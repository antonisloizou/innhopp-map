/*

  This file is part of StageBox Project .

    StageBox is free software; you can redistribute it and/or modify
    it under the terms of the GNU Lesser General Public License as published by
    the Free Software Foundation; either version 2 of the License, or
    (at your option) any later version.

    StageBox is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU Lesser General Public License for more details.

    You should have received a copy of the GNU Leaser General Public License
    along with StageBox; if not, write to the Free Software
    Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA

 ================================================================================

 @author CAMENSULI Christophe


 @fileoverview This file is to be used for CORE stage library
 <a href='http://stage-box.com'>stage</a>

 @description
 <p>
  Changes :
  2009-03-07 : creation of the file
 </p>
 Sizzle CSS Selector Engine v1.10.19-pre
 http://sizzlejs.com/

 Copyright 2013 jQuery Foundation, Inc. and other contributors
 Released under the MIT license
 http://jquery.org/license

 Date: 2014-02-24
*/
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(b){var d=0;return function(){return d<b.length?{done:!1,value:b[d++]}:{done:!0}}};$jscomp.arrayIterator=function(b){return{next:$jscomp.arrayIteratorImpl(b)}};$jscomp.makeIterator=function(b){var d="undefined"!=typeof Symbol&&Symbol.iterator&&b[Symbol.iterator];return d?d.call(b):$jscomp.arrayIterator(b)};$jscomp.arrayFromIterator=function(b){for(var d,u=[];!(d=b.next()).done;)u.push(d.value);return u};
$jscomp.arrayFromIterable=function(b){return b instanceof Array?b:$jscomp.arrayFromIterator($jscomp.makeIterator(b))};$jscomp.getGlobal=function(b){return"undefined"!=typeof window&&window===b?b:"undefined"!=typeof global&&null!=global?global:b};$jscomp.global=$jscomp.getGlobal(this);$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(b,d,u){b!=Array.prototype&&b!=Object.prototype&&(b[d]=u.value)};$jscomp.polyfill=function(b,d,u,k){if(d){u=$jscomp.global;b=b.split(".");for(k=0;k<b.length-1;k++){var l=b[k];l in u||(u[l]={});u=u[l]}b=b[b.length-1];k=u[b];d=d(k);d!=k&&null!=d&&$jscomp.defineProperty(u,b,{configurable:!0,writable:!0,value:d})}};$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(b){function d(){this.batch_=null}function u(b){return b instanceof l?b:new l(function(d,g){d(b)})}if(b&&!$jscomp.FORCE_POLYFILL_PROMISE)return b;d.prototype.asyncExecute=function(b){if(null==this.batch_){this.batch_=[];var d=this;this.asyncExecuteFunction(function(){d.executeBatch_()})}this.batch_.push(b)};var k=$jscomp.global.setTimeout;d.prototype.asyncExecuteFunction=function(b){k(b,0)};d.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var b=
this.batch_;this.batch_=[];for(var d=0;d<b.length;++d){var g=b[d];b[d]=null;try{g()}catch(f){this.asyncThrow_(f)}}}this.batch_=null};d.prototype.asyncThrow_=function(b){this.asyncExecuteFunction(function(){throw b;})};var l=function(b){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var d=this.createResolveAndReject_();try{b(d.resolve,d.reject)}catch(r){d.reject(r)}};l.prototype.createResolveAndReject_=function(){function b(b){return function(f){g||(g=!0,b.call(d,f))}}var d=this,g=!1;
return{resolve:b(this.resolveTo_),reject:b(this.reject_)}};l.prototype.resolveTo_=function(b){if(b===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(b instanceof l)this.settleSameAsPromise_(b);else{a:switch(typeof b){case "object":var d=null!=b;break a;case "function":d=!0;break a;default:d=!1}d?this.resolveToNonPromiseObj_(b):this.fulfill_(b)}};l.prototype.resolveToNonPromiseObj_=function(b){var d=void 0;try{d=b.then}catch(r){this.reject_(r);return}"function"==typeof d?
this.settleSameAsThenable_(d,b):this.fulfill_(b)};l.prototype.reject_=function(b){this.settle_(2,b)};l.prototype.fulfill_=function(b){this.settle_(1,b)};l.prototype.settle_=function(b,d){if(0!=this.state_)throw Error("Cannot settle("+b+", "+d+"): Promise already settled in state"+this.state_);this.state_=b;this.result_=d;this.executeOnSettledCallbacks_()};l.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var b=0;b<this.onSettledCallbacks_.length;++b)g.asyncExecute(this.onSettledCallbacks_[b]);
this.onSettledCallbacks_=null}};var g=new d;l.prototype.settleSameAsPromise_=function(b){var d=this.createResolveAndReject_();b.callWhenSettled_(d.resolve,d.reject)};l.prototype.settleSameAsThenable_=function(b,d){var g=this.createResolveAndReject_();try{b.call(d,g.resolve,g.reject)}catch(f){g.reject(f)}};l.prototype.then=function(b,d){function g(b,d){return"function"==typeof b?function(d){try{f(b(d))}catch(H){n(H)}}:d}var f,n,t=new l(function(b,d){f=b;n=d});this.callWhenSettled_(g(b,f),g(d,n));return t};
l.prototype.catch=function(b){return this.then(void 0,b)};l.prototype.callWhenSettled_=function(b,d){function r(){switch(f.state_){case 1:b(f.result_);break;case 2:d(f.result_);break;default:throw Error("Unexpected state: "+f.state_);}}var f=this;null==this.onSettledCallbacks_?g.asyncExecute(r):this.onSettledCallbacks_.push(r)};l.resolve=u;l.reject=function(b){return new l(function(d,g){g(b)})};l.race=function(b){return new l(function(d,g){for(var f=$jscomp.makeIterator(b),n=f.next();!n.done;n=f.next())u(n.value).callWhenSettled_(d,
g)})};l.all=function(b){var d=$jscomp.makeIterator(b),g=d.next();return g.done?u([]):new l(function(b,n){function f(f){return function(d){r[f]=d;t--;0==t&&b(r)}}var r=[],t=0;do r.push(void 0),t++,u(g.value).callWhenSettled_(f(r.length-1),n),g=d.next();while(!g.done)})};return l},"es6","es3");$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};
$jscomp.SymbolClass=function(b,d){this.$jscomp$symbol$id_=b;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:d})};$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};$jscomp.Symbol=function(){function b(u){if(this instanceof b)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(u||"")+"_"+d++,u)}var d=0;return b}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var b=$jscomp.global.Symbol.iterator;b||(b=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[b]&&$jscomp.defineProperty(Array.prototype,b,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var b=$jscomp.global.Symbol.asyncIterator;b||(b=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(b){$jscomp.initSymbolIterator();b={next:b};b[$jscomp.global.Symbol.iterator]=function(){return this};return b};$jscomp.underscoreProtoCanBeSet=function(){var b={a:!0},d={};try{return d.__proto__=b,d.a}catch(u){}return!1};
$jscomp.setPrototypeOf="function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(b,d){b.__proto__=d;if(b.__proto__!==d)throw new TypeError(b+" is not extensible");return b}:null;$jscomp.generator={};$jscomp.generator.ensureIteratorResultIsObject_=function(b){if(!(b instanceof Object))throw new TypeError("Iterator result "+b+" is not an object");};
$jscomp.generator.Context=function(){this.isRunning_=!1;this.yieldAllIterator_=null;this.yieldResult=void 0;this.nextAddress=1;this.finallyAddress_=this.catchAddress_=0;this.finallyContexts_=this.abruptCompletion_=null};$jscomp.generator.Context.prototype.start_=function(){if(this.isRunning_)throw new TypeError("Generator is already running");this.isRunning_=!0};$jscomp.generator.Context.prototype.stop_=function(){this.isRunning_=!1};
$jscomp.generator.Context.prototype.jumpToErrorHandler_=function(){this.nextAddress=this.catchAddress_||this.finallyAddress_};$jscomp.generator.Context.prototype.next_=function(b){this.yieldResult=b};$jscomp.generator.Context.prototype.throw_=function(b){this.abruptCompletion_={exception:b,isException:!0};this.jumpToErrorHandler_()};$jscomp.generator.Context.prototype.return=function(b){this.abruptCompletion_={return:b};this.nextAddress=this.finallyAddress_};
$jscomp.generator.Context.prototype.jumpThroughFinallyBlocks=function(b){this.abruptCompletion_={jumpTo:b};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.yield=function(b,d){this.nextAddress=d;return{value:b}};$jscomp.generator.Context.prototype.yieldAll=function(b,d){b=$jscomp.makeIterator(b);var u=b.next();$jscomp.generator.ensureIteratorResultIsObject_(u);if(u.done)this.yieldResult=u.value,this.nextAddress=d;else return this.yieldAllIterator_=b,this.yield(u.value,d)};
$jscomp.generator.Context.prototype.jumpTo=function(b){this.nextAddress=b};$jscomp.generator.Context.prototype.jumpToEnd=function(){this.nextAddress=0};$jscomp.generator.Context.prototype.setCatchFinallyBlocks=function(b,d){this.catchAddress_=b;void 0!=d&&(this.finallyAddress_=d)};$jscomp.generator.Context.prototype.setFinallyBlock=function(b){this.catchAddress_=0;this.finallyAddress_=b||0};$jscomp.generator.Context.prototype.leaveTryBlock=function(b,d){this.nextAddress=b;this.catchAddress_=d||0};
$jscomp.generator.Context.prototype.enterCatchBlock=function(b){this.catchAddress_=b||0;b=this.abruptCompletion_.exception;this.abruptCompletion_=null;return b};$jscomp.generator.Context.prototype.enterFinallyBlock=function(b,d,u){u?this.finallyContexts_[u]=this.abruptCompletion_:this.finallyContexts_=[this.abruptCompletion_];this.catchAddress_=b||0;this.finallyAddress_=d||0};
$jscomp.generator.Context.prototype.leaveFinallyBlock=function(b,d){d=this.finallyContexts_.splice(d||0)[0];if(d=this.abruptCompletion_=this.abruptCompletion_||d){if(d.isException)return this.jumpToErrorHandler_();void 0!=d.jumpTo&&this.finallyAddress_<d.jumpTo?(this.nextAddress=d.jumpTo,this.abruptCompletion_=null):this.nextAddress=this.finallyAddress_}else this.nextAddress=b};$jscomp.generator.Context.prototype.forIn=function(b){return new $jscomp.generator.Context.PropertyIterator(b)};
$jscomp.generator.Context.PropertyIterator=function(b){this.object_=b;this.properties_=[];for(var d in b)this.properties_.push(d);this.properties_.reverse()};$jscomp.generator.Context.PropertyIterator.prototype.getNext=function(){for(;0<this.properties_.length;){var b=this.properties_.pop();if(b in this.object_)return b}return null};$jscomp.generator.Engine_=function(b){this.context_=new $jscomp.generator.Context;this.program_=b};
$jscomp.generator.Engine_.prototype.next_=function(b){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_.next,b,this.context_.next_);this.context_.next_(b);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.return_=function(b){this.context_.start_();var d=this.context_.yieldAllIterator_;if(d)return this.yieldAllStep_("return"in d?d["return"]:function(b){return{value:b,done:!0}},b,this.context_.return);this.context_.return(b);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.throw_=function(b){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_["throw"],b,this.context_.next_);this.context_.throw_(b);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.yieldAllStep_=function(b,d,u){try{var k=b.call(this.context_.yieldAllIterator_,d);$jscomp.generator.ensureIteratorResultIsObject_(k);if(!k.done)return this.context_.stop_(),k;var l=k.value}catch(g){return this.context_.yieldAllIterator_=null,this.context_.throw_(g),this.nextStep_()}this.context_.yieldAllIterator_=null;u.call(this.context_,l);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.nextStep_=function(){for(;this.context_.nextAddress;)try{var b=this.program_(this.context_);if(b)return this.context_.stop_(),{value:b.value,done:!1}}catch(d){this.context_.yieldResult=void 0,this.context_.throw_(d)}this.context_.stop_();if(this.context_.abruptCompletion_){b=this.context_.abruptCompletion_;this.context_.abruptCompletion_=null;if(b.isException)throw b.exception;return{value:b.return,done:!0}}return{value:void 0,done:!0}};
$jscomp.generator.Generator_=function(b){this.next=function(d){return b.next_(d)};this.throw=function(d){return b.throw_(d)};this.return=function(d){return b.return_(d)};$jscomp.initSymbolIterator();this[Symbol.iterator]=function(){return this}};$jscomp.generator.createGenerator=function(b,d){d=new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(d));$jscomp.setPrototypeOf&&$jscomp.setPrototypeOf(d,b.prototype);return d};
$jscomp.asyncExecutePromiseGenerator=function(b){function d(d){return b.next(d)}function u(d){return b.throw(d)}return new Promise(function(k,l){function g(b){b.done?k(b.value):Promise.resolve(b.value).then(d,u).then(g,l)}g(b.next())})};$jscomp.asyncExecutePromiseGeneratorFunction=function(b){return $jscomp.asyncExecutePromiseGenerator(b())};$jscomp.asyncExecutePromiseGeneratorProgram=function(b){return $jscomp.asyncExecutePromiseGenerator(new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(b)))};
$jscomp.findInternal=function(b,d,u){b instanceof String&&(b=String(b));for(var k=b.length,l=0;l<k;l++){var g=b[l];if(d.call(u,g,l,b))return{i:l,v:g}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.find",function(b){return b?b:function(b,u){return $jscomp.findInternal(this,b,u).v}},"es6","es3");
$jscomp.iteratorFromArray=function(b,d){$jscomp.initSymbolIterator();b instanceof String&&(b+="");var u=0,k={next:function(){if(u<b.length){var l=u++;return{value:d(l,b[l]),done:!1}}k.next=function(){return{done:!0,value:void 0}};return k.next()}};k[Symbol.iterator]=function(){return k};return k};$jscomp.polyfill("Array.prototype.keys",function(b){return b?b:function(){return $jscomp.iteratorFromArray(this,function(b){return b})}},"es6","es3");
$jscomp.polyfill("Number.parseFloat",function(b){return b||parseFloat},"es6","es3");$jscomp.polyfill("Array.prototype.findIndex",function(b){return b?b:function(b,u){return $jscomp.findInternal(this,b,u).i}},"es6","es3");$jscomp.polyfill("Array.prototype.fill",function(b){return b?b:function(b,u,k){var d=this.length||0;0>u&&(u=Math.max(0,d+u));if(null==k||k>d)k=d;k=Number(k);0>k&&(k=Math.max(0,d+k));for(u=Number(u||0);u<k;u++)this[u]=b;return this}},"es6","es3");
$jscomp.checkEs6ConformanceViaProxy=function(){try{var b={},d=Object.create(new $jscomp.global.Proxy(b,{get:function(u,k,l){return u==b&&"q"==k&&l==d}}));return!0===d.q}catch(u){return!1}};$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS=!1;$jscomp.ES6_CONFORMANCE=$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS&&$jscomp.checkEs6ConformanceViaProxy();$jscomp.owns=function(b,d){return Object.prototype.hasOwnProperty.call(b,d)};
$jscomp.polyfill("WeakMap",function(b){function d(){if(!b||!Object.seal)return!1;try{var d=Object.seal({}),f=Object.seal({}),n=new b([[d,2],[f,3]]);if(2!=n.get(d)||3!=n.get(f))return!1;n.delete(d);n.set(f,4);return!n.has(d)&&4==n.get(f)}catch(B){return!1}}function u(){}function k(b){if(!$jscomp.owns(b,g)){var f=new u;$jscomp.defineProperty(b,g,{value:f})}}function l(b){var f=Object[b];f&&(Object[b]=function(b){if(b instanceof u)return b;k(b);return f(b)})}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(b&&
$jscomp.ES6_CONFORMANCE)return b}else if(d())return b;var g="$jscomp_hidden_"+Math.random();l("freeze");l("preventExtensions");l("seal");var q=0,t=function(b){this.id_=(q+=Math.random()+1).toString();if(b){b=$jscomp.makeIterator(b);for(var f;!(f=b.next()).done;)f=f.value,this.set(f[0],f[1])}};t.prototype.set=function(b,f){k(b);if(!$jscomp.owns(b,g))throw Error("WeakMap key fail: "+b);b[g][this.id_]=f;return this};t.prototype.get=function(b){return $jscomp.owns(b,g)?b[g][this.id_]:void 0};t.prototype.has=
function(b){return $jscomp.owns(b,g)&&$jscomp.owns(b[g],this.id_)};t.prototype.delete=function(b){return $jscomp.owns(b,g)&&$jscomp.owns(b[g],this.id_)?delete b[g][this.id_]:!1};return t},"es6","es3");$jscomp.MapEntry=function(){};
$jscomp.polyfill("Map",function(b){function d(){if($jscomp.ASSUME_NO_NATIVE_MAP||!b||"function"!=typeof b||!b.prototype.entries||"function"!=typeof Object.seal)return!1;try{var d=Object.seal({x:4}),f=new b($jscomp.makeIterator([[d,"s"]]));if("s"!=f.get(d)||1!=f.size||f.get({x:4})||f.set({x:4},"t")!=f||2!=f.size)return!1;var n=f.entries(),g=n.next();if(g.done||g.value[0]!=d||"s"!=g.value[1])return!1;g=n.next();return g.done||4!=g.value[0].x||"t"!=g.value[1]||!n.next().done?!1:!0}catch(w){return!1}}
if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(b&&$jscomp.ES6_CONFORMANCE)return b}else if(d())return b;$jscomp.initSymbolIterator();var u=new WeakMap,k=function(b){this.data_={};this.head_=q();this.size=0;if(b){b=$jscomp.makeIterator(b);for(var f;!(f=b.next()).done;)f=f.value,this.set(f[0],f[1])}};k.prototype.set=function(b,f){b=0===b?0:b;var d=l(this,b);d.list||(d.list=this.data_[d.id]=[]);d.entry?d.entry.value=f:(d.entry={next:this.head_,previous:this.head_.previous,head:this.head_,key:b,
value:f},d.list.push(d.entry),this.head_.previous.next=d.entry,this.head_.previous=d.entry,this.size++);return this};k.prototype.delete=function(b){b=l(this,b);return b.entry&&b.list?(b.list.splice(b.index,1),b.list.length||delete this.data_[b.id],b.entry.previous.next=b.entry.next,b.entry.next.previous=b.entry.previous,b.entry.head=null,this.size--,!0):!1};k.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=q();this.size=0};k.prototype.has=function(b){return!!l(this,b).entry};
k.prototype.get=function(b){return(b=l(this,b).entry)&&b.value};k.prototype.entries=function(){return g(this,function(b){return[b.key,b.value]})};k.prototype.keys=function(){return g(this,function(b){return b.key})};k.prototype.values=function(){return g(this,function(b){return b.value})};k.prototype.forEach=function(b,f){for(var d=this.entries(),g;!(g=d.next()).done;)g=g.value,b.call(f,g[1],g[0],this)};k.prototype[Symbol.iterator]=k.prototype.entries;var l=function(b,f){var d=f&&typeof f;"object"==
d||"function"==d?u.has(f)?d=u.get(f):(d=""+ ++t,u.set(f,d)):d="p_"+f;var g=b.data_[d];if(g&&$jscomp.owns(b.data_,d))for(b=0;b<g.length;b++){var r=g[b];if(f!==f&&r.key!==r.key||f===r.key)return{id:d,list:g,index:b,entry:r}}return{id:d,list:g,index:-1,entry:void 0}},g=function(b,f){var d=b.head_;return $jscomp.iteratorPrototype(function(){if(d){for(;d.head!=b.head_;)d=d.previous;for(;d.next!=d.head;)return d=d.next,{done:!1,value:f(d)};d=null}return{done:!0,value:void 0}})},q=function(){var b={};return b.previous=
b.next=b.head=b},t=0;return k},"es6","es3");
$jscomp.polyfill("Set",function(b){function d(){if($jscomp.ASSUME_NO_NATIVE_SET||!b||"function"!=typeof b||!b.prototype.entries||"function"!=typeof Object.seal)return!1;try{var d=Object.seal({x:4}),l=new b($jscomp.makeIterator([d]));if(!l.has(d)||1!=l.size||l.add(d)!=l||1!=l.size||l.add({x:4})!=l||2!=l.size)return!1;var g=l.entries(),q=g.next();if(q.done||q.value[0]!=d||q.value[1]!=d)return!1;q=g.next();return q.done||q.value[0]==d||4!=q.value[0].x||q.value[1]!=q.value[0]?!1:g.next().done}catch(t){return!1}}
if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(b&&$jscomp.ES6_CONFORMANCE)return b}else if(d())return b;$jscomp.initSymbolIterator();var u=function(b){this.map_=new Map;if(b){b=$jscomp.makeIterator(b);for(var d;!(d=b.next()).done;)this.add(d.value)}this.size=this.map_.size};u.prototype.add=function(b){b=0===b?0:b;this.map_.set(b,b);this.size=this.map_.size;return this};u.prototype.delete=function(b){b=this.map_.delete(b);this.size=this.map_.size;return b};u.prototype.clear=function(){this.map_.clear();
this.size=0};u.prototype.has=function(b){return this.map_.has(b)};u.prototype.entries=function(){return this.map_.entries()};u.prototype.values=function(){return this.map_.values()};u.prototype.keys=u.prototype.values;u.prototype[Symbol.iterator]=u.prototype.values;u.prototype.forEach=function(b,d){var g=this;this.map_.forEach(function(k){return b.call(d,k,k,g)})};return u},"es6","es3");
$jscomp.assign="function"==typeof Object.assign?Object.assign:function(b,d){for(var u=1;u<arguments.length;u++){var k=arguments[u];if(k)for(var l in k)$jscomp.owns(k,l)&&(b[l]=k[l])}return b};$jscomp.polyfill("Object.assign",function(b){return b||$jscomp.assign},"es6","es3");
$jscomp.polyfill("Array.from",function(b){return b?b:function(b,u,k){u=null!=u?u:function(b){return b};var d=[],g="undefined"!=typeof Symbol&&Symbol.iterator&&b[Symbol.iterator];if("function"==typeof g){b=g.call(b);for(var q=0;!(g=b.next()).done;)d.push(u.call(k,g.value,q++))}else for(g=b.length,q=0;q<g;q++)d.push(u.call(k,b[q],q));return d}},"es6","es3");$jscomp.polyfill("Object.is",function(b){return b?b:function(b,u){return b===u?0!==b||1/b===1/u:b!==b&&u!==u}},"es6","es3");
$jscomp.polyfill("Array.prototype.includes",function(b){return b?b:function(b,u){var d=this;d instanceof String&&(d=String(d));var l=d.length;u=u||0;for(0>u&&(u=Math.max(u+l,0));u<l;u++){var g=d[u];if(g===b||Object.is(g,b))return!0}return!1}},"es7","es3");
$jscomp.checkStringArgs=function(b,d,u){if(null==b)throw new TypeError("The 'this' value for String.prototype."+u+" must not be null or undefined");if(d instanceof RegExp)throw new TypeError("First argument to String.prototype."+u+" must not be a regular expression");return b+""};$jscomp.polyfill("String.prototype.includes",function(b){return b?b:function(b,u){return-1!==$jscomp.checkStringArgs(this,b,"includes").indexOf(b,u||0)}},"es6","es3");
$jscomp.polyfill("Math.sign",function(b){return b?b:function(b){b=Number(b);return 0===b||isNaN(b)?b:0<b?1:-1}},"es6","es3");$jscomp.polyfill("Math.log2",function(b){return b?b:function(b){return Math.log(b)/Math.LN2}},"es6","es3");$jscomp.polyfill("Array.prototype.values",function(b){return b?b:function(){return $jscomp.iteratorFromArray(this,function(b,u){return u})}},"es8","es3");
$jscomp.polyfill("String.prototype.repeat",function(b){return b?b:function(b){var d=$jscomp.checkStringArgs(this,null,"repeat");if(0>b||1342177279<b)throw new RangeError("Invalid count value");b|=0;for(var k="";b;)if(b&1&&(k+=d),b>>>=1)d+=d;return k}},"es6","es3");
$jscomp.polyfill("String.prototype.endsWith",function(b){return b?b:function(b,u){var d=$jscomp.checkStringArgs(this,b,"endsWith");b+="";void 0===u&&(u=d.length);u=Math.max(0,Math.min(u|0,d.length));for(var l=b.length;0<l&&0<u;)if(d[--u]!=b[--l])return!1;return 0>=l}},"es6","es3");$jscomp.polyfill("Object.values",function(b){return b?b:function(b){var d=[],k;for(k in b)$jscomp.owns(b,k)&&d.push(b[k]);return d}},"es8","es3");
$jscomp.polyfill("Math.trunc",function(b){return b?b:function(b){b=Number(b);if(isNaN(b)||Infinity===b||-Infinity===b||0===b)return b;var d=Math.floor(Math.abs(b));return 0>b?-d:d}},"es6","es3");
var stage=function(){var b=(new Date).getTime(),d=!1,u=function(){return window.document||null},k=function(b){var h=typeof b;if("object"===h){if(null===b)return"object";if(b instanceof Array||!(b instanceof Object)&&"[object Array]"===Object.prototype.toString.call(b)||"number"===typeof b.length&&"undefined"!==typeof b.splice&&"undefined"!==typeof b.propertyIsEnumerable&&!b.propertyIsEnumerable("splice"))return"array";if(!(b instanceof Object||"[object Function]"!==Object.prototype.toString.call(b)&&
("undefined"===typeof b.call||"undefined"===typeof b.propertyIsEnumerable||b.propertyIsEnumerable("call"))))return"function";if(1===b.nodeType)return"element";if(9===b.nodeType)return"document";if(b===stage.window)return"window";if(b instanceof Date)return"date";if(b.callee)return"arguments";if(b instanceof SyntaxError)return"SyntaxError";if(b instanceof Error)return"Error";if(b instanceof n)return"selector";if(b instanceof B)return"selectorXml"}else if("function"===h&&"undefined"===typeof b.call)return"object";
return h},l={};window.$stage=function(){return window.Element?function(b){return"string"==typeof b?document.getElementById(b):b}:function(b){"string"==typeof b&&(b=document.getElementById(b));for(var h in l)"function"!=k(l[h])||h in b||(b[h]=l[h]);return b}}();var g=function(b,h){switch(k(b)){case "element":return stage.isXML(b.ownerDocument)?new B(b,b):new n(b,b);case "document":return stage.isXML(b)?new B(h,b):new n(h,b);default:return new n(h,b)}};window.$$stage=function(b,h){if(h)switch(k(h)){case "element":case "document":return g(b,
h);case "array":case "string":return(new n(document,h)).find(b);case "selector":case "selectorXml":return h.find(b);case "object":try{return(new n(document,Array.prototype.slice.apply(h))).find(b)}catch(C){throw Error("stage context selector is not valid");}default:throw Error("stage context selector is not valid");}return g(b,document)};for(var q=function(){try{var b=Array.prototype.slice.call(document.forms,0)instanceof Array}catch(aa){b=!1}return b?function(b){return Array.prototype.slice.apply(this.getElementsByTagName(b))}:
function(b){return t(this.getElementsByTagName(b))}}(),t=function(b){for(var h=-1,e=[],f;f=b[++h];)e[h]=f;return e},r=/^(?:[^<]*(<[\w\W]+>)[^>]*$|#([\w\-]+)$)/,f=function(b,h){switch(h){case "string":if(h=r.exec(b)){if(h[2]){var e=document.getElementById(h[2]);return e&&e.id===h[2]?[e]:stage.selector(b,this)}if(h[1])return[]}else return/\W/.exec(b)?stage.selector(b,this):3===this.nodeType?[]:q.call(this,b);case "document":case "window":case "element":return Array(b);case "array":return b;default:return[]}},
n=function(b,h,e){this.context=b;this.selector=f.call(b,h,k(h));this.length=this.selector.length;this.prevSelector=null},B=function(b,h,e){this.context=b;this.selector=f.call(b,h,k(h));this.length=this.selector.length;this.prevSelector=null},w=[n,B],D=0;D<w.length;D++)(function(b){b.prototype.get=function(b){return b||0===b?this.selector[b]:this.selector};b.prototype.andSelf=function(){var b=stage.array.uniq(this.selector.concat(this.prevSelector));this.prevSelector=this.selector;this.selector=b;
this.length=b.length;return this};b.prototype.each=function(b){A.call(this,this.selector,b);return this};b.prototype.is=function(b){return!!b&&0<stage.matches(b,this.selector).length};b.prototype.first=function(){var h=new b(this.context,this.selector[0]);h.prevSelector=this.selector;return h};b.prototype.last=function(){var h=new b(this.context,this.selector[this.selector.length-1]);h.prevSelector=this.selector;return h};b.prototype.not=function(b){return this.filter(":not("+b+")")};b.prototype.has=
function(b){return 0<stage.matches(b,this.selector).length};b.prototype.filter=function(h){if(1===this.length){if(stage.matchesSelector(this.selector[0],h))return this;h=new b;h.prevSelector=this.selector;return h}h=new b(this.context,stage.matches(h,this.selector));h.prevSelector=this.selector;return h};b.prototype.find=function(h){var e=k(h);if(1==this.selector.length){var v=f.call(this.selector[0],h,e);h=new b(this.context,stage.array.uniq(v));h.prevSelector=this.selector;return h}for(var m=[],
d=0;d<this.selector.length;d++)v=f.call(this.selector[d],h,e),0!=v.length&&(m=m.concat(v));h=new b(this.context,stage.array.uniq(m));h.prevSelector=this.selector;return h}})(w[D]);n.prototype.querySelector=function(b){return document.querySelector?function(b){if(b)return this.selector[0].querySelector(b)}:function(b){if(b)return stage.selector(b,this.selector[0])[0]}}();var A=function(b,h){switch(k(b)){case "array":try{for(var e=0;e<b.length&&!1!==h(b[e],e,this);e++);}catch(L){window.console&&console.log&&
console.log(L)}break;case "object":try{for(e in b)if("function"!==typeof b[e]&&!1===h(b[e],e,this))break}catch(L){window.console&&console.log&&console.log(L)}}return b},H="STAGE",e="STAGE";w=function(b){var h=!1,f=!1;window.Prototype&&(b?d=!1:(stage.thirdPartyLibraries.Prototype.active=!!window.Prototype,stage.thirdPartyLibraries.Prototype.version=window.Prototype.Version,"STAGE"==H&&alert("WARNING  : You should put PROTOTYPEJS srcipt before STAGE library")),f=h=!0,e=H="PrototypeJs");window.jQuery&&
(b||(stage.thirdPartyLibraries.Jquery.active=!!window.jQuery,stage.thirdPartyLibraries.Jquery.version=$().jquery,"STAGE"==H&&alert("WARNING  : You should put JQUERY srcipt before STAGE library")),h=!0,H="jQuery");window.dojo&&!b&&(stage.thirdPartyLibraries.dojo.active=!!window.dojo);window.goog&&!b&&(stage.thirdPartyLibraries.closure.active=!!window.goog);h||window.$||!b||(window.$=$stage);f||window.$$||!b||(window.$$=$$stage)};w(!0);var E=function(b,h){this.eventsStage={};this.garbageEvent={};b&&
this.settingsToListen(b,h)};E.prototype.isRegistered=function(b){return this.eventsStage[b]?this.eventsStage[b]:!1};E.prototype.listen=function(b,h,e){var f=this;this.eventsStage[h]&&"array"==stage.typeOf(this.eventsStage[h])||(this.eventsStage[h]=[],this.garbageEvent[h]=[]);"function"===k(e)&&(this.garbageEvent[h].push(e),this.eventsStage[h].push(function(h){e.apply(b,h)}));return function(b){return f.fireEvent(h,b)}};E.prototype.detachEvent=function(b,h){if(this.garbageEvent[b])for(var e=0;e<this.garbageEvent[b].length;e++)if(this.garbageEvent[b][e]===
h)switch(e){case 0:this.garbageEvent[b].shift();this.eventsStage[b].shift();break;default:if(e===this.garbageEvent[b].length-1)this.garbageEvent[b].pop(),this.eventsStage[b].pop();else{var f=this.garbageEvent[b].slice(0,e),v=this.garbageEvent[b].slice(e,this.garbageEvent[b].length);v.shift();this.garbageEvent[b]=f.concat(v);f=this.eventsStage[b].slice(0,e);v=this.eventsStage[b].slice(e,this.eventsStage[b].length);v.shift();this.eventsStage[b]=f.concat(v)}}};E.prototype.clearEvents=function(b){if(this.eventsStage[b]){for(;0<
this.eventsStage[b].length;)this.eventsStage[b].pop(),this.garbageEvent[b].pop();delete this.eventsStage[b];delete this.garbageEvent[b]}};E.prototype.fireEvent=function(b){var h=!0;if(this.eventsStage[b])for(var e=Array.prototype.slice.call(arguments,1),f=0;f<this.eventsStage[b].length;f++)try{if(!1===this.eventsStage[b][f](e)){h=!1;break}}catch(K){p.fireEvent("onEventsException",K)}return h};E.prototype.fire=E.prototype.fireEvent;E.prototype.fireWith=function(b,h){var e=!0;if(this.garbageEvent[b])for(var f=
Array.prototype.slice.call(arguments,2),v=0;v<this.garbageEvent[b].length;v++)try{if(!1===this.garbageEvent[b][v].apply(h,f)){e=!1;break}}catch(G){p.fireEvent("onEventsException",G)}return e};E.prototype.fireAsync=function(){var b=arguments;setTimeout(function(){this.fireEvent.apply(this,b)}.bind(this),0)};var F=/^on(.*)$/;E.prototype.settingsToListen=function(b,h){for(var e in b){var f=F.exec(e);f&&this.listen(h||this,f[0],b[e])}};var p=new E;p.listen(this,"onEventsException",function(b){try{stage.console&&
stage.console.error&&stage.console.error("stageGlobalEvents  onEventsException : "+b),window.console&&console.error?(console.error("stageGlobalEvents  onEventsException : "),console.error(b)):window.console&&console.log&&(console.log("stageGlobalEvents  onEventsException : "),console.log(b))}catch(aa){}});p.listen(this,"onLoad",w);w=function(){stage.STAGENDREGISTER=(new Date).getTime();p.fireEvent("onLoad");stage.STAGENDLOAD=(new Date).getTime();$$stage(".timeStageLoad").update(stage.STAGENDLOAD-
stage.STAGESTOP+"ms")};window.addEventListener?(window.addEventListener("load",w,!1),window.addEventListener("unload",p.listen(this,"unLoad",null),!1),window.addEventListener("resize",p.listen(this,"onResize",null),!1)):(window.attachEvent("onload",w),window.attachEvent("onunload",p.listen(this,"unLoad",null)),window.attachEvent("onresize",p.listen(this,"onResize",null)));w=navigator.userAgent.toLowerCase();D=function(){};var m=function(b,h){if(window.console&&console[b])console[b](h.toString());
return h},h=function(){};h.prototype.error=function(b){stage.DEBUG?stage.console.error(b.toString()):m("error",b);return b};h.prototype.emergency=h.prototype.error;h.prototype.alert=function(b){alert(b.toString());return b};h.prototype.critic=h.prototype.error;h.prototype.warning=function(b){stage.DEBUG?stage.console.warning(b.toString()):m("warning",b);return b};h.prototype.info=function(b){stage.DEBUG?stage.console.info(b.toString()):m("info",b);return b};h.prototype.notice=h.prototype.info;h.prototype.debug=
function(b){stage.DEBUG?stage.console.log(b.toString()):m("log",b);return b};h.prototype.logger=function(b){var h=null;if(b)switch(b.severity){case 0:h=this.emergency(b);break;case 1:h=this.alert(b);break;case 2:h=this.critic(b);break;case 3:h=this.error(b);break;case 4:h=this.warning(b);break;case 5:h=this.notice(b);break;case 6:h=this.info(b);break;case 7:h=this.debug(b)}return h};var v=-1<navigator.userAgent.indexOf("MSIE")||-1<navigator.userAgent.indexOf("Trident")?"MSIE":-1<navigator.userAgent.indexOf("Firefox")?
"Firefox":-1<navigator.userAgent.indexOf("Chrome")?"Chrome":-1<navigator.userAgent.indexOf("Safari")?"Safari":-1<navigator.userAgent.indexOf("Opera")?"Opera":-1<navigator.userAgent.indexOf("Iceweasel")?"Firefox":"undefined",I=/MSIE (\d+\.\d+);/.test(navigator.userAgent)||/Firefox[\/\s](\d+\.\d+)/.test(navigator.userAgent)||/OPR[\/\s](\d+\.\d+)/.test(navigator.userAgent)||/Chrome[\/\s](\d+\.\d+)/.test(navigator.userAgent)||/Safari[\/\s](\d+\.\d+)/.test(navigator.userAgent)&&/Version[\/\s](\d+\.\d+)/.test(navigator.userAgent)||
/Opera[\/\s](\d+\.\d+)/.test(navigator.userAgent)&&/Version[\/\s](\d+\.\d+)/.test(navigator.userAgent)||/Iceweasel[\/\s](\d+\.\d+)/.test(navigator.userAgent)||/rv[:\s](\d+\.\d+)\)/.test(navigator.userAgent)?parseInt(RegExp.$1):"undefined",J=function(){var b=navigator.userAgent||navigator.vendor||window.opera;return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(b)||
/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(b.substr(0,
4))}(),M=/stage_version/.test("<%= stage_version %>")?"Trunk":"<%= stage_version %>",T=/stage_debug/.test("<%= stage_debug %>")?!0:"<%= stage_debug %>",U=[];return{document:u(),getDocument:u,STAGESTART:b,STAGENDREGISTER:null,STAGENDLOAD:null,STAGEVERSION:M,STAGE$:H,STAGE$$:e,DEBUG:T,consoles:{},INTRUSIVE:d,selector:null,matches:null,matchesSelector:null,selectorContains:null,isXML:function(b){return(b=b&&(b.ownerDocument||b).documentElement)?"HTML"!==b.nodeName:!1},VENDORSELECTOR:void 0,sysLog:null,
stagelog:h,stageError:function(b,h,e,f){return new stage.PDU(b,"ERROR",h,e,f)},thirdPartyLibraries:{stage:{active:!1,version:M,image:"http://"+location.host+"/src/library/console/themes/basic/images/stage.png",url:"http://www.stage-box.com"},Prototype:{active:!!window.Prototype,version:null,image:"http://www.prototypejs.org/images/logo-home.gif",url:"http://www.prototypejs.org/"},Jquery:{active:!!window.jQuery,version:null,image:"http://static.jquery.com/files/rocker/images/logo_jquery_215x53.gif",
url:"http://jquery.com/"},dojo:{active:!!window.dojo,version:null,image:"http://www.dojotoolkit.org/dojango/dojo-media/release/1.4.0-20100212/dtk/images/logo.png",url:"http://www.dojotoolkit.org/documentation/"},closure:{active:!!window.goog,version:null,image:"http://code.google.com/closure/images/logo128px.png",url:"http://code.google.com/closure/"}},browser:{mobilBrowser:J,navigator:v,version:I,Ie:(/msie/.test(w)||/trident/.test(w))&&!/opera/.test(w),Gecko:-1<navigator.userAgent.indexOf("Gecko")&&
-1===navigator.userAgent.indexOf("KHTML"),Webkit:/webkit/.test(w),Opera:"[object Opera]"==Object.prototype.toString.call(window.opera),platform:navigator.userAgent.match(/ip(?:ad|od|hone)/)?"ios":(navigator.userAgent.match(/(?:webos|android)/)||navigator.platform.toLowerCase().match(/mac|win|linux/)||["other"])[0]},emptyFunction:D,createEventsManager:function(b,h){return new E(b,h)},notificationsCenter:E,stageGlobalEvents:p,stageSelector:n,each:A,extend:function(){var b=arguments[0]||{},h=1,e=arguments.length,
f=!1,v,m;"boolean"===typeof b&&(f=b,b=arguments[1]||{},h=2);"object"!==typeof b&&"function"!==stage.typeOf(b)&&(b={});e===h&&(b=this,--h);for(;h<e;h++)if(null!=(v=arguments[h]))for(m in v)if(v.hasOwnProperty(m)){var d=b[m];var p=v[m];b!==p&&(f&&p&&"object"===typeof p&&!p.nodeType&&p!==stage.window?(d=d?d:"array"===k(p)?[]:"object"===k(p)?{}:p,b[m]=stage.extend(f,d,p)):void 0!==p&&(b[m]=p))}return b},isSelector:function(b){return b instanceof n},isSelectorXML:function(b){return b instanceof B},isObject:function(b){return"object"===
k(b)},isBoolean:function(b){return"boolean"===typeof b},listToArray:t,typeOf:k,getTimeStamp:function(){return(new Date).getTime()},getRandomId:function(){return Math.floor(1E9*Math.random())},provide:D,require:D,isRegistered:function(b){return this[b]?this[b]:!1},registerLog:U,register:function(b,h){if(this.isRegistered&&this.isRegistered(b))return this.isRegistered(b);h="function"===typeof h?h(this,b):h;if(stage.DEBUG)var e={name:b,type:h.logTypeToDisplay||null};switch(stage.typeOf(h)){case "object":h._beforeRegister&&
h._beforeRegister.call(h);var f=h.stage;delete h.stage;this[b]=h;this[b]._onLoad&&stage.stageGlobalEvents.listen(this[b],"onLoad",this[b]._onLoad);this[b]._unLoad&&stage.stageGlobalEvents.listen(this[b],"unLoad",this[b]._unLoad);this[b]._onResize&&stage.stageGlobalEvents.listen(this[b],"onResize",this[b]._onResize);if(f)for(var v in f)stage[v]=f[v];if(this[b].$$stage){var m=this,p="xml"===b||"xslt"===b?B:n;for(v in this[b].$$stage)p.prototype[v]=function(h){return function(){if(!this.selector.length)return this.prevSelector=
this.selector,this;for(var e,f=[],v=[],d=0;d<this.selector.length;d++)switch(e=m[b].$$stage[h].apply(this.selector[d],arguments),stage.typeOf(e)){case "element":v.push(e);break;case "array":for(var n=0;n<e.length;n++)"element"===stage.typeOf(e[n])?v.push(e[n]):void 0!==e&&f.push(e);break;default:void 0!==e&&f.push(e)}if(void 0===e)return this.prevSelector=this.selector,this;if(v.length)return e=new p(this.context,stage.array.uniq(stage.array.clone(v))),e.prevSelector=this.selector,e;if(f.length)return 1<
stage.array.uniq(stage.array.clone(f)).length?stage.array.flatten(f):f[0];e=new p(this.context);e.prevSelector=this.selector;return e}}(v),d&&(window.Element?Element.prototype[v]=function(h){return function(){var e=m[b].$$stage[h].apply(this,arguments);return void 0===e?this:e}}(v):l[v]=function(h){return function(){var e=m[b].$$stage[h].apply(this,arguments);return void 0===e?this:e}}(v))}if(this[b].local)for(v in this[b].local)this[v]=this[b].local[v];this[b]._onRegister&&this[b]._onRegister.call(h);
break;default:this[b]=h}stage.DEBUG&&U.push(e);return h},unRegister:function(b){this[b]=null;delete this[b]}}}();stage.provide("sizzle");
(function(b){function d(b,h,e,f){var v,m,d,p;(h?h.ownerDocument||h:L)!==I&&Ya(h);h=h||I;e=e||[];if(!b||"string"!==typeof b)return e;if(1!==(p=h.nodeType)&&9!==p)return[];if(M&&!f){if(v=Ba.exec(b))if(d=v[1])if(9===p)if((m=h.getElementById(d))&&m.parentNode){if(m.id===d)return e.push(m),e}else return e;else{if(h.ownerDocument&&(m=h.ownerDocument.getElementById(d))&&aa(h,m)&&m.id===d)return e.push(m),e}else{if(v[2])return ba.apply(e,h.getElementsByTagName(b)),e;if((d=v[3])&&ra.getElementsByClassName&&
h.getElementsByClassName)return ba.apply(e,h.getElementsByClassName(d)),e}if(ra.qsa&&(!T||!T.test(b))){m=v=C;d=h;var g=9===p&&b;if(1===p&&"object"!==h.nodeName.toLowerCase()){p=bb(b);(v=h.getAttribute("id"))?m=v.replace(wa,"\\$&"):h.setAttribute("id",m);m="[id='"+m+"'] ";for(d=p.length;d--;)p[d]=m+w(p[d]);d=Ka.test(b)&&n(h.parentNode)||h;g=p.join(",")}if(g)try{return ba.apply(e,d.querySelectorAll(g)),e}catch(Qa){}finally{v||h.removeAttribute("id")}}}return ib(b.replace(Ga,"$1"),h,e,f)}function u(){function b(e,
f){h.push(e+" ")>ma.cacheLength&&delete b[h.shift()];return b[e+" "]=f}var h=[];return b}function k(b){b[C]=!0;return b}function l(b){var h=I.createElement("div");try{return!!b(h)}catch(Aa){return!1}finally{h.parentNode&&h.parentNode.removeChild(h)}}function g(b,h){var e=b.split("|");for(b=b.length;b--;)ma.attrHandle[e[b]]=h}function q(b,h){var e=h&&b,f=e&&1===b.nodeType&&1===h.nodeType&&(~h.sourceIndex||-2147483648)-(~b.sourceIndex||-2147483648);if(f)return f;if(e)for(;e=e.nextSibling;)if(e===h)return-1;
return b?1:-1}function t(b){return function(h){return"input"===h.nodeName.toLowerCase()&&h.type===b}}function r(b){return function(h){var e=h.nodeName.toLowerCase();return("input"===e||"button"===e)&&h.type===b}}function f(b){return k(function(h){h=+h;return k(function(e,f){for(var v,m=b([],e.length,h),d=m.length;d--;)e[v=m[d]]&&(e[v]=!(f[v]=e[v]))})})}function n(b){return b&&"undefined"!==typeof b.getElementsByTagName&&b}function B(){}function w(b){for(var h=0,e=b.length,f="";h<e;h++)f+=b[h].value;
return f}function D(b,h,e){var f=h.dir,v=e&&"parentNode"===f,m=G++;return h.first?function(h,e,m){for(;h=h[f];)if(1===h.nodeType||v)return b(h,e,m)}:function(h,e,d){var p,n=[K,m];if(d)for(;h=h[f];){if((1===h.nodeType||v)&&b(h,e,d))return!0}else for(;h=h[f];)if(1===h.nodeType||v){var g=h[C]||(h[C]={});if((p=g[f])&&p[0]===K&&p[1]===m)return n[2]=p[2];g[f]=n;if(n[2]=b(h,e,d))return!0}}}function A(b){return 1<b.length?function(h,e,f){for(var v=b.length;v--;)if(!b[v](h,e,f))return!1;return!0}:b[0]}function H(b,
h,e,f,v){for(var m,d=[],p=0,n=b.length,g=null!=h;p<n;p++)if(m=b[p])if(!e||e(m,f,v))d.push(m),g&&h.push(p);return d}function e(b,h,f,v,m,p){v&&!v[C]&&(v=e(v));m&&!m[C]&&(m=e(m,p));return k(function(e,p,n,g){var I,r=[],t=[],k=p.length,J;if(!(J=e)){J=h||"*";for(var q=n.nodeType?[n]:n,l=[],A=0,B=q.length;A<B;A++)d(J,q[A],l);J=l}J=!b||!e&&h?J:H(J,r,b,n,g);q=f?m||(e?b:k||v)?[]:p:J;f&&f(J,q,n,g);if(v){var E=H(q,t);v(E,[],n,g);for(n=E.length;n--;)if(I=E[n])q[t[n]]=!(J[t[n]]=I)}if(e){if(m||b){if(m){E=[];for(n=
q.length;n--;)(I=q[n])&&E.push(J[n]=I);m(null,q=[],E,g)}for(n=q.length;n--;)(I=q[n])&&-1<(E=m?Z.call(e,I):r[n])&&(e[E]=!(p[E]=I))}}else q=H(q===p?q.splice(k,q.length):q),m?m(null,p,q,g):ba.apply(p,q)})}function E(b){var h,f,v=b.length,d=ma.relative[b[0].type];var p=d||ma.relative[" "];for(var n=d?1:0,g=D(function(b){return b===h},p,!0),I=D(function(b){return-1<Z.call(h,b)},p,!0),r=[function(b,e,f){return!d&&(f||e!==m)||((h=e).nodeType?g(b,e,f):I(b,e,f))}];n<v;n++)if(p=ma.relative[b[n].type])r=[D(A(r),
p)];else{p=ma.filter[b[n].type].apply(null,b[n].matches);if(p[C]){for(f=++n;f<v&&!ma.relative[b[f].type];f++);return e(1<n&&A(r),1<n&&w(b.slice(0,n-1).concat({value:" "===b[n-2].type?"*":""})).replace(Ga,"$1"),p,n<f&&E(b.slice(n,f)),f<v&&E(b=b.slice(f)),f<v&&w(b))}r.push(p)}return A(r)}function F(b,h){var e=0<h.length,f=0<b.length,v=function(v,p,n,g,r){var t,k,q,J=0,l="0",A=v&&[],B=[],E=m,F=v||f&&ma.find.TAG("*",r),w=K+=null==E?1:Math.random()||.1,T=F.length;for(r&&(m=p!==I&&p);l!==T&&null!=(t=F[l]);l++){if(f&&
t){for(k=0;q=b[k++];)if(q(t,p,n)){g.push(t);break}r&&(K=w)}e&&((t=!q&&t)&&J--,v&&A.push(t))}J+=l;if(e&&l!==J){for(k=0;q=h[k++];)q(A,B,p,n);if(v){if(0<J)for(;l--;)A[l]||B[l]||(B[l]=ea.call(g));B=H(B)}ba.apply(g,B);r&&!v&&0<B.length&&1<J+h.length&&d.uniqueSort(g)}r&&(K=w,m=E);return A};return e?k(v):v}var p,m,h,v,I,J,M,T,U,R,aa,C="sizzle"+-new Date,L=b.document,K=0,G=0,S=u(),Y=u(),ia=u(),Q=function(b,h){b===h&&(v=!0);return 0},ta={}.hasOwnProperty,ua=[],ea=ua.pop,oa=ua.push,ba=ua.push,ka=ua.slice,Z=
ua.indexOf||function(b){for(var h=0,e=this.length;h<e;h++)if(this[h]===b)return h;return-1},da="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+".replace("w","w#"),X="\\[[\\x20\\t\\r\\n\\f]*((?:\\\\.|[\\w-]|[^\\x00-\\xa0])+)[\\x20\\t\\r\\n\\f]*(?:([*^$|!~]?=)[\\x20\\t\\r\\n\\f]*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+da+")|)|)[\\x20\\t\\r\\n\\f]*\\]",Ha=":((?:\\\\.|[\\w-]|[^\\x00-\\xa0])+)(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|"+X.replace(3,8)+")*)|.*)\\)|)",Ga=/^[\x20\t\r\n\f]+|((?:^|[^\\])(?:\\.)*)[\x20\t\r\n\f]+$/g,
Fa=/^[\x20\t\r\n\f]*,[\x20\t\r\n\f]*/,xa=/^[\x20\t\r\n\f]*([>+~]|[\x20\t\r\n\f])[\x20\t\r\n\f]*/,Ia=/=[\x20\t\r\n\f]*([^\]'"]*?)[\x20\t\r\n\f]*\]/g,qa=new RegExp(Ha),Va=new RegExp("^"+da+"$"),va={ID:/^#((?:\\.|[\w-]|[^\x00-\xa0])+)/,CLASS:/^\.((?:\\.|[\w-]|[^\x00-\xa0])+)/,TAG:new RegExp("^("+"(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+".replace("w","w*")+")"),ATTR:new RegExp("^"+X),PSEUDO:new RegExp("^"+Ha),CHILD:/^:(only|first|last|nth|nth-last)-(child|of-type)(?:\([\x20\t\r\n\f]*(even|odd|(([+-]|)(\d*)n|)[\x20\t\r\n\f]*(?:([+-]|)[\x20\t\r\n\f]*(\d+)|))[\x20\t\r\n\f]*\)|)/i,
bool:/^(?:checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped)$/i,needsContext:/^[\x20\t\r\n\f]*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\([\x20\t\r\n\f]*((?:-\d)?\d*)[\x20\t\r\n\f]*\)|)(?=[^-]|$)/i},la=/^(?:input|select|textarea|button)$/i,fa=/^h\d$/i,P=/^[^{]+\{\s*\[native \w/,Ba=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,Ka=/[+~]/,wa=/'|\\/g,Ja=/\\([\da-f]{1,6}[\x20\t\r\n\f]?|([\x20\t\r\n\f])|.)/ig,La=function(b,h,e){b="0x"+h-65536;
return b!==b||e?h:0>b?String.fromCharCode(b+65536):String.fromCharCode(b>>10|55296,b&1023|56320)};try{ba.apply(ua=ka.call(L.childNodes),L.childNodes)}catch(hb){ba={apply:ua.length?function(b,h){oa.apply(b,ka.call(h))}:function(b,h){for(var e=b.length,f=0;b[e++]=h[f++];);b.length=e-1}}}var ra=d.support={};var Sa=d.isXML=function(b){return(b=b&&(b.ownerDocument||b).documentElement)?"HTML"!==b.nodeName:!1};var Ya=d.setDocument=function(b){var e=b?b.ownerDocument||b:L;b=e.defaultView;if(e===I||9!==e.nodeType||
!e.documentElement)return I;I=e;J=e.documentElement;M=!Sa(e);b&&b!==b.top&&(b.addEventListener?b.addEventListener("unload",function(){Ya()},!1):b.attachEvent&&b.attachEvent("onunload",function(){Ya()}));ra.attributes=l(function(b){b.className="i";return!b.getAttribute("className")});ra.getElementsByTagName=l(function(b){b.appendChild(e.createComment(""));return!b.getElementsByTagName("*").length});ra.getElementsByClassName=P.test(e.getElementsByClassName)&&l(function(b){b.innerHTML="<div class='a'></div><div class='a i'></div>";
b.firstChild.className="i";return 2===b.getElementsByClassName("i").length});ra.getById=l(function(b){J.appendChild(b).id=C;return!e.getElementsByName||!e.getElementsByName(C).length});ra.getById?(ma.find.ID=function(b,h){if("undefined"!==typeof h.getElementById&&M)return(b=h.getElementById(b))&&b.parentNode?[b]:[]},ma.filter.ID=function(b){var h=b.replace(Ja,La);return function(b){return b.getAttribute("id")===h}}):(delete ma.find.ID,ma.filter.ID=function(b){var h=b.replace(Ja,La);return function(b){return(b=
"undefined"!==typeof b.getAttributeNode&&b.getAttributeNode("id"))&&b.value===h}});ma.find.TAG=ra.getElementsByTagName?function(b,h){if("undefined"!==typeof h.getElementsByTagName)return h.getElementsByTagName(b)}:function(b,h){var e=[],f=0;h=h.getElementsByTagName(b);if("*"===b){for(;b=h[f++];)1===b.nodeType&&e.push(b);return e}return h};ma.find.CLASS=ra.getElementsByClassName&&function(b,h){if("undefined"!==typeof h.getElementsByClassName&&M)return h.getElementsByClassName(b)};U=[];T=[];if(ra.qsa=
P.test(e.querySelectorAll))l(function(b){b.innerHTML="<select t=''><option selected=''></option></select>";b.querySelectorAll("[t^='']").length&&T.push("[*^$]=[\\x20\\t\\r\\n\\f]*(?:''|\"\")");b.querySelectorAll("[selected]").length||T.push("\\[[\\x20\\t\\r\\n\\f]*(?:value|checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped)");b.querySelectorAll(":checked").length||T.push(":checked")}),l(function(b){var h=e.createElement("input");
h.setAttribute("type","hidden");b.appendChild(h).setAttribute("name","D");b.querySelectorAll("[name=d]").length&&T.push("name[\\x20\\t\\r\\n\\f]*[*^$|!~]?=");b.querySelectorAll(":enabled").length||T.push(":enabled",":disabled");b.querySelectorAll("*,:x");T.push(",.*:")});(ra.matchesSelector=P.test(R=J.matches||J.webkitMatchesSelector||J.mozMatchesSelector||J.oMatchesSelector||J.msMatchesSelector))&&l(function(b){ra.disconnectedMatch=R.call(b,"div");R.call(b,"[s!='']:x");U.push("!=",Ha)});T=T.length&&
new RegExp(T.join("|"));U=U.length&&new RegExp(U.join("|"));aa=(b=P.test(J.compareDocumentPosition))||P.test(J.contains)?function(b,h){var e=9===b.nodeType?b.documentElement:b;h=h&&h.parentNode;return b===h||!!(h&&1===h.nodeType&&(e.contains?e.contains(h):b.compareDocumentPosition&&b.compareDocumentPosition(h)&16))}:function(b,h){if(h)for(;h=h.parentNode;)if(h===b)return!0;return!1};Q=b?function(b,f){if(b===f)return v=!0,0;var m=!b.compareDocumentPosition-!f.compareDocumentPosition;if(m)return m;
m=(b.ownerDocument||b)===(f.ownerDocument||f)?b.compareDocumentPosition(f):1;return m&1||!ra.sortDetached&&f.compareDocumentPosition(b)===m?b===e||b.ownerDocument===L&&aa(L,b)?-1:f===e||f.ownerDocument===L&&aa(L,f)?1:h?Z.call(h,b)-Z.call(h,f):0:m&4?-1:1}:function(b,f){if(b===f)return v=!0,0;var m=0,d=b.parentNode,p=f.parentNode,n=[b],g=[f];if(!d||!p)return b===e?-1:f===e?1:d?-1:p?1:h?Z.call(h,b)-Z.call(h,f):0;if(d===p)return q(b,f);for(;b=b.parentNode;)n.unshift(b);for(b=f;b=b.parentNode;)g.unshift(b);
for(;n[m]===g[m];)m++;return m?q(n[m],g[m]):n[m]===L?-1:g[m]===L?1:0};return e};d.matches=function(b,h){return d(b,null,null,h)};d.matchesSelector=function(b,h){(b.ownerDocument||b)!==I&&Ya(b);h=h.replace(Ia,"='$1']");if(!(!ra.matchesSelector||!M||U&&U.test(h)||T&&T.test(h)))try{var e=R.call(b,h);if(e||ra.disconnectedMatch||b.document&&11!==b.document.nodeType)return e}catch(eb){}return 0<d(h,I,null,[b]).length};d.contains=function(b,h){(b.ownerDocument||b)!==I&&Ya(b);return aa(b,h)};d.attr=function(b,
h){(b.ownerDocument||b)!==I&&Ya(b);var e=ma.attrHandle[h.toLowerCase()];e=e&&ta.call(ma.attrHandle,h.toLowerCase())?e(b,h,!M):void 0;return void 0!==e?e:ra.attributes||!M?b.getAttribute(h):(e=b.getAttributeNode(h))&&e.specified?e.value:null};d.error=function(b){throw Error("Syntax error, unrecognized expression: "+b);};d.uniqueSort=function(b){var e,f=[],m=0,d=0;v=!ra.detectDuplicates;h=!ra.sortStable&&b.slice(0);b.sort(Q);if(v){for(;e=b[d++];)e===b[d]&&(m=f.push(d));for(;m--;)b.splice(f[m],1)}h=
null;return b};var Ra=d.getText=function(b){var h="",e=0;var f=b.nodeType;if(!f)for(;f=b[e++];)h+=Ra(f);else if(1===f||9===f||11===f){if("string"===typeof b.textContent)return b.textContent;for(b=b.firstChild;b;b=b.nextSibling)h+=Ra(b)}else if(3===f||4===f)return b.nodeValue;return h};var ma=d.selectors={cacheLength:50,createPseudo:k,match:va,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(b){b[1]=
b[1].replace(Ja,La);b[3]=(b[4]||b[5]||"").replace(Ja,La);"~="===b[2]&&(b[3]=" "+b[3]+" ");return b.slice(0,4)},CHILD:function(b){b[1]=b[1].toLowerCase();"nth"===b[1].slice(0,3)?(b[3]||d.error(b[0]),b[4]=+(b[4]?b[5]+(b[6]||1):2*("even"===b[3]||"odd"===b[3])),b[5]=+(b[7]+b[8]||"odd"===b[3])):b[3]&&d.error(b[0]);return b},PSEUDO:function(b){var h,e=!b[5]&&b[2];if(va.CHILD.test(b[0]))return null;b[3]&&void 0!==b[4]?b[2]=b[4]:e&&qa.test(e)&&(h=bb(e,!0))&&(h=e.indexOf(")",e.length-h)-e.length)&&(b[0]=b[0].slice(0,
h),b[2]=e.slice(0,h));return b.slice(0,3)}},filter:{TAG:function(b){var h=b.replace(Ja,La).toLowerCase();return"*"===b?function(){return!0}:function(b){return b.nodeName&&b.nodeName.toLowerCase()===h}},CLASS:function(b){var h=S[b+" "];return h||(h=new RegExp("(^|[\\x20\\t\\r\\n\\f])"+b+"([\\x20\\t\\r\\n\\f]|$)"),S(b,function(b){return h.test("string"===typeof b.className&&b.className||"undefined"!==typeof b.getAttribute&&b.getAttribute("class")||"")}))},ATTR:function(b,h,e){return function(f){f=d.attr(f,
b);if(null==f)return"!="===h;if(!h)return!0;f+="";return"="===h?f===e:"!="===h?f!==e:"^="===h?e&&0===f.indexOf(e):"*="===h?e&&-1<f.indexOf(e):"$="===h?e&&f.slice(-e.length)===e:"~="===h?-1<(" "+f+" ").indexOf(e):"|="===h?f===e||f.slice(0,e.length+1)===e+"-":!1}},CHILD:function(b,h,e,f,v){var m="nth"!==b.slice(0,3),d="last"!==b.slice(-4),p="of-type"===h;return 1===f&&0===v?function(b){return!!b.parentNode}:function(h,e,n){var g;e=m!==d?"nextSibling":"previousSibling";var I=h.parentNode,r=p&&h.nodeName.toLowerCase();
n=!n&&!p;if(I){if(m){for(;e;){for(g=h;g=g[e];)if(p?g.nodeName.toLowerCase()===r:1===g.nodeType)return!1;var t=e="only"===b&&!t&&"nextSibling"}return!0}t=[d?I.firstChild:I.lastChild];if(d&&n){n=I[C]||(I[C]={});var k=n[b]||[];var q=k[0]===K&&k[1];var J=k[0]===K&&k[2];for(g=q&&I.childNodes[q];g=++q&&g&&g[e]||(J=q=0)||t.pop();)if(1===g.nodeType&&++J&&g===h){n[b]=[K,q,J];break}}else if(n&&(k=(h[C]||(h[C]={}))[b])&&k[0]===K)J=k[1];else for(;(g=++q&&g&&g[e]||(J=q=0)||t.pop())&&((p?g.nodeName.toLowerCase()!==
r:1!==g.nodeType)||!++J||(n&&((g[C]||(g[C]={}))[b]=[K,J]),g!==h)););J-=v;return J===f||0===J%f&&0<=J/f}}},PSEUDO:function(b,h){var e=ma.pseudos[b]||ma.setFilters[b.toLowerCase()]||d.error("unsupported pseudo: "+b);if(e[C])return e(h);if(1<e.length){var f=[b,b,"",h];return ma.setFilters.hasOwnProperty(b.toLowerCase())?k(function(b,f){for(var v,m=e(b,h),d=m.length;d--;)v=Z.call(b,m[d]),b[v]=!(f[v]=m[d])}):function(b){return e(b,0,f)}}return e}},pseudos:{not:k(function(b){var h=[],e=[],f=gb(b.replace(Ga,
"$1"));return f[C]?k(function(b,h,e,v){v=f(b,null,v,[]);for(var m=b.length;m--;)if(e=v[m])b[m]=!(h[m]=e)}):function(b,v,m){h[0]=b;f(h,null,m,e);return!e.pop()}}),has:k(function(b){return function(h){return 0<d(b,h).length}}),contains:k(function(b){return function(h){return-1<(h.textContent||h.innerText||Ra(h)).indexOf(b)}}),lang:k(function(b){Va.test(b||"")||d.error("unsupported lang: "+b);b=b.replace(Ja,La).toLowerCase();return function(h){var e;do if(e=M?h.lang:h.getAttribute("xml:lang")||h.getAttribute("lang"))return e=
e.toLowerCase(),e===b||0===e.indexOf(b+"-");while((h=h.parentNode)&&1===h.nodeType);return!1}}),target:function(h){var e=b.location&&b.location.hash;return e&&e.slice(1)===h.id},root:function(b){return b===J},focus:function(b){return b===I.activeElement&&(!I.hasFocus||I.hasFocus())&&!!(b.type||b.href||~b.tabIndex)},enabled:function(b){return!1===b.disabled},disabled:function(b){return!0===b.disabled},checked:function(b){var h=b.nodeName.toLowerCase();return"input"===h&&!!b.checked||"option"===h&&
!!b.selected},selected:function(b){return!0===b.selected},empty:function(b){for(b=b.firstChild;b;b=b.nextSibling)if(6>b.nodeType)return!1;return!0},parent:function(b){return!ma.pseudos.empty(b)},header:function(b){return fa.test(b.nodeName)},input:function(b){return la.test(b.nodeName)},button:function(b){var h=b.nodeName.toLowerCase();return"input"===h&&"button"===b.type||"button"===h},text:function(b){var h;return"input"===b.nodeName.toLowerCase()&&"text"===b.type&&(null==(h=b.getAttribute("type"))||
"text"===h.toLowerCase())},first:f(function(){return[0]}),last:f(function(b,h){return[h-1]}),eq:f(function(b,h,e){return[0>e?e+h:e]}),even:f(function(b,h){for(var e=0;e<h;e+=2)b.push(e);return b}),odd:f(function(b,h){for(var e=1;e<h;e+=2)b.push(e);return b}),lt:f(function(b,h,e){for(h=0>e?e+h:e;0<=--h;)b.push(h);return b}),gt:f(function(b,h,e){for(e=0>e?e+h:e;++e<h;)b.push(e);return b})}};ma.pseudos.nth=ma.pseudos.eq;for(p in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})ma.pseudos[p]=t(p);for(p in{submit:!0,
reset:!0})ma.pseudos[p]=r(p);B.prototype=ma.filters=ma.pseudos;ma.setFilters=new B;var bb=d.tokenize=function(b,h){var e,f,v,m,p;if(m=Y[b+" "])return h?0:m.slice(0);m=b;var n=[];for(p=ma.preFilter;m;){if(!g||(e=Fa.exec(m)))e&&(m=m.slice(e[0].length)||m),n.push(f=[]);var g=!1;if(e=xa.exec(m))g=e.shift(),f.push({value:g,type:e[0].replace(Ga," ")}),m=m.slice(g.length);for(v in ma.filter)!(e=va[v].exec(m))||p[v]&&!(e=p[v](e))||(g=e.shift(),f.push({value:g,type:v,matches:e}),m=m.slice(g.length));if(!g)break}return h?
m.length:m?d.error(b):Y(b,n).slice(0)};var gb=d.compile=function(b,h){var e,f=[],v=[],m=ia[b+" "];if(!m){h||(h=bb(b));for(e=h.length;e--;)m=E(h[e]),m[C]?f.push(m):v.push(m);m=ia(b,F(v,f));m.selector=b}return m};var ib=d.select=function(b,h,e,f){var v,m,d,p="function"===typeof b&&b,g=!f&&bb(b=p.selector||b);e=e||[];if(1===g.length){var I=g[0]=g[0].slice(0);if(2<I.length&&"ID"===(m=I[0]).type&&ra.getById&&9===h.nodeType&&M&&ma.relative[I[1].type]){h=(ma.find.ID(m.matches[0].replace(Ja,La),h)||[])[0];
if(!h)return e;p&&(h=h.parentNode);b=b.slice(I.shift().value.length)}for(v=va.needsContext.test(b)?0:I.length;v--;){m=I[v];if(ma.relative[d=m.type])break;if(d=ma.find[d])if(f=d(m.matches[0].replace(Ja,La),Ka.test(I[0].type)&&n(h.parentNode)||h)){I.splice(v,1);b=f.length&&w(I);if(!b)return ba.apply(e,f),e;break}}}(p||gb(b,g))(f,h,!M,e,Ka.test(b)&&n(h.parentNode)||h);return e};ra.sortStable=C.split("").sort(Q).join("")===C;ra.detectDuplicates=!!v;Ya();ra.sortDetached=l(function(b){return b.compareDocumentPosition(I.createElement("div"))&
1});l(function(b){b.innerHTML="<a href='#'></a>";return"#"===b.firstChild.getAttribute("href")})||g("type|href|height|width",function(b,h,e){if(!e)return b.getAttribute(h,"type"===h.toLowerCase()?1:2)});ra.attributes&&l(function(b){b.innerHTML="<input/>";b.firstChild.setAttribute("value","");return""===b.firstChild.getAttribute("value")})||g("value",function(b,h,e){if(!e&&"input"===b.nodeName.toLowerCase())return b.defaultValue});l(function(b){return null==b.getAttribute("disabled")})||g("checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",
function(b,h,e){var f;if(!e)return!0===b[h]?h.toLowerCase():(f=b.getAttributeNode(h))&&f.specified?f.value:null});"function"===typeof define&&define.amd?define(function(){return d}):"undefined"!==typeof module&&module.exports?module.exports=d:b.Sizzle=d;b.stage.selector=d;b.stage.matches=d.matches;b.stage.matchesSelector=d.matchesSelector;b.stage.selectorContains=d.contains;b.stage.VENDORSELECTOR="sizzle";stage.DEBUG&&stage.registerLog.push({name:"sizzle"})})(window);stage.provide("functions");
stage.register("functions",function(){var b=!!Function.prototype.bind,d=function(){var b=function(){return Array.prototype.unshift?function(b,f){Array.prototype.unshift.apply(b,f)}:function(b,f){for(var d=f.length;0<d;d--)Array.prototype.splice.call(b,0,0,f[d-1])}}();return function(){var d=this,f=Array.prototype.shift.call(arguments),n=arguments;return function(){b(arguments,n);return d.apply(f,arguments)}}}(),u=function(b,d,f){d.__proto__&&u(b,d.__proto__,f);for(var n in d)f[n]||"__proto__"!=n&&
("function"==stage.typeOf(d[n])?b[n]=d[n].bind(b):b[n]=d[n])},k=function(b,d,f){d.__proto__&&k(b,d.__proto__,f);for(var n in d)"__proto__"!=n&&"function"==stage.typeOf(d[n])&&"constructor"!=n&&(b[n]=d[n].bind(f))},l=function(){return stage.browser.Ie&&10>stage.browser.version?function(b,d,f,n,g){f.__proto__=stage.extend({},d[d.length-b].prototype);if(1<b)return b!=d.length&&g.push(d[d.length-b].prototype.constructor),l(b-1,d,f.__proto__,n,g);g.push(d[d.length-b].prototype.constructor);b=function(){this.$super=
[];for(var b in g){this.$super[b]=stage.extend({},g[b].prototype);this.$super[b].constructor=g[b].bind(this);for(var f in this.$super[b])"function"==typeof this.$super[b][f]&&"constructor"!=f&&(this.$super[b][f]=this.$super[b][f].bind(this))}d[0].prototype.constructor.apply(this,arguments);b={};for(var n in this)"function"==stage.typeOf(this[n])&&(b[n]=!0);u(this,this,b);delete this.$super};b.prototype=n;return b.prototype.constructor=b}:function(b,d,f,n,g){f.__proto__=stage.extend({},d[d.length-
b].prototype);if(1<b)return b!=d.length&&g.push(d[d.length-b].prototype.constructor),l(b-1,d,f.__proto__,n,g);g.push(d[d.length-b].prototype.constructor);b=function(){this.$super=[];for(var b in g){this.$super[b]=stage.extend({},g[b].prototype);this.$super[b].constructor=g[b].bind(this);for(var f in this.$super[b])"function"==typeof this.$super[b][f]&&"constructor"!=f&&(this.$super[b][f]=this.$super[b][f].bind(this))}d[0].prototype.constructor.apply(this,arguments);delete this.$super};b.prototype=
n;return b.prototype.constructor=b}}(),g=function(){return stage.browser.Ie&&11>stage.browser.version?function(){if(!arguments[0]||!arguments[1])throw Error("STAGE HERITE CLASS NOT DEFINED !!!!");var b=arguments,d=new function(){};d.__proto__=stage.extend({},arguments[0].prototype);d.__proto__.__proto__=d.__proto__.__proto__?stage.extend({},d.__proto__.prototype,arguments[1].prototype):arguments[1].prototype;var f=function(){this.$super={constructor:b[1].prototype.constructor.bind(this)};k(this.$super,
b[1].prototype,this);var f={},d;for(d in this)"function"==stage.typeOf(this[d])&&(f[d]=!0);u(this,this,f);b[0].prototype.constructor.apply(this,arguments);delete this.$super};f.prototype=d;return f.prototype.constructor=f}:function(){if(!arguments[0]||!arguments[1])throw Error("STAGE HERITE MOTHER CLASS NOT DEFINED !!!!");var b=arguments,d=new function(){};d.__proto__=stage.extend({},arguments[0].prototype);d.__proto__.__proto__=arguments[1].prototype;var f=function(){this.$super={constructor:b[1].prototype.constructor.bind(this)};
for(var f in b[1].prototype.constructor.prototype)b[1].prototype[f]&&"function"==typeof b[1].prototype.constructor.prototype[f]&&"constructor"!=f&&(this.$super[f]=b[1].prototype.constructor.prototype[f].bind(this));b[0].prototype.constructor.apply(this,arguments);delete this.$super};f.prototype=d;return f.prototype.constructor=f}}(),q=function(){if(2<arguments.length){var b=new function(){};return l(arguments.length,arguments,b,b,[])}return g.apply(this,arguments)};return{nativeBind:b,_onRegister:function(){b||
(Function.prototype.bind=d);Function.prototype.herite=function(){Array.prototype.splice.call(arguments,0,0,this);return q.apply(this,arguments)}},stage:{isFunction:function(b){return"function"===stage.typeOf(b)},setContext:function(b,g){var f=Array.prototype.shift.call(arguments);return d.apply(f,arguments)},herite:q}}});stage.provide("array");
stage.register("array",function(){var b=Array.prototype,d=function(){return Array.prototype.sort?Array.prototype.sort:Array.prototype.sort=function(b){b||u(this,k);b=u(this,b);l(this);for(var e;e<b.length;e++)this.push(b[e])}}(),u=function(b,e){if(1>=b.length)return b;for(var f=[],d=[],p=Math.floor(b.length/2),m=b[p],h=0;h<b.length;)h!=p&&(0>e(m,b[h])?d.push(b[h]):f.push(b[h])),h++;1<d.length&&(d=u(d,e));1<f.length&&(f=u(f,e));return f.concat([m],d)},k=function(b,e,f){return b.toString()>e.toString()?
1:b.toString()<e.toString()?-1:0},l=function(b){b.length=0;return b},g=function(f,e){return 1==b.splice.call(f,e,1).length},q=function(){return b.indexOf?function(f,e,d){return b.indexOf.call(f,e,d)}:function(b,e,f){for(f=null==f?0:0>f?Math.max(0,b.length+f):f;f<b.length;f++)if(f in b&&b[f]===e)return f;return-1}}(),t=function(){return Array.prototype.reduce?Array.prototype.reduce:Array.prototype.reduceRight=function(b){var e=this.length>>>0;if("function"!=typeof fun)throw new TypeError;if(0==e&&
1==arguments.length)throw new TypeError;--e;if(2<=arguments.length)var f=arguments[1];else{do{if(e in this){f=this[e--];break}if(0>--e)throw new TypeError;}while(1)}for(;0<=e;e--)e in this&&(f=fun.call(null,f,this[e],e,this));return f}}(),r=function(){return Array.prototype.reduce?Array.prototype.reduce:Array.prototype.reduce=function(b){if(void 0===this||null===this)throw new TypeError;var e=Object(this),f=e.length>>>0;if("function"!==typeof fun)throw new TypeError;if(0==f&&1==arguments.length)throw new TypeError;
var d=0;if(2<=arguments.length)var p=arguments[1];else{do{if(d in e){p=e[d++];break}if(++d>=f)throw new TypeError;}while(1)}for(;d<f;)d in e&&(p=fun.call(void 0,p,e[d],d,e)),d++;return p}}(),f=function(b){var e=b[0];return r.call(b,function(b,d){return b instanceof Array?b===e?f(b).concat(d):b.concat(d):d instanceof Array?(d=f(d),d.splice(0,0,b),d):[b,d]})},n=function(){return Array.prototype.map?Array.prototype.map:Array.prototype.map=function(b,e){var f=this.length>>>0;if("function"!=typeof b)throw new TypeError;
for(var d=Array(f),p=0;p<f;p++)p in this&&(d[p]=b.call(e,this[p],p,this));return d}}(),B=function(){return Array.prototype.filter?Array.prototype.filter:Array.prototype.filter=function(b,e){var f=this.length>>>0;if("function"!=typeof b)throw new TypeError;for(var d=[],p=0;p<f;p++)if(p in this){var m=this[p];b.call(e,m,p,this)&&d.push(m)}return d}}(),w=function(){return Array.prototype.forEach?Array.prototype.forEach:Array.prototype.forEach=function(b,e){var f=this.length>>>0;if("function"!=typeof b)throw new TypeError;
for(var d=0;d<f;d++)d in this&&b.call(e,this[d],d,this)}}(),D=function(){return Array.prototype.every?Array.prototype.some:Array.prototype.some=function(b,e){var f=0,d=this.length>>>0;if("function"!=typeof b)throw new TypeError;for(;f<d;f++)if(f in this&&b.call(e,this[f],f,this))return!0;return!1}}(),A=function(){return Array.prototype.every?Array.prototype.every:Array.prototype.every=function(b,e){var f=this.length>>>0;if("function"!=typeof b)throw new TypeError;for(var d=0;d<f;d++)if(d in this&&
!b.call(e,this[d],d,this))return!1;return!0}}();return{stage:{isArray:function(b){return"array"===stage.typeOf(b)}},clone:function(b){return Array.prototype.slice.call(b,0)},clear:l,remove:function(b,e){if(2>arguments.length)return l(b);if(0!==e||""!==e||e)return g(b,q(b,e))},removeAll:function(b,e){if(2>arguments.length)return l(b);if(0!==e||""!==e||e){for(var f;-1!=q(b,e);)f=g(b,q(b,e));return f}},removeIndexOf:g,indexOf:q,compact:function(b){for(var e=0;e<b.length;e++)if(null===b[e]||void 0===
b[e])g(b,e),e--;return b},contain:function(b,e){return-1===q(b,e)?!1:!0},reduce:r,reduceRight:t,uniq:function(b){for(var e=b.length;0<e;e--)for(var f=0;f<e;f++)if(b[f]===b[e]){g(b,e);break}return b},flatten:f,map:n,filter:B,forEach:w,every:A,some:D,sort:d}});stage.provide("string");
stage.register("string",function(b,d){var u=/<\s*script.*?>([\s\S]*?)<\s*\/script\s*>/gmi,k=/-+(.)?/g,l=function(b){b||(b=this);for(var d=[],g;g=u.exec(b);)d.push(g[1]);return d};b=function(){var b=document.getElementsByTagName("head")[0]||document.documentElement;return stage.browser.Ie?function(d){d=l(d);for(var g=0;g<d.length;g++)script=document.createElement("script"),script.type="text/javascript",script.text=d[g],b.insertBefore(script,b.firstChild),b.removeChild(script)}:function(d){d=l(d);for(var g=
0;g<d.length;g++)script=document.createElement("script"),script.type="text/javascript",script.appendChild(document.createTextNode(d[g])),b.insertBefore(script,b.firstChild),b.removeChild(script)}}();d=function(){var b=/^\s+/,d=/\s+$/;return String.prototype.trim?function(b){return null==b?"":String.prototype.trim.call(b)}:function(g){return null==g?"":g.toString().replace(b,"").replace(d,"")}}();return{stage:{isString:function(b){return"string"===typeof b}},inc:function(b){return String.fromCharCode(b.charCodeAt()+
1)},evalScript:b,removeScript:function(b){return b.replace(u,"")},trim:d,camelize:function(b){return b.replace(k,function(b,d){return d?d.toUpperCase():""})}}});stage.provide("json");stage.require("string");
stage.register("json",function(b,d){var u=!!window.JSON,k=function(b){return('"'+b.replace(/(["\\])/g,"\\$1")+'"').replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r")};b=function(){return u?function(b,d){if(g(b))return b=stage.string.trim(b),d?window.JSON.parse(b,d):window.JSON.parse(b);throw Error("Invalid JSON: "+b);}:function(b){if(g(b))return b=stage.string.trim(b),(new Function("return "+b))();throw Error("Invalid JSON: "+b);}}();
var l=function(b){if(void 0!==b){if(null===b)return null;switch(stage.typeOf(b)){case "string":return k(b);case "number":case "boolean":return b+"";case "function":return null;case "element":throw Error("Can't serialize DOM nodes");case "array":for(var d=[],g=0;g<b.length;g++){var f=l(b[g]);"string"!=typeof f&&(f=void 0);d.push(f)}return"["+d.join(",")+"]"}d=[];for(g in b){switch(stage.typeOf(g)){case "string":var n=k(g);break;case "number":n='"'+g+'"';break;default:continue}f=l(b[g]);"string"==typeof f&&
d.push(n+":"+f)}return"{"+d.join(",")+"}"}};d=function(){return u?function(b,d,g){return window.JSON.stringify(b,d||null,g||null)}:function(b){return l(b)}}();var g=function(b){return"string"===typeof b&&b?/^[\],:{}\s]*$/.test(b.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))?!0:!1:!1};return{nativeJson:u,parse:b,stringify:d,isJson:g}});stage.provide("io");stage.provide("inSocket");
stage.provide("outSocket");stage.provide("ioSocket");stage.provide("io.tansport");stage.provide("io.tansport.outSocket");stage.provide("io.tansport.inSocket");stage.provide("io.tansport.ioSocket");stage.provide("io.session");stage.provide("io.protocols");stage.provide("io.authentication");stage.provide("io.url");stage.require("json");
stage.register("io",function(b,d){b=function(){return function(b,d,g,q){return"GET"==d?g?q?b+"?"+q:b:q?b+"?"+("_="+stage.getTimeStamp())+"&"+q:b+"?"+("_="+stage.getTimeStamp()):/Konqueror|Safari|KHTML/.test(navigator.userAgent)?g?b+"?&_=":b+"?&"+("_="+stage.getTimeStamp()):g?b:b+"?"+("_="+stage.getTimeStamp())}}();d=function(){var b=function(g,k,t){var r="",f;for(f in g)switch(stage.typeOf(g[f])){case "object":r+=b.call(this,g[f],k,stage.io.url.querySeperator);break;case "array":for(var n=f,q=k,l=
g[f],u="",A=0;A<l.length;A++)switch(stage.typeOf(l[A])){case "object":case "array":case "function":throw Error(" Sanitize data arrayToQuery : Not good format for send Data");default:u+=stage.io.url.querySeperator+d.call(this,q,n+"[]",l[A])}r+=u;break;case "function":r+=g[f]();break;default:0==t?(r+=d.call(this,k,f,g[f]),t=stage.io.url.querySeperator):r+=t+d.call(this,k,f,g[f])}return r},d=function(b,d,k){return"GET"==b?encodeURIComponent(d)+"="+encodeURIComponent(k):d+"="+k};return function(g,k,t){if(!g)return null;
var r=stage.typeOf(g),f=null;switch(k){case "text":case "domString":switch(r){case "string":f=g;break;default:throw Error(" FormatData from domString : Not good format for send Data");}break;case "formData":case "queryString":switch(r){case "array":case "object":f=b.call(this,g,t,!1);break;case "string":k="";r=!1;g=g.split(stage.io.url.querySeperator);for(f=0;f<g.length;f++){var n=g[f].split("=");!1===r?(k+=d.call(this,t,n[0],n[1]),r=stage.io.url.querySeperator):k+=stage.io.url.querySeperator+d.call(this,
t,n[0],n[1])}f=k;break;default:throw Error(" FormatData  from formData : Not good format for send Data");}break;case "xml":case "document":switch(r){case "string":f=g;break;case "document":break;default:throw Error(" FormatData from document : Not good format for send Data");}break;case "json":switch(r){case "object":case "array":f=stage.json.stringify(g);break;case "string":f=g;break;default:throw Error(" FormatData from JSON : Not good format for send Data");}"GET"==t&&(f=encodeURIComponent(f));
break;case "blob":f=g;break;default:throw Error(" FormatData dataType : Not good dataType for send Data");}if(f)return f;throw Error("Invalid sanitize data : Not good format for send Data");}}();var u=function(b,d,g,q){this.eventsManager=stage.createEventsManager();this.settings=stage.extend(!0,{},g,q);this.name=b||"transport";if(d)this.url=d,this.crossDomain=!stage.io.url.isSameOrigin(d);else return this.error=Error("Transport URL not defined"),this;this.error=null;this.streamDirection="IO"};u.prototype.listen=
function(b,d,g){return this.eventsManager.listen(b,d,g)};return{transport:{transportCore:u,outSocket:{},inSocket:{},ioSocket:{}},session:{},protocols:{},authentication:{},mechanisms:{},formatData:d,formatTransportResponse:function(b,d){try{if(3===b.transport.readyState)return"arraybuffer"!==b.transport.responseType&&"blob"!==b.transport.responseType&&(b.response=b.transport.responseText),!0;if(b.getHeader("content-type"))var g=b.getHeader("content-type").split(";")[0];switch(g){case "text/xml":case "application/xml":case "application/atom+xml":b.responseType=
"xml";if(b.transport.responseXML)b.response=b.transport.responseXML;else if(b.transport.responseText)try{b.response=(new DOMParser).parseFromString(b.transport.responseText,"text/xml")}catch(q){b.response=void 0}else b.response=void 0;b.response&&b.response.getElementsByTagName("parsererror").length&&b.eventsManager.fireEvent("onException","parsererror XML"+b.response);break;case "application/json":b.responseType="json";b.response=stage.json.parse(b.transport.responseText);if(!b.response)return!1;
break;case "text/plain":b.responseType="text";b.response=b.transport.responseText;break;case "text/html":b.responseType="html";b.response=b.transport.responseText;break;case "application/x-javascript":case "application/javascript":case "text/javascript":b.responseType="javascript";b.response=b.transport.responseText;stage.string.evalScript(b.response);break;case /audio\/.*/.test(g)?g:null:b.responseType="arraybuffer";b.response=b.transport.response;break;case /video\/.*/.test(g)?g:null:b.responseType=
"arraybuffer";b.response=b.transport.response;break;default:b.responseType=g;try{b.response=0<=g.indexOf("xml")?b.transport.responseXML:b.transport.responseText}catch(q){b.response=b.transport.response}}}catch(q){b.response=null,b.error=q,b.eventsManager.fireEvent("onError",b,d,q)}return!0},url:{isSameOrigin:function(b){return/^(?!http:).*/.test(b)?!0:/^\s*https?:\/\/[^\/]*/.exec(b)[0]==location.protocol+"//"+document.domain+location.port?":"+location.port:""},formatUrl:b,querySeperator:"&",urlToOject:function(b){var d=
{},g=document.createElement("a");g.href=b;b="protocol hostname host pathname port search hash href".split(" ");for(keyIndex in b){var k=b[keyIndex];d[k]=g[k]}d.toString=function(){return g.href};d.requestUri=d.pathname+d.search;return d}},stageDebugMessages:{NO_ERROR:"Done",ACCESS_DENIED:"Access denied to content document",FILE_NOT_FOUND:"File not found",HTTP_ERROR:"Http response at 400 or 500 level",ABORT:"Request was aborted",TIMEOUT:"Request timed out",OFFLINE:"The resource is not available offline"}}});
stage.provide("structs");stage.register("structs",function(){return{}});stage.provide("structs.hash");stage.require("structs");
stage.register.call(stage.structs,"hash",function(){var b=function(b){this.data="object"===stage.typeOf(b)?stage.extend(!0,{},b):{}};b.prototype.get=function(b){return null===b||void 0===b?this.data:b in this.data?this.data[b]:!1};b.prototype.set=function(b,u){return null!==b||void 0!==b?this.data[b]=u:!1};b.prototype.unset=function(b){return b in this.data?(delete this.data[b],!0):!1};b.prototype.hasKey=function(b){return b in this.data?!0:!1};b.prototype.clear=function(){this.data={};return!0};
b.prototype.clone=function(){return stage.extend(!0,{},this.data)};b.prototype.inspect=function(){};b.prototype.keys=function(){};b.prototype.values=function(){};b.prototype.each=function(){return stage.browser.Ie?function(b){var d=0,k;for(k in this.data){if(this.data.hasOwnProperty(k)){var l=this.data[k],g=[k,l];g.key=k;g.value=l;b(g,d)}d++}}:function(b){var d=0,k;for(k in this.data){var l=this.data[k],g=[k,l];g.key=k;g.value=l;b(g,d);d++}}}();b.prototype.clone=function(){return new b(this.data)};
b.prototype.toObject=function(b){return stage.extend(!0,{},this.data)};b.prototype.merge=function(b){this.data=stage.extend(!0,{},this.data,b)};b.prototype.toJson=function(b){return b?stage.json.stringify(this.get(b)):stage.json.stringify(this.data)};b.prototype.toQueryString=function(){};return{struct:b,local:{createHash:function(d){return new b(d)}}}});stage.provide("events");stage.require("string");stage.require("array");stage.require("structs.hash");stage.require("dom");
stage.register("events",function(){var b=[0,"Invalid HTML string in argument"],d={},u=0,k=0,l=stage.structs.createHash(),g=function(b){if(b.stageEvent)return b.stageEvent;b.stageEvent=++u;return b.stageEvent},q=function(b,h){b=g(b);return d[b]?h?d[b][h]?d[b][h]:null:d[b]:null},t=function(b,h,e,f){var v=g(b),m=++k;d[v]||(d[v]={element:b});d[v][h]||(d[v][h]={});d[v][h][m]={handler:e,capture:f}},r=function(){return document.addEventListener?function(b,h,e){t(this,b,h,e||!1);this.addEventListener(b,h,
e||!1);return h}:function(b,h,e){t(this,b,h,e||!1);this.attachEvent("on"+b,h);return h}}(),f=function(b,h){if(b.stageEvent){var e=g(b);if(e&&d[e]){var f=d[e][h];if(f){var v=d[e].element;Array.prototype.shift.call(arguments);Object.keys(f).forEach(function(b){f[b].handler.apply(v,arguments)})}}}},n=function(){return document.removeEventListener?function(b,h,e,f){b.removeEventListener(h,e,f)}:function(b,h,e,f){b.detachEvent("on"+h,e)}}(),B=function(b,h){if(d[h])for(var e in d[h])Object.keys(d[h]).forEach(function(e){"element"!=
e&&Object.keys(d[h][e]).forEach(function(f){n(b,e,d[h][e][f].handler,d[h][e][f].capture)})})},w=function(b,h,e,f){switch(arguments.length){case 0:Object.keys(d).forEach(function(b){w(d[b].element)});break;case 1:var v=b.stageEvent;if(!d[v])break;B(b,v);delete d[v];break;case 2:v=b.stageEvent;if(!d[v])break;for(var m in d[v][h])w(b,h,d[v][h][m].handler,d[v][h][m].capture);delete d[v][h];break;case 3:v=b.stageEvent;if(!d[v])break;n(b,h,e,!1);for(m in d[v][h])d[v][h][m].handler===e&&delete d[v][h][m];
break;case 4:if(v=b.stageEvent,d[v])for(m in n(b,h,e,f),d[v][h])d[v][h][m].capture==f&&d[v][h][m].handler===e&&delete d[v][h][m]}},D=function(b,h){if(!b&&!h)return this===stage?w():w(this),this;this.stageEvent&&(b&&h?w(this,b,h):b&&!h&&w(this,b));return this},A=function(b,h){h||(h=b);if(b.hasChildNodes())for(var e=b.childNodes.length-1;0<=e;e--){var f=b.childNodes[e];1===f.nodeType&&(f.stageEvent&&D.call(f),A(f,h),l.hasKey(f.stageEvent)&&l.unset(f.stageEvent))}if(b===h)for(e=b.childNodes.length-1;0<=
e;e--)f=b.childNodes[e],b.removeChild(f),delete f;return b},H=function(b){this.event=b?b:null};H.prototype.getTarget=function(b){var h=b?b:this.event||null;b=h.target||h.srcElement;var e=h.currentTarget;h=this.getEventType(h);e&&e.tagName&&("load"===h||"error"===h||"click"===h&&"input"===e.tagName.toLowerCase()&&"radio"===e.type)&&(b=e);b.nodeType==b.TEXT_NODE&&(b=b.parentNode);return b};H.prototype.getTargetType=function(b){return this.getTarget(b).tagName.toUpperCase()};H.prototype.stopPropagation=
function(b){b=b?b:this.event||null;if(!b)return!1;b.stopPropagation?b.stopPropagation():b.cancelBubble=!0;return!0};H.prototype.preventDefault=function(b){b=b?b:this.event||null;if(!b)return!1;b.preventDefault?b.preventDefault():b.returnValue=!1;return!0};H.prototype.eventStop=function(b){b=b?b:this.event||null;if(!b)return!1;this.preventDefault(b);this.stopPropagation(b);return!0};H.prototype.getEventType=function(b){return(b=b?b:this.event||null)?b.type:null};var e=function(){if(stage.browser.Ie){var b=
{0:1,1:4,2:2};return function(h,e){return h.buttons||h.button===b[e]}}return stage.browser.WebKit?function(b,h){switch(h){case 0:return 1==b.which&&!b.metaKey;case 1:return 1==b.which&&b.metaKey;default:return!1}}:function(b,h){return b.which?b.which===h+1:b.button===h}}(),E=stage.herite(function(b){this.$super.constructor(b)},H);E.prototype.isLeftClick=function(b){return(b=b?b:this.event||null)?e(b,0):null};E.prototype.isMiddleClick=function(b){return(b=b?b:this.event||null)?e(b,1):null};E.prototype.isRightClick=
function(b){return(b=b?b:this.event||null)?e(b,2):null};E.prototype.pointerX=function(b){b=b?b:this.event||null;var h=document.documentElement,e=stage.body||{scrollLeft:0};return b?b.pageX||b.clientX+(h.scrollLeft||e.scrollLeft)-(h.clientLeft||0):null};E.prototype.pointerY=function(b){b=b?b:this.event||null;var h=document.documentElement,e=stage.body||{scrollTop:0};return b?b.pageY||b.clientY+(h.scrollTop||e.scrollTop)-(h.clientTop||0):null};E.prototype.pointer=function(b){return(b=b?b:this.event||
null)?[this.pointerX(b),this.pointerY(b)]:null};E.prototype.relatedTarget=function(b){if(b=b?b:this.event||null){var h=this.getEventType();if("mouseover"===h)return b.relatedTarget||b.fromElement;if("mouseout"===h)return b.relatedTarget||b.toElement}return null};var F={a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,
f9:120,f10:121,f11:122,f12:123,shift:16,ctrl:17,control:17,alt:18,option:18,opt:18,cmd:224,command:224,fn:255,"function":255,backspace:8,osxdelete:8,enter:13,"return":13,space:32,spacebar:32,esc:27,escape:27,tab:9,capslock:20,capslk:20,"super":91,windows:91,insert:45,"delete":46,home:36,end:35,pgup:33,pageup:33,pgdn:34,pagedown:34,left:37,up:38,right:39,down:40,"`":96,"~":96,"-":45,_:45,"=":187,"+":187,"[":219,"{":219,"]":221,"}":221,"\\":220,"|":220,";":59,":":59,"'":222,'"':222,",":188,"<":188,
".":190,">":190,"/":191,"?":191},p={65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",16:"shift",17:"control",18:"opt",224:"command",255:"function",8:"osxdelete",13:"return",32:"spacebar",
27:"escape",9:"tab",20:"capslk",91:"windows",45:"_",46:"delete",36:"home",35:"end",33:"pageup",34:"pagedown",37:"left",38:"up",39:"right",40:"down",96:"~",187:"+",219:"{",221:"}",220:"|",59:":",222:'"',188:"<",190:">",191:"?"},m=stage.herite(function(b){this.$super.constructor(b)},H);m.prototype.getKey=function(b){return(b=b?b:this.event||null)?b.keyCode?b.keyCode:b.charCode:null};m.prototype.getMetaKey=function(b){return(b=b?b:this.event||null)&&!b.metaKey&&b.ctrlKey?b.ctrlKey:null};m.prototype.matchKey=
function(b,h){return this.getKey(h?h:this.event||null)===b?!0:!1};var h=/<\/?(table|tr|td)[^>]*>/mgi,v=/\//mgi,I=/\/|<|>/mgi,J=/table|tr|td/mgi,M={tr:["table","thead","tfoot","tbody"],col:["table"],colgroup:["table"],td:["tr"],th:["tr"],caption:["table"],dt:["dl"],dd:["dt"],li:["ul","ol"],optgroup:["select"],option:["select","optgroup"],thead:["table"],tfoot:["table"],tbody:["table"]},T=function(b){if(b)return A(b),D.call(b),l.hasKey(b.stageEvent)&&l.unset(b.stageEvent),b.parentNode.removeChild(b)},
U=function(e,f){if(e){if(!f)return e;switch(stage.typeOf(f)){case "string":A(e);var d=new String(stage.string.removeScript(f));try{var m=d.match(h);if(m){m.reverse();for(var p=[],n=null;0<m.length&&!n;){var g=m.pop();if("/"!==g[1]){var r=g.match(J);if(M[r])if(0===p.length)n=g;else{for(var t=0,k=!1;t<M[r].length&&!k;)M[r][t]===p[p.length-1].replace(I,"")&&(k=!0),t++;k?p.push("<"+r[0]+">"):n="<"+r[0]+">"}else p.push("<"+r[0]+">")}else p.pop()!==g.replace(v,"")&&(n=g)}var q=null===n?!0:n}else q=!0;if(!0===
q)e.innerHTML=d,stage.string.evalScript(f);else{var l=new stage.stageError("UPDATE",b[0],b[1],Error(b[1]+d));window.console&&console.log&&console.log(l)}}catch(oa){e.appendChild(document.createTextNode(d)),stage.string.evalScript(f)}break;case "element":A(e),e.appendChild(f)}return e}},R=function(b,h){var e=function(b,h){if(b.stageEvent){b=b.stageEvent;for(var e in d[b])if("element"!=e)for(var f in d[b][e])r.call(h,e,d[b][e][f].handler,d[b][e][f].capture)}},f=function(b,h){l.hasKey(b.stageEvent)&&
l.set(g(h),l.get(b.stageEvent).clone())};if(stage.browser.Ie&&9>stage.browser.version){var v=function(b,h,f){e(b,h);if(f)for(b=b.querySelectorAll("*"),h=h.querySelectorAll("*"),f=0;f<b.length;f++)m(b[f],h[f]),e(b[f],h[f])},m=function(b,h){h.clearAttributes();h.mergeAttributes(b);h.stageEvent=null;var e=b.nodeName.toLowerCase();"input"!==e||"checkbox"!==b.type&&"radio"!==b.type?"option"===e&&(h.selected=b.selected):b.checked!=h.checked&&(h.checked=b.checked)};return function(b,h,e){if(b){var d=b.cloneNode(h);
e&&(m(b,d),v(b,d,h),f(b,d));return d}}}v=function(b,h,f){e(b,h);if(f)for(b=b.querySelectorAll("*"),h=h.querySelectorAll("*"),f=0;f<b.length;f++)e(b[f],h[f])};return function(b,h,e){if(b){var d=b.cloneNode(h);d.stageEvent=null;e&&(v(b,d,h),f(b,d));return d}}}();return{hashElement:l,_unLoad:function(){D(stage)},eventsGarbageCollector:d,getStageId:g,getStageEvents:q,trigger:f,stage:{listen:function(b,h,e,f){return r.call(b,h,e,f)},unListen:function(b,h,e){return D.call(b,h,e)},remove:T,update:U,clone:R,
empty:A,mouseEvents:E,keyboardEvents:m},$$stage:{listen:function(b,h,e){r.call(this,b,h,e)},unListen:function(b,h){D.call(this,b,h)},trigger:function(){Array.prototype.unshift.call(arguments,this);f.apply(this,arguments)},remove:function(){T(this)},purgeListeners:function(){var b=g(this);B(this,b)},update:function(b){U(this,b)},empty:function(){A(this)},clone:function(b,h){return R(this,b,h)},wrap:function(b){switch(stage.typeOf(b)){case "string":var h=stage.dom.html(b);break;case "element":h=R(b,
!0,!0)}var e=stage.dom.parent(this);b=stage.dom.detach(this);h=stage.dom.insert(e,h);stage.dom.attach(b,h)},wrapInner:function(b){switch(stage.typeOf(b)){case "string":var h=stage.dom.html(b);break;case "element":h=R(b,!0,!0)}b=stage.dom.contents(this);for(var e=0;e<b.length;e++)h.appendChild(stage.dom.detach(b[e]));this.appendChild(h)},getStageId:function(){return g(this)},getStageEvents:function(b){return q(this,b)},keypress:function(){var b={A:!0,LINK:!0,BUTTON:!0,INPUT:!0,SELECT:!0,TEXTAREA:!0,
COMMAND:!0},h=new m,e=function(b,e){if("string"!==typeof b)return!1;if(""===b)return!0;b=b.replace(/\s+/g,"").match(/([a-zA-Z0-9+]*)[^,]/gmi);if(!b)return!1;for(var f=0;f<b.length;f++)if(b.hasOwnProperty(f))if(-1<b[f].toString().indexOf("+")){var v=[],d=b[f].split("+"),m;for(m in d)if(d[m]in F)v[m]=F[d[m]];else throw Error("MATCH KEY "+d[m]+" : key not exist");b[f]=v}else if(b[f]in F)b[f]=F[b[f]];else throw Error("MATCH KEY "+d[m]+" : key not exist");d=h.getKey(e);e=h.getMetaKey(e);for(var n in b)if("number"!==
typeof b[n]){if(e&&stage.array.contain(b[n],d))return p[b[n][0]]+"+"+p[d]}else if(!e&&stage.array.contain(b,d))return p[d]},f=function(){var b=function(b,f,v,d){h.stopPropagation(d);(b=e(b,d))&&"function"===typeof f&&f.call(h,b,d);v&&v.preventDefault&&h.preventDefault(d)},f=function(b){h.eventStop(b)};return{listenKeyboard:function(h,e,v,d){r.call(h,"keydown",b.bind(h,e,v,d));r.call(h,"keyup",f)},unlistenKeyboard:function(b){D.call(b,"keydown");D.call(b,"keyup",f)}}}();return function(h,e,v){if(h||
"string"===typeof h)this===document||this===window||stage.dom.nodeName(this)in b?f.listenKeyboard(this,h,e,v||{}):(stage.dom.setAttribute(this,"tabindex",-1),r.call(this,"focus",function(){f.listenKeyboard(this,h,e,v||{})}.bind(this)),r.call(this,"blur",function(){f.unlistenKeyboard(this)}.bind(this)))}}()}}});stage.provide("dom");stage.require("events");
stage.register("dom",function(){var b=function(b,h){if(/<html/i.test(b)||/<head/i.test(b)||/<body/i.test(b)||/<link/i.test(b)||/<script/i.test(b))return null;h=h||stage.document;h=h.createElement("div");stage.update(h,b);b=F(h);if(1<b.length){for(h=0;h<b.length;h++)b[h]=H(b[h]);return b}return 1===b.length?H(b[0]):null},d=function(b,h,e){if(e)switch(e){case "top":return b.insertBefore(h,b.firstChild);case "before":return b.parentNode.insertBefore(h,b);case "after":return b.parentNode.insertBefore(h,
b.nextSibling);default:return b.appendChild(h)}else return b.appendChild(h)},u=function(b,h,e,f){for(var v=null,m=null,p,n=null,g=null,r=0;r<h.length;r++){v=h[r];if(!v)break;m=v.nameSpace?document.createElementNS(v.nameSpace,v.tagName):document.createElement(v.tagName);p=v.position||null;if(v.attributes)for(n in v.attributes)if(v.attributes.hasOwnProperty(n))switch(n){case "suffix":I(m,"id",v.attributes.suffix+e);break;case "prefix":I(m,"id",e+v.attributes.prefix);break;case "klass":I(m,"class",v.attributes.klass);
break;case "value":m.value=v.attributes.value;break;case "inner":m.innerHTML=v.attributes.inner;break;case "display":"none"==v.attributes.display&&(m.style.display="none");break;case "selected":m.selected=!0;break;case "style":"object"===typeof v.attributes.style?stage.css.setStyle(m,v.attributes.style):I(m,n,v.attributes[n]);break;default:I(m,n,v.attributes[n])}b?d(b,m,p):g=b=m;v.returnActive&&(g=m);if(v.events)for(p=0;p<v.events.length;p++)stage.listen(m,v.events[p].onEvent,v.events[p].callback);
v.draggable&&stage.ui&&stage.ui.draggable&&stage.ui.draggable(m,v.draggable);v.droppable&&stage.ui&&stage.ui.droppable&&stage.ui.droppable(m,v.droppable);v.resizable&&stage.ui&&stage.ui.resizable&&stage.ui.resizable(m,v.resizable);v.childs&&v.childs.length&&(p=u(m,v.childs,e,f?f++:1),null!=p&&(g=p))}return f||v.returnActive||null!==g?v&&v.returnActive?m:g:b},k=function(b,h,e){return u(b,h,e)},l=function(b){b.style.display="block"},g=function(b){b.style.display="none"},q=function(b){return""==b.style.display?
"none"!=stage.css.getComputedStyle(b).display:"none"!=b.style.display},t=function(b){return q(b)?g(b):l(b)},r=function(b){return b.parentNode&&11!==b.parentNode.nodeType?b.parentNode:null},f=function(b,h){var e=[];for(b=b[h];b&&9!==b.nodeType;)1===b.nodeType&&e.push(b),b=b[h];return e},n=function(b){var h=[];b=b.parentNode;if(!b)return h;for(;9!==b.nodeType;)1===b.nodeType&&h.push(b),b=b.parentNode;return h},B=function(b){b=b.nextSibling;for(var h=0;2>h&&b&&1!==b.nodeType;h++)b=b.nextSibling;return b},
w=function(b){return f(b,"nextSibling")},D=function(b){b=b.previousElementSibling||b.previousSibling;for(var h=0;2>h&&b&&1!==b.nodeType;h++)b=b.previousElementSibling||b.previousSibling;return b},A=function(b){return f(b,"previousSibling")},H=function(b){if(!b)return!0;b.parentNode&&b.parentNode.removeChild(b);return b},e=function(b,h){return h?b.nodeName&&b.nodeName.toUpperCase()===h.toUpperCase():b.nodeName},E=function(b){for(var h=[],e=b.parentNode.firstChild;e.nextSibling;)1===e.nextSibling.nodeType&&
e.nextSibling!==b&&h.push(e.nextSibling),e=e.nextSibling;return h},F=function(b){var h=[],e=b.firstChild;if(e)1===e.nodeType&&h.push(e);else return h;for(;e.nextSibling;)1===e.nextSibling.nodeType&&b!==e&&h.push(e.nextSibling),e=e.nextSibling;return h},p=function(b){return stage.browser.Ie&&9>stage.browser.version?function(b){return"iframe"===e(b)?Array.prototype.slice.apply(stage.listToArray(b.contentDocument||b.contentWindow.document)):Array.prototype.slice.apply(stage.listToArray(b.childNodes))}:
function(b){return"iframe"===e(b)?Array.prototype.slice.apply(b.contentDocument||b.contentWindow.document):Array.prototype.slice.apply(b.childNodes)}}(),m=function(b){for(var h="",e="element"===stage.typeOf(b)?[b]:b,f=0;e[f];f++)b=e[f],3===b.nodeType||4===b.nodeType?h+=b.nodeValue:8!==b.nodeType&&(h+=m(b.childNodes));return h},h=function(b,h){if(!b)return null;if("object"!==typeof h&&void 0!==h)return stage.empty(b),d(b,(b.ownerDocument||document).createTextNode(h))},v=function(b,h){return b.getAttribute(h)||
!1},I=function(){return stage.browser.Ie?function(b,h,e){return"style"===h?b.style.cssText=e:b.setAttribute(h,e)}:function(b,h,e){return b.setAttribute(h,e)}}(),J=function(b,h){return v(b,h)?!0:!1},M=function(){var b=document.createElement("select"),h=b.appendChild(document.createElement("option"));b.disabled=!0;var f=!h.disabled,v={option:{get:function(b){var h=b.attributes.value;return!h||h.specified?b.value:b.text}},select:{get:function(b){var h=b.selectedIndex;var v=[],d=b.options,m="select-one"===
b.type;if(0>h)return null;b=m?h:0;for(h=m?h+1:d.length;b<h;b++){var p=d[b];if(!(!p.selected||(f?p.disabled:null!==p.getAttribute("disabled"))||p.parentNode.disabled&&e(p.parentNode,"optgroup"))){p=M(p);if(m)return p;v.push(p)}}return m&&!v.length&&d.length?M(d):v},set:function(b,h){$$stage(b).find("option").each(function(e){stage.isArray(h)?(e.selected=0<=stage.array.contain(h,M(e),h),h.length||(b.selectedIndex=-1)):e.selected=M(e)==h});return h}}},d=/\r/g;return function(b,h){if(b){var f=v[e(b).toLowerCase()]||
v[b.type];if(!h){if(f&&f.get)return f.get(b);b=b.value;return"string"===typeof b?b.replace(d,""):null===b?"":b}1===b.nodeType&&(null==h?h="":"number"===typeof h?h+="":stage.isArray(h)&&stage.array.map.call(h,function(b){return null==b?"":b+""}),f&&"set"in f&&void 0!==f.set(b,h,"value")||(b.value=h))}}}();return{show:l,hide:g,visible:q,toggle:t,insert:d,detach:H,attach:function(b,h,e){return d(h,b,e)},nodeName:e,parent:r,parents:n,next:B,nextAll:w,prev:D,prevAll:A,siblings:E,children:F,contents:p,
getText:m,setText:h,getAttribute:v,setAttribute:I,hasAttribute:J,html:b,val:M,build:k,stage:{isElement:function(b){return"element"===stage.typeOf(b)},build:k},$$stage:{build:function(b,h){return u(this,b,h)},show:function(){return l(this)},hide:function(){return g(this)},visible:function(){return q(this)},toggle:function(){return t(this)},insert:function(h,e){switch(stage.typeOf(h)){case "selectorXml":case "selector":for(var f=0;f<h.length;f++)d(this,h.selector[f],e);return;case "string":b(h,this);
return}d(this,h,e)},detach:function(){return H(this)},attach:function(b,h){return d(b,this,h)},attribute:function(b,h){return b?void 0===h?v(this,b):I(this,b,h):v(this)},hasAttribute:function(b){return J(this,b)},text:function(b){return b?h(this,b):m(this)},html:function(h){return b(this,h)},nodeName:function(b){return e(this,b)},val:function(b){return M(this,b)},parent:function(){return r(this)},parents:function(){return n(this)},next:function(){return B(this)},prev:function(){return D(this)},prevAll:function(){return A(this)},
nextAll:function(){return w(this)},siblings:function(){return E(this)},children:function(){return F(this)},contents:function(){return p(this)}}}});stage.provide("storage");stage.provide("cookies");stage.require("json");stage.require("structs.hash");
stage.register("storage",function(){var b=function(){try{var b={session:!!window.sessionStorage,local:!!window.localStorage}}catch(w){b={session:!1,local:!1}}return b}(),d=function(){var b=document.createElement("div");return"function"===stage.typeOf(b.dataset)?!0:!1}(),u=function(b,f,d){if(d){var n=new Date;n.setTime(n.getTime()+864E5*d);d="; expires="+n.toGMTString()}else d="";document.cookie=b+"="+f+d+"; path=/"},k=function(b){b+="=";for(var f=document.cookie.split(";"),d=0;d<f.length;d++){for(var n=
f[d];" "==n.charAt(0);)n=n.substring(1,n.length);if(0==n.indexOf(b))return n.substring(b.length,n.length)}return null},l=function(b){u(b,"",-1)},g=function(b){this.data="local"===b?window.localStorage:window.sessionStorage};g.prototype.get=function(b){b=this.data.getItem(b);return""===b||null===b||void 0===b?null:b&&"object"===typeof b?stage.json.parse(b.value):stage.json.parse(b)};g.prototype.set=function(b,f){return this.data.setItem(b,stage.json.stringify(f))};g.prototype.unset=function(b){return this.data.removeItem(b)};
g.prototype.clear=function(){return this.data.clear()};g.prototype.each=function(){};var q=function(b){this.data=document.cookie;this.days=b;this.backup={}};q.prototype.get=function(b){return k(b)?stage.json.parse(k(b)):null};q.prototype.set=function(b,f){this.backup[b]=f;return u(b,stage.json.stringify(f),this.days)};q.prototype.unset=function(b){delete this.backup[b];return l(b)};q.prototype.clear=function(){for(var b in this.backup)this.unset(b)};q.prototype.each=function(b,f){for(var d in this.backup)b.call(f||
this,this.backup[d])};var t=function(b){var f=(this.id=b.stageEvent)?stage.events.hashElement.get(this.id):null;f||(this.id=stage.events.getStageId(b),f=stage.events.hashElement.set(this.id,new stage.structs.hash.struct));this.data=f};t.prototype.get=function(b){return this.data.get(b)};t.prototype.set=function(b,f){return this.data.set(b,f)};t.prototype.unset=function(b){return this.data.unset(b)};t.prototype.clear=function(b){return this.data.clear()};t.prototype.each=function(){};var r=function(f){if(f)switch(this.settings=
f,this.type=this.settings.type,this.type){case "hash":this.data=new stage.structs.hash.struct;break;case "session":b.session?this.data=new g(this.type):(this.nbDaysExpire=this.settings.nbDaysExpire||1,this.data=new q(this.nbDaysExpire));break;case "local":b.local?this.data=new g(this.type):(this.nbDaysExpire=this.settings.nbDaysExpire||1,this.data=new q(this.nbDaysExpire));break;case "cookies":this.nbDaysExpire=this.settings.nbDaysExpire||1;this.data=new q(this.nbDaysExpire);break;case "dom":this.data=
this.settings.domElement?new t(this.settings.domElement):new t(stage.window);break;default:this.data=new stage.structs.hash.struct}else this.data=new stage.structs.hash.struct};r.prototype.set=function(b,f){return this.data.set(b,f)};r.prototype.get=function(b){return this.data.get(b)};r.prototype.unset=function(b){return this.data.unset(b)};r.prototype.clear=function(b){return this.data.clear()};r.prototype.each=function(b){return this.data.each(b)};var f={dom:!0,session:!0,local:!0,cookies:!0,hash:!0},
n=stage.herite(function(b,d){if(!b&&"string"!==typeof b)throw Error("storage key is not defined !!!!");this.key=b;if(!(d&&d in f))throw Error("storage type is not defined !!!!");this.core=this.$super;this.core.constructor({type:d});this.frontData="dom"===d||"hash"===d?this.data:new stage.structs.hash.struct(this.load())},r);n.prototype.get=function(b){return this.frontData.get(b)};n.prototype.set=function(b,f){return this.frontData.set(b,f)};n.prototype.unset=function(b){return this.frontData.unset(b)};
n.prototype.clear=function(b){return this.frontData.clear()};n.prototype.each=function(b){return this.frontData.each(b)};n.prototype.load=function(){return this.core.get(this.key)};n.prototype.save=function(b){this.core.clear();return this.core.set(this.key,this.frontData.get())};return{active:b,nativeDataAttribute:d,coreStorage:r,stage:{createCookie:u,readCookie:k,deleteCookie:l,createStorage:function(b,f){return new n(b,f)}},$$stage:{data:function(b,f){var d=new r({type:"dom",domElement:this});
return void 0===b?d.get():void 0!==f?d.set(b,f):d.get(b)},removeData:function(b){var f=new r({type:"dom",domElement:this});return b?f.unset(b):f.clear()}}}});stage.provide("css");stage.require("dom");stage.require("string");
stage.register("css",function(){var b=stage.browser.Ie?"styleFloat":"cssFloat",d={cssFloat:b,styleFloat:b,"float":b},u=function(b,h){try{return b.filters.item("DXImageTransform.Microsoft.Alpha")}catch(J){return h?{}:null}},k=/z-?index|font-?weight|opacity|zoom|line-?height/i,l=function(){return stage.browser.webKit?function(b){if(1==b.nodeType){var h=b.ownerDocument.defaultView;var e=h.getComputedStyle(b,null);!e&&b.style&&(b.style.display="",e=h.getComputedStyle(b,null))}return e||{}}:stage.browser.Ie&&
10>stage.browser.version?function(b){return 1==b.nodeType?b.currentStyle?b.currentStyle:{}:{}}:function(b){return 1==b.nodeType?b.ownerDocument.defaultView.getComputedStyle(b,null):{}}}(),g=function(){return stage.browser.Ie?function(b,h){if(!h)return 0;if("medium"===h)return 4;if(h.slice&&"px"==h.slice(-2))return parseFloat(h);var e=b.style.left,f=b.runtimeStyle.left;b.runtimeStyle.left=b.currentStyle.left;try{b.style.left=h,h=b.style.pixelLeft}catch(T){h=0}b.style.left=e;b.runtimeStyle.left=f;return h}:
function(b,h){return parseFloat(h)||0}}(),q={width:!0,height:!0,left:!0,top:!0},t=/.*px\s*$/,r=function(){return stage.browser.Ie?function(b,h,e){h=h.toLowerCase();if("auto"==e){if("height"===h)return b.offsetHeight;if("width"===h)return b.offsetWidth;if("bottom"===h)return b.offsetHeight-b.offsetTop}if("fontweight"==h)switch(e){case 700:return"bold";default:return"normal"}h in q||(q[h]=t.test(e));return q[h]?g(b,e):e}:stage.browser.Gecko?function(b,h,e){h=h.toLowerCase();h in q||(q[h]=t.test(e));
return q[h]?g(b,e):e}:function(b,h,e){if("bottom"===h&&"auto"===e)return 0>$$stage(b).css("top")?Math.abs($$stage(b).css("top")):b.offsetTop>b.offsetHeight?-(b.offsetTop-b.offsetHeight):-b.offsetTop;h=h.toLowerCase();h in q||(q[h]=t.test(e));return q[h]?g(b,e):e}}(),f=function(){var b=/alpha\([^)]*\)/;return stage.browser.Ie&&11>stage.browser.version?function(h,e){var d=100*e,v=1==e;h.style.zoom=v?"":1;if(u(h)){var m=h.style.filter||"";h.style.filter=b.test(m)?m.replace(b,d):d}else{if(v)return e;
h.style.filter+=" progid:DXImageTransform.Microsoft.Alpha(Opacity="+d+")"}u(h,1).Enabled=!v;"tr"==h.nodeName.toLowerCase()&&stage.selector("> td",h).each(function(b){f(b,e)});return e}:function(b,h){return b.style.opacity=h}}(),n=function(){if(stage.browser.Ie){var b=/opacity=([^)]*)/i;return function(h){return h.style.filter&&0<=h.style.filter.indexOf("Opacity=")?parseFloat(b.exec(h.style.filter)[1])/100+"":1}}return function(b){return l(b).opacity}}(),B={position:"absolute",visibility:"hidden",
display:"block"},w=function(b,h){if(0!==b.offsetWidth){var e=b.offsetWidth-(H(b,"paddingLeft")||0)-(H(b,"paddingRight")||0);h&&(e=e-(H(b,"borderLeftWidth")||0)-(H(b,"borderRightWidth")||0))}else{var f={},d;for(d in B)f[d]=b.style[d],b.style[d]=B[d];e=b.offsetWidth-(H(b,"paddingLeft")||0)-(H(b,"paddingRight")||0);h&&(e=e-(H(b,"borderLeftWidth")||0)-(H(b,"borderRightWidth")||0));for(d in B)b.style[d]=f[d]}return Math.max(0,Math.round(e))},D=function(b,h){if(0!==b.offsetHeight){var e=b.offsetHeight-
(H(b,"paddingTop")||0)-(H(b,"paddingBottom")||0);h&&(e=e-(H(b,"borderTopWidth")||0)-(H(b,"borderTopWidth")||0))}else{var f={},d;for(d in B)f[d]=b.style[d],b.style[d]=B[d];e=b.offsetHeight-(H(b,"paddingTop")||0)-(H(b,"paddingBottom")||0);h&&(e=e-(H(b,"borderTopWidth")||0)-(H(b,"borderTopWidth")||0));for(d in B)b.style[d]=f[d]}return Math.max(0,Math.round(e))},A=function(b,h){if(h="width"===h?w:"height"===h?D:null)return h(b);h=w(b);b=D(b);var e=[b,h];e.width=h;e.height=b;return e},H=function(b,h){if(!h)return l(b);
if("width"===h||"height"===h)return"width"===h?w(b):D(b);if("opacity"===h)return n(b);var e=l(b);h=d[h]||stage.string.camelize(h);return e?r(b,h,e[h]):r(b,h,b.style[h])},e=function(b,h,e){if(3!==b.nodeType&&8!==b.nodeType){if("opacity"===h)return f(b,e);("width"===h||"height"===h)&&0>parseFloat(e)&&(e=void 0);"number"!==typeof e||k.test(h)||(e+="px");h=d[h]||stage.string.camelize(h);return b.style[h]=e}},E=function(b,h,f){var d=stage.typeOf(h);if("string"===d)return e(b,h,f);if("object"===d){for(var m in h)e(b,
m,h[m]);return l(b)}},F=function(b,h){var e=(h||"").split(/\s+/);if(1===b.nodeType)if(b.className){h=" "+b.className+" ";for(var f=b.className,d=0,m=e.length;d<m;d++)0>h.indexOf(" "+e[d]+" ")&&(f+=" "+e[d]);b.className=stage.string.trim(f)}else b.className=h},p=function(b){return"function"===typeof b.className.split?b.className.split(" "):[]},m=function(b,h){h=" "+h+" ";return-1<(" "+b.className+" ").replace(/[\n\t]/g," ").indexOf(h)?!0:!1},h=function(b,h){if(h&&"string"===typeof h||void 0===h){var e=
(h||"").split(/\s+/);if(1===b.nodeType&&b.className)if(h){h=(" "+b.className+" ").replace(/[\n\t]/g," ");for(var f=0,d=e.length;f<d;f++)h=h.replace(" "+e[f]+" "," ");b.className=stage.string.trim(h)}else b.className=""}};return{addClass:F,removeClass:h,hasClass:m,getClass:p,getComputedStyle:l,getWidth:w,getHeight:D,setWidth:function(b,h){if(!(0>parseFloat(h)))return b.style.width=h},setHeight:function(b,h){if(!(0>parseFloat(h)))return b.style.height=h},getWH:A,getClientWH:function(b){var h=w(b,!0);
b=D(b,!0);var e=[b,h];e.width=h;e.height=b;return e},getDimensions:function(b){},getOpacity:n,setOpacity:f,getStyle:H,setStyle:E,styleToValue:r,pixelTovalue:g,$$stage:{getHeight:function(b){return D(this,b)},getWidth:function(b){return w(this,b)},getWH:function(b,h){return A(this,b,h)},getClass:function(){return p(this)},addClass:function(b){F(this,b)},hasClass:function(b){return m(this,b)},removeClass:function(b){h(this,b)},toggleClass:function(b,e){b&&(void 0===e||e)&&(m(this,b)?h(this,b):F(this,
b))},css:function(b,h){if(void 0===b)return H(this);if(void 0===h&&"string"===typeof b)return H(this,b);E(this,b,h)}}}});stage.provide("position");stage.require("css");stage.require("dom");
stage.register("position",function(){var b=[];b.getWidth=function(){return Math.max(stage.documentElement.clientWidth,stage.body.offsetWidth,stage.documentElement.offsetWidth)};b.getHeight=function(){return Math.max(stage.documentElement.clientHeight,stage.body.scrollHeight,stage.documentElement.scrollHeight,stage.body.offsetHeight,stage.documentElement.offsetHeight)};b.clientWidth=function(){return Math.max((stage.window.innerWidth?stage.window.innerWidth:0)||0,(stage.documentElement?stage.documentElement.clientWidth:
0)||0,(stage.body?stage.body.clientWidth:0)||0)};b.clientHeight=function(){return Math.max((stage.window.innerHeight?stage.window.innerHeight:0)||0,(stage.documentElement?stage.documentElement.clientHeight:0)||0,(stage.body?stage.body.clientHeight:0)||0)};b.clientTop=function(){return stage.documentElement.clientTop||stage.body.clientTop||0};b.clientLeft=function(){return stage.documentElement.clientLeft||stage.body.clientLeft||0};b.scrollLeft=function(){return Math.max((stage.window.pageXOffset?
stage.window.pageXOffset:0)||0,(stage.documentElement?stage.documentElement.scrollLeft:0)||0,(stage.body?stage.body.scrollLeft:0)||0)};b.scrollTop=function(){return Math.max((stage.window.pageYOffset?stage.window.pageYOffset:0)||0,(stage.documentElement?stage.documentElement.scrollTop:0)||0,(stage.body?stage.body.scrollTop:0)||0)};var d=function(b){var f=0,d=0;do if(f+=b.offsetTop||0,d+=b.offsetLeft||0,b=b.offsetParent){if("BODY"==b.tagName.toUpperCase())break;if("static"!==stage.css.getStyle(b,"position"))break}while(b);
b=[d,f];b.top=f;b.left=d;return b},u=function(){return"getBoundingClientRect"in stage.documentElement?function(d){if(!d||!d.ownerDocument)return[0,0];var f=d.getBoundingClientRect();d=f.top+b.scrollTop()-b.clientTop();f=f.left+b.scrollLeft()-b.clientLeft();var n=[f,d];n.top=d;n.left=f;return n}:function(b){if(!b||!b.ownerDocument)return[0,0];var f=0,d=0;if(b.parentNode){do f+=b.offsetTop||0,d+=b.offsetLeft||0,b=b.offsetParent;while(b)}b=[d,f];b.top=f;b.left=d;return b}},k=null,l=function(b){return"scrollTo"in
b&&b.document?b:9===b.nodeType?b.defaultView||b.parentWindow:arguments.callee(b.ownerDocument)||!1},g=function(){return window.document.body||window.document.getElementsByTagName("body")[0]},q=function(){return stage.document.documentElement},t=function(b){var f=k(b);return{left:f.left,top:f.top,width:stage.css.getWidth(b),height:stage.css.getHeight(b)}};return{ancestorOffset:d,ancestorsOffset:function(b){for(var f=0,d=0;b&&"BODY"!=b.tagName.toUpperCase();)f+=b.offsetTop||0,d+=b.offsetLeft||0,b=b.offsetParent;
b=[d,f];b.left=d;b.top=f;return b},viewport:t,_onLoad:function(){stage.documentElement=q();stage.window=l(stage.document);stage.body=g();this.documentOffset=k=u()},stage:{viewport:b,getWindow:l,getBody:g,getDocumentElement:q},$$stage:{ancestorOffset:function(){return d(this)},documentOffset:function(){return k(this)},Viewport:function(){return t(this)}}}});stage.provide("io.transport.outSocket.ajax");stage.provide("ajax");stage.require("outSocket");stage.require("json");
stage.register.call(stage.io.transport.outSocket,"ajax",function(b,d){var u={},k={},l={method:"GET",encoding:"UTF-8",async:!0,cache:!1,dataType:"queryString",responseType:"",headerJson:!1,username:null,password:null,timeout:0,ifModified:!1,withCredentials:!1,headers:{Accept:"text/javascript, text/html, application/xml, text/xml, text/plain, */*"},globalEvents:!1},g={onAjaxGlobalException:null,onAjaxGlobalError:null,onAjaxGlobalTimeout:null,onAjaxGlobalAbort:null};if(stage.browser.Ie)var q=function(){if(window.XMLHttpRequest&&
("file:"!==window.location.protocol||!window.ActiveXObject))var b=["MSXML2.XMLHTTP.6.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"];for(var h=0;h<b.length;h++){var e=b[h];try{return new window.ActiveXObject(e),e}catch(R){}}throw Error("Could not create ActiveXObject  ActiveX might be disabled, or MSXML might not be installed");}();else var t=null;var r=function(){return!window.XMLHttpRequest||"file:"===window.location.protocol&&window.ActiveXObject?t?new window.ActiveXObject(q):null:
new window.XMLHttpRequest},f=void 0!==r().withCredentials?2:1,n=function(){var b=function(){switch(this.settings.dataType){case "formData":var b="multipart/form-data";break;case "queryString":b="application/x-www-form-urlencoded";break;case "text":case "domString":b="text/plain";break;case "xml":case "document":b="application/xml";break;case "json":b="application/json";break;case "blob":b="application/octet-stream";break;default:b="application/x-www-form-urlencoded"}this.settings.encoding&&(b+="; charset="+
this.settings.encoding);return b};return function(){var h=this.settings.headers;switch(this.settings.method){case "POST":h["Content-Type"]=b.call(this);this.transport.overrideMimeType&&2005>(navigator.userAgent.match(/Gecko\/(\d{4})/)||[0,2005])[1]&&(h.Connection="close");break;case "PUT":h["Content-Type"]=b.call(this);this.transport.overrideMimeType&&2005>(navigator.userAgent.match(/Gecko\/(\d{4})/)||[0,2005])[1]&&(h.Connection="close");break;case "DELETE":this.transport.overrideMimeType&&2005>(navigator.userAgent.match(/Gecko\/(\d{4})/)||
[0,2005])[1]&&(h.Connection="close")}switch(this.settings.responseType){case "html":var e="text/html,*/*";break;case "text":e="text/plain,*/*";break;case "document":case "xml":e="application/xml, text/xml,*/*";break;case "json":e="application/json, text/javascript,*/*";break;case "script":e="application/javascript ,text/javascript ,*/*";break;default:e="application/json, text/javascript,application/xml, text/xml,text/plain,text/html,application/javascript ,text/javascript ,*/*"}h.Accept=e;this.settings.ifModified&&
(u[this.url]&&(h["If-Modified-Since"]=u[this.url]),k[this.url]&&(h["If-None-Match"]=k[this.url]));try{for(var f in h)this.transport.setRequestHeader(f,h[f])}catch(aa){this.eventsManager.fireEvent("onError",this,null,aa)}}}(),B=function(){var b=w.call(this,"X-JSON");if(b)return stage.json.parse(decodeURIComponent(escape(b)));this.eventsManager.fireEvent("onError",this,null,Error("Header JSON is null"))},w=function(b){return this.transport.getResponseHeader(b)||null},D=function(){var b=this.transport.getResponseHeader("Last-Modified"),
h=this.transport.getResponseHeader("Etag");b&&(u[this.url]=b);h&&(k[this.url]=h);return 304===this.transport.status||0===this.transport.status};if(2==f)var A=function(b){this._isOpened=!0;this.eventsManager.fireEvent("onLoadStart",this,b)},H=function(b){this._timeoutId&&clearTimeout(this._timeoutId);this.crossDomain?0==this.transport.responseText.length?(this.eventsManager.fireEvent("onError",this,b,Error("ResponseText is empty, this navigator is not ajax streaming compliant")),this.abort()):this._timeoutId=
setTimeout(this._timeoutFunc,this.settings.timeout):(this._isLoading=!0,this._timeoutId=setTimeout(this._timeoutFunc,this.settings.timeout),b.lengthComputable&&(this.offset=b.loaded),this.eventsManager.fireEvent("onProgress",this,b))},e=function(b){var h=!1;this.settings.ifModified&&(h=D.call(this));I.call(this)?(this.settings.headerJson&&(this.headerJson=B.call(this,b)),h||"HEAD"===this.settings.method||(stage.io.formatTransportResponse(this,b),this.eventsManager.fireEvent("onLoad",this,b))):this.eventsManager.fireEvent("onError",
this,b,Error(this.transport.status+": "+this.transport.statusText),this.transport.status);this.offset=0;this._timeoutId&&(clearTimeout(this._timeoutId),this._timeoutId=null);this._isComplete=!0;this.eventsManager.fireEvent("onLoadEnd",this,b)},E=function(b){this._isComplete=!0;this.eventsManager.fireEvent("onLoadEnd",this,b)},F=function(b){this.eventsManager.fireEvent("onAbort",this,b);this.eventsManager.fireEvent("onLoadEnd",this,b)},p=function(b){this.eventsManager.fireEvent("onError",this,b,Error("Error callback on ajax request"));
this.eventsManager.fireEvent("onLoadEnd",this,b)};var m=function(){return 1==f?function(b){if(!this.transport||!this._isComplete&&0===this.transport.readyState)this.abort(),this.eventsManager.fireEvent("onLoadEnd",this,b),this._isComplete=!0;else if(1===this.transport.readyState&&(this._isOpened=!0,this.eventsManager.fireEvent("onLoadStart",this,b)),2===this.transport.readyState&&(this._isHeaderReceived=!0,this.eventsManager.fireEvent("onReceive",this,b)),3===this.transport.readyState&&(stage.io.formatTransportResponse(this,
b),this._isLoading=!0,this.eventsManager.fireEvent("onProgress",this,b)),!this._isComplete&&4===this.transport.readyState){if(!this._isTimeout){var h=!1;this.settings.ifModified&&(h=D.call(this));I.call(this)?(this.settings.headerJson&&(this.headerJson=B.call(this,this)),h||"HEAD"===this.settings.method||(stage.io.formatTransportResponse(this,b),this.eventsManager.fireEvent("onLoad",this,b))):this.eventsManager.fireEvent("onError",this,null,Error(this.transport.status+": "+this.transport.statusText),
this.transport.status)}this._timeoutId&&(clearTimeout(this._timeoutId),this._timeoutId=null);this._isComplete=!0;this.eventsManager.fireEvent("onLoadEnd",this,b)}return!0}:function(b){!1===this.settings.async&&1===this.transport.readyState&&(this._isOpened=!0,this.eventsManager.fireEvent("onLoadStart",this,b));2===this.transport.readyState&&(this._isHeaderReceived=!0,this.eventsManager.fireEvent("onReceive",this,b));return!0}}(),h={json:"",xml:"",html:"",arraybuffer:"arraybuffer",blob:"blob",javascript:"",
"text/html":""},v=stage.herite(function(b,h){this.$super.constructor("ajax",b,l,h);this.streamDirection="OUT";this.offset=0;this.headerJson=this.response=this.data=null;this.transport=r();if(!this.transport)return this.error=Error("Could not create ActiveXObject  ActiveX might be disabled, or MSXML might not be installed"),this;this._isTimeout=this._isComplete=this._isAbort=this._isLoading=this._isOpened=this._isHeaderReceived=!1;this._timeoutId=void 0;this.settings.globalEvents&&(this.eventsManager.listen(this.transport,
"onAbort",this.settings.onAjaxGlobalAbort),this.eventsManager.listen(this.transport,"onTimeout",this.settings.onAjaxGlobalTimeout),this.eventsManager.listen(this.transport,"onError",this.settings.onAjaxGlobalError));2==f&&(this.transport.onloadstart=A.bind(this),this.transport.onprogress=H.bind(this),this.transport.onload=e.bind(this),this.transport.loadend=E.bind(this),this.transport.onabort=F.bind(this),this.transport.onerror=p.bind(this),this.transport.ontimeout=this.eventsManager.listen(this.transport,
"onTimeout",null))},stage.io.transport.transportCore);v.prototype.send=function(b){var e=this.settings.method.toUpperCase();try{if("GET"===this.settings.method){this.data=stage.io.formatData(b,this.settings.dataType,this.settings.method);var d=stage.io.url.formatUrl(this.url,e,this.settings.cache,this.data)}else this.data=stage.io.formatData(b,this.settings.dataType,this.settings.method),d=stage.io.url.formatUrl(this.url,e,this.settings.cache,null)}catch(aa){this.eventsManager.fireEvent("onError",
this,null,aa)}1==f&&(stage.browser.Opera||stage.browser.Webkit)&&(this.transport.onreadystatechange=this.eventsManager.listen(this,"readystatechange",m));2==f&&(this.transport.onreadystatechange=this.eventsManager.listen(this,"readystatechange",m));try{this.settings.username?this.transport.open(e,d,this.settings.async,this.settings.username,this.settings.password):this.transport.open(e,d,this.settings.async)}catch(aa){this._isOpened=!1,this.eventsManager.fireEvent("onError",this,null,aa),this.abort()}1==
f&&(stage.browser.Gecko||stage.browser.Ie)&&(this.transport.onreadystatechange=this.eventsManager.listen(this,"readystatechange",m));n.call(this);this.settings.async&&0<this.settings.timeout&&(this._timeoutFunc=function(){!this.transport||this._isComplete||this._isLoading||(this._isTimeout=!0,this.eventsManager.fireEvent("onTimeout",this),this.abort())}.bind(this),this._timeoutId=setTimeout(this._timeoutFunc,this.settings.timeout));2==f&&this.crossDomain&&this.settings.async&&(this.transport.withCredentials=
this.settings.withCredentials);try{var v=this.settings.responseType in h?h[this.settings.responseType]:this.settings.responseType;v&&(this.transport.responseType=v);this.transport.send(this.data)}catch(aa){this.eventsManager.fireEvent("onError",this,null,aa),this.abort()}1==f&&stage.browser.Gecko&&!this.settings.async&&this.transport.overrideMimeType&&m.call(this);return this};v.prototype.abort=function(){console.log("ABORT");this._timeoutId&&(clearTimeout(this._timeoutId),this._timeoutId=null);1==
f&&this.eventsManager.fireEvent("onAbort",this);this.transport&&4!==this.transport.readyState&&this.transport.abort();this._isAbort=!0};v.prototype.getHeader=w;var I=function(){switch(this.transport.status){case 0:return"file:"===location.protocol?!1:!0;case 200:case 204:case 304:case 1223:return!0;default:return 200<=this.transport.status&&300>this.transport.status?!0:!1}},J=function(b,h,e){b=new v(b,e);b.eventsManager.settingsToListen(e);if(b.error)return b.eventsManager.fireEvent("onError",b,null,
b.error),b;b.send(h||null);return b};return{transport:v,xhr:r,xhrLevel:f,active:!0,onReadyStateChange:m,stage:{ajax:{ajaxGlobalSetup:function(b){b.globalEvents=!0;stage.extend(!0,l,g,b)},request:function(b,h,e){return J(b,h,e)},get:function(b,h,e){e||(e={});e.method="GET";return J(b,h,e)},post:function(b,h,e){e||(e={});e.method="POST";return J(b,h,e)},put:function(b,h,e){e||(e={});e.method="PUT";return J(b,h,e)},Delete:function(b,h,e){e||(e={});e.method="DELETE";return J(b,h,e)},head:function(b,h){h||
(h={});h.method="HEAD";return J(b,null,h)}}}}});stage.provide("xml");stage.require("ajax");
stage.register("xml",function(b,d){var u=function(){var b=0;return document.implementation.createDocument?function(b,f){try{b||(b="");f||(f="");var e=document.implementation.createDocument(f,b,null)}catch(p){throw Error(p.message);}return e}:function(e,f){try{e||(e="");f||(f="");var d=new ActiveXObject("Microsoft.XMLDOM");if(e){var p="";f&&(1<e.indexOf(":")?(p=e.substring(0,e.indexOf(":")),e=e.substring(e.indexOf(":")+1)):p="a"+b++);f?d.loadXML("<"+p+":"+e+" xmlns:"+p+'="'+f+'" />'):d.loadXML("<"+
e+" />")}}catch(m){throw Error(m.message);}return d}}(),k=function(){try{var b=new XMLSerializer}catch(e){}return b?function(b){return(new XMLSerializer).serializeToString(b)}:function(b){return b.xml}}(),l=function(b){return k(b).replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/'/g,"&apos;").replace(/"/g,"&quot;")},g=function(){return document.implementation.createDocument?function(b){try{var e=(new DOMParser).parseFromString(b,"application/xml")}catch(E){throw Error("stage.xml function stringToDocumentXML : "+
E);}return e}:function(b){var e=u();e.async="false";e.loadXML(b);return e}}(),q=function(b){var e=stage.typeOf(b);if("document"===e)return b.documentElement||b.childNodes[0];if("element"===e)return b=b.ownerDocument,b.documentElement||b.childNodes[0]},t=function(b){return"element"===stage.typeOf(b)?stage.isXML(b.ownerDocument):!1},r=function(){return stage.browser.Ie?function(b,e,f){var d=[];if(b=b.selectNodes(e,f||null))for(e=0;e<b.length;e++)d.push(b[e]);return d}:function(b,e,f,d,p){var m=[];b=
b.evaluate(e,b,f||null,d||XPathResult.ANY_TYPE,p||null);for(e=b.iterateNext();e;)m.push(e),e=b.iterateNext();return m}}(),f=function(b){var e=stage.typeOf(b);if("string"===e)var f=q(g(b));"document"===e&&(f=q(b));"element"===e&&(f=b);return B(f)},n=null,B=function(b){if(!b)return null;n={};var e=w(b);n[b.nodeName]&&(e=[e]);if(11!=b.nodeType){var f={};f[b.nodeName]=e;e=f}return e},w=function(b){if(!b)return null;switch(b.nodeType){case 7:return null;case 3:case 4:return b.nodeValue.match(/[^\x00-\x20]/)?
b.nodeValue:null}var e=null,f={};if(b.attributes&&b.attributes.length){e={};for(var d=0;d<b.attributes.length;d++){var p=b.attributes[d].nodeName;if("string"===typeof p){var m=b.attributes[d].value||b.attributes[d].nodeValue;m&&(p="@"+p,"undefined"==typeof f[p]&&(f[p]=0),f[p]++,D(e,p,f[p],m))}}}if(b.childNodes&&b.childNodes.length){p=!0;e&&(p=!1);for(d=0;d<b.childNodes.length&&p;d++)m=b.childNodes[d].nodeType,3!=m&&4!=m&&(p=!1);if(p)for(e||(e=""),d=0;d<b.childNodes.length;d++)e+=b.childNodes[d].nodeValue;
else for(e||(e={}),d=0;d<b.childNodes.length;d++)if(p=b.childNodes[d].nodeName,"string"===typeof p&&(m=w(b.childNodes[d])))"undefined"===typeof f[p]&&(f[p]=0),f[p]++,D(e,p,f[p],m)}return e},D=function(b,e,f,d){e=e?e.replace(":",":"):e;n&&n[e]?(1==f&&(b[e]=[]),b[e][b[e].length]=d):1==f?b[e]=d:2==f?b[e]=[b[e],d]:b[e][b[e].length]=d};b=function(b,e,f){var d=stage.extend(!0,{responseType:"xml"},f);b=new stage.io.transport.outSocket.ajax.transport(b,d);b.listen(b,"onLoad",A);b.eventsManager.settingsToListen(f);
if(b.error)return b.eventsManager.fireEvent("onError",b,null,b.error),b;b.send(e||null);return b};var A=function(){this.response=$$stage(this.response)};return{xpath:!!document.evaluate,stage:{loadXml:b},createDocument:u,loadXml:b,parseXml:f,parseNode:B,stringToDocumentXML:g,getDocumentRoot:q,xmlToString:k,xmlToHTML:l,isXmlElement:t,evaluateXpath:r,$$stage:{children:function(){return stage.dom.children(this)},siblings:function(){return stage.dom.siblings(this)},contents:function(){return stage.dom.contents(this)},
nodeName:function(b){return stage.dom.nodeName(this,b)},getDocumentRoot:function(){return q(this)},insertNode:function(b,e){return stage.dom.insert(this,b,e)},removeNode:function(b,e){return stage.remove(this)},parseNode:function(){return B(this)},parseDocument:function(){return f(this)},cloneNode:function(){return this.cloneNode(!0)},importNode:function(b){return(b||document).importNode(this,!0)},text:function(b){return b?stage.dom.setText(this,b):stage.dom.getText(this)},isXmlElement:function(){return t(this)},
attribute:function(b,e){return b?void 0===e?stage.dom.getAttribute(this,b):stage.dom.setAttribute(this,b,e):stage.dom.getAttribute(this)},hasAttribute:function(b){return stage.dom.hasAttribute(this,b)},xmlToString:function(){return k(this)},xmlToHTML:function(){return l(this)},evaluateXpath:function(b,e,f,d){return r(this,b,e,f,d)}}}});stage.provide("io.transport.outSocket.iframe");stage.provide("iframe");stage.require("io");stage.require("events");stage.require("position");
stage.register.call(stage.io.transport.outSocket,"iframe",function(b,d){var u={method:"GET",dataType:"queryString",responseType:"",cleanIframe:!1,async:!0,cache:!1,timeout:0,globalEvents:!1},k={onIframeGlobalError:null,onIframeGlobalException:null,onIframeGlobalTimeout:null,onIframeGlobalAbort:null},l=function(){this._isComplete=!0},g=/\s*4\d{2}[^\d]/,q=function(){try{var b=this.transport.contentDocument;!this.crossDomain&&this.transport.contentDocument.getElementsByTagName("title")&&0!=this.transport.contentDocument.getElementsByTagName("title").length&&
g.test(this.transport.contentDocument.getElementsByTagName("title")[0].innerHTML)&&(this.error=Error(this.transport.contentDocument.getElementsByTagName("title")[0].innerHTML))}catch(f){this.error=Error("Probably 404 not found url")}this.error?this.eventsManager.fireEvent("onError",this,null,this.error):(this.response=b,this.eventsManager.fireEvent("onLoad",this,null));this.eventsManager.fireEvent("onLoadEnd",this,null);this._timeoutId&&(clearTimeout(this._timeoutId),this._timeoutId=null)},t=stage.herite(function(b,
f){this.$super.constructor("iframe",b,u,f);this.streamDirection="OUT";this.error=!1;this.transport=document.createElement("iframe");this._timeoutId=null;this._isComplete=!1;this.settings.globalEvents&&(this.eventsManager.listen(this,"onError",this.settings.onIframeGlobalError),this.eventsManager.listen(this,"onTimeout",this.settings.onIframeGlobalTimeout),this.eventsManager.listen(this,"onAbort",this.settings.onIframeGlobalAbort));this.transport.setAttribute("style","display:none");this.settings.cleanIframe?
this.eventsManager.listen(this,"onLoadEnd",l):this.eventsManager.listen(this,"onLoadEnd",function(){this._isComplete=!0;this.eventsManager.detachEvent("onLoadEnd",q);stage.unListen(this.transport)});return this},stage.io.transport.transportCore);t.prototype.send=function(b){this._isComplete&&this.eventsManager.fireEvent("onError",this,null,Error("Iframe transport is busy"));try{var f=stage.io.formatData(b,this.settings.dataType,"GET"),d=stage.io.url.formatUrl(this.url,"GET",this.settings.cache,f)}catch(B){return this.eventsManager.fireEvent("onError",
B),this.abort(),!1}this.transport.setAttribute("src",d);0<this.settings.timeout&&(this._timeoutId=setTimeout(stage.setContext(function(){this.transport&&!this._isComplete&&(this.eventsManager.fireEvent("onTimeout",this),this.abort())},this),this.settings.timeout));try{stage.listen(this.transport,"load",stage.setContext(q,this)),$stage(document.body).insertBefore(this.transport,$stage(document.body).firstChild)}catch(B){this.eventsManager.fireEvent("onError",B),this.abort()}return this};t.prototype.listen=
function(b,f,d){return this.eventsManager.listen(b,f,d)};t.prototype.abort=function(){this._isComplete=!0;this._timeoutId&&(clearTimeout(this._timeoutId),this._timeoutId=null);this.eventsManager.fireEvent("onAbort",this);this.eventsManager.fireEvent("onLoadEnd",this);this._isComplete=!0};return{transport:t,active:!0,stage:{iframe:{iframeGlobalSetup:function(b){b.globalEvents=!0;stage.extend(!0,u,k,b)},load:function(b,f,d){b=new t(b,d);b.eventsManager.settingsToListen(d);b.error?(b.eventsManager.fireEvent("onError",
b,null,b.error),b.eventsManager.fireEvent("onLoadEnd",b)):b.send(f||null);return b}}}}});stage.provide("io.transport.outSocket.script");stage.provide("script");stage.require("io");stage.require("events");
stage.register.call(stage.io.transport.outSocket,"script",function(b,d){var u={method:"GET",dataType:"queryString",responseType:"script",defer:!1,charset:"UTF-8",cleanScript:!0,async:!0,cache:!1,timeout:0,globalEvents:!1},k={onScriptGlobalAbort:null,onScriptGlobalError:null,onScriptGlobalTimeout:null},l=function(){this._isComplete=!0;setTimeout(function(){stage.remove(this.transport);this.eventsManager.detachEvent("onLoadEnd",g);this.transport=null}.bind(this),50)},g=function(b){this.error||(this.response=
this.transport,this.eventsManager.fireEvent("onLoad",this,b||null));this.eventsManager.fireEvent("onLoadEnd",this,b||null);this._timeoutId&&(clearTimeout(this._timeoutId),this._timeoutId=null)},q=function(b){if(this.transport)switch(this.transport.readyState){case "complete":case "loaded":stage.setContext(g,this)(b)}},t=function(){this.error=Error("Error callback on script request");this.eventsManager.fireEvent("onError",this,null,this.error);this.eventsManager.fireEvent("onLoadEnd",this,null)},r=
document.getElementsByTagName("head")[0]||document.documentElement;var f=stage.browser.Ie&&9>stage.browser.version?"text/javascript":"application/javascript";var n=stage.herite(function(b,d){this.$super.constructor("script",b,u,d);this.streamDirection="OUT";this.error=!1;this._timeoutId=this.response=null;this._isTimeout=this._isAbort=this._isComplete=!1;this.transport=document.createElement("script");this.transport.setAttribute("type",f);this.transport.onerror=stage.setContext(t,this);this.settings.globalEvents&&
(this.eventsManager.listen(this,"onTimeout",this.settings.onGlobalTimeout),this.eventsManager.listen(this,"onError",this.settings.onGlobalError),this.eventsManager.listen(this,"onAbort",this.settings.onGlobalAbort));this.settings.cleanScript?this.eventsManager.listen(this,"onLoadEnd",l):this.eventsManager.listen(this,"onLoadEnd",function(){this._isComplete=!0;this.eventsManager.detachEvent("onLoadEnd",g);stage.unListen(this.transport);this.transport=null})},stage.io.transport.transportCore);n.prototype.send=
function(b){this._isComplete&&this.eventsManager.fireEvent("onError",this,null,Error("transport is busy"));try{var f=stage.io.formatData(b,this.settings.dataType,"GET"),d=stage.io.url.formatUrl(this.url,"GET",this.settings.cache,f)}catch(A){return this.eventsManager.fireEvent("onError",this,null,A),this.abort(),!1}this.transport.setAttribute("charset",this.settings.charset);this.settings.defer&&this.transport.setAttribute("defer","defer");this.transport.setAttribute("src",d);0<this.settings.timeout&&
(this._timeoutId=setTimeout(stage.setContext(function(){this.transport&&!this._isComplete&&(this._isTimeout=!0,this.eventsManager.fireEvent("onTimeout",this),this.abort())},this),this.settings.timeout));try{stage.browser.Ie?this.transport.onreadystatechange=stage.setContext(q,this):stage.listen(this.transport,"load",stage.setContext(g,this)),r.insertBefore(this.transport,r.firstChild),this._isComplete=!1}catch(A){this.eventsManager.fireEvent("onError",this,null,A),this.abort()}return this};n.prototype.listen=
function(b,f,d){return this.eventsManager.listen(b,f,d)};n.prototype.abort=function(){l.call(this);this._timeoutId&&(clearTimeout(this._timeoutId),this._timeoutId=null);this.eventsManager.fireEvent("onAbort",this);this.eventsManager.fireEvent("onLoadEnd",this);this._isComplete=this._isAbort=!0};return{transport:n,active:!0,stage:{script:{scriptGlobalSetup:function(b){b.globalEvents=!0;stage.extend(!0,u,k,b)},load:function(b,f,d){b=new n(b,d);b.eventsManager.settingsToListen(d);b.error?b.eventsManager.fireEvent("onError",
b,null,b.error):b.send(f||null);return b}}}}});stage.provide("structs.queues");stage.require("structs");
stage.register.call(stage.structs,"queues",function(){var b={type:"FIFO",active:!0},d=function(d){this.settings=stage.extend(!0,{},b,d);this.data=[];this.error=null;this.eventsQueue=stage.createEventsManager()};d.prototype.listen=function(b,d,l){return this.eventsQueue.listen(b,d,l)};d.prototype.enqueue=function(b){if(this.settings.active)return b=this.data.push(b),this.eventsQueue.fireEvent("onQueued",this),b;this.error=Error("QUEUE is stoped");this.eventsQueue.fireEvent("onError",this,this.error,
2);return null};d.prototype.remove=function(b){if(this.isEmpty())return this.error=Error("QUEUE is empty"),this.eventsQueue.fireEvent("onError",this,this.error,0),null;if(stage.array.contain(this.data,b))return stage.array.remove(this.data,b);this.error=Error(b+" Not found");this.eventsQueue.fireEvent("onError",this,this.error,1);return null};d.prototype.dequeue=function(){if(this.settings.active){if(this.isEmpty())return this.error=Error("QUEUE is empty"),this.eventsQueue.fireEvent("onError",this,
this.error,0),null;var b=this.data[0];stage.array.removeIndexOf(this.data,0);this.eventsQueue.fireEvent("onDeQueued",this);return b}this.error=Error("QUEUE is stoped");this.eventsQueue.fireEvent("onError",this,this.error,2);return null};d.prototype.peek=function(b){return this.isEmpty()?null:this.data[0]};d.prototype.purge=function(){this.data.length=0};d.prototype.isEmpty=function(){return 0===this.data.length};d.prototype.count=function(){return this.data.length};d.prototype.getQueue=function(){return this.data};
d.prototype.start=function(){this.settings.active=!0};d.prototype.stop=function(){this.settings.active=!1};d.prototype.run=function(b){if(this.settings.active)this.eventsQueue.fireEvent("onRunStart",this),stage.each(this.data,b),this.eventsQueue.fireEvent("onRunFinish",this);else return this.error=Error("QUEUE is stoped"),this.eventsQueue.fireEvent("onError",this,this.error,2),null};return{struct:d,local:{createQueue:function(b){b||(b={});var k=new d(b);k.eventsQueue.settingsToListen(b);k.error&&
k.eventsQueue.fireEvent("onError",k,k.error);return k}}}});stage.provide("io.transport.outSocket.jsonp");stage.provide("jsonp");stage.require("io");stage.require("iframe");stage.require("script");
stage.register.call(stage.io.transport.outSocket,"jsonp",function(b,d){var u={method:"GET",responseType:"json",dataType:"formData",streaming:!1,globalEvents:!1,jsonpCallback:"stage.io.transport.outSocket.jsonp.jsonpCollector.callback",jsonpError:"stage.io.transport.outSocket.jsonp.jsonpCollector.error"},k={onJsonpGlobalAbort:null,onJsonpGlobalError:null},l="",g=function(b){this.response=b;l+=b;this.eventsManager.fireEvent("onProgress",this)},q=function(){this.eventsManager.fireEvent("onLoadEnd",this)},
t=function(){this.error||(this.reponse=l,this.eventsManager.fireEvent("onLoad",this))},r=function(b){this.error=!0;this.eventsManager.fireEvent("onError",b)},f=function(){stage.io.transport.outSocket.jsonp.jsonpCollector["callback_"+this.ts]&&delete stage.io.transport.outSocket.jsonp.jsonpCollector["callback_"+this.ts];stage.io.transport.outSocket.jsonp.jsonpCollector["error_"+this.ts]&&delete stage.io.transport.outSocket.jsonp.jsonpCollector["error_"+this.ts]},n=stage.herite(function(b,f){this.$super.constructor("JSONP",
b,u,f);this.streamDirection="OUT";this.response=null;if(this.crossDomain&&this.settings.streaming)return this.error=Error("Browser can't start JSONP streaming on cross domain"),this;this.transport=new (this.settings.streaming?stage.io.transport.outSocket.iframe.transport:stage.io.transport.outSocket.script.transport)(this.url,this.settings);this.settings.globalEvents&&(this.eventsManager.listen(this.transport,"onAbort",this.settings.onJsonpGlobalAbort),this.eventsManager.listen(this.transport,"onError",
this.settings.onJsonpGlobalError))},stage.io.transport.transportCore);n.prototype.send=function(b){jsonData={jsonpCallback:(this.settings.streaming?"window.parent.":"")+this.settings.jsonpCallback,jsonpError:(this.settings.streaming?"window.parent.":"")+this.settings.jsonpError,responseType:this.settings.responseType};var d=stage.getRandomId();jsonData.jsonpError+="_"+d;jsonData.jsonpCallback+="_"+d;this.ts=d;stage.io.transport.outSocket.jsonp.jsonpCollector["callback_"+d]=g.bind(this);stage.io.transport.outSocket.jsonp.jsonpCollector["error_"+
d]=r.bind(this);this.transport.listen(this,"onError",r);this.transport.listen(this,"onLoad",t);this.transport.listen(this,"onLoadEnd",q);this.listen(this,"onLoadEnd",f);this.listen(this,"onError",f);this.listen(this,"onAbort",f);try{var n=stage.io.formatData(jsonData,this.settings.dataType,this.settings.method);n+=b?"&"+b:""}catch(A){this.eventsManager.fireEvent("onError",A)}this.transport.send(n)};n.prototype.abort=function(){this.transport&&this.transport.abort()};n.prototype.listen=function(b,
f,d){return this.eventsManager.listen(b,f,d)};return{jsonpCollector:{},transport:n,active:!0,stage:{jsonp:{jsonpGlobalSetup:function(b){b.globalEvents=!0;stage.extend(!0,u,k,b)},request:function(b,f,d){b=new n(b,d);b.eventsManager.settingsToListen(d);b.error?b.eventsManager.fireEvent("onError",b,null,b.error):b.send(f||null);return b}}}}});stage.provide("io.transport.outSocket.upload");stage.provide("upload");stage.require("io");stage.require("events");stage.require("ajax");stage.require("iframe");
stage.register.call(stage.io.transport.outSocket,"upload",function(b,d){var u={method:"POST",forceAjax:!1,forceIframe:!1},k=function(){return stage.browser.Gecko||stage.browser.Webkit?function(){return{"X-Stage-File-Name":this.file.name,"X-Stage-File-Size":this.file.size,"X-Stage-File-Type":this.file.type,"Content-Type":"application/octet-stream"}}:function(){return{"X-Stage-File-Name":this.file.fileName,"X-Stage-File-Size":this.file.fileSize,"X-Stage-File-Type":this.file.fileType,"Content-Type":"application/octet-stream"}}}();
var l=2==(stage.io.transport.outSocket.ajax.xhr().upload?2:1)?!0:!1;var g=function(){this.error||this.eventsManager.fireEvent("onLoad",this)},q=function(b,f){this.eventsManager.fireEvent("onProgress",this,f)},t=function(){this.eventsManager.fireEvent("onLoadEnd",this);this._isComplete=!0},r=function(){this.eventsManager.fireEvent("onError",this)},f=function(b,f,d){if(b)this.url=b;else throw Error(" url not defined");this.settings=stage.extend(!0,{},u,d);this.eventsManager=stage.createEventsManager();
this._isTimeout=this._isAbort=this._isComplete=this._isCreate=!1;this.file=f;this.wrapper="";this.wrapper=l?"AJAX":"IFRAME";this.settings.forceAjax&&l&&(this.wrapper="AJAX");this.settings.forceIframe&&(this.wrapper="IFRAME");switch(this.wrapper){case "AJAX":this.settings.dataType="blob",this.settings.headers=k.call(this),this.transport=new stage.io.transport.outSocket.ajax.transport(b,this.settings),this.transport.listen(this,"onLoad",g),this.transport.listen(this,"onLoadEnd",t),this.transport.listen(this,
"onProgress",q),this.transport.listen(this,"onError",r)}this.settings.globalEvents&&(this.eventsManager.listen(this.transport,"onAbort",this.settings.onUploadGlobalAbort),this.eventsManager.listen(this.transport,"onError",this.settings.onUploadGlobalError));this.eventsManager.listen(this,"onCreateUpload",this.settings.onCreateUpload);this.eventsManager.fireEvent("onCreateUpload",this);this._isCreate=!0;return this};f.prototype.send=function(b){switch(this.wrapper){case "AJAX":this.transport.send(this.file)}};
f.prototype.abort=function(){};f.prototype.listen=function(b,f,d){return this.eventsManager.listen(b,f,d)};return{transport:f,stage:{upload:function(b,d,g){b=new f(b,d,g);b.eventsManager.settingsToListen(g);b.error?b.eventsManager.fireEvent("onError",b,null,b.error):b.send(d||null);return b}}}});stage.provide("io.transport.inSocket.poll");stage.provide("poll");stage.require("io");stage.require("ajax");stage.require("script");stage.require("iframe");stage.require("jsonp");
stage.register.call(stage.io.transport.inSocket,"poll",function(b,d){var u={delay:4E3,pollAsync:!1},k=function(b){this.error=b.response;this.eventsManager.fireEvent("onError",this.error)},l=function(b){this.toDisconnect||(this.response=b.response,this.eventsManager.fireEvent("onMessage",this.response),this.timer=setTimeout(stage.setContext(function(){this.transport=new this.transportWrapper(this.url,this.settings);this.transport.listen(this,"onLoad",l);this.eventsManager.fireEvent("onPrepareData");
this.transport.send(this.pollData)},this),this.settings.delay))},g=function(){var b=this.idRequest++;this.transport[b]=new this.transportWrapper(this.url,this.settings);this.transport[b].listen(this,"onLoad",function(b){this.response=b.response;this.eventsManager.fireEvent("onMessage",this.response)});this.transport[b].listen(this,"onLoadEnd",function(d){delete this.transport[b]});this.transport[b].listen(this,"onError",function(d){k(d);delete this.transport[b]});this.eventsManager.fireEvent("onPrepareData");
this.transport[b].send(this.pollData)},q=stage.herite(function(b,d,f){this.$super.constructor("poll",b,u,d);this.streamDirection="IN";this.state="closed";this.pollData="";this.idRequest=0;this.transport=f||null;this.transportWrapper=null},stage.io.transport.transportCore);q.prototype.start=function(b,d){stage.extend(!0,this.settings,b);d&&(this.pollData=d);this.toDisconnect=!1;this.timer=null;this.transportWrapper=2!=stage.io.transport.outSocket.ajax.xhrLevel||this.settings.forceJSONP?this.crossDomain||
this.settings.forceJSONP?stage.io.transport.outSocket.jsonp.transport:stage.io.transport.outSocket.ajax.transport:stage.io.transport.outSocket.ajax.transport;if(!this.transport)if(this.settings.pollAsync)this.timer=setInterval(stage.setContext(g,this),this.settings.delay),this.transport={};else try{this.transport=new this.transportWrapper(this.url,this.settings),this.transport.listen(this,"onLoad",l),this.transport.listen(this,"onError",k),this.transport.send(this.pollData)}catch(f){this.error=Error("transport create transport on poll prototype: "+
f);return}this.state="started";this.eventsManager.fireEvent("onStart",this)};q.prototype.stop=function(){if("started"==this.state){this.toDisconnect=!0;clearTimeout(this.timer);if(this.settings.pollAsync)for(var b in this.transport)this.transport[b].abort();else this.transport.abort();this.transport=null;this.state="closed";this.eventsManager.fireEvent("onStop",this)}};q.prototype.setPoolData=function(b){this.pollData=b};return{transport:q,active:!0,stage:{poll:function(b,d){b=new q(b,d);b.eventsManager.settingsToListen(d);
b.error?b.eventsManager.fireEvent("onError",b,null,b.error):b.start();return b}}}});stage.provide("io.transport.inSocket.longPoll");stage.provide("longPoll");stage.require("io");stage.require("ajax");stage.require("script");stage.require("iframe");stage.require("jsonp");stage.require("poll");
stage.register.call(stage.io.transport.inSocket,"longPoll",function(b,d){var u=function(b,d,g){d=d?d:{};d.delay=10;d.pollAsync=!1;b=new stage.io.transport.inSocket.poll.transport(b,d,g);b.name="longPoll";return b};return{transport:u,active:!0,stage:{longPoll:function(b,d){b=u(b,d);b.eventsManager.settingsToListen(d);b.error?b.eventsManager.fireEvent("onError",b,null,b.error):b.start();return b}}}});stage.provide("io.transport.inSocket.streaming");stage.provide("streaming");stage.require("io");stage.require("ajax");
stage.require("script");stage.require("iframe");stage.require("jsonp");
stage.register.call(stage.io.transport.inSocket,"streaming",function(b,d){var u={globalEvents:!1};b=2==stage.io.transport.outSocket.ajax.xhrLevel&&stage.browser.Gecko;var k=function(){if(!this.toDisconnect){this.response=this.transport=null;this.offset=0;this.transport||(this.settings.forceJSONP||1==stage.io.transport.outSocket.ajax.xhrLevel&&this.crossDomain?(this.settings.forceStreaming=!0,this.transportWrapper=stage.io.transport.outSocket.jsonp.transport):this.transportWrapper=stage.io.transport.outSocket.ajax.transport);
try{this.transport=new this.transportWrapper(this.url,this.settings),this.transport.listen(this,"onLoadStart",q),this.transport.listen(this,"onLoad",k),this.transport.listen(this,"onProgress",g),this.transport.listen(this,"onError",t),this.transport.error?(this.eventsManager.fireEvent("onError",this,this.transport.error),this.eventsManager.fireEvent("onStop",this)):this.transport.send()}catch(f){this.eventsManager.fireEvent("onError",this,f)}}},l=/\s*4\d{2}[^\d]/,g=function(b){l.test(b.response)?
(this.error=Error(b.response),this.eventsManager.fireEvent("onError",this,this.error),stage.console.error(this.error),this.stop()):(this.response=this.settings.forceJSONP||1==stage.io.transport.outSocket.ajax.xhrLevel&&this.crossDomain?b.response:0!=this.offset?b.response.substr(this.offset,b.response.length):b.response,this.offset=b.response.length,this.eventsManager.fireEvent("onMessage",this.response))},q=function(b){this.eventsManager.fireEvent("onOpen",this)},t=function(b,d,g){this.eventsManager.fireEvent("onError",
this,g)},r=stage.herite(function(b,d,g){this.$super.constructor("streaming",b,u,d);this.streamDirection="IN";this.toDisconnect=!1;this.offset=0;this.transportWrapper=this.response=null;this.transport=g||null},stage.io.transport.transportCore);r.prototype.start=function(b,d){stage.extend(!0,this.settings,b);d&&(this.poolData=d);this.toDisconnect=!1;if(this.crossDomain&&1==stage.io.transport.outSocket.ajax.xhrLevel)return this.error=Error("This browser can't create streaming request on crossDomain"),
stage.console.error(this.error),this;this.eventsManager.fireEvent("onStart",this);k.call(this)};r.prototype.stop=function(){this.toDisconnect=!0;this.response=null;this.offset=0;this.transport&&this.transport.abort();this.transport=null;this.eventsManager.fireEvent("onStop",this)};return{transport:r,active:stage.browser.Gecko,crossDomainActive:b,stage:{streaming:function(b,d){b=new r(b,d);b.eventsManager.settingsToListen(d);b.error?b.eventsManager.fireEvent("onError",b,null,b.error):b.start();return b}}}});
stage.provide("io.transport.ioSocket.webSocket");stage.provide("webSocket");stage.require("io");
stage.register.call(stage.io.transport.ioSocket,"webSocket",function(b,d){var u={protocol:null,onStart:null,onStop:null,onMessage:null};b=function(){try{var b=window.WebSocket}catch(q){b=!1}return b?!0:!1}();var k=function(b){this.response=b.data;this.eventsManager.fireEvent("onMessage",this.response)},l=stage.herite(function(b,d,t){this.$super.constructor("webSocket",b,u,d);this.streamDirection="IO"},stage.io.transport.transportCore);l.prototype.start=function(b){stage.extend(!0,this.settings,b);
try{this.transport=new WebSocket(this.url,this.settings.protocol?this.settings.protocol:null)}catch(q){throw Error("webSocket Create socket : "+q);}this.transport.onopen=this.eventsManager.listen(this,"onStart",this.settings.onStart);this.transport.onmessage=stage.setContext(k,this);this.transport.onclose=this.eventsManager.listen(this,"onStop",this.settings.onStop);this.transport.onerror=this.eventsManager.listen(this,"onError",this.settings.onError)};l.prototype.send=function(b){if(1==this.transport.readyState)return this.eventsManager.fireEvent("onSend",
b),this.transport.send(b);throw Error("webSocket is not ready to send data, readyState = "+this.transport.readyState);};l.prototype.stop=function(){this.transport.close();this.transport.onopen=null;this.transport.onmessage=null;this.transport.onclose=null;this.transport.onerror=null;delete this.transport};return{transport:l,active:b,stage:{webSocket:function(b,d){b=new l(b,d);b.start();return b}}}});stage.provide("io.transport.ioSocket.socket");stage.provide("socket");stage.require("io");stage.require("structs.queues");
stage.register.call(stage.io.transport.ioSocket,"socket",function(b,d){var u={activFIFO:!0},k=function(b){this.response=b;this.eventsManager.fireEvent("onMessage",this.response)},l=function(b){this.error=b;this.eventsManager.fireEvent("onError",this,this.error)},g=function(){this.eventsManager.fireEvent("onPrepareData")},q=function(b){this.stop();stage.setContext(l,this)(b)},t=function(b){this.outTransportQueue.dequeue();r.call(this)},r=function(){if(!this.outTransportQueue.isEmpty()){var b=this.outTransportQueue.data[0];
this.outTransport.send(b);this.eventsManager.fireEvent("onSend",b)}},f=stage.herite(function(b,f,d){this.$super.constructor("socket",b,u,f);this.streamDirection="IO";this.outTransportQueue=stage.structs.createQueue();this.state="stoped";this.outTransport=new stage.io.transport.transport.outTransport(b,this.settings);this.outTransport.listen(this,"onLoad",k);this.settings.activFIFO&&this.outTransport.listen(this,"onLoadEnd",t);this.inTransport=new stage.io.transport.transport.inTransport(b,this.settings);
this.inTransport.listen(this,"onMessage",k);this.inTransport.listen(this,"onPrepareData",g);this.inTransport.listen(this,"onError",q)},stage.io.transport.transportCore);f.prototype.start=function(b){this.inTransport.start(b);this.state="started";this.eventsManager.fireEvent("onStart",this)};f.prototype.send=function(b){if(this.outTransport){if(this.settings.activFIFO)return this.outTransportQueue.enqueue(b),1==this.outTransportQueue.count()&&r.call(this),!0;this.outTransport.send(b);this.eventsManager.fireEvent("onSend",
b)}else throw Error("No wrapper socket to send data");};f.prototype.stop=function(){this.outTransportQueue.purge();"started"==this.state&&(this.inTransport.stop(),this.outTransport&&this.outTransport.abort(),this.state="stoped",this.eventsManager.fireEvent("onStop",this))};f.prototype.setPoolData=function(b){this.inTransport.setPoolData(b)};return{transport:f,active:!0,stage:{socket:function(b,d){b=new f(b,d);b.eventsManager.settingsToListen(d);b.start();return b}}}});stage.provide("io.transport.transport");
stage.provide("transport");stage.require("io");
stage.register.call(stage.io.transport,"transport",function(b,d){var u={},k={};b=function(b,e,f,h){b=new h(b,f);b.eventsManager.settingsToListen(f);if(b.error)return b.eventsManager.fireEvent("onError",b,null,b.error),b;b.send(e||null);return b};var l={AJAX:{active:stage.io.transport.outSocket.ajax.active,dual:!1,realTime:!1,crossDomain:2==stage.io.transport.outSocket.ajax.xhrLevel,transport:stage.io.transport.outSocket.ajax.transport,createMethod:b},JSONP:{active:stage.io.transport.outSocket.jsonp.active,
dual:!1,realTime:!1,crossDomain:!0,transport:stage.io.transport.outSocket.jsonp.transport,createMethod:b},SCRIPT:{active:stage.io.transport.outSocket.script.active,dual:!1,realTime:!1,crossDomain:!0,transport:stage.io.transport.outSocket.script.transport,createMethod:b},IFRAME:{active:stage.io.transport.outSocket.iframe.active,dual:!1,realTime:!1,crossDomain:!0,transport:stage.io.transport.outSocket.iframe.transport,createMethod:b}},g=stage.herite(function(b,e){this.$super.constructor("transport",
b,k,e);this.streamDirection="OUT";this.transport=null;try{var f=this.settings.typeOutTransport?this.settings.typeOutTransport.toUpperCase():null;if(f&&l[f])this.outTransportType=f;else{a:{var h=!stage.io.url.isSameOrigin(this.url),d;for(d in l)if(l[d].active&&(!h||l[d].crossDomain)){var p=d;break a}p=void 0}this.outTransportType=p}}catch(J){throw Error("outTransport Create transport : "+J);}},stage.io.transport.transportCore);g.prototype.send=function(b){if(this.outTransportType){var e=!1,d=stage.extend(!0,
{},this.settings);d.onLoadStart=stage.setContext(function(){e=!0},this);d.onLoad=stage.setContext(function(b){b.response&&this.eventsManager.fireEvent("onLoad",b.response)},this);d.onLoadEnd=stage.setContext(function(){this.eventsManager.fireEvent("onLoadEnd",E);this.transport=null},this);d.onError=stage.setContext(function(b,d,m){e=!1;stage.setContext(f,this)(m)},this);this.transport=l[this.outTransportType].createMethod(this.url,b,d,l[this.outTransportType].transport);this.eventsManager.fireEvent("onSend",
b);return e}throw Error("No wrapper socket to send data");};g.prototype.abort=function(){this.transport&&this.transport.abort();this.eventsManager.fireEvent("onStop",this)};b=function(b,e,f,h){return new h(b,f)};var q=function(b,e,f){var h=!stage.io.url.isSameOrigin(b),d;for(d in t)if(t[d].active&&(!h||t[d].crossDomain))return f=stage.extend(!0,{},{headers:t[d].XHeaders},f),t[d].createMethod(b,e,f,t[d].transport)},t={SSE:{active:!1,dual:!1,realTime:!1,crossDomain:!1,transport:null,createMethod:b,
XHeaders:{"X-Stage-socket":"sse"}},POLL:{active:stage.io.transport.inSocket.poll.active,dual:!1,realTime:!0,crossDomain:!0,transport:stage.io.transport.inSocket.poll.transport,createMethod:b,XHeaders:{"X-Stage-socket":"poll"}},LONGPOLL:{active:stage.io.transport.inSocket.longPoll.active,dual:!1,realTime:!0,crossDomain:!0,transport:stage.io.transport.inSocket.longPoll.transport,createMethod:b,XHeaders:{"X-Stage-socket":"longPoll"}},STREAMING:{active:stage.io.transport.inSocket.streaming.active,dual:!1,
realTime:!0,crossDomain:stage.io.transport.inSocket.streaming.crossDomainActive,transport:stage.io.transport.inSocket.streaming.transport,createMethod:b,XHeaders:{"X-Stage-socket":"streaming"}}},r=function(b){this.response=b;this.eventsManager.fireEvent("onMessage",this.response)},f=function(b){this.error=b;this.eventsManager.fireEvent("onError",this,this.error)},n=function(){this.eventsManager.fireEvent("onPrepareData")},B=function(b){this.stop();stage.setContext(f,this)(b)},w=stage.herite(function(b,
e,f){this.$super.constructor("intTransport",b,u,e);this.streamDirection="IN";this.state="stoped";try{var h=this.settings.typeInTransport?this.settings.typeInTransport.toUpperCase():null;h&&t[h]?this.crossDomain&&!t[h].crossDomain?(this.transport=q(this.url,null,this.settings),stage.DEBUG&&stage.console.warning("The inTransport "+h+" can't fire crossDomain request, automatic switch")):(stage.extend(!0,this.settings,{headers:t[h].XHeaders}),this.transport=t[h].createMethod(this.url,null,this.settings,
t[h].transport)):this.transport=q(this.url,null,this.settings);this.transport.listen(this,"onMessage",r);this.transport.listen(this,"onPrepareData",n);this.transport.listen(this,"onError",B)}catch(v){throw Error("inTransport Create transport : "+v);}},stage.io.transport.transportCore);w.prototype.start=function(){"started"!=this.state&&(this.transport.start(),this.state="started",this.eventsManager.fireEvent("onStart",this))};w.prototype.stop=function(){"started"==this.state&&(this.transport.stop(),
this.state="stoped",this.eventsManager.fireEvent("onStop",this))};w.prototype.setPoolData=function(b){this.transport.setPoolData(b)};var D={autoStart:!0},A=function(b){this.eventsManager.fireEvent("onMessage",b.response)},H=function(b,e){b.listen(b,"onLoad",A);e.autoStart&&b.eventsManager.settingsToListen(e);b.error?b.eventsManager.fireEvent("onError",b,null,b.error):(b.stop=b.abort,b.start=b.send,e.autoStart&&b.send(e.data))},e=function(b,e){e.autoStart&&b.eventsManager.settingsToListen(e);b.error?
b.eventsManager.fireEvent("onError",b,null,b.error):e.autoStart&&b.start(e)},E=function(b,f){f=stage.extend(!0,{},D,f);switch(f.transportType){case "OUT":return b=new g(b,f.transportSettings),H(b,f),b;case "IN":return b=new w(b,f.transportSettings),e(b,f),b;case "IO":return b=new stage.io.transport.ioSocket.socket.transport(b,f.transportSettings),e(b,f),b;case "SOCKET":return b=new stage.io.transport.ioSocket.socket.transport(b,f.transportSettings),e(b,f),b;case "WEBSOCKET":return b=new stage.io.transport.ioSocket.webSocket.transport(b,
f.transportSettings),e(b,f),b;case "POLL":return b=new stage.io.transport.inSocket.poll.transport(b,f.transportSettings),e(b,f),b;case "LONGPOLL":return b=new stage.io.transport.inSocket.longPoll.transport(b,f.transportSettings),e(b,f),b;case "IFRAME":return b=new stage.io.transport.outSocket.iframe.transport(b,f.transportSettings),H(b,f),b;case "SCRIPT":return b=new stage.io.transport.outSocket.script.transport(b,f.transportSettings),H(b,f),b;case "JSONP":return b=new stage.io.transport.outSocket.jsonp.transport(b,
f.transportSettings),H(b,f),b;default:return b=new stage.io.transport.outSocket.ajax.transport(b,f.transportSettings),H(b,f),b}};return{outTransport:g,inTransport:w,active:!0,transport:E,stage:{transport:function(b,e){return new E(b,e)}}}});stage.provide("crypto");
stage.register("crypto",function(){var b=function(){var b="-_0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),u=" !#$%&()*+,./:;<=>?@[\\]^{|}~".split("").concat(b);return function(d,l){var g="";d/=8;switch(l){case "hexa":for(var k=0;k<d;k++)l=u[Math.floor(Math.random()*u.length)],g+=l.charCodeAt(0).toString(16);break;case "alphanum":for(k=0;k<d;k++)g+=b[Math.floor(Math.random()*b.length)];break;default:for(k=0;k<d;k++)g+=u[Math.floor(Math.random()*u.length)]}return g}}();
return{generateAscciKey:function(d){return b(d,"ascci")},generateHexaKey:function(d){return b(d,"hexa")},generateAlphanumKey:function(d){return b(d,"alphanum")}}});stage.provide("md5");stage.require("crypto");
stage.register.call(stage.crypto,"md5",function(){var b=function(b){return t(r(q(b),8*b.length))},d=function(b,f){var e=q(b);16<e.length&&(e=r(e,8*b.length));var d=Array(16);b=Array(16);for(var n=0;16>n;n++)d[n]=e[n]^909522486,b[n]=e[n]^1549556828;f=r(d.concat(q(f)),512+8*f.length);return t(r(b.concat(f),640))},u=function(b){for(var f="",e,d=0;d<b.length;d++)e=b.charCodeAt(d),f+="0123456789abcdef".charAt(e>>>4&15)+"0123456789abcdef".charAt(e&15);return f},k=function(b){for(var f="",e=b.length,d=0;d<
e;d+=3)for(var n=b.charCodeAt(d)<<16|(d+1<e?b.charCodeAt(d+1)<<8:0)|(d+2<e?b.charCodeAt(d+2):0),p=0;4>p;p++)f=8*d+6*p>8*b.length?f+"":f+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(n>>>6*(3-p)&63);return f},l=function(b,f){var e=f.length,d,n,p,m=Array(Math.ceil(b.length/2));for(d=0;d<m.length;d++)m[d]=b.charCodeAt(2*d)<<8|b.charCodeAt(2*d+1);var h=Math.ceil(8*b.length/(Math.log(f.length)/Math.log(2)));b=Array(h);for(n=0;n<h;n++){var v=[];for(d=p=0;d<m.length;d++){p=(p<<
16)+m[d];var g=Math.floor(p/e);p-=g*e;if(0<v.length||0<g)v[v.length]=g}b[n]=p;m=v}e="";for(d=b.length-1;0<=d;d--)e+=f.charAt(b[d]);return e},g=function(b){for(var f="",e=-1,d,n;++e<b.length;)d=b.charCodeAt(e),n=e+1<b.length?b.charCodeAt(e+1):0,55296<=d&&56319>=d&&56320<=n&&57343>=n&&(d=65536+((d&1023)<<10)+(n&1023),e++),127>=d?f+=String.fromCharCode(d):2047>=d?f+=String.fromCharCode(192|d>>>6&31,128|d&63):65535>=d?f+=String.fromCharCode(224|d>>>12&15,128|d>>>6&63,128|d&63):2097151>=d&&(f+=String.fromCharCode(240|
d>>>18&7,128|d>>>12&63,128|d>>>6&63,128|d&63));return f},q=function(b){for(var f=Array(b.length>>2),e=0;e<f.length;e++)f[e]=0;for(e=0;e<8*b.length;e+=8)f[e>>5]|=(b.charCodeAt(e/8)&255)<<e%32;return f},t=function(b){for(var f="",e=0;e<32*b.length;e+=8)f+=String.fromCharCode(b[e>>5]>>>e%32&255);return f},r=function(b,d){b[d>>5]|=128<<d%32;b[(d+64>>>9<<4)+14]=d;d=1732584193;for(var e=-271733879,g=-1732584194,t=271733878,p=0;p<b.length;p+=16){var m=d,h=e,v=g,I=t;d=n(d,e,g,t,b[p+0],7,-680876936);t=n(t,
d,e,g,b[p+1],12,-389564586);g=n(g,t,d,e,b[p+2],17,606105819);e=n(e,g,t,d,b[p+3],22,-1044525330);d=n(d,e,g,t,b[p+4],7,-176418897);t=n(t,d,e,g,b[p+5],12,1200080426);g=n(g,t,d,e,b[p+6],17,-1473231341);e=n(e,g,t,d,b[p+7],22,-45705983);d=n(d,e,g,t,b[p+8],7,1770035416);t=n(t,d,e,g,b[p+9],12,-1958414417);g=n(g,t,d,e,b[p+10],17,-42063);e=n(e,g,t,d,b[p+11],22,-1990404162);d=n(d,e,g,t,b[p+12],7,1804603682);t=n(t,d,e,g,b[p+13],12,-40341101);g=n(g,t,d,e,b[p+14],17,-1502002290);e=n(e,g,t,d,b[p+15],22,1236535329);
d=B(d,e,g,t,b[p+1],5,-165796510);t=B(t,d,e,g,b[p+6],9,-1069501632);g=B(g,t,d,e,b[p+11],14,643717713);e=B(e,g,t,d,b[p+0],20,-373897302);d=B(d,e,g,t,b[p+5],5,-701558691);t=B(t,d,e,g,b[p+10],9,38016083);g=B(g,t,d,e,b[p+15],14,-660478335);e=B(e,g,t,d,b[p+4],20,-405537848);d=B(d,e,g,t,b[p+9],5,568446438);t=B(t,d,e,g,b[p+14],9,-1019803690);g=B(g,t,d,e,b[p+3],14,-187363961);e=B(e,g,t,d,b[p+8],20,1163531501);d=B(d,e,g,t,b[p+13],5,-1444681467);t=B(t,d,e,g,b[p+2],9,-51403784);g=B(g,t,d,e,b[p+7],14,1735328473);
e=B(e,g,t,d,b[p+12],20,-1926607734);d=f(e^g^t,d,e,b[p+5],4,-378558);t=f(d^e^g,t,d,b[p+8],11,-2022574463);g=f(t^d^e,g,t,b[p+11],16,1839030562);e=f(g^t^d,e,g,b[p+14],23,-35309556);d=f(e^g^t,d,e,b[p+1],4,-1530992060);t=f(d^e^g,t,d,b[p+4],11,1272893353);g=f(t^d^e,g,t,b[p+7],16,-155497632);e=f(g^t^d,e,g,b[p+10],23,-1094730640);d=f(e^g^t,d,e,b[p+13],4,681279174);t=f(d^e^g,t,d,b[p+0],11,-358537222);g=f(t^d^e,g,t,b[p+3],16,-722521979);e=f(g^t^d,e,g,b[p+6],23,76029189);d=f(e^g^t,d,e,b[p+9],4,-640364487);t=
f(d^e^g,t,d,b[p+12],11,-421815835);g=f(t^d^e,g,t,b[p+15],16,530742520);e=f(g^t^d,e,g,b[p+2],23,-995338651);d=w(d,e,g,t,b[p+0],6,-198630844);t=w(t,d,e,g,b[p+7],10,1126891415);g=w(g,t,d,e,b[p+14],15,-1416354905);e=w(e,g,t,d,b[p+5],21,-57434055);d=w(d,e,g,t,b[p+12],6,1700485571);t=w(t,d,e,g,b[p+3],10,-1894986606);g=w(g,t,d,e,b[p+10],15,-1051523);e=w(e,g,t,d,b[p+1],21,-2054922799);d=w(d,e,g,t,b[p+8],6,1873313359);t=w(t,d,e,g,b[p+15],10,-30611744);g=w(g,t,d,e,b[p+6],15,-1560198380);e=w(e,g,t,d,b[p+13],
21,1309151649);d=w(d,e,g,t,b[p+4],6,-145523070);t=w(t,d,e,g,b[p+11],10,-1120210379);g=w(g,t,d,e,b[p+2],15,718787259);e=w(e,g,t,d,b[p+9],21,-343485551);d=D(d,m);e=D(e,h);g=D(g,v);t=D(t,I)}return[d,e,g,t]},f=function(b,f,e,d,g,p){b=D(D(f,b),D(d,p));return D(b<<g|b>>>32-g,e)},n=function(b,d,e,g,n,p,m){return f(d&e|~d&g,b,d,n,p,m)},B=function(b,d,e,g,n,p,m){return f(d&g|e&~g,b,d,n,p,m)},w=function(b,d,e,g,n,p,m){return f(e^(d|~g),b,d,n,p,m)},D=function(b,f){var e=(b&65535)+(f&65535);return(b>>16)+(f>>
16)+(e>>16)<<16|e&65535};return{hex_md5:function(f){return u(b(g(f)))},hex_md5_noUTF8:function(f){return u(b(f))},str_md5:function(f){return b(g(f))},b64_md5:function(f){return k(b(g(f)))},any_md5:function(f,d){return l(b(g(f)),d)},hex_hmac_md5:function(b,f){return u(d(g(b),g(f)))},str_hmac_md5:function(b,f){return d(g(b),g(f))},b64_hmac_md5:function(b,f){return k(d(g(b),g(f)))},any_hmac_md5:function(b,f,e){return l(d(g(b),g(f)),e)}}});stage.provide("base64");stage.require("crypto");
stage.register.call(stage.crypto,"base64",function(){return{decodeArrayBuffer:function(b){var d=new ArrayBuffer(b.length/4*3),u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(b.charAt(b.length-1)),k="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(b.charAt(b.length-2)),l=b.length/4*3;64==u&&l--;64==k&&l--;var g,q=0;u=d?new Uint8Array(d):new Uint8Array(l);b=b.replace(/[^A-Za-z0-9\+\/=]/g,"");for(g=0;g<l;g+=3){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(b.charAt(q++));
var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(b.charAt(q++));k="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(b.charAt(q++));var f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(b.charAt(q++));t=t<<2|r>>4;r=(r&15)<<4|k>>2;var n=(k&3)<<6|f;u[g]=t;64!=k&&(u[g+1]=r);64!=f&&(u[g+2]=n)}return d},encode:function(b){var d="",u,k=0;b=b.replace(/\r\n/g,"\n");var l="";for(u=0;u<b.length;u++){var g=b.charCodeAt(u);
128>g?l+=String.fromCharCode(g):(127<g&&2048>g?l+=String.fromCharCode(g>>6|192):(l+=String.fromCharCode(g>>12|224),l+=String.fromCharCode(g>>6&63|128)),l+=String.fromCharCode(g&63|128))}for(b=l;k<b.length;){var q=b.charCodeAt(k++);l=b.charCodeAt(k++);u=b.charCodeAt(k++);g=q>>2;q=(q&3)<<4|l>>4;var t=(l&15)<<2|u>>6;var r=u&63;isNaN(l)?t=r=64:isNaN(u)&&(r=64);d=d+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(g)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(q)+
"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(t)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(r)}return d},decode:function(b){var d="",u=0;for(b=b.replace(/[^A-Za-z0-9\+\/=]/g,"");u<b.length;){var k="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(b.charAt(u++));var l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(b.charAt(u++));var g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(b.charAt(u++));
var q="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(b.charAt(u++));k=k<<2|l>>4;l=(l&15)<<4|g>>2;var t=(g&3)<<6|q;d+=String.fromCharCode(k);64!=g&&(d+=String.fromCharCode(l));64!=q&&(d+=String.fromCharCode(t))}if(u!=b.length)throw Error("BASE64_BROKEN : There were invalid base64 characters in the input text.\nValid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='\nExpect errors in decoding.");b=d;d="";for(g=0;g<b.length;)q=b.charCodeAt(g),128>q?(d+=String.fromCharCode(q),
g++):191<q&&224>q?(u=b.charCodeAt(g+1),d+=String.fromCharCode((q&31)<<6|u&63),g+=2):(u=b.charCodeAt(g+1),k=b.charCodeAt(g+2),d+=String.fromCharCode((q&15)<<12|(u&63)<<6|k&63),g+=3);return d}}});stage.provide("ui");
stage.register("ui",function(){var b=function(b,d){var g=$$stage(b);if(this.pluginName||0!==g.length){var t=g.data("ui");t?stage.array.contain(t.plugin,this.pluginName)||t.plugin.push({name:this.pluginName,context:this}):g.data("ui",{plugin:[{name:this.pluginName,context:this}]})}this.$super.constructor.apply(this.$super,arguments)},d=function(k,g){if(!k||"string"!==typeof k)throw Error("REGISTER PLUGIN  : name is undefined or bad format argument");if(!g||"function"!==typeof g)throw Error("REGISTER PLUGIN  : plugin closure is undefined or bad format argument ");
this.name=k;g=g();if("object"!==stage.typeOf(g))throw Error("REGISTER PLUGIN  : plugin closure must return object ");if(g.plugin){if(g.herite){if(g.herite instanceof d)var q=g.herite.plugin,t=g.herite.globalSettings;else q=g.herite,t=g.herite.prototype.globalSettings;var r=stage.herite(g.plugin,q);this.globalSettings=t?stage.extend(!0,{},t,g.globalSettings?g.globalSettings:null):g.globalSettings?g.globalSettings:null}else r=g.plugin,this.globalSettings=g.globalSettings?g.globalSettings:null;r.prototype.globalSettings=
this.globalSettings;r.prototype.extendSettings=function(b){return this.globalSettings?stage.extend(!0,{},this.globalSettings,b):b};stage.ui[k]=function(b,f){b="object"===stage.typeOf(b)?new r(null,b):new r(b,f);b.build&&b.settings.build&&b.build();return b};this.plugin=r;var f=stage.herite(b,r);f.prototype.pluginName=k;stage.stageSelector.prototype[this.name]=function(b){var d=b,g=arguments;if(this.selector.length)for(var n=0;n<this.selector.length;n++){var t=null,r=stage.storage.$$stage.data.call(this.selector[n],
"ui");if(r&&r.plugin)for(var e=0;e<r.plugin.length;e++)r.plugin[e].name===k&&(t=r.plugin[e].context);if(t)switch(stage.typeOf(g[0])){case "function":r=Array.prototype.slice.call(g,1);g[0].apply(t,r);break;case "string":r=Array.prototype.slice.call(g,1);if(t[g[0]])t[g[0]].apply(t,r);else throw Error("FUNCTION "+g[0]+" not defined in "+k+" PLUGIN");break;default:throw Error("ELEMENT ALREADY PLUG TO "+k+" PLUGIN");}else t=new f(this.selector[n],d),t.build&&t.settings.build&&t.build()}return this}}else throw Error("PLUGIN CLASS IS NOT DEFINED :  "+
this.name+" PLUGIN ");this.orverride=!1};d.prototype.overrideSettings=function(b){this.globalSettings=stage.extend(!0,this.globalSettings,b);this.orverride=!0};var u=stage.herite(function(b,d){this.container=d||window.document.body;b&&this.logger(b)},stage.stagelog),k=function(b){var d="";switch(b.typePayload){case "object":b.msgid&&(d+=b.msgid+": ");b.msg&&(d+=b.msg);break;default:d=b.payload}return d};u.prototype.error=function(b){var d="<div>"+k(b)+"</div>",q=stage.ui.panel({header:{title:b.severityName+
"&nbsp&nbsp&nbsp&nbsp<bold>"+b.getDate()+"</bold>",icon:"stageui-icon-alert"},draggable:!0,framed:!0,focusable:!0,autofocus:!0,effect:"spring",shadow:!0,width:300,height:100,appendTo:this.container,html:d,display:{position:"center"}});setTimeout(function(){$$stage(q.container).fade(5,null,{onFinish:function(){q.close()}})},5E3);return q};u.prototype.notice=function(b){var d="<div>"+k(b)+"</div>";return stage.ui.panel({header:{title:b.severityName+"&nbsp&nbsp&nbsp&nbsp<bold>"+b.getDate()+"</bold>",
icon:"stageui-icon-notice"},closable:!0,draggable:!0,framed:!0,focusable:!0,autofocus:!0,shadow:!0,width:300,height:100,appendTo:this.container,html:d,display:{position:"centerFixed"}})};u.prototype.info=function(b){var d=stage.position.viewport(window.document.body),q="<div>"+k(b)+"</div>",t=stage.ui.panel({header:{title:b.severityName+"&nbsp&nbsp&nbsp&nbsp<bold>"+b.getDate()+"</bold>",icon:"stageui-icon-info"},draggable:!1,framed:!0,focusable:!0,autofocus:!0,width:300,height:70,appendTo:this.container,
html:q,display:{position:"absolute",left:d.width,top:50}}),r=$$stage(window.document.body).css("overflow-x");$$stage(window.document.body).css("overflow-x","hidden");$$stage(t.container).morph({left:-283},{duration:1,mode:"relative",onFinish:function(b){setTimeout(function(){$$stage(t.container).morph({left:300},{duration:4,mode:"relative",onFinish:function(){t.close();$$stage(window.document.body).css("overflow-x",r)}})},5E3)}});return t};return{plugins:{},stageUILog:u,log:function(b,d){return(new u(null,
d)).notice(new stage.PDU(b,7))},error:function(b,d){return(new u(null,d)).error(new stage.PDU(b,3))},info:function(b,d){return(new u(null,d)).info(new stage.PDU(b,6))},warning:function(b,d){return(new u(null,d)).warning(new stage.PDU(b,4))},isRegistered:function(b){return this[b]?this[b]:!1},registerPlugin:function(b,g){if(b in this.plugins)throw Error("PLUGIN NAME ALREADY register :  "+b+" PLUGIN ");if(!b||"string"!==typeof b)throw Error("REGISTER PLUGIN : name is undefined or bad format argument");
if(!g||"function"!==typeof g)throw Error("REGISTER PLUGIN : closure is udefined or bad format argument ");this.plugins[b]=new d(b,g);return this.plugins[b]},_onRegister:function(){stage.stageSelector.prototype.instanceofUi=function(b){var d=[],k=this.data("ui");if("array"===stage.typeOf(k))for(var t=0;t<k.length;t++){if(k[t].plugin)for(var r in k[t].plugin)k[t].plugin[r].name===b&&d.push(this.selector[t])}else if(k.plugin)for(r in k.plugin)k.plugin[r].name===b&&d.push(this.selector[0]);b=new stage.stageSelector(this.context,
d);b.prevSelector=this.selector;return b};stage.stageSelector.prototype.notInstanceofUi=function(b){var d=[],k=this.data("ui");if(!k)return this;if("array"===stage.typeOf(k))for(var t=0;t<k.length;t++)if(k[t].plugin)for(var r in k[t].plugin)k[t].plugin[r].name!==b&&d.push(this.selector[t]);else d.push(this.selector[t]);else if(k.plugin)for(r in k.plugin)k.plugin[r].name!==b&&d.push(this.selector[0]);else d.push(this.selector[0]);b=new stage.stageSelector(this.context,d);b.prevSelector=this.selector;
return b}}}});stage.provide("ui.i18n");stage.require("ajax");
stage.register.call(stage.ui,"i18n",function(){var b=document.location,d=function(d,g,k){this.country=this.lang="";this.variant=null;this.lang=d.toLowerCase();this.country=g?g.toLowerCase():this.lang.toLowerCase();this.variant=k?k.toLowerCase():null;this.path=b.protocol+"//"+b.host};d.prototype.getLocaleString=function(b){return this.lang+"-"+this.country};d.prototype.getLocaleUrl=function(b,d){b||(b=this.path);d=d||"locales.json";return this.variant?b+"/locales/"+this.getLocaleString()+"_"+this.variant+
"/"+d:b+"/locales/"+this.getLocaleString()+"/"+d};var u=navigator.browserLanguage?navigator.browserLanguage:navigator.language,k=function(b,g,k){switch(arguments.length){case 0:b=u;var f=/(\w{2})-(\w{2})/.exec(b);return f?new d(f[1],f[2],null):(f=/(\w{2})/.exec(b))?new d(f[1],f[1],null):!1;case 1:return(f=/(\w{2})-(\w{2})/.exec(b))?new d(f[1],f[2],null):(f=/(\w{2})/.exec(b))?new d(f[1],f[1],null):!1;case 2:return new d(b,g,null);case 3:return new d(b,g,k);default:return!1}},l=k(),g=function(b,d){this.eventsManager=
stage.createEventsManager();this.eventsManager.settingsToListen(d);this.langs={};this.localBrowser=l;this.defaultLang=null;b.localesPath&&(this.path=b.localesPath);b.fileName&&(this.fileName=b.fileName);this.locale=b.locale?k(b.locale):l;b.translate?(this.setLang(this.locale.getLocaleString(),b.translate),this.defaultLang=this.locale.getLocaleString()):this.loadLang(this.localBrowser.getLocaleString());this.locale.getLocaleString();this.localBrowser.getLocaleString()};g.prototype.listen=function(b,
d,g){return this.eventsManager.listen(b,d,g)};g.prototype.setLang=function(b,d){this.langs[b]=b in this.langs?d:stage.extend(!0,{},this.getLang(b),d)};g.prototype.loadLang=function(b){var g=b instanceof d?b:k(b);b=g.getLocaleUrl(this.path,this.fileName);var r=g.getLocaleString();stage.ajax.get(b,null,{responseType:"json",onLoad:stage.setContext(function(b){try{var f="string"===typeof b.response?stage.json.parse(b.response):b.response;this.defaultLang?f=stage.extend(!0,{},this.langs[this.defaultLang],
f):this.defaultLang=r;f&&(this.setLang(r,f),this.locale=g,this.eventsManager.fireEvent("onLoadLang",this,b))}catch(B){this.setLang(r,{})}},this),onError:stage.setContext(function(b,d,g){},this)})};g.prototype.getLang=function(b){return b in this.langs?this.langs[b]:null};g.prototype.classTranslate=function(){var b=this;return function(){this.translate=b.langs[b.locale.getLocaleString()];this.locale=b.locale;this.eventsManager=stage.createEventsManager()}};return{browserLang:u,locale:null,local:{locale:l,
createI18nManager:function(b,d){return new g(b,d)}},getBrowserLang:function(){return navigator.browserLanguage?navigator.browserLanguage:navigator.language},getLang:function(){return this.locale.lang}}});stage.provide("ui.color");stage.require("dom");stage.require("string");
stage.register.call(stage.ui,"color",function(){var b={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueViolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",
darkgray:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",
gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",
lightslategray:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370D8",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",
oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#D87093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",
skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"},d=function(b,d){var g=4===d.length?4:8,t=(1<<g)-1;d=Number("0x"+d.substr(1));if(isNaN(d))return null;stage.each(["blue","green","red"],stage.setContext(function(b){var f=d&t;d>>=g;this[b]=4==g?
17*f:f},b));b.alpha=1;return b},u=function(b,d){3===d.length?(b.red=parseFloat(d[0]),b.green=parseFloat(d[1]),b.blue=parseFloat(d[2])):4===d.length&&(b.red=parseFloat(d[0]),b.green=parseFloat(d[1]),b.blue=parseFloat(d[2]),b.alpha=parseFloat(d[3]))},k=function(b){b&&this.setColor(b)};k.prototype.setColor=function(k){switch(stage.typeOf(k)){case "array":u(this,k);break;case "object":this.red=k.red;this.green=k.green;this.blue=k.blue;this.alpha=k.alpha;break;case "string":var g=k.toLowerCase();b[g]&&
(k=b[g]);d(this,k)||(k=k.toLowerCase().match(/^rgba?\(([\s\.,0-9]+)\)/),u(this,k[1].split(/\s*,\s*/)))}};k.prototype.toString=function(b){return b?"rgba("+this.red+", "+this.green+", "+this.blue+", "+this.alpha+")":"rgb("+this.red+", "+this.green+", "+this.blue+")"};k.prototype.toRgb=function(){return[this.red,this.green,this.blue]};k.prototype.toRgba=function(){return[this.red,this.green,this.blue,this.alpha]};k.prototype.toHex=function(){var b="#";stage.each(["red","green","blue"],stage.setContext(function(d){d=
this[d].toString(16);b+=2>d.length?"0"+d:d},this));return b};k.prototype.blendColors=function(b,d){var g="rgb(";stage.each(["red","green","blue"],stage.setContext(function(t,k){t=this[t]+(b[t]-this[t])*d;g=2!=k?g+(Math.round(t)+","):g+(Math.round(t)+")")},this));return g};return k});stage.provide("ui.date");stage.require("ui.i18n");
stage.register.call(stage.ui,"date",function(){var b={type:"json",locale:"en-en",localesPath:"/src/framework/date",i18nDays:["Sun Mon Tue Wed Thu Fri Sat".split(" "),"Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" ")],i18nMonths:["Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" "),"January February March April May June July August September October November December".split(" ")],i18nClose:"close",regExp:{regExpName:"shortDate_en_en",format:"mm/dd/yyyy",position:[3,1,2],
regExp:/^(\d{2})\/(\d{2})\/(\d{4})$/,errorText:"Bad format date"}},d=/^\s?((0[1-9]|1[012]){1,2}\/)((0[/1-9]|[12][0-9]|3[01]){1,2}\/)(19|20)\d\d\s?$/,u=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,k=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,l=/[^-+\dA-Z]/g,g=function(b,d){b=String(b);for(d=d||2;b.length<d;)b="0"+b;return b},q={"default":"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",
longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"};Date.prototype.format=function(b,d){return stage.date.dateFormat(this,b,d)};return{_onRegister:function(b){},i18n:b,decaleFirstDayOfWeek:function(b){for(var d=[],f=1;f<b.length;f++)d.push(b[f]);d.push(b[0]);return d},getCurrentMonth:function(){return(new Date).getMonth()},
getCurrentYear:function(){return(new Date).getFullYear()},getFirstDay:function(b,d){var f=new Date;f.setMonth(b);f.setFullYear(d);f.setDate(1);return f.getDay()},getLastDate:function(b,d){var f=new Date;f.setMonth(b);f.setFullYear(d);for(b=28;32>b;){f.setDate(b);if(f.getDate()!=b)break;b++}return b-1},getTimestamp:function(b,d,f){var g=new Date;g.setDate(b);g.setMonth(d);g.setFullYear(f);return g.getTime()},parseDate:function(b,d){var f={m:1,d:1,y:1970,h:0,i:0,s:0},g;if(b&&null!==b&&void 0!==b){b=
stage.string.trim(b);b=b.split(/[\\\/:_;.\tT\s-]/);d=d.split(/[\\\/:_;.\tT\s-]/);var k="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec January February March April May June July August September October November December".split(" "),t=["am","pm","AM","PM"],r=function(b,f){0===b?12==f&&(f=0):12!=f&&(f+=12);return f};var q=0;for(g=d.length;q<g;q++){if("M"==d[q]){var l=$.inArray(b[q],k);-1!==l&&12>l&&(b[q]=l+1)}"F"==d[q]&&(l=$.inArray(b[q],k),-1!==l&&11<l&&(b[q]=l+1-12));"a"==d[q]&&(l=$.inArray(b[q],
t),-1!==l&&2>l&&b[q]==t[l]&&(b[q]=l,f.h=r(b[q],f.h)));"A"==d[q]&&(l=$.inArray(b[q],t),-1!==l&&1<l&&b[q]==t[l]&&(b[q]=l-2,f.h=r(b[q],f.h)));void 0!==b[q]&&(f[d[q].toLowerCase()]=parseInt(b[q],10))}f.m=parseInt(f.m,10)-1;b=f.y;70<=b&&99>=b?f.y=1900+f.y:0<=b&&69>=b&&(f.y=2E3+f.y)}return new Date(f.y,f.m,f.d,f.h,f.i,f.s,0)},dateFormat:function(d,r,f){1!=arguments.length||"[object String]"!=Object.prototype.toString.call(d)||/\d/.test(d)||(r=d,d=void 0);d=d?new Date(d):new Date;if(isNaN(d))throw SyntaxError("invalid date");
r=String(q[r]||r||q["default"]);"UTC:"===r.slice(0,4)&&(r=r.slice(4),f=!0);var n=f?"getUTC":"get",t=d[n+"Date"](),w=d[n+"Day"](),D=d[n+"Month"](),A=d[n+"FullYear"](),H=d[n+"Hours"](),e=d[n+"Minutes"](),E=d[n+"Seconds"]();n=d[n+"Milliseconds"]();var F=f?0:d.getTimezoneOffset(),p={d:t,dd:g(t),ddd:b.i18nDays[0][w],dddd:b.i18nDays[1][w],m:D+1,mm:g(D+1),mmm:b.i18nMonths[0][D],mmmm:b.i18nMonths[1][D],y:String(A).slice(2),yy:String(A).slice(2),yyyy:A,h:H%12||12,hh:g(H%12||12),H:H,HH:g(H),M:e,MM:g(e),s:E,
ss:g(E),l:g(n,3),L:g(99<n?Math.round(n/10):n),t:12>H?"a":"p",tt:12>H?"am":"pm",T:12>H?"A":"P",TT:12>H?"AM":"PM",Z:f?"UTC":(String(d).match(k)||[""]).pop().replace(l,""),o:(0<F?"-":"+")+g(100*Math.floor(Math.abs(F)/60)+Math.abs(F)%60,4),S:["th","st","nd","rd"][3<t%10?0:(10!=t%100-t%10)*t%10]};return r.replace(u,function(b){return b in p?p[b]:b.slice(1,b.length-1)})},controleFomatDate:function(b){return d.test(b)}}});stage.provide("ui.data");stage.require("ui");stage.require("ui.date");
stage.register.call(stage.ui,"data",function(){var b=function(b){if(b){if(b.metas)for(var d in b.metas)this[d]=b.metas[d];this.key=b.key;this.type=b.type}};b.prototype.set=function(b){return b};b.prototype.get=function(b){return b};b.prototype.sortUp=function(b,d){return b>d?1:b<d?-1:0};b.prototype.sortDown=function(b,d){return b<d?1:b>d?-1:0};var d=stage.herite(function(b){this.$super.constructor(b)},b);d.prototype.set=function(b){return b.toString()};var u=stage.herite(function(b){this.$super.constructor(b)},
b);u.prototype.set=function(b){return new Boolean(b)};var k=stage.herite(function(b){this.$super.constructor(b)},b);k.prototype.set=function(b){return parseInt(b,10)};var l=stage.herite(function(b){this.$super.constructor(b)},b);l.prototype.set=function(b){return parseFloat(b,10)};var g=stage.herite(function(b){this.$super.constructor(b)},b);g.prototype.set=function(b){try{var d=new Date(b)}catch(f){window.console&&(console.log(f),console.log(d)),d=b}return d};g.prototype.get=function(b){try{var d=
b}catch(f){window.console&&console.log(f)}return d};g.prototype.sortUp=function(b,d){b=b.getTime();d=d.getTime();return b>d?1:b<d?-1:0};g.prototype.sortDown=function(b,d){b=b.getTime();d=d.getTime();return b<d?1:b>d?-1:0};var q=stage.herite(function(b){this.$super.constructor(b)},b);return{types:{},dataStorage:stage.herite(function(b){this.$super.constructor(b)},stage.storage.coreStorage),design:function(b){this.fields=[];if(b)for(var g=0;g<b.length;g++)if(b[g].key){var f=stage.ui.data.isTypeRegister(b[g].type||
"string");f=f?new f(b[g]):new d(b[g]);b[g].render&&(f.get=b[g].render);this.fields.push(f);b[g].mapping?this.fields[b[g].mapping]=f:this.fields[b[g].key]=f}else throw Error("DESIGN ERROR : no key in design");this.nbFields=this.fields.length},registerType:function(d,g){var f=this.isTypeRegister(d);f||(f=this.types[d.toUpperCase()]=stage.herite(g,b));return f},isTypeRegister:function(b){b=b.toUpperCase();return b in this.types?this.types[b]:!1},_onRegister:function(){this.types.STRING=d;this.types.INTERGER=
k;this.types.FLOAT=l;this.types.BOOLEAN=u;this.types.DATE=g;this.types.OBJECT=q}}});stage.provide("ui.data.model");stage.require("xml");stage.require("json");stage.require("structs.hash");stage.require("ui.data");
stage.register.call(stage.ui.data,"model",function(){var b=function(){var b=function(b){k.call(this,b.response)},d=function(f,d,g){f=new stage.io.transport.outSocket.ajax.transport(f,g);f.listen(this,"onLoad",b);f.eventsManager.settingsToListen(g,this);f.send(d)};return stage.extend(this,{GET:function(b,g,k){k||(k={});k.method="GET";d.call(this,this.url?b?this.url+"/"+b:this.url:b,g,k)},POST:function(b,g,k){k||(k={});k.method="POST";d.call(this,this.url?b?this.url+"/"+b:this.url:b,g,k)},PUT:function(b,
g,k){k||(k={});k.method="PUT";d.call(this,this.url?b?this.url+"/"+b:this.url:b,g,k)},DELETE:function(b,g,k){k||(k={});k.method="DELETE";d.call(this,this.url?b?this.url+"/"+b:this.url:b,g,k)}})},d=function(){var b=function(b){k.call(this,b.response)},d=function(f,d,g){f=new stage.io.transport.outSocket.ajax.transport(f,g);f.listen(this,"onLoad",b);f.eventsManager.settingsToListen(g,this);f.send(d)};return stage.extend(this,{CREATE:function(b,g,k){k||(k={});k.method="POST";b=b?b:this.url?this.url:null;
g||(g={});g.action="create";d.call(this,b,g,k)},READ:function(b,g,k){k||(k={});k.method="GET";b=b?b:this.url?this.url:null;g||(g={});g.action="read";d.call(this,b,g,k)},UPDATE:function(b,g,k){k||(k={});k.method="POST";b=b?b:this.url?this.url:null;g||(g={});g.action="update";d.call(this,b,g,k)},DELETE:function(b,g,k){k||(k={});k.method="POST";b=b?b:this.url?this.url:null;g||(g={});g.action="delete";d.call(this,b,g,k)}})},u=function(b){switch(stage.typeOf(b)){case "document":return stage.isXML(b)?this.xmlReader:
this.domReader;case "string":return stage.json.isJson(b)?this.jsonReader:this.htmlReader;case "element":return stage.isXML(b.ownerDocument)?this.xmlReader:this.domReader;case "selector":return this.domReader;case "selectorXml":return this.xmlReader;case "object":return null!==b?this.jsonReader:null;case "array":return this.jsonReader;default:return null}},k=function(b){var d=u.call(this,b);d&&d.call(this,b);this.eventsManager.fireEvent("onDataReady",this,b)},l=function(b,d,f){this.errorMapper?this.error=
new this.errorMapper(stage.stageError(f,"STAGE MODEL","onErrorCallback TRANSPORT ERROR",f.message)):(this.error=new stage.stageError(f,"STAGE MODEL","onErrorCallback TRANSPORT ERROR",f.message),stage.console&&stage.console.error&&stage.console.error(this.error.toString()));this.eventsManager.fireEvent("onError",this,d,this.error)},g={name:"stageModel",design:null,transport:null,storage:null,errorMapper:null,logMapper:null,ormType:null,ormKey:null,ormMapper:null},q=function(t,r,f){this.settings=stage.extend(!0,
{},g,f);this.name=this.settings.name;this.errorMapper=this.settings.errorMapper||this.errorMapper;this.logMapper=this.settings.logMapper||this.logMapper;this.eventsManager=stage.createEventsManager(this.settings,this);this.data=t;this.nbDatas=0;this.data||(this.data=this.settings.storage?new stage.ui.data.dataStorage(this.settings.storage):new stage.ui.data.dataStorage);this.design=this.settings.design?new stage.ui.data.design(this.settings.design):new stage.ui.data.design;this.ormKey=this.settings.ormKey;
this.ormType=this.settings.ormType;this.ormMapper=this.settings.ormMapper;switch(this.ormType){case "REST":b.call(this);break;case "CRUD":d.call(this)}this.transport=r instanceof stage.transport?r:null;this.transport||(r&&"object"===typeof r&&(this.settings.transport=r),this.settings.transport&&(this.settings.transport.autoStart=!1,this.transport=stage.transport(this.settings.transport.url,this.settings.transport),this.transport.eventsManager.listen(this,"onMessage",k),this.transport.eventsManager.listen(this,
"onError",l),this.transport.eventsManager.settingsToListen(this.transport,this),this.transport.start(this.settings.transport.data),this.url=this.settings.transport.url))};q.prototype.loadData=function(b){if("array"===stage.typeOf(b)){for(var d=0;d<b.length;d++)this.set(d,b[d]);return b}for(d in b)this.set(d,b[d]);return b};q.prototype.foreach=function(b){return this.data.each(function(d,f){b(d.key,this.get(d.key),f)}.bind(this))};q.prototype.set=function(b,d){if(void 0!==b||null!==b){switch(stage.typeOf(d)){case "object":var f=
{},g;for(g in d)f[g]=g in this.design.fields?this.design.fields[g].set(d[g]):d[g];this.ormMapper?this.data.set(b,stage.extend(new this.ormMapper(f),f)):this.data.set(b,f);break;default:b in this.design.fields?this.data.set(b,this.design.fields[b].set(d)):this.data.set(b,d)}this.nbDatas+=1}};q.prototype.get=function(b){if(void 0!==b||null!==b){var d={},f=this.data.get(b);if("object"===stage.typeOf(f))for(var g in f)d[g]=g in this.design.fields?this.design.fields[g].get(f[g]):f[g];else return b in this.design.fields?
this.design.fields[b].get(f):f}return d};q.prototype.domReader=function(b){this.error=stage.stageError(Error("domReader must be orverride by child class"),"STAGE MODEL","domReader","domReader must be orverride by child class");throw Error("MODEL CORE : domReader must be orverride by child class");};q.prototype.jsonReader=function(b){b="string"===typeof b?stage.json.parse(b).resultSet:b.resultSet||b;if(b.data)if(this.ormKey)for(var d=0;d<b.data.length;d++)void 0!=b.data[d][this.ormKey]&&this.set(b.data[d][this.ormKey],
b.data[d]);else for(d=0;d<b.data.length;d++)this.set(d,b.data[d]);b.log&&0<b.log.length&&(this.logMapper?this.logMapper(b.log):stage.console&&stage.console.log&&stage.console.log(b.log));b.error&&0<b.error.length&&(this.errorMapper?this.error=new this.errorMapper(stage.stageError(b.error,"STAGE MODEL","jsonReader")):(this.error=stage.stageError(b.error,"STAGE MODEL","jsonReader"),stage.console&&stage.console.error&&stage.console.error(this.error.toString())),this.eventsManager.fireEvent("onError",
this,null,this.error))};q.prototype.xmlReader=function(b){b=stage.xml.parseXml(b).resultSet;if(b.data)if(this.ormKey)for(var d=0;d<b.data.length;d++)b.data[d][this.ormKey]&&this.set(b.data[d][this.ormKey],b.data[d]);else for(d=0;d<b.data.length;d++)this.set(d,b.data[d]);b.log&&0<b.log.length&&(this.logMapper?this.logMapper(b.log):stage.console&&stage.console.log&&stage.console.log(b.log));b.error&&0<b.error.length&&(this.errorMapper?this.error=new this.errorMapper(stage.stageError(b.error,"STAGE MODEL",
"xmlReader")):(this.error=stage.stageError(b.error,"STAGE MODEL","xmlReader"),stage.console&&stage.console.error&&stage.console.error(this.error.toString())),this.eventsManager.fireEvent("onError",this,null,this.error))};q.prototype.htmlReader=function(b){b=stage.dom.html(b);this.domReader(b)};q.prototype.sort=function(b,d){if(b in this.design.fields){var f=[],g=this.data.get(),k;for(k in g)f.push(g[k]);var r="up"===d?this.design.fields[b].sortUp:this.design.fields[b].sortDown;f.sort(function(f,d){return r(f[b],
d[b])});if(this.ormKey)for(k=0;k<f.length;k++)this.set(f[k][this.ormKey],f[k]);else this.data.each(stage.setContext(function(b,d){this.set(d,f[d])},this));this.eventsManager.fireEvent("onDataReady",f)}else throw Error("can't sort field is not register!!!");};q.prototype.find=function(b,d){};return q});stage.provide("ui.sampler");
stage.register.call(stage.ui,"sampler",function(){var b={framerate:30,auto:!1},d=function(d){this.settings=stage.extend(!0,{},b,d);this.framerate=this.settings.framerate;this.eventsBeat=stage.createEventsManager(this.settings);this.beatInterval=this.timestamp=null;this.updateTimeStamp();this.settings.auto&&this.start()};d.prototype.listen=function(b,d,k){return this.eventsBeat.listen(b,d,k)};d.prototype.unlisten=function(b,d){return this.eventsBeat.detachEvent(b,d)};d.prototype.start=function(){if(this.beatInterval)return this.timestamp;
this.beatInterval=setInterval(this.beatGenerate.bind(this),1E3/this.settings.framerate);this.updateTimeStamp();this.eventsBeat.fireEvent("onStart",this);return this.timestamp};d.prototype.stop=function(){if(!this.beatInterval)return this.timestamp;clearInterval(this.beatInterval);this.beatInterval=null;this.updateTimeStamp();this.eventsBeat.fireEvent("onStop",this);return this.timestamp};d.prototype.beatGenerate=function(){this.updateTimeStamp();this.eventsBeat.fireEvent("onBeat",this);return this.timestamp};
d.prototype.getTimeStamp=function(){return this.timestamp||stage.getTimeStamp()};d.prototype.updateTimeStamp=function(){return this.timestamp=stage.getTimeStamp()};var u={framerate:30,duration:.2,autoStop:!0},k={"short":250,normal:500,"long":1E3},l=function(b,q){this.settings=stage.extend(!0,{},u,q);this.error=null;this.eventsSampler=stage.createEventsManager(this.settings);"number"===typeof this.settings.duration?this.duration=1E3*this.settings.duration:k[this.settings.duration]?this.duration=k[this.settings.duration]:
parseInt(this.settings.duration,10)?this.duration=1E3*parseInt(this.settings.duration,10):this.duration=250;b?(this.framerate=b.framerate,this.hearBeat=b):(this.framerate=this.settings.framerate,this.hearBeat=new d({framerate:this.framerate}));this.timeStop=this.timeStart=this.state=0;this.maxFrames=this.framerate*this.settings.duration;this.nbFrames=0};l.prototype.listen=function(b,d,k){return this.eventsSampler.listen(b,d,k)};l.prototype.play=function(b){1!==this.state?(this.myRender=this.render.bind(this),
this.hearBeat.listen(this,"onBeat",this.myRender),this.timeStart=b?b:this.hearBeat.start(),this.render.apply(this,arguments),this.timeStop=this.timeStart+this.duration,this.state=1,this.eventsSampler.fireEvent("onStart",this)):(this.error=Error("SAMPLER_ALREADY_RUNNING"),this.eventsSampler.fireEvent("onError",this,0))};l.prototype.stop=function(){2!==this.state?(this.hearBeat.unlisten("onBeat",this.myRender),this.hearBeat.stop(),this.state=2,this.nbFrames=0,this.eventsSampler.fireEvent("onStop",this)):
(this.error=Error("SAMPLER_ALREADY_STOP"),this.eventsSampler.fireEvent("onError",this,1))};l.prototype.abort=function(){1===this.state&&(this.state=3,this.eventsSampler.fireEvent("onAbort",this),this.stop())};l.prototype.render=function(){if(this.hearBeat.timestamp>=this.timeStart)if(0===this.state)this.nbFrames++;else if(this.hearBeat.timestamp>=this.timeStop&&2!==this.state)this.settings.autoStop&&(this.maxFrames>=this.nbFrames&&(Array.prototype.unshift.call(arguments,1),this.eventsSampler.fireEvent("onRenderSample",
1)),this.stop()),this.eventsSampler.fireEvent("onFinish",this);else if(1===this.state){var b=Math.round(100*(1-(this.timeStop-this.hearBeat.timestamp)/this.duration))/100;this.maxFrames>=this.nbFrames&&(Array.prototype.unshift.call(arguments,b),this.eventsSampler.fireEvent("onRenderSample",b),this.nbFrames++)}};return{heartBeat:d,sampler:l}});stage.provide("ui.effects");stage.require("structs.queues");stage.require("ui.sampler");
stage.register.call(stage.ui,"effects",function(){var b={isRegister:function(b){return this[b]?this[b]:!1}},d={isRegister:function(b){return this[b]?this[b]:!1}},u={transition:"linear",propertyTransitions:{},delay:0},k=function(b,g){this.settings=stage.extend(!0,{},u,g);this.sampler=new stage.ui.sampler.sampler(b,this.settings);this.sampler.listen(this,"onRenderSample",function(b){this.renderFrame(b)});this.timeoutId=null;d.isRegister(this.settings.transition)?this.transition=d[this.settings.transition]:
this.transition=d[u.transition]};k.prototype.play=function(b){this.settings.delay?this.timeoutId=setTimeout(function(){this.sampler.play(b);this.timeoutId=null}.bind(this),this.settings.delay):this.sampler.play(b)};k.prototype.clearDelay=function(){return this.timeoutId?clearTimeout(this.timeoutId):!0};k.prototype.stop=function(){this.clearDelay();this.sampler.stop()};k.prototype.abort=function(){this.clearDelay();this.sampler.abort()};k.prototype.listen=function(b,d,g){return this.sampler.listen(b,
d,g)};k.prototype.renderFrame=function(b){throw Error("renderFrame is not overloaded in the EFFECT CORE you must overload this function in effect Type ");};var l={framerate:30,duration:.2,chain:!1},g=function(b,d){this.settings=stage.extend(!0,{},l,d);this.error=null;this.hearBeat=new stage.ui.sampler.heartBeat({framerate:this.settings.framerate});this.hearBeat.eventsBeat.settingsToListen(this.settings);this.nbFinish=0;this.settings.queue||(this.queue=new stage.structs.queues.struct);this.selector=
new stage.stageSelector(document,b||null);this.settings.replay&&(this.buffer=[])};g.prototype.addEffect=function(d,g){if(!d)return!1;if(b.isRegister(d)){g.autoStop=!1;var k=new b[d].effect(this.selector,this.hearBeat,g);k.sampler.eventsSampler.listen(this,"onFinish",function(b){this.nbFinish++;this.queue.dequeue();0===this.queue.count()?b.stop():this.settings.chain?(b.stop(),this.queue.peek().play()):this.hearBeat.unlisten("onBeat",b.myRender)});this.settings.replay&&this.buffer.push({name:d,settings:g})}else throw Error("effect not exits");
this.queue.enqueue(k);return k};g.prototype.addElement=function(b){stage.isSelector(b)?this.selector.selector=Array.prototype.concat.call(this.selector.selector,b.selector):this.selector.selector.push(b);return this.selector};g.prototype.removeElements=function(){this.selector.selector.length=0};g.prototype.play=function(){var b=this.hearBeat.start();this.settings.chain?this.queue.peek().play(b):this.queue.run(function(d){d.play(b)})};g.prototype.replay=function(){this.hearBeat=new stage.ui.sampler.heartBeat({framerate:this.settings.framerate});
this.hearBeat.eventsBeat.settingsToListen(this.settings);this.nbFinish=0;this.settings.queue||(this.queue=new stage.structs.queues.struct);this.settings.replay=!1;for(var b=0;b<this.buffer.length;b++)this.addEffect(this.buffer[b].name,this.buffer[b].settings);this.play()};return{effectCore:k,transitions:d,registerTransition:function(b,g){if(d.isRegister(b))return d.isRegister(b);d[b]=g()},effects:b,registerEffect:function(d,g){return b.isRegister(d)?b.isRegister(d):b[d]=stage.register.call(b,d,g)},
local:{animate:function(b,d){return new g(b,d)}},$$stage:{effects:function(d,g){if(!d)return!1;b.isRegister(d)&&(new b[d].effect(this,null,g)).play()}}}});stage.provide("ui.effects.transitions");stage.require("ui.effects");stage.ui.effects.registerTransition("linear",function(){return function(b,d){return b}});stage.ui.effects.registerTransition("reverse",function(){return function(b){return 1-b}});
stage.ui.effects.registerTransition("sinusoidal",function(){return function(b,d){return-Math.cos(b*Math.PI)/2+.5}});stage.ui.effects.registerTransition("wobble",function(){return function(b,d){return-Math.cos(b*Math.PI*9*b)/2+.5}});stage.ui.effects.registerTransition("pulse",function(){return function(b,d){return-Math.cos(b*((d.pulses||5)-.5)*2*Math.PI)/2+.5}});
stage.ui.effects.registerTransition("flicker",function(){return function(b,d){b+=(Math.random()-.5)/5;return stage.ui.effects.transitions.sinusoidal(0>b?0:1<b?1:b)}});stage.ui.effects.registerTransition("blink",function(){return function(b,d){return Math.round(b*(d.blinks||5))%2}});stage.ui.effects.registerTransition("spring",function(){return function(b,d){return 1-Math.cos(4.5*b*Math.PI)*Math.exp(6*-b)}});
stage.ui.effects.registerTransition("parabole",function(){return function(b,d){return b*(1-b)*4*(d||200)}});stage.provide("ui.effects.transitions.penner");stage.require("ui.effects");stage.ui.effects.registerTransition("easeInQuad",function(){return function(b){return Math.pow(b,2)}});stage.ui.effects.registerTransition("easeOutQuad",function(){return function(b){return-(Math.pow(b-1,2)-1)}});
stage.ui.effects.registerTransition("easeInOutQuad",function(){return function(b){return 1>(b/=.5)?.5*Math.pow(b,2):-.5*((b-=2)*b-2)}});stage.ui.effects.registerTransition("easeInCubic",function(){return function(b){return Math.pow(b,3)}});stage.ui.effects.registerTransition("easeOutCubic",function(){return function(b){return Math.pow(b-1,3)+1}});stage.ui.effects.registerTransition("easeInOutCubic",function(){return function(b){return 1>(b/=.5)?.5*Math.pow(b,3):.5*(Math.pow(b-2,3)+2)}});
stage.ui.effects.registerTransition("easeInQuart",function(){return function(b){return Math.pow(b,4)}});stage.ui.effects.registerTransition("easeOutQuart",function(){return function(b){return-(Math.pow(b-1,4)-1)}});stage.ui.effects.registerTransition("easeInOutQuart",function(){return function(b){return 1>(b/=.5)?.5*Math.pow(b,4):-.5*((b-=2)*Math.pow(b,3)-2)}});stage.ui.effects.registerTransition("easeInQuint",function(){return function(b){return Math.pow(b,5)}});
stage.ui.effects.registerTransition("easeOutQuint",function(){return function(b){return Math.pow(b-1,5)+1}});stage.ui.effects.registerTransition("easeInOutQuint",function(){return function(b){return 1>(b/=.5)?.5*Math.pow(b,5):.5*(Math.pow(b-2,5)+2)}});stage.ui.effects.registerTransition("easeInSine",function(){return function(b){return-Math.cos(Math.PI/2*b)+1}});stage.ui.effects.registerTransition("easeOutSine",function(){return function(b){return Math.sin(Math.PI/2*b)}});
stage.ui.effects.registerTransition("easeInOutSine",function(){return function(b){return-.5*(Math.cos(Math.PI*b)-1)}});stage.ui.effects.registerTransition("easeOutCirc",function(){return function(b){return Math.sqrt(1-Math.pow(b-1,2))}});stage.ui.effects.registerTransition("easeInOutCirc",function(){return function(b){return 1>(b/=.5)?-.5*(Math.sqrt(1-b*b)-1):.5*(Math.sqrt(1-(b-=2)*b)+1)}});stage.provide("ui.effects.css");stage.require("ui.effects");stage.require("css");stage.require("ui.color");
stage.ui.effects.registerEffect("css",function(){var b=function(){var b=/^(([\+\-]?[0-9\.]+)(em|ex|px|in|cm|mm|pt|pc|%))|0$/,d=/([\+-]*\d+\.?\d*)/,k=/color/gi,r={absolute:function(b,e,f){return b.blendColors(e,f)},relative:function(b,e,f){return b.blendColors(e,f*(e||1))},percent:function(b,e,f){}},f={absolute:function(b,e,f){return parseInt(b||0)+(e-parseInt(b||0))*f},relative:function(b,e,f){return parseInt((b||0)+f*(e||1))},percent:function(b,e,f){return parseInt(b||0)+(b*e-parseInt(b||0))*f}},
n={absolute:function(b,e,f){return parseFloat((1*(b||0)+(e-1*(b||0))*f).toFixed(3))},relative:function(b,e,f){return parseFloat((1*(b||0)+f*(e||1)).toFixed(3))},percent:function(b,e,f){return parseFloat((1*(b||0)+(b*e-1*(b||0))*f).toFixed(3))}},l={absolute:function(b,e,f){return(1*(b||0)+(e-1*(b||0))*f).toFixed(3)},relative:function(b,e,f){return(1*(b||0)+f*(e||1)).toFixed(3)},percent:function(b,e,f){return(1*(b||0)+(b*e-1*(b||0))*f).toFixed(3)}},w=function(b,e){b=b.split(" ");b[0]=parseFloat(b[0].substring(0,
b[0].length-e));b[1]=parseFloat(b[1].substring(0,b[1].length-e));return b},u={backgroundColor:r,backgroundSize:{absolute:function(b,e,f){b=w(b,2);e=w(e,2);return(b[0]||0)+(e[0]-(b[0]||0))*f+"px "+((b[1]||0)+(e[1]-(b[1]||0))*f)+"px"},percent:function(b,e,f){b=w(b,1);e=w(e,1);return 1*(b[0]||0)+(e[0]-b[0])*f+"% "+(1*(b[1]||0)+(e[1]-b[1])*f)+"%"}},borderBottomColor:r,borderBottomWidth:n,borderLeftColor:r,borderLeftWidth:n,borderRightColor:r,borderRightWidth:n,borderSpacing:n,borderTopColor:r,borderTopWidth:n,
bottom:n,color:r,fontSize:n,fontWeight:f,height:n,left:n,letterSpacing:n,lineHeight:n,marginBottom:n,marginLeft:n,marginRight:n,marginTop:n,maxHeight:n,maxWidth:n,minHeight:n,minWidth:n,opacity:l,outlineColor:r,outlineOffset:n,outlineWidth:n,paddingBottom:n,paddingLeft:n,paddingRight:n,paddingTop:n,right:n,textIndent:n,top:n,width:n,wordSpacing:n,zIndex:f,zoom:l},A=function(f,e,g,n,p){this.property=stage.string.camelize(g);this.mode=p.mode;this.transition=p.transition?stage.ui.effects.transitions.isRegister(p.transition)||
n:n;this.propertyTransition=p.propertyTransitions;var m=k.test(this.property);"object"===stage.typeOf(p.css[g])?(this.end=p.css[g].value||1,this.mode=p.css[g].mode||p.mode,this.transition=p.css[g].transition?stage.ui.effects.transitions.isRegister(p.css[g].transition)||n:n,this.propertyTransition=p.css[g].propertyTransitions||this.propertyTransition):this.end=p.css[this.property]||p.css[g];if("backgroundSize"!==this.property){if(m)this.end=new stage.ui.color(this.end);else if(b.test(this.end)||d.test(this.end))this.end=
parseFloat(this.end);stage.browser.Ie&&"opacity"===this.property?this.start=stage.css.getOpacity(f):(this.start=e[g]||e[this.property],m?this.start=new stage.ui.color(this.start):(this.start&&"auto"!==this.start||(this.start=f.style[this.property]),b.test(this.start)||d.test(this.start)?this.start=parseFloat(this.start):this.start=1))}else this.start=f.style[this.property],f=this.start.split(" "),f[0]="auto"===f[0]?"percent"===this.mode?"100%":e.width:f[0],f[1]="auto"===f[1]?"percent"===this.mode?
"100%":e.height:f[1],this.start=f[0]+" "+f[1];a:switch(e=this.property,this.mode){case "relative":e=u[e].relative;break a;case "percent":e=u[e].percent;break a;default:e=u[e].absolute}this.interpolation=e};return function(b,e,f){this.objectsComputed=[];b.each(function(b){var d=stage.css.getStyle(b),m={element:b,css:[]},h;for(h in e.css)m.css.push(new A(b,d,h,f,e));this.objectsComputed.push(m)}.bind(this))}}();b.prototype.interpole=function(b){for(var d=0;d<this.objectsComputed.length;d++)for(var g=
0;g<this.objectsComputed[d].css.length;g++){var k=this.objectsComputed[d].css[g].interpolation(this.objectsComputed[d].css[g].start,this.objectsComputed[d].css[g].end,this.objectsComputed[d].css[g].transition(b,this.objectsComputed[d].css[g].propertyTransition));stage.css.setStyle(this.objectsComputed[d].element,this.objectsComputed[d].css[g].property,k)}};var d={mode:"absolute",css:{}},u=function(){for(var b=0;b<this.objectsComputed.length;b++)for(var d=0;d<this.objectsComputed[b].css.length;d++){var k=
this.objectsComputed[b].css[d].mode;"absolute"===k?stage.css.setStyle(this.objectsComputed[b].element,this.objectsComputed[b].css[d].property,this.objectsComputed[b].css[d].end):"relative"===k&&stage.css.setStyle(this.objectsComputed[b].element,this.objectsComputed[b].css[d].property,this.objectsComputed[b].css[d].start+this.objectsComputed[b].css[d].end)}},k=stage.herite(function(b,k,l){l=stage.extend(!0,{},d,l);this.effectCore=this.$super;this.effectCore.constructor(k,l);stage.isSelector(b)?this.selector=
b:this.selector=new stage.stageSelector(document,b);this.selector.visible()||this.selector.show()},stage.ui.effects.effectCore);k.prototype.renderFrame=function(b){this.interpolate.interpole(b)};k.prototype.play=function(d){this.interpolate=new b(this.selector,this.settings,this.transition);this.sampler.listen(this.interpolate,"onStop",u);this.effectCore.play(d)};var l=function(b,d,k){return stage.extend(!0,{},{transition:"sinusoidal",duration:b||1,css:{opacity:d}},k)};return{effect:k,local:{morph:function(b,
d,l){l?l.css=d:l={css:d};b=new k(b,null,l);b.play();return b}},$$stage:{morph:function(b,d){d?d.css=b:d={css:b};(new k(this,null,d)).play()},fade:function(b,d,t){b=l(b,d||0,t);(new k(this,null,b)).play()},appear:function(b,d,t){b=l(b,d||1,t);(new k(this,null,b)).play()},move:function(b,d,l,r){b=l&&"relative"!==l?stage.extend(!0,{},{transition:"sinusoidal",css:{left:b,top:d}},r):stage.extend(!0,{},{transition:"sinusoidal",mode:"relative",css:{left:b,top:d}},r);(new k(this,null,b)).play()},pulse:function(b,
d,l){var g=stage.css.getOpacity(this);b=new k(this,null,{transition:"pulse",propertyTransitions:{pulses:b||7},duration:d||3,css:{opacity:0}});l||b.listen(b,"onFinish",function(){stage.css.setOpacity(this.selector.get(0),g)});b.play()},slide:function(b,d,l){switch(b){case "up":var g={height:0};$$stage(this).css({paddingTop:0,paddingBottom:0,borderBottomWidth:0,borderTopWidth:0,borderLeftWidth:0,borderRightWidth:0});break;case "down":g=stage.css.getComputedStyle(this)||this.style,g={height:stage.css.getHeight(this),
paddingTop:stage.css.styleToValue(this,"paddingTop",g.paddingTop)||stage.css.styleToValue(this,"paddingTop",g["padding-top"]),paddingBottom:stage.css.styleToValue(this,"paddingBottom",g.paddingBottom)||stage.css.styleToValue(this,"paddingBottom",g["padding-bottom"])},$$stage(this).css({height:0,paddingTop:0,paddingBottom:0,overflow:"hidden"})}b=stage.extend(!0,{},{transition:"sinusoidal",mode:"up"===b?"absolute":"relative",duration:d,css:g},l);(new k(this,null,b)).play();return this},hightLight:function(b){},
scale:function(b,d){b=stage.extend(!0,{},{transition:"sinusoidal",mode:"percent",css:{width:{value:parseFloat(b)},height:{value:parseFloat(b)}}},d);(new k(this,null,b)).play()}}}});stage.provide("ui.gestural");stage.require("events");stage.require("functions");stage.require("array");
stage.register.call(stage.ui,"gestural",function(){var b=stage.document,d={speed:!1,direction:!1,containment:null,mouseClick:"left",zIndex:null},u=function(b){this.startGesture(b)},k=function(b){if(this.preventClick)return this.preventClick=!1,this.eventStop(b),!1},l=function(b){this.eventStop(b)},g=stage.herite(function(b,g){this.mouseEvent=this.$super;this.mouseEvent.constructor();this.settingsGestural=stage.extend(!0,d,g);switch(this.settingsGestural.mouseClick){case "left":this.mouseClickType=
this.isLeftClick;break;case "right":this.mouseClickType=this.isRightClick;break;case "middle":this.mouseClickType=this.isMiddleClick;break;default:this.mouseClickType=this.isLeftClick}this.state="stop";this.handles=b;this.handleType=stage.typeOf(this.handles);"array"===this.handleType?(this.downCallBack=[],this.clickCallback=[]):this.clickCallback=this.downCallBack=null;this.enableGesture(!0)},stage.mouseEvents);g.prototype.startGesture=function(d,g){this.mouseClickType(d);g||(g=this.handles);this.mouseDownEvent=
d;if("progress"===this.state||"start"===this.state)return this.stopGesture(d),!1;this.callbackUp&&(stage.unListen(b,"mouseup",this.callbackUp),stage.unListen(b,"touchend",this.callbackUp));this.callbackUp=this.stopGesture.bind(this);stage.listen(b,"mouseup",this.callbackUp);stage.listen(b,"touchend",this.callbackUp);this.callbackMove&&(stage.unListen(b,"mousemove",this.callbackMove),stage.unListen(b,"touchmove",this.callbackMove));this.callbackMove=this.progressGesture.bind(this);stage.listen(b,"mousemove",
this.callbackMove);stage.listen(b,"touchmove",this.callbackMove);this.state="start";this.timeStart=stage.getTimeStamp();this.startPointer=this.pointer(d);this.originPosition=stage.css.getStyle(g,"position");this.startPosition=(this.originPosAbsolute="absolute"===this.originPosition||"fixed"===this.originPosition?!0:!1)?stage.position.ancestorOffset(g):[stage.css.getStyle(g,"left"),stage.css.getStyle(g,"top")];if(this.settings&&this.settings.containment){d=$$stage(g);var f=d.documentOffset(),n=$$stage(this.settings.containment);
g=$$stage(this.element).parent();var k=stage.typeOf(this.settings.containment);d.hide();switch(k){case "element":n.documentOffset();var l=n.documentOffset()[0],r=n.documentOffset(),q=n.getWH();n=q[0];q=q[1];var t=f[1]-r[1];f=f[0]-r[0];break;case "document":n.documentOffset();l=n.documentOffset()[0];n=stage.viewport.getHeight();q=stage.viewport.getWidth();t=f[1];f=f[0];break;case "window":t=stage.viewport.scrollTop();l=stage.viewport.scrollLeft();n=window.innerHeight;q=window.innerWidth;t=f[1]-t;f=
f[0]-l;break;default:throw Error("DRAG ERROR containment must be an element or a document or window =>"+k);}d.show();var e=d.getWH();r=e[0];e=e[1];var E=g.getWH()[1],u=d.ancestorOffset(),p=u[1];u=u[0];"relative"===d.css("position")?("element"===k?this.topMin=-(d.get(0).offsetTop-d.css("top")):(k=d.css("bottom"),this.topMin=-(d.get(0).offsetTop+k+t-p)),this.topMax=n-r+this.topMin):(this.topMin=p-t,this.topMax=n-r-(t-p));this.leftMin=u-f+(stage.css.getStyle(g.selector[0],"paddingLeft")||0);this.leftMax=
this.leftMin+E-e;this.widthMaxRight=q-f;this.widthMaxLeft=f+e;this.heightMaxBottom=n-t;this.heightMaxTop=r+t;this.offsetContainment=l}return!0};var q=function(){this.dx=Math.abs(this.currentPointer[0]-this.startPointer[0]);this.dy=Math.abs(this.currentPointer[1]-this.startPointer[1]);this.settingsGestural.speed&&(this.speed=[],this.timeEnd=stage.getTimeStamp(),this.speed[0]=(this.currentPointer[0]-this.startPointer[0])/((this.timeEnd-this.timeStart)/1E3),this.speed[1]=(this.currentPointer[1]-this.startPointer[1])/
((this.timeEnd-this.timeStart)/1E3),this.duration=Math.abs(this.dx/this.speed[0]));this.settingsGestural.direction&&(this.direction=this.dx>this.dy?this.currentPointer[0]<this.startPointer[0]?"left":"right":this.currentPointer[1]<this.startPointer[1]?"up":"down")};g.prototype.stopGesture=function(d){this.preventClick=d.target===this.mouseDownEvent.target;if("stop"===this.state)return!1;if("start"===this.state)return stage.unListen(b,"mouseup",this.callbackUp),stage.unListen(b,"touchend",this.callbackUp),
this.callbackUp=null,stage.unListen(b,"mousemove",this.callbackMove),stage.unListen(b,"touchmove",this.callbackMove),this.callbackMove=null,this.state="stop",this.eventStop(d),!1;(this.settingsGestural.speed||this.settingsGestural.direction)&&q.call(this);stage.unListen(b,"mouseup",this.callbackUp);stage.unListen(b,"touchend",this.callbackUp);this.callbackUp=null;stage.unListen(b,"mousemove",this.callbackMove);stage.unListen(b,"touchmove",this.callbackMove);this.callbackMove=null;this.state="stop";
this.eventStop(d);return!0};g.prototype.progressGesture=function(b){this.state="progress";this.currentPointer=this.pointer(b);(this.settingsGestural.speed||this.settingsGestural.direction)&&q.call(this);this.eventStop(b);return!0};g.prototype.disableGesture=function(){"element"===this.handleType&&(stage.unListen(this.handles,"mousedown",this.downCallBack),stage.unListen(this.handles,"touchstart",this.downCallBack),this.settings.zIndex&&stage.css.setStyle(this.handles,"zIndex",this.settings.zIndex),
this.clickCallback=l.bind(this),stage.listen(this.handles,"mousedown",this.clickCallback),stage.listen(this.handles,"touchstart",this.clickCallback));if("array"===this.handleType)for(var b=0;b<this.handles.length;b++)stage.unListen(this.handles[b],"mousedown",this.downCallBack[b]),stage.unListen(this.handles[b],"touchstart",this.downCallBack[b]),this.settings.zIndex&&stage.css.setStyle(this.handles[b],"zIndex",this.settings.zIndex),this.clickCallback=l.bind(this),stage.listen(this.handles[b],"mousedown",
this.clickCallback),stage.listen(this.handles[b],"touchstart",this.clickCallback)};g.prototype.enableGesture=function(b){"element"===this.handleType&&(this.downCallBack=u.bind(this),stage.listen(this.handles,"mousedown",this.downCallBack),stage.listen(this.handles,"touchstart",this.downCallBack),b?stage.listen(this.handles,"click",k.bind(this)):(stage.unListen(this.handles,"mousedown",this.clickCallback),stage.unListen(this.handles,"touchstart",this.clickCallback)),this.settings&&this.settings.zIndex&&
stage.css.setStyle(this.handles,"zIndex",this.settings.zIndex));if("array"===this.handleType)for(var d=0;d<this.handles.length;d++)this.downCallBack[d]=u.bind(this),stage.listen(this.handles[d],"mousedown",this.downCallBack[d]),stage.listen(this.handles[d],"touchstart",this.downCallBack[d]),b?stage.listen(this.handles[d],"click",k.bind(this)):(stage.unListen(this.handles[d],"mousedown",this.clickCallback),stage.unListen(this.handles[d],"touchstart",this.clickCallback)),this.settings&&this.settings.zIndex&&
stage.css.setStyle(this.handles[d],"zIndex",this.settings.zIndex)};return g});stage.provide("ui.dragdrop");stage.require("array");stage.require("events");stage.require("dom");stage.require("position");stage.require("ui.gestural");
stage.register.call(stage.ui,"dragdrop",function(){var b=function(b){this.dropEffect="none";this.effectAllowed="uninitialized";this.types=null;this.data=stage.structs.createHash(b)};b.prototype.clearData=function(b){};b.prototype.setData=function(b,h){};b.prototype.getData=function(b){};b.prototype.setDragImage=function(b,h,e){};b.prototype.addElement=function(b){};var d={handle:null,cursor:!1,zindex:null,opacity:.7,revert:!1,revertDuration:.5,revertTransition:"sinusoidal",ghosting:!1,scroll:!1,scrollSensitivity:20,
scrollSpeed:15,constraint:null,snapToGrid:null,canDrop:!1,data:null,containment:null,mouseClick:"left",settingsToListen:!0},u=function(b,h){if(this.settings.revert&&this.settings.ghosting){b=this.clone;var e=!0}else b=this.element,e=!1;$$stage(b).move(h.startPosition[0],h.startPosition[1],"absolute",{duration:"auto"===this.settings.revertDuration?this.duration:this.settings.revertDuration,transition:this.settings.revertTransition,onStop:function(b){h.settings.zindex&&stage.css.setStyle(h.element,
{zIndex:h.originZindex});e&&stage.remove(h.clone);h.state="stop"}})},k=function(b,h){this.startOpacity=stage.css.getStyle(this.element,"opacity");this.settings.ghosting?stage.css.setStyle(this.clone,"opacity",this.settings.opacity):stage.css.setStyle(this.element,"opacity",this.settings.opacity)},l=function(b,h){this.settings.ghosting?stage.css.setStyle(this.clone,"opacity",this.startOpacity):stage.css.setStyle(this.element,"opacity",this.startOpacity)},g={INPUT:"nodrag",SELECT:"nodrag",OPTION:"nodrag",
BUTTON:"nodrag",TEXTAREA:"nodrag"},q=stage.herite(function(h,e){h&&(this.handle=this.element=h,this.settings=stage.extend(!0,{},d,e),this.error=null,this.dragEvents=stage.createEventsManager(),this.settings.handle&&(this.handle=this.settings.handle),this.settings.revert&&(this.dragEvents.listen(this,"onDragEnd",u),this.settings.speed=!0),this.gestural=this.$super,this.gestural.constructor(this.handle,this.settings),this.settings.cursor?stage.css.setStyle(this.handle,{cursor:this.settings.cursor}):
stage.css.setStyle(this.handle,{cursor:"move"}),this.dataTransfer=new b(this.settings.data),this.dragEvents.listen(this,"onDragStart",k),this.dragEvents.listen(this,"onDragEnd",l),this.settings.settingsToListen&&this.dragEvents.settingsToListen(this.settings,this))},stage.ui.gestural);q.prototype.startGesture=function(b){if("revert"!==this.state&&this.mouseClickType(b))if(v.innerHTML=m,this.targetType=this.getTargetType(b),this.targetType in g)this.error=Error("this element can't be drag"),this.dragEvents.fireEvent("onError",
b,this,0);else{if(this.settings.ghosting){this.clone=this.element.cloneNode(!0);if(!this.originPosAbsolute){var h=stage.position.ancestorOffset(this.element),e=stage.css.getStyle(this.element,"width"),d=stage.css.getStyle(this.element,"height");stage.css.setStyle(this.clone,{left:h[0],top:h[1],width:e,height:d})}this.element.parentNode.insertBefore(this.clone,this.element)}else this.clone=this.element;this.gestural.startGesture(b,this.clone)&&(this.settings.zindex&&(this.originZindex=stage.css.getStyle(this.clone,
"zIndex"),stage.css.setStyle(this.clone,{zIndex:this.settings.zindex})),this.offset=[this.startPointer[0]-this.startPosition[0],this.startPointer[1]-this.startPosition[1]],this.settings.ghosting&&(this.originPosAbsolute||stage.css.setStyle(this.clone,{position:"absolute"}),this.clonePosition=[stage.css.getStyle(this.element,"left"),stage.css.getStyle(this.element,"top")],this.offsetClone=[this.startPointer[0]-this.clonePosition[0],this.startPointer[1]-this.clonePosition[1]]),this.dragEvents.fireEvent("onStart",
b,this))}};q.prototype.progressGesture=function(b){"start"===this.state&&this.dragEvents.fireEvent("onDragStart",b,this);if(this.gestural.progressGesture(b)){this.left=this.currentPointer[0]-this.offset[0];this.top=this.currentPointer[1]-this.offset[1];var h=!0,e=!0;this.settings.constraint&&("horizontal"===this.settings.constraint?h=!1:e=!1);this.settings.snapToGrid&&(this.left=Math.round(this.left/this.settings.snapToGrid[0])*this.settings.snapToGrid[0],this.top=Math.round(this.top/this.settings.snapToGrid[1])*
this.settings.snapToGrid[1]);this.settings.containment&&(this.top<this.topMin?this.top=this.topMin:this.top>this.topMax&&(this.top=this.topMax),this.left<this.leftMin?this.left=this.leftMin:this.left>this.leftMax&&(this.left=this.leftMax));this.dragEvents.fireEvent("onDrag",b,this)&&(e&&(this.clone.style.left=this.left+"px"),h&&(this.clone.style.top=this.top+"px"),this.settings.canDrop&&f(b,this))}};q.prototype.stopGesture=function(b){v.innerHTML=h;this.gestural.stopGesture(b)?(this.settings.ghosting&&
!this.settings.revert&&(stage.css.setStyle(this.element,{left:this.currentPointer[0]-this.offsetClone[0],top:this.currentPointer[1]-this.offsetClone[1]}),stage.remove(this.clone)),this.settings.canDrop&&n(b,this),this.settings.revert?this.state="revert":this.settings.zindex&&stage.css.setStyle(this.element,{zIndex:this.originZindex}),this.dragEvents.fireEvent("onDragEnd",b,this)):(this.settings.ghosting&&stage.remove(this.clone),this.settings.zindex&&stage.css.setStyle(this.element,{zIndex:this.originZindex}))};
var t=[],r=null;t.isElementRegistred=function(b){var h=!1;stage.each(this,function(e){e.element===b&&(h=e)});return h};var f=function(b,h){stage.each(t,function(e,d){"*"===e.settings.accept?e.isDragInside(b,h):stage.css.hasClass(h.element,e.settings.accept)&&e.isDragInside(b,h)})},n=function(b,h){stage.each(t,function(e,d){e.isDropInside(b,h)})},B={active:!0,activeClass:!1,accept:"*",hoverClass:!1,overlap:"pointer",overlapTolerence:.5,settingsToListen:!0},w=function(b,h){if(b){this.element=b;this.settings=
stage.extend(!0,{},B,h);this.error=null;this.dropEvents=stage.createEventsManager();if(!0===this.attachDrop(this.element,this))return this.error=Error("droppable is already register"),this.dropEvents.fireEvent("onError",null,this,0),this;this.overlap=E.call(this);this.dragInside=!1;this.settings.settingsToListen&&this.dropEvents.settingsToListen(this.settings,this)}},D=function(b,h){return h.currentPointer[0]>=this.layout[0]&&h.currentPointer[0]<this.layout[1]&&h.currentPointer[1]>=this.layout[2]&&
h.currentPointer[1]<this.layout[3]},A=function(b,h){},H=function(b,h){},e=function(b,h){},E=function(){switch(this.settings.overlap){case "pointer":return D.bind(this);case "fit":return A.bind(this);case "intersect":return H.bind(this);case "touch":return e.bind(this);default:return D.bind(this)}};w.prototype.isDragInside=function(b,h){this.documentOffset=stage.position.documentOffset(this.element);this.layout=[this.documentOffset[0],this.documentOffset[0]+stage.css.getWidth(this.element),this.documentOffset[1],
this.documentOffset[1]+stage.css.getHeight(this.element)];var e=this.overlap(b,h);if(!1===this.dragInside&&!0===e)return p.call(this,b,h,e);if(!0===this.dragInside&&!1===e)return this.dropEvents.fireEvent("onDragLeave",b,this,h),this.settings.hoverClass&&stage.css.removeClass(this.element,this.settings.hoverClass),stage.array.remove(F,this),r===this&&(r=null),b=!r&&F[0]?p.call(this,b,h,e,!0):this.dragInside=e,b;if(!0===e)return r===this&&r.dropEvents.fireEvent("onDragOver",b,r,h),this.dragInside=
e};var F=[],p=function(b,h,e,d){d||F.push(this);r||(F[0].dropEvents.fireEvent("onDragEnter",b,F[0],h),F[0].settings.hoverClass&&stage.css.addClass(F[0].element,F[0].settings.hoverClass),r=F[0]);return this.dragInside=e};w.prototype.isDropInside=function(b,h){this.dragInside&&this===r&&(this.dropEvents.fireEvent("onDrop",b,this,h),stage.css.removeClass(this.element,this.settings.hoverClass),this.dragInside=!1,stage.array.remove(F),r=null)};w.prototype.attachDrop=function(){var b=stage.array.contain(t,
this)?!0:t.push(this);return b};w.prototype.detachDrop=function(){var b=stage.array.contain(t,this)?stage.array.remove(t,this):!1;return b};var m="* { -khtml-user-select: none; -webkit-user-select: none;-moz-user-select:none;user-select:none;}",h="* { -khtml-user-select: auto; -webkit-user-select: auto;-moz-user-select:auto;user-select:auto;}",v=null;return{drops:t,nativeDrag:!1,_onLoad:function(){var b=document.getElementsByTagName("head")[0];v=document.createElement("style");v.innerHTML=h;b.appendChild(v)},
local:{draggable:function(b,h){return new q(b,h)},droppable:function(b,h){return new w(b,h)}},$$stage:{draggable:function(b){new q(this,b)},droppable:function(b){new w(this,b)}}}});stage.provide("ui.resize");stage.require("array");stage.require("events");stage.require("dom");stage.require("position");stage.require("ui.gestural");
stage.register.call(stage.ui,"resize",function(){var b={disable:!1,animate:!1,handles:["s","e","se"],zIndex:100,colResize:!1,ghosting:!1,containment:null,snapToGrid:null,respectRatio:!1,maxWidth:1280,maxHeight:1024,minWidth:0,minHeight:0,mouseClick:"left",settingsToListen:!0},d=function(b,d,k){d=[{tagName:"div",position:"top",returnActive:!0,attributes:{style:d[1]+"display:block;font-size:0.1px;position:absolute;'z-index':99999;"},events:[{onEvent:"mousedown",callback:stage.setContext(function(b){this.eventStop(b);
this.maskHandle=k;this.resizeEvents.fireEvent("onMouseDown",b,this)},this)}]}];return stage.build(b,d)},u=function(){var b=this.settings.colResize?{n:[1,"cursor:col-resize;height:8px;top:-3px;width:100%;"],ne:[8,"cursor:ne-resize;top: 2px;height: 12px;right: 2px;width: 12px;"],e:[64,"cursor:"+(stage.browser.Opera?"e-resize":"col-resize")+";height:100%;right:-3px;top:0;width:8px;"],se:[512,"cursor:se-resize;bottom: 2px;height: 12px;right: 2px;width: 12px;"],s:[4096,"cursor:col-resize;bottom: -5px;height: 8px;left: 0;width: 100%;"],
sw:[32768,"cursor:sw-resize;bottom: 2px;height: 12px;left:2px;width: 12px;"],w:[262144,"cursor:col-resize;height:100%;left:-3px;bottom:0px;width:8px;"],nw:[2097152,"cursor:nw-resize;top: 2px;height: 12px;left:2px;width: 12px;"]}:{n:[1,"cursor:n-resize;height:8px;top:-3px;width:100%;"],ne:[8,"cursor:ne-resize;top: 2px;height: 12px;right: 2px;width: 12px;"],e:[64,"cursor:e-resize;height:100%;right:-3px;top:0;width:8px;"],se:[512,"cursor:se-resize;bottom: 2px;height: 12px;right: 2px;width: 12px;"],s:[4096,
"cursor:s-resize;bottom: -5px;height: 8px;left: 0;width: 100%;"],sw:[32768,"cursor:sw-resize;bottom: 2px;height: 12px;left:2px;width: 12px;"],w:[262144,"cursor:w-resize;height:100%;left:-3px;bottom:0px;width:8px;"],nw:[2097152,"cursor:nw-resize;top: 2px;height: 12px;left:2px;width: 12px;"]};this.regionMask=b;b=[];for(var g=0,k=0;k<this.handles.length;k++)g|=this.regionMask[this.handles[k]][0];this.regionMask.n[0]&g&&b.push(d.call(this,this.element,this.regionMask.n,this.regionMask.n[0]));this.regionMask.ne[0]&
g&&b.push(d.call(this,this.element,this.regionMask.ne,this.regionMask.e[0]|this.regionMask.n[0]));this.regionMask.e[0]&g&&b.push(d.call(this,this.element,this.regionMask.e,this.regionMask.e[0]));this.regionMask.se[0]&g&&b.push(d.call(this,this.element,this.regionMask.se,this.regionMask.e[0]|this.regionMask.s[0]));this.regionMask.s[0]&g&&b.push(d.call(this,this.element,this.regionMask.s,this.regionMask.s[0]));this.regionMask.sw[0]&g&&b.push(d.call(this,this.element,this.regionMask.sw,this.regionMask.w[0]|
this.regionMask.s[0]));this.regionMask.w[0]&g&&b.push(d.call(this,this.element,this.regionMask.w,this.regionMask.w[0]));this.regionMask.nw[0]&g&&b.push(d.call(this,this.element,this.regionMask.nw,this.regionMask.w[0]|this.regionMask.n[0]));return b},k=stage.herite(function(d,g){d&&(this.element=d,this.settings=stage.extend(!0,{},b,g),this.error=null,this.resizeEvents=stage.createEventsManager(),this.settings.settingsToListen&&this.resizeEvents.settingsToListen(g,this),this.handles=g.handles?g.handles:
this.settings.handles,this.maskHandle=null,this.gestural=this.$super,this.gestural.constructor(u.call(this),this.settings))},stage.ui.gestural);k.prototype.startGesture=function(b){if(this.gestural.startGesture(b,this.element)){this.progress=!1;this.originSize=stage.css.getClientWH(this.element);this.width=this.originSize.width;this.left=stage.position.ancestorOffset(this.element)[0];this.top=stage.position.ancestorOffset(this.element)[1];if(this.settings.ghosting){this.clone=this.element.cloneNode(!0);
if(this.originPosAbsolute)stage.css.setStyle(this.clone,{opacity:.5});else{var d=stage.position.ancestorOffset(this.element);stage.css.setStyle(this.clone,{opacity:.5,position:"absolute",left:d[0],top:d[1]})}this.element.parentNode.appendChild(this.clone)}else this.clone=this.element;stage.css.setStyle(this.element,"overflow","hidden");this.offsetN=this.startPosition[1]+this.originSize.height;this.offsetW=this.startPosition[0]+this.originSize.width;this.offsetSE=[this.originSize[1]-this.startPointer[0],
this.originSize[0]-this.startPointer[1]];this.region="";this.maskHandle&this.regionMask.s[0]?this.region+="s":this.maskHandle&this.regionMask.n[0]&&(this.region+="n");this.maskHandle&this.regionMask.e[0]?this.region+="e":this.maskHandle&this.regionMask.w[0]&&(this.region+="w");this.settings.containment&&(this.offset=[this.startPointer[0]-this.startPosition[0],this.startPointer[1]-this.startPosition[1]]);this.settings.snapToGrid&&(this.settings.minWidth=this.settings.snapToGrid[0],this.settings.minHeight=
this.settings.snapToGrid[1]);this.resizeEvents.fireEvent("onStart",b,this)}};k.prototype.stopGesture=function(b){this.gestural.stopGesture(b);this.maskHandle=null;this.settings.snapToGrid&&(this.heightBack=this.widthBack=null);this.settings.ghosting&&(void 0!=this.width&&stage.css.setStyle(this.element,"width",this.width),void 0!=this.height&&stage.css.setStyle(this.element,"height",this.height),void 0!=this.top&&stage.css.setStyle(this.element,"top",this.top),void 0!=this.left&&stage.css.setStyle(this.element,
"left",this.left),stage.remove(this.clone));this.resizeEvents.fireEvent("onResizeEnd",b,this);this.progress=!1};k.prototype.progressGesture=function(b){this.resizeEvents.fireEvent("onResizeStart",b,this);this.progress=this.gestural.progressGesture(b);var d=!1,k=!1,l=!1,r=!1,f=!0;if(this.maskHandle&this.regionMask.s[0]){this.height=this.currentPointer[1]+this.offsetSE[1];this.settings.minHeight>this.height&&(this.height=this.settings.minHeight,f=!1);this.settings.maxHeight<this.height&&(this.height=
this.settings.maxHeight,f=!1);this.settings.snapToGrid&&(this.height=Math.round(this.height/this.settings.snapToGrid[1])*this.settings.snapToGrid[1]);if(this.settings.containment){var n=$$stage(this.element);d=n.css("border-top-width")+n.css("border-bottom-width");this.height>this.heightMaxBottom-d&&(this.height=this.heightMaxBottom-d,this.clone.style.height=this.height+"px")}d=!0}else if(this.maskHandle&this.regionMask.n[0]){l=!0;n=$$stage(this.element);d=n.css("border-top-width")+n.css("border-bottom-width");
n=this.startPointer[1]-this.currentPointer[1];this.height=this.originSize.height+n;this.settings.minHeight>=this.height&&(this.height=this.settings.minHeight,this.top=this.startPosition[1]+(this.originSize.height-this.settings.minHeight),this.clone.style.top=this.top+"px",f=l=!1);this.settings.maxHeight<=this.height&&(this.height=this.settings.maxHeight,f=l=!1);if(this.settings.snapToGrid){this.height=Math.round(this.height/this.settings.snapToGrid[1])*this.settings.snapToGrid[1];if(this.heightBack&&
this.heightBack===this.height||!this.heightBack)l=!1;this.heightBack=this.height}l&&(this.top=this.settings.snapToGrid?this.currentPointer[1]>this.top?stage.position.ancestorOffset(this.element)[1]+this.settings.snapToGrid[1]:stage.position.ancestorOffset(this.element)[1]-this.settings.snapToGrid[1]:this.startPosition[1]-n);this.settings.containment&&(this.height>this.heightMaxTop-d?(this.height=this.heightMaxTop-d,this.top=0):l&&(this.top=this.startPosition[1]-n));d=!0}if(this.maskHandle&this.regionMask.e[0])this.width=
this.currentPointer[0]+this.offsetSE[0],this.settings.minWidth>=this.width&&(this.width=this.settings.minWidth,f=!1),this.settings.maxWidth<=this.width&&(this.width=this.settings.maxWidth,f=!1),this.settings.snapToGrid&&(this.width=Math.round(this.width/this.settings.snapToGrid[0])*this.settings.snapToGrid[0]),this.settings.containment&&(n=$$stage(this.element),k=n.css("border-right-width")+n.css("border-left-width"),this.width>this.widthMaxRight-k&&(this.width=this.widthMaxRight-k,this.clone.style.width=
this.width+"px")),k=!0;else if(this.maskHandle&this.regionMask.w[0]){r=!0;n=$$stage(this.element);k=n.css("border-left-width")+n.css("border-right-width");this.width=this.settings.containment?this.offsetW-(this.currentPointer[0]-this.offsetContainment):this.offsetW-this.currentPointer[0];this.settings.minWidth>=this.width&&(this.width=this.settings.minWidth,f=r=!1);this.settings.maxWidth<=this.width&&(this.width=this.settings.maxWidth,f=r=!1);if(this.settings.snapToGrid){this.width=Math.round(this.width/
this.settings.snapToGrid[0])*this.settings.snapToGrid[0];if(this.widthBack&&this.widthBack===this.width||!this.widthBack)r=!1;this.widthBack=this.width}r&&(this.left=this.settings.snapToGrid?this.currentPointer[0]>this.left?stage.position.ancestorOffset(this.element)[0]+this.settings.snapToGrid[0]:stage.position.ancestorOffset(this.element)[0]-this.settings.snapToGrid[0]:this.settings.containment?this.currentPointer[0]-this.offsetContainment:this.currentPointer[0]);this.settings.containment&&(console.log(this.widthMaxLeft),
this.width>this.widthMaxLeft-k&&(this.width=this.widthMaxLeft-k,this.left=0));k=!0}k&&(this.clone.style.width=this.width+"px");d&&(this.clone.style.height=this.height+"px");r&&(this.clone.style.left=this.left+"px");l&&(this.clone.style.top=this.top+"px");f&&this.resizeEvents.fireEvent("onResize",b,this)};return{resizable:k,cardinal:{north:"n",south:"s",east:"e",west:"w"},local:{resizable:function(b,d){return stage.browser.Ie?null:new k(b,d)}},$$stage:{resizable:function(b){new k(this,b)}}}});stage.provide("ui.sortable");
stage.require("ui.dragdrop");
stage.register.call(stage.ui,"sortable",function(){var b={dragContainment:null,dragConstraint:null,accept:"*",classHandleDrag:null,settingsToListen:!0},d=function(b,d){var f=stage.css.getHeight(b.element);f=Math.floor((this.yStartMouse-stage.position.ancestorsOffset(d.element).top)/f);f=stage.dom.children(d.element)[f];this.ghost||this.createGhost(b,d.element);f?stage.dom.insert(f,this.detachGhost(),"before"):stage.dom.attach(this.detachGhost(),d.element,"bottom")},u=function(b,d){stage.dom.attach(stage.dom.detach(b.element),
d.element,"bottom");stage.dom.attach(stage.dom.detach(b.clone),d.element,"bottom");var f=Math.floor(stage.css.getWidth(d.element)/stage.css.getWidth(b.clone)),g=stage.dom.children(d.element).length-2,n=Math.floor(g/f),k=0===g%f,l=stage.css.getHeight(b.element),e=stage.css.getWidth(b.element),r=Math.floor((this.yStartMouse-stage.position.ancestorsOffset(d.element).top)/l);r>n&&(r=n);var q=Math.floor((this.xStartMouse-stage.position.ancestorsOffset(d.element).left)/e)+1;q>f&&(q=f);k&&r===n&&1!==q&&
--r;f=f*r+q-1;f>g&&(f=g);g=stage.dom.children(d.element)[f];this.ghost||this.createGhost(b,d.element);g&&stage.dom.insert(g,this.detachGhost(),"before");stage.dom.attach(stage.dom.detach(b.clone),this.ghost,"before");stage.dom.attach(stage.dom.detach(b.element),this.ghost,"after");this.yStartMouse=stage.position.ancestorsOffset(d.element).top+r*l+l/2;this.xStartMouse=stage.position.ancestorsOffset(d.element).left+(q-1)*e+e/2},k=function(b,d,g){var f=Math.floor(stage.css.getWidth(d.element)/stage.css.getWidth(this.ghost)),
n=stage.css.getWidth(this.ghost),k=b.pointerX(),r=this.xStartMouse-b.pointerX();if(Math.abs(r)>n/2){if(0<r){if(k-n/2<stage.position.ancestorsOffset(d.element).left)return;for(k=stage.dom.prev(g.clone);k&&!stage.dom.visible(k)||k&&k===this.ghost;)k=stage.dom.prev(k);if(!k)return;stage.dom.insert(k,this.detachGhost(),"before");this.xStartMouse=b.pointerX()-n/2}else{if(k+n/2>stage.css.getWidth(d.element)+stage.position.ancestorsOffset(d.element).left)return;for(k=stage.dom.next(this.ghost);k&&!stage.dom.visible(k);)k=
stage.dom.next(k);if(!k)return;stage.dom.insert(k,this.detachGhost(),"after");this.xStartMouse=b.pointerX()+n/2}stage.dom.insert(this.ghost,stage.dom.detach(g.clone),"before");stage.dom.insert(this.ghost,stage.dom.detach(g.element),"after")}n=stage.css.getHeight(this.ghost);k=b.pointerY();r=this.yStartMouse-b.pointerY();if(Math.abs(r)>n/2){if(0<r){if(k-n/2<stage.position.ancestorsOffset(d.element).top)return;r=stage.dom.children(d.element);for(var e=0;r[e]!==g.clone;)e++;stage.dom.insert(r[e-f],this.detachGhost(),
"before");this.yStartMouse=b.pointerY()-n/2}else{r=stage.dom.children(d.element);for(e=0;r[e]!==g.clone;)e++;if(r.length-2-e<=f||k+n/2>stage.css.getHeight(d.element)+stage.position.ancestorsOffset(d.element).top)return;d=e+f<r.length-2?e+f:r.length-3;stage.dom.insert(r[d+2],this.detachGhost(),"after");this.yStartMouse=b.pointerY()+n/2}stage.dom.insert(this.ghost,stage.dom.detach(g.clone),"before");stage.dom.insert(this.ghost,stage.dom.detach(g.element),"after")}},l=function(b,d,g){b=new stage.mouseEvents(b);
b.eventStop();if(d.element!==g.element)if(this.settings.floatable)k.call(this,b,d,g);else if("vertical"===this.settings.dragConstraint||!this.settings.dragConstraint)a:{d=stage.css.getHeight(this.ghost);b.pointerY();var f=this.yStartMouse-b.pointerY();if(Math.abs(f)>d/2){if(0<f){for(d=stage.dom.prev(g.clone);d&&!stage.dom.visible(d)||d&&d===this.ghost;)d=stage.dom.prev(d);if(!d)break a;stage.dom.insert(d,this.detachGhost(),"before");this.yStartMouse=b.pointerY()-stage.css.getHeight(d)/2}else{for(d=
stage.dom.next(this.ghost);d&&!stage.dom.visible(d);)d=stage.dom.next(d);if(!d)break a;stage.dom.insert(d,this.detachGhost(),"after");this.yStartMouse=b.pointerY()+stage.css.getHeight(d)/2}stage.position.ancestorsOffset(this.ghost);stage.css.getHeight(d);stage.dom.insert(this.ghost,stage.dom.detach(g.clone),"before")}}},g=function(b,d,g){d.element!==g.element&&(stage.dom.attach(stage.dom.detach(g.element),this.ghost,"before"),this.removeGhost(),stage.dom.show(g.element),stage.css.setStyle(g.element,
"display",null),this.sortEvents.fire("onSort",g.element))},q=function(b,d,g){g.settings.containment!==d.element&&this.removeGhost();this.dragLeave=!0},t=function(b,g,k){this.yStartMouse=(new stage.mouseEvents(b)).pointerY();this.xStartMouse=(new stage.mouseEvents(b)).pointerX();stage.dom.parent(k.element)===this.drop.element?this.dragLeave?this.settings.floatable?u.call(this,k,g):d.call(this,k,g):this.ghost||this.createGhost(k,this.drop.element):this.settings.floatable?(stage.dom.attach(stage.dom.detach(k.clone),
this.drop.element,"bottom"),stage.dom.attach(stage.dom.detach(k.element),this.drop.element,"bottom"),u.call(this,k,g)):(stage.dom.attach(stage.dom.detach(k.clone),this.drop.element,"bottom"),stage.dom.attach(stage.dom.detach(k.element),this.drop.element,"bottom"),d.call(this,k,g),stage.dom.insert(this.ghost,stage.dom.detach(k.clone),"before"));stage.dom.hide(k.element);this.dragLeave=!1},r=function(d,n){this.element=d;this.settings=stage.extend(!0,{},b,n);this.drop=stage.ui.droppable(d,{accept:this.settings.accept});
this.sortEvents=stage.createEventsManager();this.drop.dropEvents.listen(this,"onDragEnter",t);this.drop.dropEvents.listen(this,"onDragOver",l);this.drop.dropEvents.listen(this,"onDragLeave",q);this.drop.dropEvents.listen(this,"onDrop",g);this.sortEvents.settingsToListen(this.settings,this);this.sortables="*"===this.settings.accept?stage.dom.children(d):$$stage("."+this.settings.accept,this.element).selector;for(d=0;d<this.sortables.length;d++)this.attachSortable(this.sortables[d])};r.prototype.attachSortable=
function(b){var d=this.settings.classHandleDrag?$$stage(b).find("."+this.settings.classHandleDrag).get(0):null;d=stage.ui.draggable(b,{canDrop:!0,ghosting:!0,handle:d,constraint:this.settings.dragConstraint,containment:this.settings.containment});d.dragEvents.listen(this,"onDragEnd",function(b,d){stage.dom.visible(d.element)||stage.css.setStyle(d.element,"display",null);this.ghost&&(stage.dom.attach(stage.dom.detach(d.element),this.ghost,"before"),this.removeGhost())});d.dragEvents.listen(this,"onDragStart",
function(b,d){});return b};r.prototype.createGhost=function(b,d){this.ghost=stage.clone(b.element,!1);stage.css.setStyle(this.ghost,{border:"1px dashed black",backgroundColor:"grey",opacity:.3,display:null});return stage.dom.insert(b.element,this.ghost,"before")};r.prototype.detachGhost=function(){return stage.dom.detach(this.ghost)};r.prototype.removeGhost=function(){this.ghost&&(stage.remove(this.ghost),this.ghost=null)};r.prototype.detachSortable=function(b,d){};return{stage:{sortable:function(b,
d){return new r(b,d)}},$$stage:{sortable:function(b){new r(this,b)}}}});stage.provide("ui.coreContainer");stage.require("ui");
stage.register.call(stage.ui,"coreContainer",function(){var b=/^[0-9]{1,3}%$/,d=/^[0-9]{1,3}px$/,u=1E4,k=1,l=function(b,d){this.element=b;this.eventsManager=d||stage.createEventsManager();stage.dom.setAttribute(this.element,"tabindex",k);k+=1;stage.listen(this.element,"focus",function(b){this.zindex=u+=1;stage.css.setStyle(this.element,"z-index",u);stage.css.addClass(this.element,"stageui-box-shadow-plus");this.eventsManager.fireEvent("onFocus",b)}.bind(this));stage.listen(this.element,"blur",function(b){stage.css.removeClass(this.element,
"stageui-box-shadow-plus");this.eventsManager.fireEvent("onBlur",b)}.bind(this))};l.prototype.focus=function(){return this.element.focus()};l.prototype.blur=function(){return this.element.blur()};var g={type:"simple",align:"left",slots:[]},q=function(b,d){this.settings=this.extendSettings(d);this.eventsManager=stage.createEventsManager(this.settings,this);this.eventsManager.listen(this,"onResizeEnd",this.bubbleResizeLayout);this.container=b||document.createElement("div");this.body=null;this.width=
this.settings.width;this.height=this.settings.height;this.top=this.settings.display.top;this.left=this.settings.display.left;this.bodyDims=[];this.bordersRL=this.bordersTB=0;this.layout=null;this.parent=this.settings.appendTo||stage.dom.parent(this.container)||document.body;this.rendered=!1;this.buildContainer();this.buildBody();("center"===this.settings.display.position&&!this.settings.draggable||"centerFixed"===this.settings.display.position)&&stage.stageGlobalEvents.listen(this,"onResize",this.render)};
q.prototype.globalSettings={id:null,display:{position:"relative",left:0,top:0},typeContainer:"html",typeSettings:null,html:null,url:null,width:"auto",height:"auto",border:"1",bodyPadding:"5",margin:"0",resizable:!1,draggable:!1,showContentDrag:!1,droppable:!1,overflow:"hidden",appendTo:null,build:!0,render:!0,focusable:!1,autofocus:!1,containerClass:"",containerStyle:"",bodyClass:"",bodyStyle:"",layout:null,effect:null};q.prototype.bubbleResizeLayout=function(b,d){this.layout&&this.layout.render()};
q.prototype.buildContainer=function(){stage.css.addClass(this.container,"stageui-widget stageui-widget-content stageui-container stageui-border-box "+this.settings.containerClass);this.settings.containerStyle&&stage.css.setStyle(this.container,this.settings.containerStyle);this.settings.id&&stage.dom.setAttribute(this.container,"id",this.settings.id);this.body=document.createElement("div");stage.css.addClass(this.body,"stageui-container-body stageui-border-box "+this.settings.bodyClass);this.settings.bodyStyle&&
stage.css.setStyle(this.body,this.settings.bodyStyle);this.settings.focusable&&(this.focusManager=new l(this.container,this.eventsManager),this.focus=this.focusManager.focus.bind(this.focusManager),this.blur=this.focusManager.blur.bind(this.focusManager))};q.prototype.buildBody=function(){var b=this.settings.typeContainer;"html"===b?this.settings.html?this.html(this.settings.html):this.html(this.container.innerHTML):b in stage.ui.coreContainer.containers?stage.ui.coreContainer.containers[b].call(this):
stage.ui.error("Container type error");stage.empty(this.container)};q.prototype.resizable=function(b){switch(typeof this.settings.resizable){case "object":this.settings.resizable=stage.extend({ghosting:!0,settingsToListen:!1},this.settings.resizable,b);break;case "string":this.settings.resizable in stage.ui.resize.cardinal&&(this.settings.resizable=stage.extend({ghosting:!0,settingsToListen:!1,handles:[stage.ui.resize.cardinal[this.settings.resizable]]},b));break;case "boolean":this.settings.resizable=
stage.extend({ghosting:!0,settingsToListen:!1},b);break;default:throw Error("resisable container settings error");}this.resize=stage.ui.resizable(this.container,this.settings.resizable);this.resize.resizeEvents.listen(this,"onResizeStart",function(b,d){$$stage(d.clone).removeClass("stageui-box-shadow").css({zIndex:this.focusManager?this.focusManager.zindex+1:"auto",background:"none",borderWidth:"2px",borderStyle:"dashed",borderColor:"#000"}).children().hide()});this.resize.resizeEvents.listen(this,
"onResizeEnd",function(b,d){d.width&&(this.width=d.width);d.height&&(this.height=d.height);this.rendered=!1;this.renderBody();this.eventsManager.fireEvent("onResizeEnd",b,d)});this.resize.resizeEvents.settingsToListen(this.settings.resizable)};q.prototype.disableResizable=function(){this.resize&&this.resize.disableGesture()};q.prototype.enableResizable=function(){this.resize&&this.resize.enableGesture()};q.prototype.draggable=function(b){this.settings.draggable="object"===typeof this.settings.draggable?
stage.extend({settingsToListen:!1},this.settings.draggable,b):stage.extend({settingsToListen:!1},b);this.drag=stage.ui.draggable(this.container,this.settings.draggable);this.settings.showContentDrag||(this.drag.dragEvents.listen(this,"onDragStart",function(b,d){stage.css.setStyle(this.body,"display","none")}),this.drag.dragEvents.listen(this,"onDragEnd",function(b,d){stage.css.setStyle(this.body,"display","block")}));this.drag.dragEvents.settingsToListen(this.settings.draggable)};q.prototype.disableDraggable=
function(){this.drag&&this.drag.disableGesture()};q.prototype.enableDraggable=function(){this.drag&&this.drag.enableGesture()};q.prototype.droppable=function(b){this.settings.droppable="object"===typeof this.settings.droppable?stage.extend({settingsToListen:!1},this.settings.droppable,b):stage.extend({settingsToListen:!1},b);this.drop=stage.ui.droppable(this.body,this.settings.droppable);this.drop.dropEvents.settingsToListen(this.settings.droppable)};q.prototype.transformDims=function(g,k,f){var n=
g?"width":"height";if("number"==typeof k)this[n]=k;else if(b.test(k)){var l=stage.css.getWH(this.parent);l[g]=l[g]*parseInt(k)/100;this[n]=l[g]}else"auto"===k?(g?this.width=stage.css.getWidth(this.parent):l=stage.css.getHeight(this.body)+2+(f?f:0)+this.settings.bodyPadding.top+this.settings.bodyPadding.bottom,this[n]=l):d.test(k)&&(this[n]=parseInt(k))};q.prototype.transformWidth=function(b){this.transformDims(1,b)};q.prototype.transformHeight=function(b){this.transformDims(0,b)};q.prototype.getDimensions=
function(){var b=this.width-this.bordersRL,d=this.height-this.bordersTB;this.bodyDims[0]=d-this.settings.bodyPadding.top-this.settings.bodyPadding.bottom;this.bodyDims[1]=b-this.settings.bodyPadding.left-this.settings.bodyPadding.right;return{width:b,height:d,top:0,left:0}};q.prototype.render=function(b){b&&(this.settings=stage.extend(!0,{},this.settings,b));this.settings.autofocus&&this.focus();this.transformDims(1,this.settings.width);this.transformDims(0,this.settings.height);this.top=this.settings.display.top;
this.left=this.settings.display.left;switch(this.settings.display.position){case "center":stage.css.setStyle(this.container,"position","absolute");b=stage.viewport.scrollLeft();var d=stage.viewport.scrollTop();var f=stage.viewport.clientWidth();var g=stage.viewport.clientHeight();this.left=(b+f-this.width)/2;this.top=(d+g-this.height)/2;break;case "centerFixed":stage.css.setStyle(this.container,"position","fixed");b=stage.viewport.scrollLeft();d=stage.viewport.scrollTop();f=stage.viewport.clientWidth();
g=stage.viewport.clientHeight();this.left=(f-this.width)/2;this.top=(g-this.height)/2;break;case "absolute":stage.css.setStyle(this.container,"position","absolute");break;case "fixed":stage.css.setStyle(this.container,"position","fixed");break;default:stage.css.setStyle(this.container,"position","relative")}this.settings.effect?(b=stage.ui.animate(null,{}),b.addEffect(this.container,"css",{duration:1,transition:this.settings.effect,onStart:function(b){this.renderBody();this.layout&&this.layout.render()}.bind(this),
onStop:function(b){this.rendered=!0}.bind(this),css:{width:this.width,height:this.height,top:this.top,left:this.left}}),b.play()):(stage.css.setStyle(this.container,{width:this.width,height:this.height,top:this.top,left:this.left}),this.renderBody(),this.layout&&this.layout.render(),this.rendered=!0)};q.prototype.renderBody=function(){var b=this.getDimensions();stage.css.setStyle(this.body,{width:b.width,height:b.height,top:b.top,left:b.left});this.eventsManager.fireEvent("onRender",this)};q.prototype.build=
function(b){b&&(this.settings=stage.extend(!0,this.settings,b));this.settings.border=this.extractDims(this.settings.border);this.settings.bodyPadding=this.extractDims(this.settings.bodyPadding);this.settings.margin=this.extractDims(this.settings.margin);this.bordersTB=this.settings.border.top+this.settings.border.bottom;this.bordersRL=this.settings.border.right+this.settings.border.left;stage.dom.insert(this.parent,this.container);stage.dom.insert(this.container,this.body);stage.css.setStyle(this.body,
{overflow:this.settings.overflow,padding:[this.settings.bodyPadding.top,this.settings.bodyPadding.right,this.settings.bodyPadding.bottom,this.settings.bodyPadding.left].join("px ")});stage.css.setStyle(this.container,{margin:[this.settings.margin.top,this.settings.margin.right,this.settings.margin.bottom,this.settings.margin.left].join("px "),borderWidth:[this.settings.border.top,this.settings.border.right,this.settings.border.bottom,this.settings.border.left].join("px ")});this.settings.resizable&&
this.resizable();this.settings.draggable&&this.draggable();this.settings.droppable&&this.droppable();this.settings.layout&&(this.layoutSettings=!0,b=stage.extend(!0,{},g,this.settings.layout),this.createLayout(b.type,b));this.settings.render&&this.render()};q.prototype.destroy=function(){this.drop&&this.drop.detachDrop();if(this.layout)for(var b=0;b<this.layout.nbslots;b++)this.layout.slots[b].destroy();("center"===this.settings.display.position&&!this.settings.draggable||"centerFixed"===this.settings.display.position)&&
stage.stageGlobalEvents.detachEvent("onResize",this.render);stage.remove(this.container)};q.prototype.createLayout=function(b,d){if(this.layout)throw Error("Container has already an instance of layout ");return this.layout=new stage.ui.createLayout(b,this,d)};q.prototype.getLayout=function(){return this.layout||null};q.prototype.html=function(b){stage.update(this.body,b)};q.prototype.getHtml=function(){return this.body};q.prototype.buildContent=function(b){return stage.dom.build(this.body,b)};q.prototype.extractDims=
function(b){if("object"==typeof b)return{top:b.top||0,right:b.right||0,bottom:b.bottom||0,left:b.left||0};b=b.split(" ");switch(b.length){case 1:b[3]=b[2]=b[1]=b[0];break;case 2:b[2]=b[0];b[3]=b[1];break;case 3:b[3]=b[1]}return{top:parseFloat(b[0]),right:parseFloat(b[1]),bottom:parseFloat(b[2]),left:parseFloat(b[3])}};return{containers:{},registerContainer:function(b,d){if(b in stage.ui.coreContainer.containers)throw Error("container :"+b+" already exist");d=d();return stage.ui.coreContainer.containers[b]=
d},extractDims:q.prototype.extractDims,focusManager:l,regPixel:d,regPercent:b,container:q}});stage.provide("ui.container");stage.require("ui");stage.require("ui.coreContainer");stage.ui.registerPlugin("container",function(){return{version:1,globalSettings:null,herite:stage.ui.coreContainer.container,plugin:function(b,d){this.container_mother=this.$super;this.container_mother.constructor(b,d)}}});stage.provide("ui.coreLayout");stage.require("ui");stage.require("ui.container");
stage.register.call(stage.ui,"coreLayout",function(){var b={area:"auto",align:"stretch",slots:[],sortable:!1,globals:null},d={ctype:"container",flex:0,border:"1",bodyPadding:"5",margin:"0",draggable:!1,resizable:!1,display:{position:"absolute"},render:!1},u=function(b,k){if(b)b=k?stage.extend(!0,{},d,b):b;else return b=stage.extend(!0,{},d);b.margin&&(b.margin=stage.ui.coreContainer.extractDims(b.margin));b.border&&(b.border=stage.ui.coreContainer.extractDims(b.border));b.bodyPadding&&(b.bodyPadding=
stage.ui.coreContainer.extractDims(b.bodyPadding));return b},k=function(d,k){this.settings=stage.extend(!0,{},b,k);this.container=d;this.parent=d.body;this.slots=[];this.slotsSanitized=[];this.slotsSanitized.backup=[];this.nbslots=this.availableSpace=this.flexRatioValue=this.flexRatio=0;this.area=this.settings.area;switch(this.area){case "vertical":this.SIDE=0;this._SIDE=1;this.boxDim="height";this._boxDim="width";this.boxPos="top";this._boxPos="left";this.boxPos2="bottom";this.resizeRegion="north";
this._resizeRegion="south";break;case "horizontal":this.SIDE=1,this._SIDE=0,this.boxDim="width",this._boxDim="height",this.boxPos="left",this._boxPos="top",this.boxPos2="right",this.resizeRegion="west",this._resizeRegion="east"}this.settings.sortable&&stage.sortable&&(this.sortable=stage.sortable(this.container.body,{classHandleDrag:"stageui-widget-header",dragConstraint:this.area,dragContainment:!0,accept:"stageui-container"}));if(this.settings.slots.length)for(d=0;d<this.settings.slots.length;d++)this.addSlot(this.settings.slots[d])};
k.prototype.addSlot=function(b){var d=this.settings.globals?u(stage.extend(!0,{},this.settings.globals,b),!0):u(b,!0);"auto"===this.area&&(d.render=!0);d.appendTo=this.parent;d.draggable&&d.draggable.containment&&!0===d.draggable.containment&&(d.draggable.containment=this.parent);d.resizable&&d.resizable.containment&&!0===d.resizable.containment&&(d.resizable.containment=this.parent);this.flexRatio+=parseInt(d.flex,10);try{if(d.ctype in stage.ui){var g=stage.ui[d.ctype](d);this.nbslots=this.slots.push(g);
g.indexLayout=this.nbslots-1;this.slotsSanitized.push(d);b[this.boxDim]=d[this.boxDim];this.slotsSanitized.backup.push(b)}else throw Error("STAGE LAYOUT CONTAINER TYPE :  "+d.ctype+" not exist");}catch(r){throw Error("STAGE LAYOUT :  "+r);}g.resize&&"auto"!==this.area&&g.eventsManager.listen(this,"onResizeEnd",function(b,d){d[this.boxDim]&&(this.flexRatio-=this.slotsSanitized[g.indexLayout].flex,this.slotsSanitized[g.indexLayout].flex=0,this.slotsSanitized.backup[g.indexLayout][this.boxDim]=this.slotsSanitized[g.indexLayout][this.boxDim]=
d[this.boxDim]);this.render()});this.sortable&&this.sortable.attachSortable(g.container);return g};k.prototype.render=function(){if("auto"!=this.area){this.setupLayout();for(var b=0;b<this.slots.length;b++)this.doLayout(b),this.slots[b].render(this.slotsSanitized[b])}};k.prototype.setupLayout=function(){this.availableSpace=this.container.bodyDims[this.SIDE];for(var b=0;b<this.nbslots;b++)if("stretch"==this.settings.align&&(this.slotsSanitized[b][this._boxDim]=this.container.bodyDims[this._SIDE]),
0==this.slotsSanitized[b].flex){var d=this.slotsSanitized.backup[b][this.boxDim];var k=this.container.bodyDims[this.SIDE];switch(stage.typeOf(d)){case "string":d=stage.ui.coreContainer.regPercent.test(d)?k*parseInt(d,10)/100:"auto"===d?null:parseInt(d,10);break;case "number":d=parseInt(d,10);break;default:d=null}this.slotsSanitized[b][this.boxDim]=d;this.availableSpace-=this.slotsSanitized[b].margin[this.boxPos]+this.slotsSanitized[b].margin[this.boxPos2]+this.slotsSanitized[b][this.boxDim]}else this.availableSpace-=
this.slotsSanitized[b].margin[this.boxPos]+this.slotsSanitized[b].margin[this.boxPos2];0!==this.flexRatio&&(this.flexRatioValue=Math.round(this.availableSpace/this.flexRatio*100)/100)};k.prototype.doLayout=function(b){0<this.slotsSanitized[b].flex&&(this.slotsSanitized[b][this.boxDim]=this.slotsSanitized[b].flex*this.flexRatioValue);this.slotsSanitized[b].display[this._boxPos]=this.container.settings.bodyPadding[this._boxPos];if(0==b)this.slotsSanitized[b].display[this.boxPos]=this.container.settings.bodyPadding[this.boxPos];
else{for(var d=this.slotsSanitized[b].display[this.boxPos]=0;d<b;d++)this.slotsSanitized[b].display[this.boxPos]+=this.slotsSanitized[d][this.boxDim]+this.slotsSanitized[d].margin[this.boxPos]+this.slotsSanitized[d].margin[this.boxPos2];this.slotsSanitized[b].display[this.boxPos]+=this.container.settings.bodyPadding[this.boxPos]}};var l={simple:k};return{layouts:l,coreLayout:k,local:{registerLayout:function(b,d){if(b in l)throw Error("Layout :"+b+" is already registred ");d=d();if("function"!==typeof d)throw Error("Layout registar must be a closure and return function:");
l[b]=stage.herite(d,k);l[b].prototype.type=b;return l[b]},createLayout:function(b,d,k){if(b in l)return new l[b](d,k);throw Error("LAYOUT TYPE : "+b+" NOT DEFINED");}}}});stage.provide("module");stage.require("ui.i18n");
stage.register("module",function(){var b=stage.herite(function(b,u,k){this.core=this.$super;k=stage.extend({name:"widgetW3c",design:[{key:"name",type:"string"},{key:"author",type:"object"},{key:"description",type:"string"},{key:"license",type:"string"},{key:"preference",type:"object"},{key:"feature",type:"string"},{key:"content",type:"string"}]},k);this.core.constructor(b,u,k)},stage.ui.data.model);b.prototype.xmlReader=function(b){b=stage.xml.parseXml(b).module;if(this.ormKey)for(var d in b)b[d][this.ormKey]&&
this.set(b[d][this.ormKey],b[d]);else for(d in b)this.set(d,b[d])};b.prototype.getName=function(){return this.get("name")["#text"]};b.prototype.getShortName=function(){return this.get("name")["@short"]};b.prototype.getIcon=function(){var b=this.get("icon");return{src:b["@src"],width:b["@width"],height:b["@height"]}};b.prototype.getContent=function(){var b=this.get("content");return{src:b["@src"],type:b["@type"],encoding:b["@encoding"]}};return{modules:{},local:{registerModule:function(d,u,k){return new b(null,
null,{transport:{url:(k?k:"/src/stage-modules/"+d)+"/config.xml",transportSettings:{async:!1,cache:!0}},onDataReady:function(b,g){g=stage.register.call(stage.module.modules,d,u);g.controler.prototype.module=b;g.config=this;g.name=d;if(g.i18n){b.i18nManager=stage.ui.createI18nManager(g.i18n);var k=b.i18nManager.classTranslate();g.controler.prototype.createI18nManager=function(){return new k}}}})},registerModuleDirect:function(b,u,k){u=stage.register.call(stage.module.modules,b,u);u.name=b;return u},
loadModule:function(b,u,k){if(b in stage.module.modules)b=new stage.module.modules[b].controler(u,null,k);else throw Error("MODULE :"+b+" not registred");return b}}}});stage.provide("emersya");
stage.register("emersya",function(){function b(b){if(b){console.error("Error!");for(var f in b.emError)d[b.emError[f].code]?console.error(""+b.emError[f].code+": "+d[b.emError[f].code]):console.error(""+b.emError[f].code+": unknown code"),console.error(b.emError[f].desc,b.emError[f].data,"\n");console.error(b.jsError)}else console.error("Error! null returned...")}var d={801:"graph node not found",802:"graph node already exists",803:"unable to add subtree",804:"unable to remove subtree",805:"texture not found",
806:"can not remove only son",807:"can not remove default material settings",404:"page not found",104:"file not found",201:"rendering mode not supported",202:"projection mode not supported",203:"control mode not supported",204:"webgl context lost",205:"webgl out of memory",206:"webgl hardware limitation error",207:"webgl error",208:"unauthorized viewer",901:"layer not found",300:"undefined action",301:"iframe API not initialized",302:"viewer not loaded",303:"invalid screenshot",304:"invalid parameters",
305:"viewer already loaded",306:"viewer already started",307:"viewer already preloading",308:"viewer already preloaded",309:"viewer already paused",310:"transaction id already used",311:"transaction error",312:"preset error",313:"impossible action error",314:"network error",315:"preset not found",316:"materials group configuration not found",317:"materials groups configurations error",318:"unsupported language",319:"annotations error",320:"viewer unloaded error",321:"viewer configuration not found",
322:"unsupported network protocol",323:"annotation already exists",324:"annotation does not exist",325:"materials error",326:"planner error",327:"font error",328:"export error",329:"invalid viewer configuration",501:"no response data",502:"response error",503:"jquery parse response error",504:"request timeout",505:"request abort",506:"authentication required",701:"orientation motion permission denied",702:"orientation changed error",703:"move your device error",704:"sharing error",705:"unavailable model error",
706:"camera need to be activated",707:"motion sensor error",708:"use other browser",709:"ar can not run on chrome IOS",710:"popup need to be enable",711:"camera error",8E3:"invalid configuration file content",8001:"invalid index file path",8010:"invalid external configuration file protocol",8011:"external configuration file not found",8012:"unexpected external configuration file type",9E3:"unavailable product",9001:"missing product informations",9002:"missing store informations",9003:"missing currency informations",
9004:"missing tax rate",9005:"impossible configuration",9006:"cannot configure product now",9010:"unavailable product option",9011:"product option not found",9012:"invalid product option custom data",9020:"unknow product attribute name",9021:"unknow product attribute value",9085:"duplicate blueprint",9086:"duplicate blueprint attribute",9087:"duplicate blueprint attribute value",9088:"duplicate blueprint section",9089:"duplicate blueprint section option",9090:"invalid product blueprint",9091:"missing blueprint section",
9092:"missing blueprint section option",9093:"invalid blueprint viewer",9094:"invalid blueprint section",9095:"invalid blueprint option",9096:"missing blueprint attribute value",9097:"invalid blueprint attribute",9098:"invalid blueprint attribute value"},u={10301:"configuration mixed"},k=[],l=[],g=function(b){var d={"\u00e0":"a","\u00e2":"a","\u00e4":"a","\u00e9":"e","\u00e8":"e","\u00eb":"e","\u00ea":"e","\u00f4":"o","\u00f6":"o","\u00fb":"u","\u00fc":"u"};return b.replace(/\u00e0|\u00e2|\u00e4|\u00e9|\u00e8|\u00eb|\u00ea|\u00f4|\u00f6|\u00fb|\u00fc/gi,
function(b){return void 0!==d[b]?d[b]:b})},q=function(b){return/^[\[\](a-zA-Z0-9_@&!:;,.+/#'" -/{}/)]{1,60}$/g.test(b)?1:0},t=function(b){stage.emersya.ui.popup(stage.body,{validText:"OK",cancelButton:!1,block:!0,title:"ERROR",message:b,zindex:5600})};return{browser:{},stage:{createResult:function(b){return{result:void 0!==b?b:null,errors:null}},createWarning:function(b,d,g){u[d]?console.warn("Warning "+d+": "+u[d]+"\n\n"+g):console.warn("Warning "+d+": Unknown warning code.\n\n"+g);l.push({code:d,
desc:g,res:b});return{result:b?b:null,errors:null}},createError:function(b,f,g,l){l?l.emError.push({code:b,desc:f,data:g}):(l={jsError:Error(d[b]),emError:[{code:b,desc:f,data:g}]},k.push(l));return{result:null,errors:l}},printError:b,printErrors:function(){for(var d in k)b(k[d])},getErrorMessage:function(b){if(!b)return"Error! null returned...";var f="Error! ",g;for(g in b.emError){d[b.emError[g].code]&&(f+="\nName: "+d[b.emError[g].code]);f+="\nDescription: "+b.emError[g].desc;break}return f},clearErrors:function(){k=
[]},clearWarnings:function(){l=[]},testResult:function(b){return b?!b||b.errors?b.errors.emError[0].code:0:0},printLastError:function(){k.length?b(k[k.length-1]):console.log("There is no last error ! Something else might be wrong.")},testResultAndPrint:function(d){return d?d.errors?(b(d.errors),d.errors.emError[0].code):0:(b(d),-1)},handleErrorPopup:function(b,d){d||(d=tr("errors.defaultPopupErrorMessage"));b||(b=tr("global.error"));if(-1!==d.indexOf("!!")){d=d.split("!!");var f=d[1];d=d[2];b={validText:tr("global.ok"),
cancelText:tr("errors.createASupportTicket"),title:b,klass:"errorPopUp",message:d,specialClose:!0,onCancel:function(){var b="fr";-1!=window.location.href.indexOf("en")&&(b="en");var d=window.location.origin;d=d.replace("publish.emersya.com","emersya.com");window.location.href.match(/app_dev.php/i)&&(d+="/app_dev.php");window.open(d+"/"+b+"/publish/"+stage.emersya.dataManager().getCustomerCode()+"/support/newRequest/ISU/"+f,"_blank")}}}else b={validText:tr("global.ok"),isMiddleButtonOnly:!0,cancelButton:!1,
title:b,message:d};stage.emersya.ui.popup(stage.body,b)}},form:{removeAccentedChar:g,checkRegExp:q,displayPopupError:t,validateSettings:function(b,d){name=g($stage(b).value);$stage(b).value=name;if(""!=name&&q(name))$$stage("#"+b).css({backgroundColor:"#FFFFFF"});else return $$stage("#"+b).css({backgroundColor:"#de8787"}),""==name?t("You must insert a name for your "+d):t(d+" name can contain letters, numbers and these specials chars [({_@&!:;,.+/#-'\")] (max 60 chars)"),!1;return!0}},libs:{}}});
stage.provide("emersya.ui");stage.register.call(stage.emersya,"ui",function(){return{}});stage.provide("emersya.ui.waiting");stage.require("emersya.ui");
stage.register.call(stage.emersya.ui,"waiting",function(){function b(b){return 7<b.length?(b=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(b))?{r:parseInt(b[1],16),g:parseInt(b[2],16),b:parseInt(b[3],16),a:parseInt(b[4],16)}:null:(b=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(b))?{r:parseInt(b[1],16),g:parseInt(b[2],16),b:parseInt(b[3],16),a:255}:null}var d={waitingIcon:!0,mode:0,opacity:0,mainBackgroundColor:"#00000000",backgroundColor:"#00000080",circleColor:"#00B1ABFF",rotateSpeed:3E3,
increaseTime:1E3,decreaseTime:1E3,longWaitTime:400,shortWaitTime:400,shortLength:.14,longLength:.86,displayLoadingProgress:!1,customKlass:null},u=function(b){this.settings=stage.extend(!0,{},d,b);this.settings.container||(this.settings.container=stage.body);this.loaderInterval=null;this.cappedFrames=this.state=1;this.display()};u.prototype.display=function(){this.visible=!0;switch(this.settings.mode){case 0:var d=[{tagName:"div",returnActive:!0,attributes:{klass:"waitingContainer "+(this.settings.customKlass?
this.settings.customKlass:""),style:{"background-color":this.settings.mainBackgroundColor}},childs:[{tagName:"div",attributes:{klass:"blockLayer"}},{tagName:"div",attributes:{klass:"waitingLoader"},childs:[{tagName:"svg",nameSpace:"http://www.w3.org/2000/svg",attributes:{klass:"svgLoader uil-ring-alt",viewBox:"-100 -100 200 200",preserveAspectRatio:"xMidYMid"},childs:[{tagName:"circle",nameSpace:"http://www.w3.org/2000/svg",attributes:{klass:"circleBackground",cx:"0",cy:"0",r:"80",stroke:"#999",fill:"none",
"stroke-width":"16","stroke-linecap":"round"}},{tagName:"circle",nameSpace:"http://www.w3.org/2000/svg",attributes:{klass:"bar","stroke-dasharray":"70 432.6548245743669","stroke-dashoffset":"0",cx:"0",cy:"0",r:"80",stroke:"#000",fill:"none","stroke-width":"12","stroke-linecap":"round",style:"stroke: rgb(0,177, 171);",transform:"scale(-1,1)"}}]}]}]}];this.perimeter=160*Math.PI;this.shortLength=parseFloat((this.settings.shortLength*this.perimeter).toFixed(3));this.longLength=parseFloat((this.settings.longLength*
this.perimeter).toFixed(3));break;case 1:d=[{tagName:"div",returnActive:!0,attributes:{klass:"waitingContainer "+(this.settings.customKlass?this.settings.customKlass:""),style:{"background-color":this.settings.mainBackgroundColor}},childs:[{tagName:"div",attributes:{klass:"blockLayer"}},{tagName:"div",attributes:{klass:"waitingLoader"},childs:[{tagName:"svg",nameSpace:"http://www.w3.org/2000/svg",attributes:{klass:"svgLoader uil-ring-alt",viewBox:"-100 -100 200 200",preserveAspectRatio:"xMidYMid"},
childs:[{tagName:"circle",nameSpace:"http://www.w3.org/2000/svg",attributes:{klass:"circleBackground",cx:"0",cy:"0",r:"50",stroke:"#FFFFFF",fill:"none","stroke-width":"16","stroke-linecap":"round"}},{tagName:"circle",nameSpace:"http://www.w3.org/2000/svg",attributes:{klass:"bar","stroke-dasharray":"70 432.6548245743669","stroke-dashoffset":"0",cx:"0",cy:"0",r:"50",stroke:"#000",fill:"none","stroke-width":"32",style:"stroke: rgb(0,177, 171);",transform:"scale(-1,1)","stroke-linecap":"round"}}]}]}]}],
this.perimeter=100*Math.PI,this.shortLength=parseFloat((this.settings.shortLength*this.perimeter).toFixed(3)),this.longLength=parseFloat((.9*this.settings.longLength*this.perimeter).toFixed(3))}this.settings.displayLoadingProgress&&d[0].childs.push({tagName:"div",attributes:{klass:"loadingProgress",inner:"0%"}});this.view=$$stage(this.settings.container).build(d);this.barContainer=this.view.find(".waitingLoader .svgLoader .bar");this.loadingProgressContainer=this.view.find(".loadingProgress").get(0);
d=b(this.settings.circleColor);var l=b(this.settings.backgroundColor);this.barContainer.css({stroke:"rgba("+d.r+","+d.g+","+d.b+","+d.a/255+")"});this.view.find(".svgLoader .circleBackground").css({stroke:"rgba("+l.r+","+l.g+","+l.b+","+l.a/255+")"});this.settings.waitingIcon&&(this.renderFunction=stage.setContext(function(){if(this.visible){this.animationFrame=window.requestAnimationFrame(this.renderFunction);var b=Date.now(),d=parseFloat(this.barContainer.attribute("stroke-dashoffset")),k=this.barContainer.attribute("stroke-dasharray");
this.settings.rotateSpeed&&(d+=this.perimeter*(b-this.lastUpdate)/this.settings.rotateSpeed,d>this.perimeter&&(d-=this.perimeter));k=k.split(" ");k[0]=parseFloat(k[0]);var l=k[0];switch(this.state){case 1:var f=Math.min((b-this.startAcc)/this.settings.increaseTime,1);f=.5*(Math.sin(Math.PI*(f-.5))+1);k[0]=this.shortLength+f*f*(this.longLength-this.shortLength);d=parseFloat(d)+(k[0]-l);break;case 0:f=Math.min((b-this.startDec)/this.settings.decreaseTime,1),f=.5*(Math.sin(Math.PI*(f-.5))+1),k[0]=this.shortLength+
(1-f*f)*(this.longLength-this.shortLength)}k[0]>=this.longLength?(k[0]=this.longLength,this.state=2,this.startWait||(this.startWait=b),b-this.startWait>=this.settings.longWaitTime&&(this.state=0,this.startDec=b,this.startWait=null)):k[0]<=this.shortLength&&(k[0]=this.shortLength,this.state=2,this.startWait||(this.startWait=b),b-this.startWait>this.settings.shortWaitTime&&(this.state=1,this.startAcc=b-(b-this.startWait-this.settings.shortWaitTime),this.startWait=null));k[1]=this.perimeter-k[0];k=k[0]+
" "+k[1];this.barContainer.attribute("stroke-dasharray",k);this.barContainer.attribute("stroke-dashoffset",d);this.lastUpdate=b}},this),this.startAcc=this.lastUpdate=Date.now()-1,this.animationFrame=window.requestAnimationFrame(this.renderFunction));$$stage(".blockLayer").css({opacity:this.settings.opacity,backgroundColor:"rgb("+l.r+","+l.g+","+l.b+")"})};u.prototype.setLoadingProgress=function(b){this.loadingProgressContainer&&(this.loadingProgressContainer.innerHTML=Number.parseFloat(100*b).toFixed(0)+
" %")};u.prototype.remove=function(){this.visible&&(window.cancelAnimationFrame(this.animationFrame),this.view.remove(),this.visible=!1)};return function(b){return new u(b)}});stage.provide("emersya.ui.svgIcon");stage.require("emersya.ui");
stage.register.call(stage.emersya.ui,"svgIcon",function(){var b={foregroundColor:"rgba(0,0,0,0.7)",backgroundColor:"#FFFFFF",stroke:"white",strokeOpacity:.7,fillOpacity:.51},d={annotationIcon:"m 500.25781,180.9707 c -120.83749,0 -218.83008,97.98598 -218.83008,218.83985 0,35.82687 8.26922,69.67491 23.5,99.52734 37.52312,61.68315 124.13983,211.89517 171.2168,295.51758 20.86816,32.18681 28.80051,32.06759 48.83789,-1.1875 44.30774,-77.62818 121.51082,-210.39165 169.99219,-294.29102 15.23078,-29.79308 24.11133,-63.74004 24.11133,-99.52734 0,-120.85386 -97.99064,-218.83789 -218.82813,-218.83789 l 0,-0.041 z m 0.2168,110.80664 A 115.26208,115.27769 0 0 1 615.73828,407.05664 115.26208,115.27769 0 0 1 500.47461,522.33398 115.26208,115.27769 0 0 1 385.21289,407.05664 115.26208,115.27769 0 0 1 500.47461,291.77734 Z",arrowMoveLeft:"m 15.983,14.0862 2.248853,1.2984 2.24884,1.2984 0,-1.4015 2.90814,0 0,-2.3406 -2.90814,0 0,-1.4513 -2.24884,1.2984 -2.248853,1.2982 z",
arrowMoveRight:"m 46.636312,14.0862 -2.248852,1.2984 -2.24884,1.2984 0,-1.4015 -2.90814,0 0,-2.3406 2.90814,0 0,-1.4513 2.24884,1.2984 2.248852,1.2982 z",arrowMoveTop:"m 30.72879,0.56822 -1.298374,2.24885 -1.298362,2.24885 1.401489,0 0,2.90814 2.340611,0 0,-2.90814 1.451277,0 L 32.027063,2.81707 30.72879,0.56822 z",arrowRotateLeft:"m 15.344,13.1346 2.338179,1.3192 2.338165,1.3192 0,-1.424 3.023653,0 0,-2.3781 -3.023653,0 0,-1.47459 -2.338165,1.31919 -2.338179,1.3191 z",arrowRotateRight:"m 39.986912,13.1346 -2.338179,1.3192 -2.338165,1.3192 0,-1.424 -3.023653,0 0,-2.3781 3.023653,0 0,-1.47459 2.338165,1.31919 2.338179,1.3191 z",
arrowRotateTop:"m 27.511515,0.68808 -1.349946,2.2849 -1.349934,2.2849 1.457157,0 0,2.95476 2.433582,0 0,-2.95476 1.508922,0 -1.34994,-2.2849 -1.349841,-2.2849 z",arrowZoomBottom:"m 11.952,22.084 2.742469,-1.4392 2.742462,-1.4393 -1.412795,-0.8935 1.853926,-2.9315 -2.359482,-1.4922 -1.853926,2.9316 -1.462978,-0.9252 -0.124782,3.0947 L 11.952,22.084 z",arrowZoomTop:"M 23.1926,4.30946 23.067802,7.40415 22.943013,10.49882 21.530218,9.60538 19.676292,12.537 17.31681,11.04483 19.170737,8.11325 17.707758,7.18806 20.450226,5.7488 23.1926,4.30946 z",
arSizeManBodyAndLegs:"m 19.155803,30.901171 c 0,0 14.39064,6.270435 16.80466,7.05754 7.18793,5.348017 8.62857,7.937131 12.2839,14.831387 6.80927,13.912967 5.04044,28.121549 3.86378,43.904362 -0.77877,9.03326 0.2387,17.77428 0.77327,26.82526 0.16015,2.71245 0.36839,10.54567 0.36839,10.54567 l -0.77133,-0.0579 c -1.17429,55.03284 -5.52635,58.67074 -8.41861,88.62678 -1.82436,18.89607 -2.67511,41.82918 -1.08471,59.66268 6.72177,4.53856 6.49264,6.45744 20.42762,6.81035 3.5668,0.0903 1.9673,2.62184 0.72704,3.33442 v 0 c -9.50582,5.46162 -19.68365,6.08999 -34.35294,3.0395 l -3.02292,0.82869 -5.33877,-0.53379 -4.80495,-1.24577 c -1.55245,-2.31813 -0.65493,-5.87862 -0.5338,-9.16554 l -0.004,-0.064 c -0.42782,-0.10347 -0.81512,-0.20096 -0.81512,-0.20096 0,0 5.43438,-48.01603 5.91642,-62.8049 0.54043,-22.84277 -0.29887,-29.08356 -1.21561,-43.59049 -0.34945,-5.52992 -0.66957,-12.1982 -1.63216,-16.54239 -2.05227,-7.35456 -4.53506,-6.73911 -5.47598,-18.90148 -0.20976,-2.71144 0.98766,-8.98661 1.63312,-12.10826 l -0.85258,-0.0641 c 0,0 2.59948,-15.3581 2.50419,-22.16577 -0.10505,-7.49579 -1.17486,-14.950136 -2.01362,-22.399747 -0.90938,-8.07631 -2.86253,-16.044464 -3.27159,-24.161465 -0.24936,-4.946327 -0.67742,-10.039107 0.50316,-14.848918 1.1092,-4.518768 6.04053,-12.584161 6.04053,-12.584161 z",
arSizeManHEeadAndArm:"m 28.580699,-1.2506185 c 3.10151,0.04462 6.64999,1.00905094 10.57521,3.1221439 6.7253,3.620473 6.43349,13.0160546 7.93774,24.1461916 0.26017,3.03094 -1.63946,1.401275 -5.42659,10.893849 -1.21551,1.09345 -1.49756,1.679728 -4.59299,1.335586 L 34.902129,37.958711 19.145991,31.262037 C 10.093509,15.62462 15.140893,-1.4444495 28.580699,-1.2506185 Z m 68.27435,40.9533305 c 0.0723,-9.45e-4 0.1462,0.01356 0.21753,0.04442 l 0.722386,0.313161 c 0.285877,0.123962 0.421847,0.468285 0.305167,0.771949 l -5.049453,13.142892 c 0.23969,0.223496 1.02221,0.985517 1.15775,1.577311 0.12654,0.553086 -0.92022,2.236874 -0.92022,2.236874 0,0 0.67308,1.632187 0.45365,2.578694 -0.24937,1.075735 -1.04051,1.922557 -1.04051,1.922557 0.62399,1.446325 0.67315,1.980198 0.52972,2.739134 -0.0153,0.653112 -0.75666,1.574135 -0.75666,1.574135 0,0 0.47083,1.129616 0.31552,1.674392 -0.5168,1.813173 -2.36593,3.190643 -3.90164,4.353783 -1.23486,0.93527 -2.68771,1.53739 -4.13785,2.0091 -0.95319,0.31009 -2.94949,0.5238 -2.94949,0.5238 0,0 -2.27527,1.67348 -3.34389,2.60478 -2.93714,2.55963 -5.40267,5.70401 -8.40587,8.17554 -3.17434,2.6124 -6.5956,4.89213 -10.09717,6.98008 -1.65199,0.98507 -3.24717,2.35515 -5.12705,2.60476 -1.12792,0.1499 -2.31196,-0.20429 -3.34387,-0.71058 -8.23368,-4.0389 -14.84144,-11.20298 -21.36291,-17.89777 -4.780946,-4.95641 -11.318778,-12.262052 -13.413482,-19.161933 -2.83515,-9.338636 3.592518,-21.340004 14.406562,-14.350708 2.13745,1.733981 3.68585,4.166907 5.40205,6.36654 2.38054,3.05127 4.63945,6.213387 6.77783,9.460779 1.64583,2.499359 3.06002,5.162563 4.65036,7.702128 1.02516,1.637134 1.94542,3.365404 3.15253,4.856054 1.15136,1.42198 2.25653,3.07075 3.86198,3.85152 0.91273,0.4439 1.99994,0.47415 2.99517,0.33471 0.72556,-0.10177 1.37055,-0.54605 2.0491,-0.83742 1.74623,-0.74995 3.46707,-1.56532 5.20207,-2.34424 1.99552,-0.89593 4.05792,-1.63778 5.98992,-2.67894 1.63948,-0.88345 4.72878,-3.014121 4.72878,-3.014121 l 2.67967,-5.860593 c 0,0 2.25447,-4.539548 4.29431,-5.416497 0.72156,-0.310216 1.58757,0.02924 2.33916,0.244598 0.6979,0.199951 1.71258,0.270022 2.36893,0.29853 0.48761,-0.307001 0.95493,-0.603692 1.34394,-0.858489 0.69604,-0.455935 1.31788,-0.781928 1.85556,-1.0192 l 5.54125,-14.42307 c 0.0874,-0.227826 0.29181,-0.365907 0.50905,-0.36856 z",
axesIcon:"m 463.16858,131.38215 -52.774,94.40611 -52.78305,94.36846 71.55334,0 0,265.06503 -140.88408,146.96794 -50.16042,-52.794 -27.56148,105.42173 -27.56146,105.42173 101.2953,-27.81671 101.30134,-27.81043 -50.36796,-53.00108 139.88256,-145.92317 258.01431,0 0,74.33578 90.9342,-54.2184 90.94923,-54.21842 -90.46802,-55.04356 -90.48305,-55.05298 0,74.6213 -237.56878,0 0,-245.6316 71.24656,0 -51.95895,-94.89556 -51.977,-94.8579 z",bBoxIcon:"m 526.125,95.78125 c -0.73682,-0.04327 -1.46293,0.102375 -2.125,0.65625 l -0.0625,-0.0625 -1.8125,0 c -24.72085,6.03165 -51.51326,29.38491 -76.6875,41.15625 -18.43845,10.88857 -36.98666,21.58126 -55.5625,32.25 16.02716,8.97191 32.05252,18.05624 48.0625,27.0625 28.59195,-16.51147 57.20647,-33.01634 85.78125,-49.53125 22.708,13.98684 45.42387,28.09007 68.125,42.125 15.86572,-8.97191 31.71773,-17.84712 47.59375,-26.78125 -36.34448,-22.55686 -72.79721,-44.88126 -109.71875,-66.21875 -1.11634,0 -2.36571,-0.584131 -3.59375,-0.65625 z m 221.125,134.5625 c 0.032,0.0195 0.0618,0.043 0.0937,0.0625 0.0124,-0.007 0.0189,-0.0242 0.0312,-0.0312 z m 0.0937,0.0625 c -7.78452,4.40633 -15.47855,8.65227 -23.21875,13.0625 -8.38455,3.67876 -16.58738,8.23683 -24.625,13.09375 25.15363,15.53597 50.29073,31.08903 75.4375,46.625 -24.71741,14.27537 -49.43197,28.71157 -74.15625,43.0625 3.67876,2.06093 7.37519,4.25501 10.90625,6.3125 15.65962,5.59543 17.01531,19.69484 16.1875,35.0625 23.82434,-13.83227 47.65848,-27.6643 71.5,-41.5 l 0,92.34375 c 15.85198,-9.56615 31.80252,-18.93837 47.8125,-28.28125 0,-37.6566 0.008,-75.30393 -1.46875,-112.84375 -13.83227,-24.38423 -46.81171,-30.37286 -67.5,-48.0625 -10.26926,-6.30401 -20.6053,-12.61177 -30.875,-18.875 z M 276.6875,235.0625 c 0.0931,0.0531 0.18818,0.10316 0.28125,0.15625 0.0805,-0.0466 0.1695,-0.0784 0.25,-0.125 z m 0.28125,0.15625 c -30.60245,17.73012 -61.0172,35.71605 -91.03125,54.25 -15.08256,25.06433 -1.79428,57.69328 -6.1875,85.375 l 0,36.6875 c 15.80389,9.41844 31.61643,18.71996 47.4375,28.09375 l 0,-92 c 22.48817,13.09377 44.98401,26.10713 67.46875,39.15625 l 0,-29.75 c 7.35752,-4.26612 14.86944,-8.68504 22.34375,-13.25 -22.10347,-12.8018 -44.21247,-25.63603 -66.3125,-38.46875 24.8548,-14.27537 49.70426,-28.70125 74.5625,-43.0625 -16.167,-8.77676 -32.22686,-17.87299 -48.28125,-27.03125 z M 429.90625,409 l -0.6875,0.0312 c 0.10506,0.061 0.20744,0.12651 0.3125,0.1875 0.1266,-0.0709 0.2484,-0.14788 0.375,-0.21875 z m -0.375,0.21875 c -7.23078,4.04767 -14.46497,8.07745 -21.625,12.125 l 0,31.3125 c 26.7543,15.52567 53.51666,31.06808 80.28125,46.59375 l 0,95.0625 c 7.94832,4.70922 16.04205,9.54077 24.0625,14.25 8.53568,-5.00463 17.05807,-10.15506 25.59375,-15.15625 l 0,-95.5625 C 563.06266,483.13215 588.2811,468.56323 613.5,453.9375 l 0,-29.5 c -8.09258,-4.56152 -16.23433,-9.12255 -24.375,-13.6875 -26.13258,15.1753 -52.28774,30.35937 -78.4375,45.53125 -27.04426,-15.68458 -54.10859,-31.36095 -81.15625,-47.0625 z m -249.9375,130.875 c 0,48.70663 0.023,97.42013 1.5,145.96875 14.12423,25.14677 48.56014,29.94365 70.0625,47.4375 16.44965,9.27418 32.8378,18.76973 49.21875,28.25 l 0,-55.15625 C 276.28617,692.61378 252.19665,678.7794 228.125,664.875 l 0,-96.46875 c -15.93785,-9.41501 -31.87808,-18.88031 -47.8125,-28.3125 z m 667.21875,0 c -15.81763,9.41502 -31.66863,18.75464 -47.5,28.125 l 0,95.9375 c -25.62421,14.78717 -51.22297,29.5844 -76.84375,44.375 l 0,55.53125 C 762.48169,741.09001 802.35609,717.90066 841.5,693.75 c 14.77343,-24.72084 1.614,-57.04742 6.03125,-84.40625 l 0,-69.25 z m -358.25,182.125 0,93.4375 C 463.07568,800.93778 437.58057,786.23221 412.09375,771.5 l 0,55.4375 c 31.49443,18.1293 63.09682,35.99936 95,53.1875 28.35495,0 49.42077,-26.84212 75.03125,-36.59375 9.11961,-5.44429 18.41642,-10.72194 27.65625,-16.125 l 0,-54.46875 c -23.82434,13.68113 -47.6269,27.50703 -71.4375,41.25 l 0,-91.0625 c -8.24028,4.56152 -16.39468,8.96973 -24.59375,13.53125 -8.38454,-4.85692 -16.702,-9.54933 -25.0625,-14.40625 z",
blurEffectIcon:"m 687.8112,317.97249 c 0,0 -112.5553,47.9265 -165.1562,78.25001 -52.6115,30.31119 -150.25,103.99999 -150.25,103.99999 0,0 98.0189,73.6897 150.625,104.00001 52.6061,30.3244 164.9687,78.0625 164.9688,78.0625 0,0 6.5935,-55.3655 10.9062,-110.03121 l 172.9062,0 c 2.7346,0 5.105,-2.625 6.3438,-6.5 0.5633,-1.7638 0.9085,-3.7992 0.9375,-5.9376 l 0,-119.4687 c -0.055,-6.9939 -3.2113,-12.4793 -7.1875,-12.5 l -173.0312,0 c -4.3597,-54.596 -11.0625,-109.875 -11.0626,-109.875 z m -473.375,91.03131 c -50.476,0 -91.4062,40.90039 -91.4062,91.37499 0,50.5033 40.9302,91.43741 91.4062,91.43741 50.4761,0 91.4063,-40.93421 91.4063,-91.43741 0,-50.4746 -40.9301,-91.37499 -91.4063,-91.37499 z",
bodyIcon:"M 498.99586,80.981317 A 111.40837,111.40837 0 0 0 387.58441,192.39126 111.40837,111.40837 0 0 0 498.99586,303.80271 111.40837,111.40837 0 0 0 610.40428,192.39126 111.40837,111.40837 0 0 0 498.99586,80.981317 Z M 401.01104,345.30796 c -38.25705,3.79514 -67.97656,35.4825 -67.97656,74.14599 l 0,205.23444 c 0,38.19595 29.06101,69.2905 66.64887,73.70444 l 0,288.22355 c 0,20.92532 13.95833,37.52522 30.89288,37.52522 l 140.37469,0 c 16.93302,0 30.89287,-16.5999 30.89287,-37.52522 l 0,-288.22355 c 37.58635,-4.41394 66.64887,-35.50849 66.64887,-73.70444 l 0,-205.23444 c 0,-41.24093 -33.54215,-74.14599 -75.47213,-74.14599 l -184.51392,0 c -2.62177,0 -4.94407,-0.25974 -7.49557,0 z",
botBg:"m 80.612123,866.41996 c 0,0 396.779697,85.2542 839.999997,0 0,0 82.83978,-284.50138 79.38788,-839.999977 0,0 -540,0 -1000,0 0,0 -5.5515072,381.387877 80.612123,839.999977 z",changeBackgroundBorderIcon:"m 140.30697,270.30136 c -10.59033,0 -19.73108,9.14112 -19.73108,19.73076 l 0,603.13459 c 0,10.58964 9.14075,19.73103 19.73108,19.73103 l 592.12372,0 c 10.59031,0 19.73109,-9.14139 19.73109,-19.73103 l 0,-159.24989 c -13.17144,11.35146 -26.32695,22.7221 -39.45772,34.12081 l 0,98.43577 -545.70387,0 0,-552.07017 268.65204,0 c 15.31083,-13.15606 35.27051,-30.95149 50.58669,-44.10187 z",
changeBackgroundIcon:"m 667.11332,163.97849 c -0.25883,-0.0206 -0.52558,0.0565 -0.73759,0.24078 L 362.46857,425.68213 c -0.42664,0.3664 -0.4726,1.00629 -0.10149,1.43207 l 292.67993,340.18943 c 0.36746,0.42598 1.00348,0.4769 1.42746,0.1111 L 960.38158,505.95181 c 0.42663,-0.36641 0.47703,-1.0063 0.12155,-1.43203 L 667.82355,164.33036 c -0.18103,-0.2131 -0.4355,-0.33184 -0.69431,-0.35123 z m -263.7251,197.1911 c 0,0 -68.614,11.97223 -94.48598,38.55841 -25.74748,26.64855 -48.29638,78.89097 -42.27559,113.20586 5.96694,34.30802 28.14219,68.49766 57.18364,67.15185 29.0414,0 45.72143,-39.93875 49.73089,-70.89564 3.88579,-30.95688 -34.7875,-94.5183 -34.7875,-94.5183 l 64.63454,-53.50218 ",
changeModelIcon:"m 496.61741,172.76499 c -36.94405,0 -66.61374,29.95747 -66.61374,66.90152 l 0,154.95237 -143.23246,0 c -1.1173,0 -2.1415,0 -3.14539,0.28778 -0.33858,0.16929 -0.54172,0.16929 -0.86338,0.27088 -0.16929,0 -0.18622,0.18621 -0.27086,0.27086 -0.237,0.16928 -0.33858,0.18621 -0.57558,0.27086 -0.20315,0.16929 -0.37245,0.18622 -0.57558,0.27087 -0.38937,0.18621 -0.81261,0.3555 -1.13425,0.57556 -0.45708,0.32167 -1.06651,0.77875 -1.43895,1.15118 -0.30474,0.32165 -0.60946,0.49095 -0.86338,0.86338 -0.16929,0.16928 0.16928,0.16928 0,0.27085 -0.16929,0.27087 -0.44016,0.5756 -0.5756,0.86339 -0.16928,0.22007 -0.18621,0.3555 -0.28779,0.57559 0,0.16929 0,0.16929 0,0.27087 -0.16927,0.33856 -0.27084,0.81257 -0.27084,1.13422 0,0.16929 0,0.16929 0,0.2878 0,0.25393 -0.16931,0.60944 0,0.86338 0,0.27086 0.18622,0.60943 0.27084,0.86337 0.1693,0.49094 0.28779,0.96496 0.57558,1.43896 0.1693,0.23702 0.38938,0.62638 0.5756,0.86338 L 488.0395,676.46895 c 0.47401,0.62638 1.03266,1.23583 1.71491,1.71491 0.16929,0.16929 0.38936,0.16929 0.57558,0.27087 0.18622,0.16929 0.38936,0.16929 0.57558,0.27087 0.27087,0.16928 0.54173,0.45708 0.86337,0.57556 0.1693,0.16931 0.1693,-0.16929 0.27087,0 0.16929,0.16931 0.42323,0.18623 0.57558,0.27087 0.38939,0.1693 0.74488,0.1693 1.13425,0.27086 0.45708,0.16929 0.94801,0.18622 1.42203,0.27088 0.16929,0 0.16929,0 0.27086,0 0.1693,0 0.38937,0.27086 0.57558,0.27086 l 0.86337,0 c 0.37245,0 0.77875,-0.16929 1.13426,-0.27086 1.03266,-0.1693 2.19737,-0.23702 3.1437,-0.5756 0.27085,-0.16928 0.57559,-0.16928 0.86339,-0.27085 0.30471,-0.16929 0.28777,-0.16929 0.57556,-0.27087 0.8126,-0.44015 1.65905,-1.08345 2.28711,-1.71491 0.20315,-0.20313 0.38937,-0.62636 0.57559,-0.86337 L 715.30896,405.96296 c 0.16929,-0.237 0.42324,-0.60943 0.57559,-0.86338 0,0 0.27086,0.1693 0.27086,0 0.27086,-0.49093 0.16929,-0.93108 0.27086,-1.43895 0.1693,-0.49095 0.27086,-0.91417 0.27086,-1.43896 0,-0.27086 0.16928,-0.59252 0,-0.86338 0,-0.25394 -0.18621,-0.62637 -0.27086,-0.86338 -0.16929,-0.22007 -0.18622,-0.64329 -0.27086,-0.86338 -0.1693,-0.27087 -0.1693,-0.5925 -0.27086,-0.86337 0,0 -0.27087,0.1693 -0.27087,0 0,-0.1693 0.16929,-0.18622 0,-0.27086 -0.25393,-0.35552 -0.52479,-0.54172 -0.86338,-0.86338 -0.37244,-0.38937 -0.96495,-0.81259 -1.43896,-1.13424 -0.3555,-0.22008 -0.7618,-0.38936 -1.13423,-0.57558 -0.18622,-0.16929 -0.38937,-0.18622 -0.57558,-0.27087 -0.30473,-0.16928 -0.54173,-0.45708 -0.86338,-0.57558 -0.1693,0 -0.18623,0 -0.27087,0 -0.25394,-0.16929 -0.32164,-0.18622 -0.57558,-0.27087 -0.59251,-0.16929 -1.35432,-0.16929 -2.00101,-0.27085 -0.42322,0 -0.69408,0 -1.13423,0 l -143.23246,0 0,-154.95407 c 0,-36.94404 -29.95578,-66.89983 -66.89813,-66.89983 z M 126.38296,716.53641 c -40.529596,0 -73.188927,32.66102 -73.188927,73.19061 0,40.5279 32.659331,72.90113 73.188927,72.90113 l 750.1878,0 c 40.52959,0 73.1889,-32.37323 73.1889,-72.90113 0,-40.52959 -32.65931,-73.19061 -73.1889,-73.19061 l -750.1878,0 z",
classicRendering:"m 687.8112,317.97249 c 0,0 -112.5553,47.9265 -165.1562,78.25001 -52.6115,30.31119 -150.25,103.99999 -150.25,103.99999 0,0 98.0189,73.6897 150.625,104.00001 52.6061,30.3244 164.9687,78.0625 164.9688,78.0625 0,0 6.5935,-55.3655 10.9062,-110.03121 l 172.9062,0 c 2.7346,0 5.105,-2.625 6.3438,-6.5 0.5633,-1.7638 0.9085,-3.7992 0.9375,-5.9376 l 0,-119.4687 c -0.055,-6.9939 -3.2113,-12.4793 -7.1875,-12.5 l -173.0312,0 c -4.3597,-54.596 -11.0625,-109.875 -11.0626,-109.875 z m -473.375,91.03131 c -50.476,0 -91.4062,40.90039 -91.4062,91.37499 0,50.5033 40.9302,91.43741 91.4062,91.43741 50.4761,0 91.4063,-40.93421 91.4063,-91.43741 0,-50.4746 -40.9301,-91.37499 -91.4063,-91.37499 z",
closeHandleMenu:"M 500.21875 0 C 400.94875 38.99 305.27 87.06875 214.75 143.46875 C 139.3 190.48875 67.43 243.2775 0 301.1875 C 167.29 291.2875 334.88875 286.4 502.46875 286.5 C 668.41875 286.6 834.35 291.475 1000 301.375 C 932.69 243.515 860.98875 190.82375 785.71875 143.84375 C 695.18875 87.34375 599.48875 39.14 500.21875 0 z ",closeHandleMenuBot:"m 286.48 549.9c0.07-165.95 5.03-331.89 14.87-497.54-57.82 67.31-110.52 139.02-157.51 214.3-56.493 90.52-104.71 186.21-143.84 285.48 38.983 99.27 87.077 194.97 143.48 285.48 47.01 75.46 99.8 147.31 157.73 214.78-9.89-167.33-14.8-334.92-14.73-502.5",
doubleOrbitIcon:"m 687.8112,317.97249 c 0,0 -112.5553,47.9265 -165.1562,78.25001 -52.6115,30.31119 -150.25,103.99999 -150.25,103.99999 0,0 98.0189,73.6897 150.625,104.00001 52.6061,30.3244 164.9687,78.0625 164.9688,78.0625 0,0 6.5935,-55.3655 10.9062,-110.03121 l 172.9062,0 c 2.7346,0 5.105,-2.625 6.3438,-6.5 0.5633,-1.7638 0.9085,-3.7992 0.9375,-5.9376 l 0,-119.4687 c -0.055,-6.9939 -3.2113,-12.4793 -7.1875,-12.5 l -173.0312,0 c -4.3597,-54.596 -11.0625,-109.875 -11.0626,-109.875 z m -473.375,91.03131 c -50.476,0 -91.4062,40.90039 -91.4062,91.37499 0,50.5033 40.9302,91.43741 91.4062,91.43741 50.4761,0 91.4063,-40.93421 91.4063,-91.43741 0,-50.4746 -40.9301,-91.37499 -91.4063,-91.37499 z",
downloadIcon:"m 496.61741,172.76499 c -36.94405,0 -66.61374,29.95747 -66.61374,66.90152 l 0,154.95237 -143.23246,0 c -1.1173,0 -2.1415,0 -3.14539,0.28778 -0.33858,0.16929 -0.54172,0.16929 -0.86338,0.27088 -0.16929,0 -0.18622,0.18621 -0.27086,0.27086 -0.237,0.16928 -0.33858,0.18621 -0.57558,0.27086 -0.20315,0.16929 -0.37245,0.18622 -0.57558,0.27087 -0.38937,0.18621 -0.81261,0.3555 -1.13425,0.57556 -0.45708,0.32167 -1.06651,0.77875 -1.43895,1.15118 -0.30474,0.32165 -0.60946,0.49095 -0.86338,0.86338 -0.16929,0.16928 0.16928,0.16928 0,0.27085 -0.16929,0.27087 -0.44016,0.5756 -0.5756,0.86339 -0.16928,0.22007 -0.18621,0.3555 -0.28779,0.57559 0,0.16929 0,0.16929 0,0.27087 -0.16927,0.33856 -0.27084,0.81257 -0.27084,1.13422 0,0.16929 0,0.16929 0,0.2878 0,0.25393 -0.16931,0.60944 0,0.86338 0,0.27086 0.18622,0.60943 0.27084,0.86337 0.1693,0.49094 0.28779,0.96496 0.57558,1.43896 0.1693,0.23702 0.38938,0.62638 0.5756,0.86338 L 488.0395,676.46895 c 0.47401,0.62638 1.03266,1.23583 1.71491,1.71491 0.16929,0.16929 0.38936,0.16929 0.57558,0.27087 0.18622,0.16929 0.38936,0.16929 0.57558,0.27087 0.27087,0.16928 0.54173,0.45708 0.86337,0.57556 0.1693,0.16931 0.1693,-0.16929 0.27087,0 0.16929,0.16931 0.42323,0.18623 0.57558,0.27087 0.38939,0.1693 0.74488,0.1693 1.13425,0.27086 0.45708,0.16929 0.94801,0.18622 1.42203,0.27088 0.16929,0 0.16929,0 0.27086,0 0.1693,0 0.38937,0.27086 0.57558,0.27086 l 0.86337,0 c 0.37245,0 0.77875,-0.16929 1.13426,-0.27086 1.03266,-0.1693 2.19737,-0.23702 3.1437,-0.5756 0.27085,-0.16928 0.57559,-0.16928 0.86339,-0.27085 0.30471,-0.16929 0.28777,-0.16929 0.57556,-0.27087 0.8126,-0.44015 1.65905,-1.08345 2.28711,-1.71491 0.20315,-0.20313 0.38937,-0.62636 0.57559,-0.86337 L 715.30896,405.96296 c 0.16929,-0.237 0.42324,-0.60943 0.57559,-0.86338 0,0 0.27086,0.1693 0.27086,0 0.27086,-0.49093 0.16929,-0.93108 0.27086,-1.43895 0.1693,-0.49095 0.27086,-0.91417 0.27086,-1.43896 0,-0.27086 0.16928,-0.59252 0,-0.86338 0,-0.25394 -0.18621,-0.62637 -0.27086,-0.86338 -0.16929,-0.22007 -0.18622,-0.64329 -0.27086,-0.86338 -0.1693,-0.27087 -0.1693,-0.5925 -0.27086,-0.86337 0,0 -0.27087,0.1693 -0.27087,0 0,-0.1693 0.16929,-0.18622 0,-0.27086 -0.25393,-0.35552 -0.52479,-0.54172 -0.86338,-0.86338 -0.37244,-0.38937 -0.96495,-0.81259 -1.43896,-1.13424 -0.3555,-0.22008 -0.7618,-0.38936 -1.13423,-0.57558 -0.18622,-0.16929 -0.38937,-0.18622 -0.57558,-0.27087 -0.30473,-0.16928 -0.54173,-0.45708 -0.86338,-0.57558 -0.1693,0 -0.18623,0 -0.27087,0 -0.25394,-0.16929 -0.32164,-0.18622 -0.57558,-0.27087 -0.59251,-0.16929 -1.35432,-0.16929 -2.00101,-0.27085 -0.42322,0 -0.69408,0 -1.13423,0 l -143.23246,0 0,-154.95407 c 0,-36.94404 -29.95578,-66.89983 -66.89813,-66.89983 z M 126.38296,716.53641 c -40.529596,0 -73.188927,32.66102 -73.188927,73.19061 0,40.5279 32.659331,72.90113 73.188927,72.90113 l 750.1878,0 c 40.52959,0 73.1889,-32.37323 73.1889,-72.90113 0,-40.52959 -32.65931,-73.19061 -73.1889,-73.19061 l -750.1878,0 z",
emersyaIcon:"m 505.4 134.41c-180.15 62.67-314.43 147.97-432.08 250.01-33.046 169.65-32.523 337.73-0.023 500 121.04 107.01 269.77 195.08 432.1 249.98 206.24-70.1 347.36-176.08 432.11-249.98 13.17-64.96 20.48-131.81 23.38-191.63-155.02 124.47-318.16 215.34-455.49 275.34-102.21-46.71-198.92-103.49-288.43-166.83-10.822-112.23-9.9809-224.34 0-333.69 91.743-65.224 188.88-120.87 288.43-166.89 90.698 40.967 214.12 110.22 308.04 181.63-97.168 68.879-202 128.65-308.04 174.98-2.5818 61.538-2.5818 122.41 0 179.92 170.17-76.14 316.14-164.66 454.74-274.82-3.36-60.64-11.52-123.52-22.6-178.01-127.11-110.19-260.9-190.36-432.14-250.01z",
emersyaIconLogo:"m 19.115356,16.131836 c -2.13199,0.74085 -3.72058,1.75004 -5.11285,2.95723 -0.39152,2.00655 -0.38533,3.99454 0,5.91389 1.43221,1.26626 3.19237,2.30695 5.11341,2.95723 2.44027,-0.82917 4.11042,-2.08305 5.11342,-2.95723 0.15582,-0.76842 0.24245,-1.55877 0.27676,-2.26644 -1.83441,1.47215 -3.76502,2.54715 -5.39018,3.25706 -1.20944,-0.55297 -2.35419,-1.22463 -3.41344,-1.97392 -0.12825,-1.32701 -0.11813,-2.65346 0,-3.94672 1.08569,-0.7718 2.2355,-1.42996 3.41344,-1.97393 1.07332,0.48434 2.53365,1.30339 3.64521,2.14831 -1.14982,0.81455 -2.3902,1.52165 -3.64521,2.06955 -0.0281,0.72792 -0.0281,1.44796 0,2.12862 2.01387,-0.90061 3.74084,-1.94804 5.38118,-3.25087 -0.0394,-0.71722 -0.13613,-1.46145 -0.2672,-2.10555 -1.50421,-1.30339 -3.08774,-2.25182 -5.11398,-2.95723 z",
eyeIcon:"m 497.49603,305.21852 c -97.77686,0.37838 -210.4389,49.08614 -328.67132,194.10182 356.09919,436.75324 661.77595,0 661.77595,0 0,0 -136.4006,-194.86301 -333.10463,-194.10182 z m 2.5333,46.39679 c 81.7431,0 147.98657,66.2669 147.98657,148.01 0,81.74311 -66.24347,148.00999 -147.98657,148.00999 -81.74311,0 -148.01,-66.26688 -148.01,-148.00999 0,-81.7431 66.26689,-148.01 148.01,-148.01 z m -0.0232,71.30752 c -42.34668,0 -76.65557,34.33231 -76.65557,76.67899 0,42.34674 34.30889,76.67906 76.65557,76.67906 42.34674,0 76.67906,-34.33232 76.67906,-76.67906 0,-42.34668 -34.33232,-76.67899 -76.67906,-76.67899 z",
facebookIcon:"m 563.31845,262.74134 c -48.16955,0.80717 -85.29916,13.09952 -111.41486,36.77029 -10.62334,9.79274 -19.16367,23.64214 -25.69911,41.59766 -5.70223,17.95553 -8.98297,31.04723 -9.81617,39.21002 -0.78113,7.3452 -1.30188,13.46143 -1.30188,18.3591 l 0,80.80768 -72.20225,0 0,115.08356 72.20225,0 0,295.21164 139.5615,0 0,-293.99048 94.28213,0 12.26371,-115.08616 -106.54584,0 0,-67.33062 0,-3.71296 c 0,-3.26511 0.78113,-7.30615 2.60376,-12.20382 1.56226,-4.89767 4.03583,-8.5872 7.31657,-11.03733 6.53543,-6.52763 16.74217,-9.40999 30.62021,-8.59241 l 66.10945,0 0,-115.08617 -97.95343,0 z",
faceItemAngle1:"m 248.22537,846.77461 c 0,0 246.46373,52.95643 521.77463,10e-6 0,0 52.95652,-246.46379 0,-521.77462 0,0 -246.46379,-52.95652 -521.77463,-10e-6 0,0 -52.95651,246.46376 0,521.77462 z",faceItemAngle2:"m 625.55724,652.56769 c -49.99486,-1.36571 -99.68792,-6.28522 -150.89286,-14.96528 -6.59309,-1.1117 -12.18851,-2.2234 -12.43907,-2.44552 -0.57172,-0.50687 -3.69971,-18.21837 -6.30096,-35.68954 -5.03963,-33.8796 -8.23425,-65.64857 -10.5428,-104.93975 -1.07968,-18.58344 -1.07968,-86.4987 0,-104.92837 2.28634,-38.49044 5.54758,-71.29821 10.20967,-102.67306 1.7465,-11.82779 6.08116,-37.43626 6.37044,-37.73184 C 462.62848,248.55931 500.81922,242.49279 520,240 c 22.23019,-2.89032 50.65543,-5.47252 80.00203,-7.29555 18.34256,-1.1436 91.72701,-1.1436 110.12024,0 38.08881,2.35041 69.88291,5.61205 103.00212,10.54751 13.1412,1.9694 34.73588,5.63141 35.0058,5.93952 0,0 1.20666,6.4407 2.47654,14.09505 8.47284,50.57623 12.73461,92.83746 14.65935,145.42693 2.47711,67.62481 -3.14393,147.65376 -15.10068,215.01089 l -2.06425,11.62732 -8.4216,1.49271 c -51.2841,9.0679 -102.64336,14.19415 -157.73765,15.73755 -24.30356,0.6988 -30.47355,0.6988 -56.40004,0 z",
faceItemAngle3:"m 253.4555,840.5136 c -0.89168,-2.6767 -7.0821,-41.941 -9.7271,-61.704 -9.1761,-68.596 -12.7,-122.1 -12.703,-192.99 0,-59.914 2.2602,-102.81 8.3552,-158.19 4.1361,-37.574 13.7,-100.68 15.505,-102.32 0.50746,-0.44612 171.08,-63.363 205.57,-75.793 1.2146,-0.39035 1.3713,0.1673 0.7624,3.1674 -1.876,9.0729 -7.2545,45.61 -9.2687,62.956 -11.59,99.802 -8.6993,209.1 8.0507,304.36 1.4672,8.3536 1.4455,9.2124 -0.2788,11.404 -2.5401,3.2065 -204.75,210.46 -205.34,210.46 -0.24536,0 -0.67029,-0.60226 -0.91956,-1.3551 z",
faceItemAngle4:"m 792.9808,821.5 c 3.6504,-18.09 10.683,-75.701 13.675,-111.98 3.7703,-45.738 4.7417,-70.559 4.7172,-120.69 C 811.3172,504.224 805.4413,432.16 792,352 l -3.8009,-22.652 6.2668,-6.8089 c 12.544,-13.623 67.168,-70.208 67.774,-70.208 1.2765,0 9.0317,53.105 11.867,81.272 6.6394,65.953 7.1926,136.38 1.5742,200.87 -3.318,38.082 -11.418,94.678 -14.324,100.06 -0.65523,1.199 -16.188,44.249 -34.516,95.653 -18.328,51.404 -33.593,93.713 -33.922,94.02 -0.32901,0.33458 -0.30671,-0.90339 0.0613,-2.7046 z",
faceItemAngle5:"m 760.6253,301.09139 c -16.32,-3.0001 -47.908,-7.7959 -67.654,-10.272 -113.15,-14.164 -220.5,-15.28 -333.66,-3.4518 -25.764,2.6991 -75.905,9.5469 -89.278,12.201 -1.8547,0.33459 -1.9624,0.27883 -0.6703,-0.33459 0.8454,-0.39035 44.436,-16.551 96.867,-35.823 106.4,-39.086 96.232,-35.94 133.77,-41.411 30.493,-4.4667 58.834,-7.3553 96.099,-9.8146 19.33,-1.2603 95.816,-1.2548 115.32,0 35.697,2.3421 64.942,5.2697 93.793,9.4354 14.081,2.0187 38.203,5.9947 38.566,6.346 0.3848,0.33459 -71.27,74.725 -72.128,74.831 -0.5688,0.11153 -5.5318,-0.70264 -11.027,-1.7064 z",
faceItemAngle6:"m 248.34183,844.23624 207.9005,-212.73655 c 63.9727,11.84757 129.03406,17.82102 194.09541,17.82133 65.06444,1.8e-4 130.1258,-5.97345 194.10156,-17.82133 l -73.67838,213.12096 m 0.69194,-0.16914 C 685.1134,860.43996 597.31009,868.50092 509.50371,868.50031 421.7004,868.4996 333.89709,860.4375 247.5607,844.44843",fallbackInteractionIcon:"m 391.90253,91.880037 c -5.10668,0 -8.96525,3.85766 -8.96525,8.965193 l 0,40.34334 c 0,5.10753 3.85857,9.33875 8.96525,9.33875 5.10776,0 9.33928,-4.23122 9.33928,-9.33875 l 0,-40.34334 c 0,-5.107533 -4.23152,-8.965193 -9.33928,-8.965193 z m 74.70986,28.389763 c -2.35493,0.0717 -4.59497,1.1332 -6.3497,2.98839 l -27.64276,29.13686 c -3.50947,3.71112 -3.33747,9.56502 0.37055,13.07425 3.71163,3.50921 9.56532,3.33755 13.07371,-0.37295 l 27.64262,-29.51041 c 3.50961,-3.71111 3.33868,-9.19148 -0.37055,-12.70069 -1.85515,-1.75454 -4.36787,-2.68071 -6.72387,-2.61484 z m -147.9256,1.49421 c -2.35493,-0.0717 -4.86752,0.86066 -6.72387,2.61484 -3.71044,3.50922 -3.88257,9.36313 -0.37055,13.07424 l 27.64262,29.13685 c 3.50961,3.71112 9.36328,3.88277 13.07479,0.37294 3.71164,-3.50919 3.88255,-9.36311 0.37054,-13.07421 L 325.0377,124.75179 c -1.75474,-1.85554 -3.99491,-2.92251 -6.35091,-2.98838 z m 72.46861,48.18788 c -50.05802,0.38131 -43.0335,75.75823 -44.82598,101.23191 -1.79248,25.47368 -2.19917,416.88125 -2.19917,416.88125 0,0 -7.91325,-8.83487 -9.30232,-15.37427 -0.68131,-6.91394 1.80626,-12.34953 1.80626,-12.34953 0,0 0.29554,-132.04857 0.29554,-141.6429 -61.2031,-2.81262 -102.51478,28.38809 -101.47833,129.04855 1.03646,100.66047 70.27607,223.17371 146.36578,343.64026 l 322.37266,0 c 0,0 61.96186,-230.39353 62.38341,-316.0228 0.42155,-85.62927 -4.65116,-133.23942 -30.63113,-166.22954 -17.32117,-21.99493 -40.43783,-27.77879 -53.92266,-29.19097 -4.61044,-0.40785 -11.03873,-0.29263 -9.41478,4.77266 12.52765,42.63431 14.18998,69.04788 0.95417,112.576 0,0 4.35575,-46.29728 -0.70504,-71.15867 -5.0608,-24.86139 -12.90291,-73.51305 -60.55707,-85.73211 -47.65417,-12.21896 -37.83065,3.5131 -38.95905,54.04367 -1.12371,50.53054 -11.96411,71.32158 -11.96411,71.32158 0,0 15.997,-96.64622 -14.94004,-139.83693 -5.70434,-7.96374 -13.00436,-14.1101 -22.29453,-17.49813 -59.67363,-21.76233 -67.74213,-1.13798 -66.86484,40.34336 0.51547,41.48109 -6.35091,114.52422 -6.35091,114.52422 0,0 -7.59287,-249.99784 -9.71224,-281.65632 -2.11818,-31.65846 0,-112.07274 -50.05562,-111.69129 z m -101.60549,26.522 c -5.10653,0 -9.33821,3.85768 -9.33821,8.96519 0,5.10753 4.23168,9.33875 9.33821,9.33875 l 40.34338,0 c 5.10774,0 9.33929,-4.23122 9.33929,-9.33875 0,-5.10751 -4.23155,-8.96519 -9.33929,-8.96519 z m 166.6031,0.37297 c -5.10656,0 -9.33821,3.85766 -9.33821,8.96518 0,5.10753 4.23165,9.33875 9.33821,9.33875 l 39.97041,0 c 5.10777,0 9.33809,-4.23122 9.33809,-9.33875 0,-5.10752 -4.23032,-8.96518 -9.33809,-8.96518 z m -122.16456,47.3496 -22.39849,23.99835 c -3.50961,3.7111 -3.33748,9.56501 0.37054,13.07423 3.71165,3.50909 9.56518,3.33696 13.07358,-0.37296 l 7.96862,-8.64276 z m 116.80358,1.08057 1.87499,29.05483 7.22149,8.05783 c 3.5096,3.7111 9.36315,3.883 13.07478,0.37295 3.71164,-3.50921 3.88378,-9.36312 0.37056,-13.07424 -8.45785,-9.09466 -14.09384,-15.31854 -22.54182,-24.41137 z",
flagIcon:"M 839.5625 201.03125 C 839.5625 201.03125 719.10161 247.49586 651.71875 248.5 C 584.33586 249.50415 514.19401 201.82212 446.09375 203 C 377.99356 204.17797 254.3125 252.4375 254.3125 252.4375 L 252.34375 521.34375 L 253.28125 521.34375 L 251.34375 675.5625 C 251.34375 675.5625 371.80474 629.12921 439.1875 628.125 C 506.57037 627.12085 576.71217 674.77171 644.8125 673.59375 C 712.91267 672.41585 836.625 624.15625 836.625 624.15625 L 838.59375 355.25 L 837.65625 355.25 L 839.5625 201.03125 z M 178.40625 215.59375 C 164.81249 215.59375 153.875 226.53124 153.875 240.125 L 153.875 783.71875 C 153.875 797.31251 164.81249 808.25 178.40625 808.25 C 192.00001 808.25 202.96875 797.31251 202.96875 783.71875 L 202.96875 240.125 C 202.96875 226.53124 192.00001 215.59375 178.40625 215.59375 z ",
frameRateIcon:"m 752.8125,380.84375 -0.0625,0.0312 c 17.22593,0 34.33732,2.91078 51.3125,8.4375 16.98893,5.71908 31.62035,13.61191 43.96875,23.90625 l -24.3125,34.34375 c -7.9071,-7.23386 -18.74883,-13.11978 -32.375,-17.75 -13.62618,-4.70578 -27.15926,-6.875 -40.53125,-6.875 -13.12469,0 -23.91522,2.69722 -32.40625,8.0625 -8.41203,5.36529 -12.8125,13.63062 -12.8125,24.6875 0,10.76149 4.23216,19.14763 12.8125,25.0625 8.40859,5.72595 26.47973,11.78857 54,18.53125 27.79163,6.72893 48.62652,16.14447 62.5,28.15625 14.13454,12.11139 21.21875,29.9621 21.21875,53.625 0,23.40528 -8.92849,42.47179 -26.625,57.125 -17.7446,14.63259 -41.01445,22 -69.8125,22 -42.18722,0 -79.61552,-14.48347 -112.28125,-43.625 L 675.9375,582.2187 c 27.26266,23.66977 55.55828,35.53125 84.875,35.53125 14.63603,0 26.26928,-3.08472 34.75,-9.28125 8.74521,-6.39575 13.09375,-14.78877 13.09375,-25.0625 0,-10.60348 -4.01315,-18.63808 -12.25,-24.3125 -7.90366,-5.88396 -21.85416,-11.10328 -41.65625,-15.8125 -19.81584,-4.87066 -34.87908,-9.25733 -45.15625,-13.125 -10.26343,-4.03942 -19.43389,-9.41675 -27.40625,-15.8125 -15.97907,-12.11139 -23.90625,-30.61839 -23.90625,-55.5625 0,-24.94755 9.06992,-44.08302 27,-57.46875 18.2667,-13.63305 40.76322,-20.46875 67.53125,-20.46875 z m -579.625,6.59375 179.40625,0 0,42.46875 -133.875,0 0,74.0625 119.59375,0 0,42.03125 -119.59375,0 0,111.125 -45.53125,0 z m 232.46875,0 92.59375,0 c 40.89227,0 70.72494,7.90597 89.5,23.53125 18.79224,15.64932 28.1875,39.89678 28.1875,72.5625 0,32.6726 -9.60975,56.57813 -28.96875,71.75 -19.02581,15.14096 -48.33675,22.75 -87.9375,22.75 l -47.84375,0 0,79.09375 -45.53125,0 z m 45.4375,41.25 0.0937,0.0312 0,108.03125 52.84375,0 c 25.21546,0 42.31654,-4.69106 51.3125,-14.28125 9.25357,-9.75507 13.8125,-23.93379 13.8125,-42.4375 0,-18.79224 -5.73419,-32.02838 -17.375,-39.75 -11.60647,-7.73879 -29.68851,-11.59375 -54.375,-11.59375 z",
freeFlyIcon:"m 687.8112,317.97249 c 0,0 -112.5553,47.9265 -165.1562,78.25001 -52.6115,30.31119 -150.25,103.99999 -150.25,103.99999 0,0 98.0189,73.6897 150.625,104.00001 52.6061,30.3244 164.9687,78.0625 164.9688,78.0625 0,0 6.5935,-55.3655 10.9062,-110.03121 l 172.9062,0 c 2.7346,0 5.105,-2.625 6.3438,-6.5 0.5633,-1.7638 0.9085,-3.7992 0.9375,-5.9376 l 0,-119.4687 c -0.055,-6.9939 -3.2113,-12.4793 -7.1875,-12.5 l -173.0312,0 c -4.3597,-54.596 -11.0625,-109.875 -11.0626,-109.875 z m -473.375,91.03131 c -50.476,0 -91.4062,40.90039 -91.4062,91.37499 0,50.5033 40.9302,91.43741 91.4062,91.43741 50.4761,0 91.4063,-40.93421 91.4063,-91.43741 0,-50.4746 -40.9301,-91.37499 -91.4063,-91.37499 z",
fullscreenIcon:"m 394.61906,163.32715 c -10.95302,0 -101.34095,4.85479 -107.152,5.4135 -6.84631,0.38232 -54.28971,4.18516 -85.46858,7.2082 -12.41076,1.20429 -22.56061,2.21177 -22.62491,2.26544 -0.0321,0.0488 -1.07671,10.80212 -2.32428,23.89001 -2.95243,30.93606 -6.91397,77.51672 -6.91397,83.93868 -0.50397,1.87666 -4.18468,68.29513 -4.94277,90.6173 -0.23482,6.81873 -0.49989,13.70331 -0.61784,15.29901 -0.19087,2.6032 -0.14265,2.88329 0.50016,2.88329 0.39352,0 5.30739,-0.15192 10.91526,-0.38248 15.03294,-0.59088 57.76454,-1.91589 79.84914,-2.47139 l 19.30031,-0.47073 0.17652,-1.23569 c 0.10722,-0.67506 0.29395,-6.70994 0.4119,-13.41607 0.28361,-15.15276 1.56715,-52.03169 2.61848,-75.46538 0.43479,-9.71738 1.05917,-16.43057 1.05917,-17.27024 l 0.23537,-5.61945 c 5.61108,-0.0783 7.81666,-0.53439 11.06237,-0.76495 9.6985,-0.67452 63.18735,-2.65843 98.38449,-3.64822 6.38631,-0.18017 3.61881,-0.24266 3.61881,-0.55901 0.007,-2.44503 1.3782,-49.76109 2.00064,-69.02214 0.4348,-13.52487 0.91441,-28.32938 1.05917,-32.8929 l 0.26478,-8.29678 -1.41222,0 z m 208.3021,0 0.26478,8.29678 c 0.14476,4.56353 0.62491,19.36481 1.05918,32.8929 0.62243,19.25837 1.99474,66.58246 2.00064,69.02214 0,0.31635 -2.76859,0.37885 3.6188,0.55901 35.19713,0.99034 88.65657,2.97369 98.35507,3.64822 3.24463,0.23055 5.4513,0.68345 11.06237,0.76495 l 0.2648,5.61945 c 0,0.83967 0.62436,7.55285 1.05916,17.27024 1.05134,23.43368 2.33487,60.31262 2.61849,75.46538 0.11794,6.70935 0.31002,12.74101 0.41189,13.41607 l 0.17652,1.23569 19.27089,0.47073 c 22.08459,0.55604 64.84561,1.88051 79.87856,2.47139 5.6084,0.23056 10.52228,0.4119 10.91527,0.4119 0.64334,0 0.69154,-0.30896 0.50015,-2.91271 -0.11795,-1.59516 -0.41244,-8.48029 -0.64727,-15.29901 -0.75861,-22.31895 -4.40992,-88.74064 -4.91333,-90.6173 0,-6.41981 -3.96047,-53.00048 -6.91399,-83.93868 -1.24756,-13.08789 -2.29264,-23.84069 -2.32427,-23.89001 -0.0643,-0.0537 -10.21362,-1.06384 -22.62491,-2.26544 -31.17888,-3.02305 -78.62226,-6.79646 -85.46857,-7.17878 -5.81053,-0.56138 -96.22841,-5.44292 -107.18143,-5.44292 l -1.3828,0 z M 165.07487,601.82071 c -0.64335,0 -0.69155,0.31164 -0.50016,2.9127 0.11795,1.59571 0.4119,8.47975 0.64727,15.29903 0.75861,22.31894 4.40992,88.73526 4.91334,90.61729 0,6.41928 3.96046,52.99994 6.91397,83.93868 1.24757,13.08787 2.29265,23.81126 2.32428,23.86059 0.0643,0.0537 10.21309,1.09057 22.62491,2.29485 31.17834,3.02036 78.62226,6.79379 85.46858,7.17878 5.81052,0.55925 96.19897,5.44292 107.152,5.44292 l 1.41222,0 -0.26478,-8.29678 c -0.14476,-4.56352 -0.62492,-19.36802 -1.05917,-32.8929 -0.62244,-19.26105 -1.99475,-66.61188 -2.00064,-69.05156 0,-0.31634 2.76858,-0.34941 -3.61881,-0.52957 -35.19606,-0.99034 -88.68599,-2.97318 -98.38449,-3.64823 -3.24516,-0.23057 -5.42187,-0.71663 -11.03295,-0.79438 l -0.26479,-5.59002 c 0,-0.83968 -0.62438,-7.58228 -1.05917,-17.29967 -1.05079,-23.43422 -2.33487,-60.28857 -2.61848,-75.43595 -0.11795,-6.70882 -0.31003,-12.74423 -0.4119,-13.41607 l -0.17652,-1.23569 -19.30031,-0.47074 c -22.08459,-0.55604 -64.81619,-1.8805 -79.84914,-2.47139 -5.6084,-0.23055 -10.52228,-0.41189 -10.91526,-0.41189 z m 668.80271,0 c -0.39353,0 -5.30741,0.18134 -10.91527,0.41189 -15.03294,0.59089 -57.76454,1.88648 -79.84914,2.44197 l -19.30031,0.50016 -0.17652,1.23569 c -0.10722,0.67505 -0.29395,6.70993 -0.41189,13.41607 -0.28362,15.15275 -1.56715,52.00226 -2.61849,75.43595 -0.4348,9.71738 -1.05916,16.45999 -1.05916,17.29967 l -0.2648,5.59002 c -5.61108,0.0777 -7.8172,0.56381 -11.06237,0.79438 -9.6985,0.67452 -63.15794,2.65789 -98.35507,3.64823 -6.38685,0.18016 -3.6188,0.21323 -3.6188,0.52957 -0.006,2.43968 -1.37821,49.78998 -2.00064,69.05156 -0.43426,13.52488 -0.91442,28.32938 -1.05918,32.8929 l -0.26478,8.29678 1.3828,0 c 10.95839,0 101.3709,-4.88367 107.18143,-5.44292 6.8463,-0.38231 54.2897,-4.15627 85.46857,-7.17878 12.41076,-1.20481 22.56061,-2.24127 22.62491,-2.29485 0.0316,-0.0498 1.07618,-10.80213 2.32427,-23.89001 2.95297,-30.93552 6.91399,-77.48677 6.91399,-83.90926 0.50342,-1.87667 4.15417,-68.29567 4.91333,-90.61729 0.2343,-6.81927 0.52932,-13.70386 0.64727,-15.29903 0.19033,-2.6032 0.14265,-2.9127 -0.50015,-2.9127 z",
fullscreenIconOff:"m 389.83641,129.24266 c -41.80649,0.16951 -87.14064,4.11156 -124.21875,8.0625 l 0,131.4375 -130.90625,0 c -4.09581,44.24873 -7.16078,84.64983 -8.25,122.34375 0,0.0401 179.34469,-6.90886 254.96875,-6.625 -0.45404,-81.40803 5.47238,-166.1937 8.40625,-255.21875 z m 220.32718,0 c 2.93387,89.02404 8.86029,173.81072 8.40625,255.21875 75.62406,-0.28386 254.96875,6.66512 254.96875,6.625 -1.08922,-37.69392 -4.15419,-78.09502 -8.25,-122.34375 l -130.90625,0 0,-131.4375 c -37.07811,-3.95094 -82.41226,-7.89399 -124.21875,-8.0625 z M 126.46141,606.72609 c 1.08922,37.69392 4.15419,78.09603 8.25,122.34375 l 130.90625,0 0,131.4375 c 37.07811,3.95094 82.41226,7.89299 124.21875,8.0625 -2.93387,-89.02505 -8.86029,-173.84097 -8.40625,-255.25 -75.62406,0.28386 -254.96875,-6.63387 -254.96875,-6.59375 z m 747.07718,0 c 0,-0.0401 -179.34469,6.87761 -254.96875,6.59375 0.45404,81.40903 -5.47238,166.22596 -8.40625,255.25 41.80649,-0.16851 87.14064,-4.11156 124.21875,-8.0625 l 0,-131.4375 130.90625,0 c 4.09581,-44.24772 7.16078,-84.64983 8.25,-122.34375 z",
fullscreenInArrowBottomIcon:"m 834.23438,213.06445 -253.57227,0.84571 c -4.84735,0.0182 -7.20536,5.92998 -3.70117,9.27929 l 68.18554,65.13477 -121.05859,121.58203 c -2.10957,2.11889 -2.08941,5.55057 0.0449,7.64453 l 114.16797,112.01367 c 2.11558,2.0761 5.51108,2.05255 7.59766,-0.0527 l 118.99218,-120.03516 64.56836,64.06055 c 3.39203,3.36288 9.15818,0.97372 9.17774,-3.80273 l 1.00195,-251.26368 c 0.0113,-2.9897 -2.41458,-5.4165 -5.40429,-5.40625 z",fullscreenInArrowTopIcon:"m 359.42578,572.48633 c -1.39115,0.0333 -2.71543,0.60374 -3.69531,1.59179 L 236.73828,694.11523 172.16797,630.05469 c -3.40606,-3.37676 -9.19462,-0.95244 -9.17774,3.84375 l 1,251.26562 c 0.0125,2.97215 2.43019,5.3724 5.40235,5.36328 l 251.57422,-0.8457 c 4.84737,-0.0182 7.20537,-5.92999 3.70117,-9.2793 l -68.1875,-65.13476 121.06055,-121.58203 c 2.10957,-2.11889 2.08941,-5.55057 -0.0449,-7.64453 L 363.32617,574.02539 c -1.03885,-1.01883 -2.44574,-1.57398 -3.90039,-1.53906 z",
fullscreenoutArrowBottomIcon:"m 719.95312,213.06445 c -1.39075,0.0343 -2.71427,0.60544 -3.69335,1.59375 L 597.26758,334.69336 532.69727,270.63281 c -3.39204,-3.36288 -9.15819,-0.97371 -9.17774,3.80274 l -1,251.26367 c -0.0113,2.98894 2.4134,5.41542 5.40235,5.40625 l 253.57421,-0.8457 c 4.84737,-0.0182 7.20539,-5.92999 3.70118,-9.2793 L 717.00977,455.8457 838.07031,334.26367 c 2.10957,-2.11889 2.08941,-5.55057 -0.0449,-7.64453 L 723.85547,214.60547 c -1.03901,-1.02004 -2.44674,-1.57595 -3.90235,-1.54102 z",
fullscreenoutArrowTopIcon:"m 472.70703,572.48438 -251.57226,0.84765 c -4.84831,0.0164 -7.20801,5.92934 -3.70313,9.2793 l 68.18945,65.13476 -121.0625,121.58203 c -2.10957,2.11889 -2.08942,5.55057 0.0449,7.64454 l 114.16992,112.01367 c 2.11535,2.0748 5.50934,2.05125 7.5957,-0.0527 l 118.99219,-120.03515 64.57031,64.06054 c 3.40672,3.37743 9.19636,0.95143 9.17774,-3.8457 l -1,-251.26367 c -0.0114,-2.97291 -2.42943,-5.37435 -5.40235,-5.36523 z",fullSpecRendering:"m 687.8112,317.97249 c 0,0 -112.5553,47.9265 -165.1562,78.25001 -52.6115,30.31119 -150.25,103.99999 -150.25,103.99999 0,0 98.0189,73.6897 150.625,104.00001 52.6061,30.3244 164.9687,78.0625 164.9688,78.0625 0,0 6.5935,-55.3655 10.9062,-110.03121 l 172.9062,0 c 2.7346,0 5.105,-2.625 6.3438,-6.5 0.5633,-1.7638 0.9085,-3.7992 0.9375,-5.9376 l 0,-119.4687 c -0.055,-6.9939 -3.2113,-12.4793 -7.1875,-12.5 l -173.0312,0 c -4.3597,-54.596 -11.0625,-109.875 -11.0626,-109.875 z m -473.375,91.03131 c -50.476,0 -91.4062,40.90039 -91.4062,91.37499 0,50.5033 40.9302,91.43741 91.4062,91.43741 50.4761,0 91.4063,-40.93421 91.4063,-91.43741 0,-50.4746 -40.9301,-91.37499 -91.4063,-91.37499 z",
glowEffectIcon:"m 687.8112,317.97249 c 0,0 -112.5553,47.9265 -165.1562,78.25001 -52.6115,30.31119 -150.25,103.99999 -150.25,103.99999 0,0 98.0189,73.6897 150.625,104.00001 52.6061,30.3244 164.9687,78.0625 164.9688,78.0625 0,0 6.5935,-55.3655 10.9062,-110.03121 l 172.9062,0 c 2.7346,0 5.105,-2.625 6.3438,-6.5 0.5633,-1.7638 0.9085,-3.7992 0.9375,-5.9376 l 0,-119.4687 c -0.055,-6.9939 -3.2113,-12.4793 -7.1875,-12.5 l -173.0312,0 c -4.3597,-54.596 -11.0625,-109.875 -11.0626,-109.875 z m -473.375,91.03131 c -50.476,0 -91.4062,40.90039 -91.4062,91.37499 0,50.5033 40.9302,91.43741 91.4062,91.43741 50.4761,0 91.4063,-40.93421 91.4063,-91.43741 0,-50.4746 -40.9301,-91.37499 -91.4063,-91.37499 z",
goochRendering:"m 687.8112,317.97249 c 0,0 -112.5553,47.9265 -165.1562,78.25001 -52.6115,30.31119 -150.25,103.99999 -150.25,103.99999 0,0 98.0189,73.6897 150.625,104.00001 52.6061,30.3244 164.9687,78.0625 164.9688,78.0625 0,0 6.5935,-55.3655 10.9062,-110.03121 l 172.9062,0 c 2.7346,0 5.105,-2.625 6.3438,-6.5 0.5633,-1.7638 0.9085,-3.7992 0.9375,-5.9376 l 0,-119.4687 c -0.055,-6.9939 -3.2113,-12.4793 -7.1875,-12.5 l -173.0312,0 c -4.3597,-54.596 -11.0625,-109.875 -11.0626,-109.875 z m -473.375,91.03131 c -50.476,0 -91.4062,40.90039 -91.4062,91.37499 0,50.5033 40.9302,91.43741 91.4062,91.43741 50.4761,0 91.4063,-40.93421 91.4063,-91.43741 0,-50.4746 -40.9301,-91.37499 -91.4063,-91.37499 z",
graphicEffectsIcon:"m 297.75,135.03125 0,119.15625 0,49.34375 147.1875,-84.9375 -42.90625,-24.5 -103.40625,-59.0625 z m 413.21875,0 L 607.5,194.09375 563.46875,219.25 l 148.3125,85.59375 0,-50.65625 0,-119.15625 z m -206.03125,117.125 -208.0625,121 208.0625,120.4375 208.125,-120.4375 z m -221.65625,140.125 0,240.21875 197.28125,113.21875 11.71875,6.8125 0,-240.15625 -208.75,-119.8125 z m 443.34375,0 -208.71875,119.8125 0,240.1875 L 726.625,632.5 z m -501.59375,33.90625 -44.625,26.0625 -102.875,60.0625 102.875,60.0625 44.625,26.03125 z m 560.84375,0 0,172.4375 44.8125,-26.1875 L 933.53125,512.40625 830.6875,452.3125 z m -62.0625,274.59375 0,0.5 0.84375,-0.5 z m 0,0.5 -147.375,85.0625 43.9375,25.09375 103.4375,59.03125 0,-119.09375 z m -440.5625,0.875 0.8125,0.46875 0,-0.46875 z m 0.8125,0.46875 0,48.75 0,119.125 103.4375,-59.0625 42.75,-24.40625 z",
gridIcon:"m 232.84375,227.4375 0,524.21875 539.6875,0 0,-524.21875 z m 42.3125,41.125 3.25,0 3.25,0 75.53125,0 0,79.65625 -82.03125,0 z m 124.34375,0 3.25,0 3.25,0 75.53125,0 0,79.65625 -82.03125,0 z m 124.375,0 3.21875,0 3.25,0 75.5625,0 0,79.65625 -82.03125,0 z m 124.34375,0 3.21875,0 3.25,0 75.5625,0 0,79.65625 -82.03125,0 z m -373.0625,120.78125 3.25,0 3.25,0 75.53125,0 0,79.65625 -82.03125,0 z m 124.34375,0 3.25,0 3.25,0 75.53125,0 0,79.65625 -82.03125,0 z m 124.375,0 3.21875,0 3.25,0 75.5625,0 0,79.65625 -82.03125,0 z m 124.34375,0 3.21875,0 3.25,0 75.5625,0 0,79.65625 -82.03125,0 z m -373.0625,120.75 3.25,0 3.25,0 75.53125,0 0,79.6875 -82.03125,0 z m 124.34375,0 3.25,0 3.25,0 75.53125,0 0,79.6875 -82.03125,0 z m 124.375,0 3.21875,0 3.25,0 75.5625,0 0,79.6875 -82.03125,0 z m 124.34375,0 3.21875,0 3.25,0 75.5625,0 0,79.6875 -82.03125,0 z m -373.0625,120.78125 3.25,0 3.25,0 75.53125,0 0,79.6875 -82.03125,0 z m 124.34375,0 3.25,0 3.25,0 75.53125,0 0,79.6875 -82.03125,0 z m 124.375,0 3.21875,0 3.25,0 75.5625,0 0,79.6875 -82.03125,0 z m 124.34375,0 3.21875,0 3.25,0 75.5625,0 0,79.6875 -82.03125,0 z",
hatchingRendering:"m 687.8112,317.97249 c 0,0 -112.5553,47.9265 -165.1562,78.25001 -52.6115,30.31119 -150.25,103.99999 -150.25,103.99999 0,0 98.0189,73.6897 150.625,104.00001 52.6061,30.3244 164.9687,78.0625 164.9688,78.0625 0,0 6.5935,-55.3655 10.9062,-110.03121 l 172.9062,0 c 2.7346,0 5.105,-2.625 6.3438,-6.5 0.5633,-1.7638 0.9085,-3.7992 0.9375,-5.9376 l 0,-119.4687 c -0.055,-6.9939 -3.2113,-12.4793 -7.1875,-12.5 l -173.0312,0 c -4.3597,-54.596 -11.0625,-109.875 -11.0626,-109.875 z m -473.375,91.03131 c -50.476,0 -91.4062,40.90039 -91.4062,91.37499 0,50.5033 40.9302,91.43741 91.4062,91.43741 50.4761,0 91.4063,-40.93421 91.4063,-91.43741 0,-50.4746 -40.9301,-91.37499 -91.4063,-91.37499 z",
helpIcon:"M 508.46875 151.5625 C 451.00101 151.56319 402.89828 168.04013 364.15625 200.96875 C 326.05972 233.25299 303.80074 278.09821 297.34375 335.5625 L 414.53125 335.5625 C 417.11391 310.38181 426.48227 290.38228 442.625 275.53125 C 459.41309 260.0357 480.08807 252.28184 504.625 252.28125 C 529.16143 252.28184 549.1591 260.35877 564.65625 276.5 C 580.1528 291.99669 587.90592 311.67316 587.90625 335.5625 C 587.90592 359.45287 580.47585 379.48365 565.625 395.625 L 494.9375 466.3125 C 474.2748 486.97438 460.70684 503.77439 454.25 516.6875 C 448.4385 528.95559 445.53107 548.01715 445.53125 573.84375 L 445.53125 632.90625 L 554.96875 632.90625 L 554.96875 589.3125 C 554.96846 563.48588 560.78331 543.48635 572.40625 529.28125 C 576.92586 524.11619 582.7407 517.97773 589.84375 510.875 C 597.59185 503.12728 606.63717 494.40418 616.96875 484.71875 C 627.94534 474.38836 636.6676 465.98835 643.125 459.53125 C 649.58164 453.07491 658.91874 442.12155 671.1875 426.625 C 692.49526 400.79855 703.15581 368.52208 703.15625 329.78125 C 703.15581 273.60831 685.09644 230.02414 648.9375 199.03125 C 612.77779 167.39398 565.93599 151.56319 508.46875 151.5625 z M 500.75 704.59375 C 480.733 704.59389 463.28847 711.67034 448.4375 725.875 C 434.23186 740.0799 427.12484 757.203 427.125 777.21875 C 427.12484 796.58898 434.55492 813.38899 449.40625 827.59375 C 464.25722 841.15287 481.70174 847.90625 501.71875 847.90625 C 522.38098 847.90625 539.79426 840.8298 554 826.625 C 568.85086 812.42024 576.28094 795.62022 576.28125 776.25 C 576.28094 756.23424 568.85086 739.43423 554 725.875 C 539.14855 711.67034 521.41223 704.59389 500.75 704.59375 z",
highLightEffectIcon:"m 687.8112,317.97249 c 0,0 -112.5553,47.9265 -165.1562,78.25001 -52.6115,30.31119 -150.25,103.99999 -150.25,103.99999 0,0 98.0189,73.6897 150.625,104.00001 52.6061,30.3244 164.9687,78.0625 164.9688,78.0625 0,0 6.5935,-55.3655 10.9062,-110.03121 l 172.9062,0 c 2.7346,0 5.105,-2.625 6.3438,-6.5 0.5633,-1.7638 0.9085,-3.7992 0.9375,-5.9376 l 0,-119.4687 c -0.055,-6.9939 -3.2113,-12.4793 -7.1875,-12.5 l -173.0312,0 c -4.3597,-54.596 -11.0625,-109.875 -11.0626,-109.875 z m -473.375,91.03131 c -50.476,0 -91.4062,40.90039 -91.4062,91.37499 0,50.5033 40.9302,91.43741 91.4062,91.43741 50.4761,0 91.4063,-40.93421 91.4063,-91.43741 0,-50.4746 -40.9301,-91.37499 -91.4063,-91.37499 z",
icoAnnotionGout:"m 11.024,1.555 c -5.292,0 -9.583,4.29 -9.583,9.583 0,1.568 0.376,3.049 1.043,4.356 1.644,2.701 5.436,9.274 7.498,12.936 0.914,1.409 1.254,1.401 2.132,-0.058 1.94,-3.398 5.324,-9.213 7.448,-12.886 0.667,-1.305 1.044,-2.782 1.044,-4.349 0,-5.292 -4.29,-9.582 -9.582,-9.582 z",infoIcon:"m 502.9471,181.9408 c -190.37611,0 -344.7973,154.24087 -344.7973,344.61668 0,190.37581 154.42119,344.79777 344.7973,344.79777 190.37613,0 344.61747,-154.42196 344.61747,-344.79777 0,-190.37581 -154.24134,-344.61668 -344.61747,-344.61668 z m 25.36613,130.99771 c 29.87805,0 53.99474,24.11572 53.99474,53.99361 0,29.8779 -24.11669,54.17474 -53.99474,54.17474 -29.87804,0 -54.17457,-24.29684 -54.17457,-54.17474 0,-29.87789 24.29653,-53.99361 54.17457,-53.99361 z m -47.65279,145.85516 c 14.13998,-0.063 43.03676,-1.30939 61.24219,35.51258 18.20385,36.82309 -47.03123,173.87134 -27.72148,195.68141 19.30975,21.80993 49.6532,2.7537 53.81172,14.85731 4.15853,12.10361 -46.03102,35.29598 -76.82249,35.33116 -30.79149,0.0315 -67.64092,-18.06929 -70.48216,-55.98644 -2.84282,-37.91715 48.52363,-165.24033 28.99144,-179.19335 -19.53534,-13.95335 -49.53487,1.2116 -52.72635,-13.2267 -3.19304,-14.43877 69.57032,-32.90087 83.70713,-32.97597 z",
itemAngle:"m 645.95777,225.2839 c -61.8904,0.0811 -123.7169,5.70913 -184.6031,16.80623 a 21.677481,21.687806 0 0 0 -4.875,1.17526 l -197.87708,73.01309 a 21.677481,21.687806 0 0 0 -13.83206,16.45367 c -15.05854,82.57211 -22.61294,166.4468 -22.58344,250.38933 0,83.68485 7.58589,167.4123 22.58344,249.7429 a 21.677481,21.687806 0 0 0 17.44416,17.42329 c 82.32868,15.06027 166.01608,22.61136 249.71048,22.50625 83.7115,-0.1053 167.314,-7.84943 249.6224,-23.12331 a 21.677481,21.687806 0 0 0 17.4442,-17.45262 c 0.043,-0.23853 0.045,-0.46644 0.088,-0.70516 l 69.5419,-196.53296 a 21.677481,21.687806 0 0 0 0.8516,-3.37888 l 0.1175,0.0293 c 11.3818,-61.45513 17.1799,-123.89948 17.1799,-186.39638 0,-62.33129 -5.7299,-124.66427 -17.0625,-185.95568 a 21.677481,21.687806 0 0 0 -17.4441,-17.45257 c -61.4162,-11.12467 -123.8892,-16.6236 -186.306,-16.5418 z m 0.088,43.36713 c 46.038,-0.0603 92.0471,3.2702 137.6447,9.63714 l -33.8605,35.46349 c -78.6895,-13.87683 -158.5565,-20.86143 -238.4628,-20.86088 -10.1176,9e-5 -20.2201,0.0997 -30.3365,0.3232 0.5654,-3.62714 1.1566,-7.25094 1.762,-10.87116 53.9072,-9.03756 108.6,-13.62019 163.2531,-13.69179 z m 167.6875,40.98722 c 6.3324,44.90635 9.6869,90.25567 9.6912,135.59575 0,54.78532 -4.6863,109.58001 -13.832,163.59631 -2.9511,0.45453 -5.8976,0.90946 -8.8396,1.38093 0.1821,-9.44649 0.6263,-18.93409 0.6167,-28.38255 -0.083,-79.63082 -7.0124,-159.14706 -20.7039,-237.57899 l 33.0676,-34.61145 z m -302.3661,26.61968 c 76.1348,-5.5e-4 152.2858,6.52779 227.3032,19.53871 12.7848,74.64416 19.2755,150.42033 19.353,226.14958 0,11.4244 -0.4546,22.80808 -0.7341,34.22947 -37.0414,4.24678 -74.2557,6.6991 -111.5372,6.69899 -54.5068,-2.6e-4 -108.9736,-4.87084 -162.7244,-13.92684 -9.0369,-53.82537 -13.7959,-108.34028 -13.832,-162.92054 -0.022,-36.47195 2.0058,-72.97102 6.0203,-109.2405 12.0549,-0.32789 24.0925,-0.52877 36.1512,-0.52887 z m -79.8498,2.40928 c -3.7569,35.65651 -5.6911,71.49332 -5.6679,107.36009 0.038,58.18424 5.1725,116.33073 15.0067,173.67418 L 280.80429,783.62099 c -9.9646,-66.34429 -15.2598,-133.41461 -15.271,-200.49951 -0.028,-76.19396 6.6188,-152.3577 19.4411,-227.47175 48.48128,-8.37522 97.42978,-14.03084 146.54308,-16.98252 z m 39.4991,312.29621 c 57.6722,9.99737 116.2024,15.2781 174.7356,15.27839 36.6958,1.1e-4 73.354,-2.28866 109.8339,-6.22889 -2.8594,50.07215 -8.4661,99.99626 -16.8863,149.43443 -74.8916,13.01597 -150.8507,19.88392 -226.8626,19.97944 -67.0401,0.0846 -134.0188,-5.2128 -200.3147,-15.19025 l 159.4941,-163.27312 z",
leftArrowIcon:"m 152.43069,30.969952 c 0.0374,2.64533 -0.67534,5.24404 -2.05836,7.49619 0,0 -17.0269,28.6679 -34.04342,57.718589 -8.50845,14.523959 -17.008827,29.144369 -23.344677,40.277219 -3.04336,5.34369 -5.50177,9.75633 -7.26258,13.01148 1.74878,3.23228 4.17417,7.60749 7.18458,12.89575 6.29447,11.05807 14.758687,25.58077 23.208047,40.005 16.9011,28.85406 33.81101,57.30853 33.81101,57.30853 9.4785,15.93747 -14.42744,30.15544 -23.90594,14.21797 0,0 -16.92807,-28.51035 -33.890647,-57.46407 -8.47991,-14.47772 -16.97468,-29.06197 -23.38054,-40.31824 -3.20412,-5.6263 -5.89322,-10.41807 -7.84468,-14.04069 -0.9649,-1.81311 -1.74079,-3.30057 -2.39208,-4.64056 -0.32198,-0.66712 -0.59914,-1.27844 -0.9327,-2.07846 -0.32123,-0.78396 -1.20201,0 -1.22614,-5.84579 0,-5.92348 1.22614,-5.88605 1.22614,-5.88605 0.32198,-0.80406 0.59914,-1.40708 0.9327,-2.07846 0.66712,-1.35083 1.42718,-2.86242 2.40814,-4.67919 1.96192,-3.64638 4.68,-8.45458 7.9034,-14.12107 6.44807,-11.32986 14.95972,-26.031099 23.49872,-40.607278 17.076797,-29.15117 34.141517,-57.83274 34.141517,-57.83274 7.01246,-12.23887 25.68893,-7.46197 25.96393,6.64058 z",
leftBg:"m 62.414375,80.625266 c 0,0 -85.2542,396.779664 0,839.999974 0,0 284.501425,82.83926 840.000015,79.38776 0,0 0,-539.99989 0,-999.99985379 0,0 -381.38787,-5.55150961 -840.000015,80.61211979 z",lightBulb:"m 511.92953,86.94836 c -70.86597,0 -131.71092,24.33471 -181.70534,72.13149 -50.0028,47.81393 -74.80251,108.21422 -74.81972,176.36102 -3.24921,34.10759 14.84944,81.41747 50.78679,144.26298 11.10687,19.43511 22.31489,40.7323 34.72158,66.81961 9.16588,18.04139 15.57973,37.40567 21.3771,56.13106 5.21549,16.73317 14.26683,44.73679 24.06537,88.16431 5.2157,21.4701 7.0064,33.02004 8.0326,34.72159 18.12674,20.63215 49.92922,18.72115 69.47561,18.72115 l 93.50853,0 c 30.04613,0 56.42787,3.3218 74.81982,-18.72115 -0.008,-1.28259 2.73136,-12.66153 8.03261,-34.72159 9.79876,-42.7435 16.08438,-74.18791 21.37709,-90.85264 6.49832,-18.73395 14.8994,-36.12309 24.06542,-56.13106 3.24919,-6.07077 14.48277,-27.96834 34.72158,-66.78722 31.99564,-60.79341 48.09846,-109.50375 48.09846,-144.29537 0,-68.15532 -24.80845,-125.86732 -74.81982,-173.67269 C 643.6986,111.30873 582.90289,86.94836 511.99431,86.94836 l -0.0648,0 z m -85.96187,684.77953 c -10.25997,0 -18.52682,8.26676 -18.52682,18.52681 0,10.26005 8.26685,18.52682 18.52682,18.52682 l 174.7092,0 c 10.26005,0 18.52681,-8.26677 18.52681,-18.52682 0,-10.26005 -8.26676,-18.52681 -18.52681,-18.52681 l -174.7092,0 z m 1.42514,51.27263 c -10.25997,0 -18.52682,8.26677 -18.52682,18.52682 0,10.26005 8.26685,18.52681 18.52682,18.52681 l 172.02086,0 c 10.26005,0 18.49443,-8.26676 18.49443,-18.52681 0,-10.26005 -8.23438,-18.52682 -18.49443,-18.52682 l -172.02086,0 z m -1.42514,51.3698 c -10.25997,0 -18.52682,8.2344 -18.52682,18.4944 0,10.2601 8.26685,18.5268 18.52682,18.5268 l 174.7092,0 c 10.26005,0 18.52681,-8.2667 18.52681,-18.5268 0,-10.26 -8.26676,-18.4944 -18.52681,-18.4944 l -174.7092,0 z m 28.21133,62.1555 c 12.09023,20.6407 33.14426,34.754 58.78701,34.754 25.48878,0 46.64543,-14.3185 58.787,-34.754 l -117.57401,0 z",
lightsIcon:"m 518.07606,198.68047 c 49.98124,0 92.85589,17.2694 128.08749,51.10561 35.24966,33.86646 52.74189,74.75941 52.74189,123.0423 0.006,24.64727 -11.35005,59.14975 -33.91152,102.21727 -14.26745,27.50024 -22.19382,43.02514 -24.48433,47.31979 -6.46162,14.17414 -12.3687,26.48261 -16.94971,39.75421 -3.73715,11.80572 -8.16746,34.07846 -15.06911,64.359 -3.73715,15.62789 -5.66601,23.70229 -5.66601,24.60485 -12.96544,15.61575 -31.56073,13.25341 -52.7419,13.25341 l -65.93038,0 c -13.77921,0 -36.19604,1.39319 -48.96861,-13.25341 -0.7233,-1.21147 -1.98911,-9.3949 -5.66598,-24.60485 -6.90769,-30.76512 -13.27288,-50.60889 -16.94975,-62.46305 -4.0988,-13.26554 -8.61351,-26.97326 -15.06911,-39.75422 -8.75213,-18.48087 -16.66043,-33.55146 -24.49034,-47.32583 -25.33416,-44.52128 -38.08264,-78.04855 -35.78611,-102.21119 0.0113,-48.27686 17.48619,-91.06576 52.74189,-124.93828 35.23763,-33.86044 78.13034,-51.10561 128.08748,-51.10561 z m -60.27645,484.58557 122.43354,0 c 7.2151,0 13.19451,5.99672 13.18851,13.24734 -0.006,7.25668 -5.9674,13.25341 -13.18851,13.25341 l -122.43354,0 c -7.22113,0 -13.18848,-5.99673 -13.18848,-13.25341 0,-7.25062 5.96735,-13.24734 13.18848,-13.24734 z m 0,35.9623 122.43354,0 c 7.2151,0 13.19451,5.99672 13.18851,13.25341 -0.006,7.25666 -5.9674,13.25344 -13.18851,13.25344 l -122.43354,0 c -7.22113,0 -13.18848,-5.99678 -13.18848,-13.25344 0,-7.25669 5.96735,-13.25341 13.18848,-13.25341 z m 0,37.85824 122.43354,0 c 7.2151,0 13.19451,5.99673 13.18851,13.2534 -0.006,7.25667 -5.9674,13.25344 -13.18851,13.25344 l -122.43354,0 c -7.22113,0 -13.18848,-5.99677 -13.18848,-13.25344 0,-7.25667 5.96735,-13.2534 13.18848,-13.2534 z m 18.83037,43.54002 82.88011,0 c -8.5532,14.47699 -23.47164,24.60484 -41.43403,24.60484 -18.08294,0 -32.92903,-9.98249 -41.44608,-24.60484 z",
linkedinIcon:"m 346.19537,317.62544 c -15.24297,0 -28.37897,5.50152 -39.382,16.51235 -10.17066,10.16545 -15.295,22.85665 -15.295,38.10222 0,15.24818 5.12434,28.4128 15.295,39.42623 11.00303,10.16545 24.13903,15.24037 39.382,15.24037 15.24298,0 27.93678,-5.07492 38.08142,-15.24037 11.02904,-11.01343 16.51755,-24.17805 16.51755,-39.42623 0,-15.24557 -5.48851,-27.93677 -16.51755,-38.10222 -10.14464,-11.01083 -22.83844,-16.51235 -38.08142,-16.51235 z m 313.75548,134.68439 c -3.38154,0 -8.45386,0.41619 -15.24297,1.27458 -5.07232,0 -9.72844,0.41619 -13.96838,1.27459 -4.23994,0 -8.47988,0.41619 -12.69381,1.27458 -4.23994,0.85839 -7.67351,1.69077 -10.22267,2.54916 -2.60119,0.83239 -5.87869,2.10697 -10.11863,3.81075 -4.18792,1.69077 -7.15327,2.96015 -8.87006,3.81074 -0.78035,0 -3.40755,1.27458 -7.62148,3.81074 -4.21393,2.54917 -7.15327,4.22954 -8.89607,5.08013 -0.78036,0.85839 -3.84976,2.96015 -8.94809,6.3495 -4.18792,2.54917 -7.15327,4.23214 -8.89607,5.08012 l 0,-30.48334 -108.00139,0 0,306.19903 108.00139,0 0,-199.45661 2.65321,-8.89087 c 1.82084,-5.08272 6.29488,-10.16025 13.91637,-15.24297 8.45386,-5.08533 19.09273,-7.20009 31.81254,-6.3495 13.5522,0.85839 23.72285,3.80814 30.48595,8.89086 7.59547,5.08013 11.83541,9.31226 12.6938,12.70161 0.78036,2.54917 1.82083,5.08012 2.60119,7.61888 l 0,202.00058 106.72681,0 0,-228.67317 -2.60119,-8.89087 c -0.78036,-5.92811 -4.21393,-14.01521 -10.14464,-24.18066 -5.09833,-10.16545 -12.27762,-18.62711 -21.58988,-25.40321 -19.50892,-16.09356 -39.85022,-24.13124 -61.0239,-24.13124 l 0,0 z m -369.70706,2.54917 0,308.78981 110.55055,0 0,-308.78981 z",
mirrorEffectIcon:"m 687.8112,317.97249 c 0,0 -112.5553,47.9265 -165.1562,78.25001 -52.6115,30.31119 -150.25,103.99999 -150.25,103.99999 0,0 98.0189,73.6897 150.625,104.00001 52.6061,30.3244 164.9687,78.0625 164.9688,78.0625 0,0 6.5935,-55.3655 10.9062,-110.03121 l 172.9062,0 c 2.7346,0 5.105,-2.625 6.3438,-6.5 0.5633,-1.7638 0.9085,-3.7992 0.9375,-5.9376 l 0,-119.4687 c -0.055,-6.9939 -3.2113,-12.4793 -7.1875,-12.5 l -173.0312,0 c -4.3597,-54.596 -11.0625,-109.875 -11.0626,-109.875 z m -473.375,91.03131 c -50.476,0 -91.4062,40.90039 -91.4062,91.37499 0,50.5033 40.9302,91.43741 91.4062,91.43741 50.4761,0 91.4063,-40.93421 91.4063,-91.43741 0,-50.4746 -40.9301,-91.37499 -91.4063,-91.37499 z",
modeControlIcon:"m 419.16503,86.575859 c -2.07555,0 -4.1511,0 -6.22665,0 C 343.4073,90.72706 287.36724,145.72929 284.25397,217.33592 l 0,12.4534 c 2.07555,44.62438 25.94442,84.06003 61.22888,106.89109 l 1.03772,-30.09553 c -22.83105,-19.71778 -37.36,-47.73786 -38.39773,-78.87121 l 0,-10.37775 c 2.07555,-59.15323 48.77558,-104.81553 105.85336,-107.92891 2.07555,0 4.1511,0 5.18883,0 2.07555,0 4.1512,0 6.22675,0 62.2666,3.11338 110.00446,55.00233 106.89108,117.26894 -1.03772,32.17107 -15.56668,60.19115 -38.39773,79.90893 0,10.37775 1.03773,20.7555 1.03773,30.09553 35.28445,-22.83106 59.15333,-62.26671 61.22888,-107.92891 4.1511,-75.75773 -53.96451,-139.062265 -129.72224,-142.175641 -2.07555,0 -5.18892,0 -7.26447,0 m 0,88.211131 c -25.94443,0 -41.51111,17.64233 -42.54883,63.30453 l -7.26448,438.89226 -10.37775,-5.18882 c 0,0 0,-76.79566 0,-108.96674 0,-21.79333 -33.2089,-17.64222 -45.6623,-14.52885 -18.67995,5.18883 -28.01998,38.39783 -37.36001,67.45553 -4.1511,14.52885 -6.22665,29.0578 -6.22665,42.54893 8.3022,122.45766 65.38008,252.1801 114.15556,332.08893 l 1.03783,12.45344 290.57782,0 c 2.07555,-8.30224 3.11338,-16.60454 6.22665,-24.90674 33.20891,-125.57104 71.60674,-238.68907 72.64446,-354.92008 0,-33.20891 -3.11327,-70.56891 -14.52885,-97.55116 -7.26448,-19.71778 -32.17118,-39.43555 -51.88886,-38.39783 -8.3023,0 -7.26447,8.3023 -7.26447,14.52895 l 0,85.09776 -11.41558,9.34002 0,-90.28668 c 0,-33.2089 -39.43555,-50.85113 -65.37998,-51.88895 -14.52895,0 -19.71777,8.3023 -19.71777,20.7556 0,48.77548 0,45.6623 0,94.43778 l -11.41558,9.34003 0,-100.66444 c 0,-40.47337 -44.62448,-50.85112 -68.49336,-51.88895 -12.4533,0 -21.79332,8.3023 -22.83115,20.7556 0,5.18883 0,9.34003 0,14.52885 l 0,89.24896 -12.4533,9.33993 c 0,0 -2.07555,-212.65679 -6.22665,-321.62333 -1.03782,-45.6622 -17.64233,-63.30453 -42.54893,-63.30453 l -1.03782,0",
mouseBody:"m 30.363454,24.947212 c -5.855028,0.03033 -11.689378,0.20303 -17.489266,0.504914 -0.08615,2.227305 -0.172309,4.383189 -0.172309,6.219734 l 0,1.514777 0,0.137675 0,2.777071 c 0.103385,8.113227 0.697848,16.256988 1.797173,24.557635 0.155078,1.093553 0.311878,1.963123 0.311878,1.973788 0.03446,0.02826 1.776496,0.289478 3.089483,0.459029 3.537484,0.456565 6.659706,0.739805 10.710668,0.895089 1.226833,0.04704 7.698723,-0.04256 8.960018,-0.114758 3.27213,-0.187695 5.910166,-0.408525 8.72051,-0.780331 1.347449,-0.178184 2.899944,-0.434544 2.899944,-0.459029 0,-0.0069 0.155077,-0.93994 0.310155,-2.088545 1.109663,-8.508502 1.662772,-16.204986 1.797172,-24.924841 l 0,-2.295108 0,-0.137675 0,-0.849185 c 0,-1.29269 -0.120615,-5.074541 -0.191261,-6.95418 -6.902661,-0.333589 -13.850121,-0.471797 -20.749335,-0.43606 z",
mouseLeftClic:"m 26.738092,1.3128826 c -0.137846,1.4250219 -0.244677,2.9235918 -0.299816,4.4066127 -0.01723,0.5261598 -0.05169,1.7001634 -0.05169,2.0885457 l 0,0.2524485 0,0.045834 0,0.6655915 c 0.03446,2.540027 0.180923,4.774087 0.458339,7.252532 0.03446,0.334587 0.06892,0.617483 0.06892,0.619671 0,0.0069 0.398031,0.06289 0.735755,0.114757 0.70474,0.108382 1.35951,0.174841 2.179697,0.229514 0.137846,0.01034 0.589293,0.01551 1.032125,0.02292 l 0,0.02292 0,5.921383 c -5.930843,0.0174 -11.890978,0.162142 -17.785636,0.481963 0.256739,-6.213221 0.765048,-12.593271 1.490464,-18.3379002 0.103385,-0.8340915 0.194709,-1.7366652 0.230893,-2.0196984 0.03446,-0.2830159 0.120616,-0.5174582 0.155077,-0.5278657 0.244678,-0.078228 3.440992,-0.5524368 5.048626,-0.7344285 2.219328,-0.2510701 4.473117,-0.4061128 6.725183,-0.5049315 z",
mouseRightClic:"m 37.24716,1.5215821 c 0.137846,1.4250219 0.244677,2.9235746 0.299816,4.4066127 0.01723,0.5261598 0.03446,1.7001634 0.03446,2.0885457 l 0,0.2524485 0,0.045834 0,0.6655915 c -0.03446,2.5400275 -0.180923,4.7740875 -0.458339,7.2525315 -0.03446,0.334571 -0.06892,0.617483 -0.06892,0.619671 0,0.0069 -0.396309,0.06289 -0.734032,0.114758 -0.70474,0.108381 -1.359511,0.174841 -2.179697,0.229514 -0.137847,0.01034 -0.591017,0.01551 -1.033848,0.02292 l 0,0.02292 0,5.921383 c 5.932565,0.0174 11.892701,0.162142 17.787359,0.481963 C 50.637218,17.433048 50.128909,11.052998 49.403492,5.3083683 49.300107,4.4742768 49.208784,3.5717031 49.172599,3.2886699 49.138138,3.005654 49.051984,2.7712117 49.017522,2.7608042 48.772845,2.6825764 45.57653,2.2083674 43.968896,2.0263757 41.749569,1.7753056 39.49578,1.6202629 37.243714,1.5214442 z",
mouseWheel:"M 31.867703,-1.2193954e-4 C 30.937239,0.00849346 30.015391,0.07896745 29.103882,0.21140341 c -0.155077,0.0239508 -0.789171,0.1285418 -0.792617,0.13216027 0,0.0103385 -0.172308,1.50909102 -0.225724,2.12852122 -0.137846,1.6029024 -0.236062,3.5528091 -0.237785,4.9180747 l 0,0.3833853 0,0.039631 0,0.7006906 c 0.01723,2.0574956 0.155077,4.1218836 0.396309,6.2269026 0.03446,0.27733 0.06892,0.499676 0.06892,0.502381 0,0.0069 0.387693,0.07599 0.673724,0.119065 0.77194,0.115791 1.45428,0.185369 2.339944,0.224741 0.2688,0.01206 1.681726,-0.0086 1.957419,-0.02636 0.715078,-0.04756 1.288864,-0.104074 1.904004,-0.198292 0.294646,-0.04514 0.634093,-0.112689 0.634093,-0.118892 0,-0.0017 0.03446,-0.237544 0.06892,-0.528831 0.242954,-2.157727 0.367016,-4.108117 0.398031,-6.3194318 l 0,-0.5817119 0,-0.039631 0,-0.2115426 c 0,-0.33812 -0.01723,-1.366351 -0.03446,-1.824432 C 36.202973,4.1310564 36.080634,2.4788394 35.911772,0.99163145 35.894542,0.7801061 35.86008,0.5478004 35.86008,0.47601687 c 0,-0.0716801 -0.03446,-0.12957565 -0.03446,-0.13216027 C 35.773926,0.32404118 35.041617,0.20497632 34.674601,0.15878053 33.754476,0.04316184 32.813674,-0.00835826 31.884934,8.4830112e-5 z",
moveAround:"m 502.45372,206.22859 c -0.26305,0.0275 -0.52611,0.16542 -0.76285,0.36944 v -0.0552 h -0.99958 c -13.6917,3.5008 -28.52502,17.0596 -42.46661,23.89249 -10.21157,6.31981 -20.4731,12.52741 -30.76094,18.72041 8.87527,5.20764 17.74791,10.47291 26.61528,15.70013 15.83291,-9.58434 31.67109,-19.16427 47.49611,-28.75055 12.57637,8.11874 25.16326,16.30171 37.73436,24.44829 8.78583,-5.20847 17.5664,-10.35822 26.3575,-15.54381 -20.1285,-13.09315 -40.31487,-26.03935 -60.76166,-38.4245 -0.73654,0 -1.6046,-0.49075 -2.39374,-0.36944 z m 122.87012,78.08771 c 0.0237,0.0146 0,0.0275 0,0.0551 0,0 0.0132,-0.0146 0.0132,-0.0146 z m 0,0.0551 c -4.31137,2.55847 -8.58328,5.01852 -12.87098,7.57975 -4.64545,2.1339 -9.18303,4.78804 -13.63645,7.60733 13.93106,9.01805 27.84635,18.03777 41.77215,27.05529 -13.68643,8.28581 -27.35707,16.65901 -41.0514,24.98948 2.05178,1.19653 4.06674,2.48128 6.02119,3.6756 8.67272,3.24744 9.4303,11.42463 8.9726,20.34509 13.19453,-8.02914 26.39432,-16.04725 39.59675,-24.07748 v 53.59695 c 8.78057,-5.55255 17.61374,-11.00391 26.48112,-16.4266 0,-21.85784 0.002,-43.7041 -0.81545,-65.49357 -7.65998,-14.1543 -25.92347,-17.62782 -37.38187,-27.89644 -5.68186,-3.65576 -11.40318,-7.32281 -17.08766,-10.9554 z m -260.6525,2.70736 c 0,0.0275 0,0.0551 0.26305,0.0827 0,-0.0248 0,-0.0551 0,-0.0827 z m 0.26305,0.0827 c -16.9535,10.294 -33.80704,20.72501 -50.43173,31.48603 -8.35443,14.54883 -0.99959,33.48372 -3.4249,49.55136 v 21.28467 c 8.75163,5.46709 17.5138,10.87241 26.27596,16.31329 v -53.3979 c 12.45272,7.60015 24.91335,15.16392 37.36609,22.73842 v -17.26749 c 4.07463,-2.47576 8.21765,-5.04415 12.35804,-7.69333 -12.2423,-7.43115 -24.4767,-14.89096 -36.71637,-22.33948 13.76535,-8.28664 27.53069,-16.65323 41.29605,-24.98949 -8.95156,-5.09379 -17.83472,-10.37119 -26.72314,-15.68609 z m 84.67281,100.86886 -0.36827,0.0143 c 0,0.0276 0,0.0552 0.26305,0.11028 0,-0.0276 0.26304,-0.0827 0.26304,-0.11028 z m -0.26306,0.11028 c -4.00623,2.3517 -8.00717,4.7012 -11.97398,7.05234 v 18.17866 c 14.81754,9.01227 29.64037,18.02895 44.46318,27.04123 v 55.16456 c 4.40081,2.73216 8.88051,5.55862 13.32077,8.29187 4.72702,-2.90474 9.45137,-5.90212 14.17836,-8.80466 v -55.47804 c 13.96789,-8.53974 27.94105,-16.99841 41.90892,-25.4885 v -17.11061 c -4.48233,-2.6467 -9.00414,-5.30029 -13.5128,-7.94974 -14.47295,8.80826 -28.96167,17.62203 -43.44252,26.42808 -14.98329,-9.10573 -29.95863,-18.20926 -44.94193,-27.3252 z m 258.1825,57.87081 v 12.13868 l 171.5736,102.13761 c 14.74395,8.776 14.78604,22.73759 0,31.51442 L 523.85011,803.27089 c -14.74389,8.77682 -38.18943,8.74843 -52.93069,-0.0276 l -133.03961,-79.1852 -6.02382,8.57666 128.86765,76.70619 c 20.2232,12.0386 53.1385,12.0386 73.3617,0 L 889.32501,597.87191 c 20.22321,-12.03887 20.17577,-31.5996 0,-43.63848 z m -427.3387,4.24601 -174.66182,103.97514 c -20.223198,12.03888 -20.223198,31.62828 0,43.66688 l 157.90296,94.0021 -46.00198,-4.14538 a 5.450126,5.7121915 0 1 0 -0.92067,11.36921 l 71.47301,6.51032 a 5.450126,5.7121915 0 0 0 5.02949,-8.83307 l -26.09708,-42.42763 a 5.450126,5.7121915 0 0 0 -5.08473,-2.69356 5.450126,5.7121915 0 0 0 -4.06411,8.83307 l 15.35943,24.98949 -157.41107,-93.70293 c -14.74389,-8.77683 -14.74389,-22.71002 0,-31.48602 L 280.19056,462.4091 Z m 30.74777,13.86262 c 0,28.27111 0,56.53312 0.81546,84.71243 7.82307,14.59708 26.88885,17.40009 38.79707,27.55402 9.10939,5.38355 18.1951,10.88123 27.26765,16.38443 v -31.99878 c -13.33921,-8.11515 -26.68631,-16.14925 -40.01763,-24.22001 v -55.99111 c -8.82791,-5.46488 -17.64268,-10.96642 -26.46797,-16.44094 z m 369.49687,0 c -8.75953,5.46487 -17.52169,10.88784 -26.2891,16.32652 v 55.67819 c -14.19149,8.58274 -28.37245,17.17347 -42.56131,25.75814 v 32.22709 c 22.16187,-13.33438 44.23693,-26.78537 65.91478,-40.80376 8.18345,-14.34923 0.89437,-33.11485 3.33021,-48.99585 V 464.12008 Z M 482.02271,569.8186 v 54.23905 c -14.11521,-8.54331 -28.22778,-17.07946 -42.34298,-25.63076 v 32.18409 c 17.44277,10.5231 34.9513,20.91055 52.6203,30.88776 15.70402,0 27.37287,-15.59621 41.55646,-21.25683 5.05053,-3.16004 10.18788,-6.22442 15.30418,-9.3602 v -31.59989 c -13.1919,7.94092 -26.36802,15.95737 -39.55466,23.93468 v -52.85643 c -4.5639,2.6467 -9.08045,5.21702 -13.6233,7.86399 -4.64281,-2.81846 -9.24616,-5.5575 -13.87845,-8.37678 z",
moveIcon:"M 500.84375 105.8125 C 428.37166 200.40575 397.78125 307.1875 397.78125 307.1875 C 506.6308 330.79406 604.125 307.1875 604.125 307.1875 C 567.76954 189.11936 500.84375 105.8125 500.84375 105.8125 z M 344.4375 359.0625 C 226.36935 395.41796 143.0625 462.34375 143.0625 462.34375 C 237.65575 534.81584 344.4375 565.40625 344.4375 565.40625 C 368.04406 456.5567 344.4375 359.0625 344.4375 359.0625 z M 656.75 359.21875 C 656.75 359.21875 633.14344 456.6817 656.75 565.53125 C 656.75 565.53125 763.53175 534.94084 858.125 462.46875 C 858.125 462.46875 774.81815 395.57421 656.75 359.21875 z M 502.0625 374.25 C 477.49992 374.1339 449.1192 375.90126 419.6875 381.5625 C 419.6875 381.5625 403.21845 458.22428 419.6875 543.84375 C 419.6875 543.84375 496.34927 560.313 581.96875 543.84375 C 581.96875 543.84375 598.43752 467.18195 581.96875 381.5625 C 581.96875 381.5625 548.95469 374.47164 502.0625 374.25 z M 496.59375 608.8125 C 466.75898 608.98543 432.85972 611.70492 397.78125 619.3125 C 397.78125 619.3125 428.37166 726.09425 500.84375 820.6875 C 500.84375 820.6875 567.76954 737.38064 604.125 619.3125 C 604.125 619.3125 562.1264 609.1302 502.5 608.8125 C 500.54795 608.8021 498.58273 608.80097 496.59375 608.8125 z ",
moveIconBot:"M 461.03125 143.71875 C 388.55916 238.312 357.96875 345.09375 357.96875 345.09375 C 466.8183 368.70031 564.3125 345.09375 564.3125 345.09375 C 527.95704 227.02561 461.03125 143.71875 461.03125 143.71875 z M 304.625 396.96875 C 186.55685 433.32421 103.25 500.21875 103.25 500.21875 C 197.84325 572.69084 304.625 603.28125 304.625 603.28125 C 328.23156 494.4317 304.625 396.96875 304.625 396.96875 z M 616.9375 397.09375 C 616.9375 397.09375 593.33094 494.58795 616.9375 603.4375 C 616.9375 603.4375 723.71925 572.84709 818.3125 500.375 C 818.3125 500.375 735.00565 433.44921 616.9375 397.09375 z M 455.4375 412.15625 C 432.49894 412.37739 406.63109 414.32217 379.875 419.46875 C 379.875 419.46875 363.40595 496.09928 379.875 581.71875 C 379.875 581.71875 456.53677 598.188 542.15625 581.71875 C 542.15625 581.71875 558.62502 505.0882 542.15625 419.46875 C 542.15625 419.46875 505.90232 411.66974 455.4375 412.15625 z M 456.78125 646.71875 C 426.94648 646.88824 393.04722 649.57992 357.96875 657.1875 C 357.96875 657.1875 388.55916 763.96925 461.03125 858.5625 C 461.03125 858.5625 527.95704 775.25564 564.3125 657.1875 C 564.3125 657.1875 522.3139 647.03645 462.6875 646.71875 C 460.73545 646.70835 458.77023 646.70745 456.78125 646.71875 z ",
openHandleMenu:"M 502.46,14.9 C 668.41,14.8 834.35,9.9 1000,0 932.69,57.86 860.98,110.56 785.71,157.54 695.18,214.04 599.49,262.25 500.22,301.39 400.95,262.4 305.26,214.31 214.74,157.91 139.29,110.89 67.430001,58.11 1.0217e-6,0.2 167.29,10.1 334.88,15 502.46,14.9",openHandleMenuBot:"M 14.872001,497.538 C 14.801001,331.588 9.840901,165.648 1.0217e-6,-0.002 57.820001,67.308 110.52,139.018 157.51,214.298 c 56.49,90.52 104.71,186.21 143.84,285.48 -38.98,99.27 -87.08,194.97 -143.48,285.48 -47.01,75.46 -99.795999,147.31 -157.72999898,214.78 C 10.030001,832.708 14.944001,665.118 14.872001,497.538",
orthographicModeIcon:"m 512.96294,129.6342 c -26.65063,6.49118 -55.52179,31.6773 -82.66381,44.37427 -92.95963,54.77405 -188.15045,106.49163 -279.78369,163.08489 -16.26101,27.00946 -1.90139,62.20185 -6.69903,92.04381 0.96618,112.0319 -1.71066,224.4485 1.42249,336.25225 15.15905,27.10506 52.35168,32.29663 75.53249,51.15274 92.33984,52.23021 183.17086,107.85452 276.40576,158.07435 30.56613,0.18935 53.28693,-28.94413 80.88801,-39.45197 92.51767,-54.48909 187.22446,-105.97483 278.44713,-162.2434 15.92524,-26.65663 1.81826,-61.4837 6.57848,-90.97927 -0.88028,-112.04344 1.90048,-224.47205 -1.15739,-336.28782 C 846.99972,319.37754 811.47433,312.91497 789.15903,293.85058 699.61146,239.58363 611.65358,182.01775 521.16201,129.7067 c -2.60018,-0.28634 -5.76564,-1.59058 -8.19907,-0.074 z M 785.48599,351.94112 C 690.76904,406.92623 596.05208,461.91135 501.33558,516.89646 407.85451,462.66324 314.37346,408.42954 220.89239,354.19629 c 97.92814,-56.5489 195.85628,-113.09736 293.78397,-169.6458 90.26988,55.79657 180.53976,111.5936 270.80963,167.39063 z m 26.24004,389.07501 c -93.82052,54.17043 -187.6415,108.34085 -281.46248,162.51081 0,-113.93284 0,-227.86612 0,-341.79944 93.87224,-54.49184 187.74404,-108.98372 281.61582,-163.47605 -0.0508,114.2552 -0.10154,228.50995 -0.15247,342.76468 z M 476.73693,563.27007 c 0,113.94208 0,227.8846 0,341.82668 C 382.91318,850.91754 289.08942,796.73789 195.26566,742.55868 195.21489,628.30395 195.16412,514.04921 195.11319,399.794 288.98821,454.28587 382.86276,508.77821 476.7378,563.27007 Z",
paletteIcon:"M 105.46816,454.14608 C 87.030105,496.87659 75.662006,539.11042 72.460867,575.81181 61.081535,706.30596 167.83483,829.61532 216.52333,844.27816 c 48.68602,14.66159 62.26933,1.78965 109.40658,-24.53582 47.12974,-26.32671 89.87649,-66.68353 128.71573,-59.24915 38.84048,7.43438 43.06,79.39074 124.93677,122.67787 81.88425,43.29088 198.62037,53.34483 285.32817,-85.88661 C 951.61714,658.053 936.92934,491.69986 846.06318,342.16611 755.18578,192.62863 542.76994,149.84194 370.16677,197.72674 246.10237,232.14178 152.53926,344.92172 105.46816,454.14608 z m 55.7098,-23.06943 c 3.45948,-8.01719 16.61722,-30.94059 26.50393,-39.46198 9.88672,-8.5214 18.59906,-12.70472 27.87549,-13.15026 9.2752,-0.4368 13.5621,3.49817 23.18673,8.38161 9.62089,4.88222 25.37074,21.96868 33.20448,22.17959 7.83624,0.21217 13.66943,10.71664 16.82564,19.98435 3.15496,9.26645 1.92068,20.14533 -1.38654,32.70278 -3.30847,12.5562 -12.87944,30.92936 -20.56466,40.12968 -7.68398,9.20031 7.38945,13.00798 -21.35466,16.23282 -28.74409,3.22861 -35.45089,-9.28892 -47.19339,-15.48901 -11.74126,-6.2026 -15.95203,-6.53956 -23.74958,-18.37191 -7.79505,-11.83112 -16.80567,-45.12171 -13.34744,-53.13767 z m -33.11462,190.92891 c 3.45947,-8.0172 16.61721,-30.93935 26.50518,-39.46074 9.88671,-8.52265 18.5978,-12.70472 27.87424,-13.15151 9.27643,-0.4368 13.79172,3.59676 23.41512,8.48021 9.62212,4.88221 25.37074,21.96867 33.20447,22.17958 7.83625,0.21217 13.44229,10.6193 16.59726,19.88576 3.1562,9.26771 1.92193,20.14533 -1.38654,32.70278 -3.30723,12.55621 -12.8782,30.92937 -20.56467,40.12968 -7.68273,9.2003 7.61908,13.10658 -21.12627,16.33268 -28.7441,3.22608 -35.35105,-9.51856 -47.09355,-15.71866 -11.7425,-6.20135 -16.05187,-6.31117 -23.84817,-18.14228 -7.79506,-11.83236 -17.03655,-45.22031 -13.57707,-53.2375 z M 302.02807,296.65379 c 3.45947,-8.01721 16.51863,-30.71097 26.40534,-39.23361 9.88796,-8.5214 18.6989,-12.93311 27.97408,-13.37864 9.27519,-0.44929 13.69314,3.82514 23.31528,8.70734 9.62463,4.88096 25.37074,21.96992 33.20573,22.18085 7.83499,0.21215 13.44228,10.62054 16.59724,19.88574 3.15747,9.26895 1.92193,20.14533 -1.38652,32.70278 -3.30847,12.55621 -12.8782,30.92937 -20.56592,40.12844 -7.68274,9.2003 7.61909,13.10657 -21.12627,16.33392 -28.74286,3.2261 -35.34981,-9.51856 -47.09355,-15.71991 -11.74001,-6.19884 -16.05188,-6.30992 -23.84693,-18.14228 -7.79506,-11.83111 -16.93796,-45.44868 -13.47848,-53.46463 z m 196.6872,-24.77544 c 3.45949,-8.01721 16.61473,-30.94061 26.50518,-39.462 9.88298,-8.52264 18.59906,-12.70347 27.87424,-13.15026 9.27769,-0.4368 13.79299,3.59802 23.41388,8.47897 9.62587,4.8822 25.37074,21.96992 33.20573,22.18083 7.83249,0.21216 13.67066,10.71914 16.82438,19.98435 3.15871,9.26769 1.69355,20.04673 -1.61367,32.60419 -3.30971,12.55619 -12.65604,31.02546 -20.33628,40.22702 -7.68399,9.20031 7.38696,13.00673 -21.3534,16.23532 -28.74911,3.22486 -35.45214,-9.29016 -47.19465,-15.49151 -11.74125,-6.2001 -15.95203,-6.53706 -23.74833,-18.36941 -7.7988,-11.83362 -17.03655,-45.22155 -13.57708,-53.2375 z m 157.83051,85.97523 c 3.45947,-8.01721 16.747,-30.61363 26.63497,-39.13628 9.88671,-8.52264 18.6964,-12.93185 27.97409,-13.37863 9.27518,-0.43681 13.56459,3.49941 23.18547,8.38036 9.62588,4.88096 25.37074,21.96992 33.20573,22.18085 7.83125,0.21216 13.67318,10.72037 16.82439,19.98433 3.15746,9.26895 1.92193,20.14534 -1.38654,32.70278 -3.30722,12.55621 -12.97678,31.15776 -20.66326,40.35806 -7.68273,9.20032 7.48681,12.77836 -21.25481,16.00571 -28.7466,3.2261 -35.4509,-9.28892 -47.19339,-15.49152 -11.74125,-6.2001 -16.05062,-6.30993 -23.84693,-18.13979 -7.7988,-11.83486 -16.93921,-45.44993 -13.47972,-53.46587 z m -76.0386,350.00865 c 18.8549,-43.694 69.45036,-63.9766 113.14684,-45.12171 43.69024,18.85364 63.87676,69.67875 45.02187,113.37273 -18.8549,43.69524 -69.58389,63.64962 -113.27414,44.79598 -43.69648,-18.8549 -63.74946,-69.35302 -44.89457,-113.047 z M 743.07511,516.20947 c 3.45948,-8.01594 16.51489,-30.7122 26.40535,-39.2336 9.88296,-8.52389 18.70014,-12.93185 27.97283,-13.37864 9.28143,-0.4368 13.5646,3.49941 23.18673,8.38161 9.62464,4.88096 25.37074,21.96868 33.20573,22.17959 7.83499,0.21217 13.66943,10.71789 16.82563,19.98559 3.15622,9.26646 1.92069,20.14409 -1.38653,32.70154 -3.31221,12.55496 -12.98802,31.15401 -20.66325,40.35806 -7.68648,9.19907 7.48804,12.77835 -21.25732,16.0057 -28.74285,3.22735 -35.4509,-9.29017 -47.1909,-15.49026 -11.745,-6.20261 -16.05311,-6.30994 -23.84942,-18.1423 -7.79381,-11.83236 -16.70832,-45.35008 -13.24885,-53.36729 z",
pauseIcon:"m 419.14001,304.18664 c -25.729,1.6922 -50.405,3.9752 -69.995,6.5178 -18.158,2.3572 -54.349,8.1187 -54.968,8.7379 -0.28537,0.28536 -4.3547,24.488 -6.0184,35.688 -4.4147,29.718 -7.4995,60.778 -9.6598,97.211 -1.0416,17.462 -1.073,81.767 -0.0285,99.36 2.1859,37.201 5.2308,67.279 10.005,99.357 2.4599,16.54 5.402,33.345 5.9414,33.811 0.2283,0.19976 5.5647,1.2414 11.806,2.3001 38.12,6.4608 75.323,10.724 112.51,12.879 -0.75623,-10.233 -1.4383,-20.572 -2.0318,-30.934 -5.462,-95.082 -5.7445,-218.91 -0.6906,-314.9 0.92175,-17.493 1.9719,-34.099 3.1419,-50.025 z m 116.3,0.0285 c 0.51081,6.9002 1.0245,13.8 1.4554,20.624 1.932,30.646 2.985,53.644 4.409,96.752 0.79618,24.105 0.79903,142.33 0,167.63 -1.3412,42.646 -3.0877,78.702 -5.3678,110.67 39.772,-2.3115 77.863,-6.6948 115.88,-13.418 l 7.9732,-1.4183 1.9548,-11.001 c 11.326,-63.786 16.646,-139.54 14.297,-203.58 -1.8235,-49.791 -5.89,-89.812 -13.915,-137.69 -1.2157,-7.2541 -2.263,-13.293 -2.3372,-13.381 -0.25683,-0.29393 -20.678,-3.7354 -33.12,-5.596 -29.496,-4.4032 -57.947,-7.3968 -91.23,-9.5827 z",
perspectiveModeIcon:"m 512.25196,212.09728 c -117.33534,29.83583 -239.65508,56.57931 -357.31935,88.98567 -21.59232,22.11505 -4.96699,58.07509 -10.17357,85.44208 1.12561,103.49494 -2.01025,207.48007 1.5929,310.69234 17.87694,27.6185 52.51437,40.75202 75.82604,63.65734 90.70594,68.81076 179.08367,141.62556 271.1942,208.02289 29.29937,5.0806 46.58625,-29.55953 70.06605,-41.08366 96.32987,-75.46733 194.47437,-149.08246 289.77665,-225.59477 13.00616,-28.3602 0.62901,-62.60548 4.95416,-92.86874 -1.14943,-99.06074 2.43448,-198.68957 -1.46462,-297.42322 -13.77946,-27.29505 -53.54698,-19.01354 -77.49315,-31.07504 -88.99255,-22.60571 -178.08725,-46.75346 -266.95931,-68.75489 z m 255.08242,109.03733 c -89.31964,32.43568 -178.63883,64.87136 -267.95801,97.30659 -88.00711,-31.71643 -176.01423,-63.43331 -264.02135,-95.15019 93.92838,-20.10894 187.88928,-45.88532 281.79796,-62.4905 83.3938,20.11122 166.78761,40.22288 250.1814,60.3341 z m 39.94252,352.2282 c -93.06848,74.11404 -186.13696,148.22852 -279.20544,222.34255 0,-144.16311 0,-288.32624 0,-432.48935 93.12208,-33.67354 186.24462,-67.34661 279.3667,-101.02015 -0.0549,103.72217 -0.10539,207.44479 -0.16034,311.16695 z M 474.94871,464.75485 c 0,144.16632 0,288.3322 0,432.49852 -93.05657,-74.12045 -186.11313,-148.24044 -279.1697,-222.36041 -0.0503,-103.72263 -0.1008,-207.44479 -0.15119,-311.16697 93.10743,33.67629 186.21484,67.35258 279.3218,101.02886 z",
pinterestIcon:"m 505.24426,285.21494 c -144.30149,0 -261.29107,116.98958 -261.29107,261.29107 0,110.75301 68.8174,205.37694 166.02198,243.44157 -2.3656,-20.64523 -4.30109,-52.47327 0.86021,-75.05399 4.73121,-20.43015 30.53773,-129.89284 30.53773,-129.89284 0,0 -7.74196,-15.69897 -7.74196,-38.70979 0,-36.34418 21.07533,-63.44104 47.31197,-63.44104 22.36566,0 33.11838,16.77424 33.11838,36.77429 0,22.36566 -14.1936,55.91415 -21.7205,87.09704 -6.23658,26.02157 13.11832,47.31195 38.70979,47.31195 46.45175,0 82.15078,-49.0324 82.15078,-119.57022 0,-62.58084 -44.94637,-106.23687 -109.24764,-106.23687 -74.40881,0 -118.06485,55.69908 -118.06485,113.33366 0,22.36565 8.60218,46.45174 19.3549,59.57006 2.15053,2.58066 2.36559,4.94625 1.72043,7.5269 -1.93549,8.17207 -6.45163,26.02159 -7.31185,29.67751 -1.07527,4.7312 -3.87098,5.80647 -8.81723,3.44087 -32.68826,-15.26887 -53.11843,-62.79588 -53.11843,-101.29062 0,-82.36583 59.78512,-158.06497 172.68867,-158.06497 90.53789,0 161.07573,64.51631 161.07573,150.96817 0,90.10779 -56.77436,162.58112 -135.48426,162.58112 -26.45169,0 -51.398,-13.76348 -59.78512,-30.10762 0,0 -13.11832,49.89263 -16.34414,62.15072 -5.80646,22.79577 -21.72048,51.18295 -32.4732,68.60235 24.5162,7.52691 50.32272,11.61294 77.41957,11.61294 144.3015,0 261.29109,-116.98958 261.29109,-261.29107 0.4301,-144.73161 -116.55948,-261.72119 -260.86098,-261.72119 z",
placeAndInteract:"m 165.11453,114.52947 c -22.67786,0 -41.13834,18.4078 -41.13834,41.08567 v 667.22853 c 0,22.677 18.46048,41.0849 41.13834,41.0849 H 832.2897 c 22.675,0 41.1253,-18.4079 41.1253,-41.0849 V 155.61514 c 0,-22.67787 -18.4503,-41.08567 -41.1253,-41.08567 z m 0,10.67004 H 832.2897 c 16.9242,0 30.4024,13.48988 30.4024,30.41563 v 667.22853 c 0,16.9258 -13.4782,30.3483 -30.4024,30.3483 H 165.11453 c -16.92648,0 -30.41558,-13.4225 -30.41558,-30.3483 V 155.61514 c 0,-16.92575 13.4891,-30.41563 30.41558,-30.41563 z m 339.37765,144.55407 c -0.26164,0.0777 -0.51293,0.12958 -0.75127,0.33677 l -0.0777,-0.0777 h -0.99218 c -13.48367,3.29003 -28.09138,16.02994 -41.82114,22.45015 -10.05632,5.93861 -20.1637,11.77154 -30.2949,17.59076 8.74058,4.89306 17.48169,9.84052 26.21191,14.75226 15.59549,-9.0051 31.18943,-17.99437 46.77454,-27.00154 12.38554,7.6282 24.78012,15.30406 37.16303,22.95895 8.65199,-4.89386 17.3102,-9.73226 25.97047,-14.60564 -19.82304,-12.30261 -39.71731,-24.46741 -59.85383,-36.10452 -0.73831,0 -1.58541,-0.44558 -2.37037,-0.33677 z m 121.00631,73.37505 c 0,0 0,0 0.0777,0 0,-0.004 0,0 0,0 z m 0.0777,0 c -4.24257,2.40145 -8.44499,4.73141 -12.66451,7.13522 -4.5752,2.00508 -9.03047,4.48608 -13.41371,7.1352 13.7194,8.47401 27.42378,16.94931 41.13825,25.4223 -13.48081,7.78647 -26.9554,15.6543 -40.44242,23.48118 2.02063,1.12431 4.01642,2.33151 5.9438,3.45401 8.54111,3.05221 9.28692,10.74879 8.83591,19.13006 12.9943,-7.54375 25.98082,-15.09085 38.98343,-22.63744 v 50.36198 c 8.64705,-5.21741 17.35811,-10.33949 26.09117,-15.43488 0,-20.53882 0,-41.06571 -0.80308,-61.5408 -7.54244,-13.29973 -25.52877,-16.56384 -36.81354,-26.21165 -5.6047,-3.44105 -11.24852,-6.87693 -16.85373,-10.29518 z m -256.68559,2.54394 c 0.0777,0 0.10362,0.0777 0.15533,0.10362 0.0777,0 0.0777,-0.0777 0.12957,-0.0777 z m 0.15533,0.10362 c -16.68998,9.6693 -33.29637,19.46399 -49.6663,29.57188 -8.22506,13.6707 -0.98778,31.47595 -3.37364,46.57429 v 20 c 8.61848,5.13708 17.24795,10.21616 25.87739,15.32813 v -50.17493 c 12.2636,7.14142 24.53742,14.23543 36.80102,21.35277 v -16.22525 c 4.01306,-2.32635 8.10512,-4.72598 12.18269,-7.21605 -12.05548,-6.98157 -24.11963,-13.9914 -36.17138,-20.99086 13.55413,-7.78596 27.12768,-15.66129 40.68389,-23.49439 -8.81312,-4.7848 -17.57831,-9.73227 -26.33263,-14.72559 z m 83.40212,94.76694 h -0.37565 c 0.0777,0 0.12958,0.0777 0.18129,0.10363 0.0777,-0.0777 0.12958,-0.0777 0.20725,-0.10363 z m -0.20726,0.10363 c -3.94673,2.20975 -7.88853,4.43065 -11.79408,6.63989 v 17.069 c 14.59009,8.46753 29.17785,16.94026 43.77596,25.40857 v 51.83499 c 4.33662,2.56724 8.74604,5.22283 13.11892,7.79113 4.65524,-2.72943 9.30792,-5.54564 13.96264,-8.27299 v -52.12979 c 13.75646,-8.0235 27.51963,-15.9592 41.27271,-23.93634 v -16.09081 c -4.41406,-2.48693 -8.86648,-4.98036 -13.30672,-7.47043 -14.25331,8.27713 -28.51078,16.55842 -42.77161,24.83347 -14.75097,-8.55485 -29.50478,-17.11304 -44.25782,-25.67669 z m -136.32141,71.39352 c 0,26.565 0,53.13466 0.80333,79.61313 7.70416,13.71606 26.49224,16.33641 38.21979,25.87748 8.97423,5.05834 17.90665,10.22447 26.84178,15.39524 v -30.06642 c -13.1378,-7.62457 -26.28138,-15.17453 -39.40992,-22.75816 V 527.49018 C 333.67979,522.3549 324.99821,517.1854 316.30913,512.0413 Z m 363.90274,0 c -8.62685,5.13529 -17.25631,10.23068 -25.89119,15.34187 v 52.33002 c -13.97561,8.06524 -27.95485,16.13668 -41.92863,24.20424 v 30.28194 c 21.82322,-12.53033 43.56535,-25.18241 64.91502,-38.35416 8.059,-13.4829 0.88338,-31.10316 3.2926,-46.02538 v -37.77853 z m -195.39868,99.33283 v 50.96453 c -13.901,-8.02766 -27.79993,-16.06154 -41.70118,-24.0967 v 30.24153 c 17.17808,9.88769 34.40769,19.64895 51.8083,29.02346 15.46596,0 26.96937,-14.6419 40.93748,-19.96008 4.97415,-2.96932 10.03535,-5.86195 15.07401,-8.80924 v -29.69233 c -12.99171,7.46135 -25.98316,14.99499 -38.9697,22.49001 v -49.66638 c -4.4923,2.48694 -8.92892,4.90213 -13.40075,7.39038 -4.57235,-2.64938 -9.12218,-5.22311 -13.68157,-7.87223 z",
planarFreeflyIcon:"m 687.8112,317.97249 c 0,0 -112.5553,47.9265 -165.1562,78.25001 -52.6115,30.31119 -150.25,103.99999 -150.25,103.99999 0,0 98.0189,73.6897 150.625,104.00001 52.6061,30.3244 164.9687,78.0625 164.9688,78.0625 0,0 6.5935,-55.3655 10.9062,-110.03121 l 172.9062,0 c 2.7346,0 5.105,-2.625 6.3438,-6.5 0.5633,-1.7638 0.9085,-3.7992 0.9375,-5.9376 l 0,-119.4687 c -0.055,-6.9939 -3.2113,-12.4793 -7.1875,-12.5 l -173.0312,0 c -4.3597,-54.596 -11.0625,-109.875 -11.0626,-109.875 z m -473.375,91.03131 c -50.476,0 -91.4062,40.90039 -91.4062,91.37499 0,50.5033 40.9302,91.43741 91.4062,91.43741 50.4761,0 91.4063,-40.93421 91.4063,-91.43741 0,-50.4746 -40.9301,-91.37499 -91.4063,-91.37499 z",
playIcon:"m 329.42368,709.61394 c 0,0 206.80503,-62.2762 390,-209.82761 0,0 -161.34214,-136.24207 -390,-210.26091 0,0 -45.71787,198.47347 0,420.08852 z",positionGridIcon:"m 280.32335,142.03071 c -16.75254,9.7e-4 -33.51193,0.6605 -40.20951,1.07223 -21.43262,1.32443 -42.20129,3.25513 -58.43572,5.36115 -14.00591,1.81903 -41.87361,5.95115 -42.35396,6.43339 -0.20588,0.21274 -3.55467,18.70228 -4.82418,27.3419 -3.4037,22.92119 -5.30626,46.95409 -6.97037,75.05613 -0.80631,13.46808 -0.80631,63.09727 0,76.6645 1.68125,28.69359 3.82401,51.92325 7.50561,76.66451 1.90086,12.75782 3.89434,25.90424 4.28894,26.26965 0.1887,0.1544 4.30092,0.79773 9.11309,1.60749 37.39426,6.3392 73.93418,10.26613 110.44147,11.25841 18.93132,0.4958 23.53075,0.4958 41.28004,0 40.23353,-1.13056 77.81479,-5.17329 115.26567,-11.79452 l 5.89641,-1.07224 1.61264,-8.57785 c 8.73394,-49.19908 12.5408,-107.68405 10.72229,-157.0818 -1.40677,-38.4037 -3.99899,-69.21962 -10.18533,-106.15084 -0.94356,-5.59481 -2.14445,-10.1862 -2.14445,-10.1862 -0.20588,-0.22816 -16.13837,-2.85642 -25.73354,-4.28891 -24.18096,-3.61265 -47.24508,-5.794 -75.05616,-7.50562 -6.71646,-0.4186 -23.45698,-1.07395 -40.2078,-1.07224 z m 439.07763,0.53527 c -16.75082,9.6e-4 -33.51193,0.12006 -40.20779,0.53525 -21.43089,1.32443 -42.20301,3.25512 -58.43744,5.36115 -14.0059,1.81903 -41.85645,5.95114 -42.35225,6.43339 -0.20587,0.21273 -3.57354,19.23838 -4.82591,27.878 -3.40539,22.9212 -5.84151,46.9541 -7.5056,75.05616 -0.82347,13.46807 -0.82347,63.09725 0,76.66449 1.68125,28.69357 4.36097,51.92341 8.04258,76.6645 1.8957,12.75782 3.89434,25.36811 4.28893,25.73354 0.1887,0.1544 4.29921,0.79944 9.11309,1.60748 37.39426,6.33921 73.92903,10.26614 110.43977,11.25842 18.93303,0.4958 23.53075,0.4958 41.28174,0 40.23353,-1.13056 77.8148,-5.17347 115.26392,-11.79454 l 5.89642,-1.07222 1.61263,-8.04173 c 8.73579,-49.1991 12.54251,-107.68406 10.72233,-157.08181 -1.40672,-38.4037 -4.53764,-69.21961 -10.72233,-106.15084 -0.94349,-5.59482 -1.61263,-10.72231 -1.61263,-10.72231 -0.1887,-0.22645 -16.13837,-2.85643 -25.73352,-4.28893 -24.18094,-3.61282 -47.23991,-5.79399 -75.05614,-7.50561 -6.71646,-0.41859 -23.45699,-0.53697 -40.2078,-0.53526 z M 280.8586,581.10834 c -16.75081,9.7e-4 -33.51193,0.12007 -40.2095,0.53525 -21.42918,1.32442 -42.19957,3.25513 -58.43572,5.36117 -14.00591,1.81884 -41.8719,5.95045 -42.35397,6.43339 -0.20587,0.21272 -3.55466,19.23838 -4.82419,27.87798 -3.4054,22.92121 -5.30625,46.95429 -6.96863,75.05616 -0.80633,13.46807 -0.80633,62.56115 0,76.12838 1.68126,28.69358 3.82228,51.92324 7.50389,76.6645 1.90256,12.75783 3.89606,25.90424 4.28893,26.26964 0.18871,0.15441 4.30093,0.79947 9.11482,1.60749 37.39426,6.33914 73.93245,10.26612 110.43977,11.25843 18.9313,0.49582 23.53074,0.49582 41.28003,0 40.23352,-1.13054 77.81306,-5.17343 115.26565,-11.79453 l 5.89813,-1.07224 1.61263,-8.57784 c 8.73396,-49.1991 13.07778,-107.14793 11.25928,-156.54568 -1.40677,-38.40371 -4.53768,-69.75591 -10.72231,-106.68697 -0.94356,-5.59481 -2.14446,-10.18618 -2.14446,-10.18618 -0.20586,-0.22647 -16.14007,-2.85661 -25.73353,-4.28894 -24.18096,-3.61263 -47.24164,-5.79381 -75.05616,-7.50561 -6.71644,-0.4186 -23.45869,-0.53697 -40.2095,-0.53526 z m 438.54238,0 c -16.75082,9.7e-4 -33.51022,0.12007 -40.20779,0.53525 -21.43262,1.32442 -42.20644,3.25513 -58.43744,5.36117 -14.0059,1.81884 -41.85645,5.95028 -42.35225,6.43339 -0.22303,0.21272 -3.53923,19.23838 -4.82591,27.87798 -3.40196,22.92121 -5.84151,46.95429 -7.5056,75.05616 -0.80632,13.46807 -0.80632,62.56115 0,76.12838 1.68125,28.69358 3.82399,51.92342 7.5056,76.6645 1.89913,12.75783 4.43132,25.90424 4.82591,26.26964 0.1887,0.15441 4.29749,0.79947 9.11309,1.60749 37.39426,6.33914 73.93245,10.26612 110.43977,11.25843 18.93131,0.49582 22.99378,0.49582 40.74477,0 40.23181,-1.13054 77.81307,-5.17343 115.26389,-11.79453 l 6.43342,-1.07224 1.08086,-8.57784 c 8.73559,-49.1991 13.07776,-107.14793 11.25749,-156.54568 -1.40673,-38.40371 -4.53243,-69.75591 -10.72224,-106.68697 -0.94358,-5.59481 -1.61263,-10.18618 -1.61263,-10.18618 -0.1887,-0.22647 -16.13497,-2.85661 -25.73357,-4.28894 -24.18093,-3.61263 -47.24505,-5.79381 -75.05615,-7.50561 -6.71645,-0.4186 -23.45525,-0.53697 -40.2078,-0.53526 z",
povIcon:"m 497.49603,305.21852 c -97.77686,0.37838 -210.4389,49.08614 -328.67132,194.10182 356.09919,436.75324 661.77595,0 661.77595,0 0,0 -136.4006,-194.86301 -333.10463,-194.10182 z m 2.5333,46.39679 c 81.7431,0 147.98657,66.2669 147.98657,148.01 0,81.74311 -66.24347,148.00999 -147.98657,148.00999 -81.74311,0 -148.01,-66.26688 -148.01,-148.00999 0,-81.7431 66.26689,-148.01 148.01,-148.01 z m -0.0232,71.30752 c -42.34668,0 -76.65557,34.33231 -76.65557,76.67899 0,42.34674 34.30889,76.67906 76.65557,76.67906 42.34674,0 76.67906,-34.33232 76.67906,-76.67906 0,-42.34668 -34.33232,-76.67899 -76.67906,-76.67899 z",
poweredByEmersyaIcon:"M 522.19998,5.0535906 C 504.68856,11.142701 491.62317,19.436671 480.1866,29.351131 c -3.21206,16.482671 -3.16137,32.812802 0,48.579452 11.7664,10.396919 26.23344,18.942558 42.01338,24.281887 20.04676,-6.810968 33.7594,-17.101699 41.99747,-24.281887 1.28048,-6.311641 1.98601,-12.807093 2.26806,-18.6197 -15.06897,12.09353 -30.91696,20.910478 -44.26543,26.74026 -9.93616,-4.538602 -19.33982,-10.055341 -28.04062,-16.209201 -1.05209,-10.90396 -0.9702,-21.792871 0,-32.417821 8.91786,-6.3371 18.36404,-11.73811 28.04062,-16.20919 8.81605,3.98063 20.81438,10.714561 29.9438,17.652302 -9.44518,6.692198 -19.63574,12.48392 -29.9438,16.986308 -0.25164,5.97893 -0.25164,11.9063 0,17.493631 16.54093,-7.39688 30.72924,-16.004511 44.20201,-26.708341 -0.32716,-5.89148 -1.12726,-11.99378 -2.20454,-17.2877 C 551.8417,18.644221 538.84566,10.849601 522.20008,5.0535906 Z M 323.156,10.763361 313.08487,11.779201 V 34.55418 c -2.86194,-0.807209 -5.60244,-1.206098 -8.21555,-1.206098 -3.91964,0 -7.50199,0.840928 -10.73724,2.5228 -3.23532,1.678818 -5.84396,4.25564 -7.83492,7.739711 -1.92863,3.422038 -2.8865,7.648519 -2.8865,12.6883 0,6.656908 1.45323,11.82438 4.3774,15.495018 2.98654,3.608671 7.27885,5.408401 12.87838,5.408401 4.23074,0 8.55615,-1.42099 12.97353,-4.282331 l 0.65029,3.077091 h 8.86579 z m 44.04344,0 -10.08703,1.01584 v 62.80571 c 3.11087,0.933021 6.03308,1.59286 8.77065,1.967301 2.73764,0.435819 5.13146,0.65068 7.1846,0.65068 4.0441,0 7.87413,-0.712071 11.48273,-2.142231 3.60855,-1.49466 6.56376,-3.953018 8.86577,-7.37507 2.36413,-3.42175 3.55264,-7.863081 3.55264,-13.33836 0,-6.53261 -1.37007,-11.666929 -4.10774,-15.399891 -2.73767,-3.733268 -6.84824,-5.59866 -12.32331,-5.59866 -4.35518,0 -8.7965,1.304401 -13.33831,3.917392 z m 605.0937,14.89256 c -4.90091,0 -9.75852,0.0927 -14.44856,0.54021 l -4.44081,12.00605 c 8.21234,-0.758118 12.06851,-1.00049 16.27245,-1.00049 1.92313,0 3.42741,0.319111 4.5043,0.936061 1.07698,0.537038 1.80437,1.417929 2.18858,2.648638 0.46127,1.230712 0.69768,2.91873 0.69768,5.075092 v 1.27067 c -9.69204,0.383691 -17.53661,2.19134 -23.53639,5.42403 -5.99969,3.15382 -9.00853,7.76914 -9.00853,13.84568 0,2.84508 0.65866,5.38231 1.9667,7.61293 1.38446,2.154529 3.31147,3.8447 5.7731,5.075399 2.46142,1.230712 5.3021,1.856801 8.53268,1.856801 3.07684,0 6.00144,-0.420471 8.77065,-1.267481 2.84599,-0.847019 5.68637,-2.3172 8.53276,-4.393438 l 1.26881,4.044468 h 13.38591 v -36.57337 c 0,-6.07623 -1.72458,-10.421789 -5.18629,-13.03699 -3.3846,-2.6916 -8.50416,-4.06012 -15.27331,-4.06012 z m -353.31496,0.0159 c -5.30762,0 -9.92293,1.11414 -13.84585,3.34656 -3.84607,2.15451 -6.80488,5.349153 -8.88167,9.57962 -1.9998,4.230762 -2.9976,9.26841 -2.9976,15.114472 0,6.384358 1.18401,11.6089 3.56852,15.68559 2.46144,3.999669 5.69066,6.924241 9.69052,8.770609 4.07678,1.84454 8.65817,2.774482 13.73484,2.774482 4.23077,0 8.15306,-0.58928 11.76816,-1.743242 3.03139,-0.966758 5.76326,-2.252739 8.19965,-3.869859 l -3.94914,-10.419952 c -2.60596,1.531501 -5.05902,2.642521 -7.3591,3.33062 -2.30735,0.690491 -4.69132,1.04653 -7.15285,1.04653 -3.30753,0 -6.16439,-1.0005 -8.54858,-2.99852 -2.38469,-2.077799 -3.80497,-5.27182 -4.26638,-9.57962 h 33.22693 c 0.30745,-3.84591 0.45998,-6.534439 0.45998,-8.0727 0,-4.38482 -0.87995,-8.30684 -2.64864,-11.76818 -1.76935,-3.461649 -4.45746,-6.199931 -8.07278,-8.199771 -3.53817,-2.00103 -7.84921,-2.9985 -12.92595,-2.9985 z m 66.48543,0 c -5.69214,0 -11.20278,1.69107 -16.51032,5.07538 v -4.50421 l -15.68564,1.50693 v 51.57704 h 15.68564 V 40.78689 c 3.69221,-2.231228 7.03953,-3.34654 10.03943,-3.34654 2.07685,0 3.54716,0.659803 4.39322,1.967291 0.92329,1.23071 1.37988,3.378481 1.37988,6.454961 v 33.464981 h 15.68564 V 41.136461 40.786652 c 3.84601,-2.231242 7.15928,-3.346561 9.92841,-3.346561 2.07685,0 3.54719,0.65981 4.39322,1.96731 0.92284,1.23072 1.37988,3.378491 1.37988,6.454949 v 33.464971 h 15.68564 V 41.13623 c 0,-4.9999 -1.30212,-8.804058 -3.91747,-11.419239 -2.5381,-2.69163 -6.24023,-4.04449 -11.08618,-4.04449 -3.30766,0 -6.48676,0.50648 -9.5636,1.50692 -3.07684,1.00051 -6.15392,2.42154 -9.2306,4.26639 -2.53846,-3.84621 -6.73105,-5.77331 -12.57702,-5.77331 z m 82.25041,0 c -5.30765,0 -9.92296,1.11414 -13.84591,3.34656 -3.84625,2.15451 -6.805,5.349153 -8.88164,9.57962 -2.00009,4.230762 -3.01355,9.26841 -3.01355,15.114472 0,6.384358 1.19975,11.6089 3.58439,15.68559 2.46147,3.999669 5.69066,6.924241 9.6905,8.770609 4.07696,1.84454 8.65809,2.774482 13.73486,2.774482 4.23074,0 8.15287,-0.58928 11.76819,-1.743242 3.03501,-0.969798 5.76101,-2.252739 8.19965,-3.869859 l -3.94917,-10.419952 c -2.60935,1.53457 -5.07225,2.639441 -7.37494,3.33062 -2.30762,0.690491 -4.69149,1.04653 -7.15288,1.04653 -3.30774,0 -6.14823,-1.0005 -8.53271,-2.99852 -2.38442,-2.077799 -3.80473,-5.27182 -4.2664,-9.57962 h 33.22685 c 0.30789,-3.84591 0.46,-6.534439 0.46,-8.0727 0,-4.38482 -0.87955,-8.30684 -2.64861,-11.76818 -1.76903,-3.461649 -4.45767,-6.199931 -8.07278,-8.199771 -3.53838,-2.00103 -7.84929,-2.9985 -12.92593,-2.9985 z m 64.28081,0 c -5.69214,0 -10.45972,2.62103 -14.30578,7.850792 v -7.279852 l -15.68561,1.50694 v 51.57703 h 15.68561 v -31.62505 c 1.84581,-2.461409 4.67238,-4.850109 6.51854,-5.772989 4.01571,-1.85375 7.346,-1.341221 10.80066,0.0608 l 3.75891,-15.177979 c -1.9151,-0.65677 -4.61944,-1.14166 -6.77233,-1.14166 z m 35.09841,0 c -4.15364,0 -7.83955,0.69367 -11.0703,2.07778 -3.23066,1.30745 -5.73262,3.18452 -7.50181,5.646261 -1.76935,2.461421 -2.64869,5.317831 -2.64869,8.54838 0,4.230482 1.18377,7.577659 3.56854,10.03939 2.46142,2.461429 6.4679,4.45665 12.00597,5.995202 l 3.34648,0.920707 c 2.76932,0.770433 4.84838,1.497741 6.23306,2.188292 1.46147,0.61694 2.40926,1.27371 2.8708,1.967281 0.46125,0.616958 0.69768,1.344268 0.69768,2.188289 0,1.307439 -0.60886,2.354019 -1.83962,3.124359 -1.15369,0.767241 -2.9967,1.141672 -5.53519,1.141672 -5.60181,-0.0304 -12.50053,-2.915682 -17.8109,-5.202172 l -2.93402,11.863372 c 2.60596,1.175398 5.3059,2.203609 7.93009,3.044529 3.9229,1.15399 8.35176,1.72794 13.27481,1.72794 4.92297,0 9.06561,-0.742791 12.4501,-2.20364 3.46157,-1.53761 5.99771,-3.601911 7.61288,-6.217409 1.69228,-2.61488 2.55347,-5.58977 2.55347,-8.897351 0,-4.230772 -1.38596,-7.730471 -4.15536,-10.49942 -2.69219,-2.768359 -7.0028,-4.916731 -12.92571,-6.454971 l -3.80641,-1.03119 c -2.23094,-0.61695 -3.88731,-1.12024 -4.96421,-1.506939 -1,-0.46042 -1.69328,-0.920721 -2.07786,-1.381102 -0.38486,-0.537019 -0.57084,-1.196969 -0.57084,-1.967298 0,-1.07723 0.45631,-1.95502 1.37983,-2.648641 0.99994,-0.693679 2.45499,-1.098799 4.37746,-1.046541 5.24541,0.123031 10.01164,0.53717 15.22565,1.11098 l -4.55189,-12.02203 c -3.71835,-0.31302 -7.52594,-0.50632 -11.13372,-0.50632 z m 22.90191,0.58624 21.30012,53.258311 -0.8565,2.6333 c -1.08771,3.19862 -2.61642,5.585481 -4.56772,7.15286 -0.75097,0.62607 -1.55665,1.126321 -2.41078,1.506932 l 4.44082,11.689026 c 2.29206,-0.69673 4.42341,-1.75553 6.37569,-3.171938 3.87054,-2.783679 6.83411,-6.963489 8.91347,-12.561258 l 22.69572,-60.506313 h -15.68561 l -9.92841,30.181952 c -0.73324,2.083929 -1.45968,4.036499 -2.12508,6.169541 -0.713,-2.378552 -1.304,-4.060741 -1.99832,-6.169541 L 906.0139,26.258981 Z M 28.919845,33.347712 c -2.05324,0 -4.16645,0.346768 -6.34403,1.0312 -2.17755,0.684419 -4.32383,1.67267 -6.4392,2.9801 v -3.64795 L 6.0496153,34.743841 V 93.347002 H 16.136615 V 76.091253 c 2.86196,0.745799 5.53654,1.110959 8.02519,1.110959 3.9819,0 7.58131,-0.840931 10.81659,-2.5228 3.29749,-1.678821 5.9391,-4.22279 7.93003,-7.644881 1.99094,-3.484039 2.99761,-7.743659 2.99761,-12.78313 0,-4.10618 -0.627,-7.721571 -1.87155,-10.832449 -1.18216,-3.173762 -3.04763,-5.633651 -5.59861,-7.37476 -2.55105,-1.804641 -5.72082,-2.697739 -9.51607,-2.697739 z m 45.29637,0 c -4.10631,0 -7.82041,0.74277 -11.11791,2.23737 -3.29752,1.430229 -5.9391,3.75907 -7.93003,6.99421 -1.92864,3.23547 -2.88651,7.44475 -2.88651,12.60884 0,4.106468 0.74304,7.83757 2.23616,11.197339 1.55543,3.29746 3.85052,5.939041 6.89913,7.92997 3.04854,1.930482 6.81274,2.888041 11.29236,2.888041 4.16852,0 7.91559,-0.74276 11.21311,-2.237381 3.29747,-1.49466 5.90613,-3.854198 7.83485,-7.08965 1.99094,-3.297449 2.98164,-7.50706 2.98164,-12.608521 0,-4.231079 -0.77583,-7.995038 -2.3313,-11.292488 -1.49312,-3.297779 -3.77119,-5.873691 -6.81981,-7.7397 -3.04856,-1.930461 -6.82985,-2.884971 -11.37169,-2.884971 z m 107.674085,0 c -4.29299,0 -7.95827,0.95763 -11.00691,2.884958 -3.04855,1.927411 -5.3437,4.603383 -6.89913,8.025122 -1.55542,3.359748 -2.34725,7.22285 -2.34725,11.577918 0,5.039802 0.90788,9.150253 2.71218,12.3234 1.80431,3.173773 4.23115,5.468861 7.27974,6.899061 3.11086,1.430211 6.66025,2.142252 10.64212,2.142252 3.23526,0 6.22343,-0.463481 8.96096,-1.39646 2.79964,-0.933022 5.30959,-2.172931 7.54939,-3.72713 l -3.53677,-6.534452 c -2.30215,1.307449 -4.36531,2.265011 -6.16961,2.88498 -1.80433,0.561642 -3.81873,0.840941 -6.05854,0.840941 -3.11082,0 -5.7195,-0.95763 -7.83486,-2.888041 -2.05324,-1.927389 -3.20862,-4.94987 -3.45752,-9.056029 h 27.80274 c 0.1872,-2.240459 0.28538,-4.319471 0.28538,-6.249021 0,-3.359759 -0.67703,-6.380988 -2.04587,-9.056018 -1.36884,-2.737663 -3.39912,-4.850451 -6.07444,-6.344182 -2.67533,-1.556031 -5.94411,-2.332519 -9.80157,-2.332519 z m 49.05521,0 c -2.30214,0 -4.48121,0.527899 -6.53433,1.58673 -1.99096,1.058849 -3.74065,2.608739 -5.23384,4.6629 v -5.8841 l -10.07116,0.93608 v 41.347379 h 10.07116 V 49.113733 c 1.55542,-2.240463 3.12328,-3.759372 4.67871,-4.567762 1.61772,-0.80719 3.31852,-1.2061 5.12282,-1.2061 1.05764,0 2.03144,0.0925 2.90245,0.276241 0.87096,0.184189 1.79574,0.469569 2.79136,0.840949 l 1.68126,-10.261269 c -1.86662,-0.561639 -3.66621,-0.840942 -5.40829,-0.840942 z m 28.23093,0 c -4.29294,0 -7.95827,0.95763 -11.00688,2.884958 -3.04855,1.927411 -5.35959,4.603383 -6.91498,8.025122 -1.55543,3.359748 -2.33161,7.22285 -2.33161,11.577918 0,5.039802 0.90788,9.150253 2.71218,12.3234 1.80433,3.173773 4.23113,5.468861 7.27973,6.899061 3.11087,1.430211 6.66028,2.142252 10.64214,2.142252 3.23527,0 6.22342,-0.463481 8.96093,-1.39646 2.79964,-0.933022 5.30961,-2.172931 7.54941,-3.72713 l -3.53682,-6.534452 c -2.30213,1.307449 -4.36525,2.265011 -6.16955,2.88498 -1.80433,0.561642 -3.81874,0.840941 -6.05856,0.840941 -3.11086,0 -5.71949,-0.95763 -7.83486,-2.888041 -2.05322,-1.927389 -3.20865,-4.94987 -3.4575,-9.056029 h 27.80273 c 0.18719,-2.240459 0.28538,-4.319471 0.28538,-6.249021 0,-3.359759 -0.67702,-6.380988 -2.04586,-9.056018 -1.36885,-2.737663 -3.39913,-4.850451 -6.07443,-6.344182 -2.67535,-1.556031 -5.9441,-2.332519 -9.80155,-2.332519 z M 97.704975,34.64907 v 0.555562 l 13.068715,40.88734 h 9.61123 l 6.53435,-23.060699 c 0.80865,-2.676271 1.38724,-5.218113 1.76044,-7.644551 0.31119,1.930458 0.9382,4.471688 1.87156,7.644551 l 6.81979,22.965539 h 9.61121 l 12.21227,-40.79218 V 34.64907 h -10.16631 l -5.50343,22.775273 c -0.56005,2.611808 -0.97232,5.105778 -1.22118,7.469918 -0.37324,-2.17908 -0.91861,-4.670269 -1.66531,-7.469918 L 134.10396,34.64907 h -10.18218 l -6.43919,23.044751 c -0.31118,1.120241 -0.80653,3.266152 -1.49097,6.439292 -0.37324,-2.42765 -0.80282,-4.573281 -1.30069,-6.439292 L 108.61651,34.64907 Z m 301.928305,0 v 0.555562 l 15.66979,40.79218 h 2.71217 l -0.46003,1.301229 c -0.99534,2.611832 -2.03513,4.57667 -3.09269,5.884101 -0.99534,1.368829 -2.05203,2.261949 -3.17201,2.697771 -1.11996,0.435808 -2.42427,0.66603 -3.91745,0.66603 -1.74202,0 -3.47588,-0.276262 -5.21798,-0.840952 l -2.61702,7.359132 c 2.98625,0.997439 5.87568,1.506929 8.67545,1.506929 3.17307,0 5.91352,-0.592331 8.21552,-1.777021 2.30214,-1.181619 4.31649,-3.080769 6.05856,-5.69381 1.74202,-2.550419 3.34291,-5.935369 4.77388,-10.16612 L 441.53553,35.20614 v -0.555559 h -10.35661 l -7.85077,24.551381 c -0.43556,1.368809 -1.14562,3.845899 -2.14101,7.454238 -0.55978,-2.240449 -1.33596,-4.716608 -2.3313,-7.454238 l -8.58033,-24.551381 z m 219.69384,1.632781 c 2.53814,0 4.56779,0.77955 6.10608,2.31412 1.53855,1.53761 2.31566,4.074239 2.31566,7.612621 V 46.5584 h -18.3501 c 0.61534,-3.538688 1.73096,-6.124408 3.3465,-7.739679 1.69228,-1.69109 3.88964,-2.53815 6.58188,-2.53815 z m 148.73578,0 c 2.53849,0 4.56782,0.77955 6.10611,2.31412 1.53855,1.53761 2.31566,4.074239 2.31566,7.612621 V 46.5584 h -18.35005 c 0.61529,-3.538688 1.73093,-6.124408 3.34645,-7.739679 1.69228,-1.69109 3.88967,-2.53815 6.58191,-2.53815 z m -586.07744,4.345551 c 2.48871,0 4.45308,0.77651 5.88409,2.33253 1.49311,1.49465 2.23613,3.854191 2.23613,7.08932 v 0.27628 h -17.92176 c 0.56017,-3.11087 1.64964,-5.50478 3.26716,-7.184501 1.61773,-1.6788 3.79682,-2.52281 6.53438,-2.52281 z m 77.28616,0 c 2.48875,0 4.4531,0.77651 5.88407,2.33253 1.49313,1.49465 2.23617,3.854191 2.23617,7.08932 v 0.27628 h -17.92192 c 0.56005,-3.11087 1.64965,-5.50478 3.26719,-7.184501 1.61775,-1.6788 3.7968,-2.52281 6.53437,-2.52281 z m 46.80306,0.276249 c 2.48873,0 4.83257,0.377481 7.01019,1.126331 V 66.20077 c -3.35973,1.991861 -6.59556,2.983172 -9.7064,2.983172 -6.28388,0 -9.43673,-4.325591 -9.43673,-12.97374 0,-3.359751 0.51136,-6.18303 1.50664,-8.48486 1.05765,-2.30184 2.47801,-4.019621 4.2822,-5.13892 1.86664,-1.12024 3.97979,-1.681871 6.34403,-1.681871 z m -232.334255,0.27627 c 3.54636,0 6.15501,1.2368 7.83486,3.72713 1.74203,2.42765 2.61704,5.859841 2.61704,10.277221 0,4.417369 -0.84186,7.9008 -2.52188,10.451849 -1.61774,2.489062 -4.3581,3.72714 -8.21554,3.72714 -3.60856,0 -6.30022,-1.270659 -8.10449,-3.822279 -1.74202,-2.55043 -2.61702,-6.001639 -2.61702,-10.35671 0,-4.479682 0.84186,-7.945922 2.52158,-10.37236 1.74202,-2.427682 4.56546,-3.631991 8.48515,-3.631991 z m -47.9926,0.276251 c 3.23528,0 5.62919,1.02207 7.1846,3.07679 1.61774,1.991839 2.42644,5.25984 2.42644,9.801518 0,5.039482 -1.15556,8.836581 -3.4575,11.387641 -2.23984,2.550411 -5.26086,3.822271 -9.05609,3.822271 -2.11524,0 -4.34457,-0.31305 -6.7088,-0.936069 V 44.342382 c 3.35969,-1.930471 6.56255,-2.884971 9.6112,-2.884971 z m 351.617915,0 c 3.17307,0 5.46814,1.05581 6.89914,3.171939 1.43116,2.05323 2.15699,5.22301 2.15699,9.516081 0,5.28868 -1.28722,9.151469 -3.83815,11.577929 -2.48875,2.427642 -5.80747,3.63197 -9.97601,3.63197 -1.74202,0 -3.54177,-0.184158 -5.40827,-0.555538 V 44.152052 c 3.85741,-1.804652 7.24212,-2.697761 10.1663,-2.697761 z m 599.70119,15.003669 v 10.039361 c -3.76904,2.077799 -7.23458,3.124369 -10.38828,3.124369 -1.92307,0 -3.3774,-0.42351 -4.37734,-1.267489 -1,-0.923761 -1.50665,-2.240449 -1.50665,-3.933071 0,-2.077799 1.30188,-3.83577 3.91742,-5.297299 2.61522,-1.460889 6.73981,-2.354001 12.35499,-2.663971 z",
quitIcon:"M 57.23,0 C 42.622,0 27.986,5.599 16.791,16.794 c -22.388,22.388 -22.388,58.487 0,80.878 l 402.33,402.33 -401.98,402.33 c -22.388,22.388 -22.388,58.149 0,80.537 22.388,22.388 58.146,22.388 80.534,0 l 402.33,-402.02 402.33,402.32 c 22.388,22.388 58.146,22.388 80.534,0 22.388,-22.388 22.388,-58.49 0,-80.878 l -402.33,-402.32 402.68,-402.67 c 22.388,-22.388 22.388,-58.146 0,-80.534 -22.388,-22.388 -58.149,-22.388 -80.537,0 L 500.012,419.427 97.342,16.757 C 86.145,5.563 71.85,-0.036 57.242,-0.036 z",
redditIcon:"m 809.71429,520.92822 c 0,-37.76031 -30.8501,-68.45512 -68.7657,-68.45512 -18.50488,0 -35.27573,7.40196 -47.62094,19.30719 -46.84453,-30.82422 -110.22698,-50.44198 -180.41613,-52.95243 l 38.38146,-120.83816 103.9379,24.35398 -0.15529,1.50109 c 0,30.87598 25.23393,55.9805 56.26519,55.9805 31.00538,0 56.21343,-25.10452 56.21343,-55.9805 0,-30.87598 -25.23393,-56.00637 -56.21343,-56.00637 -23.81047,0 -44.10113,14.85566 -52.3054,35.68982 L 546.99674,277.25906 c -4.8915,-1.19053 -9.86065,1.6305 -11.38762,6.44435 l -42.8071,134.76212 c -73.45014,0.87995 -139.99006,20.653 -188.93095,52.40893 -12.26756,-11.33586 -28.54669,-18.42724 -46.55983,-18.42724 -37.91559,0 -68.73981,30.72069 -68.73981,68.481 0,25.10453 13.79455,46.8704 34.08522,58.77564 -1.34581,7.29843 -2.22576,14.6745 -2.22576,22.17997 0,101.22041 124.43562,183.57358 277.41792,183.57358 152.98231,0 277.44381,-82.35317 277.44381,-183.57358 0,-7.09137 -0.75055,-14.07923 -1.94107,-20.96357 21.53295,-11.56879 36.36274,-33.9558 36.36274,-59.99204 z m -445.77352,46.99981 c 0,-22.46467 18.37547,-40.7625 40.94366,-40.7625 22.5682,0 40.91779,18.29783 40.91779,40.7625 0,22.46467 -18.34959,40.73661 -40.91779,40.73661 -22.56819,0 -40.94366,-18.27194 -40.94366,-40.73661 z m 234.5073,120.83816 c -20.62712,20.5236 -53.00419,30.51364 -98.96876,30.51364 l -0.33645,-0.0776 -0.33645,0.0776 c -45.99045,0 -78.36753,-9.99004 -98.96876,-30.51364 -3.75274,-3.72686 -3.75274,-9.80888 0,-13.53574 3.75273,-3.75274 9.86065,-3.75274 13.61337,0 16.82263,16.74497 44.74818,24.8716 85.35539,24.8716 l 0.33645,0.0777 0.33645,-0.0777 c 40.60721,0 68.53276,-8.1525 85.35539,-24.89748 3.75272,-3.75274 9.86064,-3.72686 13.61337,0 3.75274,3.75274 3.75274,9.80888 0,13.56162 z m -4.8915,-80.10155 c -22.56819,0 -40.91778,-18.27194 -40.91778,-40.73661 0,-22.46467 18.34959,-40.7625 40.91778,-40.7625 22.56819,0 40.91779,18.29783 40.91779,40.7625 0,22.46467 -18.3496,40.73661 -40.91779,40.73661 z",
redirectButtonArrow:"M 445.1875 241.375 C 442.76738 241.41638 440.85549 241.81355 439.5 242.59375 C 428.8432 248.72767 421.41114 296.41937 417.21875 360.125 L 181.8125 360.125 C 170.67241 360.125 161.71875 369.10991 161.71875 380.25 L 161.71875 605.46875 C 161.71875 616.60884 170.67241 625.5625 181.8125 625.5625 L 416.875 625.5625 C 420.90006 689.23169 428.20847 736.90344 438.84375 743.0625 C 473.49132 763.12745 872.54077 533.4444 872.59375 493.40625 C 872.64466 454.93209 504.72252 240.35713 445.1875 241.375 z ",
renderingModeIcon:"m 507.40625,137.8125 -307.0625,178.34375 40.8125,23.71875 307.25,-178.25 z m 85.625,49.75 -307.21875,178.25 43.5625,25.3125 307.25,-178.25 z M 681.25,238.8125 374,417.03125 l 43.90625,25.5 307.21875,-178.25 z m 88.53125,51.40625 -307.25,178.25 44.3125,25.71875 307.0625,-178.34375 z m 63.375,51.90625 -307.40625,177.09375 0,354.75 308.21875,-176.625 z m -647.84375,3.53125 -1.4375,355.125 307.40625,176.4375 1.4375,-355.09375 z m 39.71875,82.625 221.625,119.84375 0,251.6875 L 228.0625,674.78125 z",
resetAnimationIcon:"M 515.71875 117.15625 C 456.39993 117.15625 400.41154 131.38798 350.96875 156.625 L 318.34375 271.53125 L 440.8125 282.25 C 464.10029 273.42291 489.33816 268.5625 515.71875 268.5625 C 632.48753 268.5625 727.15625 363.23122 727.15625 480 C 727.15625 544.46324 698.30697 602.18604 652.8125 640.96875 L 764 650.6875 L 729.4375 773.25 C 819.83535 707.26062 878.5625 600.49725 878.5625 480 C 878.5625 279.59953 716.11922 117.15625 515.71875 117.15625 z M 298.875 189.03125 C 210.22683 255.18509 152.84375 360.88495 152.84375 480 C 152.84375 680.40047 315.31828 842.84375 515.71875 842.84375 C 573.89552 842.84375 628.86031 829.1469 677.59375 804.8125 L 710.46875 689.03125 L 588.9375 678.40625 C 566.12118 686.83037 541.46063 691.4375 515.71875 691.4375 C 398.94997 691.4375 304.28125 596.76878 304.28125 480 C 304.28125 415.93503 332.77268 358.52528 377.78125 319.75 L 264.78125 309.875 L 298.875 189.03125 z",
resetIcon:"m 687.8112,317.97249 c 0,0 -112.5553,47.9265 -165.1562,78.25001 -52.6115,30.31119 -150.25,103.99999 -150.25,103.99999 0,0 98.0189,73.6897 150.625,104.00001 52.6061,30.3244 164.9687,78.0625 164.9688,78.0625 0,0 6.5935,-55.3655 10.9062,-110.03121 l 172.9062,0 c 2.7346,0 5.105,-2.625 6.3438,-6.5 0.5633,-1.7638 0.9085,-3.7992 0.9375,-5.9376 l 0,-119.4687 c -0.055,-6.9939 -3.2113,-12.4793 -7.1875,-12.5 l -173.0312,0 c -4.3597,-54.596 -11.0625,-109.875 -11.0626,-109.875 z m -473.375,91.03131 c -50.476,0 -91.4062,40.90039 -91.4062,91.37499 0,50.5033 40.9302,91.43741 91.4062,91.43741 50.4761,0 91.4063,-40.93421 91.4063,-91.43741 0,-50.4746 -40.9301,-91.37499 -91.4063,-91.37499 z",
rightArrowIcon:"m 56.353962,267.20166 c -0.0374,-2.64533 0.67534,-5.24404 2.05836,-7.49619 0,0 17.0269,-28.6679 34.04342,-57.71859 8.508448,-14.52396 17.008828,-29.14437 23.344678,-40.27722 3.04336,-5.34369 5.50177,-9.75633 7.26258,-13.01148 -1.74878,-3.23228 -4.17417,-7.60749 -7.18458,-12.89575 -6.29447,-11.05807 -14.75869,-25.58077 -23.208048,-40.005001 -16.9011,-28.85406 -33.81101,-57.308531 -33.81101,-57.308531 -9.4785,-15.937469 14.42744,-30.1554393 23.90594,-14.217969 0,0 16.92807,28.510349 33.890648,57.46407 8.47991,14.47772 16.97468,29.061971 23.38054,40.318241 3.20412,5.6263 5.89322,10.41807 7.84468,14.04069 0.9649,1.81311 1.74079,3.30057 2.39208,4.64056 0.32198,0.66712 0.59914,1.27844 0.9327,2.07846 0.32123,0.78396 1.20201,0 1.22614,5.84579 0,5.92348 -1.22614,5.88605 -1.22614,5.88605 -0.32198,0.80406 -0.59914,1.40708 -0.9327,2.07846 -0.66712,1.35083 -1.42718,2.86242 -2.40814,4.67919 -1.96192,3.64638 -4.68,8.45458 -7.9034,14.12107 -6.44807,11.32986 -14.95972,26.0311 -23.49872,40.60728 -17.076798,29.15117 -34.141518,57.83274 -34.141518,57.83274 -7.01246,12.23887 -25.68893,7.46197 -25.96393,-6.64058 z",
rightBg:"m 866.09701,919.39347 c 0,0 85.25418,-396.7797 0,-840.000097 0,0 -284.50138,-82.8397912 -840.00002,-79.38789149 0,0 0,540.00010849 0,1000.00011849 0,0 381.38792,5.5515 840.00002,-80.61213 z",rotateIcon:"m 498.41334,179.4755 c -2.64896,0.0222 -5.29736,0.10079 -7.94309,0.2427 -21.16581,1.16239 -42.61372,5.18112 -64.20666,10.96588 -68.27674,18.2952 -124.6502,60.04573 -161.90676,114.15987 -23.3927,-12.68177 -44.5254,-23.3218 -44.5254,-23.3218 0,0 -12.7782,68.80372 -14.9595,103.54702 -2.1869,34.74223 1.9417,104.91499 1.9417,104.91499 0,0 66.148,-23.2983 97.30285,-38.83289 31.15733,-15.5267 89.71282,-54.12334 89.71282,-54.12334 0,0 -18.92733,-16.15634 -40.35531,-33.27272 23.28618,-33.35429 57.48997,-59.50002 99.84025,-70.84797 50.73851,-13.59152 101.86412,-3.50374 142.75499,22.81433 4.90626,2.87887 8.92682,6.69439 13.50326,10.12744 19.78993,-12.86438 30.76254,-22.39579 43.9297,-35.47913 23.82033,-23.83386 29.56864,-44.76275 29.56595,-44.76815 -1.8652,-1.32454 -3.4497,-2.90096 -5.05269,-4.23632 -46.62427,-38.30663 -104.60021,-59.97394 -166.42982,-61.64721 -4.35212,-0.16894 -8.75736,-0.27966 -13.17229,-0.2427 z m 294.75487,262.71774 c 0,0 -66.14803,23.29829 -97.30287,38.83288 -31.15703,15.52673 -89.7128,54.1454 -89.7128,54.1454 0,0 19.07202,16.26237 40.59802,33.44925 -23.27813,33.25236 -57.42727,59.30466 -99.6858,70.62731 -50.7385,13.59425 -101.86412,3.50376 -142.75499,-22.81433 -4.97384,-3.13023 -9.46021,-6.65613 -14.36375,-10.10536 -19.7926,12.86438 -30.76797,22.3931 -43.92971,35.47913 -23.82304,23.83657 -28.73025,44.76545 -28.7275,44.76815 1.86518,1.32457 3.47174,2.90096 5.07476,4.23631 46.62155,38.30662 104.57814,59.97396 166.40775,61.64721 27.84806,0.75691 56.53597,-3.24561 85.32203,-10.96588 68.20458,-18.27321 124.56079,-59.95486 161.81841,-113.98335 23.28089,12.61502 44.23861,23.16735 44.23861,23.16735 0,0 12.79767,-68.80289 14.98155,-103.54702 2.18416,-34.73871 -1.96371,-104.93705 -1.96371,-104.93705 z",
rotateIconBot:"m 456.61529,213.4655 c -2.649,0.0222 -5.2974,0.10079 -7.9431,0.2427 -21.1658,1.16239 -42.6137,5.18112 -64.2067,10.96588 -68.2767,18.2952 -124.6502,60.04573 -161.90666,114.15987 -23.3927,-12.68177 -44.5254,-23.3218 -44.5254,-23.3218 0,0 -12.7782,68.80372 -14.9595,103.54702 -2.1869,34.74223 1.9417,104.91499 1.9417,104.91499 0,0 66.148,-23.2983 97.30276,-38.83289 31.1573,-15.5267 89.7128,-54.12334 89.7128,-54.12334 0,0 -18.9273,-16.15634 -40.3553,-33.27272 23.2862,-33.35429 57.49,-59.50002 99.8403,-70.84797 50.7385,-13.59152 101.8641,-3.50374 142.755,22.81433 4.9062,2.87887 8.9268,6.69439 13.5032,10.12744 19.79004,-12.86438 30.76264,-22.39579 43.92974,-35.47913 23.8204,-23.83386 29.5687,-44.76275 29.566,-44.76815 -1.8652,-1.32454 -3.4497,-2.90096 -5.0527,-4.23632 -46.6243,-38.30663 -104.60024,-59.97394 -166.42984,-61.64721 -4.3522,-0.16894 -8.7574,-0.27966 -13.1723,-0.2427 z m 294.75484,262.71774 c 0,0 -66.148,23.29829 -97.3028,38.83288 -31.1571,15.52673 -89.71284,54.1454 -89.71284,54.1454 0,0 19.07204,16.26237 40.59804,33.44925 -23.2781,33.25236 -57.42734,59.30466 -99.68584,70.62731 -50.7385,13.59425 -101.8641,3.50376 -142.755,-22.81433 -4.9738,-3.13023 -9.4602,-6.65613 -14.3637,-10.10536 -19.7926,12.86438 -30.768,22.3931 -43.9298,35.47913 -23.823,23.83657 -28.7302,44.76545 -28.7275,44.76815 1.8652,1.32457 3.4718,2.90096 5.0748,4.23631 46.6216,38.30662 104.5781,59.97396 166.4078,61.64721 27.848,0.75691 56.5359,-3.24561 85.322,-10.96588 68.20464,-18.27321 124.56084,-59.95486 161.81844,-113.98335 23.2809,12.61502 44.2386,23.16735 44.2386,23.16735 0,0 12.7977,-68.80289 14.9816,-103.54702 2.1841,-34.73871 -1.9638,-104.93705 -1.9638,-104.93705 z",
scrollingBottomArrow:"m 108.07967,272.02349 c -3.81556,0 -3.27946,-0.60079 -3.80222,-0.80804 -0.52578,-0.21009 -0.91014,-0.39095 -1.34332,-0.60611 -0.87367,-0.43025 -1.85991,-0.93398 -3.041764,-1.57153 -2.36338,-1.27511 -5.49046,-3.0293 -9.16237,-5.12033 -7.34604,-4.18002 -16.86455,-9.71331 -26.31206,-15.24683 -18.89634,-11.06975 -37.48911,-22.11634 -37.48911,-22.11634 -10.6875,-6.10237 -1.20864,-22.06545 9.26463,-15.60235 0,0 18.57049,11.03666 37.40175,22.06651 9.41333,5.51545 18.89038,11.03768 26.10759,15.14501 3.450524,1.96513 6.304214,3.54823 8.415254,4.68925 2.12516,-1.14917 5.00473,-2.75508 8.49078,-4.74015 7.26534,-4.13486 16.80754,-9.68232 26.28609,-15.23424 18.9593,-11.1046 37.6676,-22.22994 37.6676,-22.22994 10.44407,-6.34609 19.83579,9.46877 9.2653,15.60207 0,0 -18.73053,11.13662 -37.75647,22.2811 -9.51111,5.57185 -19.09555,11.14002 -26.48821,15.34813 -3.69636,2.10416 -6.82405,3.86357 -9.2009,5.14553 -1.19061,0.62964 -2.19022,1.15699 -3.0677,1.58465 -0.43684,0.20974 -0.81806,0.39357 -1.34384,0.60606 -0.51082,0.21009 0,0.8081 -3.85256,0.8081 z m 0,-57.6028 c -3.81556,0 -3.29279,-0.5772 -3.81482,-0.80024 -0.51843,-0.20974 -0.91881,-0.3909 -1.35512,-0.60605 -0.87367,-0.43027 -1.8481,-0.94976 -3.029184,-1.58467 -2.36496,-1.27512 -5.49045,-3.01745 -9.16458,-5.1085 -7.34455,-4.17974 -16.86149,-9.71173 -26.31057,-15.24605 -18.89555,-11.06895 -37.50171,-22.12844 -37.50171,-22.12844 -10.40453,-6.1842 -1.12725,-21.78707 9.27722,-15.60286 0,0 18.57129,11.04927 37.40019,22.07831 9.4149,5.51623 18.89198,11.012 26.10918,15.12141 3.458654,1.96777 6.316784,3.55927 8.428564,4.7003 2.12516,-1.14914 4.99583,-2.75799 8.4782,-4.73886 7.26605,-4.13619 16.80605,-9.68206 26.28609,-15.23478 18.95781,-11.10591 37.66758,-22.22993 37.66758,-22.22993 10.45195,-6.37733 19.86659,9.47745 9.26456,15.60206 0,0 -18.71792,11.13665 -37.74387,22.28194 -9.5111,5.57106 -19.10738,11.15182 -26.50154,15.35908 -3.69636,2.10418 -6.82255,3.85181 -9.20089,5.13346 -1.18904,0.64542 -2.17685,1.15701 -3.05438,1.58468 -0.43684,0.20973 -0.84272,0.40665 -1.36902,0.6297 -0.52578,0.20972 -7.4e-4,0.8002 -3.83998,0.8002 z m 0,-58.88367 c -3.81556,0 -3.29279,-0.5772 -3.81482,-0.80023 -0.51843,-0.20972 -0.91881,-0.39354 -1.35512,-0.60609 -0.87367,-0.43024 -1.8481,-0.94976 -3.029184,-1.58465 -2.36496,-1.27249 -5.49045,-3.0172 -9.16458,-5.10826 -7.34455,-4.18079 -16.86149,-9.72509 -26.31057,-15.25942 -18.89555,-11.06736 -37.50171,-22.1292 -37.50171,-22.1292 -10.86168,-6.06223 -1.23083,-22.244143 9.27722,-15.587913 0,0 18.57129,11.035603 37.40019,22.065433 9.4149,5.51416 18.89198,11.03797 26.10918,15.14452 3.451234,1.9651 6.305684,3.54822 8.415234,4.69004 2.12516,-1.14915 5.00399,-2.74329 8.49153,-4.72859 7.26605,-4.13465 16.80605,-9.70571 26.28609,-15.25918 18.95781,-11.10463 37.66758,-22.205563 37.66758,-22.205563 10.45195,-6.3773 19.86659,9.477413 9.26456,15.602083 0,0 -18.71792,11.1366 -37.74387,22.28109 -9.5111,5.57186 -19.10738,11.12746 -26.50154,15.33634 -3.69636,2.10415 -6.82255,3.87695 -9.20089,5.15862 -1.18904,0.64541 -2.17685,1.15702 -3.05438,1.58465 -0.43684,0.21009 -0.84272,0.39095 -1.36902,0.60609 -0.52578,0.20974 -7.4e-4,0.80023 -3.83998,0.80023 z m 0,-60.163283 c -3.81556,0 -3.29279,-0.5772 -3.81482,-0.8002 -0.51843,-0.20973 -0.91881,-0.39356 -1.35512,-0.60607 -0.87367,-0.43029 -1.8481,-0.94711 -3.029184,-1.58207 -2.36496,-1.27244 -5.49045,-3.01825 -9.16458,-5.10772 -7.34455,-4.18208 -16.86149,-9.71249 -26.31057,-15.24735 -18.89555,-11.06841 -37.50171,-22.1279 -37.50171,-22.1279 -10.22133,-6.22985 -1.07754,-21.60683 9.27722,-15.60128 0,0 18.57129,11.0343 37.40019,22.06412 9.4149,5.51547 18.89198,11.03721 26.10918,15.14583 3.458654,1.96773 6.316784,3.54772 8.428564,4.68872 2.12516,-1.14917 4.99583,-2.75743 8.4782,-4.73961 7.26605,-4.13566 16.80605,-9.67999 26.28609,-15.23505 18.95781,-11.10381 37.66758,-22.22914 37.66758,-22.22914 10.45965,-6.40986 19.8986,9.48553 9.26456,15.60152 0,0 -18.71792,11.13795 -37.74387,22.28165 -9.5111,5.57186 -19.10738,11.15263 -26.50154,15.36072 -3.69636,2.10418 -6.82255,3.85099 -9.20089,5.1329 -1.18904,0.64541 -2.17685,1.15705 -3.05438,1.58469 -0.43684,0.20974 -0.84272,0.40667 -1.36902,0.62183 -0.52578,0.20974 -7.4e-4,0.8002 -3.83998,0.8002 z",
scrollingTopArrow:"m 108.5317,32.501073 c 3.81556,0 3.27946,0.600793 3.80222,0.808045 0.52578,0.210091 0.91014,0.390947 1.34332,0.606109 0.87367,0.430247 1.85991,0.933984 3.04176,1.571527 2.36338,1.275117 5.49046,3.029303 9.16237,5.120332 7.34604,4.180018 16.86455,9.713307 26.31206,15.24683 18.89634,11.069748 37.48911,22.116344 37.48911,22.116344 10.6875,6.10237 1.20864,22.06545 -9.26463,15.602344 0,0 -18.57049,-11.036662 -37.40175,-22.066511 -9.41333,-5.515442 -18.89038,-11.037673 -26.10759,-15.145003 -3.45052,-1.965132 -6.30421,-3.548229 -8.41525,-4.689252 -2.12516,1.149167 -5.00473,2.755074 -8.49078,4.740144 C 92.737198,60.546851 83.195,66.094303 73.716449,71.646228 54.757146,82.750826 36.048845,93.876164 36.048845,93.876164 25.604771,100.22226 16.213048,84.407401 26.783546,78.274098 c 0,0 18.730523,-11.136618 37.756468,-22.281103 9.511109,-5.571853 19.095549,-11.140023 26.488216,-15.348124 3.69636,-2.104168 6.824044,-3.863574 9.2009,-5.145533 1.19061,-0.629644 2.19022,-1.156991 3.0677,-1.584656 0.43684,-0.209739 0.81806,-0.393562 1.34384,-0.606055 0.51082,-0.210091 0,-0.808098 3.85256,-0.808098 z m 0,57.602801 c 3.81556,0 3.29279,0.5772 3.81482,0.80024 0.51843,0.20974 0.91881,0.3909 1.35512,0.60605 0.87367,0.43027 1.8481,0.94976 3.02918,1.58467 2.36496,1.27512 5.49045,3.01745 9.16458,5.1085 7.34455,4.179746 16.86149,9.711736 26.31057,15.246056 18.89555,11.06895 37.50171,22.12844 37.50171,22.12844 10.40453,6.1842 1.12725,21.78707 -9.27722,15.60286 0,0 -18.57129,-11.04927 -37.40019,-22.07831 -9.4149,-5.51623 -18.89198,-11.012 -26.10918,-15.12141 -3.45865,-1.96777 -6.31678,-3.55927 -8.42856,-4.7003 -2.12516,1.14914 -4.99583,2.75799 -8.4782,4.73886 -7.266058,4.13619 -16.806055,9.68206 -26.286099,15.23478 -18.957811,11.10591 -37.66758,22.22993 -37.66758,22.22993 -10.451951,6.37733 -19.866586,-9.47745 -9.264564,-15.60206 0,0 18.717927,-11.13665 37.743874,-22.28194 9.511108,-5.57106 19.107382,-11.15182 26.501547,-15.359086 3.696361,-2.10418 6.822545,-3.85181 9.200892,-5.13346 1.18904,-0.64542 2.17685,-1.15701 3.05438,-1.58468 0.43684,-0.20973 0.84272,-0.40665 1.36902,-0.6297 0.52578,-0.20972 7.4e-4,-0.8002 3.83998,-0.8002 z m 0,58.883676 c 3.81556,0 3.29279,0.5772 3.81482,0.80023 0.51843,0.20972 0.91881,0.39354 1.35512,0.60609 0.87367,0.43024 1.8481,0.94976 3.02918,1.58465 2.36496,1.27249 5.49045,3.0172 9.16458,5.10826 7.34455,4.18079 16.86149,9.72509 26.31057,15.25942 18.89555,11.06736 37.50171,22.1292 37.50171,22.1292 10.86168,6.06223 1.23083,22.24414 -9.27722,15.58791 0,0 -18.57129,-11.0356 -37.40019,-22.06543 -9.4149,-5.51416 -18.89198,-11.03797 -26.10918,-15.14452 -3.45123,-1.9651 -6.30568,-3.54822 -8.41523,-4.69004 -2.12516,1.14915 -5.00399,2.74329 -8.49153,4.72859 -7.266058,4.13465 -16.806055,9.70571 -26.286099,15.25918 -18.957811,11.10463 -37.66758,22.20556 -37.66758,22.20556 -10.451951,6.3773 -19.866586,-9.47741 -9.264564,-15.60208 0,0 18.717927,-11.1366 37.743874,-22.28109 9.511108,-5.57186 19.107382,-11.12746 26.501547,-15.33634 3.696361,-2.10415 6.822545,-3.87695 9.200892,-5.15862 1.18904,-0.64541 2.17685,-1.15702 3.05438,-1.58465 0.43684,-0.21009 0.84272,-0.39095 1.36902,-0.60609 0.52578,-0.20974 7.4e-4,-0.80023 3.83998,-0.80023 z m 0,60.16328 c 3.81556,0 3.29279,0.5772 3.81482,0.8002 0.51843,0.20973 0.91881,0.39356 1.35512,0.60607 0.87367,0.43029 1.8481,0.94711 3.02918,1.58207 2.36496,1.27244 5.49045,3.01825 9.16458,5.10772 7.34455,4.18208 16.86149,9.71249 26.31057,15.24735 18.89555,11.06841 37.50171,22.1279 37.50171,22.1279 10.22133,6.22985 1.07754,21.60683 -9.27722,15.60128 0,0 -18.57129,-11.0343 -37.40019,-22.06412 -9.4149,-5.51547 -18.89198,-11.03721 -26.10918,-15.14583 -3.45865,-1.96773 -6.31678,-3.54772 -8.42856,-4.68872 -2.12516,1.14917 -4.99583,2.75743 -8.4782,4.73961 -7.266058,4.13566 -16.806055,9.67999 -26.286099,15.23505 -18.957811,11.10381 -37.66758,22.22914 -37.66758,22.22914 -10.45965,6.40986 -19.898603,-9.48553 -9.264564,-15.60152 0,0 18.717927,-11.13795 37.743874,-22.28165 9.511108,-5.57186 19.107382,-11.15263 26.501547,-15.36072 3.696361,-2.10418 6.822545,-3.85099 9.200892,-5.1329 1.18904,-0.64541 2.17685,-1.15705 3.05438,-1.58469 0.43684,-0.20974 0.84272,-0.40667 1.36902,-0.62183 0.52578,-0.20974 7.4e-4,-0.8002 3.83998,-0.8002 z",
semiWireFrameRendering:"m 687.8112,317.97249 c 0,0 -112.5553,47.9265 -165.1562,78.25001 -52.6115,30.31119 -150.25,103.99999 -150.25,103.99999 0,0 98.0189,73.6897 150.625,104.00001 52.6061,30.3244 164.9687,78.0625 164.9688,78.0625 0,0 6.5935,-55.3655 10.9062,-110.03121 l 172.9062,0 c 2.7346,0 5.105,-2.625 6.3438,-6.5 0.5633,-1.7638 0.9085,-3.7992 0.9375,-5.9376 l 0,-119.4687 c -0.055,-6.9939 -3.2113,-12.4793 -7.1875,-12.5 l -173.0312,0 c -4.3597,-54.596 -11.0625,-109.875 -11.0626,-109.875 z m -473.375,91.03131 c -50.476,0 -91.4062,40.90039 -91.4062,91.37499 0,50.5033 40.9302,91.43741 91.4062,91.43741 50.4761,0 91.4063,-40.93421 91.4063,-91.43741 0,-50.4746 -40.9301,-91.37499 -91.4063,-91.37499 z",
settingsIcon1:"M 175.84375 99.6875 C 162.9514 99.6875 152.5625 108.1053 152.5625 118.5625 L 152.5625 321.46875 L 125.78125 321.46875 C 111.60366 321.46875 100.1875 333.32736 100.1875 348.0625 L 100.1875 466.21875 C 100.1875 480.95389 111.60366 492.8125 125.78125 492.8125 L 152.5625 492.8125 L 152.5625 861.4375 C 152.5625 871.8947 162.9514 880.3125 175.84375 880.3125 L 195.9375 880.3125 C 208.82985 880.3125 219.21875 871.8947 219.21875 861.4375 L 219.21875 492.8125 L 245.96875 492.8125 C 260.14634 492.8125 271.5625 480.95389 271.5625 466.21875 L 271.5625 348.0625 C 271.5625 333.32736 260.14634 321.46875 245.96875 321.46875 L 219.21875 321.46875 L 219.21875 118.5625 C 219.21875 108.1053 208.82985 99.6875 195.9375 99.6875 L 175.84375 99.6875 z",
settingsIcon2:"M 490 99.6875 C 477.10765 99.6875 466.71875 108.1053 466.71875 118.5625 L 466.71875 548.03125 L 439.96875 548.03125 C 425.79116 548.03125 414.375 559.88986 414.375 574.625 L 414.375 692.8125 C 414.375 707.54764 425.79116 719.40625 439.96875 719.40625 L 466.71875 719.40625 L 466.71875 861.4375 C 466.71875 871.8947 477.10765 880.3125 490 880.3125 L 510.09375 880.3125 C 522.9861 880.3125 533.375 871.8947 533.375 861.4375 L 533.375 719.40625 L 560.125 719.40625 C 574.30259 719.40625 585.71875 707.54764 585.71875 692.8125 L 585.71875 574.625 C 585.71875 559.88986 574.30259 548.03125 560.125 548.03125 L 533.375 548.03125 L 533.375 118.5625 C 533.375 108.1053 522.9861 99.6875 510.09375 99.6875 L 490 99.6875 z",
settingsIcon3:"M 806.0625 99.6875 C 793.17015 99.6875 782.78125 108.1053 782.78125 118.5625 L 782.78125 256.71875 L 756.03125 256.71875 C 741.85366 256.71875 730.4375 268.57736 730.4375 283.3125 L 730.4375 401.46875 C 730.4375 416.20389 741.85366 428.09375 756.03125 428.09375 L 782.78125 428.09375 L 782.78125 861.4375 C 782.78125 871.8947 793.17015 880.3125 806.0625 880.3125 L 826.15625 880.3125 C 839.0486 880.3125 849.4375 871.8947 849.4375 861.4375 L 849.4375 428.09375 L 876.21875 428.09375 C 890.39634 428.09375 901.8125 416.20389 901.8125 401.46875 L 901.8125 283.3125 C 901.8125 268.57736 890.39634 256.71875 876.21875 256.71875 L 849.4375 256.71875 L 849.4375 118.5625 C 849.4375 108.1053 839.0486 99.6875 826.15625 99.6875 L 806.0625 99.6875 z",
shareIcon:"M 622.36133 261.40234 C 621.3462 261.40632 620.3298 261.42929 619.3125 261.4707 L 619.31445 261.47656 C 608.46326 261.9212 597.47136 264.47357 587.03125 269.39844 C 555.78608 284.1406 537.87197 315.75174 539.10156 348.22461 L 346.88867 438.88672 A 85.105354 85.105354 0 0 0 289.66211 416.63672 A 85.105354 85.105354 0 0 0 204.55664 501.74219 A 85.105354 85.105354 0 0 0 289.66211 586.84766 A 85.105354 85.105354 0 0 0 347.08984 564.43359 L 538.9043 655 C 537.67493 687.47234 555.58675 719.08479 586.83203 733.82617 C 628.59271 753.52809 678.43643 735.57913 698.13867 693.81836 C 717.84092 652.05746 699.89152 602.41285 658.13086 582.71094 C 627.80777 568.40495 593.4145 573.92146 569.20703 594 L 375.11523 502.30273 C 375.11923 501.84598 375.11923 501.37673 375.11523 500.91602 L 569.20703 409.41602 C 593.4145 429.49434 628.0069 435.01095 658.33008 420.70508 C 700.09087 401.00381 718.03819 351.16039 698.33594 309.40039 C 684.021 279.05828 653.83018 261.27904 622.36133 261.40234 z ",
silhouetteEffectIcon:"m 687.8112,317.97249 c 0,0 -112.5553,47.9265 -165.1562,78.25001 -52.6115,30.31119 -150.25,103.99999 -150.25,103.99999 0,0 98.0189,73.6897 150.625,104.00001 52.6061,30.3244 164.9687,78.0625 164.9688,78.0625 0,0 6.5935,-55.3655 10.9062,-110.03121 l 172.9062,0 c 2.7346,0 5.105,-2.625 6.3438,-6.5 0.5633,-1.7638 0.9085,-3.7992 0.9375,-5.9376 l 0,-119.4687 c -0.055,-6.9939 -3.2113,-12.4793 -7.1875,-12.5 l -173.0312,0 c -4.3597,-54.596 -11.0625,-109.875 -11.0626,-109.875 z m -473.375,91.03131 c -50.476,0 -91.4062,40.90039 -91.4062,91.37499 0,50.5033 40.9302,91.43741 91.4062,91.43741 50.4761,0 91.4063,-40.93421 91.4063,-91.43741 0,-50.4746 -40.9301,-91.37499 -91.4063,-91.37499 z",
squareBg:"m 81.059322,920.12708 c 0,0 396.779598,85.25402 839.999998,10e-6 0,0 85.25418,-396.77969 0,-839.999972 0,0 -396.7797,-85.2542 -839.999998,-10e-6 0,0 -85.2542,396.779652 0,839.999972 z",squareBgPlayIcon:"M 154.34311,0.01740534 C 106.62311,6.7894052 42.303108,17.789801 40.963108,19.129801 c -0.68886,0.68886 -10.896,61.616 -15.068,89.693999 -11.068,74.494 -18.9740004,151.93 -24.3970004,243.26 -2.5763,43.77 -2.5901,204.9 0,248.99 5.4834,93.251 13.1500004,169.3 25.1140004,249.71 6.1722,41.458 13.715,83.504 15.07,84.673 0.59702,0.5051 13.775,3.0884 29.421,5.7405 27.952004,4.7394 55.658822,10.07992 83.284822,13.88272 322.12999,0 379.44658,0 680.22658,0 34.422,-4.5901 68.38759,-9.99732 102.58659,-16.04512 l 20.092,-3.589 5.0218,-27.268 c 28.393,-159.89 41.766,-349.65 35.881,-510.19 -4.5741,-124.81 -15.052,-225.12 -35.162,-345.149999 -3.0493,-18.181 -5.5109,-33.518 -5.7405,-33.724 -0.6429,-0.73478 -52.053,-9.6922996 -83.238,-14.3509991 C 860.7304,2.7652019 848.233,1.7743443 835,0.00394131 c -289.14,0 -363.1496,0.01147196 -680.65959,0.01147196 z",
squareBgPlayIconBlack:"m 80.042678,898.1113 c 0,0 396.779642,85.25416 839.999982,10e-6 0,0 85.25424,-396.77969 0,-840.000001 0,0 -396.77971,-85.254202 -839.999997,-10e-6 0,0 -85.2541838,396.779681 1.5e-5,840.000001 z",squareBgPlayIconBlackBot:"m 56.027542,916.02754 c 0,0 396.779658,85.25416 839.999998,10e-6 0,0 85.2542,-396.77969 0,-840.000008 0,0 -396.77971,-85.2542016 -840.000013,-1e-5 0,0 -85.254187,396.779688 1.5e-5,840.000008 z",squareBgPlayIconBot:"m 2.315434,845.09489 c 6.7669,47.722 16.606,112.04 17.94,113.38 0.68886,0.6889 61.61598,10.896 89.693976,15.068 74.494,11.068 151.93,18.974 243.26,24.397 43.77,2.57641 204.9,2.59011 248.99,0 93.251,-5.4833 169.3,-13.15 249.71,-25.114 41.458,-6.1722 83.504,-13.715 84.673,-15.07 0.5051,-0.597 3.0884,-13.775 5.7405,-29.421 4.7394,-27.952 8.3972,-55.612 12.2,-83.238 0,-322.13 1.4236,-379.47 1.4236,-680.25 -4.5901,-34.422 -9.7382,-68.411 -15.786,-102.61 l -3.589,-20.092 -27.268,-5.0218 c -159.87,-28.402 -349.63,-41.775 -510.17,-35.89 -124.81,4.5741 -225.12,15.052 -345.149976,35.162 -18.181,3.0493 -33.518,5.5109 -33.724,5.7405 -0.73478,0.6429 -9.6923,52.053 -14.351,83.238 -1.9977,13.325 -3.2537,26.232 -5.02409993,39.465 0,289.14 1.42369993,362.74 1.42369993,680.25 z",
squareBgTransparent:"m 46.009539,1053.6689 c 0,0 475.935331,102.2617 1007.576261,0 0,0 102.2619,-475.93551 0,-1007.576244 0,0 -475.93552,-102.262032 -1007.576261,-10e-6 0,0 -102.262031,475.935404 0,1007.576254 z",squareBgViews:"m 127.68301,973.19081 c 0,0 399.78567,85.89989 846.364,0 0,0 85.90009,-399.78577 0,-846.36398 0,0 -399.78579,-85.90011 -846.364,-1e-5 0,0 -85.900099,399.78574 0,846.36399 z",ssaoEffectIcon:"m 687.8112,317.97249 c 0,0 -112.5553,47.9265 -165.1562,78.25001 -52.6115,30.31119 -150.25,103.99999 -150.25,103.99999 0,0 98.0189,73.6897 150.625,104.00001 52.6061,30.3244 164.9687,78.0625 164.9688,78.0625 0,0 6.5935,-55.3655 10.9062,-110.03121 l 172.9062,0 c 2.7346,0 5.105,-2.625 6.3438,-6.5 0.5633,-1.7638 0.9085,-3.7992 0.9375,-5.9376 l 0,-119.4687 c -0.055,-6.9939 -3.2113,-12.4793 -7.1875,-12.5 l -173.0312,0 c -4.3597,-54.596 -11.0625,-109.875 -11.0626,-109.875 z m -473.375,91.03131 c -50.476,0 -91.4062,40.90039 -91.4062,91.37499 0,50.5033 40.9302,91.43741 91.4062,91.43741 50.4761,0 91.4063,-40.93421 91.4063,-91.43741 0,-50.4746 -40.9301,-91.37499 -91.4063,-91.37499 z",
ssaoFilterEffectIcon:"m 687.8112,317.97249 c 0,0 -112.5553,47.9265 -165.1562,78.25001 -52.6115,30.31119 -150.25,103.99999 -150.25,103.99999 0,0 98.0189,73.6897 150.625,104.00001 52.6061,30.3244 164.9687,78.0625 164.9688,78.0625 0,0 6.5935,-55.3655 10.9062,-110.03121 l 172.9062,0 c 2.7346,0 5.105,-2.625 6.3438,-6.5 0.5633,-1.7638 0.9085,-3.7992 0.9375,-5.9376 l 0,-119.4687 c -0.055,-6.9939 -3.2113,-12.4793 -7.1875,-12.5 l -173.0312,0 c -4.3597,-54.596 -11.0625,-109.875 -11.0626,-109.875 z m -473.375,91.03131 c -50.476,0 -91.4062,40.90039 -91.4062,91.37499 0,50.5033 40.9302,91.43741 91.4062,91.43741 50.4761,0 91.4063,-40.93421 91.4063,-91.43741 0,-50.4746 -40.9301,-91.37499 -91.4063,-91.37499 z",
switchCameraIcon:"m 154.04329,54.013227 c -4.4925,0 -10.10792,0.306543 -16.84556,0.942623 -6.59033,0.616918 -10.10905,1.168675 -10.55809,1.639993 -0.44463,0.475136 -1.05093,4.996999 -1.79686,13.585515 -0.74593,8.588497 -1.27507,15.458852 -1.57269,20.61179 -0.45564,7.027823 -0.83045,11.166502 -1.12074,12.415652 -0.29395,2.03085 -1.57271,4.29541 -3.8197,6.79219 -2.24514,2.49831 -3.96739,4.21645 -5.1653,5.15408 -0.14703,0.15306 -2.32231,1.3258 -6.51351,3.51373 H 83.288459 c -2.546458,-2.65539 -6.814445,-3.98388 -12.803586,-3.98388 -5.991713,0 -10.259332,1.32961 -12.805056,3.98388 h -2.245146 c -2.094492,0 -3.893916,0.77786 -5.391295,2.3412 -1.499214,1.55955 -2.245146,3.51375 -2.245146,5.85572 v 94.16469 c 0,2.3412 0.745932,4.2954 2.245146,5.85684 1.499215,1.55953 3.296069,2.34122 5.391295,2.34122 h 55.258909 c 11.97976,9.83842 25.53294,14.75686 40.65699,14.75686 15.27547,0 28.82755,-4.91844 40.65922,-14.75686 h 42.22898 c 2.09451,0 3.89429,-0.77784 5.39167,-2.34122 1.49922,-1.55951 2.24514,-3.51371 2.24514,-5.85684 v -94.16469 c 0,-2.34122 -0.74592,-4.29504 -2.24514,-5.85572 -1.49923,-1.56334 -3.29608,-2.3412 -5.39167,-2.3412 h -37.5127 c -2.99475,-1.40624 -4.86767,-2.42166 -5.61434,-3.04625 -3.44671,-3.12287 -6.06593,-7.4953 -7.86279,-13.11765 -0.74593,-2.965787 -1.34857,-7.574237 -1.79686,-13.821513 -0.29393,-4.214179 -0.90393,-10.539263 -1.79684,-18.971036 -0.90393,-8.588507 -1.57271,-13.11728 -2.02101,-13.586675 -0.29395,-0.306524 -3.29239,-0.693538 -8.98352,-1.168674 -5.69259,-0.616916 -10.55735,-0.942622 -14.60154,-0.942622 z m -22.91226,4.452135 h 42.45532 c 1.34855,0 2.02101,0.69354 2.02101,2.107463 v 12.650183 c 0,1.40626 -0.66509,2.107452 -2.02101,2.107452 h -42.45532 c -1.34854,0 -2.02099,-0.693539 -2.02099,-2.107452 V 60.572825 c 0,-1.406259 0.6651,-2.107463 2.02099,-2.107463 z m 19.99283,30.449084 h 1.5727 c 6.13908,0 10.48129,1.406259 13.02738,4.218758 1.4992,1.716616 2.02099,4.683568 1.5727,8.898876 h -29.87515 l -0.22048,-1.40626 c 0,-1.095887 0.14685,-2.421666 0.45564,-3.981977 0.29398,-1.563346 0.81945,-2.732038 1.56905,-3.513711 2.24514,-2.345019 6.21511,-3.747442 11.90625,-4.218759 z m 0.6651,24.361164 c 16.47336,0 30.5509,6.09135 42.23118,18.27251 11.83058,12.17962 17.74585,26.93649 17.74585,44.27177 0,17.177 -5.91527,31.85494 -17.74585,44.03572 -11.68028,12.18 -25.75782,18.27057 -42.23118,18.27057 -10.78221,0 -20.81446,-2.80866 -30.10004,-8.43294 -9.13418,-5.46636 -16.39654,-12.96167 -21.789315,-22.48665 -5.24027,-9.68209 -7.86058,-20.14548 -7.86058,-31.3867 0,-17.33528 5.84032,-32.09215 17.520595,-44.27177 11.68027,-12.18116 25.75784,-18.27251 42.22934,-18.27251 z m -81.090227,4.9192 c 2.844097,0 5.241004,0.47514 7.186676,1.40626 1.947508,0.93878 2.921264,2.10747 2.921264,3.51371 0,1.24534 -0.973756,2.42168 -2.921264,3.51375 -1.947509,0.9426 -4.34221,1.40624 -7.186676,1.40624 -2.844099,0 -5.241373,-0.46364 -7.188882,-1.40624 -1.943835,-1.09588 -2.91759,-2.26457 -2.91759,-3.51375 0,-1.40242 0.962732,-2.57493 2.91759,-3.51371 1.947509,-0.94259 4.343313,-1.40626 7.188882,-1.40626 z m 81.315097,7.02708 c -13.32682,0 -24.78406,4.92033 -34.36728,14.75877 -9.43401,9.8365 -14.1514,21.78279 -14.1514,35.83923 0,13.89585 4.71739,25.8433 14.1514,35.83651 9.58322,9.8388 21.04046,14.75688 34.36728,14.75688 13.4775,0 24.93363,-4.91808 34.36839,-14.75688 9.58431,-9.99321 14.37666,-21.94066 14.37666,-35.83651 0,-14.05644 -4.79235,-26.00273 -14.37666,-35.83923 -9.43476,-9.83844 -20.89089,-14.75877 -34.36839,-14.75877 z M 33.937845,208.08135 c -6.883896,2.57494 -12.815714,5.45032 -17.684854,8.69889 -7.6801674,5.12265 -13.4804384,11.78072 -13.4804384,20.31099 0,8.53025 5.800271,15.18835 13.4804384,20.31218 7.680536,5.12151 17.993883,9.31614 30.540984,12.85669 21.82974,6.15763 50.39492,10.17486 82.180095,11.11709 v 12.94329 l 10.13294,-4.61879 12.14032,-5.5346 6.08542,-2.77038 c 32.01851,-0.91962 60.79865,-4.93875 82.75883,-11.13545 12.54821,-3.54054 22.86155,-7.73518 30.54173,-12.85672 7.68052,-5.12384 13.47969,-11.78189 13.47969,-20.31216 0,-8.53027 -5.79917,-15.18831 -13.47969,-20.31102 -4.09603,-2.73203 -8.94862,-5.20158 -14.48322,-7.44854 l 0.14685,14.40741 c 2.90289,1.37178 5.42803,2.76653 7.51738,4.16013 5.91638,3.9452 7.63495,7.25623 7.63495,9.19202 0,1.93887 -1.71965,5.24683 -7.63495,9.19201 -5.91603,3.94594 -15.26994,7.91605 -27.03546,11.23471 -19.82087,5.59208 -46.4933,9.47403 -76.31041,10.55881 l -9.22127,-4.20116 -22.27361,-10.14572 v 14.43119 C 98.125765,267.21194 70.490977,263.27098 50.105703,257.5191 38.342747,254.20082 28.988825,250.23033 23.071336,246.28439 c -5.916386,-3.94518 -7.635707,-7.25504 -7.635707,-9.19201 0,-1.93504 1.71969,-5.24682 7.635707,-9.19202 2.858798,-1.9082 6.523053,-3.81641 10.865997,-5.65683 z",
threeDButtonBg:"m 499.97967,186.68633 c -115.50182,40.70015 -214.281,95.35317 -315.95202,182.82631 -23.25985,122.00415 -23.79333,243.97944 0.01,365.65531 97.1293,83.88866 196.3589,141.22894 315.95873,182.86918 C 621.43117,877.31528 732.48144,808.92034 815.96254,735.22889 839.42388,613.96244 840.41248,491.61108 815.98164,369.57626 716.97111,283.42978 616.22096,227.32368 499.97967,186.68633 z",threeDButtonBlur:"m 500.00553,115.07312 c -138.14,48.6777 -256.27973,114.04312 -377.8782,218.66162 -27.818653,145.91785 -28.456655,291.8012 0.0125,437.32646 C 238.30628,871.39264 356.98476,939.97202 500.02595,989.774 645.26174,941.07032 778.07767,859.26957 877.92093,771.13403 905.98065,626.09846 907.16301,479.76535 877.94372,333.81084 759.52691,230.77902 639.02992,163.67571 500.00553,115.07312 z",
threeDButtonTxt:"m 267.75,403.40348 0,46.27164 110.40625,0 -70.75,80.88751 0.0312,36.84375 -0.0312,0.0937 0,0.0937 c 38.99724,-6.53364 104.47285,-3.57309 105.25,48.625 -2.5699,69.0295 -104.21608,52.29763 -139.71875,21.96875 l -21.78125,41.375 c 72.76674,54.04034 210.59667,44.40169 210.03125,-66.3874 0,-69.74333 -55.92243,-85.93557 -88.8125,-87.95635 l 0,-0.0312 73.6875,-82.37501 0,-39.40909 z m 260.9375,1.50287 0,304.125 64,0 C 688.17688,709.00585 762.5,664.76168 762.5,555.875 762.5,434.32703 666.06955,404.94477 592.6875,404.90625 z m 51.21875,47.375 0.0312,0 c 72.84836,-4.3683 129.63881,19.26021 130.65625,104.6875 -2.0558,90.56186 -64.56714,107.71707 -130.7187,104.21875 l -0.0312,0 c -0.0788,-69.8685 0.0625,-139.32779 0.0625,-208.90625 z",
tooltipBottomLeft:"m 466.71429,1004.5051 c -96.615,-1.0212 -212.2675,-4.2312 -296.8787,-7.90065 -5.0782,-0.095 -24.1877,34.83305 -31.5811,34.16025 -8.4162,-0.7659 -22.1738,-36.77841 -28.082,-37.13441 -15.982704,-0.93668 -29.263604,-1.87347 -39.088004,-2.78436 l -6.7211,-0.62318 -1.0938,-4.1722 c -11.1525,-42.5381 -12.644,-130.60083 -3.0305,-178.92853 1.1052,-5.5558 2.4421,-11.7435 2.9709,-13.7504 l 0.9615,-3.6489 7.3221,-0.6329 c 12.3938,-1.0714 55.232304,-3.5885 88.134404,-5.1786 254.5834,-12.3038 642.3527,-12.3015 886.40881,0.01 29.3695,1.4809 68.2714,3.9145 82.5786,5.1659 l 7.3221,0.6404 0.954,3.6488 c 11.4211,43.683 12.6798,132.80623 2.5555,180.93063 -3.3804,16.068 -3.4145,16.1611 -5.8972,16.1711 -1.1853,0.01 -7.1553,0.43788 -13.2668,0.96267 -25.5952,2.19767 -86.4242,5.44693 -142.43151,7.6081 -141.9407,5.47738 -324.7828,7.43088 -511.1372,5.46108 l 0,0 z",
tooltipBottomLeftCorner:"m 482.14293,771.83174 c -146.0182,1.5434 -335.5207,8.086 -395.629868,13.6591 l -6.7211,0.6232 -1.0938,4.1722 c -7.394,28.20253 -5.4148,107.52866 -3.8949,150.90606 0.11,1.9579 -38.4003,87.8578 -36.4637,92.3853 -2.2235,4.2519 83.037968,-46.7534 83.113368,-45.2708 36.129,3.4927 26.2666,2.8236 53.6037,4.1189 254.5834,12.3038 642.3527,12.3015 886.40897,-0.01 29.3695,-1.4809 68.2714,-3.9145 82.5786,-5.1659 l 7.3221,-0.6404 0.954,-3.6488 c 11.4211,-43.683 12.6798,-132.8063 2.5555,-180.93076 -3.3804,-16.068 -3.4145,-16.1611 -5.8972,-16.1711 -1.1853,-0.01 -7.1553,-0.4379 -13.2668,-0.9627 -25.5952,-2.1976 -86.4242,-5.4469 -142.43167,-7.6081 -141.9407,-5.4773 -324.7828,-7.4308 -511.1372,-5.461 l 0,0 z",
tooltipBottomMiddle:"M 466.63095,999.63665 C 320.61275,998.09327 131.11026,991.55067 71.00116,985.97757 l -6.7211,-0.6232 -1.0938,-4.1722 c -11.1525,-42.5381 -12.644,-130.6009 -3.0305,-178.9287 1.1052,-5.5558 2.4421,-11.7435 2.9709,-13.7504 l 0.9615,-3.6489 7.3221,-0.6329 c 12.3938,-1.0714 55.2323,-3.5885 88.13439,-5.1786 254.5834,-12.3038 642.3527,-12.3015 886.40885,0.01 29.3695,1.4809 68.2714,3.9145 82.5786,5.1659 l 7.3221,0.6404 0.954,3.6488 c 11.4211,43.6831 12.6798,132.8064 2.5555,180.9308 -3.3804,16.068 -3.4145,16.1611 -5.8972,16.1711 -1.1853,0.01 -7.1553,0.4379 -13.2668,0.9627 -25.5952,2.1976 -86.4242,5.4468 -142.43155,7.6081 -100.2407,3.8681 -220.8807,5.97873 -348.7506,6.19123 -4.1263,0.1949 -23.1168,35.2001 -29.287,35.3725 -6.5151,-0.1846 -25.7441,-35.3802 -29.6457,-35.4081 -34.2022,-0.097 -68.7672,-0.3281 -103.4539,-0.69465 l 0,0 z",
tooltipBottomRight:"m 733.47268,1004.5051 c 96.615,-1.0212 212.2675,-4.2312 296.87872,-7.90065 5.0782,-0.095 24.1877,34.83305 31.5811,34.16025 8.4162,-0.7659 22.1738,-36.77841 28.082,-37.13441 15.9827,-0.93668 29.2636,-1.87347 39.088,-2.78436 l 6.7211,-0.62318 1.0938,-4.1722 c 11.1525,-42.5381 12.644,-130.60083 3.0305,-178.92853 -1.1052,-5.5558 -2.4421,-11.7435 -2.9709,-13.7504 l -0.9615,-3.6489 -7.3221,-0.6329 c -12.3938,-1.0714 -55.2323,-3.5885 -88.1344,-5.1786 -254.58342,-12.3038 -642.35272,-12.3015 -886.40883,0.01 -29.3695,1.4809 -68.271396,3.9145 -82.578596,5.1659 l -7.3221,0.6404 -0.954,3.6488 c -11.4211,43.683 -12.6798,132.80623 -2.5555,180.93063 3.3804,16.068 3.4145,16.1611 5.8972,16.1711 1.1853,0.01 7.1553,0.43788 13.2668,0.96267 25.595196,2.19767 86.424196,5.44693 142.431506,7.6081 141.9407,5.47738 324.7828,7.43088 511.1372,5.46108 l 0,0 z",
tooltipBottomRightCorner:"m 717.86674,771.83174 c 146.0182,1.5434 335.52066,8.086 395.62986,13.6591 l 6.7211,0.6232 1.0938,4.1722 c 7.394,28.20253 5.4148,107.52866 3.8949,150.90606 -0.11,1.9579 38.4003,87.8578 36.4637,92.3853 2.2235,4.2519 -83.038,-46.7534 -83.1134,-45.2708 -36.129,3.4927 -26.2666,2.8236 -53.6037,4.1189 -254.58336,12.3038 -642.35266,12.3015 -886.40893,-0.01 -29.3695,-1.4809 -68.271404,-3.9145 -82.578604,-5.1659 l -7.3221,-0.6404 -0.954,-3.6488 c -11.4211,-43.683 -12.6798,-132.8063 -2.5555,-180.93076 3.3804,-16.068 3.4145,-16.1611 5.8972,-16.1711 1.1853,-0.01 7.1553,-0.4379 13.2668,-0.9627 25.5952,-2.1976 86.424204,-5.4469 142.431674,-7.6081 141.9407,-5.4773 324.7828,-7.4308 511.1372,-5.461 l 0,0 z",
tooltipLeftBottom:"m 483.57139,789.00981 c -146.0182,1.5434 -335.5207,8.086 -395.629764,13.6591 l -6.7211,0.6232 -1.0938,4.17219 c -7.394,28.20247 -10.5414,76.41585 -9.0215,119.79325 0.11,1.9579 -34.6879,27.9305 -32.7513,32.458 -2.2235,4.2519 38.6669,25.1947 38.7423,26.6773 1.1052,5.5558 2.4421,11.7435 2.9709,13.75045 l 0.9615,3.6489 7.3221,0.6329 c 12.393764,1.0714 55.232264,3.5885 88.134364,5.1786 254.5834,12.3038 642.3527,12.3015 886.40871,-0.01 29.3695,-1.4809 68.2714,-3.9145 82.5786,-5.1659 l 7.3221,-0.6404 0.954,-3.6488 c 11.4211,-43.68305 12.6798,-132.80635 2.5555,-180.93073 -3.3804,-16.06796 -3.4145,-16.16106 -5.8972,-16.17106 -1.1853,-0.01 -7.1553,-0.4379 -13.2668,-0.9627 -25.5952,-2.1976 -86.4242,-5.4469 -142.43142,-7.6081 -141.94069,-5.4773 -324.78279,-7.4308 -511.13719,-5.461 l 0,0 z",
tooltipLeftMiddle:"m 483.93482,1016.9189 c -146.0182,-1.544 -335.521,-8.086 -395.629995,-13.659 l -6.721,-0.624 -1.094,-4.17183 c -4.432,-16.90408 -7.338,-40.99908 -8.628,-66.93108 -0.141,-5.02 -37.541,-23.707 -35.23,-29.503 -2.153,-5.071 35.193,-25.826 35.077,-29.339 0.903,-19.814 2.805,-38.349 5.751,-53.155 1.105,-5.556 2.442,-11.744 2.971,-13.751 l 0.961,-3.649 7.322,-0.633 c 12.393995,-1.071 55.232995,-3.588 88.134685,-5.178 254.58341,-12.304 642.35271,-12.302 886.40869,0.01 29.3695,1.481 68.2713,3.914 82.5785,5.166 l 7.3221,0.64 0.954,3.649 c 11.4211,43.683 12.6798,132.806 2.5555,180.931 -3.3804,16.06791 -3.4145,16.16091 -5.8972,16.17091 -1.1853,0.01 -7.1553,0.438 -13.2668,0.962 -25.5952,2.198 -86.4241,5.447 -142.43118,7.608 -141.9408,5.478 -324.7829,7.431 -511.1373,5.461 l 0,0 z",
tooltipLeftTop:"m 483.57139,1018.0764 c -146.0182,-1.5434 -335.5207,-8.086 -395.629764,-13.6591 l -6.7211,-0.6232 -1.0938,-4.17219 c -7.394,-28.20247 -10.5414,-76.41585 -9.0215,-119.79325 0.11,-1.9579 -34.6879,-27.9305 -32.7513,-32.458 -2.2235,-4.2519 38.6669,-25.1947 38.7423,-26.6773 1.1052,-5.5558 2.4421,-11.7435 2.9709,-13.7504 l 0.9615,-3.6489 7.3221,-0.6329 c 12.393764,-1.0714 55.232264,-3.5885 88.134364,-5.1786 254.5834,-12.3038 642.3527,-12.3015 886.40871,0.01 29.3695,1.4809 68.2714,3.9145 82.5786,5.1659 l 7.3221,0.6404 0.954,3.6488 c 11.4211,43.683 12.6798,132.8063 2.5555,180.93068 -3.3804,16.06796 -3.4145,16.16106 -5.8972,16.17106 -1.1853,0.01 -7.1553,0.4379 -13.2668,0.9627 -25.5952,2.1976 -86.4242,5.4469 -142.43142,7.6081 -141.94069,5.4773 -324.78279,7.4308 -511.13719,5.461 l 0,0 z",
tooltipRightBottom:"m 717.86401,789.00981 c 146.0182,1.5434 335.52069,8.086 395.62979,13.6591 l 6.7211,0.6232 1.0938,4.17219 c 7.394,28.20247 10.5414,76.41585 9.0215,119.79325 -0.11,1.9579 34.6879,27.9305 32.7513,32.458 2.2235,4.2519 -38.6669,25.1947 -38.7423,26.6773 -1.1052,5.5558 -2.4421,11.7435 -2.9709,13.75045 l -0.9615,3.6489 -7.3221,0.6329 c -12.3938,1.0714 -55.2323,3.5885 -88.1344,5.1786 -254.58339,12.3038 -642.35269,12.3015 -886.4087,-0.01 -29.3695,-1.4809 -68.271402,-3.9145 -82.578602,-5.1659 l -7.3221,-0.6404 -0.954,-3.6488 c -11.4211,-43.68305 -12.6798,-132.80635 -2.5555,-180.93073 3.3804,-16.06796 3.4145,-16.16106 5.8972,-16.17106 1.1853,-0.01 7.1553,-0.4379 13.2668,-0.9627 25.5952,-2.1976 86.424202,-5.4469 142.431422,-7.6081 141.94069,-5.4773 324.78279,-7.4308 511.13719,-5.461 l 0,0 z",
tooltipRightMiddle:"m 716.12643,1016.9189 c 146.0182,-1.544 335.52097,-8.086 395.62997,-13.659 l 6.721,-0.624 1.094,-4.17183 c 4.432,-16.90408 7.338,-40.99908 8.628,-66.93108 0.141,-5.02 37.541,-23.707 35.23,-29.503 2.153,-5.071 -35.193,-25.826 -35.077,-29.339 -0.903,-19.814 -2.805,-38.349 -5.751,-53.155 -1.105,-5.556 -2.442,-11.744 -2.971,-13.751 l -0.961,-3.649 -7.322,-0.633 c -12.394,-1.071 -55.233,-3.588 -88.1347,-5.178 -254.58337,-12.304 -642.35267,-12.302 -886.40865,0.01 -29.3695,1.481 -68.271301,3.914 -82.578501,5.166 l -7.3221,0.64 -0.954,3.649 c -11.4211,43.683 -12.6798,132.806 -2.5555,180.931 3.3804,16.06791 3.4145,16.16091 5.8972,16.17091 1.1853,0.01 7.1553,0.438 13.2668,0.962 25.5952,2.198 86.424101,5.447 142.431181,7.608 141.9408,5.478 324.7829,7.431 511.1373,5.461 l 0,0 z",
tooltipRightTop:"m 720,1022.3574 c 146.0182,-1.5434 335.5207,-8.086 395.6298,-13.6591 l 6.7211,-0.6232 1.0938,-4.1722 c 7.394,-28.20243 10.5414,-76.41581 9.0215,-119.79321 -0.11,-1.9579 34.6879,-27.9305 32.7513,-32.458 2.2235,-4.2519 -38.6669,-25.1947 -38.7423,-26.6773 -1.1052,-5.5558 -2.4421,-11.7435 -2.9709,-13.75045 l -0.9615,-3.6489 -7.3221,-0.6329 c -12.3938,-1.0714 -55.2323,-3.5885 -88.1344,-5.1786 -254.5834,-12.3038 -642.3527,-12.3015 -886.40871,0.01 -29.3695,1.4809 -68.271402,3.9145 -82.578602,5.1659 l -7.3221,0.6404 -0.954,3.6488 c -11.4211,43.68305 -12.6798,132.80635 -2.5555,180.93073 3.3804,16.06793 3.4145,16.16103 5.8972,16.17103 1.1853,0.01 7.1553,0.4379 13.2668,0.9627 25.5952,2.1976 86.424202,5.4469 142.431422,7.6081 141.94069,5.4773 324.78279,7.4308 511.13719,5.461 l 0,0 z",
tooltipTopLeft:"m 466.71431,800.95468 c -96.615,1.0212 -212.2675,4.2312 -296.87872,7.90065 -5.0782,0.095 -24.1877,-34.83305 -31.5811,-34.16025 -8.4162,0.7659 -22.1738,36.77841 -28.082,37.13441 -15.982704,0.93668 -29.263604,1.87347 -39.088004,2.78436 l -6.7211,0.62318 -1.0938,4.1722 c -11.1525,42.5381 -12.644,130.60083 -3.0305,178.92853 1.1052,5.55584 2.4421,11.74354 2.9709,13.75044 l 0.9615,3.6489 7.3221,0.6329 c 12.3938,1.0714 55.232304,3.5885 88.134404,5.1786 254.58342,12.3038 642.35272,12.3015 886.40881,-0.01 29.3695,-1.4809 68.2714,-3.9145 82.5786,-5.1659 l 7.3221,-0.6404 0.954,-3.6488 c 11.4211,-43.68304 12.6798,-132.80627 2.5555,-180.93067 -3.3804,-16.068 -3.4145,-16.1611 -5.8972,-16.1711 -1.1853,-0.01 -7.1553,-0.43788 -13.2668,-0.96267 -25.5952,-2.19767 -86.4242,-5.44693 -142.43149,-7.6081 -141.9407,-5.47738 -324.7828,-7.43088 -511.1372,-5.46108 l 0,0 z",
tooltipTopLeftCorner:"m 482.14293,1033.0765 c -146.0182,-1.5434 -335.5207,-8.086 -395.629868,-13.6591 l -6.7211,-0.6232 -1.0938,-4.1722 c -7.394,-28.20253 -5.4148,-107.52866 -3.8949,-150.90606 0.11,-1.9579 -38.4003,-87.8578 -36.4637,-92.3853 -2.2235,-4.2519 83.037968,46.7534 83.113368,45.2708 36.129,-3.4927 26.2666,-2.8236 53.6037,-4.1189 254.5834,-12.3038 642.3527,-12.3015 886.40897,0.01 29.3695,1.4809 68.2714,3.9145 82.5786,5.1659 l 7.3221,0.6404 0.954,3.6488 c 11.4211,43.683 12.6798,132.8063 2.5555,180.93076 -3.3804,16.068 -3.4145,16.1611 -5.8972,16.1711 -1.1853,0.01 -7.1553,0.4379 -13.2668,0.9627 -25.5952,2.1976 -86.4242,5.4469 -142.43167,7.6081 -141.9407,5.4773 -324.7828,7.4308 -511.1372,5.461 l 0,0 z",
tooltipTopMiddle:"m 466.63095,805.92448 c -146.0182,1.54338 -335.52069,8.08598 -395.62979,13.65908 l -6.7211,0.6232 -1.0938,4.1722 c -11.1525,42.5381 -12.644,130.6009 -3.0305,178.92874 1.1052,5.5558 2.4421,11.7435 2.9709,13.7504 l 0.9615,3.6489 7.3221,0.6329 c 12.3938,1.0714 55.2323,3.5885 88.13439,5.1786 254.5834,12.3038 642.3527,12.3015 886.40885,-0.01 29.3695,-1.4809 68.2714,-3.9145 82.5786,-5.1659 l 7.3221,-0.6404 0.954,-3.6488 c 11.4211,-43.68314 12.6798,-132.80644 2.5555,-180.93084 -3.3804,-16.068 -3.4145,-16.1611 -5.8972,-16.1711 -1.1853,-0.01 -7.1553,-0.4379 -13.2668,-0.9627 -25.5952,-2.1976 -86.4242,-5.4468 -142.43155,-7.6081 -100.2407,-3.8681 -220.8807,-5.97873 -348.7506,-6.19123 -4.1263,-0.1949 -23.1168,-35.2001 -29.287,-35.3725 -6.5151,0.1846 -25.7441,35.3802 -29.6457,35.4081 -34.2022,0.097 -68.7672,0.3281 -103.4539,0.69465 l 0,0 z",
tooltipTopRight:"m 733.47268,800.95468 c 96.615,1.0212 212.2675,4.2312 296.87872,7.90065 5.0782,0.095 24.1877,-34.83305 31.5811,-34.16025 8.4162,0.7659 22.1738,36.77841 28.082,37.13441 15.9827,0.93668 29.2636,1.87347 39.088,2.78436 l 6.7211,0.62318 1.0938,4.1722 c 11.1525,42.5381 12.644,130.60083 3.0305,178.92853 -1.1052,5.55584 -2.4421,11.74354 -2.9709,13.75044 l -0.9615,3.6489 -7.3221,0.6329 c -12.3938,1.0714 -55.2323,3.5885 -88.1344,5.1786 -254.58342,12.3038 -642.35272,12.3015 -886.40883,-0.01 -29.3695,-1.4809 -68.271396,-3.9145 -82.578596,-5.1659 l -7.3221,-0.6404 -0.954,-3.6488 c -11.4211,-43.68304 -12.6798,-132.80627 -2.5555,-180.93067 3.3804,-16.068 3.4145,-16.1611 5.8972,-16.1711 1.1853,-0.01 7.1553,-0.43788 13.2668,-0.96267 25.595196,-2.19767 86.424196,-5.44693 142.431506,-7.6081 141.9407,-5.47738 324.7828,-7.43088 511.1372,-5.46108 l 0,0 z",
tooltipTopRightCorner:"m 717.86674,1033.0765 c 146.0182,-1.5434 335.52066,-8.086 395.62986,-13.6591 l 6.7211,-0.6232 1.0938,-4.1722 c 7.394,-28.20253 5.4148,-107.52866 3.8949,-150.90606 -0.11,-1.9579 38.4003,-87.8578 36.4637,-92.3853 2.2235,-4.2519 -83.038,46.7534 -83.1134,45.2708 -36.129,-3.4927 -26.2666,-2.8236 -53.6037,-4.1189 -254.58336,-12.3038 -642.35266,-12.3015 -886.40893,0.01 -29.3695,1.4809 -68.271404,3.9145 -82.578604,5.1659 l -7.3221,0.6404 -0.954,3.6488 c -11.4211,43.683 -12.6798,132.8063 -2.5555,180.93076 3.3804,16.068 3.4145,16.1611 5.8972,16.1711 1.1853,0.01 7.1553,0.4379 13.2668,0.9627 25.5952,2.1976 86.424204,5.4469 142.431674,7.6081 141.9407,5.4773 324.7828,7.4308 511.1372,5.461 l 0,0 z",
topBg:"m 919.98976,61.665394 c 0,0 -396.7797,-85.2542 -840.000007,0 0,0 -82.8396251,284.501376 -79.38782492,839.999966 0,0 539.99995192,0 1000.00047192,0 0,0 5.5515,-381.38787 -80.61264,-839.999966 z",topBottomIcon:"m 687.8112,317.97249 c 0,0 -112.5553,47.9265 -165.1562,78.25001 -52.6115,30.31119 -150.25,103.99999 -150.25,103.99999 0,0 98.0189,73.6897 150.625,104.00001 52.6061,30.3244 164.9687,78.0625 164.9688,78.0625 0,0 6.5935,-55.3655 10.9062,-110.03121 l 172.9062,0 c 2.7346,0 5.105,-2.625 6.3438,-6.5 0.5633,-1.7638 0.9085,-3.7992 0.9375,-5.9376 l 0,-119.4687 c -0.055,-6.9939 -3.2113,-12.4793 -7.1875,-12.5 l -173.0312,0 c -4.3597,-54.596 -11.0625,-109.875 -11.0626,-109.875 z m -473.375,91.03131 c -50.476,0 -91.4062,40.90039 -91.4062,91.37499 0,50.5033 40.9302,91.43741 91.4062,91.43741 50.4761,0 91.4063,-40.93421 91.4063,-91.43741 0,-50.4746 -40.9301,-91.37499 -91.4063,-91.37499 z",
touchMove:"m 27.650076,11.12463 c -1.65435,0 -2.646964,1.12487 -2.713133,4.03657 l -0.463224,27.9861 -0.661736,-0.3308 0,-6.9483 c 0,-1.3897 -2.117574,-1.125 -2.911668,-0.9264 -1.191134,0.3308 -1.786701,2.4484 -2.382275,4.3013 -0.264696,0.9264 -0.39704,1.8529 -0.39704,2.7131 0.529391,7.8086 4.168977,16.0803 7.279159,21.1757 l 0.06618,0.7941 18.528758,0 c 0.132351,-0.5294 0.198526,-1.0588 0.397046,-1.5882 2.117573,-8.007 4.566017,-15.22 4.632187,-22.6315 0,-2.1176 -0.198521,-4.4998 -0.926432,-6.2204 -0.463223,-1.2573 -2.051404,-2.5146 -3.308708,-2.4484 -0.529398,0 -0.463222,0.5294 -0.463222,0.9264 l 0,5.4263 -0.727912,0.5956 0,-5.7572 c 0,-2.1176 -2.51462,-3.2425 -4.16897,-3.3087 -0.926445,0 -1.25731,0.5294 -1.25731,1.3235 l 0,6.0218 -0.727918,0.5956 0,-22.2536 c 0,-3.67797 -1.356535,-4.8165701 -2.981566,-4.8291701 -1.625025,-0.013 -2.96368,1.2622001 -2.841761,4.9289701 l 0,20.3671 -0.794087,0.5956 c 0,0 -0.132345,-13.5601 -0.397041,-20.5085 -0.06618,-2.9117 -1.124971,-4.03657 -2.713146,-4.03657 l -0.06618,0",
touchRotate:"m 27.611575,9.9140896 c -1.720061,0 -2.752103,1.1430004 -2.8209,4.1013104 l -0.481622,28.4348 -0.688021,-0.3362 0,-7.0597 c 0,-1.4119 -2.201685,-1.143 -3.02732,-0.9413 -1.238447,0.3362 -1.85767,2.4877 -2.476901,4.3703 -0.275209,0.9413 -0.412811,1.8826 -0.412811,2.7566 0.55042,7.9338 4.334571,16.3382 7.56829,21.5153 l 0.0688,0.8068 19.264731,0 c 0.137608,-0.5379 0.206412,-1.0758 0.412818,-1.6137 2.201684,-8.1354 4.747381,-15.464 4.816179,-22.9943 0,-2.1516 -0.206406,-4.572 -0.963231,-6.3201 -0.481622,-1.2775 -2.132886,-2.555 -3.44013,-2.4877 -0.550427,0 -0.481622,0.5378 -0.481622,0.9412 l 0,5.5133 -0.756825,0.6051 0,-5.8494 c 0,-2.1515 -2.614502,-3.2945 -4.334564,-3.3618 -0.963244,0 -1.307252,0.5379 -1.307252,1.3447 l 0,6.1184 -0.756831,0.6051 0,-6.5218 c 0,-2.6221 -2.958516,-3.2945 -4.54097,-3.3617 -0.825629,0 -1.444859,0.5379 -1.513663,1.3447 l 0,0.9413 0,5.7822 -0.825629,0.6051 c 0,0 -0.137601,-13.7775 -0.412812,-20.8372 -0.06881,-2.95831 -1.169656,-4.1013104 -2.820913,-4.1013104 l -0.06881,0",
touchZoom:"m 27.957305,0.5315403 c -1.973183,0 -3.157097,1.34177 -3.236019,4.8145797 L 24.168789,38.7258 c 0,0 -0.539407,1.3577 -2.228778,-0.6826 -1.689364,-2.0403 -1.403567,-8.1571 -3.417264,-12.1001 -2.013697,-3.943 -3.718059,-3.2903 -4.665194,-3.0535 -1.420694,0.3946 -0.167676,5.8616 -0.398471,8.3875 -0.104567,1.1445 0.806069,5.1182 0.806069,6.1443 0.631418,9.3134 7.299038,19.063 11.008624,25.1405 l 0.07893,0.9471 22.09969,0 c 0.157859,-0.6314 0.236788,-1.2629 0.473568,-1.8943 2.525679,-9.5502 5.445997,-18.1533 5.524919,-26.9932 0,-2.5256 -0.236781,-5.367 -1.104978,-7.4191 -0.552497,-1.4997 -2.446758,-2.9993 -3.946374,-2.9204 -0.631426,0 -0.552497,0.6315 -0.552497,1.105 l 0,6.4721 -0.868197,0.7103 0,-6.8667 c 0,-2.5257 -2.999247,-3.8674 -4.97243,-3.9463 -1.104993,0 -1.499624,0.6314 -1.499624,1.5785 l 0,7.1824 -0.868205,0.7104 0,-7.656 c 0,-3.0782 -3.393885,-3.8675 -5.20921,-3.9464 -0.947127,0 -1.657482,0.6314 -1.736411,1.5786 l 0,1.1049 0,6.7878 -0.947127,0.7104 c 0,0 -0.15785,-16.1735 -0.473559,-24.46088 C 31.19333,1.8733103 29.930489,0.5315403 28.036235,0.5315403 l -0.07893,0",
trackBallIcon:"m 687.8112,317.97249 c 0,0 -112.5553,47.9265 -165.1562,78.25001 -52.6115,30.31119 -150.25,103.99999 -150.25,103.99999 0,0 98.0189,73.6897 150.625,104.00001 52.6061,30.3244 164.9687,78.0625 164.9688,78.0625 0,0 6.5935,-55.3655 10.9062,-110.03121 l 172.9062,0 c 2.7346,0 5.105,-2.625 6.3438,-6.5 0.5633,-1.7638 0.9085,-3.7992 0.9375,-5.9376 l 0,-119.4687 c -0.055,-6.9939 -3.2113,-12.4793 -7.1875,-12.5 l -173.0312,0 c -4.3597,-54.596 -11.0625,-109.875 -11.0626,-109.875 z m -473.375,91.03131 c -50.476,0 -91.4062,40.90039 -91.4062,91.37499 0,50.5033 40.9302,91.43741 91.4062,91.43741 50.4761,0 91.4063,-40.93421 91.4063,-91.43741 0,-50.4746 -40.9301,-91.37499 -91.4063,-91.37499 z",
triggerIcon:"M 500,230.93237 A 271.18652,271.18652 0 0 0 228.81323,502.11914 271.18652,271.18652 0 0 0 500,773.30591 271.18652,271.18652 0 0 0 771.18677,502.11914 271.18652,271.18652 0 0 0 500,230.93237 z m 0,68.65508 A 202.53172,202.53172 0 0 1 702.53169,502.11914 202.53172,202.53172 0 0 1 500,704.65083 202.53172,202.53172 0 0 1 297.46831,502.11914 202.53172,202.53172 0 0 1 500,299.58745 z m 0,75.52058 A 127.01142,127.01142 0 0 0 372.98889,502.11914 127.01142,127.01142 0 0 0 500,629.13025 127.01142,127.01142 0 0 0 627.01111,502.11914 127.01142,127.01142 0 0 0 500,375.10803 z",
twitterIcon:"m 633.30507,338.31078 c -29.82178,0 -55.62559,10.87203 -77.30702,32.56392 -20.79438,20.78655 -31.12632,46.10245 -31.12632,75.92684 0,10.84594 1.30453,21.66579 4.01798,32.51173 -45.18927,-2.71083 -88.10862,-14.42559 -128.78417,-35.21214 -39.76238,-20.78652 -73.21079,-48.83415 -100.31913,-84.0828 -12.65404,22.59724 -18.0809,42.92196 -16.25456,60.99766 1.82636,19.88381 6.78361,37.53162 14.92395,52.89649 9.02741,14.45952 15.81101,23.49477 20.32472,27.10833 4.5137,2.71345 8.14033,4.97031 10.85377,6.77839 l -20.37692,-1.3828 c -9.94059,-1.80027 -18.968,-5.37993 -27.10832,-10.8042 l 1.30453,12.17917 c 0.78272,8.13512 3.15698,17.64 6.75752,28.48595 3.62661,10.84594 7.67069,18.98626 12.18439,24.41053 20.79437,26.20821 42.05838,41.07476 63.76592,44.68834 l 0,1.3828 c -0.78273,0.91318 -3.18309,1.80026 -6.78361,2.7004 -3.62662,0.91317 -8.60998,1.38281 -14.92393,1.38281 -4.53982,0 -11.71477,-0.88709 -21.68146,-2.70039 l 4.04406,9.47878 c 1.82638,6.32703 5.89653,13.9951 12.23659,23.03296 6.31397,9.03784 13.98468,16.70594 23.01209,23.03295 27.13442,17.17296 47.45916,23.9983 61.00028,20.38475 l -6.78361,5.4008 c -4.5137,3.61617 -11.71478,8.60472 -21.65536,14.93175 -9.02741,5.42166 -18.52447,9.93798 -28.46505,13.55417 -30.73496,10.84594 -64.18338,15.36226 -100.34522,13.55417 50.61616,34.34592 107.12882,51.51888 169.48582,51.51888 84.95164,0 157.69279,-30.30184 218.24951,-90.85859 60.55675,-60.55413 90.82208,-133.77011 90.82208,-219.62971 0,-5.42428 -0.52182,-12.20006 -1.30454,-20.33257 11.74086,-9.04045 21.26399,-17.18078 28.49115,-24.41054 10.82769,-9.94059 19.88118,-21.23269 27.10834,-33.88674 l -27.10834,10.85378 c -6.34006,1.80027 -15.83713,3.17264 -28.49115,4.07538 l 21.65536,-23.03295 c 8.14032,-9.9406 14.95002,-21.70494 20.37691,-35.26171 l -35.24867,17.63215 c -7.22715,2.71084 -14.89785,5.39036 -23.03817,8.1012 -2.71345,0 -6.34006,0.46963 -10.85377,1.38281 -21.70755,-26.21081 -49.25943,-39.33969 -82.70784,-39.33969 z",
uvGridRendering:"m 687.8112,317.97249 c 0,0 -112.5553,47.9265 -165.1562,78.25001 -52.6115,30.31119 -150.25,103.99999 -150.25,103.99999 0,0 98.0189,73.6897 150.625,104.00001 52.6061,30.3244 164.9687,78.0625 164.9688,78.0625 0,0 6.5935,-55.3655 10.9062,-110.03121 l 172.9062,0 c 2.7346,0 5.105,-2.625 6.3438,-6.5 0.5633,-1.7638 0.9085,-3.7992 0.9375,-5.9376 l 0,-119.4687 c -0.055,-6.9939 -3.2113,-12.4793 -7.1875,-12.5 l -173.0312,0 c -4.3597,-54.596 -11.0625,-109.875 -11.0626,-109.875 z m -473.375,91.03131 c -50.476,0 -91.4062,40.90039 -91.4062,91.37499 0,50.5033 40.9302,91.43741 91.4062,91.43741 50.4761,0 91.4063,-40.93421 91.4063,-91.43741 0,-50.4746 -40.9301,-91.37499 -91.4063,-91.37499 z",
waterEffectIcon:"m 687.8112,317.97249 c 0,0 -112.5553,47.9265 -165.1562,78.25001 -52.6115,30.31119 -150.25,103.99999 -150.25,103.99999 0,0 98.0189,73.6897 150.625,104.00001 52.6061,30.3244 164.9687,78.0625 164.9688,78.0625 0,0 6.5935,-55.3655 10.9062,-110.03121 l 172.9062,0 c 2.7346,0 5.105,-2.625 6.3438,-6.5 0.5633,-1.7638 0.9085,-3.7992 0.9375,-5.9376 l 0,-119.4687 c -0.055,-6.9939 -3.2113,-12.4793 -7.1875,-12.5 l -173.0312,0 c -4.3597,-54.596 -11.0625,-109.875 -11.0626,-109.875 z m -473.375,91.03131 c -50.476,0 -91.4062,40.90039 -91.4062,91.37499 0,50.5033 40.9302,91.43741 91.4062,91.43741 50.4761,0 91.4063,-40.93421 91.4063,-91.43741 0,-50.4746 -40.9301,-91.37499 -91.4063,-91.37499 z",
wechatIcon:"m 774.88637,769.15334 c 43.4101,-31.47517 71.15382,-77.99005 71.15382,-129.71756 0,-94.73882 -92.20372,-171.56101 -205.91308,-171.56101 -113.70938,0 -205.91311,76.82219 -205.91311,171.56101 0,94.7673 92.20373,171.58949 205.91311,171.58949 23.49955,0 46.17306,-3.33266 67.22296,-9.39982 l 6.03868,-0.9115 c 3.95932,0 7.54835,1.22483 10.93798,3.16175 l 45.09066,26.03467 3.95932,1.2818 c 3.78841,0 6.86472,-3.07631 6.86472,-6.86473 l -1.11089,-5.01324 -9.28589,-34.60843 -0.7121,-4.38658 c 0,-4.61446 2.27874,-8.68772 5.75382,-11.16585 z M 409.51812,278.42561 c -136.46835,0 -247.1014,92.17524 -247.1014,205.91309 0,62.03883 33.26967,117.89657 85.36747,155.63828 4.18719,2.96237 6.92168,7.86167 6.92168,13.41611 l -0.85452,5.24112 -11.13737,41.53013 -1.33875,6.01018 c 0,4.5575 3.70295,8.26046 8.23196,8.26046 l 4.78536,-1.53816 54.0917,-31.24729 c 4.04478,-2.33572 8.34591,-3.78841 13.10279,-3.78841 l 7.26351,1.0824 c 25.23709,7.2635 52.4681,11.30826 80.66757,11.30826 l 13.55853,-0.3418 c -5.35506,-16.06515 -8.28894,-32.98483 -8.28894,-50.44572 0,-103.71138 100.89143,-187.79707 225.3394,-187.79707 l 13.4161,0.34183 C 634.94295,353.65268 532.76972,278.42561 409.51812,278.42561 Z m 161.9618,333.57978 c -15.15367,0 -27.4304,-12.30523 -27.4304,-27.45888 0,-15.18213 12.27673,-27.45887 27.4304,-27.45887 15.18213,0 27.45886,12.27674 27.45886,27.45887 0,15.15365 -12.27673,27.45888 -27.45886,27.45888 z m 137.29438,0 c -15.18215,0 -27.45889,-12.30523 -27.45889,-27.45888 0,-15.18213 12.27674,-27.45887 27.45889,-27.45887 15.15364,0 27.43038,12.27674 27.43038,27.45887 0,15.15365 -12.27674,27.45888 -27.43038,27.45888 z M 327.14149,451.38235 c -18.20148,0 -32.92787,-14.75488 -32.92787,-32.92786 0,-18.20147 14.72639,-32.95635 32.92787,-32.95635 18.20147,0 32.95634,14.75488 32.95634,32.95635 0,18.17298 -14.75487,32.92786 -32.95634,32.92786 z m 164.72476,0 c -18.20147,0 -32.92785,-14.75488 -32.92785,-32.92786 0,-18.20147 14.72638,-32.95635 32.92785,-32.95635 18.20147,0 32.95636,14.75488 32.95636,32.95635 0,18.17298 -14.75489,32.92786 -32.95636,32.92786 z",
whatsappIcon:"m 643.31375,606.45595 c -6.948,-3.47734 -41.108,-20.284 -47.47733,-22.60533 -6.368,-2.31867 -11,-3.476 -15.632,3.47733 -4.632,6.95467 -17.948,22.60666 -22.00133,27.244 -4.052,4.636 -8.10533,5.21866 -15.05333,1.73866 -6.948,-3.47733 -29.336,-10.81333 -55.87467,-34.48666 -20.65467,-18.424 -34.6,-41.176 -38.652,-48.132 -4.05333,-6.956 -0.43333,-10.716 3.04533,-14.18 3.12667,-3.11333 6.94934,-8.116 10.42267,-12.17333 3.47467,-4.056 4.632,-6.956 6.948,-11.59067 2.316,-4.63867 1.15867,-8.69467 -0.58,-12.17201 -1.736,-3.47732 -15.632,-37.67865 -21.42133,-51.59199 -5.64,-13.54666 -11.368,-11.712 -15.63333,-11.92666 -4.048,-0.20134 -8.68534,-0.244 -13.316,-0.244 -4.632,0 -12.16,1.73867 -18.52934,8.69333 -6.368,6.956 -24.31733,23.76667 -24.31733,57.964 0,34.20133 24.896,67.23866 28.37067,71.876 3.47466,4.63866 48.99333,74.81733 118.69466,104.91333 16.576,7.16 29.51866,11.43466 39.60933,14.636 16.644,5.28933 31.79067,4.54266 43.76267,2.75333 13.34933,-1.99333 41.108,-16.80667 46.89866,-33.036 5.78934,-16.23333 5.78934,-30.144 4.05199,-33.04133 -1.73599,-2.89867 -6.368,-4.63734 -13.31599,-8.116 M 516.53776,779.55594 h -0.0933 c -41.47333,-0.016 -82.15066,-11.15866 -117.63599,-32.216 l -8.44,-5.00933 -87.47467,22.94667 23.348,-85.288 -5.49466,-8.74532 c -23.136,-36.79735 -35.356,-79.32801 -35.33734,-123.00001 0.028,-70.60493 31.86994,-133.91704 81.94761,-176.34282 40.30454,-34.14601 92.42165,-54.7625 149.27235,-54.7625 61.73333,0.0213 119.76266,24.09333 163.40133,67.78132 43.63599,43.68534 67.65333,101.75467 67.62933,163.51067 -0.052,127.44133 -103.73333,231.12532 -231.12266,231.12532 M 713.24175,351.72396 c -52.5,-52.56133 -122.31866,-81.52 -196.70666,-81.55067 -153.27066,0 -278.01466,124.736 -278.07599,278.05333 -0.02,49.01066 12.784,96.84666 37.11866,139.01866 l -39.44933,144.09466 147.41066,-38.668 c 40.616,22.15334 86.34533,33.83067 132.88533,33.84534 h 0.11334 10e-4 c 153.25466,0 278.00933,-124.748 278.07199,-278.068 0.028,-74.30133 -28.86933,-144.16533 -81.36933,-196.72532",
wireFrameRendering:"m 687.8112,317.97249 c 0,0 -112.5553,47.9265 -165.1562,78.25001 -52.6115,30.31119 -150.25,103.99999 -150.25,103.99999 0,0 98.0189,73.6897 150.625,104.00001 52.6061,30.3244 164.9687,78.0625 164.9688,78.0625 0,0 6.5935,-55.3655 10.9062,-110.03121 l 172.9062,0 c 2.7346,0 5.105,-2.625 6.3438,-6.5 0.5633,-1.7638 0.9085,-3.7992 0.9375,-5.9376 l 0,-119.4687 c -0.055,-6.9939 -3.2113,-12.4793 -7.1875,-12.5 l -173.0312,0 c -4.3597,-54.596 -11.0625,-109.875 -11.0626,-109.875 z m -473.375,91.03131 c -50.476,0 -91.4062,40.90039 -91.4062,91.37499 0,50.5033 40.9302,91.43741 91.4062,91.43741 50.4761,0 91.4063,-40.93421 91.4063,-91.43741 0,-50.4746 -40.9301,-91.37499 -91.4063,-91.37499 z",
youtubeIcon:"m 149.9375,79.222656 c 0,0 -63.218849,5.9e-5 -79.085938,4.123047 -8.495787,2.373802 -15.491408,9.3695 -17.865234,17.990237 -4.122953,15.8671 -4.123047,48.72656 -4.123047,48.72656 0,0 9.4e-5,32.9842 4.123047,48.60156 2.373826,8.62062 9.244506,15.49138 17.865234,17.86524 15.99203,4.24788 79.085938,4.24804 79.085938,4.24804 0,0 63.34418,-5e-5 79.21094,-4.12304 8.62079,-2.37381 15.49133,-9.11966 17.74023,-17.86524 4.24793,-15.74232 4.24805,-48.60156 4.24805,-48.60156 0,0 0.12484,-32.98446 -4.24805,-48.85156 -2.2489,-8.620737 -9.11944,-15.491334 -17.74023,-17.740237 -15.86676,-4.372847 -79.21094,-4.373047 -79.21094,-4.373047 z m -20.11523,40.480464 52.59961,30.35938 -52.59961,30.23438 z",
zoomIcon:"m 393.042,289.23578 c -17.23712,1.99214 -34.13258,8.66459 -43.74179,20.55785 l -55.21493,85.80898 c -30.84575,5.29163 -57.49232,22.86932 -74.33728,47.80453 l -92.26433,123.33874 c -24.85059,30.45881 -39.678251,69.48394 -39.678251,111.86314 0,97.68583 79.191691,176.8797 176.879421,176.8797 79.71703,0 147.13047,-52.76316 169.23074,-125.25176 15.30169,12.16327 34.15443,19.7745 54.73681,21.51288 3.59605,0.38209 7.29934,0.46397 10.99555,0.46397 2.96346,0 5.94685,-0.27292 8.84399,-0.46397 20.58266,-1.74649 39.43565,-9.34961 54.73707,-21.51288 22.10027,72.4886 89.51372,125.25176 169.23074,125.25176 97.68746,0 176.87942,-79.19387 176.87942,-176.8797 0,-42.3792 -14.82766,-81.40433 -39.67853,-111.86314 L 777.39658,443.40714 c -16.8447,-24.93521 -43.49153,-42.5129 -74.33728,-47.80453 l -55.21493,-85.80898 c -9.60893,-11.89326 -26.50467,-18.53567 -43.74179,-20.55785 -30.92842,0 -55.21492,25.24355 -55.21492,56.16891 0.89512,18.46468 1.63195,37.8381 3.34605,61.43066 -10.22268,-6.22216 -21.5812,-10.59139 -33.70247,-12.90841 -3.27784,-0.65485 -6.6534,-1.11879 -10.03931,-1.44629 -3.08736,-0.27292 -6.15508,-0.46396 -9.32211,-0.46396 -0.39844,0 -0.79688,0 -1.19532,0 -3.16705,0 -6.23448,0.27293 -9.32211,0.46396 -3.46506,0.3275 -6.9263,0.76416 -10.27809,1.44629 -12.03451,2.34707 -23.30596,6.72442 -33.46372,12.90841 1.71386,-23.59256 2.4507,-42.96598 3.34635,-61.43066 0,-30.92536 -24.28676,-56.16891 -55.21493,-56.16891 z M 264.68484,544.75524 c 73.95139,0 133.8548,59.90233 133.8548,133.85378 0,73.95421 -59.90341,133.85637 -133.8548,133.85637 -73.95141,0 -133.85455,-59.90216 -133.85455,-133.85637 0,-73.95145 59.90314,-133.85378 133.85455,-133.85378 z m 467.7749,0 c 73.95141,0 133.85483,59.90233 133.85483,133.85378 0,73.95421 -59.90342,133.85637 -133.85483,133.85637 -73.95139,0 -133.8548,-59.90216 -133.8548,-133.85637 0,-73.95145 59.90341,-133.85378 133.8548,-133.85378 z m -233.76806,61.90824 c 23.93664,0 43.26394,19.32697 43.26394,43.26067 0,23.93907 -19.3273,43.26618 -43.26394,43.26618 -23.93636,0 -43.50272,-19.32711 -43.50272,-43.26618 0,-23.9337 19.56636,-43.26067 43.50272,-43.26067 z",
zoomInIcon:"M 496.875 233.9375 C 474.2134 233.91747 460.76724 235.05378 445.53125 238.28125 C 441.93249 239.04297 438.87556 239.7777 438.75 239.90625 C 438.33237 240.32598 435.19048 252.6955 433.25 261.59375 C 427.16427 289.45589 422.57223 320.70341 419.25 356.90625 C 418.21413 368.19997 417.39696 380.05958 416.71875 392.25 C 404.27512 393.02896 392.1875 393.94597 380.71875 395.09375 C 342.11533 398.95708 303.11345 405.8209 280.90625 412.625 L 276.71875 413.90625 L 275.46875 419.78125 C 273.41228 429.55393 272.36192 437.96872 271.15625 454.21875 C 270.65372 461.01388 271.38647 493.43084 272.21875 501.34375 C 273.23308 510.95171 276.14849 526.24178 277.15625 527.21875 C 278.05429 528.09168 287.41798 530.7655 299.15625 533.5 C 331.69402 541.07941 368.11632 545.94683 417.40625 549.25 C 418.15052 560.65239 419.03673 571.74971 420.09375 582.3125 C 423.95618 620.9189 430.78905 659.9172 437.59375 682.125 L 438.90625 686.34375 L 444.75 687.5625 C 454.52507 689.62047 462.97142 690.70148 479.21875 691.90625 C 486.01389 692.41028 518.39929 691.67872 526.3125 690.84375 C 535.92135 689.83031 551.24238 686.91341 552.21875 685.90625 C 553.09168 685.00701 555.7682 675.64453 558.5 663.90625 C 565.8806 632.23081 570.70242 596.85694 574 549.53125 C 594.98969 548.19855 609.49565 546.974 627.1875 545.03125 C 659.16917 541.51949 693.37399 535.61632 715.59375 529.8125 L 723.28125 527.8125 L 724.40625 523 C 727.81637 508.41423 729.0921 494.57024 729.125 471.90625 C 729.14383 449.24075 728.00902 435.76843 724.78125 420.53125 C 724.02102 416.93338 723.28181 413.87855 723.15625 413.75 C 722.73563 413.32968 710.36491 410.19258 701.46875 408.25 C 673.60063 402.16577 642.3591 397.57074 606.15625 394.25 C 596.07705 393.32548 585.52748 392.5771 574.71875 391.9375 C 573.31687 369.41071 572.05697 354.32871 570.03125 335.875 C 566.5174 303.89333 560.61541 269.65696 554.8125 247.4375 L 552.8125 239.78125 L 547.96875 238.625 C 533.38298 235.21727 519.54079 233.9704 496.875 233.9375 z ",
zoomInIconBot:"m 236.22035,479.1261 c 1.20477,-16.24733 2.26275,-24.68789 4.32072,-34.46296 l 1.23497,-5.86569 4.20563,-1.28758 c 22.2078,-6.8047 61.20702,-13.64707 99.81342,-17.5095 68.06494,-6.81128 156.70361,-7.14102 225.41727,-0.83856 36.20284,3.32223 67.44611,7.90693 95.30825,13.99266 8.89825,1.94048 21.27298,5.08065 21.69271,5.49828 0.12855,0.12556 0.85739,3.17784 1.61911,6.7766 3.22747,15.23599 4.36647,28.69801 4.34644,51.35961 -0.0329,22.66579 -1.29386,36.50778 -4.70159,51.09355 l -1.12854,4.83252 -7.68122,2.00686 c -22.21946,5.80291 -56.44774,11.68446 -88.42941,15.19831 -21.93934,2.40835 -38.39714,3.71147 -69.25177,5.48903 -17.25569,0.99221 -101.88814,0.9952 -119.99853,0 -59.99328,-3.28457 -101.88515,-8.42202 -138.78454,-17.01983 -11.73828,-2.7318 -21.08555,-5.40113 -21.98479,-6.27406 -1.00716,-0.97637 -3.9279,-16.28171 -4.94134,-25.89056 -0.83497,-7.91321 -1.56351,-40.30743 -1.05948,-47.10257 z M 473.8856,271.0569 c 16.25003,1.20567 24.69028,2.26425 34.46296,4.32072 l 5.86599,1.23407 1.28848,4.20802 c 6.8041,22.2072 13.64617,61.20702 17.5095,99.81044 6.81157,68.06194 7.14102,156.70361 0.83796,225.42025 -3.32074,36.20285 -7.90723,67.44312 -13.99146,95.31124 -1.94258,8.89616 -5.08066,21.27149 -5.50098,21.69211 -0.12855,0.12556 -3.17664,0.85709 -6.77451,1.61732 -15.23718,3.22777 -28.6971,4.36766 -51.3626,4.34883 -22.66399,-0.0329 -36.50777,-1.29356 -51.09354,-4.70368 l -4.83193,-1.12764 -2.00595,-7.68062 c -5.80382,-22.21976 -11.68626,-56.44774 -15.19802,-88.42941 -2.40894,-21.93725 -3.71386,-38.39415 -5.48962,-69.24878 -0.99341,-17.25539 -0.9964,-101.88814 0,-119.99853 3.28576,-59.99329 8.42321,-101.88515 17.01862,-138.78455 2.7345,-11.73827 5.40263,-21.08644 6.27556,-21.98448 0.97697,-1.00776 16.28201,-3.92821 25.88997,-4.94254 7.91291,-0.83228 40.30743,-1.56082 47.10256,-1.05829 z",
zoomOutIcon:"m 498.25,383.28125 c -25.57891,-3.7e-4 -51.2573,0.2518 -60.3125,0.75 -59.99329,3.28576 -101.88185,8.40459 -138.78125,17 -11.73827,2.7345 -21.10196,5.40832 -22,6.28125 -1.00776,0.97697 -3.92317,16.26704 -4.9375,25.875 -0.83228,7.91291 -1.56503,40.32987 -1.0625,47.125 1.20567,16.25003 2.25603,24.66482 4.3125,34.4375 l 1.25,5.875 4.1875,1.28125 c 22.2072,6.8041 61.20908,13.66792 99.8125,17.53125 68.06194,6.81157 156.72086,7.11556 225.4375,0.8125 36.20285,-3.32074 67.44438,-7.88452 95.3125,-13.96875 8.89616,-1.94258 21.26688,-5.07968 21.6875,-5.5 0.12556,-0.12855 0.86477,-3.18338 1.625,-6.78125 3.22777,-15.23718 4.36258,-28.7095 4.34375,-51.375 -0.0329,-22.66399 -1.30863,-36.50798 -4.71875,-51.09375 l -1.125,-4.8125 -7.6875,-2 C 693.37399,398.91493 659.16917,393.01176 627.1875,389.5 c -21.93725,-2.40894 -38.39537,-3.69299 -69.25,-5.46875 -8.6277,-0.49671 -34.10859,-0.74963 -59.6875,-0.75 z",
zoomOutIconBot:"m 469.53125,419.1875 c -39.25699,-0.14604 -78.61192,1.34877 -112.96875,4.5 -36.20284,3.32223 -67.45036,7.91427 -95.3125,14 -8.89825,1.94048 -21.26777,5.08237 -21.6875,5.5 -0.12855,0.12556 -0.86328,3.15124 -1.625,6.75 -3.22747,15.23599 -4.36378,28.7134 -4.34375,51.375 0.0329,22.66579 1.31102,36.50798 4.71875,51.09375 l 1.125,4.84375 7.6875,2 c 22.21946,5.80291 56.42458,11.67365 88.40625,15.1875 21.93934,2.40835 38.39537,3.72244 69.25,5.5 17.25569,0.99221 101.88961,0.9952 120,0 59.99328,-3.28457 101.91311,-8.43344 138.8125,-17.03125 11.73828,-2.7318 21.06951,-5.40832 21.96875,-6.28125 1.00716,-0.97637 3.92406,-16.26615 4.9375,-25.875 0.83497,-7.91321 1.56653,-40.29861 1.0625,-47.09375 -1.20477,-16.24733 -2.25453,-24.69368 -4.3125,-34.46875 l -1.25,-5.875 -4.1875,-1.28125 c -22.2078,-6.8047 -61.2061,-13.63757 -99.8125,-17.5 -34.03247,-3.40564 -73.21176,-5.19771 -112.46875,-5.34375 z",
touchTutorial:"m 6.476291,3.6785164 c -0.42843,0.003 -0.64541,0.33917 -0.65093,1.00804 l -0.0746,6.8821196 -0.15745,-0.0928 -0.0126,-1.7085496 c -0.001,-0.14629 -0.0957,-0.2292 -0.28399,-0.24871 -0.18833,-0.0299 -0.33455,-0.0184 -0.43866,0.0346 -0.0625,0.0214 -0.1249,0.0636 -0.18717,0.12678 -0.0519,0.0527 -0.10862,0.15235 -0.17023,0.2991 -0.0513,0.1362296 -0.0871,0.2253296 -0.10776,0.2672796 -0.0102,0.0419 -0.0458,0.16232 -0.10706,0.36133 -0.061,0.23036 -0.0907,0.45526 -0.0891,0.67471 0.0588,0.8774 0.26399,1.78506 0.61575,2.723 0.36217,0.92741 0.76535,1.75002 1.20955,2.46781 l 0.0171,0.18798 4.54567,-0.0335 0.10694,-0.377 c 0.0609,-0.2408 0.15745,-0.61773 0.28949,-1.13077 0.14252,-0.51312 0.24932,-0.91103 0.32039,-1.19371 0.071,-0.28268 0.14689,-0.62811 0.22748,-1.03626 0.091,-0.41869 0.15604,-0.80583 0.19521,-1.16144 0.0392,-0.35559 0.0575,-0.70582 0.0549,-1.05066 -0.005,-0.66879 -0.0818,-1.1802896 -0.23077,-1.5345096 -0.0639,-0.15628 -0.17987,-0.2965 -0.34797,-0.42066 -0.16813,-0.12418 -0.3253,-0.18049 -0.47151,-0.16896 -0.0731,5.4e-4 -0.10918,0.074 -0.1081,0.22025 l 0.01,1.3323596 -0.18695,0.15813 -0.0105,-1.4263996 c -0.002,-0.22989 -0.11281,-0.41718 -0.33333,-0.56186 -0.2206,-0.15512 -0.45112,-0.23702 -0.69154,-0.2457 -0.20899,0.002 -0.31268,0.11203 -0.31106,0.33147 l 0.011,1.4891 -0.17138,0.14235 -0.0117,-1.58315 c -0.002,-0.2717 -0.11842,-0.4694 -0.34924,-0.5931 -0.23082,-0.1237 -0.47693,-0.19503 -0.73833,-0.21401 -0.094,7e-4 -0.17741,0.0327 -0.25009,0.096 -0.0622,0.0632 -0.0983,0.14184 -0.108,0.23594 l 0.002,0.23512 0.0103,1.39504 -0.18705,0.14246 c -0.0373,-2.22565 -0.081,-3.90261 -0.13112,-5.03088 -0.0258,-0.66864 -0.25294,-1.00138 -0.68142,-0.99821 l -0.0157,1.1e-4 z",
touchTutorialBlur:"m 6.476291,3.6785164 c -0.42843,0.003 -0.64541,0.33917 -0.65093,1.00804 l -0.0746,6.8821196 -0.15745,-0.0928 -0.0126,-1.7085496 c -0.001,-0.14629 -0.0957,-0.2292 -0.28399,-0.24871 -0.18833,-0.0299 -0.33455,-0.0184 -0.43866,0.0346 -0.0625,0.0214 -0.1249,0.0636 -0.18717,0.12678 -0.0519,0.0527 -0.10862,0.15235 -0.17023,0.2991 -0.0513,0.1362296 -0.0871,0.2253296 -0.10776,0.2672796 -0.0102,0.0419 -0.0458,0.16232 -0.10706,0.36133 -0.061,0.23036 -0.0907,0.45526 -0.0891,0.67471 0.0588,0.8774 0.26399,1.78506 0.61575,2.723 0.36217,0.92741 0.76535,1.75002 1.20955,2.46781 l 0.0171,0.18798 4.54567,-0.0335 0.10694,-0.377 c 0.0609,-0.2408 0.15745,-0.61773 0.28949,-1.13077 0.14252,-0.51312 0.24932,-0.91103 0.32039,-1.19371 0.071,-0.28268 0.14689,-0.62811 0.22748,-1.03626 0.091,-0.41869 0.15604,-0.80583 0.19521,-1.16144 0.0392,-0.35559 0.0575,-0.70582 0.0549,-1.05066 -0.005,-0.66879 -0.0818,-1.1802896 -0.23077,-1.5345096 -0.0639,-0.15628 -0.17987,-0.2965 -0.34797,-0.42066 -0.16813,-0.12418 -0.3253,-0.18049 -0.47151,-0.16896 -0.0731,5.4e-4 -0.10918,0.074 -0.1081,0.22025 l 0.01,1.3323596 -0.18695,0.15813 -0.0105,-1.4263996 c -0.002,-0.22989 -0.11281,-0.41718 -0.33333,-0.56186 -0.2206,-0.15512 -0.45112,-0.23702 -0.69154,-0.2457 -0.20899,0.002 -0.31268,0.11203 -0.31106,0.33147 l 0.011,1.4891 -0.17138,0.14235 -0.0117,-1.58315 c -0.002,-0.2717 -0.11842,-0.4694 -0.34924,-0.5931 -0.23082,-0.1237 -0.47693,-0.19503 -0.73833,-0.21401 -0.094,7e-4 -0.17741,0.0327 -0.25009,0.096 -0.0622,0.0632 -0.0983,0.14184 -0.108,0.23594 l 0.002,0.23512 0.0103,1.39504 -0.18705,0.14246 c -0.0373,-2.22565 -0.081,-3.90261 -0.13112,-5.03088 -0.0258,-0.66864 -0.25294,-1.00138 -0.68142,-0.99821 l -0.0157,1.1e-4 z"},
u=function(d,l){this.settings=stage.extend(!0,{},b,l);this.uiElement=$$stage(d);this.svgIconEvents=stage.createEventsManager(this.settings)};u.prototype.getTooltipIcons=function(){var b={bottomMiddle:d.tooltipBottomMiddle,bottomLeftCorner:d.tooltipBottomLeftCorner,bottomLeft:d.tooltipBottomLeft,bottomRightCorner:d.tooltipBottomRightCorner,bottomRight:d.tooltipBottomRight,leftMiddle:d.tooltipLeftMiddle,leftBottom:d.tooltipLeftBottom,leftTop:d.tooltipLeftTop,rightMiddle:d.tooltipRightMiddle,rightBottom:d.tooltipRightBottom,
rightTop:d.tooltipRightTop,topMiddle:d.tooltipTopMiddle,topLeftCorner:d.tooltipTopLeftCorner,topLeft:d.tooltipTopLeft,topRightCorner:d.tooltipTopRightCorner,topRight:d.tooltipTopRight},l={},g;for(g in b){var q={transform:"translate(0,-752.36218)",sizeSvg:"0 0 1200 300"};q.container=g;q.elems=[];q.elems[0]={};q.elems[0].balise="path";q.elems[0].attributes={d:b[g],"stroke-width":"10","stroke-opacity":.4,"stroke-miterlimit":4,"stroke-linejoin":"miter",stroke:"foregroundNormalColor",fill:"backgroundNormalColor",
"fill-opacity":.78};l[g]=q}return l};u.prototype.getAnnotationsIcons=function(b){return{pin:{elems:[{balise:"path",attributes:{d:d.icoAnnotionGout,fill:this.settings.foregroundColor,"fill-opacity":this.settings.fillOpacity,stroke:this.settings.stroke,"stroke-opacity":.7},normalColor:this.settings.foregroundColor,overColor:"backgroundOverColor",colorable:!0}],container:b,sizeSvg:"0 0 21.165 29.921641"},cross:{elems:[{balise:"path",attributes:{d:d.quitIcon,fill:this.settings.foregroundColor,"fill-opacity":this.settings.fillOpacity,
stroke:this.settings.stroke,"stroke-opacity":.7},normalColor:this.settings.foregroundColor,overColor:"backgroundOverColor",colorable:!0}],container:b,sizeSvg:"0 0 1004.0166625976562 1004.0166625976562"}}};u.prototype.getTriggerIcons=function(b){return{target:{elems:[{balise:"circle",attributes:{cx:"14",cy:"14",r:"14",fill:this.settings.foregroundColor},normalColor:this.settings.foregroundColor,overColor:"backgroundOverColor",colorable:!0},{balise:"circle",attributes:{cx:"14",cy:"14",r:"9.8",fill:"none",
stroke:this.settings.backgroundColor,"stroke-width":"2.2","stroke-linecap":"round"},colorable:!1},{balise:"circle",attributes:{cx:"14",cy:"14",r:"1",fill:"none",stroke:this.settings.backgroundColor,"stroke-width":"2.2","stroke-linecap":"round"},colorable:!1}],container:b,sizeSvg:"0 0 28 28"},simpleColored:{elems:[{balise:"circle",attributes:{cx:"14",cy:"14",r:"4.5",fill:"none",stroke:this.settings.backgroundColor,"stroke-width":"2.2","stroke-linecap":"round"},overColor:"backgroundOverColor",strokeOverColor:"backgroundOverColor",
strokeNormalColor:this.settings.backgroundColor,colorable:!0,strokeColorable:!0}],container:b,sizeSvg:"0 0 28 28"},simple:{elems:[{balise:"circle",attributes:{cx:"14",cy:"14",r:"4.5",fill:"none",stroke:this.settings.backgroundColor,"stroke-width":"2.2","stroke-linecap":"round"},overColor:this.settings.backgroundColor,strokeOverColor:"none",strokeNormalColor:this.settings.backgroundColor,colorable:!0,strokeColorable:!0},{balise:"circle",attributes:{cx:"14",cy:"14",r:"9",fill:"none",stroke:"none","stroke-width":"1.5",
"stroke-linecap":"round"},strokeOverColor:this.settings.backgroundColor,strokeNormalColor:"none",strokeColorable:!0}],container:b,sizeSvg:"0 0 28 28"},numbered:{elems:[{balise:"circle",attributes:{cx:"16",cy:"16",r:"14",fill:this.settings.foregroundColor},colorable:!0,normalColor:this.settings.foregroundColor,overColor:"backgroundOverColor"}],container:b,sizeSvg:"0 0 30 30"},movingNumber:{elems:[{balise:"circle",attributes:{cx:"32.5",cy:"32.5",r:"15",fill:this.settings.foregroundColor,"fill-opacity":this.settings.fillOpacity},
normalColor:this.settings.foregroundColor,overColor:"backgroundOverColor",colorable:!0}],container:b,sizeSvg:"0 0 65 65"},movingTarget:{elems:[{balise:"circle",attributes:{cx:"26",cy:"26",r:"4",fill:"backgroundOverColor","fill-opacity":.7},normalColor:"borderColor",overColor:"backgroundOverColor",colorable:!0},{balise:"circle",attributes:{cx:"26",cy:"26",r:"4",fill:"rgba(255,255,255,1)"},colorable:!1},{balise:"circle",attributes:{cx:"26",cy:"26",r:"25",fill:"none",stroke:"rgba(255,255,255,1)","stroke-width":"2",
"stroke-linecap":"round","stroke-opacity":"1"},colorable:!1}],container:b,sizeSvg:"0 0 52 52"},moving:{elems:[{balise:"circle",attributes:{cx:"26",cy:"26",r:"4",fill:"backgroundOverColor","fill-opacity":.7},normalColor:"borderColor",overColor:"backgroundOverColor",colorable:!0},{balise:"circle",attributes:{cx:"26",cy:"26",r:"4",fill:"rgba(255,255,255,1)"},normalColor:"backgroundNormalColor",overColor:"backgroundNormalColor",colorable:!1},{balise:"circle",attributes:{cx:"26",cy:"26",r:"25",fill:"none",
stroke:"rgba(255,255,255,1)","stroke-width":"1","stroke-linecap":"round","stroke-opacity":"1"},normalColor:"backgroundNormalColor",overColor:"backgroundNormalColor",colorable:!1}],container:b,sizeSvg:"0 0 52 52"},cross:{elems:[{balise:"circle",attributes:{cx:"12",cy:"12",r:"11",fill:"backgroundOverColor",stroke:this.settings.foregroundColor,"stroke-width":"1","stroke-linecap":"round","stroke-opacity":"1"},normalColor:"backgroundOverColor",overColor:"backgroundNormalColor",colorable:!0},{balise:"path",
attributes:{d:"M17.5 8L15.9929 6.5L12 10.5L8 6.5L6.5 8L10.5 12L6.5 16L8 17.5L12 13.5L15.9929 17.5L17.5 15.9929L13.5 12L17.5 8Z",fill:"backgroundNormalColor"},colorable:!0,normalColor:"backgroundNormalColor",overColor:"backgroundOverColor"}],container:b,sizeSvg:"0 0 24 24"},plus:{elems:[{balise:"circle",attributes:{cx:"50",cy:"50",r:"45",fill:"backgroundOverColor",stroke:this.settings.foregroundColor,"stroke-width":"1","stroke-linecap":"round","stroke-opacity":"1"},normalColor:"backgroundOverColor",
overColor:"backgroundNormalColor",colorable:!0},{balise:"path",attributes:{d:"M47 29H53V71H47V29Z",fill:"backgroundNormalColor"},colorable:!0,normalColor:"backgroundNormalColor",overColor:"backgroundOverColor"},{balise:"path",attributes:{d:"M29 53L29 47L71 47V53L29 53Z",fill:"backgroundNormalColor"},colorable:!0,normalColor:"backgroundNormalColor",overColor:"backgroundOverColor"}],container:b,sizeSvg:"0 0 100 100"},pen:{elems:[{balise:"circle",attributes:{cx:"50",cy:"50",r:"45",fill:"backgroundOverColor",
stroke:this.settings.foregroundColor,"stroke-width":"1","stroke-linecap":"round","stroke-opacity":"1"},normalColor:"backgroundOverColor",overColor:"backgroundNormalColor",colorable:!0},{balise:"path",attributes:{d:"M38.1421 76.7696L24 76.7696L24 62.6274L59.6985 26.9289C63.6037 23.0237 69.9354 23.0237 73.8406 26.9289C77.7459 30.8342 77.7459 37.1658 73.8406 41.0711L38.1421 76.7696ZM63.9411 31.1716C65.5032 29.6095 68.0359 29.6095 69.598 31.1716C71.1601 32.7337 71.1601 35.2663 69.598 36.8284L35.6569 70.7696H30V65.1127L63.9411 31.1716Z",
fill:"backgroundNormalColor",fillRule:"evenodd",clipRule:"evenodd",style:"transform : scale(.80) translate(12px, 11px);"},colorable:!0,normalColor:"backgroundNormalColor",overColor:"backgroundOverColor"}],container:b,sizeSvg:"0 0 100 100"},penLine:{elems:[{balise:"circle",attributes:{cx:"50",cy:"50",r:"45",fill:"black",stroke:this.settings.foregroundColor,"stroke-width":"1","stroke-linecap":"round","stroke-opacity":"1"},normalColor:"black",overColor:"white",colorable:!0},{balise:"path",attributes:{d:"M38.1421 76.7696L24 76.7696L24 62.6274L59.6985 26.9289C63.6037 23.0237 69.9354 23.0237 73.8406 26.9289C77.7459 30.8342 77.7459 37.1658 73.8406 41.0711L38.1421 76.7696ZM63.9411 31.1716C65.5032 29.6095 68.0359 29.6095 69.598 31.1716C71.1601 32.7337 71.1601 35.2663 69.598 36.8284L35.6569 70.7696H30V65.1127L63.9411 31.1716Z",
fill:"white",fillRule:"evenodd",clipRule:"evenodd",style:"transform : scale(.80) translate(12px, 11px);"},colorable:!0,normalColor:"white",overColor:"black"},{balise:"path",attributes:{d:"M52.4289 70.8578H73.9289C75.5857 70.8578 76.9289 72.201 76.9289 73.8578C76.9289 75.5147 75.5857 76.8578 73.9289 76.8578H46.4289L52.4289 70.8578Z",fill:"white",style:"transform : scale(.80) translate(12px, 11px);"},colorable:!0,normalColor:"white",overColor:"black"}],container:b,sizeSvg:"0 0 100 100"}}};u.prototype.getLoaderIcons=
function(){return{emersyaPoweredByIcon:{elems:[{balise:"path",attributes:{d:d.poweredByEmersyaIcon,fill:"foregroundNormalColor","fill-opacity":.8},colorable:!0}],container:"emersyaLoaderLogoContainer",sizeSvg:"0 0 1000 100"}}};u.prototype.getArUiIcons=function(){return{moving:{elems:[{balise:"circle",attributes:{cx:"30",cy:"30",r:"26",fill:"rgba(255,255,255,1)"}},{balise:"circle",attributes:{cx:"30",cy:"30",r:"24",fill:"none",stroke:"rgba(0,0,0,0.5)","stroke-width":"7","stroke-linecap":"round"}},
{balise:"circle",attributes:{cx:"30",cy:"30",r:"28",fill:"none",stroke:"rgba(255,255,255,1)","stroke-width":"4","stroke-linecap":"round"}}],container:"takePictureButtonContainer",sizeSvg:"0 0 60 60"},mouseLeftClic:{elems:[{balise:"path",attributes:{d:d.mouseLeftClic,fill:"secondArColor"}},{balise:"path",attributes:{d:d.mouseRightClic,fill:"thirdColor"}},{balise:"path",attributes:{d:d.mouseWheel,fill:"thirdColor"}},{balise:"path",attributes:{d:d.mouseBody,fill:"thirdColor"}}],container:"arHelperRotateIcon",
sizeSvg:"0 0 64 64"},rotateTouch:{elems:[{balise:"path",attributes:{d:d.touchRotate,fill:"thirdColor"}},{balise:"path",attributes:{d:d.arrowRotateTop,fill:"secondArColor"}},{balise:"path",attributes:{d:d.arrowRotateLeft,fill:"secondArColor"}},{balise:"path",attributes:{d:d.arrowRotateRight,fill:"secondArColor"}}],container:"arHelperRotateIconTouch",sizeSvg:"0 0 64 64"},mouseRightClic:{elems:[{balise:"path",attributes:{d:d.mouseLeftClic,fill:"thirdColor"}},{balise:"path",attributes:{d:d.mouseRightClic,
fill:"secondArColor"}},{balise:"path",attributes:{d:d.mouseWheel,fill:"thirdColor"}},{balise:"path",attributes:{d:d.mouseBody,fill:"thirdColor"}}],container:"arHelperMoveIcon",sizeSvg:"0 0 64 64"},moveTouch:{elems:[{balise:"path",attributes:{d:d.touchMove,fill:"thirdColor"}},{balise:"path",attributes:{d:d.arrowMoveTop,fill:"secondArColor"}},{balise:"path",attributes:{d:d.arrowMoveLeft,fill:"secondArColor"}},{balise:"path",attributes:{d:d.arrowMoveRight,fill:"secondArColor"}}],container:"arHelperMoveIconTouch",
sizeSvg:"0 0 64 64"},mouseWheel:{elems:[{balise:"path",attributes:{d:d.mouseLeftClic,fill:"thirdColor"}},{balise:"path",attributes:{d:d.mouseRightClic,fill:"thirdColor"}},{balise:"path",attributes:{d:d.mouseWheel,fill:"secondArColor"}},{balise:"path",attributes:{d:d.mouseBody,fill:"thirdColor"}}],container:"arHelperZoomIcon",sizeSvg:"0 0 64 64"},zoomTouch:{elems:[{balise:"path",attributes:{d:d.touchZoom,fill:"thirdColor"}},{balise:"path",attributes:{d:d.arrowZoomTop,fill:"secondArColor"}},{balise:"path",
attributes:{d:d.arrowZoomBottom,fill:"secondArColor"}}],container:"arHelperZoomIconTouch",sizeSvg:"0 0 64 64"},rotateIcon:{elems:[{balise:"path",attributes:{d:d.rotateIcon,fill:"secondArColor"}}],container:"rotateArIconTitle"},moveIcon:{elems:[{balise:"path",attributes:{d:d.moveIcon,fill:"secondArColor"}}],container:"moveArIconTitle"},zoomIcon:{elems:[{balise:"path",attributes:{d:d.zoomIcon,fill:"secondArColor"}}],container:"zoomArIconTitle"},emersyaPoweredByIcon:{elems:[{balise:"path",attributes:{d:d.poweredByEmersyaIcon,
fill:"secondArColor"}}],container:"emersyaArLogoHelper",sizeSvg:"0 0 1000 100"},emersyaPoweredByIconQrCode:{elems:[{balise:"path",attributes:{d:d.poweredByEmersyaIcon,fill:"secondArColor"}}],container:"powerByEmersyaLogoQrCode",sizeSvg:"0 0 1000 100"},quitIcon:{elems:[{balise:"path",attributes:{d:d.quitIcon,fill:"secondArColor"},colorable:!0,overColor:"secondArColor"}],container:"quitArHelpIcon"},quitArIcon:{elems:[{balise:"path",attributes:{d:d.quitIcon,fill:"#4f5865"},colorable:!0,overColor:"secondArColor"}],
container:"quitArIcon"},arhelperIcon:{elems:[{balise:"path",attributes:{d:d.infoIcon,fill:"#a4a4a4"},colorable:!0,overColor:"secondArColor"}],container:"arHelperIcon"},arPresetIcon:{elems:[{balise:"path",attributes:{d:d.paletteIcon,fill:"#4f5865"},colorable:!0,overColor:"secondArColor"}],container:"arPresetIcon",sizeSvg:"0 0 1000 955"},arAnimationIcon:{elems:[{balise:"path",attributes:{d:d.playIcon,fill:"#4f5865"},colorable:!0,overColor:"secondArColor"}],container:"arAnimationIcon",sizeSvg:"0 0 1000 955"},
arFullscreenInIcon:{elems:[{balise:"path",attributes:{d:d.fullscreenInArrowTopIcon,fill:"#4f5865"},colorable:!0,overColor:"secondArColor"},{balise:"path",attributes:{d:d.fullscreenInArrowBottomIcon,fill:"#4f5865"},colorable:!0,overColor:"secondArColor"}],container:"arFullscreenIcon"},arFullscreenOutIcon:{elems:[{balise:"path",attributes:{d:d.fullscreenoutArrowTopIcon,fill:"#4f5865"},colorable:!0,overColor:"secondArColor"},{balise:"path",attributes:{d:d.fullscreenoutArrowBottomIcon,fill:"#4f5865"},
colorable:!0,overColor:"secondArColor"}],container:"arFullscreenIcon"},quitSizeSelectionIcon:{elems:[{balise:"path",attributes:{d:d.quitIcon,fill:"secondArColor"}}],container:"quitArSizeSelection"},facebookIcon:{elems:[{balise:"path",attributes:{d:d.facebookIcon,fill:"secondArColor"}}],container:"facebookArIcon"},twitterIcon:{elems:[{balise:"path",attributes:{d:d.twitterIcon,fill:"secondArColor"}}],container:"twitterArIcon"},downloadIcon:{elems:[{balise:"path",attributes:{d:d.downloadIcon,fill:"secondArColor"}}],
container:"downloadArIcon"},shareIcon:{elems:[{balise:"path",attributes:{d:d.shareIcon,fill:"secondArColor"}}],container:"shareArIcon"},unavailableArInstructionIcon:{elems:[{balise:"path",attributes:{d:d.lightBulb,fill:"secondArColor"}}],container:"unavailableArInstructionIcon"},quitArMessageScreen:{elems:[{balise:"path",attributes:{d:d.quitIcon,fill:"secondArColor"}}],container:"quitArMessageScreen"},moveAround:{elems:[{balise:"path",attributes:{d:d.moveAround,fill:"secondArColor"}}],container:"moveAroundIconContainer"},
arTypeSelectorQuitButon:{elems:[{balise:"path",attributes:{d:d.quitIcon,fill:"secondArColor"}}],container:"arTypeSelectorQuitButon"},qrCodeQuitButon:{elems:[{balise:"path",attributes:{d:d.quitIcon,fill:"secondArColor"}}],container:"qrCodeQuitButon"},placeAndInteract:{elems:[{balise:"path",attributes:{d:d.placeAndInteract,fill:"secondArColor"}}],container:"placeAndInteractIconContainer"},arIcon:{elems:[{balise:"path",attributes:{d:d.bBoxIcon,fill:"secondArColor"}}],container:"arButtonIcon"},arQrCodePageIcon:{elems:[{balise:"path",
attributes:{d:d.bBoxIcon,fill:"secondArColor"}}],container:"arQrCodePageIcon"},arSizeIcon:{elems:[{balise:"path",attributes:{d:d.bodyIcon,fill:"secondArColor"}}],container:"arSizeSelectionTitleIcon"},switchCameraIcon:{elems:[{balise:"path",attributes:{d:d.switchCameraIcon,fill:"secondArColor"}}],container:"switchCameraButtonIcon",sizeSvg:"0 0 300 300"},settingsIcon:{elems:[{balise:"path",attributes:{d:d.settingsIcon1,fill:"secondArColor"}},{balise:"path",attributes:{d:d.settingsIcon2,fill:"secondArColor"}},
{balise:"path",attributes:{d:d.settingsIcon3,fill:"secondArColor"}}],container:"arSettingsButtonIcon"},quitErrorScreenIcon:{elems:[{balise:"path",attributes:{d:d.quitIcon,fill:"secondArColor"}}],container:"arErrorScreenQuitIcon"},arManIcon:{elems:[{balise:"path",attributes:{d:d.arSizeManBodyAndLegs,fill:"rgba(255,255,255,0.15)"}},{balise:"path",attributes:{d:d.arSizeManHEeadAndArm,fill:"secondArColor"}}],container:"arManIcon",sizeSvg:"0 -1 80 297"},arRotateButtonIcon:{elems:[{balise:"path",attributes:{d:d.rotateIcon,
fill:"secondArColor"}}],container:"arInteractionRotateButtonIcon"},arMoveButtonIcon:{elems:[{balise:"path",attributes:{d:d.moveIcon,fill:"secondArColor"}}],container:"arInteractionMoveButtonIcon"}}};u.prototype.getUICoreIcons=function(){return{scrollingTopArrow:{elems:[{balise:"path",attributes:{d:d.scrollingTopArrow,fill:"rgba(255,255,255,1)"}}],container:"scrollingTopContainer",sizeSvg:"0 0 210 297"},scrollingBottomArrow:{elems:[{balise:"path",attributes:{d:d.scrollingBottomArrow,fill:"rgba(255,255,255,1)"}}],
container:"scrollingBottomContainer",sizeSvg:"0 0 210 297"},arrow:{elems:[{balise:"path",attributes:{d:d.redirectButtonArrow,fill:"foregroundOverColor"}}],container:"redirectButtonArrowContainer",sizeSvg:"0 0 1000 1000"},mouseWheel:{elems:[{balise:"path",attributes:{d:d.mouseLeftClic,fill:"foregroundOverColor"}},{balise:"path",attributes:{d:d.mouseRightClic,fill:"foregroundOverColor"}},{balise:"path",attributes:{d:d.mouseWheel,fill:"backgroundOverColor"}},{balise:"path",attributes:{d:d.mouseBody,
fill:"foregroundOverColor"}}],container:"wheelOnCtrlIconContainer",sizeSvg:"0 0 64 64"},threeDButton:{elems:[{balise:"path",attributes:{d:d.threeDButtonBlur,fill:"borderColor","fill-opacity":.5},colorable:!0,overColor:"backgroundOverColor"},{balise:"path",attributes:{d:d.threeDButtonBg,fill:"backgroundNormalColor","fill-opacity":.8}},{balise:"path",attributes:{d:d.threeDButtonTxt,fill:"foregroundNormalColor","fill-opacity":1}}],container:"svgThreeDButton",sizeSvg:"0 0 1000 1067.70"},quitIcon:{elems:[{balise:"path",
attributes:{d:d.quitIcon,fill:"backgroundNormalColor","fill-opacity":1},colorable:!0,overColor:"foregroundOverColor"}],container:"svgQuitIcon"},emersyaIcon:{elems:[{balise:"path",attributes:{d:d.emersyaIcon,fill:"logoNeutralColor","fill-opacity":.8},colorable:!0,overColor:"foregroundSelectedColor"}],container:"emersyaIcon",transform:"translate(-48.729 -134.41)"},emersyaPoweredByIcon:{elems:[{balise:"path",attributes:{d:d.poweredByEmersyaIcon,fill:"logoNeutralColor","fill-opacity":.8},overColor:"overColor",
colorable:!0}],container:"emersyaLogoContainer",sizeSvg:"0 0 1000 100"},partnerLogoLinkIcon:{elems:[{balise:"path",attributes:{d:d.quitIcon,fill:"logoNeutralColor","fill-opacity":1},colorable:!0,overColor:"foregroundSelectedColor"}],container:"partnerLogoLinkContainer",sizeSvg:"0 -500 1000 2000"}}};u.prototype.getFallbackIcons=function(){return{quitIcon:{elems:[{balise:"path",attributes:{d:d.quitIcon,fill:"foregroundNormalColor","fill-opacity":.5},colorable:!0,overColor:"foregroundOverColor"}],container:"fallbackQuitIcon"},
fallbackInteractionIcon:{elems:[{balise:"path",attributes:{d:d.fallbackInteractionIcon,fill:"foregroundOverColor"}}],container:"buttonFallbackContainer"}}};u.prototype.getHelperIcons=function(){var b=this.getStartingTutorialIcons();b.quitIcon={elems:[{balise:"path",attributes:{d:d.quitIcon,fill:"foregroundOverColor"},colorable:!0,overColor:"backgroundOverColor"}],container:"svgHelpWindowCloseButton"};b.leftArrowIcon={elems:[{balise:"path",attributes:{d:d.leftArrowIcon,fill:"foregroundOverColor"},
colorable:!0,overColor:"backgroundOverColor"}],container:"leftArrowSvgContainer",sizeSvg:"0 0 210 297"};b.rightArrowIcon={elems:[{balise:"path",attributes:{d:d.rightArrowIcon,fill:"foregroundOverColor"},colorable:!0,overColor:"backgroundOverColor"}],container:"rightArrowSvgContainer",sizeSvg:"0 0 210 297"};b.mouseLeftClic.container="svgMouseLeftClic";b.rotateTouch.container="svgRotateTouch";b.mouseRightClic.container="svgMouseRightClic";b.moveTouch.container="svgMoveTouch";b.mouseWheel.container=
"svgMouseWheelClic";b.zoomTouch.container="svgZoomTouch";b.rotateIcon.container="helpWindowManipulationActionBlocContentTitleIconRotate";b.moveIcon.container="helpWindowManipulationActionBlocContentTitleIconMove";b.zoomIcon.container="helpWindowManipulationActionBlocContentTitleIconZoom";b.emersyaLogoHelper={elems:[{balise:"path",attributes:{d:d.poweredByEmersyaIcon,fill:"foregroundOverColor","fill-opacity":.8}}],container:"emersyaLogoHelper",sizeSvg:"0 0 1000 100"};return b};u.prototype.getTutorialIcons=
function(){return{interactTouch:{elems:[{balise:"filter",attributes:{id:"filter842",x:"-0.19934134",width:"1.3986827",y:"-0.11642906",height:"1.2328581",childs:[{balise:"feGaussianBlur",attributes:{stdDeviation:"0.62981763",id:"feGaussianBlur844"}}]}},{balise:"path",attributes:{d:d.touchTutorialBlur,filter:"url(#filter842)"}},{balise:"path",attributes:{d:d.touchTutorial,fill:"#FFFFFF",stroke:"#000000","stroke-width":.1}}],container:"tutorialContainer",sizeSvg:"0 0 15.534309 20.937853"}}};u.prototype.getStartingTutorialIcons=
function(){return{mouseLeftClic:{elems:[{balise:"path",attributes:{d:d.mouseLeftClic,fill:"backgroundOverColor"}},{balise:"path",attributes:{d:d.mouseRightClic,fill:"foregroundOverColor"}},{balise:"path",attributes:{d:d.mouseWheel,fill:"foregroundOverColor"}},{balise:"path",attributes:{d:d.mouseBody,fill:"foregroundOverColor"}}],container:"startingTutorialSvgMouseLeftClic",sizeSvg:"0 0 64 64"},rotateTouch:{elems:[{balise:"path",attributes:{d:d.touchRotate,fill:"foregroundOverColor"}},{balise:"path",
attributes:{d:d.arrowRotateTop,fill:"backgroundOverColor"}},{balise:"path",attributes:{d:d.arrowRotateLeft,fill:"backgroundOverColor"}},{balise:"path",attributes:{d:d.arrowRotateRight,fill:"backgroundOverColor"}}],container:"startingTutorialSvgRotateTouch",sizeSvg:"0 0 64 64"},mouseRightClic:{elems:[{balise:"path",attributes:{d:d.mouseLeftClic,fill:"foregroundOverColor"}},{balise:"path",attributes:{d:d.mouseRightClic,fill:"backgroundOverColor"}},{balise:"path",attributes:{d:d.mouseWheel,fill:"foregroundOverColor"}},
{balise:"path",attributes:{d:d.mouseBody,fill:"foregroundOverColor"}}],container:"startingTutorialSvgMouseRightClic",sizeSvg:"0 0 64 64"},moveTouch:{elems:[{balise:"path",attributes:{d:d.touchMove,fill:"foregroundOverColor"}},{balise:"path",attributes:{d:d.arrowMoveTop,fill:"backgroundOverColor"}},{balise:"path",attributes:{d:d.arrowMoveLeft,fill:"backgroundOverColor"}},{balise:"path",attributes:{d:d.arrowMoveRight,fill:"backgroundOverColor"}}],container:"startingTutorialSvgMoveTouch",sizeSvg:"0 0 64 64"},
mouseWheel:{elems:[{balise:"path",attributes:{d:d.mouseLeftClic,fill:"foregroundOverColor"}},{balise:"path",attributes:{d:d.mouseRightClic,fill:"foregroundOverColor"}},{balise:"path",attributes:{d:d.mouseWheel,fill:"backgroundOverColor"}},{balise:"path",attributes:{d:d.mouseBody,fill:"foregroundOverColor"}}],container:"startingTutorialSvgMouseWheelClic",sizeSvg:"0 0 64 64"},zoomTouch:{elems:[{balise:"path",attributes:{d:d.touchZoom,fill:"foregroundOverColor"}},{balise:"path",attributes:{d:d.arrowZoomTop,
fill:"backgroundOverColor"}},{balise:"path",attributes:{d:d.arrowZoomBottom,fill:"backgroundOverColor"}}],container:"startingTutorialSvgZoomTouch",sizeSvg:"0 0 64 64"},rotateIcon:{elems:[{balise:"path",attributes:{d:d.rotateIcon,fill:"foregroundOverColor"}}],container:"startingTutorialIconContainerContentTitleIconRotate"},moveIcon:{elems:[{balise:"path",attributes:{d:d.moveIcon,fill:"foregroundOverColor"}}],container:"startingTutorialIconContainerContentTitleIconTranslate"},zoomIcon:{elems:[{balise:"path",
attributes:{d:d.zoomIcon,fill:"foregroundOverColor"}}],container:"startingTutorialIconContainerContentTitleIconZoom"}}};u.prototype.getFullIcons=function(){return{playIcon:{elems:[{balise:"path",attributes:{d:d.squareBgPlayIcon,fill:"borderColor"}},{balise:"path",attributes:{d:d.squareBgPlayIconBlack,fill:"backgroundNormalColor"},colorable:!0,overColor:"backgroundOverColor"},{balise:"path",attributes:{d:d.playIcon,fill:"foregroundNormalColor"},colorable:!0,overColor:"foregroundOverColor"}],container:"svgPlayIcon",
sizeSvg:"0 0 1000 955"},playIconBot:{elems:[{balise:"path",attributes:{d:d.squareBgPlayIconBot,fill:"borderColor"}},{balise:"path",attributes:{d:d.squareBgPlayIconBlackBot,fill:"backgroundNormalColor"},colorable:!0,overColor:"backgroundOverColor"},{balise:"path",attributes:{d:d.playIcon,fill:"foregroundNormalColor"},colorable:!0,overColor:"foregroundOverColor"}],container:"svgPlayIconBot"},pauseIcon:{elems:[{balise:"path",attributes:{d:d.squareBgPlayIcon,fill:"borderColor"}},{balise:"path",attributes:{d:d.squareBgPlayIconBlack,
fill:"backgroundNormalColor"},colorable:!0,overColor:"backgroundOverColor"},{balise:"path",attributes:{d:d.pauseIcon,fill:"foregroundNormalColor"},colorable:!0,overColor:"foregroundOverColor"}],container:"svgPauseIcon",sizeSvg:"0 0 1000 955"},pauseIconBot:{elems:[{balise:"path",attributes:{d:d.squareBgPlayIconBot,fill:"borderColor"},colorable:!0,overColor:"borderColor"},{balise:"path",attributes:{d:d.squareBgPlayIconBlackBot,fill:"backgroundNormalColor"},colorable:!0,overColor:"backgroundOverColor"},
{balise:"path",attributes:{d:d.pauseIcon,fill:"foregroundNormalColor"},colorable:!0,overColor:"foregroundOverColor"}],container:"svgPauseIconBot"},zoomInIcon:{elems:[{balise:"path",attributes:{d:d.topBg,fill:"backgroundNormalColor"},colorable:!0,overColor:"backgroundOverColor"},{balise:"path",attributes:{d:d.zoomInIcon,fill:"foregroundNormalColor"},colorable:!0,overColor:"foregroundOverColor"}],container:"svgZoomInIcon"},zoomOutIcon:{elems:[{balise:"path",attributes:{d:d.botBg,fill:"backgroundNormalColor"},
colorable:!0,overColor:"backgroundOverColor"},{balise:"path",attributes:{d:d.zoomOutIcon,fill:"foregroundNormalColor"},colorable:!0,overColor:"foregroundOverColor"}],container:"svgZoomOutIcon"},moveIcon:{elems:[{balise:"path",attributes:{d:d.topBg,fill:"backgroundNormalColor"},colorable:!0,overColor:"backgroundOverColor",normalColor:"backgroundNormalColor",selectedColor:"backgroundSelectedColor"},{balise:"path",attributes:{d:d.moveIcon,fill:"foregroundNormalColor"},colorable:!0,overColor:"foregroundOverColor",
normalColor:"foregroundNormalColor",selectedColor:"foregroundSelectedColor"}],container:"svgMoveIcon"},rotateIcon:{elems:[{balise:"path",attributes:{d:d.botBg,fill:"backgroundSelectedColor"},colorable:!0,overColor:"backgroundOverColor",normalColor:"backgroundNormalColor",selectedColor:"backgroundSelectedColor"},{balise:"path",attributes:{d:d.rotateIcon,fill:"foregroundSelectedColor"},colorable:!0,overColor:"foregroundOverColor",normalColor:"foregroundNormalColor",selectedColor:"foregroundSelectedColor"}],
container:"svgRotateIcon"},eyeIcon:{elems:[{balise:"path",attributes:{d:d.squareBg,fill:"backgroundNormalColor"},colorable:!0,overColor:"backgroundOverColor"},{balise:"path",attributes:{d:d.eyeIcon,fill:"foregroundNormalColor"},colorable:!0,overColor:"foregroundOverColor"}],container:"svgEyeIcon",doNotEmpty:!0},eyeIconBot:{elems:[{balise:"path",attributes:{d:d.squareBg,fill:"backgroundNormalColor"},colorable:!0,overColor:"backgroundOverColor",normalColor:"backgroundNormalColor",selectedColor:"backgroundSelectedColor"},
{balise:"path",attributes:{d:d.eyeIcon,fill:"foregroundNormalColor"},colorable:!0,overColor:"foregroundOverColor",normalColor:"foregroundNormalColor",selectedColor:"foregroundSelectedColor"}],container:"svgEyeIconBot",doNotEmpty:!0},itemAngle1:{elems:[{balise:"path",attributes:{d:d.squareBgTransparent,fill:"borderColor"}},{balise:"path",attributes:{d:d.squareBgViews,fill:"backgroundNormalColor"},colorable:!0,overColor:"backgroundOverColor",normalColor:"backgroundNormalColor",selectedColor:"backgroundSelectedColor"},
{balise:"path",attributes:{d:d.itemAngle,fill:"foregroundNormalColor",stroke:"foregroundNormalColor","stroke-width":46.12956619,"stroke-linejoin":"round"},colorable:!0,overColor:"foregroundOverColor",normalColor:"foregroundNormalColor",selectedColor:"foregroundSelectedColor"},{balise:"path",attributes:{d:d.faceItemAngle1,fill:"neutralNormalColor"},colorable:!0,overColor:"neutralOverColor",normalColor:"neutralNormalColor",selectedColor:"neutralSelectedColor"}],container:"svgItemAngle1",sizeSvg:"0 0 1100 1100",
doNotEmpty:!0},itemAngle2:{elems:[{balise:"path",attributes:{d:d.squareBgTransparent,fill:"borderColor"}},{balise:"path",attributes:{d:d.squareBgViews,fill:"backgroundNormalColor"},colorable:!0,overColor:"backgroundOverColor",normalColor:"backgroundNormalColor",selectedColor:"backgroundSelectedColor"},{balise:"path",attributes:{d:d.itemAngle,fill:"foregroundNormalColor",stroke:"foregroundNormalColor","stroke-width":46.12956619,"stroke-linejoin":"round"},colorable:!0,overColor:"foregroundOverColor",
normalColor:"foregroundNormalColor",selectedColor:"foregroundSelectedColor"},{balise:"path",attributes:{d:d.faceItemAngle2,fill:"neutralNormalColor"},colorable:!0,overColor:"neutralOverColor",normalColor:"neutralNormalColor",selectedColor:"neutralSelectedColor"}],container:"svgItemAngle2",sizeSvg:"0 0 1100 1100",doNotEmpty:!0},itemAngle3:{elems:[{balise:"path",attributes:{d:d.squareBgTransparent,fill:"borderColor"}},{balise:"path",attributes:{d:d.squareBgViews,fill:"backgroundNormalColor"},colorable:!0,
overColor:"backgroundOverColor",normalColor:"backgroundNormalColor",selectedColor:"backgroundSelectedColor"},{balise:"path",attributes:{d:d.itemAngle,fill:"foregroundNormalColor",stroke:"foregroundNormalColor","stroke-width":46.12956619,"stroke-linejoin":"round"},colorable:!0,overColor:"foregroundOverColor",normalColor:"foregroundNormalColor",selectedColor:"foregroundSelectedColor"},{balise:"path",attributes:{d:d.faceItemAngle3,fill:"neutralNormalColor"},colorable:!0,overColor:"neutralOverColor",
normalColor:"neutralNormalColor",selectedColor:"neutralSelectedColor"}],container:"svgItemAngle3",sizeSvg:"0 0 1100 1100",doNotEmpty:!0},itemAngle4:{elems:[{balise:"path",attributes:{d:d.squareBgTransparent,fill:"borderColor"}},{balise:"path",attributes:{d:d.squareBgViews,fill:"backgroundNormalColor"},colorable:!0,overColor:"backgroundOverColor",normalColor:"backgroundNormalColor",selectedColor:"backgroundSelectedColor"},{balise:"path",attributes:{d:d.itemAngle,fill:"foregroundNormalColor",stroke:"foregroundNormalColor",
"stroke-width":46.12956619,"stroke-linejoin":"round"},colorable:!0,overColor:"foregroundOverColor",normalColor:"foregroundNormalColor",selectedColor:"foregroundSelectedColor"},{balise:"path",attributes:{d:d.faceItemAngle4,fill:"neutralNormalColor"},colorable:!0,overColor:"neutralOverColor",normalColor:"neutralNormalColor",selectedColor:"neutralSelectedColor"}],container:"svgItemAngle4",sizeSvg:"0 0 1100 1100",doNotEmpty:!0},itemAngle5:{elems:[{balise:"path",attributes:{d:d.squareBgTransparent,fill:"borderColor"}},
{balise:"path",attributes:{d:d.squareBgViews,fill:"backgroundNormalColor"},colorable:!0,overColor:"backgroundOverColor",normalColor:"backgroundNormalColor",selectedColor:"backgroundSelectedColor"},{balise:"path",attributes:{d:d.itemAngle,fill:"foregroundNormalColor",stroke:"foregroundNormalColor","stroke-width":46.12956619,"stroke-linejoin":"round"},colorable:!0,overColor:"foregroundOverColor",normalColor:"foregroundNormalColor",selectedColor:"foregroundSelectedColor"},{balise:"path",attributes:{d:d.faceItemAngle5,
fill:"neutralNormalColor"},colorable:!0,overColor:"neutralOverColor",normalColor:"neutralNormalColor",selectedColor:"neutralSelectedColor"}],container:"svgItemAngle5",sizeSvg:"0 0 1100 1100",doNotEmpty:!0},itemAngle6:{elems:[{balise:"path",attributes:{d:d.squareBgTransparent,fill:"borderColor"}},{balise:"path",attributes:{d:d.squareBgViews,fill:"backgroundNormalColor"},colorable:!0,overColor:"backgroundOverColor",normalColor:"backgroundNormalColor",selectedColor:"backgroundSelectedColor"},{balise:"path",
attributes:{d:d.itemAngle,fill:"foregroundNormalColor",stroke:"foregroundNormalColor","stroke-width":46.12956619,"stroke-linejoin":"round"},colorable:!0,overColor:"foregroundOverColor",normalColor:"foregroundNormalColor",selectedColor:"foregroundSelectedColor"},{balise:"path",attributes:{d:d.faceItemAngle6,fill:"neutralNormalColor"},colorable:!0,overColor:"neutralOverColor",normalColor:"neutralNormalColor",selectedColor:"neutralSelectedColor"}],container:"svgItemAngle6",sizeSvg:"0 0 1100 1100",doNotEmpty:!0},
itemAngle7:{elems:[{balise:"path",attributes:{d:d.squareBgTransparent,fill:"borderColor"}},{balise:"path",attributes:{d:d.squareBgViews,fill:"backgroundNormalColor"},colorable:!0,overColor:"backgroundOverColor",normalColor:"backgroundNormalColor",selectedColor:"backgroundSelectedColor"},{balise:"path",attributes:{d:d.itemAngle,fill:"foregroundNormalColor",stroke:"foregroundNormalColor","stroke-width":46.12956619,"stroke-linejoin":"round"},colorable:!0,overColor:"foregroundOverColor",normalColor:"foregroundNormalColor",
selectedColor:"foregroundSelectedColor"}],container:"svgItemAngle7",sizeSvg:"0 0 1100 1100",doNotEmpty:!0},helpIcon:{elems:[{balise:"path",attributes:{d:d.squareBg,fill:"backgroundNormalColor"},colorable:!0,overColor:"backgroundOverColor"},{balise:"path",attributes:{d:d.helpIcon,fill:"foregroundNormalColor"},colorable:!0,overColor:"foregroundOverColor"}],container:"svgHelpIcon"},helpIconBot:{elems:[{balise:"path",attributes:{d:d.squareBg,fill:"backgroundNormalColor"},colorable:!0,overColor:"backgroundOverColor"},
{balise:"path",attributes:{d:d.helpIcon,fill:"foregroundNormalColor"},colorable:!0,overColor:"foregroundOverColor"}],container:"svgHelpIconBot"},fullscreenIcon:{elems:[{balise:"path",attributes:{d:d.squareBg,fill:"backgroundNormalColor"},colorable:!0,overColor:"backgroundOverColor"},{balise:"path",attributes:{d:d.fullscreenIcon,fill:"foregroundNormalColor"},colorable:!0,overColor:"foregroundOverColor"}],container:"svgFullscreenIcon"},fullscreenIconBot:{elems:[{balise:"path",attributes:{d:d.squareBg,
fill:"backgroundNormalColor"},colorable:!0,overColor:"backgroundOverColor"},{balise:"path",attributes:{d:d.fullscreenIcon,fill:"foregroundNormalColor"},colorable:!0,overColor:"foregroundOverColor"}],container:"svgFullscreenIconBot"},fullscreenIconOff:{elems:[{balise:"path",attributes:{d:d.squareBg,fill:"backgroundNormalColor"},colorable:!0,overColor:"backgroundOverColor"},{balise:"path",attributes:{d:d.fullscreenIconOff,fill:"foregroundNormalColor"},colorable:!0,overColor:"foregroundOverColor"}],
container:"svgFullscreenIconOff"},fullscreenIconOffBot:{elems:[{balise:"path",attributes:{d:d.squareBg,fill:"backgroundNormalColor"},colorable:!0,overColor:"backgroundOverColor"},{balise:"path",attributes:{d:d.fullscreenIconOff,fill:"foregroundNormalColor"},colorable:!0,overColor:"foregroundOverColor"}],container:"svgFullscreenIconOffBot"},closeHandleMenu:{elems:[{balise:"path",attributes:{d:d.closeHandleMenu,fill:"backgroundNormalColor"},colorable:!0,overColor:"backgroundOverColor"}],container:"svgCloseHandleMenu"},
openHandleMenu:{elems:[{balise:"path",attributes:{d:d.openHandleMenu,fill:"backgroundNormalColor"},colorable:!0,overColor:"backgroundOverColor"}],container:"svgOpenHandleMenu"},closeHandleMenuBot:{elems:[{balise:"path",attributes:{d:d.closeHandleMenuBot,fill:"backgroundNormalColor"},colorable:!0,overColor:"backgroundOverColor"}],container:"svgCloseHandleMenuBot"},openHandleMenuBot:{elems:[{balise:"path",attributes:{d:d.openHandleMenuBot,fill:"backgroundNormalColor"},colorable:!0,overColor:"backgroundOverColor"}],
container:"svgOpenHandleMenuBot"},zoomInIconBot:{elems:[{balise:"path",attributes:{d:d.rightBg,fill:"backgroundNormalColor"},colorable:!0,overColor:"backgroundOverColor"},{balise:"path",attributes:{d:d.zoomInIconBot,fill:"foregroundNormalColor"},colorable:!0,overColor:"foregroundOverColor"}],container:"svgZoomInIconBot"},zoomOutIconBot:{elems:[{balise:"path",attributes:{d:d.leftBg,fill:"backgroundNormalColor"},colorable:!0,overColor:"backgroundOverColor"},{balise:"path",attributes:{d:d.zoomOutIconBot,
fill:"foregroundNormalColor"},colorable:!0,overColor:"foregroundOverColor"}],container:"svgZoomOutIconBot"},moveIconBot:{elems:[{balise:"path",attributes:{d:d.leftBg,fill:"backgroundNormalColor"},colorable:!0,overColor:"backgroundOverColor",normalColor:"backgroundNormalColor",selectedColor:"backgroundSelectedColor"},{balise:"path",attributes:{d:d.moveIconBot,fill:"foregroundNormalColor"},colorable:!0,overColor:"foregroundOverColor",normalColor:"foregroundNormalColor",selectedColor:"foregroundSelectedColor"}],
container:"svgMoveIconBot"},rotateIconBot:{elems:[{balise:"path",attributes:{d:d.rightBg,fill:"backgroundNormalColor"},colorable:!0,overColor:"backgroundOverColor",normalColor:"backgroundNormalColor",selectedColor:"backgroundSelectedColor"},{balise:"path",attributes:{d:d.rotateIconBot,fill:"foregroundSelectedColor"},colorable:!0,overColor:"foregroundOverColor",normalColor:"foregroundNormalColor",selectedColor:"foregroundSelectedColor"}],container:"svgRotateIconBot"},eyeIconHandle:{elems:[{balise:"path",
attributes:{d:d.closeHandleMenuBot,fill:"backgroundNormalColor"},colorable:!0,overColor:"backgroundOverColor"}],container:"svgEyeIconHandle"},eyeIconHandleBot:{elems:[{balise:"path",attributes:{d:d.closeHandleMenuBot,fill:"backgroundNormalColor"},colorable:!0,overColor:"backgroundOverColor"}],container:"svgEyeIconHandle"},triggerIcon:{elems:[{balise:"path",attributes:{d:d.squareBg,fill:"backgroundNormalColor"},colorable:!0,overColor:"backgroundOverColor",normalColor:"backgroundNormalColor",selectedColor:"backgroundSelectedColor"},
{balise:"path",attributes:{d:d.triggerIcon,fill:"foregroundNormalColor"},colorable:!0,overColor:"foregroundOverColor",normalColor:"foregroundNormalColor",selectedColor:"foregroundSelectedColor"}],container:"svgTriggerIcon"},annotationIcon:{elems:[{balise:"path",attributes:{d:d.squareBg,fill:"backgroundNormalColor"},colorable:!0,overColor:"backgroundOverColor",normalColor:"backgroundNormalColor",selectedColor:"backgroundSelectedColor"},{balise:"path",attributes:{d:d.annotationIcon,fill:"foregroundNormalColor"},
colorable:!0,overColor:"foregroundOverColor",normalColor:"foregroundNormalColor",selectedColor:"foregroundSelectedColor"}],container:"svgAnnotationIcon"},triggerIconBot:{elems:[{balise:"path",attributes:{d:d.squareBg,fill:"backgroundNormalColor"},colorable:!0,overColor:"backgroundOverColor",normalColor:"backgroundNormalColor",selectedColor:"backgroundSelectedColor"},{balise:"path",attributes:{d:d.triggerIcon,fill:"foregroundNormalColor"},colorable:!0,overColor:"foregroundOverColor",normalColor:"foregroundNormalColor",
selectedColor:"foregroundSelectedColor"}],container:"svgTriggerIconBot"},annotationIconBot:{elems:[{balise:"path",attributes:{d:d.squareBg,fill:"backgroundNormalColor"},colorable:!0,overColor:"backgroundOverColor",normalColor:"backgroundNormalColor",selectedColor:"backgroundSelectedColor"},{balise:"path",attributes:{d:d.annotationIcon,fill:"foregroundNormalColor"},colorable:!0,overColor:"foregroundOverColor",normalColor:"foregroundNormalColor",selectedColor:"foregroundSelectedColor"}],container:"svgAnnotationIconBot"},
resetAnimationIcon:{elems:[{balise:"path",attributes:{d:d.squareBg,fill:"backgroundNormalColor"},colorable:!0,overColor:"backgroundOverColor",normalColor:"backgroundNormalColor",selectedColor:"backgroundSelectedColor"},{balise:"path",attributes:{d:d.resetAnimationIcon,fill:"foregroundNormalColor"},colorable:!0,overColor:"foregroundOverColor",normalColor:"foregroundNormalColor",selectedColor:"foregroundSelectedColor"}],container:"svgResetAnimationIcon"},resetAnimationIconBot:{elems:[{balise:"path",
attributes:{d:d.squareBg,fill:"backgroundNormalColor"},colorable:!0,overColor:"backgroundOverColor",normalColor:"backgroundNormalColor",selectedColor:"backgroundSelectedColor"},{balise:"path",attributes:{d:d.resetAnimationIcon,fill:"foregroundNormalColor"},colorable:!0,overColor:"foregroundOverColor",normalColor:"foregroundNormalColor",selectedColor:"foregroundSelectedColor"}],container:"svgResetAnimationIconBot"}}};u.prototype.getToolbarIcons=function(){return{eyeIconToolBar:{paths:[{path:d.eyeIcon,
normalColor:"foregroundNormalColor",overColor:"foregroundOverColor",selectedColor:"foregroundSelectedColor"}]},flagIcon:{paths:[{path:d.flagIcon,normalColor:"foregroundNormalColor",overColor:"foregroundOverColor",selectedColor:"foregroundSelectedColor"}]},fullscreenFullReverseIcon:{paths:[{path:d.fullscreenIcon,normalColor:"#64646400",overColor:"#AAAAAA00",deselectOverColor:"#AAAAAAFF",selectedColor:"#646464FF"},{path:d.fullscreenIcon,normalColor:"#646464",overColor:"#AAAAAA",deselectOverColor:"#00000000",
selectedColor:"#AAAAAA00"}]},axesIcon:{paths:[{path:d.axesIcon,normalColor:"foregroundNormalColor",overColor:"foregroundOverColor",selectedColor:"foregroundSelectedColor"}]},gridIcon:{paths:[{path:d.gridIcon,normalColor:"foregroundNormalColor",overColor:"foregroundOverColor",selectedColor:"foregroundSelectedColor"}]},frameRateIcon:{paths:[{path:d.frameRateIcon,normalColor:"foregroundNormalColor",overColor:"foregroundOverColor",selectedColor:"foregroundSelectedColor"}]},bBoxIcon:{paths:[{path:d.bBoxIcon,
normalColor:"foregroundNormalColor",overColor:"foregroundOverColor",selectedColor:"foregroundSelectedColor"}]},projectionModeIcon:{paths:[{path:d.perspectiveModeIcon,normalColor:"foregroundNormalColor",overColor:"foregroundOverColor",selectedColor:"foregroundSelectedColor"}]},orthographicModeIcon:{paths:[{path:d.orthographicModeIcon,normalColor:"foregroundNormalColor",overColor:"foregroundOverColor",selectedColor:"foregroundSelectedColor"}]},lightsIcon:{paths:[{path:d.lightsIcon,normalColor:"foregroundNormalColor",
overColor:"foregroundOverColor",selectedColor:"foregroundSelectedColor"}]},renderingModeIcon:{paths:[{path:d.renderingModeIcon,normalColor:"foregroundNormalColor",overColor:"foregroundOverColor",selectedColor:"foregroundSelectedColor"}]},graphicEffectsIcon:{paths:[{path:d.graphicEffectsIcon,normalColor:"foregroundNormalColor",overColor:"foregroundOverColor",selectedColor:"foregroundSelectedColor"}]},povIcon:{paths:[{path:d.squareBg,normalColor:"backgroundNormalColor",overColor:"backgroundOverColor",
selectedColor:"backgroundSelectedColor"},{path:d.povIcon,normalColor:"foregroundNormalColor",overColor:"foregroundOverColor",selectedColor:"foregroundSelectedColor"}]},povIconHandle:{paths:[{path:d.closeHandleMenuBot,normalColor:"backgroundNormalColor",overColor:"backgroundOverColor",selectedColor:"backgroundSelectedColor"}]},classicRendering:{paths:[{path:d.squareBgTransparent,normalColor:"borderColor",overColor:"borderColor",selectedColor:"borderColor",state:"opacity0.51"},{path:d.squareBgViews,
normalColor:"backgroundNormalColor",overColor:"backgroundOverColor",selectedColor:"backgroundSelectedColor"},{path:d.classicRenderingIcon,normalColor:"foregroundNormalColor",overColor:"foregroundOverColor",selectedColor:"foregroundSelectedColor",state:"stroke"}],size:"1100 1100"},wireFrameRendering:{paths:[{path:d.squareBgTransparent,normalColor:"borderColor",overColor:"borderColor",selectedColor:"borderColor",state:"opacity0.51"},{path:d.squareBgViews,normalColor:"backgroundNormalColor",overColor:"backgroundOverColor",
selectedColor:"backgroundSelectedColor"},{path:d.wireFrameRenderingIcon,normalColor:"foregroundNormalColor",overColor:"foregroundOverColor",selectedColor:"foregroundSelectedColor",state:"stroke"}],size:"1100 1100"},semiWireFrameRendering:{paths:[{path:d.squareBgTransparent,normalColor:"borderColor",overColor:"borderColor",selectedColor:"borderColor",state:"opacity0.51"},{path:d.squareBgViews,normalColor:"backgroundNormalColor",overColor:"backgroundOverColor",selectedColor:"backgroundSelectedColor"},
{path:d.semiWireFrameRenderingIcon,normalColor:"foregroundNormalColor",overColor:"foregroundOverColor",selectedColor:"foregroundSelectedColor",state:"stroke"}],size:"1100 1100"},goochRendering:{paths:[{path:d.squareBgTransparent,normalColor:"borderColor",overColor:"borderColor",selectedColor:"borderColor",state:"opacity0.51"},{path:d.squareBgViews,normalColor:"backgroundNormalColor",overColor:"backgroundOverColor",selectedColor:"backgroundSelectedColor"},{path:d.goochRenderingIcon,normalColor:"foregroundNormalColor",
overColor:"foregroundOverColor",selectedColor:"foregroundSelectedColor",state:"stroke"}],size:"1100 1100"},hatchingRendering:{paths:[{path:d.squareBgTransparent,normalColor:"borderColor",overColor:"borderColor",selectedColor:"borderColor",state:"opacity0.51"},{path:d.squareBgViews,normalColor:"backgroundNormalColor",overColor:"backgroundOverColor",selectedColor:"backgroundSelectedColor"},{path:d.hatchingRenderingIcon,normalColor:"foregroundNormalColor",overColor:"foregroundOverColor",selectedColor:"foregroundSelectedColor",
state:"stroke"}],size:"1100 1100"},ssaoEffect:{paths:[{path:d.squareBgTransparent,normalColor:"borderColor",overColor:"borderColor",selectedColor:"borderColor",state:"opacity0.51"},{path:d.squareBgViews,normalColor:"backgroundNormalColor",overColor:"backgroundOverColor",selectedColor:"backgroundSelectedColor"},{path:d.ssaoEffectIcon,normalColor:"foregroundNormalColor",overColor:"foregroundOverColor",selectedColor:"foregroundSelectedColor",state:"stroke"}],size:"1100 1100"},ssaoFilterEffect:{paths:[{path:d.squareBgTransparent,
normalColor:"borderColor",overColor:"borderColor",selectedColor:"borderColor",state:"opacity0.51"},{path:d.squareBgViews,normalColor:"backgroundNormalColor",overColor:"backgroundOverColor",selectedColor:"backgroundSelectedColor"},{path:d.ssaoFilterEffectIcon,normalColor:"foregroundNormalColor",overColor:"foregroundOverColor",selectedColor:"foregroundSelectedColor",state:"stroke"}],size:"1100 1100"},silhouetteEffect:{paths:[{path:d.squareBgTransparent,normalColor:"borderColor",overColor:"borderColor",
selectedColor:"borderColor",state:"opacity0.51"},{path:d.squareBgViews,normalColor:"backgroundNormalColor",overColor:"backgroundOverColor",selectedColor:"backgroundSelectedColor"},{path:d.silhouetteEffectIcon,normalColor:"foregroundNormalColor",overColor:"foregroundOverColor",selectedColor:"foregroundSelectedColor",state:"stroke"}],size:"1100 1100"},highLightEffect:{paths:[{path:d.squareBgTransparent,normalColor:"borderColor",overColor:"borderColor",selectedColor:"borderColor",state:"opacity0.51"},
{path:d.squareBgViews,normalColor:"backgroundNormalColor",overColor:"backgroundOverColor",selectedColor:"backgroundSelectedColor"},{path:d.highLightEffectIcon,normalColor:"foregroundNormalColor",overColor:"foregroundOverColor",selectedColor:"foregroundSelectedColor",state:"stroke"}],size:"1100 1100"},blurEffect:{paths:[{path:d.squareBgTransparent,normalColor:"borderColor",overColor:"borderColor",selectedColor:"borderColor",state:"opacity0.51"},{path:d.squareBgViews,normalColor:"backgroundNormalColor",
overColor:"backgroundOverColor",selectedColor:"backgroundSelectedColor"},{path:d.blurEffectIcon,normalColor:"foregroundNormalColor",overColor:"foregroundOverColor",selectedColor:"foregroundSelectedColor",state:"stroke"}],size:"1100 1100"},glowEffect:{paths:[{path:d.squareBgTransparent,normalColor:"borderColor",overColor:"borderColor",selectedColor:"borderColor",state:"opacity0.51"},{path:d.squareBgViews,normalColor:"backgroundNormalColor",overColor:"backgroundOverColor",selectedColor:"backgroundSelectedColor"},
{path:d.glowEffectIcon,normalColor:"foregroundNormalColor",overColor:"foregroundOverColor",selectedColor:"foregroundSelectedColor",state:"stroke"}],size:"1100 1100"},mirrorEffect:{paths:[{path:d.squareBgTransparent,normalColor:"borderColor",overColor:"borderColor",selectedColor:"borderColor",state:"opacity0.51"},{path:d.squareBgViews,normalColor:"backgroundNormalColor",overColor:"backgroundOverColor",selectedColor:"backgroundSelectedColor"},{path:d.mirrorEffectIcon,normalColor:"foregroundNormalColor",
overColor:"foregroundOverColor",selectedColor:"foregroundSelectedColor",state:"stroke"}],size:"1100 1100"},waterEffect:{paths:[{path:d.squareBgTransparent,normalColor:"borderColor",overColor:"borderColor",selectedColor:"borderColor",state:"opacity0.51"},{path:d.squareBgViews,normalColor:"backgroundNormalColor",overColor:"backgroundOverColor",selectedColor:"backgroundSelectedColor"},{path:d.waterEffectIcon,normalColor:"foregroundNormalColor",overColor:"foregroundOverColor",selectedColor:"foregroundSelectedColor",
state:"stroke"}],size:"1100 1100"},modeControlIcon:{paths:[{path:d.modeControlIcon,normalColor:"foregroundNormalColor",overColor:"foregroundOverColor",selectedColor:"foregroundSelectedColor"}]},doubleOrbit:{paths:[{path:d.squareBgTransparent,normalColor:"borderColor",overColor:"borderColor",selectedColor:"borderColor",state:"opacity0.51"},{path:d.squareBgViews,normalColor:"backgroundNormalColor",overColor:"backgroundOverColor",selectedColor:"backgroundSelectedColor"},{path:d.doubleOrbitIcon,normalColor:"foregroundNormalColor",
overColor:"foregroundOverColor",selectedColor:"foregroundSelectedColor",state:"stroke"}],size:"1100 1100"},trackBall:{paths:[{path:d.squareBgTransparent,normalColor:"borderColor",overColor:"borderColor",selectedColor:"borderColor",state:"opacity0.51"},{path:d.squareBgViews,normalColor:"backgroundNormalColor",overColor:"backgroundOverColor",selectedColor:"backgroundSelectedColor"},{path:d.trackBallIcon,normalColor:"foregroundNormalColor",overColor:"foregroundOverColor",selectedColor:"foregroundSelectedColor",
state:"stroke"}],size:"1100 1100"},freeFly:{paths:[{path:d.squareBgTransparent,normalColor:"borderColor",overColor:"borderColor",selectedColor:"borderColor",state:"opacity0.51"},{path:d.squareBgViews,normalColor:"backgroundNormalColor",overColor:"backgroundOverColor",selectedColor:"backgroundSelectedColor"},{path:d.freeFlyIcon,normalColor:"foregroundNormalColor",overColor:"foregroundOverColor",selectedColor:"foregroundSelectedColor",state:"stroke"}],size:"1100 1100"},topBottom:{paths:[{path:d.squareBgTransparent,
normalColor:"borderColor",overColor:"borderColor",selectedColor:"borderColor",state:"opacity0.51"},{path:d.squareBgViews,normalColor:"backgroundNormalColor",overColor:"backgroundOverColor",selectedColor:"backgroundSelectedColor"},{path:d.topBottomIcon,normalColor:"foregroundNormalColor",overColor:"foregroundOverColor",selectedColor:"foregroundSelectedColor",state:"stroke"}],size:"1100 1100"},planarFreefly:{paths:[{path:d.squareBgTransparent,normalColor:"borderColor",overColor:"borderColor",selectedColor:"borderColor",
state:"opacity0.51"},{path:d.squareBgViews,normalColor:"backgroundNormalColor",overColor:"backgroundOverColor",selectedColor:"backgroundSelectedColor"},{path:d.planarFreeflyIcon,normalColor:"foregroundNormalColor",overColor:"foregroundOverColor",selectedColor:"foregroundSelectedColor",state:"stroke"}],size:"1100 1100"},changeModelIcon:{paths:[{path:d.changeModelIcon,normalColor:"foregroundNormalColor",overColor:"foregroundOverColor",selectedColor:"foregroundSelectedColor"}]},changeBackgroundIcon:{paths:[{path:d.changeBackgroundIcon,
normalColor:"foregroundNormalColor",overColor:"foregroundOverColor",selectedColor:"foregroundSelectedColor"},{path:d.changeBackgroundBorderIcon,normalColor:"foregroundNormalColor",overColor:"foregroundOverColor",selectedColor:"foregroundSelectedColor"}]},reload3DIcon:{paths:[{path:d.rotateIcon,normalColor:"foregroundNormalColor",overColor:"foregroundOverColor",selectedColor:"foregroundSelectedColor"}]},lightsDisplayIcon:{paths:[{path:d.lightsIcon,normalColor:"foregroundNormalColor",overColor:"foregroundOverColor",
selectedColor:"foregroundSelectedColor"}]},positionGridIcon:{paths:[{path:d.positionGridIcon,normalColor:"foregroundNormalColor",overColor:"foregroundOverColor",selectedColor:"foregroundSelectedColor"}]}}};u.prototype.verifyInclusion=function(b,d,g){return 0<b.x&0<b.y&b.x+d.width<g.getWidth()&&b.y+d.height<g.getHeight()?!0:!1};u.prototype.loadFile=function(b,d,g){stage.ajax.get(b,null,{async:!0,onLoad:d,onError:stage.setContext(g,this),onTimeout:stage.setContext(g,this),onAbort:stage.setContext(g,
this)})};return function(b,d){return new u(b,d)}});stage.provide("emersya.viewer");viewerImagesReady=!0;
stage.register.call(stage.emersya,"viewer",function(){var b={ORTHOGRAPHIC:1,PERSPECTIVE:2},d={DOUBLEORBIT:1,TRACKBALL:2,FREEFLY:4,TOPBOTTOM:8,PLANARFREEFLY:16},u={OFF:0,OFF_ON_MOBILE:1,ON:2},k={OFF:0,OFF_ON_DESKTOP:1,ON:2,SMOOTH:3},l={PREVIEW:1,VIEWER:2,CONFIGURATOR:3},g={ui:{backgroundColor:"#FFFFFF",backgroundImagePath:"",backgroundOpacity:1,backgroundImageOpacity:1,fittingMethod:1,autoStart:!0,playMode:"ROTATE",autoPlay:!1,stop3DButton:!1,displayMain3DButton:!0,displayScrollingElement:!1,emersyaLogo:!1,
defaultLogo:!0,customerLogoPath:"",logoHorizontalPosition:2,clickableLogo:!0,mouseGrab:!0,hideAnnotations:!1,hideTriggers:!1,hideTriggersDuringAnimation:!1,hidePreview:!1,startWithFallback:!1,devMode:!1,watermarkOpacity:1,mainFont:"",presets:{display:!1,mode:0,position:0},loader:{enabled:!0,borderRadius:10,fontSize:13,displayLogo:!1,loaderType:0},startingTutorial:{enabled:!0,displayAfterLoading:!0},handTutorial:{enabled:!1},menu:{position:"left",enabled:!0,opened:!1,offset:!1,displayTriggers:!1,displayAnnotations:!1,
displayFullScreen:!1,displayZoomIn:!1,displayZoomOut:!1,displayMove:!1,displayRotate:!1,displayHelper:!1,displayViews:!1,displayPlay:!1,displayResetAnimation:!1,toggleable:!0},help:{enabled:!0,touchInteraction:!0,mouseMoveInteraction:!0,mouseWheelInteraction:!0,mouseButtonInteraction:!0},style:{backgroundOverColor:"#00b1abff",backgroundNormalColor:"#303030DD",backgroundSelectedColor:"#000000DD",foregroundOverColor:"#ffffffff",foregroundNormalColor:"#ffffffff",foregroundSelectedColor:"#00b1abff",neutralOverColor:"#888888ff",
neutralNormalColor:"#888888ff",neutralSelectedColor:"#00b1abff",borderColor:"#ffffff30",logoNeutralColor:"",isColorful:!1},ar:{arMainColor:"#00b1abff",arSecondColor:"#ffffff",displayAr:!1,displayArShareOnSocialNetworkButton:!1,displayArDownloadRenderButton:!1,displayArAnimationMenu:!1,displayArMenu:!1,displayArStartButton:!1,arVideoOpacity:.5,arPhotoOpacity:.5,arEmersyaEnabled:1,arMoveAroundEnabled:0,arAutostart:!1,arBackgroundLandscapeImageType:0,arBackgroundLandscapeImagePath:"",arBackgroundPortraitImageType:0,
arBackgroundPortraitImagePath:"",arSimplifiedMode:!1,enableCustomPrivacyPolicyMessage:!1,customEmersyaPrivacyPolicyMessage:"",customWearablePrivacyPolicyMessage:"",customPrivacyPolicyValidationMessage:""},annotations:{enabled:!0,annotationsMode:"ONEBYONE",annotationsHeightCase:"AUTO",hiddenPinOpacity:.35,openingEventType:0,moveOnClick:!0,descriptionFont:"",titleFont:""},configurator:{enabled:!0},fallback:{type:1,position:"bottom",alignment:"center",useDynamicThumbnails:!1},viewerSettingsFonts:[],
fontsPath:""},data:{jsShowcase:!1,serverURL:"",saveRequestsServerURL:null,preloadFiles:!1,modelsPath:"",dataPath:"",projectGraphPath:"",projectDefaultPath:"",projectConfigurationPath:"",projectJsonPath:"",loadingDate:"none",sceneryPath:"",animationsPath:"",watchPath:"",modularConfiguratorPath:"",modularConfiguratorFurnitureMode:!1,projectFurniturePath:"",wearableARPath:"",plannerPath:"",arVFOV:"",arHFOV:"",OS:"",viewerFallbackPath:"",fallbackPath:"",configuratorPath:"",statisticCode:"",presetsPath:"",
annotationsPath:"",translationsPaths:[],translated:!1,fallbackOnly:!1,startingPreset:"",routing:"",isReplay:!1,replayLink:"",configurationCode:"",configurationMetadataPath:"",routeViewerVersionNumber:0,routeProjectVersionNumber:0,viewerVersionNumber:0,projectVersionNumber:0,loadedFromConfiguration:!1,featuresLevel:1,viewPointsLibraryFilePath:"",viewerSettingsFilePath:"",companyName:"",arRouting:"",genericConfigurator:null,commerce:{managePrice:!1,manageStock:!1,currency:{name:"",isoCode:"",symbol:"",
decimals:4},store:{name:"",code:""},blueprint:{name:"",code:"",filePath:"",rulesFilePath:"",components:[]},product:{id:null,name:"",code:"",sku:"",gtin:"",reference:"",configFilePath:"",taxes:[],limitedOffers:[]}}},camera:{position:[5,5,5],target:[0,0,0],up:[0,1,0],fov:40,adaptativeFov:!1,offset:{x:0,y:0},dynamicClippingPlanes:!0,staticViewpoint:!0,planes:{near:.1,far:100},minZoomRatio:.1,maxZoomRatio:100,xTranslation:!0,yTranslation:!0,projectionMode:b.PERSPECTIVE,controlMode:d.DOUBLEORBIT,controlSettings:{xRotationMin:-2*
Math.PI,xRotationMax:2*Math.PI,yRotationMin:-.49999*Math.PI,yRotationMax:.49999*Math.PI,targetRange:1.5,targetAxes:[1,1,1]},autoRotateSpeed:20,clockwise:!0,accelerationMode:u.ON,moveOnDoubleClick:!0},peripherals:{listeningTo:{keyboard:!0,mouseButtons:!0,mouseMove:!0,mouseWheel:!0,touch:!0},wheelOnCtrl:!1,oneFingerScroll:!1},fallback:{type:1,imageFormat:"",displayMessage:!1,verticalDivisor:0,horizontalDivisor:0,horizontalLineStart:-1,verticalColumnStart:-1},rendering:{directContextLostHandling:!1,
renderSSAO:!0,filterSSAO:!0,depthAndNormalsReduction:1,ssaoReduction:1,ssaoIterations:8,ssaoIntensity:.5,ssaoRadius:.3,ssaoThickness:.05,ssaoIntensity2:.5,ssaoRadius2:1,ssaoThickness2:1.5,screenSpaceReflectDistance:0,screenSpaceRefractDistance:0,ssaoEmissiveThreshold:0,ssaoOpacityThreshold:1,ssaoNormalDisplacement:!1,graininess:0,grainOnStop:k.OFF_ON_DESKTOP,minimumQuality:1,targetFramerate:15,furQualityHD:2,noMaterialTransitions:!1},downloads:{cache:!0},i18n:{lang:null}},q=function(b,h){this.settings=
stage.extend(!0,{},g,h);this.container=b;b=$$stage(this.container);this.uiCoreContainer=b.build([{returnActive:!0,tagName:"div",attributes:{style:"position:absolute;top:0;left:0;width:100%; height : 100%;"}}]).get(0);this.rendererContainer=b.build([{returnActive:!0,tagName:"div",attributes:{style:"z-index:2;position:absolute;top:0;left:0;width:100%; height : 100%;"}}]).get(0);this.firstLoad=!0;this.inFullScreen=!1;this.routing=this.settings.data.routing;this.statisticId=window.viewerStatCode;setTimeout(stage.setContext(function(){stage.listen(window,
"unload",stage.setContext(this.destroy,this),!1)},this),5);(void 0===window.viewerImagesReady||window.viewerImagesReady)&&this.initialize();window.emViewerReady=!0};q.prototype.destroy=function(){if(this.destroyed)console.error("Double ViewerCore destruction."),console.trace();else{this.API.exec(this.callerName,"dlm.abort");this.statistics&&(this.statistics.destroy(),this.statistics=null);this.i18n&&(this.i18n.destroy(),this.i18n=null);this.lib&&(this.lib.destroy(),this.lib=null);this.uiCore&&(this.uiCore.destroy(),
this.uiCore=null);if(this.renderer){var b=this.API.exec(this.callerName,"rdr.getCurrentScene");this.renderer.destroy();this.renderer=null;b&&b.texturesManager&&b.texturesManager.setGlContext(null);b&&b.destroy()}this.sceneBase&&(this.sceneBase.destroy(),this.sceneBase=null);this.fallback&&(this.fallback.destroy(),this.fallback=null);this.sceneParser&&(this.sceneParser.destroy(),this.sceneParser=null);this.initializer&&(this.initializer.destroy(),this.initializer=null);this.peripherals&&(this.peripherals.destroy(),
this.peripherals=null);this.sceneModifier&&(this.sceneModifier.destroy(),this.sceneModifier=null);this.sceneControls&&(this.sceneControls.destroy(),this.sceneControls=null);this.sceneryControls&&(this.sceneryControls.destroy(),this.sceneryControls=null);this.downloadManager&&(this.downloadManager.destroy(),this.downloadManager=null);this.animationControls&&(this.animationControls.destroy(),this.animationControls=null);this.sceneConfiguration&&(this.sceneConfiguration.destroy(),this.sceneConfiguration=
null);this.platformConfigurator&&(this.platformConfigurator.destroy(),this.platformConfigurator=null);this.watchesControls&&(this.watchesControls.destroy(),this.watchesControls=null);this.modularConfigurator&&(this.modularConfigurator.destroy(),this.modularConfigurator=null);this.ofmlMaster&&(this.ofmlMaster.destroy(),this.ofmlMaster=null);this.productConfigurator&&(this.productConfigurator.destroy(),this.productConfigurator=null);this.iframeConfigurator&&(this.iframeConfigurator.destroy(),this.iframeConfigurator=
null);this.iframeApplication&&(this.iframeApplication.destroy(),this.iframeApplication=null);this.iframeColorSwitch&&(this.iframeColorSwitch.destroy(),this.iframeColorSwitch=null);this.iframeBase&&(this.iframeBase.destroy(),this.iframeBase=null);this.iframeAPI&&(this.iframeAPI.destroy(),this.iframeAPI=null);this.sharingManager&&(this.sharingManager.destroy(),this.sharingManager=null);this.arCore&&(this.arCore.destroy(),this.arCore=null);this.deviceDetection&&(this.deviceDetection.destroy(),this.deviceDetection=
null);this.jsShowcaseApi&&(this.jsShowcaseApi=null);this.featureLevel1&&(this.featureLevel1.destroy(),this.featureLevel1=null);this.featureLevel2&&(this.featureLevel2.destroy(),this.featureLevel2=null);this.featureLevel3&&(this.featureLevel3.destroy(),this.featureLevel3=null);this.featureLevel4&&(this.featureLevel4.destroy(),this.featureLevel4=null);this.furnitureFeatureLevel&&(this.furnitureFeatureLevel.destroy(),this.furnitureFeatureLevel=null);this.dlManager&&(this.dlManager.destroy(),this.dlManager=
null);this.watchControls&&(this.watchControls.destroy(),this.watchControls=null);this.API&&(this.API.unregister(this,"getContainer"),this.API.unregister(this,"setContainerClass"),this.API.unregister(this,"removeScene"),this.API.unregister(this,"toggleFullScreen"),this.API.unregister(this,"onNativeFullScreenChanged"),this.API.unregister(this,"isInFullscreen"),this.API.unregister(this,"launch3D"),this.API.unregister(this,"disable3D"),this.API.unregister(this,"preloadFiles"),this.API.unregister(this,
"init.downloadError"),this.API.unregister(this,"init.sceneBaseLoaded"),this.API.unregister(this,"init.sceneLoaded"),this.API.unregister(this,"3DRenderingConfirm"),this.API.unregister(this,"init.scenePreloaded"),this.API.unregister(this,"startRendering"),this.API.unregister(this,"encodeImage"),this.API.unregister(this,"destroyViewer"),this.API.unregister(this,"resetRendererMinimumQualityAndTargetFramerate"),this.API.unregister(this,"setLoadingDate"),this.API.unregister(this,"webGlContextLost"),this.API.unregister(this,
"webGlHardwareLimitedError"),this.API.unregister(this,"fileLoaded"),this.API.unregister(this,"fileDownloadError"),this.API.unregister(this,"fileProgress"),this.API.unregister(this,"renderingWorking"),this.API.unregister(this,"removeFallback"),this.API.unregister(this,"texturesManager.downloadError"),this.API.unregister(this,"renderingError"),this.API.unregister(this,"reInitCamera"),this.API.unregister(this,"removeArModules"),this.API.unregister(this,"fallbackReady"),this.API.unregister(this,"getSceneBase"),
this.API.unregister(this,"buildLoadingFilePath"),this.API.unregister(this,"getArAvailability"),this.API.unregister(this,"resetAr"),this.API.destroy(),this.API=null);this.destroyed=!0;stage.unListen(window,"unload")}};q.prototype.initialize=function(){this.firstGlOtherError=this.firstGlMemoryError=!0;if(this.settings.data.fallbackOnly){if(!D.call(this)){console.error("Failed to initialize ViewerCore 2D modules");this.destroy();return}this.startingWithFallback=!0;r.call(this)}else{if(!n.call(this)){console.error("Failed to initialize ViewerCore modules");
this.destroy();return}65536!==this.API.exec(this.callerName,"getWebGLState")?(this.startingWithFallback=!0,r.call(this),this.API.exec(this.callerName,"ui.showErrorMessage",this.API.exec(this.callerName,"translate","webGlMissingOrDisabledErrorMessage"))):(this.API.register(this,"renderingWorking",h),this.API.register(this,"3DRenderingConfirm",t),(this.startingWithFallback=this.settings.ui.startWithFallback||!1)?(this.startingWithFallback=!0,r.call(this)):(this.uiCore&&this.API.exec(this.callerName,
"ui.initialize"),this.settings.data.preloadFiles&&""!==this.settings.data.projectGraphPath&&r.call(this)))}setTimeout(stage.setContext(this.API.exec,this.API,this.callerName,"viewerReady"),0)};var t=function(b){},r=function(){this.downloadingSceneBase=!0;this.API.exec(this.callerName,"loadProject",{projectPath:this.settings.data.projectGraphPath,projectJsonPath:this.settings.data.projectJsonPath,projectDefaultGraphPath:this.settings.data.projectDefaultPath,projectConfigurationPath:this.settings.data.projectConfigurationPath,
sceneryPath:this.settings.data.sceneryPath,animationsPath:this.settings.data.animationsPath,translationsPaths:this.settings.data.translated?this.settings.data.translationsPaths:[],watchPath:this.settings.data.watchPath,modularConfiguratorPath:this.settings.data.modularConfiguratorPath,wearableARPath:this.settings.data.wearableARPath,plannerPath:this.settings.data.plannerPath,configuratorPath:this.settings.data.configuratorPath,projectFurniturePath:this.settings.data.projectFurniturePath,presetsPath:this.settings.data.presetsPath,
annotationsPath:this.settings.data.annotationsPath,fallbackPath:this.settings.data.fallbackPath,productBlueprintFile:this.settings.data.commerce.blueprint.filePath,productBlueprintRulesFile:this.settings.data.commerce.blueprint.rulesFilePath,productConfigFile:this.settings.data.commerce.product.configFilePath,viewPointsLibraryFilePath:this.settings.data.viewPointsLibraryFilePath,viewerSettingsFilePath:this.settings.data.viewerSettingsFilePath},!0)},f=function(b){this.API.exec(this.callerName,"ui.updateLoader",
0,1);this.API.exec(this.callerName,"ui.showLoader");this.API.exec(this.callerName,"ui.showStartingTutorial");this.API.exec(this.callerName,"loadProject",{projectPath:b.projectPath,projectJsonPath:b.projectJsonPath,projectDefaultGraphPath:b.projectDefaultGraphPath,projectConfigurationPath:b.projectConfigurationPath,sceneryPath:b.sceneryPath,animationsPath:b.animationsPath,translationsPaths:b.translated?b.translationsPaths:[],watchPath:b.watchPath,modularConfiguratorPath:b.modularConfiguratorPath,projectFurniturePath:b.projectFurniturePath,
wearableARPath:b.wearableARPath,plannerPath:b.plannerPath,configuratorPath:b.configuratorPath,presetsPath:b.presetsPath,annotationsPath:b.annotationsPath,fallbackPath:b.fallbackPath,viewPointsLibraryFilePath:b.viewPointsLibraryFilePath,viewerSettingsFilePath:b.viewerSettingsFilePath},!0)};q.prototype.load=function(b,h){this.settings.data.projectGraphPath="";this.settings.data.projectJsonPath="";window.viewerVersion=b.viewerVersion;this.settings.data.routing=b.routingCode;this.settings.data.loadingDate=
parseInt(b.loadingDate);""!=b.statisticCode&&(this.settings.data.statisticCode=b.statisticCode,this.statistics&&(this.statistics.destroy(),this.statistics=new Statistics({minUpdateInterval:4E3,updateInterval:12E3,updateIntervalMaximum:6E4,updateIntervalIncrement:4E3,updateAfterLoadedInterval:1E4,updateAfterLoadedIntervalMaximum:6E4,updateAfterLoadedIntervalIncrement:6E3,startingPreset:b.startingPreset,statisticCode:b.statisticCode}),this.statistics.listenToAPI(this.API)),this.API.exec(this.callerName,
"setStatId",b.statisticCode));this.API.exec(this.callerName,"viewerReady");La(b);var d=ra(b);h&&(b.hidePreview=!1,b.preview=!0,b.previewImage=h);this.sceneParser.settings.dataPath=b.dataPath;this.sceneConfiguration.settings.presetsPath=b.dataPath;this.sceneConfiguration.settings.materialTreesGroupsPath=b.dataPath;this.initializer.settings.dataPath=b.dataPath;this.iframeBase&&(this.iframeBase.settings.routing=b.routingCode);this.iframeConfigurator&&(this.iframeConfigurator.settings.routing=b.routingCode);
this.iframeApplication&&(this.iframeApplication.settings.routing=b.routingCode);this.API.exec(this.callerName,"setRouting",b.routingCode);this.API.exec(this.callerName,"updateRoutes",{routeViewerVersionNumber:b.routeViewerVersionNumber,routeProjectVersionNumber:b.routeProjectVersionNumber,viewerVersionNumber:b.viewerVersionNumber,projectVersionNumber:b.projectVersionNumber,loadedFromConfiguration:b.loadedFromConfiguration});this.fallback.settings.fallbackPath=b.fallbackPath;this.fallback.settings.projectPath=
b.projectPath;this.fallback.settings.projectDefaultGraphPath=b.projectDefaultGraphPath;this.fallback.settings.presetsPath=b.presetsPath;this.fallback.settings.configuratorPath=b.configuratorPath;this.fallback.settings.translationsPaths=b.translated?b.translationsPaths:[];this.API.exec(this.callerName,"stopAr");b.displayAr?(this.API.exec(this.callerName,"setArRouting",b.arRouting),h=Sa.call(this,b),this.arCore?this.arCore.updateSettings(h):Ja.call(this,h)):this.arCore&&(this.arCore.destroy(),delete this.arCore);
this.API.exec(this.callerName,"removeGroupsAndPresets");this.uiCore.settings.fittingMethod=b.fittingMethod;if(65536!==this.API.exec(this.callerName,"getWebGLState"))this.startingWithFallback=!0,this.API.exec(this.callerName,"prph.initialize"),f.call(this,b);else{this.API.exec(this.callerName,"ui.setFonts",b.viewerFonts);this.API.exec(this.callerName,"ui.setFonts",b.viewerSettingsFonts);this.API.exec(this.callerName,"ui.loadUI",d);this.sceneBase=null;if(this.firstLoad&&(!b.hidePreview&&b.preview&&
b.previewImage||b.backgroundImage)){this.API.exec(this.callerName,"ui.hideLoader");this.API.exec(this.callerName,"ui.hideStartingTutorial");this.API.exec(this.callerName,"ui.hideMenu");this.API.exec(this.callerName,"ui.hideHelp");this.API.exec(this.callerName,"ui.hideLogo");this.API.exec(this.callerName,"ui.hideAnnotation");this.API.exec(this.callerName,"ui.hideConfigurator");this.API.exec(this.callerName,"ui.hideStartButton");this.API.exec(this.callerName,"ui.hideDisable3DButton");this.uiCore.settings.autoStart=
!0;var e=0;d=stage.setContext(function(){--e||(this.uiCore.previewImage=document.getElementById("viewerPreviewImage"),this.uiCore.backgroundImage=document.getElementById("viewerBackgroundImage"),this.uiCore.previewImage&&this.uiCore.previewImage.naturalWidth?this.uiCore.previewImageElement=$$stage(this.uiCore.previewImage):this.uiCore.previewImage=null,this.uiCore.backgroundImageElement=$$stage(this.uiCore.backgroundImage),this.API.exec(this.callerName,"domChange"),this.API.exec(this.callerName,"ui.showPreview"),
this.API.exec(this.callerName,"ui.showBackground"),this.API.exec(this.callerName,"launch3D",b))},this);b.hidePreview||""==b.previewImage||(++e,h=document.getElementById("viewerPreviewImage"),h.onload=d,h.src=b.previewImage,$$stage(h).css("{opacity : "+b.previewOpacity));""!=b.backgroundImage&&(++e,this.backgroundImg=document.getElementById("viewerBackgroundImage"),this.backgroundImg.onload=d,this.backgroundImg.src=b.backgroundImage)}else""!=b.backgroundImage&&(this.backgroundImg=document.getElementById("viewerBackgroundImage"),
this.backgroundImg.src=b.backgroundImage),this.API.exec(this.callerName,"launch3D",b);this.sceneControls&&void 0!==b.staticViewpoint&&this.sceneControls.updateSettings({camera:{staticViewpoint:b.staticViewpoint}});var m=this.API.exec(this.callerName,"rdr.getCurrentScene");this.API.registerOnce(this,"setScene",function(h){m&&m!=h&&m.destroy();if(h){this.API.exec(this.callerName,"setAnnotationsMode",b.annotationsMode);this.API.exec(this.callerName,"setAnnotationsHeightCase",b.annotationsHeightCase);
this.API.exec(this.callerName,"setAnnotationsHiddenPinOpacity",b.hiddenPinOpacity);this.API.exec(this.callerName,"setAnnotationsOpeningEventType",b.annotationsOpeningEventType);this.API.exec(this.callerName,"setAnnotationsMoveOnClick",b.moveCameraOnClick);this.API.exec(this.callerName,"setViewerPlayMode",b.playMode);this.API.exec(this.callerName,"setMoveOnClick",b.moveOnDoubleClick);this.API.exec(this.callerName,"setFonts",b.viewerSettingsFonts);this.API.exec(this.callerName,"prph.listen",{keyboard:b.keyboardInteraction,
mouseButtons:b.mouseButtonInteraction,mouseMove:b.mouseMoveInteraction,mouseWheel:b.mouseWheelInteraction,touch:b.touchInteraction});this.iframeConfigurator&&(this.iframeConfigurator.settings.projectVersionNumber=b.projectVersionNumber);""!==b.backgroundImage?this.API.exec(this.callerName,"setBackground",b.backgroundColor,b.backgroundOpacity,this.backgroundImg,b.fittingMethod,{x:.5+b.screenOffsetX,y:.5+b.screenOffsetY},b.backgroundImageOpacity):(this.API.exec(this.callerName,"removeBackgroundImage"),
this.API.exec(this.callerName,"setBackground",b.backgroundColor,b.backgroundOpacity));this.API.exec(this.callerName,"rdr.toggleSSAO",b.renderSSAO);this.API.exec(this.callerName,"rdr.toggleSSAOFiltering",b.filterSSAO);this.API.exec(this.callerName,"rdr.setSsaoReduction",parseInt(b.ssaoReduction));this.API.exec(this.callerName,"rdr.setSsaoIntensity",parseFloat(b.ssaoIntensity));this.API.exec(this.callerName,"rdr.setSsaoRadius",parseFloat(b.ssaoRadius));this.API.exec(this.callerName,"rdr.setSsaoThickness",
parseFloat(b.ssaoThickness));this.API.exec(this.callerName,"rdr.setSsaoIntensity2",parseFloat(b.ssaoIntensity2));this.API.exec(this.callerName,"rdr.setSsaoRadius2",parseFloat(b.ssaoRadius2));this.API.exec(this.callerName,"rdr.setSsaoThickness2",parseFloat(b.ssaoThickness2));this.API.exec(this.callerName,"rdr.setSsaoEmissiveThreshold",parseFloat(b.ssaoEmissiveThreshold));this.API.exec(this.callerName,"rdr.setSsaoOpacityThreshold",parseFloat(b.ssaoOpacityThreshold));this.API.exec(this.callerName,"rdr.setSsaoNormalDisplacement",
b.ssaoNormalDisplacement);this.API.exec(this.callerName,"rdr.setGraininess",parseFloat(b.graininess));this.API.exec(this.callerName,"rdr.setGrainOnStop",parseFloat(b.grainOnStop));this.API.exec(this.callerName,"rdr.setScreenSpaceReflectDistance",parseFloat(b.ssrDistance));this.API.exec(this.callerName,"rdr.setScreenSpaceRefractDistance",parseFloat(b.ssRefractDistance));this.API.exec(this.callerName,"setAccelerationMode",b.accelerationMode);this.API.exec(this.callerName,"rdr.setMinimumQualityAndTargetFramerate",
b.minimumQuality,b.targetFramerate);var d=[{position:[b.cameraPositionX,b.cameraPositionY,b.cameraPositionZ],up:[b.cameraUpX,b.cameraUpY,b.cameraUpZ],target:[b.objectPositionX,b.objectPositionY,b.objectPositionZ],fov:b.fov,t:0}];this.arCore&&this.arCore.arActive||this.API.exec(this.callerName,"startAnimatingPath",d,!1,!0,stage.setContext(function(){this.API.exec(this.callerName,"reInitCamera")},this));this.API.exec(this.callerName,"setAnimations",h);this.API.exec(this.callerName,"startRendering");
this.firstLoad=!1;h.update()}})}};var n=function(){if(stage.emersya.viewer.modules.API.core)p.call(this);else return console.error("No API core registered."),!1;if(stage.emersya.viewer.modules.API.featureLevel1){var b={statisticId:this.statisticId,startingPreset:this.settings.data.startingPreset,serverURL:this.settings.data.saveRequestsServerURL?this.settings.data.saveRequestsServerURL:this.settings.data.serverURL,routing:this.settings.data.routing,arRouting:this.settings.data.arRouting,extensions:{productConfigurator:stage.emersya.viewer.modules.productConfigurator?
!0:!1}};this.featureLevel1=new stage.emersya.viewer.modules.API.featureLevel1(b,this.API)}stage.emersya.viewer.modules.API.featureLevel2&&(b={statisticId:this.statisticId,startingPreset:this.settings.data.startingPreset,serverURL:this.settings.data.saveRequestsServerURL?this.settings.data.saveRequestsServerURL:this.settings.data.serverURL,routing:this.settings.data.routing},this.featureLevel2=new stage.emersya.viewer.modules.API.featureLevel2(b,this.API));stage.emersya.viewer.modules.API.featureLevel3&&
(b={statisticId:this.statisticId,serverURL:this.settings.data.saveRequestsServerURL?this.settings.data.saveRequestsServerURL:this.settings.data.serverURL,routing:this.settings.data.routing},this.featureLevel3=new stage.emersya.viewer.modules.API.featureLevel3(b,this.API));stage.emersya.viewer.modules.API.featureLevel4&&(b={statisticId:this.statisticId,startingPreset:this.settings.data.startingPreset,serverURL:this.settings.data.saveRequestsServerURL?this.settings.data.saveRequestsServerURL:this.settings.data.serverURL,
routing:this.settings.data.routing},this.featureLevel4=new stage.emersya.viewer.modules.API.featureLevel4(b,this.API));stage.emersya.viewer.modules.API.furnitureFeatureLevel&&(b={serverURL:this.settings.data.saveRequestsServerURL?this.settings.data.saveRequestsServerURL:this.settings.data.serverURL},this.furnitureFeatureLevel=new stage.emersya.viewer.modules.API.furnitureFeatureLevel(b,this.API));stage.emersya.viewer.modules.API.iframe&&G.call(this);stage.emersya.viewer.modules.lib?Y.call(this):console.warn("No library module registered.");
if(stage.emersya.viewer.modules.i18n)S.call(this);else return console.error("No Translation module registered."),!1;window.viewerStatistics&&ia.call(this);stage.emersya.viewer.modules.platformConfigurator?this.platformConfigurator=new stage.emersya.viewer.modules.platformConfigurator(this.API,{}):console.warn("No Platform Configurator registered.");stage.emersya.viewer.modules.deviceDetection?this.deviceDetection=new stage.emersya.viewer.modules.deviceDetection(this.API,{vfov:this.settings.data.arVFOV,
hfov:this.settings.data.arHFOV,os:this.settings.data.OS}):console.warn("No Device Detection registered.");if(stage.emersya.viewer.modules.downloadManager)ta.call(this);else return console.error("No download manager registered."),!1;stage.emersya.viewer.modules.peripherals?la.call(this):console.warn("No peripherals registered.");stage.emersya.viewer.modules.ui.core?ba.call(this):console.warn("No Core UI registered.");stage.emersya.viewer.modules.sceneParser?Fa.call(this):console.warn("No Scene Parser registered.");
stage.emersya.viewer.modules.sceneConfiguration&&P.call(this);stage.emersya.viewer.modules.initializer?xa.call(this):console.warn("No scene initializer registered.");stage.emersya.viewer.modules.productConfigurator&&(this.productConfigurator=new stage.emersya.viewer.modules.productConfigurator(this.API,{currency:this.settings.data.commerce.currency,product:this.settings.data.commerce.product,blueprint:this.settings.data.commerce.blueprint,store:this.settings.data.commerce.store,manageStock:this.settings.data.commerce.manageStock,
managePrice:this.settings.data.commerce.managePrice}));65536===this.API.exec(this.callerName,"getWebGLState")&&(stage.emersya.viewer.modules.renderer||console.warn("No WebGL Renderer registered."),stage.emersya.viewer.modules.sceneControls||console.warn("No Scene Controls registered."),stage.emersya.viewer.modules.sceneryControls?this.sceneryControls=new stage.emersya.viewer.modules.sceneryControls(this.API,{serverURL:this.settings.data.serverURL,background:{color:this.settings.ui.backgroundColor,
opacity:this.settings.ui.backgroundOpacity,image:null,imageOpacity:this.settings.ui.backgroundImageOpacity,imageOffset:{x:.5,y:.5},imageFitting:this.settings.ui.fittingMethod}}):console.warn("No Scenery Controls registered."),stage.emersya.viewer.modules.animationControls&&(this.animationControls=new stage.emersya.viewer.modules.animationControls(this.API,{})),stage.emersya.viewer.modules.sceneModifier&&(this.sceneModifier=new stage.emersya.viewer.modules.sceneModifier(this.API,{})),stage.emersya.viewer.modules.watchControls&&
(this.watchControls=new stage.emersya.viewer.modules.watchControls(this.API,{})),stage.emersya.viewer.modules.modularConfigurator&&(this.settings.data.modularConfiguratorFurnitureMode&&viewerOfmlMaster&&(this.ofmlMaster=new viewerOfmlMaster(this.API)),this.modularConfigurator=new stage.emersya.viewer.modules.modularConfigurator(this.API,this.uiCoreContainer,{furnitureMode:this.settings.data.modularConfiguratorFurnitureMode})),stage.emersya.viewer.modules.genericConfigurator&&this.settings.data.genericConfigurator&&
stage.emersya.viewer.modules.modularConfigurator&&(stage.emersya.viewer.modules.modularConfigurator.isConfiguratorUIDisabled=!0),stage.emersya.viewer.modules.sharingManager&&(this.sharingManager=new stage.emersya.viewer.modules.sharingManager(this.API,{})),B.call(this));stage.emersya.viewer.modules.fallback?Ba.call(this):console.warn("No Fallback registered.");K.call(this);return!0},B=function(b){if(b||!this.arModulesRemoved)stage.emersya.viewer.modules.arCore&&this.settings.ui.ar.displayAr&&Ja.call(this),
this.API.register(this,"removeArModules",w),this.arModulesRemoved=!1},w=function(){this.arModulesRemoved||(this.arCore&&(this.arCore.destroy(),this.arCore=null),this.arModulesRemoved=!0,this.API.unregister(this,"removeArModules"))},D=function(){if(stage.emersya.viewer.modules.API.core)p.call(this);else return console.error("No API core registered."),!1;stage.emersya.viewer.modules.API.iframe&&G.call(this);if(stage.emersya.viewer.modules.lib)Y.call(this);else return console.error("No library module registered."),
!1;if(stage.emersya.viewer.modules.i18n)S.call(this);else return console.error("No Translation module registered."),!1;window.viewerStatistics&&ia.call(this);stage.emersya.viewer.modules.platformConfigurator?this.platformConfigurator=new stage.emersya.viewer.modules.platformConfigurator(this.API,{}):console.error("No Platform Configurator registered.");if(stage.emersya.viewer.modules.downloadManager)ta.call(this);else return console.error("No download manager registered."),!1;stage.emersya.viewer.modules.peripherals?
la.call(this):console.warn("No peripherals registered.");stage.emersya.viewer.modules.ui.core?ba.call(this):console.warn("No Core UI registered.");stage.emersya.viewer.modules.sceneParser?Fa.call(this):console.warn("No Scene Parser registered.");stage.emersya.viewer.modules.initializer?xa.call(this):console.warn("No scene initializer registered.");stage.emersya.viewer.modules.sceneConfiguration&&P.call(this);stage.emersya.viewer.modules.fallback?Ba.call(this):console.warn("No Fallback registered.");
K.call(this);return!0},A=function(b){this.errorAlreadyHandled||(this.errorAlreadyHandled=!0,this.launchFromFallback&&this.API.exec(this.callerName,"removeFallback"),this.API.exec(this.callerName,"disable3D"),this.API.exec(this.callerName,"ui.showErrorMessage",b))},H=function(b){console.log(b.desc);A.call(this,this.API.exec(this.callerName,"translate","webGlHardwareLimitedErrorMessage"))},e=function(b){console.error(b.emError[0].desc);var h=!(!stage.emersya.viewer.modules.renderer.lightsEditor&&!stage.emersya.collaborativeDesignManager);
switch(b.emError[0].code){case 204:h?A.call(this,this.API.exec(this.callerName,"translate","webGlContextLost")):E.call(this);break;case 205:this.firstGlMemoryError&&!h?(this.firstGlMemoryError=!1,E.call(this,this.API.exec(this.callerName,"translate","webGlMemoryLimitErrorMessage"),this.API.exec(this.callerName,"translate","clickHereToRestart3DOnce"))):A.call(this,this.API.exec(this.callerName,"translate","webGlMemoryLimitErrorMessage"));break;case 206:A.call(this,this.API.exec(this.callerName,"translate",
"webGlHardwareLimitedErrorMessage"));break;default:this.firstGlOtherError&&!h?(this.firstGlOtherError=!1,E.call(this,this.API.exec(this.callerName,"translate","webGlErrorMessage"),this.API.exec(this.callerName,"translate","clickHereToRestart3DOnce"))):A.call(this,this.API.exec(this.callerName,"translate","webGlErrorMessage"))}},E=function(b,h){this.API.exec(this.callerName,"dlm.abort",!1);void 0===b&&(b=this.API.exec(this.callerName,"translate","webGlContextLostButReloadable"));void 0===h&&(h=this.API.exec(this.callerName,
"translate","clickHereToRestart3D"));this.API.exec(this.callerName,"ui.showErrorMessage",b,h,"launch3D");this.API.exec(this.callerName,"disable3D");this.initializer.loadToGl=!1;this.API.registerOnce(this,"init.scenePreloaded",F)},F=function(){Ha.call(this);this.API.exec(this.callerName,"rdr.initShaders");this.API.exec(this.callerName,"loadToGl");this.API.exec(this.callerName,"ui.launch3D")},p=function(){this.name="Viewer";this.callerName="ViewerCore";this.API=new stage.emersya.viewer.modules.API.core({});
this.API.register(this,"getContainer",J,!0);this.API.register(this,"setContainerClass",M);this.API.register(this,"removeScene",T);this.API.register(this,"toggleFullScreen",R);this.API.register(this,"onNativeFullScreenChanged",aa);this.API.register(this,"isInFullscreen",C,!0);this.API.register(this,"launch3D",Z);this.API.register(this,"disable3D",L);this.API.register(this,"preloadFiles",I);this.API.register(this,"init.scenePreloaded",v);this.API.register(this,"getSceneBase",U,!0);this.API.register(this,
"destroyViewer",this.destroy);this.API.register(this,"startRendering",m);this.API.register(this,"resetRendererMinimumQualityAndTargetFramerate",Ga);this.API.register(this,"encodeImage",Ya,!0);this.API.register(this,"setLoadingDate",Ra);this.API.register(this,"buildLoadingFilePath",ma,!0);this.API.register(this,"resetAr",bb);this.API.register(this,"getArAvailability",gb,!0)},m=function(){this.renderingStarted=!0},h=function(){},v=function(){this.preloading=!1;this.preloaded=!0},I=function(b){!b&&this.settings.data.preloadFiles||
this.preloading||this.preloaded||this.renderingStarted||(this.preloading=!0,this.API.exec(this.callerName,"loadProjectModelsAndImages",this.sceneBase,!1))},J=function(){return this.container},M=function(b){this.currentContainerClass&&$$stage(this.container).removeClass(this.currentContainerClass);this.currentContainerClass=b;$$stage(this.container).addClass(b);this.API.exec(this.callerName,"domChange")},T=function(){this.API.exec(this.callerName,"dlm.abort");var b=this.API.exec(this.callerName,"rdr.getCurrentScene");
this.API.exec(this.callerName,"setScene",null);b&&b.destroy();this.sceneParser.settings.dataPath=this.settings.data.dataPath;this.sceneConfiguration.settings.presetsPath=this.settings.data.dataPath;this.sceneConfiguration.settings.materialTreesGroupsPath=this.settings.data.dataPath;this.initializer.settings.dataPath=this.settings.data.dataPath;this.initializer.currentlyLoading=!1},U=function(){return this.sceneBase},R=function(b){b?this.inFullScreen&&(document.exitFullscreen?document.exitFullscreen():
document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen()):this.inFullScreen||(this.container.requestFullscreen?this.container.requestFullscreen():this.container.msRequestFullscreen?this.container.msRequestFullscreen():this.container.webkitRequestFullScreen?this.container.webkitRequestFullscreen():window.open(window.location.href))},aa=function(){this.inFullScreen=!this.inFullScreen},C=function(){return this.inFullScreen},L=function(b,
h){h=void 0===h?!0:h;if(!stage.emersya.appManager&&!stage.emersya.collaborativeDesignManager){var d=this.API.exec(this.callerName,"rdr.getCurrentScene");this.threeDDisabled=!0;if(d||b){b=!b;h=void 0===h?!0:h;this.API.exec(this.callerName,"dlm.abort",!1);d=this.API.exec(this.callerName,"getCamera");w.call(this);var e=this.API.exec(this.callerName,"rdr.getCurrentScene");e&&(this.API.exec(this.callerName,"setScene",null),this.sceneToReload=e,this.API.exec(this.callerName,"toggleAnnotations","annotations",
!1),this.API.exec(this.callerName,"toggleAnnotations","triggers",!1),this.API.exec(this.callerName,"ui.hideMenu"),this.API.exec(this.callerName,"ui.showPreview"),this.API.exec(this.callerName,"ui.showBackground"),this.API.exec(this.callerName,"hideArButton"),this.API.exec(this.callerName,"ui.hideStartingTutorial"),this.API.exec(this.callerName,"ui.hideHandTutorial",!0));this.sceneControls&&(this.sceneControls.destroy(),this.sceneControls=null);this.renderer&&(this.renderer.destroy(),this.renderer=
null);this.API.exec(this.callerName,"prph.initialize");this.API.exec(this.callerName,"prph.toggleMouseWheel",!1);this.API.exec(this.callerName,"prph.toggleTouch",!1);this.API.exec(this.callerName,"displayFallback",b,d,h)}else this.API.exec(this.callerName,"prph.initialize"),this.startingWithFallback=!0,this.sceneBase?this.API.exec(this.callerName,"displayFallback",65536===this.API.exec(this.callerName,"getWebGLState")):r.call(this)}},K=function(){if(this.settings.data.jsShowcase){var b={id:this.container.id,
featuresLevel:this.settings.data.featuresLevel,routeViewerVersionNumber:this.settings.data.routeViewerVersionNumber,routeProjectVersionNumber:this.settings.data.routeProjectVersionNumber,viewerVersionNumber:this.settings.data.viewerVersionNumber,projectVersionNumber:this.settings.data.projectVersionNumber,loadedFromConfiguration:this.settings.data.loadedFromConfiguration,fallbackOnly:this.settings.data.fallbackOnly,serverURL:this.settings.data.saveRequestsServerURL?this.settings.data.saveRequestsServerURL:
this.settings.data.serverURL,statisticId:this.statisticId,arAvailable:this.settings.ui.ar.displayAr,fontsPath:this.settings.ui.fontsPath,fonts:this.settings.ui.viewerSettingsFonts,routing:this.settings.data.routing,viewer:this,projectPath:this.settings.data.projectGraphPath.substring(0,this.settings.data.projectGraphPath.lastIndexOf("/")+1)};this.jsShowcaseApi=new emersyaApi(this.API,b)}},G=function(){this.iframeAPI=new stage.emersya.viewer.modules.API.iframe(this.API,{routeViewerVersionNumber:this.settings.data.routeViewerVersionNumber,
routeProjectVersionNumber:this.settings.data.routeProjectVersionNumber,viewerVersionNumber:this.settings.data.viewerVersionNumber,projectVersionNumber:this.settings.data.projectVersionNumber,loadedFromConfiguration:this.settings.data.loadedFromConfiguration,serverURL:this.settings.data.saveRequestsServerURL?this.settings.data.saveRequestsServerURL:this.settings.data.serverURL});stage.emersya.viewer.modules.API.iframeBase&&(this.iframeBase=new stage.emersya.viewer.modules.API.iframeBase(this.API,this.iframeAPI,
{routing:this.settings.data.routing,fallbackOnly:this.settings.data.fallbackOnly,statisticId:this.statisticId}));stage.emersya.viewer.modules.API.iframeRender&&new stage.emersya.viewer.modules.API.iframeRender(this.iframeBase);stage.emersya.viewer.modules.API.iframeColorSwitch&&(this.iframeColorSwitch=new stage.emersya.viewer.modules.API.iframeColorSwitch(this.API,this.iframeAPI));stage.emersya.viewer.modules.API.iframeConfigurator&&(this.iframeConfigurator=new stage.emersya.viewer.modules.API.iframeConfigurator(this.API,
this.iframeAPI,{fonts:this.settings.ui.viewerSettingsFonts,fontsPath:this.settings.ui.fontsPath,projectPath:this.settings.data.projectGraphPath.substring(0,this.settings.data.projectGraphPath.lastIndexOf("/")+1),routing:this.settings.data.routing,projectVersionNumber:this.settings.data.projectVersionNumber,viewer:this,statisticId:this.statisticId,currentPreset:this.settings.data.startingPreset}));stage.emersya.viewer.modules.API.iframeApplication&&(this.iframeApplication=new stage.emersya.viewer.modules.API.iframeApplication(this.API,
this.iframeAPI,{fonts:this.settings.ui.viewerSettingsFonts,fontsPath:this.settings.ui.fontsPath,routing:this.settings.data.routing,statisticId:this.statisticId}))},S=function(){this.i18n=new stage.emersya.viewer.modules.i18n(this.API,{lang:this.settings.i18n.lang})},Y=function(){var b={};stage.extend(!0,b,this.settings.ui.style);this.lib=new stage.emersya.viewer.modules.lib(this.API,b)},ia=function(){this.API.register(this,"setStatId",Q);this.statistics=window.viewerStatistics();this.statistics.listenToAPI(this.API)},
Q=function(b){this.statisticId=b},ta=function(){var b={timeout:15E3,cache:this.settings.downloads.cache,retries:4};this.API.register(this,"fileLoaded",ua);this.API.register(this,"fileDownloadError",ea);this.API.register(this,"fileProgress",oa);this.dlManager=new stage.emersya.viewer.modules.downloadManager(this.API,b)},ua=function(b,h){},ea=function(b,h){A.call(this,this.API.exec(this.callerName,"translate","fileDownloadErrorMessage"))},oa=function(b,h){},ba=function(){var b=document.getElementById("viewerBackgroundImage");
b&&this.API.exec(this.callerName,"setBackgroundImage",b);this.settings.data.projectGraphPath&&this.API.register(this,"uiReady",ka);this.settings.ui.dataPath=this.settings.data.dataPath;this.settings.ui.isReplay=this.settings.data.isReplay;this.settings.ui.replayLink=this.settings.data.replayLink;this.settings.ui.wheelOnCtrl=this.settings.peripherals.wheelOnCtrl;this.settings.ui.adaptativeFov=this.settings.camera.adaptativeFov;this.settings.ui.featuresLevel=this.settings.data.featuresLevel;this.settings.ui.startingPreset=
this.settings.data.startingPreset;this.settings.ui.oneFingerScroll=this.settings.peripherals.oneFingerScroll;this.settings.ui.configurationCode=this.settings.data.configurationCode;this.settings.ui.loadingDate=this.settings.data.loadingDate;this.settings.ui.companyName=this.settings.data.companyName;this.uiCore=new stage.emersya.viewer.modules.ui.core(this.API,this.uiCoreContainer,this.settings.ui)},ka=function(){this.readyToLoad=!0},Z=function(b){this.settings.data.fallbackOnly||(this.initializer?
this.API.exec(this.callerName,"ui.isReady")?(this.launched=!0,this.threeDDisabled=!1,b?f.call(this,b):this.firstLoad&&""==this.settings.data.projectGraphPath||(this.sceneToReload?setTimeout(stage.setContext(da,this),0):(this.launchFromFallback&&(this.API.exec(this.callerName,"hidePreview"),this.API.exec(this.callerName,"prph.toggleMouseWheel",this.settings.peripherals.listeningTo.mouseWheel),this.API.exec(this.callerName,"prph.toggleTouch",this.settings.peripherals.listeningTo.touch)),this.API.register(this,
"init.sceneLoaded",qa),this.sceneBase?(this.settings.data.preloadFiles||this.preloading||this.preloaded||this.API.exec(this.callerName,"loadProjectModelsAndImages",this.sceneBase,!0),Ha.call(this),this.API.exec(this.callerName,"loadToGl",this.sceneBase),this.API.exec(this.callerName,"rdr.initShaders")):(this.API.registerOnce(this,"setSceneBase",function(b){this.settings.data.preloadFiles||this.preloading||this.preloaded||this.API.exec(this.callerName,"loadProjectModelsAndImages",b,!0);Ha.call(this);
this.API.exec(this.callerName,"loadToGl",b);this.API.exec(this.callerName,"rdr.initShaders")}),this.downloadingSceneBase||r.call(this)),this.API.exec(this.callerName,"ui.launch3D")))):this.API.exec(this.callerName,"ui.initialize"):console.error("No initializer to load 3D."))},da=function(){this.API.exec(this.callerName,"ui.showBasicLoader");Ha.call(this);B.call(this,!0);this.API.exec(this.callerName,"rdr.initShaders");this.sceneToReload.prepareScene();this.sceneToReload.loadMaterials();this.sceneToReload.texturesManager.setGlContext(this.API.exec(this.callerName,
"rdr.getWebGLContext"));this.sceneToReload.texturesManager.updateStartingRequirements();this.sceneToReload.texturesManager.eventsManager.listen(this,"startingTexturesReady",X);this.sceneToReload.texturesManager.loadStartingTextures(!0,!0)},X=function(){this.sceneToReload.texturesManager.eventsManager.detachEvent("startingTexturesReady",X);this.API.exec(this.callerName,"rdr.initSceneBuffers",this.sceneToReload);this.API.exec(this.callerName,"rdr.updateSceneMaterials",this.sceneToReload);this.API.exec(this.callerName,
"rdr.updateSceneLights",this.sceneToReload);this.API.exec(this.callerName,"rdr.updateShaders",this.sceneToReload);this.API.exec(this.callerName,"rdr.updateSceneLights",this.sceneToReload);this.API.exec(this.callerName,"rdr.updateShaders",this.sceneToReload);this.API.exec(this.callerName,"ui.hideBasicLoader");this.API.exec(this.callerName,"ui.launch3D");this.launchFromFallback&&this.API.exec(this.callerName,"removeFallback");this.API.exec(this.callerName,"setScene",this.sceneToReload);this.API.exec(this.callerName,
"setAnimations",this.sceneToReload);this.API.exec(this.callerName,"prph.toggleMouseWheel",this.settings.peripherals.listeningTo.mouseWheel);this.API.exec(this.callerName,"prph.toggleTouch",this.settings.peripherals.listeningTo.touch);this.API.exec(this.callerName,"startRendering");this.sceneToReload=null},Ha=function(){try{if(!this.renderer){this.API.register(this,"webGlHardwareLimitedError",H);this.API.register(this,"webGlContextLost",E);var b={statId:this.statisticId,container:this.rendererContainer,
canvasWidth:$$stage(this.container).getWH()[1],canvasHeight:$$stage(this.container).getWH()[0],renderEditionMode:!1};stage.extend(!0,b,this.settings.rendering);this.API.exec(this.callerName,"updateRendererSettings",b);this.renderer=new stage.emersya.viewer.modules.renderer.core(this.API,b);this.API.unregister(this,"setStatId")}if(!this.sceneControls){this.API.register(this,"renderingError",e);this.API.register(this,"reInitCamera",fa);var h={camera:{position:this.settings.camera.position,target:this.settings.camera.target,
up:this.settings.camera.up,screenOffset:this.settings.camera.offset,fov:this.settings.camera.fov,dynamicClippingPlanes:this.settings.camera.dynamicClippingPlanes,staticViewpoint:this.settings.camera.staticViewpoint,planes:this.settings.camera.planes},adaptativeFov:this.settings.camera.adaptativeFov,minZoomRatio:this.settings.camera.minZoomRatio,maxZoomRatio:this.settings.camera.maxZoomRatio,translateX:this.settings.camera.xTranslation,translateY:this.settings.camera.yTranslation,autoRotateSpeed:this.settings.camera.autoRotateSpeed,
clockwise:this.settings.camera.clockwise,startingControlMode:this.settings.camera.controlMode,startingProjectionMode:this.settings.camera.projectionMode,acceleration:this.settings.camera.accelerationMode,hdOnStopMode:this.settings.rendering.hdOnStopMode,moveOnClick:this.settings.camera.moveOnDoubleClick};if(this.launchFromFallback){var d=this.API.exec(this.callerName,"getCamera");d&&(h.camera.position=d.position,h.camera.target=d.target,h.camera.up=d.up,h.camera.fov=d.fov)}this.API.exec(this.callerName,
"updateRendererSettings",h);switch(this.settings.camera.controlMode){case stage.emersya.viewer.SCENE_CONTROL.DOUBLEORBIT:h.doubleOrbitSettings=this.settings.camera.controlSettings;break;case stage.emersya.viewer.SCENE_CONTROL.TRACKBALL:h.trackBallSettings=this.settings.camera.controlSettings;break;case stage.emersya.viewer.SCENE_CONTROL.FREEFLY:case stage.emersya.viewer.SCENE_CONTROL.PLANARFREEFLY:h.freeFlySettings=this.settings.camera.controlSettings}this.sceneControls=new stage.emersya.viewer.modules.sceneControls(this.API,
this.renderer,h)}this.API.exec(this.callerName,"rdr.setBackgroundColor",this.settings.ui.backgroundColor,this.settings.ui.backgroundOpacity);this.settings.ui.backgroundImagePath?this.API.exec(this.callerName,"setBackgroundImage",this.uiCore.backgroundImage):this.API.exec(this.callerName,"rdr.removeBackgroundImage")}catch(Aa){console.log(Aa),this.API.exec(this.callerName,"webGlHardwareLimitedError",Aa.errors.emError[0])}},Ga=function(){this.API.exec(this.callerName,"rdr.setMinimumQualityAndTargetFramerate",
this.settings.minimumQuality,this.settings.targetFramerate)},Fa=function(){this.sceneParser=new stage.emersya.viewer.modules.sceneParser(this.API,{dataPath:this.settings.data.dataPath,modelsPath:this.settings.data.modelsPath,dracoDecoderModule:this.dracoDecoderModule})},xa=function(){this.initializer=new stage.emersya.viewer.modules.initializer(this.API,{modelsPath:this.settings.data.modelsPath,dataPath:this.settings.data.dataPath,serverURL:this.settings.data.serverURL});this.API.register(this,"init.downloadError",
Va);this.API.register(this,"texturesManager.downloadError",va);this.API.register(this,"init.sceneBaseLoaded",Ia);this.settings.data.projectGraphPath||65536!==this.API.exec(this.callerName,"getWebGLState")||(Ha.call(this),this.API.register(this,"init.sceneLoaded",function(b){this.API.exec(this.callerName,"setScene",b)}),this.API.exec(this.callerName,"rdr.initShaders"),this.API.exec(this.callerName,"ui.hideBackground"),this.API.exec(this.callerName,"startRendering"),this.API.exec(this.callerName,"ui.hideDisable3DButton"))},
Ia=function(b){this.downloadingSceneBase=!1;this.sceneBase=b;this.API.exec(this.callerName,"setSceneBase",b);b.isSimpleModel||(this.startingWithFallback?this.API.exec(this.callerName,"displayFallback",!this.settings.data.fallbackOnly&&65536===this.API.exec(this.callerName,"getWebGLState"),null,!1):""!==this.settings.data.projectGraphPath?this.settings.data.preloadFiles&&I.call(this,!0):this.API.exec(this.callerName,"loadProjectModelsAndImages",this.sceneBase,!0))},qa=function(b){this.threeDDisabled||
(this.firstLoad=!1,setTimeout(stage.setContext(function(){this.API.unregister(this,"init.sceneLoaded");this.API.register(this,"init.sceneLoaded",function(b){this.API.exec(this.callerName,"setScene",b)})},this),1),this.launchFromFallback&&this.API.exec(this.callerName,"removeFallback",b),this.API.exec(this.callerName,"setScene",b),this.API.exec(this.callerName,"startRendering"),this.API.exec(this.callerName,"setAnimations",b),b.watch&&this.API.exec(this.callerName,"setWatch",b.watch),b.productData&&
this.API.exec(this.callerName,"setProduct"))},Va=function(b){A.call(this,this.API.exec(this.callerName,"translate","initializerDownloadErrorMessage"))},va=function(b){A.call(this,this.API.exec(this.callerName,"translate","texturesManagerDownloadError"))},la=function(){this.peripherals=new stage.emersya.viewer.modules.peripherals(this.API,this.rendererContainer,this.settings.peripherals)},fa=function(){this.sceneControls&&(this.settings.camera.position=this.sceneControls.camera.position,this.settings.camera.target=
this.sceneControls.camera.target,this.settings.camera.up=this.sceneControls.camera.up)},P=function(){this.sceneConfiguration=new stage.emersya.viewer.modules.sceneConfiguration(this.API,{noMaterialTransitions:this.settings.rendering.noMaterialTransitions,fonts:this.settings.ui.viewerSettingsFonts,fontsPath:this.settings.ui.fontsPath,configurationCode:this.settings.data.configurationCode,configurationMetadataPath:this.settings.data.configurationMetadataPath})},Ba=function(){this.fallback=new stage.emersya.viewer.modules.fallback(this.API,
this.rendererContainer,this.uiCoreContainer,{viewerFallback:{filePath:this.settings.data.viewerFallbackPath,imageFormat:this.settings.fallback.imageFormat,verticalDivisor:this.settings.fallback.verticalDivisor,horizontalDivisor:this.settings.fallback.horizontalDivisor,horizontalLineStart:this.settings.fallback.horizontalLineStart,verticalColumnStart:this.settings.fallback.verticalColumnStart,camera:{position:this.settings.camera.position,target:this.settings.camera.target,up:this.settings.camera.up}},
displayMessage:this.settings.ui.startWithFallback?!1:this.settings.fallback.displayMessage,type:this.settings.fallback.type,style:this.settings.ui.style,ui:this.settings.ui.fallback,force3DButton:this.settings.ui.stop3DButton,adaptativeFov:this.settings.camera.adaptativeFov,fallbackPath:this.settings.data.fallbackPath,statId:this.statisticId});this.API.register(this,"removeFallback",Ka);this.API.register(this,"fallbackReady",wa)},Ka=function(){this.launchFromFallback=!1},wa=function(b){b==l.VIEWER||
b==l.CONFIGURATOR?(this.API.exec(this.callerName,"prph.initialize"),this.API.exec(this.callerName,"prph.toggleTouch",this.settings.peripherals.listeningTo.touch)):(this.API.exec(this.callerName,"prph.toggleMouseWheel",!1),this.API.exec(this.callerName,"prph.toggleTouch",!1));this.launchFromFallback=!0;this.settings.data.preloadFiles&&I.call(this,!0)},Ja=function(b){this.arCore||(b||(b={serverURL:this.settings.data.saveRequestsServerURL?this.settings.data.saveRequestsServerURL:this.settings.data.serverURL,
backgroundColor:this.settings.ui.backgroundColor,backgroundOpacity:this.settings.ui.backgroundOpacity,menuEnabled:this.settings.ui.menu.enabled,backgroundImage:this.settings.ui.backgroundImagePath,adaptativeFov:this.settings.camera.adaptativeFov,cameraTarget:this.settings.camera.target,imageFitting:this.settings.ui.fittingMethod,imageOffset:{x:.5,y:.5},imageOpacity:this.settings.ui.backgroundImageOpacity,jsShowcase:this.settings.data.jsShowcase,routing:this.settings.data.routing,mainColor:this.settings.ui.ar.arMainColor,
secondColor:this.settings.ui.ar.arSecondColor,displayShareOnSocialNetworkButton:this.settings.ui.ar.displayArShareOnSocialNetworkButton,displayDownloadRenderButton:this.settings.ui.ar.displayArDownloadRenderButton,displayAnimationMenu:this.settings.ui.ar.displayArAnimationMenu,displayPresetMenu:this.settings.ui.presets.display&&2<=this.settings.data.featuresLevel,displayMenu:this.settings.ui.ar.displayArMenu,displayArStartButton:this.settings.ui.ar.displayArStartButton,videoOpacity:this.settings.ui.ar.arVideoOpacity,
photoOpacity:this.settings.ui.ar.arPhotoOpacity,arEmersyaEnabled:this.settings.ui.ar.arEmersyaEnabled,arAutostart:this.settings.ui.ar.arAutostart,arMoveAroundEnabled:this.settings.ui.ar.arMoveAroundEnabled,arSimplifiedMode:this.settings.ui.ar.arSimplifiedMode,realTimeRefraction:0<this.settings.ui.ar.realTimeRefraction,arRouting:this.settings.data.arRouting,arBackgroundLandscapeImageType:this.settings.ui.ar.arBackgroundLandscapeImageType,arBackgroundLandscapeImagePath:this.settings.ui.ar.arBackgroundLandscapeImagePath,
arBackgroundPortraitImageType:this.settings.ui.ar.arBackgroundPortraitImageType,arBackgroundPortraitImagePath:this.settings.ui.ar.arBackgroundPortraitImagePath,displayPrivacyPolicyMessage:this.settings.ui.ar.displayPrivacyPolicyMessage,enableCustomPrivacyPolicyMessage:this.settings.ui.ar.enableCustomPrivacyPolicyMessage,customEmersyaPrivacyPolicyMessage:this.settings.ui.ar.customEmersyaPrivacyPolicyMessage,customWearablePrivacyPolicyMessage:this.settings.ui.ar.customWearablePrivacyPolicyMessage,customPrivacyPolicyValidationMessage:this.settings.ui.ar.customPrivacyPolicyValidationMessage}),
this.arCore=new stage.emersya.viewer.modules.arCore(this.API,this.iframeAPI,this.rendererContainer,this.uiCoreContainer,b))},La=function(b){b.autoRotateSpeed=parseFloat(b.autoRotateSpeed);b.backgroundOpacity=parseFloat(b.backgroundOpacity);b.backgroundImageOpacity=parseFloat(b.backgroundImageOpacity);b.cameraPositionX=parseFloat(b.cameraPositionX);b.cameraPositionY=parseFloat(b.cameraPositionY);b.cameraPositionZ=parseFloat(b.cameraPositionZ);b.cameraUpX=parseFloat(b.cameraUpX);b.cameraUpY=parseFloat(b.cameraUpY);
b.cameraUpZ=parseFloat(b.cameraUpZ);b.depthAndNormalsReduction=parseFloat(b.depthAndNormalsReduction);b.fittingMethod=parseInt(b.fittingMethod);b.hidePreview=b.hidePreview?!0:!1;b.hiddenPinOpacity=parseFloat(b.hiddenPinOpacity);b.annotationsOpeningEventType=parseInt(b.annotationsOpeningEventType);b.horizontalDivisor=parseFloat(b.horizontalDivisor);b.horizontalLineStart=parseFloat(b.horizontalLineStart);b.loaderBorderRadius=parseFloat(b.loaderBorderRadius);b.loaderFontSize=parseFloat(b.loaderFontSize);
b.minimumQuality=parseFloat(b.minimumQuality);b.offsetMenu=parseFloat(b.offsetMenu);b.projectMetaTitleFormat=parseFloat(b.projectMetaTitleFormat);b.screenOffsetX=parseFloat(b.screenOffsetX);b.screenOffsetY=parseFloat(b.screenOffsetY);b.ssaoIterations=parseFloat(b.ssaoIterations);b.ssaoReduction=parseFloat(b.ssaoReduction);b.ssaoIntensity=parseFloat(b.ssaoIntensity);b.ssaoRadius=parseFloat(b.ssaoRadius);b.ssaoThickness=parseFloat(b.ssaoThickness);b.ssaoIntensity2=parseFloat(b.ssaoIntensity2);b.ssaoRadius2=
parseFloat(b.ssaoRadius2);b.ssaoThickness2=parseFloat(b.ssaoThickness2);b.ssaoEmissiveThreshold=parseFloat(b.ssaoEmissiveThreshold);b.ssaoOpacityThreshold=parseFloat(b.ssaoOpacityThreshold);b.ssaoNormalDisplacement=b.ssaoNormalDisplacement?!0:!1;b.targetFramerate=parseInt(b.targetFramerate);b.graininess=parseFloat(b.graininess);b.grainOnStop=parseInt(b.grainOnStop);b.screenSpaceReflectDistance=parseFloat(b.screenSpaceReflectDistance);b.screenSpaceRefractDistance=parseFloat(b.screenSpaceRefractDistance);
b.verticalColumnStart=parseFloat(b.verticalColumnStart);b.verticalDivisor=parseFloat(b.verticalDivisor);b.accelerationMode=parseInt(b.accelerationMode);b.routeViewerVersionNumber=parseInt(b.routeViewerVersionNumber);b.routeProjectVersionNumber=parseInt(b.routeProjectVersionNumber);b.viewerVersionNumber=parseInt(b.viewerVersionNumber);b.projectVersionNumber=parseInt(b.projectVersionNumber)},ra=function(b){return{auto_play:b.autoPlay,auto_start3d:b.autoStart,border_color:b.borderColor.replace("#",""),
clockwise:b.clockwise,default_language_code:"en-us",defined_views:b.displayViews,display_annotations:b.displayAnnotations,display_emersya_logo:b.emersyaLogo,is_default_logo:b.defaultLogo,customer_logo_path:b.customerLogoPath,is_clickable_logo:b.clickableLogo,display_full_screen:b.displayFullScreen,display_helper:b.helperEnabled,display_loader:b.loader,display_menu:b.menu,display_move:b.displayMove,display_rotate:b.displayRotate,display_play:b.displayPlay,display_triggers:b.displayTriggers,display_zoom_in:b.displayZoomIn,
display_zoom_out:b.displayZoomOut,display_reset_animation:b.displayResetAnimation,keyboard_interactions:b.keyboardInteraction,logo_neutral_color:b.logoNeutralColor.replace("#",""),isColorful:b.theme?!0:!1,menu_opened:b.menuOpened,menu_position:b.menuPosition,mouse_button_interaction:b.mouseButtonInteraction,mouse_move_interaction:b.mouseMoveInteraction,mouse_wheel_interaction:b.mouseWheelInteraction,normal_background_color:b.backgroundNormalColor.replace("#",""),normal_foreground_color:b.foregroundNormalColor.replace("#",
""),normal_neutral_color:b.neutralNormalColor.replace("#",""),offset_menu:b.offsetMenu,over_background_color:b.backgroundOverColor.replace("#",""),over_foreground_color:b.foregroundOverColor.replace("#",""),over_neutral_color:b.neutralOverColor.replace("#",""),rotate_speed:b.autoRotateSpeed,selected_background_color:b.backgroundSelectedColor.replace("#",""),selected_foreground_color:b.foregroundSelectedColor.replace("#",""),selected_neutral_color:b.neutralSelectedColor.replace("#",""),stop3_d_button:b.stop3DButton,
display_main3_d_button:b.displayMain3DButton,display_scrolling_element:b.displayScrollingElement,display_hand_tutorial:b.displayHandTutorial,touch_interaction:b.touchInteraction,loaderBorderRadius:b.loaderBorderRadius,loaderFontSize:b.loaderFontSize,display_loader_logo:b.displayLoaderLogo,display_loader_icon:b.displayStartingTutorial,display_loader_icon_after_loading:b.displayStartingTutorialAfterLoading,loader_type:b.loaderType,ar_main_color:b.arMainColor.replace("#",""),ar_second_color:b.arSecondColor.replace("#",
""),display_ar_share_on_social_network_button:b.displayArShareOnSocialNetworkButton,display_ar_download_render_button:b.displayArDownloadRenderButton,display_ar_animation_menu:b.displayArAnimationMenu,display_ar_menu:b.displayArMenu,display_ar_start_button:b.displayArStartButton,mainFont:b.mainFont,watermark_opacity:parseFloat(b.watermarkOpacity)}},Sa=function(b){return{serverURL:this.settings.data.saveRequestsServerURL?this.settings.data.saveRequestsServerURL:this.settings.data.serverURL,backgroundColor:b.backgroundColor,
backgroundOpacity:b.backgroundOpacity,menuEnabled:b.menu,backgroundImage:b.backgroundImage,adaptativeFov:b.adaptativeFov,cameraTarget:[b.objectPositionX,b.objectPositionY,b.objectPositionZ],imageFitting:b.fittingMethod,imageOffset:{x:.5,y:.5},imageOpacity:b.backgroundImageOpacity,jsShowcase:this.settings.data.jsShowcase,routing:b.routingCode,mainColor:b.arMainColor,secondColor:b.arSecondColor,displayShareOnSocialNetworkButton:b.displayArShareOnSocialNetworkButton,displayDownloadRenderButton:b.displayArDownloadRenderButton,
displayAnimationMenu:b.displayArAnimationMenu,displayPresetMenu:b.displayPresets&&2<=b.featuresLevel,displayMenu:b.displayArMenu,displayArStartButton:b.displayArStartButton,videoOpacity:b.arVideoOpacity,photoOpacity:b.arPhotoOpacity,arEmersyaEnabled:b.arEmersyaEnabled,arMoveAroundEnabled:b.arMoveAroundEnabled,arSimplifiedMode:b.arSimplifiedMode,realTimeRefraction:b.ssRefractDistance,arRouting:b.arRouting,arAutostart:b.arAutostart,arBackgroundLandscapeImageType:b.arBackgroundLandscapeImageType,arBackgroundLandscapeImagePath:b.arBackgroundLandscapeImagePath,
arBackgroundPortraitImageType:b.arBackgroundPortraitImageType,arBackgroundPortraitImagePath:b.arBackgroundPortraitImagePath,displayPrivacyPolicyMessage:b.arDisplayPrivacyPolicyMessage,enableCustomPrivacyPolicyMessage:b.arEnableCustomPrivacyPolicyMessage,customEmersyaPrivacyPolicyMessage:b.arCustomEmersyaPrivacyPolicyMessage,customWearablePrivacyPolicyMessage:b.arWearableCustomPrivacyPolicyMessage,customPrivacyPolicyValidationMessage:b.arCustomPrivacyPolicyValidationMessage}},Ya=function(b){return"**"+
this.statisticId+"**"+b},Ra=function(b){this.settings.data.loadingDate=b},ma=function(b,h){var d=b.indexOf("date=");-1!==d?b=b.substring(0,d):(b.indexOf("?"),-1===d&&(b+="?"));return this.settings.data.dataPath+b+"date="+(void 0!==h?h:this.settings.data.loadingDate)},bb=function(b){this.arCore&&(!b.displayAr||this.arCore.wearableAREnabled&&(!this.renderer.scene.wearableAR||!this.renderer.scene.wearableAR.enabled)||!this.arCore.wearableAREnabled&&this.renderer.scene.wearableAR&&this.renderer.scene.wearableAR.enabled)&&
(this.arCore.destroy(),delete this.arCore);b.displayAr&&(b=Sa.call(this,b),this.arCore?this.arCore.updateSettings(b):Ja.call(this,b))},gb=function(){return void 0!=this.arCore};return{core:q,modules:{ui:{designGroupsConfigurator:{}},API:{},renderer:{}},PROJECTION_MODES:b,SCENE_CONTROL:d,INTERACTION_TYPE:{NONE:0,TRANSLATION:1,ROTATION:2,ZOOM_IN:4,ZOOM_OUT:8,ZROTATION:16},HIGHTLIGHT_MODE:{NONE:0,COLOR:1,SILHOUETTE:2},RENDERING_MODES:{CLASSIC:1,FULL_WIREFRAME:2,SHARP_EDGES:3,GOOCH:4,FULLSPEC:5,FULLREFL:6,
UVS:7,UVS1:8,POLYCOLOR:9,MATSCOLOR:10,SEMI_WIREFRAME:11,RENDERING_ORDER:12,TEXTURED_SEMI_WIREFRAME:13},EDITION_MODES:{NONE:0,LIGHT:1,MESHES:2,MODULAR:4},MOUSE_CONTROL_MODES:{ROTATE:0,TRANSLATE:1},TRANSFORMATION_TOOLS:{NONE:0,SCALING:1,TRANSLATION:2,ROTATION:3},TEXTURE_CHANNEL:{R:1,G:2,B:3,A:4,RGB:5},BLENDING_MODE:{INTERPOLATIVE:0,ADDITIVE:1,MULTIPLICATIVE:2,MASK:3,DITHER:4},ACCELERATION_MODES:u,HD_ON_STOP_MODES:k,ANIMATIONS_ACCELERATION_MODES:{NONE:0,SQUARE:1,CUBIC:2,EXP:3,POLYNOMIAL5:4,HALFSINUSOIDAL:5,
QUARTERSINUSOIDAL:6,LINEAR:7},ANIMATIONS_TRIGGERS:{AUTO:0,TRIGGER:1,IFRAME:2,WATCH:3,PRODUCT_CONFIGURATOR:4},FALLBACK_TYPE:l,FALLBACK_UI_TYPE:{POINTS_BAR:1,VIEWPOINTS_LIST:2,THUMBNAIL_BAR:3,THUMBNAIL_TAB:4},PRODUCT_NODES_DRAG_MODE:{OVERED:1,KEPT:2},verbose:!1}});stage.provide("emersya.viewer.modules.API.core");
stage.register.call(stage.emersya.viewer.modules.API,"core",function(){var b={},d=function(d){this.settings=stage.extend(!0,{},b,d);this.eventsManager=stage.createEventsManager(this.settings);this.reg={};this.asyncFuncsByName={};this.syncFuncsByName={};this.asyncFuncsByName.findIndex=stage.setContext(function(b,d){for(var g in this[d])if(this[d][g].func===b.async[d])return g;return-1},this.asyncFuncsByName);this.syncFuncsByName.findIndex=stage.setContext(function(b,d){for(var g in this[d])if(this[d][g].func===
b.sync[d])return g;return-1},this.syncFuncsByName);this.onlyOnce={}};d.prototype.destroy=function(){this.onlyOnce={};this.reg={};this.asyncFuncsByName={};this.syncFuncsByName={}};d.prototype.register=function(b,d,l,g){void 0!==b.name&&null!==b.name||console.warn("apiCore registered object should have a name",b,d);this.reg[b.name]||(this.reg[b.name]={sync:{},async:{}});g?(this.reg[b.name].sync[d]&&this.unregister(b,d),this.syncFuncsByName[d]||(this.syncFuncsByName[d]=[]),this.reg[b.name].sync[d]=l,
this.syncFuncsByName[d].unshift({obj:b,func:l})):(this.reg[b.name].async[d]&&this.unregister(b,d),this.asyncFuncsByName[d]||(this.asyncFuncsByName[d]=[]),this.reg[b.name].async[d]=l,this.asyncFuncsByName[d].push({obj:b,func:l}))};d.prototype.registerOnce=function(b,d,l,g){this.register(b,d,l,g);this.onlyOnce[d]||(this.onlyOnce[d]=[]);this.onlyOnce[d].push(b)};d.prototype.unregister=function(b,d){void 0!==b.name&&null!==b.name||console.warn("apiCore unregistered object should have a name",b,d);if(this.reg[b.name]){var k=
this.reg[b.name];if(k.sync[d]){var g=this.syncFuncsByName.findIndex(k,d);-1!==g&&this.syncFuncsByName[d].splice(g,1);k.sync[d]=null}k.async[d]&&(g=this.asyncFuncsByName.findIndex(k,d),-1!==g&&this.asyncFuncsByName[d].splice(g,1),delete k.async[d])}this.onlyOnce[d]&&(b=this.onlyOnce[d].indexOf(b),-1!==b&&this.onlyOnce[d].splice(b,1))};d.prototype.exec=function(b,d){var k=null,g=d,q=Array.prototype.slice.call(arguments,2);this.eventsManager.fireEvent("onStatisticUpdate",b,d,q);if(this.asyncFuncsByName[g]||
this.syncFuncsByName[g]){if(this.syncFuncsByName[g]&&this.syncFuncsByName[g].length){var t=this.syncFuncsByName[g][0];k=t.func.apply(t.obj,q)}if(this.asyncFuncsByName[g])for(var r in this.asyncFuncsByName[g])t=this.asyncFuncsByName[g][r],t.func.apply(t.obj,q)}if(this.onlyOnce[g])for(r in q=[].concat(this.onlyOnce[g]),q)this.unregister(q[r],g);return k};return d});stage.provide("emersya.viewer.modules.platformConfigurator");
var webglStateMask={NONE:1,DISACTIVATED:2,HARD_LIMITED:4,VARYINGS:11,TEXTURE_UNITS:20,TEXTURE_SIZE:36,VERT_UNIFS:68,FRAG_UNIFS:132,CUBE_SIZE:260,BUGGED:512,VERT_BUGGED:1536,FRAG_BUGGED:2560,LINK_BUGGED:4608,MISSING_EXT:8192,FLOAT_TEXTURE:24576,STANDARD_DERIVATIVES:40960,OK:65536},unmaskedRendererWebGL="",webgl2Enabled=!1,updateWebGLState=function(){var b=0;if(window.WebGLRenderingContext){var d=document.createElement("canvas");try{webgl2Enabled=!1;var u=d.getContext("webgl2");if(u)(k=u.getExtension("WEBGL_debug_renderer_info"))&&
-1!==(unmaskedRendererWebGL=u.getParameter(k.UNMASKED_RENDERER_WEBGL).toLowerCase()).indexOf("mali")?(delete d,d=document.createElement("canvas"),u=d.getContext("webgl")||d.getContext("experimental-webgl")):webgl2Enabled=!0;else if(u=d.getContext("webgl")||d.getContext("experimental-webgl")){var k=u.getExtension("WEBGL_debug_renderer_info");k&&(unmaskedRendererWebGL=u.getParameter(k.UNMASKED_RENDERER_WEBGL).toLowerCase())}if(u){64>u.getParameter(u.MAX_FRAGMENT_UNIFORM_VECTORS)&&(b|=webglStateMask.FRAG_UNIFS);
8>u.getParameter(u.MAX_TEXTURE_IMAGE_UNITS)&&(b|=webglStateMask.TEXTURE_UNITS);6>u.getParameter(u.MAX_VARYING_VECTORS)&&(b|=webglStateMask.VARYINGS);4096>u.getParameter(u.MAX_TEXTURE_SIZE)&&(b|=webglStateMask.TEXTURE_SIZE);512>u.getParameter(u.MAX_CUBE_MAP_TEXTURE_SIZE)&&(b|=webglStateMask.CUBE_SIZE);64>u.getParameter(u.MAX_VERTEX_UNIFORM_VECTORS)&&(b|=webglStateMask.VERT_UNIFS);var l=u.createShader(u.VERTEX_SHADER),g=u.createShader(u.FRAGMENT_SHADER),q=(new Date).getTime();webgl2Enabled?(u.shaderSource(l,
"#version 300 es\n#define SHADER_VERSION "+q+"\nprecision highp float;\nin vec3 iwnuwvr;\nin vec3 tbnfgls;\nuniform mat4 doooosp;\nuniform mat4 xjmyxdv;\nuniform mat4 fbknquu;\nout vec3 vVertexColor;\nvoid main() {\ngl_Position = fbknquu * xjmyxdv * doooosp * vec4(iwnuwvr, 1.0);\nvVertexColor = tbnfgls;\n}"),u.shaderSource(g,"#version 300 es\n#define SHADER_VERSION "+q+"\nprecision highp float;\n#define FILTER_3X3\nuniform vec4 mcusrsu;\nin vec3 vVertexColor;\nout vec4 _gl_FragColor;\nvoid main() {\n_gl_FragColor.rgb = vVertexColor;\n_gl_FragColor.a = 1.0;\n}")):
(u.shaderSource(l,"precision highp float;\n#define SHADER_VERSION "+q+"\nattribute vec3 iwnuwvr;\nattribute vec3 tbnfgls;\nuniform mat4 doooosp;\nuniform mat4 xjmyxdv;\nuniform mat4 fbknquu;\nvarying vec3 vVertexColor;\nvoid main() {\ngl_Position = fbknquu * xjmyxdv * doooosp * vec4(iwnuwvr, 1.0);\nvVertexColor = tbnfgls;\n}"),u.shaderSource(g,"precision highp float;\n#define FILTER_3X3\n#define SHADER_VERSION "+q+"\nuniform vec4 mcusrsu;\nvarying vec3 vVertexColor;\nvoid main() {\ngl_FragColor.rgb = vVertexColor;\ngl_FragColor.a = 1.0;\n}"));
u.compileShader(l);u.compileShader(g);u.getShaderParameter(l,u.COMPILE_STATUS)||(b|=webglStateMask.VERT_BUGGED);u.getShaderParameter(g,u.COMPILE_STATUS)||(b|=webglStateMask.FRAG_BUGGED);var t=u.createProgram();u.attachShader(t,l);u.attachShader(t,g);u.linkProgram(t);u.getProgramParameter(t,u.LINK_STATUS)||u.isContextLost()||(b|=webglStateMask.LINK_BUGGED);u.deleteProgram(t);webgl2Enabled||u.getExtension("OES_standard_derivatives")||u.getExtension("OES_standard_derivatives")||u.getExtension("GL_OES_standard_derivatives")||
(b|=webglStateMask.STANDARD_DERIVATIVES);0==b&&(b=webglStateMask.OK)}else delete u,b=webglStateMask.DISACTIVATED}catch(r){console.log(r),b=webglStateMask.BUGGED}}else b=webglStateMask.NONE;return b},glState=updateWebGLState();
stage.register.call(stage.emersya.viewer.modules,"platformConfigurator",function(){var b={},d=function(d,t){this.settings=stage.extend(!0,{},b,t);this.apiCore=d;glState?this.webGLState=glState:k.call(this);this.name="Platform Configurator";this.callerName="PlatformConfigurator";this.apiCore.register(this,"updateRendererSettings",g,!0);this.apiCore.register(this,"getWebGLState",u,!0);this.apiCore.register(this,"updateWebGLState",k,!0);this.apiCore.register(this,"setFallbackFromViewer",l);this.apiCore.register(this,
"webGlContextLost",l)};d.prototype.destroy=function(){this.apiCore.unregister(this,"updateRendererSettings");this.apiCore.unregister(this,"getWebGLState");this.apiCore.unregister(this,"updateWebGLState");this.apiCore.unregister(this,"setFallbackFromViewer");this.apiCore.unregister(this,"webGlContextLost")};var u=function(){return this.webGLState},k=function(){return void 0!==this.webGLState?this.webGLState:glState?this.webGLState=glState:this.webGLState=glState=k()},l=function(){this.webGLState=webglStateMask.BUGGED},
g=function(b){var d=Math.max(window.devicePixelRatio,1);b.hdOnStop=!0;b.dynamicScaling=!0;b.smoothHdOnStop=!1;b.maximumScaling=d;b.minimumScaling=b.minimumQuality;1<b.minimumQuality&&(b.minimumScaling=1+(d-1)*(b.minimumQuality-1));b.minimumScaling>b.maximumScaling&&(d=b.maximumScaling,b.maximumScaling=b.minimumScaling,b.minimumScaling=d);b.targetFramerate=Math.max(.1,b.targetFramerate);(d=this.apiCore.exec(this.callerName,"getDevice"))&&d.isMobile||!webgl2Enabled||-1!==unmaskedRendererWebGL.indexOf("intel")?
(b.multisampling=!1,b.mipmappedEnvironment=!1):(b.multisampling=!0,b.mipmappedEnvironment=!0)};return d});stage.provide("emersya.viewer.modules.i18n");stage.require("emersya.viewer.modules.API.core");
languages={"en-us":{locale_name:"English",viewerObject:{disable3D:"Disable 3D",emersyaPowered:"Powered by Emersya",enable3D:"Enable 3D",help:"Help",ok:"OK",or:"or",pause:"Pause",play:"Play",playPauseAnimation:"Play/Pause animation",rotate:"Rotate",setFullscreen:"Set fullscreen",setLang:"Change language",start3D:"Start/Stop 3D",translate:"Move",view0:"Front view",view1:"Back view",view2:"Left view",view3:"Right view",view6:"Perspective",viewpoint:"Change viewpoint",views:"Change view",zoom:"Zoom",
zoomOut:"Zoom out",zoomIn:"Zoom in",close:"Close menu",open:"Open menu",fullscreen:"Fullscreen",toggleAnnotations:"Hide / Show",toggleTriggers:"Hide / Show",loading:"Loading 3D",view5:"Bottom view",view4:"Top view",poweredBy:"Powered by",fallbackMessage:"Your current configuration does not allow you to run the fully interactive 3D experience. Please try restarting your browser, try using a newer browser or another device",use:"Use",toZoomIn:"to zoom-in",CTRL:"CTRL + ",customizeOrder:"Customize &amp; order",
controlZoomMessage:"use/CTRL/icon/toZoomIn",activateMotionSensor:"Motion sensors are disabled",chooseYourARExperience:"Choose your AR experience",inAugmentedReality:"in Augmented Reality",moveAround:"Move around",onlyAvailableOnMobilesAndTablets:"Only available on mobiles and tablets",placeAndInteract:"Place and interact",scanQrCode:"Scan this QR code",withArPhoto:"with AR photo",tryNextToYou:"Try next to you",arCannotRun:"The Augmented Reality experience cannot run",cameraDisabled:"Camera access disabled",
enableCamera:"Please enable camera access in your browser settings. Then restart the experience.",start:"Start",selectYourSize:"and select your size",arInstructionOne:"<b>Place</b> product on the ground<br><b>Take AR photo</b> of your space",arInstructionOneWorktop:"<b>Place</b> product on the worktop<br><b>Take AR photo</b> of your space",arInstructionOneTable:"<b>Place</b> product on the table<br><b>Take AR photo</b> of your space",arInstructionTwo:"<b>Adjust</b> position and product options",pleaseStandUp:"Please stand up",
sorry:"Sorry",modelIsNotCompatible:"Model is not compatible",moveYourDevice:"Please move your device up and down to detect its orientation",arCannotRunOnChromeIos:"Please use Safari web browser",useSafari:"Video stream is unavailable in your browser, please use Safari instead.",sharingError:"Sorry an error occured, please try sharing again",arPermissionDeniedContent:"Please allow us access to a camera to be able to enjoy the augmented reality experience. <br><br> Try restarting the experience. <br>If this does not work, unblock the camera access for Emersya in your browser settings.",
arCameraErrorTitle:"Please make sure no other application is using the camera",arCameraErrorNotReadableContent:"Your camera is unavailable.<br> Please check whether another application or page is using it and try closing, then restarting. <br> Deleting your web browser's cache may help.",arCameraErrorUnknownContent:"Sorry, an unknown error occured with the video stream",activateCamera:"Please activate your camera",motionError:"Please activate the motion sensor",copylink:"COPY LINK",restart:"RESTART",
useOtherBrowsers:"Please use Chrome, Firefox or Edge",arCannotRunOpera:"Video stream is unavailable in Opera, please use another browser.",iosPopupErrorTitle:"Safari is blocking a popup",iosPopupErrorMessage:"Please disable Block Pop-ups option in Safari General settings.",orientationChangeTitle:"Orientation change",orientationChangeMessage:"Change the orientation to the initial one or restart the experience",modelDisabledTitle:"AR may have performance issues on your device",modelDisabledMessage:"Your device is not able to run the augmented reality experience smoothly",
forceAr:"Force AR",devWarningMessage:"This 3D viewer is for development purpose only.<br>Please use the normal link to remove the watermark.",iosMotionErrorTitle:"Motion sensor disabled",iosMotionErrorMessage:"Go to Settings  &gt; Safari &gt; Clear History and Website Data. Then restart the experience",force3D:"force 3D",fallbackUpgradeMessage:"Your are running image based 3D, upgrade your system to get fully interactive 3D.",seeHow:"see how",resetAnimation:"Reset animation",tryOnYou:"Virtual Try-On",
onlyAvailableOnDevicesWithACamera:"Only available on devices with a camera",arMoveAroundNotAvailable:"Move around AR is not available",badFeaturesLevelMessage:"This 3D viewer does not have the required level of features enabled for the experience you wish to access. The experience may be limited.",arWearablePrivacyPolicyWarning:"Privacy policy",arWearablePrivacyPolicyMessage:"The Try-On experience you are about to enter will analyze your video stream in real-time on your device. Your images will not be transferred or stored.",
arEmersyaPrivacyPolicyWarning:"Privacy policy",arEmersyaPrivacyPolicyMessage:"The Augmented Reality experience you are about to enter will analyze images of your space, and possibly images of people within that space. The analysis happens in real-time on your device. The images will not be transferred or stored.","continue":"Continue",requestingCameraAccessTitle:"Camera access requested",requestingCameraAccessMessage:"Please autorize access to your camera to start the experience",tryNextToYouButtonTitle:"Try out in AR",
orGoTo:"Or go to :",webGlContextLostButReloadable:"Error - webgl context lost.",fileDownloadErrorMessage:"Error - file download. Please check your internet connection.",clickHereToRestart3D:"Please click here to load the full Interactive 3D experience.",webGlHardwareLimitedErrorMessage:"Error - The full Interactive 3D experience is not able to run on this device. ",webGlMemoryLimitErrorMessage:"Error - insufficient memory.",webGlErrorMessage:"An error has occured.",clickHereToRestart3DOnce:"Please click here to load the 3D experience.",
webGlMissingOrDisabledErrorMessage:"Error. The 3D experience is not able to run on this device. Please update or switch web browser.",arInstructionOneCeiling:"&lt;b&gt;Place&lt;/b&gt; product on the ceiling&lt;br&gt;&lt;b&gt;Take AR photo&lt;/b&gt; of your space",arMoveAroundNotAvailableUseChrome:"The native AR experience is only available in Chrome.",addToCart:"Add to basket",basketLineCustomTextContent:"Text",basketLineCustomTextFont:"Font type",noOptionSelected:"None",customTexRequired:"This field cannot be empty.",
customTextMaxCharactersCount:"Maximum number of characters :",customTextAllowedCharacters:"Allowed characters :",arPermissionLackContent:"Please allow us access to a camera to be able to enjoy the augmented reality experience. <br><br> Try restarting the experience. <br>If this does not work, unblock the camera access for Emersya in your browser settings.<br>On slow devices the permission popup may take some time to appear. If your device is slow, try to wait a little after pressing the START button."}},
"fr-fr":{locale_name:"Fran\u00e7ais",viewerObject:{disable3D:"D\u00e9sactiver la 3D",emersyaPowered:"",enable3D:"Activer la 3D",help:"Aide",ok:"Valider",or:"ou",pause:"",play:"",playPauseAnimation:"Lancer/Arr\u00eater animation",rotate:"Rotation",setFullscreen:"Mode plein \u00e9cran",setLang:"Changer la langue",start3D:"Lancer/Arr\u00eater la 3D",translate:"D\u00e9placement",view0:"Vue avant",view1:"Vue arri\u00e8re",view2:"Vue gauche",view3:"Vue droite",view6:"",viewpoint:"Changer le point de vue",
views:"Changer la vue",zoom:"",zoomOut:"Zoom arri\u00e8re",zoomIn:"Zoom avant",close:"Fermer le menu",open:"Ouvrir le menu",fullscreen:"Plein \u00e9cran",toggleAnnotations:"On/Off",toggleTriggers:"On/Off",loading:"Chargement de la 3D",view5:"Vue dessous",view4:"Vue dessus",poweredBy:"",fallbackMessage:"Votre configuration actuelle ne vous permet pas de profiter pleinement de l'exp\u00e9rience 3D interactive. Veuillez essayer de relancer votre navigateur, d'essayer d'utiliser un navigateur plus r\u00e9cent ou un autre appareil",
use:"Utiliser",toZoomIn:"pour zoomer",CTRL:"",customizeOrder:"Configurer et commander",controlZoomMessage:"",activateMotionSensor:"Le capteur de mouvement est d\u00e9sactiv\u00e9",chooseYourARExperience:"Choisissez votre type d'exp\u00e9rience RA",inAugmentedReality:"en R\u00e9alit\u00e9 Augment\u00e9e",moveAround:"Tourner autour",onlyAvailableOnMobilesAndTablets:"Disponible uniquement sur mobiles et tablettes",placeAndInteract:"Placer et interagir",scanQrCode:"Scannez ce QR code",withArPhoto:"avec Photo RA",
tryNextToYou:"Essayer",arCannotRun:"L'exp\u00e9rience de R\u00e9alit\u00e9 Augment\u00e9e ne peut d\u00e9marrer",cameraDisabled:"L'acc\u00e8s \u00e0 la cam\u00e9ra est d\u00e9sactiv\u00e9",enableCamera:"Veuillez activer l'acc\u00e8s \u00e0 la cam\u00e9ra dans vos param\u00e8tres de navigateur puis red\u00e9marrer l'exp\u00e9rience.",start:"D\u00e9marrer",selectYourSize:"et s\u00e9lectionner votre taille",arInstructionOne:"<b>Placez</b> le produit sur le sol<br><b>Prenez une Photo RA</b> de votre espace",
arInstructionOneWorktop:"<b>Placez</b> le produit sur votre plan de travail<br><b>Prenez une Photo RA</b> de votre espace",arInstructionOneTable:"<b>Placez</b> le produit sur une table<br><b>Prenez une Photo RA</b> de votre espace",arInstructionTwo:"<b>Ajustez</b> la position et les options du produit",pleaseStandUp:"Veuillez vous mettre debout",sorry:"D\u00e9sol\u00e9",modelIsNotCompatible:"Votre mobile n'est pas compatible",moveYourDevice:"Veuillez bouger votre mobile de haut en bas plusieurs fois pour d\u00e9tecter son orientation",
arCannotRunOnChromeIos:"Veuillez utiliser le navigateur Safari",useSafari:"Le flux vid\u00e9o est indisponible dans Chrome, veuillez utiliser Safari.",sharingError:"D\u00e9sol\u00e9, une erreur s'est produite. Veuillez r\u00e9essayer de partager.",arPermissionDeniedContent:"Veuillez autoriser l'acc\u00e8s \u00e0 la camera afin de b\u00e9n\u00e9ficier de l'exp\u00e9rience de R\u00e9alit\u00e9 Augment\u00e9e, puis essayez de red\u00e9marrer l'exp\u00e9rience. Si cela ne fonctionne pas, veuillez d\u00e9bloquer l'acc\u00e8s \u00e0 la cam\u00e9ra pour Emersya dans les param\u00e8tres de votre navigateur.",
arCameraErrorTitle:"Veuillez vous assurer qu'aucun autre application n'utilise la cam\u00e9ra",arCameraErrorNotReadableContent:"Votre cam\u00e9ra est indisponible. <br> Veuillez v\u00e9rifier qu'aucune autre application ou page ne l'utilise d\u00e9j\u00e0, puis red\u00e9marrer cette page. <br> Vider le cache de votre navigateur peut parfois aider.",arCameraErrorUnknownContent:"D\u00e9sol\u00e9, un \u00e9v\u00e9nement inatendu s'est produit avec le flux vid\u00e9o",activateCamera:"Veuillez activer votre cam\u00e9ra",
motionError:"Veuillez activer votre capteur de mouvements",copylink:"COPIER LE LIEN",restart:"REDEMARRER ",useOtherBrowsers:"Veuillez utiliser Chrome, Firefox ou Edge",arCannotRunOpera:"Le flux video n'est pas disponible dans Opera, veuillez utiliser un autre navigateur",iosPopupErrorTitle:"Safari bloque une popup",iosPopupErrorMessage:"Veuillez d\u00e9sactiver l'option 'Bloquer les pop-up' dans les param\u00e8tres g\u00e9n\u00e9raux de Safari",orientationChangeTitle:"Changement d'orientation",orientationChangeMessage:"Veuillez r\u00e9orienter votre mobile dans sa position initiale ou red\u00e9marrez l'exp\u00e9rience",
modelDisabledTitle:"La RA peut rencontrer des probl\u00e8mes de performance sur votre mobile.",modelDisabledMessage:"Votre mobile n'est pas en mesure de faire fonctionner l'exp\u00e9rience de R\u00e9alit\u00e9 Augment\u00e9e de mani\u00e8re fluide.",forceAr:"Forcer la RA",devWarningMessage:"Cette visionneuse 3D est pour un usage en d\u00e9veloppement uniquement. <br>Veuillez utiliser le lien normal afin de retirer le watermark.",iosMotionErrorTitle:"Le capteur de mouvements est d\u00e9sactiv\u00e9",
iosMotionErrorMessage:"Allez dans Settings  &gt; Safari &gt; 'Effacer historique, donn\u00e9es de site' puis red\u00e9marrez l'exp\u00e9rience",force3D:"forcer la 3D",fallbackUpgradeMessage:"Vous exp\u00e9rimentez la 3D \u00e0 base d'images, mettez \u00e0 niveau votre syst\u00e8me pour obtenir une 3D enti\u00e8rement interactive.",seeHow:"voir comment",resetAnimation:"",tryOnYou:"Essayage virtuel",onlyAvailableOnDevicesWithACamera:"Uniquement disponible sur les appareils \u00e9quip\u00e9s d'une cam\u00e9ra",
arMoveAroundNotAvailable:"Le d\u00e9placement en R\u00e9alit\u00e9 Augment\u00e9e n'est pas disponible",badFeaturesLevelMessage:"Cette visionneuse ne poss\u00e8de pas le niveau requis pour l'exp\u00e9rience souhait\u00e9e.",arWearablePrivacyPolicyWarning:"Politique de confidentialit\u00e9",arWearablePrivacyPolicyMessage:"L'exp\u00e9rience d'essayage virtuel que vous \u00eates sur le point de d\u00e9marrer va analyser le flux vid\u00e9o en temps r\u00e9el dans votre navigateur. Vos images ne seront ni transf\u00e9r\u00e9es ni stock\u00e9es.",
arEmersyaPrivacyPolicyWarning:"Politique de confidentialit\u00e9","continue":"Continuer",requestingCameraAccessTitle:"Demande d'acc\u00e8s \u00e0 la cam\u00e9ra",requestingCameraAccessMessage:"Veuillez autoriser l'acc\u00e8s \u00e0 votre cam\u00e9ra afin de d\u00e9marrer l'exp\u00e9rience",tryNextToYouButtonTitle:"R\u00e9alit\u00e9 augment\u00e9e",orGoTo:"Ou se rendre sur :",webGlContextLostButReloadable:"Perte du contexte WebGL.",fileDownloadErrorMessage:"Erreur de t\u00e9l\u00e9chargement du fichier.&lt;br/&gt;Veuillez v\u00e9rifier votre connexion internet.",
clickHereToRestart3D:"Cliquer ici pour relancer l'exp\u00e9rience 3D dans son int\u00e9gralit\u00e9.",webGlHardwareLimitedErrorMessage:"L'appareil utilis\u00e9 ne permet pas d'acc\u00e9der \u00e0 l'exp\u00e9rience 3D dans son int\u00e9gralit\u00e9.",webGlMemoryLimitErrorMessage:"M\u00e9moire insuffisante.",webGlErrorMessage:"Une erreur est survenue.",clickHereToRestart3DOnce:"Cliquer ici pour relancer l'exp\u00e9rience 3D.",webGlMissingOrDisabledErrorMessage:"L'exp\u00e9rience 3D ne parvient pas \u00e0 d\u00e9marrer sur cet appareil. Veuillez ouvrir la page dans un autre navigateur ou v\u00e9rifier la mise \u00e0 jour de celui-ci.",
arInstructionOneCeiling:"<b>Placez</b> le produit sur le plafond<br><b>Prenez une Photo RA</b> de votre espace",arMoveAroundNotAvailableUseChrome:"L'exp\u00e9rience en RA native n'est disponible que dans Chrome.",addToCart:"Ajouter au panier",basketLineCustomTextContent:"Texte",basketLineCustomTextFont:"Police d'\u00e9criture",noOptionSelected:"Sans",customTexRequired:"Ce champ ne peut \u00eatre laiss\u00e9 vide.",customTextMaxCharactersCount:"Nombre maximum de caract\u00e8res :",customTextAllowedCharacters:"Caract\u00e8res autoris\u00e9s :",
arPermissionLackContent:"Veuillez autoriser l'acc\u00e8s \u00e0 la camera afin de b\u00e9n\u00e9ficier de l'exp\u00e9rience de R\u00e9alit\u00e9 Augment\u00e9e, puis essayez de red\u00e9marrer l'exp\u00e9rience. Si cela ne fonctionne pas, veuillez d\u00e9bloquer l'acc\u00e8s \u00e0 la cam\u00e9ra pour Emersya dans les param\u00e8tres de votre navigateur. Sur les mobiles peu performants l'affichage de la popup de validation peut prendre quelques secondes et n\u00e9cessiter d'attendre avant de d\u00e9marrer l'exp\u00e9rience.",
arEmersyaPrivacyPolicyMessage:"L\u2019exp\u00e9rience de R\u00e9alit\u00e9 Augment\u00e9e que vous \u00eates sur le point de d\u00e9marrer va analyser les images que vous capturerez. Celles-ci peuvent comprendre des images de personnes ou de vous. L'analyse se fait en temps r\u00e9el sur votre appareil. Vos images ne seront ni transf\u00e9r\u00e9es ni stock\u00e9es."}},"es-es":{locale_name:"Espa\u00f1ol",viewerObject:{disable3D:"Desactivar 3D",emersyaPowered:"",enable3D:"Activar 3D",help:"Ayuda",
ok:"Validar",or:"o",pause:"Pausa",play:"Reproducir",playPauseAnimation:"Reproducir/Pausar la animaci\u00f3n",rotate:"Girar",setFullscreen:"Pantalla completa",setLang:"Cambiar el idioma",start3D:"Comenzar/Detener 3D",translate:"Mover",view0:"Vista de frente",view1:"Vista trasera",view2:"Vista izquierda",view3:"Vista derecha",view6:"Vista libre",viewpoint:"Cambiar de punto de vista",views:"Cambiar la vista",zoom:"",zoomOut:"Alejarse",zoomIn:"Acercarse",close:"Cerrar el men\u00fa",open:"Abrir el men\u00fa",
fullscreen:"Pantalla completa",toggleAnnotations:"On/Off",toggleTriggers:"On/Off",loading:"Cargando el 3D",view5:"Vista abajo",view4:"Vista arriba",poweredBy:"",fallbackMessage:"La experiencia 3D interactiva no puede cargarse totalmente a causa de los par\u00e1metros actuales de su navegador web. Por favor intente actualizar su navegador, utilizar otro m\u00e1s reciente o cambiar de aparato.",use:"Usar",toZoomIn:"hacer zoom",CTRL:"",customizeOrder:"Personalizar y ordenar",controlZoomMessage:"",activateMotionSensor:"",
chooseYourARExperience:"",inAugmentedReality:"",moveAround:"",onlyAvailableOnMobilesAndTablets:"",placeAndInteract:"",scanQrCode:"",withArPhoto:"",tryNextToYou:"",arCannotRun:"",cameraDisabled:"",enableCamera:"",start:"",selectYourSize:"",arInstructionOne:"",arInstructionOneWorktop:"",arInstructionOneTable:"",arInstructionTwo:"",pleaseStandUp:"",sorry:"",modelIsNotCompatible:"",moveYourDevice:"",arCannotRunOnChromeIos:"",useSafari:"",sharingError:"",arPermissionDeniedContent:"",arCameraErrorTitle:"",
arCameraErrorNotReadableContent:"",arCameraErrorUnknownContent:"",activateCamera:"",motionError:"",copylink:"",restart:"",useOtherBrowsers:"",arCannotRunOpera:"",iosPopupErrorTitle:"",iosPopupErrorMessage:"",orientationChangeTitle:"",orientationChangeMessage:"",modelDisabledTitle:"",modelDisabledMessage:"",forceAr:"",devWarningMessage:"",iosMotionErrorTitle:"",iosMotionErrorMessage:"",force3D:"",fallbackUpgradeMessage:"",seeHow:"",resetAnimation:"",tryOnYou:"",onlyAvailableOnDevicesWithACamera:"",
arMoveAroundNotAvailable:"",badFeaturesLevelMessage:"",arPermissionLackContent:"Please allow us access to a camera to be able to enjoy the augmented reality experience. <br><br> Try restarting the experience. <br>If this does not work, unblock the camera access for Emersya in your browser settings.<br>On slow devices the permission popup may take some time to appear. If your device is slow, try to wait a little after pressing the START button.",arWearablePrivacyPolicyWarning:"",arWearablePrivacyPolicyMessage:"",
arEmersyaPrivacyPolicyWarning:"",arEmersyaPrivacyPolicyMessage:"","continue":"",requestingCameraAccessTitle:"",requestingCameraAccessMessage:"",tryNextToYouButtonTitle:"Realidad aumentada",orGoTo:"",webGlContextLostButReloadable:"",fileDownloadErrorMessage:"",clickHereToRestart3D:"",webGlHardwareLimitedErrorMessage:"",webGlMemoryLimitErrorMessage:"",webGlErrorMessage:"",clickHereToRestart3DOnce:"",webGlMissingOrDisabledErrorMessage:"",arInstructionOneCeiling:"",arMoveAroundNotAvailableUseChrome:"",
addToCart:"A\u00f1adir a la cesta",basketLineCustomTextContent:"Texto",basketLineCustomTextFont:"Tipo de letra",noOptionSelected:"Ninguno",customTexRequired:"",customTextMaxCharactersCount:"N\u00famero m\u00e1ximo de caracteres :",customTextAllowedCharacters:"Caracteres permitidos :"}},"it-it":{locale_name:"Italiana",viewerObject:{disable3D:"Disabilita 3D",emersyaPowered:"",enable3D:"Abilita 3D",help:"Aiuto",ok:"",or:"oppure",pause:"Pausa",play:"",playPauseAnimation:"",rotate:"Ruota",setFullscreen:"Schermo intero",
setLang:"Cambia lingua",start3D:"",translate:"Sposta",view0:"Vista frontale",view1:"Vista posteriore",view2:"Cambia visuale",view3:"Destra",view6:"Prospettiva",viewpoint:"Cambia punto di vista",views:"Cambia visuale",zoom:"",zoomOut:"",zoomIn:"",close:"Chiudi menu",open:"Apri menu",fullscreen:"",toggleAnnotations:"On/Off",toggleTriggers:"On/Off",loading:"Caricamento 3D",view5:"Fondo",view4:"Vista dall'alto",poweredBy:"",fallbackMessage:"",use:"Usare",toZoomIn:"per ingrandire",CTRL:"",customizeOrder:"Personalizza e ordina",
controlZoomMessage:"",activateMotionSensor:"",chooseYourARExperience:"",inAugmentedReality:"",moveAround:"",onlyAvailableOnMobilesAndTablets:"",placeAndInteract:"",scanQrCode:"",withArPhoto:"",tryNextToYou:"",arCannotRun:"",cameraDisabled:"",enableCamera:"",start:"",selectYourSize:"",arInstructionOne:"",arInstructionOneWorktop:"",arInstructionOneTable:"",arInstructionTwo:"",pleaseStandUp:"",sorry:"",modelIsNotCompatible:"",moveYourDevice:"",arCannotRunOnChromeIos:"",useSafari:"",sharingError:"",arPermissionDeniedContent:"",
arCameraErrorTitle:"",arCameraErrorNotReadableContent:"",arCameraErrorUnknownContent:"",activateCamera:"",motionError:"",copylink:"",restart:"",useOtherBrowsers:"",arCannotRunOpera:"",iosPopupErrorTitle:"",iosPopupErrorMessage:"",orientationChangeTitle:"",orientationChangeMessage:"",modelDisabledTitle:"",modelDisabledMessage:"",forceAr:"",devWarningMessage:"",iosMotionErrorTitle:"",iosMotionErrorMessage:"",force3D:"",fallbackUpgradeMessage:"",seeHow:"",resetAnimation:"",tryOnYou:"",onlyAvailableOnDevicesWithACamera:"",
arMoveAroundNotAvailable:"",badFeaturesLevelMessage:"",arPermissionLackContent:"Please allow us access to a camera to be able to enjoy the augmented reality experience. <br><br> Try restarting the experience. <br>If this does not work, unblock the camera access for Emersya in your browser settings.<br>On slow devices the permission popup may take some time to appear. If your device is slow, try to wait a little after pressing the START button.",arWearablePrivacyPolicyWarning:"",arWearablePrivacyPolicyMessage:"",
arEmersyaPrivacyPolicyWarning:"",arEmersyaPrivacyPolicyMessage:"","continue":"",requestingCameraAccessTitle:"",requestingCameraAccessMessage:"",tryNextToYouButtonTitle:"Realt\u00e0 aumentata",orGoTo:"",webGlContextLostButReloadable:"",fileDownloadErrorMessage:"",clickHereToRestart3D:"",webGlHardwareLimitedErrorMessage:"",webGlMemoryLimitErrorMessage:"",webGlErrorMessage:"",clickHereToRestart3DOnce:"",webGlMissingOrDisabledErrorMessage:"",arInstructionOneCeiling:"",arMoveAroundNotAvailableUseChrome:"",
addToCart:"Aggiungi al carrello",basketLineCustomTextContent:"Testo",basketLineCustomTextFont:"Carattere del testo",noOptionSelected:"Nessuno",customTexRequired:"Questo campo non pu\u00f2 rimanere vuoto.",customTextMaxCharactersCount:"Numero massimo di caratteri :",customTextAllowedCharacters:"Caratteri consentiti :"}},"ru-ru":{locale_name:"\u0440\u0443\u0441\u0441\u043a\u0438\u0439",viewerObject:{disable3D:"\u041e\u0442\u043a\u043b\u044e\u0447\u0438\u0442\u044c 3D",emersyaPowered:"C\u043e\u0437\u0434\u0430\u043d \u0415\u043c\u0435\u0440\u0441\u0438\u0435\u0438",
enable3D:"\u0412\u044b\u043a\u043b\u044e\u0447\u0438\u0442\u044c 3D",help:"\u041f\u043e\u043c\u043e\u0449\u044c",ok:"",or:"\u0438\u043b\u0438",pause:"C\u0442\u043e\u043f",play:"\u0418\u0433\u0440\u0430\u0442\u044c",playPauseAnimation:"\u0418\u0433\u0440\u0430\u0442\u044c/\u0421\u0442\u043e\u043f",rotate:"B\u0440\u0430\u0449\u0430\u0442\u044c",setFullscreen:"\u0423\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u043f\u043e\u043b\u043d\u044b\u0439 \u044d\u043a\u0440\u0430\u043d",setLang:"\u0418\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u044f\u0437\u044b\u043a",
start3D:"\u0418\u0433\u0440\u0430\u0442\u044c/\u0421\u0442\u043e\u043f 3D",translate:"\u041f\u0435\u0440\u0435\u043c\u0435\u0449\u0435\u043d\u0438\u0435",view0:"\u041f\u0435\u0440\u0435\u0434\u043d\u0438\u0439 \u0432\u0438\u0434",view1:"\u0412\u0438\u0434 \u0441\u0437\u0430\u0434\u0438",view2:"\u0412\u0438\u0434 \u0441\u043b\u0435\u0432\u0430",view3:"\u0412\u0438\u0434 \u0441\u043f\u0440\u0430\u0432\u0430",view6:"\u041f\u0435\u0440\u0441\u043f\u0435\u043a\u0442\u0438\u0432\u0430",viewpoint:"\u0421\u043c\u0435\u043d\u0438\u0442\u044c \u0432\u0438\u0434",
views:"\u0421\u043c\u0435\u043d\u0438\u0442\u044c \u0432\u0438\u0434",zoom:"\u0423\u0432\u0435\u043b\u0438\u0447\u0438\u0442\u044c",zoomOut:"\u0423\u043c\u0435\u043d\u044c\u0448\u0438\u0442\u044c",zoomIn:"\u0423\u0432\u0435\u043b\u0438\u0447\u0438\u0442\u044c",close:"\u0417\u0430\u043a\u0440\u044b\u0442\u044c \u043c\u0435\u043d\u044e",open:"\u041e\u0442\u043a\u0440\u044b\u0442\u044c \u043c\u0435\u043d\u044e",fullscreen:"\u041f\u043e\u043b\u043d\u044b\u0439 \u044d\u043a\u0440\u0430\u043d",toggleAnnotations:"\u0412\u043a\u043b /\u0412\u044b\u043a\u043b",
toggleTriggers:"\u041f\u0435\u0440\u0435\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435 \u0442\u0440\u0438\u0433\u0433\u0435\u0440\u043e\u0432",loading:"\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430 3D",view5:"\u0412\u0438\u0434 \u0441\u043d\u0438\u0437\u0443",view4:"\u0412\u0438\u0434 \u0441\u0432\u0435\u0440\u0445\u0443",poweredBy:"\u043f\u0438\u0442\u0430\u043d\u0438\u0435 \u043e\u0442",use:"\u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0435",toZoomIn:"\u0423\u0432\u0435\u043b\u0438\u0447\u0438\u0442\u044c",
CTRL:"",customizeOrder:"\u041d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0438 \u0437\u0430\u043a\u0430\u0437\u0430\u0442\u044c",controlZoomMessage:"",activateMotionSensor:"",chooseYourARExperience:"",inAugmentedReality:"",moveAround:"",onlyAvailableOnMobilesAndTablets:"",placeAndInteract:"",scanQrCode:"",withArPhoto:"",tryNextToYou:"",arCannotRun:"",cameraDisabled:"",enableCamera:"",start:"",selectYourSize:"",arInstructionOne:"",arInstructionOneWorktop:"",arInstructionOneTable:"",arInstructionTwo:"",
pleaseStandUp:"",sorry:"",modelIsNotCompatible:"",moveYourDevice:"",arCannotRunOnChromeIos:"",useSafari:"",sharingError:"",arPermissionDeniedContent:"",arCameraErrorTitle:"",arCameraErrorNotReadableContent:"",arCameraErrorUnknownContent:"",activateCamera:"",motionError:"",copylink:"",restart:"",useOtherBrowsers:"",arCannotRunOpera:"",iosPopupErrorTitle:"",iosPopupErrorMessage:"",orientationChangeTitle:"",orientationChangeMessage:"",modelDisabledTitle:"",modelDisabledMessage:"",forceAr:"",devWarningMessage:"",
iosMotionErrorTitle:"",iosMotionErrorMessage:"",force3D:"\u0441\u0438\u043b\u0430 3D",fallbackUpgradeMessage:"\u0412\u044b \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0435 3D-\u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u043d\u0430 \u043e\u0441\u043d\u043e\u0432\u0435 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0439, \u043e\u0431\u043d\u043e\u0432\u043b\u044f\u0435\u0442\u0435 \u0441\u0432\u043e\u044e \u0441\u0438\u0441\u0442\u0435\u043c\u0443, \u0447\u0442\u043e\u0431\u044b \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u043f\u043e\u043b\u043d\u043e\u0441\u0442\u044c\u044e \u0438\u043d\u0442\u0435\u0440\u0430\u043a\u0442\u0438\u0432\u043d\u043e\u0435 3D-\u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435.",
seeHow:"\u0421\u043c\u043e\u0442\u0440\u0438 \u043a\u0430\u043a",resetAnimation:"\u043f\u043e\u0432\u0442\u043e\u0440 \u0430\u043d\u0438\u043c\u0430\u0446\u044b\u0438",tryOnYou:"",onlyAvailableOnDevicesWithACamera:"",arMoveAroundNotAvailable:"",badFeaturesLevelMessage:"",arPermissionLackContent:"Please allow us access to a camera to be able to enjoy the augmented reality experience. <br><br> Try restarting the experience. <br>If this does not work, unblock the camera access for Emersya in your browser settings.<br>On slow devices the permission popup may take some time to appear. If your device is slow, try to wait a little after pressing the START button.",
arWearablePrivacyPolicyWarning:"",arWearablePrivacyPolicyMessage:"",arEmersyaPrivacyPolicyWarning:"",arEmersyaPrivacyPolicyMessage:"","continue":"",requestingCameraAccessTitle:"",requestingCameraAccessMessage:"",tryNextToYouButtonTitle:"\u0414\u043e\u043f\u043e\u043b\u043d\u0435\u043d\u043d\u0430\u044f \u0440\u0435\u0430\u043b\u044c\u043d\u043e\u0441\u0442\u044c",orGoTo:"",webGlContextLostButReloadable:"",fileDownloadErrorMessage:"",clickHereToRestart3D:"",webGlHardwareLimitedErrorMessage:"",webGlMemoryLimitErrorMessage:"",
webGlErrorMessage:"",clickHereToRestart3DOnce:"",webGlMissingOrDisabledErrorMessage:"",arInstructionOneCeiling:"",arMoveAroundNotAvailableUseChrome:"",addToCart:"",basketLineCustomTextContent:"",basketLineCustomTextFont:"",noOptionSelected:"",customTexRequired:"",customTextMaxCharactersCount:"",customTextAllowedCharacters:"",fallbackMessage:"\u0412\u0430\u0448\u0430 \u0442\u0435\u043a\u0443\u0449\u0430\u044f \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u044f \u043d\u0435 \u043f\u043e\u0437\u0432\u043e\u043b\u044f\u0435\u0442 \u0432\u0430\u043c \u0437\u0430\u043f\u0443\u0441\u043a\u0430\u0442\u044c \u043f\u043e\u043b\u043d\u043e\u0441\u0442\u044c\u044e \u0438\u043d\u0442\u0435\u0440\u0430\u043a\u0442\u0438\u0432\u043d\u044b\u0439 3D-\u043e\u043f\u044b\u0442. \u041f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u0431\u043e\u043b\u0435\u0435 \u043f\u043e\u0437\u0434\u043d\u0438\u0439 \u0432\u0435\u0431-\u0431\u0440\u0430\u0443\u0437\u0435\u0440 \u0438\u043b\u0438 \u0434\u0440\u0443\u0433\u043e\u0435 \u0443\u0441\u0442\u0440\u043e\u0439\u0441\u0442\u0432\u043e."}},
"fi-fi":{locale_name:"Suomalainen",viewerObject:{disable3D:"poista 3D k\u00e4yt\u00f6st\u00e4",emersyaPowered:"",enable3D:"ota 3D k\u00e4ytt\u00f6\u00f6n",help:"",ok:"",or:"tai",pause:"pys\u00e4yt\u00e4",play:"toista",playPauseAnimation:"toista/pys\u00e4yt\u00e4 animaatio",rotate:"py\u00f6rit\u00e4",setFullscreen:"aseta koko n\u00e4yt\u00f6n tilaan",setLang:"vaihda kieli",start3D:"aloita/pys\u00e4yt\u00e4 3D",translate:"siirry",view0:"edest\u00e4",view1:"Takan\u00e4kym\u00e4",view2:"vasemmalta",view3:"oikealta",
view6:"perspektiivi",viewpoint:"vaihda kuvakulmaa",views:"vaihda n\u00e4kym\u00e4\u00e4",zoom:"l\u00e4henn\u00e4",zoomOut:"loitonna",zoomIn:"l\u00e4henn\u00e4",close:"sulje valikko",open:"avaa valikko",fullscreen:"koko n\u00e4ytt\u00f6",toggleAnnotations:"On/Off",toggleTriggers:"On/Off",loading:"ladataan 3D",view5:"Katso alhaalta",view4:"Katso ylh\u00e4\u00e4lt\u00e4",poweredBy:"",fallbackMessage:"J\u00e4rjestelm\u00e4asetuksesi eiv\u00e4t mahdollista interaktiivista 3D-kokemusta. Kokeile uudempaa selainta tai toista laitetta.",
use:"k\u00e4yt\u00e4",toZoomIn:"l\u00e4henn\u00e4",CTRL:"",customizeOrder:"Mukauta ja tilaa",controlZoomMessage:"",activateMotionSensor:"",chooseYourARExperience:"",inAugmentedReality:"",moveAround:"",onlyAvailableOnMobilesAndTablets:"",placeAndInteract:"",scanQrCode:"",withArPhoto:"",tryNextToYou:"",arCannotRun:"",cameraDisabled:"",enableCamera:"",start:"",selectYourSize:"",arInstructionOne:"",arInstructionOneWorktop:"",arInstructionOneTable:"",arInstructionTwo:"",pleaseStandUp:"",sorry:"",modelIsNotCompatible:"",
moveYourDevice:"",arCannotRunOnChromeIos:"",useSafari:"",sharingError:"",arPermissionDeniedContent:"",arCameraErrorTitle:"",arCameraErrorNotReadableContent:"",arCameraErrorUnknownContent:"",activateCamera:"",motionError:"",copylink:"",restart:"",useOtherBrowsers:"",arCannotRunOpera:"",iosPopupErrorTitle:"",iosPopupErrorMessage:"",orientationChangeTitle:"",orientationChangeMessage:"",modelDisabledTitle:"",modelDisabledMessage:"",forceAr:"",devWarningMessage:"",iosMotionErrorTitle:"",iosMotionErrorMessage:"",
force3D:"",fallbackUpgradeMessage:"Interaktiivinen 3D-ty\u00f6kalu hy\u00f6dynt\u00e4\u00e4 oikeita valokuvia. Ole hyv\u00e4 ja  p\u00e4ivit\u00e4 j\u00e4rjestelm\u00e4si saavuttaaksesi t\u00e4ydellisen 3D-kokemuksen.",seeHow:"tutustu ohjeisiin",resetAnimation:"nollaa animaatio",tryOnYou:"",onlyAvailableOnDevicesWithACamera:"",arMoveAroundNotAvailable:"",badFeaturesLevelMessage:"",arPermissionLackContent:"Please allow us access to a camera to be able to enjoy the augmented reality experience. &lt;br&gt;&lt;br&gt; Try restarting the experience. &lt;br&gt;If this does not work, unblock the camera access for Emersya in your browser settings.&lt;br&gt;On slow devices the permission popup may take some time to appear. If your device is slow, try to wait a little after pressing the START button.",
arWearablePrivacyPolicyWarning:"",arWearablePrivacyPolicyMessage:"",arEmersyaPrivacyPolicyWarning:"",arEmersyaPrivacyPolicyMessage:"","continue":"",requestingCameraAccessTitle:"",requestingCameraAccessMessage:"",tryNextToYouButtonTitle:"Lis\u00e4tty todellisuus",orGoTo:"",webGlContextLostButReloadable:"",fileDownloadErrorMessage:"",clickHereToRestart3D:"",webGlHardwareLimitedErrorMessage:"",webGlMemoryLimitErrorMessage:"",webGlErrorMessage:"",clickHereToRestart3DOnce:"",webGlMissingOrDisabledErrorMessage:"",
arInstructionOneCeiling:"",arMoveAroundNotAvailableUseChrome:"",addToCart:"",basketLineCustomTextContent:"",basketLineCustomTextFont:"",noOptionSelected:"",customTexRequired:"",customTextMaxCharactersCount:"",customTextAllowedCharacters:""}},"nl-nl":{locale_name:"Nederlands",viewerObject:{disable3D:"3D stoppen",emersyaPowered:"",enable3D:"3D starten",help:"",ok:"",or:"of",pause:"Pauzeren",play:"Afspelen",playPauseAnimation:"Animatie afspelen/pauzeren",rotate:"Roteren",setFullscreen:"Volledig scherm activeren",
setLang:"Taal wijzigen",start3D:"3D starten/stoppen",translate:"Verplaatsen",view0:"Vooraanzicht",view1:"Achteraanzicht",view2:"Linkeraanzicht",view3:"Rechteraanzicht",view6:"Perspectief",viewpoint:"Aanzicht wijzigen",views:"Wijzigen aanzicht",zoom:"",zoomOut:"Uitzoomen",zoomIn:"Inzoomen",close:"Sluit menu",open:"",fullscreen:"Volledig scherm",toggleAnnotations:"On/Off",toggleTriggers:"On/Off",loading:"Het laden 3D",view5:"Onderaanzicht",view4:"Bovenaanzicht",poweredBy:"",fallbackMessage:"",use:"Gebruiken",
toZoomIn:"om in te zoomen",CTRL:"",customizeOrder:"Aanpassen &amp; bestellen",controlZoomMessage:"",activateMotionSensor:"",chooseYourARExperience:"",inAugmentedReality:"",moveAround:"",onlyAvailableOnMobilesAndTablets:"",placeAndInteract:"",scanQrCode:"",withArPhoto:"",tryNextToYou:"",arCannotRun:"",cameraDisabled:"",enableCamera:"",start:"",selectYourSize:"",arInstructionOne:"",arInstructionOneWorktop:"",arInstructionOneTable:"",arInstructionTwo:"",pleaseStandUp:"",sorry:"",modelIsNotCompatible:"",
moveYourDevice:"",arCannotRunOnChromeIos:"",useSafari:"",sharingError:"",arPermissionDeniedContent:"",arCameraErrorTitle:"",arCameraErrorNotReadableContent:"",arCameraErrorUnknownContent:"",activateCamera:"",motionError:"",copylink:"",restart:"",useOtherBrowsers:"",arCannotRunOpera:"",iosPopupErrorTitle:"",iosPopupErrorMessage:"",orientationChangeTitle:"",orientationChangeMessage:"",modelDisabledTitle:"",modelDisabledMessage:"",forceAr:"",devWarningMessage:"",iosMotionErrorTitle:"",iosMotionErrorMessage:"",
force3D:"",fallbackUpgradeMessage:"",seeHow:"",resetAnimation:"Reset animatie",tryOnYou:"",onlyAvailableOnDevicesWithACamera:"",arMoveAroundNotAvailable:"",badFeaturesLevelMessage:"",arPermissionLackContent:"Please allow us access to a camera to be able to enjoy the augmented reality experience. &lt;br&gt;&lt;br&gt; Try restarting the experience. &lt;br&gt;If this does not work, unblock the camera access for Emersya in your browser settings.&lt;br&gt;On slow devices the permission popup may take some time to appear. If your device is slow, try to wait a little after pressing the START button.",
arWearablePrivacyPolicyWarning:"",arWearablePrivacyPolicyMessage:"",arEmersyaPrivacyPolicyWarning:"",arEmersyaPrivacyPolicyMessage:"","continue":"",requestingCameraAccessTitle:"",requestingCameraAccessMessage:"",tryNextToYouButtonTitle:"Verhoogde realiteit",orGoTo:"",webGlContextLostButReloadable:"",fileDownloadErrorMessage:"",clickHereToRestart3D:"",webGlHardwareLimitedErrorMessage:"",webGlMemoryLimitErrorMessage:"",webGlErrorMessage:"",clickHereToRestart3DOnce:"",webGlMissingOrDisabledErrorMessage:"",
arInstructionOneCeiling:"",arMoveAroundNotAvailableUseChrome:"",addToCart:"",basketLineCustomTextContent:"",basketLineCustomTextFont:"",noOptionSelected:"",customTexRequired:"",customTextMaxCharactersCount:"",customTextAllowedCharacters:""}},"tr-tr":{locale_name:"T\u00fcrk",viewerObject:{disable3D:"3D Kapat",emersyaPowered:"",enable3D:"3D Etkinle\u015ftir",help:"Yard\u0131m",ok:"Tamam",or:"Veya",pause:"Durdur",play:"Ba\u015flat",playPauseAnimation:"Animasyonu Ba\u015flat/Durdur",rotate:"D\u00f6nd\u00fcr",
setFullscreen:"Tam Ekran",setLang:"Dil De\u011fi\u015ftir",start3D:"Ba\u015flat/Durdur",translate:"\u0130lerlet",view0:"\u00d6nden G\u00f6r\u00fcn\u00fc\u015f",view1:"arkaya G\u00f6r\u00fcn\u00fc\u015f",view2:"Soldan G\u00f6r\u00fcn\u00fc\u015f",view3:"Sa\u011fdan G\u00f6r\u00fcn\u00fc\u015f",view6:"Bak\u0131\u015f A\u00e7\u0131s\u0131",viewpoint:"Bak\u0131\u015f A\u00e7\u0131s\u0131n\u0131 De\u011fi\u015ftir",views:"Bak\u0131\u015f A\u00e7\u0131s\u0131n\u0131 De\u011fi\u015ftir",zoom:"Yak\u0131nla\u015ft\u0131rma/Uzakla\u015ft\u0131rma",
zoomOut:"Uzakla\u015ft\u0131r",zoomIn:"Yak\u0131nla\u015ft\u0131r",close:"Men\u00fcy\u00fc Kapat",open:"Men\u00fcy\u00fc A\u00e7",fullscreen:"Tam Ekran",toggleAnnotations:"On/Off",toggleTriggers:"On/Off",loading:"3D Y\u00fckleniyor",view5:"Alttan G\u00f6r\u00fcn\u00fc\u015f",view4:"\u00dcstten G\u00f6r\u00fcn\u00fc\u015f",poweredBy:"",fallbackMessage:"",use:"Kullan\u0131m",toZoomIn:"yak\u0131nla\u015ft\u0131rmak",CTRL:"",customizeOrder:"\u00d6zelle\u015ftir ve sipari\u015f et",controlZoomMessage:"",
activateMotionSensor:"",chooseYourARExperience:"",inAugmentedReality:"",moveAround:"",onlyAvailableOnMobilesAndTablets:"",placeAndInteract:"",scanQrCode:"",withArPhoto:"",tryNextToYou:"",arCannotRun:"",cameraDisabled:"",enableCamera:"",start:"",selectYourSize:"",arInstructionOne:"",arInstructionOneWorktop:"",arInstructionOneTable:"",arInstructionTwo:"",pleaseStandUp:"",sorry:"",modelIsNotCompatible:"",moveYourDevice:"",arCannotRunOnChromeIos:"",useSafari:"",sharingError:"",arPermissionDeniedContent:"",
arCameraErrorTitle:"",arCameraErrorNotReadableContent:"",arCameraErrorUnknownContent:"",activateCamera:"",motionError:"",copylink:"",restart:"",useOtherBrowsers:"",arCannotRunOpera:"",iosPopupErrorTitle:"",iosPopupErrorMessage:"",orientationChangeTitle:"",orientationChangeMessage:"",modelDisabledTitle:"",modelDisabledMessage:"",forceAr:"",devWarningMessage:"",iosMotionErrorTitle:"",iosMotionErrorMessage:"",force3D:"",fallbackUpgradeMessage:"",seeHow:"",resetAnimation:"Reset animasyonu",tryOnYou:"",
onlyAvailableOnDevicesWithACamera:"",arMoveAroundNotAvailable:"",badFeaturesLevelMessage:"",arPermissionLackContent:"Please allow us access to a camera to be able to enjoy the augmented reality experience. <br><br> Try restarting the experience. <br>If this does not work, unblock the camera access for Emersya in your browser settings.<br>On slow devices the permission popup may take some time to appear. If your device is slow, try to wait a little after pressing the START button.",arWearablePrivacyPolicyWarning:"",
arWearablePrivacyPolicyMessage:"",arEmersyaPrivacyPolicyWarning:"",arEmersyaPrivacyPolicyMessage:"","continue":"",requestingCameraAccessTitle:"",requestingCameraAccessMessage:"",tryNextToYouButtonTitle:"Artt\u0131r\u0131lm\u0131\u015f ger\u00e7eklik",orGoTo:"",webGlContextLostButReloadable:"",fileDownloadErrorMessage:"",clickHereToRestart3D:"",webGlHardwareLimitedErrorMessage:"",webGlMemoryLimitErrorMessage:"",webGlErrorMessage:"",clickHereToRestart3DOnce:"",webGlMissingOrDisabledErrorMessage:"",
arInstructionOneCeiling:"",arMoveAroundNotAvailableUseChrome:"",addToCart:"",basketLineCustomTextContent:"",basketLineCustomTextFont:"",noOptionSelected:"",customTexRequired:"",customTextMaxCharactersCount:"",customTextAllowedCharacters:""}},"pl-pl":{locale_name:"Poland",viewerObject:{activateCamera:"Prosz\u0119 aktywowa\u0107 kamer\u0119 internetow\u0105",activateMotionSensor:"Czujniki ruchu s\u0105 wy\u0142\u0105czone",arCameraErrorNotReadableContent:"Twoja kamera internetowa jest niedost\u0119pna. <br> Sprawd\u017a, czy nie u\u017cywa jej inna aplikacja lub strona, nast\u0119pnie spr\u00f3buj zamkn\u0105\u0107 i uruchomi\u0107 ponownie. <br> Pomocne mo\u017ce by\u0107 usuni\u0119cie pami\u0119ci podr\u0119cznej przegl\u0105darki internetowej.",
arCameraErrorTitle:"Upewnij si\u0119, \u017ce \u017cadna inna aplikacja nie korzysta z kamery internetowej",arCameraErrorUnknownContent:"Przepraszamy, wystapi\u0142 nieznany b\u0142\u0105d ",arCannotRun:"Rozszerzona rzeczywisto\u015b\u0107 nie mo\u017ce dzia\u0142a\u0107",arCannotRunOnChromeIos:"Prosz\u0119 u\u017cy\u0107 przegl\u0105darki internetowej Safari",arCannotRunOpera:"Stream wideo nie jest dostepny w Operze, prosz\u0119 u\u017cy\u0107 innej przegl\u0105darki internetowej ",arInstructionOne:"<b> Umie\u015b\u0107 </b> produkt na ziemi <br> <b> Zr\u00f3b zdj\u0119cie w rozszerzonej rzeczywisto\u015bci </b>",
arInstructionOneTable:"<b>Dostosuj</b> pozycj\u0119 i opcje produktu",arInstructionOneWorktop:"<b> Umie\u015b\u0107 </b> produkt na ziemi <br> <b> Zr\u00f3b zdj\u0119cie w rozszerzonej rzeczywisto\u015bci </b>",arInstructionTwo:"<b>Dostosuj</b> pozycj\u0119 i opcje produktu",arMoveAroundNotAvailable:"",cameraDisabled:"Dost\u0119p do kamery internetowej wy\u0142\u0105czony",chooseYourARExperience:"Wybierz swoj\u0105 rozszerzon\u0105 rzeczywisto\u015b\u0107",close:"Zamknij menu",copylink:"Kopiuj link",
devWarningMessage:"Ta przegl\u0105darka 3D s\u0142u\u017cy wy\u0142\u0105cznie do cel\u00f3w programistycznych. <br> U\u017cyj normalnego linku, aby usun\u0105\u0107 znak wodny.",disable3D:"Wy\u0142\u0105cz 3D",emersyaPowered:"Opracowany przez Emersya",enable3D:"W\u0142\u0105cz 3D",enableCamera:"W\u0142\u0105cz dost\u0119p do kamery internetowej w ustawieniach przegl\u0105darki. Nast\u0119pnie uruchom ponownie.",fallbackMessage:"Twoja bie\u017c\u0105ca konfiguracja nie pozwala na uruchomienie w pe\u0142ni interaktywnego \u015brodowiska 3D. Wypr\u00f3buj nowsz\u0105 przegl\u0105dark\u0119 internetow\u0105 lub inne urz\u0105dzenie.",
fallbackUpgradeMessage:"Korzystasz z 3D opartego na obrazach, zaktualizuj sw\u00f3j system, aby uzyska\u0107 w pe\u0142ni interaktywny obraz 3D.",force3D:"Wymu\u015b 3D",forceAr:"Wymu\u015b rozszerzon\u0105 rzeczywisto\u015b\u0107",fullscreen:"Pe\u0142ny ekran",help:"Pomoc",inAugmentedReality:"w rozszerzonej rzeczywisto\u015bci",iosMotionErrorMessage:"Przejd\u017a do ustawie\u0144  &gt; Safari &gt; wyczy\u015b\u0107 histori\u0119 i dane przegladarki internetowej. Nastepnie uruchom ponownie",iosMotionErrorTitle:"Czujnik ruchu jest wy\u0142\u0105czony",
iosPopupErrorMessage:"Wy\u0142\u0105cz opcj\u0119 'Blokuj wyskakuj\u0105ce okienka' w og\u00f3lnych ustawieniach Safari.",iosPopupErrorTitle:"Safari blokuje wyskakuj\u0105ce okienko",loading:"\u0141adowanie 3D",modelDisabledMessage:"Twoje urz\u0105dzenie nie jest w stanie p\u0142ynnie uruchomi\u0107 rozszerzonej rzeczywisto\u015bci",modelDisabledTitle:"Rozszerzona rzeczywisto\u015b\u0107 mo\u017ce mie\u0107 problemy z wydajno\u015bci\u0105 na twoim urz\u0105dzeniu",modelIsNotCompatible:"Model nie jest kompatybilny",
motionError:"Prosz\u0119 aktywowac czujnik ruchu",moveAround:"Poruszaj si\u0119",moveYourDevice:"Poruszaj urz\u0105dzeniem w g\u00f3r\u0119 i w d\u00f3\u0142, aby wykry\u0107 jego orientacj\u0119",ok:"Ok",onlyAvailableOnDevicesWithACamera:"",onlyAvailableOnMobilesAndTablets:"Dost\u0119pne tylko na telefonach kom\u00f3rkowych i tabletach",open:"Otw\u00f3rz menu",or:"lub",orientationChangeMessage:"Zmie\u0144 orientacj\u0119 na pocz\u0105tkow\u0105 lub uruchom ponownie ",orientationChangeTitle:"orientacjaZmie\u0144Tytu\u0142",
pause:"Wstrzymaj",placeAndInteract:"Umie\u015b\u0107 i wejd\u017a w interakcj\u0119",play:"Odtw\u00f3rz",playPauseAnimation:"Odtw\u00f3rz / Wstrzymaj animacj\u0119",pleaseStandUp:"Prosze wsta\u0107",poweredBy:"Opracowany przez",resetAnimation:"Zresetuj animacj\u0119",restart:"Uruchom ponownie",rotate:"Obr\u00f3\u0107",scanQrCode:"Zeskanuj ten kod QR",seeHow:"Zobacz jak",selectYourSize:"i wybierz sw\u00f3j rozmiar",setFullscreen:"Ustaw pe\u0142ny ekran",setLang:"Zmie\u0144 j\u0119zyk",sharingError:"Przepraszamy, wyst\u0105pi\u0142 b\u0142\u0105d, spr\u00f3buj udost\u0119pni\u0107 ponownie",
sorry:"Przepraszamy",start:"Uruchom",start3D:"Uruchom / Zatrzymaj 3D",toggleAnnotations:"Ukryj / Poka\u017c",toggleTriggers:"Ukryj / Poka\u017c",toZoomIn:"aby powi\u0119kszy\u0107",translate:"Przesu\u0144",tryNextToYou:"Wypr\u00f3buj obok ciebie",tryOnYou:"Wypr\u00f3buj",use:"U\u017cyj",useOtherBrowsers:"Prosz\u0119 u\u017cy\u0107 Chrome, Firefox lub Edge",useSafari:"Stream wideo jest niedost\u0119pny w twojej przegl\u0105darce, prosz\u0119 u\u017cy\u0107 przegl\u0105darki Safari.",view0:"Przedni widok",
view1:"Widok z ty\u0142u",view2:"Widok z lewej",view3:"Widok z prawej",view4:"Widok z g\u00f3ry",view5:"Widok z do\u0142u",view6:"Perspektywa",viewpoint:"Zmie\u0144 punkt widzenia",views:"Zmie\u0144 widok",withArPhoto:"ze zdj\u0119ciem z rozszerzonej rzeczywisto\u015bci",zoom:"Powi\u0119kszenie",zoomIn:"Zwi\u0119ksz",zoomOut:"Zmniejsz",arPermissionDeniedContent:"W celu lepszego do\u015bwiadczenia w rozszerzonej rzeczywistosci, prosimy o zezwolenie nam dost\u0119pu do kamery internetowej &lt;br&gt;&lt;br&gt; Spr\u00f3buj uruchomi\u0107 ponownie. &lt;br&gt; Je\u015bli to nie zadzia\u0142a, odblokuj dost\u0119p do kamery dla Emersya w ustawieniach przegl\u0105darki. &lt;br&gt; Na wolnych urz\u0105dzeniach mo\u017ce min\u0105\u0107 troch\u0119 czasu zanim pojawi si\u0119 okienko uprawnie\u0144. Je\u015bli twoje urz\u0105dzenie jest powolne, spr\u00f3buj chwil\u0119 poczeka\u0107 po naci\u015bni\u0119ciu przycisku START.",
customizeOrder:"Dostosuj i  zam\u00f3wienie",badFeaturesLevelMessage:"",controlZoomMessage:"",CTRL:"",arWearablePrivacyPolicyWarning:"",arWearablePrivacyPolicyMessage:"",arEmersyaPrivacyPolicyWarning:"",arEmersyaPrivacyPolicyMessage:"","continue":"",requestingCameraAccessTitle:"",requestingCameraAccessMessage:"",tryNextToYouButtonTitle:"Rozszerzona Rzeczywisto\u015b\u0107",orGoTo:"",webGlContextLostButReloadable:"",fileDownloadErrorMessage:"",clickHereToRestart3D:"",webGlHardwareLimitedErrorMessage:"",
webGlMemoryLimitErrorMessage:"",webGlErrorMessage:"",clickHereToRestart3DOnce:"",webGlMissingOrDisabledErrorMessage:"",arInstructionOneCeiling:"",arMoveAroundNotAvailableUseChrome:"",addToCart:"",basketLineCustomTextContent:"",basketLineCustomTextFont:"",noOptionSelected:"",customTexRequired:"",customTextMaxCharactersCount:"",customTextAllowedCharacters:"",arPermissionLackContent:"W celu lepszego do\u015bwiadczenia w rozszerzonej rzeczywistosci, prosimy o zezwolenie nam dost\u0119pu do kamery internetowej <br><br> Spr\u00f3buj uruchomi\u0107 ponownie. <br> Je\u015bli to nie zadzia\u0142a, odblokuj dost\u0119p do kamery dla Emersya w ustawieniach przegl\u0105darki. <br> Na wolnych urz\u0105dzeniach mo\u017ce min\u0105\u0107 troch\u0119 czasu zanim pojawi si\u0119 okienko uprawnie\u0144. Je\u015bli twoje urz\u0105dzenie jest powolne, spr\u00f3buj chwil\u0119 poczeka\u0107 po naci\u015bni\u0119ciu przycisku START."}},
"pt-pt":{locale_name:"Portugu\u00eas",viewerObject:{disable3D:"Desativar 3D",emersyaPowered:"",enable3D:"Ativar 3D",help:"Ajuda",ok:"",or:"ao",pause:"Parar",play:"Lan\u00e7ar",playPauseAnimation:"Lan\u00e7ar/Parar anima\u00e7ao",rotate:"Tornar",setFullscreen:"Tela inteira",setLang:"Modificar a lingua",start3D:"Come\u00e7ar/Parar 3D",translate:"Deslocar",view0:"Visto por de frente",view1:"Visto traseira",view2:"Visto por de lado esquerdo",view3:"Visto por de lado direito",view6:"Visto de longe",viewpoint:"Modificar o ponto de vista",
views:"Modificar a vista",zoom:"Aumentar",zoomOut:"Aumentar fora",zoomIn:"Aumentar dentro",close:"Fechar menu",open:"Abrir menu",fullscreen:"Tela cheia",toggleAnnotations:"On/Off",toggleTriggers:"On/Off",loading:"Carregando de la 3D",view5:"Visto por de baixo",view4:"Visto por de cima",poweredBy:"",fallbackMessage:"",use:"Uso",toZoomIn:"para ampliar",CTRL:"",customizeOrder:"Personalizar e encomendar",controlZoomMessage:"",activateMotionSensor:"",chooseYourARExperience:"",inAugmentedReality:"",moveAround:"",
onlyAvailableOnMobilesAndTablets:"",placeAndInteract:"",scanQrCode:"",withArPhoto:"",tryNextToYou:"",arCannotRun:"",cameraDisabled:"",enableCamera:"",start:"",selectYourSize:"",arInstructionOne:"",arInstructionOneWorktop:"",arInstructionOneTable:"",arInstructionTwo:"",pleaseStandUp:"",sorry:"",modelIsNotCompatible:"",moveYourDevice:"",arCannotRunOnChromeIos:"",useSafari:"",sharingError:"",arPermissionDeniedContent:"",arCameraErrorTitle:"",arCameraErrorNotReadableContent:"",arCameraErrorUnknownContent:"",
activateCamera:"",motionError:"",copylink:"",restart:"",useOtherBrowsers:"",arCannotRunOpera:"",iosPopupErrorTitle:"",iosPopupErrorMessage:"",orientationChangeTitle:"",orientationChangeMessage:"",modelDisabledTitle:"",modelDisabledMessage:"",forceAr:"",devWarningMessage:"",iosMotionErrorTitle:"",iosMotionErrorMessage:"",force3D:"",fallbackUpgradeMessage:"",seeHow:"",resetAnimation:"Reset anima\u00e7ao",tryOnYou:"",onlyAvailableOnDevicesWithACamera:"",arMoveAroundNotAvailable:"",badFeaturesLevelMessage:"",
arPermissionLackContent:"Please allow us access to a camera to be able to enjoy the augmented reality experience. <br><br> Try restarting the experience. <br>If this does not work, unblock the camera access for Emersya in your browser settings.<br>On slow devices the permission popup may take some time to appear. If your device is slow, try to wait a little after pressing the START button.",arWearablePrivacyPolicyWarning:"",arWearablePrivacyPolicyMessage:"",arEmersyaPrivacyPolicyWarning:"",arEmersyaPrivacyPolicyMessage:"",
"continue":"",requestingCameraAccessTitle:"",requestingCameraAccessMessage:"",tryNextToYouButtonTitle:"Realidade aumentada",orGoTo:"",webGlContextLostButReloadable:"",fileDownloadErrorMessage:"",clickHereToRestart3D:"",webGlHardwareLimitedErrorMessage:"",webGlMemoryLimitErrorMessage:"",webGlErrorMessage:"",clickHereToRestart3DOnce:"",webGlMissingOrDisabledErrorMessage:"",arInstructionOneCeiling:"",arMoveAroundNotAvailableUseChrome:"",addToCart:"",basketLineCustomTextContent:"",basketLineCustomTextFont:"",
noOptionSelected:"",customTexRequired:"",customTextMaxCharactersCount:"",customTextAllowedCharacters:""}},"zh-tw":{locale_name:"\u81fa\u7063",viewerObject:{disable3D:"\u505c\u7528\u4e09\u7dad\u6a21\u578b",emersyaPowered:"\u7531 Emersya \u63d0\u4f9b",enable3D:"\u555f\u7528\u4e09\u7dad\u6a21\u578b",help:"\u8aaa\u660e",ok:"\u78ba\u5b9a",or:"\u6216",pause:"\u66ab\u505c",play:"\u64ad\u653e",playPauseAnimation:"\u64ad\u653e/\u66ab\u505c\u52d5\u756b",rotate:"\u65cb\u8f49",setFullscreen:"\u8a2d\u70ba\u5168\u87a2\u5e55",
setLang:"\u8b8a\u66f4\u8a9e\u8a00",start3D:"\u958b\u59cb/\u505c\u6b62\u4e09\u7dad\u6a21\u578b",translate:"\u79fb\u52d5",view0:"\u6b63\u9762\u8996\u5716",view1:"\u80cc\u9762\u8996\u5716",view2:"\u5de6\u5074\u8996\u5716",view3:"\u53f3\u5074\u8996\u5716",view6:"\u6b6a\u659c",viewpoint:"\u8b8a\u66f4\u8996\u9ede",views:"\u8b8a\u66f4\u8996\u5716",zoom:"\u7e2e\u653e",zoomOut:"\u7e2e\u5c0f",zoomIn:"\u653e\u5927",close:"\u95dc\u9589\u529f\u80fd\u8868",open:"\u958b\u555f\u529f\u80fd\u8868",fullscreen:"\u5168\u87a2\u5e55",
toggleAnnotations:"\u5f00\u5173",toggleTriggers:"\u5f00\u5173",loading:"\u6b63\u5728\u8f09\u5165\u4e09\u7dad\u6a21\u578b",view5:"\u5e95\u90e8\u8996\u5716",view4:"\u9802\u7aef\u8996\u5716",poweredBy:"\u63d0\u4f9b\u8005\u70ba",fallbackMessage:"\u76ee\u524d\u7684\u8a2d\u5b9a\u4e0d\u5141\u8a31\u57f7\u884c\u5168\u4e92\u52d5\u5f0f\u4e09\u7dad\u9ad4\u9a57\u3002\u8acb\u5617\u8a66\u4f7f\u7528\u8f03\u65b0\u7684\u7db2\u9801\u700f\u89bd\u5668\u6216\u5176\u4ed6\u88dd\u7f6e\u3002",use:"\u4f7f\u7528",toZoomIn:"\u4ee5\u653e\u5927",
CTRL:"",customizeOrder:"\u81ea\u8a02\u548c\u6392\u5e8f",controlZoomMessage:"",activateMotionSensor:"\u52d5\u4f5c\u611f\u6e2c\u5668\u5df2\u505c\u7528",chooseYourARExperience:"\u9078\u64c7 AR \u9ad4\u9a57",inAugmentedReality:"\u5728\u64f4\u589e\u5be6\u5883\u4e2d",moveAround:"\u56db\u8655\u79fb\u52d5",onlyAvailableOnMobilesAndTablets:"\u53ea\u9069\u7528\u65bc\u884c\u52d5\u88dd\u7f6e\u8207\u5e73\u677f\u96fb\u8166",placeAndInteract:"\u653e\u7f6e\u548c\u4e92\u52d5",scanQrCode:"",withArPhoto:"AR \u76f8\u7247",
tryNextToYou:"\u8a66\u8a66\u60a8\u8eab\u65c1",arCannotRun:"\u64f4\u589e\u5be6\u5883\u9ad4\u9a57\u7121\u6cd5\u57f7\u884c",cameraDisabled:"\u76f8\u6a5f\u5b58\u53d6\u6b0a\u5df2\u505c\u7528",enableCamera:"\u8acb\u5728\u700f\u89bd\u5668\u8a2d\u5b9a\u4e2d\u555f\u7528\u76f8\u6a5f\u5b58\u53d6\u6b0a\u3002\u7136\u5f8c\u91cd\u65b0\u555f\u52d5\u9ad4\u9a57\u3002",start:"\u958b\u59cb",selectYourSize:"\u60a8\u7684\u5c3a\u5bf8",arInstructionOne:"\u5c07\u7522\u54c1<b>\u653e\u5728</b>\u5730\u4e0a<br>\u70ba\u60a8\u7684\u7a7a\u9593<b>\u62cd\u651d AR \u76f8\u7247</b>",
arInstructionOneWorktop:"",arInstructionOneTable:"",arInstructionTwo:"<b>\u8abf\u6574</b>\u4f4d\u7f6e\u8207\u7522\u54c1\u9078\u9805",pleaseStandUp:"\u8acb\u8d77\u7acb",sorry:"\u5f88\u62b1\u6b49",modelIsNotCompatible:"\u578b\u865f\u4e0d\u76f8\u5bb9",moveYourDevice:"\u8acb\u5c07\u60a8\u7684\u88dd\u7f6e\u4e0a\u4e0b\u79fb\u52d5\uff0c\u4ee5\u5075\u6e2c\u5176\u65b9\u5411",arCannotRunOnChromeIos:"\u8acb\u4f7f\u7528 Safari \u7db2\u9801\u700f\u89bd\u5668",useSafari:"\u7121\u6cd5\u5728 Chrome \u700f\u89bd\u5668\u4e2d\u4f7f\u7528\u8996\u8a0a\u4e32\u6d41\uff0c\u8acb\u6539\u7528 Safari \u700f\u89bd\u5668\u3002",
sharingError:"\u5f88\u62b1\u6b49\uff0c\u767c\u751f\u932f\u8aa4\uff0c\u8acb\u5617\u8a66\u518d\u6b21\u5206\u4eab",arCameraErrorTitle:"\u8acb\u78ba\u5b9a\u4e26\u7121\u5176\u4ed6\u61c9\u7528\u7a0b\u5f0f\u6b63\u5728\u4f7f\u7528\u76f8\u6a5f",arCameraErrorNotReadableContent:"\u7121\u6cd5\u4f7f\u7528\u60a8\u7684\u76f8\u6a5f\u3002<br> \u8acb\u6aa2\u67e5\u662f\u5426\u6709\u5176\u4ed6\u61c9\u7528\u7a0b\u5f0f\u6216\u9801\u9762\u6b63\u5728\u4f7f\u7528\u76f8\u6a5f\uff0c\u7136\u5f8c\u5617\u8a66\u4e88\u4ee5\u95dc\u9589\uff0c\u518d\u91cd\u65b0\u555f\u52d5\u3002<br> \u522a\u9664\u7db2\u9801\u700f\u89bd\u5668\u7684\u5feb\u53d6\uff0c\u6216\u8a31\u6709\u5e6b\u52a9\u3002",
arCameraErrorUnknownContent:"\u5f88\u62b1\u6b49\uff0c\u8996\u8a0a\u4e32\u6d41\u767c\u751f\u4e0d\u660e\u932f\u8aa4",activateCamera:"\u8acb\u555f\u7528\u76f8\u6a5f",motionError:"\u8acb\u555f\u7528\u52d5\u4f5c\u611f\u6e2c\u5668",copylink:"\u8907\u88fd\u9023\u7d50",restart:"\u91cd\u65b0\u555f\u52d5",useOtherBrowsers:"\u8acb\u4f7f\u7528 Chrome\u3001Firefox \u6216 Edge",arCannotRunOpera:"\u7121\u6cd5\u5728 Opera \u4e2d\u4f7f\u7528\u8996\u8a0a\u4e32\u6d41\uff0c\u8acb\u4f7f\u7528\u5176\u4ed6\u700f\u89bd\u5668\u3002",
iosPopupErrorTitle:"Safari \u5c01\u9396\u5f48\u51fa\u5f0f\u8996\u7a97",iosPopupErrorMessage:"\u8acb\u5728 Safari \u7684\u300c\u4e00\u822c\u300d\u8a2d\u5b9a\u4e2d\uff0c\u505c\u7528\u300c\u963b\u64cb\u5f48\u51fa\u5f0f\u8996\u7a97\u300d\u9078\u9805\u3002",orientationChangeTitle:"",orientationChangeMessage:"",modelDisabledTitle:"\u60a8\u88dd\u7f6e\u4e0a\u7684 AR \u53ef\u80fd\u6703\u51fa\u73fe\u6027\u80fd\u554f\u984c",modelDisabledMessage:"\u60a8\u7684\u88dd\u7f6e\u7121\u6cd5\u9806\u66a2\u57f7\u884c\u64f4\u589e\u5be6\u5883\u9ad4\u9a57",
forceAr:"\u5f37\u5236 AR",devWarningMessage:"\u6b64\u4e09\u7dad\u6aa2\u8996\u5668\u50c5\u9650\u958b\u767c\u7528\u9014\u3002<br>\u8acb\u4f7f\u7528\u4e00\u822c\u9023\u7d50\u4ee5\u79fb\u9664\u6d6e\u6c34\u5370\u3002",iosMotionErrorTitle:"\u52d5\u4f5c\u611f\u6e2c\u5668\u5df2\u505c\u7528",iosMotionErrorMessage:"\u8acb\u524d\u5f80\uff1a\u8a2d\u5b9a &gt; Safari &gt; \u6e05\u9664\u700f\u89bd\u8a18\u9304\u548c\u7db2\u7ad9\u8cc7\u6599\u3002\u7136\u5f8c\u91cd\u65b0\u555f\u52d5\u9ad4\u9a57",force3D:"\u529b3D",
fallbackUpgradeMessage:"\u60a8\u6b63\u5728\u57f7\u884c\u5716\u50cf\u5f0f\u4e09\u7dad\u6a21\u578b\uff0c\u8acb\u5347\u7d1a\u7cfb\u7d71\u4ee5\u53d6\u5f97\u5168\u4e92\u52d5\u5f0f\u4e09\u7dad\u6a21\u578b\u3002",seeHow:"",resetAnimation:"\u91cd\u8a2d\u52d5\u756b",tryOnYou:"",onlyAvailableOnDevicesWithACamera:"",arMoveAroundNotAvailable:"",badFeaturesLevelMessage:"",arWearablePrivacyPolicyWarning:"",arWearablePrivacyPolicyMessage:"",arEmersyaPrivacyPolicyWarning:"",arEmersyaPrivacyPolicyMessage:"","continue":"",
requestingCameraAccessTitle:"",requestingCameraAccessMessage:"",tryNextToYouButtonTitle:"\u589e\u5f37\u73fe\u5be6",orGoTo:"",webGlContextLostButReloadable:"",fileDownloadErrorMessage:"",clickHereToRestart3D:"",webGlHardwareLimitedErrorMessage:"",webGlMemoryLimitErrorMessage:"",webGlErrorMessage:"",clickHereToRestart3DOnce:"",webGlMissingOrDisabledErrorMessage:"",arInstructionOneCeiling:"",arMoveAroundNotAvailableUseChrome:"",addToCart:"",basketLineCustomTextContent:"",basketLineCustomTextFont:"",
noOptionSelected:"",customTexRequired:"",customTextMaxCharactersCount:"",customTextAllowedCharacters:"",arPermissionDeniedContent:"\u8acb\u5141\u8a31\u5b58\u53d6\u76f8\u6a5f\uff0c\u4ee5\u4f7f\u7528\u64f4\u589e\u5be6\u5883\u9ad4\u9a57\u3002<br><br> \u5617\u8a66\u91cd\u65b0\u555f\u52d5\u9ad4\u9a57\u3002<br>\u5982\u679c\u9019\u6a23\u7121\u6cd5\u904b\u4f5c\uff0c\u8acb\u5728\u700f\u89bd\u5668\u8a2d\u5b9a\u4e2d\uff0c\u70ba Emersya \u89e3\u9396\u76f8\u6a5f\u5b58\u53d6\u6b0a\u3002<br>\u5728\u901f\u5ea6\u7de9\u6162\u7684\u88dd\u7f6e\u4e0a\uff0c\u53ef\u80fd\u9700\u8981\u4e00\u4e9b\u6642\u9593\u624d\u6703\u51fa\u73fe\u6b0a\u9650\u5f48\u51fa\u5f0f\u8996\u7a97\u3002\u5982\u679c\u60a8\u7684\u88dd\u7f6e\u901f\u5ea6\u7de9\u6162\uff0c\u8acb\u5617\u8a66\u5728\u6309\u4e0b\u300c\u958b\u59cb\u300d\u6309\u9215\u5f8c\uff0c\u7a0d\u5019\u7247\u523b\u3002",
arPermissionLackContent:"\u8acb\u5141\u8a31\u5b58\u53d6\u76f8\u6a5f\uff0c\u4ee5\u4f7f\u7528\u64f4\u589e\u5be6\u5883\u9ad4\u9a57\u3002<br><br> \u5617\u8a66\u91cd\u65b0\u555f\u52d5\u9ad4\u9a57\u3002<br>\u5982\u679c\u9019\u6a23\u7121\u6cd5\u904b\u4f5c\uff0c\u8acb\u5728\u700f\u89bd\u5668\u8a2d\u5b9a\u4e2d\uff0c\u70ba Emersya \u89e3\u9396\u76f8\u6a5f\u5b58\u53d6\u6b0a\u3002<br>\u5728\u901f\u5ea6\u7de9\u6162\u7684\u88dd\u7f6e\u4e0a\uff0c\u53ef\u80fd\u9700\u8981\u4e00\u4e9b\u6642\u9593\u624d\u6703\u51fa\u73fe\u6b0a\u9650\u5f48\u51fa\u5f0f\u8996\u7a97\u3002\u5982\u679c\u60a8\u7684\u88dd\u7f6e\u901f\u5ea6\u7de9\u6162\uff0c\u8acb\u5617\u8a66\u5728\u6309\u4e0b\u300c\u958b\u59cb\u300d\u6309\u9215\u5f8c\uff0c\u7a0d\u5019\u7247\u523b\u3002"}},
"zh-cn":{locale_name:"\u4e2d\u6587",viewerObject:{disable3D:"\u4f60\u597d",emersyaPowered:"\u7531Emersya\u4f9b\u7535",enable3D:"\u542f\u75283D",help:"\u5e2e\u52a9",ok:"\u597d\u7684",or:"\u6291\u6216",pause:"\u6682\u505c",play:"\u73a9",playPauseAnimation:"\u64ad\u653e/\u6682\u505c\u52a8\u753b",rotate:"\u65cb\u8f6c",setFullscreen:"\u8bbe\u7f6e\u5168\u5c4f",setLang:"\u6539\u53d8\u8bed\u8a00",start3D:"\u542f\u52a8/\u505c\u6b623D",translate:"\u79fb\u52a8",view0:"\u6b63\u89c6\u56fe",view1:"\u540e\u89c6\u56fe",
view2:"\u5de6\u89c6\u56fe",view3:"\u6b63\u786e\u7684\u770b\u6cd5",view6:"\u770b\u6cd5",viewpoint:"\u6539\u53d8\u89c2\u70b9",views:"\u53d8\u66f4\u68c0\u89c6",zoom:"\u98de\u6da8",zoomOut:"\u7f29\u5c0f",zoomIn:"\u653e\u5927",close:"\u5173\u95ed\u83dc\u5355",open:"\u6253\u5f00\u83dc\u5355",fullscreen:"\u5168\u5c4f\u83dc\u5355",toggleAnnotations:"\u5f00\u5173",toggleTriggers:"\u5f00\u5173",loading:"\u8f7d\u51653D",view5:"\u5e95\u89c6\u56fe",view4:"\u9876\u89c6\u56fe",poweredBy:"\u4f9b\u7535",fallbackMessage:"\u60a8\u5f53\u524d\u7684\u914d\u7f6e\u4e0d\u5141\u8bb8\u60a8\u8fd0\u884c\u5b8c\u5168\u4ea4\u4e92\u5f0f\u76843D\u4f53\u9a8c\u3002\u8bf7\u5c1d\u8bd5\u4f7f\u7528\u66f4\u65b0\u7684\u7f51\u7edc\u6d4f\u89c8\u5668\u6216\u5176\u4ed6\u8bbe\u5907\u3002",
use:"\u4f7f\u7528",toZoomIn:"\u653e\u5927",CTRL:"",customizeOrder:"\u81ea\u5b9a\u4e49\u548c\u8ba2\u8d2d",controlZoomMessage:"",activateMotionSensor:"",chooseYourARExperience:"",inAugmentedReality:"",moveAround:"",onlyAvailableOnMobilesAndTablets:"",placeAndInteract:"",scanQrCode:"",withArPhoto:"",tryNextToYou:"",arCannotRun:"",cameraDisabled:"",enableCamera:"",start:"",selectYourSize:"",arInstructionOne:"",arInstructionOneWorktop:"",arInstructionOneTable:"",arInstructionTwo:"",pleaseStandUp:"",sorry:"",
modelIsNotCompatible:"",moveYourDevice:"",arCannotRunOnChromeIos:"",useSafari:"",sharingError:"",arPermissionDeniedContent:"",arCameraErrorTitle:"",arCameraErrorNotReadableContent:"",arCameraErrorUnknownContent:"",activateCamera:"",motionError:"",copylink:"",restart:"",useOtherBrowsers:"",arCannotRunOpera:"",iosPopupErrorTitle:"",iosPopupErrorMessage:"",orientationChangeTitle:"",orientationChangeMessage:"",modelDisabledTitle:"",modelDisabledMessage:"",forceAr:"",devWarningMessage:"",iosMotionErrorTitle:"",
iosMotionErrorMessage:"",force3D:"\u529b3D",fallbackUpgradeMessage:"",seeHow:"",resetAnimation:"",tryOnYou:"",onlyAvailableOnDevicesWithACamera:"",arMoveAroundNotAvailable:"",badFeaturesLevelMessage:"",arPermissionLackContent:"Please allow us access to a camera to be able to enjoy the augmented reality experience. <br><br> Try restarting the experience. <br>If this does not work, unblock the camera access for Emersya in your browser settings.<br>On slow devices the permission popup may take some time to appear. If your device is slow, try to wait a little after pressing the START button.",
arWearablePrivacyPolicyWarning:"",arWearablePrivacyPolicyMessage:"",arEmersyaPrivacyPolicyWarning:"",arEmersyaPrivacyPolicyMessage:"","continue":"",requestingCameraAccessTitle:"",requestingCameraAccessMessage:"",tryNextToYouButtonTitle:"\u589e\u5f3a\u73b0\u5b9e",orGoTo:"",webGlContextLostButReloadable:"",fileDownloadErrorMessage:"",clickHereToRestart3D:"",webGlHardwareLimitedErrorMessage:"",webGlMemoryLimitErrorMessage:"",webGlErrorMessage:"",clickHereToRestart3DOnce:"",webGlMissingOrDisabledErrorMessage:"",
arInstructionOneCeiling:"",arMoveAroundNotAvailableUseChrome:"",addToCart:"",basketLineCustomTextContent:"",basketLineCustomTextFont:"",noOptionSelected:"",customTexRequired:"",customTextMaxCharactersCount:"\u6700\u5927\u6587\u5b57\u6570\uff1a",customTextAllowedCharacters:"\u8a31\u53ef\u3055\u308c\u305f\u6587\u5b57\uff1a"}},"ro-ro":{locale_name:"Rom\u00e2n\u0103",viewerObject:{disable3D:"Dezactiveaza 3D",emersyaPowered:"Generat de Emersya",enable3D:"Activeaza 3D",help:"Ajutor",ok:"",or:"sau",pause:"Pauza",
play:"Porneste",playPauseAnimation:"Porneste/Pauza",rotate:"Roteste",setFullscreen:"Seteaz\u0103 ecran plin",setLang:"Schimba Limba",start3D:"Pornire/Stop 3D",translate:"Misca",view0:"Fata",view1:"Vedere din spate",view2:"Stanga",view3:"Dreapta",view6:"Perspectiva",viewpoint:"Schimba PDV",views:"Schimba perspectiva",zoom:"Mareste",zoomOut:"Micsoreaza",zoomIn:"Mareste",close:"Inchide meniul",open:"Deschide Meniul",fullscreen:"Ecran plin",toggleAnnotations:"On/Off",toggleTriggers:"Schimba Declansarile",
loading:"Incarcare 3D",view5:"Jos",view4:"Vedere de sus",poweredBy:"Creat de",fallbackMessage:"Experien\u021ba 3D complet interactiv\u0103. \u00cencerca\u021bi un browser web mai recent sau alt dispozitiv.",use:"Utilizeaza",toZoomIn:"pentru a m\u0103ri",CTRL:"",customizeOrder:"Personaliza\u021bi \u0219i ordona\u021bi",controlZoomMessage:"",activateMotionSensor:"",chooseYourARExperience:"",inAugmentedReality:"",moveAround:"",onlyAvailableOnMobilesAndTablets:"",placeAndInteract:"",scanQrCode:"",withArPhoto:"",
tryNextToYou:"",arCannotRun:"",cameraDisabled:"",enableCamera:"",start:"",selectYourSize:"",arInstructionOne:"",arInstructionOneWorktop:"",arInstructionOneTable:"",arInstructionTwo:"",pleaseStandUp:"",sorry:"",modelIsNotCompatible:"",moveYourDevice:"",arCannotRunOnChromeIos:"",useSafari:"",sharingError:"",arPermissionDeniedContent:"",arCameraErrorTitle:"",arCameraErrorNotReadableContent:"",arCameraErrorUnknownContent:"",activateCamera:"",motionError:"",copylink:"",restart:"",useOtherBrowsers:"",arCannotRunOpera:"",
iosPopupErrorTitle:"",iosPopupErrorMessage:"",orientationChangeTitle:"",orientationChangeMessage:"",modelDisabledTitle:"",modelDisabledMessage:"",forceAr:"",devWarningMessage:"",iosMotionErrorTitle:"",iosMotionErrorMessage:"",force3D:"Forta 3D",fallbackUpgradeMessage:"Actualiza\u021bi-v\u0103 sistemul pentru a ob\u021bine un 3D interactiv complet.",seeHow:"Uite cum",resetAnimation:"Restartati animatia",tryOnYou:"",onlyAvailableOnDevicesWithACamera:"",arMoveAroundNotAvailable:"",badFeaturesLevelMessage:"",
arPermissionLackContent:"Please allow us access to a camera to be able to enjoy the augmented reality experience. <br><br> Try restarting the experience. <br>If this does not work, unblock the camera access for Emersya in your browser settings.<br>On slow devices the permission popup may take some time to appear. If your device is slow, try to wait a little after pressing the START button.",arWearablePrivacyPolicyWarning:"",arWearablePrivacyPolicyMessage:"",arEmersyaPrivacyPolicyWarning:"",arEmersyaPrivacyPolicyMessage:"",
"continue":"",requestingCameraAccessTitle:"",requestingCameraAccessMessage:"",tryNextToYouButtonTitle:"Realitate augmentat\u0103",orGoTo:"",webGlContextLostButReloadable:"",fileDownloadErrorMessage:"",clickHereToRestart3D:"",webGlHardwareLimitedErrorMessage:"",webGlMemoryLimitErrorMessage:"",webGlErrorMessage:"",clickHereToRestart3DOnce:"",webGlMissingOrDisabledErrorMessage:"",arInstructionOneCeiling:"",arMoveAroundNotAvailableUseChrome:"",addToCart:"",basketLineCustomTextContent:"",basketLineCustomTextFont:"",
noOptionSelected:"",customTexRequired:"",customTextMaxCharactersCount:"",customTextAllowedCharacters:""}},"de-de":{locale_name:"Deutsche",viewerObject:{disable3D:"Schalten Sie 3D aus",emersyaPowered:"",enable3D:"Aktivieren Sie 3D",help:"Hilfe",ok:"",or:"oder",pause:"",play:"abspielen",playPauseAnimation:"Animation abspielen / anhalten",rotate:"Drehen",setFullscreen:"Vollbild",setLang:"Sprache \u00e4ndern",start3D:"",translate:"Bewegen",view0:"Frontansicht",view1:"R\u00fcckansicht",view2:"Linke Seite",
view3:"Rechte Seite",view6:"Freie Ansicht",viewpoint:"Ausgangspunkt \u00e4ndern",views:"Ansicht \u00e4ndern",zoom:"",zoomOut:"Rauszoomen",zoomIn:"Einzoomen",close:"Men\u00fc schlie\u00dfen",open:"Men\u00fc \u00f6ffnen",fullscreen:"Vollbild",toggleAnnotations:"On/Off",toggleTriggers:"On/Off",loading:"Laden 3D",view5:"Bodenansicht",view4:"Vogelperspektive",poweredBy:"",fallbackMessage:"",use:"Zum Zoomen",toZoomIn:"um zu zoomen",CTRL:"",customizeOrder:"Anpassen und bestellen",controlZoomMessage:"",activateMotionSensor:"",
chooseYourARExperience:"",inAugmentedReality:"",moveAround:"",onlyAvailableOnMobilesAndTablets:"",placeAndInteract:"",scanQrCode:"",withArPhoto:"",tryNextToYou:"",arCannotRun:"",cameraDisabled:"",enableCamera:"",start:"",selectYourSize:"",arInstructionOne:"",arInstructionOneWorktop:"",arInstructionOneTable:"",arInstructionTwo:"",pleaseStandUp:"",sorry:"",modelIsNotCompatible:"",moveYourDevice:"",arCannotRunOnChromeIos:"",useSafari:"",sharingError:"",arPermissionDeniedContent:"",arCameraErrorTitle:"",
arCameraErrorNotReadableContent:"",arCameraErrorUnknownContent:"",activateCamera:"",motionError:"",copylink:"",restart:"",useOtherBrowsers:"",arCannotRunOpera:"",iosPopupErrorTitle:"",iosPopupErrorMessage:"",orientationChangeTitle:"",orientationChangeMessage:"",modelDisabledTitle:"",modelDisabledMessage:"",forceAr:"",devWarningMessage:"",iosMotionErrorTitle:"",iosMotionErrorMessage:"",force3D:"",fallbackUpgradeMessage:"",seeHow:"",resetAnimation:"",tryOnYou:"",onlyAvailableOnDevicesWithACamera:"",
arMoveAroundNotAvailable:"",badFeaturesLevelMessage:"",arPermissionLackContent:"Please allow us access to a camera to be able to enjoy the augmented reality experience. <br><br> Try restarting the experience. <br>If this does not work, unblock the camera access for Emersya in your browser settings.<br>On slow devices the permission popup may take some time to appear. If your device is slow, try to wait a little after pressing the START button.",arWearablePrivacyPolicyWarning:"",arWearablePrivacyPolicyMessage:"",
arEmersyaPrivacyPolicyWarning:"",arEmersyaPrivacyPolicyMessage:"","continue":"",requestingCameraAccessTitle:"",requestingCameraAccessMessage:"",tryNextToYouButtonTitle:"Erweiterte Realit\u00e4t",orGoTo:"",webGlContextLostButReloadable:"",fileDownloadErrorMessage:"",clickHereToRestart3D:"",webGlHardwareLimitedErrorMessage:"",webGlMemoryLimitErrorMessage:"",webGlErrorMessage:"",clickHereToRestart3DOnce:"",webGlMissingOrDisabledErrorMessage:"",arInstructionOneCeiling:"",arMoveAroundNotAvailableUseChrome:"",
addToCart:"In den Warenkorb",basketLineCustomTextContent:"Text",basketLineCustomTextFont:"Schriftart",noOptionSelected:"Keine",customTexRequired:"Dieses Feld muss ausgef\u00fcllt werden.",customTextMaxCharactersCount:"Maximale Anzahl von Zeichen :",customTextAllowedCharacters:"Erlaubte Zeichen :"}},"cs-cz":{locale_name:"\u010ce\u0161ka",viewerObject:{disable3D:"Vypnout 3D",emersyaPowered:"B\u011b\u017e\u00ed na Emersya",enable3D:"Zapnout 3D",help:"N\u00e1pov\u011bda",ok:"",or:"nebo",pause:"Pauza",
play:"P\u0159ehr\u00e1t",playPauseAnimation:"P\u0159ehr\u00e1t/Pozastavit animaci",rotate:"Ot\u00e1\u010det",setFullscreen:"Nastavit na celou obrazovku",setLang:"Zm\u011bnit jazyk",start3D:"Spustit/Zastavit 3D",translate:"H\u00fdbat",view0:"\u010celn\u00ed pohled",view1:"Zp\u011btn\u00fd pohled",view2:"Zm\u011bnit uhel pohledu",view3:"Pohled zprava",view6:"Perspektiva",viewpoint:"Pohled zleva",views:"Zm\u011bna pohledu",zoom:"Lupa",zoomOut:"Odd\u00e1lit",zoomIn:"P\u0159ibl\u00ed\u017eit",close:"Zav\u0159\u00edt menu",
open:"Otev\u0159\u00edt menu",fullscreen:"Cel\u00e1 obrazovka",toggleAnnotations:"On/Off",toggleTriggers:"On/Off",loading:"Na\u010d\u00edt\u00e1n\u00ed 3D",view5:"Pohled zespoda",view4:"Pohled shora",poweredBy:"B\u011b\u017e\u00ed na",fallbackMessage:"",use:"Pou\u017eit\u00ed",toZoomIn:"pro p\u0159ibl\u00ed\u017een\u00ed",CTRL:"",customizeOrder:"P\u0159izp\u016fsobte &amp;",controlZoomMessage:"",activateMotionSensor:"",chooseYourARExperience:"",inAugmentedReality:"",moveAround:"",onlyAvailableOnMobilesAndTablets:"",
placeAndInteract:"",scanQrCode:"",withArPhoto:"",tryNextToYou:"",arCannotRun:"",cameraDisabled:"",enableCamera:"",start:"",selectYourSize:"",arInstructionOne:"",arInstructionOneWorktop:"",arInstructionOneTable:"",arInstructionTwo:"",pleaseStandUp:"",sorry:"",modelIsNotCompatible:"",moveYourDevice:"",arCannotRunOnChromeIos:"",useSafari:"",sharingError:"",arPermissionDeniedContent:"",arCameraErrorTitle:"",arCameraErrorNotReadableContent:"",arCameraErrorUnknownContent:"",activateCamera:"",motionError:"",
copylink:"",restart:"",useOtherBrowsers:"",arCannotRunOpera:"",iosPopupErrorTitle:"",iosPopupErrorMessage:"",orientationChangeTitle:"",orientationChangeMessage:"",modelDisabledTitle:"",modelDisabledMessage:"",forceAr:"",devWarningMessage:"",iosMotionErrorTitle:"",iosMotionErrorMessage:"",force3D:"",fallbackUpgradeMessage:"",seeHow:"",resetAnimation:"Reset animaci",tryOnYou:"",onlyAvailableOnDevicesWithACamera:"",arMoveAroundNotAvailable:"",badFeaturesLevelMessage:"",arPermissionLackContent:"Please allow us access to a camera to be able to enjoy the augmented reality experience. <br><br> Try restarting the experience. <br>If this does not work, unblock the camera access for Emersya in your browser settings.<br>On slow devices the permission popup may take some time to appear. If your device is slow, try to wait a little after pressing the START button.",
arWearablePrivacyPolicyWarning:"",arWearablePrivacyPolicyMessage:"",arEmersyaPrivacyPolicyWarning:"",arEmersyaPrivacyPolicyMessage:"","continue":"",requestingCameraAccessTitle:"",requestingCameraAccessMessage:"",tryNextToYouButtonTitle:"Roz\u0161\u00ed\u0159en\u00e1 realita",orGoTo:"",webGlContextLostButReloadable:"",fileDownloadErrorMessage:"",clickHereToRestart3D:"",webGlHardwareLimitedErrorMessage:"",webGlMemoryLimitErrorMessage:"",webGlErrorMessage:"",clickHereToRestart3DOnce:"",webGlMissingOrDisabledErrorMessage:"",
arInstructionOneCeiling:"",arMoveAroundNotAvailableUseChrome:"",addToCart:"",basketLineCustomTextContent:"",basketLineCustomTextFont:"",noOptionSelected:"",customTexRequired:"",customTextMaxCharactersCount:"",customTextAllowedCharacters:""}},"no-no":{locale_name:"norsk",viewerObject:{disable3D:"Sl\u00e5 av 3D",emersyaPowered:"",enable3D:"Sl\u00e5 p\u00e5 3D",help:"Hjelp",ok:"",or:"eller",pause:"",play:"Spill av",playPauseAnimation:"Spill av/Pause animasjon",rotate:"Rot\u00e9r",setFullscreen:"Fullskjerm",
setLang:"Endre spr\u00e5k",start3D:"",translate:"Flytt",view0:"Foran",view1:"Sett bakfra",view2:"Venstre",view3:"H\u00f8yre",view6:"Perspektiv",viewpoint:"Endre utgangspunkt",views:"Endre syn",zoom:"",zoomOut:"Zoom ut",zoomIn:"Zoom inn",close:"Lukk meny",open:"\u00c5pne meny",fullscreen:"Fullskjerm",toggleAnnotations:"Annotasjoner p\u00e5/av",toggleTriggers:"Triggere p\u00e5/av",loading:"Laster 3D",view5:"Bunn",view4:"Topp",poweredBy:"",fallbackMessage:"Dine innstillinger lar deg ikke kj\u00f8re interaktiv 3D opplevelse. Vennligst pr\u00f8v en nyere nettleser eller annen enhet",
use:"Bruk",toZoomIn:"for \u00e5 zoome",CTRL:"",customizeOrder:" objedn\u00e1vejte",controlZoomMessage:"",activateMotionSensor:"",chooseYourARExperience:"",inAugmentedReality:"",moveAround:"",onlyAvailableOnMobilesAndTablets:"",placeAndInteract:"",scanQrCode:"",withArPhoto:"",tryNextToYou:"",arCannotRun:"",cameraDisabled:"",enableCamera:"",start:"",selectYourSize:"",arInstructionOne:"",arInstructionOneWorktop:"",arInstructionOneTable:"",arInstructionTwo:"",pleaseStandUp:"",sorry:"",modelIsNotCompatible:"",
moveYourDevice:"",arCannotRunOnChromeIos:"",useSafari:"",sharingError:"",arPermissionDeniedContent:"",arCameraErrorTitle:"",arCameraErrorNotReadableContent:"",arCameraErrorUnknownContent:"",activateCamera:"",motionError:"",copylink:"",restart:"",useOtherBrowsers:"",arCannotRunOpera:"",iosPopupErrorTitle:"",iosPopupErrorMessage:"",orientationChangeTitle:"",orientationChangeMessage:"",modelDisabledTitle:"",modelDisabledMessage:"",forceAr:"",devWarningMessage:"",iosMotionErrorTitle:"",iosMotionErrorMessage:"",
force3D:"",fallbackUpgradeMessage:"Du ser n\u00e5 bildebasert 3D. Oppgrad\u00e9r systemet for \u00e5 oppleve full interaktiv 3D",seeHow:"seHvordan",resetAnimation:"tilbakestill animasjon",tryOnYou:"",onlyAvailableOnDevicesWithACamera:"",arMoveAroundNotAvailable:"",badFeaturesLevelMessage:"",arPermissionLackContent:"Please allow us access to a camera to be able to enjoy the augmented reality experience. <br><br> Try restarting the experience. <br>If this does not work, unblock the camera access for Emersya in your browser settings.<br>On slow devices the permission popup may take some time to appear. If your device is slow, try to wait a little after pressing the START button.",
arWearablePrivacyPolicyWarning:"",arWearablePrivacyPolicyMessage:"",arEmersyaPrivacyPolicyWarning:"",arEmersyaPrivacyPolicyMessage:"","continue":"",requestingCameraAccessTitle:"",requestingCameraAccessMessage:"",tryNextToYouButtonTitle:"Utvidet virkelighet",orGoTo:"",webGlContextLostButReloadable:"",fileDownloadErrorMessage:"",clickHereToRestart3D:"",webGlHardwareLimitedErrorMessage:"",webGlMemoryLimitErrorMessage:"",webGlErrorMessage:"",clickHereToRestart3DOnce:"",webGlMissingOrDisabledErrorMessage:"",
arInstructionOneCeiling:"",arMoveAroundNotAvailableUseChrome:"",addToCart:"",basketLineCustomTextContent:"",basketLineCustomTextFont:"",noOptionSelected:"",customTexRequired:"",customTextMaxCharactersCount:"",customTextAllowedCharacters:""}},"ko-ko":{locale_name:"\ud55c\uad6d\uc5b4",viewerObject:{disable3D:"3D \ube44\ud65c\uc131\ud654",emersyaPowered:"Emersya \uc791\ub3d9",enable3D:"3D \ud65c\uc131\ud654",help:"\ub3c4\uc6c0",ok:"\ud655\uc778",or:"\ub610\ub294",pause:"\uc911\uc9c0",play:"\uc7ac\uc0dd",
playPauseAnimation:"\uc560\ub2c8\uba54\uc774\uc158 \uc7ac\uc0dd/\uc77c\uc2dc\uc911\uc9c0",rotate:"\ud68c\uc804",setFullscreen:"\uc804\uccb4\ud654\uba74 \uc124\uc815",setLang:"\uc5b8\uc5b4 \ubcc0\uacbd",start3D:"3D \uc2dc\uc791/\uc911\uc9c0",translate:"\uc774\ub3d9",view0:"\uc815\uba74 \ubcf4\uae30",view1:"\ud6c4\uba74 \ubcf4\uae30",view2:"\uc67c\ucabd \ubcf4\uae30",view3:"\uc624\ub978\ucabd \ubcf4\uae30",view6:"\uc6d0\uadfc\ubc95",viewpoint:"\uad00\uc810 \ubcc0\uacbd",views:"\ubcf4\uae30 \ubcc0\uacbd",
zoom:"\uc90c",zoomOut:"\ucd95\uc18c",zoomIn:"\ud655\ub300",close:"\uba54\ub274 \ub2eb\uae30",open:"\uba54\ub274 \uc5f4\uae30",fullscreen:"\uc804\uccb4 \ud654\uba74",toggleAnnotations:"\ucf1c\uae30 / \ub044\uae30",toggleTriggers:"\ud2b8\ub9ac\uac70 \uc804\ud658",loading:"3D \ub85c\ub529",view5:"\ud558\ub2e8 \ubcf4\uae30",view4:"\uc0c1\ub2e8 \ubcf4\uae30",poweredBy:"~\uc5d0 \uc758\ud574 \uc6c0\uc9c1\uc774\ub294",fallbackMessage:"\ud604\uc7ac \ucef4\ud4e8\ud130 \ud658\uacbd\uc73c\ub85c\ub294 \uc644\uc804\ud55c 3D\ub97c \uc2e4\ud589\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4. \ucd5c\uc2e0 \uc6f9 \ub4dc\ub77c\uc6b0\uc800 \ub610\ub294 \ub2e4\ub978 \uc7a5\uce58\ub97c \uc0ac\uc6a9\ud558\uc2ed\uc2dc\uc624.",
use:"\uc0ac\uc6a9",toZoomIn:"\ud655\ub300\ud558\uae30",CTRL:"",customizeOrder:"Tilpass og bestill",controlZoomMessage:"",activateMotionSensor:"\ubaa8\uc158 \uc13c\uc11c \ube44\ud65c\uc131\ud654",chooseYourARExperience:"AR \uacbd\ud5d8 \uc120\ud0dd",inAugmentedReality:"AR",moveAround:"\uc774\ub3d9",onlyAvailableOnMobilesAndTablets:"\ubaa8\ubc14\uc77c \ubc0f \ud0dc\ube14\ub9bf\uc5d0\uc11c\ub9cc \uc0ac\uc6a9 \uac00\ub2a5",placeAndInteract:"\ubc30\uce58 \ubc0f \uc0c1\ud638\uc791\uc6a9",scanQrCode:"",
withArPhoto:"AR \uc0ac\uc9c4 \ud3ec\ud568",tryNextToYou:"\uc606\uc5d0\uc11c \uc2dc\ub3c4 \ud558\uc2ed\uc2dc\uc624.",arCannotRun:"AR\uc744 \uc2e4\ud589\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4.",cameraDisabled:"\uce74\uba54\ub77c \uc561\uc138\uc2a4 \ube44\ud65c\uc131\ud654",enableCamera:"\ube0c\ub77c\uc6b0\uc800 \uc124\uc815\uc5d0\uc11c \uce74\uba54\ub77c \uc561\uc138\uc2a4\ub97c \ud65c\uc131\ud654\ud558\uc2ed\uc2dc\uc624. \uadf8\ub7f0 \ub2e4\uc74c \uacbd\ud5d8\uc744 \ub2e4\uc2dc \uc2dc\uc791\ud558\uc2ed\uc2dc\uc624.",
start:"\uc2dc\uc791",selectYourSize:"\uc0ac\uc774\uc988 \uc120\ud0dd",arInstructionOne:"\uc81c\ud488\uc744 \ubc14\ub2e5\uc5d0 \ub193\uc73c\uc2ed\uc2dc\uc624. \uadf8\ub9ac\uace0 \uadf8 \uc790\ub9ac\uc5d0\uc11c AR \uc0ac\uc9c4\uc744 \ucc0d\uc73c\uc138\uc694.",arInstructionOneWorktop:"",arInstructionOneTable:"",arInstructionTwo:"\uc704\uce58 \ubc0f \uc81c\ud488 \uc635\uc158 \ubcc0\uacbd",pleaseStandUp:"\uc77c\uc5b4\uc11c \uc8fc\uc2ed\uc2dc\uc624.",sorry:"\uc8c4\uc1a1\ud569\ub2c8\ub2e4.",modelIsNotCompatible:"\ubaa8\ub378\uc774 \ud638\ud658\ub418\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4.",
moveYourDevice:"\ubc29\ud5a5\uc744 \uac10\uc9c0\ud558\ub824\uba74 \uae30\uae30\ub97c \uc704 \uc544\ub798\ub85c \uc774\ub3d9\ud558\uc138\uc694.",arCannotRunOnChromeIos:"Safari \uc6f9 \ube0c\ub77c\uc6b0\uc800\ub97c \uc774\uc6a9\ud574 \uc8fc\uc2ed\uc2dc\uc624.",useSafari:"Chrome \ube0c\ub77c\uc6b0\uc800\uc5d0\uc11c\ub294 \ube44\ub514\uc624 \uc2a4\ud2b8\ub9ac\ubc0d\uc774 \ubd88\uac00\ud569\ub2c8\ub2e4. \ub300\uc2e0 Safari\ub97c \uc0ac\uc6a9\ud574 \uc8fc\uc2ed\uc2dc\uc624.",sharingError:"\uc624\ub958\uac00 \ubc1c\uc0dd\ud588\uc2b5\ub2c8\ub2e4. \ub2e4\uc2dc \uacf5\uc720\ud574 \uc8fc\uc2ed\uc2dc\uc624.",
arPermissionDeniedContent:"",arCameraErrorTitle:"\ub2e4\ub978 \uc751\uc6a9 \ud504\ub85c\uadf8\ub7a8\uc774 \uce74\uba54\ub77c\ub97c \uc0ac\uc6a9\ud558\uace0 \uc788\uc9c0 \uc54a\uc740\uc9c0 \ud655\uc778\ud558\uc2ed\uc2dc\uc624.",arCameraErrorNotReadableContent:"\uce74\uba54\ub77c\ub97c \uc0ac\uc6a9\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4. <br> \ub2e4\ub978 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc774\ub098 \ud398\uc774\uc9c0\uc5d0\uc11c \uc0ac\uc6a9 \uc911\uc778\uc9c0 \ud655\uc778\ud558\uace0 \uc885\ub8cc\ud55c \ub2e4\uc74c \ub2e4\uc2dc \uc2dc\uc791\ud574\uc8fc\uc138\uc694. <br> \uc6f9 \ube0c\ub77c\uc6b0\uc800\uc758 \uce90\uc2dc\ub97c \uc0ad\uc81c\ud558\uba74 \ub3c4\uc6c0\uc774 \ub420 \uc218 \uc788\uc2b5\ub2c8\ub2e4.",
arCameraErrorUnknownContent:"\uc8c4\uc1a1\ud569\ub2c8\ub2e4. \ub3d9\uc601\uc0c1 \uc2a4\ud2b8\ub9ac\ubc0d\uc5d0 \uc54c \uc218 \uc5c6\ub294 \uc624\ub958\uac00 \ubc1c\uc0dd\ud558\uc600\uc2b5\ub2c8\ub2e4.",activateCamera:"\uce74\uba54\ub77c\ub97c \ud65c\uc131\ud654 \ud558\uc2ed\uc2dc\uc624.",motionError:"\ubaa8\uc158 \uc13c\uc11c\ub97c \ud65c\uc131\ud654 \ud574\uc8fc\uc2ed\uc2dc\uc624.",copylink:"\ub9c1\ud06c \ubcf5\uc0ac",restart:"\uc7ac\uc2dc\uc791",useOtherBrowsers:"Chrome, Firefox, \ub610\ub294 Edge\ub97c \uc0ac\uc6a9\ud558\uc2ed\uc2dc\uc624.",
arCannotRunOpera:"Opera\uc5d0\uc11c\ub294 \ube44\ub514\uc624 \uc2a4\ud2b8\ub9ac\ubc0d\uc744 \uc0ac\uc6a9\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4. \ub2e4\ub978 \ube0c\ub77c\uc6b0\uc800\ub97c \uc0ac\uc6a9\ud558\uc2ed\uc2dc\uc624.",iosPopupErrorTitle:"Safari\uac00 \ud31d\uc5c5\uc744 \ucc28\ub2e8\ud558\uace0 \uc788\uc2b5\ub2c8\ub2e4.",iosPopupErrorMessage:"Safari \uc77c\ubc18 \uc124\uc815\uc5d0\uc11c \ud31d\uc5c5 \ucc28\ub2e8 \uc635\uc158\uc744 \ube44\ud65c\uc131\ud654 \ud558\uc2ed\uc2dc\uc624.",orientationChangeTitle:"\ubc29\ud5a5 \ubcc0\uacbd",
orientationChangeMessage:"\ucd08\uae30 \ubc29\ud5a5\uc73c\ub85c \ubcc0\uacbd\ud558\uac70\ub098 \uacbd\ud5d8\uc744 \ub2e4\uc2dc \uc2dc\uc791\ud558\uc138\uc694.",modelDisabledTitle:"\uc0ac\uc6a9\ud558\uc2dc\ub294 \ub514\ubc14\uc774\uc2a4\uac00 AR \uc2e4\ud589\uc5d0 \ubb38\uc81c\uac00 \uc788\uc744 \uc218 \uc788\uc2b5\ub2c8\ub2e4.",modelDisabledMessage:"\uc7a5\uce58\uc5d0\uc11c AR\uc744 \uc6d0\ud65c\ud558\uac8c \uc2e4\ud589\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4.",forceAr:"AR \uac15\uc81c",devWarningMessage:"\uc774 3D \ubdf0\uc5b4\ub294 \uac1c\ubc1c \uc804\uc6a9 \uc785\ub2c8\ub2e4. \uc6cc\ud130 \ub9c8\ud06c\ub97c \uc81c\uac70\ud558\ub824\uba74 \uc77c\ubc18 \ub9c1\ud06c\ub97c \uc0ac\uc6a9\ud558\uc2ed\uc2dc\uc624.",
iosMotionErrorTitle:"\uc6c0\uc9c1\uc784 \uac10\uc9c0(Motion Sensor) \ube44\ud65c\uc131\ud654",iosMotionErrorMessage:"\uc124\uc815 &gt; \uc0ac\ud30c\ub9ac &gt; \ubc29\ubb38 \uae30\ub85d \ubc0f \uc6f9 \uc0ac\uc774\ud2b8 \ub370\uc774\ud130 \uc9c0\uc6b0\uae30. \uadf8\ub7f0 \ub2e4\uc74c \uacbd\ud5d8\uc744 \ub2e4\uc2dc \uc2dc\uc791\ud558\uc2ed\uc2dc\uc624.",force3D:"3D \uac15\uc81c",fallbackUpgradeMessage:"\uc774\ubbf8\uc9c0\ub97c \uae30\ubc18\uc73c\ub85c 3D\ub97c \uc2e4\ud589 \uc911\uc785\ub2c8\ub2e4. \uc2dc\uc2a4\ud15c\uc744 \uc5c5\uadf8\ub808\uc774\ub4dc \ud558\uc5ec \uc644\uc804\ud55c 3D\ub97c \uc5bb\uc73c\uc2ed\uc2dc\uc624.",
seeHow:"\ubc29\ubc95\ubcf4\uae30",resetAnimation:"\uc560\ub2c8\uba54\uc774\uc158 \uc7ac\uc124\uc815",tryOnYou:"",onlyAvailableOnDevicesWithACamera:"",arMoveAroundNotAvailable:"",badFeaturesLevelMessage:"",arWearablePrivacyPolicyWarning:"",arWearablePrivacyPolicyMessage:"",arEmersyaPrivacyPolicyWarning:"",arEmersyaPrivacyPolicyMessage:"","continue":"",requestingCameraAccessTitle:"",requestingCameraAccessMessage:"",tryNextToYouButtonTitle:"\uc99d\uac15 \ud604\uc2e4",orGoTo:"",webGlContextLostButReloadable:"",
fileDownloadErrorMessage:"",clickHereToRestart3D:"",webGlHardwareLimitedErrorMessage:"",webGlMemoryLimitErrorMessage:"",webGlErrorMessage:"",clickHereToRestart3DOnce:"",webGlMissingOrDisabledErrorMessage:"",arInstructionOneCeiling:"",arMoveAroundNotAvailableUseChrome:"",addToCart:"",basketLineCustomTextContent:"",basketLineCustomTextFont:"",noOptionSelected:"",customTexRequired:"",customTextMaxCharactersCount:"",customTextAllowedCharacters:"",arPermissionLackContent:"AR \uacbd\ud5d8\uc744 \uc5bb\uc744 \uc218 \uc788\ub3c4\ub85d \uce74\uba54\ub77c\uc5d0 \ub300\ud55c \uc561\uc138\uc2a4\ub97c \ud5c8\uc6a9\ud558\uc2ed\uc2dc\uc624.<br> \uacbd\ud5d8\uc744 \ub2e4\uc2dc \uc2dc\uc791\ud558\uc2ed\uc2dc\uc624.<br> \uadf8\ub798\ub3c4 \uc791\ub3d9\ud558\uc9c0 \uc54a\uc73c\uba74 \ube0c\ub77c\uc6b0\uc800 \uc124\uc815\uc5d0\uc11c Emersya\uc5d0 \ub300\ud55c \uce74\uba54\ub77c \uc561\uc138\uc2a4 \ucc28\ub2e8\uc744 \ud574\uc81c\ud558\uc2ed\uc2dc\uc624.<br> \ub290\ub9b0 \uc7a5\uce58\uc5d0\uc11c\ub294 \uad8c\ud55c \ud31d\uc5c5\uc774 \ub098\ud0c0\ub098\ub294 \ub370 \ub2e4\uc18c \uc2dc\uac04\uc774 \uac78\ub9b4 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc7a5\uce58\uac00 \ub290\ub9b0 \uacbd\uc6b0 \uc2dc\uc791 \ubc84\ud2bc\uc744 \ub204\ub978 \ud6c4 \uc7a0\uc2dc \uae30\ub2e4\ub9ac\uc2ed\uc2dc\uc624."}},
"ja-jp":{locale_name:"\u65e5\u672c\u8a9e",viewerObject:{disable3D:"\uff13D\u5316\u7121\u52b9",emersyaPowered:"",enable3D:"\uff13D\u5316\u6709\u52b9",help:"\u30d8\u30eb\u30d7",ok:"",or:"\u307e\u305f\u306f",pause:"\u4e00\u6642\u505c\u6b62",play:"\u518d\u751f",playPauseAnimation:"\u30a2\u30cb\u30e1\u30fc\u30b7\u30e7\u30f3\u518d\u751f/\u4e00\u6642\u505c\u6b62",rotate:"\u56de\u8ee2",setFullscreen:"\u5168\u753b\u9762\u8a2d\u5b9a",setLang:"\u8a00\u8a9e\u5909\u66f4",start3D:"3D\u306e\u958b\u59cb/3D\u306e\u505c\u6b62",
translate:"\u79fb\u52d5",view0:"\u6b63\u9762\u56f3",view1:"\u80cc\u9762\u56f3",view2:"\u5de6\u5074\u9762",view3:"\u53f3\u5074\u9762",view6:"\u8996\u70b9",viewpoint:"\u8996\u70b9\u5909\u66f4",views:"\u30d3\u30e5\u30fc\u3092\u5909\u66f4\u3001\u8996\u70b9\u5909\u66f4",zoom:"\u30ba\u30fc\u30e0",zoomOut:"\u30ba\u30fc\u30e0\u30a2\u30a6\u30c8",zoomIn:"\u30ba\u30fc\u30e0\u30a4\u30f3",close:"\u30e1\u30cb\u30e5\u30fc\u9589",open:"\u30e1\u30cb\u30e5\u30fc\u958b",fullscreen:"\u5168\u753b\u9762\u8a2d\u5b9a",toggleAnnotations:"\u30aa\u30f3\u30aa\u30d5",
toggleTriggers:"\u30aa\u30f3\u30aa\u30d5",loading:"3D\u306e\u8aad\u8fbc\u4e2d",view5:"\u4e0b\u9762\u56f3",view4:"\u4e0a\u9762\u56f3",poweredBy:"",fallbackMessage:"\u73fe\u5728\u306e\u8a2d\u5b9a\u3067\u306f\u3001\u5b8c\u5168\u306b\u30a4\u30f3\u30bf\u30e9\u30af\u30c6\u30a3\u30d6\u306a3D\u3092\u5b9f\u884c\u3059\u308b\u3053\u3068\u306f\u3067\u304d\u307e\u305b\u3093\u3002 \u6700\u65b0\u306e\u30d6\u30e9\u30a6\u30b6\u307e\u305f\u306f\u4ed6\u306e\u30c7\u30d0\u30a4\u30b9\u3092\u8a66\u3057\u3066\u304f\u3060\u3055\u3044\u3002",
use:"\u4f7f\u7528\u3059\u308b",toZoomIn:"\u30ba\u30fc\u30e0\u30a4\u30f3\u3059\u308b\u306b\u306f",CTRL:"CTRL\u3092\u62bc\u3057\u306a\u304c\u3089",customizeOrder:"\ucee4\uc2a4\ud130\ub9c8\uc774\uc988 &amp;",controlZoomMessage:"toZoomIn/use/CTRL/icon",activateMotionSensor:"",chooseYourARExperience:"",inAugmentedReality:"",moveAround:"",onlyAvailableOnMobilesAndTablets:"",placeAndInteract:"",scanQrCode:"",withArPhoto:"",tryNextToYou:"",arCannotRun:"",cameraDisabled:"",enableCamera:"",start:"",selectYourSize:"",
arInstructionOne:"",arInstructionOneWorktop:"",arInstructionOneTable:"",arInstructionTwo:"",pleaseStandUp:"",sorry:"",modelIsNotCompatible:"",moveYourDevice:"",arCannotRunOnChromeIos:"",useSafari:"",sharingError:"",arPermissionDeniedContent:"",arCameraErrorTitle:"",arCameraErrorNotReadableContent:"",arCameraErrorUnknownContent:"",activateCamera:"",motionError:"",copylink:"",restart:"",useOtherBrowsers:"",arCannotRunOpera:"",iosPopupErrorTitle:"",iosPopupErrorMessage:"",orientationChangeTitle:"",orientationChangeMessage:"",
modelDisabledTitle:"",modelDisabledMessage:"",forceAr:"",devWarningMessage:"",iosMotionErrorTitle:"",iosMotionErrorMessage:"",force3D:"3D\u5316\u3092\u5f37\u5236",fallbackUpgradeMessage:"\u753b\u50cf\u30d9\u30fc\u30b9\u306e3D\u3092\u5b9f\u884c\u3057\u3066\u3044\u307e\u3059\u3002\u5b8c\u5168\u306b\u30a4\u30f3\u30bf\u30e9\u30af\u30c6\u30a3\u30d6\u306a\u4f53\u9a13\u3092\u5f97\u308b\u305f\u3081\u306b\u306f\u3001\u30b7\u30b9\u30c6\u30e0\u3092\u30a2\u30c3\u30d7\u30b0\u30ec\u30fc\u30c9\u3057\u3066\u4e0b\u3055\u3044\u3002",
seeHow:"\u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb",resetAnimation:"\u30a2\u30cb\u30e1\u30fc\u30b7\u30e7\u30f3\u30fb\u30ea\u30bb\u30c3\u30c8",tryOnYou:"",onlyAvailableOnDevicesWithACamera:"",arMoveAroundNotAvailable:"",badFeaturesLevelMessage:"",arPermissionLackContent:"Please allow us access to a camera to be able to enjoy the augmented reality experience. <br><br> Try restarting the experience. <br>If this does not work, unblock the camera access for Emersya in your browser settings.<br>On slow devices the permission popup may take some time to appear. If your device is slow, try to wait a little after pressing the START button.",
arWearablePrivacyPolicyWarning:"",arWearablePrivacyPolicyMessage:"",arEmersyaPrivacyPolicyWarning:"",arEmersyaPrivacyPolicyMessage:"","continue":"",requestingCameraAccessTitle:"",requestingCameraAccessMessage:"",tryNextToYouButtonTitle:"\u62e1\u5f35\u73fe\u5b9f",orGoTo:"",webGlContextLostButReloadable:"",fileDownloadErrorMessage:"",clickHereToRestart3D:"",webGlHardwareLimitedErrorMessage:"",webGlMemoryLimitErrorMessage:"",webGlErrorMessage:"",clickHereToRestart3DOnce:"",webGlMissingOrDisabledErrorMessage:"",
arInstructionOneCeiling:"",arMoveAroundNotAvailableUseChrome:"",addToCart:"",basketLineCustomTextContent:"",basketLineCustomTextFont:"",noOptionSelected:"",customTexRequired:"",customTextMaxCharactersCount:"",customTextAllowedCharacters:""}},"he-he":{locale_name:"\u05e2\u05b4\u05d1\u05e8\u05b4\u05d9\u05ea",viewerObject:{disable3D:"\u05d4\u05e4\u05e1\u05e7\u05ea \u05ea\u05e6\u05d5\u05d2\u05ea \u05ea\u05dc\u05ea \u05de\u05d9\u05de\u05d3 (3D)",emersyaPowered:"\u05de\u05d5\u05e4\u05e2\u05dc \u05e2\u05dc \u05d9\u05d3\u05d9 Emersya",
enable3D:"\u05d4\u05e4\u05e2\u05dc\u05ea \u05ea\u05e6\u05d5\u05d2\u05ea \u05ea\u05dc\u05ea \u05de\u05d9\u05de\u05d3 (3D)",help:"\u05e2\u05d6\u05e8\u05d4",ok:"\u05d0\u05d9\u05e9\u05d5\u05e8",or:"\u05d0\u05d5",pause:"\u05d4\u05e4\u05e1\u05e7\u05d4",play:"\u05d4\u05e4\u05e2\u05dc\u05d4",playPauseAnimation:"\u05d4\u05ea\u05d7\u05dc\u05ea/ \u05e2\u05e6\u05d9\u05e8\u05ea \u05d0\u05e0\u05d9\u05de\u05e6\u05d9\u05d4",rotate:"\u05e1\u05d9\u05d1\u05d5\u05d1",setFullscreen:"\u05dc\u05e6\u05e4\u05d9\u05d9\u05d4 \u05d1\u05de\u05e1\u05da \u05de\u05dc\u05d0",
setLang:"\u05e9\u05d9\u05e0\u05d5\u05d9 \u05e9\u05e4\u05d4",start3D:"\u05d4\u05e4\u05e2\u05dc\u05ea / \u05e2\u05e6\u05d9\u05e8\u05ea \u05ea\u05dc\u05ea \u05de\u05d9\u05de\u05d3 (3D)",translate:"\u05d4\u05d6\u05d6\u05d4",view0:"\u05de\u05d1\u05d8 \u05e7\u05d3\u05de\u05d9",view1:"\u05de\u05d1\u05d8 \u05d0\u05d7\u05d5\u05e8\u05d9",view2:"\u05de\u05d1\u05d8 \u05de\u05e9\u05de\u05d0\u05dc",view3:"\u05de\u05d1\u05d8 \u05de\u05d9\u05de\u05d9\u05df",view6:"\u05d6\u05d5\u05d5\u05d9\u05ea",viewpoint:"\u05e9\u05d9\u05e0\u05d5\u05d9 \u05e0\u05e7\u05d5\u05d3\u05ea \u05de\u05d1\u05d8/ \u05e9\u05d9\u05e0\u05d5\u05d9 \u05d6\u05d5\u05d9\u05ea \u05ea\u05e6\u05d5\u05d2\u05d4?",
views:"\u05e9\u05d9\u05e0\u05d5\u05d9 \u05d6\u05d5\u05d9\u05ea? \u05ea\u05e6\u05d5\u05d2\u05d4? \u05de\u05d1\u05d8",zoom:"Zoom",zoomOut:"Zoom out/ \u05d4\u05ea\u05e8\u05d7\u05e7\u05d5\u05ea",zoomIn:"Zoom in/\u05d4\u05ea\u05e7\u05e8\u05d1\u05d5\u05ea",close:"\u05e1\u05d2\u05d9\u05e8\u05ea \u05ea\u05e4\u05e8\u05d9\u05d8",open:"\u05e4\u05ea\u05d9\u05d7\u05ea \u05ea\u05e4\u05e8\u05d9\u05d8",fullscreen:"\u05de\u05e1\u05da \u05de\u05dc\u05d0",toggleAnnotations:"\u05e4\u05ea\u05d9\u05d7\u05d4/ \u05e1\u05d2\u05d9\u05e8\u05d4",
toggleTriggers:"\u05e4\u05ea\u05d9\u05d7\u05d4/ \u05e1\u05d2\u05d9\u05e8\u05d4",loading:"\u05d8\u05e2\u05d9\u05e0\u05ea \u05ea\u05e6\u05d5\u05d2\u05ea \u05ea\u05dc\u05ea \u05de\u05d9\u05de\u05d3 (3D)",view5:"\u05e6\u05e4\u05d9\u05d9\u05d4 \u05de\u05dc\u05de\u05d8\u05d4",view4:"\u05de\u05d1\u05d8 \u05de\u05dc\u05de\u05e2\u05dc\u05d4",poweredBy:"\u05de\u05d5\u05e4\u05e2\u05dc \u05e2\u05dc \u05d9\u05d3\u05d9",fallbackMessage:"\u05d4\u05d2\u05d3\u05e8\u05d5\u05ea \u05d4\u05de\u05db\u05e9\u05d9\u05e8 \u05d0\u05d5 \u05d4\u05d3\u05e4\u05d3\u05e4\u05df \u05e9\u05dc\u05da \u05d0\u05d9\u05e0\u05df \u05de\u05d0\u05e4\u05e9\u05e8\u05d5\u05ea \u05dc\u05d4\u05e4\u05e2\u05d9\u05dc \u05d7\u05d5\u05d5\u05d9\u05d9\u05ea \u05ea\u05dc\u05ea\u05be\u05de\u05de\u05d3 \u05d0\u05d9\u05e0\u05d8\u05e8\u05d0\u05e7\u05d8\u05d9\u05d1\u05d9\u05ea \u05de\u05dc\u05d0\u05d4. \u05de\u05d5\u05de\u05dc\u05e5 \u05dc\u05e8\u05e2\u05e0\u05df \u05d0\u05ea \u05d4\u05d3\u05e4\u05d3\u05e4\u05df \u05d0\u05d5 \u05dc\u05e0\u05e1\u05d5\u05ea \u05de\u05de\u05db\u05e9\u05d9\u05e8 \u05d0\u05d7\u05e8.",
use:"\u05e9\u05d9\u05de\u05d5\u05e9",toZoomIn:"\u05d4\u05d2\u05d3\u05dc\u05ea \u05ea\u05e6\u05d5\u05d2\u05d4",CTRL:"CTRL + ",customizeOrder:"\u05d4\u05ea\u05d0\u05de\u05d4 \u05d0\u05d9\u05e9\u05d9\u05ea &amp;  \u05d4\u05d6\u05de\u05e0\u05d4",controlZoomMessage:"\u05d9\u05e9 \u05dc\u05d4\u05e9\u05ea\u05de\u05e9 / \u05d1\u05beCTRL / \u05d0\u05d9\u05d9\u05e7\u05d5\u05df / \u05dc\u05d4\u05d2\u05d3\u05dc\u05d4 \u05d5\u05d4\u05ea\u05e7\u05e8\u05d1\u05d5\u05ea ",activateMotionSensor:"\u05d7\u05d9\u05d9\u05e9\u05e0\u05d9 \u05ea\u05e0\u05d5\u05e2\u05d4 \u05de\u05d5\u05e9\u05d1\u05ea\u05d9\u05dd",
chooseYourARExperience:" \u05d1\u05d7\u05d9\u05e8\u05ea \u05d7\u05d5\u05d5\u05d9\u05d9\u05ea \u05d4\u05de\u05e6\u05d9\u05d0\u05d5\u05ea \u05d4\u05e8\u05d1\u05d5\u05d3\u05d4",inAugmentedReality:"\u05d1\u05de\u05e6\u05d9\u05d0\u05d5\u05ea \u05e8\u05d1\u05d5\u05d3\u05d4",moveAround:"\u05ea\u05e0\u05d5\u05e2\u05d4 \u05d1\u05de\u05e8\u05d7\u05d1",onlyAvailableOnMobilesAndTablets:"\u05d6\u05de\u05d9\u05df \u05e8\u05e7 \u05d1\u05d8\u05dc\u05e4\u05d5\u05e0\u05d9\u05dd \u05e0\u05d9\u05d9\u05d3\u05d9\u05dd \u05d5\u05d8\u05d0\u05d1\u05dc\u05d8\u05d9\u05dd",
placeAndInteract:"\u05de\u05d9\u05e7\u05d5\u05dd \u05d5\u05d0\u05d9\u05e0\u05d8\u05e8\u05d0\u05e7\u05e6\u05d9\u05d4",scanQrCode:"\u05d9\u05e9 \u05dc\u05e1\u05e8\u05d5\u05e7 \u05d0\u05ea \u05e7\u05d5\u05d3 \u05d4 QR",withArPhoto:"\u05e2\u05dd \u05ea\u05de\u05d5\u05e0\u05ea \u05de\u05e6\u05d9\u05d0\u05d5\u05ea \u05e8\u05d1\u05d5\u05d3\u05d4",tryNextToYou:"\u05e0\u05e1\u05d4 \u05dc\u05d9\u05d3\u05da",arCannotRun:"\u05d7\u05d5\u05d5\u05d9\u05d9\u05ea \u05d4\u05de\u05e6\u05d9\u05d0\u05d5\u05ea \u05d4\u05e8\u05d1\u05d5\u05d3\u05d4 \u05d0\u05d9\u05e0\u05d4 \u05d9\u05db\u05d5\u05dc\u05d4 \u05dc\u05e4\u05e2\u05d5\u05dc",
cameraDisabled:" \u05d4\u05d2\u05d9\u05e9\u05d4 \u05dc\u05de\u05e6\u05dc\u05de\u05d4 \u05de\u05d5\u05e9\u05d1\u05ea\u05ea ",enableCamera:"\u05d9\u05e9 \u05dc\u05d0\u05e4\u05e9\u05e8 \u05d2\u05d9\u05e9\u05d4 \u05dc\u05de\u05e6\u05dc\u05de\u05d4 \u05d1\u05d4\u05d2\u05d3\u05e8\u05d5\u05ea \u05d4\u05d3\u05e4\u05d3\u05e4\u05df \u05d5\u05dc\u05d0\u05d7\u05e8 \u05de\u05db\u05df \u05dc\u05d4\u05e4\u05e2\u05d9\u05dc \u05d0\u05ea \u05d4\u05d7\u05d5\u05d5\u05d9\u05d4 \u05de\u05d7\u05d3\u05e9.",start:"\u05d4\u05ea\u05d7\u05dc\u05d4",
selectYourSize:"\u05d9\u05e9 \u05dc\u05d1\u05d7\u05d5\u05e8 \u05de\u05d9\u05d3\u05d4",arInstructionOne:"<b>\u05de\u05d9\u05e7\u05d5\u05dd \u05d5\u05d4\u05e6\u05d1\u05ea \u05d4\u05de\u05d5\u05e6\u05e8</b> \u05e2\u05dc \u05d4\u05e7\u05e8\u05e7\u05e2<br><b>\u05e6\u05d9\u05dc\u05d5\u05dd \u05d4\u05de\u05e8\u05d7\u05d1 </b> \u05d1\u05ea\u05dc\u05ea \u05de\u05d9\u05de\u05d3 ",arInstructionOneWorktop:"<b>\u05de\u05d9\u05e7\u05d5\u05dd \u05d5\u05d4\u05e6\u05d1\u05ea \u05d4\u05de\u05d5\u05e6\u05e8</b> \u05e2\u05dc \u05de\u05e9\u05d8\u05d7 \u05d4\u05e2\u05d1\u05d5\u05d3\u05d4<br><b>\u05e6\u05d9\u05dc\u05d5\u05dd \u05d4\u05de\u05e8\u05d7\u05d1 </b> \u05d1\u05ea\u05dc\u05ea \u05de\u05d9\u05de\u05d3 ",
arInstructionOneTable:"<b>\u05de\u05d9\u05e7\u05d5\u05dd \u05d5\u05d4\u05e6\u05d1\u05ea \u05d4\u05de\u05d5\u05e6\u05e8</b> \u05e2\u05dc \u05d4\u05e9\u05d5\u05dc\u05d7\u05df<br><b>\u05e6\u05d9\u05dc\u05d5\u05dd \u05d4\u05de\u05e8\u05d7\u05d1 </b> \u05d1\u05ea\u05dc\u05ea \u05de\u05d9\u05de\u05d3 ",arInstructionTwo:"<b>\u05d4\u05ea\u05d0\u05de\u05d4</b> \u05e9\u05dc \u05d4\u05de\u05d9\u05e7\u05d5\u05dd \u05d5\u05e9\u05dc \u05d0\u05e4\u05e9\u05e8\u05d5\u05d9\u05d5\u05ea \u05d4\u05de\u05d5\u05e6\u05e8",
pleaseStandUp:"\u05d9\u05e9 \u05dc\u05e2\u05de\u05d5\u05d3",sorry:"\u05e1\u05dc\u05d9\u05d7\u05d4",modelIsNotCompatible:"\u05d4\u05d3\u05d2\u05dd \u05d0\u05d9\u05e0\u05d5 \u05ea\u05d5\u05d0\u05dd",moveYourDevice:"\u05d9\u05e9 \u05dc\u05d4\u05d6\u05d9\u05d6 \u05d0\u05ea \u05d4\u05de\u05db\u05e9\u05d9\u05e8 \u05e9\u05dc\u05da \u05dc\u05de\u05e2\u05dc\u05d4 \u05d5\u05dc\u05de\u05d8\u05d4 \u05db\u05d3\u05d9 \u05dc\u05d6\u05d4\u05d5\u05ea \u05d0\u05ea \u05db\u05d9\u05d5\u05d5\u05e0\u05d5",arCannotRunOnChromeIos:"\u05d0\u05e0\u05d0 \u05d4\u05e9\u05ea\u05de\u05e9 \u05d1\u05d3\u05e4\u05d3\u05e4\u05df Safari",
useSafari:"\u05e9\u05d9\u05d3\u05d5\u05e8 \u05d4\u05d5\u05d5\u05d9\u05d3\u05d0\u05d5 \u05d0\u05d9\u05e0\u05d5 \u05d6\u05de\u05d9\u05df \u05d1\u05d3\u05e4\u05d3\u05e4\u05df \u05e9\u05dc\u05da \u2013 \u05d0\u05e0\u05d0 \u05d4\u05e9\u05ea\u05de\u05e9/\u05d9 \u05d1\u05beSafari \u05d1\u05de\u05e7\u05d5\u05dd",sharingError:"\u05d0\u05d9\u05e8\u05e2\u05d4 \u05e9\u05d2\u05d9\u05d0\u05d4 \u05d9\u05e9 \u05dc\u05e0\u05e1\u05d5\u05ea \u05dc\u05e9\u05ea\u05e3 \u05e9\u05d5\u05d1",arPermissionDeniedContent:"\u05db\u05d3\u05d9 \u05dc\u05d9\u05d4\u05e0\u05d5\u05ea \u05de\u05d7\u05d5\u05d5\u05d9\u05d9\u05ea \u05d4\u05de\u05e6\u05d9\u05d0\u05d5\u05ea \u05d4\u05e8\u05d1\u05d5\u05d3\u05d4 \u05e0\u05d0 \u05dc\u05d0\u05e4\u05e9\u05e8 \u05d2\u05d9\u05e9\u05d4 \u05dc\u05de\u05e6\u05dc\u05de\u05d4. <br><br> \u05e0\u05d9\u05ea\u05df \u05dc\u05e0\u05e1\u05d5\u05ea \u05dc\u05d4\u05e4\u05e2\u05d9\u05dc \u05d0\u05ea \u05d4\u05d7\u05d5\u05d5\u05d9\u05d4 \u05de\u05d7\u05d3\u05e9. <br> \u05d0\u05dd \u05e2\u05d3\u05d9\u05d9\u05df \u05dc\u05d0 \u05e0\u05d9\u05ea\u05df \u05dc\u05d4\u05e4\u05e2\u05d9\u05dc, \u05d9\u05e9 \u05dc\u05d0\u05e4\u05e9\u05e8 \u05d2\u05d9\u05e9\u05d4 \u05dc\u05de\u05e6\u05dc\u05de\u05d4 \u05e2\u05d1\u05d5\u05e8 Emersya \u05d1\u05d4\u05d2\u05d3\u05e8\u05d5\u05ea \u05d4\u05d3\u05e4\u05d3\u05e4\u05df. ",
arCameraErrorTitle:"\u05d9\u05e9 \u05dc\u05d5\u05d5\u05d3\u05d0 \u05e9\u05d4\u05de\u05e6\u05dc\u05de\u05d4 \u05d0\u05d9\u05e0\u05d4 \u05d1\u05e9\u05d9\u05de\u05d5\u05e9 \u05e2\u05dc \u05d9\u05d3\u05d9 \u05d0\u05e4\u05dc\u05d9\u05e7\u05e6\u05d9\u05d4 \u05d0\u05d7\u05e8\u05ea",arCameraErrorNotReadableContent:"\u05d4\u05de\u05e6\u05dc\u05de\u05d4 \u05e9\u05dc\u05da \u05d0\u05d9\u05e0\u05d4 \u05d6\u05de\u05d9\u05e0\u05d4.<br> \u05d9\u05e9 \u05dc\u05d1\u05d3\u05d5\u05e7 \u05d0\u05dd \u05d9\u05d9\u05e9\u05d5\u05dd \u05d0\u05d5 \u05d3\u05e3 \u05d0\u05d7\u05e8 \u05de\u05e9\u05ea\u05de\u05e9\u05d9\u05dd \u05d1\u05d4 \u05d5\u05dc\u05e0\u05e1\u05d5\u05ea \u05dc\u05e1\u05d2\u05d5\u05e8 \u05d0\u05d5\u05ea\u05d5 \u05d5\u05dc\u05d4\u05e4\u05e2\u05d9\u05dc \u05de\u05d7\u05d3\u05e9.<br> \u05de\u05d7\u05d9\u05e7\u05ea \u05de\u05d8\u05de\u05d5\u05df (cache) \u05d4\u05d3\u05e4\u05d3\u05e4\u05df \u05e9\u05dc\u05da \u05e2\u05e9\u05d5\u05d9\u05d4 \u05dc\u05e2\u05d6\u05d5\u05e8.",
arCameraErrorUnknownContent:"\u05d0\u05e0\u05d9 \u05de\u05ea\u05e0\u05e6\u05dc\u05d9\u05dd, \u05e7\u05e8\u05ea\u05d4 \u05ea\u05e7\u05dc\u05d4 \u05dc\u05d0 \u05d9\u05d3\u05d5\u05e2\u05d4 \u05d1\u05d4\u05e4\u05e2\u05dc\u05ea \u05d4\u05e1\u05e8\u05d8\u05d5\u05df",activateCamera:"\u05d9\u05e9 \u05dc\u05d4\u05e4\u05e2\u05d9\u05dc \u05d0\u05ea \u05d4\u05de\u05e6\u05dc\u05de\u05d4",motionError:"\u05d9\u05e9 \u05dc\u05d4\u05e4\u05e2\u05d9\u05dc \u05d0\u05ea \u05d7\u05d9\u05d9\u05e9\u05df \u05d4\u05ea\u05e0\u05d5\u05e2\u05d4",
copylink:"\u05d4\u05e2\u05ea\u05e7\u05ea \u05e7\u05d9\u05e9\u05d5\u05e8",restart:"\u05d4\u05e4\u05e2\u05dc\u05d4 \u05de\u05d7\u05d3\u05e9",useOtherBrowsers:"\u05de\u05d5\u05de\u05dc\u05e5 \u05dc\u05d4\u05e9\u05ea\u05de\u05e9 \u05d1\u05d3\u05e4\u05d3\u05e4\u05df Chrome, Firefox \u05d0\u05d5 Edge",arCannotRunOpera:"\u05d4\u05e4\u05e2\u05dc\u05ea \u05d4\u05e1\u05e8\u05d8\u05d5\u05df \u05d0\u05d9\u05e0\u05d4 \u05d6\u05de\u05d9\u05e0\u05d4 \u05d1 Opera \u05d9\u05e9 \u05dc\u05d4\u05e9\u05ea\u05de\u05e9 \u05d1\u05d3\u05e4\u05d3\u05e4\u05df \u05d0\u05d7\u05e8.",
iosPopupErrorTitle:"Safari \u05d7\u05d5\u05e1\u05dd \u05d7\u05dc\u05d5\u05df \u05e7\u05d5\u05e4\u05e5",iosPopupErrorMessage:"\u05d9\u05e9 \u05dc\u05d1\u05d8\u05dc \u05d0\u05ea \u05d4\u05d0\u05e4\u05e9\u05e8\u05d5\u05ea \u05dc\u05d7\u05e1\u05d9\u05de\u05ea \u05d7\u05dc\u05d5\u05e0\u05d5\u05ea \u05e7\u05d5\u05e4\u05e6\u05d9\u05dd \u05d1\u05d4\u05d2\u05d3\u05e8\u05d5\u05ea \u05d4\u05db\u05dc\u05dc\u05d9\u05d5\u05ea \u05e9\u05dc Safari",orientationChangeTitle:"\u05e9\u05d9\u05e0\u05d5\u05d9 \u05db\u05d9\u05d5\u05d5\u05df",
orientationChangeMessage:"\u05d9\u05e9 \u05dc\u05e9\u05e0\u05d5\u05ea \u05d0\u05ea \u05d4\u05db\u05d9\u05d5\u05d5\u05df \u05dc\u05de\u05e6\u05d1 \u05d4\u05d4\u05ea\u05d7\u05dc\u05ea\u05d9 \u05d0\u05d5 \u05dc\u05d4\u05e4\u05e2\u05d9\u05dc \u05de\u05d7\u05d3\u05e9 \u05d0\u05ea \u05d4\u05d7\u05d5\u05d5\u05d9\u05d4.",modelDisabledTitle:"\u05d9\u05d9\u05ea\u05db\u05e0\u05d5 \u05d1\u05e2\u05d9\u05d5\u05ea \u05d1\u05d9\u05e6\u05d5\u05e2\u05d9\u05dd \u05d1\u05e9\u05d9\u05de\u05d5\u05e9 \u05d1\u05d7\u05d5\u05d5\u05d9\u05ea \u05d4\u05de\u05e6\u05d9\u05d0\u05d5\u05ea \u05d4\u05e8\u05d1\u05d5\u05d3\u05d4 \u05d1\u05de\u05db\u05e9\u05d9\u05e8 \u05e9\u05dc\u05da",
modelDisabledMessage:"\u05d4\u05de\u05db\u05e9\u05d9\u05e8 \u05e9\u05dc\u05da \u05d0\u05d9\u05e0\u05d5 \u05ea\u05d5\u05de\u05da \u05d1\u05d4\u05e4\u05e2\u05dc\u05d4 \u05d7\u05dc\u05e7\u05d4 \u05e9\u05dc \u05d7\u05d5\u05d5\u05d9\u05d9\u05ea \u05d4\u05de\u05e6\u05d9\u05d0\u05d5\u05ea \u05d4\u05e8\u05d1\u05d5\u05d3\u05d4.",forceAr:"\u05d0\u05dc\u05e5 \u05ea\u05e6\u05d5\u05d2\u05ea \u05de\u05e6\u05d9\u05d0\u05d5\u05ea \u05e8\u05d1\u05d5\u05d3\u05d4",devWarningMessage:"\u05ea\u05e6\u05d5\u05d2\u05ea \u05ea\u05dc\u05ea\u05be\u05d4\u05de\u05de\u05d3 \u05d4\u05e0\u05d5\u05db\u05d7\u05d9\u05ea \u05de\u05d9\u05d5\u05e2\u05d3\u05ea \u05dc\u05e6\u05e8\u05db\u05d9 \u05e4\u05d9\u05ea\u05d5\u05d7 \u05d1\u05dc\u05d1\u05d3. <br>\u05d9\u05e9 \u05dc\u05d4\u05e9\u05ea\u05de\u05e9 \u05d1\u05e7\u05d9\u05e9\u05d5\u05e8 \u05d4\u05e8\u05d2\u05d9\u05dc \u05db\u05d3\u05d9 \u05dc\u05d4\u05e1\u05d9\u05e8 \u05d0\u05ea \u05e1\u05d9\u05de\u05df \u05d4\u05de\u05d9\u05dd.",
iosMotionErrorTitle:"\u05d7\u05d9\u05d9\u05e9\u05df \u05d4\u05ea\u05e0\u05d5\u05e2\u05d4 \u05de\u05d5\u05e9\u05d1\u05ea",iosMotionErrorMessage:"\u05d9\u05e9 \u05dc\u05d4\u05d9\u05db\u05e0\u05e1 \u05dc\u05d4\u05d2\u05d3\u05e8\u05d5\u05ea > Safari > \u05dc\u05e0\u05e7\u05d5\u05ea \u05d4\u05d9\u05e1\u05d8\u05d5\u05e8\u05d9\u05d4 \u05d5\u05e0\u05ea\u05d5\u05e0\u05d9 \u05d0\u05ea\u05e8\u05d9\u05dd. \u05dc\u05d0\u05d7\u05e8 \u05de\u05db\u05df \u05d9\u05e9 \u05dc\u05d4\u05e4\u05e2\u05d9\u05dc \u05d0\u05ea \u05d4\u05d7\u05d5\u05d5\u05d9\u05d4 \u05de\u05d7\u05d3\u05e9.",
force3D:"\u05d0\u05dc\u05e5 \u05ea\u05e6\u05d5\u05d2\u05d4 \u05d1\u05ea\u05dc\u05ea \u05de\u05d9\u05de\u05d3 (3D)",fallbackUpgradeMessage:"\u05d4\u05ea\u05de\u05d5\u05e0\u05d4 \u05de\u05d1\u05d5\u05e1\u05e1\u05ea \u05ea\u05dc\u05ea \u05de\u05d9\u05de\u05d3, \u05d9\u05e9 \u05dc\u05e9\u05d3\u05e8\u05d2 \u05d0\u05ea \u05d4\u05de\u05e2\u05e8\u05db\u05ea \u05db\u05d3\u05d9 \u05dc\u05e7\u05d1\u05dc \u05ea\u05e6\u05d5\u05d2\u05d4 \u05d0\u05d9\u05e0\u05d8\u05e8\u05e7\u05d8\u05d9\u05d1\u05d9\u05ea",seeHow:"\u05dc\u05e6\u05e4\u05d9\u05d9\u05d4",
resetAnimation:"\u05d0\u05d9\u05e4\u05d5\u05e1 \u05d0\u05e0\u05d9\u05de\u05e6\u05d9\u05d4",tryOnYou:"\u05de\u05d3\u05d9\u05d3\u05d4 \u05d5\u05d9\u05e8\u05d8\u05d5\u05d0\u05dc\u05d9\u05ea",onlyAvailableOnDevicesWithACamera:"\u05d6\u05de\u05d9\u05df \u05e8\u05e7 \u05d1\u05de\u05db\u05e9\u05d9\u05e8\u05d9\u05dd \u05e2\u05dd \u05de\u05e6\u05dc\u05de\u05d4",arMoveAroundNotAvailable:"\u05d4\u05e9\u05d9\u05de\u05d5\u05e9 \u05d1\u05de\u05e6\u05d9\u05d0\u05d5\u05ea \u05e8\u05d1\u05d5\u05d3\u05d4 \u05d1\u05d6\u05de\u05df \u05ea\u05e0\u05d5\u05e2\u05d4 \u05d0\u05d9\u05e0\u05d5 \u05d6\u05de\u05d9\u05df",
badFeaturesLevelMessage:"\u05ea\u05e6\u05d5\u05d2\u05ea \u05ea\u05dc\u05ea \u05d4\u05de\u05d9\u05de\u05d3\u05d4\u05e0\u05d5\u05db\u05d7\u05d9\u05ea \u05dc\u05d0 \u05ea\u05d5\u05de\u05db\u05ea \u05d1\u05db\u05dc \u05d4\u05e4\u05d5\u05e0\u05e7\u05e6\u05d9\u05d5\u05ea \u05d4\u05d3\u05e8\u05d5\u05e9\u05d5\u05ea. \u05d9\u05d9\u05ea\u05db\u05df \u05e9\u05d7\u05dc\u05e7 \u05de\u05d4\u05d7\u05d5\u05d5\u05d9\u05d4 \u05d9\u05d4\u05d9\u05d4 \u05de\u05d5\u05d2\u05d1\u05dc. ",arPermissionLackContent:"\u05e0\u05d0 \u05dc\u05d0\u05e9\u05e8 \u05d2\u05d9\u05e9\u05d4 \u05dc\u05de\u05e6\u05dc\u05de\u05d4 \u05db\u05d3\u05d9 \u05dc\u05d9\u05d4\u05e0\u05d5\u05ea \u05de\u05d7\u05d5\u05d5\u05d9\u05d9\u05ea \u05d4\u05de\u05e6\u05d9\u05d0\u05d5\u05ea \u05d4\u05e8\u05d1\u05d5\u05d3\u05d4. <br><br> \u05d9\u05e9 \u05dc\u05e0\u05e1\u05d5\u05ea \u05dc\u05d4\u05e4\u05e2\u05d9\u05dc \u05d0\u05ea \u05d4\u05d7\u05d5\u05d5\u05d9\u05d4 \u05de\u05d7\u05d3\u05e9. <br>\u05d0\u05dd \u05e2\u05d3\u05d9\u05d9\u05df \u05dc\u05d0 \u05e0\u05d9\u05ea\u05df \u05dc\u05d4\u05e4\u05e2\u05d9\u05dc, \u05d9\u05e9 \u05dc\u05d5\u05d5\u05d3\u05d0 \u05e9\u05d4\u05d2\u05d9\u05e9\u05d4 \u05dc\u05de\u05e6\u05dc\u05de\u05d4 \u05e2\u05d1\u05d5\u05e8 Emersya \u05d0\u05d9\u05e0\u05d4 \u05d7\u05e1\u05d5\u05de\u05d4 \u05d1\u05d4\u05d2\u05d3\u05e8\u05d5\u05ea \u05d4\u05d3\u05e4\u05d3\u05e4\u05df. <br>\u05d1\u05de\u05db\u05e9\u05d9\u05e8\u05d9\u05dd \u05d0\u05d9\u05d8\u05d9\u05d9\u05dd, \u05d7\u05dc\u05d5\u05e0\u05d9\u05ea \u05d4\u05d4\u05e8\u05e9\u05d0\u05d4 \u05e2\u05e9\u05d5\u05d9\u05d4 \u05dc\u05d4\u05d5\u05e4\u05d9\u05e2 \u05dc\u05d0\u05d7\u05e8 \u05d6\u05de\u05df \u05de\u05d4 \u05dc\u05db\u05df \u05de\u05d5\u05de\u05dc\u05e5 \u05dc\u05d4\u05de\u05ea\u05d9\u05df \u05de\u05e2\u05d8 \u05dc\u05d0\u05d7\u05e8 \u05dc\u05d7\u05d9\u05e6\u05d4 \u05e2\u05dc \u05db\u05e4\u05ea\u05d5\u05e8 \u05d4\u05d4\u05ea\u05d7\u05dc\u05d4. ",
arWearablePrivacyPolicyWarning:"\u05de\u05d3\u05d9\u05e0\u05d9\u05d5\u05ea \u05e4\u05e8\u05d8\u05d9\u05d5\u05ea",arWearablePrivacyPolicyMessage:"\u05d7\u05d5\u05d5\u05d9\u05d9\u05ea \u05d4\u05de\u05d3\u05d9\u05d3\u05d4 (Try-On) \u05e9\u05e2\u05d5\u05de\u05d3\u05d9\u05dd \u05dc\u05d4\u05e4\u05e2\u05d9\u05dc \u05db\u05d5\u05dc\u05dc\u05ea \u05d6\u05d9\u05d4\u05d5\u05d9 \u05d5\u05e2\u05d9\u05d1\u05d5\u05d3 \u05e9\u05dc \u05d4\u05d5\u05d5\u05d9\u05d3\u05d0\u05d5 \u05de\u05d4\u05de\u05db\u05e9\u05d9\u05e8 \u05d1\u05d6\u05de\u05df \u05d0\u05de\u05ea. \u05d4\u05de\u05d9\u05d3\u05e2 \u05d0\u05d9\u05e0\u05d5 \u05de\u05d5\u05e2\u05d1\u05e8 \u05d0\u05d5 \u05e0\u05e9\u05de\u05e8. ",
arEmersyaPrivacyPolicyWarning:"\u05de\u05d3\u05d9\u05e0\u05d9\u05d5\u05ea \u05e4\u05e8\u05d8\u05d9\u05d5\u05ea",arEmersyaPrivacyPolicyMessage:"\u05d1\u05de\u05d4\u05dc\u05da \u05d7\u05d5\u05d5\u05d9\u05d9\u05ea \u05d4\u05de\u05e6\u05d9\u05d0\u05d5\u05ea \u05d4\u05e8\u05d1\u05d5\u05d3\u05d4 \u05d9\u05ea\u05d1\u05e6\u05e2 \u05e0\u05d9\u05ea\u05d5\u05d7 \u05d1\u05d6\u05de\u05df \u05d0\u05de\u05ea \u05e9\u05dc \u05ea\u05de\u05d5\u05e0\u05d5\u05ea \u05de\u05d4\u05e1\u05d1\u05d9\u05d1\u05d4, \u05d5\u05dc\u05e2\u05d9\u05ea\u05d9\u05dd \u05d2\u05dd \u05e9\u05dc \u05d0\u05e0\u05e9\u05d9\u05dd. \u05d4\u05db\u05d5\u05dc \u05de\u05ea\u05d1\u05e6\u05e2 \u05e2\u05dc \u05d2\u05d1\u05d9 \u05d4\u05de\u05db\u05e9\u05d9\u05e8 \u05d1\u05dc\u05d1\u05d3 \u05d5\u05d4\u05ea\u05de\u05d5\u05e0\u05d5\u05ea \u05dc\u05d0 \u05de\u05d5\u05e2\u05d1\u05e8\u05d5\u05ea \u05d5\u05dc\u05d0 \u05e0\u05e9\u05de\u05e8\u05d5\u05ea. ",
"continue":"\u05d4\u05de\u05e9\u05da",requestingCameraAccessTitle:"\u05d4\u05de\u05e2\u05e8\u05db\u05ea \u05d1\u05d9\u05e7\u05e9\u05d4 \u05d2\u05d9\u05e9\u05d4 \u05dc\u05de\u05e6\u05dc\u05de\u05d4",requestingCameraAccessMessage:"\u05db\u05d3\u05d9 \u05dc\u05d4\u05ea\u05d7\u05d9\u05dc \u05d0\u05ea \u05d4\u05d7\u05d5\u05d5\u05d9\u05d4 \u05d9\u05e9 \u05dc\u05d0\u05e9\u05e8 \u05d2\u05d9\u05e9\u05d4 \u05dc\u05de\u05e6\u05dc\u05de\u05d4 ",tryNextToYouButtonTitle:"\u05dc\u05d7\u05d5\u05d5\u05d9\u05ea \u05de\u05e6\u05d9\u05d0\u05d5\u05ea \u05e8\u05d1\u05d5\u05d3\u05d4",
orGoTo:"\u05d0\u05d5 \u05e2\u05d1\u05d5\u05e8 \u05d0\u05dc:",webGlContextLostButReloadable:"\u05e9\u05d2\u05d9\u05d0\u05d4 \u2013 \u05d7\u05d9\u05d1\u05d5\u05e8 WebGL \u05d0\u05d1\u05d3",fileDownloadErrorMessage:"\u05e9\u05d2\u05d9\u05d0\u05d4 \u2013 \u05d4\u05d5\u05e8\u05d3\u05ea \u05d4\u05e7\u05d5\u05d1\u05e5 \u05e0\u05db\u05e9\u05dc\u05d4. \u05e0\u05d0 \u05dc\u05d1\u05d3\u05d5\u05e7 \u05d0\u05ea \u05d7\u05d9\u05d1\u05d5\u05e8 \u05d4\u05d0\u05d9\u05e0\u05d8\u05e8\u05e0\u05d8 ",clickHereToRestart3D:"\u05d9\u05e9 \u05dc\u05dc\u05d7\u05d5\u05e5 \u05db\u05d0\u05df \u05db\u05d3\u05d9 \u05dc\u05d8\u05e2\u05d5\u05df \u05d7\u05d5\u05d5\u05d9\u05d9\u05ea \u05ea\u05dc\u05ea \u05de\u05d9\u05de\u05d3 \u05d0\u05d9\u05e0\u05d8\u05e8\u05d0\u05e7\u05d8\u05d9\u05d1\u05d9\u05ea \u05d5\u05de\u05dc\u05d0\u05d4.",
webGlHardwareLimitedErrorMessage:"\u05e9\u05d2\u05d9\u05d0\u05d4 \u2013 \u05de\u05db\u05e9\u05d9\u05e8\u05da \u05d0\u05d9\u05e0\u05d5 \u05ea\u05d5\u05de\u05da \u05d1\u05d7\u05d5\u05d5\u05d9\u05d9\u05ea \u05ea\u05dc\u05ea \u05de\u05d9\u05de\u05d3 \u05d0\u05d9\u05e0\u05d8\u05e8\u05d0\u05e7\u05d8\u05d9\u05d1\u05d9\u05ea \u05d5\u05de\u05dc\u05d0\u05d4  ",webGlMemoryLimitErrorMessage:"\u05e9\u05d2\u05d9\u05d0\u05d4 - \u05d6\u05d9\u05db\u05e8\u05d5\u05df \u05dc\u05d0 \u05de\u05e1\u05e4\u05d9\u05e7.",webGlErrorMessage:"\u05d0\u05d9\u05e8\u05e2\u05d4 \u05e9\u05d2\u05d9\u05d0\u05d4.",
clickHereToRestart3DOnce:"\u05d9\u05e9 \u05dc\u05dc\u05d7\u05d5\u05e5 \u05db\u05d0\u05df \u05db\u05d3\u05d9 \u05dc\u05d8\u05e2\u05d5\u05df \u05d0\u05ea \u05d7\u05d5\u05d5\u05d9\u05d9\u05ea \u05ea\u05dc\u05ea \u05d4\u05de\u05d9\u05de\u05d3 ",webGlMissingOrDisabledErrorMessage:"\u05e9\u05d2\u05d9\u05d0\u05d4 \u2013 \u05d7\u05d5\u05d5\u05d9\u05d9\u05ea \u05ea\u05dc\u05ea \u05d4\u05de\u05d9\u05de\u05d3 \u05d0\u05d9\u05e0\u05d4 \u05e0\u05ea\u05de\u05db\u05ea \u05d1\u05de\u05db\u05e9\u05d9\u05e8 \u05d6\u05d4. \u05e0\u05d0 \u05dc\u05e2\u05d3\u05db\u05df \u05d0\u05d5 \u05dc\u05e9\u05e0\u05d5\u05ea \u05d0\u05ea \u05d4\u05d3\u05e4\u05d3\u05e4\u05df",
arInstructionOneCeiling:"<b>\u05d9\u05e9 \u05dc\u05de\u05e7\u05dd</b> \u05d0\u05ea \u05d4\u05de\u05d5\u05e6\u05e8 \u05e2\u05dc \u05d4\u05ea\u05e7\u05e8\u05d4<br><b>\u05d5\u05dc\u05e6\u05dc\u05dd \u05ea\u05de\u05d5\u05e0\u05ea AR</b> \u05e9\u05dc \u05d4\u05d7\u05dc\u05dc \u05e9\u05dc\u05da",arMoveAroundNotAvailableUseChrome:"\u05d7\u05d5\u05d5\u05d9\u05ea \u05d4\u05de\u05e6\u05d9\u05d0\u05d5\u05ea \u05d4\u05e8\u05d1\u05d5\u05d3\u05d4 \u05e0\u05ea\u05de\u05db\u05ea \u05d1\u05d0\u05d5\u05e4\u05df \u05de\u05dc\u05d0 \u05e8\u05e7 \u05d1\u05d3\u05e4\u05d3\u05e4\u05df Chrome ",
addToCart:"\u05d4\u05d5\u05e1\u05e4\u05d4 \u05dc\u05e2\u05d2\u05dc\u05d4",basketLineCustomTextContent:"\u05d8\u05e7\u05e1\u05d8",basketLineCustomTextFont:"\u05e1\u05d5\u05d2 \u05d2\u05d5\u05e4\u05df",noOptionSelected:"\u05dc\u05dc\u05d0",customTexRequired:"\u05e9\u05d3\u05d4 \u05d6\u05d4 \u05d0\u05d9\u05e0\u05d5 \u05d9\u05db\u05d5\u05dc \u05dc\u05d4\u05d9\u05e9\u05d0\u05e8 \u05e8\u05d9\u05e7.",customTextMaxCharactersCount:"\u05de\u05e1\u05e4\u05e8 \u05ea\u05d5\u05d5\u05d9\u05dd \u05de\u05e8\u05d1\u05d9:",
customTextAllowedCharacters:"\u05ea\u05d5\u05d5\u05d9\u05dd \u05de\u05d5\u05ea\u05e8\u05d9\u05dd:"}}};
var findLanguage=function(b){b=(""+b).replace("_","-").toLowerCase();if(languages[b])return b;for(var d in languages)if(-1!=d.indexOf(b))return d;return null},readLocaleFromCookie=function(){var b=null;window.viewerLang?b=findLanguage(window.viewerLang):(window.cookieEnabled&&(b=stage.createStorage("emLocale","cookies"),b=findLanguage(b.get("lang"))),b||(b=findLanguage(stage.browser.Ie&&11>stage.browser.version?window.navigator.systemLanguage:window.navigator.language)),!b&&window.viewerDefaultLocale&&
(b=findLanguage(window.viewerDefaultLocale)),b||(b="en-US"));return b};window.viewerLocale=readLocaleFromCookie.call(this);
stage.register.call(stage.emersya.viewer.modules,"i18n",function(){var b={},d=function(d,g){this.settings=stage.extend(!0,{},b,g);this.apiCore=d;window.cookieEnabled&&(this.cookieStorage=stage.createStorage("emLocale","cookies"));this.callerName=this.name="i18n";this.apiCore.register(this,"translate",q,!0);this.apiCore.register(this,"setTranslations",u);this.apiCore.register(this,"addTranslations",k);this.apiCore.register(this,"updateTranslations",l);this.apiCore.register(this,"getLocales",f,!0);
this.apiCore.register(this,"getLanguages",r,!0);this.apiCore.register(this,"getLocale",n,!0);this.apiCore.register(this,"setLocale",B,!0);this.apiCore.register(this,"localeChanged",D);this.apiCore.register(this,"isCurrentLocaleRightToLeft",w,!0);this.apiCore.register(this,"translateInAllLocales",t,!0);this.initializing=!0;languages[window.viewerLocale]?this.apiCore.exec(this.callerName,"setLocale",window.viewerLocale):this.apiCore.exec(this.callerName,"setLocale","en");this.initializing=!1;this.defaultTranslation=
this.defaultLanguage=null};d.prototype.destroy=function(){this.apiCore.unregister(this,"translate");this.apiCore.unregister(this,"setTranslations");this.apiCore.unregister(this,"addTranslations");this.apiCore.unregister(this,"updateTranslations");this.apiCore.unregister(this,"getLocales");this.apiCore.unregister(this,"getLanguages");this.apiCore.unregister(this,"getLocale");this.apiCore.unregister(this,"setLocale");this.apiCore.unregister(this,"localeChanged");this.apiCore.unregister(this,"translateInAllLocales");
this.apiCore=null};var u=function(b){this.defaultTranslation=null;window.viewerDefaultLocale&&(this.defaultLanguage=findLanguage(window.viewerDefaultLocale));if(!this.defaultTranslation)for(var d in b.translations){var e=findLanguage(d);e==this.defaultLanguage&&(this.defaultTranslation=b.translations[d])}for(var f in b.translations)if(e=findLanguage(f))for(var g in b.translations[f])for(var p in b.translations[f][g])for(var m in b.translations[f][g][p])b.translations[f][g][p][m]&&(languages[e][g]||
(languages[e][g]={}),"Project"==g||"ViewerSettings"==g?(languages[e][g][m]||(languages[e][g][m]={}),languages[e][g][m]=b.translations[f][g][p][m]):(languages[e][g][m+p]||(languages[e][g][m+p]={}),languages[e][g][m+p]=b.translations[f][g][p][m]))},k=function(b){for(var d in b.translations){var e=findLanguage(d);e==this.defaultLanguage&&(this.defaultTranslation=stage.extend(this.defaultTranslation,b.translations[d]));for(var f in b.translations[d])for(var g in b.translations[d][f])for(var p in b.translations[d][f][g])b.translations[d][f][g][p]&&
(languages[e][f]||(languages[e][f]={}),languages[e][f][p+g]||(languages[e][f][p+g]={}),languages[e][f][p+g]=b.translations[d][f][g][p])}},l=function(b){u.call(this,b);this.apiCore.exec(this.callerName,"localeChanged",this.currentLang)},g=function(b,d,e){return b&&(b=b.toLowerCase(),languages[b]&&languages[b][e]&&languages[b][e][d])?languages[b][e][d]:null},q=function(b,d,e){d||(d="viewerObject");e=(void 0===e?null:e)||this.currentLang;"toolbar"==d&&(e=-1!=window.location.href.toLowerCase().indexOf("fr")?
"fr-FR":"en-US");return(e=g(e,b,d))||(e=g(this.defaultLanguage,b,d))?e:(e=g("en-US",b,d))?e:null},t=function(b,d){for(var e={},f=$jscomp.makeIterator(this.apiCore.exec(this.callerName,"getLocales")),g=f.next();!g.done;g=f.next())g=g.value,e[g]=this.apiCore.exec(this.callerName,"translate",b,d,g);return e},r=function(){return languages},f=function(){var b=[],d;for(d in languages)b.push(d);return b},n=function(){return this.currentLang},B=function(b){var d=findLanguage(b);if(d)this.currentLang=d,this.apiCore.exec(this.callerName,
"localeChanged",this.currentLang);else return stage.createError(318,b+" language is not available.");return stage.createResult(1)},w=function(){return!!languages[this.currentLang].rightToLeft},D=function(b){!this.initializing&&window.cookieEnabled&&(this.cookieStorage.set("lang",b.toLowerCase()),this.cookieStorage.save())};return d});stage.provide("emersya.viewer.modules.lib");stage.require("emersya.viewer.modules.API.core");
stage.register.call(stage.emersya.viewer.modules,"lib",function(){function b(b){return window.fetch(b,{mode:"cors"}).then(function(b){return b.blob()})}var d={},u=function(b,r){this.apiCore=b;this.settings=stage.extend(!0,{},d,r);this.callerName=this.name="lib";this.apiCore.register(this,"lib.setStyle",k);this.apiCore.register(this,"lib.insertSvg",g);this.apiCore.register(this,"lib.resetSvg",l);this.apiCore.register(this,"lib.hexToRgb",f,!0);this.apiCore.register(this,"lib.hexToRgba",n,!0);this.apiCore.register(this,
"lib.rgbToHex",F,!0);this.apiCore.register(this,"lib.rgbaToHex",p,!0);this.apiCore.register(this,"lib.convertToRGB",A,!0);this.apiCore.register(this,"lib.convertToRGBA",D,!0);this.apiCore.register(this,"lib.isColorDark",E,!0);this.apiCore.register(this,"lib.getClearestColor",e,!0);this.apiCore.register(this,"lib.getDarkestColor",H,!0);this.apiCore.register(this,"lib.computeRotationAngles",m,!0);this.apiCore.register(this,"lib.markdown2HTML",h,!0);this.apiCore.register(this,"lib.downloadFile",v,!0);
this.apiCore.register(this,"lib.convertStringsToSet",I,!0);this.apiCore.register(this,"lib.startTimer",J);this.apiCore.register(this,"lib.updateTimer",M,!0);this.apiCore.register(this,"lib.stopTimer",T,!0);this.apiCore.register(this,"lib.convertSize",R,!0)};u.prototype.destroy=function(){this.apiCore.unregister(this,"lib.resetSvg");this.apiCore.unregister(this,"lib.insertSvg");this.apiCore.unregister(this,"lib.setStyle");this.apiCore.unregister(this,"lib.hexToRgb");this.apiCore.unregister(this,"lib.hexToRgba");
this.apiCore.unregister(this,"lib.rgbToHex");this.apiCore.unregister(this,"lib.rgbaToHex");this.apiCore.unregister(this,"lib.convertToRGB");this.apiCore.unregister(this,"lib.convertToRGBA");this.apiCore.unregister(this,"lib.isColorDark");this.apiCore.unregister(this,"lib.getClearestColor");this.apiCore.unregister(this,"lib.getDarkestColor");this.apiCore.unregister(this,"lib.computeRotationAngles");this.apiCore.unregister(this,"lib.markdown2HTML");this.apiCore.unregister(this,"lib.downloadFile");this.apiCore.unregister(this,
"lib.convertStringsToSet");this.apiCore.unregister(this,"lib.startTimer");this.apiCore.unregister(this,"lib.updateTimer");this.apiCore.unregister(this,"lib.stopTimer");this.apiCore.unregister(this,"lib.convertSize");this.apiCore=null};var k=function(b){this.settings=stage.extend(!0,{},this.settings,b)},l=function(b,h){h.find("svg").last().children().each(stage.setContext(function(h,d){if(b.elems[d]){for(var e in b.elems[d].attributes){var f=b.elems[d].attributes[e];"fill"==e&&this.settings[f]?h.setAttributeNS(null,
e,this.settings[f].substring(0,7)):h.setAttributeNS(null,e,f)}!h.getAttributeNS(null,"fill-opacity")&&this.settings[b.elems[d].attributes.fill]&&h.setAttributeNS(null,"fill-opacity",""!=this.settings[b.elems[d].attributes.fill].substring(7,9)?1/(255/parseInt(this.settings[b.elems[d].attributes.fill].substring(7,9),16)):1)}},this))},g=function(b,h){var d=0<$$stage("#privateEmersyaViewerContainer").find("#"+b.container).length?$$stage("#privateEmersyaViewerContainer").find("#"+b.container).get(0):$$stage("#privateEmersyaViewerContainer").find("."+
b.container).get(0);d&&d.listenerSet&&(d.listenerSet=!1,h.mouseOver&&($$stage(d).unListen("mouseover",d.onMouseOverActionListener),$$stage(d).unListen("mouseout",d.onMouseOutActionListener)),h.colorOnClick&&$$stage(d).unListen("mousedown",d.onMousedownActionListener));$$stage(d).find("svg").last().remove();d=document.createElementNS("http://www.w3.org/2000/svg","svg");d.setAttributeNS(null,"width",h.width?h.width:"100%");d.setAttributeNS(null,"height",h.height?h.height:"100%");d.setAttributeNS(null,
"viewBox",b.sizeSvg?b.sizeSvg:"0 0 1000 1000");for(var e=0;e<b.elems.length;e++){var f=b.elems[e],m=document.createElementNS("http://www.w3.org/2000/svg",f.balise);m.settings||(m.settings={});b.transform&&m.setAttributeNS(null,"transform",b.transform);for(var v in f.attributes){var p=f.attributes[v];if("childs"==v)for(var g in f.attributes[v]){p=f.attributes[v][g];var n=document.createElementNS("http://www.w3.org/2000/svg",p.balise),k;for(k in p.attributes){var I=p.attributes[k];"fill"==k&&this.settings[I]?
n.setAttributeNS(null,k,this.settings[I].substring(0,7)):n.setAttributeNS(null,k,I)}m.appendChild(n)}else"fill"==v&&this.settings[p]?(p=this.settings[p].substring(0,7),m.setAttributeNS(null,v,p),m.settings.initialColor=p):(m.setAttributeNS(null,v,p),"stroke"==v&&(m.settings.initialStrokeColor=p))}!m.getAttributeNS(null,"fill-opacity")&&this.settings[f.attributes.fill]&&(f=""!=this.settings[f.attributes.fill].substring(7,9)?1/(255/parseInt(this.settings[f.attributes.fill].substring(7,9),16)):1,m.setAttributeNS(null,
"fill-opacity",f),m.settings.initialColorOpacity=f);d.appendChild(m)}void 0!==h.text&&null!==h.text&&(v=h.fontSize?h.fontSize:110,150<h.width&&(v=1/(h.width/16500)),g=document.createElementNS("http://www.w3.org/2000/svg","text"),g.setAttributeNS(null,"fill",h.fillText?h.fillText:"white"),g.setAttributeNS(null,"font-size",v),g.setAttributeNS(null,"x",h.posTextX?h.posTextX:"620"),g.setAttributeNS(null,"y",h.posTextY?h.posTextY:"190"),g.setAttributeNS(null,"text-anchor",h.textAnchor?h.textAnchor:"middle"),
g.setAttributeNS(null,"font-weight",h.fontWeight?h.fontWeight:"normal"),g.textContent=h.text,d.appendChild(g));if(v=0<$$stage("#privateEmersyaViewerContainer").find("#"+b.container).length?$$stage("#privateEmersyaViewerContainer").find("#"+b.container).get(0):$$stage("#privateEmersyaViewerContainer").find("."+b.container).get(0))b.doNotEmpty||$$stage(v).empty(),v.appendChild(d),v.listenerSet||(v.listenerSet=!0,h.mouseOver&&(v.onMouseOverActionListener=stage.setContext(q,this,v,b,h),v.onMouseOutActionListener=
stage.setContext(t,this,v,b,h),$$stage(v).listen("mouseover",v.onMouseOverActionListener),$$stage(v).listen("mouseout",v.onMouseOutActionListener)),h.colorOnClick&&(v.onMousedownActionListener=stage.setContext(r,this,v,b,h),$$stage(v).listen("mousedown",v.onMousedownActionListener)))},q=function(b,h,d){$$stage(b).find("svg").last().children().each(stage.setContext(function(b,e){b.settings||(b.settings={});b.settings.initialColor=b.getAttributeNS(null,"fill");b.settings.initialColorOpacity=b.getAttributeNS(null,
"fill-opacity");b.settings.initialStrokeColor=b.getAttributeNS(null,"stroke");h.elems[e]&&h.elems[e].colorable&&(void 0!=this.settings[h.elems[e].overColor]?b.setAttributeNS(null,"fill",this.settings[h.elems[e].overColor].substring(0,7)):d[h.elems[e].overColor]?b.setAttributeNS(null,"fill",d[h.elems[e].overColor].substring(0,7)):b.setAttributeNS(null,"fill",h.elems[e].overColor.substring(0,7)),b.setAttributeNS(null,"fill-opacity",1));h.elems[e]&&h.elems[e].strokeColorable&&(void 0!=this.settings[h.elems[e].strokeOverColor]?
b.setAttributeNS(null,"stroke",this.settings[h.elems[e].strokeOverColor].substring(0,7)):b.setAttributeNS(null,"stroke",h.elems[e].strokeOverColor.substring(0,7)))},this))},t=function(b,h,d){$$stage(b).find("svg").last().children().each(stage.setContext(function(b,h){b.setAttributeNS(null,"fill",b.settings.initialColor);b.setAttributeNS(null,"fill-opacity",b.settings.initialColorOpacity);b.setAttributeNS(null,"stroke",b.settings.initialStrokeColor)},this))},r=function(b,h,d){$$stage(b).find("svg").last().children().each(stage.setContext(function(b,
d){h.elems[d]&&h.elems[d].colorable&&(b.settings.initialColor=this.settings[h.elems[d].overColor],void 0!=this.settings[h.elems[d].attributes.fill]&&(b.settings.initialColorOpacity=""!=this.settings[h.elems[d].overColor].substring(7,9)?1/(255/parseInt(this.settings[h.elems[d].overColor].substring(7,9),16)):h.elems[d].attributes.opacity,b.setAttributeNS(null,"fill-opacity",b.settings.initialColorOpacity)),b.setAttributeNS(null,"fill",b.settings.initialColor))},this))},f=function(b){b=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(b);
var h=parseInt(b[1],16),d=parseInt(b[2],16),e=parseInt(b[3],16);return b?{0:h,1:d,2:e,r:h,g:d,b:e}:null},n=function(b,h){if(7<b.length)b=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(b),d=parseInt(b[1],16),e=parseInt(b[2],16),f=parseInt(b[3],16),a=parseInt(b[4],16),b=b?{0:d,1:e,2:f,3:a,r:d,g:e,b:f,a:a}:null;else{b=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(b);var d=parseInt(b[1],16),e=parseInt(b[2],16),f=parseInt(b[3],16);b=b?{0:d,1:e,2:f,3:255,r:d,g:e,b:f,a:255}:null}b&&h&&(b["0"]/=
255,b["1"]/=255,b["2"]/=255,b["3"]/=255,b.r/=255,b.g/=255,b.b/=255,b.a/=255);return b},B=function(b){return"#"==b.charAt(0)?b.substring(1,7):b},w=function(b){b=Number(b).toString(16);2>b.length&&(b="0"+b);return b},D=function(b){var h=parseInt(B(b).substring(0,2),16),d=parseInt(B(b).substring(2,4),16),e=parseInt(B(b).substring(4,6),16),f=1;7<b.length&&(f=parseInt(b.substring(7,9),16)/255);return"rgba("+h+","+d+","+e+","+f+")"},A=function(b){var h=parseInt(B(b).substring(0,2),16),d=parseInt(B(b).substring(2,
4),16);b=parseInt(B(b).substring(4,6),16);return"rgba("+h+","+d+","+b+")"},H=function(b,h){b=f(b);b.r=Math.max(b.r-b.r*h,0);b.g=Math.max(b.g-b.g*h,0);b.b=Math.max(b.b-b.b*h,0);return"#"+w(parseInt(b.r))+w(parseInt(b.g))+w(parseInt(b.b))},e=function(b,h){b=f(b);b.r=Math.min(b.r+b.r*h,255);b.g=Math.min(b.g+b.g*h,255);b.b=Math.min(b.b+b.b*h,255);return"#"+w(parseInt(b.r))+w(parseInt(b.g))+w(parseInt(b.b))},E=function(b){b=f(b);return 127.5<Math.sqrt(.299*Math.pow(b.r,2)+.587*Math.pow(b.g,2)+.114*Math.pow(b.b,
2))?!1:!0},F=function(b){return"#"+w(parseInt(b.r))+w(parseInt(b.g))+w(parseInt(b.b))},p=function(b){return"#"+w(parseInt(b.r))+w(parseInt(b.g))+w(parseInt(b.b))+w(parseInt(b.a))},m=function(b){var h=vec3.create([0,0,1]);vec3.dot(h,b);vec3.cross(h,b,vec3.create());var d=vec3.create(b);d[1]=0;if(vec3.length(d)){vec3.normalize(d);vec3.subtract(d,h);var e=1-Math.pow(vec3.length(d),2)/2;1<e?e=1:-1>e&&(e=-1);var f=0<b[0]?Math.acos(e):-Math.acos(e)}else f=0<b[0]?0:Math.PI;vec3.add(h,d);d=vec3.create(b);
vec3.normalize(d);vec3.subtract(d,h);e=1-Math.pow(vec3.length(d),2)/2;1<e?e=1:-1>e&&(e=-1);return{x:f,y:0<b[1]?Math.acos(e):-Math.acos(e)}},h=function(b){if("string"!==typeof b)return b.toString();var h=[{regex:/\*\*.*?\*\*/gm,size:2,html:["<b>","</b>"]},{regex:/\*.*?\*/gm,size:1,html:["<i>","</i>"]}];for(g in h){var d=h[g].size,e=h[g].html,f=b.match(h[g].regex);if(f)for(var m in f){var v=f[m],p=e[0]+v.substr(d,v.length-2*d)+e[1];b=b.replace(v,p)}}h=/\((.*?)\)/;var g=/\[(.*?)\]/;m=/["|'].*?["|']/;
d=[/!\[(.*?)\]\(.*?\)/gm,/\[(.*?)\]\(.*?\)/gm];for(e=0;e<d.length;++e)if(f=b.match(d[e]))for(v=0;v<f.length;v++){var n=f[v],k;(k=g.exec(n))&&(k=k[1]);var I=h.exec(n);if(I)switch(e){case 0:p='<img src="';I=I[1].split(/[ ]+/);p+=I[0]+'"';p+=" width="+I[1];p+=" height="+I[2];p+=' alt="'+k+'">';break;case 1:var J;I=I[1];if(J=m.exec(I))J=J[0],I=I.replace(J,"");k||(k=I);0<I.trim().length&&(p='<a href="'+I+'" target=_blank',J&&(p+=" title="+J),p+=">"+k+"</a>")}b=b.replace(n,p)}return b},v=function(h,d){d=
void 0===d?null:d;return b(h).then(function(b){b=window.URL.createObjectURL(b);var h=document.createElement("a");d&&(h.download=d);h.href=b;document.body.appendChild(h);h.click();document.body.removeChild(h);delete h;window.URL.revokeObjectURL(b)})},I=function(b){var h=new Set;if(b)for(var d=0;d<b.length;++d)h.add(b[d]);return h},J=function(){this.tx=this.t1=(new Date).getTime()},M=function(b){if(!this.t1)throw"timer not started";var h=(new Date).getTime();b=b?h-this.t1:h-this.tx;this.tx=h;return b},
T=function(){var b=null;this.t1&&(b=M.call(this,!0));this.tx=this.t1=null;return b},U={system:"metric",fraction:.01,decimals:0},R=function(b,h){stage.extend({},U,h);switch(h.system){case "imperial":var d=Number(100*b)/2.54;var e=Math.floor(Math.round(d)/12);var f=Math.round(d)%12;d=d.toFixed(2);b=C(100*b);var m="";switch(h.fraction){default:switch(h.decimals){case 0:m="";break;case 1:0<f&&(m=f+"\u2033");break;case 2:0<f&&(m=f),b&&(m+=""+b),m.length&&(m+="\u2033")}return(0<e?e+"\u2032":"")+m;case .1:switch(h.decimals){case 0:m=
d+"\u2033";break;case 1:m=b?0<d?""+Math.floor(d)+b:""+b:0<d?""+Math.round(d):"0",m.length&&(m+="\u2033")}return m}default:switch(e=(b/h.fraction).toFixed(h.decimals),h.fraction){case 1E3:return e+"km";case 100:return e+"hm";case 10:return e+"dam";case 1:return e+"m";case .1:return e+"dm";default:return e+"cm";case .001:return e+"mm";case 1E-6:return e+"\u03bcm";case 1E-9:return e+"nm"}}},aa={"1/2":"\u00bd","1/3":"\u2153","2/3":"\u2154","1/4":"\u00bc","3/4":"\u00be","1/5":"\u2155","2/5":"\u2156","3/5":"\u2157",
"4/5":"\u2158","1/6":"\u2159","5/6":"\u215a","1/7":"\u2150","1/8":"\u215b","3/8":"\u215c","5/8":"\u215d","7/8":"\u215e"},C=function(){var b=[{multiple:2,value:0},{multiple:4,value:0},{multiple:8,value:0}];b.forEach(function(b){b.value=1/b.multiple});return function(h){h/=2.54;var d=h-Math.floor(h);h=b.reduce(function(b,h){var e=Math.ceil(d/h.value),f=Math.abs(d-e*h.value);return null===b||f<b.accuracity?{fractionalPart:e,accuracity:f,multiple:h.multiple}:b},null);if(null===h)throw new RangeError;
return aa[h.fractionalPart+"/"+h.multiple]}}();return u});stage.provide("emersya.viewer.modules.API.iframe");stage.require("emersya.viewer.modules.API.core");
stage.register.call(stage.emersya.viewer.modules.API,"iframe",function(){var b={routeViewerVersionNumber:0,routeProjectVersionNumber:0,viewerVersionNumber:0,projectVersionNumber:0,serverURL:"",loadedFromConfiguration:!1},d=function(d,ea){this.settings=stage.extend(!0,{},b,ea);this.apiCore=d;this.product={state:void 0,store:void 0,blueprint:void 0};this.arState=void 0;this.state="opened";this.bridge=null;this.callerLocation="";this.registeredBridge=!1;this.callsTable={};this.transactionIds=-.5;this.productCallsTable=
{};this.funcNames={};this.register(this,"registerCallback",ka);this.register(this,"getViewerState",Z);this.register(this,"destroyViewer",da);window.addEventListener("message",stage.setContext(ba,this),!1);this.name="iframe";this.callerName="iframeAPI";this.apiCore.register(this,"iframe.setState",q);this.apiCore.register(this,"updateRoutes",t);this.apiCore.register(this,"onAnimationTriggerClicked",Fa);this.apiCore.register(this,"onAnnotationPinClicked",xa);this.apiCore.register(this,"onAnnotationPinClosed",
Ia);this.apiCore.register(this,"onAnnotationPinOpened",qa);this.apiCore.register(this,"onHelpHide",Va);this.apiCore.register(this,"onHelpDisplayed",va);this.apiCore.register(this,"onScrollWithoutCtrl",la);this.apiCore.register(this,"localeChanged",fa);this.apiCore.register(this,"resize",P);this.apiCore.register(this,"startAnnotationsAnimation",Ba);this.apiCore.register(this,"startAutoRotate",Ba);this.apiCore.register(this,"stopAnnotationsAnimation",Ka);this.apiCore.register(this,"stopAutoRotate",
Ka);this.apiCore.register(this,"onAnimationTriggerMouseEnter",Ja);this.apiCore.register(this,"onAnimationTriggerMouseLeave",La);this.apiCore.register(this,"onEndAnimation",wa);this.apiCore.register(this,"onEndNodeAnimation",ra);this.apiCore.register(this,"cameraAnimationEnd",Sa);this.apiCore.register(this,"polylistSelection",Ya);this.apiCore.register(this,"polylistHighlight",Ra);this.apiCore.register(this,"materialTreeHighlight",ma);this.apiCore.register(this,"materialTreesGroupHighlight",bb);this.apiCore.register(this,
"startExternalCameraInteraction",gb);this.apiCore.register(this,"updateExternalCameraInteraction",ib);this.apiCore.register(this,"endExternalCameraInteraction",hb);this.apiCore.register(this,"mouseTrackingUpdate",fb);this.apiCore.register(this,"onTransactionError",Ha);this.apiCore.register(this,"onTransactionIdError",X);this.apiCore.register(this,"onTransactionSuccess",Ga);this.apiCore.register(this,"uiReady",r);this.apiCore.register(this,"launch3D",K);this.apiCore.register(this,"ui.updateLoader",
G);this.apiCore.register(this,"init.scenePreloaded",S);this.apiCore.register(this,"startRendering",Y);this.apiCore.register(this,"displayFallback",ia);this.apiCore.register(this,"webGlContextLost",Q);this.apiCore.register(this,"disable3D",ta);this.apiCore.register(this,"fallbackReady",ua);this.apiCore.register(this,"customPatternReady",f);this.apiCore.register(this,"toggleFullScreen",Aa);this.apiCore.register(this,"arReady",h);this.apiCore.register(this,"stopAr",v);this.apiCore.register(this,"onShowArLoader",
R);this.apiCore.register(this,"onHideArLoader",aa);this.apiCore.register(this,"showArSizeSelector",F);this.apiCore.register(this,"hideArSizeSelector",E);this.apiCore.register(this,"quitArSizeSelector",p);this.apiCore.register(this,"showArSizeSelectorNewTab",F);this.apiCore.register(this,"arStarted",e);this.apiCore.register(this,"startSharing",B);this.apiCore.register(this,"arShared",H);this.apiCore.register(this,"arSharedError",A);this.apiCore.register(this,"foldShareButton",w);this.apiCore.register(this,
"unfoldShareButton",D);this.apiCore.register(this,"startArNewTab",n);this.apiCore.register(this,"takeArPicture",m);this.apiCore.register(this,"onShowArHelper",L);this.apiCore.register(this,"onHideArHelper",C);this.apiCore.register(this,"hideMessageScreen",I);this.apiCore.register(this,"displayMessageScreen",J);this.apiCore.register(this,"addingPresetToArMenu",M);this.apiCore.register(this,"viewerOverlayStatusUpdated",T);this.apiCore.register(this,"ARQRCodeStartingScreenExpected",U);this.apiCore.register(this,
"onProductStateChange",u);this.apiCore.register(this,"onProductTransactionError",l);this.apiCore.register(this,"onProductTransactionSuccess",g);this.apiCore.register(this,"onProductInitializationError",k);this.errorTypes={NONE:0,ARRAY_TYPE:1,ARRAY_LENGTH:2,ARRAY_CONTENT_TYPE:3,DOUBLE_TYPE:4,DOUBLE_NAN:5,BOOLEAN_TYPE:6,STRING_TYPE:7,INTEGER_TYPE:8,OBJECT_TYPE:9,OBJECT_CLASS:10,OBJECT_EMPTY:11}};d.prototype.destroy=function(){this.apiCore.unregister(this,"iframe.setState");this.apiCore.unregister(this,
"updateRoutes");this.apiCore.unregister(this,"onAnimationTriggerClicked");this.apiCore.unregister(this,"onAnnotationPinClicked");this.apiCore.unregister(this,"onAnnotationPinClosed");this.apiCore.unregister(this,"onAnnotationPinOpened");this.apiCore.unregister(this,"onHelpHide");this.apiCore.unregister(this,"onHelpDisplayed");this.apiCore.unregister(this,"onScrollWithoutCtrl");this.apiCore.unregister(this,"localeChanged");this.apiCore.unregister(this,"resize");this.apiCore.unregister(this,"startAnnotationsAnimation");
this.apiCore.unregister(this,"startAutoRotate");this.apiCore.unregister(this,"stopAnnotationsAnimation");this.apiCore.unregister(this,"stopAutoRotate");this.apiCore.unregister(this,"onAnimationTriggerMouseEnter");this.apiCore.unregister(this,"onAnimationTriggerMouseLeave");this.apiCore.unregister(this,"onEndAnimation");this.apiCore.unregister(this,"onEndNodeAnimation");this.apiCore.unregister(this,"cameraAnimationEnd");this.apiCore.unregister(this,"polylistSelection");this.apiCore.unregister(this,
"polylistHighlight");this.apiCore.unregister(this,"materialTreeHighlight");this.apiCore.unregister(this,"materialTreesGroupHighlight");this.apiCore.unregister(this,"startExternalCameraInteraction");this.apiCore.unregister(this,"updateExternalCameraInteraction");this.apiCore.unregister(this,"endExternalCameraInteraction");this.apiCore.unregister(this,"mouseTrackingUpdate");this.apiCore.unregister(this,"onTransactionError");this.apiCore.unregister(this,"onTransactionIdError");this.apiCore.unregister(this,
"onTransactionSuccess");this.apiCore.unregister(this,"uiReady");this.apiCore.unregister(this,"launch3D");this.apiCore.unregister(this,"ui.updateLoader");this.apiCore.unregister(this,"init.scenePreloaded");this.apiCore.unregister(this,"startRendering");this.apiCore.unregister(this,"displayFallback");this.apiCore.unregister(this,"webGlContextLost");this.apiCore.unregister(this,"disable3D");this.apiCore.unregister(this,"fallbackReady");this.apiCore.unregister(this,"customPatternReady");this.apiCore.unregister(this,
"toggleFullScreen");this.apiCore.unregister(this,"arReady");this.apiCore.unregister(this,"stopAr");this.apiCore.unregister(this,"onShowArLoader");this.apiCore.unregister(this,"onHideArLoader");this.apiCore.unregister(this,"showArSizeSelector");this.apiCore.unregister(this,"hideArSizeSelector");this.apiCore.unregister(this,"quitArSizeSelector");this.apiCore.unregister(this,"showArSizeSelectorNewTab");this.apiCore.unregister(this,"arStarted");this.apiCore.unregister(this,"startSharing");this.apiCore.unregister(this,
"arShared");this.apiCore.unregister(this,"arSharedError");this.apiCore.unregister(this,"foldShareButton");this.apiCore.unregister(this,"unfoldShareButton");this.apiCore.unregister(this,"startArNewTab");this.apiCore.unregister(this,"takeArPicture");this.apiCore.unregister(this,"onShowArHelper");this.apiCore.unregister(this,"onHideArHelper");this.apiCore.unregister(this,"hideMessageScreen");this.apiCore.unregister(this,"displayMessageScreen");this.apiCore.unregister(this,"addingPresetToArMenu");this.apiCore.unregister(this,
"viewerOverlayStatusUpdated");this.apiCore.unregister(this,"ARQRCodeStartingScreenExpected");this.apiCore.unregister(this,"onProductStateChange");this.apiCore.unregister(this,"onProductTransactionError");this.apiCore.unregister(this,"onProductTransactionSuccess");this.apiCore.unregister(this,"onProductInitializationError")};d.prototype.register=function(b,h,d){this.funcNames[h]=stage.setContext(d,b)};d.prototype.getServerURL=function(){return this.settings.serverURL};d.prototype.isInitialized=function(){return null!==
this.bridge};d.prototype.isLoaded=function(){return"loaded"===this.state};d.prototype.isPreloading=function(){return"preloading"===this.state};d.prototype.isPreloaded=function(){return"preloaded"===this.state};d.prototype.isFallback=function(){return this.fallbackLoaded};d.prototype.isViewerFallback=function(){return"viewerfallbackloaded"===this.state};d.prototype.isPreviewFallback=function(){return"previewfallbackloaded"===this.state};d.prototype.isLoading=function(){return"loading"===this.state};
d.prototype.isStarted=function(){return"started"===this.state};d.prototype.isProductReady=function(){return"ready"===this.product.state};d.prototype.sendResponse=function(b){this.bridge&&this.bridge.postMessage(b,this.callerLocation)};d.prototype.checkArray=function(b,h,d){if("array"===stage.typeOf(b)){if(-1!==d&&b.length!==d)return this.errorTypes.ARRAY_LENGTH;for(var e in b)if(stage.typeOf(b[e])!==h)return this.errorTypes.ARRAY_CONTENT_TYPE;return this.errorTypes.NONE}return this.errorTypes.ARRAY_TYPE};
d.prototype.checkDouble=function(b){return"number"!==stage.typeOf(b)?this.errorTypes.DOUBLE_TYPE:isNaN(b)?this.errorTypes.DOUBLE_NAN:this.errorTypes.NONE};d.prototype.checkInteger=function(b){return this.checkDouble(b)!==this.errorTypes.NONE?this.errorTypes.INTEGER_TYPE:parseInt(b)!==b?this.errorTypes.INTEGER_TYPE:this.errorTypes.NONE};d.prototype.checkBool=function(b){return"boolean"!==stage.typeOf(b)?this.errorTypes.BOOLEAN_TYPE:this.errorTypes.NONE};d.prototype.checkString=function(b){return"string"!==
stage.typeOf(b)?this.errorTypes.STRING_TYPE:this.errorTypes.NONE};d.prototype.checkObject=function(b,h,d){h=void 0===h?null:h;d=void 0===d?!1:d;return b&&"object"===stage.typeOf(b)?h&&!b instanceof h?this.errorTypes.OBJECT_CLASS:d&&!Object.keys(b).length?this.errorTypes.OBJECT_EMPTY:this.errorTypes.NONE:this.errorTypes.OBJECT_TYPE};d.prototype.checkVec3=function(b){var h=this.checkDouble(b[0]),d=this.checkDouble(b[1]);b=this.checkDouble(b[2]);return h!==this.errorTypes.NONE?h:d!==this.errorTypes.NONE?
d:b!==this.errorTypes.NONE?b:this.errorTypes.NONE};d.prototype.checkVec2=function(b){var h=this.checkDouble(b[0]);b=this.checkDouble(b[1]);return h!==this.errorTypes.NONE?h:b!==this.errorTypes.NONE?b:this.errorTypes.NONE};d.prototype.registerTransaction=function(b,h,d,e,f,m,v){this.callsTable[b]={externalId:h,callAction:d,errorCode:e,onSuccess:f,onError:m,noResponse:v}};d.prototype.registerProductTransaction=function(b,h,d,e,f){this.productCallsTable[b]={externalId:h,callAction:d,onSuccess:e,onError:f}};
var u=function(b){this.product.state=b;switch(b){case "ready":this.product.data=this.apiCore.exec(this.callerName,"product.get");case "loaded":this.product.blueprint=this.apiCore.exec(this.callerName,"product.getBlueprint");case "loading":this.product.store=this.apiCore.exec(this.callerName,"product.getStore")}this.bridge&&Z.call(this,null)},k=function(b){this.sendResponse({action:"onError",code:b.errors.emError[0].code,message:stage.getErrorMessage(b.errors)});this.product.state="failed";this.product.error=
stage.getErrorMessage(b.errors);this.bridge&&Z.call(this,null)},l=function(b,h){if(this.productCallsTable[b]){if(this.productCallsTable[b].onError)this.productCallsTable[b].onError(h);this.sendResponse({action:"onError",id:this.productCallsTable[b].externalId,callAction:this.productCallsTable[b].callAction,code:h.errors.emError[0].code,message:stage.getErrorMessage(h.errors)});delete this.productCallsTable[b]}},g=function(b,h,d){if(this.productCallsTable[b]){if(this.productCallsTable[b].onSuccess)this.productCallsTable[b].onSuccess(err);
Object.assign(this.product,d);this.sendResponse({action:"onSuccess",id:this.productCallsTable[b].externalId,callAction:this.productCallsTable[b].callAction,changes:h,product:d});delete this.productCallsTable[b]}},q=function(b){Z.call(this,null,b)},t=function(b){stage.extend(!0,this.settings,b)},r=function(){Z.call(this,null,"ready")},f=function(){Z.call(this,null,"customPatternReady")},n=function(){this.arState="arStarted";this.bridge&&this.bridge.postMessage({action:"onArPhotoTaken"},this.callerLocation)},
B=function(){this.arState="arSharing";this.bridge&&this.bridge.postMessage({action:"onArSharing"},this.callerLocation)},w=function(){this.arState="foldShareButton";this.bridge&&(this.bridge.postMessage({action:"onCollapseARShareButton"},this.callerLocation),this.bridge.postMessage({action:"onFoldShareButton"},this.callerLocation))},D=function(){this.arState="unfoldShareButton";this.bridge&&(this.bridge.postMessage({action:"onExpandARShareButton"},this.callerLocation),this.bridge.postMessage({action:"onUnfoldShareButton"},
this.callerLocation))},A=function(){this.arState="arSharedError";this.bridge&&this.bridge.postMessage({action:"onArSharedError"},this.callerLocation)},H=function(){this.arState="arShared";this.bridge&&this.bridge.postMessage({action:"onArShared"},this.callerLocation)};n=function(){this.arState="arStarted";this.bridge&&this.bridge.postMessage({action:"onArPhotoTaken"},this.callerLocation)};var e=function(){this.arState="arStarted";this.bridge&&this.bridge.postMessage({action:"arStarted"},this.callerLocation)},
E=function(){this.arState="hideArSizeSelector";this.bridge&&this.bridge.postMessage({action:"hideArSizeSelector"},this.callerLocation)},F=function(){this.arState="arSizeSelection";this.bridge&&this.bridge.postMessage({action:"arSizeSelection"},this.callerLocation)},p=function(){this.arState="quitSizeSelection";this.bridge&&this.bridge.postMessage({action:"quitSizeSelection"},this.callerLocation)},m=function(){this.arState="arPhotoTaken";this.bridge&&this.bridge.postMessage({action:"onArPhotoTaken"},
this.callerLocation)},h=function(){this.arState="arReady";this.bridge&&this.bridge.postMessage({action:"onArReady"},this.callerLocation)},v=function(){this.arState="arStopped";this.bridge&&this.bridge.postMessage({action:"onArStopped"},this.callerLocation)},I=function(){this.bridge&&this.bridge.postMessage({action:"hideMessageScreen"},this.callerLocation)},J=function(){this.bridge&&this.bridge.postMessage({action:"displayMessageScreen"},this.callerLocation)},M=function(){this.bridge&&this.bridge.postMessage({action:"addingPresetToArMenu"},
this.callerLocation)},T=function(b){this.bridge&&this.bridge.postMessage({action:"viewerOverlayStatusUpdated",data:b},this.callerLocation)},U=function(b){this.bridge&&this.bridge.postMessage({action:"ARQRCodeStartingScreenExpected",data:b},this.callerLocation)},R=function(){this.bridge&&this.bridge.postMessage({action:"onShowArLoader"},this.callerLocation)},aa=function(){this.bridge&&this.bridge.postMessage({action:"onHideArLoader"},this.callerLocation)},C=function(){this.bridge&&this.bridge.postMessage({action:"onHideArHelper"},
this.callerLocation)},L=function(){this.bridge&&this.bridge.postMessage({action:"onShowArHelper"},this.callerLocation)},K=function(){Z.call(this,null,"started")},G=function(b,h){this.currentProgression=b/h;"started"===this.state||"loading"===this.state?Z.call(this,null,"loading"):Z.call(this,null,"preloading")},S=function(){Z.call(this,null,"preloaded")},Y=function(){Z.call(this,null,"loaded");this.fallbackLoaded=!1},ia=function(){setTimeout(stage.setContext(Z,this,null,"3dlost"),1)},Q=function(){setTimeout(stage.setContext(Z,
this,null,"3dlost"),1)},ta=function(){Z.call(this,null,"stopped")},ua=function(b){switch(b){case stage.emersya.viewer.FALLBACK_TYPE.PREVIEW:Z.call(this,null,"previewfallbackloaded");break;case stage.emersya.viewer.FALLBACK_TYPE.VIEWER:Z.call(this,null,"viewerfallbackloaded");break;case stage.emersya.viewer.FALLBACK_TYPE.CONFIGURATOR:this.fallbackLoaded=!0,Z.call(this,null,"fallbackloaded")}},ea=function(b){this.bridge={source:b.source,postMessage:stage.setContext(oa,this)};this.callerLocation=b.origin},
oa=function(b,h){this.bridge&&this.bridge.source&&(stage.emersya.viewer.verbose&&console.log("sent : ",b),b.emersyaContext="emersyaViewer",this.bridge.source.postMessage(b,h))},ba=function(b){if(b.data&&b.source!==window){var h=b.data;this.registeredBridge||ea.call(this,b);if(this.bridge.source===b.source)if(stage.emersya.viewer.verbose&&console.log("rcvd : ",h),h.action)switch(h.action){case "arTabClosed":case "arTabClosedError":case "arQuitTabClosed":break;default:this.funcNames[h.action]?h.id&&
this.checkInteger(h.id)!==this.errorTypes.NONE?h.fromEmersyaIframe&&"onError"==h.action||(d=stage.createError(304,h.action+"api call id is not an integer."),this.bridge.postMessage({action:"onError",id:b.data.id,code:d.errors.emError[0].code,message:stage.getErrorMessage(d.errors),fromEmersyaIframe:!0},b.origin)):(d=this.funcNames[h.action](b),stage.testResult(d)?h.fromEmersyaIframe&&"onError"==h.action||this.bridge.postMessage({action:"onError",id:h.id,callAction:h.action,code:d.errors.emError[0].code,
message:stage.getErrorMessage(d.errors),fromEmersyaIframe:!0},b.origin):!d||!d.result||h.fromEmersyaIframe&&"onSuccess"==h.action||this.bridge.postMessage({action:"onSuccess",id:h.id,callAction:h.action,fromEmersyaIframe:!0},b.origin)):h.fromEmersyaIframe&&"onError"==h.action||(d=stage.createError(300,h.action),this.bridge.postMessage({action:"onError",id:b.data.id,code:d.errors.emError[0].code,message:stage.getErrorMessage(d.errors),fromEmersyaIframe:!0},b.origin))}else{var d=stage.createError(300,
h.action);this.bridge.postMessage({action:"onError",id:b.data.id,code:d.errors.emError[0].code,message:stage.getErrorMessage(d.errors),fromEmersyaIframe:!0},b.origin)}}},ka=function(b){ea.call(this,b);this.registeredBridge=!0;this.apiCore.exec(this.callerName,"activateEmptyTriggers");return Z.call(this)},Z=function(b,h){h&&(this.state=h);if(!this.bridge)return stage.createError(301,"Need to send a response to send the viewer state.",b);h=this.apiCore.exec(this.callerName,"getWebGLState");var d=this.apiCore.exec(this.callerName,
"isArCompatible");if("https://www.pridebodyboards.com"===this.callerLocation||"http://www.pridebodyboards.com"===this.callerLocation)switch(h){case 2:h=1;break;case 65536:h=17;break;default:h=0}var e=0;switch(this.state){case "started":case "opened":e=0;break;case "loading":e=this.currentProgression;break;case "loaded":e=1}var f=this.apiCore.exec(this.callerName,"getSceneBase");this.bridge.postMessage({action:"onStateChange",id:b?b.data?b.data.id:null:null,state:{webglStatus:h,viewerType:65536===
h?"webgl":"fallback",viewerState:this.state,product:this.product,arState:this.arState,arCompatibility:d,version:{routeViewer:this.settings.routeViewerVersionNumber,routeProject:this.settings.routeProjectVersionNumber,actualViewer:this.settings.viewerVersionNumber,actualProject:this.settings.projectVersionNumber,loadedFromConfiguration:this.settings.loadedFromConfiguration&&(!f||""!=f.projectConfigurationPath)},loadingProgress:e}},this.callerLocation);return stage.createResult(null)},da=function(b){this.apiCore.exec(this.callerName,
"destroyViewer")},X=function(b){if(this.callsTable[b]){var h=stage.createError(310,"Transaction id already used.",b);this.sendResponse({action:"onError",id:this.callsTable[b].externalId,callAction:this.callsTable[b].callAction,code:310,message:stage.getErrorMessage(h.errors)});delete this.callsTable[b]}},Ha=function(b){if(this.callsTable[b]){if(this.callsTable[b].onError)this.callsTable[b].onError();var h=stage.createError(this.callsTable[b].errorCode,"Error while loading materials.");this.callsTable[b].noResponse||
this.sendResponse({action:"onError",id:this.callsTable[b].externalId,callAction:this.callsTable[b].callAction,code:this.callsTable[b].errorCode,message:stage.getErrorMessage(h.errors)});delete this.callsTable[b]}},Ga=function(b){if(this.callsTable[b]){if(this.callsTable[b].onSuccess)this.callsTable[b].onSuccess();this.callsTable[b].noResponse||this.sendResponse({action:"onSuccess",id:this.callsTable[b].externalId,callAction:this.callsTable[b].callAction,transactionContent:[]});delete this.callsTable[b]}},
Fa=function(b){this.bridge&&(this.bridge.postMessage({action:"onAnimationTriggerClicked",triggerId:b},this.callerLocation),this.bridge.postMessage({action:"onTriggerClicked",triggerId:b},this.callerLocation))},xa=function(b){this.bridge&&(this.bridge.postMessage({action:"onAnnotationPinClicked",annotationNumber:b},this.callerLocation),this.bridge.postMessage({action:"onAnnotationClicked",annotationNumber:b},this.callerLocation))},Ia=function(b){this.bridge&&(this.bridge.postMessage({action:"onAnnotationPinClosed",
annotationNumber:b},this.callerLocation),this.bridge.postMessage({action:"onAnnotationClosed",annotationNumber:b},this.callerLocation))},qa=function(b){this.bridge&&(this.bridge.postMessage({action:"onAnnotationPinOpened",annotationNumber:b},this.callerLocation),this.bridge.postMessage({action:"onAnnotationOpened",annotationNumber:b},this.callerLocation))},Va=function(b){this.bridge&&this.bridge.postMessage({action:"onHelpHide"},this.callerLocation)},va=function(b){this.bridge&&this.bridge.postMessage({action:"onHelpDisplayed"},
this.callerLocation)},la=function(b){this.bridge&&this.bridge.postMessage({action:"onScrollWithoutCtrl"},this.callerLocation)},fa=function(b){this.bridge&&this.bridge.postMessage({action:"onLanguageChanged",language:b},this.callerLocation)},P=function(b,h){this.bridge&&this.bridge.postMessage({action:"onSizeChanged",width:b,height:h},this.callerLocation)},Ba=function(){this.bridge&&this.bridge.postMessage({action:"onStart"},this.callerLocation)},Ka=function(){this.bridge&&this.bridge.postMessage({action:"onStop"},
this.callerLocation)},wa=function(b,h){this.bridge&&this.bridge.postMessage({action:"onEndAnimation",animationSet:b,currentState:h},this.callerLocation)},Ja=function(b){this.bridge&&this.bridge.postMessage({action:"onAnimationTriggerMouseEnter",triggerId:b},this.callerLocation)},La=function(b){this.bridge&&this.bridge.postMessage({action:"onAnimationTriggerMouseLeave",triggerId:b},this.callerLocation)},ra=function(){this.bridge&&this.bridge.postMessage({action:"onEndNodeAnimation"},this.callerLocation)},
Sa=function(){this.bridge&&this.bridge.postMessage({action:"onEndCameraAnimation",camera:this.apiCore.exec(this.callerName,"getCamera")},this.callerLocation)},Ya=function(b,h){if(0!=b.length&&this.bridge){var d=[],e=[],f=[],m=[0,0,0],v=[0,0],p=null,g=null,n;for(n in b){d.push(b[n].polylistId);void 0!==b[n].clickedPoint[0]&&(m[0]=b[n].clickedPoint[0],m[1]=b[n].clickedPoint[1],m[2]=b[n].clickedPoint[2]);p=b[n].node.id;g=b[n].node.localId;void 0!==b[n].clickedPoint[4]&&(v[0]=b[n].clickedPoint[3],v[1]=
b[n].clickedPoint[4]);e.push(b[n].materialTreeId);var k=this.apiCore.exec(this.callerName,"getMaterialTreesGroupFromMaterialTree",b[n].materialTreeId);k&&f.push(k)}b=[];k=[];var I=[],J=this.apiCore.exec(this.callerName,"rdr.getCurrentScene");if(J){for(n in d)b.push(J.polylists[d[n]].name);for(n in e)k.push(J.materialTrees[e[n]].name);for(n in f)I.push(f[n].name)}this.bridge.postMessage({action:"onMeshSelection",meshName:b,configurableMaterialName:k,configurableMaterialsGroupName:I,nodeId:p,nodeLocalId:g,
position:m,uv:v,button:h},this.callerLocation);this.bridge.postMessage({action:"onPolylistSelection",polylistName:b,materialTreeName:k,materialTreesGroupName:I,nodeId:p,nodeLocalId:g,position:m,uv:v,button:h},this.callerLocation)}},Ra=function(b){if(this.bridge){var h=[],d=[],e=[],f=[],m=[],v;for(v in b){h.push(b[v].polylistId);f.push(b[v].node.id);m.push(b[v].node.localId);d.push(b[v].materialTreeId);var p=this.apiCore.exec(this.callerName,"getMaterialTreesGroupFromMaterialTree",b[v].materialTreeId);
p&&e.push(p)}b=[];p=[];var g=[],n=this.apiCore.exec(this.callerName,"rdr.getCurrentScene");if(n){for(v in h)b.push(n.polylists[h[v]].name);for(v in d)p.push(n.materialTrees[d[v]].name);for(v in e)g.push(e[v].name)}this.bridge.postMessage({action:"onMeshHighlight",meshName:b,configurableMaterialName:p,configurableMaterialsGroupName:g,nodeIds:f,nodeLocalIds:m},this.callerLocation);this.bridge.postMessage({action:"onPolylistHighlight",polylistName:b,configurableMaterialName:p,configurableMaterialsGroupName:g,
nodeIds:f,nodeLocalIds:m},this.callerLocation)}},ma=function(b){if(this.bridge){var h=[],d;for(d in b)h.push(b[d].materialTreeId);b=[];var e=this.apiCore.exec(this.callerName,"rdr.getCurrentScene");if(e)for(d in h)b.push(e.materialTrees[h[d]].name);this.bridge.postMessage({action:"onConfigurableMaterialHighlight",configurableMaterialsName:b},this.callerLocation);this.bridge.postMessage({action:"onMaterialTreeHighlight",materialTreesName:b},this.callerLocation)}},bb=function(b){if(this.bridge){var h=
[],d;for(d in b)h.push(b[d].name);this.bridge.postMessage({action:"onConfigurableMaterialsGroupHighlight",configurableMaterialsGroupsName:h},this.callerLocation);this.bridge.postMessage({action:"onMaterialTreesGroupHighlight",materialTreesGroupsName:h},this.callerLocation)}},gb=function(b,h){this.bridge&&this.bridge.postMessage({action:"onStartCameraInteraction",camera:b,interactions:h},this.callerLocation)},ib=function(b,h){this.bridge&&this.bridge.postMessage({action:"onUpdateCameraInteraction",
camera:b,interactions:h},this.callerLocation)},hb=function(b,h){this.bridge&&this.bridge.postMessage({action:"onEndCameraInteraction",camera:b,interactions:h},this.callerLocation)},fb=function(b,h,d){if(this.bridge){var e="",f="",m="",v=null,p=null;if(b){f=this.apiCore.exec(this.callerName,"rdr.getCurrentScene");e=f.polylists[b.polylistId].name;f=f.materialTrees[b.materialTreeId].name;if(v=this.apiCore.exec(this.callerName,"getMaterialTreesGroupFromMaterialTree",b.materialTreeId))m=v.name;v=b.node.id;
p=b.node.localId}this.bridge.postMessage({action:"onMouseTrackingUpdate",position:b?[b.clickedPoint[0],b.clickedPoint[1],b.clickedPoint[2]]:null,uv:b&&void 0!==b.clickedPoint[3]?[b.clickedPoint[3],b.clickedPoint[4]]:null,mousePosition:{x:d.x,y:d.y},pressed:h,polylistName:e,materialTreeName:f,materialTreesGroupName:m,nodeId:v,nodeLocalId:p},this.callerLocation)}},Aa=function(b){this.bridge&&this.bridge.postMessage({action:"toggleFullScreen",exitFullScreen:b},this.callerLocation)};return d});stage.provide("emersya.viewer.modules.API.iframeBase");
stage.require("emersya.viewer.modules.API.iframe");stage.require("emersya.viewer.modules.API.core");
stage.register.call(stage.emersya.viewer.modules.API,"iframeBase",function(){var b={routing:"",fallbackOnly:!1,statisticId:-1},d=function(d,Rb,Gb){this.settings=stage.extend(!0,{},b,Gb);this.iframeApi=Rb;this.maxScreenshotHeight=this.maxScreenshotWidth=512;this.statId=this.settings.statisticId;this.apiCore=d;this.name="iframeBase";this.callerName="iframeAPI-BaseLvl";this.sendKeyPressEvents=!1;this.iframeApi.register(this,"preloadViewerData",q);this.iframeApi.register(this,"startViewer",k);this.iframeApi.register(this,
"stopViewer",l);this.iframeApi.register(this,"switchExperience",g);this.iframeApi.register(this,"switchExperienceType",g);this.iframeApi.register(this,"setHighlightByMaterialName",t);this.iframeApi.register(this,"setHighlightByName",t);this.iframeApi.register(this,"setHighlight",r);this.iframeApi.register(this,"getScreenshot",f);this.iframeApi.register(this,"getScreenshots",n);this.iframeApi.register(this,"getForcedResolutionScreenshot",B);this.iframeApi.register(this,"getForcedResolutionScreenshots",
w);this.iframeApi.register(this,"setDefaultView",D);this.iframeApi.register(this,"resetCamera",D);this.iframeApi.register(this,"resetMaterials",A);this.iframeApi.register(this,"startZoomIn",H);this.iframeApi.register(this,"endZoomIn",e);this.iframeApi.register(this,"stopZoomIn",e);this.iframeApi.register(this,"startZoomOut",E);this.iframeApi.register(this,"endZoomOut",F);this.iframeApi.register(this,"stopZoomOut",F);this.iframeApi.register(this,"changeLanguage",p);this.iframeApi.register(this,"fullScreenChanged",
m);this.iframeApi.register(this,"play",h);this.iframeApi.register(this,"pause",v);this.iframeApi.register(this,"showAnnotations",R);this.iframeApi.register(this,"showAnnotationsPin",R);this.iframeApi.register(this,"showAnnotation",M);this.iframeApi.register(this,"showAnnotationPin",M);this.iframeApi.register(this,"hideAnnotations",aa);this.iframeApi.register(this,"hideAnnotationsPin",aa);this.iframeApi.register(this,"toggleAnnotationPin",U);this.iframeApi.register(this,"toggleAnnotations",C);this.iframeApi.register(this,
"toggleAnnotationsPin",C);this.iframeApi.register(this,"hideAnnotation",T);this.iframeApi.register(this,"hideAnnotationPin",T);this.iframeApi.register(this,"openAnnotation",I);this.iframeApi.register(this,"openAnnotationPin",I);this.iframeApi.register(this,"closeAnnotation",J);this.iframeApi.register(this,"closeAnnotationPin",J);this.iframeApi.register(this,"setPredefinedViewpoint",X);this.iframeApi.register(this,"setCamera",Ha);this.iframeApi.register(this,"setZoomProportion",Ga);this.iframeApi.register(this,
"setMinAndMaxZoom",Fa);this.iframeApi.register(this,"setMinAndMaxZoomProportion",xa);this.iframeApi.register(this,"resetMinAndMaxZoom",Ia);this.iframeApi.register(this,"getCamera",qa);this.iframeApi.register(this,"rotateCameraX",Va);this.iframeApi.register(this,"rotateCameraY",va);this.iframeApi.register(this,"rotateCameraZ",la);this.iframeApi.register(this,"rotateCamera",fa);this.iframeApi.register(this,"moveCameraX",P);this.iframeApi.register(this,"moveCameraY",Ba);this.iframeApi.register(this,
"moveCameraZ",Ka);this.iframeApi.register(this,"moveCamera",wa);this.iframeApi.register(this,"translateCameraX",Ja);this.iframeApi.register(this,"translateCameraY",La);this.iframeApi.register(this,"translateCamera",ra);this.iframeApi.register(this,"toggleKeyboard",bb);this.iframeApi.register(this,"enableKeyboard",gb);this.iframeApi.register(this,"disableKeyboard",ib);this.iframeApi.register(this,"toggleMouseButtons",hb);this.iframeApi.register(this,"enableMouseButtons",fb);this.iframeApi.register(this,
"disableMouseButtons",Aa);this.iframeApi.register(this,"toggleMouseMove",eb);this.iframeApi.register(this,"enableMouseMove",ab);this.iframeApi.register(this,"disableMouseMove",Ma);this.iframeApi.register(this,"toggleMouseWheel",Ta);this.iframeApi.register(this,"enableMouseWheel",db);this.iframeApi.register(this,"disableMouseWheel",Oa);this.iframeApi.register(this,"toggleTouch",Qa);this.iframeApi.register(this,"enableTouch",N);this.iframeApi.register(this,"disableTouch",za);this.iframeApi.register(this,
"toggleTouchInteractions",Qa);this.iframeApi.register(this,"enableTouchInteractions",N);this.iframeApi.register(this,"disableTouchInteractions",za);this.iframeApi.register(this,"toggleRealTimeFeedback",ca);this.iframeApi.register(this,"toggleHighFrequencyFeedback",ca);this.iframeApi.register(this,"enableRealTimeFeedback",Ea);this.iframeApi.register(this,"enableHighFrequencyFeedback",Ea);this.iframeApi.register(this,"disableRealTimeFeedback",Ca);this.iframeApi.register(this,"disableHighFrequencyFeedback",
Ca);this.iframeApi.register(this,"setDragMouseButton",Ua);this.iframeApi.register(this,"toggleMouseTrackingMode",sa);this.iframeApi.register(this,"toggleMouseTracking",sa);this.iframeApi.register(this,"enableMouseTrackingMode",na);this.iframeApi.register(this,"enableMouseTracking",na);this.iframeApi.register(this,"disableMouseTrackingMode",kb);this.iframeApi.register(this,"disableMouseTracking",kb);this.iframeApi.register(this,"toggleKeyboardTrackingMode",Da);this.iframeApi.register(this,"enableKeyboardTrackingMode",
xb);this.iframeApi.register(this,"disableKeyboardTrackingMode",Za);this.iframeApi.register(this,"toggleCameraLock",ja);this.iframeApi.register(this,"unlockCamera",W);this.iframeApi.register(this,"lockCamera",pa);this.iframeApi.register(this,"toggleRulers",Pa);this.iframeApi.register(this,"toggleRendering",ha);this.iframeApi.register(this,"toggleRenderingFreezing",ha);this.iframeApi.register(this,"freezeRendering",ya);this.iframeApi.register(this,"unfreezeRendering",zb);this.iframeApi.register(this,
"setPlayMode",Sa);this.iframeApi.register(this,"setMouseControlMode",Ra);this.iframeApi.register(this,"setARControlMode",Ra);this.iframeApi.register(this,"setCursor",ma);this.iframeApi.register(this,"setSceneryBackgroundColor",Ya);this.iframeApi.register(this,"showHelp",ka);this.iframeApi.register(this,"hideHelp",Z);this.iframeApi.register(this,"toggleHelp",da);this.iframeApi.register(this,"startAr",G);this.iframeApi.register(this,"startEmersyaAr",L);this.iframeApi.register(this,"setArQrCodeUrl",
K);this.iframeApi.register(this,"stopAr",S);this.iframeApi.register(this,"showArHelper",Y);this.iframeApi.register(this,"hideArHelper",ia);this.iframeApi.register(this,"showArMenu",Q);this.iframeApi.register(this,"hideArMenu",ta);this.iframeApi.register(this,"toggleShareButton",ua);this.iframeApi.register(this,"foldShareButton",ea);this.iframeApi.register(this,"collapseARShareButton",ea);this.iframeApi.register(this,"unfoldShareButton",oa);this.iframeApi.register(this,"expandARShareButton",oa);this.iframeApi.register(this,
"getARCompatibility",ba);this.iframeApi.register(this,"showScrollWithoutCtrlContainer",cb);this.iframeApi.register(this,"hideScrollWithoutCtrlContainer",nc);this.iframeApi.register(this,"setViewpoint",dc);this.iframeApi.register(this,"recenterViewpoint",Wb);this.iframeApi.register(this,"disableARDefaultQRCodeStartingScreen",Xb);this.iframeApi.register(this,"enableARDefaultQRCodeStartingScreen",ec);this.iframeApi.register(this,"toggleARDefaultQRCodeStartingScreen",Sb);this.apiCore.register(this,"onError",
u);this.apiCore.register(this,"keyPress",V);this.apiCore.register(this,"keyRelease",O)};d.prototype.destroy=function(){};var u=function(b,h){this.iframeApi.sendResponse({action:"onError",callAction:h,message:b,fromEmersyaIframe:!0})},k=function(b){if(this.settings.fallbackOnly)return stage.createError(313,"Viewer is in fallback only mode.",b);if(this.iframeApi.isLoaded())return stage.createError(305,"Viewer is already loaded.",b);if(this.iframeApi.isLoading()||this.iframeApi.isStarted())return stage.createError(306,
"Viewer is already started.",b);this.apiCore.exec(this.callerName,"launch3D");return stage.createResult(1)},l=function(b){if(!this.iframeApi.isLoaded())return stage.createError(309,"Viewer is already paused.",b);this.apiCore.exec(this.callerName,"disable3D",!1,!1);return stage.createResult(1)},g=function(b){if(this.settings.fallbackOnly)return stage.createError(313,"Viewer is in fallback only mode.",b);switch(this.iframeApi.checkDouble(b.data.type)){case this.iframeApi.errorTypes.DOUBLE_TYPE:case this.iframeApi.errorTypes.DOUBLE_NAN:return stage.createError(304,
b.data.action+" type parameter is not an integer.")}switch(b.data.type){case 1:if(this.iframeApi.isLoading()||this.iframeApi.isStarted())return stage.createError(306,"Viewer is already started.",b);if(this.iframeApi.isLoaded())return stage.createError(313,"Viewer is already a 3D experience.",b);this.apiCore.exec(this.callerName,"launch3D");break;case 2:if(this.iframeApi.isLoading()||this.iframeApi.isStarted())return stage.createError(313,"Can not switch to fallback experience while loading.",b);this.apiCore.exec(this.callerName,
"disable3D",!1,!1);break;default:return stage.createError(304,b.data.action+" type parameter must be 1 (3D) or 2 (Fallback).")}return stage.createResult(1)},q=function(){if(this.iframeApi.isLoaded())return stage.createError(305,"Viewer is already loaded.",event);if(this.iframeApi.isLoading()||this.iframeApi.isStarted()||this.iframeApi.isPreloading())return stage.createError(306,"Viewer is already started.",event);if(this.iframeApi.isPreloaded())return stage.createError(308,"Viewer is already loaded.",
event);this.apiCore.exec(this.callerName,"preloadFiles");return stage.createResult(1)},t=function(b){if(!this.iframeApi.isLoaded())return stage.createError(302,"Viewer needs to be loaded to set some highlight.",b);switch(this.iframeApi.checkArray(b.data.list,"string",-1)){case this.iframeApi.errorTypes.ARRAY_TYPE:return stage.createError(304,b.data.action+" list parameter is not an array.");case this.iframeApi.errorTypes.ARRAY_CONTENT_TYPE:return stage.createError(304,b.data.action+" list parameter contains something else than a string.")}this.apiCore.exec(this.callerName,
"stats.highlight",b.data.list,[],[]);var h=this.apiCore.exec(this.callerName,"rdr.getCurrentScene");h&&h.setHighlight(b.data.list,[],[]);return stage.createResult(1)},r=function(b){if(!this.iframeApi.isLoaded())return stage.createError(302,"Viewer needs to be loaded to set some highlight.",b);if(void 0!==b.data.polylists)switch(this.iframeApi.checkArray(b.data.polylists,"string",-1)){case this.iframeApi.errorTypes.ARRAY_TYPE:return stage.createError(304,b.data.action+" polylists parameter is not an array.");
case this.iframeApi.errorTypes.ARRAY_CONTENT_TYPE:return stage.createError(304,b.data.action+" polylists parameter contains something else than a string.")}if(void 0!==b.data.meshes)switch(this.iframeApi.checkArray(b.data.meshes,"string",-1)){case this.iframeApi.errorTypes.ARRAY_TYPE:return stage.createError(304,b.data.action+" meshes parameter is not an array.");case this.iframeApi.errorTypes.ARRAY_CONTENT_TYPE:return stage.createError(304,b.data.action+" meshes parameter contains something else than a string.")}if(void 0!==
b.data.materialTrees)switch(this.iframeApi.checkArray(b.data.materialTrees,"string",-1)){case this.iframeApi.errorTypes.ARRAY_TYPE:return stage.createError(304,b.data.action+" materialTrees parameter is not an array.");case this.iframeApi.errorTypes.ARRAY_CONTENT_TYPE:return stage.createError(304,b.data.action+" materialTrees parameter contains something else than a string.")}if(void 0!==b.data.configurableMaterials)switch(this.iframeApi.checkArray(b.data.configurableMaterials,"string",-1)){case this.iframeApi.errorTypes.ARRAY_TYPE:return stage.createError(304,
b.data.action+" configurableMaterials parameter is not an array.");case this.iframeApi.errorTypes.ARRAY_CONTENT_TYPE:return stage.createError(304,b.data.action+" configurableMaterials parameter contains something else than a string.")}if(void 0!==b.data.materialTreeGroups)switch(this.iframeApi.checkArray(b.data.materialTreeGroups,"string",-1)){case this.iframeApi.errorTypes.ARRAY_TYPE:return stage.createError(304,b.data.action+" materialTreeGroups parameter is not an array.");case this.iframeApi.errorTypes.ARRAY_CONTENT_TYPE:return stage.createError(304,
b.data.action+" materialTreeGroups parameter contains something else than a string.")}if(void 0!==b.data.configurableMaterialGroups)switch(this.iframeApi.checkArray(b.data.configurableMaterialGroups,"string",-1)){case this.iframeApi.errorTypes.ARRAY_TYPE:return stage.createError(304,b.data.action+" configurableMaterialGroups parameter is not an array.");case this.iframeApi.errorTypes.ARRAY_CONTENT_TYPE:return stage.createError(304,b.data.action+" configurableMaterialGroups parameter contains something else than a string.")}if(void 0!==
b.data.nodeLocalIds)switch(this.iframeApi.checkArray(b.data.nodeLocalIds,"number",-1)){case this.iframeApi.errorTypes.ARRAY_TYPE:return stage.createError(304,b.data.action+" nodeLocalIds parameter is not an array.");case this.iframeApi.errorTypes.ARRAY_CONTENT_TYPE:return stage.createError(304,b.data.action+" nodeLocalIds parameter contains something else than a number.")}if(b.data.cursor){if(this.iframeApi.checkString(b.data.cursor)!==this.iframeApi.errorTypes.NONE)return stage.createError(304,b.data.action+
" cursor parameter is not a string.");b.data.materialTreeGroups&&0<b.data.materialTreeGroups.length||b.data.configurableMaterialGroups&&0<b.data.configurableMaterialGroups.length||b.data.materialTrees&&0<b.data.materialTrees.length||b.data.configurableMaterials&&0<b.data.configurableMaterials.length||b.data.meshes&&0<b.data.meshes.length||b.data.polylists&&0<b.data.polylists.length?this.apiCore.exec(this.callerName,"setCursor",b.data.cursor):this.apiCore.exec(this.callerName,"setCursor","")}this.apiCore.exec(this.callerName,
"stats.highlight",b.data.polylists?b.data.polylists:[],b.data.materialTrees?b.data.materialTrees:[],b.data.materialTreeGroups?b.data.materialTreeGroups:[]);var h=this.apiCore.exec(this.callerName,"rdr.getCurrentScene");if(h){var d=[];b.data.materialTrees&&(d=b.data.materialTrees);b.data.configurableMaterials&&(d=b.data.configurableMaterials);var e=h.materialTreesGroups,f;for(f in b.data.materialTreeGroups){var m=b.data.materialTreeGroups[f],v;for(v in e){var p=e[v];if(p.name==m){for(var g in p.materialTrees)-1===
d.indexOf(p.materialTrees[g].name)&&d.push(p.materialTrees[g].name);break}}}for(f in b.data.configurableMaterialGroups)for(v in m=b.data.configurableMaterialGroups[f],e)if(p=e[v],p.name==m){for(g in p.materialTrees)-1===d.indexOf(p.materialTrees[g].name)&&d.push(p.materialTrees[g].name);break}e=[];b.data.polylists&&(e=b.data.polylists);b.data.meshes&&(e=b.data.meshes);h.setHighlight(e,d,b.data.nodeLocalIds?b.data.nodeLocalIds:[])}return stage.createResult(1)},f=function(b,h,d){if(!this.iframeApi.isInitialized())return stage.createError(301,
"Need to send a response to send the screenshot.",b);if(!this.iframeApi.isLoaded()&&!this.iframeApi.isFallback())return stage.createError(302,"Viewer needs to be loaded or fallbackloaded to get a screenshot.",b);var e=parseFloat(b.data.width),f=parseFloat(b.data.height);switch(this.iframeApi.checkDouble(e)){case this.iframeApi.errorTypes.DOUBLE_TYPE:case this.iframeApi.errorTypes.DOUBLE_NAN:return stage.createError(304,b.data.action+" width parameter is not an integer.")}switch(this.iframeApi.checkDouble(f)){case this.iframeApi.errorTypes.DOUBLE_TYPE:case this.iframeApi.errorTypes.DOUBLE_NAN:return stage.createError(304,
b.data.action+" height parameter is not an integer.")}if(void 0!==h&&void 0!==d){if(0>=e||0>=f||e>h||f>d)return stage.createError(303,"Invalid size, it must be contained between 1x1 and "+h+"x"+d+".")}else if(0>=e||0>=f||e>this.maxScreenshotWidth||f>this.maxScreenshotHeight)return stage.createError(303,"Invalid size, it must be contained between 1x1 and "+this.maxScreenshotWidth+"x"+this.maxScreenshotHeight+".");e=parseInt(e);f=parseInt(f);if(b.data.camera){switch(this.iframeApi.checkVec3(b.data.camera.position)){case this.iframeApi.errorTypes.DOUBLE_TYPE:case this.iframeApi.errorTypes.DOUBLE_NAN:return stage.createError(304,
b.data.action+" camera position parameter contains something else than a double.")}switch(this.iframeApi.checkVec3(b.data.camera.target)){case this.iframeApi.errorTypes.DOUBLE_TYPE:case this.iframeApi.errorTypes.DOUBLE_NAN:return stage.createError(304,b.data.action+" camera target parameter contains something else than a double.")}switch(this.iframeApi.checkVec3(b.data.camera.up)){case this.iframeApi.errorTypes.DOUBLE_TYPE:case this.iframeApi.errorTypes.DOUBLE_NAN:return stage.createError(304,b.data.action+
" camera up parameter contains something else than a double.")}if(void 0!==b.data.camera.fov)switch(this.iframeApi.checkDouble(b.data.camera.fov)){case this.iframeApi.errorTypes.DOUBLE_TYPE:case this.iframeApi.errorTypes.DOUBLE_NAN:return stage.createError(304,b.data.action+" camera fov parameter is not a double.");default:if(1>b.data.fov||120<b.data.fov)return stage.createError(304,b.data.action+" camera fov parameter must be contained between 1 and 120.")}}else if(b.data.viewpoint){if(this.iframeApi.checkString(b.data.viewpoint)!==
this.iframeApi.errorTypes.NONE)return stage.createError(304,b.data.action+" viewpoint parameter is not a string.");b.data.camera=this.apiCore.exec(this.callerName,"getViewpointCamera",b.data.viewpoint,e,f);if(!b.data.camera)return stage.createError(304,b.data.action+" viewpoint parameter is invalid.")}h=!0;if(void 0!==b.data.transparentBackground){if(this.iframeApi.checkBool(b.data.transparentBackground)===this.iframeApi.errorTypes.BOOLEAN_TYPE)return stage.createError(304,b.data.action+" transparentBackground parameter is not a boolean.");
h=!b.data.transparentBackground}else if(void 0!==b.data.takeBackground){console.warn("getScreenshot takeBackground parameter is now deprecated, use transparentBackground parameter to replace it.");if(this.iframeApi.checkBool(b.data.takeBackground)===this.iframeApi.errorTypes.BOOLEAN_TYPE)return stage.createError(304,b.data.action+" transparentBackground parameter is not a boolean.");h=!!b.data.takeBackground}d="image/png";if(void 0!==b.data.format){if(this.iframeApi.checkString(b.data.format)!==this.iframeApi.errorTypes.NONE)return stage.createError(304,
b.data.action+" format parameter is not a string.");d=b.data.format.toLowerCase();if("jpg"===d||"jpeg"===d)d="image/jpeg";else if("png"===d)d="image/png";else return stage.createError(304,b.data.action+" format parameter is not a available (must be either jpg or png).")}this.iframeApi.isFallback()?this.apiCore.exec(this.callerName,"rdr.takeScreenshot",e,f,!h,2,b.data.camera,stage.setContext(function(h){this.iframeApi.sendResponse({id:b.data.id,action:"onScreenshot",screenshot:h});this.apiCore.exec(this.callerName,
"stats.screenshotTaken")},this)):(this.iframeApi.sendResponse({id:b.data.id,action:"onScreenshot",screenshot:this.apiCore.exec(this.callerName,"rdr.takeScreenshot",e,f,!h,2,b.data.camera,d)}),this.apiCore.exec(this.callerName,"stats.screenshotTaken"));return stage.createResult(null)},n=function(b,h,d){if(!this.iframeApi.isInitialized())return stage.createError(301,"Need to send a response to send the screenshot.",b);if(!this.iframeApi.isLoaded()&&!this.iframeApi.isFallback())return stage.createError(302,
"Viewer needs to be loaded or in fallbackloaded mode to get a screenshot.",b);var e=parseFloat(b.data.width),f=parseFloat(b.data.height);switch(this.iframeApi.checkDouble(e)){case this.iframeApi.errorTypes.DOUBLE_TYPE:case this.iframeApi.errorTypes.DOUBLE_NAN:return stage.createError(304,b.data.action+" width parameter is not an integer.")}switch(this.iframeApi.checkDouble(f)){case this.iframeApi.errorTypes.DOUBLE_TYPE:case this.iframeApi.errorTypes.DOUBLE_NAN:return stage.createError(304,b.data.action+
" height parameter is not an integer.")}if(void 0!==h&&void 0!==d){if(0>=e||0>=f||e>h||f>d)return stage.createError(303,"Invalid size, it must be contained between 1x1 and "+h+"x"+d+".")}else if(0>=e||0>=f||e>this.maxScreenshotWidth||f>this.maxScreenshotHeight)return stage.createError(303,"Invalid size, it must be contained between 1x1 and "+this.maxScreenshotWidth+"x"+this.maxScreenshotHeight+".");e=parseInt(e);f=parseInt(f);if(b.data.cameras)for(var m in b.data.cameras){h=b.data.cameras[m];switch(this.iframeApi.checkVec3(h.position)){case this.iframeApi.errorTypes.DOUBLE_TYPE:case this.iframeApi.errorTypes.DOUBLE_NAN:return stage.createError(304,
b.data.action+" camera position parameter contains something else than a double.")}switch(this.iframeApi.checkVec3(h.target)){case this.iframeApi.errorTypes.DOUBLE_TYPE:case this.iframeApi.errorTypes.DOUBLE_NAN:return stage.createError(304,b.data.action+" camera target parameter contains something else than a double.")}switch(this.iframeApi.checkVec3(h.up)){case this.iframeApi.errorTypes.DOUBLE_TYPE:case this.iframeApi.errorTypes.DOUBLE_NAN:return stage.createError(304,b.data.action+" camera up parameter contains something else than a double.")}if(void 0!==
h.fov)switch(this.iframeApi.checkDouble(h.fov)){case this.iframeApi.errorTypes.DOUBLE_TYPE:case this.iframeApi.errorTypes.DOUBLE_NAN:return stage.createError(304,b.data.action+" camera fov parameter is not a double.");default:if(1>b.data.fov||120<b.data.fov)return stage.createError(304,b.data.action+" camera fov parameter must be contained between 1 and 120.")}}if(b.data.viewpoints){b.data.cameras||(b.data.cameras=[]);for(m in b.data.viewpoints)if(this.iframeApi.checkString(b.data.viewpoints[m])!==
this.iframeApi.errorTypes.NONE)return stage.createError(304,b.data.action+" viewpoints parameter contains something else than a string.");m=this.apiCore.exec(this.callerName,"getViewpointRegexpsCameras",b.data.viewpoints,e,f);m.length&&b.data.cameras.push.apply(b.data.cameras,$jscomp.arrayFromIterable(m))}if(!b.data.cameras||!b.data.cameras.length)return stage.createError(304,b.data.action+" either cameras or viewpoints parameter is required.");m=!0;if(void 0!==b.data.transparentBackground){if(this.iframeApi.checkBool(b.data.transparentBackground)===
this.iframeApi.errorTypes.BOOLEAN_TYPE)return stage.createError(304,b.data.action+" transparentBackground parameter is not a boolean.");m=!b.data.transparentBackground}else if(void 0!==b.data.takeBackground){console.warn("getScreenshots takeBackground parameter is now deprecated, use transparentBackground parameter to replace it.");if(this.iframeApi.checkBool(b.data.takeBackground)===this.iframeApi.errorTypes.BOOLEAN_TYPE)return stage.createError(304,b.data.action+" transparentBackground parameter is not a boolean.");
m=!!b.data.takeBackground}h="image/png";if(void 0!==b.data.format){if(this.iframeApi.checkString(b.data.format)!==this.iframeApi.errorTypes.NONE)return stage.createError(304,b.data.action+" format parameter is not a string.");h=b.data.format.toLowerCase();if("jpg"===h||"jpeg"===h)h="image/jpeg";else if("png"===h)h="image/png";else return stage.createError(304,b.data.action+" format parameter is not a available (must be either jpg or png).")}var v=function(b){return{position:Array.from(b.position),
target:Array.from(b.target),up:Array.from(b.up),viewpoint:b.viewpoint,viewpointRegexp:b.viewpointRegexp}};this.iframeApi.isFallback()?this.apiCore.exec(this.callerName,"rdr.takeScreenshots",e,f,!m,2,b.data.cameras,stage.setContext(function(h){for(var d=[],e=0;e<h.length;++e)d.push(h[e].screenshot);this.iframeApi.sendResponse({id:b.data.id,action:"onScreenshots",cameras:b.data.cameras.map(v),screenshots:d,screenshot:h});this.apiCore.exec(this.callerName,"stats.screenshotTaken")},this)):(this.iframeApi.sendResponse({id:b.data.id,
action:"onScreenshots",cameras:b.data.cameras.map(v),screenshots:this.apiCore.exec(this.callerName,"rdr.takeScreenshots",e,f,!m,2,b.data.cameras,h)}),this.apiCore.exec(this.callerName,"stats.screenshotTaken"));return stage.createResult(null)},B=function(b){return f.call(this,b,1024,1024)},w=function(b){return n.call(this,b,1024,1024)},D=function(b){if(!this.iframeApi.isLoaded())return stage.createError(302,"Viewer needs to be loaded to reset the camera.",b);var h=0;if(b.data.transitionTime){switch(this.iframeApi.checkDouble(b.data.transitionTime)){case this.iframeApi.errorTypes.DOUBLE_TYPE:case this.iframeApi.errorTypes.DOUBLE_NAN:return stage.createError(304,
b.data.action+" transitionTime parameter is not an integer.")}h=b.data.transitionTime}this.apiCore.exec(this.callerName,"resetCamera",h,!1);return stage.createResult(1)},A=function(b){if(!this.iframeApi.isLoaded())return stage.createError(302,"Viewer needs to be loaded to reset materials.",b);var h=this.apiCore.exec(this.callerName,"rdr.getCurrentScene");if(!h)return stage.createError(302,"No scene to reset animations.",b);var d=this.apiCore.exec(this.callerName,"beginUpdateTransaction");if(stage.testResult(d))return d;
d=d.result;for(var e in h.materialTrees){var f=h.materialTrees[e];this.apiCore.exec(this.callerName,"updateMaterialTreeByName",f.name,h.materialSettings[f.defaultMaterialId].name,b.data.transitionTime,[])}this.apiCore.exec(this.callerName,"endTransaction");this.iframeApi.registerTransaction(d,b.data.id,"resetMaterials",311);return stage.createResult(null)},H=function(){this.apiCore.exec(this.callerName,"keyPress","zoomIn");return stage.createResult(1)},e=function(){this.apiCore.exec(this.callerName,
"keyRelease","zoomIn");return stage.createResult(1)},E=function(){this.apiCore.exec(this.callerName,"keyPress","zoomOut");return stage.createResult(1)},F=function(){this.apiCore.exec(this.callerName,"keyRelease","zoomOut");return stage.createResult(1)},p=function(b){return this.iframeApi.checkString(b.data.language)!==this.iframeApi.errorTypes.NONE?stage.createError(304,b.data.action+" language parameter is not a string."):this.apiCore.exec(this.callerName,"setLocale",b.data.language)},m=function(){this.apiCore.exec(this.callerName,
"onNativeFullScreenChanged");return stage.createResult(1)},h=function(b){if(!this.iframeApi.isLoaded())return stage.createError(302,"Viewer needs to be loaded play the 3D.",b);this.apiCore.exec(this.callerName,"ui.changePlayMode","play");return stage.createResult(1)},v=function(b){if(!this.iframeApi.isLoaded())return stage.createError(302,"Viewer needs to be loaded to pause the 3D.",b);this.apiCore.exec(this.callerName,"ui.changePlayMode","pause");return stage.createResult(1)},I=function(b){if(!this.iframeApi.isLoaded())return stage.createError(302,
"Viewer needs to be loaded to open annotation.",b);switch(this.iframeApi.checkDouble(b.data.number)){case this.iframeApi.errorTypes.DOUBLE_TYPE:case this.iframeApi.errorTypes.DOUBLE_NAN:return stage.createError(304,b.data.action+" number parameter is not an integer.")}this.apiCore.exec(this.callerName,"openAnnotation",b.data.number);return stage.createResult(1)},J=function(b){if(!this.iframeApi.isLoaded())return stage.createError(302,"Viewer needs to be loaded to close annotation.",b);switch(this.iframeApi.checkDouble(b.data.number)){case this.iframeApi.errorTypes.DOUBLE_TYPE:case this.iframeApi.errorTypes.DOUBLE_NAN:return stage.createError(304,
b.data.action+" number parameter is not an integer.")}this.apiCore.exec(this.callerName,"closeAnnotation",b.data.number);return stage.createResult(1)},M=function(b){if(!this.iframeApi.isLoaded())return stage.createError(302,"Viewer needs to be loaded to show annotation.",b);switch(this.iframeApi.checkDouble(b.data.number)){case this.iframeApi.errorTypes.DOUBLE_TYPE:case this.iframeApi.errorTypes.DOUBLE_NAN:return stage.createError(304,b.data.action+" number parameter is not an integer.")}return this.apiCore.exec(this.callerName,
"showAnnotation",b.data.number)},T=function(b){if(!this.iframeApi.isLoaded())return stage.createError(302,"Viewer needs to be loaded to hide annotation.",b);switch(this.iframeApi.checkDouble(b.data.number)){case this.iframeApi.errorTypes.DOUBLE_TYPE:case this.iframeApi.errorTypes.DOUBLE_NAN:return stage.createError(304,b.data.action+" number parameter is not an integer.")}return this.apiCore.exec(this.callerName,"hideAnnotation",b.data.number)},U=function(b){if(!this.iframeApi.isLoaded())return stage.createError(302,
"Viewer needs to be loaded to toggle annotations",b);this.apiCore.exec(this.callerName,"toggleAnnotation",b.data.number);return stage.createResult(1)},R=function(b){if(!this.iframeApi.isLoaded())return stage.createError(302,"Viewer needs to be loaded to show annotations.",b);this.apiCore.exec(this.callerName,"toggleAnnotations","annotations",!0);return stage.createResult(1)},aa=function(b){if(!this.iframeApi.isLoaded())return stage.createError(302,"Viewer needs to be loaded to hide annotations.",
b);this.apiCore.exec(this.callerName,"toggleAnnotations","annotations",!1);return stage.createResult(1)},C=function(b){if(!this.iframeApi.isLoaded())return stage.createError(302,"Viewer needs to be loaded to toggle annotations.",b);this.apiCore.exec(this.callerName,"toggleAnnotations","annotations");return stage.createResult(1)},L=function(b){if(!this.iframeApi.isLoaded())return stage.createError(302,"Viewer needs to be loaded to start the AR.",b);this.apiCore.exec(this.callerName,"startEmersyaAr");
return stage.createResult(1)},K=function(b){if(!this.iframeApi.isLoaded())return stage.createError(302,"Viewer needs to be loaded set the AR url.",b);this.apiCore.exec(this.callerName,"setArQrCodeUrl",b.data.url);return stage.createResult(1)},G=function(b){if(!this.iframeApi.isLoaded())return stage.createError(302,"Viewer needs to be loaded to start the AR.",b);this.apiCore.exec(this.callerName,"startAr");return stage.createResult(1)},S=function(b){if(!this.iframeApi.isLoaded())return stage.createError(302,
"Viewer needs to be loaded to stop the AR.",b);this.apiCore.exec(this.callerName,"stopAr");return stage.createResult(1)},Y=function(b){if(!this.iframeApi.isLoaded())return stage.createError(302,"Viewer needs to be loaded to show the AR help menu.",b);this.apiCore.exec(this.callerName,"showArHelper",!0);return stage.createResult(1)},ia=function(b){if(!this.iframeApi.isLoaded())return stage.createError(302,"Viewer needs to be loaded to hide the AR help menu.",b);this.apiCore.exec(this.callerName,"hideArHelper",
!1);return stage.createResult(1)},Q=function(b){if(!this.iframeApi.isLoaded())return stage.createError(302,"Viewer needs to be loaded to show the AR menu.",b);this.apiCore.exec(this.callerName,"showArMenu",!0);return stage.createResult(1)},ta=function(b){if(!this.iframeApi.isLoaded())return stage.createError(302,"Viewer needs to be loaded to hide the AR menu.",b);this.apiCore.exec(this.callerName,"hideArMenu",!1);return stage.createResult(1)},ua=function(b){if(!this.iframeApi.isLoaded())return stage.createError(302,
"Viewer needs to be loaded to hide the AR menu.",b);this.apiCore.exec(this.callerName,"toggleShareButton",!1);return stage.createResult(1)},ea=function(b){if(!this.iframeApi.isLoaded())return stage.createError(302,"Viewer needs to be loaded to hide the AR menu.",b);this.apiCore.exec(this.callerName,"foldShareButton",!1);return stage.createResult(1)},oa=function(b){if(!this.iframeApi.isLoaded())return stage.createError(302,"Viewer needs to be loaded to hide the AR menu.",b);this.apiCore.exec(this.callerName,
"unfoldShareButton",!1);return stage.createResult(1)},ba=function(b){if(!this.iframeApi.isInitialized())return stage.createError(301,"Need to send a response to return ar compatibility.",b);this.iframeApi.sendResponse({id:b.data.id,action:"onGetARCompatibility",arCompatibility:this.apiCore.exec(this.callerName,"isArCompatible")});return stage.createResult(null)},ka=function(b){if(!this.iframeApi.isLoaded())return stage.createError(302,"Viewer needs to be loaded to show the help menu.",b);this.apiCore.exec(this.callerName,
"toggleHelp",!0);return stage.createResult(1)},Z=function(b){if(!this.iframeApi.isLoaded())return stage.createError(302,"Viewer needs to be loaded to hide the help menu.",b);this.apiCore.exec(this.callerName,"toggleHelp",!1);return stage.createResult(1)},da=function(b){if(!this.iframeApi.isLoaded())return stage.createError(302,"Viewer needs to be loaded to toggle the help menu.",b);this.apiCore.exec(this.callerName,"toggleHelp");return stage.createResult(1)},X=function(b){if(!this.iframeApi.isInitialized())return stage.createError(301,
"Need to send a response to send the end of the transition.",b);if(this.iframeApi.isLoaded())return stage.createError(302,"Fallback needs to be loaded to set the predefined view point.",b);switch(this.iframeApi.checkDouble(b.data.number)){case this.iframeApi.errorTypes.DOUBLE_TYPE:case this.iframeApi.errorTypes.DOUBLE_NAN:return stage.createError(304,b.data.action+" number parameter contains something else than a number.")}this.apiCore.exec(this.callerName,"setPredefinedViewpoint",b.data.number,stage.setContext(function(b){this.iframeApi.sendResponse({action:"onSuccess",
id:b,callAction:"setPredefinedViewpoint"})},this,b.data.id));return stage.createResult(null)},Ha=function(b){if(!this.iframeApi.isInitialized())return stage.createError(301,"Need to send a response to send the end of the transition.",b);if(!this.iframeApi.isLoaded()&&!this.iframeApi.isFallback())return stage.createError(302,"Viewer needs to be loaded to set the camera.",b);switch(this.iframeApi.checkVec3(b.data.position)){case this.iframeApi.errorTypes.DOUBLE_TYPE:case this.iframeApi.errorTypes.DOUBLE_NAN:return stage.createError(304,
b.data.action+" position parameter contains something else than a double.")}switch(this.iframeApi.checkVec3(b.data.target)){case this.iframeApi.errorTypes.DOUBLE_TYPE:case this.iframeApi.errorTypes.DOUBLE_NAN:return stage.createError(304,b.data.action+" target parameter contains something else than a double.")}switch(this.iframeApi.checkVec3(b.data.up)){case this.iframeApi.errorTypes.DOUBLE_TYPE:case this.iframeApi.errorTypes.DOUBLE_NAN:return stage.createError(304,b.data.action+" up parameter contains something else than a double.")}if(void 0!==
b.data.fov)switch(this.iframeApi.checkDouble(b.data.fov)){case this.iframeApi.errorTypes.DOUBLE_TYPE:case this.iframeApi.errorTypes.DOUBLE_NAN:return stage.createError(304,b.data.action+" fov parameter is not a double.");default:if(1>b.data.fov||120<b.data.fov)return stage.createError(304,b.data.action+" fov parameter must be contained between 1 and 120.")}if(void 0!==b.data.screenOffset){switch(this.iframeApi.checkDouble(b.data.screenOffset.x)){case this.iframeApi.errorTypes.DOUBLE_TYPE:case this.iframeApi.errorTypes.DOUBLE_NAN:return stage.createError(304,
b.data.action+" screenOffset.x parameter is not a double.")}switch(this.iframeApi.checkDouble(b.data.screenOffset.y)){case this.iframeApi.errorTypes.DOUBLE_TYPE:case this.iframeApi.errorTypes.DOUBLE_NAN:return stage.createError(304,b.data.action+" screenOffset.y parameter is not a double.")}}if(b.data.cameraControl){switch(b.data.cameraControl.type){case stage.emersya.viewer.SCENE_CONTROL.DOUBLEORBIT:case stage.emersya.viewer.SCENE_CONTROL.TRACKBALL:case stage.emersya.viewer.SCENE_CONTROL.FREEFLY:case stage.emersya.viewer.SCENE_CONTROL.TOPBOTTOM:case stage.emersya.viewer.SCENE_CONTROL.PLANARFREEFLY:break;
default:return stage.createError(304,b.data.action+" cameraControl type parameter is not valid.")}if(b.data.cameraControl.settings){if(void 0!==b.data.cameraControl.settings.targetRange)switch(this.iframeApi.checkDouble(b.data.cameraControl.settings.targetRange)){case this.iframeApi.errorTypes.DOUBLE_TYPE:case this.iframeApi.errorTypes.DOUBLE_NAN:return stage.createError(304,b.data.action+" cameraControl settings targetRange is not a double.")}if(void 0!==b.data.cameraControl.settings.zoomScalesRotation&&
this.iframeApi.checkBool(b.data.cameraControl.settings.zoomScalesRotation)===this.iframeApi.errorTypes.BOOLEAN_TYPE)return stage.createError(304,b.data.action+" cameraControl settings zoomScalesRotation parameter is not a boolean.");if(void 0!==b.data.cameraControl.settings.moveOnMaxZoom&&this.iframeApi.checkBool(b.data.cameraControl.settings.moveOnMaxZoom)===this.iframeApi.errorTypes.BOOLEAN_TYPE)return stage.createError(304,b.data.action+" cameraControl settings moveOnMaxZoom parameter is not a boolean.");
if(void 0!==b.data.cameraControl.settings.minDistanceRatio)switch(this.iframeApi.checkDouble(b.data.cameraControl.settings.minDistanceRatio)){case this.iframeApi.errorTypes.DOUBLE_TYPE:case this.iframeApi.errorTypes.DOUBLE_NAN:return stage.createError(304,b.data.action+" cameraControl settings minDistanceRatio is not a double.")}if(void 0!==b.data.cameraControl.settings.xRotationMin)switch(this.iframeApi.checkDouble(b.data.cameraControl.settings.xRotationMin)){case this.iframeApi.errorTypes.DOUBLE_TYPE:case this.iframeApi.errorTypes.DOUBLE_NAN:return stage.createError(304,
b.data.action+" cameraControl settings xRotationMin is not a double.")}if(void 0!==b.data.cameraControl.settings.xRotationMax)switch(this.iframeApi.checkDouble(b.data.cameraControl.settings.xRotationMax)){case this.iframeApi.errorTypes.DOUBLE_TYPE:case this.iframeApi.errorTypes.DOUBLE_NAN:return stage.createError(304,b.data.action+" cameraControl settings xRotationMax is not a double.")}if(void 0!==b.data.cameraControl.settings.yRotationMin)switch(this.iframeApi.checkDouble(b.data.cameraControl.settings.yRotationMin)){case this.iframeApi.errorTypes.DOUBLE_TYPE:case this.iframeApi.errorTypes.DOUBLE_NAN:return stage.createError(304,
b.data.action+" cameraControl settings yRotationMin is not a double.")}if(void 0!==b.data.cameraControl.settings.yRotationMax)switch(this.iframeApi.checkDouble(b.data.cameraControl.settings.yRotationMax)){case this.iframeApi.errorTypes.DOUBLE_TYPE:case this.iframeApi.errorTypes.DOUBLE_NAN:return stage.createError(304,b.data.action+" cameraControl settings yRotationMax is not a double.")}if(void 0!==b.data.cameraControl.settings.targetAxes)switch(this.iframeApi.checkVec3(b.data.cameraControl.settings.targetAxes)){case this.iframeApi.errorTypes.DOUBLE_TYPE:case this.iframeApi.errorTypes.DOUBLE_NAN:return stage.createError(304,
b.data.action+" cameraControl settings targetAxes contains something else than a double.")}}}var h={position:b.data.position,target:b.data.target,up:b.data.up,t:void 0!==b.data.transitionTime?b.data.transitionTime:0,fov:b.data.fov,camControl:b.data.cameraControl};void 0!==b.data.projectionMode&&(h.projectionMode=b.data.projectionMode);b.data.screenOffset&&(h.screenOffset={x:b.data.screenOffset.x,y:b.data.screenOffset.y});var d=!1;if(b.data.checkCurrentPosition){var e=this.apiCore.exec(this.callerName,
"getCamera"),f=function(b,h){return 1E-5>Math.abs(b&&h?1-b/h:b?b:h)},m=function(b,h){return vec3.length(vec3.subtract(b,h,vec3.create()))<1E-5*vec3.length(b)};d=(d=m(h.position,e.position)&&m(h.target,e.target)&&m(h.up,e.up))&&(h.fov?f(h.fov,e.fov):!0);h.screenOffset&&(d=(d=d&&f(h.screenOffset.x,e.screenOffset.x))&&f(h.screenOffset.y,e.screenOffset.y));if(h.camControl&&(d=d&&h.camControl.type==e.cameraControl.type,h.camControl.settings)){var v=h.camControl.settings;e=e.cameraControl.settings;d=(d=
(d=(d=(d=(d=(d=(d=d&&(v.moveOnMaxZoom?v.moveOnMaxZoom==e.moveOnMaxZoom:!0))&&(v.zoomScalesRotation?f(v.zoomScalesRotation,e.zoomScalesRotation):!0))&&(v.minDistanceRatio?f(v.minDistanceRatio,e.minDistanceRatio):!0))&&(v.xRotationMin?f(v.xRotationMin,e.xRotationMin):!0))&&(v.xRotationMax?f(v.xRotationMax,e.xRotationMax):!0))&&(v.yRotationMin?f(v.yRotationMin,e.yRotationMin):!0))&&(v.yRotationMax?f(v.yRotationMax,e.yRotationMax):!0))&&(v.targetAxes?m(v.targetAxes,e.targetAxes):!0)}}d?setTimeout(stage.setContext(function(b){this.iframeApi.sendResponse({id:b,
action:"onEndCameraTransition"})},this,b.data.id),0):this.apiCore.exec(this.callerName,"startAnimatingPath",[h],!1,b.data.unstoppable,stage.setContext(function(){this.iframeApi.sendResponse({id:b.data.id,action:"onEndCameraTransition"})},this));return stage.createResult(1)},Ga=function(b){if(!this.iframeApi.isInitialized())return stage.createError(301,"Need to send a response to send the end of the transition.",b);if(!this.iframeApi.isLoaded()&&!this.iframeApi.isFallback())return stage.createError(302,
"Viewer needs to be loaded to set the camera.",b);switch(this.iframeApi.checkDouble(b.data.value)){case this.iframeApi.errorTypes.DOUBLE_TYPE:case this.iframeApi.errorTypes.DOUBLE_NAN:return stage.createError(304,b.data.action+" value parameter is not a double.");default:if(0>b.data.value||1<b.data.value)return stage.createError(304,b.data.action+" value parameter must be contained between 0 and 1.")}this.apiCore.exec(this.callerName,"setZoomRatio",b.data.value,b.data.transitionTime,void 0!==b.data.unstoppable?
b.data.unstoppable:!0);return stage.createResult(1)},Fa=function(b){if(!this.iframeApi.isInitialized())return stage.createError(301,"Need to send a response to send the end of the transition.",b);if(!this.iframeApi.isLoaded()&&!this.iframeApi.isFallback())return stage.createError(302,"Viewer needs to be loaded to set the camera.",b);switch(this.iframeApi.checkDouble(b.data.minZoom)){case this.iframeApi.errorTypes.DOUBLE_TYPE:case this.iframeApi.errorTypes.DOUBLE_NAN:return stage.createError(304,b.data.action+
" minZoom parameter is not a double.")}switch(this.iframeApi.checkDouble(b.data.maxZoom)){case this.iframeApi.errorTypes.DOUBLE_TYPE:case this.iframeApi.errorTypes.DOUBLE_NAN:return stage.createError(304,b.data.action+" maxZoom parameter is not a double.")}if(b.data.minZoom>b.data.maxZoom)return stage.createError(304,b.data.action+" minZoom should not be greater than maxZoom.");this.apiCore.exec(this.callerName,"changeZoomRatios",b.data.minZoom,b.data.maxZoom);return stage.createResult(1)},xa=function(b){if(!this.iframeApi.isInitialized())return stage.createError(301,
"Need to send a response to send the end of the transition.",b);if(!this.iframeApi.isLoaded()&&!this.iframeApi.isFallback())return stage.createError(302,"Viewer needs to be loaded to set the camera.",b);switch(this.iframeApi.checkDouble(b.data.minZoom)){case this.iframeApi.errorTypes.DOUBLE_TYPE:case this.iframeApi.errorTypes.DOUBLE_NAN:return stage.createError(304,b.data.action+" minZoom parameter is not a double.");default:if(0>b.data.minZoom||1<b.data.minZoom)return stage.createError(304,b.data.action+
" minZoom parameter must be contained between 0 and 1.")}switch(this.iframeApi.checkDouble(b.data.maxZoom)){case this.iframeApi.errorTypes.DOUBLE_TYPE:case this.iframeApi.errorTypes.DOUBLE_NAN:return stage.createError(304,b.data.action+" maxZoom parameter is not a double.");default:if(0>b.data.maxZoom||1<b.data.maxZoom)return stage.createError(304,b.data.action+" maxZoom parameter must be contained between 0 and 1.")}if(b.data.minZoom>b.data.maxZoom)return stage.createError(304,b.data.action+" minZoom should not be greater than maxZoom.");
this.apiCore.exec(this.callerName,"changeZoomRatiosFromProportions",b.data.minZoom,b.data.maxZoom);return stage.createResult(1)},Ia=function(b){if(!this.iframeApi.isInitialized())return stage.createError(301,"Need to send a response to send the end of the transition.",b);if(!this.iframeApi.isLoaded()&&!this.iframeApi.isFallback())return stage.createError(302,"Viewer needs to be loaded to set the camera.",b);this.apiCore.exec(this.callerName,"resetMinAndMaxZoom");return stage.createResult(1)},qa=function(b){if(!this.iframeApi.isInitialized())return stage.createError(301,
"Need to send a response to return the camera.",b);if(!this.iframeApi.isLoaded())return stage.createError(302,"Viewer needs to be loaded to get the camera.",b);var h=this.apiCore.exec(this.callerName,"getCamera");this.iframeApi.sendResponse({id:b.data.id,action:"onGetCamera",camera:h});return stage.createResult(null)},Va=function(b){if(!this.iframeApi.isLoaded())return stage.createError(301,"Viewer needs to be loaded to rotate the camera.");switch(this.iframeApi.checkDouble(b.data.value)){case this.iframeApi.errorTypes.DOUBLE_TYPE:case this.iframeApi.errorTypes.DOUBLE_NAN:return stage.createError(304,
b.data.action+" value parameter is not a double.")}if(this.apiCore.exec(this.callerName,"getCamera").controlMode!==stage.emersya.viewer.SCENE_CONTROL.DOUBLEORBIT)return stage.createError(313,"Only a turn table camera can be rotated this way.");this.apiCore.exec(this.callerName,"rotateCamera",0,b.data.value,0);return stage.createResult(1)},va=function(b){if(!this.iframeApi.isLoaded())return stage.createError(301,"Viewer needs to be loaded to rotate the camera.");switch(this.iframeApi.checkDouble(b.data.value)){case this.iframeApi.errorTypes.DOUBLE_TYPE:case this.iframeApi.errorTypes.DOUBLE_NAN:return stage.createError(304,
b.data.action+" value parameter is not a double.")}var h=this.apiCore.exec(this.callerName,"getCamera");if(h.controlMode!==stage.emersya.viewer.SCENE_CONTROL.DOUBLEORBIT&&h.controlMode!==stage.emersya.viewer.SCENE_CONTROL.TRACKBALL)return stage.createError(313,"Only a turn table or a trackball camera can be rotated this way.");this.apiCore.exec(this.callerName,"rotateCamera",b.data.value,0,0);return stage.createResult(1)},la=function(b){if(!this.iframeApi.isLoaded())return stage.createError(301,"Viewer needs to be loaded to rotate the camera.");
switch(this.iframeApi.checkDouble(b.data.value)){case this.iframeApi.errorTypes.DOUBLE_TYPE:case this.iframeApi.errorTypes.DOUBLE_NAN:return stage.createError(304,b.data.action+" value parameter is not a double.")}if(this.apiCore.exec(this.callerName,"getCamera").controlMode!==stage.emersya.viewer.SCENE_CONTROL.TRACKBALL)return stage.createError(313,"Only a trackball or a trackballcamera can be rotated this way.");this.apiCore.exec(this.callerName,"rotateCamera",0,0,b.data.value);return stage.createResult(1)},
fa=function(b){if(!this.iframeApi.isLoaded())return stage.createError(301,"Viewer needs to be loaded to rotate the camera.");switch(this.iframeApi.checkVec3(b.data.value)){case this.iframeApi.errorTypes.DOUBLE_TYPE:case this.iframeApi.errorTypes.DOUBLE_NAN:return stage.createError(304,b.data.action+" value parameter contains something else than a double.")}var h=this.apiCore.exec(this.callerName,"getCamera");if(h.controlMode!==stage.emersya.viewer.SCENE_CONTROL.DOUBLEORBIT&&h.controlMode!==stage.emersya.viewer.SCENE_CONTROL.TRACKBALL)return stage.createError(313,
"Only a turn table or a trackball camera can be rotated this way.");this.apiCore.exec(this.callerName,"rotateCamera",b.data.value[1],b.data.value[0],b.data.value[2]);return stage.createResult(1)},P=function(b){if(!this.iframeApi.isLoaded())return stage.createError(301,"Viewer needs to be loaded to move the camera.");switch(this.iframeApi.checkDouble(b.data.value)){case this.iframeApi.errorTypes.DOUBLE_TYPE:case this.iframeApi.errorTypes.DOUBLE_NAN:return stage.createError(304,b.data.action+" value parameter is not a double.")}var h=
this.apiCore.exec(this.callerName,"getCamera");if(h.controlMode!==stage.emersya.viewer.SCENE_CONTROL.FREEFLY&&h.controlMode!==stage.emersya.viewer.SCENE_CONTROL.PLANARFREEFLY)return stage.createError(313,"Only a free fly camera can be moved this way.");this.apiCore.exec(this.callerName,"moveCamera",0,b.data.value,0);return stage.createResult(1)},Ba=function(b){if(!this.iframeApi.isLoaded())return stage.createError(301,"Viewer needs to be loaded to move the camera.");switch(this.iframeApi.checkDouble(b.data.value)){case this.iframeApi.errorTypes.DOUBLE_TYPE:case this.iframeApi.errorTypes.DOUBLE_NAN:return stage.createError(304,
b.data.action+" value parameter is not a double.")}var h=this.apiCore.exec(this.callerName,"getCamera");if(h.controlMode!==stage.emersya.viewer.SCENE_CONTROL.FREEFLY&&h.controlMode!==stage.emersya.viewer.SCENE_CONTROL.PLANARFREEFLY)return stage.createError(313,"Only a free fly camera can be moved this way.");this.apiCore.exec(this.callerName,"moveCamera",b.data.value,0,0);return stage.createResult(1)},Ka=function(b){if(!this.iframeApi.isLoaded())return stage.createError(301,"Viewer needs to be loaded to move the camera.");
switch(this.iframeApi.checkDouble(b.data.value)){case this.iframeApi.errorTypes.DOUBLE_TYPE:case this.iframeApi.errorTypes.DOUBLE_NAN:return stage.createError(304,b.data.action+" value parameter is not a double.")}var h=this.apiCore.exec(this.callerName,"getCamera");if(h.controlMode!==stage.emersya.viewer.SCENE_CONTROL.FREEFLY&&h.controlMode!==stage.emersya.viewer.SCENE_CONTROL.PLANARFREEFLY)return stage.createError(313,"Only a free fly camera can be moved this way.");this.apiCore.exec(this.callerName,
"moveCamera",0,0,b.data.value);return stage.createResult(1)},wa=function(b){if(!this.iframeApi.isLoaded())return stage.createError(301,"Viewer needs to be loaded to move the camera.");switch(this.iframeApi.checkVec3(b.data.value)){case this.iframeApi.errorTypes.DOUBLE_TYPE:case this.iframeApi.errorTypes.DOUBLE_NAN:return stage.createError(304,b.data.action+" value parameter contains something else than a double.")}var h=this.apiCore.exec(this.callerName,"getCamera");if(h.controlMode!==stage.emersya.viewer.SCENE_CONTROL.FREEFLY&&
h.controlMode!==stage.emersya.viewer.SCENE_CONTROL.PLANARFREEFLY)return stage.createError(313,"Only a free fly camera can be moved this way.");this.apiCore.exec(this.callerName,"moveCamera",b.data.value[1],b.data.value[0],b.data.value[2]);return stage.createResult(1)},Ja=function(b){if(!this.iframeApi.isLoaded())return stage.createError(301,"Viewer needs to be loaded to translate the camera.");switch(this.iframeApi.checkDouble(b.data.value)){case this.iframeApi.errorTypes.DOUBLE_TYPE:case this.iframeApi.errorTypes.DOUBLE_NAN:return stage.createError(304,
b.data.action+" value parameter is not a double.")}var h=this.apiCore.exec(this.callerName,"getCamera");if(h.controlMode!==stage.emersya.viewer.SCENE_CONTROL.DOUBLEORBIT&&h.controlMode!==stage.emersya.viewer.SCENE_CONTROL.TRACKBALL)return stage.createError(313,"Only a turn table camera can be translated this way.");this.apiCore.exec(this.callerName,"translateCamera",b.data.value,0);return stage.createResult(1)},La=function(b){if(!this.iframeApi.isLoaded())return stage.createError(301,"Viewer needs to be loaded to translate the camera.");
switch(this.iframeApi.checkDouble(b.data.value)){case this.iframeApi.errorTypes.DOUBLE_TYPE:case this.iframeApi.errorTypes.DOUBLE_NAN:return stage.createError(304,b.data.action+" value parameter is not a double.")}var h=this.apiCore.exec(this.callerName,"getCamera");if(h.controlMode!==stage.emersya.viewer.SCENE_CONTROL.DOUBLEORBIT&&h.controlMode!==stage.emersya.viewer.SCENE_CONTROL.TRACKBALL)return stage.createError(313,"Only a turn table camera can be translated this way.");this.apiCore.exec(this.callerName,
"translateCamera",0,b.data.value);return stage.createResult(1)},ra=function(b){if(!this.iframeApi.isLoaded())return stage.createError(301,"Viewer needs to be loaded to translate the camera.");switch(this.iframeApi.checkVec2(b.data.value)){case this.iframeApi.errorTypes.DOUBLE_TYPE:case this.iframeApi.errorTypes.DOUBLE_NAN:return stage.createError(304,b.data.action+" value parameter contains something else than a double.")}var h=this.apiCore.exec(this.callerName,"getCamera");if(h.controlMode!==stage.emersya.viewer.SCENE_CONTROL.DOUBLEORBIT&&
h.controlMode!==stage.emersya.viewer.SCENE_CONTROL.TRACKBALL)return stage.createError(313,"Only a turn table camera can be translated this way.");this.apiCore.exec(this.callerName,"translateCamera",b.data.value[1],b.data.value[0]);return stage.createResult(1)},Sa=function(b){if(!this.iframeApi.isLoaded())return stage.createError(301,"Viewer needs to be loaded to set the play mode.");if(this.iframeApi.checkString(b.data.value)!==this.iframeApi.errorTypes.NONE)return stage.createError(304,b.data.action+
" value parameter is not a string.");this.apiCore.exec(this.callerName,"setViewerPlayMode",b.data.value);return stage.createResult(1)},Ya=function(b){if(this.iframeApi.checkString(b.data.color)!==this.iframeApi.errorTypes.NONE)return stage.createError(304,b.data.action+" color parameter is not a string.");this.apiCore.exec(this.callerName,"setBackgroundColor",b.data.color);return stage.createResult(1)},Ra=function(b){if(!this.iframeApi.isLoaded())return stage.createError(301,"Viewer needs to be loaded to set the mouse control mode.");
if(0!=b.data.value&&1!=b.data.value)return stage.createError(304,b.data.action+" value parameter is not 0 or 1.");this.apiCore.exec(this.callerName,"setMouseControlMode",parseInt(b.data.value));return stage.createResult(1)},ma=function(b){if(!this.iframeApi.isLoaded())return stage.createError(301,"Viewer needs to be loaded to set the cursor style.");if(this.iframeApi.checkString(b.data.value)!==this.iframeApi.errorTypes.NONE)return stage.createError(304,b.data.action+" value parameter is not a string.");
this.apiCore.exec(this.callerName,"setCursor",b.data.value);return stage.createResult(1)},bb=function(){this.apiCore.exec(this.callerName,"prph.toggleKeyboard");return stage.createResult(1)},gb=function(){this.apiCore.exec(this.callerName,"prph.toggleKeyboard",!0);return stage.createResult(1)},ib=function(){this.apiCore.exec(this.callerName,"prph.toggleKeyboard",!1);return stage.createResult(1)},hb=function(){this.apiCore.exec(this.callerName,"prph.toggleMouseButtons");return stage.createResult(1)},
fb=function(){this.apiCore.exec(this.callerName,"prph.toggleMouseButtons",!0);return stage.createResult(1)},Aa=function(){this.apiCore.exec(this.callerName,"prph.toggleMouseButtons",!1);return stage.createResult(1)},eb=function(){this.apiCore.exec(this.callerName,"prph.toggleMouseMove");return stage.createResult(1)},ab=function(){this.apiCore.exec(this.callerName,"prph.toggleMouseMove",!0);return stage.createResult(1)},Ma=function(){this.apiCore.exec(this.callerName,"prph.toggleMouseMove",!1);return stage.createResult(1)},
Ta=function(){this.apiCore.exec(this.callerName,"prph.toggleMouseWheel");return stage.createResult(1)},db=function(){this.apiCore.exec(this.callerName,"prph.toggleMouseWheel",!0);return stage.createResult(1)},Oa=function(){this.apiCore.exec(this.callerName,"prph.toggleMouseWheel",!1);return stage.createResult(1)},Qa=function(){this.apiCore.exec(this.callerName,"prph.toggleTouch");return stage.createResult(1)},N=function(){this.apiCore.exec(this.callerName,"prph.toggleTouch",!0);return stage.createResult(1)},
za=function(){this.apiCore.exec(this.callerName,"prph.toggleTouch",!1);return stage.createResult(1)},ca=function(b){if(!this.iframeApi.isLoaded())return stage.createError(302,"Viewer needs to be loaded to set the api as real time or not.",b);this.apiCore.exec(this.callerName,"setRealTimeAPI");return stage.createResult(1)},Ea=function(b){if(!this.iframeApi.isLoaded())return stage.createError(302,"Viewer needs to be loaded to set the api as real time or not.",b);this.apiCore.exec(this.callerName,"setRealTimeAPI",
!0);return stage.createResult(1)},Ca=function(b){if(!this.iframeApi.isLoaded())return stage.createError(302,"Viewer needs to be loaded to set the api as real time or not.",b);this.apiCore.exec(this.callerName,"setRealTimeAPI",!1);return stage.createResult(1)},Ua=function(b){if(!this.iframeApi.isLoaded())return stage.createError(302,"Viewer needs to be loaded to toggle mouse drag mode.",b);if(null!==b.data.button&&this.iframeApi.checkInteger(b.data.button)!==this.iframeApi.errorTypes.NONE)return stage.createError(304,
b.data.action+" settings button parameter is not an integer.");if(null!==b.data.button&&0!==b.data.button&&1!==b.data.button&&2!==b.data.button)return stage.createError(304,b.data.action+" settings button parameter is not a valid value (null|0|1|2 are valid values).");this.apiCore.exec(this.callerName,"setDragMouseButton",b.data.button);return stage.createResult(1)},sa=function(b){if(!this.iframeApi.isLoaded())return stage.createError(302,"Viewer needs to be loaded to toggle mouse tracking mode.",
b);this.apiCore.exec(this.callerName,"toggleMouseTrackingMode");return stage.createResult(1)},na=function(b){if(!this.iframeApi.isLoaded())return stage.createError(302,"Viewer needs to be loaded to toggle mouse tracking mode on.",b);this.apiCore.exec(this.callerName,"toggleMouseTrackingMode",!0);return stage.createResult(1)},kb=function(b){if(!this.iframeApi.isLoaded())return stage.createError(302,"Viewer needs to be loaded to toggle mouse tracking mode off.",b);this.apiCore.exec(this.callerName,
"toggleMouseTrackingMode",!1);return stage.createResult(1)},Da=function(b){this.sendKeyPressEvents=!this.sendKeyPressEvents;return stage.createResult(1)},xb=function(b){if(!this.iframeApi.isLoaded())return stage.createError(302,"Viewer needs to be loaded to toggle keyboard tracking mode on.",b);this.sendKeyPressEvents=!0;return stage.createResult(1)},Za=function(b){if(!this.iframeApi.isLoaded())return stage.createError(302,"Viewer needs to be loaded to toggle keyboard tracking mode off.",b);this.sendKeyPressEvents=
!1;return stage.createResult(1)},V=function(b,h){this.sendKeyPressEvents&&void 0!==h&&this.iframeApi.sendResponse({action:"onKeyPress",key:h.key,code:h.code})},O=function(b,h){this.sendKeyPressEvents&&void 0!==h&&this.iframeApi.sendResponse({action:"onKeyRelease",key:h.key,code:h.code})},ja=function(b){if(!this.iframeApi.isLoaded())return stage.createError(302,"Viewer needs to be loaded to toggle camera lock.",b);this.apiCore.exec(this.callerName,"toggleCameraLock");return stage.createResult(1)},
W=function(b){if(!this.iframeApi.isLoaded())return stage.createError(302,"Viewer needs to be loaded to unlock the camera.",b);this.apiCore.exec(this.callerName,"toggleCameraLock",!1);return stage.createResult(1)},pa=function(b){if(!this.iframeApi.isLoaded())return stage.createError(302,"Viewer needs to be loaded to lock camera.",b);this.apiCore.exec(this.callerName,"toggleCameraLock",!0);return stage.createResult(1)},Pa=function(b){if(!this.iframeApi.isLoaded())return stage.createError(302,"Viewer needs to be loaded to toggle the rulers.",
b);if(void 0!==b.data.settings){if("metric"!==b.data.settings.system&&"imperial"!==b.data.settings.system)return stage.createError(304,b.data.action+" settings system parameter is not an metric nor imperial.");if(this.iframeApi.checkDouble(b.data.settings.fraction)!==this.iframeApi.errorTypes.NONE)return stage.createError(304,b.data.action+" settings fraction parameter is not an double.");if(this.iframeApi.checkInteger(b.data.settings.decimals)!==this.iframeApi.errorTypes.NONE)return stage.createError(304,
b.data.action+" settings decimals parameter is not an integer.");if(this.iframeApi.checkInteger(b.data.settings.size)!==this.iframeApi.errorTypes.NONE)return stage.createError(304,b.data.action+" settings size parameter is not an integer.")}this.apiCore.exec(this.callerName,"rdr.toggleRulers",b.data.value,b.data.settings);return stage.createResult(1)},ha=function(b){if(!this.iframeApi.isLoaded())return stage.createError(302,"Viewer needs to be loaded to toggle the rendering.",b);var h=this.apiCore.exec(this.callerName,
"rdr.getCurrentScene");h&&void 0!==b.data.value&&b.data.keepCount?b.data.value?--h.stopDraw:++h.stopDraw:this.apiCore.exec(this.callerName,"rdr.toggleRendering",b.data.value);return stage.createResult(1)},ya=function(b){if(!this.iframeApi.isLoaded())return stage.createError(302,"Viewer needs to be loaded to freeze the rendering.",b);var h=this.apiCore.exec(this.callerName,"rdr.getCurrentScene");h&&b.data.keepCount?++h.stopDraw:this.apiCore.exec(this.callerName,"rdr.toggleRendering",!1);return stage.createResult(1)},
zb=function(b){if(!this.iframeApi.isLoaded())return stage.createError(302,"Viewer needs to be loaded to unfreeze the rendering.",b);var h=this.apiCore.exec(this.callerName,"rdr.getCurrentScene");h&&b.data.keepCount?--h.stopDraw:this.apiCore.exec(this.callerName,"rdr.toggleRendering",!0);return stage.createResult(1)},cb=function(b){if(!this.iframeApi.isLoaded())return stage.createError(302,"Viewer needs to be loaded to show this container.",b);this.apiCore.exec(this.callerName,"onScrollWithoutCtrl",
!0);return stage.createResult(1)},nc=function(b){if(!this.iframeApi.isLoaded())return stage.createError(302,"Viewer needs to be loaded to hide this container.",b);this.apiCore.exec(this.callerName,"hideScrollWithoutCtrlContainer",!0);return stage.createResult(1)},dc=function(b){if(!this.iframeApi.isLoaded())return stage.createError(302,"Viewer needs to be loaded to set view point.",b);if(this.iframeApi.checkString(b.data.name)!==this.iframeApi.errorTypes.NONE)return stage.createError(304,b.data.action+
" name parameter is not a string.");var h=0;if(b.data.transitionTime){switch(this.iframeApi.checkDouble(b.data.transitionTime)){case this.iframeApi.errorTypes.DOUBLE_TYPE:case this.iframeApi.errorTypes.DOUBLE_NAN:return stage.createError(304,b.data.action+" transitionTime parameter is not an integer.")}h=b.data.transitionTime}if(void 0!==b.data.reinitializeZoomLimits&&this.iframeApi.checkBool(b.data.reinitializeZoomLimits)===this.iframeApi.errorTypes.BOOLEAN_TYPE)return stage.createError(304,b.data.action+
" reinitializeZoomLimits parameter is not a boolean.");this.apiCore.exec(this.callerName,"setViewpoint",b.data.name,h,!1,b.data.unstoppable,b.data.reinitializeZoomLimits,stage.setContext(function(){this.iframeApi.sendResponse({id:b.data.id,action:"onEndCameraTransition"})},this));return stage.createResult(1)},Wb=function(b){if(!this.iframeApi.isLoaded())return stage.createError(302,"Viewer needs to be loaded to set view point.",b);var h=0;if(b.data.transitionTime){switch(this.iframeApi.checkDouble(b.data.transitionTime)){case this.iframeApi.errorTypes.DOUBLE_TYPE:case this.iframeApi.errorTypes.DOUBLE_NAN:return stage.createError(304,
"recenterViewpoint transitionTime parameter is not an integer.")}h=b.data.transitionTime}var d=.1;if(b.data.border){switch(this.iframeApi.checkDouble(b.data.border)){case this.iframeApi.errorTypes.DOUBLE_TYPE:case this.iframeApi.errorTypes.DOUBLE_NAN:return stage.createError(304,"recenterViewpoint border parameter is not a double.")}if(.45<=b.data.border)return stage.createError(304,"recenterViewpoint border parameter cannot be greater or equal to 0.45.");d=b.data.border}var e=[0,0,0];if(void 0!==
b.data.interpolation){switch(this.iframeApi.checkVec3(b.data.interpolation)){case this.iframeApi.errorTypes.DOUBLE_TYPE:case this.iframeApi.errorTypes.DOUBLE_NAN:return stage.createError(304,"recenterViewpoint interpolation parameter contains something else than a double.")}e=b.data.interpolation}var f=[];if(void 0!==b.data.nodeLocalIds){switch(this.iframeApi.checkArray(b.data.nodeLocalIds,"number",-1)){case this.iframeApi.errorTypes.ARRAY_TYPE:return stage.createError(304,b.data.action+" nodeLocalIds parameter is not an array.");
case this.iframeApi.errorTypes.ARRAY_CONTENT_TYPE:return stage.createError(304,b.data.action+" nodeLocalIds parameter contains something else than an integer in its array.")}f=b.data.nodeLocalIds}if(void 0!==b.data.reinitializeZoomLimits&&this.iframeApi.checkBool(b.data.reinitializeZoomLimits)===this.iframeApi.errorTypes.BOOLEAN_TYPE)return stage.createError(304,b.data.action+" reinitializeZoomLimits parameter is not a boolean.");this.apiCore.exec(this.callerName,"recenterViewpoint",d,e,h,!1,b.data.unstoppable,
f,b.data.reinitializeZoomLimits,stage.setContext(function(){this.iframeApi.sendResponse({id:b.data.id,action:"onEndCameraTransition"})},this));return stage.createResult(1)},Sb=function(b){if(!this.iframeApi.isLoaded())return stage.createError(302,"Viewer needs to be loaded to toggle AR QR code display.",b);this.apiCore.exec(this.callerName,"arUI.setARDefaultQRCodeStartingScreen");return stage.createResult(1)},ec=function(b){if(!this.iframeApi.isLoaded())return stage.createError(302,"Viewer needs to be loaded to enabled AR QR code display",
b);this.apiCore.exec(this.callerName,"arUI.setARDefaultQRCodeStartingScreen",!0);return stage.createResult(1)},Xb=function(b){if(!this.iframeApi.isLoaded())return stage.createError(302,"Viewer needs to be loaded to disable AR QR code display",b);this.apiCore.exec(this.callerName,"arUI.setARDefaultQRCodeStartingScreen",!1);return stage.createResult(1)};return d});stage.provide("emersya.viewer.modules.API.iframeColorSwitch");stage.require("emersya.viewer.modules.API.iframe");stage.require("emersya.viewer.modules.API.core");
stage.register.call(stage.emersya.viewer.modules.API,"iframeColorSwitch",function(){var b=function(b,U){this.iframeApi=U;this.apiCore=b;this.name="iframeColorSwitch";this.callerName="iframeAPI-ColorSwitchLvl";this.annotationsToAdd=[];this.iframeApi.register(this,"switchConfiguration",d);this.iframeApi.register(this,"applyPreset",u);this.iframeApi.register(this,"setPreset",k);this.iframeApi.register(this,"togglePresetsMenu",l);this.iframeApi.register(this,"openPresetsMenu",g);this.iframeApi.register(this,
"closePresetsMenu",q);this.iframeApi.register(this,"triggerAnimation",t);this.iframeApi.register(this,"resetAnimations",r);this.iframeApi.register(this,"setAnimationSpeed",f);this.iframeApi.register(this,"setTriggerColor",n);this.iframeApi.register(this,"setAnimationTriggerColor",n);this.iframeApi.register(this,"setAnimationTriggersColor",B);this.iframeApi.register(this,"setAnimationTriggerType",w);this.iframeApi.register(this,"setAnimationTriggersType",D);this.iframeApi.register(this,"hideTriggers",
A);this.iframeApi.register(this,"hideAnimationTriggers",A);this.iframeApi.register(this,"hideAnimationTrigger",E);this.iframeApi.register(this,"showTriggers",H);this.iframeApi.register(this,"showAnimationTriggers",H);this.iframeApi.register(this,"showAnimationTrigger",F);this.iframeApi.register(this,"toggleTriggers",e);this.iframeApi.register(this,"toggleAnimationTriggers",e);this.iframeApi.register(this,"toggleAnimationTrigger",p);this.iframeApi.register(this,"getCurrentAnimationStates",J);this.iframeApi.register(this,
"getAnimationsGraph",M);this.iframeApi.register(this,"updateAnnotationPin",h);this.iframeApi.register(this,"addAnnotationPin",v);this.iframeApi.register(this,"removeAnnotationPin",I);this.apiCore.register(this,"polylistSelection",m)};b.prototype.destroy=function(){};var d=function(b){if(!this.iframeApi.isLoaded()&&!this.iframeApi.isFallback())return stage.createError(302,"Viewer needs to be loaded to be configured.",b);if(this.iframeApi.checkString(b.data.category)!==this.iframeApi.errorTypes.NONE)return stage.createError(304,
b.data.action+" category parameter is not a string.");if(this.iframeApi.checkString(b.data.button)!==this.iframeApi.errorTypes.NONE)return stage.createError(304,b.data.action+" button parameter is not a string.");this.apiCore.exec(this.callerName,"switchConfigurationByName",b.data.category,b.data.button);return stage.createResult(null)},u=function(b){if(!this.iframeApi.isLoaded()&&!this.iframeApi.isFallback())return stage.createError(302,"Viewer needs to be loaded to be configured.",b);if(b.data.fake)this.apiCore.exec(this.callerName,
"presetApplied",b.data.presetName);else{if(void 0!==b.data.nodeLocalIds)switch(this.iframeApi.checkArray(b.data.nodeLocalIds,"number",-1)){case this.iframeApi.errorTypes.ARRAY_TYPE:return stage.createError(304,b.data.action+" nodeLocalIds parameter is not an array.");case this.iframeApi.errorTypes.ARRAY_CONTENT_TYPE:return stage.createError(304,b.data.action+" nodeLocalIds parameter contains something else than an integer in its array.")}else b.data.nodeLocalIds=[];var h=this.apiCore.exec(this.callerName,
"applyPreset",b.data.presetName,b.data.nodeLocalIds);if(stage.testResult(h))return h;this.iframeApi.registerTransaction(h.result,b.data.id,"applyPreset",312)}return stage.createResult(null)},k=function(b){if(!this.iframeApi.isLoaded()&&!this.iframeApi.isFallback())return stage.createError(302,"Viewer needs to be loaded to be configured.",b);if(b.data.fake)this.apiCore.exec(this.callerName,"presetApplied",b.data.presetName||b.data.presetSku);else{if(void 0!==b.data.nodeLocalIds)switch(this.iframeApi.checkArray(b.data.nodeLocalIds,
"number",-1)){case this.iframeApi.errorTypes.ARRAY_TYPE:return stage.createError(304,b.data.action+" nodeLocalIds parameter is not an array.");case this.iframeApi.errorTypes.ARRAY_CONTENT_TYPE:return stage.createError(304,b.data.action+" nodeLocalIds parameter contains something else than an integer in its array.")}else b.data.nodeLocalIds=[];if(!b.data.presetName&&!b.data.presetSku)return stage.createError(304,b.data.action+" require a presetName or a presetSku.");if(b.data.presetName&&""!=b.data.presetName&&
this.iframeApi.checkString(b.data.presetName)!==this.iframeApi.errorTypes.NONE)return stage.createError(304,b.data.action+" presetName parameter is not a string.");if(b.data.presetSku&&""!=b.data.presetSku&&this.iframeApi.checkString(b.data.presetSku)!==this.iframeApi.errorTypes.NONE)return stage.createError(304,b.data.action+" presetSku parameter is not a string.");var h=b.data.presetName;""==h&&(h=b.data.presetSku);h=this.apiCore.exec(this.callerName,"applyPreset",h,b.data.nodeLocalIds);if(stage.testResult(h))return h;
this.iframeApi.registerTransaction(h.result,b.data.id,"setPreset",312)}return stage.createResult(null)},l=function(){if(!this.iframeApi.isLoaded()&&!this.iframeApi.isFallback())return stage.createError(302,"Viewer needs to be loaded to toggle the preset container.",event);this.apiCore.exec(this.callerName,"togglePresetsMenu");return stage.createResult(null)},g=function(){if(!this.iframeApi.isLoaded()&&!this.iframeApi.isFallback())return stage.createError(302,"Viewer needs to be loaded to toggle the preset container.",
event);this.apiCore.exec(this.callerName,"togglePresetsMenu",!0);return stage.createResult(null)},q=function(){if(!this.iframeApi.isLoaded()&&!this.iframeApi.isFallback())return stage.createError(302,"Viewer needs to be loaded to toggle the preset container.",event);this.apiCore.exec(this.callerName,"togglePresetsMenu",!1);return stage.createResult(null)},t=function(b){if(!this.iframeApi.isLoaded())return stage.createError(302,"Viewer needs to be loaded to trigger an animation.",b);var h=this.apiCore.exec(this.callerName,
"rdr.getCurrentScene");if(!h)return stage.createError(302,"No scene to trigger an animation.",b);switch(this.iframeApi.checkDouble(b.data.triggerId)){case this.iframeApi.errorTypes.DOUBLE_TYPE:case this.iframeApi.errorTypes.DOUBLE_NAN:return stage.createError(304,b.data.action+" triggerId parameter is not an integer.")}h=this.apiCore.exec(this.callerName,"triggerAnimation",h,parseInt(b.data.triggerId),stage.emersya.viewer.ANIMATIONS_TRIGGERS.IFRAME);for(var d=[],e=0;e<h.length;++e)d.push({animationSet:h[e].setName,
animatingTo:h[e].animatingTo});this.iframeApi.sendResponse({id:b.data.id,action:"onSuccess",callAction:"triggerAnimation",animationsTriggered:d});return stage.createResult(null)},r=function(b){if(!this.iframeApi.isLoaded())return stage.createError(302,"Viewer needs to be loaded to reset an animation.",b);if(!this.apiCore.exec(this.callerName,"rdr.getCurrentScene"))return stage.createError(302,"No scene to reset animations.",b);this.apiCore.exec(this.callerName,"resetAnimations");return stage.createResult(1)},
f=function(b){if(!this.iframeApi.isLoaded())return stage.createError(302,"Viewer needs to be loaded to change animation speed.",b);if(!this.apiCore.exec(this.callerName,"rdr.getCurrentScene"))return stage.createError(302,"No scene to change animation speed.",b);switch(this.iframeApi.checkDouble(b.data.value)){case this.iframeApi.errorTypes.DOUBLE_TYPE:case this.iframeApi.errorTypes.DOUBLE_NAN:return stage.createError(304,b.data.action+" value parameter is not a float.")}if(0>parseFloat(b.data.value))return stage.createError(304,
b.data.action+" value parameter must be strictly positive.");this.apiCore.exec(this.callerName,"setAnimationSpeed",parseFloat(b.data.value));return stage.createResult(1)},n=function(b){if(!this.iframeApi.isLoaded())return stage.createError(302,"Viewer needs to be loaded to set trigger color.",b);if(b.data.color&&this.iframeApi.checkString(b.data.color))return stage.createError(304,b.data.action+" color parameter is not a string.");switch(this.iframeApi.checkDouble(b.data.triggerId)){case this.iframeApi.errorTypes.DOUBLE_TYPE:case this.iframeApi.errorTypes.DOUBLE_NAN:return stage.createError(304,
b.data.action+" id parameter is not an integer.")}this.apiCore.exec(this.callerName,"setTriggerColor",b.data.triggerId,b.data.color);return stage.createResult(1)},B=function(b){if(!this.iframeApi.isLoaded())return stage.createError(302,"Viewer needs to be loaded to set triggers color.",b);if(b.data.color&&this.iframeApi.checkString(b.data.color))return stage.createError(304,b.data.action+" color parameter is not a string.");this.apiCore.exec(this.callerName,"setTriggersColor",b.data.color);return stage.createResult(1)},
w=function(b){if(!this.iframeApi.isLoaded())return stage.createError(302,"Viewer needs to be loaded to set one trigger type.",b);if(!b.data.type||this.iframeApi.checkString(b.data.type))return stage.createError(304,b.data.action+" type parameter is not a string.");switch(b.data.type){case "cross":case "moving":case "movingNumber":case "movingTarget":case "numbered":case "plus":case "simple":case "simpleColored":case "target":case "pen":case "penLine":break;default:return stage.createError(304,b.data.action+
" type is not supported. Should be one of the following : cross, moving, movingNumber, movingTarget, numbered, plus, simple, simpleColored, target")}switch(this.iframeApi.checkDouble(b.data.triggerId)){case this.iframeApi.errorTypes.DOUBLE_TYPE:case this.iframeApi.errorTypes.DOUBLE_NAN:return stage.createError(304,b.data.action+" id parameter is not an integer.")}this.apiCore.exec(this.callerName,"setTriggerType",b.data.triggerId,b.data.type);return stage.createResult(1)},D=function(b){if(!this.iframeApi.isLoaded())return stage.createError(302,
"Viewer needs to be loaded to set all triggers type.",b);if(!b.data.type||this.iframeApi.checkString(b.data.type))return stage.createError(304,b.data.action+" type parameter is not a string.");switch(b.data.type){case "cross":case "moving":case "movingNumber":case "movingTarget":case "numbered":case "plus":case "simple":case "simpleColored":case "target":break;default:return stage.createError(304,b.data.action+" type is not supported. Should be one of the following : cross, moving, movingNumber, movingTarget, numbered, plus, simple, simpleColored, target")}this.apiCore.exec(this.callerName,
"setTriggersType",b.data.type);return stage.createResult(1)},A=function(b){if(!this.iframeApi.isLoaded())return stage.createError(302,"Viewer needs to be loaded to hide triggers.",b);this.apiCore.exec(this.callerName,"toggleAnnotations","triggers",!1);return stage.createResult(1)},H=function(b){if(!this.iframeApi.isLoaded())return stage.createError(302,"Viewer needs to be loaded to show triggers.",b);this.apiCore.exec(this.callerName,"toggleAnnotations","triggers",!0);return stage.createResult(1)},
e=function(b){if(!this.iframeApi.isLoaded())return stage.createError(302,"Viewer needs to be loaded to toggle triggers.",b);this.apiCore.exec(this.callerName,"toggleAnnotations","triggers");return stage.createResult(1)},E=function(b){if(!this.iframeApi.isLoaded())return stage.createError(302,"Viewer needs to be loaded to hide trigger.",b);switch(this.iframeApi.checkDouble(b.data.triggerId)){case this.iframeApi.errorTypes.DOUBLE_TYPE:case this.iframeApi.errorTypes.DOUBLE_NAN:return stage.createError(304,
b.data.action+" triggerId parameter is not an integer.")}this.apiCore.exec(this.callerName,"toggleAnnotations","triggers",!1,b.data.triggerId);return stage.createResult(1)},F=function(b){if(!this.iframeApi.isLoaded())return stage.createError(302,"Viewer needs to be loaded to show trigger.",b);switch(this.iframeApi.checkDouble(b.data.triggerId)){case this.iframeApi.errorTypes.DOUBLE_TYPE:case this.iframeApi.errorTypes.DOUBLE_NAN:return stage.createError(304,b.data.action+" triggerId parameter is not an integer.")}this.apiCore.exec(this.callerName,
"toggleAnnotations","triggers",!0,b.data.triggerId);return stage.createResult(1)},p=function(b){if(!this.iframeApi.isLoaded())return stage.createError(302,"Viewer needs to be loaded to toggle trigger.",b);switch(this.iframeApi.checkDouble(b.data.triggerId)){case this.iframeApi.errorTypes.DOUBLE_TYPE:case this.iframeApi.errorTypes.DOUBLE_NAN:return stage.createError(304,b.data.action+" triggerId parameter is not an integer.")}this.apiCore.exec(this.callerName,"toggleAnnotations","triggers",void 0,
b.data.triggerId);return stage.createResult(1)},m=function(b){if(b.length&&this.annotationsToAdd.length){var h=this.apiCore.exec(this.callerName,"rdr.getCurrentScene");if(h){h.annotations.push({id:this.annotationsToAdd[0].id,number:this.annotationsToAdd[0].number,title:this.annotationsToAdd[0].title,description:this.annotationsToAdd[0].description,html_description:this.annotationsToAdd[0].description,position:b[0].clickedPoint,source_node:b[0].node.id,nodeLocalId:b[0].node.localId,position_x:b[0].clickedPoint[0],
position_y:b[0].clickedPoint[1],position_z:b[0].clickedPoint[2],type:"annotation",point_of_view:null,waiting_duration:3E3});var d=this.annotationsToAdd[0].eventId,e=this.annotationsToAdd[0].number;this.annotationsToAdd.splice(0,1);this.apiCore.exec(this.callerName,"setAnnotationsTriggers",h.annotations,h.triggers);this.apiCore.exec(this.callerName,"toggleAnnotations","annotations");this.apiCore.exec(this.callerName,"toggleAnnotations","triggers");this.apiCore.exec(this.callerName,"toggleAnnotations",
"annotations");this.apiCore.exec(this.callerName,"toggleAnnotations","triggers");this.iframeApi.sendResponse({id:d,action:"onAnnotationPinAdded",number:e,position:{x:b[0].clickedPoint[0],y:b[0].clickedPoint[1],z:b[0].clickedPoint[2]},nodeId:b[0].node.id,nodeLocalId:b[0].node.localId,localId:b[0].node.localId})}}},h=function(b){if(!this.iframeApi.isLoaded())return stage.createError(302,"Viewer needs to be loaded to add an annotation.",b);switch(this.iframeApi.checkDouble(b.data.annotationId)){case this.iframeApi.errorTypes.DOUBLE_TYPE:case this.iframeApi.errorTypes.DOUBLE_NAN:return stage.createError(304,
b.data.action+" annotationId parameter is not an integer.")}if(""!=b.data.title&&this.iframeApi.checkString(b.data.title)!==this.iframeApi.errorTypes.NONE)return stage.createError(304,b.data.action+" title parameter is not a string.");if(""!=b.data.description&&this.iframeApi.checkString(b.data.description)!==this.iframeApi.errorTypes.NONE)return stage.createError(304,b.data.action+" description parameter is not a string.");var h=this.apiCore.exec(this.callerName,"rdr.getCurrentScene");if(h){var d=
!1,e;for(e in h.annotations)if(h.annotations[e].id==b.data.annotationId){h.annotations[e].title=b.data.title;h.annotations[e].description=b.data.description;d=!0;break}if(!d)return stage.createError(304,b.data.action+" pin not found.");this.apiCore.exec(this.callerName,"updateAnnotation",{id:b.data.annotationId,title:b.data.title,description:b.data.description});return stage.createResult(1)}},v=function(b){if(!this.iframeApi.isLoaded())return stage.createError(302,"Viewer needs to be loaded to add an annotation.",
b);if(void 0!==b.data.annotationId)switch(this.iframeApi.checkDouble(b.data.annotationId)){case this.iframeApi.errorTypes.DOUBLE_TYPE:case this.iframeApi.errorTypes.DOUBLE_NAN:return stage.createError(304,b.data.action+" annotationId parameter is not an integer.")}switch(this.iframeApi.checkDouble(b.data.number)){case this.iframeApi.errorTypes.DOUBLE_TYPE:case this.iframeApi.errorTypes.DOUBLE_NAN:return stage.createError(304,b.data.action+" number parameter is not an integer.")}if(""!=b.data.title&&
this.iframeApi.checkString(b.data.title)!==this.iframeApi.errorTypes.NONE)return stage.createError(304,b.data.action+" title parameter is not a string.");if(""!=b.data.description&&this.iframeApi.checkString(b.data.description)!==this.iframeApi.errorTypes.NONE)return stage.createError(304,b.data.action+" description parameter is not a string.");if(!b.data.onNextClick){switch(this.iframeApi.checkDouble(b.data.nodeId)){case this.iframeApi.errorTypes.DOUBLE_TYPE:case this.iframeApi.errorTypes.DOUBLE_NAN:return stage.createError(304,
b.data.action+" nodeId parameter is not an integer.")}switch(this.iframeApi.checkVec3(b.data.position)){case this.iframeApi.errorTypes.DOUBLE_TYPE:case this.iframeApi.errorTypes.DOUBLE_NAN:return stage.createError(304,b.data.action+" position parameter contains something else than a double.")}}var h=this.apiCore.exec(this.callerName,"rdr.getCurrentScene"),d=b.data.annotationId,e=!1;void 0===d&&(d=0,e=!0);for(var f in h.annotations)if(e&&(d=Math.max(h.annotations[f].id,d)),h.annotations[f].number==
b.data.number)return stage.createError(323,"addAnnotation number already used.");e&&++d;b.data.onNextClick?this.annotationsToAdd.push({eventId:b.data.id,id:d,number:b.data.number,title:b.data.title,description:b.data.description,html_description:b.data.description}):(h.annotations.push({id:d,number:b.data.number,title:b.data.title,description:b.data.description,html_description:b.data.description,position:b.data.position,position_x:b.data.position[0],position_y:b.data.position[1],position_z:b.data.position[2],
source_node:b.data.nodeId,nodeLocalId:b.data.localId,type:"annotation",point_of_view:null,waiting_duration:3E3}),this.apiCore.exec(this.callerName,"setAnnotationsTriggers",h.annotations,h.triggers),this.apiCore.exec(this.callerName,"toggleAnnotations","annotations"),this.apiCore.exec(this.callerName,"toggleAnnotations","triggers"),this.apiCore.exec(this.callerName,"toggleAnnotations","annotations"),this.apiCore.exec(this.callerName,"toggleAnnotations","triggers"));return stage.createResult(1)},I=
function(b){if(!this.iframeApi.isLoaded())return stage.createError(302,"Viewer needs to be loaded to remove an annotation.",b);var h=this.apiCore.exec(this.callerName,"rdr.getCurrentScene");if(void 0!==b.data.annotationId)switch(this.iframeApi.checkDouble(b.data.annotationId)){case this.iframeApi.errorTypes.DOUBLE_TYPE:case this.iframeApi.errorTypes.DOUBLE_NAN:return stage.createError(304,b.data.action+" annotationId parameter is not an integer.")}if(void 0!==b.data.number)switch(this.iframeApi.checkDouble(b.data.number)){case this.iframeApi.errorTypes.DOUBLE_TYPE:case this.iframeApi.errorTypes.DOUBLE_NAN:return stage.createError(304,
b.data.action+" number parameter is not an integer.")}if(void 0===b.data.number&&void 0===b.data.annotationId)return stage.createError(304,b.data.action+" number parameter is not an integer.");var d=-1,e;for(e in h.annotations)if(void 0!==b.data.number){if(h.annotations[e].number==b.data.number){d=e;break}}else if(h.annotations[e].id==b.data.annotationId){d=e;break}if(-1==d)return void 0!==b.data.number?stage.createError(324,"removeAnnotation number not found."):stage.createError(324,"removeAnnotation annotationId not found.");
h.annotations.splice(d,1);this.apiCore.exec(this.callerName,"setAnnotationsTriggers",h.annotations,h.triggers);this.apiCore.exec(this.callerName,"toggleAnnotations","annotations");this.apiCore.exec(this.callerName,"toggleAnnotations","triggers");this.apiCore.exec(this.callerName,"toggleAnnotations","annotations");this.apiCore.exec(this.callerName,"toggleAnnotations","triggers");return stage.createResult(1)},J=function(b){if(!this.iframeApi.isInitialized())return stage.createError(301,"Need to send a response to send the configuration.",
b);if(!this.iframeApi.isLoaded())return stage.createError(302,"Viewer needs to be loaded to get the configuration.",b);var h=this.apiCore.exec(this.callerName,"rdr.getCurrentScene");if(!h)return stage.createError(320,"Viewer was unloaded, no current configuration.",b);var d=[],e;for(e in h.viewerAnimations)d.push({set:h.viewerAnimations[e].setName,state:"ANIMATING"!==h.viewerAnimations[e].currentState?h.viewerAnimations[e].currentState:h.viewerAnimations[e].animatingTo});this.iframeApi.sendResponse({id:b.data.id,
action:"onCurrentAnimationStates",states:d});return stage.createResult(null)},M=function(b){if(!this.iframeApi.isInitialized())return stage.createError(301,"Need to send a response to send the configuration.",b);if(!this.iframeApi.isLoaded())return stage.createError(302,"Viewer needs to be loaded to get the configuration.",b);var h=this.apiCore.exec(this.callerName,"rdr.getCurrentScene");if(!h)return stage.createError(320,"Viewer was unloaded, no current configuration.",b);var d=[],e;for(e in h.viewerAnimations){var f=
h.viewerAnimations[e],m=[],v;for(v in f.states){var p=f.states[v],g=[],n;for(n in p.animations){var k=p.animations[n];g.push({triggerId:k.triggerId,state:k.finalState})}m.push({name:p.name,transitions:g})}d.push({name:f.setName,currentState:"ANIMATING"!==f.currentState?f.currentState:f.animatingTo,states:m})}this.iframeApi.sendResponse({id:b.data.id,action:"onGetAnimationsGraph",sets:d});return stage.createResult(null)};return b});stage.provide("emersya.viewer.modules.API.featureLevel1");stage.require("emersya.viewer.modules.API.core");
stage.register.call(stage.emersya.viewer.modules.API,"featureLevel1",function(){var b={gltf:0,usd:1,both:2},d={statisticId:-1,startingPreset:"",serverURL:"",routing:"",extensions:{},arRouting:""},u=function(b,A){this.settings=stage.extend(!0,{},d,b);this.apiCore=A;this.currentPreset=this.settings.startingPreset;this.callerName=this.name="featureLevel1";this.apiCore.register(this,"presetApplied",g);this.apiCore.register(this,"exportConfiguration",l,!0);this.apiCore.register(this,"getExportConfiguration",
k,!0);this.apiCore.register(this,"getExportConfigurationLevel1",k,!0);this.apiCore.register(this,"setStatId",q);this.apiCore.register(this,"setRouting",t);this.apiCore.register(this,"setArRouting",r);this.apiCore.register(this,"isExtensionLoaded",w,!0);this.apiCore.register(this,"getEmersyaArLink",f,!0);this.apiCore.register(this,"buildConfiguratedEmersyaArLink",B,!0);this.apiCore.register(this,"buildDefaultEmersyaArLink",n,!0)};u.prototype.destroy=function(){this.apiCore.unregister(this,"presetApplied");
this.apiCore.unregister(this,"exportConfiguration");this.apiCore.unregister(this,"getExportConfiguration");this.apiCore.unregister(this,"getExportConfigurationLevel1");this.apiCore.unregister(this,"setStatId");this.apiCore.unregister(this,"setRouting");this.apiCore.unregister(this,"setArRouting");this.apiCore.unregister(this,"isExtensionLoaded");this.apiCore.unregister(this,"getEmersyaArLink");this.apiCore.unregister(this,"buildConfiguratedEmersyaArLink");this.apiCore.unregister(this,"buildDefaultEmersyaArLink")};
var k=function(d,f,g){d=void 0===d?!1:d;f=void 0===f?!1:f;g=void 0===g?!1:g;var e="gltf",n=this.apiCore.exec(this.callerName,"getDevice");g?e=g:n.isMobile?n.isIos&&(e="usd"):e="both";g={p1:!1===f?void 0:f,p2:void 0,p5:void 0,p37:this.settings.statisticId,p38:this.settings.routing,p63:b[e],p64:!0};!1===f&&(this.currentPreset&&""!=this.currentPreset?g.p2=this.currentPreset:g.p5=!0);if(d)return g;d=new FormData;f=stage.json.stringify(g);d.append("settings",f);return d},l=function(b,d,f,e){e=void 0===
e?!0:e;var g=this.settings.serverURL+"/HHM682GXWW";f=this.apiCore.exec(this.callerName,"getExportConfiguration",!0,!1,void 0===f?!1:f);f.p64=e;e=new FormData;f=stage.json.stringify(f);e.append("settings",f);f=new XMLHttpRequest;f.open("POST",g,!0);f.onreadystatechange=stage.setContext(function(e,f){if(e.readyState===XMLHttpRequest.DONE){f={};if(200===e.status)try{f=stage.json.parse(e.responseText)}catch(m){f.resultSet=null}else f.resultSet=null;e=(e=f)&&e.resultSet?null!=e.resultSet.error?-1!==e.resultSet.error.indexOf("Error 501:")?
stage.createError(313,"Operation not supported."):stage.createError(314,"Error from the server."):stage.createResult(null):stage.createError(314,"There is no response from the server or it is empty.");if(stage.testResult(e))d(e.errors,null,"exportConfiguration");else switch(f=f.resultSet.data[0],f.p1){case 0:e=this.apiCore.exec(this.callerName,"getLocale");b(this.settings.serverURL+"/"+(e?e+"/":"")+this.settings.arRouting+"moveAround/"+f.p2,f.p3,f.p4);break;case 1:e=stage.createError(314,"Export cannot be generated");
d(e.errors,null,"exportConfiguration");break;case 2:e=stage.createError(314,"Viewer export task has crashed");d(e.errors,null,"exportConfiguration");break;default:e=stage.createError(314,"Error while generating the export"),d(e.errors,null,"exportConfiguration")}}},this,f);f.send(e)},g=function(b){this.currentPreset=b},q=function(b){this.settings.statisticId=b},t=function(b){this.settings.routing=b},r=function(b){this.settings.arRouting=b},f=function(b){var d=!1;this.currentPreset&&""!=this.currentPreset&&
(d=this.currentPreset);b(B.call(this,d))},n=function(){var b=this.apiCore.exec(this.callerName,"getLocale");return this.settings.serverURL+"/"+(b?b+"/":"")+this.settings.arRouting+this.settings.routing},B=function(b){b=void 0===b?!1:b;var d=n.call(this);b&&(d+="/"+b);return d},w=function(b){return this.settings.extensions[b]};return u});stage.provide("emersya.viewer.modules.API.featureLevel2");stage.require("emersya.viewer.modules.API.core");
stage.register.call(stage.emersya.viewer.modules.API,"featureLevel2",function(){var b={statisticId:-1,serverURL:"",routing:""},d=function(b,d){return b.mtId<d.mtId?-1:b.mtId>d.mtId?1:0},u=function(d,r){this.settings=stage.extend(!0,{},b,d);this.apiCore=r;this.presetApplied=!1;this.callerName=this.name="featureLevel2";this.apiCore.register(this,"setStatId",l);this.apiCore.register(this,"setRouting",g);this.apiCore.register(this,"presetApplied",q);this.apiCore.register(this,"onTransactionSuccess",t);
this.apiCore.register(this,"getSceneConfiguration",f,!0);this.apiCore.register(this,"generateJsonSceneConfiguration",n,!0);this.apiCore.register(this,"getExportConfiguration",k,!0);this.apiCore.register(this,"getExportConfigurationLevel2",k,!0);this.apiCore.register(this,"sendARConfiguration",w,!0);this.apiCore.register(this,"getEmersyaArLink",D,!0)};u.prototype.destroy=function(){this.apiCore.unregister(this,"setStatId");this.apiCore.unregister(this,"setRouting");this.apiCore.unregister(this,"presetApplied");
this.apiCore.unregister(this,"onTransactionSuccess");this.apiCore.unregister(this,"getSceneConfiguration");this.apiCore.unregister(this,"generateJsonSceneConfiguration");this.apiCore.unregister(this,"getExportConfiguration");this.apiCore.unregister(this,"getExportConfigurationLevel2");this.apiCore.unregister(this,"sendARConfiguration");this.apiCore.unregister(this,"getEmersyaArLink")};var k=function(b,d,e){b=void 0===b?!1:b;d=void 0===d?!1:d;e=void 0===e?!1:e;!1===d&&!this.presetApplied&&r.call(this)&&
(d=f.call(this,null),d=n.call(this,{data:{}},d,!0,!1));return this.apiCore.exec(this.callerName,"getExportConfigurationLevel1",b,d,e)},l=function(b){this.settings.statisticId=b},g=function(b){this.settings.routing=b},q=function(){this.presetApplied=!0},t=function(){this.presetApplied=!1},r=function(){var b=this.apiCore.exec(this.callerName,"rdr.getCurrentScene");if(!b)return!1;for(var d in b.viewerAnimations)if("INITIAL"!=("ANIMATING"!==b.viewerAnimations[d].currentState?b.viewerAnimations[d].currentState:
b.viewerAnimations[d].animatingTo))return!0;return!1},f=function(b){b={materialTrees:[],polylists:[],groups:[],customTexts:[],customTextures:[],texturesTransforms:[],texturesLayers:[],animationStates:[],customColors:{},metadata:b};var f=this.apiCore.exec(this.callerName,"rdr.getCurrentScene");if(f){for(var e in f.materialTrees)b.materialTrees.push({mtId:f.materialTrees[e].id,msId:f.materialTrees[e].currentMaterialId});b.materialTrees.sort(d);for(e in f.viewerAnimations)b.animationStates.push({set:f.viewerAnimations[e].setName,
state:"ANIMATING"!==f.viewerAnimations[e].currentState?f.viewerAnimations[e].currentState:f.viewerAnimations[e].animatingTo})}return b},n=function(b,d,e,f){data={p37:this.settings.statisticId,p38:this.settings.routing,p25:e,p27:f,p34:this.apiCore.exec(this.callerName,"getLocale"),p11:{p7:[],p5:[],p3:[],p6:[],p2:[],p4:[],p8:[],p1:[],p9:{},p10:[]}};if(void 0===b.data.resetAnimations||0==b.data.resetAnimations){for(var g in d.materialTrees)data.p11.p7.push({p1:d.materialTrees[g].mtId,p2:d.materialTrees[g].msId});
for(g in d.animationStates)data.p11.p1.push({p11:d.animationStates[g].set,p32:d.animationStates[g].state})}data.p11.p6=stage.json.stringify(data.p11.p6);data.p11.p4=stage.json.stringify(data.p11.p4);data.p11.p8=stage.json.stringify(data.p11.p8);data.p11.p1=stage.json.stringify(data.p11.p1);data.p11.p9=stage.json.stringify(data.p11.p9);return stage.json.stringify(data)},B=function(b,d,e){var f=stage.setContext(function(b){this.apiCore.exec(this.callerName,"stats.configurationSaved");b={code:b.code};
this.apiCore.exec(this.callerName,"setCurrentConfigurationCode",b.code);d(b)},this),g=this.apiCore.exec(this.callerName,"getSceneConfiguration",null),p=this.apiCore.exec(this.callerName,"generateJsonSceneConfiguration",{data:{}},g,!0,!1);this.apiCore.exec(this.callerName,"sendARConfiguration",g,p,b,f,e)},w=function(b,d,e,f,g){var p=new FormData;p.append("settings",d);b.metadata&&p.append("metadata",b.metadata);e&&p.append("p42",e);b=new XMLHttpRequest;b.open("POST",this.settings.serverURL+"/A9R9VDO5L6",
!0);b.onreadystatechange=stage.setContext(function(b,h){if(b.readyState===XMLHttpRequest.DONE){h={};if(200===b.status)try{h=stage.json.parse(b.responseText)}catch(v){h.resultSet=null}else h.resultSet=null;b=(b=h)&&b.resultSet?null!=b.resultSet.error?-1!==b.resultSet.error.indexOf("Error 501:")?stage.createError(313,"Operation not supported."):stage.createError(314,"Error from the server."):stage.createResult(null):stage.createError(314,"There is no response from the server or it is empty.");stage.testResult(b)?
g(b.errors,"saveConfiguration"):f(h.resultSet.data[0])}},this,b);b.send(p)},D=function(b){var d=stage.setContext(function(d){b(this.apiCore.exec(this.callerName,"buildConfiguratedEmersyaArLink",d.code))},this),e=stage.setContext(function(){b(this.apiCore.exec(this.callerName,"buildDefaultEmersyaArLink"))},this),f=this.apiCore.exec(this.callerName,"rdr.takeEncodedScreenshot",1024,1024,!0);B.call(this,f.result,d,e)};return u});
(function(){function b(b){var h={max:null,min:null,median:null,mean:null};if(0==b.length)return h;h.max=parseInt(Math.max.apply(Math,$jscomp.arrayFromIterable(b)));h.min=parseInt(Math.min.apply(Math,$jscomp.arrayFromIterable(b)));b=[].concat($jscomp.arrayFromIterable(b));b.sort(function(b,h){return b-h});var d=Math.floor(b.length/2);h.median=parseInt(1===b.length%2?b[d]:(b[d-1]+b[d])/2);h.mean=parseInt(b.reduce(function(b,h){return b+h})/b.length);return h}window.Statistics=function(b){this.settings=
b;if(""!==this.settings.statisticCode){this.creationTime=Date.now();this.deviceInfoSent=!1;this.stat={viewer_version:window.viewerVersion,code:this.settings.statisticCode,local_start_date:null,webgl_state:null,started_loading:!1,loaded:!1,time_before_loading_three_d:null,time_after_displaying_three_d_duration:null,time_before_starting_fallback:null,duration:null,played:!1,nb_rotation:0,nb_translation:0,nb_zoom_in:0,nb_zoom_out:0,nb_annotations_displays:0,nb_annotations_clicks:0,nb_animations_plays:0,
nb_animations_clicks:0,nb_presets_changes:0,nb_unique_presets_displays:0,nb_materials_changes:0,nb_customization_changes:0,user_experience:0,nb_screenshot:0,nb_highlight:0,nb_click_auto_rotate:0,mouse_over:0,nb_configurations_loaded:0,nb_configurations_saved:0,export:null};if(this.hasPreview=(b=document.getElementById("viewerPreviewImage"))&&b.naturalWidth)this.stat.user_experience=1,Y.call(this);this.loadedTime=null;this.currentlyLoadedData=this.notFocusedDuration=0;this.arActive=!1;this.updateInterval=
this.settings.updateInterval;this.firstInteraction=!0;this.interactions={rotation:!1,translation:!1,zoom_in:!1,zoom_out:!1};this.previousInteractionType="start";this.presetsApplied=[this.settings.startingPreset];this.statsServerUrl="https://sa8xYadvlkzaf.emersya.com/";this.onMouseMovePtr=stage.setContext(w,this);$$stage(document.body).listen("mousemove",this.onMouseMovePtr);$$stage(document.body).listen("onpointerdown",this.onMouseMovePtr);$$stage(document.body).listen("ontouchstart",this.onMouseMovePtr);
this.mouseMoveRegistered=!0;this.propagateStatIdFunction=stage.setContext(function(b,h){this.apiCore&&this.stat.id&&this.apiCore.exec(this.callerName,"setStatId",this.stat.id);this.stat.device&&(this.deviceInfoSent=!0,delete this.stat.device)},this);this.statHandlingFunctions={statsIgnoreNextInteractions:n,statsIgnoreNoMore:B,startAnnotationsAnimation:stage.setContext(f,this,"stats",1E3),stopAnnotationsAnimation:stage.setContext(f,this,"stats",1E3),startAutoRotate:stage.setContext(f,this,"stats",
1E3),stopAutoRotate:stage.setContext(f,this,"stats",1E3),stopAnimatingPath:stage.setContext(f,this,"stats",1E3),triggerAnimation:stage.setContext(f,this,"stats",1E3),onAnnotationPinClicked:stage.setContext(f,this,"stats",1E3),"ui.changeRotateIcon":stage.setContext(f,this,"stats",1E3),endTransaction:stage.setContext(f,this,"stats",1E3),startAnimatingPath:stage.setContext(f,this,"stats",1E3),switchConfiguration:stage.setContext(f,this,"stats",1E3),viewpointChanged:stage.setContext(f,this,"stats",1E3),
updateCustomColor:v,updateCustomColorByPolylist:v,updateCustomTexture:v,updateCustomTextureByPolylist:v,updateCustomText:v,updateCustomTexts:v,updateCustomTextOpenType:v,updateCustomTextsOpenType:v,updateCustomTextMaximized:v,"stats.screenshotTaken":I,"stats.highlight":J,"stats.configurationSaved":M,"stats.configurationLoaded":T,"ui.changePlayMode":U,startCameraInteraction:A,updateCameraInteraction:H,endCameraInteraction:e,launch3D:G,"ui.updateLoader":S,startRendering:ia,"3DRenderingConfirm":Q,viewerReady:F,
disable3D:ea,displayFallback:ta,fallbackReady:ua,getFocus:p,loseFocus:m,mouseLeave:h,onAnnotationPinOpenByManager:R,onAnnotationPinOpenByOver:aa,onAnnotationPinOpenByClick:aa,animationsTriggered:C,presetApplied:L,onTransactionSuccess:K,"c2dprdr.startRendering":oa,"c2dprdr.configurationApplied":ba,custom2DPatternUpdate:v,endPatternInteraction:v,arUserExperienceStarted:Z,stopAr:da,shareOnFacebook:X,shareOnTwitter:Ha,arDownload:Ga,takeArPicture:Fa,arSizeSelected:xa,arSizeSelectionDisplayed:Ia,arVideoStarted:qa,
arVideoStopped:Va,"stat.newArTranslation":va,"stat.newArRotation":la,arStartButtonClicked:fa,arVideoSettings:P,arErrorMessageDisplayed:Ba,deviceDetected:u,exporConfigurationGetFiles:l,onExportConfigurationGetFilesError:g,onCurrent3DModelExportDownloaded:q,onCurrent3DModelExportDownloadError:t};r.call(this)}};Statistics.prototype.destroy=function(){this.stat&&this.apiCore&&(this.now=Date.now(),this.focusLostTime&&p.call(this,"stats"),this.startInteractionTime&&this.apiCore.exec(this.callerName,"getCamera")&&
(e.call(this,"stats",this.apiCore.exec(this.callerName,"getCamera"),"n"),clearTimeout(this.updateInteractionsTimeout)),!this.loadedTime&&this.startLoadingTime&&void 0===this.stat.aborting_time&&(this.stat.aborting_time=this.now-this.startLoadingTime,this.stat.aborting_data=this.currentlyLoadedData),this.stat.closed=1,r.call(this,!0,!1),clearTimeout(this.updateTimeout),this.apiCore.eventsManager.clearEvents("onStatisticUpdate"),D.call(this),this.apiCore=wa=null)};Statistics.prototype.listenToAPI=function(b){this.stat&&
(this.apiCore=b,this.callerName="Statistics",this.apiCore.eventsManager.listen(this,"onStatisticUpdate",d),this.onListenAPI&&(this.onListenAPI(),delete this.onListenAPI))};var d=function(b,h,d){this.now=Date.now();this.statHandlingFunctions[h]&&this.statHandlingFunctions[h].apply(this,[b].concat(d))},u=function(b){if(!this.deviceInfoSent){var h=this.apiCore.exec(this.callerName,"getDevice"),d=null;h.motionEnabled&&(d|=8);h.orientationEnabled&&(d|=4);h.isMobile&&(d|=2);0<h.cameras.length&&(d|=1);b=
JSON.stringify({webgl2:h.webgl2,webgl:h.webgl,expWebgl:h["experimental-webgl"],userAgent:window.navigator.userAgent});this.stat.device={pixelRatio:h.pixelRatio,screenHeight:h.screenHeight,screenWidth:h.screenWidth,windowHeight:h.windowHeight,windowWidth:h.windowWidth,webglVersion:h.webgl2?h.webgl2.parameters.VERSION:h.webgl?h.webgl.parameters.VERSION:"UNKNOWN",webglInfos:b,arDetails:d,arCompatibility:h.arCompatible};this.deviceInfoSent=!0;r.call(this,!0)}},k=function(){this.stat.export||(this.stat.export=
{nbAskedExports:0,nbDownloadedExports:0,nbExportErrors:0,nbDownloadErrors:0,timeBeforeFirstExport:null,successfullDownloads:"",failedDownloads:"",failedExports:"",askedFormats:"",timesBetweenAskAndDownload:[],timesBetweenAskAndExportError:[],MAX_EXPORT_DATA_STR_LENGTH:70,MAX_FORMAT_DATA_STR_LENGTH:10})},l=function(b,h){k.call(this);this.stat.export.nbAskedExports++;this.stat.export.askedFormats.length+1<=this.stat.export.MAX_FORMAT_DATA_STR_LENGTH&&(this.stat.export.askedFormats+=h[0]);1==this.stat.export.nbAskedExports&&
this.loadedTime&&(this.stat.export.timeBeforeFirstExport=Date.now()-this.loadedTime);r.call(this,!0)},g=function(b,h,d){k.call(this);this.stat.export.nbExportErrors++;this.stat.export.timesBetweenAskAndExportError.push(d);b=d+h[0];this.stat.export.failedExports.length+b.length<=this.stat.export.MAX_EXPORT_DATA_STR_LENGTH&&(this.stat.export.failedExports+=b);r.call(this,!0)},q=function(b,h,d){k.call(this);this.stat.export.nbDownloadedExports++;this.stat.export.timesBetweenAskAndDownload.push(d);b=
d+h[0];this.stat.export.successfullDownloads.length+b.length<=this.stat.export.MAX_EXPORT_DATA_STR_LENGTH&&(this.stat.export.successfullDownloads+=b);r.call(this,!0)},t=function(b,h,d){k.call(this);this.stat.export.nbDownloadErrors++;b=d+h[0];this.stat.export.failedDownloads.length+b.length<=this.stat.export.MAX_EXPORT_DATA_STR_LENGTH&&(this.stat.export.failedDownloads+=b);r.call(this,!0)},r=function(b,h){this.now=Date.now();if(!b&&this.lastUpdate){if(this.now-this.lastUpdate<this.settings.minUpdateInterval){this.updateInterval=
this.stat.loaded?this.settings.updateAfterLoadedInterval:this.settings.updateInterval;clearTimeout(this.updateTimeout);this.updateTimeout=setTimeout(stage.setContext(r,this),this.settings.minUpdateInterval-(this.now-this.lastUpdate)+1);return}}else b&&(this.updateInterval=this.stat.loaded?this.settings.updateAfterLoadedInterval:this.settings.updateInterval);this.now-this.lastUpdate<this.updateInterval?clearTimeout(this.updateTimeout):this.lastUpdate&&this.updateInterval<=(this.stat.loaded?this.settings.updateAfterLoadedIntervalMaximum:
this.settings.updateIntervalMaximum)&&(this.updateInterval+=this.stat.loaded?this.settings.updateAfterLoadedIntervalIncrement:this.settings.updateIntervalIncrement);b&&void 0===this.stat.id?this.forceUpdateOnReceive=!0:(clearTimeout(this.updateTimeout),this.updateTimeout=setTimeout(stage.setContext(r,this),this.updateInterval),this.lastUpdate=this.now,this.stat.total_duration=this.now-this.creationTime,this.arActive&&(this.arSizeSelectionDisplayedTime&&(this.stat.ar.time_for_selecting_size+=this.now-
this.arSizeSelectionDisplayedTime,this.arSizeSelectionDisplayedTime=this.now),this.arVideoStartedTime?(this.stat.ar.time_in_video_mode+=this.now-this.arVideoStartedTime,this.arVideoStartedTime=this.now):this.arPictureTakenTime&&(this.stat.ar.time_in_photo_mode+=this.now-this.arPictureTakenTime,this.arPictureTakenTime=this.now),this.stat.ar.total_duration=this.stat.ar.time_in_photo_mode+this.stat.ar.time_in_video_mode+this.stat.ar.time_for_selecting_size),this.stat.id||(this.stat.viewer_language||
(this.stat.viewer_language=window.viewerLocale),this.stat.browser_lang||(this.stat.browser_lang=window.navigator.language),this.stat.local_start_date||(this.stat.local_start_date=new Date),this.stat.utc_diff||(this.stat.utc_diff=(new Date).getTimezoneOffset()),this.stat.webgl_state||(this.stat.webgl_state=window.glState)),this.loadedTime&&(this.disabledTime?this.stat.time_after_displaying_three_d_duration=this.now-this.disabledTime:(this.stat.time_after_displaying_three_d_duration=1==this.stat.closed?
0:null,this.stat.duration=this.now-this.loadedTime-this.notFocusedDuration)),b=stage.json.stringify({data:Ka(this.stat),ub:[],mp:[],va:[]}),h={async:void 0!==h&&!h&&(-1<window.navigator.userAgent.indexOf("Edge")||stage.browser.Ie)?!1:!0},window.FormData&&window.XMLHttpRequest)?(h=new FormData,h.append("settings",b),b=new XMLHttpRequest,this.stat.id?this.stat.id&&(b.onload=this.propagateStatIdFunction,b.open("POST",this.statsServerUrl+"XVBPTRLMPS/"+this.stat.id,!0)):(b.open("POST",this.statsServerUrl+
"XVBPTRLMPS/"+this.stat.code,!0),b.onload=stage.setContext(function(b,h){(b=stage.json.parse(b.responseText))&&b.resultSet&&b.resultSet.data&&b.resultSet.data.length&&0!=b.resultSet.data[0]&&(this.stat.id=b.resultSet.data[0],delete this.stat.code,delete this.stat.webgl_state,delete this.stat.local_start_date,delete this.stat.utc_diff,delete this.stat.viewer_language,delete this.stat.browser_lang,this.stat.device&&(this.deviceInfoSent=!0,delete this.stat.device),b=function(){this.apiCore.exec(this.callerName,
"setStatId",this.stat.id);this.forceUpdateOnReceive&&(this.forceUpdateOnReceive=!1,r.call(this,!0))},this.apiCore?b.call(this):this.onListenAPI=stage.setContext(b,this))},this,b)),b.send(h)):(b="settings="+b,this.stat.id)?this.stat.id&&(h.onLoad=this.propagateStatIdFunction,stage.ajax.post(this.statsServerUrl+"XVBPTRLMPS/"+this.stat.id,b,h)):(h.onLoad=stage.setContext(function(b,h){b.response.resultSet.data&&b.response.resultSet.data.length&&0!=b.response.resultSet.data[0]&&(this.stat.id=b.response.resultSet.data[0],
delete this.stat.code,delete this.stat.webgl_state,delete this.stat.local_start_date,delete this.stat.utc_diff,delete this.stat.viewer_language,delete this.stat.browser_lang,this.stat.device&&(this.deviceInfoSent=!0,delete this.stat.device),b=function(){this.apiCore.exec(this.callerName,"setStatId",this.stat.id);this.forceUpdateOnReceive&&(this.forceUpdateOnReceive=!1,r.call(this,!0))},this.apiCore?b.call(this):this.onListenAPI=stage.setContext(b,this))},this),stage.ajax.post(this.statsServerUrl+
"XVBPTRLMPS/"+this.stat.code,b,h))},f=function(b,h){null===this.ignoreFirstInteraction||0<--this.ignoreFirstInteraction||(b=!1,!this.ignoreFirstInteraction&&this.firstInteraction&&(this.loadedTime||this.fallbackLoadedTime)&&(this.lastInteractionTime=this.now,this.stat.played=!0,this.stat.time_before_starting_first_interaction=this.loadedTime?this.now-this.loadedTime:this.now-this.fallbackLoadedTime,this.firstInteraction=!1,b=!0),this.stat.played&&(this.stat.total_interacting_duration||(this.stat.total_interacting_duration=
0),void 0===h&&(h=1E3),h=Math.min(this.now-this.lastInteractionDate,h),this.arActive?this.stat.ar.total_interacting_duration+=h:this.stat.total_interacting_duration+=h,this.lastInteractionDate=this.now),this.updateInteractionsTimeout&&clearTimeout(this.updateInteractionsTimeout),this.updateInteractionsTimeout=setTimeout(stage.setContext(r,this,b),0))},n=function(b,h){this.ignoreFirstInteraction=h},B=function(){this.ignoreFirstInteraction=1},w=function(){this.stat.mouse_over=1;r.call(this,!0);D.call(this)},
D=function(){this.mouseMoveRegistered&&($$stage(document.body).unListen("mousemove",this.onMouseMovePtr),$$stage(document.body).unListen("onpointerdown",this.onMouseMovePtr),$$stage(document.body).unListen("onpointerdown",this.onMouseMovePtr),this.mouseMoveRegistered=!1)},A=function(b,h,d){f.call(this,"stats",0);this.startInteractionTime=this.now;this.interactions.rotation=!1;this.interactions.translation=!1;this.interactions.zoom_in=!1;this.interactions.zoom_out=!1;E.call(this,h,d)},H=function(b,
h,d){E.call(this,h,d)},e=function(b,h,d){f.call(this,"stats",this.now-this.startInteractionTime);this.stat.played&&(E.call(this,h,d),this.interactions.rotation?++this.stat.nb_rotation:"",this.interactions.translation?++this.stat.nb_translation:"",this.interactions.zoom_in?++this.stat.nb_zoom_in:"",this.interactions.zoom_out?++this.stat.nb_zoom_out:"");this.interactions.rotation=!1;this.interactions.translation=!1;this.interactions.zoom_in=!1;this.interactions.zoom_out=!1},E=function(b,h){this.interactions.rotation=
this.interactions.rotation||-1!==h.indexOf("r");this.interactions.translation=this.interactions.translation||-1!==h.indexOf("t");this.interactions.zoom_in=this.interactions.zoom_in||-1!==h.indexOf("i");this.interactions.zoom_out=this.interactions.zoom_out||-1!==h.indexOf("o");this.previousInteractionType=h;this.lastInteractionTime=this.now},F=function(b){if(this.hasPreview=(b=document.getElementById("viewerPreviewImage"))&&b.naturalWidth)this.stat.user_experience|=1,Y.call(this);r.call(this,!0)},
p=function(b){this.loadedTime&&this.focusLostTime&&(this.notFocusedDuration+=this.now-Math.max(this.focusLostTime,this.loadedTime),this.focusLostTime=null)},m=function(b){this.focusLostTime=this.now;r.call(this)},h=function(b){r.call(this)},v=function(b){"Watch"!==b&&(f.call(this,"stats",1E3),this.stat.played&&(this.arActive?++this.stat.ar.nb_customization_changes:++this.stat.nb_customization_changes))},I=function(b){f.call(this,"stats",1E3);this.stat.played&&++this.stat.nb_screenshot},J=function(b,
h,d,e){if(h.length||d.length||e.length)f.call(this,"stats",1E3),this.stat.played&&++this.stat.nb_highlight},M=function(b){f.call(this,"stats",1E3);this.stat.played&&++this.stat.nb_configurations_saved},T=function(b){f.call(this,"stats",1E3);this.stat.played&&++this.stat.nb_configurations_loaded},U=function(b){f.call(this,"stats",1E3);this.stat.played&&++this.stat.nb_click_auto_rotate},R=function(b){this.stat.played&&(this.arActive?++this.stat.ar.nb_annotations_displays:++this.stat.nb_annotations_displays)},
aa=function(b){f.call(this,"stats",1E3);this.stat.played&&(this.arActive?(++this.stat.ar.nb_annotations_displays,++this.stat.ar.nb_annotations_clicks):(++this.stat.nb_annotations_displays,++this.stat.nb_annotations_clicks))},C=function(b,h,d){if(this.stat.played)switch(d){case stage.emersya.viewer.ANIMATIONS_TRIGGERS.TRIGGER:this.arActive?++this.stat.ar.nb_animations_clicks:++this.stat.nb_animations_clicks;case stage.emersya.viewer.ANIMATIONS_TRIGGERS.IFRAME:this.arActive?++this.stat.ar.nb_animations_plays:
++this.stat.nb_animations_plays}},L=function(b,h){f.call(this,"stats",1E3);this.stat.played&&(this.arActive?++this.stat.ar.nb_presets_changes:++this.stat.nb_presets_changes,-1===this.presetsApplied.indexOf(h)&&(this.presetsApplied.push(h),this.arActive?++this.stat.ar.nb_unique_presets_displays:++this.stat.nb_unique_presets_displays))},K=function(b,h,d){d&&(f.call(this,"stats",1E3),this.stat.played&&(this.arActive?++this.stat.ar.nb_materials_changes:++this.stat.nb_materials_changes))},G=function(b){this.stat.started_loading||
(this.stat.started_loading=!0,this.stat.time_before_loading_three_d=this.now-this.creationTime,this.startLoadingTime=this.now,r.call(this,!0))},S=function(b,h,d){this.currentlyLoadedData=h},Y=function(){this.arActive?this.stat.ar.nb_unique_presets_displays||(this.stat.ar.nb_unique_presets_displays=1):this.stat.nb_unique_presets_displays||(this.stat.nb_unique_presets_displays=1)},ia=function(b){this.stat.loaded?(this.disabledTime=null,this.stat.closed=0,r.call(this)):(this.stat.loaded=!0,this.stat.duration=
0,this.stat.loading_duration=this.now-this.startLoadingTime,this.lastInteractionDate=this.loadedTime=this.now,this.stat.user_experience|=2,Y.call(this),r.call(this,!0))},Q=function(b,h){void 0===this.stat.framerate&&(this.stat.framerate=h,r.call(this,!0))},ta=function(){this.stat.time_before_starting_fallback=this.creationTime?this.now-this.creationTime:0;!this.loadedTime&&this.startLoadingTime&&void 0===this.stat.aborting_time&&(this.stat.aborting_time=this.now-this.startLoadingTime,this.stat.aborting_data=
this.currentlyLoadedData);r.call(this)},ua=function(b,h){switch(h){case stage.emersya.viewer.FALLBACK_TYPE.CONFIGURATOR:this.stat.user_experience&8||(this.stat.user_experience|=8,Y.call(this),this.fallbackLoadedTime=this.now,r.call(this,!0));break;case stage.emersya.viewer.FALLBACK_TYPE.VIEWER:this.stat.user_experience&4||(this.stat.user_experience|=4,Y.call(this),this.fallbackLoadedTime=this.now,r.call(this,!0));break;case stage.emersya.viewer.FALLBACK_TYPE.PREVIEW:!(this.hasPreview=(b=document.getElementById("viewerPreviewImage"))&&
b.naturalWidth)||this.stat.user_experience&1||(this.stat.user_experience|=1,Y.call(this),r.call(this,!0))}},ea=function(){this.disabledTime=this.now;this.stat.closed=2;r.call(this,!0)},oa=function(){this.loadedTime=this.now;this.stat.started_loading=!0;this.stat.loaded=!0;this.stat.duration=0;this.stat.loading_duration=this.now-this.creationTime;this.stat.time_before_loading_three_d=1;this.stat.user_experience|=16;Y.call(this);r.call(this,!0)},ba=function(){f.call(this,"stats",1E3);this.stat.played&&
(this.arActive?++this.stat.ar.nb_materials_changes:++this.stat.nb_materials_changes)},ka=function(){this.stat.ar||(this.stat.ar={time_before_starting_ar:this.now-this.creationTime,time_for_selecting_size:null,time_in_video_mode:null,time_in_photo_mode:null,total_duration:null,nb_start:0,nb_rotation:0,nb_translation:0,nb_annotations_displays:0,nb_annotations_clicks:0,nb_animations_plays:0,nb_animations_clicks:0,nb_presets_changes:0,nb_unique_presets_displays:0,nb_materials_changes:0,nb_customization_changes:0,
nb_facebook_share:0,nb_twitter_share:0,nb_download:0,nb_photo_taken:0,user_size:0,video_framerate:0,video_width:0,video_height:0,error:"",total_interacting_duration:0})},Z=function(b){this.arActive=!0;this.stat.user_experience|=32;ka.call(this);r.call(this,!0)},da=function(b){this.arActive=!1;xa.call(this);this.arPictureTakenTime&&(this.stat.ar.time_in_photo_mode+=Date.now()-this.arPictureTakenTime,this.arPictureTakenTime=null);r.call(this,!0)},X=function(){++this.stat.ar.nb_facebook_share;r.call(this,
!0)},Ha=function(){++this.stat.ar.nb_twitter_share;r.call(this,!0)},Ga=function(){++this.stat.ar.nb_download;r.call(this,!0)},Fa=function(){this.arPictureTakenTime=Date.now();++this.stat.ar.nb_photo_taken;r.call(this,!0)},xa=function(b,h){ka.call(this);this.arSizeSelectionDisplayedTime&&(this.stat.ar.time_for_selecting_size+=Date.now()-this.arSizeSelectionDisplayedTime,this.stat.ar.user_size=h,this.arSizeSelectionDisplayedTime=null);r.call(this,!0)},Ia=function(){this.arSizeSelectionDisplayedTime=
Date.now()},qa=function(){this.arVideoStartedTime=Date.now();this.arPictureTakenTime&&(this.stat.ar.time_in_photo_mode+=Date.now()-this.arPictureTakenTime,this.arPictureTakenTime=null);r.call(this,!0)},Va=function(){this.arVideoStartedTime&&(this.stat.ar.time_in_video_mode+=Date.now()-this.arVideoStartedTime,this.arVideoStartedTime=null);r.call(this,!0)},va=function(){this.arActive&&++this.stat.ar.nb_translation},la=function(){this.arActive&&++this.stat.ar.nb_rotation},fa=function(){this.arActive&&
(++this.stat.ar.nb_start,r.call(this,!0))},P=function(b,h){this.arActive&&(this.stat.ar.video_framerate=h.frameRate,this.stat.ar.video_width=h.width,this.stat.ar.video_height=h.height,r.call(this,!0))},Ba=function(b,h){this.arActive&&(this.stat.ar.error=""==this.stat.ar.error?this.stat.ar.error+h:this.stat.ar.error+(","+h),r.call(this,!0))},Ka=function(h){var d={a1:h.id?h.id:h.code,a3:h.duration,a4:h.played,a5:h.started_loading,a6:h.nb_rotation,a7:h.nb_translation,a8:h.nb_zoom_in,a9:h.nb_zoom_out,
a10:h.loaded,a11:h.webgl_state,a12:h.browser_lang,a13:h.utc_diff,a14:h.local_start_date,a15:h.time_before_starting_first_interaction,a16:h.total_interacting_duration,a17:h.aborting_time,a18:h.aborting_data,a19:h.time_before_loading_three_d,a20:h.time_after_displaying_three_d_duration,a21:h.loading_duration,a22:h.total_duration,a23:h.framerate,a24:h.nb_annotations_displays,a25:h.nb_annotations_clicks,a26:h.nb_animations_plays,a27:h.nb_animations_clicks,a28:h.nb_presets_changes,a29:h.nb_materials_changes,
a30:h.nb_customization_changes,a31:h.viewer_language,a32:h.nb_unique_presets_displays,a33:h.time_before_starting_fallback,a34:h.user_experience,a35:h.closed,a36:h.viewer_version,a37:h.nb_screenshot,a38:h.nb_highlight,a39:h.nb_click_auto_rotate,a40:h.mouse_over,a41:h.nb_configurations_loaded,a42:h.nb_configurations_saved};h.ar&&(d.a43=h.ar,d.a44=h.ar.time_before_starting_ar,d.a45=h.ar.time_for_selecting_size,d.a46=h.ar.time_in_video_mode,d.a47=h.ar.time_in_photo_mode,d.a48=h.ar.total_duration,d.a49=
h.ar.nb_rotation,d.a50=h.ar.nb_translation,d.a51=h.ar.nb_annotations_displays,d.a52=h.ar.nb_annotations_clicks,d.a53=h.ar.nb_animations_plays,d.a54=h.ar.nb_animations_clicks,d.a55=h.ar.nb_presets_changes,d.a56=h.ar.nb_unique_presets_displays,d.a57=h.ar.nb_materials_changes,d.a58=h.ar.nb_customization_changes,d.a59=h.ar.nb_facebook_share,d.a60=h.ar.nb_twitter_share,d.a61=h.ar.nb_download,d.a62=h.ar.nb_photo_taken,d.a63=h.ar.user_size,d.a73=h.ar.nb_start,d.a74=h.ar.video_framerate,d.a75=h.ar.video_width,
d.a76=h.ar.video_height,d.a77=h.ar.error,d.a79=h.ar.total_interacting_duration);h.device&&(d.a64=h.device,d.a65=h.device.pixelRatio,d.a66=h.device.screenHeight,d.a67=h.device.screenWidth,d.a68=h.device.windowHeight,d.a69=h.device.windowWidth,d.a70=h.device.webglVersion,d.a71=h.device.webglInfos,d.a72=h.device.arCompatibility,d.a78=h.device.arDetails);if(h.export){d.a80=h.export.nbAskedExports;d.a81=h.export.nbDownloadedExports;d.a82=h.export.nbExportErrors;d.a83=h.export.nbDownloadErrors;d.a84=h.export.timeBeforeFirstExport;
0<h.export.successfullDownloads.length&&(d.a85=h.export.successfullDownloads);0<h.export.failedDownloads.length&&(d.a86=h.export.failedDownloads);0<h.export.failedExports.length&&(d.a87=h.export.failedExports);0<h.export.askedFormats.length&&(d.a88=h.export.askedFormats);if(0<h.export.timesBetweenAskAndDownload.length){var e=b(h.export.timesBetweenAskAndDownload);d.a89=e.max;d.a90=e.min;d.a91=e.median;d.a92=e.mean}0<h.export.timesBetweenAskAndExportError.length&&(h=b(h.export.timesBetweenAskAndExportError),
d.a93=h.max,d.a94=h.min,d.a95=h.median,d.a96=h.mean)}return d},wa=null;window.viewerStatistics=function(){wa||(wa=new Statistics({minUpdateInterval:6E3,updateInterval:6E3,updateIntervalMaximum:6E4,updateIntervalIncrement:4E3,updateAfterLoadedInterval:1E4,updateAfterLoadedIntervalMaximum:6E4,updateAfterLoadedIntervalIncrement:6E3,startingPreset:window.viewerStartingPreset,statisticCode:window.viewerStatCode}));return wa};wa=window.viewerStatistics()})();stage.provide("emersya.viewer.modules.scene");
stage.register.call(stage.emersya.viewer.modules,"scene",function(){var b=function(b,d,e,f){this.apiCore=b;this.callerName=this.name="Scene";this.epsilon=.001;this.materialsType=null;this.loadedToGl=this.loaded=!1;this.loadedCallback=void 0!==f?f:null;this.needsUpdate=0;this.projectConfigurationPath=this.projectDefaultGraphPath="";this.stopDraw=0;this.visibilityChanged=!1;this.maxTextureUnits=0;this.requiredUvsrc=-1;this.isSimpleModel=!1;this.configurator={};this.annotations=[];this.triggers=[];this.materialTreesGroups=
{};this.materialTreesGroupsConfigurations={};this.scenery={};this.wearableAR=this.watch=null;this.customTexts=[];this.customTextures={};this.customPolylistInstancesTexts={};this.customPolylistInstancesTextures={};this.customColors={};this.texturesTransforms={};this.texturesLayers={};this.animationStatesToLoad={};this.tonemapping={disabled:!1,type:0,multiplier:1,maxLuminance:1};this.lights={ambient:{color:[1,1,1],intensity:1},globalLightCorrection:1,globalEnvironmentCorrection:1,directionals:[],directionalIds:{},
spots:[],spotIds:{},hemisphericals:[],hemisphericalIds:{},points:[],pointIds:{},hasSomeDirShadow:0,hasSomeSpotShadow:0,hasSomeAutoAdjustShadow:0,IBL:null};this.materials={};this.newMaterialsToLoad={};this.newMaterialsLoaded={};this.materialsContent={lightMap:{},refraction:{},specularAnisotropic:{},shininess:{},reflection:{},glow:{},iridescent:{},specular:{},diffuse:{},ambient:{},localEnvironment:{},occlusion:{},coating:{},metalness:{},roughness:{},iridescence:{},albedo:{},translucency:{},opacity:{},
normalDeformation:{},emissive:{},materialSettings:{},materialSettingsByName:{}};this.mirrors=[];this.waters=[];this.viewPoints=[];this.sourceNodes={};this.sourceNodesByFullId={};this.productNodes={};this.productNodesBySKU={};this.productNodesByProjectAndSKU={};this.productNodeInstancesByLocalId={};this.geometries={};this.polylists={};this.materialTrees={};this.materialsAnimations={};this.originalTextures={};this.textures={};this.texturesCube={};this.srcImages={};this.realImages={};this.furMap=0;this.furMapResolution=
512;this.nodesInUse=[];this.hasSomeCarpaint=this.needFurMap=this.hasSomeFur=this.hasSomeBlur=this.hasSomeSpecularGlow=this.hasSomeGlow=this.updatedLights=!1;this.hasSomePolylistTags=this.hasSomeShadow=0;this.opacityBlurs=[];this.polylistInstances=[];this.arExcludedPolylists=[];this.rootUpScale=this.root=null;this.measurementFactor=1;this.uvsrcs=[];this.uvsrcsIndex={};this.maxUvsInUse=0;this.useRealMeasurements=!1;this.updateMaterialsFunction=[];this.renderingPasses=[];this.maxRenderingPass=0;this.materialsSortedByShaderType=
[];this.occluders=[];this.boundingBoxesToRender=[];this.renderingSettings={blurSupported:!0,furSupported:!0,screenSpaceRefract:!1,screenSpaceRoughness:!0};this.dfglut=d;this.dfglutCookTorrance=null;this.environmentTextures=[];this.setDefaultLights=e;this.camera={screenOffset:{x:0,y:0}};this.highlight={color:[1,1,1,.2],borderColor:[0,0,0,0],blendingMode:1,mode:0,showSilhouettes:!1};this.placeholdersProductNodeInstances=[];stage.emersya.viewer.modules.renderer.texturesManager?(b={onWebGlError:stage.setContext(function(b){this.apiCore.exec(this.callerName,
"renderingError",b.errors)},this)},this.texturesManager=new stage.emersya.viewer.modules.renderer.texturesManager(this.apiCore,this,b)):this.texturesManager=null;this.viewerAnimations=[];this.manualViewerAnimations={};this.productNodesInstancesLocalIds=this.graphIds=this.minDistanceBBox=0;this.__allData={};this.__registeredIds={}};b.prototype.destroy=function(){this.baseTypedShader&&delete this.baseTypedShader;var b=[].concat($jscomp.arrayFromIterable(this.polylistInstances)),d;for(d in b)D.call(this,
b[d]);for(var e in this.geometries)b=this.geometries[e],b.dataBuffers=null,b.polylists=null;this.geometries=null;for(var f in this.polylists){e=this.polylists[f];e.geometry=null;e.materialTree=null;e.customMaterialValues=null;if(e.list){for(b=0;b<e.list.length;++b)e.list[b]=null;e.list=null}e.instances=null}this.polylists=null;for(var m in this.sourceNodes)f=this.sourceNodes[m],f.polylists=null,f.children=null,f.parent=null,f.duplicatedNodes=null;for(var g in this.productNodes)m=this.productNodes[g],
m.duplicatedNodes=null,m.sourceNode=null,m.sourceModel=null,m.originalSourceModel=null;this.sourceModels=this.productNodesByProjectAndSKU=this.productNodeInstancesByLocalId=this.nodesInUse=this.productNodesBySKU=this.productNodes=this.sourceNodes=null;for(var p in this.materialTrees)g=this.materialTrees[p],g.polylistInstances=null,g.materialSettings=null,g.materialsSettingsByName=null;for(var n in this.textureLayers)p=this.textureLayers[n],p.layer=null,p.image=null;for(var k in this.materials)this.materials[k].materialTree=
null,this.materials[k].polylists=null,this.materials[k].onerror=null,this.materials[k].onload=null;this.scenery=this.environmentTextures=this.srcImages=this.srcImgs=this.dfglut=this.gl=this.materialTrees=this.materialsContent=this.materialSettings=this.materials=this.textures=this.sourceImages=this.originalTextures=this.imagesRGBA=this.annotations=null;for(var l in this.__allData)this.__allData[l]=null;this.__registeredIds=this.__allData=null;this.texturesManager&&(this.texturesManager.destroy(),
this.texturesManager=null);this.apiCore=null};var d={Geometry:"geometries",Polylist:"polylists",SourceNode:"sourceNodes",ProductNode:"productNodes",SourceModel:"sourceModels",MaterialTree:"materialTrees",MaterialSettings:"materialSettings",Material:"materials",LightMap:"lightMap",Opacity:"opacity",Refraction:"refraction",Translucency:"translucency",SpecularAnisotropic:"specularAnisotropic",NormalDeformation:"normalDeformation",Shininess:"shininess",Reflection:"reflection",Emissive:"emissive",Glow:"glow",
Iridescent:"iridescent",Specular:"specular",Diffuse:"diffuse",Ambient:"ambient",PbrLocalEnvironment:"pbrLocalEnvironments",PbrOcclusion:"pbrOcclusions",PbrTranslucency:"pbrTranslucencys",PbrOpacity:"pbrOpacitys",PbrCoating:"pbrCoatings",PbrNormalDeformation:"pbrNormalDeformations",PbrMetalness:"pbrMetalnesses",PbrRoughness:"pbrRoughnesses",PbrIridescence:"pbrIridescences",PbrEmissive:"pbrEmissives",PbrAlbedo:"pbrAlbedos",SourceImage:"sourceImages",ImageRGBA:"imagesRGBA",Layer:"textureLayers",Texture:"originalTextures",
TextureCube:"originalTexturesCube",MaterialTreesGroup:"materialTreesGroups",MaterialTreesGroupConfiguration:"materialTreesGroupsConfigurations",Mirror:"mirrosById",Water:"watersById"},u=function(b){return d[b]||b};b.prototype.setParent=function(b,d){this.currentGlobalId=b+"-"+d;this.__allData[b]||(this.__allData[b]={});this.__allData[b][d]||(this.__allData[b][d]={id:d});this.currentGlobalData=this.__allData[b][d]};b.prototype.setParentFromInstance=function(b){b=b.__globalId.split("-");this.setParent(b[0],
b[1])};b.prototype.getCurrentParentTypeAndId=function(){if(!this.currentGlobalId)return null;var b=this.currentGlobalId.split("-");return{type:b[0],id:b[1]}};b.prototype.getParentData=function(b,d){return this.__allData[b]&&this.__allData[b][d]?this.__allData[b][d]:null};b.prototype.getParentIdAndTypeFromInstance=function(b){b=b.__globalId.split("-");return{type:b[0],id:b[1]}};b.prototype.getOriginalIdFromInstance=function(b){return b.__localId};b.prototype.register=function(b,d){d.__localId=d.id;
d.__globalId=this.currentGlobalId;var h=u(b);this.currentGlobalData[h]||(this.currentGlobalData[h]={});this.currentGlobalData[h][d.id]=d;this.__registeredIds[b]||(this.__registeredIds[b]=0);this[h]||(this[h]={});this[h][d.id]&&(d.id=this.__registeredIds[b]+1);this[h][d.id]=d;this.__registeredIds[b]=Math.max(this.__registeredIds[b],d.id);return d};b.prototype.unregister=function(b,d){b=u(b);delete this.currentGlobalData[b][this.getOriginalIdFromInstance(d)];delete this[b][d.id]};b.prototype.get=function(b,
d){b=u(b);return this.currentGlobalData[b]?this.currentGlobalData[b][d]:null};b.prototype.getGlobal=function(b,d){b=u(b);return this[b]&&this[b][d]?this[b][d]:null};b.prototype.getAll=function(b){b=u(b);return this.currentGlobalData[b]?this.currentGlobalData[b]:{}};b.prototype.getAllGlobal=function(b){b=u(b);return this[b]?this[b]:{}};b.prototype.getFromParent=function(b,d,e,f){e=u(e);return this.__allData[b]&&this.__allData[b][d]&&this.__allData[b][d][e]?this.__allData[b][d][e][f]:null};b.prototype.getAllFromParent=
function(b,d,e){e=u(e);return this.__allData[b]&&this.__allData[b][d]&&this.__allData[b][d][e]?this.__allData[b][d][e]:{}};b.prototype.getAllFromCurrentParent=function(b){b=u(b);return this.currentGlobalData[b]?this.currentGlobalData[b]:{}};b.prototype.getFromInstanceParent=function(b,d,e){b=b.__globalId.split("-");return this.getFromParent(b[0],b[1],d,e)};b.prototype.getAllFromInstanceParent=function(b,d){b=b.__globalId.split("-");return this.getAllFromParent(b[0],b[1],d)};b.prototype.loadMaterials=
function(){if(stage.emersya.viewer.modules.renderer.animations)for(var b=0;b<this.polylistInstances.length;++b){var d=this.polylistInstances[b];d.matAnim?d.matAnim.resetMaterial(this.materials[d.currentMaterialId]):d.matAnim=new stage.emersya.viewer.modules.renderer.animations.matAnimManager(this,this.materials[d.currentMaterialId],d)}};b.prototype.unloadMaterials=function(){for(var b=0;b<this.polylistInstances.length;++b){var d=this.polylistInstances[b];d.matAnim&&(d.matAnim.destroy(),delete d.matAnim)}};
var k=function(b,d,e,f,m){this.id=b;this.node=d;this.materialTree=e;this.polylist=f;this.currentMaterialId=m;this.highlighted=!1;this.customMaterial={};this.realMeasurementScalingFactors=null;this.renderTimeQueries=[];this.fadeOut=null;this.isHidden=function(){return!1};this.notDraggable=this.draggable=this.hidden=this.isGhost=!1;this.uvIndexToId=[];this.glInstancedCount=1;this.deallocateFunctions=[]};b.prototype.createPolylistInstance=function(b,d){d=new k(b.id+"-"+d.fullId,d,b.materialTree,b,b.materialTree.currentMaterialId);
stage.emersya.viewer.modules.renderer.animations&&(d.matAnim=new stage.emersya.viewer.modules.renderer.animations.matAnimManager(this,this.materials[b.materialTree.currentMaterialId],d));d.isHidden=stage.setContext(function(){return this.hidden||this.materialTree.isHidden||this.polylist.isHidden||0==this.node.opacity||(this.matAnim?this.matAnim.isInvisible():!1)},d);b.instances.push(d);b.materialTree.polylistInstances.push(d);b.materialTree.polylistMinId=Math.min(b.materialTree.polylistMinId,b.id);
this.polylistInstances.push(d);return d};var l=function(b,d,e,f){this.type=0;this.id=b.id;this.localId=d;this.fullId=d+"-"+b.id;this.name=b.name;this.sku=b.sku;this.productNode=b;this.matrix=e;this.sourceNodeTracked=this.tracked=this.isPlaceholder=!1;this.materials=this.polylists=null;this.children=[];this.sourceModel=b.sourceModel;this.draggable=this.selected=!1;this.parent=f;this.explosionVector=vec3.create([0,0,0]);this.explodable=!0;this.opacity=1;this.matricesList=[];this.position=vec3.create();
this.backupPosition=vec3.create();this.backupPosition2=vec3.create();this.rotationAxis=vec3.create();this.rotationAngle=0;this.scaling=vec3.create([1,1,1]);this.floorOffset=0};b.prototype.createProductNodeInstance=function(b,d,f,m){this.productNodesInstancesLocalIds=Math.max(this.productNodesInstancesLocalIds,d);f=new l(b,d,f,m);stage.emersya.viewer.modules.renderer.animations&&(f.animations=e(f));b.sourceNode&&f.children.push(this.duplicateSourceNode(b.sourceNode,d));m&&m.children.push(f);this.updateProductNodeInstanceTransformationFromMatrix(f);
b.duplicatedNodes[f.localId]=f;return this.productNodeInstancesByLocalId[f.localId]=f};b.prototype.getNewProductNodeInstanceLocalId=function(){return++this.productNodesInstancesLocalIds};b.prototype.updateModelSceneGraph=function(){if(this.isSimpleModel){for(var b=0;b<this.polylists.length;++b){for(var d=0;d<this.polylists[b].instances.length;++d)this.polylists[b].instances[d].matAnim.destroy(),this.polylists[b].instances[d].destroyed=!0;this.polylists[b].instances=[]}this.polylistInstances=[];var e=
[this.root];for(b=0;b<e.length;++b){var f=e[b];f.fullId="0-"+f.id;f.polylists=[];f.matricesList=[];if(f.polylistIds)for(d=0;d<f.polylistIds.length;++d){var m=this.polylists[f.polylistIds[d]];m.materialTree=this.materialTrees[f.materialIds[d]];m=this.createPolylistInstance(m,f);f.polylists.push(m)}e.push.apply(e,$jscomp.arrayFromIterable(f.children))}}else console.warn("should not try to update the models scene graph if it is not a simple model.")};b.prototype.duplicateSourceNode=function(b,d){if(b.duplicatedNodes&&
b.duplicatedNodes[d])throw console.error("multiple source nodes duplicates",b,d),-1;var h={type:1,id:b.id,localId:d,fullId:d+"-"+b.id,name:b.name,sourceNode:b,matrix:mat4.create(b.matrix),selected:!1,highlighted:!1,opacity:1,baseOpacity:1,annotations:[],polylists:[],matricesList:[],children:[]};if(b.polylistIds)for(var e=0;e<b.polylistIds.length;++e)h.polylists.push(this.createPolylistInstance(this.polylists[b.polylistIds[e]],h));this.sourceNodesByFullId[h.fullId]=h;for(e in b.children)h.children[e]=
this.duplicateSourceNode(b.children[e],d),h.children[e].parent=h;b.duplicatedNodes||(b.duplicatedNodes={});return b.duplicatedNodes[d]=h};b.prototype.readProductNodeStr=function(b){void 0===b.value&&(b={value:b+"|"});var h=b.value.indexOf("]")+1,d=mat4.transpose(mat4.create(new Float32Array(b.value.slice(0,h).substring(1,h-1).split(","))));b.value=b.value.substring(h,b.value.length);h="";for(var e=0;e<b.value.length&&"["!==b.value.charAt(e)&&"<"!==b.value.charAt(e)&&">"!==b.value.charAt(e)&&"|"!==
b.value.charAt(e);)h+=b.value.charAt(e),e++;b.value=b.value.substring(e,b.value.length);var f=h.split("-");h=parseInt(f[0]);f=parseInt(f[1]);mat4.multiply(d,this.productNodes[h].matrix);if((e<b.value.length&&"["==b.value.charAt(0)||">"==b.value.charAt(0))&&"|"!==b.value.charAt(e))return this.createProductNodeInstance(this.productNodes[h],f,d,null);d=this.createProductNodeInstance(this.productNodes[h],f,d,null);"<"==b.value.charAt(0)&&(b.value=b.value.substring(1,b.value.length));for(;b.value.length&&
">"!==b.value.charAt(0)&&"|"!==b.value.charAt(0);)this.readProductNodeStr(b),h=b.value.indexOf(">"),e=b.value.indexOf("|"),f=b.value.indexOf("["),h=0>h?0:h,f=0>f?0:f,b.value=b.value.substring(h<e?h<f?h:f:e<f?e:f,b.value.length);">"===b.value.charAt(0)&&(b.value=b.value.substring(1,b.value.length));return d};var g=function(b){return void 0===b?null:b};b.prototype.updateMaterial=function(b,d){var h=b.lightMapLevels[d[0]],e=h.opacityLevels[d[1]],f=e.refractionLevels[d[2]],m=f.translucencyLevels[d[3]],
v=m.specularAnisotropicLevels[d[4]],p=v.normalDeformationLevels[d[5]],n=p.shininessLevels[d[6]],k=n.reflectionLevels[d[7]],l=k.emissiveLevels[d[8]],r=l.glowLevels[d[9]],q=r.iridescentLevels[d[10]],t=q.specularLevels[d[11]],B=t.diffuseLevels[d[12]];d=B.ambientLevels[d[13]];var A=d.materialSettings.content;this.register("Material",{id:A.id,name:A.name,technical_name:A.technical_name,uvTransform:b.uvTransform,newShaderType:A.newShaderType,polylists:[],type:0,materialTree:b,lightMap:g(h.content),opacity:g(e.content),
refraction:g(f.content),translucency:g(m.content),specularAnisotropic:g(v.content),normalDeformation:g(p.content),shininess:g(n.content),reflection:g(k.content),emissive:g(l.content),glow:g(r.content),iridescent:g(q.content),specular:g(t.content),diffuse:g(B.content),ambient:g(d.content)})};b.prototype.updatePbrMaterial=function(b,d){var h=b.localEnvironmentLevels[d[0]],e=h.occlusionLevels[d[1]],f=e.translucencyLevels[d[2]],m=f.opacityLevels[d[3]],v=m.coatingLevels[d[4]],p=v.normalDeformationLevels[d[5]],
n=p.metalnessLevels[d[6]],k=n.roughnessLevels[d[7]],l=k.iridescenceLevels[d[8]],r=l.emissiveLevels[d[9]];d=r.albedoLevels[d[10]];var q=d.materialSettings.content;this.register("Material",{id:q.id,name:q.name,technical_name:q.technical_name,uvTransform:b.uvTransform,polylists:[],type:1,materialTree:b,localEnvironment:g(h.content),occlusion:g(e.content),translucency:g(f.content),opacity:g(m.content),coating:g(v.content),normalDeformation:g(p.content),metalness:g(n.content),roughness:g(k.content),iridescence:g(l.content),
emissive:g(r.content),albedo:g(d.content)});r.content&&r.content.glow&&(this.materials[q.id].glow=r.content.glow)};b.prototype.readMaterialConfigsStr=function(b,d){if(d)var h=[];for(;-1!=b.indexOf("{");){var e=b.indexOf("{"),f=b.indexOf("}");e=b.substring(e+1,f);b=b.substring(f+1,b.length);e=e.split(",");f=parseInt(e[0]);e=parseInt(e[1]);if(d)h.push({mt:this.get("MaterialTree",f),ms:this.get("MaterialSettings",e)});else if(this.get("MaterialTree",f)||this.register("MaterialTree",{id:f,polylistInstances:[]}),
f=this.get("MaterialTree",f),e=this.get("MaterialSettings",e)){f.currentMaterialId=e.id;f.defaultMaterialId=e.id;for(var m in f.polylistInstances){var v=f.polylistInstances[m];v.matAnim?v.matAnim.resetMaterial(this.get("Material",e.id)):v.msId=e.id}}else f.currentMaterialId=-1,f.defaultMaterialId=-1}if(d)return h};b.prototype.readMtgcStr=function(b){for(;-1!=b.indexOf("{");){var h=b.indexOf("{"),d=b.indexOf("}");h=b.substring(h+1,d);b=b.substring(d+1,b.length);h=h.split(",");d=parseInt(h[0]);h=parseInt(h[1]);
this.materialTreesGroups[d]&&this.materialTreesGroupsConfigurations[h]&&(this.materialTreesGroups[d].currentConfiguration=this.materialTreesGroupsConfigurations[h])}};b.prototype.readPolylistsStr=function(b){for(;-1!=b.indexOf("{");){var h=b.indexOf("{"),d=b.indexOf("}");h=b.substring(h+1,d);b=b.substring(d+1,b.length);h=h.split(",");d=parseInt(h[0]);h=parseInt(h[1]);this.polylists[d]&&(this.polylists[d].isHidden=h)}};b.prototype.readCustomTextsStr=function(b){var h=[];try{h=stage.json.parse(b)}catch(L){return}b=
[];for(var d in h){var e=h[d],f=this.materialTrees[e.p82],m=this.materialSettings[e.p16];if(f&&m){if(e.p73){var g={realDimensions:!0,creationCall:"updateCustomTextsRealDimensions",color:e.p39,backgroundColor:e.p72,strokeText:e.p47,strokeColor:e.p6,strokeWidth:e.p24,font:e.p22,verticalAlignment:e.p96,horizontalAlignment:e.p79,textAlignment:e.p17,mode:e.p54,imageWidth:e.p88,textOffsetX:e.p14,textOffsetY:e.p81,contents:e.p13,uvRatio:e.p71,surfaceWidth:e.p53,maxTextWidth:e.p41,maxTextHeight:e.p37,texts:[]};
var p=stage.extend(!0,{},g);p.mtId=e.p82;p.msId=e.p16;p.material_tree=f.name;p.material_settings=m.name;for(n in e.p23)k={text:e.p23[n].p51,font:e.p23[n].p72,color:e.p23[n].p85,strokeText:e.p23[n].p57,strokeColor:e.p23[n].p94,strokeWidth:e.p23[n].p8,verticalAlignment:e.p23[n].p22,horizontalAlignment:e.p23[n].p74,maxTextWidth:e.p23[n].p61,maxTextHeight:e.p23[n].p11,preSpacing:e.p23[n].p79,postSpacing:e.p23[n].p45,offsetX:e.p23[n].p88,offsetY:e.p23[n].p87},g.texts.push(k),p.texts.push(stage.extend({},
k))}else{g={creationCall:"updateCustomTexts",color:e.p39,backgroundColor:e.p72,font:e.p47,mode:e.p6,verticalAlignment:e.p24,horizontalAlignment:e.p22,italic:e.p96,bold:e.p79,underline:e.p17,strokeText:e.p54,strokeColor:e.p88,strokeWidth:e.p14,size:e.p81,imageWidth:e.p13,imageHeight:e.p71,textOffsetX:e.p53,textOffsetY:e.p41,contents:e.p37,texts:[]};p=stage.extend(!0,{},g);p.mtId=e.p82;p.msId=e.p16;p.material_tree=f.name;p.material_settings=m.name;for(var n in e.p23){var k={color:e.p23[n].p51,backgroundColor:e.p23[n].p72,
font:e.p23[n].p85,italic:e.p23[n].p57,bold:e.p23[n].p94,underline:e.p23[n].p8,strokeText:e.p23[n].p22,strokeColor:e.p23[n].p74,strokeWidth:e.p23[n].p61,size:e.p23[n].p11,preSpacing:e.p23[n].p79,postSpacing:e.p23[n].p45,offsetX:e.p23[n].p88,offsetY:e.p23[n].p87,verticalAlignment:e.p23[n].p41,horizontalAlignment:e.p23[n].p37,text:e.p23[n].p44};g.texts.push(k);p.texts.push(stage.extend({},k))}}b.push(p);e=this.getTexturesByMtMsContentsNames(f.name,m.name,g.contents,!1);for(n=0;n<e.length;++n)this.originalTextures[e[n].id].__globalId==
this.currentGlobalId&&(this.customTextures[e[n].id]={textureId:e[n].id,metadata:g})}}this.customTexts=b};b.prototype.readCustomTexturesStr=function(b,d){d=[];try{d=stage.json.parse(b)}catch(T){}b=-22222;var h={},e;for(e in d){var f=this.projectConfigurationPath+"_"+d[e][1];h[f]||(h[f]=this.texturesManager.createLocalImageRGBA({id:--b,imageData:this.projectConfigurationPath+"_"+d[e][1],width:3,height:3}));f={textureId:d[e][0],sourceImage:h[f]};this.customTextures[f.textureId]||(this.customTextures[f.textureId]=
f)}};b.prototype.readTexturesTransformsStr=function(b,d){var h=[];try{h=stage.json.parse(b)}catch(M){}for(var e in h)b=h[e],this.texturesTransforms[b.p51]={textureId:b.p51,scaling:[b.p11[0],b.p11[1],b.p11[2]],rotationCenter:[b.p88[0],b.p88[1],b.p88[2]],translation:[b.p85[0],b.p85[1],b.p85[2]],rotation:b.p44},d&&(b=this.texturesTransforms[b.p51],this.textures[b.textureId].transform([-b.translation[0],b.translation[1],0],b.rotation,b.scaling,b.rotationCenter))};b.prototype.readTexturesLayersStr=function(b,
d){var h=[];try{h=stage.json.parse(b)}catch(T){}for(var e in h)if(b=h[e],b={textureId:b.p32,layers:b.p12},this.texturesLayers[b.textureId]=b,d)for(var f in b.layers)this.textures[b.textureId].updateLayer(b.layers[f],!0)};b.prototype.readAnimationStatesStr=function(b){var h=[];try{h=stage.json.parse(b)}catch(J){}for(var d in h)this.animationStatesToLoad[h[d].p11]=h[d].p32};b.prototype.readCustomColorsStr=function(b){var h={};try{h=stage.json.parse(b)}catch(I){}this.customColors=h};b.prototype.getProjectsFromConfiguration=
function(b){var h=[];if(b&&b.projectsData)for(var d in b.projectsData)h.push(d);return h};b.prototype.applyModularConfiguration=function(b,d){this.root&&this.removeProductNode(this.root.localId);this.loadedToGl=this.loaded=!1;delete this.loadedCallback;var h=this.getCurrentParentTypeAndId();b.modularConfiguratorData&&this.modularConfigurator&&B.call(this);var e=function(b,h){var d=this.productNodes[b.id];h=this.createProductNodeInstance(d,b.localId,mat4.create(b.matrix),h);void 0!==b.tracked&&(h.tracked=
b.tracked);void 0!==b.draggable&&(h.draggable=b.draggable);void 0!==b.initialPosition&&(h.initialPosition=vec3.create(b.initialPosition));void 0!==b.initialRotationAxis&&(h.initialRotationAxis=vec3.create(b.initialRotationAxis));void 0!==b.initialRotationAngle&&(h.initialRotationAngle=b.initialRotationAngle);if(b.sourceNodes)for(var f=0;f<b.sourceNodes.length;++f){var m=this.getFromInstanceParent(d,"SourceNode",b.sourceNodes[f].id);m&&b.sourceNodes[f].matrix&&16==b.sourceNodes[f].matrix.length&&m.duplicatedNodes[b.localId]&&
mat4.set(b.sourceNodes[f].matrix,m.duplicatedNodes[b.localId].matrix)}for(f=0;f<b.children.length;++f)e.call(this,b.children[f],h);return h};this.root=e.call(this,b.sceneGraph);b.externalUse?q.call(this,b,d):t.call(this,b,d);for(var f in b.animations.sets)this.animationStatesToLoad[f]=b.animations.sets[f];this.setParent(h.type,h.id);this.updateSceneNodes();this.recursiveComputeMatrices(this.root,mat4.identity(mat4.create()));b.plannerData&&this.planner&&(stage.extend(!0,this.planner,b.plannerData),
this.planner.configurationUpdated=!0);b.modularConfiguratorData&&this.modularConfigurator&&(this.modularConfigurator.defaultGraph=b.modularConfiguratorData)};var q=function(b,d){var h=new Set,e=function(b){var h={},d;for(d in b)h[b[d].name]=b[d];return h},f={};for(t in b.projectsData){var m=b.projectsData[t];this.setParent("Project",t);var v=e(this.getAll("MaterialTree")),g=e(this.getAll("MaterialTreesGroup"));for(A in m.materialTrees){var p=v[A],n=this.materialsContent.materialSettingsByName[p.id][m.materialTrees[A]];
p.currentMaterialId=n.id;p.defaultMaterialId=n.id;for(var k in p.polylistInstances){var l=p.polylistInstances[k];l.matAnim?l.matAnim.resetMaterial(this.get("Material",n.id)):l.msId=n.id}}for(var r in m.materialTreesGroups)for(k in l=g[r],l.configurations)if(l.configurations[k].name==m.materialTreesGroups[r]){l.currentConfiguration=l.configurations[k];break}l=m.customData;for(k=0;k<l.texts.length;++k)for(g=l.texts[k],n=g.image,f[n]||(f[n]=this.texturesManager.createLocalImageRGBA({imageData:n,width:g.width,
height:g.height})),m=this.getTexturesByMtMsContentsNames(g.configurableMaterial,g.materialVariation,[this.apiCore.exec(this.callerName,"convertToCustomContentPath",g.contents)],!0),p=0;p<m.length;++p)this.originalTextures[m[p].id].__globalId==this.currentGlobalId&&(this.customTextures[m[p].id]={textureId:m[p].id,sourceImage:f[n],metadata:g.textsData});for(k=0;k<l.textures.length;++k)for(m=l.textures[k],n=m.image,f[n]||(f[n]=this.texturesManager.createLocalImageRGBA({imageData:n,width:m.width,height:m.height})),
m=this.getTexturesByMtMsContentsNames(m.configurableMaterial,m.materialVariation,[this.apiCore.exec(this.callerName,"convertToCustomContentPath",m.contents)],!0),p=0;p<m.length;++p)this.originalTextures[m[p].id].__globalId==this.currentGlobalId&&(this.customTextures[m[p].id]={textureId:m[p].id,sourceImage:f[n]});for(k=0;k<l.texturesTransforms.length;++k)for(n=l.texturesTransforms[k],m=this.getTexturesByMtMsContentsNames(n.configurableMaterial,n.materialVariation,[this.apiCore.exec(this.callerName,
"convertToCustomContentPath",n.contents)],!0),p=0;p<m.length;++p)this.originalTextures[m[p].id].__globalId==this.currentGlobalId&&(n.textureId=m[p].id,this.texturesTransforms[m[p].id]=n,d&&this.textures[m[p].id].transform([-n.translation[0],n.translation[1],0],n.rotation,n.scaling,n.rotationCenter));for(k=0;k<l.texturesLayers.length;++k)for(n=l.texturesLayers[k],m=this.getTexturesByMtMsContentsNames(n.configurableMaterial,n.materialVariation,[this.apiCore.exec(this.callerName,"convertToCustomContentPath",
n.contents)],!0),p=0;p<m.length;++p)if(this.originalTextures[m[p].id].__globalId==this.currentGlobalId&&(n.textureId=m[p].id,this.texturesLayers[m[p].id]=n,d))for(p in n.layers)this.textures[m[p].id].updateLayer(n.layers[p],!0);for(k=0;k<l.colors.length;++k)m=l.colors[k],p=v[m.configurableMaterial],n=this.materialsContent.materialSettingsByName[p.id][m.materialVariation],this.customColors[n.id]=m.data}for(var q in b.productNodesData){this.setParentFromInstance(this.productNodeInstancesByLocalId[q].productNode);
d=e(this.getAll("Polylist"));v=e(this.getAll("MaterialTree"));var t=b.productNodesData[q];for(var B in t.polylists){var A=d[B];r=t.polylists[B];for(k=0;k<A.instances.length;++k)if(l=A.instances[k],l.node.localId==q){p=v[r.configurableMaterial];n=this.materialsContent.materialSettingsByName[p.id][r.materialVariation];p=this.get("Material",n.id);l.matAnim?l.matAnim.resetMaterial(p):l.msId=p.id;h.add(l);g=r.customData;l.customMaterial=g.material;for(p=0;p<g.textures.length;++p)m=g.textures[p],n=m.image,
f[n]||(f[n]=this.texturesManager.createLocalImageRGBA({imageData:n,width:m.width,height:m.height})),this.customPolylistInstancesTextures[l.id]||(this.customPolylistInstancesTextures[l.id]={polylistInstance:l,images:[]}),this.customPolylistInstancesTextures[l.id].images.push({path:m.path,sourceImage:f[n]});g.textureTransform&&(l.textureTransform=g.textureTransform);g.globalUVTransform&&(l.globalUVTransform=g.globalUVTransform)}}}for(b=0;b<this.polylistInstances.length;++b)e=this.polylistInstances[b],
h.has(e)||(D.call(this,e),--b)},t=function(b,d){var h=new Set,e={};for(A in b.projectsData){var f=b.projectsData[A];this.setParent("Project",A);for(var m in f.materialTrees){var v=f.materialTrees[m],p=this.get("MaterialTree",m),g=this.get("MaterialSettings",v);p.currentMaterialId=g.id;p.defaultMaterialId=g.id;for(var n in p.polylistInstances)v=p.polylistInstances[n],v.matAnim?v.matAnim.resetMaterial(this.get("Material",g.id)):v.msId=g.id}for(var k in f.materialTreesGroups)n=this.get("MaterialTreesGroup",
k),v=this.get("MaterialTreesGroupConfiguration",f.materialTreesGroups[k]),n.currentConfiguration=v;v=f.customData;for(n=0;n<v.texts.length;++n)g=v.texts[n],f=this.projectConfigurationPath.replace(".json","")+"_"+g.image,e[f]||(e[f]=this.texturesManager.createLocalImageRGBA({imageData:f,width:g.width,height:g.height})),p=this.get("Texture",g.textureId).id,this.customTextures[p]={textureId:p,sourceImage:e[f],metadata:g.textsData};for(n=0;n<v.textures.length;++n)p=v.textures[n],f=this.projectConfigurationPath.replace(".json",
"")+"_"+p.image,e[f]||(e[f]=this.texturesManager.createLocalImageRGBA({imageData:f,width:p.width,height:p.height})),p=this.get("Texture",p.textureId).id,this.customTextures[p]={textureId:p,sourceImage:e[f]};for(n=0;n<v.texturesTransforms.length;++n)f=v.texturesTransforms[n],p=this.get("Texture",f.textureId).id,f.textureId=p,this.texturesTransforms[p]=f,d&&this.textures[p].transform([-f.translation[0],f.translation[1],0],f.rotation,f.scaling,f.rotationCenter);for(n=0;n<v.texturesLayers.length;++n)if(f=
v.texturesLayers[n],p=this.get("Texture",f.textureId).id,f.textureId=p,this.texturesLayers[p]=f,d)for(var l in f.layers){this.textures[f.textureId].updateLayer(f.layers[l],!0);g=this.texturesManager.getTexturesInstances(p);for(var r=0;r<g.length;++r)g[r].updateLayer(f.layers[l])}for(n=0;n<v.colors.length;++n)f=v.colors[n],p=this.get("MaterialSettings",f.materialId).id,this.customColors[p]=f.data}for(var q in b.productNodesData){this.setParentFromInstance(this.productNodeInstancesByLocalId[q].productNode);
d=b.productNodesData[q];for(var t in d.polylists){var A=this.get("Polylist",t);m=d.polylists[t];for(n=0;n<A.instances.length;++n)if(v=A.instances[n],v.node.localId==q){l=this.get("Material",this.get("MaterialSettings",m.material||m.materialId).id);v.matAnim?v.matAnim.resetMaterial(l):v.msId=l.id;h.add(v);k=m.customData;v.customMaterial=k.material;for(l=0;l<k.textures.length;++l)p=k.textures[l],f=this.projectConfigurationPath.replace(".json","")+"_"+p.image,e[f]||(e[f]=this.texturesManager.createLocalImageRGBA({imageData:f,
width:p.width,height:p.height})),this.customPolylistInstancesTextures[v.id]||(this.customPolylistInstancesTextures[v.id]={polylistInstance:v,images:[]}),this.customPolylistInstancesTextures[v.id].images.push({path:p.path,sourceImage:e[f]});k.textureTransform&&(v.textureTransform=k.textureTransform);k.globalUVTransform&&(v.globalUVTransform=k.globalUVTransform)}}}for(b=0;b<this.polylistInstances.length;++b)e=this.polylistInstances[b],h.has(e)||(D.call(this,e),--b)};b.prototype.validateModularConfiguration=
function(b){try{var h=this.getCurrentParentTypeAndId();b.modularConfiguratorData&&this.modularConfigurator&&B.call(this);var d={},e=function(b,h){h=this.productNodes[b.id];if(!h)throw"invalid product node: "+b.id;d[b.localId]=h;void 0!==b.position&&vec3.create(b.position);void 0!==b.rotationAxis&&vec3.create(b.rotationAxis);void 0!==b.scaling&&vec3.create(b.scaling);void 0!==b.initialPosition&&vec3.create(b.initialPosition);void 0!==b.initialRotationAxis&&vec3.create(b.initialRotationAxis);if(b.sourceNodes)for(var f=
0;f<b.sourceNodes.length;++f)if(!this.getFromInstanceParent(h,"SourceNode",b.sourceNodes[f].id))throw"invalid source node: "+b.sourceNodes[f].id;for(f=0;f<b.children.length;++f)e.call(this,b.children[f])};e.call(this,b.sceneGraph);b.externalUse?r.call(this,b,d):f.call(this,b,d);for(var m in b.animations.sets)if(!b.animations.sets[m])throw"invalid animation set name: "+m;this.setParent(h.type,h.id);return!0}catch(T){return!1}};var r=function(b,d){var h=function(b){var h={},d;for(d in b)h[b[d].name]=
b[d];return h};for(l in b.projectsData){var e=b.projectsData[l];this.setParent("Project",l);var f=h(this.getAll("MaterialTree")),m=h(this.getAll("MaterialTreesGroup"));for(r in e.materialTrees){var v=e.materialTrees[r],p=f[r];if(!p)throw"invalid material tree name:"+r;p=this.materialsContent.materialSettingsByName[p.id][v];if(!p)throw"invalid material settings name:"+v;}for(var g in e.materialTreesGroups){p=m[g];if(!p)throw"invalid group name:"+r;v=!1;for(var n in p.configurations)if(p.configurations[n].name==
e.materialTreesGroups[g]){v=!0;break}if(!v)throw"invalid group configuration name:"+e.materialTreesGroups[g];}e=e.customData;for(n=0;n<e.texts.length;++n){p=e.texts[n];p=this.getTexturesByMtMsContentsNames(p.configurableMaterial,p.materialVariation,[this.apiCore.exec(this.callerName,"convertToCustomContentPath",p.contents)],!0);if(!p.length)throw"invalid custom text";v=!1;for(m=0;m<p.length&&!v;++m)v=this.originalTextures[p[m].id].__globalId==this.currentGlobalId;if(!v)throw"invalid custom text";
}for(n=0;n<e.textures.length;++n){p=e.textures[n];p=this.getTexturesByMtMsContentsNames(p.configurableMaterial,p.materialVariation,[this.apiCore.exec(this.callerName,"convertToCustomContentPath",p.contents)],!0);if(!p.length)throw"invalid custom texture";v=!1;for(m=0;m<p.length&&!v;++m)v=this.originalTextures[p[m].id].__globalId==this.currentGlobalId;if(!v)throw"invlid custom texture";}for(n=0;n<e.texturesTransforms.length;++n){p=e.texturesTransforms[n];p=this.getTexturesByMtMsContentsNames(p.configurableMaterial,
p.materialVariation,[this.apiCore.exec(this.callerName,"convertToCustomContentPath",p.contents)],!0);if(!p.length)throw"invalid texture transform";v=!1;for(m=0;m<p.length&&!v;++m)v=this.originalTextures[p[m].id].__globalId==this.currentGlobalId;if(!v)throw"invalid texture transform";}for(n=0;n<e.texturesLayers.length;++n){p=e.texturesLayers[n];p=this.getTexturesByMtMsContentsNames(p.configurableMaterial,p.materialVariation,[this.apiCore.exec(this.callerName,"convertToCustomContentPath",p.contents)],
!0);if(!p.length)throw"invalid texture layer";v=!1;for(m=0;m<p.length&&!v;++m)v=this.originalTextures[p[m].id].__globalId==this.currentGlobalId;if(!v)throw"invalid texture layer";}for(n=0;n<e.colors.length;++n){m=e.colors[n];p=f[m.configurableMaterial];if(!p)throw"invalid material tree name:"+m.configurableMaterial;p=this.materialsContent.materialSettingsByName[p.id][m.materialVariation];if(!p)throw"invalid material settings name:"+m.materialVariation;}}for(var k in b.productNodesData){f=d[k];if(!f)throw"invalid product node local id: "+
k;this.setParentFromInstance(f);var l=h(this.getAll("Polylist"));f=h(this.getAll("MaterialTree"));var r=b.productNodesData[k];for(var q in r.polylists){g=l[q];if(!g)throw"invalid polylist: "+q;e=r.polylists[q];for(n=0;n<g.instances.length;++n)if(g.instances[n].node.localId==k){p=f[e.configurableMaterial];if(!p)throw"invalid material tree:"+e.configurableMaterial;p=this.materialsContent.materialSettingsByName[p.id][e.materialVariation];if(!p)throw"invalid material settings:"+e.materialVariation;if(!this.get("Material",
p.id))throw"invalid material";}}}},f=function(b,d){for(var h in b.projectsData){var e=b.projectsData[h];this.setParent("Project",h);for(var f in e.materialTrees){var m=e.materialTrees[f];if(!this.get("MaterialTree",f))throw"invalid material tree:"+f;if(!this.get("MaterialSettings",m))throw"invalid material settings:"+m;}for(var v in e.materialTreesGroups){if(!this.get("MaterialTreesGroup",v))throw"invalid materials group:"+v;if(!this.get("MaterialTreesGroupConfiguration",e.materialTreesGroups[v]))throw"invalid materials group configuration:"+
e.materialTreesGroups[v];}m=e.customData;for(e=0;e<m.texts.length;++e){var p=m.texts[e],g=this.get("Texture",p.textureId);if(!g)throw"invalid customText: "+p.textureId;}for(e=0;e<m.textures.length;++e)if(p=m.textures[e],g=this.get("Texture",p.textureId),!g)throw"invalid customTexture: "+p.textureId;for(e=0;e<m.texturesTransforms.length;++e)if(p=m.texturesTransforms[e],g=this.get("Texture",p.textureId),!g)throw"invalid textureTransform: "+p.textureId;for(e=0;e<m.texturesLayers.length;++e)if(p=m.texturesLayers[e],
g=this.get("Texture",p.textureId),!g)throw"invalid textureLayer: "+p.textureId;for(e=0;e<m.colors.length;++e)if(p=m.colors[e],g=this.get("MaterialSettings",p.materialId),!g)throw"invalid custom material color:"+p.materialId;}for(var n in b.productNodesData){e=d[n];if(!e)throw"invalid product node";this.setParentFromInstance(e);h=b.productNodesData[n];for(var k in h.polylists){f=this.get("Polylist",k);if(!f)throw"Invalid polylist";v=h.polylists[k];for(e=0;e<f.instances.length;++e)if(f.instances[e].node.localId==
n){m=this.get("MaterialSettings",v.material||v.materialId);if(!m)throw"Invalid polylist mateiral";g=this.get("Material",m.id);if(!g)throw"Invalid polylist mateiral";}}}};b.prototype.recursiveComputeMatrices=function(b,d){if(b){for(var h=0;h<b.children.length;++h)b.children[h].parent=b;b.modelMatrix=mat4.create(d);mat4.multiply(b.modelMatrix,b.matrix);b.invModelMatrix3=mat3.create();mat4.toInverseMat3(b.modelMatrix,b.invModelMatrix3);b.normalModelMatrix=mat3.transpose(b.invModelMatrix3,mat3.create());
b.normalModelMatrixMat4=mat4.create();b.normalModelViewMatrix=mat3.create();b.matricesList=[];b.parent&&b.matricesList.push.apply(b.matricesList,$jscomp.arrayFromIterable(b.parent.matricesList));b.matricesList.push(b.matrix);b.matricesList.push(b.animations.currentMatrix);for(h=0;h<b.children.length;++h)this.recursiveComputeMatrices(b.children[h],b.modelMatrix)}};b.prototype.addProductNode=function(b,d,e,f,m,p){b=d?this.productNodesByProjectAndSKU[d][b]:this.productNodesBySKU[b];m=mat4.create(m);
mat4.multiply(m,b.matrix);d=null;for(var h in this.nodesInUse){var v=this.nodesInUse[h];if(1!=v.type&&v.localId===f){if((f=this.productNodes[b.id].duplicatedNodes[e])&&f.isPlaceholder){h=[];b.sourceNode&&h.push(this.duplicateSourceNode(b.sourceNode,e));for(e=f.type=0;e<f.children.length;++e)1!==f.children[e].type?h.push(f.children[e]):A.call(this,f.children[e]);f.children=h;f.sourceModel=b.sourceModel;delete b.boundingBox;d=f;w.call(this,f)}else d=this.createProductNodeInstance(b,e,m,v);break}}d?
(this.updateSceneNodes(),this.recursiveComputeMatrices(d,v.modelMatrix),this.computeSceneBoundingBoxes(),this.computeSceneRealMeasurementScalingFactors(this.arData),this.imagesReadyCallbacks=[p],this.texturesManager.eventsManager.listen(this,"startingTexturesReady",n),this.texturesManager.loadStartingTextures(!0,!0)):p&&p()};b.prototype.addProductNodes=function(b,d){for(var h=0;h<b.length;++h){var e=b[h],f=e.id&&this.productNodes[e.id]?this.productNodes[e.id]:e.projectCode?this.productNodesByProjectAndSKU[e.projectCode][e.SKU]:
this.productNodesBySKU[e.SKU],m=mat4.create(e.matrix);mat4.multiply(m,f.matrix);var v=null,p;for(p in this.nodesInUse){var g=this.nodesInUse[p];if(1!=g.type&&g.localId===e.parentLocalId){var k=this.productNodes[f.id].duplicatedNodes[e.localId];if(k&&k.isPlaceholder){v=[];e.newSourceNodeRoot?v.push(this.duplicateSourceNode(e.newSourceNodeRoot,e.localId)):f.sourceNode&&v.push(this.duplicateSourceNode(f.sourceNode,e.localId));for(e=k.type=0;e<k.children.length;++e)1!==k.children[e].type?v.push(k.children[e]):
A.call(this,k.children[e]);k.children=v;k.sourceModel=f.sourceModel;delete f.boundingBox;delete f.boundingBoxWithoutNodes;v=!0;w.call(this,k)}else if(k&&!k.isPlaceholder)console.error("Already a product node with this id",e,k);else{if(e.newSourceNodeRoot){var l=f.sourceNode;f.sourceNode=null}k=this.createProductNodeInstance(f,e.localId,m,g);v=!0;e.newSourceNodeRoot&&(f.sourceNode=l,f=this.duplicateSourceNode(e.newSourceNodeRoot,e.localId),k.children.push(f),f.parent=k)}break}}this.updateSceneNodes()}v?
(this.prepareScene(),this.imagesReadyCallbacks||(this.imagesReadyCallbacks=[]),this.imagesReadyCallbacks.push(d),this.texturesManager.eventsManager.listen(this,"startingTexturesReady",n),this.texturesManager.loadStartingTextures(!0,!0)):d&&d()};var n=function(){this.texturesManager.eventsManager.detachEvent("startingTexturesReady",n);for(var b=0;b<this.imagesReadyCallbacks.length;++b)(0,this.imagesReadyCallbacks[b])();this.imagesReadyCallbacks=[];++this.needsUpdate},B=function(){this.ofmlStructuralNode=
{id:1,name:"OfmlStructuralNode",sku:"OfmlStructuralNode",matrix:mat4.identity(mat4.create()),opacity:1,baseOpacity:1,sourceNode:null,sourceModel:null,originalSourceModel:null,matricesList:[],associations:{},duplicatedNodes:{}};var b=this.getCurrentParentTypeAndId();this.setParent("Scene",1);this.register("ProductNode",this.ofmlStructuralNode);this.productNodesBySKU.OfmlStructuralNode=this.get("ProductNode",this.ofmlStructuralNode.id);var d=this.getCurrentParentTypeAndId().id;this.productNodesByProjectAndSKU[d]||
(this.productNodesByProjectAndSKU[d]={});this.productNodesByProjectAndSKU[d].OfmlStructuralNode=this.productNodesBySKU.OfmlStructuralNode;b&&this.setParent(b.type,b.id)};b.prototype.getOfmlStructuralNode=function(){this.ofmlStructuralNode||B.call(this);return this.ofmlStructuralNode};b.prototype.createPlaceholderSourceNode=function(b){this.createPlaceholderSourceModel();var d=this.currentGlobalId,h=this.currentGlobalData;this.setParentFromInstance(b);var e=this.register("SourceNode",{id:-1,name:"placeholder source node for "+
b.name,matrix:mat4.identity(mat4.create()),children:[],polylistIds:[b.polylist.id],materialIds:[],sourceModel:b,selected:!1,highlighted:!1,parent:null,opacity:1,baseOpacity:1,explosionVector:vec3.create([0,0,0]),explodable:!1,annotations:[],duplicatedNodes:{},polylists:[]});b.polylist.materialTree=this.placeholderMaterialTree;b.polylist.customMaterial=this.convertCustomMaterialValuesToMaterial([]);this.currentGlobalId=d;this.currentGlobalData=h;return e};b.prototype.createPlaceholderSourceModel=function(){if(!this.placeholderSourceModel){var b=
this.currentGlobalId,d=this.currentGlobalData;this.setParent("Scene","PlaceholderCube");this.register("ArData",{id:1,realSize:1,algorithm:0,excludedPolylists:[],boundingBox:this.createBoundingBox()});var e=this.register("MaterialSettings",{id:1,name:"placeholder cube material settings",customText:!1});this.placeholderMaterialTree=this.register("MaterialTree",{id:1,name:"placeholder cube mat tree",defaultMaterialId:e.id,currentMaterialId:e.id,uvTransform:{dirty:!0,angle:0,scaleX:1,scaleY:1,offsetX:0,
offsetY:0},localEnvironmentLevels:[],polylistInstances:[],polylistMinId:2E12,highlighted:!1});var f=this.register("Material",{id:e.id,name:e.name,uvTransform:this.placeholderMaterialTree.uvTransform,polylists:[],type:1,materialTree:this.placeholderMaterialTree,localEnvironment:null,occlusion:null,translucency:null,opacity:this.register("PbrOpacity",{id:1,name:"placeholder cube opacity",intensity:1,glassMode:0,firstFacesOnly:!1,blur:"",blending:stage.emersya.viewer.BLENDING_MODE.INTERPOLATIVE,threshold:0,
texture:null,refraction:null}),coating:null,normalDeformation:null,metalness:this.register("PbrMetalness",{id:1,name:"placeholder cube metalness",intensity:0,texture:null,anisotropy:null,carpaint:null}),roughness:this.register("PbrRoughness",{id:1,name:"placeholder cube roughness",intensity:.2,texture:null,gloss:!1,sheen:null}),iridescence:null,emissive:null,albedo:this.register("Albedo",{id:1,name:"placeholder cube albedo",color:[1,1,1],intensity:1,texture:null,specular:null})}),m=this.register("Geometry",
{id:1,name:"placeholder cube",dataBuffers:[{nbVertices:24,nbFaces:12,polySize:3,vertices:new Float32Array([-1,1,1,-1,1,-1,-1,-1,-1,1,1,1,1,1,-1,-1,1,-1,1,-1,1,1,-1,-1,1,1,-1,-1,-1,1,-1,-1,-1,1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,1,1,1,-1,1,1,-1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,-1,1,-1,-1,-1,1,-1,1]),faces:new Float32Array([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,0,2,19,3,5,20,6,8,21,9,11,22,12,14,23,15,17]),normals:new Float32Array([-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,0,0,0,-1,0,0,-1,
0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,-1,0,0,0,1,0,1,0,0,0,-1,0,0,0,-1,0,0,1]),uvs:null,tangents:{},colors:null}],polySize:3,vertexBuffers:null,normalBuffers:null,colorBuffers:null,uvBuffers:null,polylists:[]}),p=this.register("Polylist",{id:1,name:"placeholder cube",list:[new Uint16Array([0,1,2,3,4,5,6,7,8,9,10,11])],elementTypes:null,edges:[],indexBuffer:null,indexLineBuf:null,doubleSided:!1,facesOrientation:!0,polygonOffsetFactor:0,polygonOffsetUnits:0,subdivisionLevel:0,renderingPass:0,
downloaded:!0,selected:!1,highlighted:!1,isHidden:!1,duplicatedPolylists:[],instances:[],geometryId:1,geometry:m,materialTree:this.placeholderMaterialTree,customMaterial:this.convertCustomMaterialValuesToMaterial([]),boundingBox:{minX:-1,maxX:1,minY:-1,maxY:1,minZ:-1,maxZ:1,center:vec3.create(0,0,0),vecs:[vec3.create([-1,-1,-1]),vec3.create([-1,-1,1]),vec3.create([-1,1,-1]),vec3.create([-1,1,1]),vec3.create([1,-1,-1]),vec3.create([1,-1,1]),vec3.create([1,1,-1]),vec3.create([1,1,1])],radius:Math.sqrt(2)}});
m.polylists.push(p);e=this.register("SourceModel",{id:1,code:"no code here",filePath:"",realFilePath:"",name:"placeholder cube",extension:"",fileSize:0,uncompressedFileSize:0,geometryCompression:0,geometry:m,polylist:p,materialTree:this.placeholderMaterialTree,materialSettings:e,material:f});p=this.register("SourceNode",{id:1,name:"placeholder cube",matrix:mat4.identity(mat4.create()),children:[],polylistIds:[p.id],materialIds:[],sourceModel:e,selected:!1,highlighted:!1,parent:null,opacity:1,baseOpacity:1,
explosionVector:vec3.create([0,0,0]),explodable:!1,annotations:[],duplicatedNodes:{},polylists:[]});e.sourceNode=p;this.placeholderSourceModel=e;this.currentGlobalId=b;this.currentGlobalData=d}};b.prototype.addProductNodesPlaceholders=function(b){var d=[];this.createPlaceholderSourceModel();for(var h=0;h<b.length;++h){var e=b[h],f=e.id&&this.productNodes[e.id]?this.productNodes[e.id]:e.projectCode?this.productNodesByProjectAndSKU[e.projectCode][e.SKU]:this.productNodesBySKU[e.SKU],m=mat4.create(e.matrix);
mat4.multiply(m,f.matrix);var p=null,g;for(g in this.nodesInUse){var n=this.nodesInUse[g];if(1!=n.type&&n.localId===e.parentLocalId){var k=f.sourceNode;if(f.sourceModel&&f.sourceModel.convexHull)f.sourceModel.placeHolderSourceNode||(f.sourceModel.placeHolderSourceNode=this.createPlaceholderSourceNode(f.sourceModel)),f.sourceNode=f.sourceModel.placeHolderSourceNode,p=this.createProductNodeInstance(f,e.localId,m,n),f.sourceNode=k,p.type=3,p.isPlaceholder=!0;else{var l=f.sourceModel&&f.sourceModel.boundingBox||
e.boundingBox||this.getFromInstanceParent(f,"ArData",1).boundingBox;l.minX<=l.maxX?(f.sourceNode=this.placeholderSourceModel.sourceNode,p=this.createProductNodeInstance(f,e.localId,m,n),f.sourceNode=k,p.type=2,p.isPlaceholder=!0,p.sourceModel=this.placeholderSourceModel,p.children[0].matrix=mat4.translate(p.children[0].matrix,l.center,mat4.create()),mat4.scale(p.children[0].matrix,[(l.maxX-l.minX)/2,(l.maxY-l.minY)/2,(l.maxZ-l.minZ)/2])):(f.sourceNode=null,p=this.createProductNodeInstance(f,e.localId,
m,n),f.sourceNode=k,p.type=2,p.isPlaceholder=!0)}e.position&&(p.initialPosition=e.position);e.rotationAxis&&(p.initialRotationAxis=e.rotationAxis,p.initialRotationAngle=e.rotationAngle);break}}this.updateSceneNodes();d.push(p);this.placeholdersProductNodeInstances.push(p)}if(!d.length)return[];this.prepareScene();this.apiCore.exec(this.callerName,"placeholdersAdded",d);return d};var w=function(b){b.isPlaceholder&&(this.placeholdersProductNodeInstances.splice(this.placeholdersProductNodeInstances.indexOf(b),
1),this.apiCore.exec(this.callerName,"placeholderRemoved",b),b.isPlaceholder=!1)},D=function(b){b.polylist.instances.splice(b.polylist.instances.indexOf(b),1);b.materialTree.polylistInstances.splice(b.materialTree.polylistInstances.indexOf(b),1);b.matAnim&&b.matAnim.destroy();b.destroyed=!0;b.node.polylists.splice(b.node.polylists.indexOf(b),1);this.polylistInstances.splice(this.polylistInstances.indexOf(b),1);b.deallocateFunctions.forEach(function(b){return b()});delete b},A=function(b){if(1===b.type){b.polylists&&
b.polylists.length&&([].concat($jscomp.arrayFromIterable(b.polylists)).forEach(D.bind(this)),delete b.polylists);delete b.sourceNode.duplicatedNodes[b.localId];delete this.sourceNodesByFullId[b.fullId];for(var d=0;d<b.children.length;++d)A.call(this,b.children[d]);b.children=[]}};b.prototype.removeProductNode=function(b,d,e){var h=this.productNodeInstancesByLocalId[b];if(h){for(var f=[].concat($jscomp.arrayFromIterable(h.children)),m=0;m<f.length;++m){var v=f[m];switch(v.type){case 1:A.call(this,
this.sourceNodes[v.id].duplicatedNodes[v.localId]);f.push.apply(f,$jscomp.arrayFromIterable(v.children));break;default:this.removeProductNode(v.localId,!0,e)}}h.parent&&h.parent.children.splice(h.parent.children.indexOf(h),1);delete h.productNode.duplicatedNodes[h.localId];delete this.productNodeInstancesByLocalId[h.localId];this.apiCore.exec(this.callerName,"freePlannerFixedPosition",h);this.apiCore.exec(this.callerName,"rdr.renderProductNodeInstanceAsGhost",h,!1);h.rigidBody&&(this.physics.world.removeBody(h.rigidBody),
this.physics.rigidBodies.splice(this.physics.rigidBodies.indexOf(h.rigidBody),1),delete h.rigidBody);w.call(this,h);this.root.localId==b?(delete this.root,this.nodesInUse=[]):d||(this.updateSceneNodes(),this.computeSceneBoundingBoxes());e||this.apiCore.exec(this.callerName,"productNodeInstanceRemoved",h);++this.needsUpdate}};b.prototype.removeProductNodes=function(b,d){for(var h=0;h<b.length;++h)this.removeProductNode(b[h],!0,d);this.updateSceneNodes();this.prepareScene();++this.needsUpdate};b.prototype.updateProductNodeInstanceTransformationFromMatrix=
function(b){b.position=vec3.create([b.matrix[12],b.matrix[13],b.matrix[14]]);b.scaling=vec3.create([vec3.length([b.matrix[0],b.matrix[1],b.matrix[2]]),vec3.length([b.matrix[4],b.matrix[5],b.matrix[6]]),vec3.length([b.matrix[8],b.matrix[9],b.matrix[10]])]);if(0<vec3.length(b.scaling)){var d=b.matrix[1]/b.scaling[1],h=b.matrix[2]/b.scaling[2],e=b.matrix[4]/b.scaling[0],f=b.matrix[6]/b.scaling[2],m=b.matrix[8]/b.scaling[0],p=b.matrix[9]/b.scaling[1];b.rotationAngle=Math.acos((b.matrix[0]/b.scaling[0]+
b.matrix[5]/b.scaling[1]+b.matrix[10]/b.scaling[2]-1)/2);b.rotationAngle&&(b.rotationAxis=vec3.create([(f-p)/Math.sqrt(Math.pow(f-p,2)+Math.pow(m-h,2)+Math.pow(d-e,2)),(m-h)/Math.sqrt(Math.pow(f-p,2)+Math.pow(m-h,2)+Math.pow(d-e,2)),(d-e)/Math.sqrt(Math.pow(f-p,2)+Math.pow(m-h,2)+Math.pow(d-e,2))]))}};b.prototype.updateProductNodeInstanceTransformation=function(b){mat4.translate(mat4.identity(b.matrix),b.position);mat4.translate(b.matrix,[0,b.floorOffset,0]);b.rigidBody?mat4.translate(b.matrix,b.rigidBody.emersyaOffset):
mat4.scale(b.matrix,b.scaling);mat4.rotate(b.matrix,b.rotationAngle,b.rotationAxis);b.rigidBody&&(mat4.translate(b.matrix,[-b.rigidBody.emersyaOffset[0],-b.rigidBody.emersyaOffset[1],-b.rigidBody.emersyaOffset[2]]),mat4.scale(b.matrix,b.scaling));if(b.snapBoundingBox){var d=b.snapBoundingBox,h=mat4.scale(mat4.create(b.matrix),[1/b.scaling[0],1/b.scaling[1],1/b.scaling[2]]);mat4.translate(h,b.rigidBody.emersyaOffset);for(var e=0;e<d.vecs.length;++e)mat4.multiplyVec3(h,d.vecs[e],b.fullyTransformedSnapBoundingBox.vecs[e]),
e?(b.fullyTransformedSnapBoundingBox.minX=Math.min(b.fullyTransformedSnapBoundingBox.minX,b.fullyTransformedSnapBoundingBox.vecs[e][0]),b.fullyTransformedSnapBoundingBox.maxX=Math.max(b.fullyTransformedSnapBoundingBox.maxX,b.fullyTransformedSnapBoundingBox.vecs[e][0]),b.fullyTransformedSnapBoundingBox.minY=Math.min(b.fullyTransformedSnapBoundingBox.minY,b.fullyTransformedSnapBoundingBox.vecs[e][1]),b.fullyTransformedSnapBoundingBox.maxY=Math.max(b.fullyTransformedSnapBoundingBox.maxY,b.fullyTransformedSnapBoundingBox.vecs[e][1]),
b.fullyTransformedSnapBoundingBox.minZ=Math.min(b.fullyTransformedSnapBoundingBox.minZ,b.fullyTransformedSnapBoundingBox.vecs[e][2]),b.fullyTransformedSnapBoundingBox.maxZ=Math.max(b.fullyTransformedSnapBoundingBox.maxZ,b.fullyTransformedSnapBoundingBox.vecs[e][2])):(b.fullyTransformedSnapBoundingBox.minX=b.fullyTransformedSnapBoundingBox.maxX=b.fullyTransformedSnapBoundingBox.vecs[e][0],b.fullyTransformedSnapBoundingBox.minY=b.fullyTransformedSnapBoundingBox.maxY=b.fullyTransformedSnapBoundingBox.vecs[e][1],
b.fullyTransformedSnapBoundingBox.minZ=b.fullyTransformedSnapBoundingBox.maxZ=b.fullyTransformedSnapBoundingBox.vecs[e][2]);b.rotationAngle?mat4.rotate(mat4.identity(h),b.rotationAngle,b.rotationAxis):mat4.identity(h);for(e=0;e<d.vecs.length;++e)mat4.multiplyVec3(h,d.vecs[e],b.transformedSnapBoundingBox.vecs[e]),e?(b.transformedSnapBoundingBox.minX=Math.min(b.transformedSnapBoundingBox.minX,b.transformedSnapBoundingBox.vecs[e][0]),b.transformedSnapBoundingBox.maxX=Math.max(b.transformedSnapBoundingBox.maxX,
b.transformedSnapBoundingBox.vecs[e][0]),b.transformedSnapBoundingBox.minY=Math.min(b.transformedSnapBoundingBox.minY,b.transformedSnapBoundingBox.vecs[e][1]),b.transformedSnapBoundingBox.maxY=Math.max(b.transformedSnapBoundingBox.maxY,b.transformedSnapBoundingBox.vecs[e][1]),b.transformedSnapBoundingBox.minZ=Math.min(b.transformedSnapBoundingBox.minZ,b.transformedSnapBoundingBox.vecs[e][2]),b.transformedSnapBoundingBox.maxZ=Math.max(b.transformedSnapBoundingBox.maxZ,b.transformedSnapBoundingBox.vecs[e][2])):
(b.transformedSnapBoundingBox.minX=b.transformedSnapBoundingBox.maxX=b.transformedSnapBoundingBox.vecs[e][0],b.transformedSnapBoundingBox.minY=b.transformedSnapBoundingBox.maxY=b.transformedSnapBoundingBox.vecs[e][1],b.transformedSnapBoundingBox.minZ=b.transformedSnapBoundingBox.maxZ=b.transformedSnapBoundingBox.vecs[e][2])}b.rigidBody&&b.rigidBody.computeAABB()};b.prototype.translateProductNodeInstance=function(b,d){void 0!==b.handleVerticalOffset&&(b.handleVerticalOffset+=d[1]-b.position[1]);b.position=
d;b.rigidBody&&b.rigidBody.position.set(b.position[0]+b.rigidBody.emersyaOffset[0],b.position[1]+b.rigidBody.emersyaOffset[1]+b.floorOffset,b.position[2]+b.rigidBody.emersyaOffset[2]);this.updateProductNodeInstanceTransformation(b)};b.prototype.rotateProductNodeInstance=function(b,d,e){var h=null;if(e){for(var f=0;f<this.nodesInUse.length;++f)this.updateMatrices(this.nodesInUse[f]);this.recursiveComputeBoundingBoxes(b);h=this.copyBoundingBox(b.boundingBox)}b.rotationAxis=d;b.rotationAngle=e;b.rigidBody&&
b.rigidBody.quaternion.setFromAxisAngle({x:d[0],y:d[1],z:d[2]},e);if(e){this.updateProductNodeInstanceTransformation(b);for(f=0;f<this.nodesInUse.length;++f)this.updateMatrices(this.nodesInUse[f]);this.recursiveComputeBoundingBoxes(b);b.floorOffset+=h.minY-b.boundingBox.minY;b.rigidBody&&b.rigidBody.position.set(b.position[0]+b.rigidBody.emersyaOffset[0],b.position[1]+b.rigidBody.emersyaOffset[1]+b.floorOffset,b.position[2]+b.rigidBody.emersyaOffset[2])}this.updateProductNodeInstanceTransformation(b)};
b.prototype.scaleProductNodeInstance=function(b,d){b.scaling=d;this.updateProductNodeInstanceTransformation(b)};var H=[[0,0,0],[0,0,0]];b.prototype.checkContacts=function(){if(!this.physics)return{};for(var b=0;b<this.physics.rigidBodies.length;++b)this.physics.rigidBodies[b].type=CANNON.Body.DYNAMIC,this.physics.rigidBodies[b].velocity.set(0,0,0),this.physics.rigidBodies[b].angularVelocity.set(0,0,0),this.physics.rigidBodies[b].force.set(0,0,0);this.physics.world.step(1E-20);var d={};for(b=0;b<this.physics.world.contacts.length;b++){for(var e=
this.physics.world.contacts[b],f=0;2>f;f++){var m=0===f?e.bi:e.bj,p=0===f?e.ri:e.rj;H[f][0]=m.position.x+p.x;H[f][1]=m.position.y+p.y;H[f][2]=m.position.z+p.z}.01<vec3.length(vec3.subtract(H[0],H[1]))&&(e.bi.pnInstance&&e.bj.pnInstance?(d[e.bi.pnInstance.localId]||(d[e.bi.pnInstance.localId]={}),d[e.bi.pnInstance.localId][e.bj.pnInstance.localId]=e,d[e.bj.pnInstance.localId]||(d[e.bj.pnInstance.localId]={}),d[e.bj.pnInstance.localId][e.bi.pnInstance.localId]=e):(e.bi.pnInstance&&e.bj!=this.physics.groundBody&&
(pnInstancesInContacta[e.bi.pnInstance.localId]={}),e.bj.pnInstance&&e.bi!=this.physics.groundBody&&(d[e.bj.pnInstance.localId]={})))}for(b=0;b<this.physics.rigidBodies.length;++b)this.physics.rigidBodies[b].type=CANNON.Body.STATIC,this.physics.rigidBodies[b].velocity.set(0,0,0),this.physics.rigidBodies[b].angularVelocity.set(0,0,0),this.physics.rigidBodies[b].force.set(0,0,0);return d};b.prototype.updateMatrices=function(b){mat4.identity(b.modelMatrix);for(var d in b.matricesList)mat4.multiply(b.modelMatrix,
b.matricesList[d]);mat4.toInverseMat3(b.modelMatrix,b.invModelMatrix3);mat3.transpose(b.invModelMatrix3,b.normalModelMatrix);d=b.animations.getOpacity();for(var e=b.parent;e;)d*=e.animations.getOpacity(),e=e.parent;b.opacity=d;d=!1;e=b.animations.isOpaque();e!=b.wasOpaque&&(d=!0);b.wasOpaque=e;return d};b.prototype.setNodeAnimations=function(b,d,e,f,m){var h=null,p;for(p in this.nodesInUse){var v=this.nodesInUse[p];if(parseInt(v.id)===parseInt(b)&&parseInt(v.localId)===parseInt(d)){h=v;break}}if(h)for(p in m&&
h.animations.reset(),void 0!==f&&h.animations.setCallback(f),e)h.animations.addAnimations(e[p])};b.prototype.resetNodesAnimations=function(){for(var b in this.nodesInUse){var d=this.nodesInUse[b];d.animations.reset();d.opacity=1;d.baseOpacity=1;this.updateMatrices(d)}++this.needsUpdate};b.prototype.setNodeManualAnimations=function(b,d,e){var h=null,f;for(f in this.nodesInUse){var m=this.nodesInUse[f];if(m.id===b&&m.localId===d){h=m;break}}if(h)for(f in h.animations.reset(),h.opacity=1,h.baseOpacity=
1,h.animations.setManualMode(),e)h.animations.addAnimations(e[f])};b.prototype.setNodeAnimationProgression=function(b,d,e){var h=null,f;for(f in this.nodesInUse){var m=this.nodesInUse[f];if(m.id===b&&m.localId===d){h=m;break}}if(h){h.animations.setProgression(e);for(f in this.nodesInUse)this.updateMatrices(this.nodesInUse[f]);++this.needsUpdate}};b.prototype.toggleNodeAnimations=function(b,d){var e=null,h;for(h in this.nodesInUse){var f=this.nodesInUse[h];if(f.id===b&&f.localId===d){e=f;break}}if(e){e.animations.toggle();
for(h in this.nodesInUse)this.updateMatrices(this.nodesInUse[h]);++this.needsUpdate}};b.prototype.toggleMaterialAnimations=function(b){for(var d in b.mtIds){var e=this.materialTrees[b.mtIds[d]],h;for(h in e.polylistInstances)e.polylistInstances[h].matAnim.toggle()}++this.needsUpdate};b.prototype.setMaterialTreeAnimations=function(b){for(var d in b.mtIds){for(var e=this.materialTrees[b.mtIds[d]],h=null,f=b.animations.length-1;0<=f&&null===h;--f)b.animations[f].empty||(h=this.materialsContent.materialSettingsByName[e.id][b.animations[f].material_settings]);
for(var m in e.polylistInstances){var p=e.polylistInstances[m].matAnim;p.resetMaterial(p.currentMaterial);var g=e.currentMaterialId;for(f in b.animations){var n=this.materialsContent.materialSettingsByName[e.id][b.animations[f].material_settings];null===n||void 0===n?p.addAnimations(b.animations[f],this.materials[g]):(p.addAnimations(b.animations[f],this.materials[n.id]),g=n.id)}}e.currentMaterialId=h.id}};b.prototype.resetMaterialsAnimations=function(){this.polylistInstances.forEach(function(b){return b.matAnim.resetMaterial(b.matAnim.currentMaterial)});
++this.needsUpdate};b.prototype.findMaterialTreeByPolylistName=function(b){for(var d in this.nodesInUse){var e=this.nodesInUse[d];if(e.polylistIds)for(var h in e.typedMaterials)for(var f in e.typedMaterials[h])if(this.polylists[e.typedMaterials[h][f].polylist].name==b)return this.materialTrees[e.typedMaterials[h][f].material]}return null};var e=function(b){return new stage.emersya.viewer.modules.renderer.animations.animManager(b)};b.prototype.updateSceneNodes=function(){this.nodesInUse=[];for(var b=
[this.root],d=0;d<b.length;++d){var f=b[d];this.nodesInUse.push(f);f.graphId=++this.graphIds;f.opacity=1;f.baseOpacity=1;f.animations=e(f);b.push.apply(b,$jscomp.arrayFromIterable(f.children))}};b.prototype.prepareScene=function(){for(var b in this.polylists){var d=this.polylists[b],e=this.getFromInstanceParent(d,"Geometry",d.geometryId);e&&(d.geometry=e,!d.list&&void 0!==d.basePolylistId&&this.polylists[d.basePolylistId]&&(e=this.polylists[d.basePolylistId],e.list&&(d.list=new Int32Array(e.list.length),
d.list.set(e.list)),e.edges&&(d.edges=new Int32Array(e.edges.length),d.edges.set(e.edges))),this.wearableAR&&this.wearableAR.enabled&&(d.isHidden=-1!==this.wearableAR.arSpecificPolylists.indexOf(d.id)))}this.recursiveComputeMatrices(this.root,mat4.identity(mat4.create()));this.computeSceneBoundingBoxes();this.computeSceneRealMeasurementScalingFactors(this.arData);this.computeBaseNodesBoundingBoxes();this.updateSceneMaterialsPolylists()};b.prototype.updateSceneMaterialsPolylists=function(){this.updateScenePolylistsBoundingBoxes()};
b.prototype.resetNodesInUse=function(){this.nodesInUse=[];for(var b=[this.root],d=0;d<b.length;++d)this.nodesInUse.push(b[d]),b.push.apply(b,$jscomp.arrayFromIterable(b[d].children))};b.prototype.getAllSourceModels=function(b){var d=[],e=stage.emersya.appManager||stage.emersya.collaborativeDesignManager;if(e){var h=0,f;for(f in this.productNodes){var m=this.productNodes[f];!m.sourceModel||b&&m.sourceModel.downloaded||(d.push(m.sourceModel),h+=m.sourceModel.fileSize)}if(10<=d.length&&2E7<=h||20<=d.length)e=
!1,d=[]}if(!e)for(e=[this.root],f=0;f<e.length;++f)for(h=e[f].sourceModel,!h||-1!=d.indexOf(h)||b&&h.downloaded||d.push(h),h=0;h<e[f].children.length;++h)e.push(e[f].children[h]);return d};b.prototype.getAllSourceModelsNotDownloadedYet=function(){return this.getAllSourceModels(!0)};b.prototype.calculateAutoSettings=function(b){this.root.boundingBox||this.computeSceneBoundingBoxes();var d=this.root.boundingBox;var e=.8/Math.max(d.maxZ-d.minZ,Math.max(d.maxX-d.minX,d.maxY-d.minY));var h=this.root.boundingBox;
d=h.minX+(h.maxX-h.minX)/2;var f=h.minY+(h.maxY-h.minY)/2;h=h.minZ+(h.maxZ-h.minZ)/2;void 0!==b&&(e*=b/40);return{position:[d+1/e,f+1/e,h+1/e],target:[d,f,h],up:[0,1,0]}};b.prototype.createBoundingBox=function(){for(var b=new ArrayBuffer(108),d=new Float32Array(b,0,27),e=0;27>e;e++)d[e]=0;return{_buffer:b,minX:0,maxX:0,minY:0,maxY:0,minZ:0,maxZ:0,radius:0,center:new Float32Array(b,0,3),vecs:[new Float32Array(b,12,3),new Float32Array(b,24,3),new Float32Array(b,36,3),new Float32Array(b,48,3),new Float32Array(b,
60,3),new Float32Array(b,72,3),new Float32Array(b,84,3),new Float32Array(b,96,3)]}};b.prototype.createAndFillBoundingBox=function(b,d,e,f,m,p){var h=new ArrayBuffer(108),v=new Float32Array(h,0,27);v[0]=0;v[1]=0;v[2]=0;v[3]=b;v[4]=e;v[5]=m;v[6]=b;v[7]=e;v[8]=p;v[9]=b;v[10]=f;v[11]=m;v[12]=b;v[13]=f;v[14]=p;v[15]=d;v[16]=e;v[17]=m;v[18]=d;v[19]=e;v[20]=p;v[21]=d;v[22]=f;v[23]=m;v[24]=d;v[25]=f;v[26]=p;b={_buffer:h,minX:b,maxX:d,minY:e,maxY:f,minZ:m,maxZ:p,center:new Float32Array(h,0,3),vecs:[new Float32Array(h,
12,3),new Float32Array(h,24,3),new Float32Array(h,36,3),new Float32Array(h,48,3),new Float32Array(h,60,3),new Float32Array(h,72,3),new Float32Array(h,84,3),new Float32Array(h,96,3)],radius:Math.max(Math.abs(d-b),Math.max(Math.abs(f-e),Math.abs(p-m)))};vec3.add([b.minX,b.minY,b.minZ],[b.maxX,b.maxY,b.maxZ],b.center);vec3.scale(b.center,.5);return b};b.prototype.copyBoundingBox=function(b,d){if(d)return d.minX=b.minX,d.maxX=b.maxX,d.minY=b.minY,d.maxY=b.maxY,d.minZ=b.minZ,d.maxZ=b.maxZ,d.center=vec3.create(b.center),
d.radius=b.radius,vec3.set(b.vecs[0],d.vecs[0]),vec3.set(b.vecs[1],d.vecs[1]),vec3.set(b.vecs[2],d.vecs[2]),vec3.set(b.vecs[3],d.vecs[3]),vec3.set(b.vecs[4],d.vecs[4]),vec3.set(b.vecs[5],d.vecs[5]),vec3.set(b.vecs[6],d.vecs[6]),vec3.set(b.vecs[7],d.vecs[7]),d;d=new ArrayBuffer(108);new Float32Array(d,0,27);(new Float32Array(d)).set(new Float32Array(b._buffer));return{_buffer:d,minX:b.minX,maxX:b.maxX,minY:b.minY,maxY:b.maxY,minZ:b.minZ,maxZ:b.maxZ,center:new Float32Array(d,0,3),radius:b.radius,vecs:[new Float32Array(d,
12,3),new Float32Array(d,24,3),new Float32Array(d,36,3),new Float32Array(d,48,3),new Float32Array(d,60,3),new Float32Array(d,72,3),new Float32Array(d,84,3),new Float32Array(d,96,3)]}};b.prototype.mergeBoundingBoxes=function(b,d){if(!b||0==b.length)return d;d=this.copyBoundingBox(b[0],d);for(var e=1;e<b.length;++e)b[e].minX<d.minX&&(d.minX=b[e].minX),b[e].maxX>d.maxX&&(d.maxX=b[e].maxX),b[e].minY<d.minY&&(d.minY=b[e].minY),b[e].maxY>d.maxY&&(d.maxY=b[e].maxY),b[e].minZ<d.minZ&&(d.minZ=b[e].minZ),b[e].maxZ>
d.maxZ&&(d.maxZ=b[e].maxZ);vec3.add([d.minX,d.minY,d.minZ],[d.maxX,d.maxY,d.maxZ],d.center);vec3.scale(d.center,.5);d.radius=Math.max(Math.abs(d.maxX-d.minX),Math.max(Math.abs(d.maxY-d.minY),Math.abs(d.maxZ-d.minZ)));vec3.set([d.minX,d.minY,d.minZ],d.vecs[0]);vec3.set([d.minX,d.minY,d.maxZ],d.vecs[1]);vec3.set([d.minX,d.maxY,d.minZ],d.vecs[2]);vec3.set([d.minX,d.maxY,d.maxZ],d.vecs[3]);vec3.set([d.maxX,d.minY,d.minZ],d.vecs[4]);vec3.set([d.maxX,d.minY,d.maxZ],d.vecs[5]);vec3.set([d.maxX,d.maxY,d.minZ],
d.vecs[6]);vec3.set([d.maxX,d.maxY,d.maxZ],d.vecs[7]);return d};b.prototype.moveBBox=function(b,d){b.minX+=d[0];b.maxX+=d[0];b.minY+=d[1];b.maxY+=d[1];b.minZ+=d[2];b.maxZ+=d[2];vec3.add(b.center,d);vec3.add(b.vecs[0],d);vec3.add(b.vecs[1],d);vec3.add(b.vecs[2],d);vec3.add(b.vecs[3],d);vec3.add(b.vecs[4],d);vec3.add(b.vecs[5],d);vec3.add(b.vecs[6],d);vec3.add(b.vecs[7],d)};b.prototype.areBoundingBoxesColliding=function(b,d){return b.maxX>d.minX+this.epsilon&&b.minX+this.epsilon<d.maxX&&b.maxY>d.minY+
this.epsilon&&b.minY+this.epsilon<d.maxY&&b.maxZ>d.minZ+this.epsilon&&b.minZ+this.epsilon<d.maxZ};b.prototype.areBoundingBoxesArraysColliding=function(b,d){for(var e=!1,h=0;h<b.length&&!e;++h)for(var f=0;f<d.length&&!e;++f)e=this.areBoundingBoxesColliding(b[h],d[f]);return e};b.prototype.transformBoundingBox=function(b,d,e){e||(e=this.createBoundingBox());for(var h=0;h<b.vecs.length;++h)mat4.multiplyVec3(d,b.vecs[h],e.vecs[h]),h?(e.minX=Math.min(e.minX,e.vecs[h][0]),e.maxX=Math.max(e.maxX,e.vecs[h][0]),
e.minY=Math.min(e.minY,e.vecs[h][1]),e.maxY=Math.max(e.maxY,e.vecs[h][1]),e.minZ=Math.min(e.minZ,e.vecs[h][2]),e.maxZ=Math.max(e.maxZ,e.vecs[h][2])):(e.minX=e.maxX=e.vecs[h][0],e.minY=e.maxY=e.vecs[h][1],e.minZ=e.maxZ=e.vecs[h][2]);return e};b.prototype.setMinDistanceBBox=function(b){this.minDistanceBBox=b};b.prototype.computeNodeBoundingBox=function(b){void 0===b.parent&&(b=this.getNodeFromId(b.id));if(!b.polylists||!b.polylists.length)return null;for(var d=[],e=0;e<b.polylists.length;++e)b.polylists[e].polylist.boundingBox&&
d.push(b.polylists[e].polylist.boundingBox);return res=this.mergeBoundingBoxes(d,this.createBoundingBox())};b.prototype.computePolylistsBoundingBoxes=function(){for(var b in this.polylists){var d=this.polylists[b],e=d.geometry;if(e&&d.list&&!d.boundingBox&&e.dataBuffers.length&&d.list.length){var f,m,p;var g=f=e.dataBuffers[0].vertices[3*e.dataBuffers[0].faces[d.list[0][0]*e.dataBuffers[0].polySize]];var n=m=e.dataBuffers[0].vertices[3*e.dataBuffers[0].faces[d.list[0][0]*e.dataBuffers[0].polySize]+
1];var k=p=e.dataBuffers[0].vertices[3*e.dataBuffers[0].faces[d.list[0][0]*e.dataBuffers[0].polySize]+2];for(var l,r=0;r<d.list.length;++r){var q=d.list[r],t=e.dataBuffers[r];for(b=0;b<q.length;++b)for(var A=t.polySize*q[b],B=0;B<t.polySize;++B)l=3*(A+B),t.vertices[l]<g&&(g=t.vertices[l]),t.vertices[l]>f&&(f=t.vertices[l]),t.vertices[l+1]<n&&(n=t.vertices[l+1]),t.vertices[l+1]>m&&(m=t.vertices[l+1]),t.vertices[l+2]<k&&(k=t.vertices[l+2]),t.vertices[l+2]>p&&(p=t.vertices[l+2])}d.boundingBox=this.createAndFillBoundingBox(g,
f,n,m,k,p);0===d.refractDistance&&(d.refractDistance=.03*d.boundingBox.radius)}}};b.prototype.applyMatrixToBoundingBox=function(b,d){for(var e in b.vecs)mat4.multiplyVec3(d,b.vecs[e]);b.minX=b.vecs[0][0];b.maxX=b.vecs[7][0];b.minY=b.vecs[0][1];b.maxY=b.vecs[7][1];b.minZ=b.vecs[0][2];b.maxZ=b.vecs[7][2];for(e=0;8>e;++e)b.vecs[e][0]<b.minX&&(b.minX=b.vecs[e][0]),b.vecs[e][0]>b.maxX&&(b.maxX=b.vecs[e][0]),b.vecs[e][1]<b.minY&&(b.minY=b.vecs[e][1]),b.vecs[e][1]>b.maxY&&(b.maxY=b.vecs[e][1]),b.vecs[e][2]<
b.minZ&&(b.minZ=b.vecs[e][2]),b.vecs[e][2]>b.maxZ&&(b.maxZ=b.vecs[e][2]);vec3.add([b.minX,b.minY,b.minZ],[b.maxX,b.maxY,b.maxZ],b.center);vec3.scale(b.center,.5);b.radius=Math.max(Math.abs(b.maxX-b.minX),Math.max(Math.abs(b.maxY-b.minY),Math.abs(b.maxZ-b.minZ)));return b};b.prototype.updateNodeBoundingBoxFromRaw=function(b){if(b.rawGeometryBoundingBox){var d=this.copyBoundingBox(b.rawGeometryBoundingBox,b.geometryBoundingBox);this.applyMatrixToBoundingBox(d,b.modelMatrix);b.geometryBoundingBox=d}else b.geometryBoundingBox=
null};b.prototype.recursiveComputeBoundingBoxes=function(b){void 0===b.parent&&(b=this.getNodeFromId(b.id));b.boundingBox||(b.boundingBox=this.createBoundingBox());b.rawGeometryBoundingBox=this.computeNodeBoundingBox(b);this.updateNodeBoundingBoxFromRaw(b);for(var d in b.children)this.recursiveComputeBoundingBoxes(b.children[d]);this.updateBBoxFromChildren(b);b.bBoxAnimations=e(b);if(b.polylists)for(d=0;d<b.polylists.length;d++)b.polylists[d]&&b.polylists[d].matAnim&&b.polylists[d].matAnim.updateMaterialSettingsWhenBoundingBoxChange();
return b.boundingBox};b.prototype.recursiveComputeBoundingBoxesWithoutNodes=function(b,d){void 0===b.parent&&(b=this.getNodeFromId(b.id));var e=d;if(!e){switch(b.type){case 0:case 2:case 3:e=(e=this.getFromInstanceParent(b.productNode,"ArData",1))?[].concat($jscomp.arrayFromIterable(e.excludedPolylists)):[];break;case 1:e=(e=this.getFromInstanceParent(b.sourceNode,"ArData",1))?[].concat($jscomp.arrayFromIterable(e.excludedPolylists)):[];break;default:e=[]}e.push.apply(e,$jscomp.arrayFromIterable(this.arExcludedPolylists))}for(var h in b.children)this.recursiveComputeBoundingBoxesWithoutNodes(b.children[h],
d);this.updateBBoxFromChildrenWithoutNodes(b,e)};b.prototype.updateBBoxFromChildren=function(b){void 0===b.parent&&(b=this.getNodeFromId(b.id));var d=[];null!==b.geometryBoundingBox&&d.push(b.geometryBoundingBox);for(var e=0;e<b.children.length;++e)d.push(b.children[e].boundingBox);0!=d.length?this.mergeBoundingBoxes(d,b.boundingBox):b.boundingBox=this.createBoundingBox()};b.prototype.updateBBoxFromChildrenWithoutNodes=function(b,d){d||(d=[]);void 0===b.parent&&(b=this.getNodeFromId(b.id));var e=
[];if(b.polylists&&0<b.polylists.length){b.rawGeometryBoundingBoxWithoutNodes||(b.rawGeometryBoundingBoxWithoutNodes=this.createBoundingBox());b.geometryBoundingBoxWithoutNodes||(b.geometryBoundingBoxWithoutNodes=this.createBoundingBox());for(var h=[],f=0;f<b.polylists.length;f++)d.includes(this.getOriginalIdFromInstance(b.polylists[f].polylist))||h.push(b.polylists[f].polylist.boundingBox);0<h.length&&(this.mergeBoundingBoxes(h,b.rawGeometryBoundingBoxWithoutNodes),this.copyBoundingBox(b.rawGeometryBoundingBoxWithoutNodes,
b.geometryBoundingBoxWithoutNodes),this.applyMatrixToBoundingBox(b.geometryBoundingBoxWithoutNodes,b.modelMatrix),e.push(b.geometryBoundingBoxWithoutNodes))}for(d=0;d<b.children.length;++d)b.children[d].boundingBoxWithoutNodes&&e.push(b.children[d].boundingBoxWithoutNodes);0!=e.length?(b.boundingBoxWithoutNodes||(b.boundingBoxWithoutNodes=this.createBoundingBox()),this.mergeBoundingBoxes(e,b.boundingBoxWithoutNodes)):delete b.boundingBoxWithoutNodes};b.prototype.computeSceneBoundingBoxes=function(){this.updatedBoundingBox=
!0;this.computePolylistsBoundingBoxes();this.recursiveComputeBoundingBoxes(this.root);this.recursiveComputeBoundingBoxesWithoutNodes(this.root)};b.prototype.updateScenePolylistsBoundingBoxes=function(){for(var b in this.polylists){var d=this.polylists[b];if(d.boundingBox){var e=this.copyBoundingBox(d.boundingBox,d.nodeBoundingBox);d.nodeBoundingBox=e}}};b.prototype.updateSceneBoundingBoxesFromRaw=function(){for(var b in this.nodesInUse)this.updateNodeBoundingBoxFromRaw(this.nodesInUse[b]);for(b=this.nodesInUse.length-
1;0<=b;--b)this.updateBBoxFromChildren(this.nodesInUse[b]);this.updateScenePolylistsBoundingBoxes()};b.prototype.updateBoundingBoxesFromNode=function(b,d){void 0===b.parent&&(b=this.getNodeFromId(b.id));for(var e=[b],h=0;h<e.length;++h){this.moveBBox(e[h].boundingBox,d);for(var f=0;f<e[h].children.length;++f)e.push(e[h].children[f])}for(;b=b.parent;)this.updateBBoxFromChildren(b)};b.prototype.backupBoundingBoxes=function(){for(var b=[this.root],d=0;d<b.length;++d){b[d].BBBox=this.copyBoundingBox(b[d].boundingBox);
for(var e=0;e<b[d].children.length;++e)b.push(b[d].children[e])}};b.prototype.restoreBoundingBoxes=function(){for(var b=[this.root],d=0;d<b.length;++d){b[d].boundingBox=b[d].BBBox;b[d].BBBox=null;for(var e=0;e<b[d].children.length;++e)b.push(b[d].children[e])}};b.prototype.getDisplayedBoundingBox=function(){var b=[],d;for(d in this.polylistInstances){var e=this.polylistInstances[d];e.isHidden()||b.push(e.node.boundingBox)}return this.mergeBoundingBoxes(b)};b.prototype.computeBaseNodesBoundingBoxes=
function(){for(var b in this.productNodes){var d=this.productNodes[b];d.boundingBox||!d.sourceNode||d.sourceModel&&!d.sourceModel.downloaded||(d.modelMatrix=mat4.create(d.matrix),this.recursiveComputeSourceNodeBoundingBoxes(d.sourceNode,d),d.boundingBox=this.copyBoundingBox(d.sourceNode.boundingBox))}};b.prototype.recursiveComputeSourceNodeBoundingBoxes=function(b,d){if(!b.boundingBox){b.boundingBox=this.createBoundingBox();b.modelMatrix=mat4.multiply(d.modelMatrix,b.matrix,mat4.create());b.rawGeometryBoundingBox=
this.computeSourceNodeBoundingBox(b);this.updateNodeBoundingBoxFromRaw(b);for(var e in b.children)this.recursiveComputeSourceNodeBoundingBoxes(b.children[e],b);this.updateBBoxFromChildren(b);return b.boundingBox}};b.prototype.computeSourceNodeBoundingBox=function(b){if(!b.polylistIds||!b.polylistIds.length)return null;for(var d=[],e=0;e<b.polylistIds.length;++e)d.push(this.polylists[b.polylistIds[e]].boundingBox);return res=this.mergeBoundingBoxes(d,this.createBoundingBox())};b.prototype.adjustDirectionalShadow=
function(b,d,e){e=e||this.getDisplayedBoundingBox();if(!e)return{near:0,far:0,left:0,right:0,top:0,bottom:0,pos:d};vec3.add(e.center,vec3.scale(b,-(e.radius||Math.max(Math.abs(e.maxX-e.minX),Math.max(Math.abs(e.maxY-e.minY),Math.abs(e.maxZ-e.minZ)))),vec3.create()),d);var f=vec3.create(),h=vec3.create(),m=vec3.create([0,1,0]);vec3.set(d,h);.1>vec3.length(vec3.cross(vec3.normalize(h),m))&&vec3.set([0,0,1],m);vec3.add(d,b,f);var p=mat4.lookAt(d,f,m),g=vec3.create(),n=Number.POSITIVE_INFINITY,v=0,k=
0,l=0,r=0,q=0;e.vecs.forEach(function(b){mat4.multiplyVec3(p,b,g);0<g[0]?l=Math.max(l,g[0]):k=Math.min(k,g[0]);0<g[1]?r=Math.max(r,g[1]):q=Math.min(q,g[1]);b=Math.abs(g[2]);v=Math.max(v,2*b);n=Math.min(n,b)});return{near:n,far:v,left:k,right:l,top:r,bottom:q,pos:d}};b.prototype.computeWorldCoordinates=function(b,d,e){return(d=this.sourceNodesByFullId[e+"-"+d])?mat4.multiplyVec3(d.modelMatrix,b,vec3.create()):b};b.prototype.computeLocalCoordinates=function(b,d,e){return(d=this.sourceNodesByFullId[e+
"-"+d])?mat4.multiplyVec3(mat4.inverse(d.modelMatrix,mat4.create()),b,vec3.create()):b};b.prototype.computeUVCoverage=function(b,d){for(var e={minX:null,maxX:null,minY:null,maxY:null},f=b.geometry,h=0;h<f.dataBuffers.length;++h)for(var m=f.dataBuffers[h],p=b.list[h],g=m.polySize,n=0;n<p.length;++n)for(var v=p[n],k=0;k<g;++k){var l=m.faces[g*v+k],r=m.uvs[d][2*l];l=m.uvs[d][2*l+1];e.minX=null===e.minX?r:Math.min(e.minX,r);e.minY=null===e.minY?l:Math.min(e.minY,l);e.maxX=null===e.maxX?r:Math.max(e.maxX,
r);e.maxY=null===e.maxY?l:Math.max(e.maxY,l)}return e};b.prototype.getNodeFromId=function(b){if(this.root.id==b)return this.root;for(var d=[this.root],e=0;e<d.length;++e)for(var f=0;f<d[e].children.length;++f){if(d[e].children[f].id==b)return d[e].children[f];d.push(d[e].children[f])}return null};b.prototype.getPolylistFromId=function(b){if(this.root.id==b)return this.root;for(var d=[this.root],e=0;e<d.length;++e){if(d[e].polylists)for(var f=0;f<d[e].polylists.length;++f)if(d[e].polylists[f].polylist.id==
b)return d[e].polylists[f].polylist;for(f=0;f<d[e].children.length;++f)d.push(d[e].children[f])}return null};b.prototype.removeNode=function(b){(b=this.getNodeFromId(b.id))&&b.parent.children.splice(b.parent.children.indexOf(b),1)};b.prototype.computeTransfMatrix=function(b){if(!b)return mat4.identity(mat4.create());void 0===b.parent&&(b=this.getNodeFromId(b.id));var d=mat4.identity(mat4.create()),e=b;for(b=[];null!=e;)b.push(e.matrix),e=e.parent;for(e=b.length-1;0<=e;e--)mat4.multiply(d,b[e]);return d};
b.prototype.computeNodePosition=function(b){void 0===b.parent&&(b=this.getNodeFromId(b.id));b=this.computeTransfMatrix(b);return mat4.multiplyVec3(b,vec3.create([0,0,0]))};b.prototype.setNodePosition=function(b,d){void 0===b.parent&&(b=this.getNodeFromId(b.id));var e=this.computeNodePosition(b);d=vec3.subtract(d,e,vec3.create());e=mat4.toRotationMat(this.computeTransfMatrix(b));d=mat4.multiplyVec3(mat4.inverse(e,mat4.create()),d,vec3.create());d=mat4.translate(mat4.identity(mat4.create()),d);mat4.multiply(b.matrix,
d,b.matrix)};b.prototype.highlightNode=function(b){this.changeNodeHighlight(b,!0);++this.needsUpdate};b.prototype.dehighlightNode=function(b){this.changeNodeHighlight(b,!1);++this.needsUpdate};b.prototype.changeNodeHighlight=function(b,d){this.changeNode(b,d,"highlighted")};b.prototype.changeNode=function(b,d,e){var f=[b];void 0===d&&(d=!b[e]);for(b=0;b<f.length;++b){f[b][e]=d;for(var h in f[b].polylists)this.polylists[f[b].polylists[h]][e]=d;for(h=0;h<f[b].children.length;++h)f.push(f[b].children[h])}++this.needsUpdate};
b.prototype.selectPolylist=function(b){this.changeMeshSelection(b,!0);++this.needsUpdate};b.prototype.deselectPolylist=function(b){this.changeMeshSelection(b,!1);++this.needsUpdate};b.prototype.highlightPolylist=function(b){this.changeMeshHighlight(b,!0);++this.needsUpdate};b.prototype.dehighlightPolylist=function(b){this.changeMeshHighlight(b,!1);++this.needsUpdate};b.prototype.changeMeshSelection=function(b,d){b=this.polylists[b];b.selected=void 0===d?!b.selected:d;++this.needsUpdate};b.prototype.changeMeshHighlight=
function(b,d){b=this.polylists[b];b.highlighted=void 0===d?!b.highlighted:d;++this.needsUpdate};b.prototype.setHighlight=function(b,d,e){e||(e=[]);if(b.length||d.length)for(var f=0;f<this.polylistInstances.length;++f){var h=this.polylistInstances[f];h.highlighted=(-1!==b.indexOf(h.polylist.name)||-1!==d.indexOf(h.materialTree.name))&&(!e.length||-1!==e.indexOf(h.node.localId))}else if(e.length)for(f=0;f<this.polylistInstances.length;++f)h=this.polylistInstances[f],h.highlighted=-1!==e.indexOf(h.node.localId);
else for(f=0;f<this.polylistInstances.length;++f)this.polylistInstances[f].highlighted=!1;++this.needsUpdate};b.prototype.checkMaterials=function(){for(var b in this.newMaterialsToLoad){var d=this.newMaterialsToLoad[b];d&&this.checkMaterial(d)&&(this.newMaterialsLoaded[d.id]=d,this.newMaterialsToLoad[d.id]=void 0,d.updateFunction())}};b.prototype.checkMaterial=function(b){return this.texturesManager.checkMaterial(b)};b.prototype.checkDilation=function(b){stage.emersya.appManager||stage.emersya.collaborativeDesignManager||
b.opacity&&b.opacity.texture&&.005>=b.opacity.glassMode&&b.albedo&&b.albedo.texture&&b.opacity.texture.images[0].id==b.albedo.texture.images[0].id&&6==b.opacity.texture.channel&&b.albedo.texture.updateLayer(this.register("Layer",{name:"internal dilation filter",color:[1,1,1],opacity:1,level:999999999,type:"dilation"}))};b.prototype.extend=function(b,d){for(var e in d)b[e]=d[e]};b.prototype.update=function(b){b&&(this.needsUpdate=Math.max(this.needsUpdate,b));0>=this.needsUpdate&&(this.needsUpdate=
1)};b.prototype.updateForExternalEvents=function(){this.update(1)};b.prototype.getMaterialsByMtMsNames=function(b,d,e){var f=[];e=e?this.getAll("MaterialTree"):this.materialTrees;for(var h in e)if(e[h].name===b){var m=this.materialsContent.materialSettingsByName[e[h].id][d];m&&(m=this.materials[m.id])&&f.push(m)}return f};b.prototype.getMaterialTreeAndSettingsByMtMsNames=function(b,d,e){var f=[];e=e?this.getAll("MaterialTree"):this.materialTrees;for(var h in e){var m=e[h];if(m.name===b){var p=this.materialsContent.materialSettingsByName[m.id][d];
p&&this.materials[p.id]&&f.push({materialTree:m,materialSettings:p})}}return f};b.prototype.getTexturesFromMaterialByContents=function(b,d){var e=[],f;for(f in d)2==d[f].length?b[d[f][0]]&&b[d[f][0]]&&d[f][1]&&b[d[f][0]][d[f][1]]&&e.push(b[d[f][0]][d[f][1]]):b[d[f][0]]&&b[d[f][0]]&&d[f][1]&&b[d[f][0]][d[f][1]]&&d[f][2]&&b[d[f][0]][d[f][1]][d[f][2]]&&e.push(b[d[f][0]][d[f][1]][d[f][2]]);return e};b.prototype.createOrGetTexturesFromMaterialByContents=function(b,d){var e=[],f;for(f in d)b[d[f][0]]||
(b[d[f][0]]={}),b[d[f][0]][d[f][1]]||(b[d[f][0]][d[f][1]]={layer:{}}),2==d[f].length?e.push(b[d[f][0]][d[f][1]]):(b[d[f][0]][d[f][1]][d[f][2]]||(b[d[f][0]][d[f][1]][d[f][2]]={layer:{}}),e.push(b[d[f][0]][d[f][1]][d[f][2]]));return e};b.prototype.getTexturesByMtMsContentsNames=function(b,d,e,f){var h=[];b=this.getMaterialsByMtMsNames(b,d,f);for(var m in b)h.push.apply(h,$jscomp.arrayFromIterable(this.getTexturesFromMaterialByContents(b[m],e)));return h};var E=function(b,d,e){if(!this.noTextureInstance)void 0!==
e[d]&&null!==e[d]?(!b[d]&&e[d].images&&(b[d]=this.texturesManager.createTextureInstance()),b[d]&&b[d].fill(e[d])):null===e[d]&&(b[d]=null);else if(null===e[d]||e[d]&&e[d].images)b[d]=e[d]};b.prototype.fillMaterialNoTextureInstance=function(){this.noTextureInstance=!0;var b=this.fillMaterial.apply(this,arguments);this.noTextureInstance=!1;return b};b.prototype.fillMaterial=function(b){var d=[].slice.call(arguments,1,arguments.length);if(d.length){for(var e=b.type,f=0;f<d.length;++f)void 0!==d[f].type&&
(e=d[f].type);b.type=e;for(f=0;f<d.length;++f){var h=d[f];void 0!==h.id&&(b.id=h.id);void 0!==h.name&&(b.name=h.name);void 0!==h.polylists&&(b.polylists=h.polylists);void 0!==h.materialTree&&(b.materialTree=h.materialTree);void 0!==h.uvTransform&&(b.uvTransform=h.uvTransform);h.uvTransform&&(h.uvTransform.dirty=!0);if(e){var m=b,p=h.localEnvironment;void 0!==p&&(null===p?m.localEnvironment=null:(m.localEnvironment||(m.localEnvironment={}),void 0!==p.id&&(m.localEnvironment.id=p.id),void 0!==p.name&&
(m.localEnvironment.name=p.name),void 0!==p.tint&&(m.localEnvironment.tint=p.tint),E.call(this,m.localEnvironment,"texture",p),void 0!==p.relativeToCamera&&(m.localEnvironment.relativeToCamera=p.relativeToCamera),void 0!==p.rotation&&(m.localEnvironment.rotation=p.rotation),void 0!==p.exposure&&(m.localEnvironment.exposure=p.exposure),void 0!==p.positioned&&(m.localEnvironment.positioned=p.positioned),void 0!==p.center&&(m.localEnvironment.center=p.center),void 0!==p.size&&(m.localEnvironment.size=
p.size)));var g=b,n=h.occlusion;void 0!==n&&(null===n?g.occlusion=null:(g.occlusion||(g.occlusion={}),void 0!==n.id&&(g.occlusion.id=n.id),void 0!==n.name&&(g.occlusion.name=n.name),void 0!==n.ambientIntensity&&(g.occlusion.ambientIntensity=n.ambientIntensity),E.call(this,g.occlusion,"ambientTexture",n),void 0!==n.ambientTextureCorrection&&(g.occlusion.ambientTextureCorrection=n.ambientTextureCorrection),void 0!==n.lightIntensity&&(g.occlusion.lightIntensity=n.lightIntensity),E.call(this,g.occlusion,
"lightTexture",n),void 0!==n.lightTextureCorrection&&(g.occlusion.lightTextureCorrection=n.lightTextureCorrection)));var k=b,l=h.translucency;void 0!==l&&(null===l?k.translucency=null:(k.translucency||(k.translucency={}),void 0!==l.id&&(k.translucency.id=l.id),void 0!==l.name&&(k.translucency.name=l.name),void 0!==l.intensity&&(k.translucency.intensity=l.intensity),E.call(this,k.translucency,"texture",l)));var r=b,q=h.opacity;if(void 0!==q)if(null===q)r.opacity=null;else{r.opacity||(r.opacity={});
void 0!==q.id&&(r.opacity.id=q.id);void 0!==q.name&&(r.opacity.name=q.name);void 0!==q.blending&&(r.opacity.blending=q.blending);void 0!==q.threshold&&(r.opacity.threshold=q.threshold);void 0!==q.glassMode&&(r.opacity.glassMode=q.glassMode);void 0!==q.firstFacesOnly&&(r.opacity.firstFacesOnly=q.firstFacesOnly);void 0!==q.intensity&&(r.opacity.intensity=q.intensity);void 0!==q.blur&&(r.opacity.blur=q.blur);E.call(this,r.opacity,"texture",q);var t=r.opacity,A=q.refraction;void 0!==A&&(null===A?t.refraction=
null:(t.refraction||(t.refraction={}),void 0!==A.id&&(t.refraction.id=A.id),void 0!==A.name&&(t.refraction.name=A.name),void 0!==A.intensity&&(t.refraction.intensity=A.intensity),void 0!==A.index&&(t.refraction.index=A.index),void 0!==A.relativeToCamera&&(t.refraction.relativeToCamera=A.relativeToCamera),void 0!==A.textureCube&&(t.refraction.textureCube=A.textureCube)))}var B=b,w=h.coating;if(void 0!==w)if(null===w)B.coating=null;else{if(B.coating)var u=0<B.coating.furMaxLength||0<B.coating.furRealSize;
else B.coating={},u=!0;void 0!==w.id&&(B.coating.id=w.id);void 0!==w.name&&(B.coating.name=w.name);u&&(void 0!==w.furMaxLength&&(B.coating.furMaxLength=w.furMaxLength),void 0!==w.furRealSize&&(B.coating.furRealSize=w.furRealSize),void 0!==w.furRigidity&&(B.coating.furRigidity=w.furRigidity),void 0!==w.furDispersion&&(B.coating.furDispersion=w.furDispersion),void 0!==w.furClumpType&&(B.coating.furClumpType=w.furClumpType),void 0!==w.furClumpSize&&(B.coating.furClumpSize=w.furClumpSize),void 0!==w.furHairSize&&
(B.coating.furHairSize=w.furHairSize),void 0!==w.furRootColor&&(B.coating.furRootColor=w.furRootColor),void 0!==w.furGradInterval&&(B.coating.furGradInterval=w.furGradInterval),void 0!==w.furGradNormalize&&(B.coating.furGradNormalize=w.furGradNormalize));void 0!==w.intensity&&(B.coating.intensity=w.intensity);void 0!==w.thickness&&(B.coating.thickness=w.thickness);void 0!==w.roughness&&(B.coating.roughness=w.roughness);void 0!==w.ior&&(B.coating.ior=w.ior);void 0!==w.color&&(B.coating.color=w.color);
void 0!==w.colorIntensity&&(B.coating.colorIntensity=w.colorIntensity);void 0!==w.normalIntensity&&(B.coating.normalIntensity=w.normalIntensity);void 0!==w.normalInverted&&(B.coating.normalInverted=w.normalInverted);E.call(this,B.coating,"intensityTexture",w);E.call(this,B.coating,"thicknessTexture",w);E.call(this,B.coating,"roughnessTexture",w);E.call(this,B.coating,"normalTexture",w)}var F=b,D=h.normalDeformation;void 0!==D&&(null===D?F.normalDeformation=null:(F.normalDeformation||(F.normalDeformation=
{}),void 0!==D.id&&(F.normalDeformation.id=D.id),void 0!==D.name&&(F.normalDeformation.name=D.name),void 0!==D.type&&(F.normalDeformation.type=D.type),void 0!==D.inverted&&(F.normalDeformation.inverted=D.inverted),void 0!==D.intensity&&(F.normalDeformation.intensity=D.intensity),E.call(this,F.normalDeformation,"texture",D),E.call(this,F.normalDeformation,"intensityTexture",D),void 0!==D.type2&&(F.normalDeformation.type2=D.type2),void 0!==D.inverted2&&(F.normalDeformation.inverted2=D.inverted2),void 0!==
D.intensity2&&(F.normalDeformation.intensity2=D.intensity2),E.call(this,F.normalDeformation,"texture2",D),E.call(this,F.normalDeformation,"intensityTexture2",D)));var H=b,ba=h.metalness;if(void 0!==ba)if(null===ba)H.metalness=null;else{H.metalness||(H.metalness={});void 0!==ba.id&&(H.metalness.id=ba.id);void 0!==ba.name&&(H.metalness.name=ba.name);void 0!==ba.intensity&&(H.metalness.intensity=ba.intensity);E.call(this,H.metalness,"texture",ba);var ka=H.metalness,Z=ba.anisotropy;void 0!==Z&&(null===
Z?ka.anisotropy=null:(ka.anisotropy||(ka.anisotropy={}),void 0!==Z.id&&(ka.anisotropy.id=Z.id),void 0!==Z.name&&(ka.anisotropy.name=Z.name),void 0!==Z.intensity&&(ka.anisotropy.intensity=Z.intensity),void 0!==Z.angle&&(ka.anisotropy.angle=Z.angle),E.call(this,ka.anisotropy,"texture",Z),E.call(this,ka.anisotropy,"intensityTexture",Z),E.call(this,ka.anisotropy,"roughnessTexture",Z),E.call(this,ka.anisotropy,"rotationTexture",Z)));var da=H.metalness,X=ba.carpaint;void 0!==X&&(null===X?da.carpaint=null:
(da.carpaint||(da.carpaint={}),void 0!==X.id&&(da.carpaint.id=X.id),void 0!==X.name&&(da.carpaint.name=X.name),void 0!==X.diffuse&&(da.carpaint.diffuse=X.diffuse),void 0!==X.coatingFlags&&(da.carpaint.coatingFlags=X.coatingFlags),void 0!==X.specularLobeCount&&(da.carpaint.specularLobeCount=X.specularLobeCount),void 0!==X.specularLobeF0s&&(da.carpaint.specularLobeF0s=X.specularLobeF0s),void 0!==X.specularLobeCoeffs&&(da.carpaint.specularLobeCoeffs=X.specularLobeCoeffs),void 0!==X.specularLobeSpreads&&
(da.carpaint.specularLobeSpreads=X.specularLobeSpreads),void 0!==X.flakesIntensity&&(da.carpaint.flakesIntensity=X.flakesIntensity),void 0!==X.flakesMaxThetaI&&(da.carpaint.flakesMaxThetaI=X.flakesMaxThetaI),void 0!==X.flakesNumThetaI&&(da.carpaint.flakesNumThetaI=X.flakesNumThetaI),void 0!==X.flakesNumThetaF&&(da.carpaint.flakesNumThetaF=X.flakesNumThetaF),void 0!==X.flakesNumPatches&&(da.carpaint.flakesNumPatches=X.flakesNumPatches),void 0!==X.flakesGridX&&(da.carpaint.flakesGridX=X.flakesGridX),
void 0!==X.flakesGridY&&(da.carpaint.flakesGridY=X.flakesGridY),void 0!==X.flakesColorBias&&(da.carpaint.flakesColorBias=X.flakesColorBias),void 0!==X.isRGBEflakesColorTexture&&(da.carpaint.isRGBEflakesColorTexture=X.isRGBEflakesColorTexture),void 0!==X.isRGBEbrdfColorTexture&&(da.carpaint.isRGBEbrdfColorTexture=X.isRGBEbrdfColorTexture),E.call(this,da.carpaint,"brdfColorTexture",X),E.call(this,da.carpaint,"flakesSliceLutTexture",X),E.call(this,da.carpaint,"flakesColorTexture",X)))}var Ha=b,Ga=h.roughness;
if(void 0!==Ga)if(null===Ga)Ha.roughness=null;else{Ha.roughness||(Ha.roughness={});void 0!==Ga.id&&(Ha.roughness.id=Ga.id);void 0!==Ga.name&&(Ha.roughness.name=Ga.name);void 0!==Ga.gloss&&(Ha.roughness.gloss=Ga.gloss);void 0!==Ga.intensity&&(Ha.roughness.intensity=Ga.intensity);E.call(this,Ha.roughness,"texture",Ga);var Fa=Ha.roughness,xa=Ga.sheen;void 0!==xa&&(null===xa?Fa.sheen=null:(Fa.sheen||(Fa.sheen={}),void 0!==xa.oldShader&&(Fa.sheen.oldShader=xa.oldShader),void 0!==xa.color&&(Fa.sheen.color=
xa.color),void 0!==xa.intensity&&(Fa.sheen.intensity=xa.intensity),E.call(this,Fa.sheen,"texture",xa),E.call(this,Fa.sheen,"intensityTexture",xa),void 0!==xa.customRoughness&&(Fa.sheen.customRoughness=xa.customRoughness),void 0!==xa.roughness&&(Fa.sheen.roughness=xa.roughness),E.call(this,Fa.sheen,"roughnessTexture",xa)))}var Ia=b,qa=h.iridescence;void 0!==qa&&(null===qa?Ia.iridescence=null:(Ia.iridescence||(Ia.iridescence={}),void 0!==qa.id&&(Ia.iridescence.id=qa.id),void 0!==qa.name&&(Ia.iridescence.name=
qa.name),void 0!==qa.intensity&&(Ia.iridescence.intensity=qa.intensity),E.call(this,Ia.iridescence,"texture",qa),void 0!==qa.colormap&&(Ia.iridescence.colormap=qa.colormap),void 0!==qa.mode&&(Ia.iridescence.mode=qa.mode),void 0!==qa.shaderColormap&&(Ia.iridescence.shaderColormap=qa.shaderColormap)));var Va=b,va=h.emissive;if(void 0!==va)if(null===va)Va.emissive=null;else{Va.emissive||(Va.emissive={});void 0!==va.id&&(Va.emissive.id=va.id);void 0!==va.name&&(Va.emissive.name=va.name);void 0!==va.color&&
(Va.emissive.color=va.color);void 0!==va.intensity&&(Va.emissive.intensity=va.intensity);void 0!==va.blendingMode&&(Va.emissive.blendingMode=va.blendingMode);E.call(this,Va.emissive,"texture",va);E.call(this,Va.emissive,"intensityTexture",va);var la=Va.emissive,fa=va.glow;void 0!==fa&&(null===fa?la.glow=null:(la.glow||(la.glow={}),void 0!==fa.id&&(la.glow.id=fa.id),void 0!==fa.name&&(la.glow.name=fa.name),void 0!==fa.emissiveColor&&(la.glow.emissiveColor=fa.emissiveColor),void 0!==fa.color&&(la.glow.color=
fa.color),void 0!==fa.size&&(la.glow.size=fa.size),void 0!==fa.opacity&&(la.glow.opacity=fa.opacity),void 0!==fa.saturation&&(la.glow.saturation=fa.saturation),E.call(this,la.glow,"colorTexture",fa),E.call(this,la.glow,"opacityTexture",fa),E.call(this,la.glow,"saturationTexture",fa)))}var P=b,Ba=h.albedo;if(void 0!==Ba)if(null===Ba)P.albedo=null;else{P.albedo||(P.albedo={});void 0!==Ba.id&&(P.albedo.id=Ba.id);void 0!==Ba.name&&(P.albedo.name=Ba.name);void 0!==Ba.color&&(P.albedo.color=Ba.color);void 0!==
Ba.intensity&&(P.albedo.intensity=Ba.intensity);void 0!==Ba.blendingMode&&(P.albedo.blendingMode=Ba.blendingMode);E.call(this,P.albedo,"texture",Ba);var Ka=P.albedo,wa=Ba.specular;void 0!==wa&&(null===wa?Ka.specular=null:(Ka.specular||(Ka.specular={}),void 0!==wa.id&&(Ka.specular.id=wa.id),void 0!==wa.name&&(Ka.specular.name=wa.name),void 0!==wa.color&&(Ka.specular.color=wa.color),void 0!==wa.intensity&&(Ka.specular.intensity=wa.intensity),E.call(this,Ka.specular,"texture",wa),E.call(this,Ka.specular,
"intensityTexture",wa),void 0!==wa.glow&&(Ka.specular.glow=wa.glow),void 0!==wa.fresnelMode&&(Ka.specular.fresnelMode=wa.fresnelMode),void 0!==wa.fresnel&&(Ka.specular.fresnel=wa.fresnel)))}}else{void 0!==h.newShaderType&&(b.newShaderType=h.newShaderType);var Ja=b,La=h.lightMap;void 0!==La&&(null===La?Ja.lightMap=null:(Ja.lightMap||(Ja.lightMap={}),void 0!==La.id&&(Ja.lightMap.id=La.id),void 0!==La.name&&(Ja.lightMap.name=La.name),void 0!==La.color&&(Ja.lightMap.color=La.color),void 0!==La.intensity&&
(Ja.lightMap.intensity=La.intensity),E.call(this,Ja.lightMap,"texture",La),E.call(this,Ja.lightMap,"colorTexture",La)));var ra=b,Sa=h.opacity;void 0!==Sa&&(null===Sa?ra.opacity=null:(ra.opacity||(ra.opacity={}),void 0!==Sa.id&&(ra.opacity.id=Sa.id),void 0!==Sa.name&&(ra.opacity.name=Sa.name),void 0!==Sa.intensity&&(ra.opacity.intensity=Sa.intensity),void 0!==Sa.blur&&(ra.opacity.blur=Sa.blur),void 0!==Sa.channel&&(ra.opacity.channel=Sa.channel),void 0!==Sa.blending&&(ra.opacity.blending=Sa.blending),
void 0!==Sa.threshold&&(ra.opacity.threshold=Sa.threshold),void 0!==Sa.firstFacesOnly&&(ra.opacity.firstFacesOnly=Sa.firstFacesOnly),E.call(this,ra.opacity,"texture",Sa)));var Ya=b,Ra=h.refraction;void 0!==Ra&&(null===Ra?Ya.refraction=null:(Ya.refraction||(Ya.refraction={}),void 0!==Ra.id&&(Ya.refraction.id=Ra.id),void 0!==Ra.name&&(Ya.refraction.name=Ra.name),void 0!==Ra.intensity&&(Ya.refraction.intensity=Ra.intensity),void 0!==Ra.index&&(Ya.refraction.index=Ra.index),void 0!==Ra.relativeToCamera&&
(Ya.refraction.relativeToCamera=Ra.relativeToCamera),E.call(this,Ya.refraction,"texture",Ra),void 0!==Ra.textureCube&&(Ya.refraction.textureCube=Ra.textureCube)));var ma=b,bb=h.translucency;void 0!==bb&&(null===bb?ma.translucency=null:(ma.translucency||(ma.translucency={}),void 0!==bb.id&&(ma.translucency.id=bb.id),void 0!==bb.name&&(ma.translucency.name=bb.name),void 0!==bb.intensity&&(ma.translucency.intensity=bb.intensity),E.call(this,ma.translucency,"texture",bb)));var gb=b,ib=h.specularAnisotropic;
void 0!==ib&&(null===ib?gb.specularAnisotropic=null:(gb.specularAnisotropic||(gb.specularAnisotropic={}),void 0!==ib.id&&(gb.specularAnisotropic.id=ib.id),void 0!==ib.name&&(gb.specularAnisotropic.name=ib.name),void 0!==ib.intensity&&(gb.specularAnisotropic.intensity=ib.intensity),E.call(this,gb.specularAnisotropic,"texture",ib)));var hb=b,fb=h.normalDeformation;void 0!==fb&&(null===fb?hb.normalDeformation=null:(hb.normalDeformation||(hb.normalDeformation={}),void 0!==fb.id&&(hb.normalDeformation.id=
fb.id),void 0!==fb.name&&(hb.normalDeformation.name=fb.name),void 0!==fb.type&&(hb.normalDeformation.type=fb.type),void 0!==fb.scale&&(hb.normalDeformation.scale=fb.scale),E.call(this,hb.normalDeformation,"texture",fb),E.call(this,hb.normalDeformation,"scaleTexture",fb)));var Aa=b,eb=h.shininess;void 0!==eb&&(null===eb?Aa.shininess=null:(Aa.shininess||(Aa.shininess={}),void 0!==eb.id&&(Aa.shininess.id=eb.id),void 0!==eb.name&&(Aa.shininess.name=eb.name),void 0!==eb.intensity&&(Aa.shininess.intensity=
eb.intensity),E.call(this,Aa.shininess,"texture",eb)));var ab=b,Ma=h.reflection;void 0!==Ma&&(null===Ma?ab.reflection=null:(ab.reflection||(ab.reflection={}),void 0!==Ma.id&&(ab.reflection.id=Ma.id),void 0!==Ma.name&&(ab.reflection.name=Ma.name),void 0!==Ma.intensity&&(ab.reflection.intensity=Ma.intensity),void 0!==Ma.blendingLevel&&(ab.reflection.blendingLevel=Ma.blendingLevel),void 0!==Ma.relativeToCamera&&(ab.reflection.relativeToCamera=Ma.relativeToCamera),E.call(this,ab.reflection,"texture",
Ma),void 0!==Ma.textureCube&&(ab.reflection.textureCube=Ma.textureCube)));var Ta=b,db=h.emissive;void 0!==db&&(null===db?Ta.emissive=null:(Ta.emissive||(Ta.emissive={}),void 0!==db.id&&(Ta.emissive.id=db.id),void 0!==db.name&&(Ta.emissive.name=db.name),void 0!==db.color&&(Ta.emissive.color=db.color),void 0!==db.intensity&&(Ta.emissive.intensity=db.intensity),E.call(this,Ta.emissive,"texture",db),E.call(this,Ta.emissive,"intensityTexture",db)));var Oa=b,Qa=h.glow;void 0!==Qa&&(null===Qa?Oa.glow=null:
(Oa.glow||(Oa.glow={}),void 0!==Qa.id&&(Oa.glow.id=Qa.id),void 0!==Qa.name&&(Oa.glow.name=Qa.name),void 0!==Qa.color&&(Oa.glow.color=Qa.color),void 0!==Qa.size&&(Oa.glow.size=Qa.size),void 0!==Qa.opacity&&(Oa.glow.opacity=Qa.opacity),void 0!==Qa.saturation&&(Oa.glow.saturation=Qa.saturation),E.call(this,Oa.glow,"colorTexture",Qa),E.call(this,Oa.glow,"opacityTexture",Qa),E.call(this,Oa.glow,"saturationTexture",Qa)));var N=b,za=h.iridescent;void 0!==za&&(null===za?N.iridescent=null:(N.iridescent||(N.iridescent=
{}),void 0!==za.id&&(N.iridescent.id=za.id),void 0!==za.name&&(N.iridescent.name=za.name),void 0!==za.intensity&&(N.iridescent.intensity=za.intensity),E.call(this,N.iridescent,"texture",za),E.call(this,N.iridescent,"intensityTexture",za)));var ca=b,Ea=h.specular;void 0!==Ea&&(null===Ea?ca.specular=null:(ca.specular||(ca.specular={}),void 0!==Ea.id&&(ca.specular.id=Ea.id),void 0!==Ea.name&&(ca.specular.name=Ea.name),void 0!==Ea.color&&(ca.specular.color=Ea.color),void 0!==Ea.intensity&&(ca.specular.intensity=
Ea.intensity),E.call(this,ca.specular,"texture",Ea),E.call(this,ca.specular,"intensityTexture",Ea),void 0!==Ea.glow&&(ca.specular.glow=Ea.glow)));var Ca=b,Ua=h.diffuse;void 0!==Ua&&(null===Ua?Ca.diffuse=null:(Ca.diffuse||(Ca.diffuse={}),void 0!==Ua.id&&(Ca.diffuse.id=Ua.id),void 0!==Ua.name&&(Ca.diffuse.name=Ua.name),void 0!==Ua.color&&(Ca.diffuse.color=Ua.color),void 0!==Ua.intensity&&(Ca.diffuse.intensity=Ua.intensity),E.call(this,Ca.diffuse,"texture",Ua)));var sa=b,na=h.ambient;void 0!==na&&(null===
na?sa.ambient=null:(sa.ambient||(sa.ambient={}),void 0!==na.id&&(sa.ambient.id=na.id),void 0!==na.name&&(sa.ambient.name=na.name),void 0!==na.diffuseColor&&(sa.ambient.diffuseColor=na.diffuseColor),void 0!==na.color&&(sa.ambient.color=na.color),void 0!==na.intensity&&(sa.ambient.intensity=na.intensity),E.call(this,sa.ambient,"texture",na)))}}if(e){var kb=b;if(!kb.localEnvironment)kb.localEnvironment=null;else if(void 0===kb.localEnvironment.tint||void 0===kb.localEnvironment.rotation||void 0===kb.localEnvironment.exposure)kb.localEnvironment=
null;var Da=b;if(Da.occlusion){var xb=void 0===Da.occlusion.ambientIntensity||void 0===Da.occlusion.ambientTextureCorrection||!Da.occlusion.ambientTexture&&!Da.occlusion.ambientIntensity,Za=void 0===Da.occlusion.lightIntensity||void 0===Da.occlusion.lightTextureCorrection||!Da.occlusion.lightTexture&&!Da.occlusion.lightIntensity;xb&&Za?Da.occlusion=null:(xb&&(Da.occlusion.ambientIntensity=0,Da.occlusion.ambientTexture=null,Da.occlusion.ambientTextureCorrection=0),Za&&(Da.occlusion.lightIntensity=
0,Da.occlusion.lightTexture=null,Da.occlusion.lightTextureCorrection=0))}else Da.occlusion=null;var V=b;V.translucency?void 0===V.translucency.intensity&&(V.translucency=null):V.translucency=null;var O=b;if(O.opacity)if(void 0===O.opacity.blending||void 0===O.opacity.glassMode||void 0===O.opacity.intensity)O.opacity=null;else{var ja=O.opacity;if(!ja.refraction)ja.refraction=null;else if(void 0===ja.refraction.intensity||void 0===ja.refraction.index)ja.refraction=null;O.opacity.blur||(O.opacity.blur=
"none");O.opacity.threshold||(O.opacity.threshold=0)}else O.opacity=null;var W=b;if(!W.coating)W.coating=null;else if((0<W.coating.furRealSize||0<W.coating.furMaxLength)&&(void 0===W.coating.furHairSize||void 0===W.coating.furRigidity||void 0===W.coating.furDispersion||void 0===W.coating.furClumpType||void 0===W.coating.furClumpSize||void 0===W.coating.furRootColor||void 0===W.coating.furGradInterval||void 0===W.coating.furGradNormalize)||0>=W.coating.furRealSize&&0>=W.coating.furMaxLength&&(void 0===
W.coating.intensity||void 0===W.coating.thickness||void 0===W.coating.roughness||void 0===W.coating.ior||void 0===W.coating.color||void 0===W.coating.colorIntensity||void 0===W.coating.normalIntensity))W.coating=null;var pa=b;if(pa.normalDeformation){var Pa=void 0===pa.normalDeformation.type||void 0===pa.normalDeformation.intensity,ha=void 0===pa.normalDeformation.type2||void 0===pa.normalDeformation.intensity2;Pa&&ha?pa.normalDeformation=null:(Pa&&(pa.normalDeformation.type=0,pa.normalDeformation.inverted=
!1,pa.normalDeformation.intensity=0,pa.normalDeformation.texture=null,pa.normalDeformation.intensityTexture=null),ha&&(pa.normalDeformation.type2=0,pa.normalDeformation.inverted2=!1,pa.normalDeformation.intensity2=0,pa.normalDeformation.texture2=null,pa.normalDeformation.intensityTexture2=null))}else pa.normalDeformation=null;var ya=b;if(ya.metalness)if(void 0===ya.metalness.intensity)ya.metalness=null;else{var zb=ya.metalness;if(!zb.anisotropy)zb.anisotropy=null;else if(void 0===zb.anisotropy.intensity||
void 0===zb.anisotropy.angle)zb.anisotropy=null;var cb=ya.metalness;if(!cb.carpaint)cb.carpaint=null;else if(void 0===cb.carpaint.diffuse||void 0===cb.carpaint.coatingFlags||void 0===cb.carpaint.specularLobeCount||void 0===cb.carpaint.specularLobeF0s||void 0===cb.carpaint.specularLobeCoeffs||void 0===cb.carpaint.specularLobeSpreads||void 0===cb.carpaint.flakesMaxThetaI||void 0===cb.carpaint.flakesNumThetaI||void 0===cb.carpaint.flakesNumThetaF||void 0===cb.carpaint.flakesNumPatches||void 0===cb.carpaint.flakesGridX||
void 0===cb.carpaint.flakesGridY||void 0===cb.carpaint.isRGBEbrdfColorTexture||void 0===cb.carpaint.isRGBEflakesColorTexture||void 0===cb.carpaint.flakesColorBias||void 0===cb.carpaint.flakesIntensity)cb.carpaint=null}else ya.metalness=null;var nc=b;if(nc.roughness)if(void 0===nc.roughness.intensity)nc.roughness=null;else{var dc=nc.roughness;if(!dc.sheen)dc.sheen=null;else if(void 0===dc.sheen.color||void 0===dc.sheen.intensity||void 0===dc.sheen.roughness)dc.sheen=null}else nc.roughness=null;var Wb=
b;if(!Wb.iridescence)Wb.iridescence=null;else if(void 0===Wb.iridescence.intensity||void 0===Wb.iridescence.colormap||void 0===Wb.iridescence.mode||void 0===Wb.iridescence.shaderColormap)Wb.iridescence=null;var Sb=b;if(Sb.emissive){if(void 0===Sb.emissive.color||void 0===Sb.emissive.intensity||void 0===Sb.emissive.blendingMode)Sb.emissive.color=[0,0,0],Sb.emissive.intensity=0,Sb.emissive.blendingMode=0;var ec=Sb.emissive;if(!ec.glow)ec.glow=null;else if(void 0===ec.glow.color||void 0===ec.glow.size||
void 0===ec.glow.opacity||void 0===ec.glow.saturation)ec.glow=null}else Sb.emissive=null;var Xb=b;if(Xb.albedo)if(void 0===Xb.albedo.color||void 0===Xb.albedo.intensity)Xb.albedo=null;else{var yb=Xb.albedo;if(!yb.specular)yb.specular=null;else if(void 0===yb.specular.color||void 0===yb.specular.intensity||void 0===yb.specular.fresnel)yb.specular=null}else Xb.albedo=null}else{var Rb=b;if(!Rb.lightMap)Rb.lightMap=null;else if(void 0===Rb.lightMap.color||void 0===Rb.lightMap.intensity)Rb.lightMap=null;
var Gb=b;Gb.opacity?void 0===Gb.opacity.intensity||void 0===Gb.opacity.channel||void 0===Gb.opacity.blending?Gb.opacity=null:(void 0===Gb.opacity.blur&&(Gb.opacity.blur="none"),void 0===Gb.opacity.threshold&&(Gb.opacity.threshold=0)):Gb.opacity=null;var ob=b;if(!ob.refraction)ob.refraction=null;else if(void 0===ob.refraction.intensity||void 0===ob.refraction.index)ob.refraction=null;var Hb=b;Hb.translucency?void 0===Hb.translucency.intensity&&(Hb.translucency=null):Hb.translucency=null;var tc=b;tc.specularAnisotropic?
void 0===tc.specularAnisotropic.intensity&&(tc.specularAnisotropic=null):tc.specularAnisotropic=null;var pb=b;if(!pb.normalDeformation)pb.normalDeformation=null;else if(void 0===pb.normalDeformation.type||void 0===pb.normalDeformation.scale||void 0===pb.normalDeformation.texture)pb.normalDeformation=null;var Ab=b;Ab.shininess?void 0===Ab.shininess.intensity&&(Ab.shininess=null):Ab.shininess=null;var Bb=b;if(!Bb.reflection)Bb.reflection=null;else if(void 0===Bb.reflection.intensity||void 0===Bb.reflection.blendingLevel||
void 0===Bb.reflection.textureCube)Bb.reflection=null;var $a=b;if(!$a.emissive)$a.emissive=null;else if(void 0===$a.emissive.color||void 0===$a.emissive.intensity)$a.emissive=null;var lb=b;if(!lb.glow)lb.glow=null;else if(void 0===lb.glow.color||void 0===lb.glow.size||void 0===lb.glow.opacity||void 0===lb.glow.saturation)lb.glow=null;var ic=b;ic.iridescent?void 0===ic.iridescent.intensity&&(ic.iridescent=null):ic.iridescent=null;var ac=b;if(!ac.specular)ac.specular=null;else if(void 0===ac.specular.color||
void 0===ac.specular.intensity)ac.specular=null;var Yb=b;if(!Yb.diffuse)Yb.diffuse=null;else if(void 0===Yb.diffuse.color||void 0===Yb.diffuse.intensity)Yb.diffuse=null;var Kc=b;if(!Kc.ambient)Kc.ambient=null;else if(void 0===Kc.ambient.color||void 0===Kc.ambient.intensity)Kc.ambient=null}return b}console.error("should not happen")};b.prototype.convertCustomMaterialValuesToMaterial=function(b){for(var d={type:this.materialsType},e=0;e<b.length;++e){for(var f=b[e],h=f.address.split("."),m=d,p=0;p<
h.length-1;++p)void 0===m[h[p]]&&(m[h[p]]={}),m=m[h[p]];m[h.slice(-1)[0]]=f.value}return d};b.prototype.computeRealMeasurementSceneFactor=function(b){var d=1;b&&(1E-6<b.boundingBox.maxY-b.boundingBox.minY&&(d=b.realSize/(b.boundingBox.maxY-b.boundingBox.minY)),0==d&&(d=1));return d};b.prototype.computeSceneRealMeasurementScalingFactors=function(b,d){this.useRealMeasurements&&(b=this.computeRealMeasurementSceneFactor(b),this.computeAllPolylistsRealMeasurementScalingFactors(b,d))};b.prototype.computePolylistRealMeasurementScalingFactors=
function(b,d,e){var f={},h=d.geometry;d=[];for(var m=0;m<h.dataBuffers.length;++m){var p=h.dataBuffers[m];p={polySize:p.polySize,nbVertices:p.nbVertices,nbFaces:p.nbFaces,faces:p.faces,vertices:new Float32Array(p.vertices),uvs:p.uvs};for(var g=vec3.create(),n=0;n<p.nbVertices;n++){var v=3*n;g[0]=p.vertices[v];g[1]=p.vertices[v+1];g[2]=p.vertices[v+2];mat4.multiplyVec3(e,g);p.vertices[v]=g[0];p.vertices[v+1]=g[1];p.vertices[v+2]=g[2]}d.push(p)}for(var k in h.dataBuffers[0].uvs)e=this.computeScalingFactorByMinimalDistortionEdge(d,
k),f[k]=b*e*1E3,Infinity===f[k]&&(f[k]=1E3*b);return f};b.prototype.computeNodePolylistsRealMeasurementScalingFactors=function(b,d,e){for(var f=[d],h=0;h<f.length;++h){d=f[h];if(d.polylists)for(var m=0;m<d.polylists.length;m++){var p=d.polylists[m],g=p.polylist;g.downloaded&&g.geometry.dataBuffers.length&&(this.modularConfigurator&&g.realMeasurementScalingFactors&&(p.realMeasurementScalingFactors=g.realMeasurementScalingFactors),null===p.realMeasurementScalingFactors||e)&&(p.realMeasurementScalingFactors=
this.computePolylistRealMeasurementScalingFactors(b,g,p.node.modelMatrix),g.realMeasurementScalingFactors=p.realMeasurementScalingFactors,p.matAnim&&p.matAnim.updateMaterialSettingsWhenPolylistInstanceMeasurementChange())}for(m=0;m<d.children.length;m++)f.push(d.children[m])}};b.prototype.computeAllPolylistsRealMeasurementScalingFactors=function(b,d){void 0===b&&(b=1);this.computeNodePolylistsRealMeasurementScalingFactors(b,this.root,d)};var F=function(b,d){for(var e=0,f=0;f<b.length;f++){var h=d[f]-
b[f];e+=h*h}return e=Math.sqrt(e)},p=function(b,d,e){d*=3;e*=3;return F([b.vertices[d],b.vertices[d+1],b.vertices[d+2]],[b.vertices[e],b.vertices[e+1],b.vertices[e+2]])},m=function(b,d,e,f){return b.uvs[f]?(d*=2,e*=2,F([b.uvs[f][d],b.uvs[f][d+1]],[b.uvs[f][e],b.uvs[f][e+1]])):NaN};b.prototype.computeScalingFactorByMinimalDistortionEdge=function(b,d){for(var e=[],f=0;f<b.length;++f)for(var h=b[f],g=0;g<h.nbFaces;++g)for(var n=h.polySize*g,v=0;v<h.polySize;v++){var k=h.faces[n+v],l=h.faces[n+(v+1)%
h.polySize];if(k!=l){var r=p(h,k,l);k=m(h,k,l,d);0!=r&&0!=k&&e.push(k/r)}}if(0==e.length)return 1;b=Math.floor(.05*e.length);e=e.sort(function(b,d){return b-d});e=e.slice(b,e.length-b);return 1/(e.reduce(function(b,d){return b+d})/e.length)};b.prototype.filterPolylistsInstances=function(){for(var b={hidden:[],arExcluded:[],others:[]},d=0;d<this.polylistInstances.length;++d){var e=this.polylistInstances[d];if(e.isHidden())b.hidden.push(e);else{var f=e.polylist;this.getFromInstanceParent(f,"ArData",
1).excludedPolylists.includes(f.id)?b.arExcluded.push(e):b.others.push(e)}}return b};b.prototype.setIntersection=function(b,d){if(b.intersection)return b.intersection(d);var e=new Set;d=$jscomp.makeIterator(d);for(var f=d.next();!f.done;f=d.next())f=f.value,b.has(f)&&e.add(f);return e};b.prototype.setIsSubsetOf=function(b,d){return b.isSubsetOf?b.isSubsetOf(d):this.setIntersection(b,d).size==b.size};b.prototype.getRealBoundingBox=function(b){b=void 0===b?null:b;for(var d=0,e=0,f=0,h=0,m=0,p=0,g=!0,
n=vec3.create(),k=this.filterPolylistsInstances(),l=0;l<k.others.length;++l){var r=k.others[l],q=r.polylist,t=q.geometry;if(!b||!b.size||this.setIntersection(b,q.tagsSet).size)for(var B=0;B<q.list.length;++B)for(var A=q.list[B],w=t.dataBuffers[B],E=0;E<A.length;++E)for(var u=w.polySize*A[E],F=0;F<w.polySize;++F)n[0]=w.vertices[3*w.faces[u+F]],n[1]=w.vertices[3*w.faces[u+F]+1],n[2]=w.vertices[3*w.faces[u+F]+2],mat4.multiplyVec3(r.node.modelMatrix,n),g?(d=n[0],e=n[0],f=n[1],h=n[1],m=n[2],p=n[2],g=!1):
(d=Math.min(d,n[0]),e=Math.max(e,n[0]),f=Math.min(f,n[1]),h=Math.max(h,n[1]),m=Math.min(m,n[2]),p=Math.max(p,n[2]))}return this.createAndFillBoundingBox(d,e,f,h,m,p)};b.prototype.getPolylistsWithAndWithoutTags=function(b){var d={with:[],without:[]},e;for(e in this.polylists){var f=this.polylists[e];this.setIntersection(b,f.tagsSet).size?d.with.push(f):d.without.push(f)}return d};b.prototype.showPolylistsInstancesWithoutTags=function(b){var d=[];if(!b.size)return d;for(var e=0;e<this.polylistInstances.length;++e){var f=
this.polylistInstances[e];this.setIntersection(b,f.polylist.tagsSet).size||(f.hidden=!1,d.push(f))}return d};b.prototype.hidePolylistsInstancesWithoutTags=function(b){var d=[];if(!b.size)return d;for(var e=0;e<this.polylistInstances.length;++e){var f=this.polylistInstances[e];this.setIntersection(b,f.polylist.tagsSet).size||(f.hidden=!0,d.push(f))}return d};b.prototype.showPolylistsInstances=function(b){for(var d=0;d<b.length;++d)b[d].hidden=!1};b.prototype.hidePolylistsInstances=function(b){for(var d=
0;d<b.length;++d)b[d].hidden=!0};return b});stage.provide("emersya.viewer.modules.fallback");
stage.register.call(stage.emersya.viewer.modules,"fallback",function(){var b={viewerFallback:{filePath:"",imageFormat:"png",verticalDivisor:3,horizontalDivisor:12,horizontalLineStart:0,verticalColumnStart:0,camera:{position:[5,5,5],target:[0,0,0],up:[0,1,0]}},style:{backgroundOverColor:"#00b1abff",backgroundNormalColor:"#303030DD",backgroundSelectedColor:"#000000DD",foregroundOverColor:"#ffffffff",foregroundNormalColor:"#ffffffff",foregroundSelectedColor:"#00b1abff",neutralOverColor:"#888888ff",neutralNormalColor:"#888888ff",
neutralSelectedColor:"#00b1abff",borderColor:"#ffffff30",logoNeutralColor:"#434649"},ui:{type:stage.emersya.viewer.FALLBACK_UI_TYPE.POINTS_BAR,position:"bottom",alignment:"center",useDynamicThumbnails:!1},displayMessage:!0,type:1,adaptativeFov:!0,useCache:!0,force3DButton:!0,fallbackPath:"",statId:-1},d=function(b,d){return b.number<d.number?-1:b.number>d.number?1:b.id<d.id?-1:1},u=function(d,h,m,p){this.settings=stage.extend({},b,p);this.apiCore=d;this.statId=this.settings.statId;this.scene=null;
this.presets={};this.materialTreesGroups={};this.materialTreesGroupsConfigurations={};this.materialTreesGroupsConfigurationsByName={};this.materialTreesGroupsConfigurationsByCode={};this.materialTrees={};this.materialTreesByName={};this.materialSettings={};this.polylists={};this.rendereringStarted=!1;this.fallbackRenderer=null;this.materialsChanged=this.viewerFallbackActive=!1;this.transactionIds=0;this.transactionTable={};this.camera=stage.extend(!0,{},this.settings.viewerFallback.camera);this.deltaY=
this.deltaX=0;this.svgIcon=stage.emersya.ui.svgIcon(null,this.settings);this.fullIcons=this.svgIcon.getFallbackIcons();this.parentElement=$$stage(h);this.uiParentElement=$$stage(m);this.windowWidth=!stage.browser.Ie||11<=stage.browser.version?window.innerWidth:document.documentElement.clientWidth||document.body.clientWidth;this.windowHeight=!stage.browser.Ie||11<=stage.browser.version?window.innerHeight:document.documentElement.clientHeight||document.body.clientHeight;this.callerName=this.name="Fallback";
this.apiCore.register(this,"setFallback",A);this.apiCore.register(this,"setViewerFallbackFromPlatform",Va);this.apiCore.register(this,"hideFallback",fa);this.apiCore.register(this,"showFallback",la);this.apiCore.register(this,"resize",wa);this.apiCore.register(this,"deltaUpdate",Sa);this.apiCore.register(this,"mouseButtonPress",Ya);this.apiCore.register(this,"mouseButtonRelease",Ra);this.apiCore.register(this,"getFallbackPosition",P,!0);this.apiCore.register(this,"isMaterialTreeGroupFallbackLoaded",
f,!0);this.apiCore.register(this,"startRendering",g);this.apiCore.register(this,"setStatId",q);this.apiCore.register(this,"setSceneBase",t);this.apiCore.register(this,"displayFallback",H);this.apiCore.register(this,"removeFallback",e);this.apiCore.register(this,"launch3D",D);this.apiCore.register(this,"removeGroupsAndPresets",E);this.apiCore.register(this,"setPresets",F);this.apiCore.register(this,"ui.loadUI",bb);this.apiCore.register(this,"ui.setStyle",gb);this.apiCore.register(this,"getFallbackScreenshots",
ka);this.apiCore.register(this,"getMaterialTreeGroupFallbackEncodedScreenshot",da,!0);this.apiCore.register(this,"setPredefinedViewpoint",xa);d=[{tagName:"div",returnActive:!0,attributes:{klass:"fallbackContainer"}}];this.mainContainer=this.parentElement.build(d);d=[{tagName:"div",attributes:{klass:"fallbackForce3DButtonContainer"},childs:[{tagName:"div",attributes:{klass:"fallbackForce3DButton",inner:this.apiCore.exec(this.callerName,"translate","enable3D")}}],events:[{onEvent:"click",callback:stage.setContext(n,
this)},{onEvent:"mouseenter",callback:stage.setContext(B,this)},{onEvent:"mouseleave",callback:stage.setContext(w,this)}]}];this.force3DContainer=this.uiParentElement.build(d);this.force3DContainer=this.uiParentElement.find(".fallbackForce3DButtonContainer");this.force3DContainer.css({"background-color":this.settings.style.borderColor,color:this.settings.style.backgroundNormalColor});this.force3DContainer.hide();this.mainContainer.hide()};u.prototype.destroy=function(){this.apiCore.unregister(this,
"setFallback");this.apiCore.unregister(this,"setViewerFallbackFromPlatform");this.apiCore.unregister(this,"hideFallback");this.apiCore.unregister(this,"showFallback");this.apiCore.unregister(this,"resize");this.apiCore.unregister(this,"deltaUpdate");this.apiCore.unregister(this,"mouseButtonPress");this.apiCore.unregister(this,"mouseButtonRelease");this.apiCore.unregister(this,"getFallbackPosition");this.apiCore.unregister(this,"isMaterialTreeGroupFallbackLoaded");this.apiCore.unregister(this,"startRendering");
this.apiCore.unregister(this,"setStatId");this.apiCore.unregister(this,"setSceneBase");this.apiCore.unregister(this,"displayFallback");this.apiCore.unregister(this,"removeFallback");this.apiCore.unregister(this,"launch3D");this.apiCore.unregister(this,"removeGroupsAndPresets");this.apiCore.unregister(this,"setPresets");this.apiCore.unregister(this,"ui.loadUI");this.apiCore.unregister(this,"ui.setStyle");this.apiCore.unregister(this,"getFallbackScreenshots");this.apiCore.unregister(this,"getMaterialTreeGroupFallbackEncodedScreenshot");
this.apiCore.unregister(this,"setPredefinedViewpoint");k.call(this);this.fallbackRenderer&&(this.fallbackRenderer.destroy(),this.fallbackRenderer=null)};var k=function(){this.configuratorApiRegistered&&(this.apiCore.unregister(this,"updateMaterialTreeByName"),this.apiCore.unregister(this,"beginUpdateTransaction"),this.apiCore.unregister(this,"endTransaction"),this.apiCore.unregister(this,"applyMaterialTreesGroupsConfigurations"),this.apiCore.unregister(this,"applyMaterialTreesGroupsCodeConfigurations"),
this.apiCore.unregister(this,"applyMaterialTreesGroupsConfigurations2"),this.apiCore.unregister(this,"applyMaterialTreesGroupsCodeConfigurations2"),this.apiCore.unregister(this,"applyPreset"),this.apiCore.unregister(this,"updateCustomText"),this.apiCore.unregister(this,"updateCustomTexts"),this.apiCore.unregister(this,"updateCustomTextMaximized"),this.apiCore.unregister(this,"updateSceneCustomTextures"),this.apiCore.unregister(this,"rdr.getCurrentScene"),this.apiCore.unregister(this,"setZoomRatio"),
this.apiCore.unregister(this,"rdr.takeScreenshot"),this.apiCore.unregister(this,"rdr.takeScreenshots"),this.apiCore.unregister(this,"rdr.takeEncodedScreenshot"),this.apiCore.unregister(this,"getFallbackScreenshot"),this.apiCore.unregister(this,"getCamera"),this.apiCore.unregister(this,"startAnimatingPath"),this.configuratorApiRegistered=!1)},l=function(){this.viewerFallbackApiRegistered&&(this.viewerFallbackApiRegistered=!1,this.apiCore.unregister(this,"getCamera"),this.apiCore.unregister(this,"startAnimatingPath"))},
g=function(){this.rendereringStarted=!0;fa.call(this)},q=function(b){this.statId=b},t=function(b){if(b){this.scene=b;if(this.scene){for(var e in this.scene.materialTrees)b=this.scene.materialTrees[e],this.materialTrees[b.id]=b,this.materialTreesByName[b.name]=b,b.materialsSettings={},b.materialsSettingsByName={};for(e in this.scene.materialSettings)b=this.scene.materialSettings[e],this.materialSettings[b.id]=b,b.imagesByViewpoint={},b.msCtsByViewpoint={},this.materialTrees[b.mt].materialsSettings[b.id]=
b,this.materialTrees[b.mt].materialsSettingsByName[b.name]=b}if(this.scene)for(var f in this.scene.materialTreesGroups)if(e=this.scene.materialTreesGroups[f],!this.materialTreesGroups[e.id]){this.materialTreesGroups[e.id]=e;for(var h in e.configurations)b=e.configurations[h],this.materialTreesGroupsConfigurations[b.id]=b,this.materialTreesGroupsConfigurationsByName[e.name+"/"+b.name]=b,this.materialTreesGroupsConfigurationsByCode[e.code+"/"+b.code]=b,b.imagesByViewpoint={},b.msCtsByViewpoint={}}if(this.scene){for(var m in this.scene.polylists)f=
this.scene.polylists[m],this.polylists[f.id]=f,f.imagesByViewpoint={};this.scene.nodesInUse=[];f=[this.scene.root];for(m=0;m<f.length;++m)this.scene.nodesInUse.push(f[m]),f[m].opacity=1,f=f.concat(f[m].children)}for(var p in this.viewpoints){m=this.viewpoints[p];for(var g in m.presetImages)f=m.presetImages[g],this.presetsById[f.presetId].imagesByViewpoint[m.id]=f;for(g in m.msImages)f=m.msImages[g],this.materialSettings[f.msId].imagesByViewpoint[m.id]=f;for(g in m.mtgcImages)f=m.mtgcImages[g],this.materialTreesGroupsConfigurations[f.configurationId].imagesByViewpoint[m.id]=
f;for(g in m.polyImages)f=m.polyImages[g],this.polylists[f.polyId].imagesByViewpoint[f.msId]||(this.polylists[f.polyId].imagesByViewpoint[f.msId]={}),this.polylists[f.polyId].imagesByViewpoint[f.msId][m.id]=f;for(g in m.msCts){f=m.msCts[g];this.materialSettings[f.msId].msCtsByViewpoint[m.id]=f;for(var n in this.materialTreesGroups)if(h=this.materialTreesGroups[n],1==h.materialTrees.length)for(var k in h.configurations)1==h.configurations[k].materials.length&&f.msId==h.configurations[k].materials[0].ms.id&&
(h.configurations[k].msCtsByViewpoint[m.id]=f)}}this.uiViewpoints=[];this.uiViewpointsById={};for(var v in this.viewpoints)p=this.viewpoints[v],g=this.apiCore.exec(this.callerName,"translate","name"+p.id,"FallbackViewpoint"),g={id:p.id,name:null!=g?g:p.name,number:p.number,thumbnail:p.thumbnail,realThumbnail:p.realThumbnail,images:[]},this.uiViewpoints.push(g),this.uiViewpointsById[p.id]=g;this.uiViewpoints.sort(d)}},r=function(){if(this.scene)for(var b in this.scene.customTexts){var d=this.scene.customTexts[b];
if(this.scene.materialTrees[d.mtId]&&this.scene.materialSettings[d.msId]){var e=this.scene.materialTrees[d.mtId],f=this.scene.materialSettings[d.msId];d.realDimensions?this.sceneLoaded&&updateCustomTextsRealDimensions.call(this,e.name,f.name,stage.extend(!0,{},d),d.contents,123,!0):K.call(this,e.name,f.name,stage.extend(!0,{},d),d.contents,123,d.imageWidth,d.imageHeight,!0)}}},f=function(){return void 0!==this.fallbackRenderer&&null!==this.fallbackRenderer},n=function(){this.apiCore.exec(this.callerName,
"launch3D")},B=function(){this.force3DContainer.children().first().addClass("fallbackForce3DButtonOver")},w=function(){this.force3DContainer.children().first().removeClass("fallbackForce3DButtonOver")},D=function(){this.displayed&&(this.fallbackRenderer&&this.fallbackRenderer.hideUI(),this.force3DContainer.hide())},A=function(b){this.fallback=b;this.viewpoints=this.fallback.viewpoints},H=function(b,d,e){e=void 0===e?!0:e;this.displayed=!0;this.showForce3DButton=this.settings.force3DButton&&b;if(3==
this.settings.type&&this.settings.fallbackPath&&this.fallback&&0<this.viewpoints.length){this.previewMessageContainer&&(this.previewMessageContainer.remove(),this.previewMessageContainer=null);this.viewerFallbackContainer&&(l.call(this),this.viewerFallbackContainer.remove(),this.viewerFallbackContainer=null);this.viewerFallbackActive=!1;switch(this.fallback.groupsOnly){case 1:var f=Q.call(this);break;case 2:f=Y.call(this);break;case 0:f=S.call(this)}Ba.call(this,e);this.mainContainer.show();b=0;d&&
(b=Math.max(Ga.call(this,d),0));this.fallbackRenderer?(this.fallbackRenderer.show(),this.fallbackRenderer.setViewpoints(f,stage.setContext(function(){this.apiCore.exec(this.callerName,"ui.showBackground");this.apiCore.exec(this.callerName,"fallbackReady",stage.emersya.viewer.FALLBACK_TYPE.CONFIGURATOR);r.call(this)},this))):this.fallbackRenderer=new stage.emersya.viewer.modules.fallbackRenderer(this.apiCore,this.mainContainer,this.uiParentElement,f,{imagesWidth:this.fallback.width,imagesHeight:this.fallback.height,
thumbnailSize:this.fallback.thumbnailSize,interactive:this.fallback.interactive,adaptativeFov:this.settings.adaptativeFov,style:this.settings.style,uiType:this.settings.ui.type,uiPosition:this.settings.ui.position,uiAlignment:this.settings.ui.alignment,thumbFromVp:!this.settings.ui.useDynamicThumbnails,startingViewpoint:b},stage.setContext(function(){this.apiCore.exec(this.callerName,"ui.showBackground");this.apiCore.exec(this.callerName,"fallbackReady",stage.emersya.viewer.FALLBACK_TYPE.CONFIGURATOR);
r.call(this)},this));this.showForce3DButton?this.force3DContainer.show():this.force3DContainer.hide();this.configuratorApiRegistered=!0;this.apiCore.register(this,"updateMaterialTreeByName",m,!0);this.apiCore.register(this,"beginUpdateTransaction",h,!0);this.apiCore.register(this,"endTransaction",v,!0);this.apiCore.register(this,"applyMaterialTreesGroupsConfigurations",I,!0);this.apiCore.register(this,"applyMaterialTreesGroupsCodeConfigurations",M,!0);this.apiCore.register(this,"applyMaterialTreesGroupsConfigurations2",
J,!0);this.apiCore.register(this,"applyMaterialTreesGroupsCodeConfigurations2",T,!0);this.apiCore.register(this,"applyPreset",U,!0);this.apiCore.register(this,"updateCustomText",L,!0);this.apiCore.register(this,"updateCustomTexts",K,!0);this.apiCore.register(this,"updateCustomTextMaximized",G,!0);this.apiCore.register(this,"updateSceneCustomTextures",r,!0);this.apiCore.register(this,"rdr.getCurrentScene",ta,!0);this.apiCore.register(this,"setZoomRatio",ua);this.apiCore.register(this,"rdr.takeScreenshot",
ea,!0);this.apiCore.register(this,"rdr.takeScreenshots",oa,!0);this.apiCore.register(this,"rdr.takeEncodedScreenshot",ba,!0);this.apiCore.register(this,"getFallbackScreenshot",Z,!0);this.apiCore.register(this,"getCamera",Ha,!0);this.apiCore.register(this,"startAnimatingPath",Fa);this.rendereringStarted||(this.apiCore.exec(this.callerName,"setConfigurator",this.scene.configurator),this.apiCore.exec(this.callerName,"setConfiguratorDefaultConfiguration"));this.apiCore.exec(this.callerName,"ui.showConfigurator");
wa.call(this)}else 2==this.settings.type?(this.apiCore.exec(this.callerName,"ui.hideLoader"),this.settings.viewerFallback.filePath&&""!==this.settings.viewerFallback.filePath&&(this.viewerFallbackApiRegistered=!0,this.apiCore.register(this,"getCamera",La,!0),this.apiCore.register(this,"startAnimatingPath",ra),qa.call(this,!1,e),d&&ra.call(this,d)),this.showForce3DButton?this.force3DContainer.show():this.force3DContainer.hide(),this.apiCore.exec(this.callerName,"fallbackReady",stage.emersya.viewer.FALLBACK_TYPE.VIEWER)):
(Ia.call(this,e),this.showForce3DButton?this.force3DContainer.show():this.force3DContainer.hide(),this.apiCore.exec(this.callerName,"fallbackReady",stage.emersya.viewer.FALLBACK_TYPE.PREVIEW))},e=function(){this.displayed=!1;this.fallbackRenderer&&(k.call(this),this.fallbackRenderer.hide());this.previewMessageContainer&&(this.previewMessageContainer.remove(),this.previewMessageContainer=null);this.viewerFallbackContainer&&(l.call(this),this.viewerFallbackContainer.remove(),this.viewerFallbackContainer=
null);this.viewerFallbackActive=!1;this.mainContainer.hide()},E=function(){this.presets={};this.materialTreesGroups={};this.materialTreesGroupsConfigurations={};this.materialTreesGroupsConfigurationsByName={};this.materialTreesGroupsConfigurationsByCode={};this.materialTrees={};this.materialTreesByName={};this.materialSettings={};this.polylists={}},F=function(b){this.presets=b.presets;this.presetsById={};this.presetsByName={};for(var d in this.presets)(b=this.presets[d])&&b.filePath&&(this.presetsById[b.id]=
b,this.presetsByName[b.name]=b,b.imagesByViewpoint={})},p=function(b){switch(this.fallback.groupsOnly){case 1:var d=Q.call(this);break;case 2:d=Y.call(this);break;case 0:d=S.call(this)}this.fallbackRenderer.setViewpoints(d,b)},m=function(b,d,e){(b=this.materialTreesByName[b])&&b.materialsSettingsByName[d]&&this.transactionTable[this.currentTransaction].toUpdate.push({mt:b,ms:b.materialsSettingsByName[d]})},h=function(b){this.materialsChanged=!0;if(b){if(b==this.previousId||this.transactionTable[b])return this.currentTransaction=
null,this.apiCore.exec(this.callerName,"onTransactionIdError",b),stage.createResult(null);var d=b}else d=++this.transactionIds;this.transactionTable[this.previousId]&&this.transactionTable[this.previousId].cancelFunction();this.currentTransaction=d;this.transactionTable[d]={toUpdate:[],cancelled:!1,cancelFunction:stage.setContext(function(){this.transactionTable[d].cancelled||(this.transactionTable[d].cancelled=!0,this.apiCore.exec(this.callerName,"onTransactionError",d),this.apiCore.exec(this.callerName,
"ui.hideBasicLoader"),this.currentTransaction=null)},this),updateFunction:stage.setContext(function(){if(!this.transactionTable[d].cancelled){var b=[],e=this.transactionTable[d],f;for(f in e.toUpdate){b.push({materialTreeName:e.toUpdate[f].mt.name,from:this.materialSettings[e.toUpdate[f].mt.currentMaterialId]?this.materialSettings[e.toUpdate[f].mt.currentMaterialId].name:"",to:e.toUpdate[f].ms.name});e.toUpdate[f].mt.currentMaterialId=e.toUpdate[f].ms.id;for(var h in e.toUpdate[f].mt.polylistInstances)e.toUpdate[f].mt.polylistInstances[h].matAnim&&
e.toUpdate[f].mt.polylistInstances[h].matAnim.resetMaterial(this.scene.materials[e.toUpdate[f].ms.id])}this.apiCore.exec(this.callerName,"onTransactionSuccess",d,b);switch(this.fallback.groupsOnly){case 2:var m=Y.call(this);break;case 0:m=S.call(this)}this.fallbackRenderer.setViewpoints(m)}},this)};this.previousId=d;return stage.createResult(this.previousId)},v=function(){if(!this.currentTransaction)return stage.createError(311,"There is no active transaction.",event);1==this.fallback.groupsOnly?
this.transactionTable[this.currentTransaction].cancelFunction():this.transactionTable[this.currentTransaction].updateFunction();this.currentTransaction=null;return stage.createResult(null)},I=function(b){for(var d in b)if(!this.materialTreesGroupsConfigurationsByName[b[d]])return stage.createError(316,"The configuration "+b[d]+" does not exist.");var e=++this.transactionIds,f=[];for(d in b){var h=this.materialTreesGroupsConfigurationsByName[b[d]],m;for(m in h.materials){var p=h.materials[m];f.push({materialTreeName:p.mt.name,
from:this.materialSettings[p.mt.currentMaterialId].name,to:p.ms.name});p.mt.currentMaterialId=p.ms.id;for(var g in p.mt.polylistInstances)p.mt.polylistInstances[g].matAnim&&p.mt.polylistInstances[g].matAnim.resetMaterial(this.scene.materials[p.ms.id])}h.group.currentConfiguration=h}b=function(){};switch(this.fallback.groupsOnly){case 1:var n=Q.call(this);b=stage.setContext(this.apiCore.exec,this.apiCore,this.callerName,"onTransactionSuccess",e,f);break;case 2:n=Y.call(this);break;case 0:n=this.materialsChanged?
S.call(this):Q.call(this)}this.fallbackRenderer.setViewpoints(n,b);return stage.createResult(e)},J=function(b){for(var d in b)if(!this.materialTreesGroupsConfigurationsByName[b[d].name])return stage.createError(316,"The configuration "+b[d].name+" does not exist.");var e=++this.transactionIds,f=[];for(d in b){var h=this.materialTreesGroupsConfigurationsByName[b[d].name],m;for(m in h.materials){var p=h.materials[m];f.push({materialTreeName:p.mt.name,from:this.materialSettings[p.mt.currentMaterialId].name,
to:p.ms.name});p.mt.currentMaterialId=p.ms.id;for(var g in p.mt.polylistInstances)p.mt.polylistInstances[g].matAnim&&p.mt.polylistInstances[g].matAnim.resetMaterial(this.scene.materials[p.ms.id])}h.group.currentConfiguration=h}b=function(){};switch(this.fallback.groupsOnly){case 1:var n=Q.call(this);b=stage.setContext(this.apiCore.exec,this.apiCore,this.callerName,"onTransactionSuccess",e,f);break;case 2:n=Y.call(this);break;case 0:n=this.materialsChanged?S.call(this):Q.call(this)}this.fallbackRenderer.setViewpoints(n,
b);return stage.createResult(e)},M=function(b){for(var d in b)if(!this.materialTreesGroupsConfigurationsByCode[b[d]])return stage.createError(316,"The configuration "+b[d]+" does not exist.");var e=++this.transactionIds,f=[];for(d in b){var h=this.materialTreesGroupsConfigurationsByName[b[d]]?this.materialTreesGroupsConfigurationsByName[b[d]]:this.materialTreesGroupsConfigurationsByCode[b[d]],m;for(m in h.materials){var p=h.materials[m];f.push({materialTreeName:p.mt.name,from:this.materialSettings[p.mt.currentMaterialId].name,
to:p.ms.name});p.mt.currentMaterialId=p.ms.id;for(var g in p.mt.polylistInstances)p.mt.polylistInstances[g].matAnim&&p.mt.polylistInstances[g].matAnim.resetMaterial(this.scene.materials[p.ms.id])}h.group.currentConfiguration=h}b=function(){};switch(this.fallback.groupsOnly){case 1:var n=Q.call(this);b=stage.setContext(this.apiCore.exec,this.apiCore,this.callerName,"onTransactionSuccess",e,f);break;case 2:n=Y.call(this);break;case 0:n=this.materialsChanged?S.call(this):Q.call(this)}this.fallbackRenderer.setViewpoints(n,
b);return stage.createResult(e)},T=function(b){for(var d in b)if(!this.materialTreesGroupsConfigurationsByCode[b[d].name])return stage.createError(316,"The configuration "+b[d].name+" does not exist.");var e=++this.transactionIds,f=[];for(d in b){var h=this.materialTreesGroupsConfigurationsByCode[b[d].name],m;for(m in h.materials){var p=h.materials[m];f.push({materialTreeName:p.mt.name,from:this.materialSettings[p.mt.currentMaterialId].name,to:p.ms.name});p.mt.currentMaterialId=p.ms.id;for(var g in p.mt.polylistInstances)p.mt.polylistInstances[g].matAnim&&
p.mt.polylistInstances[g].matAnim.resetMaterial(this.scene.materials[p.ms.id])}h.group.currentConfiguration=h}b=function(){};switch(this.fallback.groupsOnly){case 1:var n=Q.call(this);b=stage.setContext(this.apiCore.exec,this.apiCore,this.callerName,"onTransactionSuccess",e,f);break;case 2:n=Y.call(this);break;case 0:n=this.materialsChanged?S.call(this):Q.call(this)}this.fallbackRenderer.setViewpoints(n,b);return stage.createResult(e)},U=function(b,d){if(!this.presetsByName[b])return stage.createError(315,
"The preset "+b+" does not exist.");this.materialsChanged=!0;var e=++this.transactionIds,f=[],h;for(h in this.presetsByName[b].materials){d=this.presetsByName[b].materials[h];f.push({materialTreeName:d.mt.name,from:this.materialSettings[d.mt.currentMaterialId].name,to:d.ms.name});d.mt.currentMaterialId=d.ms.id;for(var m in d.mt.polylistInstances)d.mt.polylistInstances[m].matAnim&&d.mt.polylistInstances[m].matAnim.resetMaterial(this.scene.materials[d.ms.id])}b=ia.call(this,this.presetsByName[b]);this.fallbackRenderer.setViewpoints(b);
setTimeout(stage.setContext(function(){this.apiCore.exec(this.callerName,"onTransactionSuccess",e,f)},this),0);return stage.createResult(e)},R=function(b,d){if(d==stage.emersya.viewer.TEXTURE_CHANNEL.A)return b;b=7<b.length?this.apiCore.exec(this.callerName,"lib.hexToRgba",b):this.apiCore.exec(this.callerName,"lib.hexToRgb",b);res="#"+("0"+parseInt(b[0],10).toString(16)).slice(-2)+("0"+parseInt(b[1],10).toString(16)).slice(-2)+("0"+parseInt(b[2],10).toString(16)).slice(-2);switch(d){case stage.emersya.viewer.TEXTURE_CHANNEL.R:res+=
("0"+parseInt(b[0],10).toString(16)).slice(-2);break;case stage.emersya.viewer.TEXTURE_CHANNEL.G:res+=("0"+parseInt(b[1],10).toString(16)).slice(-2);break;case stage.emersya.viewer.TEXTURE_CHANNEL.B:res+=("0"+parseInt(b[2],10).toString(16)).slice(-2);break;case stage.emersya.viewer.TEXTURE_CHANNEL.RGB:res+=("0"+parseInt(.299*b[0]+.587*b[1]+.114*b[2],10).toString(16)).slice(-2)}return res},aa=function(b,d){var e=[],f;for(f in d)2==d[f].length?b[d[f][0]]&&b[d[f][0]]&&d[f][1]&&b[d[f][0]][d[f][1]]&&e.push(b[d[f][0]][d[f][1]]):
b[d[f][0]]&&b[d[f][0]]&&d[f][1]&&b[d[f][0]][d[f][1]]&&d[f][2]&&b[d[f][0]][d[f][1]][d[f][2]]&&e.push(b[d[f][0]][d[f][1]][d[f][2]]);return e},C=function(b,d,e,f,h,m,g){for(var n in this.viewpoints){var k=this.viewpoints[n],v;for(v in k.msCts)k.msCts[v].msId==d&&(k.msCts[v].imageData=e,k.msCts[v].imageWidth=f,k.msCts[v].imageHeight=h,this.fallbackRenderer.cancelImageDownload(k.msCts[v]),delete k.msCts[v].htmlImage,delete k.msCts[v].downloaded,delete k.msCts[v].attached)}if(this.scene.texturesManager)for(v in d=
this.scene.materials[d],f=this.scene.texturesManager.createLocalImageRGBA({imageData:g,width:void 0!==f?f:3,height:void 0!==h?h:3}),this.scene.srcImages[f.id]=f,m=aa.call(this,d,m),m)h=stage.extend(!1,{},m[v]),h.layer.image=f,m[v].finalImage&&0>m[v].finalImage.id&&(imageToDelete=m[v].finalImage),m[v].update(h);p.call(this,stage.setContext(function(){this.apiCore.exec(this.callerName,"onEndUpdateCustomTexture",b)},this))},L=function(b,d,e,f,h,m,p){var g=null,n=null;for(v in this.scene.materialTrees)if(this.scene.materialTrees[v].name===
b){g=this.scene.materialTrees[v];n=this.scene.materialsContent.materialSettingsByName[g.id][d];break}if(g&&n){g=stage.extend(!0,{},e);g.texts=[{text:e.text}];g.mode="horizontal";this.apiCore.exec(this.callerName,"registerCustomText",b,d,g,f);var k=this.apiCore.exec(this.callerName,"createTextImg",stage.extend(!0,{},e));b=this.scene.materials[n.id];d=g=!1;for(v in f)switch(f[v][0]){case "opacity":g=!0;break;case "diffuse":d=!0}if(g){var v=this.scene.materials[n.id].opacity.channel;d||(e.color=R.call(this,
e.color,v),void 0!==e.strokeColor&&(e.strokeColor=R.call(this,e.strokeColor,v)));e.backgroundColor=R.call(this,e.backgroundColor,v);textCanvas=this.apiCore.exec(this.callerName,"createTextImg",e,!0);if(!d){var l=textCanvas.getContext("2d");l.globalCompositeOperation="source-in";if(b.diffuse.texture){var r=new Image;r.crossOrigin="anonymous";r.onload=stage.setContext(function(){l.drawImage(r,0,0,m,p);q=textCanvas.toDataURL("image/png");C.call(this,h,n.id,q,m,p,f,k)},this);r.src=b.diffuse.texture.imgsSrc?
b.diffuse.texture.imgsSrc.defaultImage.realFilePath:b.diffuse.texture.images[0].images[0].realFilePath;return}e=b.diffuse.color;l.fillStyle="rgba("+parseInt(255*e[0])+","+parseInt(255*e[1])+","+parseInt(255*e[2])+", 1)";l.fillRect(0,0,m,p)}var q=textCanvas.toDataURL("image/png")}else q=this.apiCore.exec(this.callerName,"createTextImg",e);C.call(this,h,n.id,q,m,p,f,k)}else this.apiCore.exec(this.callerName,"onEndUpdateCustomTexture",h)},K=function(b,d,e,f,h,m,p){var g=null,n=null,k;for(k in this.scene.materialTrees)if(this.scene.materialTrees[k].name===
b){g=this.scene.materialTrees[k];n=this.scene.materialsContent.materialSettingsByName[g.id][d];break}if(g&&n){this.apiCore.exec(this.callerName,"registerCustomText",b,d,stage.extend(!0,{},e),f);var v=this.apiCore.exec(this.callerName,"createTextsImg",stage.extend(!0,{},e));b=this.scene.materials[n.id];d=g=!1;for(k in f)switch(f[k][0]){case "opacity":g=!0;break;case "diffuse":d=!0}if(g){g=this.scene.materials[n.id].opacity.channel;d||(e.color=R.call(this,e.color,g),void 0!==e.strokeColor&&(e.strokeColor=
R.call(this,e.strokeColor,g)));e.backgroundColor=R.call(this,e.backgroundColor,g);if(!d)for(k in e.texts){var l=e.texts[k];void 0!==l.color&&(l.color=R.call(this,l.color,g));void 0!==l.strokeColor&&(l.strokeColor=R.call(this,l.strokeColor,g))}textCanvas=this.apiCore.exec(this.callerName,"createTextsImg",e,!0);if(!d){var r=textCanvas.getContext("2d");r.globalCompositeOperation="source-in";if(b.diffuse.texture){var q=new Image;q.crossOrigin="anonymous";q.onload=stage.setContext(function(){r.drawImage(q,
0,0,m,p);t=textCanvas.toDataURL("image/png");C.call(this,h,n.id,t,m,p,f,v)},this);q.src=b.diffuse.texture.imgsSrc?b.diffuse.texture.imgsSrc.defaultImage.realFilePath:b.diffuse.texture.images[0].images[0].realFilePath;return}e=b.diffuse.color;r.fillStyle="rgba("+parseInt(255*e[0])+","+parseInt(255*e[1])+","+parseInt(255*e[2])+", 1)";r.fillRect(0,0,m,p)}var t=textCanvas.toDataURL("image/png")}else t=this.apiCore.exec(this.callerName,"createTextsImg",e);C.call(this,h,n.id,t,m,p,f,v)}else this.apiCore.exec(this.callerName,
"onEndUpdateCustomTexture",h)},G=function(b,d,e,f,h,m,p){var g=null,n=null;for(v in this.scene.materialTrees)if(this.scene.materialTrees[v].name===b){g=this.scene.materialTrees[v];n=this.scene.materialsContent.materialSettingsByName[g.id][d];break}if(g&&n){g=stage.extend(!0,{},e);g.texts=[{text:e.text}];g.mode="horizontal";this.apiCore.exec(this.callerName,"registerCustomText",b,d,g,f);var k=this.apiCore.exec(this.callerName,"createMaximizedTextImg",stage.extend(!0,{},e));b=this.scene.materials[n.id];
d=g=!1;for(v in f)switch(f[v][0]){case "opacity":g=!0;break;case "diffuse":d=!0}if(g){var v=this.scene.materials[n.id].opacity.channel;d||(e.color=R.call(this,e.color,v),void 0!==e.strokeColor&&(e.strokeColor=R.call(this,e.strokeColor,v)));e.backgroundColor=R.call(this,e.backgroundColor,v);textCanvas=this.apiCore.exec(this.callerName,"createMaximizedTextImg",e,!0);if(!d){var l=textCanvas.getContext("2d");l.globalCompositeOperation="source-in";if(b.diffuse.texture){var r=new Image;r.crossOrigin="anonymous";
r.onload=stage.setContext(function(){l.drawImage(r,0,0,m,p);q=textCanvas.toDataURL("image/png");C.call(this,h,n.id,q,m,p,f,k)},this);r.src=b.diffuse.texture.imgsSrc?b.diffuse.texture.imgsSrc.defaultImage.realFilePath:b.diffuse.texture.images[0].images[0].realFilePath;return}e=b.diffuse.color;l.fillStyle="rgba("+parseInt(255*e[0])+","+parseInt(255*e[1])+","+parseInt(255*e[2])+", 1)";l.fillRect(0,0,m,p)}var q=textCanvas.toDataURL("image/png")}else q=this.apiCore.exec(this.callerName,"createMaximizedTextImg",
e);C.call(this,h,n.id,q,m,p,f,k)}else this.apiCore.exec(this.callerName,"onEndUpdateCustomTexture",h)},S=function(){for(var b in this.uiViewpoints)this.uiViewpoints[b].images=[];for(b in this.materialTrees){var e=this.materialTrees[b];if(!e.isHidden&&(e=e.materialsSettings[e.currentMaterialId]))for(var f in this.viewpoints){var h=this.viewpoints[f].id;e.msCtsByViewpoint[h]&&e.msCtsByViewpoint[h].imageData?(e.msCtsByViewpoint[h].number=e.imagesByViewpoint[h]?e.imagesByViewpoint[h].number:9999999999999,
e.msCtsByViewpoint[h].custom=!0,this.uiViewpointsById[h].images.push(e.msCtsByViewpoint[h])):e.imagesByViewpoint[h]&&""!=e.imagesByViewpoint[h].filePath&&this.uiViewpointsById[h].images.push(e.imagesByViewpoint[h])}}for(b in this.uiViewpoints)this.uiViewpoints[b].images.sort(d);return[].concat(this.uiViewpoints)},Y=function(){for(var b in this.uiViewpoints)this.uiViewpoints[b].images=[];var e={};for(b in this.scene.polylistInstances){var f=this.scene.polylistInstances[b],h=f.polylist;e[h.id]||(e[h.id]=
!0);f=f.materialTree;if(!h.isHidden&&!f.isHidden&&(f=f.materialsSettings[f.currentMaterialId]))for(var m in this.viewpoints){var p=this.viewpoints[m].id;f.msCtsByViewpoint[p]&&f.msCtsByViewpoint[p].imageData?(f.msCtsByViewpoint[p].number=f.imagesByViewpoint[p]?f.imagesByViewpoint[p].number:9999999999999,f.msCtsByViewpoint[p].custom=!0,this.uiViewpointsById[p].images.push(f.msCtsByViewpoint[p])):h.imagesByViewpoint[f.id][p]&&""!=h.imagesByViewpoint[f.id][p].filePath&&this.uiViewpointsById[p].images.push(h.imagesByViewpoint[f.id][p])}}for(b in this.uiViewpoints)this.uiViewpoints[b].images.sort(d);
return[].concat(this.uiViewpoints)},ia=function(b){for(var d in this.uiViewpoints)this.uiViewpoints[d].images=[];for(var e in b.imagesByViewpoint)this.uiViewpointsById[e].images.push(b.imagesByViewpoint[e]);return[].concat(this.uiViewpoints)},Q=function(){for(var b in this.uiViewpoints)this.uiViewpoints[b].images=[];for(b in this.materialTreesGroups){var e=this.materialTreesGroups[b].currentConfiguration,f;for(f in this.viewpoints){var h=this.viewpoints[f].id;e.msCtsByViewpoint[h]&&e.msCtsByViewpoint[h].imageData?
(e.msCtsByViewpoint[h].number=e.imagesByViewpoint[h]?e.imagesByViewpoint[h].number:9999999999999,e.msCtsByViewpoint[h].custom=!0,this.uiViewpointsById[h].images.push(e.msCtsByViewpoint[h])):e.imagesByViewpoint[h]&&""!=e.imagesByViewpoint[h].filePath&&this.uiViewpointsById[h].images.push(e.imagesByViewpoint[h])}}for(b in this.uiViewpoints)this.uiViewpoints[b].images.sort(d);return[].concat(this.uiViewpoints)},ta=function(){return this.scene},ua=function(b,d){this.fallbackRenderer?this.fallbackRenderer.setZoomRatio(b):
console.warn("no renderer to update zoom ratio")},ea=function(b,d,e,f,h,m){e=this.viewpoints[0];h&&(e=this.viewpoints[Ga.call(this,h)]);ka.call(this,b,d,[e.number],void 0,function(b){m(b[0].screenshot)})},oa=function(b,d,e,f,h,m){e=[];for(var p in h)e.push(this.viewpoints[Ga.call(this,h[p])].number);e.length||e.push(this.viewpoints[0].number);ka.call(this,b,d,e,void 0,m)},ba=function(b,d,e,f,h,m){da.call(this,b,d,void 0,h?this.viewpoints[Ga.call(this,h)].number:this.viewpoints[0].number,m)},ka=function(b,
d,e,f,h){this.displayed||p.call(this);var m=[],g;for(g in e)for(var n in this.viewpoints)if(e[g]==this.viewpoints[n].number){m.push(this.viewpoints[n]);break}this.fallbackRenderer.getScreenshots(b,d,m,f,h)},Z=function(b,d,e,f){this.displayed||p.call(this);if(f){var h=[],m;for(m in this.viewpoints)if(f==this.viewpoints[m].number){h.push(this.viewpoints[m]);break}f=this.fallbackRenderer.getViewpointsImages(h)}else f=this.fallbackRenderer.getCurrentImages();h=document.createElement("canvas");h.width=
b;h.height=d;var g=b/d;for(m in f){var n=f[m].naturalWidth/f[m].naturalHeight,k=h.getContext("2d");if(this.settings.adaptativeFov)X.call(this,b,d,k,f[m],e);else if(g<n){n=b;var v=d,l=f[m],r=e,q=l.naturalWidth,t=l.naturalHeight,B=q/t;n/v>B?(newWidth=n,newHeight=newWidth/B):(newHeight=v,newWidth=newHeight*B);r?k.drawImage(l,q*r.x,t*r.y,q*r.width,t*r.height,(n-newWidth)/2,(v-newHeight)/2,newWidth,newHeight):k.drawImage(l,(n-newWidth)/2,(v-newHeight)/2,newWidth,newHeight)}else X.call(this,b,d,k,f[m],
e)}return h.toDataURL("image/png")},da=function(b,d,e,f,h){ka.call(this,b,d,[f],e,stage.setContext(function(b){h(stage.createResult("**"+this.statId+"**"+b[0].screenshot))},this))},X=function(b,d,e,f,h){var m=f.naturalWidth,p=f.naturalHeight,g=m/p;b/d>g?(newHeight=d,newWidth=newHeight*g):(newWidth=b,newHeight=newWidth/g);h?e.drawImage(f,m*h.x,p*h.y,m*h.width,p*h.height,(b-newWidth)/2,(d-newHeight)/2,newWidth,newHeight):e.drawImage(f,(b-newWidth)/2,(d-newHeight)/2,newWidth,newHeight)},Ha=function(){var b=
this.fallbackRenderer.getCurrentViewpoint(),d=null;for(e in this.viewpoints)if(this.viewpoints[e].id===b.id){d={cameraControl:null,controlMode:-1,mode:-1,fov:0,zoomProportion:1,position:this.viewpoints[e].cameraPosition,up:this.viewpoints[e].cameraUp,target:this.viewpoints[e].cameraTarget};var e=this.windowWidth/this.windowHeight;var f=this.fallback.width/this.fallback.height;if(e>f){b=vec3.subtract(d.position,d.target,vec3.create());var h=vec3.length(b);this.settings.adaptativeFov&&1>e?(e=h*e/f,
d.position=vec3.add(vec3.scale(vec3.normalize(b),e),d.target,vec3.create())):this.settings.adaptativeFov||1<f?1>f&&(e=h/f,d.position=vec3.add(vec3.scale(vec3.normalize(b),e),d.target,vec3.create())):(e=h/f,d.position=vec3.add(vec3.scale(vec3.normalize(b),e),d.target,vec3.create()))}else b=vec3.subtract(d.position,d.target,vec3.create()),h=vec3.length(b),this.settings.adaptativeFov&&1>e?1<f&&(e=h*f,d.position=vec3.add(vec3.scale(vec3.normalize(b),e),d.target,vec3.create())):(e=this.settings.adaptativeFov||
1<f?h*f/e:h/e,d.position=vec3.add(vec3.scale(vec3.normalize(b),e),d.target,vec3.create()));break}return d},Ga=function(b){var d=-1,e=999999999,f;for(f in this.viewpoints){var h=this.viewpoints[f],m=vec3.length(vec3.subtract(b.target,h.cameraTarget,vec3.create())),p=vec3.length(vec3.subtract(b.position,h.cameraPosition,vec3.create()));h=vec3.length(vec3.subtract(b.up,h.cameraUp,vec3.create()));m=2*m+2*p+h;m<e&&(e=m,d=f)}return d},Fa=function(b,d,e,f){if(b.length){var h=Ga.call(this,b[0]);0<=h&&(this.fallbackRenderer.setViewpoint(this.viewpoints[h]),
setTimeout(stage.setContext(function(){var b=this.viewpoints[h];b={position:vec3.create(b.cameraPosition),target:vec3.create(b.cameraTarget),up:vec3.create(b.cameraUp)};this.apiCore.exec(this.callerName,"cameraAnimationEnd",b);f()},this),10))}},xa=function(b,d){for(var e in this.viewpoints)if(this.viewpoints[e].number==b){this.fallbackRenderer.setViewpoint(this.viewpoints[e],d);break}},Ia=function(b){this.showForce3DButton||void 0!==b&&!b||(b=[{tagName:"div",returnActive:!0,attributes:{klass:"fallbackPreviewImageMessageContainer",
inner:this.apiCore.exec(this.callerName,"translate","fallbackMessage")},childs:[{tagName:"div",attributes:{id:"fallbackQuitIcon"}}]}],this.previewMessageContainer=this.mainContainer.build(b),this.previewMessageContainer.css({top:"calc(50% - "+(this.previewMessageContainer.getWH()[0]/2+17)+"px)"}),this.previewMessageContainer.find("#fallbackQuitIcon").listen("click",stage.setContext(function(){this.previewMessageContainer.remove();this.previewMessageContainer=null},this)),this.apiCore.exec(this.callerName,
"lib.insertSvg",this.fullIcons.quitIcon,{mouseOver:!0}));this.apiCore.exec(this.callerName,"ui.showPreview");this.apiCore.exec(this.callerName,"ui.showBackground");this.mainContainer.show();wa.call(this)},qa=function(b,d){this.viewerFallbackActive=!0;this.viewerFallbackContainer&&(this.viewerFallbackContainer.remove(),this.viewerFallbackContainer=null);this.viewerFallbackContainer=this.mainContainer.build([{returnActive:!0,tagName:"div",attributes:{klass:"viewerFallbackContainer",id:"viewerFallbackContainer"},
childs:[{tagName:"div",attributes:{klass:"imageContainer"},childs:[{tagName:"div",attributes:{klass:"imageSizeRegulator"},childs:[{tagName:"img",attributes:{src:"",klass:"space"}},{tagName:"img",attributes:{draggable:"false",src:"",klass:"viewerFallbackImage"}}]}]}]}]);this.mainContainer.ondragstart=function(){return!1};b=this.viewerFallbackContainer.find(".imageContainer");this.viewerFallbackImage=b.find(".viewerFallbackImage");this.horizontalDivisor=this.settings.viewerFallback.horizontalDivisor;
this.verticalDivisor=this.settings.viewerFallback.verticalDivisor;this.horizontalPosition=this.settings.viewerFallback.horizontalLineStart%this.verticalDivisor;this.verticalPosition=this.settings.viewerFallback.verticalColumnStart%this.horizontalDivisor;this.numImageToLoad=2;b=b.find("img");b.get(0).onload=stage.setContext(va,this);b.get(0).src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3gkJCTYAEjVQ/gAAAB1pVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVBkLmUHAAAADUlEQVQI12P4//8/AwAI/AL+XJ/P2gAAAABJRU5ErkJggg==";
b.get(0).unselectable=!0;this.viewerFallbackImage.get(0).onload=stage.setContext(va,this);this.viewerFallbackImage.get(0).onerror=stage.setContext(function(){this.apiCore.exec(this.callerName,"setViewerFallbackError")},this);this.settings.viewerFallback.fallbackData?this.viewerFallbackImage.get(0).src=this.settings.viewerFallback.fallbackData[this.settings.startingViewpoint]:this.viewerFallbackImage.get(0).src=this.settings.viewerFallback.filePath;if("jpg"==this.settings.viewerFallback.imageFormat){var e=
this.scene.scenery.backgroundColor;e&&b.css({"background-color":"rgba("+Math.round(255*e[0])+","+Math.round(255*e[1])+","+Math.round(255*e[2])+",1"})}else b.css({"background-color":"rgba(0,0,0,0"});this.apiCore.exec(this.callerName,"ui.showBackground");Ba.call(this,d);this.mainContainer.show();wa.call(this);this.apiCore.exec(this.callerName,"viewerFallbackDisplayed")},Va=function(b,e){if(b)if(this.fallbackDisplayed=!0,this.apiCore.exec(this.callerName,"rdr.hide"),this.apiCore.exec(this.callerName,
"ui.hide"),e.fallback){b=[];for(var f in e.fallback.viewpoints){var h=e.fallback.viewpoints[f];h.cameraPosition=[h.camera_position_x,h.camera_position_y,h.camera_position_z];h.cameraUp=[h.camera_up_x,h.camera_up_y,h.camera_up_z];h.cameraTarget=[h.camera_target_x,h.camera_target_y,h.camera_target_z];h.mtgcImages=h.mtgc_images;h.msImages=h.ms_images;h.polyImages=h.poly_images;h.presetImages=h.preset_images;for(var m in h.presetImages)h.presetImages[m].presetId=h.presetImages[m].id;var p={id:h.id,name:h.name,
number:h.number,thumbnail:h.thumbnail,realThumbnail:h.realThumbnail,images:[]};e.viewpoint&&e.viewpoint.id===h.id&&(p.selected=!0);var g=-1;if(0<h.msImages.length)for(var n in h.msImages){var k=h.msImages[n];k.number!=g&&(g=k.number,p.images.push({filePath:e.filePath+k.file_path,realFilePath:e.filePath+k.file_path,thumbRealFilePath:e.filePath+k.file_path,number:k.number}))}else if(0<h.mtgcImages.length)for(n in h.mtgcImages)k=h.mtgcImages[n],k.number!=g&&(g=k.number,p.images.push({filePath:e.filePath+
k.file_path,realFilePath:e.filePath+k.file_path,thumbRealFilePath:e.filePath+k.file_path,number:k.number}));else for(n in h.polyImages)k=h.polyImages[n],k.number!=g&&(g=k.number,p.images.push({filePath:e.filePath+k.file_path,realFilePath:e.filePath+k.file_path,thumbRealFilePath:e.filePath+k.file_path,number:k.number}));b.push(p)}b.sort(d);m=0;for(f in b)b[f].selected&&(m=f),b[f].images.sort(d);b.length&&(this.apiCore.exec(this.callerName,"ui.showBackground"),this.mainContainer.show(),this.fallbackRenderer?
(this.fallbackRenderer.setSettings({imagesWidth:e.fallback.width,imagesHeight:e.fallback.height,thumbnailSize:e.fallback.thumbnailSize,interactive:e.fallback.interactive,adaptativeFov:e.adaptativeFov?e.adaptativeFov:this.settings.adaptativeFov,style:e.style?e.style:this.settings.style,uiType:e.ui&&e.ui.type?e.ui.type:this.settings.ui.type,uiPosition:e.ui&&e.ui.position?e.ui.position:this.settings.ui.position,uiAlignment:e.ui&&e.ui.alignment?e.ui.alignment:this.settings.ui.alignment,thumbFromVp:!(e.ui&&
e.ui.useDynamicThumbnails?e.ui.useDynamicThumbnails:this.settings.ui.useDynamicThumbnails)}),this.fallbackRenderer.show(),this.fallbackRenderer.setViewpoints(b)):this.fallbackRenderer=new stage.emersya.viewer.modules.fallbackRenderer(this.apiCore,this.mainContainer,this.uiParentElement,b,{imagesWidth:e.fallback.width,imagesHeight:e.fallback.height,thumbnailSize:e.fallback.thumbnailSize,interactive:e.fallback.interactive,adaptativeFov:e.adaptativeFov?e.adaptativeFov:this.settings.adaptativeFov,style:e.style?
e.style:this.settings.style,uiType:e.ui&&e.ui.type?e.ui.type:this.settings.ui.type,uiPosition:e.ui&&e.ui.position?e.ui.position:this.settings.ui.position,uiAlignment:e.ui&&e.ui.alignment?e.ui.alignment:this.settings.ui.alignment,thumbFromVp:!(e.ui&&e.ui.useDynamicThumbnails?e.ui.useDynamicThumbnails:this.settings.ui.useDynamicThumbnails),startingViewpoint:m}))}else this.apiCore.exec(this.callerName,"ui.hide"),delete this.settings.viewerFallback.fallbackData,delete this.settings.viewerFallback.filePath,
stage.extend(this.settings.viewerFallback,e),qa.call(this,!0,!1);else this.fallbackDisplayed&&(this.fallbackDisplayed=!1,fa.call(this),this.apiCore.exec(this.callerName,"rdr.show"),this.mainContainer.hide(),this.fallbackRenderer&&(this.fallbackRenderer.destroy(),this.fallbackRenderer=null),this.apiCore.exec(this.callerName,"ui.show"))},va=function(){this.numImageToLoad--;0==this.numImageToLoad&&(ma.call(this),this.apiCore.exec(this.callerName,"ui.hideBasicLoader"),this.apiCore.exec(this.callerName,
"ui.hidePreview"),this.apiCore.exec(this.callerName,"ui.updateLoader",1,1))},la=function(){this.fallbackRenderer&&this.mainContainer.show();this.viewerFallbackActive&&(this.viewerFallbackContainer.show(),this.messageFallbackContainer.show(),this.buttonFallbackContainer.show())},fa=function(){this.fallbackRenderer&&(this.force3DContainer.hide(),this.fallbackRenderer.hide());this.viewerFallbackActive&&(this.viewerFallbackContainer.hide(),this.messageFallbackContainer&&(this.messageFallbackContainer.hide(),
this.buttonFallbackContainer.hide()),this.viewerFallbackActive=!1)},P=function(){return{line_to_start:this.horizontalPosition,column_to_start:this.verticalPosition}},Ba=function(b){if(this.settings.displayMessage&&b){this.messageFallbackContainer&&(this.messageFallbackContainer.remove(),this.messageFallbackContainer=null);this.buttonFallbackContainer&&(this.buttonFallbackContainer.remove(),this.buttonFallbackContainer=null);this.apiCore.exec(this.callerName,"getWebGLState");b=stage.browser.Ie&&11>
stage.browser.version?window.navigator.systemLanguage.substr(0,2):window.navigator.language.substr(0,2);"en"!=b&&"fr"!=b&&(b="en");var d="/"+b+"/3dSupport";this.buttonFallbackContainer=this.mainContainer.build([{returnActive:!0,tagName:"span",attributes:{klass:"buttonFallbackContainer"},childs:[{tagName:"span",attributes:{id:"buttonFallbackContainer"}}]}]);this.cursorState="out";Ka.call(this,this.mainContainer);this.buttonFallbackContainer.get(0).style.opacity=.8;stage.browser.Ie&&9>stage.browser.version&&
this.buttonFallbackContainer.remove();this.mainContainer.listen("mousedown",stage.setContext(function(){this.buttonFallbackContainer.fade(.2);this.mainContainer.css({cursor:"grabbing"});stage.browser.Webkit&&this.mainContainer.css({cursor:"-webkit-grabbing"});stage.browser.Gecko&&this.mainContainer.css({cursor:"-moz-grabbing"});stage.browser.Opera&&this.mainContainer.css({cursor:"-o-grabbing"});stage.browser.Ie&&this.mainContainer.css({cursor:"move"})},this));this.mainContainer.listen("mouseup",stage.setContext(function(){Ka.call(this,
this.mainContainer)},this));var e={framerate:25},f={duration:.2,css:{opacity:.5}},h={duration:.2,css:{opacity:.8}};this.mainContainer.listen("mouseenter",stage.setContext(function(){0!=this.buttonFallbackContainer.get(0).style.opacity&&(this.animEnter=stage.ui.animate(null,e),this.animEnter.addElement(this.buttonFallbackContainer),this.animEnter.addEffect("css",f),this.animEnter.play());this.cursorState="in"},this));this.mainContainer.listen("mouseleave",stage.setContext(function(){null!=this.animBarLeave&&
this.animBarLeave.hearBeat.stop();if(.5==this.buttonFallbackContainer.get(0).style.opacity){var b=stage.ui.animate(null,e);b.addElement(this.buttonFallbackContainer);b.addEffect("css",h);b.play()}this.cursorState="out"},this));b=[{returnActive:!0,tagName:"div",attributes:{klass:"messageFallbackContainer"},childs:[{tagName:"span",attributes:{id:"fallbackQuitIcon"},events:[{onEvent:"click",callback:stage.setContext(function(){this.messageFallbackContainer.remove();this.messageFallbackContainer=null;
wa.call(this)},this)}]},{tagName:"div",attributes:{klass:"textMessageFallback"},childs:[{tagName:"p",attributes:{klass:"",inner:this.apiCore.exec(this.callerName,"translate","fallbackUpgradeMessage")},childs:[{tagName:"span",attributes:{klass:"textMessageFallbackLink",inner:this.apiCore.exec(this.callerName,"translate","seeHow")},events:[{onEvent:"click",callback:stage.setContext(function(){window.open(d)},this)}]}]}]}]}];this.messageFallbackContainer=this.mainContainer.build(b);this.apiCore.exec(this.callerName,
"lib.insertSvg",this.fullIcons.quitIcon,{mouseOver:!0});this.mainContainer.listen("touchmove",stage.setContext(function(){this.mainContainer.find(".buttonFallbackContainer").hide()},this));this.settings.displayMessage&&!stage.browser.mobilBrowser||this.messageFallbackContainer.hide();stage.browser.Ie&&10>stage.browser.version&&this.messageFallbackContainer.css({backgroundColor:"Black",opacity:.8});this.messageFallbackContainer.listen("mousedown",function(b){b.stopPropagation()});this.messageFallbackContainer.listen("mouseenter",
stage.setContext(function(){if(0!=this.buttonFallbackContainer.get(0).style.opacity){this.animEnter.hearBeat.stop();var b=stage.ui.animate(null,e);b.addElement(this.buttonFallbackContainer);b.addEffect("css",h);b.play()}this.cursorState="inBar"},this));this.messageFallbackContainer.listen("mouseleave",stage.setContext(function(){0!=this.buttonFallbackContainer.get(0).style.opacity&&(this.animBarLeave=stage.ui.animate(null,e),this.animBarLeave.addElement(this.buttonFallbackContainer),this.animBarLeave.addEffect("css",
f),this.animBarLeave.play())},this))}},Ka=function(b){b.css({cursor:"grab"});stage.browser.Webkit&&b.css({cursor:"-webkit-grab"});stage.browser.Gecko&&b.css({cursor:"-moz-grab"});stage.browser.Opera&&b.css({cursor:"-o-grab"});stage.browser.Ie&&b.css({cursor:"pointer"})},wa=function(){this.windowWidth=!stage.browser.Ie||11<=stage.browser.version?window.innerWidth:document.documentElement.clientWidth||document.body.clientWidth;this.windowHeight=!stage.browser.Ie||11<=stage.browser.version?window.innerHeight:
document.documentElement.clientHeight||document.body.clientHeight;this.viewerFallbackActive&&(ma.call(this),this.settings.viewerFallback.xLimit=this.mainContainer.selector[0].offsetWidth/this.settings.viewerFallback.horizontalDivisor/1.5,this.settings.viewerFallback.yLimit=this.mainContainer.selector[0].offsetHeight/(this.settings.viewerFallback.verticalDivisor+2));if(this.settings.displayMessage){this.messageFallbackContainer&&this.messageFallbackContainer.css("height");var b=Math.min(this.windowWidth,
this.windowHeight)/6,d=b/.6875;var e=d/5+(this.messageFallbackContainer?this.messageFallbackContainer.get(0).clientHeight:0);var f=this.messageFallbackContainer?e-this.messageFallbackContainer.get(0).clientHeight:e;this.buttonFallbackContainer&&this.buttonFallbackContainer.css({right:f,bottom:e,height:d,width:d,borderRadius:.2*b+"px"});45>d?(this.buttonFallbackContainer&&this.buttonFallbackContainer.css({display:"none"}),this.messageFallbackContainer&&this.messageFallbackContainer.find("p").css({fontSize:"9px"})):
(this.buttonFallbackContainer&&this.buttonFallbackContainer.css({display:"block"}),this.messageFallbackContainer&&this.messageFallbackContainer.find("p").css({fontSize:"11px"}))}this.previewMessageContainer&&this.previewMessageContainer.find(".fallbackPreviewImageQuitIcon").css({lineHeight:this.previewMessageContainer.get(0).clientHeight+2+"px"});Ja.call(this)},Ja=function(){if(this.viewerFallbackActive)if(this.settings.viewerFallback.fallbackData)this.viewerFallbackImage.get(0).src=this.settings.viewerFallback.fallbackData[this.horizontalPosition*
this.horizontalDivisor+this.verticalPosition];else{var b=this.viewerFallbackContainer.getWidth()/512;this.viewerFallbackImage.css({left:(-(512*this.verticalPosition)-512*this.settings.viewerFallback.horizontalDivisor*this.horizontalPosition)*b})}},La=function(){switch(this.settings.viewerFallback.verticalDivisor){case 1:case "1":var b=0;break;case 3:case "3":b=60*Math.PI/180;break;case 5:case "5":b=35*Math.PI/180;break;case 7:case "7":b=27*Math.PI/180}var d=this.verticalPosition/this.settings.viewerFallback.horizontalDivisor*
Math.PI*2;b*=this.horizontalPosition-Math.floor(this.settings.viewerFallback.verticalDivisor/2);var e=vec3.length(vec3.subtract(this.settings.viewerFallback.camera.position,this.settings.viewerFallback.camera.target,vec3.create())),f=vec3.create();vec3.set(this.settings.viewerFallback.camera.target,f);var h=vec3.create(),m=vec3.create([0,1,0]),p=vec3.create([1,0,0]);vec3.set([0,0,1],h);var g=mat4.create();mat4.create();vec3.normalize(h);mat4.identity(g);mat4.rotate(g,d,m);mat4.rotate(g,b,p);mat4.multiplyVec3(g,
h);vec3.normalize(h);vec3.scale(h,e);vec3.add(h,f);return{position:h,target:f,up:vec3.create(this.settings.viewerFallback.camera.up)}},ra=function(b){for(var d=this.horizontalPosition,e=this.verticalPosition,f=999999999,h=null,m=0;m<this.settings.viewerFallback.horizontalDivisor;++m)for(var p=0;p<this.settings.viewerFallback.verticalDivisor;++p){this.horizontalPosition=p;this.verticalPosition=m;var g=La.call(this),n=vec3.length(vec3.subtract(b.target,g.target,vec3.create())),k=vec3.length(vec3.subtract(b.position,
g.position,vec3.create()));g=vec3.length(vec3.subtract(b.up,g.up,vec3.create()));n=2*n+2*k+g;n<f&&(f=n,h={horizontal:p,vertical:m})}h?(this.horizontalPosition=h.horizontal,this.verticalPosition=h.vertical):(this.horizontalPosition=d,this.verticalPosition=e);Ja.call(this)},Sa=function(b,d){this.viewerFallbackActive&&(this.deltaX+=b,this.deltaY+=d,Math.abs(this.deltaX)>this.settings.viewerFallback.xLimit&&(this.verticalPosition=0<this.deltaX?0<=--this.verticalPosition?this.verticalPosition%this.horizontalDivisor:
this.horizontalDivisor-1:0<=++this.verticalPosition?this.verticalPosition%this.horizontalDivisor:this.horizontalDivisor-1,Ja.call(this),this.deltaX=0,this.camera.position=[this.horizontalPosition,this.verticalPosition,0],this.apiCore.exec(this.callerName,"updateCameraInteraction",this.camera,"r")),Math.abs(this.deltaY)>this.settings.viewerFallback.yLimit&&(0<this.deltaY?0<this.horizontalPosition&&this.horizontalPosition--:this.horizontalPosition<this.verticalDivisor-1&&this.horizontalPosition++,Ja.call(this),
this.deltaY=0,this.camera.position=[this.horizontalPosition,this.verticalPosition,0],this.apiCore.exec(this.callerName,"updateCameraInteraction",this.camera,"r")))},Ya=function(){this.viewerFallbackActive&&(this.camera.position=[this.horizontalPosition,this.verticalPosition,0],this.apiCore.exec(this.callerName,"startCameraInteraction",this.camera,"r"))},Ra=function(){this.viewerFallbackActive&&(this.camera.position=[this.horizontalPosition,this.verticalPosition,0],this.apiCore.exec(this.callerName,
"endCameraInteraction",this.camera,"n"))},ma=function(){var b=Math.min(this.mainContainer.selector[0].offsetWidth,this.mainContainer.selector[0].offsetHeight);this.viewerFallbackContainer.css({width:b+"px",height:b+"px"});this.viewerFallbackImage.css({width:this.viewerFallbackImage.get(0).naturalWidth*b/this.viewerFallbackImage.get(0).naturalHeight+"px"});this.mainContainer.selector[0].offsetWidth<this.mainContainer.selector[0].offsetHeight?this.viewerFallbackContainer.css({marginTop:(this.mainContainer.selector[0].offsetHeight-
this.mainContainer.selector[0].offsetWidth)/2+"px"}):this.viewerFallbackContainer.css({marginTop:0})},bb=function(b){b&&(this.settings.ui.type=b.fallback_ui_type,this.settings.ui.alignment=b.fallback_ui_alignment,this.settings.ui.position=b.fallback_ui_position,this.settings.ui.useDynamicThumbnails=b.fallback_use_dynamic_thumbnails,gb.call(this,b))},gb=function(b){b&&(this.settings.style.backgroundOverColor=b.over_background_color,this.settings.style.backgroundNormalColor=b.normal_background_color,
this.settings.style.backgroundSelectedColor=b.selected_background_color,this.settings.style.foregroundOverColor=b.over_foreground_color,this.settings.style.foregroundNormalColor=b.normal_foreground_color,this.settings.style.foregroundSelectedColor=b.selected_foreground_color,this.settings.style.neutralOverColor=b.over_neutral_color,this.settings.style.neutralNormalColor=b.normal_neutral_color,this.settings.style.neutralSelectedColor=b.selected_neutralground_color,this.settings.style.borderColor=b.border_color,
this.settings.style.logoNeutralColor=b.logo_neutral_color)};return u});stage.provide("emersya.viewer.modules.fallbackRenderer");
stage.register.call(stage.emersya.viewer.modules,"fallbackRenderer",function(){var b={imagesWidth:1,imagesHeight:1,thumbnailSize:1,interactive:!1,uiType:stage.emersya.viewer.FALLBACK_UI_TYPE.POINTS_BAR,uiPosition:"bottom",uiAlignment:"center",thumbFromVp:!0,vpCount:-1,startingViewpoint:0,style:{backgroundOverColor:"#00b1abff",backgroundNormalColor:"#303030DD",backgroundSelectedColor:"#000000DD",foregroundOverColor:"#ffffffff",foregroundNormalColor:"#ffffffff",foregroundSelectedColor:"#00b1abff",neutralOverColor:"#888888ff",
neutralNormalColor:"#888888ff",neutralSelectedColor:"#00b1abff",borderColor:"#ffffff30",logoNeutralColor:"#434649"}},d=null,u=function(e,h,m,p,k,v){this.settings=stage.extend({},b,k);this.apiCore=e;this.viewpoints=p;this.currentViewpointIndex=this.settings.startingViewpoint;this.currentViewpoint=this.viewpoints[this.currentViewpointIndex];this.parentElement=h;this.uiContainer=m;this.imagesToLoad=0;this.callerName=this.name="fallbackRenderer";this.apiCore.register(this,"resize",ba);this.settings.interactive&&
(this.apiCore.register(this,"mousePosUpdate",t),this.apiCore.register(this,"deltaUpdate",r),this.apiCore.register(this,"mouseButtonPress",f),this.apiCore.register(this,"mouseButtonRelease",n),this.apiCore.register(this,"wheelUpdate",B),this.apiCore.register(this,"click",w));this.imagesCanvas=[];this.imagesCtx=[];this.webgl=!1;this.mainContainer=this.parentElement.build([{returnActive:!0,tagName:"div",attributes:{klass:"fallbackRendererMainContainer"},childs:[{tagName:"div",attributes:{klass:"fallbackRendererImagesParentContainer"},
childs:[{tagName:"div",attributes:{klass:"fallbackRendererImagesContainer"}}]}]}]);this.imagesContainer=this.mainContainer.children().first().children().first();this.webgl&&this.imagesContainer.get(0).appendChild(this.canvas);l.call(this);g.call(this);this.posY=this.posX=0;this.scale=1;E.call(this,v);ba.call(this)};u.prototype.destroy=function(){A.call(this);this.previousViewpoint=this.currentViewpoint;A.call(this);this.apiCore.unregister(this,"resize");this.settings.interactive&&(this.apiCore.unregister(this,
"mousePosUpdate"),this.apiCore.unregister(this,"deltaUpdate"),this.apiCore.unregister(this,"mouseButtonPress"),this.apiCore.unregister(this,"mouseButtonRelease"),this.apiCore.unregister(this,"wheelUpdate"),this.apiCore.unregister(this,"click"));this.webgl&&(Z.call(this,this.viewpoints),d.deleteBuffer(this.vertexBufferScreen),d.deleteBuffer(this.vertexUvsBufferScreen),d.deleteBuffer(this.elementsBufferScreen),d.deleteProgram(this.shaderProgram),this.canvas.width=0,this.canvas.height=0,d=this.canvas=
null);this.mainContainer&&(this.mainContainer.remove(),this.mainContainer=null)};u.prototype.setSettings=function(b){this.settings=stage.extend({},this.settings,b)};u.prototype.setViewpoints=function(b,d){this.viewpoints.splice(this.currentViewpointIndex,1);Z.call(this,this.viewpoints);this.viewpoints=b;this.previousViewpoint=this.currentViewpoint;this.currentViewpoint=this.viewpoints[this.currentViewpointIndex];this.isHidden||(g.call(this),E.call(this,d),ba.call(this))};u.prototype.getCurrentImages=
function(){var b=[],d;for(d in this.currentViewpoint.images)this.currentViewpoint.images[d].custom||b.push(this.currentViewpoint.images[d].htmlImage);return b};u.prototype.getViewPointsImages=function(b){var d=[],e=[],f;for(f in b)this.viewpoints[f].id==b[f].id&&d.push(this.viewpoints[f]);for(f in d)for(var h in d[f].images)d[f].images[h].custom||e.push(d[f].images[h].htmlImage);return e};u.prototype.getCurrentViewpoint=function(){return this.currentViewpoint};u.prototype.setViewpoint=function(b,
d){var e=-1,f;for(f in this.viewpoints)if(this.viewpoints[f].id==b.id){e=f;break}-1!==e&&Q.call(this,e,d)};u.prototype.hide=function(){this.isHidden=!0;this.mainContainer.hide();this.hideUI()};u.prototype.show=function(){this.isHidden=!1;for(this.imagesCtx[0].clearRect(0,0,this.imagesCanvas[0].width,this.imagesCanvas[0].height);this.imagesContainer.get(0).firstChild;)this.imagesContainer.get(0).removeChild(this.imagesContainer.get(0).firstChild);this.imagesContainer.get(0).appendChild(this.imagesCanvas[0]);
this.mainContainer.show();this.showUI()};u.prototype.hideUI=function(){this.navBar&&this.navBar.hide();this.thumbBar&&this.thumbBar.hide();this.thumbTab&&this.thumbTab.hide();this.viewpointsListBar&&this.viewpointsListBar.hide()};u.prototype.showUI=function(){this.navBar&&this.navBar.show();this.thumbBar&&this.thumbBar.show();this.thumbTab&&this.thumbTab.show();this.viewpointsListBar&&this.viewpointsListBar.show()};u.prototype.setZoomRatio=function(b){var d=this.scale;this.scale=b*(this.maxScale-
1)+1;this.posX=.5*this.currentWidth-this.basePosX-(.5*this.currentWidth-this.posX-this.basePosX)*this.scale/d;this.posY=.5*this.currentHeight-this.basePosY-(.5*this.currentHeight-this.posY-this.basePosY)*this.scale/d;q.call(this);D.call(this)};u.prototype.cancelImageDownload=function(b){b.htmlImage&&!b.downloaded&&(delete b.htmlImage,--this.imagesToLoad)};var k=function(b,d,e,f,h){var m=f.naturalWidth,p=f.naturalHeight,g=m/p;b/d>g?(newWidth=b,newHeight=newWidth/g):(newHeight=d,newWidth=newHeight*
g);h?e.drawImage(f,m*h.x,p*h.y,m*h.width,p*h.height,(b-newWidth)/2,(d-newHeight)/2,newWidth,newHeight):e.drawImage(f,(b-newWidth)/2,(d-newHeight)/2,newWidth,newHeight)};u.prototype.getScreenshots=function(b,d,e,f,h){var m=[];for(g in e)for(var p in this.viewpoints)this.viewpoints[p].id==e[g].id&&m.push(this.viewpoints[p]);var g=Math.max(b,d);var n=f?g<=1.5*Math.min(f.width,f.height)*this.settings.thumbnailSize:g<=1.5*this.settings.thumbnailSize;this.screenshotImagesToLoad=0;e=function(){if(!--this.screenshotImagesToLoad){var e=
document.createElement("canvas");e.width=b;e.height=d;var p=e.getContext("2d"),g=[];if(n)for(var v in m){p.clearRect(0,0,b,d);for(var l=m[v],r=0;r<l.images.length;++r)!l.images[r].custom&&l.images[r].thumbHtmlImage&&l.images[r].thumbHtmlImage.naturalWidth&&(k(b,d,p,l.images[r].thumbHtmlImage,f),l.images[r].thumbnailDownloaded=!0);g.push({id:l.id,screenshot:e.toDataURL("image/png")})}else for(v in m){p.clearRect(0,0,b,d);l=m[v];for(r=0;r<l.images.length;++r)!l.images[r].custom&&l.images[r].htmlImage&&
l.images[r].htmlImage.naturalWidth&&(k(b,d,p,l.images[r].htmlImage,f),l.images[r].downloaded=!0);g.push({id:l.id,screenshot:e.toDataURL("image/png")})}h(g)}};if(n)for(p in m){var v=m[p];for(g=0;g<v.images.length;++g){var l=v.images[g];l.custom||l.thumbnailDownloaded||l.thumbHtmlImage||(++this.screenshotImagesToLoad,l.thumbHtmlImage=new Image,l.thumbHtmlImage.crossOrigin="anonymous",l.thumbHtmlImage.onload=stage.setContext(e,this),l.thumbHtmlImage.onerror=stage.setContext(e,this),l.thumbHtmlImage.src=
l.thumbRealFilePath,l.thumbnailDownloaded=!1)}}else for(p in m)for(v=m[p],g=0;g<v.images.length;++g)l=v.images[g],l.custom||l.downloaded||l.htmlImage||(++this.screenshotImagesToLoad,l.htmlImage=new Image,l.htmlImage.crossOrigin="anonymous",l.htmlImage.onload=stage.setContext(e,this),l.htmlImage.onerror=stage.setContext(e,this),l.htmlImage.src=l.realFilePath,l.downloaded=!1);this.screenshotImagesToLoad||(this.screenshotImagesToLoad=1,e.call(this))};var l=function(){var b=this.mainContainer.getWH(),
d=document.createElement("canvas"),e=d.getContext("2d");$$stage(d).css({width:"100%",height:"100%"});this.imagesCanvas.push(d);this.imagesCtx.push(e);b.width*=window.devicePixelRatio;b.height*=window.devicePixelRatio;d.width=b.width;d.height=b.height},g=function(){switch(this.settings.uiType){case stage.emersya.viewer.FALLBACK_UI_TYPE.POINTS_BAR:if(!(1>=this.viewpoints.length)){var b=[{returnActive:!0,tagName:"div",attributes:{klass:"fallbackRendererNavBarContainer fallbackRendererNoTouchHighlights fallbackRenderer_"+
this.settings.uiPosition,style:{"background-color":this.settings.style.backgroundNormalColor,color:this.settings.style.foregroundNormalColor}},childs:[{tagName:"div",attributes:{klass:"fallbackRendererNavBarPreviousContainer fallbackRenderer_"+this.settings.uiPosition}},{tagName:"div",attributes:{klass:"fallbackRendererNavBarViewpointsContainer fallbackRenderer_"+this.settings.uiPosition},childs:[]},{tagName:"div",attributes:{klass:"fallbackRendererNavBarNextContainer fallbackRenderer_"+this.settings.uiPosition}}]}];
this.navBar&&this.navBar.remove();this.navBar=this.uiContainer.build(b);for(var d=this.navBar.find(".fallbackRendererNavBarViewpointsContainer"),e=0;e<this.viewpoints.length;++e)b=[{returnActive:!0,tagName:"div",attributes:{klass:"fallbackRendererNavBarViewpointContainer fallbackRenderer_"+this.settings.uiPosition,title:this.viewpoints[e].name},childs:[{tagName:"div",attributes:{klass:"fallbackRendererNavBarViewpoint fallbackRenderer_"+this.settings.uiPosition},childs:[{tagName:"div",attributes:{klass:"fallbackRendererNavBarViewpointDisc",
style:{"border-color":this.settings.style.foregroundNormalColor}}}]}],events:[{onEvent:"click",callback:stage.setContext(Q,this,e,null)},{onEvent:"mouseenter",callback:stage.setContext(p,this,e)},{onEvent:"mouseleave",callback:stage.setContext(m,this,e)}]}],this.viewpoints[e].navBarElement=d.build(b);ta.call(this);b=this.navBar.getWH();d="right";switch(this.settings.uiPosition){case "left":d="left";case "right":e={};e[d]=""+(17+b.height/2-b.width/2)+"px";switch(this.settings.uiAlignment){case "top":e.top=
b.width/2+"px";break;case "bottom":e.bottom=b.width/2+"px";break;default:e.top="calc(50% - "+b.height/2+"px)"}this.navBar.css(e);break;case "top":case "bottom":switch(this.settings.uiAlignment){case "left":this.navBar.css({left:"17px"});break;case "right":this.navBar.css({right:"17px"});break;default:this.navBar.css({left:"calc(50% - "+b.width/2+"px)"})}}}this.thumbnailsNeeded=!1;break;case stage.emersya.viewer.FALLBACK_UI_TYPE.VIEWPOINTS_LIST:if(!(1>=this.viewpoints.length)){"top"!==this.settings.uiPosition&&
"bottom"!==this.settings.uiPosition&&(this.settings.uiPosition="top");b=[{returnActive:!0,tagName:"div",attributes:{klass:"fallbackRendererViewpointsListBarContainer fallbackRendererNoTouchHighlights fallbackRenderer_"+this.settings.uiPosition,style:{color:this.settings.style.foregroundNormalColor,"background-color":this.settings.style.backgroundNormalColor}},childs:[{tagName:"div",attributes:{klass:"fallbackRendererViewpointsListBarPreviousContainer fallbackRenderer_"+this.settings.uiPosition},childs:[{tagName:"div",
attributes:{klass:"fallbackRendererViewpointsListBarPrevious fallbackRenderer_"+this.settings.uiPosition}}],events:[{onEvent:"click",callback:stage.setContext(Y,this)}]},{tagName:"div",attributes:{klass:"fallbackRendererViewpointsListBarViewpointsContainer fallbackRenderer_"+this.settings.uiPosition},childs:[{tagName:"div",attributes:{klass:"fallbackRendererViewpointsListBarCurrentViewpointContainer fallbackRenderer_"+this.settings.uiPosition},childs:[{tagName:"div",attributes:{klass:"fallbackRendererViewpointsListBarCurrentViewpoint fallbackRenderer_"+
this.settings.uiPosition}}]},{tagName:"div",attributes:{klass:"fallbackRendererViewpointsListBarViewpointsListContainer fallbackRenderer_"+this.settings.uiPosition,style:{"background-color":this.settings.style.backgroundNormalColor}},childs:[{tagName:"div",attributes:{klass:"fallbackRendererViewpointsListBarViewpointsList fallbackRenderer_"+this.settings.uiPosition}}]}],events:[{onEvent:"click",callback:stage.setContext(T,this)}]},{tagName:"div",attributes:{klass:"fallbackRendererViewpointsListBarNextContainer fallbackRenderer_"+
this.settings.uiPosition},childs:[{tagName:"div",attributes:{klass:"fallbackRendererViewpointsListBarNext fallbackRenderer_"+this.settings.uiPosition}}],events:[{onEvent:"click",callback:stage.setContext(ia,this)}]}]}];this.viewpointsListBar&&this.viewpointsListBar.remove();this.viewpointsListBar=this.uiContainer.build(b);d=this.viewpointsListBar.find(".fallbackRendererViewpointsListBarViewpointsList");for(var f=e=0;f<this.viewpoints.length;++f)b=[{returnActive:!0,tagName:"div",attributes:{klass:"fallbackRendererViewpointsListBarViewpointsListViewpointContainer fallbackRenderer_"+
this.settings.uiPosition,title:this.viewpoints[f].name,style:{color:this.settings.style.foregroundNormalColor}},childs:[{tagName:"div",attributes:{klass:"fallbackRendererViewpointsListBarViewpointsListViewpoint fallbackRenderer_"+this.settings.uiPosition,inner:this.viewpoints[f].name}}],events:[{onEvent:"click",callback:stage.setContext(Q,this,f,null)},{onEvent:"mouseenter",callback:stage.setContext(I,this,f)},{onEvent:"mouseleave",callback:stage.setContext(J,this,f)}]}],this.viewpoints[f].viewpointsListBarElement=
d.build(b),e=Math.max(h(this.viewpoints[f].name),e);this.viewpointsListBar.find(".fallbackRendererViewpointsListBarViewpointsContainer").css({width:e+11+"px"});ua.call(this);v.call(this)}this.thumbnailsNeeded=!1;break;case stage.emersya.viewer.FALLBACK_UI_TYPE.THUMBNAIL_BAR:this.thumbBar||(d=[{tagName:"div",returnActive:!0,attributes:{klass:"fallbackRendererThumbBarContainer fallbackRendererNoTouchHighlights fallbackRenderer_"+this.settings.uiPosition},childs:[{tagName:"div",attributes:{klass:"fallbackRendererThumbBarPreviousContainer fallbackRenderer_"+
this.settings.uiPosition},childs:[{tagName:"div",attributes:{klass:"fallbackRendererThumbBarPrevious fallbackRenderer_"+this.settings.uiPosition}}],events:[{onEvent:"click",callback:stage.setContext(aa,this)}]},{tagName:"div",attributes:{klass:"fallbackRendererThumbBarViewpointsScrollContainer fallbackRenderer_"+this.settings.uiPosition},childs:[{tagName:"div",attributes:{klass:"fallbackRendererThumbBarViewpointsContainer fallbackRenderer_"+this.settings.uiPosition}}]},{tagName:"div",attributes:{klass:"fallbackRendererThumbBarNextContainer fallbackRenderer_"+
this.settings.uiPosition},childs:[{tagName:"div",attributes:{klass:"fallbackRendererThumbBarNext fallbackRenderer_"+this.settings.uiPosition}}],events:[{onEvent:"click",callback:stage.setContext(C,this)}]}]}],this.thumbBar=this.uiContainer.build(d));e=this.thumbBar.find(".fallbackRendererThumbBarViewpointsContainer");for(b in this.viewpoints)f=this.viewpoints[b],f.thumbBarElement||(d=[{returnActive:!0,tagName:"div",attributes:{klass:"fallbackRendererThumbBarViewpointContainer fallbackRenderer_"+this.settings.uiPosition,
title:this.viewpoints[b].name},childs:[],events:[{onEvent:"click",callback:stage.setContext(Q,this,b,null)}]}],d[0].childs.push({tagName:"div",attributes:{klass:"fallbackRendererThumbBarViewpoint fallbackRenderer_"+this.settings.uiPosition}}),f.thumbBarElement=e.build(d),f.thumbBarCanvas=document.createElement("canvas"),f.thumbBarCanvas.width=68,f.thumbBarCanvas.height=68,f.thumbBarCtx=f.thumbBarCanvas.getContext("2d"),f.thumbBarElement.children().first().get(0).appendChild(f.thumbBarCanvas));ea.call(this);
U.call(this);this.currentThumbBarPosition=Math.min(this.currentViewpointIndex,this.viewpoints.length-this.thumbBarVPCount);R.call(this);this.thumbnailsNeeded=!0;break;case stage.emersya.viewer.FALLBACK_UI_TYPE.THUMBNAIL_TAB:this.thumbTab||(b=[{tagName:"div",returnActive:!0,attributes:{klass:"fallbackRendererThumbTabContainer fallbackRendererNoTouchHighlights fallbackRenderer_"+this.settings.uiPosition,style:{"background-color":this.settings.style.borderColor}},childs:[{tagName:"div",attributes:{klass:"fallbackRendererThumbTabSubContainer fallbackRenderer_"+
this.settings.uiPosition},childs:[{tagName:"div",attributes:{klass:"fallbackRendererThumbTabPreviousContainer fallbackRenderer_"+this.settings.uiPosition},childs:[{tagName:"div",attributes:{klass:"fallbackRendererThumbTabPrevious fallbackRenderer_"+this.settings.uiPosition}}],events:[{onEvent:"click",callback:stage.setContext(G,this)}]},{tagName:"div",attributes:{klass:"fallbackRendererThumbTabViewpointsScrollContainer fallbackRenderer_"+this.settings.uiPosition},childs:[{tagName:"div",attributes:{klass:"fallbackRendererThumbTabViewpointsContainer fallbackRenderer_"+
this.settings.uiPosition}}]},{tagName:"div",attributes:{klass:"fallbackRendererThumbTabNextContainer fallbackRenderer_"+this.settings.uiPosition},childs:[{tagName:"div",attributes:{klass:"fallbackRendererThumbTabNext fallbackRenderer_"+this.settings.uiPosition}}],events:[{onEvent:"click",callback:stage.setContext(S,this)}]}]}]}],this.thumbTab=this.uiContainer.build(b));e=this.thumbTab.find(".fallbackRendererThumbTabViewpointsContainer");for(d in this.viewpoints)f=this.viewpoints[d],f.thumbTabElement||
(b=[{returnActive:!0,tagName:"div",attributes:{klass:"fallbackRendererThumbTabViewpointContainer fallbackRenderer_"+this.settings.uiPosition},childs:[],events:[{onEvent:"click",callback:stage.setContext(Q,this,d,null)}]}],b[0].childs.push({tagName:"div",attributes:{klass:"fallbackRendererThumbTabViewpoint fallbackRenderer_"+this.settings.uiPosition,title:f.name}}),f.thumbTabElement=e.build(b),f.thumbTabCanvas=document.createElement("canvas"),f.thumbTabCanvas.width=68,f.thumbTabCanvas.height=68,f.thumbTabCtx=
f.thumbTabCanvas.getContext("2d"),f.thumbTabElement.children().first().get(0).appendChild(f.thumbTabCanvas));oa.call(this);L.call(this);this.currentThumbTabPosition=Math.min(this.currentViewpointIndex,this.viewpoints.length-this.thumbTabVPCount);K.call(this);this.thumbnailsNeeded=!0}},q=function(){this.posX=this.currentWidth>this.scale*this.baseImagesWidth?Math.min(Math.max(this.posX,-this.basePosX),this.currentWidth-this.scale*this.baseImagesWidth-this.basePosX):Math.max(Math.min(this.posX,-this.basePosX),
this.currentWidth-this.scale*this.baseImagesWidth-this.basePosX);this.posY=this.currentHeight>this.scale*this.baseImagesHeight?Math.min(Math.max(this.posY,-this.basePosY),this.currentHeight-this.scale*this.baseImagesHeight-this.basePosY):Math.max(Math.min(this.posY,-this.basePosY),this.currentHeight-this.scale*this.baseImagesHeight-this.basePosY)},t=function(b,d){this.mouseX=b;this.mouseY=d},r=function(b,d){this.translating&&(this.posX+=b*window.devicePixelRatio,this.posY+=d*window.devicePixelRatio,
q.call(this),D.call(this))},f=function(b,d,e){b||(this.translating=!0)},n=function(b,d,e){b||(this.translating=!1)},B=function(b){var d=this.scale;this.scale*=1+b/1200;this.scale=Math.max(Math.min(this.scale,this.maxScale),1);this.posX=.5*this.currentWidth-this.basePosX-(.5*this.currentWidth-this.posX-this.basePosX)*this.scale/d;this.posY=.5*this.currentHeight-this.basePosY-(.5*this.currentHeight-this.posY-this.basePosY)*this.scale/d;q.call(this);D.call(this)},w=function(){this.scale==this.maxScale?
this.setZoomRatio(0):this.setZoomRatio(1)},D=function(){var b=0;for(this.imagesCtx[b].clearRect(0,0,this.imagesCanvas[b].width,this.imagesCanvas[b].height);this.imagesContainer.get(0).firstChild;)this.imagesContainer.get(0).removeChild(this.imagesContainer.get(0).firstChild);this.imagesContainer.get(0).appendChild(this.imagesCanvas[b]);var d=!1,e;for(e in this.currentViewpoint.images){var f=this.currentViewpoint.images[e];f.custom?(d=document.createElement("div"),$$stage(d).addClass("fallbackRendererImage"),
$$stage(d).css({perspective:"150em"}),$$stage(f.htmlImage).addClass("fallbackRendererImage"),this.imagesContainer.get(0).appendChild(d),d.appendChild(f.htmlImage),d=!0):(d&&(++b>=this.imagesCtx.length&&l.call(this),this.imagesCtx[b].clearRect(0,0,this.imagesCanvas[b].width,this.imagesCanvas[b].height),this.imagesContainer.get(0).appendChild(this.imagesCanvas[b])),d=!1,f.loaded&&this.imagesCtx[b].drawImage(f.htmlImage,this.posX+this.basePosX,this.posY+this.basePosY,this.baseImagesWidth*this.scale,
this.baseImagesHeight*this.scale))}for(e=b+1;e<this.imagesCtx.length;++e)this.imagesCtx[e].clearRect(0,0,this.imagesCanvas[e].width,this.imagesCanvas[e].height)},A=function(){this.previousViewpoint&&(this.webgl&&Z.call(this,[this.previousViewpoint]),delete this.previousViewpoint)},H=function(){ta.call(this);ua.call(this);ea.call(this);oa.call(this);A.call(this);this.webgl?da.call(this):D.call(this);switch(this.settings.uiType){case stage.emersya.viewer.FALLBACK_UI_TYPE.THUMBNAIL_BAR:R.call(this);
break;case stage.emersya.viewer.FALLBACK_UI_TYPE.THUMBNAIL_TAB:K.call(this)}this.apiCore.exec(this.callerName,"ui.hideBasicLoader");this.apiCore.exec(this.callerName,"ui.hidePreview");this.endCallback&&(this.endCallback(),this.endCallback=null)},e=function(b,e){if(!b.downloaded){b.downloaded=!0;var f=!--this.imagesToLoad;this.webgl&&(b.glTexture&&d.deleteTexture(b.glTexture),b.glTexture=d.createTexture(),d.bindTexture(d.TEXTURE_2D,b.glTexture),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR),
d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE),b.loaded?d.texImage2D(d.TEXTURE_2D,0,d.RGBA,d.RGBA,d.UNSIGNED_BYTE,b.element.get(0)):d.texImage2D(d.TEXTURE_2D,0,d.RGBA,1,1,0,d.RGBA,d.UNSIGNED_BYTE,new Uint8Array([0,0,0,0])));b.loaded=!e;f&&H.call(this)}},E=function(b){this.endCallback=b;if(this.currentViewpoint.images.length){this.apiCore.exec(this.callerName,"ui.showBasicLoader");
this.newImagesContainer&&this.newImagesContainer.remove();b=this.mainContainer.getWH();for(var d=0;d<this.currentViewpoint.images.length;++d){var f=this.currentViewpoint.images[d];f.downloaded||f.htmlImage||(++this.imagesToLoad,f.htmlImage=new Image,f.htmlImage.crossOrigin="anonymous",f.htmlImage.onload=stage.setContext(e,this,f,!1),f.htmlImage.onerror=stage.setContext(e,this,f,!0),f.htmlImage.src=f.imageData?f.imageData:f.realFilePath,f.custom&&ka.call(this,$$stage(f.htmlImage),b.width,b.height,
f),f.downloaded=!1)}if(this.thumbnailsNeeded)for(var h in this.viewpoints)if(b=this.viewpoints[h],this.settings.thumbFromVp)b.thumbnailDownloaded||b.thumbHtmlImage||(++this.imagesToLoad,b.thumbHtmlImage=new Image,b.thumbHtmlImage.crossOrigin="anonymous",b.thumbHtmlImage.onload=stage.setContext(F,this,b,!1),b.thumbHtmlImage.onerror=stage.setContext(F,this,b,!0),b.thumbHtmlImage.src=b.imageData?b.imageData:b.realThumbnail?b.realThumbnail:b.thumbnail,b.thumbnailDownloaded=!1);else for(h=0;h<b.images.length;++h)d=
b.images[h],d.thumbnailDownloaded||d.thumbHtmlImage||(++this.imagesToLoad,d.thumbHtmlImage=new Image,d.thumbHtmlImage.crossOrigin="anonymous",d.thumbHtmlImage.onload=stage.setContext(F,this,d,!1),d.thumbHtmlImage.onerror=stage.setContext(F,this,d,!0),d.thumbHtmlImage.src=d.imageData?d.imageData:d.thumbRealFilePath,d.custom&&(f=this.imagesContainer.parent().getWH(),ka.call(this,$$stage(d.thumbHtmlImage),f.width,f.height,d)),d.thumbnailDownloaded=!1);this.imagesToLoad||setTimeout(stage.setContext(H,
this),0)}else setTimeout(stage.setContext(H,this),0)},F=function(b,d){if(!b.thumbnailDownloaded){b.thumbnailDownloaded=!0;var e=!--this.imagesToLoad;b.thumbnailLoaded=!d;e&&H.call(this)}},p=function(b){this.viewpoints[b].navBarElement.find(".fallbackRendererNavBarViewpointDisc").addClass("fallbackRendererNavBarViewpointDiscOvered")},m=function(b){this.viewpoints[b].navBarElement.find(".fallbackRendererNavBarViewpointDisc").removeClass("fallbackRendererNavBarViewpointDiscOvered")},h=function(b){var d=
document.body.appendChild(document.createElement("div"));d.style.position="absolute";d.style.visibility="hidden";d.style.fontSize="14px";d.style.fontFamily="OpenSans";d.innerHTML=b;b=d.offsetWidth;d.remove();return b},v=function(){if(this.viewpointsListBar){var b=this.viewpointsListBar.getWH(),d="right";switch(this.settings.uiPosition){case "left":d="left";case "right":var e={};e[d]=""+(17+b.height/2-b.width/2)+"px";switch(this.settings.uiAlignment){case "top":e.top=b.width/2+"px";break;case "bottom":e.bottom=
b.width/2+"px";break;default:e.top="calc(50% - "+b.height/2+"px)"}this.viewpointsListBar.css(e);break;case "top":case "bottom":switch(this.settings.uiAlignment){case "left":this.viewpointsListBar.css({left:"17px"});break;case "right":this.viewpointsListBar.css({right:"17px"});break;default:this.viewpointsListBar.css({left:"calc(50% - "+b.width/2+"px)"})}}}},I=function(b){this.viewpoints[b].viewpointsListBarElement.addClass("fallbackRendererViewpointsListBarViewpointsListViewpointOvered")},J=function(b){this.viewpoints[b].viewpointsListBarElement.removeClass("fallbackRendererViewpointsListBarViewpointsListViewpointOvered")},
M=function(){if(this.viewpointsListBarOpened){this.viewpointsListBarOpened=!1;var b=this.viewpointsListBar.find(".fallbackRendererViewpointsListBarViewpointsListContainer");b.removeClass("visible");b.css({overflow:"hidden"})}},T=function(){if(this.viewpointsListBarOpened)M.call(this);else if(!this.viewpointsListBarOpened){this.viewpointsListBarOpened=!0;var b=this.viewpointsListBar.find(".fallbackRendererViewpointsListBarViewpointsListContainer");b.addClass("visible");setTimeout(stage.setContext(b.css,
b,{overflow:"auto"}),350)}},U=function(){if(this.thumbBar){var b=this.thumbBar.find(".fallbackRendererThumbBarViewpointsScrollContainer"),d=this.imagesContainer.parent().getWH();switch(this.settings.uiPosition){case "left":case "right":this.thumbBarVPCount=parseInt((d.height-50)/80);break;case "top":case "bottom":this.thumbBarVPCount=parseInt((d.width-50)/80);break;default:this.thumbBarVPCount=4}this.thumbBarVPCount=0<this.settings.vpCount?Math.min(this.thumbBarVPCount,this.settings.vpCount):Math.min(this.thumbBarVPCount,
this.viewpoints.length);switch(this.settings.uiPosition){case "left":case "right":b.css({height:80*this.thumbBarVPCount+"px"});break;case "top":case "bottom":b.css({width:80*this.thumbBarVPCount+"px"})}}},R=function(){if(this.thumbBar){var b=this.thumbBar.find(".fallbackRendererThumbBarViewpointsContainer"),d=this.thumbBar.getWH();switch(this.settings.uiPosition){case "left":case "right":this.thumbBar.find(".fallbackRendererThumbBarPrevious").addClass("topArrow");this.thumbBar.find(".fallbackRendererThumbBarNext").addClass("bottomArrow");
b.css({height:80*this.viewpoints.length+"px",top:80*-this.currentThumbBarPosition+"px"});b={};switch(this.settings.uiAlignment){case "top":b.top=d.width/2+"px";break;case "bottom":b.bottom=d.width/2+"px";break;default:b.top="calc(50% - "+d.height/2+"px)"}this.thumbBar.css(b);break;case "top":case "bottom":switch(this.thumbBar.find(".fallbackRendererThumbBarPrevious").addClass("leftArrow"),this.thumbBar.find(".fallbackRendererThumbBarNext").addClass("rightArrow"),b.css({width:80*this.viewpoints.length+
"px",left:80*-this.currentThumbBarPosition+"px"}),this.settings.uiAlignment){case "left":this.thumbBar.css({left:"17px"});break;case "right":this.thumbBar.css({right:"17px"});break;default:this.thumbBar.css({left:"calc(50% - "+d.width/2+"px)"})}}0<this.currentThumbBarPosition?this.thumbBar.find(".fallbackRendererThumbBarPrevious").show():this.thumbBar.find(".fallbackRendererThumbBarPrevious").hide();this.currentThumbBarPosition<this.viewpoints.length-this.thumbBarVPCount?this.thumbBar.find(".fallbackRendererThumbBarNext").show():
this.thumbBar.find(".fallbackRendererThumbBarNext").hide();for(var e in this.viewpoints){d=this.viewpoints[e];b=d.thumbBarCanvas;var f=d.thumbBarCtx;if(this.settings.thumbFromVp)d.thumbnailDownloaded&&(f.clearRect(0,0,b.width,b.height),d.thumbnailLoaded&&k(b.width,b.height,f,d.thumbHtmlImage));else{var h=!0,m;for(m in d.images)if(!d.images[m].thumbnailDownloaded){h=!1;break}if(h)for(m in f.clearRect(0,0,b.width,b.height),d.images)d.images[m].thumbnailLoaded&&k(b.width,b.height,f,d.images[m].thumbHtmlImage)}}}},
aa=function(){0<this.currentThumbBarPosition&&(this.currentThumbBarPosition=this.currentThumbBarPosition>=this.thumbBarVPCount?this.currentThumbBarPosition-this.thumbBarVPCount:0,R.call(this))},C=function(){this.currentThumbBarPosition<this.viewpoints.length&&(this.currentThumbBarPosition=this.currentThumbBarPosition+this.thumbBarVPCount<this.viewpoints.length-this.thumbBarVPCount?this.currentThumbBarPosition+this.thumbBarVPCount:this.viewpoints.length-this.thumbBarVPCount,R.call(this))},L=function(){if(this.thumbTab){var b=
this.thumbTab.find(".fallbackRendererThumbTabViewpointsScrollContainer"),d=this.imagesContainer.parent().getWH();switch(this.settings.uiPosition){case "left":case "right":this.thumbTabVPCount=parseInt((d.height-50)/80);break;case "top":case "bottom":this.thumbTabVPCount=parseInt((d.width-50)/80);break;default:this.thumbTabVPCount=4}this.thumbTabVPCount=0<this.settings.vpCount?Math.min(this.thumbTabVPCount,this.settings.vpCount):Math.min(this.thumbTabVPCount,this.viewpoints.length);switch(this.settings.uiPosition){case "left":case "right":b.css({height:80*
this.thumbTabVPCount+"px"});break;case "top":case "bottom":b.css({width:80*this.thumbTabVPCount+"px"})}}},K=function(){if(this.thumbTab){var b=this.thumbTab.find(".fallbackRendererThumbTabSubContainer"),d=this.thumbTab.find(".fallbackRendererThumbTabViewpointsContainer"),e=b.getWH();switch(this.settings.uiPosition){case "left":case "right":this.thumbTab.find(".fallbackRendererThumbTabPrevious").addClass("topArrow");this.thumbTab.find(".fallbackRendererThumbTabNext").addClass("bottomArrow");this.imagesContainer.parent().css({width:"calc(100% - "+
e.width+"px)",right:"right"==this.settings.uiPosition?e.width+"px":"unset",left:"left"==this.settings.uiPosition?e.width+"px":"unset"});d.css({height:80*this.viewpoints.length+"px",top:80*-this.currentThumbTabPosition+"px"});this.thumbTab.css({width:"80px"});d={};switch(this.settings.uiAlignment){case "top":d.top=e.width/2+"px";break;case "bottom":d.bottom=e.width/2+"px";break;default:d.top="calc(50% - "+e.height/2+"px)"}b.css(d);break;case "top":case "bottom":switch(this.thumbTab.find(".fallbackRendererThumbTabPrevious").addClass("leftArrow"),
this.thumbTab.find(".fallbackRendererThumbTabNext").addClass("rightArrow"),this.imagesContainer.parent().css({height:"calc(100% - "+e.height+"px)",bottom:"bottom"==this.settings.uiPosition?e.height+"px":"unset",top:"top"==this.settings.uiPosition?e.height+"px":"unset"}),d.css({width:80*this.viewpoints.length+"px",left:80*-this.currentThumbTabPosition+"px"}),this.thumbTab.css({height:"80px"}),this.settings.uiAlignment){case "left":b.css({left:"17px"});break;case "right":b.css({right:"17px"});break;
default:b.css({left:"calc(50% - "+e.width/2+"px)"})}}0<this.currentThumbTabPosition?this.thumbTab.find(".fallbackRendererThumbTabPrevious").show():this.thumbTab.find(".fallbackRendererThumbTabPrevious").hide();this.currentThumbTabPosition<this.viewpoints.length-this.thumbTabVPCount?this.thumbTab.find(".fallbackRendererThumbTabNext").show():this.thumbTab.find(".fallbackRendererThumbTabNext").hide();for(var f in this.viewpoints)if(b=this.viewpoints[f],e=b.thumbTabCanvas,d=b.thumbTabCtx,this.settings.thumbFromVp)b.thumbnailDownloaded&&
(d.clearRect(0,0,e.width,e.height),b.thumbnailLoaded&&d.drawImage(b.thumbHtmlImage,0,0,e.width,e.height));else{var h=!0,m;for(m in b.images)if(!b.images[m].thumbnailDownloaded){h=!1;break}if(h)for(m in d.clearRect(0,0,e.width,e.height),b.images)b.images[m].thumbnailLoaded&&d.drawImage(b.images[m].thumbHtmlImage,0,0,e.width,e.height)}}},G=function(){0<this.currentThumbTabPosition&&(this.currentThumbTabPosition=this.currentThumbTabPosition>=this.thumbTabVPCount?this.currentThumbTabPosition-this.thumbTabVPCount:
0,K.call(this))},S=function(){this.currentThumbTabPosition<this.viewpoints.length&&(this.currentThumbTabPosition=this.currentThumbTabPosition+this.thumbTabVPCount<this.viewpoints.length-this.thumbTabVPCount?this.currentThumbTabPosition+this.thumbTabVPCount:this.viewpoints.length-this.thumbTabVPCount,K.call(this))},Y=function(){var b=this.currentViewpointIndex-1;0>b&&(b+=this.viewpoints.length);Q.call(this,b,null)},ia=function(){Q.call(this,(this.currentViewpointIndex+1)%this.viewpoints.length,null)},
Q=function(b,d){this.currentViewpointIndex===b?d&&d():(this.currentViewpointIndex=b,this.previousViewpoint=this.currentViewpoint,this.currentViewpoint=this.viewpoints[this.currentViewpointIndex],E.call(this,d),this.apiCore.exec(this.callerName,"viewpointChanged"))},ta=function(){this.navBar&&(this.previousViewpoint&&this.previousViewpoint.navBarElement.children().first().children().first().removeClass("fallbackRendererNavBarViewpointDiscSelected"),this.currentViewpoint.navBarElement.children().first().children().first().addClass("fallbackRendererNavBarViewpointDiscSelected"))},
ua=function(){this.viewpointsListBar&&(M.call(this),this.previousViewpoint&&this.previousViewpoint.viewpointsListBarElement.removeClass("fallbackRendererViewpointsListBarViewpointsListViewpointSelected"),this.currentViewpoint.viewpointsListBarElement.addClass("fallbackRendererViewpointsListBarViewpointsListViewpointSelected"),this.viewpointsListBar.find(".fallbackRendererViewpointsListBarCurrentViewpoint").update(this.currentViewpoint.name))},ea=function(){this.thumbBar&&(this.previousViewpoint&&
this.previousViewpoint.thumbBarElement.children().first().removeClass("fallbackRendererThumbBarCurrentViewpoint"),this.currentViewpoint&&this.currentViewpoint.thumbBarElement.children().first().addClass("fallbackRendererThumbBarCurrentViewpoint"))},oa=function(){this.thumbTab&&(this.previousViewpoint&&this.previousViewpoint.thumbTabElement.children().first().removeClass("fallbackRendererThumbTabCurrentViewpoint"),this.currentViewpoint.thumbTabElement.children().first().addClass("fallbackRendererThumbTabCurrentViewpoint"))},
ba=function(){v.call(this);U.call(this);R.call(this);L.call(this);K.call(this);var b=this.imagesContainer.parent().getWH();if(this.webgl){var e=b.height;this.canvas.width=b.width;this.canvas.height=e;1<this.canvas.width/this.canvas.height?(b=this.canvas.height/this.canvas.width,b=(1/b-1)/2,b=new Float32Array([-b,1,-b,0,1+b,0,1+b,1])):(b=this.canvas.width/this.canvas.height,b=(1/b-1)/2,b=new Float32Array([0,1+b,0,-b,1,-b,1,1+b]));this.vertexUvsBufferScreen||(this.vertexUvsBufferScreen=d.createBuffer());
d.bindBuffer(d.ARRAY_BUFFER,this.vertexUvsBufferScreen);d.bufferData(d.ARRAY_BUFFER,b,d.STATIC_DRAW);da.call(this);d.viewport(0,0,this.canvas.width,this.canvas.height)}else{this.imagesContainer&&this.imagesContainer.css({width:"100%",height:"100%"});this.newImagesContainer&&this.newImagesContainer.css({width:"100%",height:"100%"});e=b.width;var f=b.height;b.width*=window.devicePixelRatio;b.height*=window.devicePixelRatio;this.currentWidth=b.width;this.currentHeight=b.height;var h=!1;for(p in this.imagesCanvas){var m=
this.imagesCanvas[p];if(m.width!=b.width||m.height!=b.height)m.width=b.width,m.height=b.height,h=!0}var p=this.settings.imagesWidth/this.settings.imagesHeight;if(b.width/b.height>p){m=b.height;var g=m*p}else g=b.width,m=g/p;this.basePosX=(b.width-g)/2;this.basePosY=(b.height-m)/2;this.baseImagesWidth=g;this.baseImagesHeight=m;this.maxScale=Math.max(Math.max(this.settings.imagesWidth/b.width,this.settings.imagesHeight/b.height),1);for(var n in this.viewpoints)for(var k in this.viewpoints[n].images)b=
this.viewpoints[n].images[k],b.custom&&ka.call(this,$$stage(b.htmlImage),e,f,b);q.call(this);h&&D.call(this)}},ka=function(b,d,e,f){var h=this.settings.imagesWidth/this.settings.imagesHeight;d/e>h?d=e*h:e=d/h;b.css({width:f.imageWidth+"px",height:f.imageHeight+"px",left:"calc("+((this.posX+this.basePosX)/window.devicePixelRatio+d*f.x/this.settings.imagesWidth)+"px - "+f.imageWidth/2+"px)",top:"calc("+(e-e*f.y/this.settings.imagesHeight+(this.posY+this.basePosY)/window.devicePixelRatio)+"px - "+f.imageHeight/
2+"px)",transform:"matrix3d("+f.matrix[0]+","+f.matrix[1]+","+f.matrix[2]+","+f.matrix[3]+","+f.matrix[4]+","+f.matrix[5]+","+f.matrix[6]+","+f.matrix[7]+","+f.matrix[8]+","+f.matrix[9]+","+f.matrix[10]+","+f.matrix[11]+","+f.matrix[12]+","+f.matrix[13]+","+f.matrix[14]+","+f.matrix[15]+") scale3d("+d*f.width/this.settings.imagesWidth*-1/f.imageWidth+","+e*f.height/this.settings.imagesHeight/f.imageHeight+",1)"})},Z=function(b){for(var e in b){var f=b[e],h;for(h in f.images){var m=f.images[h];m.glTexture&&
(d.deleteTexture(m.glTexture),m.glTexture=null)}}},da=function(){d.clear(d.COLOR_BUFFER_BIT);d.useProgram(this.shaderProgram);d.uniformMatrix4fv(d.getUniformLocation(this.shaderProgram,"uPMatrix"),!1,this.screenTransfMatrix);d.uniformMatrix4fv(d.getUniformLocation(this.shaderProgram,"ampnorz"),!1,this.screenViewMatrix);d.uniform2fv(d.getUniformLocation(this.shaderProgram,"uViewport"),[this.canvas.width,this.canvas.height]);d.enableVertexAttribArray(0);d.enableVertexAttribArray(1);d.bindBuffer(d.ARRAY_BUFFER,
this.vertexBufferScreen);d.vertexAttribPointer(0,3,d.FLOAT,!1,0,0);d.bindBuffer(d.ARRAY_BUFFER,this.vertexUvsBufferScreen);d.vertexAttribPointer(1,2,d.FLOAT,!1,0,0);d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,this.elementsBufferScreen);for(var b in this.currentViewpoint.images){var e=this.currentViewpoint.images[b];e.glTexture&&(d.activeTexture(d.TEXTURE0),d.bindTexture(d.TEXTURE_2D,e.glTexture),d.uniform1i(d.getUniformLocation(this.shaderProgram,"dkgckvl"),0),d.drawElements(d.TRIANGLES,6,d.UNSIGNED_SHORT,
0))}};return u});stage.provide("emersya.viewer.modules.peripherals");
stage.register.call(stage.emersya.viewer.modules,"peripherals",function(){var b={listeningTo:{keyboard:!0,mouseButtons:!0,mouseMove:!0,mouseWheel:!0,touch:!0},wheelOnCtrl:!1,pinchMultiplier:2},d=function(d,g,l){this.settings=stage.extend(!0,{},b,l);this.settings.listeningTo.keyboard=!0;this.apiCore=d;this.element=$$stage(g);this.topLeft=this.element.documentOffset();this.prevTouchY=this.prevTouchX=this.prevMouseY=this.prevMouseX=this.touchY=this.touchX=this.mouseY=this.mouseX=null;this.mouseButtons=
[!1,!1,!1];this.moving=!1;this.keys={};this.initPanTwoF=this.initPanOneF=!0;this.endPanTwoF=0;this.initRotate=this.initPinch=!0;this.prevAngle=0;this.pinchScreenMult=2;this.onResizePtr=stage.setContext(w,this);this.onFocusPtr=stage.setContext(H,this);this.onBlurPtr=stage.setContext(A,this);this.onKeyDownPtr=stage.setContext(U,this);this.onKeyUpPtr=stage.setContext(R,this);this.onMouseDownPtr=stage.setContext(F,this);this.onMouseMovePtr=stage.setContext(p,this);this.onMouseLeavePtr=stage.setContext(m,
this);this.onMouseUpPtr=stage.setContext(h,this);this.onTouchPressPtr=stage.setContext(e,this);this.onTouchReleasePtr=stage.setContext(E,this);this.onClickPtr=stage.setContext(I,this);this.onWheelPtr=stage.setContext(v,this);this.onFullScreenChangePtr=stage.setContext(D,this);this.onDrop=stage.setContext(M,this);this.onDragLeave=stage.setContext(T,this);this.onVisibilityChange=stage.setContext(J,this);this.preventDefaultPtr=function(b){b.preventDefault()};this.wheelOnWindow=stage.emersya.viewer.modules.renderer.lightsEditor||
stage.emersya.collaborativeDesignManager?!1:!0;d=$$stage("#privateEmersyaViewerContainer");$$stage(window).listen("resize",this.onResizePtr);d.listen("focus",this.onFocusPtr);d.listen("blur",this.onBlurPtr);this.callerName=this.name="Peripherals";this.apiCore.register(this,"domChange",w);this.apiCore.register(this,"prph.listen",q);this.apiCore.register(this,"prph.toggleKeyboard",t);this.apiCore.register(this,"prph.toggleMouseButtons",r);this.apiCore.register(this,"prph.toggleMouseMove",f);this.apiCore.register(this,
"prph.toggleMouseWheel",n);this.apiCore.register(this,"prph.toggleTouch",B);this.apiCore.register(this,"startRendering",k);this.apiCore.register(this,"prph.initialize",k);this.apiCore.register(this,"prph.setWheelOnCtrl",u)};d.prototype.destroy=function(){this.apiCore.unregister(this,"domChange");this.apiCore.unregister(this,"prph.listen");this.apiCore.unregister(this,"prph.toggleKeyboard");this.apiCore.unregister(this,"prph.toggleMouseButtons");this.apiCore.unregister(this,"prph.toggleMouseMove");
this.apiCore.unregister(this,"prph.toggleMouseWheel");this.apiCore.unregister(this,"prph.toggleTouch");this.apiCore.unregister(this,"startRendering");this.apiCore.unregister(this,"prph.initialize");this.apiCore.unregister(this,"prph.setWheelOnCtrl");var b=stage.emersya.viewer.modules.renderer.lightsEditor||stage.emersya.collaborativeDesignManager?$$stage(window):$$stage("#privateEmersyaViewerContainer");$$stage(window).unListen("resize",this.onResizePtr);b.unListen("focus",this.onFocusPtr);b.unListen("blur",
this.onBlurPtr);this.initialized&&(this.initialized=!1,b.unListen("keydown",this.onKeyDownPtr),b.unListen("keyup",this.onKeyUpPtr),b.unListen("mouseup",this.onMouseUpPtr),this.wheelOnWindow?b.unListen("wheel",this.onWheelPtr):this.element.unListen("wheel",this.onWheelPtr),b.unListen("webkitfullscreenchange",this.onFullScreenChangePtr),b.unListen("mozfullscreenchange",this.onFullScreenChangePtr),b.unListen("fullscreenchange",this.onFullScreenChangePtr),b.unListen("MSFullscreenChange",this.onFullScreenChangePtr),
this.element.unListen("mouseleave",this.onMouseMovePtr),this.element.unListen("mousemove",this.onMouseMovePtr),this.element.unListen("mousedown",this.onMouseDownPtr),this.element.unListen("drop",this.onDrop),this.element.unListen("dragover",this.onMouseMovePtr),this.element.unListen("dragleave",this.onDragLeave),this.element.unListen("contextmenu",this.onClickPtr),document.removeEventListener("visibilitychange",this.onVisibilityChange),g.call(this))};var u=function(b){this.settings.wheelOnCtrl=b},
k=function(){if(!this.initialized){this.initialized=!0;this.topLeft=this.element.parent().documentOffset();this.element.getWH();var b=stage.emersya.viewer.modules.renderer.lightsEditor||stage.emersya.collaborativeDesignManager?$$stage(window):$$stage("#privateEmersyaViewerContainer");b.listen("keydown",this.onKeyDownPtr);b.listen("keyup",this.onKeyUpPtr);b.listen("mouseup",this.onMouseUpPtr);this.wheelOnWindow?b.listen("wheel",this.onWheelPtr,{passive:!1}):this.element.listen("wheel",this.onWheelPtr,
{passive:!1});b.listen("webkitfullscreenchange",this.onFullScreenChangePtr);b.listen("mozfullscreenchange",this.onFullScreenChangePtr);b.listen("fullscreenchange",this.onFullScreenChangePtr);b.listen("MSFullscreenChange",this.onFullScreenChangePtr);document.addEventListener("visibilitychange",this.onVisibilityChange);this.element.listen("mouseleave",this.onMouseLeavePtr);this.element.listen("mousemove",this.onMouseMovePtr);this.element.listen("mousedown",this.onMouseDownPtr);this.element.listen("contextmenu",
this.onClickPtr);this.element.listen("drop",this.onDrop);this.element.listen("dragover",this.onMouseMovePtr);this.element.listen("dragleave",this.onDragLeave);this.settings.listeningTo.touch&&l.call(this)}},l=function(){stage.emersya.viewer.modules.renderer.lightsEditor?this.settings.listeningTo.touch=!1:this.hammer||($$stage("#privateEmersyaViewerContainer").css({"touch-action":"none","-ms-touch-action":"none"}),this.element.listen("ontouchstart",this.onTouchPressPtr),this.element.listen("ontouchmove",
this.preventDefaultPtr),this.element.listen("ontouchend",this.onTouchReleasePtr),this.element.listen("touchstart",this.onTouchPressPtr),this.element.listen("touchmove",this.preventDefaultPtr),this.element.listen("touchend",this.onTouchReleasePtr),this.element.listen("touchcancel",this.onTouchReleasePtr),this.element.listen("touchleave",this.onTouchReleasePtr),this.element.listen("onmsgesturechange",this.preventDefaultPtr),this.element.listen("onmsgesturedoubletap",this.preventDefaultPtr),this.element.listen("onmsgestureend",
this.preventDefaultPtr),this.element.listen("onmsgesturehold",this.preventDefaultPtr),this.element.listen("onmsgesturestart",this.preventDefaultPtr),this.element.listen("onmsgesturetap",this.preventDefaultPtr),this.element.listen("ongesturechange",this.preventDefaultPtr),this.element.listen("ongesturedoubletap",this.preventDefaultPtr),this.element.listen("ongestureend",this.preventDefaultPtr),this.element.listen("ongesturehold",this.preventDefaultPtr),this.element.listen("ongesturestart",this.preventDefaultPtr),
this.element.listen("ongesturetap",this.preventDefaultPtr),this.onPanOneF=stage.setContext(aa,this),this.onPanTwoF=stage.setContext(C,this),this.onPinch=stage.setContext(L,this),this.onRotate=stage.setContext(K,this),this.onTap=stage.setContext(G,this),this.hammer=new Hammer.Manager(this.element.get(0)),this.hammer.add(new Hammer.Pan({event:"pan",direction:Hammer.DIRECTION_ALL,threshold:5})),this.hammer.on("pan",this.onPanOneF),this.hammer.add(new Hammer.Tap({event:"tap",time:1E4})),this.hammer.on("tap",
this.onTap),this.hammer.add(new Hammer.Pan({event:"panTwoF",pointers:2,direction:Hammer.DIRECTION_ALL,threshold:50})),this.hammer.on("panTwoF",this.onPanTwoF),this.hammer.get("panTwoF").recognizeWith("pan"),this.hammer.get("pan").requireFailure("panTwoF"),this.hammer.add(new Hammer.Pinch({event:"pinch",threshold:0})),this.hammer.get("panTwoF").recognizeWith("pinch"),this.hammer.get("pinch").recognizeWith("pan"),this.hammer.on("pinch",this.onPinch),this.hammer.add(new Hammer.Rotate({event:"rotate"})),
this.hammer.get("panTwoF").recognizeWith("rotate"),this.hammer.get("pinch").recognizeWith("rotate"),this.hammer.on("rotate",this.onRotate))},g=function(){this.hammer&&($$stage("#privateEmersyaViewerContainer").css({"touch-action":"initial","-ms-touch-action":"initial"}),this.element.css({"touch-action":"initial","-ms-touch-action":"initial"}),this.element.unListen("ontouchstart",this.onTouchPressPtr),this.element.unListen("ontouchmove",this.preventDefaultPtr),this.element.unListen("ontouchend",this.onTouchReleasePtr),
this.element.unListen("touchstart",this.onTouchPressPtr),this.element.unListen("touchmove",this.preventDefaultPtr),this.element.unListen("touchend",this.onTouchReleasePtr),this.element.unListen("touchcancel",this.onTouchReleasePtr),this.element.unListen("touchleave",this.onTouchReleasePtr),this.element.unListen("onmsgesturechange",this.preventDefaultPtr),this.element.unListen("onmsgesturedoubletap",this.preventDefaultPtr),this.element.unListen("onmsgestureend",this.preventDefaultPtr),this.element.unListen("onmsgesturehold",
this.preventDefaultPtr),this.element.unListen("onmsgesturestart",this.preventDefaultPtr),this.element.unListen("onmsgesturetap",this.preventDefaultPtr),this.element.unListen("ongesturechange",this.preventDefaultPtr),this.element.unListen("ongesturedoubletap",this.preventDefaultPtr),this.element.unListen("ongestureend",this.preventDefaultPtr),this.element.unListen("ongesturehold",this.preventDefaultPtr),this.element.unListen("ongesturestart",this.preventDefaultPtr),this.element.unListen("ongesturetap",
this.preventDefaultPtr),this.hammer.destroy(),delete this.hammer)},q=function(b){var d=this.settings.listeningTo.touch;stage.extend(this.settings.listeningTo,b);d&&!b.touch?g.call(this):!d&&b.touch&&l.call(this)},t=function(b){this.settings.listeningTo.keyboard=void 0!==b?b:!this.settings.listeningTo.keyboard},r=function(b){this.settings.listeningTo.mouseButtons=void 0!==b?b:!this.settings.listeningTo.mouseButtons},f=function(b){this.settings.listeningTo.mouseMove=void 0!==b?b:!this.settings.listeningTo.mouseMove},
n=function(b){this.settings.listeningTo.mouseWheel=void 0!==b?b:!this.settings.listeningTo.mouseWheel},B=function(b){this.settings.listeningTo.touch=void 0!==b?b:!this.settings.listeningTo.touch;this.settings.listeningTo.touch?l.call(this):g.call(this)},w=function(){this.topLeft=this.element.parent().documentOffset();var b=this.element.getWH();this.apiCore.exec(this.callerName,"resize",b[1],b[0])},D=function(){this.apiCore.exec(this.callerName,"onNativeFullScreenChanged")},A=function(){this.apiCore.exec(this.callerName,
"loseFocus")},H=function(){this.apiCore.exec(this.callerName,"getFocus")},e=function(b){b.preventDefault();for(var d=0,e=0,f=0;f<b.touches.length;++f)d+=b.touches[f].pageX,e+=b.touches[f].pageY;this.touchX=d/b.touches.length-this.topLeft[0];this.touchY=e/b.touches.length-this.topLeft[1];this.prevTouchX=this.touchX;this.prevTouchY=this.touchY;b=1<b.touches.length?2:0;this.mouseButtons[b]=!0;this.apiCore.exec(this.callerName,"mousePosUpdate",this.touchX,this.touchY,this.mouseButtons);this.apiCore.exec(this.callerName,
"mouseButtonPress",b,this.touchX,this.touchY,this.mouseButtons)},E=function(b){this.apiCore.exec(this.callerName,"mousePosUpdate",-1,-1,this.mouseButtons);if(0<b.touches.length)this.mouseButtons[2]=!1,this.apiCore.exec(this.callerName,"mouseButtonRelease",2,this.touchX,this.touchY,this.mouseButtons);else for(b=0;b<this.mouseButtons.length;++b)this.mouseButtons[b]&&(this.mouseButtons[b]=!1,this.apiCore.exec(this.callerName,"mouseButtonRelease",b,this.touchX,this.touchY,this.mouseButtons))},F=function(b){stage.emersya.viewer.modules.renderer.lightsEditor||
b.preventDefault();this.mouseX=b.pageX-this.topLeft[0];this.mouseY=b.pageY-this.topLeft[1];this.mouseButtons[0]||this.mouseButtons[1]||this.mouseButtons[2]||(this.prevMouseX=this.mouseX,this.prevMouseY=this.mouseY,this.moving=!1,this.lastButtonPressed=b.button);this.mouseButtons[b.button]=!0},p=function(b){b.preventDefault();if(this.mouseButtons[0]||this.mouseButtons[1]||this.mouseButtons[2]){var d=this.settings.listeningTo.touch?0!==this.lastButtonPressed:!0;!this.moving&&d&&this.apiCore.exec(this.callerName,
"mouseButtonPress",this.lastButtonPressed,this.mouseX,this.mouseY,this.mouseButtons);this.mouseX=b.pageX-this.topLeft[0];this.mouseY=b.pageY-this.topLeft[1];d&&this.settings.listeningTo.mouseMove&&!this.inPan&&this.apiCore.exec(this.callerName,"deltaUpdate",this.mouseX-this.prevMouseX,this.mouseY-this.prevMouseY,this.mouseButtons);if(this.mouseX!==this.prevMouseX||this.mouseY!==this.prevMouseY)this.moving=!0;this.prevMouseX=this.mouseX;this.prevMouseY=this.mouseY}else this.mouseX=b.pageX-this.topLeft[0],
this.mouseY=b.pageY-this.topLeft[1];this.settings.listeningTo.mouseMove&&this.apiCore.exec(this.callerName,"mousePosUpdate",this.mouseX,this.mouseY,this.mouseButtons)},m=function(b){p.call(this,b);this.apiCore.exec(this.callerName,"mouseLeave")},h=function(b){this.mouseX=b.pageX-this.topLeft[0];this.mouseY=b.pageY-this.topLeft[1];var d=this.mouseButtons[b.button];this.mouseButtons[b.button]=!1;this.settings.listeningTo.mouseButtons&&(!this.moving&&d?(this.settings.listeningTo.touch?0!==b.button:1)&&
this.apiCore.exec(this.callerName,"click",this.mouseX,this.mouseY,b.button):this.apiCore.exec(this.callerName,"mouseButtonRelease",this.settings.listeningTo.touch&&0!==b.button?2:b.button,this.mouseX,this.mouseY,this.mouseButtons))},v=function(b){if(this.settings.listeningTo.mouseWheel)if(this.apiCore.exec(this.callerName,"isInFullscreen")||!this.settings.wheelOnCtrl||b.ctrlKey){b.preventDefault();b.stopPropagation();this.mouseX=b.pageX-this.topLeft[0];this.mouseY=b.pageY-this.topLeft[1];switch(b.deltaMode){case WheelEvent.DOM_DELTA_PIXEL:b=
-2.25*b.deltaY;break;case WheelEvent.DOM_DELTA_LINE:case WheelEvent.DOM_DELTA_PAGE:b=-60*b.deltaY;break;default:b=b.detail?-60*b.detail:b.wheelDelta}this.apiCore.exec(this.callerName,"wheelUpdate",b)}else-1==b.target.classList.value.indexOf("descriptionAnnotation")&&-1==b.target.classList.value.indexOf("xmpDescription")&&this.apiCore.exec(this.callerName,"onScrollWithoutCtrl")},I=function(b){b.preventDefault();return!1},J=function(b){"hidden"==document.visibilityState?this.apiCore.exec(this.callerName,
"onViewerHidden"):this.apiCore.exec(this.callerName,"onViewerVisible")},M=function(b){b.preventDefault();b.stopPropagation();this.apiCore.exec(this.callerName,"mouseDrop",b.dataTransfer,{x:b.pageX-this.topLeft[0],y:b.pageY-this.topLeft[1]})},T=function(b){b.preventDefault();b.stopPropagation();p.call(this,b);this.apiCore.exec(this.callerName,"mouseLeave")},U=function(b){var d=void 0!==b.keyCode?b.keyCode:b.charCode;if(this.settings.listeningTo.keyboard||"escape"===d)this.keys[d]||(this.keys[d]=!0,
this.apiCore.exec(this.callerName,"keyPress",S[d],b)),"s"==S[d]&&b.ctrlKey&&b.preventDefault()},R=function(b){var d=void 0!==b.keyCode?b.keyCode:b.charCode;if(this.settings.listeningTo.keyboard||"escape"===d)this.keys[d]=!1,this.apiCore.exec(this.callerName,"keyRelease",S[d],b)},aa=function(b){if(this.settings.listeningTo.touch&&!(300>Date.now()-this.endPanTwoF)){var d=-this.topLeft[0],e=-this.topLeft[1];b.pointers.forEach(function(f){return d+=f.pageX/b.pointers.length,e+=f.pageY/b.pointers.length});
switch(b.eventType){case Hammer.INPUT_START:this.initPanOneF=!0;case Hammer.INPUT_MOVE:this.inPan=!0;this.touchX=d;this.touchY=e;this.initPanOneF?"mouse"==b.pointerType&&(this.prevTouchX=d,this.prevTouchY=e,this.apiCore.exec(this.callerName,"mouseButtonPress",0,this.touchX,this.touchY,this.mouseButtons)):this.apiCore.exec(this.callerName,"deltaUpdate",this.touchX-this.prevTouchX,this.touchY-this.prevTouchY,this.mouseButtons);this.initPanOneF=!1;this.apiCore.exec(this.callerName,"mousePosUpdate",this.touchX,
this.touchY,this.mouseButtons);this.prevTouchX=d;this.prevTouchY=e;break;case Hammer.INPUT_END:case Hammer.INPUT_CANCEL:this.inPan=!1,this.initPanTwoF=this.initPanOneF=!0,"mouse"==b.pointerType&&(this.mouseButtons[0]=!1,this.apiCore.exec(this.callerName,"mouseButtonRelease",0,this.touchX,this.touchY,this.mouseButtons))}}},C=function(b){if(this.settings.listeningTo.touch){var d=-this.topLeft[0],e=-this.topLeft[1];b.pointers.forEach(function(f){return d+=f.pageX/b.pointers.length,e+=f.pageY/b.pointers.length});
switch(b.eventType){case Hammer.INPUT_START:this.initPanTwoF=!0;case Hammer.INPUT_MOVE:this.inPan=!0;this.touchX=d;this.touchY=e;this.initPanTwoF?"mouse"==b.pointerType&&(this.prevTouchX=d,this.prevTouchY=e,this.apiCore.exec(this.callerName,"mouseButtonPress",2,this.touchX,this.touchY,this.mouseButtons)):this.apiCore.exec(this.callerName,"deltaUpdate",this.touchX-this.prevTouchX,this.touchY-this.prevTouchY,this.mouseButtons);this.initPanTwoF=!1;this.apiCore.exec(this.callerName,"mousePosUpdate",this.touchX,
this.touchY,this.mouseButtons);this.prevTouchX=d;this.prevTouchY=e;break;case Hammer.INPUT_END:case Hammer.INPUT_CANCEL:this.inPan=!1,this.initPanTwoF=this.initPanOneF=!0,this.endPanTwoF=Date.now(),"mouse"==b.pointerType&&(this.mouseButtons[2]=!1,this.apiCore.exec(this.callerName,"mouseButtonRelease",2,this.touchX,this.touchY,this.mouseButtons))}}},L=function(b){if(this.settings.listeningTo.touch)switch(b.eventType){case Hammer.INPUT_START:this.initPinch=!0;case Hammer.INPUT_MOVE:this.initPinch&&
(this.prevScale=b.scale,this.initPinch=!1,this.initDistance=vec3.length(vec3.subtract(vec3.create([b.pointers[0].clientX,b.pointers[0].clientY,0]),vec3.create([b.pointers[1].clientX,b.pointers[1].clientY,0]))));this.apiCore.exec(this.callerName,"wheelUpdate",this.settings.pinchMultiplier*this.pinchScreenMult*(b.scale-this.prevScale)*this.initDistance);this.prevScale=b.scale;break;case Hammer.INPUT_CANCEL:case Hammer.INPUT_END:this.initPinch=!0}},K=function(b){if(this.settings.listeningTo.touch)switch(b.eventType){case Hammer.INPUT_START:this.initRotate=
!0;case Hammer.INPUT_MOVE:this.initRotate&&(this.initRotate=!1,this.prevAngle=b.rotation);90<b.rotation&&-90>this.prevAngle?this.prevAngle+=360:-90>b.rotation&&90<this.prevAngle&&(this.prevAngle-=360);var d=-(b.rotation-this.prevAngle)*Math.PI/180;this.prevAngle=b.rotation;this.apiCore.exec(this.callerName,"angleUpdate",d);break;case Hammer.INPUT_CANCEL:case Hammer.INPUT_END:this.initRotate=!0}},G=function(b){this.apiCore.exec(this.callerName,"click",b.pointers[0].pageX-this.topLeft[0],b.pointers[0].pageY-
this.topLeft[1],0)},S={65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",107:"+",109:"-",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",16:"shift",17:"control",
18:"opt",224:"command",255:"function",8:"osxdelete",13:"return",32:"spacebar",27:"escape",9:"tab",20:"capslk",91:"windows",45:"_",46:"delete",36:"home",35:"end",33:"pageup",34:"pagedown",37:"left",38:"up",39:"right",40:"down",187:"+",219:"{",221:"}",220:"|",59:":",222:'"',188:"<",190:">",191:"?",256:"zoomIn",257:"zoomOut"};return d});stage.provide("emersya.viewer.modules.sceneryControls");stage.require("emersya.viewer.modules.API.core");
stage.register.call(stage.emersya.viewer.modules,"sceneryControls",function(){var b={serverURL:"",background:{color:"#FFFFFF",opacity:1,image:null,imageOpacity:1,imageOffset:{x:.5,y:.5},imageFitting:0}},d=function(d,q){this.settings=stage.extend(!0,{},b,q);this.apiCore=d;this.callerName=this.name="SceneryControls";this.apiCore.register(this,"setDefaultLights",k);this.apiCore.register(this,"setAmbientLight",l);this.apiCore.register(this,"setImageBasedLight",g);this.apiCore.register(this,"addDirectionalLight",
t);this.apiCore.register(this,"addHemisphericalLight",r);this.apiCore.register(this,"addPointLight",f);this.apiCore.register(this,"addSpotLight",n);this.apiCore.register(this,"setDirectionalLight",t);this.apiCore.register(this,"setHemisphericalLight",r);this.apiCore.register(this,"setPointLight",f);this.apiCore.register(this,"setSpotLight",n);this.apiCore.register(this,"removeDirectionalLight",B);this.apiCore.register(this,"removeHemisphericalLight",w);this.apiCore.register(this,"removePointLight",
D);this.apiCore.register(this,"removeSpotLight",A);this.apiCore.register(this,"removeImageBasedLight",e);this.apiCore.register(this,"removeAllLights",H);this.apiCore.register(this,"setScene",u);this.apiCore.register(this,"setBackground",F);this.apiCore.register(this,"resetBackground",m);this.apiCore.register(this,"setBackgroundColor",p);this.apiCore.register(this,"setBackgroundOpacity",h);this.apiCore.register(this,"setBackgroundImage",v);this.apiCore.register(this,"removeBackgroundImage",I);this.apiCore.register(this,
"setBackgroundImageOpacity",J);this.apiCore.register(this,"setBackgroundImageOffset",M);this.apiCore.register(this,"setBackgroundImageFitting",T);this.apiCore.register(this,"setTonemapping",U);this.apiCore.register(this,"setEnvironment",R);this.apiCore.register(this,"setRenderEnvironment",aa);this.apiCore.register(this,"setEnvironmentSettings",C);this.apiCore.register(this,"toggleEnvironmentRendering",L);this.apiCore.register(this,"createDefaultEnvironmentTexture2D",ua,!0);this.apiCore.register(this,
"toggleShadowMode",G);this.apiCore.register(this,"toggleShadowFilter",S);this.apiCore.register(this,"adjustDirectionalShadow",K,!0);this.apiCore.register(this,"setShadowOpacityThreshold",Y);this.background=stage.extend(!0,{},this.settings.background);(this.backgroundImage=document.getElementById("viewerBackgroundImage"))?this.backgroundImageElement=$$stage(this.backgroundImage):this.backgroundImage=null;this.texturesFilePath=stage.emersya.dataManager?stage.emersya.dataManager().getTexturesFilePath():
this.settings.serverURL+"/data/managementApp/textures/";this.apiCore.exec(this.callerName,"rdr.setBackgroundColor",this.background.color,this.background.opacity)};d.prototype.destroy=function(){this.apiCore.unregister(this,"setDefaultLights");this.apiCore.unregister(this,"setAmbientLight");this.apiCore.unregister(this,"setImageBasedLight");this.apiCore.unregister(this,"addDirectionalLight");this.apiCore.unregister(this,"addHemisphericalLight");this.apiCore.unregister(this,"addPointLight");this.apiCore.unregister(this,
"addSpotLight");this.apiCore.unregister(this,"setDirectionalLight");this.apiCore.unregister(this,"setHemisphericalLight");this.apiCore.unregister(this,"setPointLight");this.apiCore.unregister(this,"setSpotLight");this.apiCore.unregister(this,"removeDirectionalLight");this.apiCore.unregister(this,"removeHemisphericalLight");this.apiCore.unregister(this,"removePointLight");this.apiCore.unregister(this,"removeSpotLight");this.apiCore.unregister(this,"removeAllLights");this.apiCore.unregister(this,"removeImageBasedLight");
this.apiCore.unregister(this,"setScene");this.apiCore.unregister(this,"setBackground");this.apiCore.unregister(this,"resetBackground");this.apiCore.unregister(this,"setBackgroundColor");this.apiCore.unregister(this,"setBackgroundOpacity");this.apiCore.unregister(this,"setBackgroundImage");this.apiCore.unregister(this,"removeBackgroundImage");this.apiCore.unregister(this,"setBackgroundImageOpacity");this.apiCore.unregister(this,"setBackgroundImageOffset");this.apiCore.unregister(this,"setBackgroundImageFitting");
this.apiCore.unregister(this,"setTonemapping");this.apiCore.unregister(this,"setEnvironment");this.apiCore.unregister(this,"setEnvironmentSettings");this.apiCore.unregister(this,"setRenderEnvironment");this.apiCore.unregister(this,"toggleEnvironmentRendering");this.apiCore.unregister(this,"createDefaultEnvironmentTexture2D");this.apiCore.unregister(this,"createDefaultEnvironmentTexture");this.apiCore.unregister(this,"createDefaultEnvironmentTexture2");this.apiCore.unregister(this,"createDefaultEnvironmentTexture3");
this.apiCore.unregister(this,"createDefaultEnvironmentTexture4");this.apiCore.unregister(this,"createDefaultEnvironmentTexture5");this.apiCore.unregister(this,"toggleShadowMode");this.apiCore.unregister(this,"toggleShadowFilter");this.apiCore.unregister(this,"adjustDirectionalShadow");this.apiCore.unregister(this,"setShadowOpacityThreshold")};var u=function(b){this.scene=b},k=function(b){var d=this.scene;b&&(this.scene=b);this.apiCore.exec(this.callerName,"removeAllLights",!0);if(this.scene.materialsType){l.call(this,
{color:"FFFFFF",intensity:1},!0);t.call(this,{id:-1,name:"Default directional light",color:"FFFFFF",intensity:3,position_x:0,position_y:10,position_z:0,direction_x:.3,direction_y:-.6,direction_z:-.9285,relative_to_camera:!0},!0);this.scene.scenery.environmentTexture=this.apiCore.exec(this.callerName,"createTextureFromDB",ua.call(this),!1,!1,this.scene);-1===this.scene.environmentTextures.indexOf(this.scene.scenery.environmentTexture)&&this.scene.environmentTextures.push(this.scene.scenery.environmentTexture);
this.scene.scenery.environmentRelativeToCamera=!0;this.scene.scenery.environmentRotation=280/360;this.scene.scenery.environmentExposure=0;this.scene.scenery.renderEnvironment=0;if(this.scene.scenery.environmentTexture.approximatedLights)for(b=0;b<this.scene.scenery.environmentTexture.approximatedLights.length;++b){var e=2*this.scene.scenery.environmentRotation*Math.PI,f=approximatedLights[b];f.direction[0]=f.originalDirection[2]*Math.sin(e)+f.originalDirection[0]*Math.cos(e);f.direction[2]=f.originalDirection[2]*
Math.cos(e)+f.originalDirection[0]*Math.sin(e)}this.scene.tonemapping.type=1;this.scene.tonemapping.multiplier=.8;this.scene.tonemapping.maxLuminance=1;this.scene.scenery.environmentTexture.load();this.scene.texturesManager.downloadTexture(this.scene.scenery.environmentTexture,stage.setContext(function(){this.apiCore.exec(this.callerName,"rdr.updateSceneLights",this.scene);this.apiCore.exec(this.callerName,"rdr.updateShaders",this.scene);--this.scene.stopDraw},this))&&++this.scene.stopDraw}else l.call(this,
{color:"FFFFFF",intensity:.1},!0),t.call(this,{id:-1,name:"Default directional light",color:"FFFFFF",intensity:.65,position_x:0,position_y:1,position_z:5,direction_x:0,direction_y:-1,direction_z:-5,relative_to_camera:!0},!0),r.call(this,{id:-1,name:"Default hemispherical light",sky_color:"777777",ground_color:"555555",intensity:1,direction_x:0,direction_y:1,direction_z:0,relative_to_camera:!1},!0),this.apiCore.exec(this.callerName,"rdr.updateSceneLights",this.scene),this.apiCore.exec(this.callerName,
"rdr.updateShaders",this.scene);this.scene=d},l=function(b,d){var e=this.scene.lights;b={color:ia(b.color),intensity:b.intensity};e.ambient=b;d||(this.apiCore.exec(this.callerName,"rdr.updateSceneLights",this.scene),this.apiCore.exec(this.callerName,"rdr.updateShaders",this.scene))},g=function(b){if(!this.scene)console.warn("No current scene set to update lights.");else if(b.texture_cube_map){var d=b.id,e=b.texture_cube_map.id,f=b.texture_cube_map.positive_x.id,h=b.texture_cube_map.positive_y.id,
m=b.texture_cube_map.positive_z.id,p=b.texture_cube_map.negative_x.id,g=b.texture_cube_map.negative_y.id,n=b.texture_cube_map.negative_z.id,k=b.texture_cube_map.positive_x.default_source_image.id,v=b.texture_cube_map.positive_y.default_source_image.id,l=b.texture_cube_map.positive_z.default_source_image.id,r=b.texture_cube_map.negative_x.default_source_image.id,t=b.texture_cube_map.negative_y.default_source_image.id,B=b.texture_cube_map.negative_z.default_source_image.id;b.id=-Math.abs(b.id);b.texture_cube_map.id=
-Math.abs(b.texture_cube_map.id);b.texture_cube_map.positive_x.id=-Math.abs(b.texture_cube_map.positive_x.id);b.texture_cube_map.positive_y.id=-Math.abs(b.texture_cube_map.positive_y.id);b.texture_cube_map.positive_z.id=-Math.abs(b.texture_cube_map.positive_z.id);b.texture_cube_map.negative_x.id=-Math.abs(b.texture_cube_map.negative_x.id);b.texture_cube_map.negative_y.id=-Math.abs(b.texture_cube_map.negative_y.id);b.texture_cube_map.negative_z.id=-Math.abs(b.texture_cube_map.negative_z.id);b.texture_cube_map.positive_x.default_source_image.id=
-Math.abs(b.texture_cube_map.positive_x.default_source_image.id);b.texture_cube_map.positive_y.default_source_image.id=-Math.abs(b.texture_cube_map.positive_y.default_source_image.id);b.texture_cube_map.positive_z.default_source_image.id=-Math.abs(b.texture_cube_map.positive_z.default_source_image.id);b.texture_cube_map.negative_x.default_source_image.id=-Math.abs(b.texture_cube_map.negative_x.default_source_image.id);b.texture_cube_map.negative_y.default_source_image.id=-Math.abs(b.texture_cube_map.negative_y.default_source_image.id);
b.texture_cube_map.negative_z.default_source_image.id=-Math.abs(b.texture_cube_map.negative_z.default_source_image.id);var A={id:b.id,name:b.name,intensity:b.intensity,relativeToCamera:b.relative_to_camera,texture:this.apiCore.exec(this.callerName,"createTextureCubeFromDB",b.texture_cube_map)};b.id=d;b.texture_cube_map.id=e;b.texture_cube_map.positive_x.id=f;b.texture_cube_map.positive_y.id=h;b.texture_cube_map.positive_z.id=m;b.texture_cube_map.negative_x.id=p;b.texture_cube_map.negative_y.id=g;
b.texture_cube_map.negative_z.id=n;b.texture_cube_map.positive_x.default_source_image.id=k;b.texture_cube_map.positive_y.default_source_image.id=v;b.texture_cube_map.positive_z.default_source_image.id=l;b.texture_cube_map.negative_x.default_source_image.id=r;b.texture_cube_map.negative_y.default_source_image.id=t;b.texture_cube_map.negative_z.default_source_image.id=B;b=this.scene.lights.IBL;this.scene.lights.IBL=A;this.scene.texturesManager.downloadTextureCube(A.texture,stage.setContext(q,this,A,
b))}},q=function(b,d){b.texture.load();d&&d.texture&&d.texture.unload();this.apiCore.exec(this.callerName,"rdr.updateSceneLights",this.scene);this.apiCore.exec(this.callerName,"rdr.updateShaders",this.scene)},t=function(b,d){if(this.scene){var e=this.scene.lights.directionalIds[b.id],f=ta.call(this,b);void 0!==e?stage.extend(this.scene.lights.directionals[e],f):(this.scene.lights.directionalIds[b.id]=this.scene.lights.directionals.length,this.scene.lights.directionals.push(f));d||(this.apiCore.exec(this.callerName,
"rdr.updateSceneLights",this.scene),this.apiCore.exec(this.callerName,"rdr.updateShaders",this.scene))}else console.warn("No current scene set to update lights.")},r=function(b,d){if(this.scene){var e=this.scene.lights.hemisphericalIds[b.id];var f={id:b.id,name:b.name,skyColor:ia(b.sky_color),groundColor:ia(b.ground_color),intensity:b.intensity,direction:vec3.normalize(vec3.create([b.direction_x,b.direction_y,b.direction_z])),relativeToCamera:b.relative_to_camera,ambientMode:b.ambient_mode};void 0!==
e?stage.extend(this.scene.lights.hemisphericals[e],f):(this.scene.lights.hemisphericalIds[b.id]=this.scene.lights.hemisphericals.length,this.scene.lights.hemisphericals.push(f));d||(this.apiCore.exec(this.callerName,"rdr.updateSceneLights",this.scene),this.apiCore.exec(this.callerName,"rdr.updateShaders",this.scene))}else console.warn("No current scene set to update lights.")},f=function(b,d){if(this.scene){var e=this.scene.lights.pointIds[b.id];var f={id:b.id,name:b.name,color:ia(b.color),intensity:b.intensity,
position:vec3.create([b.position_x,b.position_y,b.position_z]),relativeToCamera:b.relative_to_camera,ambientMode:b.ambient_mode,distance:b.distance,constantAttenuation:b.constant_attenuation,linearAttenuation:b.linear_attenuation,quadraticAttenuation:b.quadratic_attenuation};void 0!==e?stage.extend(this.scene.lights.points[e],f):(this.scene.lights.pointIds[b.id]=this.scene.lights.points.length,this.scene.lights.points.push(f));d||(this.apiCore.exec(this.callerName,"rdr.updateSceneLights",this.scene),
this.apiCore.exec(this.callerName,"rdr.updateShaders",this.scene))}else console.warn("No current scene set to update lights.")},n=function(b,d){if(this.scene){var e=this.scene.lights.spotIds[b.id];var f={id:b.id,name:b.name,color:ia(b.color),intensity:b.intensity,position:vec3.create([b.position_x,b.position_y,b.position_z]),direction:vec3.normalize(vec3.create([b.direction_x,b.direction_y,b.direction_z])),relativeToCamera:b.relative_to_camera,ambientMode:b.ambient_mode,innerAngle:b.inner_angle,outerAngle:b.outer_angle,
exponent:b.exponent,distance:b.distance,constantAttenuation:b.constant_attenuation,linearAttenuation:b.linear_attenuation,quadraticAttenuation:b.quadratic_attenuation,shadow:Q(b.shadow)};void 0!==e?stage.extend(this.scene.lights.spots[e],f):(this.scene.lights.spotIds[b.id]=this.scene.lights.spots.length,this.scene.lights.spots.push(f));d||(this.apiCore.exec(this.callerName,"rdr.updateSceneLights",this.scene),this.apiCore.exec(this.callerName,"rdr.updateShaders",this.scene))}else console.warn("No current scene set to update lights.")},
B=function(b,d){if(this.scene){var e=this.scene.lights.directionalIds[b];if(void 0===e)console.warn("No light with id "+b+" to remove.");else{for(var f in this.scene.lights.directionalIds)this.scene.lights.directionalIds[f]>e&&--this.scene.lights.directionalIds[f];this.scene.lights.directionals.splice(e,1);this.scene.lights.directionalIds[b]=void 0;this.apiCore.exec(this.callerName,"rdr.updateSceneLights",this.scene);d||this.apiCore.exec(this.callerName,"rdr.updateShaders",this.scene)}}else console.warn("No current scene set to update lights.")},
w=function(b,d){if(this.scene){var e=this.scene.lights.hemisphericalIds[b];if(void 0===e)console.warn("No light with id "+b+" to remove.");else{for(var f in this.scene.lights.hemisphericalIds)this.scene.lights.hemisphericalIds[f]>e&&--this.scene.lights.hemisphericalIds[f];this.scene.lights.hemisphericals.splice(e,1);this.scene.lights.hemisphericalIds[b]=void 0;this.apiCore.exec(this.callerName,"rdr.updateSceneLights",this.scene);d||this.apiCore.exec(this.callerName,"rdr.updateShaders",this.scene)}}else console.warn("No current scene set to update lights.")},
D=function(b,d){if(this.scene){var e=this.scene.lights.pointIds[b];if(void 0===e)console.warn("No light with id "+b+" to remove.");else{for(var f in this.scene.lights.pointIds)this.scene.lights.pointIds[f]>e&&--this.scene.lights.pointIds[f];this.scene.lights.points.splice(e,1);this.scene.lights.pointIds[b]=void 0;this.apiCore.exec(this.callerName,"rdr.updateSceneLights",this.scene);d||this.apiCore.exec(this.callerName,"rdr.updateShaders",this.scene)}}else console.warn("No current scene set to update lights.")},
A=function(b,d){if(this.scene){var e=this.scene.lights.spotIds[b];if(void 0===e)console.warn("No light with id "+b+" to remove.");else{for(var f in this.scene.lights.spotIds)this.scene.lights.spotIds[f]>e&&--this.scene.lights.spotIds[f];this.scene.lights.spots.splice(e,1);this.scene.lights.spotIds[b]=void 0;this.apiCore.exec(this.callerName,"rdr.updateSceneLights",this.scene);d||this.apiCore.exec(this.callerName,"rdr.updateShaders",this.scene)}}else console.warn("No current scene set to update lights.")},
H=function(b){if(this.scene){this.scene.lights.ambient={color:[1,1,1],intensity:1};this.scene.lights.directionals=[];this.scene.lights.directionalIds={};this.scene.lights.spots=[];this.scene.lights.spotIds={};this.scene.lights.hemisphericals=[];this.scene.lights.hemisphericalIds={};this.scene.lights.points=[];this.scene.lights.pointIds={};this.scene.lights.IBL=null;if(this.scene.scenery.environmentTexture){var d=this.scene.environmentTextures.indexOf(this.scene.scenery.environmentTexture);-1!==d&&
this.scene.environmentTextures.splice(d,1);this.scene.texturesManager.removeTexture(this.scene.scenery.environmentTexture)}this.apiCore.exec(this.callerName,"rdr.updateSceneLights",this.scene);b||this.apiCore.exec(this.callerName,"rdr.updateShaders",this.scene)}else console.warn("No current scene set to update lights.")},e=function(b){this.scene.lights.IBL=null;this.apiCore.exec(this.callerName,"rdr.updateSceneLights",this.scene);b||this.apiCore.exec(this.callerName,"rdr.updateShaders",this.scene)},
E=function(){if(this.backgroundImage){var b=this.apiCore.exec(this.callerName,"lib.hexToRgb",this.background.color);this.backgroundImageElement.css("background-color","rgba("+b.r+","+b.g+","+b.b+","+this.background.opacity+")")}},F=function(b,d,e,f,h,m){this.background.color=b;this.background.opacity=parseFloat(d);this.apiCore.exec(this.callerName,"rdr.setBackgroundColor",this.background.color,this.background.opacity);void 0!==e&&null!==e&&(this.background.image=e,this.background.imageOpacity=parseFloat(m),
this.background.imageOffset=h,this.background.imageFitting=f,this.apiCore.exec(this.callerName,"rdr.setBackgroundImage",this.background.image,this.background.imageFitting,this.background.imageOffset,this.background.imageOpacity));this.apiCore.exec(this.callerName,"rdr.getCurrentScene")&&this.apiCore.exec(this.callerName,"rdr.forceUpdate");E.call(this)},p=function(b){this.apiCore.exec(this.callerName,"rdr.setBackgroundColor",b,this.background.opacity);this.background.color=b;this.apiCore.exec(this.callerName,
"rdr.getCurrentScene")&&this.apiCore.exec(this.callerName,"rdr.forceUpdate");E.call(this)},m=function(){this.background&&(this.background.image||this.apiCore.exec(this.callerName,"rdr.removeBackgroundImage"),F.call(this,this.background.color,this.background.opacity,this.background.image,this.background.imageFitting,this.background.imageOffset,this.background.imageOpacity))},h=function(b){this.apiCore.exec(this.callerName,"rdr.setBackgroundColor",this.background.color,parseFloat(b));this.background.opacity=
parseFloat(b);this.apiCore.exec(this.callerName,"rdr.getCurrentScene")&&this.apiCore.exec(this.callerName,"rdr.forceUpdate");E.call(this)},v=function(b){this.apiCore.exec(this.callerName,"rdr.setBackgroundImage",b,this.background.imageFitting,this.background.imageOffset,this.background.imageOpacity);this.background.image=b;this.apiCore.exec(this.callerName,"rdr.getCurrentScene")&&this.apiCore.exec(this.callerName,"rdr.forceUpdate")},I=function(){this.apiCore.exec(this.callerName,"rdr.removeBackgroundImage");
this.background.image=null;this.apiCore.exec(this.callerName,"rdr.getCurrentScene")&&this.apiCore.exec(this.callerName,"rdr.forceUpdate")},J=function(b){this.background.imageOpacity=parseFloat(b);this.background.image&&(this.apiCore.exec(this.callerName,"rdr.setBackgroundImage",this.background.image,this.background.imageFitting,this.background.imageOffset,b),this.apiCore.exec(this.callerName,"rdr.getCurrentScene")&&this.apiCore.exec(this.callerName,"rdr.forceUpdate"))},M=function(b){this.background.image&&
(this.apiCore.exec(this.callerName,"rdr.setBackgroundImage",this.background.image,this.background.imageFitting,b,this.background.imageOpacity),this.background.imageOffset=b,this.apiCore.exec(this.callerName,"rdr.getCurrentScene")&&this.apiCore.exec(this.callerName,"rdr.forceUpdate"))},T=function(b){this.background.image&&(this.apiCore.exec(this.callerName,"rdr.setBackgroundImage",this.background.image,b,this.background.imageOffset,this.background.imageOpacity),this.background.imageFitting=b,this.apiCore.exec(this.callerName,
"rdr.getCurrentScene")&&this.apiCore.exec(this.callerName,"rdr.forceUpdate"))},U=function(b,d,e,f){this.scene&&(this.scene.tonemapping.type=b,this.scene.tonemapping.multiplier=d,this.scene.tonemapping.maxLuminance=e,this.apiCore.exec(this.callerName,"rdr.updateSceneLights",this.scene),f||this.apiCore.exec(this.callerName,"rdr.updateShaders",this.scene))},R=function(b){if(this.scene&&b.environment_texture){b.environment_texture.layer.image_r_g_b_a.rgbe=!0;var d=this.apiCore.exec(this.callerName,"createTextureFromDB",
b.environment_texture,!0);d.load();this.scene.texturesManager.downloadTexture(d,stage.setContext(function(b,d){this.scene.scenery.environmentTexture=d;-1===this.scene.environmentTextures.indexOf(d)&&this.scene.environmentTextures.push(d);this.scene.scenery.renderEnvironment=b.render_environment;this.scene.scenery.environmentRelativeToCamera=b.environment_relative_to_camera;this.scene.scenery.environmentRotation=b.environment_rotation;this.scene.scenery.environmentExposure=b.environment_exposure;this.apiCore.exec(this.callerName,
"rdr.updateSceneLights",this.scene);this.apiCore.exec(this.callerName,"rdr.updateShaders",this.scene)},this,b,d))}},aa=function(b){this.scene&&(this.scene.scenery.renderEnvironment=b,this.scene.update())},C=function(b){if(this.scene){var d=this.scene.scenery.environmentExposure!=b.environment_exposure,e=this.scene.scenery.environmentRotation!=b.environment_rotation;this.scene.scenery.environmentRelativeToCamera=b.environment_relative_to_camera;this.scene.scenery.environmentRotation=b.environment_rotation;
this.scene.scenery.environmentExposure=b.environment_exposure;if(e&&this.scene.scenery.environmentTexture.approximatedLights)for(b=0;b<this.scene.scenery.environmentTexture.approximatedLights.length;++b){e=2*-this.scene.scenery.environmentRotation*Math.PI;var f=this.scene.scenery.environmentTexture.approximatedLights[b];f.direction[0]=-f.originalDirection[2]*Math.sin(e)+f.originalDirection[0]*Math.cos(e);f.direction[2]=f.originalDirection[2]*Math.cos(e)+f.originalDirection[0]*Math.sin(e)}d&&0>this.scene.scenery.environmentExposure&&
(this.apiCore.exec(this.callerName,"rdr.getWebGLCapabilities").halfFloatTexturesForEnvCubes||this.apiCore.exec(this.callerName,"rdr.updateEnvironmentCubes",this.scene,!0));this.scene.update()}},L=function(b){this.scene&&(this.scene.scenery.renderEnvironment=void 0!==b?b:!this.scene.scenery.renderEnvironment,this.apiCore.exec(this.callerName,"rdr.updateSceneLights",this.scene),this.scene.update())},K=function(b){if(this.scene){var d=this.scene.lights.directionalIds[b.id];b=ta.call(this,b);void 0!==
d&&(d=this.scene.adjustDirectionalShadow(b.direction,b.position,this.scene.getDisplayedBoundingBox()),b.position=d.pos,delete d.pos,stage.extend(b.shadow,d));return b}},G=function(b){this.scene&&(this.scene.scenery.shadowMode=b,this.apiCore.exec(this.callerName,"rdr.updateShaders",this.scene),this.scene.update())},S=function(b){this.scene&&(this.scene.scenery.shadowFilter=b,this.apiCore.exec(this.callerName,"rdr.updateSceneLights",this.scene),this.scene.update())},Y=function(b){this.scene&&(this.scene.scenery.shadowOpacityThreshold=
b,this.apiCore.exec(this.callerName,"rdr.updateSceneLights",this.scene),this.scene.update())},ia=function(b){var d=b;"#"==d[0]&&(d=d.slice(1,b.length));b="0x"+d.substr(0,2);var e="0x"+d.substr(2,2);d="0x"+d.substr(4,2);return vec3.create([parseInt(b)/255,parseInt(e)/255,parseInt(d)/255])},Q=function(b){return b?{id:b.id,intensity:b.intensity,globalIntensity:b.global_intensity,width:b.width,height:b.height,bias:b.bias,globalBias:b.global_bias,near:b.near,far:b.far,left:b.box_left,right:b.box_right,
top:b.box_top,bottom:b.box_bottom,autoAdjust:b.auto_adjust}:{id:-1,intensity:0,globalIntensity:0,width:1,height:1,bias:0,globalBias:0,near:0,far:0,left:0,right:0,top:0,bottom:0,autoAdjust:!1}},ta=function(b){return{id:b.id,name:b.name,color:ia(b.color),intensity:b.intensity,position:vec3.create([b.position_x,b.position_y,b.position_z]),direction:vec3.normalize(vec3.create([b.direction_x,b.direction_y,b.direction_z])),relativeToCamera:b.relative_to_camera,ambientMode:b.ambient_mode,shadow:Q(b.shadow)}},
ua=function(){return{id:-100000001,wrap_s:"REPEAT",wrap_t:"REPEAT",repeat_x:1,repeat_y:1,offset_x:0,offset_y:0,angle:0,use_mipmap:!0,min_filter:"LINEAR_MIPMAP_LINEAR",mag_filter:"LINEAR",srgb_mode:0,uvsrc:0,channel:0,anisotropy:4,layer:{color:"FFFFFF",image_r_g_b_a:{id:-100000001,name:"env",rgbe:!0,default_source_image:{id:-100000002,name:"env",file_path:"/defaultEnvironment/1024.png",real_file_path:this.texturesFilePath+"defaultEnvironment/1024.png",file_type:"local",width:1024,height:1024,file_size:683243},
source_images:[{id:-100000002,name:"env",file_path:"/defaultEnvironment/1024.png",real_file_path:this.texturesFilePath+"defaultEnvironment/1024.png",file_type:"local",width:1024,height:1024,file_size:683243},{id:-100000003,name:"env",file_path:"/defaultEnvironment/512.png",real_file_path:this.texturesFilePath+"defaultEnvironment/512.png",file_type:"local",width:512,height:512,file_size:203484},{id:-100000004,name:"env",file_path:"/defaultEnvironment/256.png",real_file_path:this.texturesFilePath+"defaultEnvironment/256.png",
file_type:"local",width:256,height:256,file_size:67262},{id:-100000005,name:"env",file_path:"/defaultEnvironment/128.png",real_file_path:this.texturesFilePath+"defaultEnvironment/128.png",file_type:"local",width:128,height:128,file_size:23145},{id:-100000006,name:"env",file_path:"/defaultEnvironment/64.png",real_file_path:this.texturesFilePath+"defaultEnvironment/64.png",file_type:"local",width:64,height:64,file_size:7505},{id:-100000007,name:"env",file_path:"/defaultEnvironment/32.png",real_file_path:this.texturesFilePath+
"defaultEnvironment/32.png",file_type:"local",width:32,height:32,file_size:2406},{id:-100000008,name:"env",file_path:"/defaultEnvironment/16.png",real_file_path:this.texturesFilePath+"defaultEnvironment/16.png",file_type:"local",width:16,height:16,file_size:826},{id:-100000009,name:"env",file_path:"/defaultEnvironment/8.png",real_file_path:this.texturesFilePath+"defaultEnvironment/8.png",file_type:"local",width:8,height:8,file_size:315},{id:-100000010,name:"env",file_path:"/defaultEnvironment/4.png",
real_file_path:this.texturesFilePath+"defaultEnvironment/4.png",file_type:"local",width:4,height:4,file_size:143},{id:-100000011,name:"env",file_path:"/defaultEnvironment/2.png",real_file_path:this.texturesFilePath+"defaultEnvironment/2.png",file_type:"local",width:2,height:2,file_size:97},{id:-100000012,name:"env",file_path:"/defaultEnvironment/1.png",real_file_path:this.texturesFilePath+"defaultEnvironment/1.png",file_type:"local",width:1,height:1,file_size:89}]}}}};return d});stage.provide("emersya.viewer.modules.sceneControls");
stage.require("emersya.viewer.modules.peripherals");
stage.register.call(stage.emersya.viewer.modules,"sceneControls",function(){var b={camera:{position:[5,5,5],target:[0,0,0],up:[0,1,0],upReal:[0,1,0],screenOffset:{x:0,y:0},dynamicClippingPlanes:!0,staticViewpoint:!0,planes:{near:.1,far:100},mousePos:{x:-1,y:-1},fov:40},doubleOrbitSettings:{deltaZoomDivisor:1E4,zoomScalesRotation:!0,xRotationFull:3*Math.PI,yRotationFull:3*Math.PI,xRotationMin:-2*Math.PI,xRotationMax:2*Math.PI,yRotationMin:-2*Math.PI,yRotationMax:2*Math.PI,targetRange:1.5,targetAxes:[1,
1,1],moveOnMaxZoom:!1,minDistanceRatio:.2},trackBallSettings:{deltaZoomDivisor:1E4,zoomScalesRotation:!0,minDistanceRatio:.2,moveOnMaxZoom:!1,targetRange:1.5,targetAxes:[1,1,1]},freeFlySettings:{deltaZoomDivisor:1E4,zoomScalesRotation:!0,xRotationFull:3*Math.PI,yRotationFull:3*Math.PI,xRotationMin:-2*Math.PI,xRotationMax:2*Math.PI,yRotationMin:(Math.PI-1E-4)/2,yRotationMax:-(Math.PI-1E-4)/2,minDistanceRatio:.2,targetRange:-1},minZoomRatio:.1,maxZoomRatio:1E3,translateX:!0,translateY:!0,adaptativeFov:!1,
moveOnClick:!0,autoRotateSpeed:10,clockwise:!0,acceleration:stage.emersya.viewer.ACCELERATION_MODES.ON,editionMode:stage.emersya.viewer.EDITION_MODES.NONE,computeHighlight:!0,highlightPolylists:0,selectPolylists:!0,realTimeAPI:!1,hdOnStop:!0,startingRenderingMode:stage.emersya.viewer.RENDERING_MODES.CLASSIC,possibleRenderingModes:stage.emersya.viewer.RENDERING_MODES.CLASSIC|stage.emersya.viewer.RENDERING_MODES.FULL_WIREFRAME|stage.emersya.viewer.RENDERING_MODES.SHARP_EDGES|stage.emersya.viewer.RENDERING_MODES.GOOCH|
stage.emersya.viewer.RENDERING_MODES.FULLSPEC|stage.emersya.viewer.RENDERING_MODES.FULLREFL|stage.emersya.viewer.RENDERING_MODES.UVS|stage.emersya.viewer.RENDERING_MODES.POLYCOLOR|stage.emersya.viewer.RENDERING_MODES.MATSCOLOR,startingControlMode:stage.emersya.viewer.SCENE_CONTROL.DOUBLEORBIT,possibleControlModes:stage.emersya.viewer.SCENE_CONTROL.DOUBLEORBIT|stage.emersya.viewer.SCENE_CONTROL.TRACKBALL|stage.emersya.viewer.SCENE_CONTROL.FREEFLY|stage.emersya.viewer.SCENE_CONTROL.PLANARFREEFLY,startingProjectionMode:stage.emersya.viewer.PROJECTION_MODES.PERSPECTIVE,
possibleProjectionModes:stage.emersya.viewer.PROJECTION_MODES.PERSPECTIVE|stage.emersya.viewer.PROJECTION_MODES.ORTHOGRAPHIC,useFxLevels:!1,fxLevels:{downscale:{min:1,max:1,val:1},silhouettes:{min:0,max:0,val:0},blur:{min:0,max:.5,val:1},mirror:{min:0,max:0,val:0},ssao:{min:1,max:1,val:1},glow:{min:.5,max:.5,val:.5}},useFxSaveRestore:!1},d=function(d,V,O){this.settings=stage.extend(!0,{},b,O);this.apiCore=d;this.eventsManager=stage.createEventsManager(this.settings);this.renderer=V;this.checkForWebGLErrors=
-1===navigator.userAgent.indexOf("SamsungBrowser");this.callerName=this.name="SceneControls";this.apiCore.register(this,"mousePosUpdate",Qa);this.apiCore.register(this,"mouseLeave",N);this.apiCore.register(this,"deltaUpdate",za);this.apiCore.register(this,"mouseButtonPress",ca);this.apiCore.register(this,"mouseButtonRelease",Ea);this.apiCore.register(this,"mouseDrop",Ca);this.apiCore.register(this,"wheelUpdate",Ua);this.apiCore.register(this,"angleUpdate",sa);this.apiCore.register(this,"click",na);
this.apiCore.register(this,"keyPress",kb);this.apiCore.register(this,"keyRelease",Da);this.apiCore.register(this,"resize",Za);this.apiCore.register(this,"setMouseControlMode",P);this.apiCore.register(this,"removeScene",u);this.apiCore.register(this,"setScene",k);this.apiCore.register(this,"resetCameraScene",l);this.apiCore.register(this,"displayFallback",g);this.apiCore.register(this,"removeFallback",q);this.apiCore.register(this,"getWidth",t,!0);this.apiCore.register(this,"getHeight",r,!0);this.apiCore.register(this,
"getFov",f,!0);this.apiCore.register(this,"getNear",n,!0);this.apiCore.register(this,"getFar",B,!0);this.apiCore.register(this,"getCamera",va,!0);this.apiCore.register(this,"getInitCamera",la,!0);this.apiCore.register(this,"getAnimationSpeed",Ba,!0);this.apiCore.register(this,"setZoomRatio",F);this.apiCore.register(this,"getZoomRatio",fa,!0);this.apiCore.register(this,"setAutoRotate",w);this.apiCore.register(this,"startAutoRotate",D);this.apiCore.register(this,"stopAutoRotate",A);this.apiCore.register(this,
"toggleAutoRotate",H);this.apiCore.register(this,"startAnimatingPath",e);this.apiCore.register(this,"getViewpointCamera",ra,!0);this.apiCore.register(this,"getViewpointRegexpsCameras",Sa,!0);this.apiCore.register(this,"setViewpoint",Ya);this.apiCore.register(this,"recenterViewpoint",Ra);this.apiCore.register(this,"getModelBiggestSize",Ja,!0);this.apiCore.register(this,"stopAnimatingPath",E);this.apiCore.register(this,"enableForceRender",p,!0);this.apiCore.register(this,"disableForceRender",m,!0);
this.apiCore.register(this,"setNextDeltaT",h);this.apiCore.register(this,"ignoreNextFrames",v);this.apiCore.register(this,"setAccelerationMode",M);this.apiCore.register(this,"setAnimationSpeed",Ka);this.apiCore.register(this,"changeRenderingMode",I);this.apiCore.register(this,"changeZoomRatios",T);this.apiCore.register(this,"changeZoomRatiosFromProportions",U);this.apiCore.register(this,"reinitZoom",R);this.apiCore.register(this,"resetMinAndMaxZoom",aa);this.apiCore.register(this,"changeTranslationAxes",
C);this.apiCore.register(this,"getCameraControl",L,!0);this.apiCore.register(this,"changeCameraControl",K);this.apiCore.register(this,"changeCameraMode",G);this.apiCore.register(this,"translateCamera",S);this.apiCore.register(this,"rotateCamera",Y);this.apiCore.register(this,"moveCamera",ia);this.apiCore.register(this,"zoomInCamera",Q);this.apiCore.register(this,"zoomOutCamera",ta);this.apiCore.register(this,"setPosition",ua);this.apiCore.register(this,"setRotationCamera",ea,!0);this.apiCore.register(this,
"setFov",oa);this.apiCore.register(this,"setAdaptativeFov",ba);this.apiCore.register(this,"setCameraClippingPlanes",ka);this.apiCore.register(this,"setCameraScreenOffsets",Z);this.apiCore.register(this,"setMoveOnClick",da);this.apiCore.register(this,"setRealTimeAPI",X);this.apiCore.register(this,"resetCamera",Va);this.apiCore.register(this,"reInitCamera",db);this.apiCore.register(this,"toggleMouseTrackingMode",Ha);this.apiCore.register(this,"toggleCameraLock",Ga);this.apiCore.register(this,"setDragMouseButton",
xa);this.apiCore.register(this,"toggleProductNodesDrag",Ia);this.apiCore.register(this,"setProductNodesDragMode",qa);this.apiCore.register(this,"startProductNodeInstanceDragging",ec);this.apiCore.register(this,"stopProductNodeInstanceDragging",Xb);this.apiCore.register(this,"productNodeInstanceRemoved",yb);this.apiCore.register(this,"toggleUseFxLevels",wa);this.apiCore.register(this,"startRendering",bb);this.apiCore.register(this,"restartRendering",bb);this.apiCore.register(this,"stopRendering",gb);
this.apiCore.register(this,"forceRender",ib,!0);this.apiCore.register(this,"polylistHighlight",Hb);this.apiCore.register(this,"setEditionMode",J);this.camera=stage.extend(!0,{},this.settings.camera);db.call(this);this.apiCore.exec(this.callerName,"rdr.changeCameraMode",this.perspective);this.viewerSize=[0,0];this.mousePos={x:0,y:0};M.call(this,this.settings.acceleration);this.wheelDelta=this.deltaAngle=this.deltaY=this.deltaX=0;this.firstNoRender=!0;this.currentState=-1;this.lastUpdate=this.now=null;
this.deltaTCount=this.deltaTSum=this.deltaT=0;this.nextDeltaT=null;this.minSpeedWithHdOnStop=.05;this.minSpeedWithoutHdOnStop=.001;this.decDurationWithHdOnStop=300;this.mousePressedDecDurationWithoutHdOnStop=this.mousePressedDecDurationWithHdOnStop=this.decDurationWithoutHdOnStop=800;this.minSpeedLimit=this.minSpeedWithoutHdOnStop;this.wheelDeltaSpeed=this.deltaAngleSpeed=this.deltaYSpeed=this.deltaXSpeed=this.wheelDeltaApplied=this.deltaAngleApplied=this.deltaYApplied=this.deltaXApplied=0;this.deltaAngleMaxSpeed=
this.deltaYMaxSpeed=this.deltaXMaxSpeed=5;this.initialMaxZoomSpeed=this.wheelDeltaMaxSpeed=3.53;this.accStart=0;this.accDuration=1;Aa.call(this);this.lastInteractionType=this.interactionType=0;this.lastEventTriggered=null;this.statAccumulatedDeltaApplied=vec3.create([0,0,0]);this.statPeriod=500;this.mouseMode=stage.emersya.viewer.MOUSE_CONTROL_MODES.ROTATE;this.autoRotating=!1;this.autoRotateSpeed=0;this.autoRotateAccStart=null;this.autoRotateAccTime=1E3;this.animating=!1;this.animations=this.animationStart=
null;this.animationLooping=!1;this.animationUnstoppable=!0;this.animationEndCallback=null;this.currentAnimation=0;this.animationSpeed=1;this.cameraLockedForDrag=this.wasPressedForDrag=this.ignorePressStatus=this.productNodesDragEnabled=!1;this.draggingProductNodeInstance=null;this.productNodesDragMode=stage.emersya.viewer.PRODUCT_NODES_DRAG_MODE.OVERED;this.anyMouseButtonPressed=this.mouseTrackingForced=this.mouseTrackingMode=!1;this.mouseButtonsPressed=[];this.dragMouseButton=null;this.cameraLocked=
!1;xb.call(this);this.settings.useFxLevels&&(this.updateFxLevels=[stage.setContext(ja,this),stage.setContext(W,this),stage.setContext(pa,this),stage.setContext(Pa,this),stage.setContext(ha,this),stage.setContext(ya,this)],this.setFxLevels=[stage.setContext(zb,this),stage.setContext(cb,this),stage.setContext(nc,this),stage.setContext(dc,this),stage.setContext(Wb,this),stage.setContext(Sb,this)],this.fxLevelsNames="downscale silhouettes blur mirror ssao glow".split(" "),this.renderer.gl.mrt||(this.settings.fxLevels.ssao.min=
this.settings.fxLevels.ssao.max=this.settings.fxLevels.ssao.val=0),this.renderer.gl.floatTextures||(this.settings.fxLevels.ssao.min=this.settings.fxLevels.ssao.max=this.settings.fxLevels.ssao.val=0,this.settings.fxLevels.silhouettes.min=this.settings.fxLevels.silhouettes.max=this.settings.fxLevels.silhouettes.val=0),this.fxLevels={downscale:this.settings.fxLevels.downscale.val,silhouettes:this.settings.fxLevels.silhouettes.val,blur:this.settings.fxLevels.blur.val,mirror:this.settings.fxLevels.mirror.val,
ssao:this.settings.fxLevels.ssao.val,glow:this.settings.fxLevels.glow.val},this.settings.useFxLevels&&(cb.call(this,this.settings.fxLevels.silhouettes.val),nc.call(this,this.settings.fxLevels.blur.val),dc.call(this,this.settings.fxLevels.mirror.val),Wb.call(this,this.settings.fxLevels.ssao.val),Sb.call(this,this.settings.fxLevels.glow.val)),this.fxDeltaTimes=[])};d.prototype.updateSettings=function(b){this.settings=stage.extend(!0,{},this.settings,b)};d.prototype.destroy=function(){this.destroyed||
(this.animationFrame&&(window.cancelAnimationFrame(this.animationFrame),this.animationFrame=null),this.apiCore.unregister(this,"mousePosUpdate"),this.apiCore.unregister(this,"mouseLeave"),this.apiCore.unregister(this,"deltaUpdate"),this.apiCore.unregister(this,"mouseButtonPress"),this.apiCore.unregister(this,"mouseButtonRelease"),this.apiCore.unregister(this,"mouseDrop"),this.apiCore.unregister(this,"wheelUpdate"),this.apiCore.unregister(this,"angleUpdate"),this.apiCore.unregister(this,"click"),this.apiCore.unregister(this,
"keyPress"),this.apiCore.unregister(this,"keyRelease"),this.apiCore.unregister(this,"resize"),this.apiCore.unregister(this,"setMouseControlMode"),this.apiCore.unregister(this,"removeScene"),this.apiCore.unregister(this,"setScene"),this.apiCore.unregister(this,"resetCameraScene"),this.apiCore.unregister(this,"displayFallback"),this.apiCore.unregister(this,"removeFallback"),this.apiCore.unregister(this,"getWidth"),this.apiCore.unregister(this,"getHeight"),this.apiCore.unregister(this,"getFov"),this.apiCore.unregister(this,
"getNear"),this.apiCore.unregister(this,"getFar"),this.apiCore.unregister(this,"getCamera"),this.apiCore.unregister(this,"getInitCamera"),this.apiCore.unregister(this,"getAnimationSpeed"),this.apiCore.unregister(this,"setZoomRatio"),this.apiCore.unregister(this,"getZoomRatio"),this.apiCore.unregister(this,"setAutoRotate"),this.apiCore.unregister(this,"startAutoRotate"),this.apiCore.unregister(this,"stopAutoRotate"),this.apiCore.unregister(this,"toggleAutoRotate"),this.apiCore.unregister(this,"startAnimatingPath"),
this.apiCore.unregister(this,"getViewpointCamera"),this.apiCore.unregister(this,"getViewpointRegexpsCameras"),this.apiCore.unregister(this,"setViewpoint"),this.apiCore.unregister(this,"recenterViewpoint"),this.apiCore.unregister(this,"getModelBiggestSize"),this.apiCore.unregister(this,"stopAnimatingPath"),this.apiCore.unregister(this,"enableForceRender"),this.apiCore.unregister(this,"disableForceRender"),this.apiCore.unregister(this,"setNextDeltaT"),this.apiCore.unregister(this,"ignoreNextFrames"),
this.apiCore.unregister(this,"setAccelerationMode"),this.apiCore.unregister(this,"setAnimationSpeed"),this.apiCore.unregister(this,"changeRenderingMode"),this.apiCore.unregister(this,"changeZoomRatios"),this.apiCore.unregister(this,"changeZoomRatiosFromProportions"),this.apiCore.unregister(this,"reinitZoom"),this.apiCore.unregister(this,"resetMinAndMaxZoom"),this.apiCore.unregister(this,"changeTranslationAxes"),this.apiCore.unregister(this,"getCameraControl"),this.apiCore.unregister(this,"changeCameraControl"),
this.apiCore.unregister(this,"changeCameraMode"),this.apiCore.unregister(this,"translateCamera"),this.apiCore.unregister(this,"rotateCamera"),this.apiCore.unregister(this,"moveCamera"),this.apiCore.unregister(this,"zoomInCamera"),this.apiCore.unregister(this,"zoomOutCamera"),this.apiCore.unregister(this,"setPosition"),this.apiCore.unregister(this,"setRotationCamera"),this.apiCore.unregister(this,"setFov"),this.apiCore.unregister(this,"setAdaptativeFov"),this.apiCore.unregister(this,"setCameraClippingPlanes"),
this.apiCore.unregister(this,"setCameraScreenOffsets"),this.apiCore.unregister(this,"setMoveOnClick"),this.apiCore.unregister(this,"setRealTimeAPI"),this.apiCore.unregister(this,"resetCamera"),this.apiCore.unregister(this,"reInitCamera"),this.apiCore.unregister(this,"toggleMouseTrackingMode"),this.apiCore.unregister(this,"toggleCameraLock"),this.apiCore.unregister(this,"setDragMouseButton"),this.apiCore.unregister(this,"toggleProductNodesDrag"),this.apiCore.unregister(this,"setProductNodesDragMode"),
this.apiCore.unregister(this,"startProductNodeInstanceDragging"),this.apiCore.unregister(this,"stopProductNodeInstanceDragging"),this.apiCore.unregister(this,"productNodeInstanceRemoved"),this.apiCore.unregister(this,"toggleUseFxLevels"),this.apiCore.unregister(this,"startRendering"),this.apiCore.unregister(this,"restartRendering"),this.apiCore.unregister(this,"stopRendering"),this.apiCore.unregister(this,"forceRender"),this.apiCore.unregister(this,"polylistHighlight"),this.apiCore.unregister(this,
"setEditionMode"),this.destroyed=!0)};var u=function(){this.deltaAngle=this.wheelDelta=this.deltaY=this.deltaX=this.deltaAngleSpeed=this.deltaYSpeed=this.deltaXSpeed=this.deltaAngleApplied=this.deltaYApplied=this.deltaXApplied=0},k=function(b){(this.scene=b)?(this.renderingStartTime=Date.now()-1,this.confirmationSent=!1,l.call(this)):(this.camera.sceneRadius=1,this.camera.sceneCenter=vec3.create([0,0,0]),this.camera.fov=40);b&&b.scenery.complete&&(b=b.scenery,this.initCameraFov=b.fov,oa.call(this,
b.fov),ba.call(this,b.adaptativeFov),C.call(this,b.xTranslation,b.yTranslation),G.call(this,b.cameraMode),this.camera.up=vec3.create(this.initCameraUp),this.camera.upReal=vec3.create(this.initCameraUp),this.settings.doubleOrbitSettings.xRotationMin=b.xRotationMin,this.settings.doubleOrbitSettings.xRotationMax=b.xRotationMax,this.settings.doubleOrbitSettings.yRotationMin=b.yRotationMin,this.settings.doubleOrbitSettings.yRotationMax=b.yRotationMax,this.settings.doubleOrbitSettings.targetRange=b.targetRange,
this.settings.doubleOrbitSettings.targetAxes=b.targetAxes,this.settings.trackBallSettings.targetRange=b.targetRange,this.settings.trackBallSettings.targetAxes=b.targetAxes,this.settings.freeFlySettings.xRotationMin=b.xRotationMin,this.settings.freeFlySettings.xRotationMax=b.xRotationMax,this.settings.freeFlySettings.yRotationMin=b.yRotationMin,this.settings.freeFlySettings.yRotationMax=b.yRotationMax,this.settings.freeFlySettings.targetRange=b.targetRange,this.settings.freeFlySettings.targetAxes=
b.targetAxes,T.call(this,b.minZoomRatio,b.maxZoomRatio),K.call(this,b.sceneControl,{},!0,!0))},l=function(){if(this.scene){var b=this.scene.root.boundingBox;this.camera.sceneRadius=Math.max(Math.abs(b.maxX-b.minX),Math.max(Math.abs(b.maxY-b.minY),Math.abs(b.maxZ-b.minZ)));this.camera.sceneCenter=b.center}},g=function(){this.fallbackDisplayed=!0},q=function(){this.fallbackDisplayed=!1;Oa.call(this)},t=function(){return this.renderer.realSize[0]},r=function(){return this.renderer.realSize[1]},f=function(){return this.camera.fov},
n=function(){return this.renderer.near},B=function(){return this.renderer.far},w=function(b,d){this.settings.clockwise=b;this.settings.autoRotateSpeed=d},D=function(){this.autoRotating||(this.state=0,this.autoRotateAccStart=Date.now(),this.autoRotating=!0)},A=function(){this.autoRotating&&(this.autoRotating=!1,this.autoRotateAccStart=null,this.apiCore.exec(this.callerName,"ui.changeRotateIcon","pause"))},H=function(){this.autoRotating?this.apiCore.exec(this.callerName,"stopAutoRotate"):this.apiCore.exec(this.callerName,
"startAutoRotate")},e=function(b,d,e,f){if(!(!b.length||this.animating&&this.animationUnstoppable)){this.animating&&this.apiCore.exec(this.callerName,"stopAnimatingPath");this.apiCore.exec(this.callerName,"stopAutoRotate");this.animations=[];for(var h in b)b[h].fov||(b[h].fov=this.camera.fov),this.animations.push(new Ta(b[h]));this.animationLooping=void 0!==d?d:!1;this.currentAnimation=0;this.animations[this.currentAnimation].empty||(d=this.animations[this.currentAnimation].camControl,this.animations[this.currentAnimation].camControl&&
(b=this.camControl.getType(),d=d.type,b==stage.emersya.viewer.SCENE_CONTROL.DOUBLEORBIT&&d==stage.emersya.viewer.SCENE_CONTROL.TRACKBALL&&this.apiCore.exec(this.callerName,"changeCameraControl",d,{},!0,!0)),this.camControl.setAnimation(this.animations[this.currentAnimation].position,this.animations[this.currentAnimation].target,this.animations[this.currentAnimation].up));this.initialFov=this.camera.fov;this.initialScreenOffsetX=this.camera.screenOffset.x;this.initialScreenOffsetY=this.camera.screenOffset.y;
this.interactionType=stage.emersya.viewer.INTERACTION_TYPE.NONE;Ma.call(this);this.apiCore.exec(this.callerName,"cameraAnimationStart",this.camera);this.animating=!0;this.animationUnstoppable=void 0!==e?e:!1;this.animationEndCallback=void 0!==f?f:null;this.wheelDeltaSpeed=this.deltaYSpeed=this.deltaXSpeed=this.wheelDeltaApplied=this.deltaYApplied=this.deltaXApplied=0;this.apiCore.exec(this.callerName,"forceRender")}},E=function(b){if(!b||this.animating)!b&&this.animating&&this.animationUnstoppable||
(K.call(this,this.camControl.getType(),this.camControl.settings,!0,!0),this.apiCore.exec(this.callerName,"cameraAnimationEnd",this.camera),this.animationEndCallback&&(b=this.animationEndCallback,this.animationEndCallback=null,b()),this.animating=!1,this.animations=null)},F=function(b,d,f){0>b||1<b||(b=[{position:this.camControl.getPositionFromZoomRatio(b),target:vec3.create(this.camera.target),up:vec3.create(this.camera.up),t:void 0!==d?d:1E3}],e.call(this,b,!1,!!f))},p=function(){this.noForceRender=
!1},m=function(){this.noForceRender=!0},h=function(b){this.nextDeltaT=b},v=function(b){this.ignoreNextFrames=2},I=function(b){return b&this.settings.possibleRenderingModes?(this.apiCore.exec(this.callerName,"rdr.changeRenderingMode",b),stage.createResult(null)):stage.createError(201,"changeRenderingMode in sceneControls",b)},J=function(b){this.currentlyTransforming=!1;this.settings.editionMode=b},M=function(b){switch(b){case stage.emersya.viewer.ACCELERATION_MODES.OFF:this.useAcceleration=!1;break;
case stage.emersya.viewer.ACCELERATION_MODES.OFF_ON_MOBILE:this.useAcceleration=!(stage.browser.mobilBrowser||"iPad"==navigator.platform||"iPhone"==navigator.platform);break;default:this.useAcceleration=!0}},T=function(b,d,e){this.settings.minZoomRatio=b;this.settings.maxZoomRatio=d;e?R.call(this):(this.camControl.settings.minZoom=1/d*this.initialZoom,this.camControl.settings.maxZoom=1/b*this.initialZoom)},U=function(b,d){if(this.scene&&this.scene.scenery){var e=1/this.scene.scenery.maxZoomRatio*
this.initialZoom,f=1/this.scene.scenery.minZoomRatio*this.initialZoom-e;T.call(this,1/(((1-b)*f+e)/this.initialZoom),1/(((1-d)*f+e)/this.initialZoom))}},R=function(){this.camera&&this.camControl&&(this.initialZoom=vec3.length(vec3.subtract(this.camera.position,this.camera.target,vec3.create())),this.camControl.settings.minZoom=1/this.settings.maxZoomRatio*this.initialZoom,this.camControl.settings.maxZoom=1/this.settings.minZoomRatio*this.initialZoom)},aa=function(){this.scene&&this.scene.scenery&&
T.call(this,this.scene.scenery.minZoomRatio,this.scene.scenery.maxZoomRatio)},C=function(b,d){this.settings.translateX=b;this.settings.translateY=d;this.translatingX=this.settings.translateX?1:0;this.translatingY=this.settings.translateY?1:0},L=function(){return this.camControl},K=function(b,d,e,f){if(f||this.camControl.getType()!=b){if(!(b&this.settings.possibleControlModes))return stage.createError(203,"changeCameraControl in sceneControls",{mode:b,settings:d});void 0===d&&(d={});f={};switch(b){case stage.emersya.viewer.SCENE_CONTROL.DOUBLEORBIT:stage.extend(f,
this.settings.doubleOrbitSettings,d,{camera:this.camera,viewport:{width:this.renderer.realSize[0],height:this.renderer.realSize[1]},minZoom:1/this.settings.maxZoomRatio*this.initialZoom,maxZoom:1/this.settings.minZoomRatio*this.initialZoom,initialZoom:this.initialZoom});b=new stage.emersya.viewer.modules.sceneControls.doubleOrbitControl(f);e?this.camControl=b:(e=b.getAnimateDest(this.camera.position,this.camera.target,this.camera.up),e.t=400,this.apiCore.exec(this.callerName,"startAnimatingPath",
[e],!1,!0,stage.setContext(function(b){this.camControl=b},this,b)));break;case stage.emersya.viewer.SCENE_CONTROL.TRACKBALL:stage.extend(f,this.settings.trackBallSettings,d,{camera:this.camera,viewport:{width:this.renderer.realSize[0],height:this.renderer.realSize[1]},minZoom:1/this.settings.maxZoomRatio*this.initialZoom,maxZoom:1/this.settings.minZoomRatio*this.initialZoom,initialZoom:this.initialZoom});this.camControl=new stage.emersya.viewer.modules.sceneControls.trackBallControl(f);break;case stage.emersya.viewer.SCENE_CONTROL.FREEFLY:stage.extend(f,
this.settings.freeFlySettings,d,{camera:this.camera,viewport:{width:this.renderer.realSize[0],height:this.renderer.realSize[1]},minZoom:1/this.settings.maxZoomRatio*this.initialZoom,maxZoom:1/this.settings.minZoomRatio*this.initialZoom,initialZoom:this.initialZoom});b=new stage.emersya.viewer.modules.sceneControls.freeFlyControl(f);e?this.camControl=b:(e=b.getAnimateDest(this.camera.position,this.camera.target,this.camera.up),e.t=400,this.apiCore.exec(this.callerName,"startAnimatingPath",[e],!1,!0,
stage.setContext(function(b){this.camControl=b},this,b)));break;case stage.emersya.viewer.SCENE_CONTROL.PLANARFREEFLY:stage.extend(f,this.settings.freeFlySettings,d,{camera:this.camera,viewport:{width:this.renderer.realSize[0],height:this.renderer.realSize[1]}}),b=new stage.emersya.viewer.modules.sceneControls.planarFreeFlyControl(f),e?this.camControl=b:(e=b.getAnimateDest(this.camera.position,this.camera.target,this.camera.up),e.t=400,this.apiCore.exec(this.callerName,"startAnimatingPath",[e],!1,
!0,stage.setContext(function(b){this.camControl=b},this,b)))}return stage.createResult(null)}},G=function(b){switch(b){case stage.emersya.viewer.PROJECTION_MODES.PERSPECTIVE:if(!(stage.emersya.viewer.PROJECTION_MODES.PERSPECTIVE&this.settings.possibleProjectionModes))return stage.createError(202,"toggleCameraMode in sceneControls",b);this.perspective=!0;break;case stage.emersya.viewer.PROJECTION_MODES.ORTHOGRAPHIC:if(!(stage.emersya.viewer.PROJECTION_MODES.ORTHOGRAPHIC&this.settings.possibleProjectionModes))return stage.createError(202,
"toggleCameraMode in sceneControls",b);this.perspective=!1;break;default:this.perspective=!0}this.apiCore.exec(this.callerName,"rdr.changeCameraMode",this.perspective);return stage.createResult(null)},S=function(b,d){this.autoRotating&&this.apiCore.exec(this.callerName,"stopAutoRotate");this.animating&&!this.animationUnstoppable&&this.apiCore.exec(this.callerName,"stopAnimatingPath");this.animating||(this.accStart=Date.now(),this.deltaAngleSpeed=this.deltaYSpeed=this.deltaXSpeed=this.deltaAngleApplied=
this.deltaYApplied=this.deltaXApplied=0,this.deltaAngleMaxSpeed=this.deltaYMaxSpeed=this.deltaXMaxSpeed=5,this.state=2,this.deltaX+=b,this.deltaY-=d,this.apiCore.exec(this.callerName,"forceRender"))},Y=function(b,d,e){this.autoRotating&&this.apiCore.exec(this.callerName,"stopAutoRotate");this.animating&&!this.animationUnstoppable&&this.apiCore.exec(this.callerName,"stopAnimatingPath");this.animating||(this.accStart=Date.now(),this.deltaAngleSpeed=this.deltaYSpeed=this.deltaXSpeed=this.deltaAngleApplied=
this.deltaYApplied=this.deltaXApplied=0,this.deltaAngleMaxSpeed=this.deltaYMaxSpeed=this.deltaXMaxSpeed=5,this.state=0,b=this.camControl.getRotationDeltas(b,d,e),this.deltaX+=b.x,this.deltaY+=b.y,this.deltaAngle+=b.z,this.camControl.setMousePos(parseInt(this.apiCore.exec(this.callerName,"getWidth")/2),parseInt(this.apiCore.exec(this.callerName,"getHeight")/2)),this.apiCore.exec(this.callerName,"forceRender"))},ia=function(b,d,e){this.autoRotating&&this.apiCore.exec(this.callerName,"stopAutoRotate");
this.animating&&!this.animationUnstoppable&&this.apiCore.exec(this.callerName,"stopAnimatingPath");this.animating||(xb.call(this),0<b?this.deltaRight+=b:this.deltaLeft-=b,0<d?this.deltaUp+=d:this.deltaDown-=d,0<e?this.deltaForward+=e:this.deltaBackward-=e,this.keyboardAccStart=this.now,this.apiCore.exec(this.callerName,"forceRender"))},Q=function(b){this.autoRotating&&this.apiCore.exec(this.callerName,"stopAutoRotate");this.animating&&!this.animationUnstoppable&&this.apiCore.exec(this.callerName,
"stopAnimatingPath");this.animating||(this.accStart=Date.now(),this.wheelDelta+=b,this.apiCore.exec(this.callerName,"forceRender"))},ta=function(b){this.autoRotating&&this.apiCore.exec(this.callerName,"stopAutoRotate");this.animating&&!this.animationUnstoppable&&this.apiCore.exec(this.callerName,"stopAnimatingPath");this.animating||(this.accStart=Date.now(),this.wheelDelta-=b,this.apiCore.exec(this.callerName,"forceRender"))},ua=function(b,d,e,f){vec3.set(f,this.camera.target);var h=vec3.create();
if(this.camControl.getType()===stage.emersya.viewer.SCENE_CONTROL.TRACKBALL){var m=vec3.create(this.camera.up),p=vec3.create(this.camControl.cameraXReal);vec3.subtract(this.camera.position,this.camera.target,h)}else m=vec3.create([0,1,0]),p=vec3.create([1,0,0]),vec3.set([0,0,1],h);var g=mat4.create();mat4.create();vec3.normalize(h);mat4.identity(g);mat4.rotate(g,b,m);mat4.rotate(g,d,p);mat4.multiplyVec3(g,h);vec3.normalize(h);null===e&&(e=vec3.length(vec3.subtract(this.camera.position,this.camera.target,
vec3.create())));vec3.scale(h,e);vec3.add(h,f);this.camera.position=h;switch(this.camControl.getType()){case stage.emersya.viewer.SCENE_CONTROL.DOUBLEORBIT:this.camControl=new stage.emersya.viewer.modules.sceneControls.doubleOrbitControl({camera:this.camera,viewport:{width:this.renderer.realSize[0],height:this.renderer.realSize[1]},minZoom:1/this.settings.maxZoomRatio*this.initialZoom,maxZoom:1/this.settings.minZoomRatio*this.initialZoom,initialZoom:this.initialZoom});break;case stage.emersya.viewer.SCENE_CONTROL.TRACKBALL:this.camControl=
new stage.emersya.viewer.modules.sceneControls.trackBallControl({camera:this.camera,viewport:{width:this.renderer.realSize[0],height:this.renderer.realSize[1]},minZoom:1/this.settings.maxZoomRatio*this.initialZoom,maxZoom:1/this.settings.minZoomRatio*this.initialZoom,initialZoom:this.initialZoom});break;case stage.emersya.viewer.SCENE_CONTROL.FREEFLY:this.camControl=new stage.emersya.viewer.modules.sceneControls.freeFlyControl({camera:this.camera,viewport:{width:this.renderer.realSize[0],height:this.renderer.realSize[1]},
minZoom:1/this.settings.maxZoomRatio*this.initialZoom,maxZoom:1/this.settings.minZoomRatio*this.initialZoom,initialZoom:this.initialZoom});break;case stage.emersya.viewer.SCENE_CONTROL.PLANARFREEFLY:this.camControl=new stage.emersya.viewer.modules.sceneControls.planarFreeFlyControl({camera:this.camera,viewport:{width:this.renderer.realSize[0],height:this.renderer.realSize[1]}})}return stage.createResult(null)},ea=function(b,d){if(this.animating&&this.animationUnstoppable)return!1;var e=vec3.create(this.initCameraPosition),
f=vec3.create(this.initCameraTarget);vec3.subtract(e,f);e=vec3.length(e);var h=vec3.create(b);d=vec3.create(d);vec3.normalize(h);vec3.scale(h,e);vec3.add(h,f);this.camControl.getType()===stage.emersya.viewer.SCENE_CONTROL.TRACKBALL&&(vec3.length(vec3.subtract(b,[1,1,1],vec3.create()))||(d=[-.40824830532073975,.8164966106414795,-.40824830532073975]));this.apiCore.exec(this.callerName,"startAnimatingPath",[{position:h,target:f,up:d,t:500}],!1,!0,null);return!0},oa=function(b){this.camera.fov=b;this.camControl.updatePixelRatio();
this.scene&&(this.scene.forceCameraUpdate=!0)},ba=function(b){this.settings.adaptativeFov=b;this.camera.adaptativeFov=b;this.scene&&(this.scene.forceCameraUpdate=!0)},ka=function(b,d,e){this.settings.camera.dynamicClippingPlanes=b;this.settings.camera.planes.near=d;this.settings.camera.planes.far=e;this.camera.dynamicClippingPlanes=b;this.camera.planes.near=d;this.camera.planes.far=e;this.scene&&(this.scene.forceCameraUpdate=!0)},Z=function(b,d){this.settings.camera.screenOffset.x=b;this.settings.camera.screenOffset.y=
d;this.camera.screenOffset.x=b;this.camera.screenOffset.y=d;this.scene&&(this.scene.forceCameraUpdate=!0)},da=function(b){this.settings.moveOnClick=b},X=function(b){this.settings.realTimeAPI=void 0!==b?b:!this.settings.realTimeAPI},Ha=function(b,d){this.mouseTrackingMode=void 0!==b?b:!this.mouseTrackingMode;this.mouseTrackingForced=!!d},Ga=function(b){var d=this.cameraLocked;this.cameraLocked=void 0!==b?b:!this.cameraLocked;d!=this.cameraLocked&&Oa.call(this)},Fa=function(b){var d=this.cameraLockedForDrag;
this.cameraLockedForDrag=void 0!==b?b:!this.cameraLockedForDrag;d!=this.cameraLockedForDrag&&Oa.call(this)},xa=function(b){if(null===b||0===b||1===b||2===b)this.dragMouseButton=b},Ia=function(b){this.productNodesDragEnabled=void 0!==b?b:!this.productNodesDragEnabled},qa=function(b){this.productNodesDragMode=b},Va=function(b,d,e){b=[{position:vec3.create(this.initCameraPosition),target:vec3.create(this.initCameraTarget),up:vec3.create(this.initCameraUp),fov:this.initCameraFov,t:void 0!==b?b:0}];this.apiCore.exec(this.callerName,
"startAnimatingPath",b,!1,d,e)},va=function(){var b={position:vec3.create(this.camera.position),target:vec3.create(this.camera.target),up:vec3.create(this.camera.up),controlMode:this.camControl.getType(),fov:this.camera.fov,mode:stage.emersya.viewer.PROJECTION_MODES[this.perspective?"PERSPECTIVE":"ORTHOGRAPHIC"],cameraControl:{type:this.camControl.getType(),settings:{targetRange:this.camControl.settings.targetRange,zoomScalesRotation:this.camControl.settings.zoomScalesRotation,moveOnMaxZoom:this.camControl.settings.moveOnMaxZoom,
minDistanceRatio:this.camControl.settings.minDistanceRatio,xRotationMin:this.camControl.settings.xRotationMin,xRotationMax:this.camControl.settings.xRotationMax,yRotationMin:this.camControl.settings.yRotationMin,yRotationMax:this.camControl.settings.yRotationMax,targetAxes:this.camControl.settings.targetAxes}},screenOffset:{x:this.camera.screenOffset.x,y:this.camera.screenOffset.y},zoomProportion:this.camControl.getCurrentZoomRatio()};this.apiCore.exec(this.callerName,"onCameraGet",b);return b},la=
function(){return{position:vec3.create(this.initCameraPosition),target:vec3.create(this.initCameraTarget),up:vec3.create(this.initCameraUp),upReal:vec3.create(this.initCameraUp)}},fa=function(){return this.camControl.getCurrentZoomRatio()},P=function(b){this.mouseMode=b},Ba=function(){return this.animationSpeed},Ka=function(b){this.animationSpeed=Math.max(Math.min(b,1E3),0)},wa=function(b){this.settings.useFxLevels=void 0===b?!this.settings.useFxLevels:b},Ja=function(b){var d=this.apiCore.exec(this.callerName,
"rdr.getCurrentScene"),e=[];if(d){d=d.root.boundingBox;d=[d.maxX-d.minX,d.maxY-d.minY,d.maxZ-d.minZ];for(var f=0,h=0,m=0,p=0;p<b.length;p++)Math.abs(b[p])>f&&(f=Math.abs(b[p]),h=p);for(p=0;p<d.length;p++)p!=h&&(m=Math.abs(d[p]),e.push(m))}e.sort(function(b,d){return d-b});return e[0]},La=function(b,d,e,f,h,m,p,g,n,k,v){g=Math.abs(g-h/2);n=Math.abs(n-h/2);k=Math.abs(k-m/2);v=Math.abs(v-m/2);vec3.normalize(e);var l=.5*(!this.camera.adaptativeFov&&m>h?h/m:1)*this.camera.fov*Math.PI/180,r=vec3.subtract(p.center,
d,[0,0,0]);l=(0<vec3.dot(vec3.normalize(r,[0,0,0]),e)?vec3.length(r):0)+p.radius/Math.tan(l);var q=vec3.create(d);l=vec3.scale(e,l);vec3.add(q,l);n=Math.max(g,n);v=Math.max(k,v);g=Math.round(h/2-n);n=Math.round(h/2+n);k=Math.round(m/2-v);v=Math.round(m/2+v);var t=[],B,A,w,V,O,E,I,u;if("pixel"==b)l=stage.setContext(function(){var b=this.apiCore.exec(this.callerName,"rdr.getSceneScreenPosition",{position:q,target:d,up:f},h,m);t[0]={position:b.minScreenXPoint};t[1]={position:b.minScreenYPoint};t[2]=
{position:b.maxScreenXPoint};t[3]={position:b.maxScreenYPoint};B=b.minScreen[0];O=b.minScreen[1];w=b.maxScreen[0];I=b.maxScreen[1];A=0;E=1;V=2;u=3},this);else{for(r=0;r<p.vecs.length;++r)t[r]={position:vec3.create(p.vecs[r])};l=stage.setContext(function(){for(var b=0;b<p.vecs.length;++b)t[b].screenPos=this.apiCore.exec(this.callerName,"rdr.getScreenPosition",p.vecs[b],{position:q,target:d,up:f},h,m);B=h;V=w=A=0;O=m;for(b=u=I=E=0;b<t.length;b++)t[b].screenPos.x>w&&(w=t[b].screenPos.x,V=b),t[b].screenPos.y>
I&&(I=t[b].screenPos.y,u=b),t[b].screenPos.x<B&&(B=t[b].screenPos.x,A=b),t[b].screenPos.y<O&&(O=t[b].screenPos.y,E=b)},this)}l();r=null;r=[h/2,m/2];var P=B,F=w;var N=O;var W=I;Math.abs(r[0]-B)<Math.abs(r[0]-w)?P=r[0]-Math.abs(r[0]-w):F=r[0]+Math.abs(r[0]-B);Math.abs(r[1]-O)<Math.abs(r[1]-I)?N=r[1]-Math.abs(r[1]-I):W=r[1]+Math.abs(r[1]-O);if((F-P)/(W-N)<(n-g)/(v-k))if(Math.abs(O-k)<Math.abs(I-v)){var D=k;r=t[E].position;N=1}else D=v,r=t[u].position,N=2;else if(Math.abs(B-g)<Math.abs(w-n)){var ca=g;
r=t[A].position;N=3}else ca=n,r=t[V].position,N=4;if(null===r)return null;P=ma.call(this,q,d,f,r,N,ca,D,h,m);vec3.add(d,vec3.scale(vec3.normalize(e),P),q);l();for(r=0;20>=++r&&(B<g||w>n||O<k||I>v);){W=N=0;var ja=F=P=-1,J=ja=-1;O<k&&W<k-O&&(W=k-O,F=E,D=k,J=1);I>v&&W<I-v&&(W=I-v,F=u,D=v,J=2);B<g&&N<g-B&&(N=g-B,P=A,ca=g,ja=3);w>n&&N<w-n&&(N=w-n,P=V,ca=n,ja=4);0>P?(N=J,ja=F):0>F?(N=ja,ja=P):N>W?(N=ja,ja=P):(N=J,ja=F);if(!t[ja].position)return null;P=ma.call(this,q,d,f,t[ja].position,N,ca,D,h,m);vec3.add(d,
vec3.scale(vec3.normalize(e),P),q);l()}if("bbox"==b&&(20<r||B<g||w>n||O<k||I>v))for(b=!1,r=0;8>r;++r){for(ca=1;5>ca;++ca)if(P=ma.call(this,q,d,f,p.vecs[r],ca,3==ca?g:n,1==ca?k:v,h,m),vec3.add(d,vec3.scale(vec3.normalize(e),P),q),l(),g<=B&&w<=n&&k<=O&&I<=v&&(g==B||w==n||k==O||I==v)){b=!0;break}if(b)break}return{position:[q[0],q[1],q[2]],target:[d[0],d[1],d[2]],up:[f[0],f[1],f[2]]}},ra=function(b,d,e){if(!this.scene||!this.scene.viewPoints)return null;for(var f=null,h="string"===typeof b?"name":"id",
m=0;m<this.scene.viewPoints.length;m++)if(this.scene.viewPoints[m][h]==b){f=this.scene.viewPoints[m];break}if(!f)return null;var p=[f.point_of_view.camera_position_x,f.point_of_view.camera_position_y,f.point_of_view.camera_position_z];b=[f.point_of_view.camera_up_x,f.point_of_view.camera_up_y,f.point_of_view.camera_up_z];var g=[f.point_of_view.camera_target_x,f.point_of_view.camera_target_y,f.point_of_view.camera_target_z];if(f.automated_position){h=!stage.emersya.appManager||this.scene.hasSomePolylistTags?
this.scene.getRealBoundingBox(f.tagsSet):this.scene.getRealBoundingBox();m=f.modelReferenceBoundingBox||this.scene.viewPointsModelReferenceBoundingBox;if(!m)return console.warn("The bounding box is empty"),null;m=[(h.maxX+h.minX)/2+(g[0]-(m.maxX+m.minX)/2)/(m.maxX-m.minX)*(h.maxX-h.minX),(h.maxY+h.minY)/2+(g[1]-(m.maxY+m.minY)/2)/(m.maxY-m.minY)*(h.maxY-h.minY),(h.maxZ+h.minZ)/2+(g[2]-(m.maxZ+m.minZ)/2)/(m.maxZ-m.minZ)*(h.maxZ-h.minZ)];switch(f.computeMode){case "bbox":case "pixel":var n=f.computeMode;
break;default:n="bbox"}g=vec3.normalize(vec3.subtract(vec3.create(p),g));var k=d*f.points_minX/f.viewerSize[0],v=d*f.points_maxX/f.viewerSize[0],l=e*f.points_minY/f.viewerSize[1],r=e*f.points_maxY/f.viewerSize[1];p=[];this.scene.isSimpleModel||stage.emersya.appManager&&!this.scene.hasSomePolylistTags||!f.tagsSet.size||(p=this.scene.hidePolylistsInstancesWithoutTags(f.tagsSet));if(p.length==this.scene.polylistInstances.length)return this.scene.showPolylistsInstances(p),null;d=La.call(this,n,m,g,b,
d,e,h,k,v,l,r);this.scene.showPolylistsInstances(p);return d}return{position:[p[0],p[1],p[2]],target:[g[0],g[1],g[2]],up:[b[0],b[1],b[2]]}},Sa=function(b,d,e){if(!this.scene||!this.scene.viewPoints)return[];for(var f=[],h=[],m=0;m<b.length;++m)try{new RegExp(b[m]),h.push(b[m])}catch(ac){console.warn(b[m]+" is not a valid regular expression, it will be ignored.")}for(b=0;b<this.scene.viewPoints.length;b++)for(viewpoint=this.scene.viewPoints[b],m=0;m<h.length;++m)if(viewpoint.name.match(h[m])){var p=
ra.call(this,viewpoint.id,d,e);p&&(p.viewpoint=viewpoint.name,p.viewpointRegexp=h[m],f.push(p));break}return f},Ya=function(b,d,f,h,m,p){var g=this,n=this.apiCore.exec(this.callerName,"rdr.getCanvasSize");(b=ra.call(this,b,n[0],n[1]))?e.call(this,[stage.extend(b,{t:d?d:void 0})],f,h,function(){m&&R.call(g);p&&p()}):p&&p()},Ra=function(b,d,f,h,m,p,g,n){var k=this;if(!this.scene||.45<=b)n&&n();else{var v=this.apiCore.exec(this.callerName,"rdr.getCanvasSize"),l=v[0],r=v[1];v=this.scene.filterPolylistsInstances();
var q=v.arExcluded;q.forEach(function(b){return b.hidden=!0});p&&p.length&&v.others.forEach(function(b){-1===p.indexOf(b.node.localId)&&(b.hidden=!0)});var t=this.scene.getRealBoundingBox(),B=[(t.maxX+t.minX)/2,(t.maxY+t.minY)/2,(t.maxZ+t.minZ)/2];d&&(B[0]=d[0]*this.initCameraTarget[0]+(1-d[0])*B[0],B[1]=d[1]*this.initCameraTarget[1]+(1-d[1])*B[1],B[2]=d[2]*this.initCameraTarget[2]+(1-d[2])*B[2]);if(null===b||void 0===b)b=.1;d=l*b;var A=l*(1-b),w=r*b;b=r*(1-b);var O=vec3.normalize(vec3.subtract(vec3.create(this.camera.position),
this.camera.target)),V=vec3.create(this.camera.up);if(l=La.call(this,"pixel",B,O,V,l,r,t,d,A,w,b))q.forEach(function(b){b.hidden=!1}),p&&p.length&&v.others.forEach(function(b){-1===p.indexOf(b.node.localId)&&(b.hidden=!1)}),Oa.call(this),e.call(this,[{position:l.position,target:l.target,up:l.up,t:f?f:void 0}],h,m,function(){g&&R.call(k);n&&n()})}},ma=function(b,d,e,f,h,m,p,g,n){var k=vec3.normalize(vec3.subtract(d,b,vec3.create())),v=f[0],l=f[1];f=f[2];var r=k[0],q=k[1];k=k[2];var t=d[0],B=d[1],A=
d[2],w=e[0],O=e[1],V=e[2],E=mat4.create();if(this.perspective){if(this.camera.adaptativeFov&&g<n){b=1E-4*Math.tan(this.camera.fov*Math.PI*.5/180);d=-b;e=d*n/g;var I=b*n/g}else I=1E-4*Math.tan(this.camera.fov*Math.PI*.5/180),e=-I,d=e*g/n,b=I*g/n;b+=d*this.camera.screenOffset.x;d*=1+this.camera.screenOffset.x;I+=e*this.camera.screenOffset.y;e*=1+this.camera.screenOffset.y;mat4.frustum(d,b,e,I,1E-4,1E6,E)}else I=Math.tan(this.camera.fov*Math.PI*.5/180)*vec3.length(vec3.subtract(b,d,vec3.create())),this.camera.adaptativeFov&&
g<n?(d=-I,b=I,e=-I*n/g,I=I*n/g):(d=-I*g/n,b=I*g/n,e=-I),b+=d*this.camera.screenOffset.x,d*=1+this.camera.screenOffset.x,I+=e*this.camera.screenOffset.y,e*=1+this.camera.screenOffset.y,mat4.ortho(d,b,e,I,1E-4,1E6,E);var u=E[0],P=E[1];b=E[3];var N=E[4],F=E[5];d=E[7];var W=E[8],D=E[9];e=E[11];var ca=E[12],ja=E[13];E=E[15];I=k*O-q*V;V=r*V-k*w;w=q*w-r*O;var J=Math.sqrt(I*I+V*V+w*w);J?(J=1/J,I*=J,V*=J,w*=J):w=V=I=0;O=q*w-k*V;var na=k*I-r*w,sa=r*V-q*I;(J=Math.sqrt(O*O+na*na+sa*sa))?(J=1/J,O*=J,na*=J,sa*=
J):sa=na=O=0;2>=h?(h=-(P*(I*r+V*q+w*k)+F*(O*r+na*q+sa*k)+D*(r*r+q*q+k*k)),u=(P*I+F*O+D*r)*v+(P*V+F*na+D*q)*l+(P*w+F*sa+D*k)*f+-(1*(P*(I*t+V*B+w*A)+F*(O*t+na*B+sa*A)+D*(r*t+q*B+k*A)+ja)),m=p/n*2-1):(h=-(u*(I*r+V*q+w*k)+N*(O*r+na*q+sa*k)+W*(r*r+q*q+k*k)),u=(u*I+N*O+W*r)*v+(u*V+N*na+W*q)*l+(u*w+N*sa+W*k)*f+-(1*(u*(I*t+V*B+w*A)+N*(O*t+na*B+sa*A)+W*(r*t+q*B+k*A)+ca)),m=m/g*2-1);return Math.abs((m*((b*I+d*O+e*r)*v+(b*V+d*na+e*q)*l+(b*w+d*sa+e*k)*f+-(1*(b*(I*t+V*B+w*A)+d*(O*t+na*B+sa*A)+e*(r*t+q*B+k*A)+
E)))-u)/(h-m*-(b*(I*r+V*q+w*k)+d*(O*r+na*q+sa*k)+e*(r*r+q*q+k*k))))},bb=function(){this.animationFrame&&(window.cancelAnimationFrame(this.animationFrame),this.animationFrame=null);this.renderingStartTime=this.lastUpdate=Date.now()-1;this.confirmationSent=!1;this.lastJsRenderTime=this.lastJsFrameTime=0;xb.call(this);this.deltaAngle=this.wheelDelta=this.deltaY=this.deltaX=this.deltaAngleSpeed=this.deltaYSpeed=this.deltaXSpeed=this.deltaAngleApplied=this.deltaYApplied=this.deltaXApplied=0;this.framerateFrames=
3;this.framerateStartTime=0;this.ignoreNextFrames=2;this.stopped=!1;if(this.scene&&this.scene.viewPoints&&!1===this.settings.camera.staticViewpoint)for(var b in this.scene.viewPoints)if(this.scene.viewPoints[b].is_default){var d=this.apiCore.exec(this.callerName,"rdr.getCanvasSize");if(b=ra.call(this,this.scene.viewPoints[b].id,d[0],d[1]))this.camera=stage.extend(this.camera,b),db.call(this);break}hb.call(this,!1)},gb=function(){this.animationFrame&&(window.cancelAnimationFrame(this.animationFrame),
this.animationFrame=null);this.stopped=!0},ib=function(){this.noForceRender||(hb.call(this,!0),this.scene&&this.scene.update())},hb=function(b){if(!this.destroyed&&(this.stopped||b&&this.animationFrame||(this.renderFunction||(this.renderFunction=stage.setContext(hb,this,!1)),this.animationFrame=requestAnimationFrame(this.renderFunction)),!this.fallbackDisplayed)){this.now=Date.now();this.deltaT=this.now-this.lastUpdate;!this.framerateStartTime&&0>=--this.framerateFrames&&(this.framerateStartTime=
this.now,this.apiCore.exec(this.callerName,"renderingWorking"));null===this.nextDeltaT&&this.ignoreNextFrames&&(this.deltaT=0,--this.ignoreNextFrames,this.autoRotateAccStart&&(this.autoRotateAccStart=this.now));this.apiCore.exec(this.callerName,"frameStart",this.deltaT);b=this.deltaT;null!==this.nextDeltaT?(b=this.animationDeltaT=this.nextDeltaT,this.nextDeltaT=null):this.animationDeltaT=this.animationSpeed*this.deltaT;var d=this.renderer.checkWebGLErrors();if(this.checkForWebGLErrors&&stage.testResult(d))this.apiCore.exec(this.callerName,
"renderingError",d.errors);else{if(this.settings.useFxLevels)if(this.ignoreNextFxLevelTime)this.ignoreNextFxLevelTime=!1;else if(this.settings.useFxSaveRestore||!this.stopFxLevelsComputing)if(this.fxDeltaTimes.length||(this.startingFxRecordingTime=this.now),this.fxDeltaTimes.push(this.deltaT),200<this.now-this.startingFxRecordingTime||10<=this.fxDeltaTimes.length){d=0;for(var e in this.fxDeltaTimes)d+=this.fxDeltaTimes[e];d=1E3*this.fxDeltaTimes.length/d;this.fxDeltaTimes=[];if(1>d)for(d=4,e=this.updateFxLevels.length-
1;0<=e&&(!this.updateFxLevels[e](!1,!0)||(this.ignoreNextFxLevelTime=!0,console.log("downgrade 1",this.fxLevelsNames[e],this.fxLevels[this.fxLevelsNames[e]]),!--d));--e);else if(5>d)for(d=3,e=this.updateFxLevels.length-1;0<=e&&(!this.updateFxLevels[e](!1,!0)||(this.ignoreNextFxLevelTime=!0,console.log("downgrade 2",this.fxLevelsNames[e],this.fxLevels[this.fxLevelsNames[e]]),!--d));--e);else if(10>d)for(d=2,e=this.updateFxLevels.length-1;0<=e&&(!this.updateFxLevels[e](!1,!0)||(this.ignoreNextFxLevelTime=
!0,console.log("downgrade 3",this.fxLevelsNames[e],this.fxLevels[this.fxLevelsNames[e]]),!--d));--e);else if(17>d)for(e=this.updateFxLevels.length-1;0<=e;--e){if(this.updateFxLevels[e](!1,!1)){this.ignoreNextFxLevelTime=!0;console.log("downgrade 4",this.fxLevelsNames[e],this.fxLevels[this.fxLevelsNames[e]]);break}}else if(45<d)for(e=0;e<this.updateFxLevels.length;++e)if(this.updateFxLevels[e](!0,!1)){this.ignoreNextFxLevelTime=!0;console.log("upgrade",this.fxLevelsNames[e],this.fxLevels[this.fxLevelsNames[e]]);
break}}if(this.animating)for(var f=this.animationDeltaT;f&&this.currentAnimation<this.animations.length;){if(e=this.animations[this.currentAnimation].getTimeUsed(f),f-=e,this.animations[this.currentAnimation].applyTime(e),d=this.animations[this.currentAnimation].computeAcceleration(),this.animations[this.currentAnimation].empty||(this.camControl.updateAnimation(d),this.apiCore.exec(this.callerName,"setFov",(this.animations[this.currentAnimation].fov-this.initialFov)*d+this.initialFov),this.apiCore.exec(this.callerName,
"setCameraScreenOffsets",(this.animations[this.currentAnimation].screenOffsetX-this.initialScreenOffsetX)*d+this.initialScreenOffsetX,(this.animations[this.currentAnimation].screenOffsetY-this.initialScreenOffsetY)*d+this.initialScreenOffsetY)),f)if(++this.currentAnimation<this.animations.length)this.initialFov=this.camera.fov,this.initialScreenOffsetX=this.camera.screenOffset.x,this.initialScreenOffsetY=this.camera.screenOffset.y,e=this.currentAnimation-1,this.animations[e].projectionMode&&this.apiCore.exec(this.callerName,
"changeCameraMode",this.animations[e].projectionMode),this.animations[e].renderingMode&&this.apiCore.exec(this.callerName,"changeRenderingMode",this.animations[e].renderingMode),d=this.animations[e].camControl,this.animations[this.currentAnimation].empty?(this.camControl.resetAnimation(),d&&this.apiCore.exec(this.callerName,"changeCameraControl",d.type,d.settings,!0,!0)):(this.animations[this.currentAnimation].camControl&&(e=d?d.type:this.camControl.getType(),d=this.animations[this.currentAnimation].camControl.type,
e==stage.emersya.viewer.SCENE_CONTROL.DOUBLEORBIT&&d==stage.emersya.viewer.SCENE_CONTROL.TRACKBALL&&this.apiCore.exec(this.callerName,"changeCameraControl",d,{},!0,!0)),this.camControl.setAnimation(this.animations[this.currentAnimation].position,this.animations[this.currentAnimation].target,this.animations[this.currentAnimation].up),this.apiCore.exec(this.callerName,"animationUpdate",this.camera));else if(e=this.currentAnimation-1,this.camControl.updateAnimation(1),this.apiCore.exec(this.callerName,
"setFov",this.animations[e].fov-this.initialFov+this.initialFov),this.apiCore.exec(this.callerName,"setCameraScreenOffsets",(this.animations[e].screenOffsetX-this.initialScreenOffsetX)*d+this.initialScreenOffsetX,(this.animations[e].screenOffsetY-this.initialScreenOffsetY)*d+this.initialScreenOffsetY),(d=this.animations[e].camControl)&&this.apiCore.exec(this.callerName,"changeCameraControl",d.type,d.settings,!0,!0),this.animations[e].projectionMode&&this.apiCore.exec(this.callerName,"changeCameraMode",
this.animations[e].projectionMode),this.animations[e].renderingMode&&this.apiCore.exec(this.callerName,"changeRenderingMode",this.animations[e].renderingMode),this.animationLooping)this.currentAnimation=0,this.apiCore.exec(this.callerName,"animationUpdate",this.camera);else{this.apiCore.exec(this.callerName,"animationEnd",this.camera);this.animationUnstoppable=!1;this.animationEndCallback&&(f=this.animationEndCallback,this.animationEndCallback=null,f());this.apiCore.exec(this.callerName,"stopAnimatingPath");
break}}else{if(this.useAcceleration)if(this.autoRotating)this.settings.autoRotateSpeed?(this.now-this.autoRotateAccStart<this.autoRotateAccTime?(this.autoRotateSpeed=(this.now-this.autoRotateAccStart)/this.autoRotateAccTime,this.autoRotateSpeed/=this.settings.autoRotateSpeed):this.autoRotateSpeed=1/this.settings.autoRotateSpeed,this.deltaXApplied=this.settings.clockwise?2*this.renderer.realSize[0]/3*-this.autoRotateSpeed*(this.deltaT/1E3):2*this.renderer.realSize[0]/3*this.autoRotateSpeed*(this.deltaT/
1E3),this.camControl.setMousePos(this.renderer.realSize[0]/2,this.renderer.realSize[1]/2)):this.autoRotateSpeed=0;else{eb.call(this);1===this.state&&(this.wheelDelta-=this.deltaY,this.deltaY=0);e=Math.abs(this.wheelDelta);360<=e?(this.wheelDeltaMaxSpeed=2*this.initialMaxZoomSpeed,540<=e&&(this.wheelDeltaMaxSpeed=3*this.initialMaxZoomSpeed,720<=e&&(this.wheelDeltaMaxSpeed=4*this.initialMaxZoomSpeed))):this.wheelDeltaMaxSpeed=this.initialMaxZoomSpeed;switch(this.state){case 0:this.camControl.getAvailableRotation()}e=
["deltaX","deltaY","wheelDelta","deltaAngle"];for(f in e)if(this[e[f]]){d=this[e[f]];if(Math.abs(this[e[f]])<this.decDuration){var h=Math.abs(this[e[f]])/this.decDuration;this[e[f]+"Speed"]=fb(h)*this[e[f]+"MaxSpeed"]}else this[e[f]+"Speed"]<this[e[f]+"MaxSpeed"]&&(h=(this.now-this.accStart)/this.accDuration,this[e[f]+"Speed"]=fb(1<h?1:h)*this[e[f]+"MaxSpeed"]);this[e[f]+"Speed"]>this[e[f]+"MaxSpeed"]?this[e[f]+"Speed"]=this[e[f]+"MaxSpeed"]:this[e[f]+"Speed"]<this.minSpeedLimit&&(this[e[f]+"Speed"]=
0);this[e[f]+"Applied"]=this[e[f]]/Math.abs(this[e[f]])*this[e[f]+"Speed"]*this.deltaT;0<d&&this[e[f]+"Applied"]>d||0>d&&this[e[f]+"Applied"]<d?(this[e[f]+"Speed"]=0,this[e[f]+"Applied"]=this[e[f]],this[e[f]]=0):this[e[f]]-=this[e[f]+"Applied"]}}else this.deltaXApplied=this.deltaX,this.deltaYApplied=this.deltaY,this.deltaAngleApplied=this.deltaAngle,this.wheelDeltaApplied=this.wheelDelta,1===this.state&&(this.wheelDeltaApplied-=this.deltaY),this.wheelDelta=this.deltaAngle=this.deltaY=this.deltaX=
0,eb.call(this);if(!this.cameraLocked&&!this.cameraLockedForDrag){this.interactionType=0;if(this.deltaXApplied||this.deltaYApplied)switch(this.state){case 0:this.interactionType|=this.camControl.rotate(this.deltaXApplied,this.deltaYApplied);break;case 2:this.interactionType|=this.camControl.translate(this.translatingX*this.deltaXApplied,this.translatingY*this.deltaYApplied);break;case -1:this.currentlyTransforming&&(this.settings.editionMode&stage.emersya.viewer.EDITION_MODES.MESHES||this.settings.editionMode&
stage.emersya.viewer.EDITION_MODES.LIGHT||this.settings.editionMode&stage.emersya.viewer.EDITION_MODES.MODULAR)&&(f=this.camControl.getTranslation(-this.deltaXApplied,-this.deltaYApplied),this.apiCore.exec(this.callerName,"rdr.applyTransformation",f,this.deltaXApplied,this.deltaYApplied))}this.wheelDeltaApplied&&(f=this.camControl.zoom(this.wheelDeltaApplied),f!=stage.emersya.viewer.INTERACTION_TYPE.NONE?this.interactionType|=f:this.wheelDeltaSpeed=this.wheelDelta=0);this.deltaAngleApplied&&(this.interactionType|=
this.camControl.rotateZ(this.deltaAngleApplied));this.interactionType|=this.camControl.move(this.deltaRightApplied-this.deltaLeftApplied,this.deltaUpApplied-this.deltaDownApplied,this.deltaForwardApplied-this.deltaBackwardApplied);this.camControl.updateCamera(this);this.deltaAngleApplied=this.wheelDeltaApplied=this.deltaYApplied=this.deltaXApplied=0}Ma.call(this)}this.recordingPerfs?(f=Date.now(),b=!this.renderer.render(this.camera,b),this.lastJsRenderTime=Date.now()-f):b=!this.renderer.render(this.camera,
b);if(this.mouseTrackingMode&&this.mouseTrackingForced||(this.cameraLocked||this.cameraLockedForDrag||this.draggingProductNodeInstance||this.fireDragStartOnNextMove||b)&&(this.settings.computeHighlight||this.mouseTrackingMode))e=this.apiCore.exec(this.callerName,"rdr.getCurrentScene"),f=void 0,e&&(f=ob.call(this)),this.mouseLeaved||this.interactionType!==stage.emersya.viewer.INTERACTION_TYPE.NONE||this.lastInteractionType!==stage.emersya.viewer.INTERACTION_TYPE.NONE?(-1!==this.lastHighlightedPolylist&&
this.apiCore.exec(this.callerName,"polylistHighlight",[]),this.lastHighlightedPolylist=-1,-1!==this.lastHighlightedMaterialTree&&this.apiCore.exec(this.callerName,"materialTreeHighlight",[]),this.lastHighlightedMaterialTree=-1,-1!==this.lastHighlightedMaterialTreesGroup&&this.apiCore.exec(this.callerName,"materialTreesGroupHighlight",[]),this.lastHighlightedMaterialTreesGroup=-1):(e&&void 0===f&&(f=this.apiCore.exec(this.callerName,"rdr.getUnderMousePolylist",this.mousePos)),f&&f[0]?(void 0!==this.lastHighlightedPolylist&&
f[0].polylistInstanceId!==this.lastHighlightedPolylist&&this.apiCore.exec(this.callerName,"polylistHighlight",f),void 0!==this.lastHighlightedMaterialTree&&f[0].materialTreeId!==this.lastHighlightedMaterialTree&&this.apiCore.exec(this.callerName,"materialTreeHighlight",f),(e=this.apiCore.exec(this.callerName,"getMaterialTreesGroupFromMaterialTree",f[0].materialTreeId))?void 0!==this.lastHighlightedMaterialTreesGroup&&e.id!==this.lastHighlightedMaterialTreesGroup&&this.apiCore.exec(this.callerName,
"materialTreesGroupHighlight",[e]):-1!==this.lastHighlightedMaterialTreesGroup&&this.apiCore.exec(this.callerName,"materialTreesGroupHighlight",[])):(-1!==this.lastHighlightedPolylist&&this.apiCore.exec(this.callerName,"polylistHighlight",[]),-1!==this.lastHighlightedMaterialTree&&this.apiCore.exec(this.callerName,"materialTreeHighlight",[]),-1!==this.lastHighlightedMaterialTreesGroup&&this.apiCore.exec(this.callerName,"materialTreesGroupHighlight",[])),f?(this.lastHighlightedPolylist=f[0].polylistInstanceId,
this.lastHighlightedMaterialTree=f[0].materialTreeId,this.lastHighlightedMaterialTreesGroup=(e=this.apiCore.exec(this.callerName,"getMaterialTreesGroupFromMaterialTree",f[0].materialTreeId))?e.id:-1):this.lastHighlightedMaterialTreesGroup=this.lastHighlightedMaterialTree=this.lastHighlightedPolylist=-1);if(this.apiCore.exec(this.callerName,"rdr.getCurrentScene")){if(this.framerateStartTime&&1E4<this.now-this.framerateStartTime){if(this.confirmationSent||(this.apiCore.exec(this.callerName,"3DRenderingConfirm",
1E3*this.deltaTCount/this.deltaTSum),this.confirmationSent=!0),!this.ignoreNextFxLevelTime)if(b)this.firstNoRender&&(this.settings.useFxSaveRestore?this.savedFxLevels=stage.extend(!0,{},this.fxLevels):this.stopFxLevelsComputing=!0,this.firstNoRender=!1);else{if(!this.firstNoRender)if(this.settings.useFxSaveRestore){this.fxLevels=stage.extend(!0,{},this.savedFxLevels);for(b=0;b<this.setFxLevels.length;++b)this.setFxLevels[b](this.fxLevels[this.fxLevelsNames[b]],!0);this.renderer.setSize(this.renderer.realSize[0],
this.renderer.realSize[1]);this.fxDeltaTimes=[];this.ignoreNextFxLevelTime=!0}else this.stopFxLevelsComputing=!1;this.firstNoRender=!0}}else this.framerateStartTime&&this.deltaT&&(this.deltaTSum+=this.deltaT,++this.deltaTCount);this.apiCore.exec(this.callerName,"updateGlobalUVTransformDirtness")}this.apiCore.exec(this.callerName,"deltaTUpdate",this.animationDeltaT);this.lastUpdate=this.now;this.lastJsFrameTime=Date.now()-this.now}}},fb=function(b){return Math.sin(Math.PI*b/2)},Aa=function(){this.decDuration=
this.renderer&&this.renderer.currentScaling!==this.renderer.maxScaling?this.anyMouseButtonPressed?this.mousePressedDecDurationWithHdOnStop:this.decDurationWithHdOnStop:this.anyMouseButtonPressed?this.mousePressedDecDurationWithoutHdOnStop:this.decDurationWithoutHdOnStop},eb=function(){var b="deltaLeft deltaRight deltaUp deltaDown deltaForward deltaBackward".split(" "),d="left right up down forward backward".split(" "),e=this.moveSpeed;this.keys.shift&&(e/=this.shiftDivisor);this.keys.control&&(e*=
this.controlMultiplicator);if(this.useAcceleration)for(h in b){if(this.keys[d[h]]&&(this[b[h]]+=this.deltaT*e),this[b[h]]){if(this[b[h]]<300*e){var f=this[b[h]]/(300*e);this[b[h]+"Speed"]=fb(f)*e}else this[b[h]+"Speed"]<e&&(f=(this.now-this.keyboardAccStart)/(300*e),this[b[h]+"Speed"]=fb(1<f?1:f)*e);if(isNaN(this[b[h]+"Speed"])||this[b[h]+"Speed"]<this.speedThreshold)this[b[h]+"Speed"]=0;this[b[h]+"Applied"]=this[b[h]+"Speed"]*this.deltaT;this[b[h]]-=this[b[h]+"Applied"]}}else for(var h in b)this.keys[d[h]]&&
(this[b[h]]+=this.deltaT*e),this[b[h]+"Applied"]=this[b[h]],this[b[h]]=0},ab=function(b){var d="";this.interactionType===stage.emersya.viewer.INTERACTION_TYPE.NONE?d="n":(this.interactionType&stage.emersya.viewer.INTERACTION_TYPE.TRANSLATION&&(d+="t"),this.interactionType&stage.emersya.viewer.INTERACTION_TYPE.ROTATION&&(d+="r"),this.interactionType&stage.emersya.viewer.INTERACTION_TYPE.ZROTATION&&(d+="r"),this.interactionType&stage.emersya.viewer.INTERACTION_TYPE.ZOOM_IN&&(d+="i"),this.interactionType&
stage.emersya.viewer.INTERACTION_TYPE.ZOOM_OUT&&(d+="o"));this.apiCore.exec(this.callerName,b,this.camera,d)},Ma=function(){if(this.recordingPerfs&&!(2E4>this.now-this.currentRecordStart)){if(1E3<=++this.currentRecordSize||14E4<this.now-this.currentRecordStart)if(this.configurations.length){var b=this.configurations.shift();this.currentConfigName="";for(var d=1;1024>d;d*=2)if(b&d)this.perfActivateFunctions[d](),this.currentConfigName+="_"+this.perfBitMaskNames[d];else this.perfDeactivateFunctions[d]();
this.currentConfigName=this.currentConfigName.slice(1,this.currentConfigName.length);this.perfStats[this.currentConfigName]={frameTimes:[],jsFrameTimes:[],jsRenderTimes:[]};this.currentRecordSize=0;this.currentRecordStart=this.now}else console.log(this.perfStats),this.recordingPerfs=!1,this.apiCore.exec(this.callerName,"perfStatRecord",this.perfStats);this.recordingPerfs&&(this.perfStats[this.currentConfigName].frameTimes.push(this.deltaT),this.perfStats[this.currentConfigName].jsFrameTimes.push(this.lastJsFrameTime),
this.perfStats[this.currentConfigName].jsRenderTimes.push(this.lastJsRenderTime))}if(this.interactionType===stage.emersya.viewer.INTERACTION_TYPE.NONE)this.lastInteractionType!==stage.emersya.viewer.INTERACTION_TYPE.NONE&&(ab.call(this,"endCameraInteraction"),this.apiCore.exec(this.callerName,"endExternalCameraInteraction",va.call(this),this.interactionType));else{if(this.lastInteractionType===stage.emersya.viewer.INTERACTION_TYPE.NONE)ab.call(this,"startCameraInteraction"),this.apiCore.exec(this.callerName,
"startExternalCameraInteraction",va.call(this),this.interactionType),this.lastEventTriggered=this.now;else if(this.lastInteractionType!==this.interactionType||this.now-this.lastEventTriggered>=this.statPeriod)ab.call(this,"updateCameraInteraction"),this.lastEventTriggered=this.now,this.settings.realTimeAPI||this.lastInteractionType===this.interactionType||this.apiCore.exec(this.callerName,"updateExternalCameraInteraction",va.call(this),this.interactionType);this.settings.realTimeAPI&&this.apiCore.exec(this.callerName,
"updateExternalCameraInteraction",va.call(this),this.interactionType)}this.lastInteractionType=this.interactionType},Ta=function(b){this.empty=b.empty;this.emtpy||(this.position=vec3.create(b.position),this.target=vec3.create(b.target),this.up=vec3.create(b.up),this.fov=b.fov,this.timer=void 0!==b.t?b.t:0,this.sample=this.progression=0,this.camControl=void 0!==b.camControl?b.camControl:null,this.projectionMode=void 0!==b.projectionMode?b.projectionMode:null,this.renderingMode=void 0!==b.renderingMode?
b.renderingMode:null,this.accelerationType=void 0!==b.accelerationType?b.accelerationType:stage.emersya.viewer.ANIMATIONS_ACCELERATION_MODES.POLYNOMIAL5,this.reversed=void 0!==b.reversed?b.reversed:!1,this.accelerationExponent=void 0!==b.accelerationExponent?b.accelerationExponent:1,this.screenOffsetX=void 0!==b.screenOffset?b.screenOffset.x:0,this.screenOffsetY=void 0!==b.screenOffset?b.screenOffset.y:0)};Ta.prototype.applyTime=function(b){this.progression+=b;this.sample=this.timer?this.progression/
this.timer:1};Ta.prototype.getTimeUsed=function(b){return this.progression>=this.timer?0:this.progression+b>this.timer?this.timer-this.progression:b};Ta.prototype.computeAcceleration=function(){if(this.reversed){for(var b=1-this.sample,d=0;d<this.accelerationExponent;++d)b=stage.emersya.viewer.modules.renderer.animations.accelerationFunction(this.accelerationType,b);return this.accelerationType===stage.emersya.viewer.ANIMATIONS_ACCELERATION_MODES.NONE&&1==this.sample?1:1-b}b=this.sample;for(d=0;d<
this.accelerationExponent;++d)b=stage.emersya.viewer.modules.renderer.animations.accelerationFunction(this.accelerationType,b);return b};var db=function(){this.initialZoom=vec3.length(vec3.subtract(this.camera.position,this.camera.target,vec3.create()));this.initCameraPosition=vec3.create(this.camera.position);this.initCameraTarget=vec3.create(this.camera.target);this.initCameraUp=vec3.create(this.camera.up);this.initCameraFov=this.camera.fov;this.camera.adaptativeFov=this.settings.adaptativeFov;
var b={};this.translatingX=this.settings.translateX?1:0;this.translatingY=this.settings.translateY?1:0;switch(this.camControl?this.camControl.getType():this.settings.startingControlMode){case stage.emersya.viewer.SCENE_CONTROL.DOUBLEORBIT:stage.extend(b,this.settings.doubleOrbitSettings,{camera:this.camera,viewport:{width:this.renderer.realSize[0],height:this.renderer.realSize[1]},minZoom:1/this.settings.maxZoomRatio*this.initialZoom,maxZoom:1/this.settings.minZoomRatio*this.initialZoom,initialZoom:this.initialZoom});
this.camControl=new stage.emersya.viewer.modules.sceneControls.doubleOrbitControl(b);break;case stage.emersya.viewer.SCENE_CONTROL.FREEFLY:stage.extend(b,this.settings.freeFlySettings,{camera:this.camera,viewport:{width:this.renderer.realSize[0],height:this.renderer.realSize[1]}});this.camControl=new stage.emersya.viewer.modules.sceneControls.freeFlyControl(b);break;case stage.emersya.viewer.SCENE_CONTROL.PLANARFREEFLY:stage.extend(b,this.settings.freeFlySettings,{camera:this.camera,viewport:{width:this.renderer.realSize[0],
height:this.renderer.realSize[1]}});this.camControl=new stage.emersya.viewer.modules.sceneControls.planarFreeFlyControl(b);break;case stage.emersya.viewer.SCENE_CONTROL.TRACKBALL:this.camera.upReal=vec3.create(this.camera.up),stage.extend(b,this.settings.trackBallSettings,{camera:this.camera,viewport:{width:this.renderer.realSize[0],height:this.renderer.realSize[1]},minZoom:1/this.settings.maxZoomRatio*this.initialZoom,maxZoom:1/this.settings.minZoomRatio*this.initialZoom,initialZoom:this.initialZoom}),
this.camControl=new stage.emersya.viewer.modules.sceneControls.trackBallControl(b),this.camControl.setMousePos(this.renderer.realSize[0]/2,this.renderer.realSize[1]/2)}this.perspective=this.settings.startingProjectionMode!=stage.emersya.viewer.PROJECTION_MODES.ORTHOGRAPHIC},Oa=function(){this.deltaBackwardSpeed=this.deltaBackwardApplied=this.deltaBackward=this.deltaForwardSpeed=this.deltaForwardApplied=this.deltaForward=this.deltaDownSpeed=this.deltaDownApplied=this.deltaDown=this.deltaUpSpeed=this.deltaUpApplied=
this.deltaUp=this.deltaRightSpeed=this.deltaRightApplied=this.deltaRight=this.deltaLeftSpeed=this.deltaLeftApplied=this.deltaLeft=this.wheelDeltaSpeed=this.deltaAngleSpeed=this.deltaYSpeed=this.deltaXSpeed=this.wheelDeltaApplied=this.deltaAngleApplied=this.deltaYApplied=this.deltaXApplied=this.wheelDelta=this.deltaAngle=this.deltaY=this.deltaX=0;this.interactionType=stage.emersya.viewer.INTERACTION_TYPE.NONE;Ma.call(this)},Qa=function(b,d){this.mousePos.x=b;this.mousePos.y=d;this.drawingSelectionSquare&&
this.apiCore.exec(this.callerName,"rdr.updateSelectionSquare",{x:b,y:d});this.mouseLeaved=!1},N=function(){this.mouseLeaved=!0},za=function(b,d){this.autoRotating&&this.apiCore.exec(this.callerName,"stopAutoRotate");this.animating&&!this.animationUnstoppable&&this.apiCore.exec(this.callerName,"stopAnimatingPath");this.animating||(this.deltaX&&this.deltaY||(this.accStart=Date.now()),this.deltaX+=b,this.deltaY+=d)},ca=function(b,d,e,f){this.anyMouseButtonPressed=!0;this.mouseButtonsPressed=f;ob.call(this);
this.autoRotating&&this.apiCore.exec(this.callerName,"stopAutoRotate");this.animating&&!this.animationUnstoppable&&this.apiCore.exec(this.callerName,"stopAnimatingPath");if(!this.animating){if(this.settings.editionMode&stage.emersya.viewer.EDITION_MODES.MESHES||this.settings.editionMode&stage.emersya.viewer.EDITION_MODES.LIGHT||this.settings.editionMode&stage.emersya.viewer.EDITION_MODES.MODULAR)this.keys.control&&0===b?(this.apiCore.exec(this.callerName,"rdr.startSelectionSquare",{x:d,y:e}),this.drawingSelectionSquare=
!0):this.currentlyTransforming=this.apiCore.exec(this.callerName,"rdr.startTransformation",{x:d,y:e});if(this.currentlyTransforming||this.drawingSelectionSquare)this.state=-1;else{switch(this.mouseMode){case stage.emersya.viewer.MOUSE_CONTROL_MODES.ROTATE:switch(b){case 0:var h=0;break;case 1:h=1;break;case 2:h=2}break;case stage.emersya.viewer.MOUSE_CONTROL_MODES.TRANSLATE:switch(b){case 0:h=2;break;case 1:h=1;break;case 2:h=0}}this.camControl.setMousePos(d,e);this.state!==h&&(this.wheelDeltaApplied=
this.deltaYApplied=this.deltaXApplied=0,Ma.call(this));this.state=h;Aa.call(this)}}},Ea=function(b,d,e,f){this.anyMouseButtonPressed=!1;this.mouseButtonsPressed=f;for(var h in f)this.anyMouseButtonPressed=this.anyMouseButtonPressed||f[h];Aa.call(this);(this.settings.editionMode&stage.emersya.viewer.EDITION_MODES.MESHES||this.settings.editionMode&stage.emersya.viewer.EDITION_MODES.LIGHT||this.settings.editionMode&stage.emersya.viewer.EDITION_MODES.MODULAR)&&this.drawingSelectionSquare&&(this.drawingSelectionSquare=
!1,(b=this.apiCore.exec(this.callerName,"rdr.endSelectionSquare",{x:d,y:e}))&&this.apiCore.exec(this.callerName,"rdr.onPolylistsSelected",b));b=ob.call(this,void 0,!1);this.apiCore.exec(this.callerName,"stopProductNodeInstanceDragging",b)},Ca=function(){var b=this.apiCore.exec(this.callerName,"rdr.getUnderMousePolylist",this.mousePos);this.apiCore.exec(this.callerName,"stopProductNodeInstanceDragging",b)},Ua=function(b){this.wheelDelta||(this.accStart=Date.now());this.autoRotating&&this.apiCore.exec(this.callerName,
"stopAutoRotate");this.animating&&!this.animationUnstoppable&&this.apiCore.exec(this.callerName,"stopAnimatingPath");this.wheelDelta+=b},sa=function(b){this.deltaAngle||(this.accStart=Date.now());this.autoRotating&&this.apiCore.exec(this.callerName,"stopAutoRotate");this.animating&&!this.animationUnstoppable&&this.apiCore.exec(this.callerName,"stopAnimatingPath");this.deltaAngle+=b},na=function(b,d,e){if(!this.cameraLocked&&!this.cameraLockedForDrag&&this.settings.moveOnClick&&(1<=this.camControl.settings.targetRange||
-1===this.camControl.settings.targetRange)){if(this.firstClickTime&&this.firstClickTime.x===b&&this.firstClickTime.y===d&&500>(new Date).getTime()-this.firstClickTime.time&&!stage.browser.Ie&&-1===window.navigator.userAgent.indexOf("Edge")){var f=this.apiCore.exec(this.callerName,"rdr.getUnderMousePolylist",{x:b,y:d});if(f&&this.animationSpeed){var h=f[0].node;f=vec3.create(f[0].clickedPoint);mat4.multiplyVec3(h.modelMatrix,f);h=vec3.length(vec3.subtract(this.camera.position,f,vec3.create()));h*=
.5;h<1/this.settings.maxZoomRatio*this.initialZoom?h=1/this.settings.maxZoomRatio*this.initialZoom:h>1/this.settings.minZoomRatio*this.initialZoom&&(h=1/this.settings.minZoomRatio*this.initialZoom);var m=vec3.subtract(this.camera.position,f,vec3.create());vec3.normalize(m);vec3.scale(m,h);vec3.add(m,f);f=this.camControl.getAnimateDest(m,f,this.camera.up);f.t=1E3;this.apiCore.exec(this.callerName,"startAnimatingPath",[f],!1,!0)}}this.firstClickTime={x:b,y:d,time:(new Date).getTime()}}this.settings.editionMode&
stage.emersya.viewer.EDITION_MODES.LIGHT?(f=this.apiCore.exec(this.callerName,"rdr.getUnderMouseLight",{x:b,y:d}))&&this.apiCore.exec(this.callerName,"lightSelection",[f]):this.settings.editionMode&stage.emersya.viewer.EDITION_MODES.MESHES?(f=this.apiCore.exec(this.callerName,"rdr.getUnderMousePolylist",{x:b,y:d}))&&this.apiCore.exec(this.callerName,"rdr.onPolylistClicked",f[0].polylistId,this.keys.control):this.settings.editionMode&stage.emersya.viewer.EDITION_MODES.MODULAR&&(f=this.apiCore.exec(this.callerName,
"rdr.getUnderMouseModularConnector",{x:b,y:d}))&&this.apiCore.exec(this.callerName,"onModularConnectorClicked",f);this.settings.selectPolylists&&((f=this.apiCore.exec(this.callerName,"rdr.getUnderMousePolylist",{x:b,y:d}))?this.apiCore.exec(this.callerName,"polylistSelection",f,e):this.apiCore.exec(this.callerName,"polylistSelection",[],e),ob.call(this,f,!0))},kb=function(b){switch(b){case "zoomIn":this.keys.forward=!0;this.keyboardAccStart=this.now;this.autoRotating&&this.apiCore.exec(this.callerName,
"stopAutoRotate");break;case "zoomOut":this.keys.backward=!0;this.keyboardAccStart=this.now;this.autoRotating&&this.apiCore.exec(this.callerName,"stopAutoRotate");break;case "shift":this.keys.shift=!0;this.keyboardAccStart=this.now;break;case "control":this.keys.control=!0;this.keyboardAccStart=this.now;break;case "escape":this.apiCore.exec(this.callerName,"toggleFullScreen",!0);this.apiCore.exec(this.callerName,"rdr.setTransformationTool",stage.emersya.viewer.TRANSFORMATION_TOOLS.NONE);break;case "m":Oa.call(this);
this.apiCore.exec(this.callerName,"rdr.setTransformationTool",stage.emersya.viewer.TRANSFORMATION_TOOLS.TRANSLATION);break;case "l":Oa.call(this);this.apiCore.exec(this.callerName,"rdr.setTransformationTool",stage.emersya.viewer.TRANSFORMATION_TOOLS.SCALING);break;case "k":Oa.call(this),this.apiCore.exec(this.callerName,"rdr.setTransformationTool",stage.emersya.viewer.TRANSFORMATION_TOOLS.ROTATION)}},Da=function(b){switch(b){case "zoomIn":this.keys.forward=!1;break;case "zoomOut":this.keys.backward=
!1;break;case "q":case "left":this.keys.left=!1;break;case "d":case "right":this.keys.right=!1;break;case "r":case "pageup":this.keys.up=!1;break;case "f":case "pagedown":this.keys.down=!1;break;case "shift":this.keys.shift=!1;break;case "control":this.keys.control=!1}},xb=function(){this.keys={left:!1,right:!1,up:!1,down:!1,forward:!1,backward:!1,shift:!1,control:!1};this.moveSpeed=.1;this.speedThreshold=.001;this.controlMultiplicator=this.shiftDivisor=10;this.deltaLeftSpeed=this.deltaLeftApplied=
this.deltaLeft=0;this.deltaLeftMaxSpeed=5;this.deltaRightSpeed=this.deltaRightApplied=this.deltaRight=0;this.deltaRightMaxSpeed=5;this.deltaUpSpeed=this.deltaUpApplied=this.deltaUp=0;this.deltaUpMaxSpeed=5;this.deltaDownSpeed=this.deltaDownApplied=this.deltaDown=0;this.deltaDownMaxSpeed=5;this.deltaForwardSpeed=this.deltaForwardApplied=this.deltaForward=0;this.deltaForwardMaxSpeed=5;this.deltaBackwardSpeed=this.deltaBackwardApplied=this.deltaBackward=0;this.deltaBackwardMaxSpeed=5},Za=function(b,
d){this.viewerSize=[this.renderer.realSize[0],this.renderer.realSize[1]];this.camControl.setSize(this.renderer.realSize[0],this.renderer.realSize[1]);this.apiCore.exec(this.callerName,"rdr.getCurrentScene")&&this.apiCore.exec(this.callerName,"rdr.forceUpdate")},V=function(b){var d=2*this.fxLevels[b];"downscale"==b&&(d=this.fxLevels[b]+.1);0==d&&(d=.125);d>this.settings.fxLevels[b].max&&(d=this.settings.fxLevels[b].max);return d},O=function(b){var d=this.fxLevels[b]/2;"downscale"==b&&(d=this.fxLevels[b]-
.1);d<this.settings.fxLevels[b].min&&(d=this.settings.fxLevels[b].min);.125>d&&(d=0);return d},ja=function(b,d){if(b){if(this.fxLevels.downscale!==this.settings.fxLevels.downscale.max)return this.fxLevels.downscale=V.call(this,"downscale"),zb.call(this,this.fxLevels.downscale),!0}else if(this.fxLevels.downscale!==this.settings.fxLevels.downscale.min)return this.fxLevels.downscale=O.call(this,"downscale"),zb.call(this,this.fxLevels.downscale),!0;return!1},W=function(b,d){if(b){if(this.fxLevels.silhouettes!==
this.settings.fxLevels.silhouettes.max)return this.fxLevels.silhouettes=d?this.settings.fxLevels.silhouettes.max:V.call(this,"silhouettes"),cb.call(this,this.fxLevels.silhouettes),!0}else if(this.fxLevels.silhouettes!==this.settings.fxLevels.silhouettes.min)return this.fxLevels.silhouettes=d?this.settings.fxLevels.silhouettes.min:O.call(this,"silhouettes"),cb.call(this,this.fxLevels.silhouettes),!0;return!1},pa=function(b,d){if(b){if(this.fxLevels.blur!==this.settings.fxLevels.blur.max)return this.fxLevels.blur=
d?this.settings.fxLevels.blur.max:V.call(this,"blur"),nc.call(this,this.fxLevels.blur),!0}else if(this.fxLevels.blur!==this.settings.fxLevels.blur.min)return this.fxLevels.blur=d?this.settings.fxLevels.blur.min:O.call(this,"blur"),nc.call(this,this.fxLevels.blur),!0;return!1},Pa=function(b,d){if(b){if(this.fxLevels.mirror!==this.settings.fxLevels.mirror.max)return this.fxLevels.mirror=1,dc.call(this,this.fxLevels.mirror),!0}else if(this.fxLevels.mirror!==this.settings.fxLevels.mirror.min)return this.fxLevels.mirror=
0,dc.call(this,this.fxLevels.mirror),!0;return!1},ha=function(b,d){if(b){if(this.fxLevels.ssao!==this.settings.fxLevels.ssao.max)return this.fxLevels.ssao=d?this.settings.fxLevels.ssao.max:V.call(this,"ssao"),Wb.call(this,this.fxLevels.ssao),!0}else if(this.fxLevels.ssao!==this.settings.fxLevels.ssao.min)return this.fxLevels.ssao=d?this.settings.fxLevels.ssao.min:O.call(this,"ssao"),Wb.call(this,this.fxLevels.ssao),!0;return!1},ya=function(b,d){if(b){if(this.fxLevels.glow!==this.settings.fxLevels.glow.max)return this.fxLevels.glow=
d?this.settings.fxLevels.glow.max:V.call(this,"glow"),Sb.call(this,this.fxLevels.glow),!0}else if(this.fxLevels.glow!==this.settings.fxLevels.glow.min)return this.fxLevels.glow=d?this.settings.fxLevels.glow.min:O.call(this,"glow"),Sb.call(this,this.fxLevels.glow),!0;return!1},zb=function(b,d){b&&this.apiCore.exec(this.callerName,"rdr.setDownscale",b,d)},cb=function(b,d){b?(this.apiCore.exec(this.callerName,"rdr.setDepthAndNormalsReduction",1/b,d),this.apiCore.exec(this.callerName,"rdr.toggleSilhouettes",
!0)):this.apiCore.exec(this.callerName,"rdr.toggleSilhouettes",!1)},nc=function(b,d){b?(this.apiCore.exec(this.callerName,"rdr.setBlurReduction",1/b,d),this.apiCore.exec(this.callerName,"rdr.toggleBlur",!0)):this.apiCore.exec(this.callerName,"rdr.toggleBlur",!1)},dc=function(b,d){b?this.apiCore.exec(this.callerName,"rdr.toggleMirror",!0):this.apiCore.exec(this.callerName,"rdr.toggleMirror",!1)},Wb=function(b,d){b?(this.apiCore.exec(this.callerName,"rdr.setSsaoReduction",1/b,d),this.apiCore.exec(this.callerName,
"rdr.toggleSSAO",!0)):this.apiCore.exec(this.callerName,"rdr.toggleSSAO",!1)},Sb=function(b,d){b?(this.apiCore.exec(this.callerName,"rdr.setGlowReduction",1/b,d),this.apiCore.exec(this.callerName,"rdr.toggleGlow",!0)):this.apiCore.exec(this.callerName,"rdr.toggleGlow",!1)},ec=function(b,d){this.ignorePressStatus=!!d;this.draggingProductNodeInstance=b;d&&(this.fireDragStartOnNextMove=!1,Rb.call(this),Fa.call(this,!0))},Xb=function(){this.draggingProductNodeInstance=null;this.fireDragStartOnNextMove=
!1;this.draggingGeoms=null;Fa.call(this,!1)},yb=function(b){this.productNodesDragEnabled&&b===this.draggingProductNodeInstance&&(b=this.apiCore.exec(this.callerName,"rdr.getUnderMousePolylist",this.mousePos),this.apiCore.exec(this.callerName,"stopProductNodeInstanceDragging",b))},Rb=function(){if(this.fireDragStartOnNextMove){var b=Math.abs(this.mousePos.x-this.dragStartPosition.x);b+=Math.abs(this.mousePos.y-this.dragStartPosition.y);if(0>=b)return;this.apiCore.exec(this.callerName,"startProductNodeInstanceDragging",
this.fireDragStartOnNextMove)}this.draggingProductNodeInstance&&(this.fireDragStartOnNextMove=!1,this.dragStartPosition=null,this.apiCore.exec(this.callerName,"updateDraggingNodePosition",this.mousePos))},Gb=function(b,d){if(this.productNodesDragEnabled){var e=b?b[0]:null,f=d&&!this.wasPressedForDrag;if(e)if((d||this.ignorePressStatus)&&this.draggingProductNodeInstance)Rb.call(this);else{e=e.node;for(var h=e.parent;h&&!h.draggable&&!h.notDraggable;)h=h.parent;if(e.boundingBoxWithoutNodes&&h&&h.draggable){if(d&&
f&&!this.draggingProductNodeInstance){this.fireDragStartOnNextMove=h;this.draggingGeoms=b;this.dragStartPosition=stage.extend({},this.mousePos);Fa.call(this,!0);this.wasPressedForDrag=d;return}}else!this.cameraLockedForDrag||this.draggingProductNodeInstance||this.fireDragStartOnNextMove||Fa.call(this,!1);d?Rb.call(this):this.wasPressedForDrag&&this.apiCore.exec(this.callerName,"stopProductNodeInstanceDragging",b)}else this.cameraLockedForDrag&&!this.draggingProductNodeInstance&&Fa.call(this,!1),this.wasPressedForDrag&&
!d&&this.draggingProductNodeInstance?this.apiCore.exec(this.callerName,"stopProductNodeInstanceDragging",b):this.draggingProductNodeInstance&&Rb.call(this);this.wasPressedForDrag=d}},ob=function(b,d){if(this.mouseTrackingMode||this.productNodesDragEnabled){var e=null==this.dragMouseButton?this.anyMouseButtonPressed:!!this.mouseButtonsPressed[this.dragMouseButton];e=void 0!==d?d:e;if(this.draggingProductNodeInstance&&this.draggingGeoms&&this.productNodesDragMode==stage.emersya.viewer.PRODUCT_NODES_DRAG_MODE.KEPT)return Gb.call(this,
this.draggingGeoms,e),this.draggingGeoms;void 0===b&&(b=this.apiCore.exec(this.callerName,"rdr.getUnderMousePolylist",this.mousePos));this.mouseTrackingMode&&this.apiCore.exec(this.callerName,"mouseTrackingUpdate",b?b[0]:null,e,this.mousePos,this.mouseLeaved);this.productNodesDragEnabled&&Gb.call(this,b,e);return b}},Hb=function(b){if(this.settings.highlightPolylists){b=b?b[0].polylistInstanceId:-1;var d=this.apiCore.exec(this.callerName,"rdr.getCurrentScene");d&&(-1!==this.lastHighlightedPolylist&&
void 0!==this.lastHighlightedPolylist&&d.dehighlightPolylist(parseInt(this.lastHighlightedPolylist.split("-")[0])),-1!==b?(d.highlightPolylist(parseInt(b.split("-")[0])),this.lastHighlightedPolylist=b):this.lastHighlightedPolylist=-1)}};return d});stage.provide("emersya.viewer.modules.sceneControls.doubleOrbitControl");stage.require("emersya.viewer");
stage.register.call(stage.emersya.viewer.modules.sceneControls,"doubleOrbitControl",function(){var b={deltaZoomDivisor:1E4,xRotationFull:3*Math.PI,yRotationFull:3*Math.PI,xRotationMin:-2*Math.PI,xRotationMax:2*Math.PI,yRotationMin:-.49999*Math.PI,yRotationMax:.49999*Math.PI,maxZoom:10,minZoom:.001,moveOnMaxZoom:!1,initialZoom:10,zoomScalesRotation:!0,targetRange:-1,targetAxes:[1,1,1],minDistanceRatio:.2},d=function(d){this.settings=stage.extend({},b,d);this.settings.yRotationMin>this.settings.yRotationMax&&
(d=this.settings.yRotationMin,this.settings.yRotationMin=this.settings.yRotationMax,this.settings.yRotationMax=d);this.yRotationMin=-this.settings.yRotationMax;this.yRotationMax=-this.settings.yRotationMin;this.viewport={width:this.settings.viewport.width,height:this.settings.viewport.height};this.currentXRotation=this.currentYRotation=0;this.ratioPixel=1;this.cameraXReal=this.cameraUpReal=this.cameraTarget=this.cameraUp=this.cameraPosition=null;this.initialCameraZoom=this.cameraZoom=0;this.inverse=
!1;this.camera=null;this.animationRotYInit=this.animationRotXInit=this.animationRotationY=this.animationRotationX=this.animationScaleInit=this.animationScale=0;this.animationInitialTarget=this.animationTranslation=null;this.initFromSettings()};d.prototype.getType=function(){return stage.emersya.viewer.SCENE_CONTROL.DOUBLEORBIT};d.prototype.setSize=function(b,d){this.viewport.width=b;this.viewport.height=d;this.ratioPixel=2*Math.tan(2*Math.PI*this.settings.camera.fov/720);this.ratioPixel/=this.viewport.height};
d.prototype.updatePixelRatio=function(){this.ratioPixel=2*Math.tan(2*Math.PI*this.settings.camera.fov/720);this.ratioPixel/=this.viewport.height};d.prototype.setMousePos=function(b,d){this.inverse=-1==this.cameraUp[1]};var u=function(){this.cameraUpReal=vec3.create([0,1,0]);this.cameraXReal=vec3.create([1,0,0]);var b=mat4.create();mat4.identity(b);mat4.rotate(b,this.currentXRotation,this.cameraUpReal);mat4.rotate(b,this.currentYRotation,this.cameraXReal);mat4.multiplyVec3(b,this.cameraUpReal);mat4.multiplyVec3(b,
this.cameraXReal);vec3.normalize(this.cameraUpReal);vec3.normalize(this.cameraXReal)};d.prototype.initFromSettings=function(){this.camera=this.settings.camera;this.cameraPosition=vec3.create(this.settings.camera.position);this.cameraTarget=vec3.create(this.settings.camera.target);this.cameraUp=vec3.create(this.settings.camera.up);0>vec3.dot(this.settings.camera.up,[0,1,0])?this.cameraUp=vec3.create([0,-1,0]):this.cameraUp=vec3.create([0,1,0]);vec3.subtract(this.cameraPosition,this.cameraTarget);this.cameraZoom=
vec3.length(this.cameraPosition);this.initialCameraZoom=this.settings.initialZoom;vec3.normalize(this.cameraPosition);var b=vec3.create(this.cameraPosition);b[1]=0;0==vec3.length(b)&&vec3.set([0,0,1],b);vec3.normalize(b);var d=vec3.create([0,0,1]);vec3.subtract(b,d);var g=1-Math.pow(vec3.length(b),2)/2;1<g?g=1:-1>g&&(g=-1);this.currentXRotation=0<this.cameraPosition[0]?Math.acos(g):-Math.acos(g);vec3.add(d,b);b=vec3.create(this.cameraPosition);vec3.subtract(b,d);g=1-Math.pow(vec3.length(b),2)/2;1<
g?g=.9:-1>g&&(g=-.9);this.currentYRotation=0<this.cameraPosition[1]?-Math.acos(g):Math.acos(g);-1==this.cameraUp[1]&&(this.currentYRotation=Math.PI-this.currentYRotation,this.currentXRotation-=Math.PI,this.inverse=!0);this.currentXRotation<this.settings.xRotationMin&&this.currentXRotation+2*Math.PI>=this.settings.xRotationMin&&(this.currentXRotation+=2*Math.PI);this.currentXRotation>this.settings.xRotationMax&&this.currentXRotation-2*Math.PI<=this.settings.xRotationMax&&(this.currentXRotation-=2*
Math.PI);this.currentYRotation<this.yRotationMin&&this.currentYRotation+2*Math.PI>=this.yRotationMin&&(this.currentYRotation+=2*Math.PI);this.currentYRotation>this.yRotationMax&&this.currentYRotation-2*Math.PI<=this.yRotationMax&&(this.currentYRotation-=2*Math.PI);u.call(this);this.ratioPixel=2*Math.tan(2*Math.PI*this.settings.camera.fov/720);this.ratioPixel/=this.viewport.height};d.prototype.updateCamera=function(){var b=vec3.create(this.cameraPosition);vec3.scale(b,this.cameraZoom);vec3.add(b,this.cameraTarget);
this.camera.position=b;this.camera.up=this.cameraUp;this.camera.upReal=this.cameraUpReal;this.camera.target=this.cameraTarget};d.prototype.getAvailableRotation=function(){var b=this.currentXRotation-this.settings.xRotationMin,d=this.settings.xRotationMax-this.currentXRotation,g=this.currentYRotation-this.settings.yRotationMin,q=this.settings.yRotationMax-this.currentYRotation;-1E-8<=Math.abs(this.settings.xRotationMax-this.settings.xRotationMin)-4*Math.PI&&(d=b=Math.PI);-1E-8<=Math.abs(this.settings.yRotationMax-
this.settings.yRotationMin)-4*Math.PI&&(q=g=Math.PI);b*=this.viewport.width;d*=this.viewport.width;q*=this.viewport.height;g*=this.viewport.height;var t=this.cameraZoom/this.initialCameraZoom;t<this.settings.minDistanceRatio&&(t=this.settings.minDistanceRatio);this.settings.zoomScalesRotation&&this.cameraZoom<this.initialCameraZoom&&(b/=t,d/=t,q/=t,g/=t);b/=this.settings.xRotationFull;d/=this.settings.xRotationFull;q/=this.settings.yRotationFull;g/=this.settings.yRotationFull;return{deltaXMin:b,deltaXMax:d,
deltaYMax:q,deltaYMin:g}};d.prototype.rotate=function(b,d){if(0==b&&0==d)return stage.emersya.viewer.INTERACTION_TYPE.NONE;b*=this.settings.xRotationFull;d*=this.settings.yRotationFull;var g=this.cameraZoom/this.initialCameraZoom;g<this.settings.minDistanceRatio&&(g=this.settings.minDistanceRatio);this.settings.zoomScalesRotation&&this.cameraZoom<this.initialCameraZoom&&(b*=g,d*=g);b/=this.viewport.width;d/=this.viewport.height;g=vec3.create([0,1,0]);var k=vec3.create([1,0,0]),l=mat4.create();mat4.identity(l);
this.currentXRotation=this.inverse?this.currentXRotation+b:this.currentXRotation-b;this.currentYRotation-=d;this.currentXRotation<this.settings.xRotationMin&&(this.currentXRotation=this.settings.xRotationMin);this.currentXRotation>this.settings.xRotationMax&&(this.currentXRotation=this.settings.xRotationMax);this.currentYRotation<this.yRotationMin&&(this.currentYRotation=this.yRotationMin);this.currentYRotation>this.yRotationMax&&(this.currentYRotation=this.yRotationMax);1E-4>Math.abs(Math.abs(this.currentYRotation)-
Math.PI/2)&&(this.currentYRotation-=1E-4*Math.sign(this.currentYRotation));1E-4>Math.abs(Math.abs(this.currentYRotation)-3*Math.PI/2)&&(this.currentYRotation-=1E-4*Math.sign(this.currentYRotation));this.cameraUp[1]=this.currentYRotation>Math.PI/2&&this.currentYRotation<3*Math.PI/2||this.currentYRotation<-Math.PI/2&&this.currentYRotation>-3*Math.PI/2?-1:1;this.currentXRotation%=2*Math.PI;this.currentYRotation%=2*Math.PI;mat4.rotate(l,this.currentXRotation,g);mat4.rotate(l,this.currentYRotation,k);
vec3.set([0,0,1],this.cameraPosition);mat4.multiplyVec3(l,this.cameraPosition);vec3.normalize(this.cameraPosition);u.call(this);return stage.emersya.viewer.INTERACTION_TYPE.ROTATION};d.prototype.getRotationDeltas=function(b,d,g){b={x:b,y:d,z:0};b.x/=180*this.settings.xRotationFull/Math.PI;b.y/=180*this.settings.yRotationFull/Math.PI;d=this.cameraZoom/this.initialCameraZoom;d<this.settings.minDistanceRatio&&(d=this.settings.minDistanceRatio);this.settings.zoomScalesRotation&&this.cameraZoom<this.initialCameraZoom&&
(b.x/=d,b.y/=d);b.x*=this.viewport.width;b.y*=this.viewport.height;return b};d.prototype.rotateZ=function(b){return stage.emersya.viewer.INTERACTION_TYPE.NONE};d.prototype.zoom=function(b){if(!b)return stage.emersya.viewer.INTERACTION_TYPE.NONE;var d=this.cameraZoom,g=this.cameraZoom/this.initialCameraZoom;g<this.settings.minDistanceRatio&&(g=this.settings.minDistanceRatio);b=1-g*b/this.settings.deltaZoomDivisor;b=Math.min(Math.max(b,.2),5);b=1<b?Math.pow(b,8):Math.pow(b,4);b=Math.min(Math.max(b,
.2),5);this.cameraZoom*=b;if(this.cameraZoom<this.settings.minZoom){if(this.cameraZoom=this.settings.minZoom,this.settings.moveOnMaxZoom)return d=vec3.scale(this.cameraPosition,-1,vec3.create()),vec3.add(this.cameraTarget,vec3.scale(d,this.cameraZoom-this.cameraZoom*b)),this.camera.sceneCenter&&0<this.settings.targetRange&&(d=vec3.subtract(this.cameraTarget,this.camera.sceneCenter,vec3.create()),vec3.length(d)>this.settings.targetRange*this.camera.sceneRadius)?(d=vec3.normalize(d),vec3.scale(d,this.settings.targetRange*
this.camera.sceneRadius),vec3.add(d,this.camera.sceneCenter,this.cameraTarget),stage.emersya.viewer.INTERACTION_TYPE.NONE):stage.emersya.viewer.INTERACTION_TYPE.TRANSLATION}else this.cameraZoom>this.settings.maxZoom&&(this.cameraZoom=this.settings.maxZoom);return d!==this.cameraZoom?d>this.cameraZoom?stage.emersya.viewer.INTERACTION_TYPE.ZOOM_IN:stage.emersya.viewer.INTERACTION_TYPE.ZOOM_OUT:stage.emersya.viewer.INTERACTION_TYPE.NONE};d.prototype.getTranslation=function(b,d){var g=vec3.create();vec3.scale(this.cameraPosition,
-1,g);var k=this.cameraZoom;vec3.normalize(g);b=b*k*this.ratioPixel;d=d*k*this.ratioPixel;k=vec3.create(this.cameraUpReal);g=vec3.create(this.cameraXReal);vec3.scale(k,d);vec3.scale(g,-b);return vec3.multiply(vec3.add(k,g),this.settings.targetAxes)};d.prototype.translate=function(b,d){if(!this.settings.targetRange||!b&&!d)return stage.emersya.viewer.INTERACTION_TYPE.NONE;vec3.add(this.cameraTarget,this.getTranslation(b,d));return this.camera.sceneCenter&&0<this.settings.targetRange&&(b=vec3.subtract(this.cameraTarget,
this.camera.sceneCenter,vec3.create()),vec3.length(b)>this.settings.targetRange*this.camera.sceneRadius)?(b=vec3.normalize(b),vec3.scale(b,this.settings.targetRange*this.camera.sceneRadius),vec3.add(b,this.camera.sceneCenter,this.cameraTarget),stage.emersya.viewer.INTERACTION_TYPE.NONE):stage.emersya.viewer.INTERACTION_TYPE.TRANSLATION};d.prototype.move=function(b,d,g){return this.zoom(10*g)};d.prototype.getAnimateDest=function(b,d,g){g=vec3.normalize(g,vec3.create());g=0>vec3.dot(g,[0,1,0])?[0,-1,
0]:[0,1,0];return{position:b,target:d,up:g}};d.prototype.getCurrentZoomRatio=function(){return 1-(this.cameraZoom-this.settings.minZoom)/(this.settings.maxZoom-this.settings.minZoom)};d.prototype.getPositionFromZoomRatio=function(b){b=(1-b)*(this.settings.maxZoom-this.settings.minZoom)+this.settings.minZoom;var d=vec3.create(this.cameraPosition);vec3.scale(d,b);vec3.add(d,this.cameraTarget);return d};d.prototype.resetAnimation=function(){this.animationInitialTarget=null};d.prototype.setAnimation=
function(b,d,g){b=vec3.create(b);vec3.subtract(b,d);this.animationScale=vec3.length(b);this.animationScale-=this.cameraZoom;this.animationTranslation=vec3.subtract(this.cameraTarget,d,vec3.create());d=vec3.create(b);vec3.normalize(d);d[1]=0;0==vec3.length(d)&&vec3.set([0,0,1],d);vec3.normalize(d);var k=vec3.create([0,0,1]);vec3.subtract(d,k);var l=1-Math.pow(vec3.length(d),2)/2;1<l?l=1:-1>l&&(l=-1);this.animationRotationX=0<b[0]?Math.acos(l):-Math.acos(l);vec3.add(k,d);d=vec3.create(b);vec3.normalize(d);
vec3.subtract(d,k);l=1-Math.pow(vec3.length(d),2)/2;1<l?l=1:-1>l&&(l=-1);this.animationRotationY=0<b[1]?-Math.acos(l):Math.acos(l);-1==g[1]&&(this.animationRotationX+=Math.PI,this.animationRotationY=Math.PI-this.animationRotationY);this.animationRotationX-=this.currentXRotation;this.animationRotationY-=this.currentYRotation;this.animationRotationX%=2*Math.PI;this.animationRotationY%=2*Math.PI;this.animationRotationX>Math.PI?this.animationRotationX=-(2*Math.PI-this.animationRotationX):this.animationRotationX<
-Math.PI&&(this.animationRotationX=2*Math.PI+this.animationRotationX);this.animationRotationY>Math.PI?this.animationRotationY=-(2*Math.PI-this.animationRotationY):this.animationRotationY<-Math.PI&&(this.animationRotationY=2*Math.PI+this.animationRotationY);this.animationRotXInit=this.currentXRotation;this.animationRotYInit=this.currentYRotation;this.animationScaleInit=this.cameraZoom;this.animationInitialTarget=vec3.create(this.cameraTarget)};d.prototype.updateAnimation=function(b){if(this.animationInitialTarget){var d=
vec3.create([0,1,0]),g=vec3.create([1,0,0]),k=mat4.create();mat4.identity(k);if(1>b){this.currentXRotation=this.animationRotXInit+this.animationRotationX*b;this.currentYRotation=this.animationRotYInit+this.animationRotationY*b;var t=vec3.create(this.animationTranslation);vec3.scale(t,-b);vec3.add(this.animationInitialTarget,t,this.cameraTarget);this.cameraZoom=this.animationScaleInit+this.animationScale*b}else this.currentXRotation=this.animationRotXInit+this.animationRotationX,this.currentYRotation=
this.animationRotYInit+this.animationRotationY,vec3.subtract(this.animationInitialTarget,this.animationTranslation,this.cameraTarget),this.cameraZoom=this.animationScaleInit+this.animationScale;mat4.rotate(k,this.currentXRotation,d);mat4.rotate(k,this.currentYRotation,g);vec3.set([0,0,1],this.cameraPosition);mat4.multiplyVec3(k,this.cameraPosition);vec3.normalize(this.cameraPosition);u.call(this);this.currentYRotation>Math.PI/2&&this.currentYRotation<3*Math.PI/2||this.currentYRotation<-Math.PI/2&&
this.currentYRotation>-3*Math.PI/2?(this.cameraUp[1]=-1,this.inverse=!0):(this.cameraUp[1]=1,this.inverse=!1);this.updateCamera()}};return d});stage.provide("emersya.viewer.modules.sceneControls.freeFlyControl");stage.require("emersya.viewer.modules.sceneControls.doubleOrbitControl");stage.require("emersya.viewer");
stage.register.call(stage.emersya.viewer.modules.sceneControls,"freeFlyControl",function(){var b=stage.herite(function(b){this.doubleOrbit=this.$super;var d=vec3.create(b.camera.target),k=vec3.create(b.camera.position),l=vec3.subtract(b.camera.position,b.camera.target,vec3.create());b.camera.position=vec3.add(l,b.camera.position);b.camera.target=k;this.$super.constructor(b);if(this.settings.yRotationMin<this.settings.yRotationMax){l=-this.yRotationMin;var g=-this.yRotationMax}else l=-this.yRotationMax,
g=-this.yRotationMin;this.yRotationMax=l;this.yRotationMin=g;this.initFromSettings();b.camera.target=d;b.camera.position=k},stage.emersya.viewer.modules.sceneControls.doubleOrbitControl);b.prototype.getType=function(){return stage.emersya.viewer.SCENE_CONTROL.FREEFLY};b.prototype.updateCamera=function(){this.camera.position=this.cameraTarget;this.camera.target=vec3.add(vec3.scale(this.cameraPosition,-this.cameraZoom,vec3.create()),this.cameraTarget);this.camera.up=this.cameraUp;this.camera.upReal=
this.cameraUpReal;this.camera.isFreeFly=!0};b.prototype.rotate=function(b,u){return-1===this.settings.targetRange?this.doubleOrbit.rotate(b,u):this.doubleOrbit.rotate(-b,-u)};b.prototype.zoom=function(b){this.doubleOrbit.translate(0,0,b/(10*this.initialCameraZoom));return b?stage.emersya.viewer.INTERACTION_TYPE.NONE:0<b?stage.emersya.viewer.INTERACTION_TYPE.ZOOM_IN:stage.emersya.viewer.INTERACTION_TYPE.ZOOM_OUT};b.prototype.move=function(b,u,k){if(!this.settings.targetRange||!b&&!u&&!k)return stage.emersya.viewer.INTERACTION_TYPE.NONE;
var d=vec3.create(this.cameraUpReal),g=vec3.create(this.cameraXReal),q=vec3.create();vec3.scale(this.cameraPosition,-1,q);vec3.normalize(q);vec3.scale(d,u);vec3.scale(g,b);vec3.scale(q,k);vec3.add(this.cameraTarget,g);vec3.add(this.cameraTarget,d);vec3.add(this.cameraTarget,q);return stage.emersya.viewer.INTERACTION_TYPE.TRANSLATION};b.prototype.getAnimateDest=function(b,u,k){k=vec3.normalize(k,vec3.create());k=0>vec3.dot(k,[0,1,0])?[0,-1,0]:[0,1,0];return{position:b,target:u,up:k}};b.prototype.setAnimation=
function(b,u,k){var d=vec3.create(b);u=vec3.subtract(b,u,vec3.create());this.doubleOrbit.setAnimation(vec3.add(u,b),d,k)};return b});stage.provide("emersya.viewer.modules.sceneControls.planarFreeFlyControl");stage.require("emersya.viewer.modules.sceneControls.planarFreeFlyControl");stage.require("emersya.viewer");
stage.register.call(stage.emersya.viewer.modules.sceneControls,"planarFreeFlyControl",function(){var b={yPlan:2,yRotationMin:-17*Math.PI/18,yRotationMax:17*Math.PI/18,targetRange:-1},d=stage.herite(function(d){this.freeFly=this.$super;d.yRotationMin=Math.max(d.yRotationMin,b.yRotationMin);d.yRotationMax=Math.min(d.yRotationMax,b.yRotationMax);d=stage.extend({},b,d);d.camera.position[1]=d.yPlan;d.camera.target[1]=d.yPlan;this.$super.constructor(d)},stage.emersya.viewer.modules.sceneControls.freeFlyControl);
d.prototype.getType=function(){return stage.emersya.viewer.SCENE_CONTROL.PLANARFREEFLY};d.prototype.updateCamera=function(){this.freeFly.updateCamera()};d.prototype.rotate=function(b,d){return this.freeFly.rotate(b,d)};d.prototype.translate=function(b,d){return stage.emersya.viewer.INTERACTION_TYPE.NONE};d.prototype.zoom=function(b){return this.freeFly.zoom(b)};d.prototype.move=function(b,d,l){if(!this.settings.targetRange||!b&&!l)return stage.emersya.viewer.INTERACTION_TYPE.NONE;d=mat4.identity(mat4.create());
mat4.rotate(d,this.currentXRotation,[0,1,0]);var g=vec3.create([0,0,-1]);mat4.multiplyVec3(d,g);vec3.normalize(g);var k=vec3.create([1,0,0]);mat4.multiplyVec3(d,k);vec3.normalize(k);vec3.scale(k,b);vec3.scale(g,l);vec3.add(this.cameraTarget,g);vec3.add(this.cameraTarget,k);return stage.emersya.viewer.INTERACTION_TYPE.TRANSLATION};d.prototype.getAnimateDest=function(b,d,l){l=vec3.normalize(l,vec3.create());l=0>vec3.dot(l,[0,1,0])?[0,-1,0]:[0,1,0];return{position:[b[0],this.settings.yPlan,b[2]],target:[d[0],
this.settings.yPlan,d[2]],up:l}};d.prototype.setAnimation=function(b,d,l){b=this.getAnimateDest(b,d,l);this.freeFly.setAnimation(b.position,b.target,b.up)};return d});stage.provide("emersya.viewer.modules.sceneControls.trackBallControl");stage.require("emersya.viewer");
stage.register.call(stage.emersya.viewer.modules.sceneControls,"trackBallControl",function(){var b={deltaZoomDivisor:1E4,zoomScalesRotation:!0,initialZoom:10,minZoom:.001,maxZoom:10,moveOnMaxZoom:!0,targetRange:-1,targetAxes:[1,1,1],minDistanceRatio:.2},d=function(d){this.settings=stage.extend({},b,d);this.viewport={width:this.settings.viewport.width,height:this.settings.viewport.height};this.noRoll=!1;this.ratioPixel=1;this.staticMoving=!0;this.dynamicDampingFactor=.3;this.camera=this.cameraXReal=
this.iieuufh=this.cameraUp=this.cameraPosition=this.cameraTarget=null;this.rotateSpeed=10;this.mouseY=this.mouseX=0;this.lastBallProjection=vec3.create();this.ballProjection=vec3.create();this.initialCameraZoom=this.cameraZoom=this.deltaZoom=0;this.initialLength=1;this.animation=!1;this.animationPath=null;this.twoPhaseAnimation=!1;this.animationOldScale=this.animationCameraZoom=this.animationDiffLen=this.animationLen=this.animationCamUpDest=this.animationCamUp=this.animationCamPosSphereDest=this.animationCamPosSphere=
this.animationInitialTarget=this.animationTranslate=this.twoPhaseAnimationPt=null;this.camera=this.settings.camera;d=vec3.create(this.settings.camera.position);var k=vec3.create(this.settings.camera.target);camUp=this.settings.camera.upReal?vec3.create(this.settings.camera.upReal):vec3.create(this.settings.camera.up);var g=vec3.create();vec3.subtract(d,k,g);this.initialLength=vec3.length(g);this.cameraUp=camUp;this.cameraTarget=k;this.iieuufh=vec3.subtract(this.cameraTarget,d,vec3.create());vec3.normalize(this.iieuufh);
this.cameraPosition=vec3.scale(this.iieuufh,-1,vec3.create());this.cameraXReal=vec3.normalize(vec3.cross(this.cameraUp,this.iieuufh,vec3.create()));vec3.cross(this.iieuufh,this.cameraXReal,this.cameraUp);vec3.normalize(this.cameraUp);vec3.scale(this.cameraXReal,-1);this.cameraZoom=vec3.length(vec3.subtract(this.cameraTarget,d,vec3.create()));this.initialCameraZoom=this.settings.initialZoom;this.ratioPixel=2*Math.tan(2*Math.PI*this.settings.camera.fov/720);this.ratioPixel/=this.viewport.height};d.prototype.getType=
function(){return stage.emersya.viewer.SCENE_CONTROL.TRACKBALL};d.prototype.setSize=function(b,d){this.viewport.width=b;this.viewport.height=d;this.ratioPixel=2*Math.tan(2*Math.PI*this.settings.camera.fov/720);this.ratioPixel/=this.viewport.height};d.prototype.updatePixelRatio=function(){this.ratioPixel=2*Math.tan(2*Math.PI*this.settings.camera.fov/720);this.ratioPixel/=this.viewport.height};d.prototype.setMousePos=function(b,d){this.mouseX=b;this.mouseY=d;u.call(this,b,d,this.lastBallProjection);
this.ballProjection=vec3.create(this.lastBallProjection)};var u=function(b,d,g){b=vec3.create([b/(.5*this.viewport.width)-1,-(d/(.5*this.viewport.height)-1),0]);d=vec3.length(b);b[2]=Math.sqrt(16-d*d);vec3.set(this.cameraUp,g);vec3.normalize(g);vec3.scale(g,b[1]);d=vec3.create(this.cameraXReal);vec3.scale(d,b[0]);vec3.add(g,d);vec3.set(this.iieuufh,d);vec3.scale(d,b[2]);vec3.add(g,d);return g};d.prototype.updateCamera=function(){var b=vec3.create(this.cameraPosition);vec3.scale(b,this.cameraZoom);
vec3.add(b,this.cameraTarget);this.camera.position=b;this.camera.target=this.cameraTarget;this.camera.up=this.cameraUp;this.camera.upReal=this.cameraUp};d.prototype.getAvailableRotation=function(){return{}};d.prototype.rotate=function(b,d){if(!b&&!d)return stage.emersya.viewer.INTERACTION_TYPE.NONE;this.mouseX-=b;this.mouseY-=d;u.call(this,this.mouseX,this.mouseY,this.ballProjection);b=vec3.create();d=mat4.create();mat4.identity(d);var g=Math.acos(vec3.dot(this.lastBallProjection,this.ballProjection)/
vec3.length(this.lastBallProjection)/vec3.length(this.ballProjection));if(this.settings.zoomScalesRotation&&this.cameraZoom<this.initialCameraZoom){var k=this.cameraZoom/this.initialCameraZoom;k<this.settings.minDistanceRatio&&(k=this.settings.minDistanceRatio);g*=2*k}else g*=2;return g?(vec3.cross(this.lastBallProjection,this.ballProjection,b),vec3.normalize(b),g*=this.rotateSpeed,mat4.rotate(d,-g,b),mat4.multiplyVec3(d,this.cameraPosition),mat4.multiplyVec3(d,this.iieuufh),mat4.multiplyVec3(d,this.cameraUp),
mat4.multiplyVec3(d,this.cameraXReal),mat4.multiplyVec3(d,this.ballProjection),this.lastBallProjection=vec3.create(this.ballProjection),stage.emersya.viewer.INTERACTION_TYPE.ROTATION):stage.emersya.viewer.INTERACTION_TYPE.NONE};d.prototype.getRotationDeltas=function(b,d,g){b={x:b,y:d,z:g};b.x/=360;b.y/=360;b.z/=20;d=this.cameraZoom/this.initialCameraZoom;d<this.settings.minDistanceRatio&&(d=this.settings.minDistanceRatio);this.settings.zoomScalesRotation&&this.cameraZoom<this.initialCameraZoom&&(b.x/=
d,b.y/=d);b.x*=this.viewport.width;b.y*=this.viewport.height;return b};d.prototype.rotateZ=function(b){if(!b)return stage.emersya.viewer.INTERACTION_TYPE.NONE;b=mat4.rotate(mat4.identity(mat4.create()),b,this.iieuufh);mat4.multiplyVec3(b,this.cameraUp);mat4.multiplyVec3(b,this.cameraXReal);return stage.emersya.viewer.INTERACTION_TYPE.ZROTATION};d.prototype.zoom=function(b){if(!b)return stage.emersya.viewer.INTERACTION_TYPE.NONE;var d=this.cameraZoom,g=this.cameraZoom/this.initialCameraZoom;g<this.settings.minDistanceRatio&&
(g=this.settings.minDistanceRatio);b=1-g*b/this.settings.deltaZoomDivisor;b=Math.min(Math.max(b,.2),5);b=1<b?Math.pow(b,8):Math.pow(b,4);b=Math.min(Math.max(b,.2),5);this.cameraZoom*=b;if(this.cameraZoom<this.settings.minZoom){if(this.cameraZoom=this.settings.minZoom,this.settings.moveOnMaxZoom)return d=vec3.create(this.iieuufh),vec3.scale(d,this.cameraZoom-this.cameraZoom*b),vec3.add(this.cameraTarget,d),this.camera.sceneCenter&&0<this.settings.targetRange&&(d=vec3.subtract(this.cameraTarget,this.camera.sceneCenter,
vec3.create()),vec3.length(d)>this.settings.targetRange*this.camera.sceneRadius)?(d=vec3.normalize(d),vec3.scale(d,this.settings.targetRange*this.camera.sceneRadius),vec3.add(d,this.camera.sceneCenter,this.cameraTarget),stage.emersya.viewer.INTERACTION_TYPE.NONE):stage.emersya.viewer.INTERACTION_TYPE.TRANSLATION}else this.cameraZoom>this.settings.maxZoom&&(this.cameraZoom=this.settings.maxZoom);return d!==this.cameraZoom?d>this.cameraZoom?stage.emersya.viewer.INTERACTION_TYPE.ZOOM_IN:stage.emersya.viewer.INTERACTION_TYPE.ZOOM_OUT:
stage.emersya.viewer.INTERACTION_TYPE.NONE};d.prototype.getTranslation=function(b,d){b=b*this.cameraZoom*this.ratioPixel;d=d*this.cameraZoom*this.ratioPixel;var g=vec3.create(this.cameraUp),k=vec3.create(this.cameraXReal);vec3.scale(g,d);vec3.scale(k,-b);return vec3.multiply(vec3.add(k,g),this.settings.targetAxes)};d.prototype.translate=function(b,d){if(!this.settings.targetRange||!b&&!d)return stage.emersya.viewer.INTERACTION_TYPE.NONE;b=this.getTranslation(b,d);vec3.add(this.cameraTarget,b);return this.camera.sceneCenter&&
0<this.settings.targetRange&&(b=vec3.subtract(this.cameraTarget,this.camera.sceneCenter,vec3.create()),vec3.length(b)>this.settings.targetRange*this.camera.sceneRadius)?(b=vec3.normalize(b),vec3.scale(b,this.settings.targetRange*this.camera.sceneRadius),vec3.add(b,this.camera.sceneCenter,this.cameraTarget),stage.emersya.viewer.INTERACTION_TYPE.NONE):stage.emersya.viewer.INTERACTION_TYPE.TRANSLATION};d.prototype.move=function(b,d,g){return this.zoom(10*g)};d.prototype.getAnimateDest=function(b,d,g){vec3.create(this.cameraPosition);
var k=vec3.subtract(b,d,vec3.create());vec3.normalize(k);g=vec3.create(g);var l=vec3.normalize(vec3.cross(g,k,vec3.create()));vec3.cross(k,l,g);vec3.normalize(g);return{position:b,target:d,up:g}};d.prototype.getCurrentZoomRatio=function(){return 1-(this.cameraZoom-this.settings.minZoom)/(this.settings.maxZoom-this.settings.minZoom)};d.prototype.getPositionFromZoomRatio=function(b){b=(1-b)*(this.settings.maxZoom-this.settings.minZoom)+this.settings.minZoom;var d=vec3.create(this.cameraPosition);vec3.scale(d,
b);vec3.add(d,this.cameraTarget);return d};d.prototype.updateAnimation=function(b){if(1>b){var d=vec3.create(this.animationTranslate);vec3.scale(d,-b);vec3.add(d,this.animationInitialTarget);this.cameraTarget=d;this.cameraZoom=this.animationLen+this.animationDiffLen*b;d=mat4.identity(mat4.create());mat4.rotate(d,this.posAngleToApply*b,this.posAxisToApply);this.cameraPosition=mat4.multiplyVec3(d,this.animationCamPosSphere,vec3.create());this.cameraUp=mat4.multiplyVec3(d,this.animationCamUp,vec3.create());
vec3.scale(this.cameraPosition,-1,this.iieuufh);vec3.normalize(this.iieuufh);d=mat4.identity(mat4.create());mat4.rotate(d,this.upAngleToApply*b,this.cameraPosition);mat4.multiplyVec3(d,this.cameraUp)}else this.cameraPosition=vec3.create(this.animationCamPosSphereDest),this.cameraZoom=this.animationLen+this.animationDiffLen,this.cameraTarget=vec3.subtract(this.animationInitialTarget,this.animationTranslate,vec3.create()),this.cameraUp=this.animationCamUpDest;vec3.scale(this.cameraPosition,-1,this.iieuufh);
vec3.normalize(this.iieuufh);vec3.cross(this.cameraUp,this.iieuufh,this.cameraXReal);vec3.normalize(this.cameraXReal);vec3.scale(this.cameraXReal,-1);this.updateCamera()};d.prototype.setAnimation=function(b,d,g){this.animationCamPosSphere=vec3.create(this.cameraPosition);b=vec3.subtract(b,d,vec3.create());this.animationLen=this.cameraZoom;this.animationDiffLen=vec3.length(b)-this.cameraZoom;vec3.normalize(b);this.animationCamPosSphereDest=b;this.animationCamUp=vec3.create(this.cameraUp);this.animationCamUpDest=
vec3.create(g);b=vec3.normalize(vec3.cross(this.animationCamUpDest,this.animationCamPosSphereDest,vec3.create()));vec3.cross(this.animationCamPosSphereDest,b,this.animationCamUpDest);vec3.normalize(this.animationCamUpDest);b=vec3.dot(this.animationCamPosSphere,this.animationCamPosSphereDest);1<b?b=1:-1>b?b=-1:"";this.posAngleToApply=Math.acos(b);this.posAxisToApply=vec3.normalize(vec3.cross(this.animationCamPosSphere,this.animationCamPosSphereDest,vec3.create()));vec3.length(this.posAxisToApply)?
1E-4>vec3.length(vec3.subtract(this.cameraUp,g,vec3.create()))&&(0>vec3.dot(this.posAxisToApply,this.cameraUp)&&(this.posAngleToApply*=-1),this.posAxisToApply=vec3.create(this.cameraUp)):this.posAxisToApply=vec3.create(this.cameraUp);g=mat4.identity(mat4.create());mat4.rotate(g,this.posAngleToApply,this.posAxisToApply);g=mat4.multiplyVec3(g,this.animationCamUp,vec3.create());b=vec3.dot(g,this.animationCamUpDest);1<b?b=1:-1>b?b=-1:"";this.upAngleToApply=Math.acos(b);g=vec3.normalize(vec3.cross(g,this.animationCamUpDest,
vec3.create()));0>vec3.dot(this.animationCamPosSphereDest,g)&&(this.upAngleToApply*=-1);this.animationTranslate=vec3.subtract(this.cameraTarget,d,vec3.create());this.animationInitialTarget=vec3.create(this.cameraTarget)};return d});stage.provide("emersya.viewer.modules.downloadManager");
stage.register.call(stage.emersya.viewer.modules,"downloadManager",function(){var b={timeout:5E3,retries:4,cache:!0},d=function(d,k){this.settings=stage.extend({},b,k);this.apiCore=d;this.currentRequests={};this.callerName=this.name="DownloadManager";this.apiCore.register(this,"dlm.get",g);this.apiCore.register(this,"dlm.abort",q)};d.prototype.destroy=function(){this.apiCore.unregister(this,"dlm.get");this.apiCore.unregister(this,"dlm.stop");this.apiCore.unregister(this,"dlm.abort");q.call(this)};
var u=function(b,d,f){this.apiCore.exec(this.callerName,"fileLoaded",b,d.transport.response)},k=function(b,d){this.apiCore.exec(this.callerName,"fileDownloadError",b,d)},l=function(b,d,f){this.apiCore.exec(this.callerName,"fileProgress",b,f.loaded)},g=function(b,d,f,g,q,w,D){d={timeout:D?D:this.settings.timeout,cache:void 0!==w?w:this.settings.cache,responseType:d,triesCount:0};d.onLoad=f?stage.setContext(function(d,g,e){delete this.currentRequests[d];"json"===g.responseType?f(b,g.response):f(b,g.transport.response)},
this,b):stage.setContext(u,this,b);d.onProgress=q?function(d,f){q(b,f.loaded)}:stage.setContext(l,this,b);d.onTimeout=stage.setContext(function(b,d,e,f,g,p,m){404!==m&&++b.triesCount<this.settings.retries?stage.ajax.get(d,null,b):(delete this.currentRequests[d],e(d,m))},this,d,b,g?g:stage.setContext(k,this));d.onError=d.onTimeout;d.onAbort=stage.setContext(function(b,d){this.triggerErrorOnAbort&&d(b,408)},this,b,g?g:stage.setContext(k,this));this.currentRequests[b]=stage.ajax.get(b,null,d)},q=function(b){void 0!==
b&&(this.triggerErrorOnAbort=b);for(var d in this.currentRequests)this.currentRequests[d].abort();this.currentRequests={};this.triggerErrorOnAbort=!1};return d});stage.provide("emersya.viewer.modules.renderer.core");
stage.register.call(stage.emersya.viewer.modules.renderer,"core",function(){var b={TEST_16_SAMPLES:0,TEST_32_SAMPLES:1,FIXE_16_SAMPLES:2,FIXE_32_SAMPLES:3,LEVEL_2ND_OFF:4,DOWN_SIZE:5,SSAO_OFF:6},d={statId:-1,container:null,possibleRenderingModes:stage.emersya.viewer.RENDERING_MODES.CLASSIC,directContextLostHandling:!1,computeHighlight:!1,renderAxes:!1,renderAxesOnSelectedNodes:!1,renderBoundingBoxes:!1,renderBlackAndWhite:0,renderFramerate:!1,renderGrid:!1,renderGlow:!0,renderHighlightedGeometry:!0,
renderHighlightedSilhouettes:!0,renderLights:!1,renderMirrors:!0,renderSelectedGeometry:!0,renderShadows:!0,renderSilhouettes:!1,renderSpecularGlow:!0,renderSSAO:!0,renderTonemapping:!0,renderWater:!0,renderBlurredOpacity:!0,renderFur:!0,renderArOccluder:!0,renderRulers:!1,filterSSAO:!0,multisampling:!1,mipmappedEnvironment:!1,graininess:0,grainOnStop:!1,grainOnStopMode:stage.emersya.viewer.HD_ON_STOP_MODES.OFF_ON_DESKTOP,depthAndNormalsReduction:2,glowReduction:2,blurReduction:2,ssaoReduction:2,
ssaoIterations:8,ssaoIntensity:.5,ssaoIntensity2:.5,ssaoRadius:.3,ssaoRadius2:1,ssaoThickness:.05,ssaoThickness2:1.5,ssaoEmissiveThreshold:0,ssaoOpacityThreshold:1,ssaoNormalDisplacement:!1,ssaoDepthThreshold:0,ssaoAutoDisable:!0,ssaoInitPhase:b.TEST_16_SAMPLES,specularGlowReduction:1,filterShadowMaps:!0,ghostCastShadow:!0,nbFilterPasses:10,axesLength:100,gridTotalSize:20,gridCasesCount:10,gridSubCasesCount:4,screenSpaceReflectDistance:0,screenSpaceRefractDistance:0,gridColor:[.5,.5,.5,1],squareColor:[0,
177/255,171/255,1],silhouettesColor:[0,177/255,171/255,1],highlightSilhouetteColor:[0,177/255,171/255,1],wireColor:[0,177/255,171/255,1],flatColor:[69/255,69/255,69/255,1],goochWarmColor:[.8,.8,.8],goochColdColor:[.2,.2,.2],goochDir:[1,1,0],furLayers:{min:10,max:80},furQualityHD:2,silhouettesThreshold:100,axesAlwaysVisible:!0,subdivise:!0,explose:!1,rebondsAnnotations:6,forceHardwareLimitations:!1,hardwareLimitations:{maxLights:null,maxCubeMapTextureSize:null,maxTextureSize:null,maxShadowMapsSize:null},
rulersSettings:{system:"metric",fraction:.01,decimals:0,size:18},targetFramerate:50,dynamicScaling:!0,hdOnStop:!0,smoothHdOnStop:!1,maximumScaling:Math.max(window.devicePixelRatio,1)},u=function(b,d){for(var e=["webgl2","webgl","experimental-webgl"],f=null,h=0;h<e.length;h++){try{f=b.getContext(e[h],{premultipliedAlpha:!0,antialias:d,stencil:!0}),f.webgl2=!h}catch(Ke){}if(f)break}if(f)f.viewportWidth=Math.max(b.width,1),f.viewportHeight=Math.max(b.height,1);else throw stage.createError(207,"Failed to create WebGL context");
stage.emersya.viewer.modules.renderer.extendedWebGLContext(f);return f},k=function(b,d){var e;if(b.length!=d.length)return!1;for(e=0;e<b.length;++e)if(1E-9<=Math.abs(b[e]-d[e]))return!1;return!0},l=function(b,g){this.settings=stage.extend({},d,g);this.settings.canvasWidth=Math.max(Math.round(this.settings.canvasWidth),1);this.settings.canvasHeight=Math.max(Math.round(this.settings.canvasHeight),1);this.devicePixelRatio=Math.max(window.devicePixelRatio,1);this.apiCore=b;this.settings.depthAndNormalsReduction||
(this.settings.depthAndNormalsReduction=2);this.settings.glowReduction||(this.settings.glowReduction=2);this.settings.blurReduction||(this.settings.blurReduction=2);this.settings.ssaoReduction||(this.settings.ssaoReduction=2);this.settings.ssaoIterations||(this.settings.ssaoIterations=8);ad.call(this,this.settings.grainOnStopMode);this.eventsManager=stage.createEventsManager(this.settings);this.statId=this.settings.statId;this.currentEditor=this.screenTools=this.shaders=this.meshes=null;this.renderingData=
{identityMatrix:mat4.identity(mat4.create()),furQuality:1,currentPolygonOffsetFactor:0,currentPolygonOffsetUnits:0,screenOffset:{x:0,y:0},clearTextures:stage.setContext(function(){if(this.gl){this.gl.activeTexture(this.gl.TEXTURE0);this.gl.bindTexture(this.gl.TEXTURE_2D,this.dummyTexture);for(var b=1;b<this.gl.maxTextureUnits;++b)this.gl.activeTexture(this.gl.TEXTURE0+b),this.gl.bindTexture(this.gl.TEXTURE_2D,null),this.gl.bindTexture(this.gl.TEXTURE_CUBE_MAP,null),this.gl.webgl2&&this.gl.bindTexture(this.gl.TEXTURE_2D_ARRAY,
null)}},this)};this.hardwareParams=null;this.clearColor={r:1,g:1,b:1,a:1};this.cameraMode=!0;this.destroyed=this.applyLightsUpdate=this.applyFilter=this.resizing=this.screenshotting=this.stopDraw=this.resized=this.cameraModeChanged=!1;this.refreshed=!0;this.framerate=0;this.animationSpeed=1;this.accumulatedTime={time:0,nbFrames:0};this.multiSamplingAccumulatedTime={times:[],time:0};this.jitterVectors=[];this.ssaaFramesCnt=-1;this.sampleWeights=[];this.accumulatedSampleWeights=[];this.maximumSSAAComputeTime=
50;this.minScaling=this.settings.minimumScaling;this.currentSelectedScaling=this.maxScaling=this.currentScaling=this.settings.maximumScaling;this.targetFramerate=this.settings.targetFramerate;this.targetFrameTimeDown=1E3/this.targetFramerate;this.targetFrameTimeUp=1E3/Math.min(60,this.targetFramerate+10);this.adaptativeUpStep=this.adaptativeDownStep=.05;this.annotationsDisabledWhileMoving=!1;this.performanceOptimisationEnabled=!0;this.scalingFrameTimes=[];this.scalingFrameTimesIndex=-1;this.globalFramebuffers=
[];this.deltaT=0;this.maximumScalingFrames=5;this.scalingWaitingDuration=this.firstScalingWaitingDuration=500;this.scalingFramesDuration=0;this.minimumAverageTimeToUpdateFirstTry=120;this.stableFramerateCounterDifferenceLimit=this.stableFramerateCounterMax=2;this.stableFramerateCounter=0;this.firstScaling=!0;this.smoothHdOnStop=this.settings.smoothHdOnStop;this.dynamicScaling=this.settings.dynamicScaling;this.sceneBoundingBoxVectors=[];this.backgroundTexCoord=this.backgroundTexture=this.glow2Texture=
this.glowTexture=this.glowFramebuffer=this.elementsBufferScreen=this.vertexBufferScreen=this.screenViewMatrix=this.screenTransfMatrix=null;this.backgroundAlpha=1;this.lastCameraUp=this.lastCameraTarget=this.lastCameraPosition=null;this.firstReturnRendering=this.firstStopMoving=!0;this.initialized=!1;this.annotationsToCompute=[];this.hiddenAnnotationsToFire=[];this.rulerPositions=[];this.rulerEnd=this.rulerStart=null;this.distanceCallback=function(b){console.log(b)};this.animatingGeometries=!1;this.animatingMaterials=
!0;this.canvasFramerate=null;this.framerateText="0.0";this.axesAlwaysVisible=this.drawAxes=!1;this.envDFGLUTCTLambertTexture=this.envDFGLUTTexture=this.gridIBufferP=this.gridVBufferP=this.gridIBuffer=this.gridVBuffer=this.axesIBuffer=this.axesCBuffer=this.axesVBuffer=this.squareIBuffer=this.squareVBuffer=this.squarePos2=this.squarePos1=this.drawAxesBottomLeft=null;this.ssaoPhase=this.settings.ssaoInitPhase;this.ssaoFrameCount=10;this.ghostProductNodesPolyInstances={};this.renderGhosts=!1;this.sceneBoundingBoxVectorsScreenPos=
[];this.anyMouseButtonPressed=!1;this.checkForErrors=!0;this.shadowSettings={shadowingTechnique:this.mobilBrowser?0:1,filteringTechnique:1,pcfLength:5,pcssLength:5,vsmLightBleed:.5,esmParam:800};this.renderingMode=stage.emersya.viewer.RENDERING_MODES.CLASSIC;this.canvas=document.createElement("canvas");this.canvas.width=Math.round(this.settings.canvasWidth*this.maxScaling);this.canvas.height=Math.round(this.settings.canvasHeight*this.maxScaling);this.contextValid=!0;this.minTextureLevel=1;this.gl=
u.call(this,this.canvas,!0);this.settings.container.appendChild(this.canvas);this.canvas.addEventListener("webglcontextlost",stage.setContext(function(b){b.preventDefault();this.settings.directContextLostHandling?this.destroyed||this.apiCore.exec(this.callerName,"webGlContextLost"):this.scene||this.destroyed||this.apiCore.exec(this.callerName,"webGlContextLost")},this),!1);this.realSize=[this.settings.canvasWidth,this.settings.canvasHeight];this.renderingData.realSize=[this.settings.canvasWidth,this.settings.canvasHeight];
this.$$canvas=$$stage(this.canvas);this.$$canvas.css({width:"100%",height:"100%"});this.$$canvas.hide();uc.call(this);this.name="WebGL Renderer";this.callerName="WebGLRenderer";this.apiCore.register(this,"resize",n);this.apiCore.register(this,"rdr.getCanvasSize",B,!0);this.apiCore.register(this,"setStatId",q);this.apiCore.register(this,"rdr.takeScreenshot",Qd,!0);this.apiCore.register(this,"rdr.takeDepthScreenshot",Id,!0);this.apiCore.register(this,"rdr.takeScreenshots",ge,!0);this.apiCore.register(this,
"rdr.takeTiledScreenshot",he,!0);this.apiCore.register(this,"rdr.takeEncodedScreenshot",Vd,!0);this.apiCore.register(this,"rdr.takeConfigurationScreenshot",Jd,!0);this.apiCore.register(this,"rdr.takePolylistScreenshot",Wd,!0);this.apiCore.register(this,"rdr.setBackgroundColor",w);this.apiCore.register(this,"rdr.setBackgroundImage",D);this.apiCore.register(this,"rdr.removeBackgroundImage",H);this.apiCore.register(this,"rdr.setBackgroundVideoTexture",A);this.apiCore.register(this,"rdr.removeBackgroundVideoTexture",
e);this.apiCore.register(this,"rdr.updateBackgroundSize",E);this.apiCore.register(this,"rdr.getBackgroundColor",F,!0);this.apiCore.register(this,"rdr.setHighlightColors",p);this.apiCore.register(this,"rdr.setAnnotations",m);this.apiCore.register(this,"rdr.setFirstRulerPoint",h);this.apiCore.register(this,"rdr.setSecondRulerPoint",v);this.apiCore.register(this,"rdr.toggleRulers",Ua);this.apiCore.register(this,"rdr.getUnderMousePolylist",I,!0);this.apiCore.register(this,"rdr.getUnderMouseLight",J,!0);
this.apiCore.register(this,"rdr.getUnderMouseModularConnector",M,!0);this.apiCore.register(this,"rdr.getPolylistInstanceScreenPosition",T,!0);this.apiCore.register(this,"rdr.getSceneScreenPosition",U,!0);this.apiCore.register(this,"rdr.getGroundPosition",R,!0);this.apiCore.register(this,"rdr.getProductNodesPositions",aa,!0);this.apiCore.register(this,"rdr.getScreenPosition",C,!0);this.apiCore.register(this,"rdr.toggleRendering",wa);this.apiCore.register(this,"rdr.toggleNodeAnimations",La);this.apiCore.register(this,
"rdr.toggleMaterialAnimations",Sa);this.apiCore.register(this,"rdr.toggleSSAO",gb);this.apiCore.register(this,"rdr.toggleSSAOFiltering",hb);this.apiCore.register(this,"rdr.toggleSilhouettes",kb);this.apiCore.register(this,"rdr.toggleMirror",xb);this.apiCore.register(this,"rdr.toggleWater",V);this.apiCore.register(this,"rdr.toggleBlur",ja);this.apiCore.register(this,"rdr.toggleGlow",pa);this.apiCore.register(this,"rdr.toggleTonemapping",ha);this.apiCore.register(this,"rdr.changeRenderingMode",Aa);
this.apiCore.register(this,"rdr.setDownscale",zb);this.apiCore.register(this,"rdr.setDepthAndNormalsReduction",nc);this.apiCore.register(this,"rdr.setBlurReduction",Wb);this.apiCore.register(this,"rdr.setMirrorReduction",ec);this.apiCore.register(this,"rdr.setSsaoReduction",yb);this.apiCore.register(this,"rdr.setSsaoIntensity",Gb);this.apiCore.register(this,"rdr.setSsaoRadius",Hb);this.apiCore.register(this,"rdr.setSsaoThickness",pb);this.apiCore.register(this,"rdr.setSsaoIntensity2",ob);this.apiCore.register(this,
"rdr.setSsaoRadius2",tc);this.apiCore.register(this,"rdr.setSsaoThickness2",Ab);this.apiCore.register(this,"rdr.setSsaoEmissiveThreshold",Bb);this.apiCore.register(this,"rdr.setSsaoOpacityThreshold",lb);this.apiCore.register(this,"rdr.setSsaoNormalDisplacement",ac);this.apiCore.register(this,"rdr.setGraininess",Yb);this.apiCore.register(this,"rdr.setGrainOnStop",ad);this.apiCore.register(this,"rdr.setGlowReduction",oc);this.apiCore.register(this,"rdr.setMinimumQualityAndTargetFramerate",nd);this.apiCore.register(this,
"rdr.setMultisampling",Sc);this.apiCore.register(this,"rdr.setSsaaOnStop",Tc);this.apiCore.register(this,"rdr.setForceGlobalFramebuffer",rb);this.apiCore.register(this,"rdr.setAntialiasing",od);this.apiCore.register(this,"rdr.setSSAARenderMode",Dc);this.apiCore.register(this,"rdr.setSSAASampleCount",Nb);this.apiCore.register(this,"rdr.setSSAORenderMode",Ib);this.apiCore.register(this,"rdr.setMipmappedEnv",Ob);this.apiCore.register(this,"rdr.setScreenSpaceReflectDistance",Ra);this.apiCore.register(this,
"rdr.setScreenSpaceRefractDistance",ma);this.apiCore.register(this,"rdr.setFurQuality",bb);this.apiCore.register(this,"rdr.bakeFurMap",ie,!0);this.apiCore.register(this,"rdr.setPerformanceOptimisation",Xd);this.apiCore.register(this,"rdr.changeCameraMode",ab);this.apiCore.register(this,"rdr.toggleAxes",Ta);this.apiCore.register(this,"rdr.toggleSelectedNodeAxes",Oa);this.apiCore.register(this,"rdr.toggleGrid",Qa);this.apiCore.register(this,"rdr.toggleBBoxes",za);this.apiCore.register(this,"rdr.toggleFramerate",
Ea);this.apiCore.register(this,"rdr.toggleLights",sa);this.apiCore.register(this,"rdr.isRendering",Ja,!0);this.apiCore.register(this,"rdr.isAnimatingNodes",ra,!0);this.apiCore.register(this,"rdr.isAnimatingMaterials",Ya,!0);this.apiCore.register(this,"rdr.isUsingSSAO",ib,!0);this.apiCore.register(this,"rdr.isFilteringSSAO",fb,!0);this.apiCore.register(this,"rdr.getRenderingMode",eb,!0);this.apiCore.register(this,"rdr.getCameraMode",Ma,!0);this.apiCore.register(this,"rdr.isRenderingAxes",db,!0);this.apiCore.register(this,
"rdr.isRenderingGrid",N,!0);this.apiCore.register(this,"rdr.isRenderingBBoxes",ca,!0);this.apiCore.register(this,"rdr.isRenderingFramerate",Ca,!0);this.apiCore.register(this,"rdr.isRenderingLights",na,!0);this.apiCore.register(this,"rdr.isRenderingSilhouettes",Da,!0);this.apiCore.register(this,"rdr.isRenderingMirrors",Za,!0);this.apiCore.register(this,"rdr.isRenderingWater",O,!0);this.apiCore.register(this,"rdr.isRenderingBlur",W,!0);this.apiCore.register(this,"rdr.isRenderingGlow",Pa,!0);this.apiCore.register(this,
"rdr.isUsingTonemapping",ya,!0);this.apiCore.register(this,"rdr.getDownscale",cb,!0);this.apiCore.register(this,"rdr.getDepthAndNormalsReduction",dc,!0);this.apiCore.register(this,"rdr.getBlurReduction",Sb,!0);this.apiCore.register(this,"rdr.getMirrorReduction",Xb,!0);this.apiCore.register(this,"rdr.getSsaoReduction",Rb,!0);this.apiCore.register(this,"rdr.getSsaoEmissiveThreshold",$a,!0);this.apiCore.register(this,"rdr.getSsaoOpacityThreshold",ic,!0);this.apiCore.register(this,"rdr.getGraininess",
Kc,!0);this.apiCore.register(this,"rdr.getGlowReduction",Cc,!0);this.apiCore.register(this,"rdr.getWebGLCapabilities",f,!0);this.apiCore.register(this,"setScene",Fc);this.apiCore.register(this,"startRendering",vc);this.apiCore.register(this,"rdr.forceUpdate",Vc);this.apiCore.register(this,"rdr.deallocateScene",jc);this.apiCore.register(this,"rdr.deallocateProductNode",xc);this.apiCore.register(this,"rdr.reallocateProductNode",Gc);this.apiCore.register(this,"rdr.initShaders",fc);this.apiCore.register(this,
"rdr.initSceneBuffers",Ec);this.apiCore.register(this,"rdr.initScenePhysics",Cb);this.apiCore.register(this,"rdr.addProductNodeInstanceToPhysics",pc);this.apiCore.register(this,"rdr.updateSceneMaterials",tb);this.apiCore.register(this,"rdr.updateSceneLights",Hc);this.apiCore.register(this,"rdr.updateShaders",Lb);this.apiCore.register(this,"rdr.updateEnvironmentCubes",bd);this.apiCore.register(this,"rdr.getCurrentScene",Pb,!0);this.apiCore.register(this,"rdr.getWebGLContext",cc,!0);this.apiCore.register(this,
"rdr.loadPolylistBuffers",Ub);this.apiCore.register(this,"rdr.unloadPolylistBuffers",sb);this.apiCore.register(this,"setEditionMode",L);this.apiCore.register(this,"rdr.selectLight",K);this.apiCore.register(this,"rdr.deselectLight",G);this.apiCore.register(this,"rdr.selectNode",ia);this.apiCore.register(this,"rdr.deselectNode",Q);this.apiCore.register(this,"rdr.moveSelectedNodes",ta);this.apiCore.register(this,"rdr.selectPolylist",oa);this.apiCore.register(this,"rdr.deselectPolylist",ba);this.apiCore.register(this,
"rdr.onPolylistClicked",ka);this.apiCore.register(this,"rdr.onPolylistsSelected",Z);this.apiCore.register(this,"rdr.setTransformationTool",da);this.apiCore.register(this,"rdr.startTransformation",X,!0);this.apiCore.register(this,"rdr.applyTransformation",Ha);this.apiCore.register(this,"rdr.startSelectionSquare",Ga);this.apiCore.register(this,"rdr.updateSelectionSquare",Fa);this.apiCore.register(this,"rdr.endSelectionSquare",xa,!0);this.apiCore.register(this,"rdr.showPolylists",Ia);this.apiCore.register(this,
"rdr.hidePolylists",qa);this.apiCore.register(this,"rdr.showMaterials",Va);this.apiCore.register(this,"rdr.hideMaterials",va);this.apiCore.register(this,"rdr.showMaterialTrees",la);this.apiCore.register(this,"rdr.hideMaterialTrees",fa);this.apiCore.register(this,"rdr.renderProductNodeInstanceAsGhost",Ba);this.apiCore.register(this,"rdr.renderProductNodeInstancesAsGhost",Ka);this.apiCore.register(this,"rdr.show",vc);this.apiCore.register(this,"rdr.hide",Ic);this.apiCore.register(this,"rdr.takePolylistsDataScreenshot",
Yd,!0);this.apiCore.register(this,"rdr.getRenderingOrder",Zd,!0);this.apiCore.register(this,"rdr.getMaterialsShaders",je,!0);this.apiCore.register(this,"mouseButtonPress",Tb);this.apiCore.register(this,"mouseButtonRelease",wc);this.apiCore.register(this,"mousePosUpdate",pd);this.apiCore.register(this,"onViewerVisible",bc);this.apiCore.register(this,"setAnimationSpeed",Uc);this.apiCore.register(this,"setNextDeltaT",Lc);this.materialPreviewManagement&&this.materialPreviewManagement.registerInApi()},
g=function(b){if(b.scenery.environmentTexture&&b.scenery.environmentTexture.finalImage&&b.scenery.environmentTexture.finalImage.glTexture&&(b.scenery.environmentModified=!0,b.dfglut&&!this.gl.floatTextures)){b.scenery.environmentModified=!0;this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1);for(var d=0;d<b.environmentTextures.length;++d)switch(this.gl.bindTexture(this.gl.TEXTURE_2D,b.environmentTextures[d].finalImage.glTexture),b.environmentTextures[d].finalImage.currentWidth){case 2048:this.gl.texSubImage2D(this.gl.TEXTURE_2D,
0,0,0,b.dfglut.size,b.dfglut.size,this.gl.RGBA,this.gl.UNSIGNED_BYTE,b.dfglut.pixels);this.gl.texSubImage2D(this.gl.TEXTURE_2D,0,2048-b.dfglut.size,0,b.dfglut.size,b.dfglut.size,this.gl.RGBA,this.gl.UNSIGNED_BYTE,b.dfglut.pixels2);break;case 1024:this.gl.texSubImage2D(this.gl.TEXTURE_2D,0,0,0,b.dfglut.size/2,b.dfglut.size/2,this.gl.RGBA,this.gl.UNSIGNED_BYTE,b.dfglut.halfPixels),this.gl.texSubImage2D(this.gl.TEXTURE_2D,0,1024-b.dfglut.size/2,0,b.dfglut.size/2,b.dfglut.size/2,this.gl.RGBA,this.gl.UNSIGNED_BYTE,
b.dfglut.halfPixels2),this.gl.texSubImage2D(this.gl.TEXTURE_2D,0,128,0,b.dfglut.size/2,b.dfglut.size/2,this.gl.RGBA,this.gl.UNSIGNED_BYTE,b.dfglut.halfPixels3)}this.gl.bindTexture(this.gl.TEXTURE_2D,null);this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!0);this.gl.flush();this.gl.finish()}};l.prototype.destroy=function(){this.destroyed||(this.destroyed=!0,this.gl.deleteBuffer(this.vertexBufferScreen),this.gl.deleteBuffer(this.uvBufferScreen),this.gl.deleteBuffer(this.elementsBufferScreen),this.gl.deleteTexture(this.dummyTexture),
this.gl.deleteTexture(this.dummyTextureCube),this.gl.deleteTexture(this.dummyTexture2dArray),this.initialized&&(this.apiCore.unregister(this,"resize"),this.apiCore.unregister(this,"rdr.getCanvasSize"),this.apiCore.unregister(this,"setStatId"),this.apiCore.unregister(this,"rdr.takeScreenshot"),this.apiCore.unregister(this,"rdr.takeDepthScreenshot"),this.apiCore.unregister(this,"rdr.takeScreenshots"),this.apiCore.unregister(this,"rdr.takeTiledScreenshot"),this.apiCore.unregister(this,"rdr.takeEncodedScreenshot"),
this.apiCore.unregister(this,"rdr.takeConfigurationScreenshot"),this.apiCore.unregister(this,"rdr.takePolylistScreenshot"),this.apiCore.unregister(this,"rdr.setBackgroundColor"),this.apiCore.unregister(this,"rdr.setBackgroundImage"),this.apiCore.unregister(this,"rdr.removeBackgroundImage"),this.apiCore.unregister(this,"rdr.setBackgroundVideoTexture"),this.apiCore.unregister(this,"rdr.removeBackgroundVideoTexture"),this.apiCore.unregister(this,"rdr.updateBackgroundSize"),this.apiCore.unregister(this,
"rdr.getBackgroundColor"),this.apiCore.unregister(this,"rdr.setHighlightColors"),this.apiCore.unregister(this,"rdr.setAnnotations"),this.apiCore.unregister(this,"rdr.setFirstRulerPoint"),this.apiCore.unregister(this,"rdr.setSecondRulerPoint"),this.apiCore.unregister(this,"rdr.getUnderMousePolylist"),this.apiCore.unregister(this,"rdr.getUnderMouseLight"),this.apiCore.unregister(this,"rdr.getUnderMouseModularConnector"),this.apiCore.unregister(this,"rdr.getPolylistInstanceScreenPosition"),this.apiCore.unregister(this,
"rdr.getSceneScreenPosition"),this.apiCore.unregister(this,"rdr.getGroundPosition"),this.apiCore.unregister(this,"rdr.getProductNodesPositions"),this.apiCore.unregister(this,"rdr.getScreenPosition"),this.apiCore.unregister(this,"rdr.toggleRendering"),this.apiCore.unregister(this,"rdr.toggleNodeAnimations"),this.apiCore.unregister(this,"rdr.toggleMaterialAnimations"),this.apiCore.unregister(this,"rdr.toggleSSAO"),this.apiCore.unregister(this,"rdr.toggleSSAOFiltering"),this.apiCore.unregister(this,
"rdr.toggleSilhouettes"),this.apiCore.unregister(this,"rdr.toggleMirror"),this.apiCore.unregister(this,"rdr.toggleWater"),this.apiCore.unregister(this,"rdr.toggleBlur"),this.apiCore.unregister(this,"rdr.toggleGlow"),this.apiCore.unregister(this,"rdr.toggleTonemapping"),this.apiCore.unregister(this,"rdr.toggleRulers"),this.apiCore.unregister(this,"rdr.changeRenderingMode"),this.apiCore.unregister(this,"rdr.setDownscale"),this.apiCore.unregister(this,"rdr.setDepthAndNormalsReduction"),this.apiCore.unregister(this,
"rdr.setBlurReduction"),this.apiCore.unregister(this,"rdr.setMirrorReduction"),this.apiCore.unregister(this,"rdr.setSsaoReduction"),this.apiCore.unregister(this,"rdr.setSsaoIntensity"),this.apiCore.unregister(this,"rdr.setSsaoIntensity2"),this.apiCore.unregister(this,"rdr.setSsaoRadius"),this.apiCore.unregister(this,"rdr.setSsaoThickness"),this.apiCore.unregister(this,"rdr.setSsaoRadius2"),this.apiCore.unregister(this,"rdr.setSsaoThickness2"),this.apiCore.unregister(this,"rdr.setSsaoEmissiveThreshold"),
this.apiCore.unregister(this,"rdr.setSsaoOpacityThreshold"),this.apiCore.unregister(this,"rdr.setSsaoNormalDisplacement"),this.apiCore.unregister(this,"rdr.setGraininess"),this.apiCore.unregister(this,"rdr.setGrainOnStop"),this.apiCore.unregister(this,"rdr.setGlowReduction"),this.apiCore.unregister(this,"rdr.setMinimumQualityAndTargetFramerate"),this.apiCore.unregister(this,"rdr.setMultisampling"),this.apiCore.unregister(this,"rdr.setSsaaOnStop"),this.apiCore.unregister(this,"rdr.setForceGlobalFramebuffer"),
this.apiCore.unregister(this,"rdr.setAntialiasing"),this.apiCore.unregister(this,"rdr.setSSAARenderMode"),this.apiCore.unregister(this,"rdr.setSSAASampleCount"),this.apiCore.unregister(this,"rdr.setSSAORenderMode"),this.apiCore.unregister(this,"rdr.setMipmappedEnv"),this.apiCore.unregister(this,"rdr.setScreenSpaceReflectDistance"),this.apiCore.unregister(this,"rdr.setScreenSpaceRefractDistance"),this.apiCore.unregister(this,"rdr.changeCameraMode"),this.apiCore.unregister(this,"rdr.toggleAxes"),this.apiCore.unregister(this,
"rdr.toggleSelectedNodeAxes"),this.apiCore.unregister(this,"rdr.toggleGrid"),this.apiCore.unregister(this,"rdr.toggleBBoxes"),this.apiCore.unregister(this,"rdr.toggleFramerate"),this.apiCore.unregister(this,"rdr.toggleLights"),this.apiCore.unregister(this,"rdr.isRendering"),this.apiCore.unregister(this,"rdr.isAnimatingNodes"),this.apiCore.unregister(this,"rdr.isAnimatingMaterials"),this.apiCore.unregister(this,"rdr.isUsingSSAO"),this.apiCore.unregister(this,"rdr.isFilteringSSAO"),this.apiCore.unregister(this,
"rdr.getRenderingMode"),this.apiCore.unregister(this,"rdr.getCameraMode"),this.apiCore.unregister(this,"rdr.isRenderingAxes"),this.apiCore.unregister(this,"rdr.isRenderingGrid"),this.apiCore.unregister(this,"rdr.isRenderingBBoxes"),this.apiCore.unregister(this,"rdr.isRenderingFramerate"),this.apiCore.unregister(this,"rdr.isRenderingLights"),this.apiCore.unregister(this,"rdr.isRenderingSilhouettes"),this.apiCore.unregister(this,"rdr.isRenderingMirrors"),this.apiCore.unregister(this,"rdr.isRenderingWater"),
this.apiCore.unregister(this,"rdr.isRenderingBlur"),this.apiCore.unregister(this,"rdr.isRenderingGlow"),this.apiCore.unregister(this,"rdr.isUsingTonemapping"),this.apiCore.unregister(this,"rdr.getDownscale"),this.apiCore.unregister(this,"rdr.getDepthAndNormalsReduction"),this.apiCore.unregister(this,"rdr.getBlurReduction"),this.apiCore.unregister(this,"rdr.getMirrorReduction"),this.apiCore.unregister(this,"rdr.getSsaoReduction"),this.apiCore.unregister(this,"rdr.getGraininess"),this.apiCore.unregister(this,
"rdr.getSsaoEmissiveThreshold"),this.apiCore.unregister(this,"rdr.getSsaoOpacityThreshold"),this.apiCore.unregister(this,"rdr.getGlowReduction"),this.apiCore.unregister(this,"rdr.getWebGLCapabilities"),this.apiCore.unregister(this,"setScene"),this.apiCore.unregister(this,"startRendering"),this.apiCore.unregister(this,"rdr.forceUpdate"),this.apiCore.unregister(this,"rdr.deallocateScene"),this.apiCore.unregister(this,"rdr.deallocateProductNode"),this.apiCore.unregister(this,"rdr.reallocateProductNode"),
this.apiCore.unregister(this,"rdr.initShaders"),this.apiCore.unregister(this,"rdr.initSceneBuffers"),this.apiCore.unregister(this,"rdr.initScenePhysics"),this.apiCore.unregister(this,"rdr.addProductNodeInstanceToPhysics"),this.apiCore.unregister(this,"rdr.updateSceneMaterials"),this.apiCore.unregister(this,"rdr.updateSceneLights"),this.apiCore.unregister(this,"rdr.updateShaders"),this.apiCore.unregister(this,"rdr.updateEnvironmentCubes"),this.apiCore.unregister(this,"rdr.getCurrentScene"),this.apiCore.unregister(this,
"rdr.getWebGLContext"),this.apiCore.unregister(this,"rdr.loadPolylistBuffers"),this.apiCore.unregister(this,"rdr.unloadPolylistBuffers"),this.apiCore.unregister(this,"setEditionMode"),this.apiCore.unregister(this,"rdr.selectLight"),this.apiCore.unregister(this,"rdr.deselectLight"),this.apiCore.unregister(this,"rdr.selectNode"),this.apiCore.unregister(this,"rdr.deselectNode"),this.apiCore.unregister(this,"rdr.moveSelectedNodes"),this.apiCore.unregister(this,"rdr.selectPolylist"),this.apiCore.unregister(this,
"rdr.deselectPolylist"),this.apiCore.unregister(this,"rdr.onPolylistClicked"),this.apiCore.unregister(this,"rdr.onPolylistsSelected"),this.apiCore.unregister(this,"rdr.setTransformationTool"),this.apiCore.unregister(this,"rdr.startTransformation"),this.apiCore.unregister(this,"rdr.applyTransformation"),this.apiCore.unregister(this,"rdr.startSelectionSquare"),this.apiCore.unregister(this,"rdr.updateSelectionSquare"),this.apiCore.unregister(this,"rdr.endSelectionSquare"),this.apiCore.unregister(this,
"rdr.showPolylists"),this.apiCore.unregister(this,"rdr.hidePolylists"),this.apiCore.unregister(this,"rdr.showMaterials"),this.apiCore.unregister(this,"rdr.hideMaterials"),this.apiCore.unregister(this,"rdr.showMaterialTrees"),this.apiCore.unregister(this,"rdr.hideMaterialTrees"),this.apiCore.unregister(this,"rdr.renderProductNodeInstanceAsGhost"),this.apiCore.unregister(this,"rdr.renderProductNodeInstancesAsGhost"),this.apiCore.unregister(this,"rdr.show"),this.apiCore.unregister(this,"rdr.hide"),this.apiCore.unregister(this,
"rdr.takePolylistsDataScreenshot"),this.apiCore.unregister(this,"rdr.getRenderingOrder"),this.apiCore.unregister(this,"rdr.getMaterialsShaders"),this.apiCore.unregister(this,"mouseButtonPress"),this.apiCore.unregister(this,"mouseButtonRelease"),this.apiCore.unregister(this,"mousePosUpdate"),this.apiCore.unregister(this,"onViewerVisible"),this.apiCore.unregister(this,"rdr.bakeFurMap"),this.apiCore.unregister(this,"rdr.setFurQuality"),this.apiCore.unregister(this,"setAnimationSpeed"),this.apiCore.unregister(this,
"setNextDeltaT"),this.apiCore.unregister(this,"rdr.setPerformanceOptimisation"),this.materialPreviewManagement&&this.materialPreviewManagement.unregisterFromApi(),this.apiCore=null,this.scene&&jc.call(this,this.scene,null),void 0!==this.meshes&&null!==this.meshes&&this.meshes.destroy(),void 0!==this.shaders&&null!==this.shaders&&this.shaders.deallocate(),void 0!==this.filters&&null!==this.filters&&this.filters.deallocate(),this.meshEditor&&this.meshEditor.deallocate(),this.lightsEditor&&this.lightsEditor.deallocate(),
this.modularEditor&&this.modularEditor.deallocate(),void 0!==this.screenTools&&null!==this.screenTools&&this.screenTools.deallocate(),this.lightsManager&&this.lightsManager.deallocate(),this.materialPreviewManagement&&this.materialPreviewManagement.deallocate(),this.imageFilterManagement&&this.imageFilterManagement.deallocate(),delete this.renderingData,delete this.meshes,delete this.shaders,delete this.filters,delete this.lightsManager,delete this.meshEditor,delete this.lightsEditor,delete this.screenTools,
delete this.materialPreviewManagement,delete this.imageFilterManagement,this.gl.deleteBuffer(this.backgroundTexCoord),Wc.call(this),Mc.call(this),kc.call(this),this.gl.deleteTexture(this.glowTexture),this.gl.deleteTexture(this.glow2Texture),this.gl.deleteTexture(this.positionsTexture),this.gl.deleteTexture(this.normalsAndDepthTexture),this.gl.deleteTexture(this.samplesTexture),this.gl.deleteTexture(this.backgroundTexture),this.gl.deleteTexture(this.textTexture),this.gl.deleteTexture(this.waterTexture),
this.gl.deleteTexture(this.noiseTexture),this.gl.deleteTexture(this.rulerTextureWidth),this.gl.deleteTexture(this.rulerTextureDepth),this.gl.deleteTexture(this.rulerTextureHeight),this.gl.deleteTexture(this.specularGlowTexture),this.gl.deleteTexture(this.highlightPositionsTexture),this.gl.deleteTexture(this.highlightRenderTexture),this.gl.deleteFramebuffer(this.glowFramebuffer),this.gl.deleteFramebuffer(this.positionsDepthAndNormalsFramebuffer),this.gl.deleteFramebuffer(this.blurFramebuffer),this.gl.deleteFramebuffer(this.waterFramebuffer),
this.gl.deleteFramebuffer(this.specularGlowFramebuffer),this.gl.deleteFramebuffer(this.hightlightFramebuffer),this.gl.deleteRenderbuffer(this.glowRenderbuffer),this.gl.deleteRenderbuffer(this.depthAndNormalsRenderbuffer),this.gl.deleteRenderbuffer(this.blurRenderbuffer),this.gl.deleteRenderbuffer(this.waterRenderbuffer),this.gl.deleteRenderbuffer(this.specularGlowRenderbuffer),this.gl.deleteRenderbuffer(this.highlightRenderbuffer),this.gl.deleteTexture(this.mirrorTexture),this.gl.deleteFramebuffer(this.mirrorFramebuffer),
this.gl.deleteRenderbuffer(this.mirrorRenderbuffer),this.gl.deleteTexture(this.blurTexture),this.gl.deleteBuffer(this.squareVBuffer),this.gl.deleteBuffer(this.squareIBuffer),this.gl.deleteBuffer(this.axesVBuffer),this.gl.deleteBuffer(this.axesCBuffer),this.gl.deleteBuffer(this.axesIBuffer),this.gl.deleteBuffer(this.gridVBuffer),this.gl.deleteBuffer(this.gridIBuffer),this.gl.deleteBuffer(this.gridVBufferP),this.gl.deleteBuffer(this.gridIBufferP),this.gl.deleteBuffer(this.cubeVBuffer),this.gl.deleteBuffer(this.cubeIBuffer),
this.vertexBufferFramerate&&this.gl.deleteBuffer(this.vertexBufferFramerate),this.vertexBufferRuler&&this.gl.deleteBuffer(this.vertexBufferRuler),this.elementsBufferRuler&&this.gl.deleteBuffer(this.elementsBufferRuler)),this.renderingData=null,this.envDFGLUTTexture&&this.gl.deleteTexture(this.envDFGLUTTexture),this.envDFGLUTCTLambertTexture&&this.gl.deleteTexture(this.envDFGLUTCTLambertTexture),this.envTexture&&(this.gl.deleteTexture(this.envTexture),this.gl.deleteFramebuffer(this.envFramebuffer),
this.gl.deleteRenderbuffer(this.envRenderbuffer)),this.canvas&&(this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas),this.canvas.width=0,this.canvas.height=0,delete this.canvas,this.canvasFramerate&&this.canvasFramerate.parentNode&&this.canvasFramerate.parentNode.removeChild(this.canvasFramerate),delete this.canvasFramerate,delete this.gl.filters,delete this.gl.extendedWebGLContext,delete this.gl),this.scene=this.currentShaderType=null)};var q=function(b){this.statId=b},t=function(){this.gl.maxTextureUnits=
this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS);this.gl.webgl2?(this.gl.oestexturefloatlinear=this.gl.getExtension("OES_texture_float_linear"),this.gl.colorbufferfloat=this.gl.getExtension("EXT_color_buffer_float"),this.gl.floatblend=this.gl.getExtension("EXT_float_blend"),this.gl.depthTextures=!0,this.gl.floatTextures=!!(this.gl.colorbufferfloat&&this.gl.oestexturefloatlinear&&this.gl.floatblend),this.gl.halfFloatTextures=!!(this.gl.colorbufferfloat&&this.gl.oestexturefloatlinear&&this.gl.floatblend),
this.gl.halfFloatTexturesForEnvCubes=!((!this.gl.colorbufferfloat||"iPad"!=navigator.platform&&"iPhone"!=navigator.platform)&&!this.gl.oestexturefloatlinear)):(this.gl.mrt=this.gl.getExtension("WEBGL_draw_buffers"),this.gl.oeselementindexuint=this.gl.getExtension("OES_element_index_uint"),this.gl.oestexturefloat=this.gl.getExtension("OES_texture_float"),this.gl.oestexturehalffloat=this.gl.getExtension("OES_texture_half_float"),this.gl.oestexturefloatlinear=this.gl.getExtension("OES_texture_float_linear"),
this.gl.oestexturehalffloatlinear=this.gl.getExtension("OES_texture_half_float_linear"),this.gl.floatblend=this.gl.getExtension("EXT_float_blend"),this.gl.colorbufferfloat=this.gl.getExtension("WEBGL_color_buffer_float"),this.gl.colorbufferhalffloat=this.gl.getExtension("EXT_color_buffer_half_float"),this.settings.mipmappedEnvironment&&-1===window.unmaskedRendererWebGL.indexOf("mali")&&(this.gl.shadertexturelod=this.gl.getExtension("EXT_shader_texture_lod")),this.gl.floatTextures=!!(this.gl.oestexturefloat&&
this.gl.oestexturefloatlinear&&this.gl.colorbufferfloat&&this.gl.floatblend),this.gl.halfFloatTextures=!!(this.gl.oestexturehalffloat&&this.gl.oestexturehalffloatlinear&&(this.gl.colorbufferfloat||this.gl.colorbufferhalffloat)&&this.gl.floatblend),this.gl.halfFloatTexturesForEnvCubes=!(!this.gl.oestexturehalffloat||!this.gl.oestexturehalffloatlinear||!this.gl.colorbufferfloat&&!this.gl.colorbufferhalffloat),this.gl.oestexturehalffloat&&(this.gl.HALF_FLOAT=this.gl.oestexturehalffloat.HALF_FLOAT_OES),
this.gl.oesstddrv=this.gl.getExtension("OES_standard_derivatives"),this.gl.gloesstddrv=this.gl.getExtension("GL_OES_standard_derivatives"),this.gl.depthTextures=this.gl.getExtension("WEBGL_depth_texture"));this.gl.useEnvCubes=!0;this.gl.anisotropicTexture=this.gl.getExtension("EXT_texture_filter_anisotropic");this.gl.anisotropicTexture&&(this.gl.maxAnisotropy=this.gl.getParameter(this.gl.anisotropicTexture.MAX_TEXTURE_MAX_ANISOTROPY_EXT));(this.gl.floatTextures||this.gl.halfFloatTextures)&&r.call(this);
this.gl.floatTextures||(this.settings.renderHighlightedSilhouettes=!1,this.settings.renderSilhouettes=!1,this.settings.filterShadowMaps=!1);this.gl.lineWidth(2);this.gl.getError()!==this.gl.NO_ERROR&&(this.gl.lineWidth=function(){});this.gl.lineWidth(1);this.forceSFX=-1!==window.location.href.indexOf("/publish/");this.maxSamples=this.gl.MAX_SAMPLES?this.gl.getParameter(this.gl.MAX_SAMPLES):1;this.depthAccuracy=1E4;(this.mobilBrowser=stage.browser.mobilBrowser||"iPad"==navigator.platform||"iPhone"==
navigator.platform)?(this.settings.filterShadowMaps=!1,this.depthAccuracy=1E3,this.maxSamples=Math.min(4,this.maxSamples)):this.maxSamples=Math.min(8,this.maxSamples)},r=function(){var b=this.gl.createProgram(),d=this.gl.createShader(this.gl.VERTEX_SHADER),e=this.gl.createShader(this.gl.FRAGMENT_SHADER);this.gl.webgl2?(this.gl.shaderSource(d,"#version 300 es\nprecision highp float;\nin vec3 ymaxekn;\nuniform mat4 ampnorz;\nuniform mat4 uPMatrix;\nvoid main() {\n\tgl_Position = uPMatrix * ampnorz * vec4(ymaxekn, 1.0);\n}\n"),
this.gl.shaderSource(e,"#version 300 es\nprecision highp float;\nuniform sampler2D dkgckvl;\nout vec4 _gl_FragColor;\nvoid main() {\n\t_gl_FragColor = vec4(10.0,0.0,0.0,1.0);\n}\n")):(this.gl.shaderSource(d,"precision highp float;\nattribute vec3 ymaxekn;\nuniform mat4 ampnorz;\nuniform mat4 uPMatrix;\nvoid main() {\n\tgl_Position = uPMatrix * ampnorz * vec4(ymaxekn, 1.0);\n}\n"),this.gl.shaderSource(e,"precision highp float;\nuniform sampler2D dkgckvl;\nvoid main() {\n\tgl_FragColor = vec4(10.0,0.0,0.0,1.0);\n}\n"));
this.gl.compileShader(d);this.gl.compileShader(e);this.gl.attachShader(b,d);this.gl.attachShader(b,e);this.gl.linkProgram(b);this.gl.bindAttribLocation(b,0,"ymaxekn");var f=this.gl.createFramebuffer(),h=this.gl.createTexture();this.gl.bindTexture(this.gl.TEXTURE_2D,h);this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA32F,1,1,0,this.gl.RGBA,this.gl.FLOAT,null);this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.NEAREST);this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,
this.gl.NEAREST);this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE);this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE);if(this.gl.getError()!==this.gl.NO_ERROR)this.gl.bindTexture(this.gl.TEXTURE_2D,null),this.gl.floatTextures=!1;else if(this.gl.bindTexture(this.gl.TEXTURE_2D,null),this.gl.getShaderParameter(d,this.gl.COMPILE_STATUS)||(this.gl.floatTextures=!1),this.gl.getShaderParameter(e,this.gl.COMPILE_STATUS)||(this.gl.floatTextures=
!1),this.gl.getProgramParameter(b,this.gl.LINK_STATUS)||(this.gl.floatTextures=!1),this.gl.floatTextures){this.gl.useProgram(b);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,f);this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,h,0);this.gl.viewport(0,0,1,1);this.gl.scissor(0,0,1,1);this.gl.enable(this.gl.SCISSOR_TEST);this.gl.disable(this.gl.DEPTH_TEST);this.gl.enable(this.gl.BLEND);this.gl.clearColor(1,0,0,1);this.gl.clear(this.gl.COLOR_BUFFER_BIT);this.gl.uniformMatrix4fv(this.gl.getUniformLocation(b,
"ampnorz"),!1,this.screenViewMatrix);this.gl.uniformMatrix4fv(this.gl.getUniformLocation(b,"uPMatrix"),!1,this.screenTransfMatrix);this.gl.enableVertexAttribArray(0);this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexBufferScreen);this.gl.vertexAttribPointer(0,3,this.gl.FLOAT,!1,0,0);this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.elementsBufferScreen);this.gl.drawElements(this.gl.TRIANGLES,6,this.gl.UNSIGNED_SHORT,0);this.gl.getError()!==this.gl.NO_ERROR&&(this.gl.floatTextures=!1);var m=new Float32Array(4);
this.gl.readPixels(0,0,1,1,this.gl.RGBA,this.gl.FLOAT,m);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null);if(10!==m[0]||0!==m[1]||0!==m[2]||1!==m[3])this.gl.floatTextures=!1;this.gl.enable(this.gl.DEPTH_TEST)}for(;this.gl.getError()!==this.gl.NO_ERROR&&10>++p;);this.gl.bindTexture(this.gl.TEXTURE_2D,h);this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA16F,1,1,0,this.gl.RGBA,this.gl.HALF_FLOAT,null);if(this.gl.getError()!==this.gl.NO_ERROR)this.gl.bindTexture(this.gl.TEXTURE_2D,null),this.gl.halfFloatTextures=
!1;else if(this.gl.bindTexture(this.gl.TEXTURE_2D,null),this.gl.getShaderParameter(d,this.gl.COMPILE_STATUS)||(this.gl.halfFloatTextures=!1),this.gl.getShaderParameter(e,this.gl.COMPILE_STATUS)||(this.gl.halfFloatTextures=!1),this.gl.getProgramParameter(b,this.gl.LINK_STATUS)||(this.gl.halfFloatTextures=!1),this.gl.halfFloatTextures){this.gl.useProgram(b);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,f);this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,h,
0);this.gl.viewport(0,0,1,1);this.gl.scissor(0,0,1,1);this.gl.enable(this.gl.SCISSOR_TEST);this.gl.disable(this.gl.DEPTH_TEST);this.gl.enable(this.gl.BLEND);this.gl.clearColor(1,0,0,1);this.gl.clear(this.gl.COLOR_BUFFER_BIT);this.gl.uniformMatrix4fv(this.gl.getUniformLocation(b,"ampnorz"),!1,this.screenViewMatrix);this.gl.uniformMatrix4fv(this.gl.getUniformLocation(b,"uPMatrix"),!1,this.screenTransfMatrix);this.gl.enableVertexAttribArray(0);this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexBufferScreen);
this.gl.vertexAttribPointer(0,3,this.gl.FLOAT,!1,0,0);this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.elementsBufferScreen);this.gl.drawElements(this.gl.TRIANGLES,6,this.gl.UNSIGNED_SHORT,0);this.gl.getError()!==this.gl.NO_ERROR&&(this.gl.halfFloatTextures=!1);if("firefox"===stage.browser.navigator.toLowerCase()){if(m=new Float32Array(4),this.gl.readPixels(0,0,1,1,this.gl.RGBA,this.gl.FLOAT,m),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),10!==m[0]||0!==m[1]||0!==m[2]||1!==m[3])this.gl.halfFloatTextures=
!1}else if(m=new Uint16Array(4),this.gl.readPixels(0,0,1,1,this.gl.RGBA,this.gl.HALF_FLOAT,m),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),18688!==m[0]||0!==m[1]||0!==m[2]||15360!==m[3])this.gl.halfFloatTextures=!1;this.gl.enable(this.gl.DEPTH_TEST)}this.gl.deleteProgram(b);this.gl.deleteFramebuffer(f);this.gl.deleteTexture(h);for(var p=0;this.gl.getError()!==this.gl.NO_ERROR&&10>++p;);},f=function(){return{webgl2:!!this.gl.webgl2,oestexturefloatlinear:!!this.gl.oestexturefloatlinear,colorbufferfloat:!!this.gl.colorbufferfloat,
floatblend:!!this.gl.floatblend,floatTextures:!!this.gl.floatTextures,halfFloatTextures:!!this.gl.halfFloatTextures,halfFloatTexturesForEnvCubes:!!this.gl.halfFloatTexturesForEnvCubes,mrt:this.gl.webgl2?!0:!!this.gl.mrt,shadertexturelod:this.gl.webgl2?!0:!!this.gl.shadertexturelod,depthTextures:this.gl.webgl2?!0:!!this.gl.depthTextures,oesstddrv:this.gl.webgl2?!0:!!this.gl.oesstddrv,gloesstddrv:this.gl.webgl2?!0:!!this.gl.gloesstddrv}},n=function(b,d){b=Math.max(b,1);d=Math.max(d,1);if(this.canvas.width!=
Math.round(b*this.maxScaling)||this.canvas.height!=Math.round(d*this.maxScaling)){this.resizing=!0;this.realSize=[b,d];this.renderingData.realSize=this.realSize;this.canvas.width=Math.round(b*this.maxScaling);this.canvas.height=Math.round(d*this.maxScaling);if(/webOS|iPhone|iPad|iPod/i.test(navigator.platform)){var e=$$stage(".canvasContainer").next(),f=$$stage(".canvasContainer");f.detach();f.attach(e.get(0),"before")}this.gl.viewportWidth=this.canvas.width;this.gl.viewportHeight=this.canvas.height;
this.cameraModeChanged=this.init=!0;this.scene&&this.currentCamera&&Wa.call(this,this.currentCamera);E.call(this);gc.call(this);Nc.call(this);mb.call(this);Jc.call(this);(this.gl.mrt||this.gl.webgl2)&&qd.call(this);qc.call(this);cd.call(this);Vb.call(this);fd.call(this);Xc.call(this);Db.call(this);this.screenTools&&this.screenTools.setSize(b*this.maxScaling,d*this.maxScaling);this.lightsEditor&&this.lightsEditor.setSize(b*this.maxScaling,d*this.maxScaling);this.modularEditor&&this.modularEditor.setSize(b*
this.maxScaling,d*this.maxScaling);this.gl.flush();this.resized=!0;this.resizing=!1;this.scene&&this.scene.update()}},B=function(){return{0:this.canvas.width/this.maxScaling,1:this.canvas.height/this.maxScaling,width:this.canvas.width/this.maxScaling,height:this.canvas.height/this.maxScaling}},w=function(b,d){c=7<b.length?this.apiCore.exec(this.callerName,"lib.hexToRgba",b):this.apiCore.exec(this.callerName,"lib.hexToRgb",b);void 0===d&&(d=c.a?c.a/255:1);c&&(this.clearColor.r=c.r/255,this.clearColor.g=
c.g/255,this.clearColor.b=c.b/255,this.backgroundTexture||(this.clearColor.a=parseFloat(d)),this.scene&&this.scene.update(),this.clearColor.r*=this.clearColor.a,this.clearColor.g*=this.clearColor.a,this.clearColor.b*=this.clearColor.a)},D=function(b,d,e,f,h){this.backgroundTexture?this.gl.bindTexture(this.gl.TEXTURE_2D,this.backgroundTexture):(this.backgroundTexture=this.gl.createTexture(),this.gl.bindTexture(this.gl.TEXTURE_2D,this.backgroundTexture),this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,
!0),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE));this.backgroundTextureWidth=b.width;this.backgroundTextureHeight=b.height;this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,
b);this.invertBackgroundX=!!h+0;this.backgroundFitting=d;this.backgroundAlpha=f;this.clearColor.a=1;this.backgroundOffset={x:e.x-.5,y:e.y-.5};E.call(this)},A=function(b,d){this.backgroundTexture!==b&&H.call(this);this.backgroundTexture=b;this.backgroundAlpha=1;this.backgroundFitting=0;this.backgroundOffset={x:0,y:0};this.gl.bindTexture(this.gl.TEXTURE_2D,b);this.backgroundTextureWidth=this.canvas.width;this.backgroundTextureHeight=this.canvas.height;this.backgroundVideoTransform=d;E.call(this)},H=
function(){this.backgroundTexture&&(this.gl.deleteTexture(this.backgroundTexture),this.backgroundTexture=null)},e=function(){H.call(this);this.backgroundVideoTransform=null},E=function(){if(void 0!==this.backgroundFitting){var b=this.gl.viewportWidth/this.gl.viewportHeight,d=this.backgroundTextureWidth/this.backgroundTextureHeight;switch(this.backgroundFitting){case 0:b>d?(b=this.gl.viewportHeight*this.backgroundTextureWidth/this.backgroundTextureHeight/this.gl.viewportWidth,b=(1/b-1)/2,b=new Float32Array([-b,
1,-b,0,1+b,0,1+b,1])):(b=this.gl.viewportWidth*this.backgroundTextureHeight/this.backgroundTextureWidth/this.gl.viewportHeight,b=(1/b-1)/2,b=new Float32Array([0,1+b,0,-b,1,-b,1,1+b]));break;case 1:b<d?(b=this.gl.viewportHeight*this.backgroundTextureWidth/this.backgroundTextureHeight/this.gl.viewportWidth,b=(1/b-1)/2,b=new Float32Array([-b,1,-b,0,1+b,0,1+b,1])):(b=this.gl.viewportWidth*this.backgroundTextureHeight/this.backgroundTextureWidth/this.gl.viewportHeight,b=(1/b-1)/2,b=new Float32Array([0,
1+b,0,-b,1,-b,1,1+b]));break;case 2:b=new Float32Array([0,1,0,0,1,0,1,1]);break;default:b=new Float32Array([0,1,0,0,1,0,1,1])}switch(this.backgroundFitting){case 0:case 1:b[0]+=this.backgroundOffset.x,b[2]+=this.backgroundOffset.x,b[4]+=this.backgroundOffset.x,b[6]+=this.backgroundOffset.x,b[1]+=this.backgroundOffset.y,b[3]+=this.backgroundOffset.y,b[5]+=this.backgroundOffset.y,b[7]+=this.backgroundOffset.y}this.backgroundTexCoord||(this.backgroundTexCoord=this.gl.createBuffer());this.gl.bindBuffer(this.gl.ARRAY_BUFFER,
this.backgroundTexCoord);this.gl.bufferData(this.gl.ARRAY_BUFFER,b,this.gl.STATIC_DRAW)}},F=function(){var b=Math.round(255*this.clearColor.r).toString(16);1===b.length&&(b="0"+b);var d=Math.round(255*this.clearColor.g).toString(16);1===d.length&&(d="0"+d);var e=Math.round(255*this.clearColor.b).toString(16);1===e.length&&(e="0"+e);return"#"+b+d+e},p=function(b){this.scene&&(this.scene.highlight.color=this.apiCore.exec(this.callerName,"lib.hexToRgba",b.highlight_color?b.highlight_color:"ffffff30",
!0),this.scene.highlight.borderColor=this.apiCore.exec(this.callerName,"lib.hexToRgba",b.highlight_border_color?b.highlight_border_color:"00000000",!0),this.scene.highlight.blendingMode=void 0!==b.highlight_blending_mode?b.highlight_blending_mode:1,this.scene.highlight.showSilhouettes=!!this.scene.highlight.borderColor[3])},m=function(b){if(this.scene){for(var d=0;d<this.scene.nodesInUse.length;++d)this.scene.nodesInUse[d].annotations=[];this.annotationsToCompute=[];this.hiddenAnnotationsToFire=[];
for(d in b){var e=vec3.create([b[d].x,b[d].y,b[d].z]),f=null;b[d].nodeLocalId?b[d].productNodeId?f=this.scene.productNodeInstancesByLocalId[b[d].nodeLocalId]:this.scene.sourceNodes[b[d].source_node]&&(f=this.scene.sourceNodes[b[d].source_node].duplicatedNodes[b[d].nodeLocalId]):this.scene.sourceNodes[b[d].source_node]&&(f=this.scene.sourceNodes[b[d].source_node].duplicatedNodes[1]);f&&f&&(f.annotations.push({id:b[d].id,pos:e,trueCounter:0,falseCounter:0,state:null}),-1==this.annotationsToCompute.lastIndexOf(f)&&
this.annotationsToCompute.push(f),this.hiddenAnnotationsToFire.push({id:b[d].id,x:0,y:0,z:0,visible:!1,displayed:!1,onViewport:!1,baseObj:f.annotations[f.annotations.length-1]}))}this.scene.update();this.lastFrameDrawn=!0}},h=function(b){this.rulerStart&&this.rulerPositions.splice(this.rulerPositions.indexOf(this.rulerStart),1);this.rulerStart=null;b&&(this.shaders.useOneColorShader(this.renderingData),this.gl.uniformMatrix4fv(this.renderingData.locations.ghgsnpw,!1,this.renderingData.unjitteredProjectionMatrix),
this.gl.uniformMatrix4fv(this.renderingData.locations.ampnorz,!1,this.renderingData.viewMatrix),(this.rulerStart=this.screenTools.getScenePoint(b))&&this.rulerPositions.push(this.rulerStart))},v=function(b){this.rulerEnd&&this.rulerPositions.splice(this.rulerPositions.indexOf(this.rulerEnd),1);this.rulerEnd=null;b&&(this.shaders.useOneColorShader(this.renderingData),this.gl.uniformMatrix4fv(this.renderingData.locations.ghgsnpw,!1,this.renderingData.unjitteredProjectionMatrix),this.gl.uniformMatrix4fv(this.renderingData.locations.ampnorz,
!1,this.renderingData.viewMatrix),this.rulerEnd=this.screenTools.getScenePoint(b))&&(this.rulerPositions.push(this.rulerEnd),this.rulerStart&&this.eventsManager.fireEvent("onMeasure",this.screenTools.getDistance(this.rulerStart,this.rulerEnd)))},I=function(b){if(!this.scene||this.stopDraw||0<this.scene.stopDraw)return null;this.shaders.useOneColorShader(this.renderingData);this.gl.uniformMatrix4fv(this.renderingData.locations.ghgsnpw,!1,this.renderingData.unjitteredProjectionMatrix);this.gl.uniformMatrix4fv(this.renderingData.locations.ampnorz,
!1,this.renderingData.viewMatrix);return this.screenTools.getUnderPosition({x:b.x*this.maxScaling,y:b.y*this.maxScaling},null!==this.currentEditor)},J=function(b){if(!this.scene||this.stopDraw||0<this.scene.stopDraw)return null;this.shaders.useOneColorShader(this.renderingData);this.gl.uniformMatrix4fv(this.renderingData.locations.ghgsnpw,!1,this.renderingData.unjitteredProjectionMatrix);this.gl.uniformMatrix4fv(this.renderingData.locations.ampnorz,!1,this.renderingData.viewMatrix);return this.lightsEditor.selection(this.scene,
{x:b.x*this.maxScaling,y:b.y*this.maxScaling})},M=function(b){if(!this.scene||this.stopDraw||0<this.scene.stopDraw)return null;this.shaders.useOneColorShader(this.renderingData);this.gl.uniformMatrix4fv(this.renderingData.locations.ghgsnpw,!1,this.renderingData.unjitteredProjectionMatrix);this.gl.uniformMatrix4fv(this.renderingData.locations.ampnorz,!1,this.renderingData.viewMatrix);return this.modularEditor.getUnderMouseConnector({x:b.x*this.maxScaling,y:b.y*this.maxScaling})},T=function(b){if(!this.scene||
this.stopDraw||0<this.scene.stopDraw)return null;this.shaders.useOneColorShader(this.renderingData);this.gl.uniformMatrix4fv(this.renderingData.locations.ghgsnpw,!1,this.renderingData.unjitteredProjectionMatrix);this.gl.uniformMatrix4fv(this.renderingData.locations.ampnorz,!1,this.renderingData.viewMatrix);return this.screenTools.getPolylistInstanceScreenPosition(b,this.maxScaling)},U=function(b,d,e){if(!this.scene)return null;if(d&&e){var f=this.gl.viewportWidth/this.maxScaling,h=this.gl.viewportHeight/
this.maxScaling;n.call(this,d,e)}var m=null;b&&(m=this.currentCamera,Wa.call(this,stage.extend(!0,{},this.currentCamera,b)));this.shaders.useOneColorShader(this.renderingData);this.gl.uniformMatrix4fv(this.renderingData.locations.ghgsnpw,!1,this.renderingData.unjitteredProjectionMatrix);this.gl.uniformMatrix4fv(this.renderingData.locations.ampnorz,!1,this.renderingData.viewMatrix);var p=this.screenTools.getSceneScreenPosition(this.maxScaling);d&&e&&n.call(this,f,h);b&&Wa.call(this,m);return p},R=
function(b,d,e){return this.screenTools.getGroundPosition({x:b*this.maxScaling,y:d*this.maxScaling},e)},aa=function(){this.shaders.useOneColorShader(this.renderingData);this.gl.uniformMatrix4fv(this.renderingData.locations.ghgsnpw,!1,this.renderingData.unjitteredProjectionMatrix);this.gl.uniformMatrix4fv(this.renderingData.locations.ampnorz,!1,this.renderingData.viewMatrix);var b=this.screenTools.trackProductNodes(0,this.maxScaling,this.cameraMode,!0).productNodes;return b=b.sort(function(b,d){return b.localId<
d.localId?-1:1})},C=function(b,d,e,f){if(e&&f){var h=this.gl.viewportWidth,m=this.gl.viewportHeight;this.gl.viewportWidth=e;this.gl.viewportHeight=f}if(d){var p=this.currentCamera;Wa.call(this,stage.extend(!0,{},this.currentCamera,d));b=this.screenTools.getScreenPosition({pt:b,node:null},e,f);Wa.call(this,p)}else b=this.screenTools.getScreenPosition({pt:b,node:null},e,f);e&&f&&(this.gl.viewportWidth=h,this.gl.viewportHeight=m);return b},L=function(b){switch(b){case stage.emersya.viewer.EDITION_MODES.LIGHT:this.shaders.createOneColorShader();
this.shaders.createShadowMapShader();this.shaders.createMeshEditingShader();this.shaders.createOpacityShadowMapShader(this.scene&&this.scene.materialsType);this.settings.renderLights=!0;this.settings.renderShadows=!0;this.currentEditor=this.lightsEditor;break;case stage.emersya.viewer.EDITION_MODES.MODULAR:this.shaders.createOneColorShader();this.shaders.createShadowMapShader();this.shaders.createMeshEditingShader();this.shaders.createShadowMapShader();this.settings.renderConnectors=!0;this.currentEditor=
this.modularEditor;break;case stage.emersya.viewer.EDITION_MODES.MESHES:this.shaders.createOneColorShader();this.shaders.createMeshEditingShader();this.settings.renderLights=!1;this.currentEditor=this.meshEditor;break;default:this.settings.renderLights=!1,this.settings.editionMode=!1,this.currentEditor=null}this.scene&&this.scene.update()},K=function(b){this.settings.renderLights&&(this.lightsEditor.selectLight(this.scene,b.type,b.id,b.target,!0),this.scene.update())},G=function(b){this.lightsEditor.selectLight(this.scene,
b.type,b.id,b.target,!1);this.scene.update()},S=function(b){this.apiCore.exec(this.callerName,"onNodeSelected",b)},Y=function(b){this.apiCore.exec(this.callerName,"onNodeDeselected",b)},ia=function(b){this.meshEditor.selectNode(b)},Q=function(b){this.meshEditor.deselectNode(b)},ta=function(b){b=this.meshes.moveSelectedNodes(this.scene,b);b.length&&(this.scene.update(),this.apiCore.exec(this.callerName,"onNodesMove",b))},ua=function(b){this.apiCore.exec(this.callerName,"onPolylistSelected",b)},ea=
function(b){this.apiCore.exec(this.callerName,"onPolylistDeselected",b)},oa=function(b){this.meshEditor.selectPolylist(b)},ba=function(b){this.meshEditor.deselectPolylist(b)},ka=function(b,d){if(this.scene)this.meshEditor.onPolylistClicked(this.scene.polylists[b],d)},Z=function(b){if(this.scene)this.meshEditor.onPolylistsSelected(b)},da=function(b){this.currentTransformationTool=b;this.scene&&this.scene.update()},X=function(b){return this.currentEditor.startTransformation({x:b.x*this.currentScaling,
y:b.y*this.currentScaling},this.currentTransformationTool)},Ha=function(b,d,e){b=this.currentEditor.applyTransformation(b,d,e);b.length&&(this.scene.update(),this.apiCore.exec(this.callerName,this.currentEditor.getUpdateEventName(),b),this.stillCnt=0)},Ga=function(b){this.squarePos1=b;this.scene&&this.scene.update();this.renderSelectionSquare=!0},Fa=function(b){this.squarePos2=b;this.scene&&this.scene.update()},xa=function(b){this.squarePos2=b;this.scene&&this.scene.update();this.renderSelectionSquare=
!1;this.shaders.useOneColorShader(this.renderingData);this.gl.uniformMatrix4fv(this.renderingData.locations.ghgsnpw,!1,this.renderingData.projectionMatrix);this.gl.uniformMatrix4fv(this.renderingData.locations.ampnorz,!1,this.renderingData.viewMatrix);return this.screenTools.getUnderSquare(this.squarePos1,this.squarePos2,null!==this.currentEditor)},Ia=function(b){for(var d in b)this.scene.polylists[b[d].id]&&(this.scene.polylists[b[d].id].isHidden=!1);this.scene.visibilityChanged=!0},qa=function(b){for(var d in b)this.scene.polylists[b[d].id]&&
(this.scene.polylists[b[d].id].isHidden=!0);this.scene.visibilityChanged=!0},Va=function(b){for(var d in b)this.scene.materials[b[d].id].isHidden=!1;this.scene.visibilityChanged=!0},va=function(b){for(var d in b)this.scene.materials[b[d].id].isHidden=!0;this.scene.visibilityChanged=!0},la=function(b){for(var d in b)this.scene.materialTrees[b[d].id].isHidden=!1;this.scene.visibilityChanged=!0},fa=function(b){for(var d in b)this.scene.materialTrees[b[d].id].isHidden=!0;this.scene.visibilityChanged=
!0},P=function(b,d,e){b.renderAsGhost=void 0===d?!b.renderAsGhost:d;if(b.renderAsGhost){this.ghostProductNodesPolyInstances[b.localId]=[];d={};for(var f=[b],h=0;h<f.length;++h){var m=f[h];1!=m.type&&(d[m.localId]=!0,e&&(f=f.concat(m.children)))}for(h=0;h<this.scene.polylistInstances.length;++h)e=this.scene.polylistInstances[h],d[e.node.localId]&&(e.isGhost=!0,this.ghostProductNodesPolyInstances[b.localId].push(e))}else if(this.ghostProductNodesPolyInstances[b.localId]){for(h=0;h<this.ghostProductNodesPolyInstances[b.localId].length;++h)this.ghostProductNodesPolyInstances[b.localId][h].isGhost=
!1;delete this.ghostProductNodesPolyInstances[b.localId]}this.renderGhosts&&this.settings.ghostCastShadow&&this.scene&&this.scene.hasSomeShadow&&!this.scene.stopDraw&&(this.scene.visibilityChanged=!0)},Ba=function(b,d,e){var f=0<Object.keys(this.ghostProductNodesPolyInstances).length;P.call(this,b,d,e);this.renderGhosts=0<Object.keys(this.ghostProductNodesPolyInstances).length;this.scene&&f!=this.renderGhosts&&(tb.call(this,this.scene),Lb.call(this,this.scene),this.scene.update(),this.scene.hasSomeShadow&&
(this.scene.visibilityChanged=!0))},Ka=function(b,d){for(var e=0;e<b.length;++e)P.call(this,b[e].instance,b[e].renderAsGhost,d);this.renderGhosts=0<Object.keys(this.ghostProductNodesPolyInstances).length;this.scene&&(this.renderGhosts&&(tb.call(this,this.scene),Lb.call(this,this.scene)),this.scene.update(),this.scene.hasSomeShadow&&(this.scene.visibilityChanged=!0))},wa=function(b){this.stopDraw=void 0===b?!this.stopDraw:!b;this.scene&&!this.stopDraw&&this.scene.update()},Ja=function(){return!this.stopDraw},
La=function(b){this.animatingGeometries=void 0===b?!this.animatingGeometries:b},ra=function(){return this.animatingGeometries},Sa=function(b){this.animatingMaterials=void 0===b?!this.animatingMaterials:b},Ya=function(){return this.animatingMaterials},Ra=function(b,d){var e=0==b&&0<this.settings.screenSpaceReflectDistance||0<b&&0==this.settings.screenSpaceReflectDistance;this.settings.screenSpaceReflectDistance=b;!d&&e&&fd.call(this,!0);this.scene&&this.scene.update()},ma=function(b,d){var e=0==b&&
0<this.settings.screenSpaceRefractDistance||0<b&&0==this.settings.screenSpaceRefractDistance;this.settings.screenSpaceRefractDistance=b;!d&&e&&(fd.call(this,!0),this.shaders.updateSceneMaterials(this.scene,this.settings.renderBlurredOpacity,0<this.settings.screenSpaceRefractDistance,this.settings.renderFur));this.scene&&this.scene.update()},bb=function(b){var d=b!==this.settings.furQualityHD;this.settings.furQualityHD=b;this.scene&&d&&(this.renderingData.furQuality=b,this.needsComputeFurlayers=!0,
this.scene.needsUpdate=Math.max(this.scene.needsUpdate,1))},gb=function(b){this.settings.renderSSAO=void 0===b?!this.settings.renderSSAO:b;qc.call(this);this.scene&&this.scene.update()},ib=function(){return this.settings.renderSSAO},hb=function(b){this.settings.filterSSAO=void 0===b?!this.settings.filterSSAO:b;this.scene&&this.scene.update()},fb=function(){return this.settings.filterSSAO},Aa=function(b,d){this.scene&&(this.scene.requiredUvsrc=-1);if(d||this.renderingMode!==b)switch(b){case stage.emersya.viewer.RENDERING_MODES.FULLREFL:(!this.scene||
this.scene.materialsType)&&this.scene||this.fullReflTexture?this.scene.materialsType?(this.renderingMode=b,this.scene.fullReflPbrMatAnim||(this.scene.fullReflPbrMatAnim=new stage.emersya.viewer.modules.renderer.animations.matAnimManager(this.scene,{type:1,albedo:{color:[1,1,1],intensity:1},roughness:{intensity:0},metalness:{intensity:1},opacity:{blending:0,glassMode:0,intensity:1},polylists:[]},{isHidden:function(){return!1},customMaterial:{},polylist:{customMaterial:{}}}),this.scene.fullReflPbrMatAnim.updateShaderType(),
this.shaders.compileTypedShader(this.scene.fullReflPbrMatAnim.shaderType)),this.scene&&this.scene.update()):this.fullReflTexture.isReady()&&(this.renderingMode=b,this.scene&&this.scene.update()):(b={id:-99999999,name:"fullReflTexture",wrap_s:"CLAMP_TO_EDGE",wrap_t:"CLAMP_TO_EDGE",min_filter:"LINEAR_MIPMAP_LINEAR",mag_filter:"LINEAR",positive_x:{id:-99999998,name:"fullReflPositiveXImageRGBA",default_source_image:{id:-99999998,name:"fullReflPositiveXImageSourceImage",file_path:stage.emersya.dataManager().getTexturesFilePath()+
"fullRefl/posx.jpg",real_file_path:stage.emersya.dataManager().getTexturesFilePath()+"fullRefl/posx.jpg",file_type:"jpg",width:512,height:512,fileSize:1},source_images:[{id:-99999998,name:"fullReflPositiveXImageSourceImage",file_path:stage.emersya.dataManager().getTexturesFilePath()+"fullRefl/posx.jpg",real_file_path:stage.emersya.dataManager().getTexturesFilePath()+"fullRefl/posx.jpg",file_type:"jpg",width:512,height:512,fileSize:1}]},positive_y:{id:-99999997,name:"fullReflPositiveYImageRGBA",default_source_image:{id:-99999997,
name:"fullReflPositiveYImageSourceImage",file_path:stage.emersya.dataManager().getTexturesFilePath()+"fullRefl/posy.jpg",real_file_path:stage.emersya.dataManager().getTexturesFilePath()+"fullRefl/posy.jpg",file_type:"jpg",width:512,height:512,fileSize:1},source_images:[{id:-99999997,name:"fullReflPositiveYImageSourceImage",file_path:stage.emersya.dataManager().getTexturesFilePath()+"fullRefl/posy.jpg",real_file_path:stage.emersya.dataManager().getTexturesFilePath()+"fullRefl/posy.jpg",file_type:"jpg",
width:512,height:512,fileSize:1}]},positive_z:{id:-99999996,name:"fullReflPositiveZImageRGBA",default_source_image:{id:-99999996,name:"fullReflPositiveZImageSourceImage",file_path:stage.emersya.dataManager().getTexturesFilePath()+"fullRefl/posz.jpg",real_file_path:stage.emersya.dataManager().getTexturesFilePath()+"fullRefl/posz.jpg",file_type:"jpg",width:512,height:512,fileSize:1},source_images:[{id:-99999996,name:"fullReflPositiveZImageSourceImage",file_path:stage.emersya.dataManager().getTexturesFilePath()+
"fullRefl/posz.jpg",real_file_path:stage.emersya.dataManager().getTexturesFilePath()+"fullRefl/posz.jpg",file_type:"jpg",width:512,height:512,fileSize:1}]},negative_x:{id:-99999995,name:"fullReflNegativeXImageRGBA",default_source_image:{id:-99999995,name:"fullReflNegativeXImageSourceImage",file_path:stage.emersya.dataManager().getTexturesFilePath()+"fullRefl/negx.jpg",real_file_path:stage.emersya.dataManager().getTexturesFilePath()+"fullRefl/negx.jpg",file_type:"jpg",width:512,height:512,fileSize:1},
source_images:[{id:-99999995,name:"fullReflNegativeXImageSourceImage",file_path:stage.emersya.dataManager().getTexturesFilePath()+"fullRefl/negx.jpg",real_file_path:stage.emersya.dataManager().getTexturesFilePath()+"fullRefl/negx.jpg",file_type:"jpg",width:512,height:512,fileSize:1}]},negative_y:{id:-99999994,name:"fullReflNegativeYImageRGBA",default_source_image:{id:-99999994,name:"fullReflNegativeYImageSourceImage",file_path:stage.emersya.dataManager().getTexturesFilePath()+"fullRefl/negy.jpg",
real_file_path:stage.emersya.dataManager().getTexturesFilePath()+"fullRefl/negy.jpg",file_type:"jpg",width:512,height:512,fileSize:1},source_images:[{id:-99999994,name:"fullReflNegativeYImageSourceImage",file_path:stage.emersya.dataManager().getTexturesFilePath()+"fullRefl/negy.jpg",real_file_path:stage.emersya.dataManager().getTexturesFilePath()+"fullRefl/negy.jpg",file_type:"jpg",width:512,height:512,fileSize:1}]},negative_z:{id:-99999993,name:"fullReflNegativeZImageRGBA",default_source_image:{id:-99999993,
name:"fullReflNegativeZImageSourceImage",file_path:stage.emersya.dataManager().getTexturesFilePath()+"fullRefl/negz.jpg",real_file_path:stage.emersya.dataManager().getTexturesFilePath()+"fullRefl/negz.jpg",file_type:"jpg",width:512,height:512,fileSize:1},source_images:[{id:-99999993,name:"fullReflNegativeZImageSourceImage",file_path:stage.emersya.dataManager().getTexturesFilePath()+"fullRefl/negz.jpg",real_file_path:stage.emersya.dataManager().getTexturesFilePath()+"fullRefl/negz.jpg",file_type:"jpg",
width:512,height:512,fileSize:1}]}},this.fullReflTexture=this.apiCore.exec(this.callerName,"createTextureCubeFromDB",b),this.fullReflTexture.load(),this.stopDraw=!0,this.scene.texturesManager.downloadTextureCube(this.fullReflTexture,stage.setContext(function(){this.renderingMode=stage.emersya.viewer.RENDERING_MODES.FULLREFL;this.stopDraw=!1;this.scene&&this.scene.update()},this)));break;case stage.emersya.viewer.RENDERING_MODES.FULLSPEC:this.scene.materialsType&&!this.scene.fullSpecPbrMatAnim&&(this.scene.fullSpecPbrMatAnim=
new stage.emersya.viewer.modules.renderer.animations.matAnimManager(this.scene,{type:1,albedo:{color:[1,1,1],intensity:1},roughness:{intensity:0},metalness:{intensity:0},opacity:{blending:0,glassMode:0,intensity:1},polylists:[]},{isHidden:function(){return!1},customMaterial:{},polylist:{customMaterial:{}}}),this.scene.fullSpecPbrMatAnim.updateShaderType(),this.shaders.compileTypedShader(this.scene.fullSpecPbrMatAnim.shaderType));this.renderingMode=b;this.scene&&this.scene.update();break;case stage.emersya.viewer.RENDERING_MODES.UVS:this.scene.requiredUvsrc=
0;this.uvsTexture?(this.uvsTexture.uvsrc=0,this.uvsTexture.isReady()&&(this.renderingMode=b,this.scene&&(tb.call(this,this.scene),Lb.call(this,this.scene),this.scene.update()))):(b=Rd(),this.uvsTexture=this.apiCore.exec(this.callerName,"createTextureFromDB",b),this.uvsTexture.uvsrc=0,this.uvsTexture.load(),this.stopDraw=!0,this.scene.texturesManager.downloadTexture(this.uvsTexture,stage.setContext(function(){this.renderingMode=stage.emersya.viewer.RENDERING_MODES.UVS;this.stopDraw=!1;this.scene&&
(tb.call(this,this.scene),Lb.call(this,this.scene),this.scene.update())},this)));break;case stage.emersya.viewer.RENDERING_MODES.UVS1:this.scene.requiredUvsrc=1;this.uvsTexture?(this.uvsTexture.uvsrc=1,this.uvsTexture.isReady()&&(this.renderingMode=b,this.scene&&(this.scene.update(),tb.call(this,this.scene),Lb.call(this,this.scene)))):(b=Rd(),this.uvsTexture=this.apiCore.exec(this.callerName,"createTextureFromDB",b),this.uvsTexture.uvsrc=1,this.uvsTexture.load(),this.stopDraw=!0,this.scene.texturesManager.downloadTexture(this.uvsTexture,
stage.setContext(function(){this.renderingMode=stage.emersya.viewer.RENDERING_MODES.UVS1;this.stopDraw=!1;this.scene&&(this.scene.update(),tb.call(this,this.scene),Lb.call(this,this.scene))},this)));break;case stage.emersya.viewer.RENDERING_MODES.FULL_WIREFRAME:this.renderingMode=b;this.shaders.createOneColorShader();this.scene&&this.scene.update();break;case stage.emersya.viewer.RENDERING_MODES.SEMI_WIREFRAME:this.renderingMode=b;this.scene&&(this.shaders.createOneColorShader(),this.shaders.createMeshEditingShader(),
this.scene.update());break;case stage.emersya.viewer.RENDERING_MODES.TEXTURED_SEMI_WIREFRAME:this.renderingMode=b;this.scene&&(this.shaders.createOneColorShader(),this.shaders.createMeshEditingShader(),this.scene.update());break;case stage.emersya.viewer.RENDERING_MODES.POLYCOLOR:this.renderingMode=b;Na.call(this);this.scene&&this.scene.update();break;case stage.emersya.viewer.RENDERING_MODES.MATSCOLOR:this.renderingMode=b;xd.call(this);this.scene&&this.scene.update();break;case stage.emersya.viewer.RENDERING_MODES.SHARP_EDGES:this.renderingMode=
b;this.shaders.createOneColorShader();Jc.call(this);this.shaders.createSilhouettesShader();this.scene&&this.scene.update();break;case stage.emersya.viewer.RENDERING_MODES.GOOCH:this.shaders.createGoochShader();this.renderingMode=b;this.scene&&this.scene.update();break;case stage.emersya.viewer.RENDERING_MODES.CLASSIC:tb.call(this,this.scene),Lb.call(this,this.scene);default:this.renderingMode=b,this.scene&&this.scene.update()}},eb=function(){return this.renderingMode},ab=function(b){this.cameraMode!==
b&&(this.cameraMode=b,this.cameraModeChanged=!0,this.scene&&this.scene.update())},Ma=function(){return this.cameraMode},Ta=function(b){this.settings.renderAxes=void 0===b?!this.settings.renderAxes:b;this.settings.renderAxes&&this.shaders.createOneColorShader();this.scene&&this.scene.update()},db=function(){return this.settings.renderAxes},Oa=function(b){this.settings.renderAxesOnSelectedNodes=void 0===b?!this.settings.renderAxesOnSelectedNodes:b;this.settings.renderAxesOnSelectedNodes&&this.shaders.createOneColorShader();
this.scene&&this.scene.update()},Qa=function(b){this.settings.renderGrid=void 0===b?!this.settings.renderGrid:b;this.settings.renderGrid&&this.shaders.createOneColorShader();this.scene&&this.scene.update()},N=function(){return this.settings.renderGrid},za=function(b){this.settings.renderBoundingBoxes=void 0===b?!this.settings.renderBoundingBoxes:b;this.settings.renderBoundingBoxes&&this.shaders.createOneColorShader();this.scene&&this.scene.update()},ca=function(){return this.settings.renderBoundingBoxes},
Ea=function(b){this.settings.renderFramerate=void 0===b?!this.settings.renderFramerate:b;Xc.call(this);this.scene&&this.scene.update()},Ca=function(){return this.settings.renderFramerate},Ua=function(b,d){this.settings.renderRulers=void 0===b?!this.settings.renderRulers:b;this.settings.renderRulers&&(stage.extend(this.settings.rulersSettings,d),this.currentBBoxHeight=this.currentBBoxDepth=this.currentBBoxWidth=null,hc.call(this));this.scene&&this.scene.update()},sa=function(b){void 0===b?(this.settings.renderLights=
!this.settings.renderLights,this.settings.renderShadows=!this.settings.renderShadows):(this.settings.renderLights=b,this.settings.renderShadows=b);if(this.settings.renderLights||this.settings.renderShadows)this.shaders.createOneColorShader(),this.shaders.createOpacityShadowMapShader(this.scene&&this.scene.materialsType);this.scene&&this.scene.update()},na=function(){return this.settings.renderLights},kb=function(b){this.settings.renderSilhouettes=void 0===b?!this.settings.renderSilhouettes:b;this.settings.renderSilhouettes&&
this.shaders.createSilhouettesShader();this.scene&&this.scene.update()},Da=function(){return this.settings.renderSilhouettes},xb=function(b){this.settings.renderMirrors=void 0===b?!this.settings.renderMirrors:b;cd.call(this);this.scene&&this.scene.update()},Za=function(){return this.settings.renderMirrors},V=function(b){this.settings.renderWater=void 0===b?!this.settings.renderWater:b;yd.call(this);this.scene&&this.scene.update()},O=function(){return this.settings.renderWater},ja=function(b){this.settings.renderBlurredOpacity=
void 0===b?!this.settings.renderBlurredOpacity:b;Vb.call(this);this.scene&&(tb.call(this,this.scene),Lb.call(this,this.scene),this.scene.update())},W=function(){return this.settings.renderBlurredOpacity},pa=function(b){this.settings.renderGlow=void 0===b?!this.settings.renderGlow:b;Nc.call(this);mb.call(this);this.scene&&this.scene.update()},Pa=function(){return this.settings.renderGlow},ha=function(b){this.settings.renderTonemapping=void 0===b?!this.settings.renderTonemapping:b;this.scene&&(this.scene.tonemapping.disabled=
!this.settings.renderTonemapping,tb.call(this,this.scene),Lb.call(this,this.scene),this.scene&&this.scene.update())},ya=function(){return this.settings.renderTonemapping},zb=function(b,d){b!=this.currentScaling&&(this.needsComputeFurlayers=!0);this.currentScaling=b;this.adaptativeResolution||(this.globalFramebuffer=this.globalFramebuffers[this.currentScaling],this.ssaoFramebuffers&&(this.ssaoFramebuffer=this.ssaoFramebuffers[this.currentScaling]),this.ssrFramebuffers&&(this.ssrFramebuffer=this.ssrFramebuffers[this.currentScaling]));
this.renderingWidth=Math.max(Math.round(this.realSize[0]*this.currentScaling),1);this.renderingHeight=Math.max(Math.round(this.realSize[1]*this.currentScaling),1);this.scene.update()},cb=function(){return this.currentScaling},nc=function(b,d){this.settings.depthAndNormalsReduction=b;d||Jc.call(this,!0)},dc=function(){return this.settings.depthAndNormalsReduction},Wb=function(b,d){this.settings.blurReduction=b;d||Vb.call(this,!0)},Sb=function(){return this.settings.blurReduction},ec=function(b,d){this.settings.mirrorReduction=
b;d||cd.call(this,!0)},Xb=function(){return this.settings.mirrorReduction},yb=function(b,d){this.settings.ssaoReduction=b;d||qc.call(this,!0)},Rb=function(){return this.settings.ssaoReduction},Gb=function(b){this.settings.ssaoIntensity=b;this.settings.ssaoAutoDisable=!1;this.scene&&this.scene.update()},ob=function(b){this.settings.ssaoIntensity2=b;this.settings.ssaoAutoDisable=!1;this.scene&&this.scene.update()},Hb=function(b){this.settings.ssaoRadius=b;this.settings.ssaoAutoDisable=!1;this.scene&&
this.scene.update()},tc=function(b){this.settings.ssaoRadius2=b;this.settings.ssaoAutoDisable=!1;this.scene&&this.scene.update()},pb=function(b,d){this.settings.ssaoThickness=b;this.settings.ssaoAutoDisable=!1;this.scene&&this.scene.update()},Ab=function(b){this.settings.ssaoThickness2=b;this.settings.ssaoAutoDisable=!1;this.scene&&this.scene.update()},Bb=function(b,d){this.settings.ssaoEmissiveThreshold=b;this.settings.ssaoAutoDisable=!1;this.scene&&this.scene.update()},$a=function(){return this.settings.ssaoEmissiveThreshold},
lb=function(b,d){this.settings.ssaoOpacityThreshold=b;this.settings.ssaoAutoDisable=!1;this.scene&&this.scene.update()},ic=function(){return this.settings.ssaoOpacityThreshold},ac=function(b,d){this.settings.ssaoNormalDisplacement=b;this.settings.ssaoAutoDisable=!1;this.scene&&this.scene.update()},Yb=function(b,d){this.settings.graininess=b;this.scene&&this.scene.update()},Kc=function(){return this.settings.graininess},ad=function(b){switch(b){case stage.emersya.viewer.HD_ON_STOP_MODES.OFF:this.settings.grainOnStop=
!1;break;case stage.emersya.viewer.HD_ON_STOP_MODES.OFF_ON_DESKTOP:if(!stage.browser.mobilBrowser&&"iPad"!=navigator.platform&&"iPhone"!=navigator.platform){this.settings.grainOnStop=!1;break}case stage.emersya.viewer.HD_ON_STOP_MODES.ON:this.settings.grainOnStop=!0}this.settings.grainOnStopMode=b;this.scene&&this.scene.update()},oc=function(b,d){this.settings.glowReduction=b;d||(Nc.call(this,!0),mb.call(this,!0))},Cc=function(){return this.settings.glowReduction},nd=function(b,d){this.minScaling=
b;1<b&&(this.minScaling=1+(this.devicePixelRatio-1)*(b-1));this.targetFramerate=Math.max(d,.01);this.targetFrameTimeDown=1E3/this.targetFramerate;this.targetFrameTimeUp=1E3/Math.min(60,this.targetFramerate+10);Db.call(this,!0);this.scene&&this.scene.update()},Sc=function(b){this.multisampling=void 0===b?!this.multisampling:b;kc.call(this);Db.call(this,!0);this.scene.update()},Tc=function(b){this.ssaaOnStop=void 0===b?!this.ssaaOnStop:b;Db.call(this);this.scene.update()},rb=function(b){this.forceGlobalFramebuffer=
void 0===b?!this.forceGlobalFramebuffer:b;Db.call(this);this.scene.update()},od=function(b){this.antialiasing=void 0===b?!this.antialiasing:b;Db.call(this);this.scene.update()},Dc=function(b){this.ssaaRenderMode=b;this.scene.update()},Nb=function(b){this.immobileMovingJitterSampleCount=b;this.scene.update()},Ib=function(b){this.ssaoRenderingMode=b;this.scene.update()},Ob=function(b){this.mipmappedEnv=void 0===b?!this.mipmappedEnv:b;this.lightsManager.setMipmappedEnvironmentAvailable(this.mipmappedEnv);
Lb.call(this,this.scene);this.scene.update()},Tb=function(b,d,e,f){this.anyMouseButtonPressed=!0},wc=function(b,d,e,f){this.anyMouseButtonPressed=!1;for(var h in f)this.anyMouseButtonPressed=this.anyMouseButtonPressed||f[h];this.scene&&0==this.scene.needsUpdate&&3<this.ssaoPhase&&(this.scene.needsUpdate=1)},pd=function(){this.anyMouseButtonPressed&&(this.lastMouseMove=Date.now())},bc=function(){this.resetTime=Date.now();this.ignoreNextScalingTime=!0},Uc=function(b){this.animationSpeed=Math.max(Math.min(b,
1E3),0)},Lc=function(b){this.nextDeltaT=b},uc=function(){gc.call(this);t.call(this);this.gl.webgl2||this.gl.mrt||this.gl.depthTextures||(this.settings.renderSSAO=!1);this.renderingData.viewMatrix=mat4.create();this.renderingData.projectionMatrix=mat4.create();this.renderingData.lastFrameViewMatrix=mat4.create();this.renderingData.lastFrameProjectionMatrix=mat4.create();this.renderingData.unjitteredProjectionMatrix=mat4.create();this.renderingData.cameraPosition=vec3.create();this.renderingData.cameraTarget=
vec3.create();this.renderingData.cameraUp=vec3.create();vb.call(this,1);this.movingJitterSampleCount=1;this.ssaoRenderingMode=0;var b=this.apiCore.exec(this.callerName,"getDevice"),d=/nvidia|ati|amd|radeon|apple gpu|apple m/;this.multisampling=!!this.gl.webgl2&&d.test(window.unmaskedRendererWebGL.toLowerCase())&&(!b||b.supportMultisampling);this.multisamplingTested=!1;this.ssaaOnStop=!!this.gl.halfFloatTextures;this.ssaaRenderMode=!this.settings.hdOnStop||this.settings.hdOnStop&&this.multisampling?
1:this.gl.halfFloatTextures?0:2;this.mipmappedEnv=this.settings.mipmappedEnvironment;this.ssaaUniformCenteredDistribution=!0;this.forceGlobalFramebuffer=!1;this.antialiasing=!this.multisampling;this.noMoveDuration=300;this.adaptativeResolution=this.settings.smoothHdOnStop||this.settings.dynamicScaling;this.immobileMovingJitterSampleCount=8;this.lastMouseMove=0;d=this.apiCore.exec(this.callerName,"getBrowser");if(b){if(b.model){this.forceGlobalFramebuffer="iPhone 5s"===b.model||"iPad Air"===b.model;
var e=b.model.indexOf("iPhone ");0<=e&&(e=parseInt(b.model.substring(e+7,b.model.length)),7<e||isNaN(e))&&(this.forceGlobalFramebuffer=!0)}else b.isIos&&!d.isSafari&&(this.forceGlobalFramebuffer=!0);b.isMobile&&(this.settings.ssaoDepthThreshold=b.isIos?.00298:2E-4,this.settings.furLayers={min:5,max:40});b.isMac&&d.isSafari&&(this.hackSync={context:document.createElement("canvas").getContext("2d"),texture:this.gl.createTexture()},this.hackSync.context.canvas.width=this.hackSync.context.canvas.height=
1);this.checkForErrors=!b.isWindow||"firefox"!==stage.browser.navigator.toLowerCase();this.forceSynchronousFramebuffers=d.isSafari||b.isIos;this.forceGlobalFramebuffer=-1!==window.unmaskedRendererWebGL.toLowerCase().indexOf("nvidia")&&!!b.isWindow;!this.forceGlobalFramebuffer&&d.isFirefox&&(d=b.webgl2||b.webgl,this.forceGlobalFramebuffer="AMD"===d.parameters.unMaskedInfo.vendor&&"Generic Renderer"===d.parameters.unMaskedInfo.renderer)}this.alignDitherOpcityFactor=(this.forceAlignDither=b&&(b.isMac||
b.isIos)||/iris\(r\) xe/.test(window.unmaskedRendererWebGL.toLowerCase()))?0:-1!==window.unmaskedRendererWebGL.toLowerCase().indexOf("angle")&&-1!==window.unmaskedRendererWebGL.toLowerCase().indexOf("amd")&&-1!==window.unmaskedRendererWebGL.toLowerCase().indexOf("angle")&&-1!==window.unmaskedRendererWebGL.toLowerCase().indexOf("llvm")?2.5:1.5;this.displayPreSsaaTexture=!/iris\(r\) xe/.test(window.unmaskedRendererWebGL.toLowerCase());this.meshes=new stage.emersya.viewer.modules.renderer.meshesManager(this.gl);
this.shaders=new stage.emersya.viewer.modules.renderer.shaders.shadersManager(this.gl);this.filters=new stage.emersya.viewer.modules.renderer.filterManager(this.gl,this.renderingData,this.shaders);this.lightsManager=new stage.emersya.viewer.modules.renderer.lightsManager(this.gl,this.renderingData,this.settings.nbFilterPasses,this.mipmappedEnv);this.screenTools=new stage.emersya.viewer.modules.renderer.screenTools(this.renderingData,this.shaders,this.gl,this.gl.viewportWidth,this.gl.viewportHeight);
stage.emersya.viewer.modules.renderer.meshEditor&&(this.meshEditor=new stage.emersya.viewer.modules.renderer.meshEditor(this.renderingData,this.gl,this.screenTools,{onNodeSelected:stage.setContext(S,this),onNodeDeselected:stage.setContext(Y,this),onPolylistSelected:stage.setContext(ua,this),onPolylistDeselected:stage.setContext(ea,this)}));stage.emersya.viewer.modules.renderer.lightsEditor&&(this.lightsEditor=new stage.emersya.viewer.modules.renderer.lightsEditor(this.apiCore,this.gl,this.renderingData,
this.lightsManager,this.screenTools,this.shaders),this.lightsEditor.initRendering());stage.emersya.viewer.modules.renderer.modularEditor&&(this.modularEditor=new stage.emersya.viewer.modules.renderer.modularEditor(this.apiCore,this.gl,this.renderingData,this.screenTools,this.shaders),this.modularEditor.initRendering());stage.emersya.viewer.modules.renderer.materialPreviewManagement&&(this.materialPreviewManagement=new stage.emersya.viewer.modules.renderer.materialPreviewManagement(this.apiCore,this));
stage.emersya.viewer.modules.renderer.imageFilterManagement&&(this.imageFilterManagement=new stage.emersya.viewer.modules.renderer.imageFilterManagement(this.apiCore,this.gl,this.filters));b=new Float32Array([0,0,0,1,0,0,1,-1,0,0,-1,0]);this.squareVBuffer=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.squareVBuffer);this.gl.bufferData(this.gl.ARRAY_BUFFER,b,this.gl.STATIC_DRAW);this.squareIBuffer=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.squareIBuffer);
this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,1,2,2,3,3,0]),this.gl.STATIC_DRAW);b=this.settings.gridTotalSize/2;d=this.settings.gridTotalSize/this.settings.gridCasesCount;e=d/this.settings.gridSubCasesCount;for(var f=d/2,h=new Float32Array(12*this.settings.gridCasesCount),m=new Uint16Array(4*(this.settings.gridCasesCount+1)),p=new Float32Array(12*(this.settings.gridSubCasesCount-1)),g=new Uint16Array(4*(this.settings.gridSubCasesCount-1)),n=0;n<this.settings.gridCasesCount;++n)h[3*
n]=-b+n*d,h[3*n+1]=0,h[3*n+2]=b,h[3*this.settings.gridCasesCount+3*n]=b,h[3*this.settings.gridCasesCount+3*n+1]=0,h[3*this.settings.gridCasesCount+3*n+2]=-n*d+b,h[6*this.settings.gridCasesCount+3*n]=-n*d+b,h[6*this.settings.gridCasesCount+3*n+1]=0,h[6*this.settings.gridCasesCount+3*n+2]=-b,h[9*this.settings.gridCasesCount+3*n]=-b,h[9*this.settings.gridCasesCount+3*n+1]=0,h[9*this.settings.gridCasesCount+3*n+2]=-b+n*d;for(n=0;n<=this.settings.gridCasesCount;++n)m[2*n]=n,m[2*n+1]=3*this.settings.gridCasesCount-
n,m[2*(this.settings.gridCasesCount+1)+2*n]=this.settings.gridCasesCount+n,m[2*(this.settings.gridCasesCount+1)+2*n+1]=(4*this.settings.gridCasesCount-n)%(4*this.settings.gridCasesCount);for(n=1;n<this.settings.gridSubCasesCount;++n)p[3*(n-1)]=-f+n*e,p[3*(n-1)+1]=0,p[3*(n-1)+2]=f,p[3*this.settings.gridSubCasesCount+3*(n-2)]=f,p[3*this.settings.gridSubCasesCount+3*(n-2)+1]=0,p[3*this.settings.gridSubCasesCount+3*(n-2)+2]=-n*e+f,p[6*this.settings.gridSubCasesCount+3*(n-3)]=-n*e+f,p[6*this.settings.gridSubCasesCount+
3*(n-3)+1]=0,p[6*this.settings.gridSubCasesCount+3*(n-3)+2]=-f,p[9*this.settings.gridSubCasesCount+3*(n-4)]=-f,p[9*this.settings.gridSubCasesCount+3*(n-4)+1]=0,p[9*this.settings.gridSubCasesCount+3*(n-4)+2]=-f+n*e;for(n=0;n<this.settings.gridSubCasesCount-1;++n)g[2*n]=n,g[2*n+1]=3*(this.settings.gridSubCasesCount-1)-1-n,g[2*(this.settings.gridSubCasesCount-1)+2*n]=this.settings.gridSubCasesCount-1+n,g[2*(this.settings.gridSubCasesCount-1)+2*n+1]=(4*(this.settings.gridSubCasesCount-1)-1-n)%(4*this.settings.gridCasesCount);
this.gridVBuffer=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.gridVBuffer);this.gl.bufferData(this.gl.ARRAY_BUFFER,h,this.gl.STATIC_DRAW);this.gridIBuffer=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.gridIBuffer);this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,m,this.gl.STATIC_DRAW);this.gridVBufferP=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.gridVBufferP);this.gl.bufferData(this.gl.ARRAY_BUFFER,p,this.gl.STATIC_DRAW);
this.gridIBufferP=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.gridIBufferP);this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,g,this.gl.STATIC_DRAW);b=new Float32Array([0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,0,1]);d=new Float32Array([1,0,0,1,0,0,0,1,0,0,1,0,0,0,1,0,0,1]);this.axesVBuffer=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.axesVBuffer);this.gl.bufferData(this.gl.ARRAY_BUFFER,b,this.gl.STATIC_DRAW);this.axesCBuffer=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,
this.axesCBuffer);this.gl.bufferData(this.gl.ARRAY_BUFFER,d,this.gl.STATIC_DRAW);this.axesIBuffer=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.axesIBuffer);this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,3,4,5]),this.gl.STATIC_DRAW);b=new Float32Array(24);b[0]=-1;b[1]=-1;b[2]=-1;b[3]=-1;b[4]=-1;b[5]=1;b[6]=1;b[7]=-1;b[8]=1;b[9]=1;b[10]=-1;b[11]=-1;b[12]=-1;b[13]=1;b[14]=-1;b[15]=-1;b[16]=1;b[17]=1;b[18]=1;b[19]=1;b[20]=1;b[21]=1;b[22]=1;b[23]=
-1;d=new Uint16Array(36);d[0]=0;d[1]=3;d[2]=2;d[3]=0;d[4]=2;d[5]=1;d[6]=4;d[7]=5;d[8]=6;d[9]=4;d[10]=6;d[11]=7;d[12]=0;d[13]=4;d[14]=7;d[15]=0;d[16]=7;d[17]=3;d[18]=2;d[19]=6;d[20]=5;d[21]=2;d[22]=5;d[23]=1;d[24]=0;d[25]=1;d[26]=5;d[27]=0;d[28]=5;d[29]=4;d[30]=3;d[31]=7;d[32]=6;d[33]=3;d[34]=6;d[35]=2;this.cubeVBuffer=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.cubeVBuffer);this.gl.bufferData(this.gl.ARRAY_BUFFER,b,this.gl.STATIC_DRAW);this.cubeIBuffer=this.gl.createBuffer();
this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.cubeIBuffer);this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,d,this.gl.STATIC_DRAW);this.shaders.updateShadowsHead(this.shadowSettings);this.shaders.createRGBEToFloatShader(this.renderingData);this.init=!0;this.gl.clearColor(this.clearColor.r/255,this.clearColor.g/255,this.clearColor.b/255,0);this.gl.enable(this.gl.DEPTH_TEST);this.gl.viewportWidth=Math.max(Math.round(this.settings.canvasWidth*this.currentScaling),1);this.gl.viewportHeight=Math.max(Math.round(this.settings.canvasHeight*
this.currentScaling),1);this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA);this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!0);dd.call(this);this.initialized=!0},Ec=function(b){if(b){if(this.settings.subdivise){Date.now();var d=new stage.emersya.viewer.modules.renderer.subdivisionManager(!1);for(h in b.polylists){var e=b.polylists[h];0!=e.subdivisionLevel&&d.readGeometry(e.geometry,e)&&(d.subdivise(e.subdivisionLevel),d.rewriteGeometry(e.geometry,e))}Date.now()}for(var f in b.polylists)b.polylists[f].convexHull||
this.meshes.loadPolylistBuffers(b.polylists[f]);d=b.getCurrentParentTypeAndId();var h=b.getAll("ProductNode");e=b.getAll("Polylist");e=Math.max.apply(Math,[0].concat($jscomp.arrayFromIterable(Object.keys(e))));for(f in h){var m=h[f].sourceModel;if(m&&m.convexHull&&!m.polylist){var p=m.convexHull;b.setParentFromInstance(p);var g=b.register("Polylist",{id:++e,name:"convex hull",list:null,edges:null,indexBuffer:null,indexLineBuf:null,selected:!1,highlighted:!1,isHidden:!1,nodes:[h[f]],duplicatedPolylists:[],
instances:[],geometryId:b.getOriginalIdFromInstance(p.id),geometry:p,convexHull:!0,doubleSided:!1,facesOrientation:0,ssaoReceive:!0,ssaoCast:!0,refractDistance:0,polygonOffsetFactor:0,polygonOffsetUnits:0,subdivisionLevel:0,renderingPass:0,downloaded:!1});this.meshes.loadConvexHullBuffers(p,g);m.polylist=g}}b.computePolylistsBoundingBoxes();b.setParent(d.type,d.id)}},Ub=function(b){this.meshes?this.meshes.loadPolylistBuffers(b):console.error("loadPolylistBuffers called when renderer is not initialized yet or was destroyed.")},
sb=function(b){this.meshes?(this.screenTools.deallocatePolylist(b),this.meshes.deallocatePolylist(b)):console.error("unloadPolylistBuffers called when renderer is not initialized yet or was destroyed.")},Cb=function(b){if(b&&CANNON){b.physics&&Oc.call(this,b);b.physics={world:new CANNON.World,rigidBodies:[],groundBody:null};b.physics.world.gravity.set(0,-9.8,0);b.physics.world.broadphase=new CANNON.NaiveBroadphase;b.physics.world.solver.iterations=5;b.physics.world.defaultContactMaterial.contactEquationStiffness=
1E6;b.physics.world.defaultContactMaterial.contactEquationRelaxation=10;var d=new CANNON.GSSolver;b.physics.world.defaultContactMaterial.contactEquationStiffness=1E9;b.physics.world.defaultContactMaterial.contactEquationRelaxation=4;d.iterations=200;d.tolerance=1E-5;b.physics.world.solver=new CANNON.SplitSolver(d);b.physics.world.solver.iterations=200;b.physics.grippyMaterial=new CANNON.Material("grippyMaterial");b.physics.slipperyMaterial=new CANNON.Material("slipperyMaterial");b.physics.alwaysSlipperyMaterial=
new CANNON.Material("alwaysSlipperyMaterial");d=new CANNON.ContactMaterial(b.physics.grippyMaterial,b.physics.slipperyMaterial,{friction:100,restitution:.3,contactEquationStiffness:1E8,contactEquationRelaxation:3});b.physics.world.addContactMaterial(d);d=new CANNON.ContactMaterial(b.physics.slipperyMaterial,b.physics.slipperyMaterial,{friction:0,restitution:.3,contactEquationStiffness:1E8,contactEquationRelaxation:3});b.physics.world.addContactMaterial(d);d=new CANNON.ContactMaterial(b.physics.alwaysSlipperyMaterial,
b.physics.slipperyMaterial,{friction:0,restitution:.3,contactEquationStiffness:1E8,contactEquationRelaxation:3});b.physics.world.addContactMaterial(d);d=new CANNON.ContactMaterial(b.physics.alwaysSlipperyMaterial,b.physics.grippyMaterial,{friction:0,restitution:.3,contactEquationStiffness:1E8,contactEquationRelaxation:3});b.physics.world.addContactMaterial(d)}},pc=function(b,d){b&&b.physics&&(d=this.meshes.createProductNodeInstanceRigidBody(b,d))&&b.physics.rigidBodies.push(d)},Pc=function(b){var d=
this.shaders.readHardwareLimitations(b);b.maxTextureUnits=this.gl.maxTextureUnits;return stage.testResult(d)?(this.apiCore.exec(this.callerName,"webGlHardwareLimitedError",d.errors.emError[0]),!0):!1},tb=function(b){b&&!Pc.call(this,b)&&(b.updateSceneMaterialsPolylists(),this.shaders.updateSceneMaterials(b,this.settings.renderBlurredOpacity,0<this.settings.screenSpaceRefractDistance,this.settings.renderFur),this.renderingMode===stage.emersya.viewer.RENDERING_MODES.MATSCOLOR&&xd.call(this),this.scene===
b&&bd.call(this,b),b.update())},Hc=function(b,d){if(b){b.dfglut&&(this.gl.floatTextures?this.filters.setDFGLUT(b.dfglut):g.call(this,b));d||this.lightsManager.updateSceneLights(b);b.scenery.blurredEnvironment&&b.scenery.blurredEnvironment&&1<b.scenery.renderEnvironment&&this.gl.deleteTexture(b.scenery.blurredEnvironment);b.scenery.blurredEnvironment=null;b.scenery.environmentTexture&&b.texturesManager.setGlContext(this.gl);for(var e=0;e<b.environmentTextures.length;++e){var f=b.environmentTextures[e].finalImage;
(this.gl.webgl2||this.gl.shadertexturelod)&&f&&(f.fullyLoaded||f.firstLoading||f.fullyLoading||setTimeout(stage.setContext(function(b,d){d.download(!1,stage.setContext(Hc,this,b,!0),stage.setContext(function(b){b.fullyLoading=!0},this,d))},this,b,f),0))}if(b&&b.scenery&&1<b.scenery.renderEnvironment&&b.scenery.environmentTexture&&b.scenery.environmentTexture.isReady()&&b.scenery.environmentTexture.images[0].glTexture){this.shaders.createTextureFilterVert2Shader();this.shaders.createTextureFilterHori2Shader();
this.shaders.createTextureFilterVert3Shader();this.shaders.createTextureFilterHori3Shader();switch(b.scenery.renderEnvironment){case 1:b.scenery.blurredEnvironment=b.scenery.environmentTexture.images[0].glTexture;break;case 2:b.scenery.blurredEnvironment=this.filters.applyBlur(b.scenery.environmentTexture.finalImage.glTexture,2048,2048,"2-2",this.gl.floatTextures,!0,!this.gl.floatTextures);break;case 3:b.scenery.blurredEnvironment=this.filters.applyBlur(b.scenery.environmentTexture.finalImage.glTexture,
2048,2048,"2-2-3",this.gl.floatTextures,!0,!this.gl.floatTextures);break;case 4:b.scenery.blurredEnvironment=this.filters.applyBlur(b.scenery.environmentTexture.finalImage.glTexture,1024,1024,"2-2-3",this.gl.floatTextures,!0,!this.gl.floatTextures);break;case 5:b.scenery.blurredEnvironment=this.filters.applyBlur(b.scenery.environmentTexture.finalImage.glTexture,1024,1024,"2-2-3-3",this.gl.floatTextures,!0,!this.gl.floatTextures);break;case 6:b.scenery.blurredEnvironment=this.filters.applyBlur(b.scenery.environmentTexture.finalImage.glTexture,
512,512,"2-2-3",this.gl.floatTextures,!0,!this.gl.floatTextures);break;case 7:b.scenery.blurredEnvironment=this.filters.applyBlur(b.scenery.environmentTexture.finalImage.glTexture,512,512,"2-2-3-3",this.gl.floatTextures,!0,!this.gl.floatTextures);break;case 8:b.scenery.blurredEnvironment=this.filters.applyBlur(b.scenery.environmentTexture.finalImage.glTexture,256,256,"2-2-3",this.gl.floatTextures,!0,!this.gl.floatTextures);break;case 9:b.scenery.blurredEnvironment=this.filters.applyBlur(b.scenery.environmentTexture.finalImage.glTexture,
256,256,"2-2-3-3",this.gl.floatTextures,!0,!this.gl.floatTextures)}b.scenery.environmentTexture.finalImage.clearTextureCurrentParameters();this.gl.bindTexture(this.gl.TEXTURE_2D,b.scenery.blurredEnvironment);this.gl.floatTextures&&this.gl.generateMipmap(this.gl.TEXTURE_2D);this.gl.bindTexture(this.gl.TEXTURE_2D,null)}Pc.call(this,b)||(b.hasSomeShadow&&!d&&(b.shadowMapRenderFunction=stage.setContext(function(b){this.renderingData.clearTextures();for(var d in b.polylistInstances){var e=b.polylistInstances[d];
e.isHidden()||e.matAnim.isPatch()||!this.settings.ghostCastShadow&&this.renderGhosts&&e.isGhost||(this.renderingData.textureCount=0,e.matAnim.loadDiscardTransparent(this.gl,this.renderingData,!e.matAnim.isOpaque(),b.scenery.shadowOpacityThreshold),this.settings.renderFur&&e.matAnim.shaderType.has(stage.emersya.viewer.modules.renderer.shaders.shaderTypes.PBR_FUR)?this.gl.enableVertexAttribArray(this.renderingData.locations.pcgewnw):this.gl.disableVertexAttribArray(this.renderingData.locations.pcgewnw),
this.gl.uniform1f(this.renderingData.locations.cqcpvcg,e.matAnim.computeDisplacementFactor()),this.meshes.renderForShadowMaps(this.renderingData,b.polylistInstances[d]))}this.renderingData.textureCount=0},this,b),this.shaders.updateMacros(b,this.mipmappedEnv,this.shadowSettings),this.shaders.createOpacityShadowMapShader(b&&b.materialsType),this.shaders.useOpacityShadowShader(this.renderingData,b&&b.materialsType),this.currentCamera?(e=mat4.create(),f=vec3.create(this.renderingData.cameraPosition),
this.currentCamera.isFreeFly&&void 0!==this.currentCamera.isFreeFly||(vec3.subtract(this.renderingData.cameraPosition,this.renderingData.cameraTarget,f),vec3.normalize(f),vec3.add(this.renderingData.cameraTarget,f,f)),mat4.lookAt(f,this.renderingData.cameraTarget,this.renderingData.cameraUp,e),f=mat4.inverse(e,mat4.create()),this.lightsManager.updateShadows(b,e,f,!0,!0)):this.lightsManager.renderShadowMaps(b),this.shaders.createTextureFilterVert2Shader(),this.shaders.createTextureFilterHori2Shader(),
this.settings.filterShadowMaps&&b.scenery.shadowFilter&&Eb.call(this,b,this.settings.nbFilterPasses,!0)),d||this.shaders.updateSceneMaterials(b,this.settings.renderBlurredOpacity,0<this.settings.screenSpaceRefractDistance,this.settings.renderFur),this.scene===b&&bd.call(this,this.scene),b.update())}},Lb=function(b){!Pc.call(this,b)&&this.shaders.updateMacros(b,this.mipmappedEnv,this.shadowSettings)&&(this.shaders.updateTypedShaders(b),b.waters.length&&this.shaders.createWaterRenderingShader(b.waters[0]),
b.scenery.renderEnvironment&&this.shaders.createEnvironmentRenderingShader(),b.hasSomeBlur&&Vb.call(this),b.hasSomeGlow&&(this.shaders.createGlowWritingShader(b),Nc.call(this)),b.hasSomeSpecularGlow&&mb.call(this),b.mirrors.length&&cd.call(this),b.hasSomeFur&&Qc.call(this),fd.call(this),b.update())},Vc=function(b){b?b>this.scene.needsUpdate&&(this.scene.needsUpdate=b):this.scene.needsUpdate||this.scene.update()},vc=function(){this.$$canvas.show()},Ic=function(){this.$$canvas.hide()},cc=function(){return this.gl},
Pb=function(){return this.scene},jc=function(b,d){if(b){this.fullReflTexture=this.uvsTexture=null;Oc.call(this,b);this.meshes.deallocateScene(b);this.lightsManager.deallocateScene(b);this.screenTools.deallocateScene();this.meshEditor&&this.meshEditor.deallocateScene();b.unloadMaterials();b.texturesManager.deallocate();b.texturesManager.setGlContext(null);b.texturesManager.setFiltersManager(null);for(var e in b.waters){var f=b.waters[e];f.environmentCube&&this.gl.deleteTexture(f.environmentCube)}b.scenery.blurredEnvironment&&
(this.gl.deleteTexture(b.scenery.blurredEnvironment),b.scenery.blurredEnvironment=null);b.scenery.environmentTexture&&b.scenery.environmentTexture.cube1&&(!d||d.scenery&&d.scenery.environmentTexture&&d.scenery.environmentTexture.cube1&&b.scenery.environmentTexture.cube1!==d.scenery.environmentTexture.cube1)&&(this.gl.deleteTexture(b.scenery.environmentTexture.cube1),this.gl.deleteTexture(b.scenery.environmentTexture.cube2),this.gl.deleteTexture(b.scenery.environmentTexture.cube3),this.gl.deleteTexture(b.scenery.environmentTexture.cube4),
this.gl.deleteTexture(b.scenery.environmentTexture.cube5),this.gl.deleteTexture(b.scenery.environmentTexture.cube6),delete b.scenery.environmentTexture.cube1,delete b.scenery.environmentTexture.cube2,delete b.scenery.environmentTexture.cube3,delete b.scenery.environmentTexture.cube4,delete b.scenery.environmentTexture.cube5,delete b.scenery.environmentTexture.cube6);if(b.scenery.environmentTexture)for(e=0;e<b.environmentTextures.length;++e)b.environmentTextures[e]!==b.scenery.environmentTexture&&
(this.gl.deleteTexture(b.environmentTextures[e].cube1),this.gl.deleteTexture(b.environmentTextures[e].cube2),this.gl.deleteTexture(b.environmentTextures[e].cube3),this.gl.deleteTexture(b.environmentTextures[e].cube4),this.gl.deleteTexture(b.environmentTextures[e].cube5),this.gl.deleteTexture(b.environmentTextures[e].cube6),delete b.environmentTextures[e].cube1,delete b.environmentTextures[e].cube2,delete b.environmentTextures[e].cube3,delete b.environmentTextures[e].cube4,delete b.environmentTextures[e].cube5,
delete b.environmentTextures[e].cube6)}},Oc=function(b){if(b.physics){for(var d=0;d<b.physics.rigidBodies.length;++d)b.physics.world.removeBody(b.physics.rigidBodies[d]);delete b.physics}},xc=function(b){if(b){this.scene.setParentFromInstance(b);b=[b.sourceNode];for(var d={},e=0;e<b.length;++e){var f=b[e];if(f.polylistIds)for(var h=0;h<f.polylistIds.length;++h){var m=this.scene.get("Polylist",f.polylistIds[h]);d[m.geometry.id]=m.geometry;this.meshes.deallocatePolylist(m)}b=b.concat(f.children)}for(var p in d)this.meshes.deallocateGeometry(d[p])}},
Gc=function(b){if(b){this.scene.setParentFromInstance(b);b=[b.sourceNode];for(var d=0;d<b.length;++d){var e=b[d];if(e.polylistIds)for(var f=0;f<e.polylistIds.length;++f){var h=this.scene.get("Polylist",e.polylistIds[f]);this.meshes.loadPolylistBuffers(h)}b=b.concat(e.children)}}},Fc=function(b){b!==this.scene&&(this.scene&&jc.call(this,this.scene,b),this.scene=b)&&(b.gl=this.gl,this.framesCnt=-1,this.scene.texturesManager.setGlContext(this.gl),this.scene.texturesManager.setFiltersManager(this.filters),
Aa.call(this,this.renderingMode,!0),this.screenTools.setScene(b),bd.call(this,b),dd.call(this),this.scene.baseTypedShader=new stage.emersya.viewer.modules.renderer.animations.matAnimManager(this.scene,{type:1,albedo:{color:[1,1,1],intensity:1},roughness:{intensity:0},metalness:{intensity:0},opacity:{blending:0,glassMode:0,intensity:1},polylists:[]},{isHidden:function(){return!1},customMaterial:{},polylist:{customMaterial:{}}}),this.scene.baseTypedShader.updateShaderType(),Na.call(this),xd.call(this),
Hc.call(this,this.scene),zd.call(this),this.meshEditor&&this.meshEditor.setScene(b),this.lightsEditor&&this.lightsEditor.setScene(b),this.modularEditor&&this.modularEditor.setScene(b),this.materialPreviewManagement&&this.materialPreviewManagement.setScene(b),this.ssaoPhase=this.settings.ssaoInitPhase,this.ssaoFrameCount=10,this.settings.ssaoAutoDisable=!0,this.scene.update())},dd=function(){gc.call(this);Nc.call(this);mb.call(this);Jc.call(this);(this.gl.mrt||this.gl.webgl2)&&qd.call(this);qc.call(this);
cd.call(this);yd.call(this,512);Vb.call(this);fd.call(this);Xc.call(this);hc.call(this);this.multisampling&&(Db.call(this),this.multisampling=!1,Db.call(this),this.multisampling=!0);Db.call(this);Qc.call(this)},Qc=function(){this.needsComputeFurlayers=!0;this.scene&&this.scene.needFurMap&&!this.scene.furMap?this.scene.furMap=this.filters.createGoldNoiseTexture(this.scene.furMapResolution,this.scene.furMapResolution,[0,0,0,1],[!0,!0,!0,!1],.4102037487633703,!0):this.scene&&!this.scene.needFurMap&&
this.scene.furMap&&(this.gl.deleteTexture(this.scene.furMap),this.scene.furMap=0)},fc=function(){this.shaders.createShadowMapShader();this.shaders.createCubeRenderingShader();this.shaders.createEnvironmentRenderingShader();this.shaders.createEnvironmentRenderingForCubeMapShader();this.shaders.createOneColorShader();this.shaders.createFramerateShader();this.shaders.createAntialiasingShader();this.shaders.createScreenTextureShader();this.shaders.createNoiseShader();this.noiseTexture=Fb.call(this,Math.max(Math.round(this.realSize[0]*
this.maxScaling),1),Math.max(Math.round(this.realSize[1]*this.maxScaling),1),!1,!0);this.noiseRandomSeeds=[Math.random(),Math.random()];return!0};l.prototype.checkWebGLErrors=function(){if(!this.checkForErrors)return stage.createResult(null);var b=this.gl.getError();if(b===this.gl.NO_ERROR)return stage.createResult(null);switch(b){case this.gl.CONTEXT_LOST_WEBGL:return stage.createError(204,"Context was lost.",{});case this.gl.OUT_OF_MEMORY:return stage.createError(205,"Out of memory",{});default:return stage.createError(207,
"Unknown rendering error",{glError:b})}};var vb=function(b){switch(b){case 1:this.jitterVectors=[[0,0]];break;case 2:this.jitterVectors=[[-4,-4],[4,4]];break;case 4:this.jitterVectors=[[-2,-6],[6,-2],[-6,2],[2,6]];break;case 8:this.jitterVectors=[[1,-3],[-1,3],[5,1],[-3,-5],[-5,5],[-7,-1],[3,7],[7,-7]];break;case 16:this.jitterVectors=[[1,1],[-1,-3],[-3,2],[4,-1],[-5,-2],[2,5],[5,3],[3,-5],[-2,6],[0,-7],[-4,-6],[-6,4],[-8,0],[7,-4],[6,7],[-7,-8]];break;case 32:this.jitterVectors=[[-4,-7],[-7,-5],
[-3,-5],[-5,-4],[-1,-4],[-2,-2],[-6,-1],[-4,0],[-7,1],[-1,2],[-6,3],[-3,3],[-7,6],[-3,6],[-5,7],[-1,7],[5,-7],[1,-6],[6,-5],[4,-4],[2,-3],[7,-2],[1,-1],[4,-1],[2,1],[6,2],[0,4],[4,4],[2,5],[7,5],[5,6],[3,7]]}this.currentJitteringVector=this.jitterVectors[0];b=1/this.jitterVectors.length;for(var d=0,e=0;e<this.jitterVectors.length;++e)this.sampleWeights[e]=b+.0625*(-.5+(e+.5)/this.jitterVectors.length),this.accumulatedSampleWeights[e]=d+=this.sampleWeights[e]},Fb=function(b,d,e,f){var h=this.gl.createTexture();
this.gl.bindTexture(this.gl.TEXTURE_2D,h);this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE);this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE);e?(this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.NEAREST),this.gl.webgl2?this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.DEPTH24_STENCIL8,b,d,0,this.gl.DEPTH_STENCIL,this.gl.UNSIGNED_INT_24_8,
null):this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.DEPTH_STENCIL,b,d,0,this.gl.DEPTH_STENCIL,this.gl.depthTextures.UNSIGNED_INT_24_8_WEBGL,null)):!f&&this.gl.halfFloatTextures?(this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA16F,b,d,0,this.gl.RGBA,this.gl.HALF_FLOAT,null)):(this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,
this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,b,d,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,null));return h},kc=function(){for(var b in this.globalFramebuffers){var d=this.globalFramebuffers[b];d.globalTexture&&!0!==d.globalTexture&&this.gl.deleteTexture(d.globalTexture);d.fxaaTexture&&!0!==d.fxaaTexture&&this.gl.deleteTexture(d.fxaaTexture);d.preSsaaTexture&&!0!==d.preSsaaTexture&&this.gl.deleteTexture(d.preSsaaTexture);
d.previousGlobalTexture&&!0!==d.previousGlobalTexture&&this.gl.deleteTexture(d.previousGlobalTexture);d.secondPreviousGlobalTexture&&!0!==d.secondPreviousGlobalTexture&&this.gl.deleteTexture(d.secondPreviousGlobalTexture);d.cnehorz&&!0!==d.cnehorz&&this.gl.deleteTexture(d.cnehorz);d.depthRenderbuffer&&!0!==d.depthRenderbuffer&&this.gl.deleteRenderbuffer(d.depthRenderbuffer);d.colorRenderbuffer&&!0!==d.colorRenderbuffer&&this.gl.deleteRenderbuffer(d.colorRenderbuffer);d.previousColorRenderbuffer&&
!0!==d.previousColorRenderbuffer&&this.gl.deleteRenderbuffer(d.previousColorRenderbuffer);d.framebuffer&&!0!==d.framebuffer&&this.gl.deleteFramebuffer(d.framebuffer);d.fxaaFramebuffer&&!0!==d.fxaaFramebuffer&&this.gl.deleteFramebuffer(d.fxaaFramebuffer);d.framebufferForTexture&&!0!==d.framebufferForTexture&&this.gl.deleteFramebuffer(d.framebufferForTexture)}this.globalFramebuffers={}},Db=function(b){if(this.forceGlobalFramebuffer||this.settings.hdOnStop||this.ssaaOnStop||this.settings.screenSpaceRefractDistance){if(!b){b=
!0;!this.adaptativeRes&&this.globalFramebuffers[this.minScaling]&&(b=this.globalFramebuffers[this.minScaling].height,b=this.globalFramebuffers[this.minScaling].width===this.realSize[0]*this.minScaling&&b===this.realSize[1]*this.minScaling);if(this.globalFramebuffers[this.maxScaling]){var d=this.globalFramebuffers[this.maxScaling].width,e=this.globalFramebuffers[this.maxScaling].height;b=b&&d===this.realSize[0]*this.maxScaling&&e===this.realSize[1]*this.maxScaling}else b=!1;if(b)return}kc.call(this);
this.globalFramebuffers[this.maxScaling]={width:Math.max(Math.round(this.realSize[0]*this.maxScaling),1),height:Math.max(Math.round(this.realSize[1]*this.maxScaling),1),globalTexture:!0,fxaaTexture:!0,preSsaaTexture:!0,previousGlobalTexture:!0,secondPreviousGlobalTexture:!0,cnehorz:!0,depthRenderbuffer:!0,colorRenderbuffer:!0,previousColorRenderbuffer:!0,framebuffer:!0,fxaaFramebuffer:!0,framebufferForTexture:!1,multisampled:this.multisampling};this.adaptativeResolution||this.maxScaling==this.minScaling||
(this.globalFramebuffers[this.minScaling]={width:Math.max(Math.round(this.realSize[0]*this.minScaling),1),height:Math.max(Math.round(this.realSize[1]*this.minScaling),1),globalTexture:!0,fxaaTexture:!0,preSsaaTexture:this.settings.hdOnStop,previousGlobalTexture:this.settings.hdOnStop,secondPreviousGlobalTexture:this.settings.hdOnStop,cnehorz:!0,depthRenderbuffer:!0,colorRenderbuffer:!0,previousColorRenderbuffer:this.settings.hdOnStop,framebuffer:!0,fxaaFramebuffer:!0,framebufferForTexture:this.multisampling,
multisampled:this.multisampling});for(var f in this.globalFramebuffers)b=this.globalFramebuffers[f],b.globalTexture=b.globalTexture&&Fb.call(this,b.width,b.height),b.fxaaTexture=b.fxaaTexture&&Fb.call(this,b.width,b.height),b.preSsaaTexture=b.preSsaaTexture&&Fb.call(this,b.width,b.height),b.previousGlobalTexture=b.previousGlobalTexture&&Fb.call(this,b.width,b.height),this.ssaaUniformCenteredDistribution||(b.secondPreviousGlobalTexture=b.secondPreviousGlobalTexture&&Fb.call(this,b.width,b.height)),
b.depthRenderbuffer=b.depthRenderbuffer&&this.gl.createRenderbuffer(),this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,b.depthRenderbuffer),b.multisampled?this.gl.renderbufferStorageMultisample(this.gl.RENDERBUFFER,this.maxSamples,this.gl.DEPTH24_STENCIL8,b.width,b.height):this.gl.renderbufferStorage(this.gl.RENDERBUFFER,this.gl.DEPTH_STENCIL,b.width,b.height),this.gl.webgl2&&b.multisampled&&(b.colorRenderbuffer=b.colorRenderbuffer&&this.gl.createRenderbuffer(),this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,
b.colorRenderbuffer),this.gl.halfFloatTextures?this.gl.renderbufferStorageMultisample(this.gl.RENDERBUFFER,this.maxSamples,this.gl.RGBA16F,b.width,b.height):this.gl.renderbufferStorageMultisample(this.gl.RENDERBUFFER,this.maxSamples,this.gl.RGBA8,b.width,b.height),b.previousColorRenderbuffer=b.previousColorRenderbuffer&&this.gl.createRenderbuffer(),b.previousColorRenderbuffer&&(this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,b.previousColorRenderbuffer),this.gl.halfFloatTextures?this.gl.renderbufferStorageMultisample(this.gl.RENDERBUFFER,
this.maxSamples,this.gl.RGBA16F,b.width,b.height):this.gl.renderbufferStorageMultisample(this.gl.RENDERBUFFER,this.maxSamples,this.gl.RGBA8,b.width,b.height))),b.framebuffer=b.framebuffer&&this.gl.createFramebuffer(),b.fxaaFramebuffer=b.fxaaFramebuffer&&this.gl.createFramebuffer(),b.framebufferForTexture=b.framebuffer&&this.gl.createFramebuffer(),this.gl.webgl2&&b.multisampled?(this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,b.framebuffer),this.gl.framebufferRenderbuffer(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,
this.gl.RENDERBUFFER,b.colorRenderbuffer),this.gl.framebufferRenderbuffer(this.gl.FRAMEBUFFER,this.gl.DEPTH_STENCIL_ATTACHMENT,this.gl.RENDERBUFFER,b.depthRenderbuffer),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,b.framebufferForTexture),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,b.globalTexture,0)):(this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,b.framebuffer),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,
b.globalTexture,0),this.gl.framebufferRenderbuffer(this.gl.FRAMEBUFFER,this.gl.DEPTH_STENCIL_ATTACHMENT,this.gl.RENDERBUFFER,b.depthRenderbuffer)),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,b.fxaaFramebuffer),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,b.fxaaTexture,0);this.gl.bindTexture(this.gl.TEXTURE_2D,null);this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,null);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null);this.globalFramebuffer=this.adaptativeResolution?
this.globalFramebuffers[this.maxScaling]:this.globalFramebuffers[this.currentScaling];this.renderingWidth=Math.max(Math.round(this.realSize[0]*this.maxScaling),1);this.renderingHeight=Math.max(Math.round(this.realSize[1]*this.maxScaling),1)}else kc.call(this)},gc=function(){this.screenTransfMatrix=mat4.create();mat4.ortho(-1,1,-1,1,.5,1.5,this.screenTransfMatrix);this.rawScreenTransfMatrix=mat4.create(this.screenTransfMatrix);this.screenViewMatrix=mat4.create();mat4.lookAt([0,0,1],[0,0,0],[0,1,0],
this.screenViewMatrix);if(!this.vertexBufferScreen){this.vertexBufferScreen=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexBufferScreen);this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array([-1,1,0,-1,-1,0,1,-1,0,1,1,0]),this.gl.STATIC_DRAW);this.uvBufferScreen=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.uvBufferScreen);this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array([0,1,0,0,1,0,1,1]),this.gl.STATIC_DRAW);this.elementsBufferScreen=this.gl.createBuffer();
this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.elementsBufferScreen);this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,0,2,3]),this.gl.STATIC_DRAW);this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1);this.dummyTexture=this.gl.createTexture();this.renderingData.dummyTexture=this.dummyTexture;this.gl.bindTexture(this.gl.TEXTURE_2D,this.dummyTexture);this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE);this.gl.texParameteri(this.gl.TEXTURE_2D,
this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE);this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.NEAREST);this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.NEAREST);var b=new Uint8Array(4);b[0]=0;b[1]=0;b[2]=0;b[3]=0;this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.ALPHA,1,1,0,this.gl.ALPHA,this.gl.UNSIGNED_BYTE,b);this.gl.bindTexture(this.gl.TEXTURE_2D,this.dummyTexture);this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!0);this.renderingData.bindDummyTexture=
stage.setContext(function(){var b=this.renderingData.textureCount++;this.gl.activeTexture(this.gl.TEXTURE0+b);this.gl.bindTexture(this.gl.TEXTURE_2D,this.renderingData.dummyTexture);return b},this);this.dummyTextureCube=this.gl.createTexture();this.renderingData.dummyTextureCube=this.dummyTextureCube;this.gl.bindTexture(this.gl.TEXTURE_CUBE_MAP,this.dummyTextureCube);this.gl.texParameteri(this.gl.TEXTURE_CUBE_MAP,this.gl.TEXTURE_MAG_FILTER,this.gl.NEAREST);this.gl.texParameteri(this.gl.TEXTURE_CUBE_MAP,
this.gl.TEXTURE_MIN_FILTER,this.gl.NEAREST);this.gl.texImage2D(this.gl.TEXTURE_CUBE_MAP_POSITIVE_X,0,this.gl.RGBA,1,1,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,b);this.gl.texImage2D(this.gl.TEXTURE_CUBE_MAP_NEGATIVE_X,0,this.gl.RGBA,1,1,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,b);this.gl.texImage2D(this.gl.TEXTURE_CUBE_MAP_POSITIVE_Y,0,this.gl.RGBA,1,1,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,b);this.gl.texImage2D(this.gl.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,this.gl.RGBA,1,1,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,b);this.gl.texImage2D(this.gl.TEXTURE_CUBE_MAP_POSITIVE_Z,
0,this.gl.RGBA,1,1,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,b);this.gl.texImage2D(this.gl.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,this.gl.RGBA,1,1,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,b);this.gl.bindTexture(this.gl.TEXTURE_CUBE_MAP,null);this.renderingData.bindDummyTextureCube=stage.setContext(function(){var b=this.renderingData.textureCount++;this.gl.activeTexture(this.gl.TEXTURE0+b);this.gl.bindTexture(this.gl.TEXTURE_CUBE_MAP,this.renderingData.dummyTextureCube);return b},this);this.gl.webgl2&&(this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,
!1),this.dummyTexture2dArray=this.gl.createTexture(),this.renderingData.dummyTexture2dArray=this.dummyTexture2dArray,this.gl.bindTexture(this.gl.TEXTURE_2D_ARRAY,this.renderingData.dummyTexture2dArray),this.gl.texParameteri(this.gl.TEXTURE_2D_ARRAY,this.gl.TEXTURE_WRAP_S,this.gl.REPEAT),this.gl.texParameteri(this.gl.TEXTURE_2D_ARRAY,this.gl.TEXTURE_WRAP_T,this.gl.REPEAT),this.gl.texParameteri(this.gl.TEXTURE_2D_ARRAY,this.gl.TEXTURE_MAG_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.gl.TEXTURE_2D_ARRAY,
this.gl.TEXTURE_MIN_FILTER,this.gl.NEAREST),this.gl.texImage3D(this.gl.TEXTURE_2D_ARRAY,0,this.gl.RGBA,1,1,1,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,b),this.gl.bindTexture(this.gl.TEXTURE_2D_ARRAY,null),this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!0),this.renderingData.bindDummyTexture2dArray=stage.setContext(function(){var b=this.renderingData.textureCount++;this.gl.activeTexture(this.gl.TEXTURE0+b);this.gl.bindTexture(this.gl.TEXTURE_2D_ARRAY,this.renderingData.dummyTexture2dArray);return b},this))}},
hc=function(){if(this.settings.renderRulers)if(this.rulerTextureWidth){var b=this.settings.rulersSettings.size*this.maxScaling+"px OpenSans";this.rulerTextHeight=Math.round(this.settings.rulersSettings.size*this.maxScaling*1.33);this.canvasRulerCtx.font=b;this.rulerTextOffset=this.forceSynchronousFramebuffers?0:this.settings.rulersSettings.size*this.maxScaling*.09;this.rulerTextMargin=.5*this.settings.rulersSettings.size*this.maxScaling}else this.canvasRuler=document.createElement("canvas"),this.canvasRuler.width=
200*this.maxScaling,this.canvasRuler.height=70*this.maxScaling,this.canvasRulerCtx=this.canvasRuler.getContext("2d"),b=this.settings.rulersSettings.size*this.maxScaling+"px OpenSans",this.rulerTextOffset=this.forceSynchronousFramebuffers?0:this.settings.rulersSettings.size*this.maxScaling*.09,this.rulerTextMargin=.5*this.settings.rulersSettings.size*this.maxScaling,this.rulerTextHeight=Math.round(this.settings.rulersSettings.size*this.maxScaling*1.33),this.canvasRulerCtx.font=b,this.rulerTextureWidth=
this.gl.createTexture(),this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!0),this.gl.bindTexture(this.gl.TEXTURE_2D,this.rulerTextureWidth),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.webgl2?this.gl.LINEAR_MIPMAP_LINEAR:
this.gl.LINEAR),this.gl.bindTexture(this.gl.TEXTURE_2D,null),this.rulerTextureDepth=this.gl.createTexture(),this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!0),this.gl.bindTexture(this.gl.TEXTURE_2D,this.rulerTextureDepth),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,
this.gl.TEXTURE_MIN_FILTER,this.gl.webgl2?this.gl.LINEAR_MIPMAP_LINEAR:this.gl.LINEAR),this.gl.bindTexture(this.gl.TEXTURE_2D,null),this.rulerTextureHeight=this.gl.createTexture(),this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!0),this.gl.bindTexture(this.gl.TEXTURE_2D,this.rulerTextureHeight),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,
this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.webgl2?this.gl.LINEAR_MIPMAP_LINEAR:this.gl.LINEAR),this.gl.bindTexture(this.gl.TEXTURE_2D,null),b=rc.call(this)/4,b=[0,0,-b,0,0,b,0,0,0,1,0,0,1,0,-b,1,0,b],this.vertexBufferRuler=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexBufferRuler),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(b),this.gl.STATIC_DRAW),this.elementsBufferRuler=this.gl.createBuffer(),
this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.elementsBufferRuler),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,3,4,5]),this.gl.STATIC_DRAW)},rc=function(){return this.scene&&this.scene.root.boundingBoxWithoutNodes?Math.min(.2,.1*this.scene.root.boundingBoxWithoutNodes.radius):.2},Mb=function(b,d,e){this.shaders.useEnvironmentRenderingForCubeMapShader(this.renderingData);this.gl.depthMask(!1);this.gl.disable(this.gl.DEPTH_TEST);this.gl.bindBuffer(this.gl.ARRAY_BUFFER,
this.cubeVBuffer);this.gl.uniform1i(this.renderingData.locations.kebjccr,this.scene.scenery.environmentRelativeToCamera);this.gl.uniform1f(this.renderingData.locations.laicxpp,this.scene.tonemapping.multiplier);this.gl.uniform1f(this.renderingData.locations.mjjhnsa,this.scene.tonemapping.maxLuminance);this.gl.uniform1f(this.renderingData.locations.dzrcnqh,10);this.gl.uniform1f(this.renderingData.locations.vztvedk,b);this.gl.uniform1f(this.renderingData.locations.ikywnlr,!this.gl.halfFloatTexturesForEnvCubes&&
0>e?e:0);this.gl.vertexAttribPointer(this.renderingData.locations.ymaxekn,3,this.gl.FLOAT,!1,0,0);this.gl.uniformMatrix4fv(this.renderingData.locations.ampnorz,!1,mat4.toRotationMat(this.renderingData.viewMatrix));this.gl.uniformMatrix4fv(this.renderingData.locations.ghgsnpw,!1,this.cubeProjMatrix);this.renderingData.textureCount=0;this.gl.activeTexture(this.gl.TEXTURE0);this.gl.uniform1i(this.renderingData.locations.gxvoadx,d.loadToShader(this.renderingData,null,null,null,{wrapS:"REPEAT",wrapT:"CLAMP_TO_EDGE",
minFilter:"LINEAR",magFilter:"LINEAR",useMipmap:!1,anisotropy:0}));this.gl.uniform1f(this.renderingData.locations.oevhrqy,d.finalImage.currentWidth);this.gl.uniform2f(this.renderingData.locations.qxxpdff,this.gl.viewportWidth,this.gl.viewportHeight);this.gl.disable(this.gl.CULL_FACE);this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.cubeIBuffer);this.gl.drawElements(this.gl.TRIANGLES,36,this.gl.UNSIGNED_SHORT,0);this.gl.depthMask(!0);this.gl.enable(this.gl.DEPTH_TEST)},Nc=function(){if(this.forceSFX||
this.settings.renderGlow&&this.scene&&this.scene.hasSomeGlow)this.shaders.createGlowRenderingShader(),this.shaders.createTextureFilterVert2Shader(),this.shaders.createTextureFilterHori2Shader(),this.shaders.createTextureFilterVert3Shader(),this.shaders.createTextureFilterHori3Shader(),this.shaders.createTextureFilterVert7Shader(),this.shaders.createTextureFilterHori7Shader(),this.glowWidth=Math.max(Math.round(this.realSize[0]*this.minScaling/this.settings.glowReduction),1),this.glowHeight=Math.max(Math.round(this.realSize[1]*
this.minScaling/this.settings.glowReduction),1),this.glowTexture&&(this.gl.deleteTexture(this.glowTexture),this.gl.deleteTexture(this.glow2Texture)),this.glowFramebuffer&&(this.gl.deleteFramebuffer(this.glowFramebuffer),this.gl.deleteRenderbuffer(this.glowRenderbuffer)),this.glowFramebuffer=this.gl.createFramebuffer(),this.glowRenderbuffer=this.gl.createRenderbuffer(),this.glowTexture=this.gl.createTexture(),this.gl.bindTexture(this.gl.TEXTURE_2D,this.glowTexture),this.gl.texParameteri(this.gl.TEXTURE_2D,
this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.floatTextures?(this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA32F,this.glowWidth,this.glowHeight,0,this.gl.RGBA,this.gl.FLOAT,null)):(this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,
this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.glowWidth,this.glowHeight,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,null)),this.glow2Texture=this.gl.createTexture(),this.gl.bindTexture(this.gl.TEXTURE_2D,this.glow2Texture),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),
this.gl.floatTextures?(this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA32F,this.glowWidth,this.glowHeight,0,this.gl.RGBA,this.gl.FLOAT,null)):(this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texImage2D(this.gl.TEXTURE_2D,
0,this.gl.RGBA,this.glowWidth,this.glowHeight,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,null)),this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,this.glowRenderbuffer),this.gl.renderbufferStorage(this.gl.RENDERBUFFER,this.gl.DEPTH_COMPONENT16,this.glowWidth,this.glowHeight),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.glowFramebuffer),this.gl.framebufferRenderbuffer(this.gl.FRAMEBUFFER,this.gl.DEPTH_ATTACHMENT,this.gl.RENDERBUFFER,this.glowRenderbuffer),this.gl.bindTexture(this.gl.TEXTURE_2D,null),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,
null),this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,null)},mb=function(){if(this.forceSFX||this.settings.renderSpecularGlow&&this.scene&&this.scene.hasSomeSpecularGlow)this.shaders.createTextureFilterVert2Shader(),this.shaders.createTextureFilterHori2Shader(),this.shaders.createTextureFilterVert3Shader(),this.shaders.createTextureFilterHori3Shader(),this.shaders.createTextureFilterVert7Shader(),this.shaders.createTextureFilterHori7Shader(),this.specularGlowWidth=Math.max(Math.round(this.realSize[0]*
this.minScaling/this.settings.specularGlowReduction),1),this.specularGlowHeight=Math.max(Math.round(this.realSize[1]*this.minScaling/this.settings.specularGlowReduction),1),this.specularGlowTexture&&this.gl.deleteTexture(this.specularGlowTexture),this.specularGlowFramebuffer&&(this.gl.deleteFramebuffer(this.specularGlowFramebuffer),this.gl.deleteRenderbuffer(this.specularGlowRenderbuffer)),this.specularGlowFramebuffer=this.gl.createFramebuffer(),this.specularGlowRenderbuffer=this.gl.createRenderbuffer(),
this.specularGlowTexture=this.gl.createTexture(),this.gl.bindTexture(this.gl.TEXTURE_2D,this.specularGlowTexture),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.floatTextures?this.gl.texImage2D(this.gl.TEXTURE_2D,
0,this.gl.RGBA32F,this.specularGlowWidth,this.specularGlowHeight,0,this.gl.RGBA,this.gl.FLOAT,null):this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.specularGlowWidth,this.specularGlowHeight,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,null),this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,this.specularGlowRenderbuffer),this.gl.renderbufferStorage(this.gl.RENDERBUFFER,this.gl.DEPTH_STENCIL,this.specularGlowWidth,this.specularGlowHeight),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.specularGlowFramebuffer),
this.gl.framebufferRenderbuffer(this.gl.FRAMEBUFFER,this.gl.DEPTH_STENCIL_ATTACHMENT,this.gl.RENDERBUFFER,this.specularGlowRenderbuffer),this.gl.bindTexture(this.gl.TEXTURE_2D,null),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,null)},Jb=function(){this.backgroundAlpha&&(this.shaders.useFramerateShader(this.renderingData),this.gl.enable(this.gl.BLEND),this.gl.disable(this.gl.DEPTH_TEST),this.gl.depthMask(!1),this.gl.uniformMatrix4fv(this.renderingData.locations.ampnorz,
!1,this.screenViewMatrix),this.gl.uniformMatrix4fv(this.renderingData.locations.ghgsnpw,!1,this.screenTransfMatrix),this.gl.uniformMatrix4fv(this.renderingData.locations.ondssmn,!1,this.renderingData.identityMatrix),this.gl.uniform1i(this.renderingData.locations.dkgckvl,0),this.gl.uniform1f(this.renderingData.locations.mnxuvqf,this.backgroundAlpha),this.gl.uniform4f(this.renderingData.locations.srrtdcb,this.clearColor.r,this.clearColor.g,this.clearColor.b,this.clearColor.a),this.gl.uniform1i(this.renderingData.locations.yitacsf,
this.invertBackgroundX),this.backgroundTexture?(this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this.backgroundTexture)):(this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this.dummyTexture)),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexBufferScreen),this.gl.vertexAttribPointer(this.renderingData.locations.ymaxekn,3,this.gl.FLOAT,!1,0,0),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.backgroundTexCoord),this.gl.vertexAttribPointer(this.renderingData.locations.aUv[0],
2,this.gl.FLOAT,!1,0,0),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.elementsBufferScreen),this.gl.drawElements(this.gl.TRIANGLES,6,this.gl.UNSIGNED_SHORT,0),this.gl.disable(this.gl.BLEND),this.gl.depthMask(!0),this.gl.enable(this.gl.DEPTH_TEST))},Jc=function(){(this.gl.webgl2||this.gl.mrt)&&this.shaders.createDepthAndNormalsShader()||(this.shaders.createShadowMapShader(),this.gl.mrt=null);var b=this.depthAndNormalsWidth,d=this.depthAndNormalsHeight;this.depthAndNormalsWidth=Math.max(Math.round(this.realSize[0]*
this.minScaling/this.settings.depthAndNormalsReduction),1);this.depthAndNormalsHeight=Math.max(Math.round(this.realSize[1]*this.minScaling/this.settings.depthAndNormalsReduction),1);if(b!==this.depthAndNormalsWidth||d!==this.depthAndNormalsHeight)this.positionsTexture&&(this.gl.deleteTexture(this.positionsTexture),this.gl.deleteTexture(this.normalsAndDepthTexture)),this.positionsTexture=this.gl.createTexture(),this.normalsAndDepthTexture=this.gl.createTexture(),this.gl.bindTexture(this.gl.TEXTURE_2D,
this.positionsTexture),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.floatTextures?(this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA32F,this.depthAndNormalsWidth,this.depthAndNormalsHeight,0,this.gl.RGBA,
this.gl.FLOAT,null)):(this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.depthAndNormalsWidth,this.depthAndNormalsHeight,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,null)),this.gl.bindTexture(this.gl.TEXTURE_2D,this.normalsAndDepthTexture),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,
this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.floatTextures?(this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA32F,this.depthAndNormalsWidth,this.depthAndNormalsHeight,0,this.gl.RGBA,this.gl.FLOAT,null)):(this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,
this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.depthAndNormalsWidth,this.depthAndNormalsHeight,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,null)),this.positionsDepthAndNormalsFramebuffer&&(this.gl.deleteFramebuffer(this.positionsDepthAndNormalsFramebuffer),this.gl.deleteRenderbuffer(this.depthAndNormalsRenderbuffer)),this.positionsDepthAndNormalsFramebuffer=this.gl.createFramebuffer(),this.depthAndNormalsRenderbuffer=this.gl.createRenderbuffer(),this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,
this.depthAndNormalsRenderbuffer),this.gl.renderbufferStorage(this.gl.RENDERBUFFER,this.gl.DEPTH_COMPONENT16,this.depthAndNormalsWidth,this.depthAndNormalsHeight),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.positionsDepthAndNormalsFramebuffer),this.gl.framebufferRenderbuffer(this.gl.FRAMEBUFFER,this.gl.DEPTH_ATTACHMENT,this.gl.RENDERBUFFER,this.depthAndNormalsRenderbuffer),this.gl.webgl2?(this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,this.positionsTexture,
0),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT1,this.gl.TEXTURE_2D,this.normalsAndDepthTexture,0)):this.gl.mrt?(this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.mrt.COLOR_ATTACHMENT0_WEBGL,this.gl.TEXTURE_2D,this.positionsTexture,0),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.mrt.COLOR_ATTACHMENT1_WEBGL,this.gl.TEXTURE_2D,this.normalsAndDepthTexture,0)):this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,
this.positionsTexture,0),this.gl.bindTexture(this.gl.TEXTURE_2D,null),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,null)},qd=function(){if(this.forceSFX||this.settings.renderHighlightedSilhouettes&&this.scene&&this.scene.highlight.showSilhouettes)this.shaders.createSilhouettesFromShadowShader(),this.highlightPositionsTexture&&(this.gl.deleteTexture(this.highlightPositionsTexture),this.gl.deleteTexture(this.highlightRenderTexture)),this.highlightScaling=
.5,this.highlightWidth=Math.max(Math.round(this.realSize[0]*this.minScaling*this.highlightScaling),1),this.highlightHeight=Math.max(Math.round(this.realSize[1]*this.minScaling*this.highlightScaling),1),this.highlightPositionsTexture=this.gl.createTexture(),this.gl.bindTexture(this.gl.TEXTURE_2D,this.highlightPositionsTexture),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),
this.gl.floatTextures?(this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA32F,this.highlightWidth,this.highlightHeight,0,this.gl.RGBA,this.gl.FLOAT,null)):(this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texImage2D(this.gl.TEXTURE_2D,
0,this.gl.RGBA,this.highlightWidth,this.highlightHeight,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,null)),this.highlightRenderTexture=this.gl.createTexture(),this.gl.bindTexture(this.gl.TEXTURE_2D,this.highlightRenderTexture),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.floatTextures?(this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),
this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA32F,this.highlightWidth,this.highlightHeight,0,this.gl.RGBA,this.gl.FLOAT,null)):(this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.highlightWidth,this.highlightHeight,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,
null)),this.gl.bindTexture(this.gl.TEXTURE_2D,null),this.hightlightFramebuffer&&(this.gl.deleteFramebuffer(this.hightlightFramebuffer),this.gl.deleteRenderbuffer(this.highlightRenderbuffer)),this.hightlightFramebuffer=this.gl.createFramebuffer(),this.highlightRenderbuffer=this.gl.createRenderbuffer(),this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,this.highlightRenderbuffer),this.gl.renderbufferStorage(this.gl.RENDERBUFFER,this.gl.DEPTH_COMPONENT16,this.highlightWidth,this.highlightHeight),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,
this.hightlightFramebuffer),this.gl.framebufferRenderbuffer(this.gl.FRAMEBUFFER,this.gl.DEPTH_ATTACHMENT,this.gl.RENDERBUFFER,this.highlightRenderbuffer),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,null),this.highlightClearColor=this.scene?this.apiCore.exec(this.callerName,"lib.isColorDark",this.apiCore.exec(this.callerName,"lib.rgbToHex",{r:255*this.scene.highlight.borderColor[0],g:255*this.scene.highlight.borderColor[1],b:255*this.scene.highlight.borderColor[2]}))?
[1,1,1,0]:[0,0,0,0]:[0,0,0,0]},Mc=function(){if(this.ssaoFramebuffers){for(var b in this.ssaoFramebuffers){var d=this.ssaoFramebuffers[b];d.ssaoTexture&&!0!==d.ssaoTexture&&this.gl.deleteTexture(d.ssaoTexture);d.ssaoFilterTexture&&!0!==d.ssaoFilterTexture&&this.gl.deleteTexture(d.ssaoFilterTexture);d.normalsTexture&&!0!==d.normalsTexture&&this.gl.deleteTexture(d.normalsTexture);d.depthTexture&&!0!==d.depthTexture&&this.gl.deleteTexture(d.depthTexture);d.depthBuffer&&!0!==d.depthBuffer&&this.gl.deleteRenderbuffer(d.depthBuffer);
d.normalZBuffer&&!0!==d.normalZBuffer&&this.gl.deleteRenderbuffer(d.normalZBuffer);d.ssaoFramebuffer&&!0!==d.ssaoFramebuffer&&this.gl.deleteFramebuffer(d.ssaoFramebuffer)}delete this.ssaoFramebuffers}},qc=function(){if(this.scene)if(this.settings.renderSSAO){if(this.ssaoFramebuffers&&this.ssaoFramebuffers[this.minScaling]&&this.ssaoFramebuffers[this.maxScaling]){var b=this.ssaoFramebuffers[this.minScaling].height,d=this.ssaoFramebuffers[this.maxScaling].width,e=this.ssaoFramebuffers[this.maxScaling].height;
if(this.ssaoFramebuffers[this.minScaling].width===this.realSize[0]*this.minScaling&&b===this.realSize[1]*this.minScaling&&d===this.realSize[0]*this.maxScaling&&e===this.realSize[1]*this.maxScaling)return}this.shaders.createSSAOShaders(this.settings.ssaoDepthThreshold);this.shaders.createSSAOFilteringShader();Mc.call(this);this.ssaoFramebuffers={};this.ssaoFramebuffers[this.maxScaling]={width:Math.max(Math.round(this.realSize[0]*this.maxScaling),1),height:Math.max(Math.round(this.realSize[1]*this.maxScaling),
1),ssaoTexture:!0,ssaoFilterTexture:!0,normalsTexture:!0,depthTexture:!0,depthBuffer:!0,normalZBuffer:!this.gl.webgl2,ssaoFramebuffer:!0};this.maxScaling!=this.minScaling&&(this.ssaoFramebuffers[this.minScaling]={width:Math.max(Math.round(this.realSize[0]*this.minScaling),1),height:Math.max(Math.round(this.realSize[1]*this.minScaling),1),ssaoTexture:!0,ssaoFilterTexture:!0,normalsTexture:!0,depthTexture:!0,depthBuffer:!0,normalZBuffer:!this.gl.webgl2,ssaoFramebuffer:!0});for(var f in this.ssaoFramebuffers)b=
this.ssaoFramebuffers[f],d=b.width,e=b.height,b.ssaoTexture=Fb.call(this,d,e,!1,!0),b.ssaoFilterTexture=Fb.call(this,d,e,!1,!0),b.normalsTexture=Fb.call(this,d,e,!1,!0),b.depthTexture=this.gl.createTexture(),this.gl.bindTexture(this.gl.TEXTURE_2D,b.depthTexture),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,
this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.webgl2&&this.gl.floatTextures?this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RG32F,d,e,0,this.gl.RG,this.gl.FLOAT,null):this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,d,e,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,null),b.depthBuffer=this.gl.createRenderbuffer(),this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,b.depthBuffer),this.gl.renderbufferStorage(this.gl.RENDERBUFFER,this.gl.DEPTH_STENCIL,
d,e),b.normalZBuffer&&(b.normalZBuffer=this.gl.createRenderbuffer(),this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,b.normalZBuffer),this.gl.renderbufferStorage(this.gl.RENDERBUFFER,this.gl.DEPTH_STENCIL,d,e)),b.ssaoFramebuffer=this.gl.createFramebuffer();this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null);this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,null);this.gl.bindTexture(this.gl.TEXTURE_2D,null);this.ssaoFramebuffer=this.ssaoFramebuffers[this.maxScaling];this.sSaoRamdomSeed=[Math.random(),Math.random()];
this.sSaoBlurRadius=8;this.sSaoBlurStdDev=4;this.sSaoHSampleOffsets=new Float32Array(2*(this.sSaoBlurRadius+1));this.sSaoVSampleOffsets=new Float32Array(2*(this.sSaoBlurRadius+1));this.sSaoSampleWeights=new Float32Array(this.sSaoBlurRadius+1);for(f=0;f<=this.sSaoBlurRadius;f++)this.sSaoHSampleOffsets[2*f]=this.sSaoVSampleOffsets[2*f+1]=f,this.sSaoHSampleOffsets[2*f+1]=this.sSaoVSampleOffsets[2*f]=0,this.sSaoSampleWeights[f]=Math.exp(-(f*f)/(2*this.sSaoBlurStdDev*this.sSaoBlurStdDev))/(Math.sqrt(2*
Math.PI)*this.sSaoBlurStdDev)}else Mc.call(this)},gd=function(){if(this.gl.webgl2||this.gl.mrt){this.shaders.useDepthAndNormalsShader(this.renderingData);this.gl.disable(this.gl.BLEND);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.positionsDepthAndNormalsFramebuffer);this.gl.webgl2?(this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,this.positionsTexture,0),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT1,this.gl.TEXTURE_2D,this.normalsAndDepthTexture,
0),this.gl.drawBuffers([this.gl.COLOR_ATTACHMENT0,this.gl.COLOR_ATTACHMENT1])):(this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.mrt.COLOR_ATTACHMENT0_WEBGL,this.gl.TEXTURE_2D,this.positionsTexture,0),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.mrt.COLOR_ATTACHMENT1_WEBGL,this.gl.TEXTURE_2D,this.normalsAndDepthTexture,0),this.gl.mrt.drawBuffersWEBGL([this.gl.mrt.COLOR_ATTACHMENT0_WEBGL,this.gl.mrt.COLOR_ATTACHMENT1_WEBGL]));this.gl.viewport(0,0,this.depthAndNormalsWidth,this.depthAndNormalsHeight);
this.gl.scissor(0,0,this.depthAndNormalsWidth,this.depthAndNormalsHeight);this.gl.clearColor(0,0,0,0);this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT);this.gl.uniformMatrix4fv(this.renderingData.locations.ghgsnpw,!1,this.renderingData.projectionMatrix);this.gl.uniformMatrix4fv(this.renderingData.locations.ampnorz,!1,this.renderingData.viewMatrix);this.gl.uniform3f(this.renderingData.locations.xzwunne,this.renderingData.cameraPosition[0],this.renderingData.cameraPosition[1],this.renderingData.cameraPosition[2]);
this.gl.enable(this.gl.POLYGON_OFFSET_FILL);for(var b=0;b<this.scene.polylistInstances.length;++b)this.meshes.renderForShadowMaps(this.renderingData,this.scene.polylistInstances[b]);this.gl.disable(this.gl.POLYGON_OFFSET_FILL)}else{this.shaders.useShadowShader(this.renderingData);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.positionsDepthAndNormalsFramebuffer);this.gl.disable(this.gl.BLEND);this.gl.viewport(0,0,this.depthAndNormalsWidth,this.depthAndNormalsHeight);this.gl.scissor(0,0,this.depthAndNormalsWidth,
this.depthAndNormalsHeight);this.gl.clearColor(0,0,0,0);this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT);this.gl.disable(this.gl.DEPTH_TEST);this.gl.uniformMatrix4fv(this.renderingData.locations.ghgsnpw,!1,this.renderingData.projectionMatrix);this.gl.uniformMatrix4fv(this.renderingData.locations.ampnorz,!1,this.renderingData.viewMatrix);this.gl.uniform3f(this.renderingData.locations.xzwunne,this.renderingData.cameraPosition[0],this.renderingData.cameraPosition[1],this.renderingData.cameraPosition[2]);
this.gl.uniform1f(this.renderingData.locations.oruddbu,this.far-this.near);this.gl.disable(this.gl.DEPTH_TEST);this.gl.enable(this.gl.POLYGON_OFFSET_FILL);for(b=0;b<this.scene.polylistInstances.length;++b){var d=this.scene.polylistInstances[b];d.matAnim.isOpaque(!0)&&this.meshes.renderForShadowMaps(this.renderingData,d)}this.gl.enable(this.gl.DEPTH_TEST);this.gl.disable(this.gl.POLYGON_OFFSET_FILL);b=this.depthAndNormalsWidth;d=this.depthAndNormalsHeight;if(this.gl.floatTextures){var e=new Float32Array(4*
b*d);this.gl.readPixels(0,0,b,d,this.gl.RGBA,this.gl.FLOAT,e)}else e=new Uint8Array(4*b*d),this.gl.readPixels(0,0,b,d,this.gl.RGBA,this.gl.UNSIGNED_BYTE,e)}this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null)},lc=function(){this.shaders.useOneColorShader(this.renderingData,!0);var b=!0;this.gl.uniform1i(this.renderingData.locations.rfausvd,1);this.gl.uniformMatrix4fv(this.renderingData.locations.ghgsnpw,!1,this.renderingData.projectionMatrix);this.gl.uniformMatrix4fv(this.renderingData.locations.ampnorz,
!1,this.renderingData.viewMatrix);for(var d in this.scene.polylistInstances){var e=this.scene.polylistInstances[d];if(e.matAnim.isOpaque(!0)||e.matAnim.shaderType.has(stage.emersya.viewer.modules.renderer.shaders.shaderTypes.SCREENSPACE_REFRACTION))this.settings.renderFur&&e.matAnim.shaderType.has(stage.emersya.viewer.modules.renderer.shaders.shaderTypes.PBR_FUR)?(b&&(this.shaders.useFurShader(this.renderingData,e.matAnim.shaderType),b=!1,this.gl.uniformMatrix4fv(this.renderingData.locations.ghgsnpw,
!1,this.renderingData.projectionMatrix),this.gl.uniformMatrix4fv(this.renderingData.locations.ampnorz,!1,this.renderingData.viewMatrix),this.gl.uniform1i(this.renderingData.locations.cfqxgas,0)),this.renderingData.textureCount=0,this.gl.uniform4f(this.renderingData.locations.srrtdcb,0,1,0,1),this.meshes.renderForFur(this.renderingData,e)):(b||(this.shaders.useOneColorShader(this.renderingData,!0),b=!0,this.gl.uniform1i(this.renderingData.locations.rfausvd,1),this.gl.uniformMatrix4fv(this.renderingData.locations.ghgsnpw,
!1,this.renderingData.projectionMatrix),this.gl.uniformMatrix4fv(this.renderingData.locations.ampnorz,!1,this.renderingData.viewMatrix)),this.gl.uniform4f(this.renderingData.locations.srrtdcb,e.matAnim.shaderType.has(stage.emersya.viewer.modules.renderer.shaders.shaderTypes.SCREENSPACE_REFRACTION)?1:0,0,0,1),this.meshes.renderForShadowMaps(this.renderingData,e))}},rd=function(){this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.positionsDepthAndNormalsFramebuffer);this.gl.disable(this.gl.BLEND);this.gl.viewport(0,
0,this.depthAndNormalsWidth,this.depthAndNormalsHeight);this.gl.scissor(0,0,this.depthAndNormalsWidth,this.depthAndNormalsHeight);this.gl.clearColor(0,0,0,0);this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT);this.gl.enable(this.gl.POLYGON_OFFSET_FILL);lc.call(this);var b=this.depthAndNormalsWidth,d=this.depthAndNormalsHeight;if(this.gl.floatTextures){var e=new Float32Array(4*b*d);this.gl.readPixels(0,0,b,d,this.gl.RGBA,this.gl.FLOAT,e)}else e=new Uint8Array(4*b*d),this.gl.readPixels(0,
0,b,d,this.gl.RGBA,this.gl.UNSIGNED_BYTE,e);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null);return e},wd=function(b,d,e){this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.positionsDepthAndNormalsFramebuffer);this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,this.positionsTexture,0);this.gl.disable(this.gl.BLEND);this.gl.viewport(0,0,this.depthAndNormalsWidth,this.depthAndNormalsHeight);this.gl.scissor(0,0,this.depthAndNormalsWidth,this.depthAndNormalsHeight);
this.gl.clearColor(0,0,0,0);this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT);this.gl.enable(this.gl.POLYGON_OFFSET_FILL);this.gl.colorMask(!1,!1,!1,!1);fa.call(this,d);fa.call(this,e);lc.call(this);fa.call(this,b);la.call(this,d);this.gl.colorMask(!0,!0,!0,!0);lc.call(this);la.call(this,b);this.gl.disable(this.gl.POLYGON_OFFSET_FILL);this.gl.enable(this.gl.DEPTH_TEST);b=this.depthAndNormalsWidth;d=this.depthAndNormalsHeight;this.gl.floatTextures?(e=new Float32Array(4*b*d),this.gl.readPixels(0,
0,b,d,this.gl.RGBA,this.gl.FLOAT,e)):(e=new Uint8Array(4*b*d),this.gl.readPixels(0,0,b,d,this.gl.RGBA,this.gl.UNSIGNED_BYTE,e));this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null);return e},sc=function(b,d,e){var f=this.gl.createTexture();this.gl.bindTexture(this.gl.TEXTURE_2D,f);this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR);this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR);this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,
this.gl.CLAMP_TO_EDGE);this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE);this.gl.floatTextures?this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA32F,b,d,0,this.gl.RGBA,this.gl.FLOAT,null):this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,b,d,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,null);var h=this.gl.createTexture();this.gl.bindTexture(this.gl.TEXTURE_2D,h);this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR);this.gl.texParameteri(this.gl.TEXTURE_2D,
this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR);this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE);this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE);this.gl.floatTextures?this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA32F,b,d,0,this.gl.RGBA,this.gl.FLOAT,null):this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,b,d,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,null);this.gl.bindTexture(this.gl.TEXTURE_2D,null);var m=this.gl.createFramebuffer(),
p=this.gl.createRenderbuffer();this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,p);this.gl.renderbufferStorage(this.gl.RENDERBUFFER,this.gl.DEPTH_COMPONENT16,b,d);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,m);this.gl.framebufferRenderbuffer(this.gl.FRAMEBUFFER,this.gl.DEPTH_ATTACHMENT,this.gl.RENDERBUFFER,p);this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,f,0);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,m);this.gl.viewport(0,0,b,d);this.gl.scissor(0,0,b,
d);this.gl.clearColor(0,0,0,0);this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT);this.gl.enable(this.gl.POLYGON_OFFSET_FILL);for(var g=0;g<this.jitterVectors.length;++g)this.gl.disable(this.gl.BLEND),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),this.ssaaFramesCnt=g+1,e?e():mc.call(this),lc.call(this),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,h,0),g||this.gl.clear(this.gl.COLOR_BUFFER_BIT),Xa.call(this,f,1/this.jitterVectors.length,
!1,!0),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,f,0);this.gl.disable(this.gl.POLYGON_OFFSET_FILL);this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,h,0);this.gl.floatTextures?(e=new Float32Array(4*b*d),this.gl.readPixels(0,0,b,d,this.gl.RGBA,this.gl.FLOAT,e)):(e=new Uint8Array(4*b*d),this.gl.readPixels(0,0,b,d,this.gl.RGBA,this.gl.UNSIGNED_BYTE,e));this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null);this.gl.enable(this.gl.DEPTH_TEST);
this.gl.deleteTexture(h);this.gl.deleteTexture(f);this.gl.deleteRenderbuffer(p);this.gl.deleteFramebuffer(m);return e},hd=function(b,d,e,f,h){var m=this.gl.createTexture();this.gl.bindTexture(this.gl.TEXTURE_2D,m);this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR);this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR);this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE);this.gl.texParameteri(this.gl.TEXTURE_2D,
this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE);this.gl.floatTextures?this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA32F,b,d,0,this.gl.RGBA,this.gl.FLOAT,null):this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,b,d,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,null);var p=this.gl.createTexture();this.gl.bindTexture(this.gl.TEXTURE_2D,p);this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR);this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR);
this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE);this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE);this.gl.floatTextures?this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA32F,b,d,0,this.gl.RGBA,this.gl.FLOAT,null):this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,b,d,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,null);this.gl.bindTexture(this.gl.TEXTURE_2D,null);var g=this.gl.createFramebuffer(),n=this.gl.createRenderbuffer();
this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,n);this.gl.renderbufferStorage(this.gl.RENDERBUFFER,this.gl.DEPTH_COMPONENT16,b,d);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,g);this.gl.framebufferRenderbuffer(this.gl.FRAMEBUFFER,this.gl.DEPTH_ATTACHMENT,this.gl.RENDERBUFFER,n);this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,m,0);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,g);this.gl.viewport(0,0,b,d);this.gl.scissor(0,0,b,d);this.gl.clearColor(0,0,0,0);
this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT);this.gl.enable(this.gl.POLYGON_OFFSET_FILL);for(var v=0;v<this.jitterVectors.length;++v)this.gl.disable(this.gl.BLEND),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),this.ssaaFramesCnt=v+1,mc.call(this),this.gl.colorMask(!1,!1,!1,!1),fa.call(this,f),fa.call(this,h),lc.call(this),fa.call(this,e),la.call(this,f),this.gl.colorMask(!0,!0,!0,!0),lc.call(this),la.call(this,e),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,
this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,p,0),v||this.gl.clear(this.gl.COLOR_BUFFER_BIT),Xa.call(this,m,1/this.jitterVectors.length,!1,!0),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,m,0);this.gl.disable(this.gl.POLYGON_OFFSET_FILL);this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,p,0);this.gl.floatTextures?(e=new Float32Array(4*b*d),this.gl.readPixels(0,0,b,d,this.gl.RGBA,this.gl.FLOAT,e)):(e=new Uint8Array(4*
b*d),this.gl.readPixels(0,0,b,d,this.gl.RGBA,this.gl.UNSIGNED_BYTE,e));this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null);this.gl.enable(this.gl.DEPTH_TEST);this.gl.deleteTexture(p);this.gl.deleteTexture(m);this.gl.deleteRenderbuffer(n);this.gl.deleteFramebuffer(g);return e},yc=function(b){this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.positionsDepthAndNormalsFramebuffer);this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,this.positionsTexture,0);this.gl.disable(this.gl.BLEND);
this.gl.viewport(0,0,this.depthAndNormalsWidth,this.depthAndNormalsHeight);this.gl.scissor(0,0,this.depthAndNormalsWidth,this.depthAndNormalsHeight);this.gl.clearColor(0,0,0,0);this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT);for(var d in this.scene.polylists){var e=this.scene.polylists[d];e.isHidden=e.id!=b}this.gl.enable(this.gl.POLYGON_OFFSET_FILL);lc.call(this);for(d in this.scene.polylists)e=this.scene.polylists[d],e.isHidden=!1;b=this.depthAndNormalsWidth;d=this.depthAndNormalsHeight;
this.gl.floatTextures?(e=new Float32Array(4*b*d),this.gl.readPixels(0,0,b,d,this.gl.RGBA,this.gl.FLOAT,e)):(e=new Uint8Array(4*b*d),this.gl.readPixels(0,0,b,d,this.gl.RGBA,this.gl.UNSIGNED_BYTE,e));this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null);return e},Kb=0,Zb=0,Yc=function(){if(this.adaptativeResolution)return this.ssaoHD;if(!this.anyMouseButtonPressed&&(1<this.jitterVectors.length||this.firstNoRender)){if(this.ssaoPhase==b.SSAO_OFF&&(this.ssaoPhase=this.settings.ssaoAutoDisable&&0<this.settings.ssaoIntensity2?
b.LEVEL_2ND_OFF:b.FIXE_16_SAMPLES,this.debugSSAO)){var d=Object.keys(b);console.log("Restor ssao state",d[this.ssaoPhase])}return!0}if(!this.framerate)return this.ssaoPhase!=b.TEST_16_SAMPLES&&this.ssaoPhase!=b.TEST_32_SAMPLES||this.scene.update(),!1;var e=this.ssaoPhase;switch(this.ssaoPhase){case b.TEST_16_SAMPLES:Kb=30>this.framerate?Kb+1:0;Zb=30<=this.framerate?Zb+1:0;Zb>this.ssaoFrameCount?e=b.TEST_32_SAMPLES:Kb>this.ssaoFrameCount&&(e=b.FIXE_16_SAMPLES);this.scene.update();break;case b.TEST_32_SAMPLES:Zb=
24<=this.framerate?Zb+1:0;Kb=24>this.framerate?Kb+1:0;Kb>this.ssaoFrameCount?e=b.FIXE_16_SAMPLES:Zb>this.ssaoFrameCount&&(e=b.FIXE_32_SAMPLES);this.scene.update();break;case b.FIXE_16_SAMPLES:this.ssaoFrameCount=3;Zb=30<=this.framerate?Zb+1:0;5<Zb?e=b.TEST_32_SAMPLES:this.settings.ssaoAutoDisable&&0<this.settings.ssaoIntensity2?(Kb=12>this.framerate?Kb+1:0,Kb>this.ssaoFrameCount&&(e=b.LEVEL_2ND_OFF)):this.settings.ssaoAutoDisable&&(Kb=12>this.framerate?Kb+1:0,Kb>this.ssaoFrameCount&&(e=b.SSAO_OFF));
break;case b.FIXE_32_SAMPLES:Kb=15>this.framerate?Kb+1:0;5<Kb&&(e=b.FIXE_16_SAMPLES);break;case b.LEVEL_2ND_OFF:this.settings.ssaoAutoDisable&&(Kb=12>this.framerate?Kb+1:0,Zb=20<=this.framerate?Zb+1:0,Kb>this.ssaoFrameCount?e=b.SSAO_OFF:Zb>this.ssaoFrameCount&&(e=b.TEST_16_SAMPLES))}e!=this.ssaoPhase&&(this.debugSSAO&&(d=Object.keys(b),console.log("ssao switch",d[this.ssaoPhase],"->",d[e])),this.ssaoPhase=e,Zb=Kb=0);return!1},id=function(b,d,e,f){b=b||!this.disableFurSsao;var h=stage.emersya.viewer.modules.renderer.shaders.shaderTypes;
d&2&&(this.gl.enable(this.gl.STENCIL_TEST),this.gl.stencilOp(this.gl.KEEP,this.gl.KEEP,this.gl.REPLACE));for(var m=null;e<=f&&e<this.scene.polylistInstances.length;e++){var p=this.scene.polylistInstances[e];if(!(!p.occluder&&p.isHidden()||p.isGhost)){var g=p.matAnim.getCurrentMaterial(),n=p.polylist.ssaoReceive,v=p.polylist.ssaoCast;p.occluder?n=v=!1:0<=this.settings.ssaoEmissiveThreshold&&p.matAnim.hasEmissive()&&(n=v=(null==g.emissive[g.type?"texture":"intensityTexture"]?g.emissive.intensity:1)<=
this.settings.ssaoEmissiveThreshold);d&2&&(p.matAnim.isPatch()?this.gl.stencilFunc(this.gl.NOTEQUAL,1,255):this.gl.stencilFunc(this.gl.ALWAYS,n?1:0,255));var k=new stage.emersya.viewer.modules.renderer.shaders.shaderType;n=[h.PBR,h.PBR_OPACITY_MAP,h.OPACITY,h.ANIMATING,h.PBR_ANIM_OPACITY_MAP,h.ANIM_OPACITY];!p.occluder&&d&2&&this.settings.ssaoNormalDisplacement&&n.push(h.PBR_NORMAL_MAP,h.PBR_NORMAL_MAP2,h.PBR_BUMP_MAP,h.PBR_BUMP_MAP2,h.PBR_NORMAL_INTENSITY,h.NORMAL,h.NORMAL_SCALE);b&&Array.prototype.push.apply(n,
stage.emersya.viewer.modules.renderer.shaders.furTypes);n.forEach(function(b){if(p.matAnim.shaderType.has(b)){var d=!0;(b!=h.PBR_OPACITY_MAP||g.opacity.texture&&g.opacity.texture.isReady())&&(b!=h.PBR_ANIM_OPACITY_MAP||p.matAnim.nextMaterial.opacity.texture&&p.matAnim.nextMaterial.opacity.texture.isReady())||(d=!1);k.set(b,d)}});k.has(h.NORMAL)&&(k.set(h.NORMAL,!1),1==g.normalDeformation.type?k.set(h.PBR_NORMAL_MAP,!0):k.set(h.PBR_BUMP_MAP,!0),k.has(h.NORMAL_SCALE)&&(k.set(h.NORMAL_SCALE,!1),k.set(h.PBR_NORMAL_INTENSITY,
!0)));m&&m.value()===k.value()||(this.shaders.useScreenSpaceShader(d,k,this.renderingData),this.renderingData.clearTextures(),m=k,this.gl.uniformMatrix4fv(this.renderingData.locations.ghgsnpw,!1,this.renderingData.projectionMatrix),this.gl.uniformMatrix4fv(this.renderingData.locations.ampnorz,!1,this.renderingData.viewMatrix),this.gl.uniform2f(this.renderingData.locations.xcsurjq,this.near,this.far));this.renderingData.textureCount=0;n=1;var r=0;p.occluder||p.matAnim.isOpaque()||(n=g.opacity.intensity,
r=Math.max(g.opacity.threshold,this.settings.ssaoOpacityThreshold));this.gl.uniform1f(this.renderingData.locations.bzmstcf,n);this.gl.uniform1f(this.renderingData.locations.ymenuuk,r);(k.has(h.PBR_OPACITY_MAP)||k.has(h.OPACITY))&&g.opacity.texture&&g.opacity.texture.isReady()&&(this.gl.uniform1i(this.renderingData.locations.bxddaze,g.opacity.texture.loadToShader(this.renderingData,this.renderingData.locations.imjkghn,this.renderingData.locations.avbfhlu)),n=this.scene.materialsType?g.opacity.texture.channel:
g.opacity.channel,this.gl.uniform1i(this.renderingData.locations.uxqdzlm,n));k.has(h.ANIMATING)&&(this.gl.uniform1f(this.renderingData.locations.heftokz,p.matAnim.animations[p.matAnim.currentAnimation].computeAcceleration()),this.gl.uniform1f(this.renderingData.locations.bzmstcf2,p.matAnim.nextMaterial.opacity.intensity),this.gl.uniform1f(this.renderingData.locations.ymenuuk2,Math.max(p.matAnim.nextMaterial.opacity.threshold,this.settings.ssaoOpacityThreshold)),(k.has(h.PBR_ANIM_OPACITY_MAP)||k.has(h.ANIM_OPACITY))&&
p.matAnim.nextMaterial.opacity.texture&&p.matAnim.nextMaterial.opacity.texture.isReady()&&(this.gl.uniform1i(this.renderingData.locations.bxddaze2,p.matAnim.nextMaterial.opacity.texture.loadToShader(this.renderingData,this.renderingData.locations.imjkghn2,this.renderingData.locations.avbfhlu2)),this.gl.uniform1i(this.renderingData.locations.lilxxtl2,1),n=this.scene.materialsType?p.matAnim.nextMaterial.opacity.texture.channel:p.matAnim.nextMaterial.opacity.channel,this.gl.uniform1i(this.renderingData.locations.uxqdzlm2,
n)));if(k.has(h.PBR_NORMAL_MAP)||k.has(h.PBR_BUMP_MAP))this.gl.uniform1i(this.renderingData.locations.yeqgzpf,g.normalDeformation.texture.loadToShader(this.renderingData,this.renderingData.locations.rjgjnzi,this.renderingData.locations.ingoasu)),n=this.scene.materialsType?g.normalDeformation.intensity:g.normalDeformation.scale,this.scene.materialsType&&k.has(h.PBR_BUMP_MAP)&&(n=Math.pow(.8*g.normalDeformation.intensity,2)),this.gl.uniform1f(this.renderingData.locations.xqahzng,n),k.has(h.PBR_NORMAL_INTENSITY)&&
this.gl.uniform1i(this.renderingData.locations.vohmaky,g.normalDeformation.intensityTexture.loadToShader(this.renderingData,this.renderingData.locations.rasiqrh,this.renderingData.locations.wullosg));if(k.has(h.PBR_NORMAL_MAP2)||k.has(h.PBR_BUMP_MAP2))this.gl.uniform1i(this.renderingData.locations.rybvhvu,g.normalDeformation.texture2.loadToShader(this.renderingData,this.renderingData.locations.shdknig,this.renderingData.locations.wtmnctg)),k.has(h.PBR_NORMAL_MAP2)?this.gl.uniform1f(this.renderingData.locations.csdjrkx,
g.normalDeformation.intensity2):this.gl.uniform1f(this.renderingData.locations.csdjrkx,Math.pow(.8*g.normalDeformation.intensity2,2)),k.has(h.PBR_NORMAL_INTENSITY2)&&this.gl.uniform1i(this.renderingData.locations.wuylkyh,g.normalDeformation.intensityTexture2.loadToShader(this.renderingData,this.renderingData.locations.qawohzh,this.renderingData.locations.xhreiep));this.gl.uniform1i(this.renderingData.locations.lvohqkg,!v);this.settings.renderFur&&k.has(h.PBR_FUR)?b?(this.gl.uniform1f(this.renderingData.locations.cqcpvcg,
0),this.meshes.renderForFur(this.renderingData,p)):(this.gl.uniform1f(this.renderingData.locations.cqcpvcg,p.matAnim.computeDisplacementFactor()),this.gl.uniform1i(this.renderingData.locations.lvohqkg,!0),this.meshes.renderForShadowMaps(this.renderingData,p)):(this.gl.uniform1f(this.renderingData.locations.cqcpvcg,0),this.meshes.renderForShadowMaps(this.renderingData,p))}}},Rc=function(d,e){SsaoHDonStop=Yc.call(this);if(this.ssaoPhase!=b.SSAO_OFF||SsaoHDonStop){this.scene&&(this.sceneRadius=this.scene.root.boundingBox.radius);
var f=!this.ssaoFramebuffers[this.minScaling]||this.ssaoPhase!=b.DOWN_SIZE&&this.currentScaling===this.maxScaling?this.ssaoFramebuffers[this.maxScaling]:this.ssaoFramebuffers[this.minScaling];if(f){var h=f.width,m=f.height,p=this.gl.getParameter(this.gl.FRAMEBUFFER_BINDING),g=this.gl.getParameter(this.gl.VIEWPORT),n=this.gl.getParameter(this.gl.SCISSOR_BOX);this.forceSynchronousFramebuffers&&(this.gl.flush(),this.gl.finish());this.gl.disable(this.gl.BLEND);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,
f.ssaoFramebuffer);this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA);this.gl.viewport(0,0,h,m);this.gl.scissor(0,0,h,m);this.gl.clearColor(0,0,0,0);var v=0==d?this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT:0,k=1;this.gl.webgl2||(this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,f.depthTexture,0),this.gl.framebufferRenderbuffer(this.gl.FRAMEBUFFER,this.gl.DEPTH_STENCIL_ATTACHMENT,this.gl.RENDERBUFFER,f.depthBuffer),v&&this.gl.clear(v),id.call(this,
SsaoHDonStop,k,d,e),this.gl.framebufferRenderbuffer(this.gl.FRAMEBUFFER,this.gl.DEPTH_STENCIL_ATTACHMENT,this.gl.RENDERBUFFER,f.normalZBuffer));this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,f.normalsTexture,0);this.gl.webgl2?(k|=2,this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT1,this.gl.TEXTURE_2D,f.depthTexture,0),this.gl.drawBuffers([this.gl.COLOR_ATTACHMENT0,this.gl.COLOR_ATTACHMENT1]),this.gl.framebufferRenderbuffer(this.gl.FRAMEBUFFER,
this.gl.DEPTH_STENCIL_ATTACHMENT,this.gl.RENDERBUFFER,f.depthBuffer)):k=2;this.gl.clearStencil(0);this.gl.clear(v|this.gl.STENCIL_BUFFER_BIT);id.call(this,SsaoHDonStop,k,d,e);this.gl.webgl2&&(this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT1,this.gl.TEXTURE_2D,null,0),this.gl.drawBuffers([this.gl.COLOR_ATTACHMENT0]));this.gl.enable(this.gl.STENCIL_TEST);this.gl.stencilMask(255);this.gl.stencilFunc(this.gl.EQUAL,1,255);this.gl.stencilOp(this.gl.KEEP,this.gl.KEEP,this.gl.KEEP);
this.gl.colorMask(!0,!0,!0,!0);this.gl.depthMask(!0);this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,f.ssaoTexture,0);this.gl.viewport(0,0,h,m);this.gl.scissor(0,0,h,m);this.gl.clear(this.gl.COLOR_BUFFER_BIT);this.gl.disable(this.gl.DEPTH_TEST);this.shaders.useSSAOShader(this.renderingData,(this.ssaoPhase!=b.LEVEL_2ND_OFF||SsaoHDonStop)&&0<this.settings.ssaoIntensity2?2:1,(this.ssaoPhase==b.TEST_16_SAMPLES||this.ssaoPhase==b.FIXE_16_SAMPLES||this.ssaoPhase==
b.LEVEL_2ND_OFF)&&!SsaoHDonStop);this.gl.uniformMatrix4fv(this.renderingData.locations.ampnorz,!1,this.screenViewMatrix);this.gl.uniformMatrix4fv(this.renderingData.locations.ghgsnpw,!1,this.screenTransfMatrix);this.gl.uniformMatrix4fv(this.renderingData.locations.ondssmn,!1,this.renderingData.identityMatrix);this.gl.uniform2f(this.renderingData.locations.kfnexkv,f.width,f.height);this.gl.uniform2f(this.renderingData.locations.hqnnjep,h/f.width,m/f.height);this.gl.uniform2f(this.renderingData.locations.xcsurjq,
this.near,this.far);this.gl.uniformMatrix4fv(this.renderingData.locations.imijlgu,!1,this.renderingData.projectionMatrix);this.gl.uniformMatrix4fv(this.renderingData.locations.puxveqx,!1,mat4.inverse(this.renderingData.projectionMatrix,mat4.create()));this.gl.uniform1i(this.renderingData.locations.uUseNormals,1);this.gl.uniform2f(this.renderingData.locations.cdlitkg,this.settings.ssaoIntensity,this.settings.ssaoIntensity2);this.gl.uniform2f(this.renderingData.locations.memjfhp,.01*this.settings.ssaoThickness*
this.sceneRadius,.01*this.settings.ssaoThickness2*this.sceneRadius);this.gl.uniform2f(this.renderingData.locations.tdnaygd,.3*this.settings.ssaoRadius*this.sceneRadius,.3*this.settings.ssaoRadius2*this.sceneRadius);this.gl.uniform2fv(this.renderingData.locations.yjwzvyh,this.sSaoRamdomSeed);this.gl.uniform1i(this.renderingData.locations.dytchtg,0);this.gl.activeTexture(this.gl.TEXTURE0);this.gl.bindTexture(this.gl.TEXTURE_2D,f.depthTexture);this.gl.uniform1i(this.renderingData.locations.ohoehyx,1);
this.gl.activeTexture(this.gl.TEXTURE1);this.gl.bindTexture(this.gl.TEXTURE_2D,f.normalsTexture);this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexBufferScreen);this.gl.vertexAttribPointer(this.renderingData.locations.ymaxekn,3,this.gl.FLOAT,!1,0,0);this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.elementsBufferScreen);this.gl.drawElements(this.gl.TRIANGLES,6,this.gl.UNSIGNED_SHORT,0);this.gl.disable(this.gl.STENCIL_TEST);if(d=this.ssaoPhase==b.TEST_16_SAMPLES||this.ssaoPhase==b.FIXE_16_SAMPLES||
this.settings.filterSSAO)this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,f.ssaoFilterTexture,0),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.shaders.useSSAOFilteringShader(this.renderingData),this.gl.uniformMatrix4fv(this.renderingData.locations.ampnorz,!1,this.screenViewMatrix),this.gl.uniformMatrix4fv(this.renderingData.locations.ghgsnpw,!1,this.screenTransfMatrix),this.gl.uniformMatrix4fv(this.renderingData.locations.ondssmn,!1,this.renderingData.identityMatrix),
this.gl.uniform1i(this.renderingData.locations.cdcsuhh,1),this.gl.uniform1i(this.renderingData.locations.hfnhysb,0),this.gl.uniform1i(this.renderingData.locations.arccsyt,0),this.gl.uniform2f(this.renderingData.locations.kfnexkv,f.width,f.height),this.gl.uniform2f(this.renderingData.locations.xcsurjq,this.near,this.far),this.gl.uniform2fv(this.renderingData.locations.hlzyslc,this.sSaoVSampleOffsets),this.gl.uniform1fv(this.renderingData.locations.lvgrxdr,this.sSaoSampleWeights),this.gl.uniform1f(this.renderingData.locations.jnmvbwy,
.005*(0<this.settings.ssaoIntensity2?Math.min(this.settings.ssaoThickness,this.settings.ssaoThickness2):this.settings.ssaoThickness)*this.sceneRadius),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,f.ssaoTexture),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexBufferScreen),this.gl.vertexAttribPointer(this.renderingData.locations.ymaxekn,3,this.gl.FLOAT,!1,0,0),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.elementsBufferScreen),this.gl.drawElements(this.gl.TRIANGLES,
6,this.gl.UNSIGNED_SHORT,0);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,p);this.gl.viewport.apply(this.gl,g);this.gl.scissor.apply(this.gl,n);this.gl.enable(this.gl.BLEND);this.gl.enable(this.gl.SCISSOR_TEST);d?(this.gl.uniform1i(this.renderingData.locations.hfnhysb,1),this.gl.uniform2f(this.renderingData.locations.kfnexkv,this.renderingWidth,this.renderingHeight),this.gl.uniform2fv(this.renderingData.locations.hlzyslc,this.sSaoHSampleOffsets),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,
f.ssaoFilterTexture)):(this.shaders.useSSAOFilteringShader(this.renderingData),this.gl.uniformMatrix4fv(this.renderingData.locations.ampnorz,!1,this.screenViewMatrix),this.gl.uniformMatrix4fv(this.renderingData.locations.ghgsnpw,!1,this.screenTransfMatrix),this.gl.uniformMatrix4fv(this.renderingData.locations.ondssmn,!1,this.renderingData.identityMatrix),this.gl.uniform1i(this.renderingData.locations.cdcsuhh,0),this.gl.uniform1i(this.renderingData.locations.hfnhysb,1),this.gl.uniform1i(this.renderingData.locations.arccsyt,
0),this.gl.uniform2f(this.renderingData.locations.kfnexkv,this.renderingWidth,this.renderingHeight),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,f.ssaoTexture));this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexBufferScreen);this.gl.vertexAttribPointer(this.renderingData.locations.ymaxekn,3,this.gl.FLOAT,!1,0,0);this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.elementsBufferScreen);this.gl.colorMask(!0,!0,!0,!1);this.gl.drawElements(this.gl.TRIANGLES,6,this.gl.UNSIGNED_SHORT,
0);this.gl.colorMask(!0,!0,!0,!0);this.gl.enable(this.gl.DEPTH_TEST)}else console.warn("no framebuffer set for SSAO rendering!")}},yd=function(b){if(this.forceSFX||this.settings.renderWater&&this.scene&&this.scene.waters.length)this.waterTexture&&this.gl.deleteTexture(this.waterTexture),this.waterFramebuffer&&(this.gl.deleteFramebuffer(this.waterFramebuffer),this.gl.deleteRenderbuffer(this.waterRenderbuffer)),this.waterFramebuffer=this.gl.createFramebuffer(),this.waterRenderbuffer=this.gl.createRenderbuffer(),
this.waterTexture=this.gl.createTexture(),this.gl.bindTexture(this.gl.TEXTURE_2D,this.waterTexture),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,b,b,
0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,null),this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,this.waterRenderbuffer),this.gl.renderbufferStorage(this.gl.RENDERBUFFER,this.gl.DEPTH_COMPONENT16,b,b),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.waterFramebuffer),this.gl.framebufferRenderbuffer(this.gl.FRAMEBUFFER,this.gl.DEPTH_ATTACHMENT,this.gl.RENDERBUFFER,this.waterRenderbuffer),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,this.waterTexture,0),this.gl.bindTexture(this.gl.TEXTURE_2D,
null),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,null)},zd=function(){for(var b in this.scene.waters){var d=this.scene.waters[b];d.environmentCube&&this.gl.deleteTexture(d.environmentCube);yd.call(this,d.textureSize);var e=d,f=d.cubeCenter;d=d.textureSize;var h=this.gl.createTexture();this.gl.bindTexture(this.gl.TEXTURE_CUBE_MAP,h);var m=this.gl.viewportWidth,p=this.gl.viewportHeight;n.call(this,d,d);this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,
!1);this.gl.texImage2D(this.gl.TEXTURE_CUBE_MAP_POSITIVE_X,0,this.gl.RGBA,d,d,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,null);this.gl.texImage2D(this.gl.TEXTURE_CUBE_MAP_NEGATIVE_X,0,this.gl.RGBA,d,d,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,null);this.gl.texImage2D(this.gl.TEXTURE_CUBE_MAP_POSITIVE_Y,0,this.gl.RGBA,d,d,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,null);this.gl.texImage2D(this.gl.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,this.gl.RGBA,d,d,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,null);this.gl.texImage2D(this.gl.TEXTURE_CUBE_MAP_POSITIVE_Z,
0,this.gl.RGBA,d,d,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,null);this.gl.texImage2D(this.gl.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,this.gl.RGBA,d,d,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,null);this.gl.texParameteri(this.gl.TEXTURE_CUBE_MAP,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE);this.gl.texParameteri(this.gl.TEXTURE_CUBE_MAP,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE);this.gl.texParameteri(this.gl.TEXTURE_CUBE_MAP,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR);this.gl.texParameteri(this.gl.TEXTURE_CUBE_MAP,
this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR);var g=this.currentCamera,v={position:f,target:vec3.add(f,[1,0,0],vec3.create()),up:[0,-1,0],upReal:[0,1,0],fov:90,screenOffset:{x:0,y:0},dynamicClippingPlanes:!0};Wa.call(this,v);nb.call(this,!1,!1);this.renderingData.invViewMatrix=this.renderingData.identityMatrix;this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.waterFramebuffer);this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_CUBE_MAP_POSITIVE_X,h,0);this.gl.disable(this.gl.BLEND);
this.gl.viewport(0,0,d,d);this.gl.scissor(0,0,d,d);this.gl.enable(this.gl.SCISSOR_TEST);this.gl.clearColor(this.clearColor.r,this.clearColor.g,this.clearColor.b,this.clearColor.a);this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT|this.gl.STENCIL_BUFFER_BIT);qb.call(this,!1,!1,!0);v={position:f,target:vec3.add(f,[-1,0,0],vec3.create()),up:[0,-1,0],upReal:[0,1,0],fov:90,screenOffset:{x:0,y:0},dynamicClippingPlanes:!0};Wa.call(this,v);nb.call(this,!1,!1);this.renderingData.invViewMatrix=
this.renderingData.identityMatrix;this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.waterFramebuffer);this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_CUBE_MAP_NEGATIVE_X,h,0);this.gl.clearColor(this.clearColor.r,this.clearColor.g,this.clearColor.b,this.clearColor.a);this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT|this.gl.STENCIL_BUFFER_BIT);qb.call(this,!1,!1,!0);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null);v={position:f,target:vec3.add(f,
[0,0,1],vec3.create()),up:[0,-1,0],upReal:[0,1,0],fov:90,screenOffset:{x:0,y:0},dynamicClippingPlanes:!0};Wa.call(this,v);nb.call(this,!1,!1);this.renderingData.invViewMatrix=this.renderingData.identityMatrix;this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.waterFramebuffer);this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_CUBE_MAP_POSITIVE_Z,h,0);this.gl.clearColor(this.clearColor.r,this.clearColor.g,this.clearColor.b,this.clearColor.a);this.gl.clear(this.gl.COLOR_BUFFER_BIT|
this.gl.DEPTH_BUFFER_BIT|this.gl.STENCIL_BUFFER_BIT);qb.call(this,!1,!1,!0);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null);v={position:f,target:vec3.add(f,[0,0,-1],vec3.create()),up:[0,-1,0],upReal:[0,1,0],fov:90,screenOffset:{x:0,y:0},dynamicClippingPlanes:!0};Wa.call(this,v);nb.call(this,!1,!1);this.renderingData.invViewMatrix=this.renderingData.identityMatrix;this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.waterFramebuffer);this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,
this.gl.TEXTURE_CUBE_MAP_NEGATIVE_Z,h,0);this.gl.clearColor(this.clearColor.r,this.clearColor.g,this.clearColor.b,this.clearColor.a);this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT|this.gl.STENCIL_BUFFER_BIT);qb.call(this,!1,!1,!0);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null);v={position:f,target:vec3.add(f,[0,1,0],vec3.create()),up:[0,0,1],upReal:[0,0,1],fov:90,screenOffset:{x:0,y:0},dynamicClippingPlanes:!0};Wa.call(this,v);nb.call(this,!1,!1);this.renderingData.invViewMatrix=
this.renderingData.identityMatrix;this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.waterFramebuffer);this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_CUBE_MAP_POSITIVE_Y,h,0);this.gl.clearColor(this.clearColor.r,this.clearColor.g,this.clearColor.b,this.clearColor.a);this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT|this.gl.STENCIL_BUFFER_BIT);qb.call(this,!1,!1,!0);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null);v={position:f,target:vec3.add(f,
[0,-1,0],vec3.create()),up:[0,0,-1],upReal:[0,0,-1],fov:90,screenOffset:{x:0,y:0},dynamicClippingPlanes:!0};Wa.call(this,v);nb.call(this,!1,!1);this.renderingData.invViewMatrix=this.renderingData.identityMatrix;this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.waterFramebuffer);this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_CUBE_MAP_NEGATIVE_Y,h,0);this.gl.clearColor(this.clearColor.r,this.clearColor.g,this.clearColor.b,this.clearColor.a);this.gl.clear(this.gl.COLOR_BUFFER_BIT|
this.gl.DEPTH_BUFFER_BIT|this.gl.STENCIL_BUFFER_BIT);qb.call(this,!1,!1,!0);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null);g&&(Wa.call(this,g),nb.call(this,!1,!1));this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!0);n.call(this,m,p);e.environmentCube=h}},Eb=function(b,d,e){this.settings.filterShadowMaps&&b.scenery.shadowFilter&&void 0!==d&&this.lightsManager.filterShadowMaps(b,e,this.filters,d)},nb=function(b,d){this.scene.updatedLights=!1;var e=mat4.create(),f=vec3.create(this.renderingData.cameraPosition);
this.currentCamera.isFreeFly&&void 0!==this.currentCamera.isFreeFly||(vec3.subtract(this.renderingData.cameraPosition,this.renderingData.cameraTarget,f),vec3.normalize(f),vec3.add(this.renderingData.cameraTarget,f,f));mat4.lookAt(f,this.renderingData.cameraTarget,this.renderingData.cameraUp,e);f=mat4.inverse(e,mat4.create());this.renderingData.invViewMatrix=f;!this.stopDraw&&this.scene.loaded&&this.scene.loadedToGl&&this.scene.hasSomeShadow&&(b||this.scene.visibilityChanged||d||this.init)&&(this.shaders.useOpacityShadowShader(this.renderingData,
this.scene&&this.scene.materialsType),this.shadowsUpdated=this.lightsManager.updateShadows(this.scene,e,f,d,b||this.scene.visibilityChanged))},bd=function(b,d){if(b.materialsType&&this.gl.useEnvCubes){var e=this.scene;this.scene=b;for(var f=!1,h=this.currentCamera,m=0;m<b.environmentTextures.length;++m)b.environmentTextures[m].checkReadiness(),!b.environmentTextures[m].isReady()||b.environmentTextures[m].cube1&&!d||(f=!0,b.environmentTextures[m].cube1&&this.gl.deleteTexture(b.environmentTextures[m].cube1),
b.environmentTextures[m].cube1=sd.call(this,256,0,b.environmentTextures[m],b.scenery.environmentExposure));for(m=0;m<b.environmentTextures.length;++m)!b.environmentTextures[m].isReady()||b.environmentTextures[m].cube2&&!d||(f=!0,b.environmentTextures[m].cube2&&this.gl.deleteTexture(b.environmentTextures[m].cube2),b.environmentTextures[m].cube2=sd.call(this,128,.25,b.environmentTextures[m],b.scenery.environmentExposure));for(m=0;m<b.environmentTextures.length;++m)!b.environmentTextures[m].isReady()||
b.environmentTextures[m].cube3&&!d||(f=!0,b.environmentTextures[m].cube3&&this.gl.deleteTexture(b.environmentTextures[m].cube3),b.environmentTextures[m].cube3=sd.call(this,64,.5,b.environmentTextures[m],b.scenery.environmentExposure));for(m=0;m<b.environmentTextures.length;++m)!b.environmentTextures[m].isReady()||b.environmentTextures[m].cube4&&!d||(f=!0,b.environmentTextures[m].cube4&&this.gl.deleteTexture(b.environmentTextures[m].cube4),b.environmentTextures[m].cube4=sd.call(this,32,.75,b.environmentTextures[m],
b.scenery.environmentExposure));for(m=0;m<b.environmentTextures.length;++m)!b.environmentTextures[m].isReady()||b.environmentTextures[m].cube5&&!d||(f=!0,b.environmentTextures[m].cube5&&this.gl.deleteTexture(b.environmentTextures[m].cube5),b.environmentTextures[m].cube6&&this.gl.deleteTexture(b.environmentTextures[m].cube6),b.environmentTextures[m].cube5=sd.call(this,16,1,b.environmentTextures[m],b.scenery.environmentExposure),b.environmentTextures[m].cube6=sd.call(this,16,-1,b.environmentTextures[m],
b.scenery.environmentExposure));if(b.hasSomeCarpaint)for(m=0;m<b.environmentTextures.length;++m)if(b.environmentTextures[m].isReady()&&!b.environmentTextures[m].approximatedLights){d=b.environmentTextures[m];var p=b,g=b.environmentTextures[m],n=g.finalImage.currentWidth,v=g.finalImage.currentHeight/2,k=this.gl,r=k.createFramebuffer();k.bindFramebuffer(k.FRAMEBUFFER,r);k.framebufferTexture2D(k.FRAMEBUFFER,k.COLOR_ATTACHMENT0,k.TEXTURE_2D,g.finalImage.glTexture,0);if(k.floatTextures)g=new Float32Array(n*
v*4),k.readPixels(0,512,n,v,k.RGBA,k.FLOAT,g);else{g=new Uint8Array(n*v*4);k.readPixels(0,512,n,v,k.RGBA,k.UNSIGNED_BYTE,g);for(var l=new Float32Array(n*v*4),q=0;q<n*v;q+=4)l[q]=g[q]*Math.pow(2,255*g[q+3]-128),l[q+1]=g[q+1]*Math.pow(2,255*g[q+3]-128),l[q+2]=g[q+2]*Math.pow(2,255*g[q+3]-128),l[q+2]=1;delete g;g=l}k.bindFramebuffer(this.gl.FRAMEBUFFER,null);k.deleteFramebuffer(r);k=g;r=[];l=new Float32Array(n*v);for(q=0;q<v;++q)for(var B=0;B<n;++B){var t=q*n+B;l[t]=.2125*k[4*t]+.7154*k[4*t+1]+.0721*
k[4*t+2]+Zc(l,n,B-1,q)+Zc(l,n,B,q-1)-Zc(l,n,B-1,q-1)}q=Math.floor(Math.log2(4)+1);B=Kd;t=n-1;var w=v-1;t=Zc(l,n,n-1,v-1)+Zc(l,n,0,0)-Zc(l,n,t,0)-Zc(l,n,0,w);B(l,n,q,{x:0,y:0,width:n,height:v,sum:t},r);q=[];for(t=B=0;t<Math.min(4,r.length);++t){w=r[t];B+=w.sum;for(var A={x:w.x,y:w.y,width:w.width,height:w.height},O=1;O<=w.width&&!(A.width=O,A.sum=Ld(l,n,A),2*A.sum>=w.sum);++O);A.width=w.width;for(var V=1;V<=w.height&&!(A.height=V,A.sum=Ld(l,n,A),2*A.sum>=w.sum);++V);A=w.x+O-1;V=w.y+V-1;var E=Math.floor(A)+
.5;O=Math.floor(V)+.5;E/=n;O/=v;O=1-O;E*=2*Math.PI;var I=Math.PI*(O-.5),P=Math.cos(I);O=-Math.cos(E)*P;E=Math.sin(E)*P;I=Math.sin(I);P=Math.sqrt(E*E+I*I+O*O);E/=P;I/=P;O/=P;P=[0,0,0];for(var u=w.x;u<w.x+w.width;++u)for(var N=w.y;N<w.y+w.height;++N)P[0]+=k[4*(N*n+u)],P[1]+=k[4*(N*n+u)+1],P[2]+=k[4*(N*n+u)+2];w={x:A,y:v-V,regluminance:w.sum,ambientMode:!1,environmentRelative:!0,name:"Approximated directional "+t,position:new Float32Array([0,0,0]),originalDirection:new Float32Array([E,I,O]),direction:new Float32Array([E,
I,O]),relativeToCamera:!1,intensity:1,color:new Float32Array(P),shadow:{id:-1}};q.push(w)}B=1/B;for(n=0;n<q.length;++n)v=q[n],v.intensity=v.regluminance*B,k=Math.max(1,Math.max(v.color[0],Math.max(v.color[1],v.color[2]))),1<k&&(v.color[0]/=k,v.color[1]/=k,v.color[2]/=k);n=q;delete g;for(g=0;g<n.length;++g)v=2*-p.scenery.environmentRotation*Math.PI,k=n[g],k.direction[0]=-k.originalDirection[2]*Math.sin(v)+k.originalDirection[0]*Math.cos(v),k.direction[2]=k.originalDirection[2]*Math.cos(v)+k.originalDirection[0]*
Math.sin(v);d.approximatedLights=n}h&&Wa.call(this,h);this.scene=e;this.gl.floatTextures&&!this.envDFGLUTTexture&&b.dfglut&&(this.envDFGLUTTexture=this.gl.createTexture(),this.gl.bindTexture(this.gl.TEXTURE_2D,this.envDFGLUTTexture),this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGB32F,b.dfglut.size/2,b.dfglut.size/2,0,this.gl.RGB,this.gl.FLOAT,b.dfglut.halfFloats),this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!0),this.gl.texParameteri(this.gl.TEXTURE_2D,
this.gl.TEXTURE_MIN_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.bindTexture(this.gl.TEXTURE_2D,null));this.gl.floatTextures&&!this.envDFGLUTCTLambertTexture&&b.dfglutCookTorrance&&(this.envDFGLUTCTLambertTexture=this.gl.createTexture(),this.gl.bindTexture(this.gl.TEXTURE_2D,
this.envDFGLUTCTLambertTexture),this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGB32F,128,128,0,this.gl.RGB,this.gl.FLOAT,b.dfglutCookTorrance.halfFloats),this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!0),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),
this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.bindTexture(this.gl.TEXTURE_2D,null));if(f)for(m in b.polylistInstances)b.polylistInstances[m].matAnim.reloadMaterial();this.gl.flush();this.gl.finish()}},sd=function(b,d,e,f){b!==this.envTextureSize&&(this.envTexture&&(this.gl.deleteTexture(this.envTexture),this.gl.deleteFramebuffer(this.envFramebuffer),this.gl.deleteRenderbuffer(this.envRenderbuffer)),this.envFramebuffer=this.gl.createFramebuffer(),this.envRenderbuffer=
this.gl.createRenderbuffer(),this.envTexture=this.gl.createTexture(),this.gl.bindTexture(this.gl.TEXTURE_2D,this.envTexture),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.halfFloatTexturesForEnvCubes?
this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA16F,b,b,0,this.gl.RGBA,this.gl.HALF_FLOAT,null):this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,b,b,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,null),this.envTextureSize=b,this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,this.envRenderbuffer),this.gl.renderbufferStorage(this.gl.RENDERBUFFER,this.gl.DEPTH_COMPONENT16,b,b),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.envFramebuffer),this.gl.framebufferRenderbuffer(this.gl.FRAMEBUFFER,this.gl.DEPTH_ATTACHMENT,
this.gl.RENDERBUFFER,this.envRenderbuffer),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,this.envTexture,0),this.gl.bindTexture(this.gl.TEXTURE_2D,null),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,null));var h=[0,0,0],m=this.gl.viewportWidth,p=this.gl.viewportHeight;this.gl.viewportWidth=b;this.gl.viewportHeight=b;this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1);var g=this.gl.createTexture();this.gl.bindTexture(this.gl.TEXTURE_CUBE_MAP,
g);this.gl.halfFloatTexturesForEnvCubes?(this.gl.texImage2D(this.gl.TEXTURE_CUBE_MAP_POSITIVE_X,0,this.gl.RGBA16F,b,b,0,this.gl.RGBA,this.gl.HALF_FLOAT,null),this.gl.texImage2D(this.gl.TEXTURE_CUBE_MAP_NEGATIVE_X,0,this.gl.RGBA16F,b,b,0,this.gl.RGBA,this.gl.HALF_FLOAT,null),this.gl.texImage2D(this.gl.TEXTURE_CUBE_MAP_POSITIVE_Y,0,this.gl.RGBA16F,b,b,0,this.gl.RGBA,this.gl.HALF_FLOAT,null),this.gl.texImage2D(this.gl.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,this.gl.RGBA16F,b,b,0,this.gl.RGBA,this.gl.HALF_FLOAT,
null),this.gl.texImage2D(this.gl.TEXTURE_CUBE_MAP_POSITIVE_Z,0,this.gl.RGBA16F,b,b,0,this.gl.RGBA,this.gl.HALF_FLOAT,null),this.gl.texImage2D(this.gl.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,this.gl.RGBA16F,b,b,0,this.gl.RGBA,this.gl.HALF_FLOAT,null)):(this.gl.texImage2D(this.gl.TEXTURE_CUBE_MAP_POSITIVE_X,0,this.gl.RGBA,b,b,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,null),this.gl.texImage2D(this.gl.TEXTURE_CUBE_MAP_NEGATIVE_X,0,this.gl.RGBA,b,b,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,null),this.gl.texImage2D(this.gl.TEXTURE_CUBE_MAP_POSITIVE_Y,
0,this.gl.RGBA,b,b,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,null),this.gl.texImage2D(this.gl.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,this.gl.RGBA,b,b,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,null),this.gl.texImage2D(this.gl.TEXTURE_CUBE_MAP_POSITIVE_Z,0,this.gl.RGBA,b,b,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,null),this.gl.texImage2D(this.gl.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,this.gl.RGBA,b,b,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,null));this.gl.texParameteri(this.gl.TEXTURE_CUBE_MAP,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR_MIPMAP_LINEAR);
this.gl.texParameteri(this.gl.TEXTURE_CUBE_MAP,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR);var n={position:h,target:vec3.add(h,[1,0,0],vec3.create()),up:[0,-1,0],upReal:[0,1,0],fov:90,screenOffset:{x:0,y:0},dynamicClippingPlanes:!0};Wa.call(this,n);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.envFramebuffer);this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_CUBE_MAP_POSITIVE_X,g,0);this.gl.disable(this.gl.BLEND);this.gl.viewport(0,0,b,b);this.gl.scissor(0,
0,b,b);this.gl.enable(this.gl.SCISSOR_TEST);this.gl.clearColor(this.clearColor.r,this.clearColor.g,this.clearColor.b,this.clearColor.a);this.gl.clearColor(0,0,0,this.clearColor.a);this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT|this.gl.STENCIL_BUFFER_BIT);Mb.call(this,d,e,f);n={position:h,target:vec3.add(h,[-1,0,0],vec3.create()),up:[0,-1,0],upReal:[0,1,0],fov:90,screenOffset:{x:0,y:0},dynamicClippingPlanes:!0};Wa.call(this,n);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.envFramebuffer);
this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_CUBE_MAP_NEGATIVE_X,g,0);this.gl.clearColor(0,0,0,this.clearColor.a);this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT|this.gl.STENCIL_BUFFER_BIT);Mb.call(this,d,e,f);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null);n={position:h,target:vec3.add(h,[0,0,1],vec3.create()),up:[0,-1,0],upReal:[0,1,0],fov:90,screenOffset:{x:0,y:0},dynamicClippingPlanes:!0};Wa.call(this,n);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,
this.envFramebuffer);this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_CUBE_MAP_POSITIVE_Z,g,0);this.gl.clearColor(0,0,0,this.clearColor.a);this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT|this.gl.STENCIL_BUFFER_BIT);Mb.call(this,d,e,f);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null);n={position:h,target:vec3.add(h,[0,0,-1],vec3.create()),up:[0,-1,0],upReal:[0,1,0],fov:90,screenOffset:{x:0,y:0},dynamicClippingPlanes:!0};Wa.call(this,n);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,
this.envFramebuffer);this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_CUBE_MAP_NEGATIVE_Z,g,0);this.gl.clearColor(0,0,0,this.clearColor.a);this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT|this.gl.STENCIL_BUFFER_BIT);Mb.call(this,d,e,f);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null);n={position:h,target:vec3.add(h,[0,1,0],vec3.create()),up:[0,0,1],upReal:[0,0,1],fov:90,screenOffset:{x:0,y:0},dynamicClippingPlanes:!0};Wa.call(this,n);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,
this.envFramebuffer);this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_CUBE_MAP_POSITIVE_Y,g,0);this.gl.clearColor(0,0,0,this.clearColor.a);this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT|this.gl.STENCIL_BUFFER_BIT);Mb.call(this,d,e,f);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null);n={position:h,target:vec3.add(h,[0,-1,0],vec3.create()),up:[0,0,-1],upReal:[0,0,-1],fov:90,screenOffset:{x:0,y:0},dynamicClippingPlanes:!0};Wa.call(this,n);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,
this.envFramebuffer);this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_CUBE_MAP_NEGATIVE_Y,g,0);this.gl.clearColor(0,0,0,this.clearColor.a);this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT|this.gl.STENCIL_BUFFER_BIT);Mb.call(this,d,e,f);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null);this.gl.bindTexture(this.gl.TEXTURE_CUBE_MAP,g);this.gl.generateMipmap(this.gl.TEXTURE_CUBE_MAP);this.gl.bindTexture(this.gl.TEXTURE_CUBE_MAP,null);this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,
!0);this.gl.flush();this.gl.finish();this.gl.viewportWidth=m;this.gl.viewportHeight=p;return g},Dd=function(b){var d=function(b){for(var d=1;d<b;)d*=2;return d},e=this.canvasFramerate.getContext("2d");e.font="bold 24px OpenSans";this.canvasFramerate.width=d(e.measureText(b).width+5);this.canvasFramerate.height=d(29);e.clearRect(0,0,this.canvasFramerate.width,this.canvasFramerate.height);e.fillStyle="rgba(0,0,0,0)";e.fillRect(0,0,this.canvasFramerate.width,this.canvasFramerate.height);e.fillStyle=
"#00b1ab";e.lineWidth=2;e.font="bold 24px OpenSans";e.textAlign="left";e.textBaseline="top";e.strokeText(b,5,5);e.fillText(b,5,5);this.gl.bindTexture(this.gl.TEXTURE_2D,this.textTexture);this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,e.canvas);this.gl.bindTexture(this.gl.TEXTURE_2D,null);b=[-1,1,0,-1,1-2*this.canvasFramerate.height/this.gl.viewportHeight,0,-1+2*this.canvasFramerate.width/this.gl.viewportWidth,1-2*this.canvasFramerate.height/this.gl.viewportHeight,
0,-1+2*this.canvasFramerate.width/this.gl.viewportWidth,1,0];this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexBufferFramerate);this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(b),this.gl.STATIC_DRAW)},Xc=function(){this.settings.renderFramerate?(this.canvasFramerate=document.createElement("canvas"),this.textTexture=this.gl.createTexture(),this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!0),this.gl.bindTexture(this.gl.TEXTURE_2D,this.textTexture),this.gl.texParameteri(this.gl.TEXTURE_2D,
this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.bindTexture(this.gl.TEXTURE_2D,null),this.vertexBufferFramerate=this.gl.createBuffer(),Dd.call(this,"0"),this.framerateDomElem||(this.framerateDomElem=document.createElement("div"),this.framerateDomElem.setAttribute("style","position : absolute; top : 0; right : 0; z-index : 1; color : white; font-size : 20px; background-color : rgba(0,0,0,0.5);"),this.canvas.parentNode.appendChild(this.framerateDomElem))):
this.canvas&&this.framerateDomElem&&(this.canvas.parentNode.removeChild(this.framerateDomElem),delete this.framerateDomElem)},td=function(){this.shaders.useSilhouettesShader(this.renderingData);this.gl.disable(this.gl.DEPTH_TEST);this.gl.viewport(0,0,this.gl.viewportWidth,this.gl.viewportHeight);this.gl.scissor(0,0,this.gl.viewportWidth,this.gl.viewportHeight);this.gl.enable(this.gl.BLEND);this.gl.uniformMatrix4fv(this.renderingData.locations.ampnorz,!1,this.screenViewMatrix);this.gl.uniformMatrix4fv(this.renderingData.locations.ghgsnpw,
!1,this.screenTransfMatrix);this.gl.uniformMatrix4fv(this.renderingData.locations.ondssmn,!1,this.renderingData.identityMatrix);this.gl.uniform2f(this.renderingData.locations.ngzaxyh,this.depthAndNormalsWidth,this.depthAndNormalsHeight);this.gl.uniform1i(this.renderingData.locations.dkgckvl,0);this.gl.uniform1f(this.renderingData.locations.zbuvdav,this.settings.silhouettesThreshold);this.gl.uniform2f(this.renderingData.locations.qxxpdff,this.gl.viewportWidth,this.gl.viewportHeight);this.gl.uniform4f(this.renderingData.locations.srrtdcb,
this.settings.silhouettesColor[0],this.settings.silhouettesColor[1],this.settings.silhouettesColor[2],this.settings.silhouettesColor[3]);this.gl.activeTexture(this.gl.TEXTURE0);this.gl.bindTexture(this.gl.TEXTURE_2D,this.positionsTexture);this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexBufferScreen);this.gl.vertexAttribPointer(this.renderingData.locations.ymaxekn,3,this.gl.FLOAT,!1,0,0);this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.elementsBufferScreen);this.gl.drawElements(this.gl.TRIANGLES,
6,this.gl.UNSIGNED_SHORT,0);this.gl.enable(this.gl.DEPTH_TEST)},cd=function(){if(this.forceSFX||this.settings.renderMirrors&&this.scene&&this.scene.mirrors.length)this.shaders.createTextureFilterVert2Shader(),this.shaders.createTextureFilterHori2Shader(),this.shaders.createTextureFilterVert3Shader(),this.shaders.createTextureFilterHori3Shader(),this.shaders.createTextureFilterVert4Shader(),this.shaders.createTextureFilterHori4Shader(),this.shaders.createTextureFilterVert5Shader(),this.shaders.createTextureFilterHori5Shader(),
this.shaders.createTextureFilterVert6Shader(),this.shaders.createTextureFilterHori6Shader(),this.mirrorTexture&&this.gl.deleteTexture(this.mirrorTexture),this.mirrorTexture=this.gl.createTexture(),this.gl.bindTexture(this.gl.TEXTURE_2D,this.mirrorTexture),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),
this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.viewportWidth,this.gl.viewportHeight,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,null),this.mirrorFramebuffer&&(this.gl.deleteFramebuffer(this.mirrorFramebuffer),this.gl.deleteRenderbuffer(this.mirrorRenderbuffer)),this.mirrorFramebuffer=this.gl.createFramebuffer(),this.mirrorRenderbuffer=this.gl.createRenderbuffer(),this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,
this.mirrorRenderbuffer),this.gl.renderbufferStorage(this.gl.RENDERBUFFER,this.gl.DEPTH_STENCIL,this.gl.viewportWidth,this.gl.viewportHeight),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.mirrorFramebuffer),this.gl.framebufferRenderbuffer(this.gl.FRAMEBUFFER,this.gl.DEPTH_STENCIL_ATTACHMENT,this.gl.RENDERBUFFER,this.mirrorRenderbuffer),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,this.mirrorTexture,0),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,
null),this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,null),this.gl.bindTexture(this.gl.TEXTURE_2D,null),this.currentMirrorWidth=this.gl.viewportWidth,this.currentMirrorHeight=this.gl.viewportHeight},Vb=function(){if(this.forceSFX||this.settings.renderBlurredOpacity&&this.scene&&this.scene.hasSomeBlur)this.shaders.createTextureFilterVert1Shader(),this.shaders.createTextureFilterHori1Shader(),this.shaders.createTextureFilterVert2Shader(),this.shaders.createTextureFilterHori2Shader(),this.shaders.createTextureFilterVert3Shader(),
this.shaders.createTextureFilterHori3Shader(),this.shaders.createTextureFilterVert4Shader(),this.shaders.createTextureFilterHori4Shader(),this.shaders.createTextureFilterVert5Shader(),this.shaders.createTextureFilterHori5Shader(),this.shaders.createTextureFilterVert6Shader(),this.shaders.createTextureFilterHori6Shader(),this.blurWidth=Math.max(Math.round(this.gl.viewportWidth/this.settings.blurReduction),1),this.blurHeight=Math.max(Math.round(this.gl.viewportHeight/this.settings.blurReduction),1),
this.blurTexture&&this.gl.deleteTexture(this.blurTexture),this.blurFramebuffer&&(this.gl.deleteFramebuffer(this.blurFramebuffer),this.gl.deleteRenderbuffer(this.blurRenderbuffer)),this.blurFramebuffer=this.gl.createFramebuffer(),this.blurRenderbuffer=this.gl.createRenderbuffer(),this.blurTexture=this.gl.createTexture(),this.gl.bindTexture(this.gl.TEXTURE_2D,this.blurTexture),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.gl.TEXTURE_2D,
this.gl.TEXTURE_MIN_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.blurWidth,this.blurHeight,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,null),this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,this.blurRenderbuffer),this.gl.renderbufferStorage(this.gl.RENDERBUFFER,this.gl.DEPTH_COMPONENT16,this.blurWidth,
this.blurHeight),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.blurFramebuffer),this.gl.framebufferRenderbuffer(this.gl.FRAMEBUFFER,this.gl.DEPTH_ATTACHMENT,this.gl.RENDERBUFFER,this.blurRenderbuffer),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,this.blurTexture,0),this.gl.bindTexture(this.gl.TEXTURE_2D,null),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,null)},Wc=function(){if(this.ssrFramebuffers){for(var b in this.ssrFramebuffers){var d=
this.ssrFramebuffers[b];d.ssColors&&!0!==d.ssColors&&this.gl.deleteTexture(d.ssColors);d.ssDepths&&!0!==d.ssDepths&&this.gl.deleteTexture(d.ssDepths);d.ssRenderbuffer&&!0!==d.ssRenderbuffer&&this.gl.deleteTexture(d.ssRenderbuffer);d.ssFramebuffer&&!0!==d.ssFramebuffer&&this.gl.deleteFramebuffer(d.ssFramebuffer)}this.gl.deleteTexture(this.ssColors);delete this.ssColors;delete this.ssrFramebuffers}},fd=function(){if(!this.forceSFX&&0>=this.settings.screenSpaceRefractDistance)Wc.call(this);else{this.shaders.createScreenSpaceCopyShader();
this.scene&&this.shaders.createScreenSpaceDepthShader(this.scene.materialsType);if(this.ssrFramebuffers&&this.ssrFramebuffers[this.minScaling]&&this.ssrFramebuffers[this.maxScaling]){var b=this.ssrFramebuffers[this.minScaling].height,d=this.ssrFramebuffers[this.maxScaling].width,e=this.ssrFramebuffers[this.maxScaling].height;if(this.ssrFramebuffers[this.minScaling].width===this.realSize[0]*this.minScaling&&b===this.realSize[1]*this.minScaling&&d===this.realSize[0]*this.maxScaling&&e===this.realSize[1]*
this.maxScaling)return}Wc.call(this);this.ssrFramebuffers={};this.ssrFramebuffers[this.maxScaling]={width:Math.max(Math.round(this.realSize[0]*this.maxScaling),1),height:Math.max(Math.round(this.realSize[1]*this.maxScaling),1),ssColors:!0,ssDepths:!0,ssRenderbuffer:!0,ssFramebuffer:!0};this.maxScaling!=this.minScaling&&(this.ssrFramebuffers[this.minScaling]={width:Math.max(Math.round(this.realSize[0]*this.minScaling),1),height:Math.max(Math.round(this.realSize[1]*this.minScaling),1),ssColors:!0,ssDepths:!0,
ssRenderbuffer:!0,ssFramebuffer:!0});this.ssColors||(this.ssColors=this.gl.createTexture(),this.gl.bindTexture(this.gl.TEXTURE_2D,this.ssColors),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.NEAREST));for(var f in this.ssrFramebuffers)b=
this.ssrFramebuffers[f],b.ssColors=b.ssColors&&Fb.call(this,b.width,b.height,!1,!this.multisampling),b.ssDepths=b.ssDepths&&Fb.call(this,b.width,b.height,!0,!0),b.ssRenderbuffer=b.ssRenderbuffer&&Fb.call(this,b.width,b.height,!1,!0),b.ssFramebuffer=b.ssFramebuffer&&this.gl.createFramebuffer(),b.ssFramebuffer&&b.ssRenderbuffer&&b.ssDepths&&(this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,b.ssFramebuffer),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,b.ssRenderbuffer,
0),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.DEPTH_STENCIL_ATTACHMENT,this.gl.TEXTURE_2D,b.ssDepths,0));this.gl.bindTexture(this.gl.TEXTURE_2D,null);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null);this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,null);this.ssrFramebuffer=this.ssrFramebuffers[this.maxScaling]}},jb=function(b){switch(b){default:case 1:return 1;case 2:return.7874015748031497;case 3:return 1.2125984251968505;case 4:return.5748031496062992;case 5:return 1.4251968503937007}},
Ad=function(b,d,e){var f=vec3.create();if(0>=d)return f[0]=e,f[1]=e,f[2]=e,f;var h=b;360<=h&&(h=0);h/=60;b=Math.round(h);var m=h-b;h=e*(1-d);var p=e*(1-d*m);d=e*(1-d*(1-m));switch(b){case 0:f[0]=e;f[1]=d;f[2]=h;break;case 1:f[0]=p;f[1]=e;f[2]=h;break;case 2:f[0]=h;f[1]=e;f[2]=d;break;case 3:f[0]=h;f[1]=p;f[2]=e;break;case 4:f[0]=d;f[1]=h;f[2]=e;break;default:f[0]=e,f[1]=h,f[2]=p}return f},Na=function(){var b=0,d;for(d in this.scene.polylists)this.scene.polylists[d].colorId=b++;var e=1;80<b?e=5:20<
b&&(e=3);var f=[];for(d=0;d<e;++d){var h=Math.round(b/(e-d));b-=h;for(var m=360/h,p=jb(d+1),g=0;g<h;++g)f.push(Ad(g%2?g/2*m:(g+h)/2*m,1,p))}for(d in this.scene.polylists)this.scene.polylists[d].color=f[this.scene.polylists[d].colorId]},xd=function(){var b=0,d;for(d in this.scene.materials)this.scene.materials[d].colorId=b++;var e=1;80<b?e=5:20<b&&(e=3);var f=[];for(d=0;d<e;++d){var h=Math.round(b/(e-d));b-=h;for(var m=360/h,p=jb(d+1),g=0;g<h;++g)f.push(Ad(g%2?g/2*m:(g+h)/2*m,1,p))}for(d in this.scene.materials)this.scene.materials[d].color=
f[this.scene.materials[d].colorId]},ub=function(){this.gl.uniformMatrix4fv(this.renderingData.locations.ampnorz,!1,this.renderingData.viewMatrix)},wb=function(){this.gl.uniformMatrix4fv(this.renderingData.locations.ghgsnpw,!1,this.renderingData.projectionMatrix)},Bd=function(b,d){if(b.dynamicClippingPlanes){var e=this.scene.root.boundingBox;if(!this.sceneBoundingBoxVectors||this.scene.updatedBoundingBox)this.scene.updatedBoundingBox=!1,this.sceneBoundingBoxVectors[0]=[e.minX,e.minY,e.minZ],this.sceneBoundingBoxVectors[1]=
[e.minX,e.minY,e.maxZ],this.sceneBoundingBoxVectors[2]=[e.minX,e.maxY,e.minZ],this.sceneBoundingBoxVectors[3]=[e.minX,e.maxY,e.maxZ],this.sceneBoundingBoxVectors[4]=[e.maxX,e.minY,e.minZ],this.sceneBoundingBoxVectors[5]=[e.maxX,e.minY,e.maxZ],this.sceneBoundingBoxVectors[6]=[e.maxX,e.maxY,e.minZ],this.sceneBoundingBoxVectors[7]=[e.maxX,e.maxY,e.maxZ],this.sceneRadius=Math.max(Math.abs(e.maxX-e.minX),Math.max(Math.abs(e.maxY-e.minY),Math.abs(e.maxZ-e.minZ))),this.scene.radius=this.sceneRadius,this.sceneCenter=
e.center,this.sceneMinDiameter=Number.POSITIVE_INFINITY,this.scene.polylistInstances.forEach(function(b){var d=b.polylist.boundingBox;if(d){var e=b.node.modelMatrix;b=mat4.multiplyVec3(e,d.vecs[0],vec3.create());d=mat4.multiplyVec3(e,d.vecs[7],vec3.create());d=vec3.length(vec3.subtract(b,d));d<this.sceneMinDiameter&&(this.sceneMinDiameter=d)}},this),this.sceneMinDiameter=Math.min(this.sceneMinDiameter,2*this.sceneRadius);e=!1;var f=999999999999999,h=0,m=b.position;b=vec3.normalize(vec3.subtract(b.target,
b.position,vec3.create()));var p=b[0]*b[0]+b[1]*b[1]+b[2]*b[2],g;for(g in this.sceneBoundingBoxVectors){var n=this.sceneBoundingBoxVectors[g];n=(b[0]*(n[0]-m[0])+b[1]*(n[1]-m[1])+b[2]*(n[2]-m[2]))/p;0>n?(f=this.sceneMinDiameter,e=!0):(n=Math.abs(n),n>h&&(h=n),!e&&n<f&&(f=n))}d?(this.far=h,this.near=Math.round(1E3*f)/1E3):(this.far=Math.max(h,2*this.sceneRadius)*(this.currentEditor?10:2),this.near=e?this.far/this.depthAccuracy:Math.round(1E3*f)/2E3);this.near<=this.far/1E4&&(this.near=this.far/1E4);
this.renderingData.nearPlane=this.near;this.renderingData.farPlane=this.far}else this.near=b.planes.near,this.far=b.planes.far},Wa=function(b,d){var e=!k(b.position,this.renderingData.cameraPosition)||!k(b.target,this.renderingData.cameraTarget)||!k(b.upReal,this.renderingData.cameraUp)||b.fov!==this.renderingData.cameraFov||this.resized||this.scene.forceCameraUpdate;if(e||this.cameraModeChanged){this.firstStopMoving=!0;Bd.call(this,b,d);if(this.cameraMode){if(b.adaptativeFov&&this.gl.viewportWidth<
this.gl.viewportHeight){d=this.near*Math.tan(b.fov*Math.PI*.5/180);var f=-d,h=f*this.gl.viewportHeight/this.gl.viewportWidth,m=d*this.gl.viewportHeight/this.gl.viewportWidth}else m=this.near*Math.tan(b.fov*Math.PI*.5/180),h=-m,f=h*this.gl.viewportWidth/this.gl.viewportHeight,d=m*this.gl.viewportWidth/this.gl.viewportHeight;d+=f*b.screenOffset.x;this.renderingData.xmax=d;f*=1+b.screenOffset.x;m+=h*b.screenOffset.y;h*=1+b.screenOffset.y;mat4.frustum(f,d,h,m,this.near,this.far,this.renderingData.projectionMatrix)}else m=
Math.tan(b.fov*Math.PI*.5/180)*vec3.length(vec3.subtract(b.position,b.target,vec3.create())),b.adaptativeFov&&this.gl.viewportWidth<this.gl.viewportHeight?(f=-m,d=m,h=-m*this.gl.viewportHeight/this.gl.viewportWidth,m=m*this.gl.viewportHeight/this.gl.viewportWidth):(f=-m*this.gl.viewportWidth/this.gl.viewportHeight,d=m*this.gl.viewportWidth/this.gl.viewportHeight,h=-m),d+=f*b.screenOffset.x,f*=1+b.screenOffset.x,m+=h*b.screenOffset.y,h*=1+b.screenOffset.y,mat4.ortho(f,d,h,m,this.near,this.far,this.renderingData.projectionMatrix);
m=1*Math.tan(b.fov*Math.PI*.5/180);h=-m;f=h*this.gl.viewportWidth/this.gl.viewportHeight;d=m*this.gl.viewportWidth/this.gl.viewportHeight;d+=f*b.screenOffset.x;f*=1+b.screenOffset.x;m+=h*b.screenOffset.y;h*=1+b.screenOffset.y;this.cubeProjMatrix=mat4.frustum(f,d,h,m,1,200,mat4.create());this.cameraModeChanged=!1;this.renderingData.viewMatrix=mat4.lookAt(b.position,b.target,b.up);mat4.set(this.renderingData.projectionMatrix,this.renderingData.unjitteredProjectionMatrix)}this.scene.forceCameraUpdate=
!1;this.renderingData.cameraPosition=vec3.create(b.position);this.renderingData.cameraTarget=vec3.create(b.target);this.renderingData.cameraFov=b.fov;this.renderingData.cameraAdaptativeFov=b.adaptativeFov;this.renderingData.cameraUp=vec3.create(b.upReal);this.renderingData.screenOffset.x=b.screenOffset.x;this.renderingData.screenOffset.y=b.screenOffset.y;this.currentCamera=b;return e},zc=function(b,d){if(this.scene&&this.settings.renderFur&&this.scene.hasSomeFur){b=b||this.realSize[0];d=d||this.realSize[1];
b=Math.min(b,d);for(var e in this.scene.polylistInstances)if(d=this.scene.polylistInstances[e],d.matAnim.shaderType.has(stage.emersya.viewer.modules.renderer.shaders.shaderTypes.PBR_FUR)){var f=d.matAnim.getCurrentMaterial();f=(0<f.coating.furRealSize?f.coating.furRealSize:f.coating.furMaxLength*d.node.boundingBox.radius)/this.scene.arData.realSize*b;if(f<=this.settings.furLayers.min)d.glInstancedCount=this.settings.furLayers.min;else{f=Math.min(f,this.settings.furLayers.max);var h=vec3.length(vec3.subtract(d.node.boundingBox.center,
this.renderingData.cameraPosition,vec3.create()))/this.far;d.glInstancedCount=Math.max(Math.floor(this.renderingData.furQuality*((1-h)*f+h*this.settings.furLayers.min)),this.settings.furLayers.min)}}else d.glInstancedCount=1}},mc=function(b){var d=this.ssaaFramesCnt-1;if(b){if(0>=this.ssaaFramesCnt||this.ssaaFramesCnt>this.jitterVectors.length)d=0}else if(0>=this.ssaaFramesCnt||this.ssaaFramesCnt>this.jitterVectors.length)return;var e=this.currentCamera;this.currentJitteringVector=this.jitterVectors[d];
this.globalFramebuffer?(d=e.screenOffset.x+this.currentJitteringVector[0]/(8*this.globalFramebuffer.width),b=e.screenOffset.y+this.currentJitteringVector[1]/(8*this.globalFramebuffer.height)):(d=e.screenOffset.x,b=e.screenOffset.y);if(this.cameraMode){if(e.adaptativeFov&&this.gl.viewportWidth<this.gl.viewportHeight){e=this.near*Math.tan(e.fov*Math.PI*.5/180);var f=-e,h=f*this.gl.viewportHeight/this.gl.viewportWidth,m=e*this.gl.viewportHeight/this.gl.viewportWidth}else m=this.near*Math.tan(e.fov*Math.PI*
.5/180),h=-m,f=h*this.gl.viewportWidth/this.gl.viewportHeight,e=m*this.gl.viewportWidth/this.gl.viewportHeight;e+=f*d;this.renderingData.xmax=e;mat4.frustum(f*(1+d),e,h*(1+b),m+h*b,this.near,this.far,this.renderingData.projectionMatrix)}else m=Math.tan(e.fov*Math.PI*.5/180)*vec3.length(vec3.subtract(e.position,e.target,vec3.create())),e.adaptativeFov&&this.gl.viewportWidth<this.gl.viewportHeight?(f=-m,e=m,h=-m*this.gl.viewportHeight/this.gl.viewportWidth,m=m*this.gl.viewportHeight/this.gl.viewportWidth):
(f=-m*this.gl.viewportWidth/this.gl.viewportHeight,e=m*this.gl.viewportWidth/this.gl.viewportHeight,h=-m),mat4.ortho(f*(1+d),e+f*d,h*(1+b),m+h*b,this.near,this.far,this.renderingData.projectionMatrix)},jd=function(){this.ssaaFramesCnt=-1;this.ssaaEnabled=!1;this.ssaaOnStop=!!this.gl.halfFloatTextures;vb.call(this,this.movingJitterSampleCount);mc.call(this,!0)},Md=function(b,d){return b<d?-1:b>d?1:0},kd=function(){this.stableFramerateCounter=Math.min(++this.stableFramerateCounter,this.stableFramerateCounterMax)},
ud=[[0,0,0],[0,0,0]],Ed=function(){var b=this;if(!this.scene.physics)return!1;for(var d=!1,e=0;!d&&e<this.scene.physics.rigidBodies.length;++e)d=this.scene.physics.rigidBodies[e].type==CANNON.Body.DYNAMIC;if(!d)return!1;d=new Set;var f=new Set;this.scene.physics.world.step(Math.min(.1,this.deltaT/1E3));for(e=0;e<this.scene.physics.rigidBodies.length;++e){var h=this.scene.physics.rigidBodies[e];if(h.type===CANNON.Body.DYNAMIC){var m=h.quaternion.toAxisAngle();h.pnInstance.rotationAxis[0]=m[0].x;h.pnInstance.rotationAxis[1]=
m[0].y;h.pnInstance.rotationAxis[2]=m[0].z;h.pnInstance.rotationAngle=m[1];h.pnInstance.position[0]=h.position.x-h.emersyaOffset[0];h.pnInstance.position[1]=h.position.y-h.emersyaOffset[1]-h.pnInstance.floorOffset;h.pnInstance.position[2]=h.position.z-h.emersyaOffset[2];this.scene.updateProductNodeInstanceTransformation(h.pnInstance);m=[h.pnInstance];for(var p=0;p<m.length;++p)d.add(m[p]),m.push.apply(m,$jscomp.arrayFromIterable(m[p].children.filter(function(b){return 1!=b.type})));for(parent=h.pnInstance;parent&&
1<parent.parent.localId&&(parent=parent.parent););parent&&f.add(parent)}}h={};for(m=0;m<this.scene.physics.world.contacts.length;m++){p=this.scene.physics.world.contacts[m];for(var g=0;2>g;g++){var n=0===g?p.bi:p.bj,v=0===g?p.ri:p.rj;ud[g][0]=n.position.x+v.x;ud[g][1]=n.position.y+v.y;ud[g][2]=n.position.z+v.z}.01<vec3.length(vec3.subtract(ud[0],ud[1]))&&(p.bi.pnInstance&&p.bj.pnInstance?(h[p.bi.pnInstance.localId]||(h[p.bi.pnInstance.localId]={}),h[p.bi.pnInstance.localId][p.bj.pnInstance.localId]=
p,h[p.bj.pnInstance.localId]||(h[p.bj.pnInstance.localId]={}),h[p.bj.pnInstance.localId][p.bi.pnInstance.localId]=p):(p.bi.pnInstance&&(h[p.bi.pnInstance.localId]={}),p.bj.pnInstance&&(h[p.bj.pnInstance.localId]={})))}for(e in this.scene.nodesInUse)d.has(this.scene.productNodeInstancesByLocalId[this.scene.nodesInUse[e].localId])&&this.scene.updateMatrices(this.scene.nodesInUse[e]);f.forEach(function(d){b.scene.recursiveComputeBoundingBoxes(d);b.scene.recursiveComputeBoundingBoxesWithoutNodes(d)});
this.apiCore.exec(this.callerName,"collidingProductNodesInstancesTrackingUpdate",h);return!0},Qb=function(d,e){if(!(this.lastFrameDrawn||d||e||this.scene.needsUpdate)&&(!this.ssaaEnabled||this.ssaaFramesCnt>=this.jitterVectors.length))return this.ssaaEnabled=!1;if(this.anyMouseButtonPressed&&!(Date.now()-this.lastMouseMove>this.noMoveDuration)||d||e||this.scene.visibilityChanged){if(this.dynamicScaling){if(1<this.deltaT&&!this.ignoreNextScalingTime){e=!1;this.scalingFrameTimes[this.scalingFrameTimesIndex=
(this.scalingFrameTimesIndex+1)%this.maximumScalingFrames]=this.deltaT;if(3<this.scalingFrameTimes.length)var f=[].concat(this.scalingFrameTimes).sort(Md).splice(1,this.scalingFrameTimes.length-2);this.scalingFramesDuration+=this.deltaT;this.firstScaling&&this.scalingFramesDuration<this.firstScalingWaitingDuration||(this.firstScaling?3<this.scalingFrameTimes.length?(d=f.reduce(function(b,d){return b+d},0)/f.length,d>=this.minimumAverageTimeToUpdateFirstTry?e=!0:(this.scalingFrameTimes=[],this.scalingFramesDuration=
0,this.scalingFrameTimesIndex=-1)):e=!0:e=this.scalingFrameTimes.length>=this.maximumScalingFrames||this.scalingFramesDuration>=this.scalingWaitingDuration,this.firstScaling=!1);if(e){3<this.scalingFrameTimes.length?(d=f.reduce(function(b,d){return b+d},0)/f.length,f[f.length-1]>1.35*d&&(d=f[f.length-1])):d=this.scalingFrameTimes.reduce(function(b,d){return b+d},0)/this.scalingFrameTimes.length;e=!1;if(d>this.targetFrameTimeDown){f=0>--this.stableFramerateCounter||d>this.stableFramerateCounterDifferenceLimit*
this.targetFrameTimeDown;this.currentSelectedScaling!=this.maxScaling||this.annotationsDisabledWhileMoving||(f&&this.performanceOptimisationEnabled&&(this.annotationsDisabledWhileMoving=!0,d-=5*this.targetFrameTimeDown),e=!0);if(this.settings.screenSpaceRefractDistance&&this.scene.renderingSettings.screenSpaceRoughness){if(f){this.scene.renderingSettings.screenSpaceRoughness=!1;for(e=0;e<this.scene.polylistInstances.length;++e)h=this.scene.polylistInstances[e],m=h.matAnim.shaderType,m.has(stage.emersya.viewer.modules.renderer.shaders.shaderTypes.SCREENSPACE_ROUGHNESS)&&
m.set(stage.emersya.viewer.modules.renderer.shaders.shaderTypes.SCREENSPACE_ROUGHNESS,!1);d-=3*this.targetFrameTimeDown}e=!0}this.scene.hasSomeSpecularGlow&&this.settings.renderSpecularGlow&&(f&&(this.disableSpecularGlow=!0,this.settings.renderSpecularGlow=!1,d-=2*this.targetFrameTimeDown),e=!0);this.scene.hasSomeGlow&&this.settings.renderGlow&&(f&&(this.disableGlow=!0,this.settings.renderGlow=!1,d-=2*this.targetFrameTimeDown),e=!0);this.currentSelectedScaling==this.minScaling?this.settings.renderSSAO&&
this.ssaoPhase!=b.SSAO_OFF?(f&&(this.ssaoPhase=b.SSAO_OFF),e=!0):this.scene.hasSomeFur&&(1==this.renderingData.furQuality?(f&&(this.renderingData.furQuality=2/3,this.needsComputeFurlayers=!0),e=!0):.5<this.renderingData.furQuality?(f&&(this.renderingData.furQuality=.5,this.needsComputeFurlayers=!0),e=!0):.25<this.renderingData.furQuality&&(f&&(this.renderingData.furQuality=.25,this.needsComputeFurlayers=!0),e=!0)):(this.settings.renderSSAO&&this.ssaoPhase<b.DOWN_SIZE&&(this.ssaoPhase<b.FIXE_16_SAMPLES&&
(f&&(this.ssaoPhase=b.FIXE_16_SAMPLES),d-=this.targetFrameTimeDown),d>this.targetFrameTimeDown&&this.ssaoPhase==b.FIXE_16_SAMPLES&&(f&&(this.ssaoPhase=b.LEVEL_2ND_OFF),d-=this.targetFrameTimeDown),d>this.targetFrameTimeDown&&this.ssaoPhase==b.LEVEL_2ND_OFF&&(f&&(this.ssaoPhase=b.DOWN_SIZE),d-=this.targetFrameTimeDown),e=!0),d>this.targetFrameTimeDown&&(!this.settings.renderSSAO||this.ssaoPhase==b.DOWN_SIZE)&&this.scene.hasSomeFur&&!this.disableFurSsao&&(f&&(this.disableFurSsao=!0),d-=this.targetFrameTimeDown,
e=!0),d>this.targetFrameTimeDown&&(!this.settings.renderSSAO||this.ssaoPhase>=b.DOWN_SIZE)&&(!this.scene.hasSomeFur||this.disableFurSsao)&&(f&&(this.currentSelectedScaling=Math.max(this.currentSelectedScaling-this.adaptativeDownStep*Math.round(d/this.targetFrameTimeDown),this.minScaling)),e=!0));e?f&&(this.stableFramerateCounter=0):(kd.call(this),kd.call(this))}else if(d<this.targetFrameTimeUp){f=0>--this.stableFramerateCounter||d<this.targetFrameTimeUp/this.stableFramerateCounterDifferenceLimit;
if(this.currentSelectedScaling!==this.maxScaling)f&&(this.currentSelectedScaling=Math.min(this.currentSelectedScaling+this.adaptativeUpStep,this.maxScaling)),e=!0;else if(this.settings.renderSSAO&&this.currentSelectedScaling==this.maxScaling)f&&(this.ssaoPhase=b.FIXE_16_SAMPLES),e=!0;else if(this.scene.hasSomeFur&&1>this.renderingData.furQuality)f&&(this.renderingData.furQuality=1,this.needsComputeFurlayers=!0),e=!0;else if(this.disableGlow&&this.scene.hasSomeGlow&&!this.settings.renderGlow)f&&(this.disableGlow=
!1,this.settings.renderGlow=!0),e=!0;else if(this.disableSpecularGlow&&this.scene.hasSomeSpecularGlow&&!this.settings.renderSpecularGlow)f&&(this.disableSpecularGlow=!1,this.settings.renderSpecularGlow=!0),e=!0;else if(this.settings.screenSpaceRefractDistance&&!this.scene.renderingSettings.screenSpaceRoughness){if(f)for(this.scene.renderingSettings.screenSpaceRoughness=!1,e=0;e<this.scene.polylistInstances.length;++e)h=this.scene.polylistInstances[e],m=h.matAnim.shaderType,m.has(stage.emersya.viewer.modules.renderer.shaders.shaderTypes.SCREENSPACE_REFRACTION)&&
(h.matAnim.getCurrentMaterial().roughness&&h.matAnim.getCurrentMaterial().roughness.gloss&&.9>h.matAnim.getCurrentMaterial().roughness.intensity||h.matAnim.getCurrentMaterial().roughness&&!h.matAnim.getCurrentMaterial().roughness.gloss&&.1<h.matAnim.getCurrentMaterial().roughness.intensity?m.set(stage.emersya.viewer.modules.renderer.shaders.shaderTypes.SCREENSPACE_ROUGHNESS,!0):!m.has(stage.emersya.viewer.modules.renderer.shaders.shaderTypes.PBR)&&h.matAnim.getCurrentMaterial().shininess&&.95>h.matAnim.getCurrentMaterial().shininess.intensity/
100&&m.set(stage.emersya.viewer.modules.renderer.shaders.shaderTypes.SCREENSPACE_ROUGHNESS,!0));e=!0}e?f&&(this.stableFramerateCounter=0):(kd.call(this),kd.call(this))}else kd.call(this);e&&(this.scalingFrameTimes=[],this.scalingFramesDuration=0,this.scalingFrameTimesIndex=-1)}}else this.ignoreNextScalingTime=!1;zb.call(this,this.currentSelectedScaling)}else this.settings.hdOnStop&&0<this.deltaT&&zb.call(this,this.minScaling),this.stillCnt=0;this.stillCnt=0;jd.call(this);this.settings.renderSSAO&&
(this.ssaoHD=!1);this.scene.hasSomeFur&&this.backFurQuality&&this.renderingData.furQuality===this.settings.furQualityHD&&(this.renderingData.furQuality=this.backFurQuality,this.needsComputeFurlayers=!0)}else if((0<this.deltaT?++this.stillCnt:this.stillCnt)<=this.settings.nbFilterPasses&&this.scene.hasSomeShadow&&(Eb.call(this,this.scene,1,!0),this.scene.needsUpdate=Math.max(this.scene.needsUpdate,1),e=!0),this.currentScaling<this.maxScaling?this.smoothHdOnStop?zb.call(this,Math.min(this.currentScaling*
(this.renderingWidth+100)/this.renderingWidth,this.maxScaling)):zb.call(this,this.maxScaling):e||this.scene.needsUpdate?jd.call(this):(0==this.ssaaFramesCnt&&(this.ssaaOnStop=this.deltaT<=this.maximumSSAAComputeTime&&!!this.gl.halfFloatTextures),this.ssaaOnStop?(0<this.deltaT?++this.ssaaFramesCnt:this.ssaaFramesCnt)<this.jitterVectors.length&&0<=this.ssaaFramesCnt?this.ssaaEnabled=!0:this.ssaaFramesCnt==this.jitterVectors.length&&(this.ssaaEnabled=!0):(this.displayPreSsaaTexture&&0==this.ssaaFramesCnt&&
(this.ssaoHD||this.scene.hasSomeFur&&this.renderingData.furQuality===this.settings.furQualityHD)&&(this.gl.clearColor(0,0,0,0),this.gl.clear(this.gl.COLOR_BUFFER_BIT),f=0,this.renderingMode!=stage.emersya.viewer.RENDERING_MODES.CLASSIC||!this.settings.graininess||this.settings.grainOnStop&&d||(f=this.settings.graininess),Xa.call(this,this.globalFramebuffer.preSsaaTexture,1,!1,!1,void 0,f)),jd.call(this))),this.settings.renderSSAO&&(this.ssaoHD=this.currentScaling==this.maxScaling),this.currentScaling==
this.maxScaling&&(this.scene.hasSomeFur&&this.renderingData.furQuality<this.settings.furQualityHD&&(this.backFurQuality=this.renderingData.furQuality,this.renderingData.furQuality=this.settings.furQualityHD,this.needsComputeFurlayers=!0),this.disableGlow&&this.scene.hasSomeGlow&&!this.settings.renderGlow&&(this.disableGlow=!1,this.settings.renderGlow=!0),this.disableSpecularGlow&&this.scene.hasSomeSpecularGlow&&!this.settings.renderSpecularGlow&&(this.disableSpecularGlow=!1,this.settings.renderSpecularGlow=
!0),this.settings.screenSpaceRefractDistance&&!this.scene.renderingSettings.screenSpaceRoughness))for(this.scene.renderingSettings.screenSpaceRoughness=!0,e=0;e<this.scene.polylistInstances.length;++e){var h=this.scene.polylistInstances[e],m=h.matAnim.shaderType;m.has(stage.emersya.viewer.modules.renderer.shaders.shaderTypes.SCREENSPACE_REFRACTION)&&(h.matAnim.getCurrentMaterial().roughness&&h.matAnim.getCurrentMaterial().roughness.gloss&&.9>h.matAnim.getCurrentMaterial().roughness.intensity||h.matAnim.getCurrentMaterial().roughness&&
!h.matAnim.getCurrentMaterial().roughness.gloss&&.1<h.matAnim.getCurrentMaterial().roughness.intensity?m.set(stage.emersya.viewer.modules.renderer.shaders.shaderTypes.SCREENSPACE_ROUGHNESS,!0):!m.has(stage.emersya.viewer.modules.renderer.shaders.shaderTypes.PBR)&&h.matAnim.getCurrentMaterial().shininess&&.95>h.matAnim.getCurrentMaterial().shininess.intensity/100&&m.set(stage.emersya.viewer.modules.renderer.shaders.shaderTypes.SCREENSPACE_ROUGHNESS,!0))}this.ssaaEnabled&&0<this.ssaaFramesCnt&&(vb.call(this,
this.immobileMovingJitterSampleCount),mc.call(this));this.generatingSSAA=this.ssaaEnabled&&this.ssaaFramesCnt<=this.jitterVectors.length},Xd=function(b){this.performanceOptimisationEnabled=b},Nd=function(b,d,e,f,h,m,p){!e||!this.firstDraw&&this.lastDrawOpaque?e||!this.firstDraw&&!this.lastDrawOpaque||(this.gl.enable(this.gl.BLEND),this.gl.disable(this.gl.STENCIL_TEST),this.lastDrawOpaque=!1):(this.gl.enable(this.gl.STENCIL_TEST),this.gl.stencilMask(255),this.gl.stencilFunc(this.gl.ALWAYS,1,255),this.gl.stencilOp(this.gl.KEEP,
this.gl.KEEP,this.gl.REPLACE),this.gl.disable(this.gl.BLEND),this.lastDrawOpaque=!0);this.currentShaderType&&this.currentShaderType.value()===d.value()||(this.shaders.useTypedShader({shaderType:d},this.renderingData),this.renderingData.clearTextures(),this.currentShaderType=d,this.meshes.lastNodeDrawn=null,this.gl.uniform1f(this.renderingData.locations.laicxpp,this.scene.tonemapping.multiplier),this.gl.uniform1f(this.renderingData.locations.mjjhnsa,this.scene.tonemapping.maxLuminance),this.lightsManager.loadToShader(this.scene,
this.scene.hasSomeShadow),this.lightsEditor&&this.lightsEditor.loadToShader(this.scene),this.gl.uniform1i(this.renderingData.locations.atutpxf,0),this.gl.uniform1i(this.renderingData.locations.uBlackAndWhite,this.settings.renderBlackAndWhite),m?(this.gl.uniform1i(this.renderingData.locations.ummxwav,1),this.gl.uniform1f(this.renderingData.locations.htrgljy,this.renderingData.mirrorAttenuationMinDistance),this.gl.uniform1f(this.renderingData.locations.fxmwxnt,this.renderingData.mirrorAttenuationMaxDistance),
this.gl.uniform1f(this.renderingData.locations.pijwcjc,this.renderingData.mirrorAttenuationExponent),this.gl.uniform3f(this.renderingData.locations.yqifqgk,this.renderingData.mirrorPlanePosition[0],this.renderingData.mirrorPlanePosition[1],this.renderingData.mirrorPlanePosition[2]),this.gl.uniform3f(this.renderingData.locations.cqtmruh,this.renderingData.mirrorPlaneNormal[0],this.renderingData.mirrorPlaneNormal[1],this.renderingData.mirrorPlaneNormal[2]),this.gl.uniform3f(this.renderingData.locations.qdzcggg,
this.renderingData.mirroredCameraPosition[0],this.renderingData.mirroredCameraPosition[1],this.renderingData.mirroredCameraPosition[2])):this.gl.uniform1i(this.renderingData.locations.ummxwav,0),this.gl.uniform1i(this.renderingData.locations.fhogvoz,p?1:0),this.gl.uniform2f(this.renderingData.locations.qxxpdff,this.gl.viewportWidth,this.gl.viewportHeight),h?this.gl.uniform1i(this.renderingData.locations.mgntrba,1):this.gl.uniform1i(this.renderingData.locations.mgntrba,0),this.renderingData.locations.fvfyemf&&
(e=this.renderingData.textureCount++,this.gl.uniform1i(this.renderingData.locations.fvfyemf,e),this.gl.activeTexture(this.gl.TEXTURE0+e),this.currentShaderType.has(stage.emersya.viewer.modules.renderer.shaders.shaderTypes.PBR_CARPAINT)?this.gl.bindTexture(this.gl.TEXTURE_2D,this.envDFGLUTCTLambertTexture):this.gl.bindTexture(this.gl.TEXTURE_2D,this.envDFGLUTTexture)),ub.call(this),wb.call(this),this.gl.uniform3f(this.renderingData.locations.xzwunne,this.renderingData.cameraPosition[0],this.renderingData.cameraPosition[1],
this.renderingData.cameraPosition[2]),this.gl.uniform3f(this.renderingData.locations.fnmxbkg,this.renderingData.cameraTarget[0],this.renderingData.cameraTarget[1],this.renderingData.cameraTarget[2]),this.gl.uniformMatrix4fv(this.renderingData.locations.wqfoqbo,!1,this.renderingData.invViewMatrix),this.baseTextureCount=this.renderingData.textureCount);this.renderingData.textureCount=this.baseTextureCount;f&&this.settings.screenSpaceRefractDistance&&d.has(stage.emersya.viewer.modules.renderer.shaders.shaderTypes.SCREENSPACE_REFRACTION)&&
(this.gl.enable(this.gl.STENCIL_TEST),this.gl.stencilFunc(this.gl.ALWAYS,2,255),this.gl.stencilOp(this.gl.KEEP,this.gl.KEEP,this.gl.REPLACE),this.gl.disable(this.gl.BLEND),this.gl.uniform1f(this.renderingData.locations.dnbasxr,b.polylist.refractDistance?b.polylist.refractDistance:.03*this.settings.screenSpaceRefractDistance*this.sceneRadius),this.gl.uniform2f(this.renderingData.locations.xcsurjq,this.near,this.far),e=this.renderingData.textureCount++,this.gl.uniform1i(this.renderingData.locations.egtltvw,
e),this.gl.uniform2f(this.renderingData.locations.uwxywpw,this.ssrFramebuffer.width,this.ssrFramebuffer.height),this.gl.activeTexture(this.gl.TEXTURE0+e),this.gl.bindTexture(this.gl.TEXTURE_2D,this.ssrFramebuffer.ssColors),e=this.renderingData.textureCount++,this.gl.uniform1i(this.renderingData.locations.vtwyuay,e),this.gl.activeTexture(this.gl.TEXTURE0+e),this.gl.bindTexture(this.gl.TEXTURE_2D,this.ssrFramebuffer.ssDepths));this.meshes.render(this.renderingData,this.scene,b,d,this.settings.renderHighlightedGeometry);
f&&this.settings.screenSpaceRefractDistance&&d.has(stage.emersya.viewer.modules.renderer.shaders.shaderTypes.SCREENSPACE_REFRACTION)&&(this.gl.enable(this.gl.BLEND),this.gl.disable(this.gl.STENCIL_TEST),this.gl.stencilFunc(this.gl.ALWAYS,1,255),this.gl.stencilOp(this.gl.KEEP,this.gl.KEEP,this.gl.REPLACE));this.firstDraw=!1},qb=function(b,d,e,f){d?this.gl.clearColor(0,0,0,0):f?this.gl.clearColor(0,0,0,0):this.gl.clearColor(this.clearColor.r,this.clearColor.g,this.clearColor.b,this.clearColor.a);this.gl.stencilMask(255);
this.gl.clearStencil(0);this.backgroundTexture&&!d&&!f&&this.backgroundAlpha?(this.gl.clearColor(0,0,0,this.clearColor.a),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT|this.gl.STENCIL_BUFFER_BIT),Jb.call(this)):b||f?this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.STENCIL_BUFFER_BIT):this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT|this.gl.STENCIL_BUFFER_BIT);if(!f)a:if(this.scene.scenery.renderEnvironment&&this.scene.scenery.environmentTexture&&this.scene.scenery.environmentTexture.isReady()){this.shaders.useEnvironmentRenderingShader(this.renderingData);
this.gl.depthMask(!1);this.gl.disable(this.gl.DEPTH_TEST);this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.cubeVBuffer);this.gl.uniform1i(this.renderingData.locations.kebjccr,this.scene.scenery.environmentRelativeToCamera);this.gl.uniform1f(this.renderingData.locations.laicxpp,this.scene.tonemapping.multiplier);this.gl.uniform1f(this.renderingData.locations.mjjhnsa,this.scene.tonemapping.maxLuminance);this.gl.uniform1f(this.renderingData.locations.dzrcnqh,10);this.gl.uniform1f(this.renderingData.locations.josltar,
0);this.gl.uniform1f(this.renderingData.locations.jmnndrt,this.scene.scenery.environmentRotation);this.gl.uniform1f(this.renderingData.locations.ikywnlr,this.scene.scenery.environmentExposure);this.gl.vertexAttribPointer(this.renderingData.locations.ymaxekn,3,this.gl.FLOAT,!1,0,0);this.gl.uniformMatrix4fv(this.renderingData.locations.ampnorz,!1,mat4.toRotationMat(this.renderingData.viewMatrix));this.gl.uniformMatrix4fv(this.renderingData.locations.ghgsnpw,!1,this.cubeProjMatrix);this.renderingData.textureCount=
0;this.gl.activeTexture(this.gl.TEXTURE0);if(1>=this.scene.scenery.renderEnvironment)this.gl.uniform1i(this.renderingData.locations.gxvoadx,this.scene.scenery.environmentTexture.loadToShader(this.renderingData,null,null,null,this.gl.floatTextures||this.gl.webgl2||this.gl.shadertexturelod?{wrapS:"REPEAT",wrapT:"CLAMP_TO_EDGE",minFilter:"LINEAR_MIPMAP_LINEAR",magFilter:"LINEAR",useMipmap:!0,anisotropy:0}:{wrapS:"REPEAT",wrapT:"CLAMP_TO_EDGE",minFilter:"NEAREST",magFilter:"NEAREST",useMipmap:!1,anisotropy:0}));
else{if(!this.scene.scenery.blurredEnvironment)break a;this.gl.bindTexture(this.gl.TEXTURE_2D,this.scene.scenery.blurredEnvironment);this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.REPEAT);this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE);this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.floatTextures?this.gl.LINEAR:this.gl.NEAREST);this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.floatTextures?
this.gl.LINEAR:this.gl.NEAREST);this.gl.uniform1i(this.renderingData.locations.gxvoadx,0)}switch(this.scene.scenery.renderEnvironment){case 1:case 2:case 3:this.gl.uniform1f(this.renderingData.locations.oevhrqy,this.scene.scenery.environmentTexture.finalImage.currentWidth);break;case 4:case 5:this.gl.uniform1f(this.renderingData.locations.oevhrqy,1024);break;case 6:case 7:this.gl.uniform1f(this.renderingData.locations.oevhrqy,512);break;case 8:case 9:this.gl.uniform1f(this.renderingData.locations.oevhrqy,
256)}this.gl.uniform2f(this.renderingData.locations.qxxpdff,this.gl.viewportWidth,this.gl.viewportHeight);this.gl.disable(this.gl.CULL_FACE);this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.cubeIBuffer);this.gl.drawElements(this.gl.TRIANGLES,36,this.gl.UNSIGNED_SHORT,0);this.gl.depthMask(!0);this.gl.enable(this.gl.DEPTH_TEST)}this.gl.enable(this.gl.POLYGON_OFFSET_FILL);var h=!1,m=0;this.baseTextureCount=0;this.currentShaderType=null;this.lastDrawOpaque=!1;this.firstDraw=!0;this.meshes.lastNodeDrawn=
null;this.ssaoSplitPolylistIndex=0;var p=vec3.length(this.scene.root.matrix.slice(4,7)),g=this.scene.computeRealMeasurementSceneFactor(this.scene.arData),n=this.scene.rootUpScale!=p||this.scene.sceneFactor!=g;n&&(this.scene.rootUpScale=p,this.scene.measurementFactor=g);if(this.scene.occluders.length){this.renderingData.currentPolygonOffsetFactor=1;this.renderingData.currentPolygonOffsetUnits=1;this.gl.disable(this.gl.STENCIL_TEST);this.shaders.useShadowShader(this.renderingData);ub.call(this);wb.call(this);
this.gl.colorMask(!1,!1,!1,!1);for(p=0;p<this.scene.occluders.length;++p)this.meshes.renderForShadowMaps(this.renderingData,this.scene.occluders[p]);this.gl.colorMask(!0,!0,!0,!0);this.renderingData.currentPolygonOffsetFactor=0;this.renderingData.currentPolygonOffsetUnits=0}for(p=0;p<this.scene.polylistInstances.length;++p)if(g=this.scene.polylistInstances[p],n&&g.matAnim.updateMaterialSettingsWhenRealMeasurementChange(),!(g.isHidden()||this.settings.renderWater&&g.polylist.isWater||this.renderGhosts&&
g.isGhost)){var v=g.matAnim.shaderType;if(this.settings.screenSpaceRefractDistance&&v.has(stage.emersya.viewer.modules.renderer.shaders.shaderTypes.SCREENSPACE_REFRACTION)&&!h&&!d&&!e&&!f){this.settings.renderSSAO&&(Rc.call(this,m,p-1),this.ssaoSplitPolylistIndex=p);var k=m;h=p;m=this.gl.getParameter(this.gl.FRAMEBUFFER_BINDING);var r=this.gl.getParameter(this.gl.VIEWPORT),l=this.gl.getParameter(this.gl.SCISSOR_BOX),q=this.gl.isEnabled(this.gl.STENCIL_TEST),B=this.gl.isEnabled(this.gl.DEPTH_TEST);
if(this.adaptativeResolution){var w=this.ssrFramebuffers[this.maxScaling];var t=this.renderingWidth;var A=this.renderingHeight}else w=this.currentScaling===this.maxScaling?this.ssrFramebuffers[this.maxScaling]:this.ssrFramebuffers[this.minScaling],t=w.width,A=w.height;this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,w.ssFramebuffer);this.gl.viewport(0,0,t,A);this.gl.scissor(0,0,t,A);this.gl.disable(this.gl.STENCIL_TEST);this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,
w.ssColors,0);this.gl.clearColor(0,0,0,0);this.gl.clear(this.gl.COLOR_BUFFER_BIT);m.attachments[this.gl.COLOR_ATTACHMENT0]instanceof WebGLTexture?(this.shaders.useScreenSpaceCopyShader(this.renderingData),this.gl.disable(this.gl.DEPTH_TEST),this.gl.depthMask(!1),this.gl.uniformMatrix4fv(this.renderingData.locations.ampnorz,!1,this.screenViewMatrix),this.gl.uniformMatrix4fv(this.renderingData.locations.ghgsnpw,!1,this.screenTransfMatrix),this.gl.uniform2f(this.renderingData.locations.kfnexkv,w.width,
w.height),this.gl.uniform1i(this.renderingData.locations.dkgckvl,0),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,m.attachments[this.gl.COLOR_ATTACHMENT0]),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexBufferScreen),this.gl.vertexAttribPointer(this.renderingData.locations.ymaxekn,3,this.gl.FLOAT,!1,0,0),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.elementsBufferScreen),this.gl.drawElements(this.gl.TRIANGLES,6,this.gl.UNSIGNED_SHORT,0),this.gl.depthMask(!0),
this.gl.bindTexture(this.gl.TEXTURE_2D,null)):m.attachments[this.gl.COLOR_ATTACHMENT0]instanceof WebGLRenderbuffer&&(this.gl.webgl2?(this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this.gl.bindFramebuffer(this.gl.READ_FRAMEBUFFER,m),this.gl.bindFramebuffer(this.gl.DRAW_FRAMEBUFFER,w.ssFramebuffer),this.gl.blitFramebuffer(0,0,t,A,0,0,t,A,this.gl.COLOR_BUFFER_BIT,this.gl.LINEAR),this.gl.bindFramebuffer(this.gl.READ_FRAMEBUFFER,null),this.gl.bindFramebuffer(this.gl.DRAW_FRAMEBUFFER,null)):(this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,
m),this.gl.bindTexture(this.gl.TEXTURE_2D,w.ssColors),this.gl.copyTexImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,0,0,t,A,0),this.gl.bindTexture(this.gl.TEXTURE_2D,null)),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,w.ssFramebuffer));this.gl.enable(this.gl.DEPTH_TEST);this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,w.ssRenderbuffer,0);k||(this.gl.clearColor(0,0,0,0),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT));this.shaders.useScreenSpaceDepthShader(this.renderingData,
this.scene.materialsType);this.gl.colorMask(!1,!1,!1,!1);this.gl.webgl2&&(this.gl.drawBuffers([this.gl.NONE]),this.gl.readBuffer(this.gl.NONE));ub.call(this);wb.call(this);for(A=k;A<h&&A<this.scene.polylistInstances.length;A++)t=this.scene.polylistInstances[A],t.isHidden()||this.settings.renderWater&&t.polylist.isWater||(currentMaterial=t.matAnim.getCurrentMaterial(),this.renderingData.textureCount=0,t.matAnim.loadDiscardTransparent(this.gl,this.renderingData,!t.matAnim.isOpaque()),this.meshes.renderFlat(this.renderingData,
t));this.gl.colorMask(!0,!0,!0,!0);this.gl.webgl2&&(this.gl.drawBuffers([this.gl.COLOR_ATTACHMENT0]),this.gl.readBuffer(this.gl.COLOR_ATTACHMENT0));this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,m);this.gl.viewport.apply(this.gl,r);this.gl.scissor.apply(this.gl,l);q&&this.gl.enable(this.gl.STENCIL_TEST);B||this.gl.disable(this.gl.DEPTH_TEST);m=p;h=!0;this.currentShaderType=null}r=g.matAnim.isOpaque();l=v.clone();if(!r)if(this.settings.renderBlurredOpacity){if(v.has(stage.emersya.viewer.modules.renderer.shaders.shaderTypes.OPACITYBLUR))continue}else v.has(stage.emersya.viewer.modules.renderer.shaders.shaderTypes.OPACITYBLUR)&&
l.set(stage.emersya.viewer.modules.renderer.shaders.shaderTypes.OPACITYBLUR,!1);if(!f||v.has(stage.emersya.viewer.modules.renderer.shaders.shaderTypes.SPECULARGLOW))f||l.set(stage.emersya.viewer.modules.renderer.shaders.shaderTypes.SPECULARGLOW,!1),Nd.call(this,g,l,r,h,b,d)}if(this.renderGhosts){this.shaders.useTypedShader(this.scene.baseTypedShader,this.renderingData);ub.call(this);wb.call(this);this.gl.colorMask(!1,!1,!1,!1);this.gl.disable(this.gl.BLEND);for(p=0;p<this.scene.polylistInstances.length;++p)g=
this.scene.polylistInstances[p],!g.isHidden()&&g.isGhost&&Nd.call(this,g,this.scene.baseTypedShader.shaderType,g.matAnim.isOpaque(),h,b,d);this.gl.colorMask(!0,!0,!0,!0);this.gl.depthFunc(this.gl.LEQUAL);this.currentShaderType=null;this.lastDrawOpaque=!0;this.renderingData.currentPolygonOffsetFactor=0;for(p=this.renderingData.currentPolygonOffsetUnits=0;p<this.scene.polylistInstances.length;++p)g=this.scene.polylistInstances[p],!g.isHidden()&&g.isGhost&&(v=g.matAnim.shaderType,l=v.clone(),l.set(stage.emersya.viewer.modules.renderer.shaders.shaderTypes.OPACITYBLUR,
!1),l.set(stage.emersya.viewer.modules.renderer.shaders.shaderTypes.SPECULARGLOW,!1),l.set(stage.emersya.viewer.modules.renderer.shaders.shaderTypes.SCREENSPACE_REFRACTION,!1),Nd.call(this,g,l,g.matAnim.isOpaque(),h,b,d));this.gl.depthFunc(this.gl.LESS)}if(this.scene.occluders.length){this.gl.enable(this.gl.STENCIL_TEST);this.gl.stencilFunc(this.gl.ALWAYS,0,255);this.shaders.useShadowShader(this.renderingData);ub.call(this);wb.call(this);this.gl.colorMask(!1,!1,!1,!1);for(p=0;p<this.scene.occluders.length;++p)this.meshes.renderForShadowMaps(this.renderingData,
this.scene.occluders[p]);this.gl.colorMask(!0,!0,!0,!0)}this.gl.stencilOp(this.gl.KEEP,this.gl.KEEP,this.gl.KEEP);this.gl.disable(this.gl.STENCIL_TEST);this.gl.disable(this.gl.BLEND);this.gl.disable(this.gl.POLYGON_OFFSET_FILL)},$b=function(b){this.shaders.useOneColorShader(this.renderingData,!0);this.gl.lineWidth(1);this.gl.depthFunc(this.gl.LEQUAL);this.gl.enable(this.gl.BLEND);for(var d=0;d<this.scene.boundingBoxesToRender.length;++d)this.meshes.renderBoundingBox(this.renderingData,this.scene.boundingBoxesToRender[d]);
this.gl.depthFunc(this.gl.LESS);if(this.settings.renderRulers){var e=this.scene.root.boundingBoxWithoutNodes;if(!this.screenshotting&&e){var f=offsetFrontRight=offsetLeftBack=offsetBackBack=rc.call(this);this.scene.visibilityChanged&&(d=[0,0,-f/4,0,0,f/4,0,0,0,1,0,0,1,0,-f/4,1,0,f/4],this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexBufferRuler),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(d),this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null));d=vec3.create();var h=this.scene.root.boundingBoxWithoutNodes.vecs[0],
m=this.scene.root.boundingBoxWithoutNodes.vecs[4],p=this.scene.root.boundingBoxWithoutNodes.vecs[1],g=[0,0,-f],n=[-offsetFrontRight,0,0],v=[offsetBackBack,0,-offsetLeftBack],k=Math.PI,r=vec3.length(vec3.subtract(e.vecs[0],this.currentCamera.position,d)),l=vec3.length(vec3.subtract(e.vecs[1],this.currentCamera.position,d));l<r&&(r=l,h=e.vecs[1],m=e.vecs[0],p=e.vecs[5],g=[-f,0,0],n=[0,0,offsetFrontRight],v=[-offsetLeftBack,0,-offsetBackBack],k=-Math.PI/2);l=vec3.length(vec3.subtract(e.vecs[4],this.currentCamera.position,
d));l<r&&(r=l,h=e.vecs[4],m=e.vecs[5],p=e.vecs[0],g=[f,0,0],n=[0,0,-offsetFrontRight],v=[offsetLeftBack,0,offsetBackBack],k=-3*Math.PI/2);l=vec3.length(vec3.subtract(e.vecs[5],this.currentCamera.position,d));l<r&&(h=e.vecs[5],m=e.vecs[1],p=e.vecs[4],g=[0,0,f],n=[offsetFrontRight,0,0],v=[-offsetBackBack,0,offsetLeftBack],k=0);e=[[vec3.add(h,g,vec3.create()),vec3.add(m,g,vec3.create())],[vec3.add(h,n,vec3.create()),vec3.add(p,n,vec3.create())],[vec3.add(m,v,vec3.create()),vec3.add(vec3.add(m,v,vec3.create()),
[0,e.maxY-e.minY,0])]];this.shaders.useOneColorShader(this.renderingData,!0);this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexBufferRuler);this.gl.vertexAttribPointer(this.renderingData.locations.ymaxekn,3,this.gl.FLOAT,!1,0,0);ub.call(this);wb.call(this);this.gl.uniform1i(this.renderingData.locations.rfausvd,1);this.gl.uniform4f(this.renderingData.locations.srrtdcb,0,0,0,1);this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.elementsBufferRuler);f=mat4.create(this.renderingData.identityMatrix);
this.gl.disable(this.gl.DEPTH_TEST);h=vec3.length(vec3.subtract(e[0][0],e[0][1],d));mat4.translate(f,e[0][1]);mat4.rotate(f,k,[0,1,0]);mat4.scale(f,[h,1,1]);this.gl.uniformMatrix4fv(this.renderingData.locations.ondssmn,!1,f);this.gl.drawElements(this.gl.LINES,6,this.gl.UNSIGNED_SHORT,0);h=vec3.length(vec3.subtract(e[1][0],e[1][1],d));mat4.identity(f);mat4.translate(f,e[1][1]);mat4.rotate(f,k-Math.PI/2,[0,1,0]);mat4.scale(f,[h,1,1]);this.gl.uniformMatrix4fv(this.renderingData.locations.ondssmn,!1,
f);this.gl.drawElements(this.gl.LINES,6,this.gl.UNSIGNED_SHORT,0);h=vec3.length(vec3.subtract(e[2][0],e[2][1],d));mat4.identity(f);mat4.translate(f,e[2][1]);mat4.rotate(f,k,[0,1,0]);mat4.rotate(f,3*Math.PI/2,[0,0,1]);mat4.scale(f,[h,1,1]);this.gl.uniformMatrix4fv(this.renderingData.locations.ondssmn,!1,f);this.gl.drawElements(this.gl.LINES,6,this.gl.UNSIGNED_SHORT,0);this.gl.enable(this.gl.DEPTH_TEST)}}if(this.settings.renderBlurredOpacity&&this.scene.hasSomeBlur){this.useGlobalFramebuffer&&Ac.call(this);
this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.blurFramebuffer);this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,this.blurTexture,0);this.gl.disable(this.gl.BLEND);this.gl.viewport(0,0,this.blurWidth,this.blurHeight);this.gl.scissor(0,0,this.blurWidth,this.blurHeight);this.gl.enable(this.gl.SCISSOR_TEST);this.useGlobalFramebuffer?(this.gl.clearColor(0,0,0,0),this.gl.clear(this.gl.COLOR_BUFFER_BIT),Xa.call(this,this.globalFramebuffer.globalTexture,1,!1)):
(this.gl.clearColor(this.clearColor.r,this.clearColor.g,this.clearColor.b,this.clearColor.a),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),qb.call(this));this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null);this.renderingData.blurredTextures={};for(var q in this.scene.opacityBlurs)d=this.scene.opacityBlurs[q],this.renderingData.blurredTextures[d]=this.filters.applyBlur(this.blurTexture,this.blurWidth,this.blurHeight,d,this.gl.floatTextures&&this.gl.floatTextureslinear,!0);b&&this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,
b);this.gl.viewport(0,0,this.gl.viewportWidth,this.gl.viewportHeight);this.gl.scissor(0,0,this.gl.viewportWidth,this.gl.viewportHeight);this.gl.enable(this.gl.POLYGON_OFFSET_FILL);this.gl.disable(this.gl.BLEND);d=0;k=null;this.meshes.lastNodeDrawn=null;for(q=0;q<this.scene.polylistInstances.length;++q)e=this.scene.polylistInstances[q],e.isHidden()||(f=e.matAnim.shaderType,f.has(stage.emersya.viewer.modules.renderer.shaders.shaderTypes.OPACITYBLUR)&&(k&&k.value()===f.value()||(this.shaders.useTypedShader({shaderType:f},
this.renderingData),k=f,this.meshes.lastNodeDrawn=null,this.gl.uniform1f(this.renderingData.locations.laicxpp,this.scene.tonemapping.multiplier),this.gl.uniform1f(this.renderingData.locations.mjjhnsa,this.scene.tonemapping.maxLuminance),this.lightsManager.loadToShader(this.scene,this.scene.hasSomeShadow),this.lightsEditor&&this.lightsEditor.loadToShader(this.scene),d=this.renderingData.textureCount,this.gl.uniform1i(this.renderingData.locations.atutpxf,0),this.gl.uniform1i(this.renderingData.locations.uBlackAndWhite,
this.settings.renderBlackAndWhite),this.gl.uniform1i(this.renderingData.locations.ummxwav,0),this.gl.uniform1i(this.renderingData.locations.fhogvoz,0),this.gl.uniform2f(this.renderingData.locations.qxxpdff,this.gl.viewportWidth,this.gl.viewportHeight),this.gl.uniform1i(this.renderingData.locations.mgntrba,0),ub.call(this),wb.call(this),this.gl.uniform3f(this.renderingData.locations.xzwunne,this.renderingData.cameraPosition[0],this.renderingData.cameraPosition[1],this.renderingData.cameraPosition[2]),
this.gl.uniform3f(this.renderingData.locations.fnmxbkg,this.renderingData.cameraTarget[0],this.renderingData.cameraTarget[1],this.renderingData.cameraTarget[2]),this.gl.uniformMatrix4fv(this.renderingData.locations.wqfoqbo,!1,this.renderingData.invViewMatrix)),this.renderingData.textureCount=d,this.meshes.render(this.renderingData,this.scene,e,f,this.settings.renderHighlightedGeometry)));this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null);for(q in this.renderingData.blurredTextures)"none"!==q&&this.gl.deleteTexture(this.renderingData.blurredTextures[q]);
delete this.renderingData.blurredTextures;this.gl.disable(this.gl.POLYGON_OFFSET_FILL)}if(this.settings.renderWater&&(b&&this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,b),this.scene.waters.length)){this.shaders.useWaterRenderingShader(this.renderingData);ub.call(this);wb.call(this);this.gl.uniform3f(this.renderingData.locations.xzwunne,this.renderingData.cameraPosition[0],this.renderingData.cameraPosition[1],this.renderingData.cameraPosition[2]);this.gl.disable(this.gl.CULL_FACE);for(var B in this.scene.waters){q=
this.scene.waters[B];void 0===this.currentTime&&(this.currentTime=0);this.currentTime+=this.deltaT;this.gl.uniform1f(this.renderingData.locations.tsdiltr,this.currentTime/1E3);this.gl.uniform1i(this.renderingData.locations.lvvebjf,q.amplitudes.length);this.gl.uniform1fv(this.renderingData.locations.ewiuhvy,q.amplitudes);this.gl.uniform1fv(this.renderingData.locations.fvkpayf,q.waveLengths);this.gl.uniform1fv(this.renderingData.locations.euozvnt,q.speeds);this.gl.uniform2fv(this.renderingData.locations.xxbzpal,
q.directions);this.gl.activeTexture(this.gl.TEXTURE0);this.gl.bindTexture(this.gl.TEXTURE_CUBE_MAP,q.environmentCube);this.gl.uniform1i(this.renderingData.tdolhkz,0);q=q.polylist;for(var t in q.instances)this.meshes.renderWater(this.renderingData,q.instances[t])}}if(this.settings.renderMirrors&&this.scene.mirrors.length){B=mat4.create(this.renderingData.viewMatrix);t=mat4.create(this.renderingData.projectionMatrix);q=this.near;d=this.far;k=this.renderingData.cameraPosition;e=this.renderingData.cameraTarget;
f=this.renderingData.cameraUp;h=this.gl.viewportWidth;m=this.gl.viewportHeight;this.gl.enable(this.gl.SCISSOR_TEST);for(p=0;p<this.scene.mirrors.length;++p){g=this.scene.mirrors[p];this.renderingData.mirrorAttenuationMaxDistance=g.maxDistance;this.renderingData.mirrorAttenuationMinDistance=g.minDistance;this.renderingData.mirrorAttenuationExponent=g.exponent;if(this.currentMirrorWidth!==this.gl.viewportWidth*g.reduction||this.currentMirrorHeight!==this.gl.viewportHeight*g.reduction)this.currentMirrorWidth=
this.gl.viewportWidth*g.reduction,this.currentMirrorHeight=this.gl.viewportHeight*g.reduction,this.gl.bindTexture(this.gl.TEXTURE_2D,this.mirrorTexture),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.currentMirrorWidth,this.currentMirrorHeight,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,null),this.gl.bindTexture(this.gl.TEXTURE_2D,null),this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,this.mirrorRenderbuffer),this.gl.renderbufferStorage(this.gl.RENDERBUFFER,this.gl.DEPTH_STENCIL,this.currentMirrorWidth,
this.currentMirrorHeight);for(var w in g.polylist.instances)if(n=g.polylist.instances[w],!n.isHidden()){v=g;r=n;var A=r.node,O=this.renderingData.cameraPosition,V=this.renderingData.cameraTarget,E=this.renderingData.cameraUp;l=mat4.multiplyVec3(A.modelMatrix,v.planePosition,vec3.create());A=vec3.normalize(mat4.multiplyVec3(mat4.toRotationMat(A.modelMatrix,mat4.create()),v.planeNormal,vec3.create()));var I=A[0]*A[0]+A[1]*A[1]+A[2]*A[2],P=-(A[0]*(O[0]-l[0])+A[1]*(O[1]-l[1])+A[2]*(O[2]-l[2]))/I,u=vec3.create([A[0]*
P+O[0],A[1]*P+O[1],A[2]*P+O[2]]);u=vec3.subtract(u,O,vec3.create());0<vec3.dot(vec3.normalize(u,vec3.create()),vec3.normalize(A,vec3.create()))?v=null:(u=vec3.add(O,vec3.scale(u,2),vec3.create()),P=-(A[0]*(V[0]-l[0])+A[1]*(V[1]-l[1])+A[2]*(V[2]-l[2]))/I,P=vec3.create([A[0]*P+V[0],A[1]*P+V[1],A[2]*P+V[2]]),P=vec3.subtract(P,V,vec3.create()),V=vec3.add(V,vec3.scale(P,2),vec3.create()),O=vec3.add(E,O,vec3.create()),P=-(A[0]*(O[0]-l[0])+A[1]*(O[1]-l[1])+A[2]*(O[2]-l[2]))/I,E=vec3.create([A[0]*P+O[0],
A[1]*P+O[1],A[2]*P+O[2]]),E=vec3.subtract(E,O,vec3.create()),O=vec3.add(O,vec3.scale(E,2),vec3.create()),vec3.subtract(O,u),this.renderingData.mirrorPlanePosition=l,this.renderingData.mirrorPlaneNormal=A,this.renderingData.mirroredCameraPosition=u,this.gl.viewportWidth=this.currentMirrorWidth,this.gl.viewportHeight=this.currentMirrorHeight,this.gl.viewport(0,0,this.gl.viewportWidth,this.gl.viewportHeight),this.gl.scissor(0,0,this.gl.viewportWidth,this.gl.viewportHeight),mat4.lookAt(u,V,O,this.renderingData.viewMatrix),
Bd.call(this,{position:u,target:V,dynamicClippingPlanes:!0}),this.cameraMode?(this.currentCamera.adaptativeFov&&this.gl.viewportWidth<this.gl.viewportHeight?(l=this.near*Math.tan(this.currentCamera.fov*Math.PI*.5/180),A=-l,u=A*this.gl.viewportHeight/this.gl.viewportWidth,O=l*this.gl.viewportHeight/this.gl.viewportWidth):(O=this.near*Math.tan(this.currentCamera.fov*Math.PI*.5/180),u=-O,A=u*this.gl.viewportWidth/this.gl.viewportHeight,l=O*this.gl.viewportWidth/this.gl.viewportHeight),l+=A*this.currentCamera.screenOffset.x,
A*=1+this.currentCamera.screenOffset.x,O+=u*this.currentCamera.screenOffset.y,u*=1+this.currentCamera.screenOffset.y,mat4.frustum(A,l,u,O,this.near,this.far,this.renderingData.projectionMatrix)):(O=Math.tan(this.currentCamera.fov*Math.PI*.5/180)*vec3.length(vec3.subtract(this.currentCamera.position,this.currentCamera.target,vec3.create())),A=-O*this.gl.viewportWidth/this.gl.viewportHeight,l=O*this.gl.viewportWidth/this.gl.viewportHeight,u=-O,l+=A*this.currentCamera.screenOffset.x,A*=1+this.currentCamera.screenOffset.x,
O+=u*this.currentCamera.screenOffset.y,u*=1+this.currentCamera.screenOffset.y,mat4.ortho(A,l,u,O,this.near,this.far,this.renderingData.projectionMatrix)),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.mirrorFramebuffer),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,this.mirrorTexture,0),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT|this.gl.STENCIL_BUFFER_BIT),this.gl.enable(this.gl.BLEND),qa.call(this,[r.polylist]),qb.call(this,!1,
!0),Ia.call(this,[r.polylist]),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this.gl.enable(this.gl.BLEND),v=this.filters.applyBlur(this.mirrorTexture,this.gl.viewportWidth,this.gl.viewportHeight,v.blur,!1,!0,!1));v&&(this.meshes.lastNodeDrawn=null,this.renderingData.viewMatrix=mat4.create(B),this.renderingData.projectionMatrix=mat4.create(t),this.renderingData.cameraPosition=k,this.renderingData.cameraTarget=e,this.renderingData.cameraUp=f,this.near=q,this.far=d,this.gl.viewportWidth=h,this.gl.viewportHeight=
m,this.gl.viewport(0,0,this.gl.viewportWidth,this.gl.viewportHeight),this.gl.scissor(0,0,this.gl.viewportWidth,this.gl.viewportHeight),b&&this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,b),this.gl.enable(this.gl.BLEND),this.gl.depthFunc(this.gl.EQUAL),this.gl.enable(this.gl.POLYGON_OFFSET_FILL),r=n.matAnim.shaderType.clone(),r.set(stage.emersya.viewer.modules.renderer.shaders.shaderTypes.REFLECTION,!1),r.set(stage.emersya.viewer.modules.renderer.shaders.shaderTypes.REFLECTIONMAP,!1),r.set(stage.emersya.viewer.modules.renderer.shaders.shaderTypes.ANIM_REFLECTION,
!1),r.set(stage.emersya.viewer.modules.renderer.shaders.shaderTypes.ANIM_REFLECTIONMAP,!1),this.shaders.useTypedShader({shaderType:r},this.renderingData),this.renderingData.textureCount=0,this.gl.uniform1f(this.renderingData.locations.laicxpp,this.scene.tonemapping.multiplier),this.gl.uniform1f(this.renderingData.locations.mjjhnsa,this.scene.tonemapping.maxLuminance),this.lightsManager.loadToShader(this.scene,this.scene.hasSomeShadow),this.lightsEditor&&this.lightsEditor.loadToShader(this.scene),
this.gl.uniform1i(this.renderingData.locations.atutpxf,0),this.gl.uniform1i(this.renderingData.locations.uBlackAndWhite,this.settings.renderBlackAndWhite),this.gl.uniform1i(this.renderingData.locations.fhogvoz,0),this.gl.uniform2f(this.renderingData.locations.qxxpdff,this.gl.viewportWidth,this.gl.viewportHeight),this.gl.uniform1i(this.renderingData.locations.mgntrba,0),ub.call(this),wb.call(this),this.gl.uniform3f(this.renderingData.locations.xzwunne,this.renderingData.cameraPosition[0],this.renderingData.cameraPosition[1],
this.renderingData.cameraPosition[2]),this.gl.uniform3f(this.renderingData.locations.fnmxbkg,this.renderingData.cameraTarget[0],this.renderingData.cameraTarget[1],this.renderingData.cameraTarget[2]),this.gl.uniformMatrix4fv(this.renderingData.locations.wqfoqbo,!1,this.renderingData.invViewMatrix),l=this.renderingData.textureCount++,this.gl.uniform1i(this.renderingData.locations.plcreao,l),this.gl.uniform2f(this.renderingData.locations.qxxpdff,this.gl.viewportWidth,this.gl.viewportHeight),this.gl.uniform1f(this.renderingData.locations.ankxunu,
g.intensity),this.gl.activeTexture(this.gl.TEXTURE0+l),this.gl.bindTexture(this.gl.TEXTURE_2D,v),null!==g.texture&&geometry.uvBuffers[0].length?(this.gl.activeTexture(this.gl.TEXTURE0+this.renderingData.textureCount),this.gl.uniform1i(this.renderingData.locations.rwexkck,this.renderingData.textureCount++),this.gl.bindTexture(this.gl.TEXTURE_2D,g.texture.glTexture),this.gl.uniform1f(this.renderingData.locations.uUseMirrorIntensityTex,1),this.gl.uniform2f(this.renderingData.locations.uMirrorIntensityTextureRepeat,
g.texture.repeatX,g.texture.repeatY),this.gl.uniform2f(this.renderingData.locations.uMirrorIntensityTextureOffset,g.texture.offsetX,g.texture.offsetY)):(this.gl.uniform1f(this.renderingData.locations.uUseMirrorIntensityTex,0),this.gl.uniform1i(this.renderingData.locations.rwexkck,l)),this.gl.uniform1i(this.renderingData.locations.ummxwav,2),this.meshes.render(this.renderingData,this.scene,n,r,this.settings.renderHighlightedGeometry),this.gl.activeTexture(this.gl.TEXTURE0+l),this.gl.bindTexture(this.gl.TEXTURE_2D,
null),this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this.gl.depthFunc(this.gl.LESS),"none"!=g.blur&&""!=g.blur&&this.gl.deleteTexture(v),b&&this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null))}}this.renderingData.viewMatrix=mat4.create(B);this.renderingData.projectionMatrix=mat4.create(t);this.near=q;this.far=d;this.renderingData.cameraPosition=k;this.renderingData.cameraTarget=e;this.renderingData.cameraUp=f;this.gl.viewportWidth=h;this.gl.viewportHeight=m;this.gl.disable(this.gl.SCISSOR_TEST)}this.settings.renderSilhouettes&&
gd.call(this);b&&this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,b);this.settings.renderSSAO&&Rc.call(this,this.ssaoSplitPolylistIndex,this.scene.polylistInstances.length-1);this.settings.renderSilhouettes&&td.call(this);if(this.settings.renderHighlightedSilhouettes&&this.scene.highlight.showSilhouettes&&!this.screenshotting){this.shaders.useShadowShader(this.renderingData);this.gl.disable(this.gl.BLEND);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.hightlightFramebuffer);this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,
this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,this.highlightPositionsTexture,0);this.gl.viewport(0,0,this.highlightWidth,this.highlightHeight);this.gl.scissor(0,0,this.highlightWidth,this.highlightHeight);this.gl.clearColor(0,0,0,0);this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT);ub.call(this);wb.call(this);this.gl.uniform3f(this.renderingData.locations.xzwunne,this.currentCamera.position[0],this.currentCamera.position[1],this.currentCamera.position[2]);this.gl.uniform1f(this.renderingData.locations.oruddbu,
this.far-this.near);this.gl.uniform1f(this.renderingData.locations.hvcoccw,0);for(w=0;w<this.scene.polylistInstances.length;++w)this.gl.uniform1f(this.renderingData.locations.oruddbu,this.scene.polylistInstances[w].highlighted?this.far-this.near:1E50),this.meshes.renderForShadowMaps(this.renderingData,this.scene.polylistInstances[w]);this.gl.colorMask(!0,!0,!0,!0);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.hightlightFramebuffer);this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,
this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,this.highlightRenderTexture,0);this.gl.viewport(0,0,this.highlightWidth,this.highlightHeight);this.gl.scissor(0,0,this.highlightWidth,this.highlightHeight);this.gl.clearColor(0,0,0,0);this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT);this.shaders.useSilhouettesFromShadowShader(this.renderingData);this.gl.disable(this.gl.DEPTH_TEST);this.gl.enable(this.gl.BLEND);this.gl.uniformMatrix4fv(this.renderingData.locations.ampnorz,!1,this.screenViewMatrix);
this.gl.uniformMatrix4fv(this.renderingData.locations.ghgsnpw,!1,this.screenTransfMatrix);this.gl.uniformMatrix4fv(this.renderingData.locations.ondssmn,!1,this.renderingData.identityMatrix);this.gl.uniform1f(this.renderingData.locations.zbuvdav,this.settings.silhouettesThreshold);this.gl.uniform2f(this.renderingData.locations.ngzaxyh,this.highlightWidth,this.highlightHeight);this.gl.uniform2f(this.renderingData.locations.qxxpdff,this.highlightWidth,this.highlightHeight);this.gl.uniform4f(this.renderingData.locations.srrtdcb,
this.scene.highlight.borderColor[0],this.scene.highlight.borderColor[1],this.scene.highlight.borderColor[2],this.scene.highlight.borderColor[3]);this.gl.uniform1f(this.renderingData.locations.oruddbu,this.far-this.near);this.gl.uniform1i(this.renderingData.locations.dkgckvl,0);this.gl.activeTexture(this.gl.TEXTURE0);this.gl.bindTexture(this.gl.TEXTURE_2D,this.highlightPositionsTexture);this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexBufferScreen);this.gl.vertexAttribPointer(this.renderingData.locations.ymaxekn,
3,this.gl.FLOAT,!1,0,0);this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.elementsBufferScreen);this.gl.drawElements(this.gl.TRIANGLES,6,this.gl.UNSIGNED_SHORT,0);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.globalFramebuffer.fxaaFramebuffer);this.shaders.useAntialiasingShader(this.renderingData);this.gl.viewport(0,0,this.gl.viewportWidth,this.gl.viewportHeight);this.gl.scissor(0,0,this.gl.viewportWidth,this.gl.viewportHeight);this.gl.enable(this.gl.SCISSOR_TEST);this.gl.clearColor(this.highlightClearColor[0],
this.highlightClearColor[1],this.highlightClearColor[2],this.highlightClearColor[3]);this.gl.clear(this.gl.COLOR_BUFFER_BIT);this.gl.enable(this.gl.BLEND);this.gl.depthMask(!1);this.gl.uniformMatrix4fv(this.renderingData.locations.ampnorz,!1,this.screenViewMatrix);this.gl.uniformMatrix4fv(this.renderingData.locations.ghgsnpw,!1,this.screenTransfMatrix);this.gl.uniform1f(this.renderingData.locations.mnxuvqf,1);this.gl.uniform2f(this.renderingData.locations.mbfivoq,1,1);this.gl.uniform2f(this.renderingData.locations.qxxpdff,
this.globalFramebuffer.width,this.globalFramebuffer.height);this.gl.uniform2f(this.renderingData.locations.wkmsbqd,.5*this.currentJitteringVector[0]/(8*this.gl.viewportWidth),.5*this.currentJitteringVector[1]/(8*this.gl.viewportHeight));this.gl.uniform1i(this.renderingData.locations.dkgckvl,0);this.gl.activeTexture(this.gl.TEXTURE0);this.gl.bindTexture(this.gl.TEXTURE_2D,this.highlightRenderTexture);this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexBufferScreen);this.gl.vertexAttribPointer(this.renderingData.locations.ymaxekn,
3,this.gl.FLOAT,!1,0,0);this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.elementsBufferScreen);this.gl.drawElements(this.gl.TRIANGLES,6,this.gl.UNSIGNED_SHORT,0);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null);this.forceSynchronousFramebuffers&&(this.gl.flush(),this.gl.finish());b?this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,b):this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null);this.shaders.useScreenTextureShader(this.renderingData);this.gl.enable(this.gl.BLEND);this.gl.blendFunc(this.gl.ONE,
this.gl.ONE);this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA);this.gl.depthMask(!1);this.gl.viewport(0,0,this.gl.viewportWidth,this.gl.viewportHeight);this.gl.scissor(0,0,this.gl.viewportWidth,this.gl.viewportHeight);this.gl.uniformMatrix4fv(this.renderingData.locations.ampnorz,!1,this.screenViewMatrix);this.gl.uniformMatrix4fv(this.renderingData.locations.ghgsnpw,!1,this.screenTransfMatrix);this.gl.uniform1f(this.renderingData.locations.mnxuvqf,1);this.gl.uniform1f(this.renderingData.locations.tfrqoeu,
1);this.gl.uniform2f(this.renderingData.locations.wclpegx,this.gl.viewportWidth/this.globalFramebuffer.width,this.gl.viewportHeight/this.globalFramebuffer.height);this.gl.uniform2f(this.renderingData.locations.qxxpdff,this.gl.viewportWidth,this.gl.viewportHeight);this.gl.uniform2f(this.renderingData.locations.ngzaxyh,this.gl.viewportWidth,this.gl.viewportHeight);this.gl.uniform1f(this.renderingData.locations.zvecpmg,0);this.gl.uniform2f(this.renderingData.locations.wkmsbqd,0,0);this.gl.uniform1i(this.renderingData.locations.dkgckvl,
0);this.gl.activeTexture(this.gl.TEXTURE0);this.gl.bindTexture(this.gl.TEXTURE_2D,this.globalFramebuffer.fxaaTexture);this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexBufferScreen);this.gl.vertexAttribPointer(this.renderingData.locations.ymaxekn,3,this.gl.FLOAT,!1,0,0);this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.elementsBufferScreen);this.gl.drawElements(this.gl.TRIANGLES,6,this.gl.UNSIGNED_SHORT,0);this.gl.depthMask(!0);this.gl.enable(this.gl.DEPTH_TEST);this.gl.bindTexture(this.gl.TEXTURE_2D,
null);this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA)}if(this.scene.hasSomeGlow&&this.settings.renderGlow){this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.glowFramebuffer);this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,this.glowTexture,0);this.gl.viewport(0,0,this.glowWidth,this.glowHeight);this.gl.scissor(0,0,this.glowWidth,this.glowHeight);this.gl.clearColor(0,0,0,0);this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT);
this.shaders.useShadowShader(this.renderingData);this.gl.disable(this.gl.BLEND);ub.call(this);wb.call(this);this.gl.uniform3f(this.renderingData.locations.xzwunne,this.renderingData.cameraPosition[0],this.renderingData.cameraPosition[1],this.renderingData.cameraPosition[2]);this.gl.uniform1f(this.renderingData.locations.oruddbu,this.far-this.near);this.gl.colorMask(!1,!1,!1,!1);this.renderingData.currentPolygonOffsetFactor=1;this.renderingData.currentPolygonOffsetUnits=1;for(w=0;w<this.scene.polylistInstances.length;++w)this.meshes.renderForShadowMaps(this.renderingData,
this.scene.polylistInstances[w]);this.renderingData.currentPolygonOffsetFactor=0;this.renderingData.currentPolygonOffsetUnits=0;this.gl.colorMask(!0,!0,!0,!0);this.shaders.useGlowWritingShader(this.renderingData,this.scene);ub.call(this);wb.call(this);this.gl.uniform1i(this.renderingData.locations.qsscwkg,1);this.gl.depthFunc(this.gl.EQUAL);for(w=0;w<this.scene.polylistInstances.length;++w)this.meshes.renderGlow(this.renderingData,this.scene.polylistInstances[w]);this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,
this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,this.glow2Texture,0);this.gl.clearColor(0,0,0,0);this.gl.clear(this.gl.COLOR_BUFFER_BIT);this.gl.uniform1i(this.renderingData.locations.qsscwkg,2);for(w=0;w<this.scene.polylistInstances.length;++w)this.meshes.renderGlow(this.renderingData,this.scene.polylistInstances[w]);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null);this.gl.depthFunc(this.gl.LESS);this.glowTexture=this.filters.applyGlow(this.glowTexture,this.glow2Texture,this.glowWidth,this.glowHeight);
this.gl.viewport(0,0,this.gl.viewportWidth,this.gl.viewportHeight);this.gl.scissor(0,0,this.gl.viewportWidth,this.gl.viewportHeight);b&&this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,b);this.shaders.useGlowRenderingShader(this.renderingData);this.gl.disable(this.gl.DEPTH_TEST);this.gl.enable(this.gl.BLEND);this.gl.uniformMatrix4fv(this.renderingData.locations.ampnorz,!1,this.screenViewMatrix);this.gl.uniformMatrix4fv(this.renderingData.locations.ghgsnpw,!1,this.rawScreenTransfMatrix);this.gl.uniformMatrix4fv(this.renderingData.locations.ondssmn,
!1,this.renderingData.identityMatrix);this.gl.uniform1i(this.renderingData.locations.dkgckvl,0);this.gl.uniform1f(this.renderingData.locations.bzmstcf,-1);this.gl.activeTexture(this.gl.TEXTURE0);this.gl.bindTexture(this.gl.TEXTURE_2D,this.glowTexture);this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexBufferScreen);this.gl.vertexAttribPointer(this.renderingData.locations.ymaxekn,3,this.gl.FLOAT,!1,0,0);this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.uvBufferScreen);this.gl.vertexAttribPointer(this.renderingData.locations.aUv[0],
2,this.gl.FLOAT,!1,0,0);this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.elementsBufferScreen);this.gl.blendFunc(this.gl.ONE,this.gl.ONE);this.gl.drawElements(this.gl.TRIANGLES,6,this.gl.UNSIGNED_SHORT,0);this.gl.enable(this.gl.DEPTH_TEST);this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA)}if(this.scene.hasSomeSpecularGlow&&this.settings.renderSpecularGlow){this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.specularGlowFramebuffer);this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,
this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,this.specularGlowTexture,0);this.gl.viewport(0,0,this.specularGlowWidth,this.specularGlowHeight);this.gl.scissor(0,0,this.specularGlowWidth,this.specularGlowHeight);this.gl.clearColor(0,0,0,0);this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT|this.gl.STENCIL_BUFFER_BIT);this.shaders.useShadowShader(this.renderingData);ub.call(this);wb.call(this);this.gl.uniform3f(this.renderingData.locations.xzwunne,this.renderingData.cameraPosition[0],this.renderingData.cameraPosition[1],
this.renderingData.cameraPosition[2]);this.gl.uniform1f(this.renderingData.locations.oruddbu,this.far-this.near);this.gl.depthFunc(this.gl.LESS);this.gl.colorMask(!1,!1,!1,!1);this.gl.enable(this.gl.POLYGON_OFFSET_FILL);this.renderingData.currentPolygonOffsetFactor=1;this.renderingData.currentPolygonOffsetUnits=1;for(w=0;w<this.scene.polylistInstances.length;++w)this.meshes.renderForShadowMaps(this.renderingData,this.scene.polylistInstances[w]);this.renderingData.currentPolygonOffsetFactor=0;this.renderingData.currentPolygonOffsetUnits=
0;this.gl.colorMask(!0,!0,!0,!0);this.gl.depthFunc(this.gl.LEQUAL);qb.call(this,!1,!1,!1,!0);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null);this.gl.depthFunc(this.gl.LESS);this.specularGlowTexture=this.filters.applySpecularGlow(this.specularGlowTexture,this.specularGlowWidth,this.specularGlowHeight);this.gl.viewport(0,0,this.gl.viewportWidth,this.gl.viewportHeight);this.gl.scissor(0,0,this.gl.viewportWidth,this.gl.viewportHeight);b&&this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,b);this.shaders.useGlowRenderingShader(this.renderingData);
this.gl.disable(this.gl.DEPTH_TEST);this.gl.enable(this.gl.BLEND);this.gl.uniformMatrix4fv(this.renderingData.locations.ampnorz,!1,this.screenViewMatrix);this.gl.uniformMatrix4fv(this.renderingData.locations.ghgsnpw,!1,this.rawScreenTransfMatrix);this.gl.uniformMatrix4fv(this.renderingData.locations.ondssmn,!1,this.renderingData.identityMatrix);this.gl.uniform1i(this.renderingData.locations.dkgckvl,0);this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE);this.gl.uniform1f(this.renderingData.locations.bzmstcf,
-1);this.gl.activeTexture(this.gl.TEXTURE0);this.gl.bindTexture(this.gl.TEXTURE_2D,this.specularGlowTexture);this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexBufferScreen);this.gl.vertexAttribPointer(this.renderingData.locations.ymaxekn,3,this.gl.FLOAT,!1,0,0);this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.uvBufferScreen);this.gl.vertexAttribPointer(this.renderingData.locations.aUv[0],2,this.gl.FLOAT,!1,0,0);this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.elementsBufferScreen);this.gl.drawElements(this.gl.TRIANGLES,
6,this.gl.UNSIGNED_SHORT,0);this.gl.enable(this.gl.DEPTH_TEST);this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA)}this.scene.enableArOccluder&&this.settings.renderArOccluder&&(this.arOccluderTexture&&this.gl.deleteTexture(this.arOccluderTexture),this.arOccluderTexture=Fb.call(this,this.gl.viewportWidth,this.gl.viewportHeight),this.shaders.useArOccluderShader(this.renderingData),this.gl.viewport(0,0,this.gl.viewportWidth,this.gl.viewportHeight),this.gl.scissor(0,0,this.gl.viewportWidth,
this.gl.viewportHeight),this.gl.enable(this.gl.BLEND),this.gl.uniformMatrix4fv(this.renderingData.locations.ampnorz,!1,this.screenViewMatrix),this.gl.uniformMatrix4fv(this.renderingData.locations.ghgsnpw,!1,this.screenTransfMatrix),this.gl.uniform2f(this.renderingData.locations.ywlbgmy,this.gl.viewportWidth,this.gl.viewportHeight),this.gl.uniform1f(this.renderingData.locations.rhtkmtu,this.gl.viewportWidth/this.gl.viewportHeight),this.gl.uniform1f(this.renderingData.locations.wlqtigw,this.backgroundTextureWidth/
this.backgroundTextureHeight),this.gl.uniformMatrix3fv(this.renderingData.locations.uvMatrix,!1,mat3.identity(mat3.create())),w=this.scene.arData.vykingData?this.scene.arData.vykingData:{},B=w.rotationAngle,this.gl.uniformMatrix3fv(this.renderingData.locations.kwxtxyk,!1,mat3.create([Math.cos(B),-Math.sin(B),0,Math.sin(B),Math.cos(B),0,0,Math.sin(B),1])),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this.backgroundTexture),this.gl.uniform1i(this.renderingData.locations.sbyegvv,
0),this.gl.activeTexture(this.gl.TEXTURE1),B=this.gl.createTexture(),this.gl.bindTexture(this.gl.TEXTURE_2D,B),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,w.occlusionMaskWidth,w.occlusionMaskHeight,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,w.occlusionMaskTexture),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),
this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.uniform1i(this.renderingData.locations.cnehorz,1),this.gl.activeTexture(this.gl.TEXTURE2),B=this.gl.createTexture(),this.gl.bindTexture(this.gl.TEXTURE_2D,B),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,w.occlusionMaskWidth,w.occlusionMaskHeight,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,w.previousOcclusionMaskTexture),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),
this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.uniform1i(this.renderingData.locations.xpetrcl,2),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexBufferScreen),this.gl.vertexAttribPointer(this.renderingData.locations.ymaxekn,3,this.gl.FLOAT,!1,0,0),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,
this.elementsBufferScreen),this.gl.drawElements(this.gl.TRIANGLES,6,this.gl.UNSIGNED_SHORT,0),this.gl.enable(this.gl.DEPTH_TEST));b&&this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,b)},ld=function(){if(this.settings.renderRulers){var b=this.scene.root.boundingBoxWithoutNodes;if(!this.screenshotting&&b){var d=b.maxX-b.minX,e=b.maxZ-b.minZ,f=b.maxY-b.minY,h=this.scene.computeRealMeasurementSceneFactor(this.scene.arData);if(this.currentBBoxWidth!==d){this.currentBBoxWidth=d;d=this.apiCore.exec(this.callerName,
"lib.convertSize",this.currentBBoxWidth*h,this.settings.rulersSettings);this.canvasRulerCtx.clearRect(0,0,this.canvasRuler.width,this.canvasRuler.height);this.canvasRulerCtx.fillStyle="rgba(0,0,0,1)";var m=this.canvasRulerCtx.measureText(d).width+2*this.rulerTextMargin,p=(this.canvasRuler.width-m)/2,g=(this.canvasRuler.height-this.rulerTextHeight)/2,n=this.rulerTextHeight,v=.55*this.rulerTextHeight;this.canvasRulerCtx.beginPath();this.canvasRulerCtx.moveTo(p+v,g);this.canvasRulerCtx.lineTo(p+m-v,
g);this.canvasRulerCtx.quadraticCurveTo(p+m,g,p+m,g+v);this.canvasRulerCtx.lineTo(p+m,g+n-v);this.canvasRulerCtx.quadraticCurveTo(p+m,g+n,p+m-v,g+n);this.canvasRulerCtx.lineTo(p+v,g+n);this.canvasRulerCtx.quadraticCurveTo(p,g+n,p,g+n-v);this.canvasRulerCtx.lineTo(p,g+v);this.canvasRulerCtx.quadraticCurveTo(p,g,p+v,g);this.canvasRulerCtx.closePath();this.canvasRulerCtx.fill();this.canvasRulerCtx.fillStyle="#ffffff";this.canvasRulerCtx.textAlign="center";this.canvasRulerCtx.textBaseline="middle";this.canvasRulerCtx.fillText(d,
this.canvasRuler.width/2,this.rulerTextOffset+this.canvasRuler.height/2);this.gl.bindTexture(this.gl.TEXTURE_2D,this.rulerTextureWidth);this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,this.canvasRuler);this.gl.webgl2&&this.gl.generateMipmap(this.gl.TEXTURE_2D);this.gl.bindTexture(this.gl.TEXTURE_2D,null)}this.currentBBoxDepth!==e&&(this.currentBBoxDepth=e,e=this.apiCore.exec(this.callerName,"lib.convertSize",this.currentBBoxDepth*h,this.settings.rulersSettings),
this.canvasRulerCtx.clearRect(0,0,this.canvasRuler.width,this.canvasRuler.height),this.canvasRulerCtx.fillStyle="rgba(0,0,0,1)",d=this.canvasRulerCtx.measureText(e).width+2*this.rulerTextMargin,m=(this.canvasRuler.width-d)/2,p=(this.canvasRuler.height-this.rulerTextHeight)/2,g=this.rulerTextHeight,n=.55*this.rulerTextHeight,this.canvasRulerCtx.beginPath(),this.canvasRulerCtx.moveTo(m+n,p),this.canvasRulerCtx.lineTo(m+d-n,p),this.canvasRulerCtx.quadraticCurveTo(m+d,p,m+d,p+n),this.canvasRulerCtx.lineTo(m+
d,p+g-n),this.canvasRulerCtx.quadraticCurveTo(m+d,p+g,m+d-n,p+g),this.canvasRulerCtx.lineTo(m+n,p+g),this.canvasRulerCtx.quadraticCurveTo(m,p+g,m,p+g-n),this.canvasRulerCtx.lineTo(m,p+n),this.canvasRulerCtx.quadraticCurveTo(m,p,m+n,p),this.canvasRulerCtx.closePath(),this.canvasRulerCtx.fill(),this.canvasRulerCtx.fillStyle="#ffffff",this.canvasRulerCtx.textAlign="center",this.canvasRulerCtx.textBaseline="middle",this.canvasRulerCtx.fillText(e,this.canvasRuler.width/2,this.rulerTextOffset+this.canvasRuler.height/
2),this.gl.bindTexture(this.gl.TEXTURE_2D,this.rulerTextureDepth),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,this.canvasRuler),this.gl.webgl2&&this.gl.generateMipmap(this.gl.TEXTURE_2D),this.gl.bindTexture(this.gl.TEXTURE_2D,null));this.currentBBoxHeight!==f&&(this.currentBBoxHeight=f,f=this.apiCore.exec(this.callerName,"lib.convertSize",this.currentBBoxHeight*h,this.settings.rulersSettings),this.canvasRulerCtx.clearRect(0,0,this.canvasRuler.width,this.canvasRuler.height),
this.canvasRulerCtx.fillStyle="rgba(0,0,0,1)",h=this.canvasRulerCtx.measureText(f).width+2*this.rulerTextMargin,e=(this.canvasRuler.width-h)/2,d=(this.canvasRuler.height-this.rulerTextHeight)/2,m=this.rulerTextHeight,p=.55*this.rulerTextHeight,this.canvasRulerCtx.beginPath(),this.canvasRulerCtx.moveTo(e+p,d),this.canvasRulerCtx.lineTo(e+h-p,d),this.canvasRulerCtx.quadraticCurveTo(e+h,d,e+h,d+p),this.canvasRulerCtx.lineTo(e+h,d+m-p),this.canvasRulerCtx.quadraticCurveTo(e+h,d+m,e+h-p,d+m),this.canvasRulerCtx.lineTo(e+
p,d+m),this.canvasRulerCtx.quadraticCurveTo(e,d+m,e,d+m-p),this.canvasRulerCtx.lineTo(e,d+p),this.canvasRulerCtx.quadraticCurveTo(e,d,e+p,d),this.canvasRulerCtx.closePath(),this.canvasRulerCtx.fill(),this.canvasRulerCtx.fillStyle="#ffffff",this.canvasRulerCtx.textAlign="center",this.canvasRulerCtx.textBaseline="middle",this.canvasRulerCtx.fillText(f,this.canvasRuler.width/2,this.rulerTextOffset+this.canvasRuler.height/2),this.gl.bindTexture(this.gl.TEXTURE_2D,this.rulerTextureHeight),this.gl.texImage2D(this.gl.TEXTURE_2D,
0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,this.canvasRuler),this.gl.webgl2&&this.gl.generateMipmap(this.gl.TEXTURE_2D),this.gl.bindTexture(this.gl.TEXTURE_2D,null));d=offsetFrontRight=offsetLeftBack=offsetBackBack=rc.call(this);f=vec3.create();m=this.scene.root.boundingBoxWithoutNodes.vecs[0];p=this.scene.root.boundingBoxWithoutNodes.vecs[4];g=this.scene.root.boundingBoxWithoutNodes.vecs[1];n=[0,0,-d];v=[-offsetFrontRight,0,0];var k=[offsetBackBack,0,-offsetLeftBack],l=vec3.length(vec3.subtract(b.vecs[0],
this.currentCamera.position,f));e=this.rulerTextureWidth;h=this.rulerTextureDepth;var r=vec3.length(vec3.subtract(b.vecs[1],this.currentCamera.position,f));r<l&&(l=r,m=b.vecs[1],p=b.vecs[0],g=b.vecs[5],n=[-d,0,0],v=[0,0,offsetFrontRight],k=[-offsetLeftBack,0,-offsetBackBack],e=this.rulerTextureDepth,h=this.rulerTextureWidth);r=vec3.length(vec3.subtract(b.vecs[4],this.currentCamera.position,f));r<l&&(l=r,m=b.vecs[4],p=b.vecs[5],g=b.vecs[0],n=[d,0,0],v=[0,0,-offsetFrontRight],k=[offsetLeftBack,0,offsetBackBack],
e=this.rulerTextureDepth,h=this.rulerTextureWidth);r=vec3.length(vec3.subtract(b.vecs[5],this.currentCamera.position,f));r<l&&(m=b.vecs[5],p=b.vecs[1],g=b.vecs[4],n=[0,0,d],v=[offsetFrontRight,0,0],k=[-offsetBackBack,0,offsetLeftBack],e=this.rulerTextureWidth,h=this.rulerTextureDepth);d=[[vec3.add(m,n,vec3.create()),vec3.add(p,n,vec3.create())],[vec3.add(m,v,vec3.create()),vec3.add(g,v,vec3.create())],[vec3.add(p,k,vec3.create()),vec3.add(vec3.add(p,k,vec3.create()),[0,b.maxY-b.minY,0])]];b=mat4.create(this.renderingData.identityMatrix);
this.shaders.useFramerateShader(this.renderingData);this.gl.disable(this.gl.DEPTH_TEST);this.gl.enable(this.gl.BLEND);this.gl.uniformMatrix4fv(this.renderingData.locations.ampnorz,!1,this.screenViewMatrix);this.gl.uniformMatrix4fv(this.renderingData.locations.ghgsnpw,!1,this.screenTransfMatrix);this.gl.uniform1i(this.renderingData.locations.dkgckvl,0);this.gl.uniform4f(this.renderingData.locations.srrtdcb,0,0,0,0);this.gl.uniform1f(this.renderingData.locations.mnxuvqf,-1);this.gl.activeTexture(this.gl.TEXTURE0);
this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexBufferScreen);this.gl.vertexAttribPointer(this.renderingData.locations.ymaxekn,3,this.gl.FLOAT,!1,0,0);this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.uvBufferScreen);this.gl.vertexAttribPointer(this.renderingData.locations.aUv[0],2,this.gl.FLOAT,!1,0,0);this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.elementsBufferScreen);m=vec3.scale(vec3.add(d[0][0],d[0][1],f),.5);mat4.multiply(this.renderingData.unjitteredProjectionMatrix,this.renderingData.viewMatrix,
mat4.identity(b));p=mat4.multiplyVec4(b,[m[0],m[1],m[2],1]);p[0]/=p[3];p[1]/=p[3];p[2]=0;m=[1/this.maxScaling*this.canvasRuler.width/this.realSize[0],1/this.maxScaling*this.canvasRuler.height/this.realSize[1],1];mat4.identity(b);mat4.translate(b,p);mat4.scale(b,m);this.gl.bindTexture(this.gl.TEXTURE_2D,e);this.gl.uniformMatrix4fv(this.renderingData.locations.ondssmn,!1,b);this.gl.drawElements(this.gl.TRIANGLES,6,this.gl.UNSIGNED_SHORT,0);e=vec3.scale(vec3.add(d[1][0],d[1][1],f),.5);mat4.multiply(this.renderingData.unjitteredProjectionMatrix,
this.renderingData.viewMatrix,mat4.identity(b));p=mat4.multiplyVec4(b,[e[0],e[1],e[2],1]);p[0]/=p[3];p[1]/=p[3];p[2]=0;mat4.identity(b);mat4.translate(b,p);mat4.scale(b,m);this.gl.bindTexture(this.gl.TEXTURE_2D,h);this.gl.uniformMatrix4fv(this.renderingData.locations.ondssmn,!1,b);this.gl.drawElements(this.gl.TRIANGLES,6,this.gl.UNSIGNED_SHORT,0);f=vec3.scale(vec3.add(d[2][0],d[2][1],f),.5);mat4.multiply(this.renderingData.unjitteredProjectionMatrix,this.renderingData.viewMatrix,mat4.identity(b));
p=mat4.multiplyVec4(b,[f[0],f[1],f[2],1]);p[0]/=p[3];p[1]/=p[3];p[2]=0;mat4.identity(b);mat4.translate(b,p);mat4.scale(b,m);this.gl.bindTexture(this.gl.TEXTURE_2D,this.rulerTextureHeight);this.gl.uniformMatrix4fv(this.renderingData.locations.ondssmn,!1,b);this.gl.drawElements(this.gl.TRIANGLES,6,this.gl.UNSIGNED_SHORT,0);this.gl.enable(this.gl.DEPTH_TEST);this.gl.disable(this.gl.BLEND)}}},Sd=function(b){b&&this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,b);if(1==this.clearColor.a)this.gl.colorMask(!1,
!1,!1,!0),this.gl.clearColor(1,1,1,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.gl.colorMask(!0,!0,!0,!0);else{this.gl.enable(this.gl.STENCIL_TEST);this.gl.stencilFunc(this.gl.EQUAL,1,255);this.gl.stencilMask(255);b=this.clearColor.a;var d=this.backgroundAlpha,e=this.backgroundFitting;this.backgroundAlpha=this.clearColor.a=1;this.backgroundFitting=12220;this.gl.colorMask(!1,!1,!1,!0);E.call(this);Jb.call(this);this.gl.colorMask(!0,!0,!0,!0);this.clearColor.a=b;this.backgroundAlpha=d;this.backgroundFitting=
e;E.call(this);this.gl.disable(this.gl.STENCIL_TEST)}};l.prototype.render=function(b,d){if(!this.canvas.width&&!this.canvas.height)return this.lastFrameDrawn=!1;if(!this.scene)return this.gl.viewport(0,0,this.gl.viewportWidth,this.gl.viewportHeight),this.gl.scissor(0,0,this.gl.viewportWidth,this.gl.viewportHeight),this.gl.clearColor(this.clearColor.r,this.clearColor.g,this.clearColor.b,this.clearColor.a),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.lastFrameDrawn=!1;if(!this.contextValid||this.destroyed||
this.screenshotting||this.resizing)return this.lastFrameDrawn=!1;null!==this.nextDeltaT&&void 0!==this.nextDeltaT?(this.deltaT=this.nextDeltaT,this.nextDeltaT=null):this.deltaT=d*this.animationSpeed;this.resetTime&&(d=Date.now()-this.resetTime,delete this.resetTime);this.accumulatedTime.time+=d;++this.accumulatedTime.nbFrames;350<this.accumulatedTime.time&&(this.framerate=1E3/(this.accumulatedTime.time/this.accumulatedTime.nbFrames),this.accumulatedTime.nbFrames=0,this.accumulatedTime.time=0,this.framerateText=
(this.gl.webgl2?"GL2":"GL1")+" FPS: "+this.framerate.toFixed(1)+" Scaling: "+this.currentScaling.toFixed(2));b=Wa.call(this,b);++this.framesCnt;this.updateSceneMaterials=!1;var e;if(this.scene.updateMaterialsFunction.length){for(e in this.scene.updateMaterialsFunction)this.scene.updateMaterialsFunction[e]();this.scene.updateMaterialsFunction=[]}d=!1;if(this.animatingMaterials){for(e=0;e<this.scene.polylistInstances.length;++e)d=this.scene.polylistInstances[e].matAnim.computeMaterial(this.scene,this.deltaT,
this.apiCore)||d;for(e=0;e<this.scene.polylistInstances.length;++e)this.scene.polylistInstances[e].matAnim.checkCallback()}d&&(this.updateSceneMaterials=!0);e=d;var f=d=!1;if(this.animatingGeometries){for(h in this.scene.nodesInUse)d=this.scene.nodesInUse[h].animations.computeMatrix(this.deltaT)||d;for(h in this.scene.nodesInUse)f=this.scene.updateMatrices(this.scene.nodesInUse[h])||f;for(h in this.scene.nodesInUse)this.scene.nodesInUse[h].animations.checkCallback()}f&&(this.updateSceneMaterials=
!0);d&&(this.scene.updateSceneBoundingBoxesFromRaw(),this.cameraModeChanged=this.scene.updatedBoundingBox=!0);e=d||e;this.updateSceneMaterials&&this.shaders.updatePolylistsInstances(this.scene);e=Ed.call(this)||e;nb.call(this,e&&this.deltaT,b);this.settings.renderWater&&this.scene.waters.length&&(e=!0);var h=e;if(this.stopDraw||0<this.scene.stopDraw)return this.ignoreNextScalingTime=!0,this.lastFrameDrawn=!1;Qb.call(this,b,h);if(2==this.rulerPositions.length){e=[];for(var m in this.rulerPositions)e.push(this.screenTools.getScreenPosition(this.rulerPositions[m]));
this.eventsManager.fireEvent("onRulerMove",e)}m=!!(this.scene.needsUpdate||h||b);if(!this.annotationsDisabledWhileMoving&&m||this.annotationsDisabledWhileMoving&&!m&&!this.generatingSSAA||h&&!b||this.forceNextExternalUpdate)this.lastFrameDrawn?(this.shaders.useOneColorShader(this.renderingData),this.gl.uniformMatrix4fv(this.renderingData.locations.ghgsnpw,!1,this.renderingData.unjitteredProjectionMatrix),this.gl.uniformMatrix4fv(this.renderingData.locations.ampnorz,!1,this.renderingData.viewMatrix),
this.annotationsToCompute.length&&(m=this.screenTools.addAnnotations(this.annotationsToCompute,this.settings.rebondsAnnotations,this.maxScaling,this.cameraMode),this.apiCore.exec(this.callerName,"onAnnotationsMove",m)),m=this.screenTools.trackProductNodes(this.settings.rebondsAnnotations,this.maxScaling,this.cameraMode),this.apiCore.exec(this.callerName,"productNodeTrackingUpdate",m.productNodes),this.apiCore.exec(this.callerName,"placeholdersTrackingUpdate",m.placeholders),this.forceNextExternalUpdate=
!1):this.forceNextExternalUpdate=!0;else if(b&&this.annotationsDisabledWhileMoving){for(m=0;m<this.hiddenAnnotationsToFire.length;++m)this.hiddenAnnotationsToFire[m].baseObj.trueCounter=0,this.hiddenAnnotationsToFire[m].baseObj.falseCounter=0,this.hiddenAnnotationsToFire[m].baseObj.state=null;this.apiCore.exec(this.callerName,"onAnnotationsMove",this.hiddenAnnotationsToFire)}if(b||h||this.needsComputeFurlayers)zc.call(this),this.needsComputeFurlayers=!1,this.scene.needsUpdate=Math.max(this.scene.needsUpdate,
1);m=this.ssaaEnabled&&2===this.ssaaRenderMode&&this.ssaaFramesCnt<this.jitterVectors.length+11&&this.ssaaFramesCnt>this.jitterVectors.length;if(b||h||this.generatingSSAA)this.firstNoRender=!1;else if(!this.firstNoRender&&!this.ssaaOnStop)this.firstNoRender=!0;else if(!this.scene.needsUpdate&&!m)return this.ignoreNextScalingTime=!0,this.lastFrameDrawn=!1;this.lastFrameDrawn=!0;this.useGlobalFramebuffer=this.forceGlobalFramebuffer||this.currentScaling!==this.maxScaling||this.ssaaOnStop&&this.ssaaEnabled||
!!this.settings.screenSpaceRefractDistance;this.renderingData.alignDither=this.forceAlignDither||!(this.ssaaEnabled&&0<this.ssaaFramesCnt);this.renderingData.alignDitherOpcityFactor=!this.forceAlignDither&&0>=this.ssaaFramesCnt?this.alignDitherOpcityFactor:0;this.renderingData.ditherOffset=0;if(!m){if(!(this.multisamplingTested||!this.gl.webgl2||10>this.framesCnt||this.settings.hdOnStop&&this.currentScaling===this.maxScaling)&&(this.multiSamplingAccumulatedTime.time+=this.deltaT,this.multiSamplingAccumulatedTime.times.push(this.deltaT),
3E3<this.multiSamplingAccumulatedTime.time))if(this.multisamplingTested=!0,m=this.multiSamplingAccumulatedTime.times.sort(),m=m.slice(.05*m.length,.95*m.length),m.length){for(e=h=0;e<m.length;++e)h+=m[e];h/=m.length;8>1E3/h&&(this.multisampling=!1,this.antialiasing=!0,Db.call(this,!0))}else this.multisampling=!1,this.antialiasing=!0,Db.call(this,!0);this.useGlobalFramebuffer&&(this.gl.viewportWidth=this.renderingWidth,this.gl.viewportHeight=this.renderingHeight,this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,
this.globalFramebuffer.framebuffer));switch(this.renderingMode){case stage.emersya.viewer.RENDERING_MODES.CLASSIC:this.gl.disable(this.gl.BLEND);this.gl.viewport(0,0,this.gl.viewportWidth,this.gl.viewportHeight);this.gl.scissor(0,0,this.gl.viewportWidth,this.gl.viewportHeight);this.gl.enable(this.gl.SCISSOR_TEST);this.gl.enable(this.gl.DEPTH_TEST);this.depthPrePass=!1;qb.call(this);this.useGlobalFramebuffer?$b.call(this,this.globalFramebuffer.framebuffer):$b.call(this);this.gl.disable(this.gl.BLEND);
this.gl.disable(this.gl.SCISSOR_TEST);break;case stage.emersya.viewer.RENDERING_MODES.FULL_WIREFRAME:this.gl.disable(this.gl.BLEND);this.gl.viewport(0,0,this.gl.viewportWidth,this.gl.viewportHeight);this.gl.scissor(0,0,this.gl.viewportWidth,this.gl.viewportHeight);this.gl.enable(this.gl.SCISSOR_TEST);this.gl.clearColor(this.clearColor.r,this.clearColor.g,this.clearColor.b,this.clearColor.a);this.gl.stencilMask(255);this.gl.clearStencil(0);this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT|
this.gl.STENCIL_BUFFER_BIT);this.backgroundTexture&&Jb.call(this);this.shaders.useOneColorShader(this.renderingData,!0);this.gl.uniform4f(this.renderingData.locations.srrtdcb,this.settings.wireColor[0],this.settings.wireColor[1],this.settings.wireColor[2],this.settings.wireColor[3]);this.gl.uniform1i(this.renderingData.locations.rfausvd,1);for(var p=0;p<this.scene.polylistInstances.length;++p)this.meshes.renderForWireFrame(this.renderingData,this.scene.polylistInstances[p]);this.gl.disable(this.gl.BLEND);
this.gl.disable(this.gl.SCISSOR_TEST);break;case stage.emersya.viewer.RENDERING_MODES.SHARP_EDGES:this.gl.disable(this.gl.BLEND);this.gl.viewport(0,0,this.gl.viewportWidth,this.gl.viewportHeight);this.gl.scissor(0,0,this.gl.viewportWidth,this.gl.viewportHeight);this.gl.enable(this.gl.SCISSOR_TEST);this.gl.clearColor(this.clearColor.r,this.clearColor.g,this.clearColor.b,this.clearColor.a);this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT|this.gl.STENCIL_BUFFER_BIT);this.backgroundTexture&&
Jb.call(this);this.shaders.useOneColorShader(this.renderingData,!0);this.gl.uniform4f(this.renderingData.locations.srrtdcb,this.settings.flatColor[0],this.settings.flatColor[1],this.settings.flatColor[2],this.settings.flatColor[3]);this.gl.uniform1i(this.renderingData.locations.rfausvd,1);this.gl.enable(this.gl.POLYGON_OFFSET_FILL);this.renderingData.currentPolygonOffsetFactor=0;this.renderingData.currentPolygonOffsetUnits=0;for(p in this.scene.polylists)this.renderingData.currentPolygonOffsetFactor=
Math.min(this.scene.polylists[p].polygonOffsetFactor,this.renderingData.currentPolygonOffsetFactor),this.renderingData.currentPolygonOffsetUnits=Math.min(this.scene.polylists[p].polygonOffsetUnits,this.renderingData.currentPolygonOffsetUnits);this.renderingData.currentPolygonOffsetFactor=-this.renderingData.currentPolygonOffsetFactor;this.renderingData.currentPolygonOffsetUnits=-this.renderingData.currentPolygonOffsetUnits;this.renderingData.currentPolygonOffsetUnits+=5;this.renderingData.currentPolygonOffsetFactor+=
5;this.renderingData.clearTextures();this.gl.disable(this.gl.CULL_FACE);for(p=0;p<this.scene.polylistInstances.length;++p){var g=this.scene.polylistInstances[p];g.isHidden()||this.meshes.renderFlat(this.renderingData,g)}this.renderingData.currentPolygonOffsetUnits=0;this.renderingData.currentPolygonOffsetFactor=0;this.gl.disable(this.gl.POLYGON_OFFSET_FILL);this.gl.uniform4f(this.renderingData.locations.srrtdcb,this.settings.wireColor[0],this.settings.wireColor[1],this.settings.wireColor[2],this.settings.wireColor[3]);
this.gl.disable(this.gl.CULL_FACE);this.gl.lineWidth(1);for(p=0;p<this.scene.polylistInstances.length;++p)g=this.scene.polylistInstances[p],g.isHidden()||this.meshes.renderSharpEdges(this.renderingData,g);gd.call(this);this.useGlobalFramebuffer&&this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.globalFramebuffer.framebuffer);td.call(this);break;case stage.emersya.viewer.RENDERING_MODES.GOOCH:this.gl.disable(this.gl.BLEND);this.gl.viewport(0,0,this.gl.viewportWidth,this.gl.viewportHeight);this.gl.scissor(0,
0,this.gl.viewportWidth,this.gl.viewportHeight);this.gl.enable(this.gl.SCISSOR_TEST);this.gl.clearColor(this.clearColor.r,this.clearColor.g,this.clearColor.b,this.clearColor.a);this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT|this.gl.STENCIL_BUFFER_BIT);this.backgroundTexture&&Jb.call(this);this.shaders.useGoochShader(this.renderingData);ub.call(this);wb.call(this);this.gl.uniform3f(this.renderingData.locations.fmnjqmw,this.settings.goochWarmColor[0],this.settings.goochWarmColor[1],
this.settings.goochWarmColor[2]);this.gl.uniform3f(this.renderingData.locations.ohcexfk,this.settings.goochColdColor[0],this.settings.goochColdColor[1],this.settings.goochColdColor[2]);this.gl.uniform3f(this.renderingData.locations.xoxpkib,this.settings.goochDir[0],this.settings.goochDir[1],this.settings.goochDir[2]);this.renderingData.clearTextures();this.meshes.lastNodeDrawn=null;for(p=0;p<this.scene.polylistInstances.length;++p)g=this.scene.polylistInstances[p],g.isHidden()||this.meshes.renderGooch(this.renderingData,
g);break;case stage.emersya.viewer.RENDERING_MODES.FULLSPEC:this.gl.disable(this.gl.BLEND);this.gl.viewport(0,0,this.gl.viewportWidth,this.gl.viewportHeight);this.gl.scissor(0,0,this.gl.viewportWidth,this.gl.viewportHeight);this.gl.enable(this.gl.SCISSOR_TEST);this.gl.clearColor(this.clearColor.r,this.clearColor.g,this.clearColor.b,this.clearColor.a);this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT|this.gl.STENCIL_BUFFER_BIT);this.backgroundTexture&&Jb.call(this);this.scene.materialsType?
(this.shaders.useTypedShader(this.scene.fullSpecPbrMatAnim,this.renderingData),this.renderingData.locations.fvfyemf&&(p=this.renderingData.textureCount++,this.gl.uniform1i(this.renderingData.locations.fvfyemf,p),this.gl.activeTexture(this.gl.TEXTURE0+p),this.gl.bindTexture(this.gl.TEXTURE_2D,this.envDFGLUTTexture)),this.scene.fullSpecPbrMatAnim.loadToShader(this.gl,this.renderingData,this.scene.fullSpecPbrMatAnim.shaderType)):(this.shaders.useFullSpecShader(this.renderingData,this.scene),this.gl.uniform1f(this.renderingData.locations.fhguuoo,
1),this.gl.uniform4f(this.renderingData.locations.xcxkhty,.5,.5,.5,1),this.gl.uniform1f(this.renderingData.locations.yxuhtpf,0),this.gl.uniform4f(this.renderingData.locations.gmzubwt,0,0,0,1),this.gl.uniform1f(this.renderingData.locations.tqpeter,1),this.gl.uniform4f(this.renderingData.locations.rmbxdvn,1,1,1,1),this.gl.uniform1f(this.renderingData.locations.jwbntls,0),this.gl.uniform4f(this.renderingData.locations.nsnbysp,0,0,0,1),this.gl.uniform1f(this.renderingData.locations.fgjxdyy,100),this.gl.uniform1f(this.renderingData.locations.bzmstcf,
1),this.gl.uniform1i(this.renderingData.locations.ummxwav,0),this.gl.uniform1i(this.renderingData.locations.fhogvoz,0),this.gl.uniform1i(this.renderingData.locations.atutpxf,0),this.gl.uniform1i(this.renderingData.locations.uBlackAndWhite,0),this.gl.uniform1f(this.renderingData.locations.laicxpp,0),this.gl.uniform1f(this.renderingData.locations.mjjhnsa,1));ub.call(this);wb.call(this);this.gl.uniform3f(this.renderingData.locations.xzwunne,this.renderingData.cameraPosition[0],this.renderingData.cameraPosition[1],
this.renderingData.cameraPosition[2]);this.gl.uniform3f(this.renderingData.locations.fnmxbkg,this.renderingData.cameraTarget[0],this.renderingData.cameraTarget[1],this.renderingData.cameraTarget[2]);this.gl.uniformMatrix4fv(this.renderingData.locations.wqfoqbo,!1,this.renderingData.invViewMatrix);this.gl.uniform2f(this.renderingData.locations.qxxpdff,this.gl.viewportWidth,this.gl.viewportHeight);this.lightsManager.loadToShader(this.scene,!1);this.gl.uniform1f(this.renderingData.locations.laicxpp,
this.scene.tonemapping.multiplier);this.gl.uniform1f(this.renderingData.locations.mjjhnsa,this.scene.tonemapping.maxLuminance);this.lightsEditor&&this.lightsEditor.loadToShader(this.scene);this.meshes.lastNodeDrawn=null;for(p=0;p<this.scene.polylistInstances.length;++p)g=this.scene.polylistInstances[p],g.isHidden()||this.meshes.renderCustomMaterial(this.renderingData,g);break;case stage.emersya.viewer.RENDERING_MODES.FULLREFL:this.gl.disable(this.gl.BLEND);this.gl.viewport(0,0,this.gl.viewportWidth,
this.gl.viewportHeight);this.gl.scissor(0,0,this.gl.viewportWidth,this.gl.viewportHeight);this.gl.enable(this.gl.SCISSOR_TEST);this.gl.clearColor(this.clearColor.r,this.clearColor.g,this.clearColor.b,this.clearColor.a);this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT|this.gl.STENCIL_BUFFER_BIT);this.backgroundTexture&&Jb.call(this);this.scene.materialsType?(this.shaders.useTypedShader(this.scene.fullReflPbrMatAnim,this.renderingData),this.renderingData.locations.fvfyemf&&(p=this.renderingData.textureCount++,
this.gl.uniform1i(this.renderingData.locations.fvfyemf,p),this.gl.activeTexture(this.gl.TEXTURE0+p),this.gl.bindTexture(this.gl.TEXTURE_2D,this.envDFGLUTTexture)),this.scene.fullReflPbrMatAnim.loadToShader(this.gl,this.renderingData,this.scene.fullReflPbrMatAnim.shaderType)):(this.shaders.useFullReflShader(this.renderingData,this.scene),this.gl.uniform1f(this.renderingData.locations.fhguuoo,1),this.gl.uniform4f(this.renderingData.locations.xcxkhty,0,0,0,1),this.gl.uniform1f(this.renderingData.locations.yxuhtpf,
0),this.gl.uniform4f(this.renderingData.locations.gmzubwt,0,0,0,1),this.gl.uniform1f(this.renderingData.locations.tqpeter,1),this.gl.uniform4f(this.renderingData.locations.rmbxdvn,0,0,0,1),this.gl.uniform1f(this.renderingData.locations.jwbntls,0),this.gl.uniform4f(this.renderingData.locations.nsnbysp,0,0,0,1),this.gl.uniform1f(this.renderingData.locations.fgjxdyy,2),this.gl.uniform1f(this.renderingData.locations.bzmstcf,1),this.gl.uniform1f(this.renderingData.locations.kyuqpss,1),this.gl.uniform1i(this.renderingData.locations.qrcyyzq,
0),this.gl.uniform1i(this.renderingData.locations.ummxwav,0),this.gl.uniform1i(this.renderingData.locations.fhogvoz,0),this.gl.uniform1i(this.renderingData.locations.atutpxf,0),this.gl.uniform1i(this.renderingData.locations.uBlackAndWhite,0),this.gl.uniform1i(this.renderingData.locations.xplzpaf,this.fullReflTexture.loadToShader(this.renderingData)));ub.call(this);wb.call(this);this.gl.uniform3f(this.renderingData.locations.xzwunne,this.renderingData.cameraPosition[0],this.renderingData.cameraPosition[1],
this.renderingData.cameraPosition[2]);this.gl.uniform3f(this.renderingData.locations.fnmxbkg,this.renderingData.cameraTarget[0],this.renderingData.cameraTarget[1],this.renderingData.cameraTarget[2]);this.gl.uniformMatrix4fv(this.renderingData.locations.wqfoqbo,!1,this.renderingData.invViewMatrix);this.gl.uniform2f(this.renderingData.locations.qxxpdff,this.gl.viewportWidth,this.gl.viewportHeight);this.lightsManager.loadToShader(this.scene,!1);this.gl.uniform1f(this.renderingData.locations.laicxpp,
this.scene.tonemapping.multiplier);this.gl.uniform1f(this.renderingData.locations.mjjhnsa,this.scene.tonemapping.maxLuminance);this.lightsEditor&&this.lightsEditor.loadToShader(this.scene);this.meshes.lastNodeDrawn=null;for(p=0;p<this.scene.polylistInstances.length;++p)g=this.scene.polylistInstances[p],g.isHidden()||this.meshes.renderCustomMaterial(this.renderingData,g);break;case stage.emersya.viewer.RENDERING_MODES.UVS:case stage.emersya.viewer.RENDERING_MODES.UVS1:this.gl.disable(this.gl.BLEND);
this.gl.viewport(0,0,this.gl.viewportWidth,this.gl.viewportHeight);this.gl.scissor(0,0,this.gl.viewportWidth,this.gl.viewportHeight);this.gl.enable(this.gl.SCISSOR_TEST);this.gl.clearColor(this.clearColor.r,this.clearColor.g,this.clearColor.b,this.clearColor.a);this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT|this.gl.STENCIL_BUFFER_BIT);this.backgroundTexture&&Jb.call(this);this.gl.enable(this.gl.STENCIL_TEST);this.gl.stencilMask(255);this.gl.stencilFunc(this.gl.ALWAYS,1,255);this.gl.stencilOp(this.gl.REPLACE,
this.gl.REPLACE,this.gl.REPLACE);this.shaders.useUvGridShader(this.renderingData,this.scene);this.gl.uniform1f(this.renderingData.locations.fhguuoo,1);this.gl.uniform4f(this.renderingData.locations.xcxkhty,0,0,0,1);this.gl.uniform1f(this.renderingData.locations.yxuhtpf,0);this.gl.uniform4f(this.renderingData.locations.gmzubwt,0,0,0,1);this.gl.uniform1f(this.renderingData.locations.tqpeter,1);this.gl.uniform4f(this.renderingData.locations.rmbxdvn,0,0,0,1);this.gl.uniform1f(this.renderingData.locations.jwbntls,
1);this.gl.uniform4f(this.renderingData.locations.nsnbysp,0,0,0,1);this.gl.uniform1i(this.renderingData.locations.kvqnhvv,0);this.gl.uniform1f(this.renderingData.locations.fgjxdyy,2);this.gl.uniform1f(this.renderingData.locations.bzmstcf,1);this.gl.uniform1i(this.renderingData.locations.ummxwav,0);this.gl.uniform1i(this.renderingData.locations.fhogvoz,0);this.gl.uniform1i(this.renderingData.locations.atutpxf,0);this.gl.uniform1i(this.renderingData.locations.uBlackAndWhite,0);this.gl.uniform1f(this.renderingData.locations.laicxpp,
0);this.gl.uniform1f(this.renderingData.locations.mjjhnsa,1);this.gl.uniform1i(this.renderingData.locations.mgntrba,0);ub.call(this);wb.call(this);this.gl.uniform3f(this.renderingData.locations.xzwunne,this.renderingData.cameraPosition[0],this.renderingData.cameraPosition[1],this.renderingData.cameraPosition[2]);this.gl.uniform3f(this.renderingData.locations.fnmxbkg,this.renderingData.cameraTarget[0],this.renderingData.cameraTarget[1],this.renderingData.cameraTarget[2]);this.gl.uniformMatrix4fv(this.renderingData.locations.wqfoqbo,
!1,this.renderingData.invViewMatrix);this.gl.uniform2f(this.renderingData.locations.qxxpdff,this.gl.viewportWidth,this.gl.viewportHeight);this.lightsManager.loadToShader(this.scene,!1);this.gl.uniform1f(this.renderingData.locations.laicxpp,this.scene.tonemapping.multiplier);this.gl.uniform1f(this.renderingData.locations.mjjhnsa,this.scene.tonemapping.maxLuminance);this.lightsEditor&&this.lightsEditor.loadToShader(this.scene);this.gl.enable(this.gl.POLYGON_OFFSET_FILL);this.meshes.lastNodeDrawn=null;
for(p=0;p<this.scene.polylistInstances.length;++p)g=this.scene.polylistInstances[p],g.isHidden()||(this.renderingData.textureCount=0,this.gl.uniform1i(this.renderingData.locations.hbaqifu,this.uvsTexture.loadToShader(this.renderingData,null,this.renderingData.locations.fbqzibe,this.renderingData.locations.kvqnhvv)),this.meshes.renderCustomMaterial(this.renderingData,g));this.gl.disable(this.gl.POLYGON_OFFSET_FILL);break;case stage.emersya.viewer.RENDERING_MODES.POLYCOLOR:this.gl.disable(this.gl.BLEND);
this.gl.viewport(0,0,this.gl.viewportWidth,this.gl.viewportHeight);this.gl.scissor(0,0,this.gl.viewportWidth,this.gl.viewportHeight);this.gl.enable(this.gl.SCISSOR_TEST);this.gl.clearColor(this.clearColor.r,this.clearColor.g,this.clearColor.b,this.clearColor.a);this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT|this.gl.STENCIL_BUFFER_BIT);this.backgroundTexture&&Jb.call(this);this.shaders.useFullSpecShader(this.renderingData,this.scene);this.gl.uniform1f(this.renderingData.locations.fhguuoo,
1);this.gl.uniform4f(this.renderingData.locations.xcxkhty,.5,.5,.5,1);this.gl.uniform1f(this.renderingData.locations.yxuhtpf,.2);this.gl.uniform4f(this.renderingData.locations.gmzubwt,0,0,0,1);this.gl.uniform1f(this.renderingData.locations.tqpeter,.1);this.gl.uniform4f(this.renderingData.locations.rmbxdvn,1,1,1,1);this.gl.uniform1f(this.renderingData.locations.jwbntls,0);this.gl.uniform4f(this.renderingData.locations.nsnbysp,0,0,0,1);this.gl.uniform1f(this.renderingData.locations.fgjxdyy,10);this.gl.uniform1f(this.renderingData.locations.bzmstcf,
1);this.gl.uniform1i(this.renderingData.locations.ummxwav,0);this.gl.uniform1i(this.renderingData.locations.fhogvoz,0);this.gl.uniform1i(this.renderingData.locations.atutpxf,0);this.gl.uniform1i(this.renderingData.locations.uBlackAndWhite,0);this.gl.uniform1f(this.renderingData.locations.laicxpp,0);this.gl.uniform1f(this.renderingData.locations.mjjhnsa,1);ub.call(this);wb.call(this);this.gl.uniform3f(this.renderingData.locations.xzwunne,this.renderingData.cameraPosition[0],this.renderingData.cameraPosition[1],
this.renderingData.cameraPosition[2]);this.gl.uniform3f(this.renderingData.locations.fnmxbkg,this.renderingData.cameraTarget[0],this.renderingData.cameraTarget[1],this.renderingData.cameraTarget[2]);this.gl.uniformMatrix4fv(this.renderingData.locations.wqfoqbo,!1,this.renderingData.invViewMatrix);this.gl.uniform2f(this.renderingData.locations.qxxpdff,this.gl.viewportWidth,this.gl.viewportHeight);this.lightsManager.loadToShader(this.scene,!1);this.gl.uniform1f(this.renderingData.locations.laicxpp,
this.scene.tonemapping.multiplier);this.gl.uniform1f(this.renderingData.locations.mjjhnsa,this.scene.tonemapping.maxLuminance);this.lightsEditor&&this.lightsEditor.loadToShader(this.scene);this.meshes.lastNodeDrawn=null;for(p=0;p<this.scene.polylistInstances.length;++p)g=this.scene.polylistInstances[p],g.isHidden()||this.meshes.renderPolyColor(this.renderingData,g);break;case stage.emersya.viewer.RENDERING_MODES.MATSCOLOR:this.gl.disable(this.gl.BLEND);this.gl.viewport(0,0,this.gl.viewportWidth,this.gl.viewportHeight);
this.gl.scissor(0,0,this.gl.viewportWidth,this.gl.viewportHeight);this.gl.enable(this.gl.SCISSOR_TEST);this.gl.clearColor(this.clearColor.r,this.clearColor.g,this.clearColor.b,this.clearColor.a);this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT|this.gl.STENCIL_BUFFER_BIT);this.backgroundTexture&&Jb.call(this);this.shaders.useFullSpecShader(this.renderingData,this.scene);this.gl.uniform1f(this.renderingData.locations.fhguuoo,1);this.gl.uniform4f(this.renderingData.locations.xcxkhty,.5,
.5,.5,1);this.gl.uniform1f(this.renderingData.locations.yxuhtpf,.2);this.gl.uniform4f(this.renderingData.locations.gmzubwt,0,0,0,1);this.gl.uniform1f(this.renderingData.locations.tqpeter,.1);this.gl.uniform4f(this.renderingData.locations.rmbxdvn,1,1,1,1);this.gl.uniform1f(this.renderingData.locations.jwbntls,0);this.gl.uniform4f(this.renderingData.locations.nsnbysp,0,0,0,1);this.gl.uniform1f(this.renderingData.locations.fgjxdyy,10);this.gl.uniform1f(this.renderingData.locations.bzmstcf,1);this.gl.uniform1i(this.renderingData.locations.ummxwav,
0);this.gl.uniform1i(this.renderingData.locations.fhogvoz,0);this.gl.uniform1i(this.renderingData.locations.atutpxf,0);this.gl.uniform1i(this.renderingData.locations.uBlackAndWhite,0);this.gl.uniform1f(this.renderingData.locations.laicxpp,0);this.gl.uniform1f(this.renderingData.locations.mjjhnsa,1);ub.call(this);wb.call(this);this.gl.uniform3f(this.renderingData.locations.xzwunne,this.renderingData.cameraPosition[0],this.renderingData.cameraPosition[1],this.renderingData.cameraPosition[2]);this.gl.uniform3f(this.renderingData.locations.fnmxbkg,
this.renderingData.cameraTarget[0],this.renderingData.cameraTarget[1],this.renderingData.cameraTarget[2]);this.gl.uniformMatrix4fv(this.renderingData.locations.wqfoqbo,!1,this.renderingData.invViewMatrix);this.gl.uniform2f(this.renderingData.locations.qxxpdff,this.gl.viewportWidth,this.gl.viewportHeight);this.lightsManager.loadToShader(this.scene,!1);this.gl.uniform1f(this.renderingData.locations.laicxpp,this.scene.tonemapping.multiplier);this.gl.uniform1f(this.renderingData.locations.mjjhnsa,this.scene.tonemapping.maxLuminance);
this.lightsEditor&&this.lightsEditor.loadToShader(this.scene);this.meshes.lastNodeDrawn=null;for(p=0;p<this.scene.polylistInstances.length;++p)g=this.scene.polylistInstances[p],g.isHidden()||this.meshes.renderMatsColor(this.renderingData,g,this.scene);break;case stage.emersya.viewer.RENDERING_MODES.SEMI_WIREFRAME:case stage.emersya.viewer.RENDERING_MODES.TEXTURED_SEMI_WIREFRAME:this.gl.disable(this.gl.BLEND);this.gl.viewport(0,0,this.gl.viewportWidth,this.gl.viewportHeight);this.gl.scissor(0,0,this.gl.viewportWidth,
this.gl.viewportHeight);this.gl.enable(this.gl.SCISSOR_TEST);this.gl.clearColor(.168,.184,.219,1);this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT);this.backgroundTexture&&Jb.call(this);this.renderingData.currentPolygonOffsetFactor=0;this.renderingData.currentPolygonOffsetUnits=0;for(g in this.scene.polylists)this.renderingData.currentPolygonOffsetFactor=Math.min(this.scene.polylists[g].polygonOffsetFactor,this.renderingData.currentPolygonOffsetFactor),this.renderingData.currentPolygonOffsetUnits=
Math.min(this.scene.polylists[g].polygonOffsetUnits,this.renderingData.currentPolygonOffsetUnits);this.renderingData.currentPolygonOffsetFactor=-this.renderingData.currentPolygonOffsetFactor;this.renderingData.currentPolygonOffsetUnits=-this.renderingData.currentPolygonOffsetUnits;this.renderingMode==stage.emersya.viewer.RENDERING_MODES.TEXTURED_SEMI_WIREFRAME&&(this.renderingData.currentPolygonOffsetFactor+=4,this.renderingData.currentPolygonOffsetUnits+=4,qb.call(this),this.renderingData.currentPolygonOffsetFactor-=
4,this.renderingData.currentPolygonOffsetUnits-=4);this.shaders.useMeshEditingShader(this.renderingData,this.scene);this.renderingData.clearTextures();ub.call(this);wb.call(this);this.renderingMode==stage.emersya.viewer.RENDERING_MODES.TEXTURED_SEMI_WIREFRAME?(this.gl.uniform4f(this.renderingData.locations.piheppa,0,0,0,0),this.gl.uniform4f(this.renderingData.locations.yvowcig,.14,.26,.29,.5)):(this.gl.uniform4f(this.renderingData.locations.piheppa,.12,.13,.15,1),this.gl.uniform4f(this.renderingData.locations.yvowcig,
.14,.26,.29,1));this.gl.uniform4f(this.renderingData.locations.fzhivaz,.47,.5,.53,1);this.gl.uniform4f(this.renderingData.locations.jdfdddr,0,.69,.67,1);this.meshEditor.render(this.renderingMode==stage.emersya.viewer.RENDERING_MODES.TEXTURED_SEMI_WIREFRAME);this.renderingData.currentPolygonOffsetFactor=0;this.renderingData.currentPolygonOffsetUnits=0;this.shaders.useOneColorShader(this.renderingData,!0);this.gl.uniform1i(this.renderingData.locations.rfausvd,0);this.meshEditor.renderTransformationTool(this.currentTransformationTool,
this.currentCamera);break;default:console.log("default",this.renderingMode)}this.gl.viewport(0,0,this.gl.viewportWidth,this.gl.viewportHeight);this.gl.scissor(0,0,this.gl.viewportWidth,this.gl.viewportHeight);this.gl.enable(this.gl.BLEND);this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA);if(this.settings.renderGrid)for(this.shaders.useOneColorShader(this.renderingData,!0),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.gridVBuffer),this.gl.vertexAttribPointer(this.renderingData.locations.ymaxekn,
3,this.gl.FLOAT,!1,0,0),this.gl.lineWidth(2),p=mat4.create(),mat4.identity(p),this.gl.uniformMatrix4fv(this.renderingData.locations.ondssmn,!1,p),this.gl.uniformMatrix4fv(this.renderingData.locations.ampnorz,!1,this.renderingData.viewMatrix),this.gl.uniformMatrix4fv(this.renderingData.locations.ghgsnpw,!1,this.renderingData.projectionMatrix),this.gl.uniform1i(this.renderingData.locations.rfausvd,1),this.gl.uniform4f(this.renderingData.locations.srrtdcb,this.settings.gridColor[0],this.settings.gridColor[1],
this.settings.gridColor[2],this.settings.gridColor[3]),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.gridIBuffer),this.gl.drawElements(this.gl.LINES,4*(this.settings.gridCasesCount+1),this.gl.UNSIGNED_SHORT,0),this.gl.lineWidth(1),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.gridVBufferP),this.gl.vertexAttribPointer(this.renderingData.locations.ymaxekn,3,this.gl.FLOAT,!1,0,0),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.gridIBufferP),g=this.settings.gridTotalSize/2,m=this.settings.gridTotalSize/
this.settings.gridCasesCount,h=0;h<this.settings.gridCasesCount;++h)for(e=0;e<this.settings.gridCasesCount;++e)d=vec3.create([0,0,0]),d[0]=-g+m/2+h*m,d[2]=-g+m/2+e*m,mat4.identity(p),mat4.translate(p,d),this.gl.uniformMatrix4fv(this.renderingData.locations.ondssmn,!1,p),this.gl.drawElements(this.gl.LINES,4*(this.settings.gridSubCasesCount-1),this.gl.UNSIGNED_SHORT,0);this.settings.renderAxes&&((this.settings.axesAlwaysVisible||this.axesAlwaysVisible)&&this.gl.disable(this.gl.DEPTH_TEST),this.shaders.useOneColorShader(this.renderingData),
this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.axesVBuffer),this.gl.vertexAttribPointer(this.renderingData.locations.ymaxekn,3,this.gl.FLOAT,!1,0,0),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.axesCBuffer),this.gl.vertexAttribPointer(this.renderingData.locations.qhsvewr,3,this.gl.FLOAT,!1,0,0),this.drawAxesBottomLeft?(p=mat4.create(),mat4.identity(p),mat4.translate(p,this.lastCameraTarget),g=vec3.create(),g[0]=-3*this.drawAxesBottomLeft/4,g[1]=-3*this.drawAxesBottomLeft/4,g[2]=-3*this.drawAxesBottomLeft/
4,mat4.translate(p,g),mat4.scale(p,[this.drawAxesBottomLeft,this.drawAxesBottomLeft,this.drawAxesBottomLeft]),mat4.scale(p,[.3,.3,.3]),this.gl.lineWidth(5)):(this.gl.lineWidth(2),p=mat4.create(),mat4.identity(p),mat4.scale(p,[this.settings.axesLength,this.settings.axesLength,this.settings.axesLength])),this.gl.uniformMatrix4fv(this.renderingData.locations.ondssmn,!1,p),this.gl.uniform1i(this.renderingData.locations.rfausvd,0),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.axesIBuffer),this.gl.drawElements(this.gl.LINES,
6,this.gl.UNSIGNED_SHORT,0),(this.settings.axesAlwaysVisible||this.axesAlwaysVisible)&&this.gl.enable(this.gl.DEPTH_TEST));if(this.settings.renderBoundingBoxes)for(this.shaders.useOneColorShader(this.renderingData,!0),this.gl.lineWidth(1),p=0;p<this.scene.nodesInUse.length;++p)this.meshes.renderNodeBoundingBox(this.renderingData,this.scene.nodesInUse[p]);this.settings.renderLights&&this.renderingData.viewMatrix&&this.renderingData.invViewMatrix&&(this.lightsEditor.renderLights(this.scene,this.renderingData.viewMatrix,
!1,this.renderingData.invViewMatrix),this.lightsEditor.renderLights(this.scene,this.renderingData.viewMatrix,this.settings.renderShadows,this.renderingData.invViewMatrix));this.settings.renderConnectors&&this.modularEditor.render();if(!this.settings.renderBoundingBoxes)for(this.shaders.useOneColorShader(this.renderingData,!0),this.gl.lineWidth(1),p=0;p<this.scene.nodesInUse.length;++p)this.scene.nodesInUse[p].renderBoundingBox&&this.meshes.renderNodeBoundingBox(this.renderingData,this.scene.nodesInUse[p]);
!this.renderSelectionSquare||1>Math.abs(this.squarePos1.x-this.squarePos2.x)||1>Math.abs(this.squarePos1.y-this.squarePos2.y)||(this.shaders.useOneColorShader(this.renderingData),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.squareVBuffer),this.gl.vertexAttribPointer(this.renderingData.locations.ymaxekn,3,this.gl.FLOAT,!1,0,0),this.gl.lineWidth(2),p=mat4.create(),mat4.identity(p),this.gl.disable(this.gl.DEPTH_TEST),g=2*Math.abs(this.squarePos1.x-this.squarePos2.x)/this.gl.viewportWidth,m=2*Math.abs(this.squarePos1.y-
this.squarePos2.y)/this.gl.viewportHeight,mat4.translate(p,[2*(Math.min(this.squarePos1.x,this.squarePos2.x)-this.gl.viewportWidth/2)/this.gl.viewportWidth,2*-(Math.min(this.squarePos1.y,this.squarePos2.y)-this.gl.viewportHeight/2)/this.gl.viewportHeight,0]),mat4.scale(p,[g,m,1]),this.gl.uniformMatrix4fv(this.renderingData.locations.ondssmn,!1,p),this.gl.uniformMatrix4fv(this.renderingData.locations.ampnorz,!1,this.screenViewMatrix),this.gl.uniformMatrix4fv(this.renderingData.locations.ghgsnpw,!1,
this.screenTransfMatrix),this.gl.uniform1i(this.renderingData.locations.rfausvd,1),this.gl.uniform4f(this.renderingData.locations.srrtdcb,this.settings.squareColor[0],this.settings.squareColor[1],this.settings.squareColor[2],this.settings.squareColor[3]),this.gl.enable(this.gl.BLEND),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.squareIBuffer),this.gl.drawElements(this.gl.LINES,8,this.gl.UNSIGNED_SHORT,0),this.gl.disable(this.gl.BLEND),this.gl.enable(this.gl.DEPTH_TEST));if(this.settings.renderAxesOnSelectedNodes){this.gl.disable(this.gl.DEPTH_TEST);
this.shaders.useOneColorShader(this.renderingData);this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.axesVBuffer);this.gl.vertexAttribPointer(this.renderingData.locations.ymaxekn,3,this.gl.FLOAT,!1,0,0);this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.axesCBuffer);this.gl.vertexAttribPointer(this.renderingData.locations.qhsvewr,3,this.gl.FLOAT,!1,0,0);this.gl.lineWidth(2);p=mat4.create();mat4.identity(p);mat4.scale(p,[10,10,10]);this.gl.uniform1i(this.renderingData.locations.rfausvd,0);this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,
this.axesIBuffer);g=mat4.create();for(var n in this.scene.nodesInUse)m=this.scene.nodesInUse[n],m.selected&&(mat4.multiply(m.modelMatrix,p,g),this.gl.uniformMatrix4fv(this.renderingData.locations.ondssmn,!1,g),this.gl.drawElements(this.gl.LINES,6,this.gl.UNSIGNED_SHORT,0));this.gl.enable(this.gl.DEPTH_TEST)}Sd.call(this)}this.settings.graininess&&b&&(this.noiseRandomSeeds=[Math.random(),Math.random()]);if(this.useGlobalFramebuffer)if(n=0,this.renderingMode!=stage.emersya.viewer.RENDERING_MODES.CLASSIC||
!this.settings.graininess||this.settings.grainOnStop&&b||(n=this.settings.graininess),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this.gl.viewportWidth=this.canvas.width,this.gl.viewportHeight=this.canvas.height,Ac.call(this),this.gl.viewport(0,0,this.gl.viewportWidth,this.gl.viewportHeight),this.gl.scissor(0,0,this.gl.viewportWidth,this.gl.viewportHeight),this.ssaaEnabled){if(0==this.ssaaFramesCnt)1!=this.ssaaRenderMode?(this.globalFramebuffer.multisampled?(this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,
this.globalFramebuffer.framebufferForTexture),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,this.globalFramebuffer.preSsaaTexture,0),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.globalFramebuffer.framebuffer)):(this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.globalFramebuffer.framebuffer),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,this.globalFramebuffer.preSsaaTexture,0)),this.gl.clearColor(0,0,
0,0),this.gl.clear(this.gl.COLOR_BUFFER_BIT),Xa.call(this,this.globalFramebuffer.globalTexture,1,!this.globalFramebuffer.multisampled&&this.settings.hdOnStop&&this.antialiasing,!0,this.globalFramebuffer.framebuffer,n),ld.call(this),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),Ac.call(this,!0),this.displayPreSsaaTexture&&(this.gl.clearColor(0,0,0,0),this.gl.clear(this.gl.COLOR_BUFFER_BIT),Xa.call(this,this.globalFramebuffer.preSsaaTexture,1,!1,!1,void 0,n))):(this.globalFramebuffer.multisampled?
(this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.globalFramebuffer.framebufferForTexture),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,this.globalFramebuffer.preSsaaTexture,0),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.globalFramebuffer.framebuffer)):(this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.globalFramebuffer.framebuffer),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,this.globalFramebuffer.preSsaaTexture,
0)),this.gl.clearColor(0,0,0,0),this.gl.clear(this.gl.COLOR_BUFFER_BIT),Xa.call(this,this.globalFramebuffer.globalTexture,1,!this.globalFramebuffer.multisampled&&this.settings.hdOnStop&&this.antialiasing,!0,this.globalFramebuffer.framebuffer,n),ld.call(this),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),Ac.call(this));else if(this.ssaaUniformCenteredDistribution)switch(this.ssaaFramesCnt<=this.jitterVectors.length&&(this.globalFramebuffer.multisampled?(this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,
this.globalFramebuffer.framebufferForTexture),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,this.globalFramebuffer.previousGlobalTexture,0),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.globalFramebuffer.framebuffer),this.gl.framebufferRenderbuffer(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.RENDERBUFFER,this.globalFramebuffer.previousColorRenderbuffer)):(this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.globalFramebuffer.framebuffer),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,
this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,this.globalFramebuffer.previousGlobalTexture,0)),1==this.ssaaFramesCnt&&(this.gl.clearColor(0,0,0,0),this.gl.clear(this.gl.COLOR_BUFFER_BIT)),Xa.call(this,this.globalFramebuffer.globalTexture,this.sampleWeights[this.ssaaFramesCnt-1],!1,!1,n),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),Ac.call(this)),this.ssaaRenderMode){case 0:this.gl.clearColor(0,0,0,0);this.gl.clear(this.gl.COLOR_BUFFER_BIT);Xa.call(this,this.globalFramebuffer.previousGlobalTexture,
1,!1,!1,void 0,n);this.ssaaFramesCnt<=this.jitterVectors.length&&Xa.call(this,this.globalFramebuffer.preSsaaTexture,1-this.accumulatedSampleWeights[this.ssaaFramesCnt-1],!1,!1,void 0,n);ld.call(this);break;case 1:this.ssaaFramesCnt>=this.jitterVectors.length&&(this.gl.clearColor(0,0,0,0),this.gl.clear(this.gl.COLOR_BUFFER_BIT),Xa.call(this,this.globalFramebuffer.previousGlobalTexture,1,!1,!1,void 0,n),ld.call(this));break;case 2:this.gl.clearColor(0,0,0,0),this.gl.clear(this.gl.COLOR_BUFFER_BIT),
this.ssaaFramesCnt<this.jitterVectors.length?Xa.call(this,this.globalFramebuffer.preSsaaTexture,1,!1,!1,void 0,n):(b=(this.ssaaFramesCnt-this.jitterVectors.length)/10,Xa.call(this,this.globalFramebuffer.preSsaaTexture,1-b,!1,!1,void 0,n),Xa.call(this,this.globalFramebuffer.previousGlobalTexture,b,!1,!1,void 0,n)),ld.call(this)}else{this.globalFramebuffer.multisampled?(this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.globalFramebuffer.framebufferForTexture),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,
this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,this.globalFramebuffer.secondPreviousGlobalTexture,0),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.globalFramebuffer.framebuffer),this.gl.framebufferRenderbuffer(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.RENDERBUFFER,this.globalFramebuffer.previousColorRenderbuffer)):(this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.globalFramebuffer.framebuffer),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,
this.globalFramebuffer.secondPreviousGlobalTexture,0));this.gl.clearColor(0,0,0,0);this.gl.clear(this.gl.COLOR_BUFFER_BIT);1<this.ssaaFramesCnt&&Xa.call(this,this.globalFramebuffer.previousGlobalTexture,(this.ssaaFramesCnt-1)/this.ssaaFramesCnt,!1,!1,void 0,n);Xa.call(this,this.globalFramebuffer.globalTexture,1/this.ssaaFramesCnt,!1,!1,void 0,n);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null);Ac.call(this);this.gl.clearColor(0,0,0,0);this.gl.clear(this.gl.COLOR_BUFFER_BIT);switch(this.ssaaRenderMode){case 0:Xa.call(this,
this.globalFramebuffer.secondPreviousGlobalTexture,this.ssaaFramesCnt/this.jitterVectors.length,!1,!1,void 0,n);Xa.call(this,this.globalFramebuffer.preSsaaTexture,(this.jitterVectors.length-this.ssaaFramesCnt)/this.jitterVectors.length,!1,!1,void 0,n);n=this.globalFramebuffer.previousGlobalTexture;this.globalFramebuffer.previousGlobalTexture=this.globalFramebuffer.secondPreviousGlobalTexture;this.globalFramebuffer.secondPreviousGlobalTexture=n;break;case 1:this.ssaaFramesCnt==this.jitterVectors.length?
(Xa.call(this,this.globalFramebuffer.secondPreviousGlobalTexture,this.ssaaFramesCnt/this.jitterVectors.length,!1,!1,void 0,n),Xa.call(this,this.globalFramebuffer.preSsaaTexture,(this.jitterVectors.length-this.ssaaFramesCnt)/this.jitterVectors.length,!1,!1,void 0,n),n=this.globalFramebuffer.previousGlobalTexture,this.globalFramebuffer.previousGlobalTexture=this.globalFramebuffer.secondPreviousGlobalTexture,this.globalFramebuffer.secondPreviousGlobalTexture=n):Xa.call(this,this.globalFramebuffer.preSsaaTexture,
1,!1,!1,void 0,n);break;case 2:this.ssaaFramesCnt<=this.jitterVectors.length?Xa.call(this,this.globalFramebuffer.preSsaaTexture,1,!1,!1,void 0,n):(b=(this.ssaaFramesCnt-this.jitterVectors.length)/10,Xa.call(this,this.globalFramebuffer.preSsaaTexture,1-b,!1,!1,void 0,n),Xa.call(this,this.globalFramebuffer.secondPreviousGlobalTexture,b,!1,!1,void 0,n))}ld.call(this)}this.globalFramebuffer.multisampled?(this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.globalFramebuffer.framebuffer),this.gl.framebufferRenderbuffer(this.gl.FRAMEBUFFER,
this.gl.COLOR_ATTACHMENT0,this.gl.RENDERBUFFER,this.globalFramebuffer.colorRenderbuffer),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.globalFramebuffer.framebufferForTexture)):this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.globalFramebuffer.framebuffer);this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,this.globalFramebuffer.globalTexture,0);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null)}else this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this.gl.clearColor(0,
0,0,0),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.forceSynchronousFramebuffers&&(this.gl.flush(),this.gl.finish()),Xa.call(this,this.globalFramebuffer.globalTexture,1,!this.globalFramebuffer.multisampled&&this.antialiasing,!1,void 0,n),ld.call(this);else this.renderingMode!=stage.emersya.viewer.RENDERING_MODES.CLASSIC||!this.settings.graininess||this.settings.grainOnStop&&b||(this.gl.bindTexture(this.gl.TEXTURE_2D,this.noiseTexture),this.gl.copyTexImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,0,0,this.gl.viewportWidth,
this.gl.viewportHeight,0),this.gl.bindTexture(this.gl.TEXTURE_2D,null),n=this.noiseTexture,this.shaders.useNoiseShader(this.renderingData),this.gl.disable(this.gl.DEPTH_TEST),this.gl.depthMask(!1),this.gl.uniformMatrix4fv(this.renderingData.locations.ampnorz,!1,this.screenViewMatrix),this.gl.uniformMatrix4fv(this.renderingData.locations.ghgsnpw,!1,this.screenTransfMatrix),this.gl.uniform2f(this.renderingData.locations.qxxpdff,this.gl.viewportWidth,this.gl.viewportHeight),this.gl.uniform2fv(this.renderingData.locations.yjwzvyh,
this.noiseRandomSeeds),this.gl.uniform1f(this.renderingData.locations.zvecpmg,this.settings.graininess),this.gl.uniform1i(this.renderingData.locations.wwvyjhq,0),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,n),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexBufferScreen),this.gl.vertexAttribPointer(this.renderingData.locations.ymaxekn,3,this.gl.FLOAT,!1,0,0),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.elementsBufferScreen),this.gl.drawElements(this.gl.TRIANGLES,
6,this.gl.UNSIGNED_SHORT,0),this.gl.depthMask(!0),this.gl.enable(this.gl.DEPTH_TEST),this.gl.disable(this.gl.BLEND),this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA)),ld.call(this);this.settings.renderFramerate&&(1===this.ssaaRenderMode?!this.ssaaEnabled:1)?this.framerateDomElem.innerHTML=this.framerateText:this.hackSync&&(this.hackSync.context.clearRect(0,0,1,1),this.gl.bindTexture(this.gl.TEXTURE_2D,this.hackSync.texture),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,
this.gl.UNSIGNED_BYTE,this.hackSync.context.canvas),this.gl.bindTexture(this.gl.TEXTURE_2D,null));this.resized=!1;this.scene.needsUpdate=Math.max(this.scene.needsUpdate-1,0);this.init=this.scene.visibilityChanged=!1;this.gl.flush();return!0};var Xa=function(b,d,e,f,h,m){e&&(this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.globalFramebuffer.fxaaFramebuffer),this.shaders.useAntialiasingShader(this.renderingData),this.gl.viewport(0,0,this.globalFramebuffer.width,this.globalFramebuffer.height),this.gl.scissor(0,
0,this.renderingWidth,this.renderingHeight),this.gl.enable(this.gl.SCISSOR_TEST),this.gl.clearColor(0,0,0,0),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.gl.enable(this.gl.BLEND),this.gl.blendFunc(this.gl.ONE,this.gl.ONE),this.gl.disable(this.gl.DEPTH_TEST),this.gl.depthMask(!1),this.gl.uniformMatrix4fv(this.renderingData.locations.ampnorz,!1,this.screenViewMatrix),this.gl.uniformMatrix4fv(this.renderingData.locations.ghgsnpw,!1,this.screenTransfMatrix),this.gl.uniform1f(this.renderingData.locations.mnxuvqf,
1),this.gl.uniform2f(this.renderingData.locations.mbfivoq,this.renderingWidth/this.globalFramebuffer.width,this.renderingHeight/this.globalFramebuffer.height),this.gl.uniform2f(this.renderingData.locations.qxxpdff,this.globalFramebuffer.width,this.globalFramebuffer.height),f?this.gl.uniform2f(this.renderingData.locations.wkmsbqd,0,0):this.gl.uniform2f(this.renderingData.locations.wkmsbqd,.5*this.currentJitteringVector[0]/(8*this.globalFramebuffer.width),.5*this.currentJitteringVector[1]/(8*this.globalFramebuffer.height)),
this.gl.uniform1i(this.renderingData.locations.dkgckvl,0),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,b),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexBufferScreen),this.gl.vertexAttribPointer(this.renderingData.locations.ymaxekn,3,this.gl.FLOAT,!1,0,0),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.elementsBufferScreen),this.gl.drawElements(this.gl.TRIANGLES,6,this.gl.UNSIGNED_SHORT,0),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this.gl.viewport(0,
0,this.gl.viewportWidth,this.gl.viewportHeight),this.gl.scissor(0,0,this.gl.viewportWidth,this.gl.viewportHeight),b=this.globalFramebuffer.fxaaTexture,this.forceSynchronousFramebuffers&&(this.gl.flush(),this.gl.finish()),h&&this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,h));this.shaders.useScreenTextureShader(this.renderingData);this.gl.enable(this.gl.BLEND);this.gl.blendFunc(this.gl.ONE,this.gl.ONE);this.gl.disable(this.gl.DEPTH_TEST);this.gl.depthMask(!1);this.gl.uniformMatrix4fv(this.renderingData.locations.ampnorz,
!1,this.screenViewMatrix);this.gl.uniformMatrix4fv(this.renderingData.locations.ghgsnpw,!1,this.screenTransfMatrix);this.gl.uniform1f(this.renderingData.locations.mnxuvqf,d);this.gl.uniform1f(this.renderingData.locations.tfrqoeu,1);this.gl.uniform2f(this.renderingData.locations.wclpegx,this.renderingWidth/this.globalFramebuffer.width,this.renderingHeight/this.globalFramebuffer.height);this.gl.uniform2f(this.renderingData.locations.qxxpdff,this.renderingWidth,this.renderingHeight);this.gl.uniform2f(this.renderingData.locations.ngzaxyh,
this.globalFramebuffer.width,this.globalFramebuffer.height);this.gl.uniform2fv(this.renderingData.locations.yjwzvyh,this.noiseRandomSeeds);this.gl.uniform1f(this.renderingData.locations.zvecpmg,m||0);this.gl.uniform2f(this.renderingData.locations.wkmsbqd,0,0);this.gl.uniform1i(this.renderingData.locations.dkgckvl,0);this.gl.activeTexture(this.gl.TEXTURE0);this.gl.bindTexture(this.gl.TEXTURE_2D,b);this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexBufferScreen);this.gl.vertexAttribPointer(this.renderingData.locations.ymaxekn,
3,this.gl.FLOAT,!1,0,0);this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.elementsBufferScreen);this.gl.drawElements(this.gl.TRIANGLES,6,this.gl.UNSIGNED_SHORT,0);this.gl.depthMask(!0);this.gl.enable(this.gl.DEPTH_TEST);this.gl.bindTexture(this.gl.TEXTURE_2D,null);this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA)},Ac=function(){this.globalFramebuffer.multisampled&&(this.gl.bindFramebuffer(this.gl.READ_FRAMEBUFFER,this.globalFramebuffer.framebuffer),this.gl.bindFramebuffer(this.gl.DRAW_FRAMEBUFFER,
this.globalFramebuffer.framebufferForTexture),this.gl.clearBufferfi(this.gl.DEPTH_STENCIL,0,0,0),this.gl.blitFramebuffer(0,0,this.globalFramebuffer.width,this.globalFramebuffer.height,0,0,this.globalFramebuffer.width,this.globalFramebuffer.height,this.gl.COLOR_BUFFER_BIT,this.gl.LINEAR),this.gl.bindFramebuffer(this.gl.READ_FRAMEBUFFER,null),this.gl.bindFramebuffer(this.gl.DRAW_FRAMEBUFFER,null))},Qd=function(b,d,e,f,h,m){b=Math.max(Math.round(b),1);d=Math.max(Math.round(d),1);h=h?[h]:[];return this.gl.floatTextures?
$d.call(this,b,d,e,h,m)[0]:Td.call(this,b,d,e,f,h,m)[0]},ge=function(b,d,e,f,h,m){return this.gl.floatTextures?$d.call(this,b,d,e,h,m):Td.call(this,b,d,e,f,h,m)},Vd=function(b,d,e,f,h,m){b=Qd.call(this,b,d,e,f,h,m);return stage.createResult("**"+this.statId+"**"+b)},$d=function(b,d,e,f,h){var m=this.gl.viewportWidth/this.maxScaling,p=this.gl.viewportHeight/this.maxScaling,g=this.settings.renderBlurredOpacity,v=this.jitterVectors.length,k=this.ssaaFramesCnt;this.screenshotting=!0;this.settings.renderBlurredOpacity=
!1;var l=md.call(this);n.call(this,b,d);vb.call(this,16);f&&f.length||(f=[this.currentCamera]);var r=this.currentCamera,q=$c.call(this,b,d,e),w=this.gl.floatTextures?1:4,B=[];if(this.gl.floatTextures){var A=this.gl.createTexture();this.gl.bindTexture(this.gl.TEXTURE_2D,A);this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR);this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR);this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,
this.gl.CLAMP_TO_EDGE);this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE);this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA32F,b,d,0,this.gl.RGBA,this.gl.FLOAT,null);B.push(A)}else for(var t=0;t<w;++t)A=this.gl.createTexture(),this.gl.bindTexture(this.gl.TEXTURE_2D,A),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,
this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,b,d,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,null),B.push(A);this.gl.bindTexture(this.gl.TEXTURE_2D,null);w=this.jitterVectors.length/B.length;if(e){var O=this.backgroundTexture;this.backgroundTexture=null;var V=this.clearColor.a,E=this.clearColor.r,I=this.clearColor.g,P=this.clearColor.b}A=[];this.gl.viewport(0,0,b,d);
this.gl.scissor(0,0,b,d);this.gl.enable(this.gl.SCISSOR_TEST);for(var u=0;u<f.length;++u){t=f[u];t.upReal||(t.upReal=vec3.create(t.up));Wa.call(this,stage.extend(!0,{},this.currentCamera,t));nb.call(this,!0,!0);Eb.call(this,this.scene,this.settings.nbFilterPasses,!0);this.scene.hasSomeFur&&zc.call(this,b,d);var N=sc.call(this,b,d);this.gl.disable(this.gl.BLEND);for(t=0;t<this.jitterVectors.length;++t){this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.globalFramebuffer.framebuffer);this.gl.clear(this.gl.DEPTH_BUFFER_BIT);
this.ssaaFramesCnt=t+1;mc.call(this);e&&(this.clearColor.r=0,this.clearColor.g=0,this.clearColor.b=0,this.clearColor.a=0);qb.call(this,!0);e&&(this.clearColor.a=V,this.clearColor.r=E,this.clearColor.g=I,this.clearColor.b=P);$b.call(this,this.globalFramebuffer.framebuffer);Ac.call(this);var F=Math.floor(t/w);F==t/w?(this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,q.framebuffer),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,B[F],0),this.gl.clearColor(0,0,
0,0),this.gl.clear(this.gl.COLOR_BUFFER_BIT)):this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,q.framebuffer);Xa.call(this,this.globalFramebuffer.globalTexture,1/w,!1)}this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,q.framebuffer);this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,q.texture,0);this.gl.clearColor(0,0,0,0);this.gl.clear(this.gl.COLOR_BUFFER_BIT);for(t=0;t<B.length;++t)Xa.call(this,B[t],1/B.length,!1,!1,null,this.settings.graininess);if(e){this.clearColor.a=
1;this.gl.colorMask(!1,!1,!1,!0);for(t=0;t<this.jitterVectors.length;++t)this.gl.blendFunc(this.gl.ZERO,this.gl.ONE_MINUS_SRC_ALPHA),this.gl.blendFunc3=this.gl.blendFunc,this.gl.blendFunc=function(b){return function(d,e){b.blendFunc3(b.ZERO,e)}}(this.gl),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.globalFramebuffer.framebuffer),this.gl.clear(this.gl.DEPTH_BUFFER_BIT),this.ssaaFramesCnt=t+1,mc.call(this),qb.call(this,!0),$b.call(this,this.globalFramebuffer.framebuffer),this.gl.blendFunc=this.gl.blendFunc3,
Ac.call(this),F=Math.floor(t/w),F==t/w?(this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,q.framebuffer2),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,B[F],0),this.gl.clearColor(0,0,0,0),this.gl.colorMask(!0,!0,!0,!0),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.gl.colorMask(!1,!1,!1,!0)):this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,q.framebuffer2),Xa.call(this,this.globalFramebuffer.globalTexture,1/w,!1,!0),this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA);
this.gl.colorMask(!0,!0,!0,!0);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,q.framebuffer2);this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,q.texture2,0);this.gl.clearColor(0,0,0,0);this.gl.clear(this.gl.COLOR_BUFFER_BIT);for(t=0;t<B.length;++t)Xa.call(this,B[t],1/B.length,!1)}t=Ud.call(this,q.framebuffer,q.framebuffer2,b,d,e,N);A.push(t.toDataURL(void 0!==h?h:"image/png"))}r&&(Wa.call(this,r),nb.call(this,!0,!0),Eb.call(this,this.scene,this.settings.nbFilterPasses,
!0));e&&(this.backgroundTexture=O,this.clearColor.a=V);this.settings.renderBlurredOpacity=g;ed.call(this,l);vb.call(this,v);n.call(this,m,p);this.screenshotting=!1;this.ssaaFramesCnt=k;mc.call(this);for(t=0;t<B.length;++t)this.gl.deleteTexture(B[t]);q.destroy();return A},Td=function(b,d,e,f,h,m){this.shaders.createShadowMapShader();var p=this.gl.viewportWidth/this.maxScaling,g=this.gl.viewportHeight/this.maxScaling,v=this.settings.depthAndNormalsReduction;f||(f=1);b*=f;d*=f;this.screenshotting=!0;
this.settings.depthAndNormalsReduction=1;var k=md.call(this);n.call(this,b,d);h&&h.length||(h=[this.currentCamera]);var l=this.currentCamera;if(e){var r=this.backgroundTexture;this.backgroundTexture=null;var q=this.clearColor.a,w=this.clearColor.r,t=this.clearColor.g,B=this.clearColor.b;this.clearColor.r=0;this.clearColor.g=0;this.clearColor.b=0;this.clearColor.a=1}var A=[],O=$c.call(this,b,d,e),V;for(V in h){h[V].upReal||(h[V].upReal=vec3.create(h[V].up));Wa.call(this,stage.extend(!0,{},l,h[V]));
nb.call(this,!0,!0);Eb.call(this,this.scene,this.settings.nbFilterPasses,!0);this.scene.hasSomeFur&&zc.call(this,b,d);this.gl.viewport(0,0,b,d);this.gl.scissor(0,0,b,d);this.gl.enable(this.gl.SCISSOR_TEST);var E=rd.call(this);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,O.framebuffer);this.gl.disable(this.gl.BLEND);this.gl.viewport(0,0,this.gl.viewportWidth,this.gl.viewportHeight);this.gl.scissor(0,0,this.gl.viewportWidth,this.gl.viewportHeight);this.gl.enable(this.gl.SCISSOR_TEST);this.gl.clear(this.gl.DEPTH_BUFFER_BIT);
qb.call(this,!0);e&&(this.clearColor.a=q,this.clearColor.r=w,this.clearColor.g=t,this.clearColor.b=B);$b.call(this,O.framebuffer);e&&(this.clearColor.a=1,this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,O.framebuffer2),this.gl.blendFunc(this.gl.ZERO,this.gl.ONE_MINUS_SRC_ALPHA),this.gl.colorMask(!1,!1,!1,!0),this.gl.blendFunc3=this.gl.blendFunc,this.gl.blendFunc=function(b){return function(d,e){b.blendFunc3(b.ZERO,e)}}(this.gl),this.gl.disable(this.gl.BLEND),this.gl.viewport(0,0,this.gl.viewportWidth,
this.gl.viewportHeight),this.gl.scissor(0,0,this.gl.viewportWidth,this.gl.viewportHeight),this.gl.enable(this.gl.SCISSOR_TEST),this.gl.clear(this.gl.DEPTH_BUFFER_BIT),qb.call(this,!0),$b.call(this,O.framebuffer2),this.gl.colorMask(!0,!0,!0,!0),this.gl.blendFunc=this.gl.blendFunc3);this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null);E=Fd.call(this,O.framebuffer,O.framebuffer2,b,d,e,E);var I=document.createElement("canvas");I.width=b/f;
I.height=d/f;I.getContext("2d").drawImage(E,0,0,b/f,d/f);A.push(I.toDataURL(void 0!==m?m:"image/png"))}this.screenshotting=!1;this.settings.depthAndNormalsReduction=v;e&&(this.backgroundTexture=r,this.clearColor.a=q);ed.call(this,k);O.destroy();Wa.call(this,l);nb.call(this,!0,!0);Eb.call(this,this.scene,this.settings.nbFilterPasses,!0);n.call(this,p,g);return A},he=function(b,d,e,f,h,m){b=Math.max(Math.round(b),1);d=Math.max(Math.round(d),1);return this.gl.floatTextures?ae.call(this,b,d,e,h,m):ne.call(this,
b,d,e,f,h,m)},ae=function(b,d,e,f,h){var m=this.gl.viewportWidth/this.maxScaling,p=this.gl.viewportHeight/this.maxScaling;this.screenshotting=!0;var g=this.settings.renderBlurredOpacity;this.settings.renderBlurredOpacity=!1;var v=md.call(this),k=Math.round(b/2E3),l=Math.round(d/2E3);0===k&&(k=1);0===l&&(l=1);var r=Math.round(b/k),q=Math.round(d/l);if(e){var w=this.backgroundTexture;this.backgroundTexture=null;var t=this.clearColor.a,B=this.clearColor.r,A=this.clearColor.g,O=this.clearColor.b;this.clearColor.r=
0;this.clearColor.g=0;this.clearColor.b=0;this.clearColor.a=1}var V=this.jitterVectors.length,E=this.ssaaFramesCnt,I=this.screenTransfMatrix;if(f){var P=this.currentCamera;f.upReal||(f.upReal=vec3.create(f.up));Wa.call(this,stage.extend(!0,{},this.currentCamera,f));nb.call(this,!0,!0);Eb.call(this,this.scene,this.settings.nbFilterPasses,!0)}if(this.cameraMode){if(this.currentCamera.adaptativeFov&&b<d)var u=this.near*Math.tan(this.currentCamera.fov*Math.PI*.5/180),N=-u,F=N*d/b,W=u*d/b;else W=this.near*
Math.tan(this.currentCamera.fov*Math.PI*.5/180),F=-W,N=F*b/d,u=W*b/d;u+=N*this.currentCamera.screenOffset.x;this.renderingData.xmax=u;N*=1+this.currentCamera.screenOffset.x;W+=F*this.currentCamera.screenOffset.y;F*=1+this.currentCamera.screenOffset.y;mat4.frustum(N,u,F,W,this.near,this.far,this.renderingData.projectionMatrix)}else{var D=Math.tan(this.currentCamera.fov*Math.PI*.5/180)*vec3.length(vec3.subtract(this.currentCamera.position,this.currentCamera.target,vec3.create()));this.currentCamera.adaptativeFov&&
b<d?(N=-D,u=D,F=-D*d/b,W=D*d/b):(N=-D*b/d,u=D*b/d,F=-D,W=D);u+=N*this.currentCamera.screenOffset.x;N*=1+this.currentCamera.screenOffset.x;W+=F*this.currentCamera.screenOffset.y;F*=1+this.currentCamera.screenOffset.y;mat4.ortho(N,u,F,W,this.near,this.far,this.renderingData.projectionMatrix)}var ca=1*Math.tan(this.currentCamera.fov*Math.PI*.5/180),ja=-ca,J=ja*b/d;var na=ca*b/d+J*this.currentCamera.screenOffset.x;J*=1+this.currentCamera.screenOffset.x;ca+=ja*this.currentCamera.screenOffset.y;ja*=1+this.currentCamera.screenOffset.y;
n.call(this,r+100,q+100);this.scene.hasSomeFur&&zc.call(this,r+100,q+100,this.renderingData.projectionMatrix);vb.call(this,16);D=$c.call(this,r+100,q+100,e);var sa=this.gl.floatTextures?1:4,pa=[];if(this.gl.floatTextures){var Q=this.gl.createTexture();this.gl.bindTexture(this.gl.TEXTURE_2D,Q);this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR);this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR);this.gl.texParameteri(this.gl.TEXTURE_2D,
this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE);this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE);this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA32F,r+100,q+100,0,this.gl.RGBA,this.gl.FLOAT,null);pa.push(Q)}else for(var H=0;H<sa;++H)Q=this.gl.createTexture(),this.gl.bindTexture(this.gl.TEXTURE_2D,Q),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),
this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,r+100,q+100,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,null),pa.push(Q);this.gl.bindTexture(this.gl.TEXTURE_2D,null);Q=this.jitterVectors.length/pa.length;sa=document.createElement("canvas");sa.width=b;sa.height=d;var Da=sa.getContext("2d"),Ca;if(this.gl.floatTextures){var Pa=new Float32Array(4*
(r+100)*(q+100));e&&(Ca=new Float32Array(4*(r+100)*(q+100)));var Ea=255;var M=1}else Pa=new Uint8Array(4*(r+100)*(q+100)),e&&(Ca=new Uint8Array(4*(r+100)*(q+100))),Ea=1,M=255;var Ua=(W-F)/l,C=(u-N)/k,Za=N,kb=F;ca=(ca-ja)/l;na=(na-J)/k;var xb=b/d,Mb=this.backgroundTextureWidth/this.backgroundTextureHeight,da=document.createElement("canvas");da.width=r;da.height=q;for(var Y=da.getContext("2d"),ha=Y.createImageData(r,q),za=50*(r+100)/r,ta=50*(q+100)/q,G=0;G<k;++G)for(var Cd=0;Cd<l;++Cd){e&&(this.clearColor.r=
0,this.clearColor.g=0,this.clearColor.b=0,this.clearColor.a=1);this.gl.viewport(0,0,r+100,q+100);this.gl.scissor(0,0,r+100,q+100);this.gl.enable(this.gl.SCISSOR_TEST);F=-1+2/l*(l-Cd-1);W=F+2/l;N=-1+2/k*G;u=N+2/k;u+=2/k*za/(r+100);N-=2/k*za/(r+100);W+=2/l*ta/(q+100);F-=2/l*ta/(q+100);switch(this.backgroundFitting){case 0:xb>Mb?(N*=k/l,u*=k/l):(F/=k/l,W/=k/l);break;case 1:xb<Mb?(N*=k/l,u*=k/l):(F/=k/l,W/=k/l)}N=mat4.ortho(N,u,F,W,.5,1.5,mat4.create());F=this.screenTransfMatrix;W=stage.setContext(function(b,
d,e,f,h,m,p,g,n,v,k,l,r,q,t,w,B){var A=this.jitterVectors[this.ssaaFramesCnt-1];n=A[0]/8;A=A[1]/8;f+=m*(v-d-1);e+=h*b;var O=e+h+(p+.5*n)/(k+r)*h;e-=(p-.5*n)/(k+r)*h;h=f+m+(g+.5*A)/(l+r)*m;f-=(g-.5*A)/(l+r)*m;this.cameraMode?mat4.frustum(e,O,f,h,this.near,this.far,this.renderingData.projectionMatrix):mat4.ortho(e,O,f,h,this.near,this.far,this.renderingData.projectionMatrix);f=B+q*(v-d-1);e=w+t*b;mat4.frustum(e-(p-.5*n)/(k+r)*t,e+t+(p+.5*n)/(k+r)*t,f-(g-.5*A)/(l+r)*q,f+q+(g+.5*A)/(l+r)*q,1,200,this.cubeProjMatrix)},
this,G,Cd,Za,kb,C,Ua,za,ta,k,l,r,q,100,ca,na,J,ja);u=sc.call(this,r+100,q+100,W);this.gl.disable(this.gl.BLEND);this.gl.viewport(0,0,this.gl.viewportWidth,this.gl.viewportHeight);this.gl.scissor(0,0,this.gl.viewportWidth,this.gl.viewportHeight);this.gl.enable(this.gl.SCISSOR_TEST);for(H=0;H<this.jitterVectors.length;++H){this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.globalFramebuffer.framebuffer);this.gl.clear(this.gl.DEPTH_BUFFER_BIT);this.ssaaFramesCnt=H+1;W();e&&(this.clearColor.r=0,this.clearColor.g=
0,this.clearColor.b=0,this.clearColor.a=0);this.screenTransfMatrix=N;qb.call(this,!0);this.screenTransfMatrix=F;e&&(this.clearColor.a=t,this.clearColor.r=B,this.clearColor.g=A,this.clearColor.b=O);$b.call(this,this.globalFramebuffer.framebuffer);Ac.call(this);var ya=Math.floor(H/Q);ya==H/Q?(this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,D.framebuffer),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,pa[ya],0),this.gl.clearColor(0,0,0,0),this.gl.clear(this.gl.COLOR_BUFFER_BIT)):
this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,D.framebuffer);Xa.call(this,this.globalFramebuffer.globalTexture,1/Q,!1)}this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,D.framebuffer);this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,D.texture,0);this.gl.clearColor(0,0,0,0);this.gl.clear(this.gl.COLOR_BUFFER_BIT);for(H=0;H<pa.length;++H)Xa.call(this,pa[H],1/pa.length,!1,!1,null,this.settings.graininess);if(e){this.clearColor.a=1;this.gl.colorMask(!1,!1,!1,!0);for(H=
0;H<this.jitterVectors.length;++H)this.gl.blendFunc(this.gl.ZERO,this.gl.ONE_MINUS_SRC_ALPHA),this.gl.blendFunc3=this.gl.blendFunc,this.gl.blendFunc=function(b){return function(d,e){b.blendFunc3(b.ZERO,e)}}(this.gl),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.globalFramebuffer.framebuffer),this.gl.clear(this.gl.DEPTH_BUFFER_BIT),this.ssaaFramesCnt=H+1,W(),qb.call(this,!0),$b.call(this,this.globalFramebuffer.framebuffer),this.gl.blendFunc=this.gl.blendFunc3,Ac.call(this),ya=Math.floor(H/Q),ya==
H/Q?(this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,D.framebuffer2),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,pa[ya],0),this.gl.clearColor(0,0,0,0),this.gl.colorMask(!0,!0,!0,!0),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.gl.colorMask(!1,!1,!1,!0)):this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,D.framebuffer2),Xa.call(this,this.globalFramebuffer.globalTexture,1/Q,!1,!0),this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA);this.gl.colorMask(!0,
!0,!0,!0);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,D.framebuffer2);this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,D.texture2,0);this.gl.clearColor(0,0,0,0);this.gl.clear(this.gl.COLOR_BUFFER_BIT);for(H=0;H<pa.length;++H)Xa.call(this,pa[H],1/pa.length,!1)}this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,D.framebuffer);this.gl.floatTextures?this.gl.readPixels(0,0,r+100,q+100,this.gl.RGBA,this.gl.FLOAT,Pa):this.gl.readPixels(0,0,r+100,q+100,this.gl.RGBA,this.gl.UNSIGNED_BYTE,
Pa);if(e)for(this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,D.framebuffer2),this.gl.floatTextures?this.gl.readPixels(0,0,r+100,q+100,this.gl.RGBA,this.gl.FLOAT,Ca):this.gl.readPixels(0,0,r+100,q+100,this.gl.RGBA,this.gl.UNSIGNED_BYTE,Ca),H=50;H<r+50;++H)for(W=50;W<q+50;++W)ya=H-50+(W-50)*r,X=H+(r+100)*(q+100-W-1),0<u[4*X]?(N=vec3.create([0,0,0]),N[0]=Pa[4*X]/M,N[1]=Pa[4*X+1]/M,N[2]=Pa[4*X+2]/M,(F=Pa[4*X+3]/M)?vec3.scale(N,1/F):vec3.scale(N,0),ha.data[4*ya]=255*N[0],ha.data[4*ya+1]=255*N[1],ha.data[4*
ya+2]=255*N[2],ha.data[4*ya+3]=255*F):u[4*X+3]==M?(ha.data[4*ya]=Pa[4*X]*Ea,ha.data[4*ya+1]=Pa[4*X+1]*Ea,ha.data[4*ya+2]=Pa[4*X+2]*Ea,ha.data[4*ya+3]=255):0!==Pa[4*X+3]?(N=vec3.create([0,0,0]),N[0]=Pa[4*X]/M,N[1]=Pa[4*X+1]/M,N[2]=Pa[4*X+2]/M,vec3.create([this.clearColor.r,this.clearColor.g,this.clearColor.b]),F=1-Ca[4*X+3]/M,0<u[4*X+3]&&(F=F?1-Ca[4*X+3]/M*(1-u[4*X+3]/M):u[4*X+3]/M),F?vec3.scale(N,1/F):vec3.scale(N,0),ha.data[4*ya]=255*N[0],ha.data[4*ya+1]=255*N[1],ha.data[4*ya+2]=255*N[2],ha.data[4*
ya+3]=255*F):(ha.data[4*ya]=0,ha.data[4*ya+1]=0,ha.data[4*ya+2]=0,ha.data[4*ya+3]=0);else for(H=50;H<r+50;++H)for(W=50;W<q+50;++W){ya=H-50+(W-50)*r;var X=H+(r+100)*(q+100-W-1);0!=u[4*X+3]?(ha.data[4*ya]=Pa[4*X]*Ea,ha.data[4*ya+1]=Pa[4*X+1]*Ea,ha.data[4*ya+2]=Pa[4*X+2]*Ea,ha.data[4*ya+3]=255):(ha.data[4*ya]=255*Pa[4*X]/Pa[4*X+3],ha.data[4*ya+1]=255*Pa[4*X+1]/Pa[4*X+3],ha.data[4*ya+2]=255*Pa[4*X+2]/Pa[4*X+3],ha.data[4*ya+3]=Pa[4*X+3]*Ea)}Y.putImageData(ha,0,0);Da.drawImage(da,G*r,Cd*q);Da.drawImage(sa,
0,0,1,1,0,0,1,1);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null)}e&&(this.backgroundTexture=w,this.clearColor.a=t,this.clearColor.r=B,this.clearColor.g=A,this.clearColor.b=O);this.screenTransfMatrix=I;this.settings.renderBlurredOpacity=g;f&&(Wa.call(this,P),nb.call(this,!0,!0),Eb.call(this,this.scene,this.settings.nbFilterPasses,!0));D.destroy();ed.call(this,v);vb.call(this,V);n.call(this,m,p);this.screenshotting=!1;this.ssaaFramesCnt=E;mc.call(this);e=document.createElement("canvas");e.width=b;
e.height=d;e.getContext("2d").drawImage(sa,0,0,b,d);return e.toDataURL(void 0!==h?h:"image/png")},ne=function(b,d,e,f,h,m){this.shaders.createShadowMapShader();var p=this.gl.viewportWidth/this.maxScaling,g=this.gl.viewportHeight/this.maxScaling,v=this.settings.depthAndNormalsReduction;this.screenshotting=!0;this.settings.depthAndNormalsReduction=1;b*=f;d*=f;var k=md.call(this),r=Math.round(b/2E3),l=Math.round(d/2E3);0===r&&(r=1);0===l&&(l=1);var q=Math.round(b/r),t=Math.round(d/l),w=$c.call(this,
q+100,t+100,e);if(e){var A=this.backgroundTexture;this.backgroundTexture=null;var B=this.clearColor.a,O=this.clearColor.r,V=this.clearColor.g,E=this.clearColor.b;this.clearColor.r=0;this.clearColor.g=0;this.clearColor.b=0;this.clearColor.a=1}var I=this.screenTransfMatrix;if(h){var u=this.currentCamera;h.upReal||(h.upReal=vec3.create(h.up));Wa.call(this,stage.extend(!0,{},this.currentCamera,h));nb.call(this,!0,!0);Eb.call(this,this.scene,this.settings.nbFilterPasses,!0)}if(this.cameraMode){if(this.currentCamera.adaptativeFov&&
b<d)var P=this.near*Math.tan(this.currentCamera.fov*Math.PI*.5/180),N=-P,F=N*d/b,W=P*d/b;else W=this.near*Math.tan(this.currentCamera.fov*Math.PI*.5/180),F=-W,N=F*b/d,P=W*b/d;P+=N*this.currentCamera.screenOffset.x;this.renderingData.xmax=P;N*=1+this.currentCamera.screenOffset.x;W+=F*this.currentCamera.screenOffset.y;F*=1+this.currentCamera.screenOffset.y;mat4.frustum(N,P,F,W,this.near,this.far,this.renderingData.projectionMatrix)}else{var D=Math.tan(this.currentCamera.fov*Math.PI*.5/180)*vec3.length(vec3.subtract(this.currentCamera.position,
this.currentCamera.target,vec3.create()));this.currentCamera.adaptativeFov&&b<d?(N=-D,P=D,F=-D*d/b,W=D*d/b):(N=-D*b/d,P=D*b/d,F=-D,W=D);P+=N*this.currentCamera.screenOffset.x;N*=1+this.currentCamera.screenOffset.x;W+=F*this.currentCamera.screenOffset.y;F*=1+this.currentCamera.screenOffset.y;mat4.ortho(N,P,F,W,this.near,this.far,this.renderingData.projectionMatrix)}var ca=1*Math.tan(this.currentCamera.fov*Math.PI*.5/180),ja=-ca,J=ja*b/d;var na=ca*b/d+J*this.currentCamera.screenOffset.x;J*=1+this.currentCamera.screenOffset.x;
ca+=ja*this.currentCamera.screenOffset.y;ja*=1+this.currentCamera.screenOffset.y;n.call(this,q+100,t+100);this.scene.hasSomeFur&&zc.call(this,q+100,t+100,this.renderingData.projectionMatrix);D=document.createElement("canvas");D.width=b;D.height=d;var sa=D.getContext("2d");if(this.gl.floatTextures){var pa=new Float32Array(4*(q+100)*(t+100));var Q=new Float32Array(4*(q+100)*(t+100));var H=255;var Da=1}else pa=new Uint8Array(4*(q+100)*(t+100)),Q=new Uint8Array(4*(q+100)*(t+100)),H=1,Da=255;var Pa=(W-
F)/l,Ca=(P-N)/r,Ea=N,M=F,Ua=(ca-ja)/l,C=(na-J)/r,Za=J,xb=ja,Mb=b/d,kb=this.backgroundTextureWidth/this.backgroundTextureHeight,da=document.createElement("canvas");da.width=q;da.height=t;for(var Y=da.getContext("2d"),ha=Y.createImageData(q,t),za=50*(q+100)/q,ta=50*(t+100)/t,G=0;G<r;++G)for(var ya=0;ya<l;++ya){e&&(this.clearColor.r=0,this.clearColor.g=0,this.clearColor.b=0,this.clearColor.a=1);this.gl.viewport(0,0,q+100,t+100);this.gl.scissor(0,0,q+100,t+100);this.gl.enable(this.gl.SCISSOR_TEST);F=
M+Pa*(l-ya-1);W=F+Pa;N=Ea+Ca*G;P=N+Ca;P+=Ca*za/(q+100);N-=Ca*za/(q+100);W+=Pa*ta/(t+100);F-=Pa*ta/(t+100);this.cameraMode?mat4.frustum(N,P,F,W,this.near,this.far,this.renderingData.projectionMatrix):mat4.ortho(N,P,F,W,this.near,this.far,this.renderingData.projectionMatrix);ja=xb+Ua*(l-ya-1);ca=ja+Ua;J=Za+C*G;na=J+C;na+=za/(q+100)*C;J-=za/(q+100)*C;ca+=ta/(t+100)*Ua;ja-=ta/(t+100)*Ua;mat4.frustum(J,na,ja,ca,1,200,this.cubeProjMatrix);F=-1+2/l*(l-ya-1);W=F+2/l;N=-1+2/r*G;P=N+2/r;P+=2/r*za/(q+100);N-=
2/r*za/(q+100);W+=2/l*ta/(t+100);F-=2/l*ta/(t+100);switch(this.backgroundFitting){case 0:Mb>kb?(N*=r/l,P*=r/l):(F/=r/l,W/=r/l);break;case 1:Mb<kb?(N*=r/l,P*=r/l):(F/=r/l,W/=r/l)}mat4.ortho(N,P,F,W,.5,1.5,this.screenTransfMatrix);P=rd.call(this);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,w.framebuffer);this.gl.viewport(0,0,q+100,t+100);this.gl.scissor(0,0,q+100,t+100);this.gl.enable(this.gl.SCISSOR_TEST);this.gl.clear(this.gl.DEPTH_BUFFER_BIT);qb.call(this,!0);e?(this.clearColor.a=B,this.clearColor.r=
O,this.clearColor.g=V,this.clearColor.b=E,$b.call(this,w.framebuffer)):($b.call(this,w.framebuffer),Sd.call(this,w.framebuffer));e&&(this.clearColor.a=1);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,w.framebuffer2);this.gl.blendFunc(this.gl.ZERO,this.gl.ONE_MINUS_SRC_ALPHA);this.gl.colorMask(!1,!1,!1,!0);this.gl.blendFunc3=this.gl.blendFunc;this.gl.blendFunc=function(b){return function(d,e){b.blendFunc3(b.ZERO,e)}}(this.gl);this.gl.disable(this.gl.BLEND);this.gl.viewport(0,0,q+100,t+100);this.gl.scissor(0,
0,q+100,t+100);this.gl.enable(this.gl.SCISSOR_TEST);this.gl.clear(this.gl.DEPTH_BUFFER_BIT);qb.call(this,!0);e?$b.call(this,w.framebuffer2):($b.call(this,w.framebuffer2),Sd.call(this,w.framebuffer2));this.gl.colorMask(!0,!0,!0,!0);this.gl.blendFunc=this.gl.blendFunc3;this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,w.framebuffer);this.gl.floatTextures?this.gl.readPixels(0,0,q+100,t+100,this.gl.RGBA,this.gl.FLOAT,pa):this.gl.readPixels(0,
0,q+100,t+100,this.gl.RGBA,this.gl.UNSIGNED_BYTE,pa);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,w.framebuffer2);this.gl.floatTextures?this.gl.readPixels(0,0,q+100,t+100,this.gl.RGBA,this.gl.FLOAT,Q):this.gl.readPixels(0,0,q+100,t+100,this.gl.RGBA,this.gl.UNSIGNED_BYTE,Q);if(e)for(W=50;W<q+50;++W)for(ca=50;ca<t+50;++ca)ja=W-50+(ca-50)*q,J=W+(q+100)*(t+100-ca-1),0<P[4*J]?(N=vec3.create([0,0,0]),N[0]=pa[4*J]/Da,N[1]=pa[4*J+1]/Da,N[2]=pa[4*J+2]/Da,(F=pa[4*J+3]/Da)?vec3.scale(N,1/F):vec3.scale(N,0),ha.data[4*
ja]=255*N[0],ha.data[4*ja+1]=255*N[1],ha.data[4*ja+2]=255*N[2],ha.data[4*ja+3]=255*F):P[4*J+3]==Da?(ha.data[4*ja]=pa[4*J]*H,ha.data[4*ja+1]=pa[4*J+1]*H,ha.data[4*ja+2]=pa[4*J+2]*H,ha.data[4*ja+3]=255):0!==pa[4*J+3]?(N=vec3.create([0,0,0]),N[0]=pa[4*J]/Da,N[1]=pa[4*J+1]/Da,N[2]=pa[4*J+2]/Da,F=1-Q[4*J+3]/Da,0<P[4*J+3]&&(F=F?1-Q[4*J+3]/Da*(1-P[4*J+3]/Da):P[4*J+3]/Da),F?vec3.scale(N,1/F):vec3.scale(N,0),ha.data[4*ja]=255*N[0],ha.data[4*ja+1]=255*N[1],ha.data[4*ja+2]=255*N[2],ha.data[4*ja+3]=255*F):(ha.data[4*
ja]=0,ha.data[4*ja+1]=0,ha.data[4*ja+2]=0,ha.data[4*ja+3]=0);else for(W=50;W<q+50;++W)for(ca=50;ca<t+50;++ca)ja=W-50+(ca-50)*q,J=W+(q+100)*(t+100-ca-1),ha.data[4*ja]=pa[4*J]*H,ha.data[4*ja+1]=pa[4*J+1]*H,ha.data[4*ja+2]=pa[4*J+2]*H,ha.data[4*ja+3]=0!=P[4*J+3]?255:pa[4*J+3]*H;Y.putImageData(ha,0,0);sa.drawImage(da,G*q,ya*t);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null)}e&&(this.backgroundTexture=A,this.clearColor.a=B,this.clearColor.r=O,this.clearColor.g=V,this.clearColor.b=E);this.screenTransfMatrix=
I;this.settings.depthAndNormalsReduction=v;h&&(Wa.call(this,u),nb.call(this,!0,!0),Eb.call(this,this.scene,this.settings.nbFilterPasses,!0));w.destroy();ed.call(this,k);n.call(this,p,g);this.screenshotting=!1;b/=f;d/=f;e=document.createElement("canvas");e.width=b;e.height=d;e.getContext("2d").drawImage(D,0,0,b,d);return e.toDataURL(void 0!==m?m:"image/png")},Jd=function(b,d,e,f,h,m,p){b=Math.max(Math.round(b),1);d=Math.max(Math.round(d),1);return this.gl.floatTextures?ve.call(this,b,d,e,h,m,p):be.call(this,
b,d,e,f,h,m,p)},ve=function(b,d,e,f,h,m){var p=[],g=[],v;for(v in this.scene.materialTrees){var k=this.scene.materialTrees[v];-1===e.indexOf(k.id)?p.push(k):g.push(k)}e=[];for(v in p){k=p[v];for(var l in this.scene.materialsContent.materialSettingsByName[k.id]){var r=this.scene.materials[this.scene.materialsContent.materialSettingsByName[k.id][l].id].opacity;if(1!=r.intensity||null!=r.texture){e.push(k);break}}}r=this.gl.viewportWidth/this.maxScaling;var q=this.gl.viewportHeight/this.maxScaling,t=
this.jitterVectors.length,w=this.ssaaFramesCnt,B=this.settings.renderBlurredOpacity;this.screenshotting=!0;this.settings.renderBlurredOpacity=!1;var A=md.call(this);n.call(this,b,d);vb.call(this,16);var O=$c.call(this,b,d,!0);O=this.gl.floatTextures?1:4;k=[];if(this.gl.floatTextures){var V=this.gl.createTexture();this.gl.bindTexture(this.gl.TEXTURE_2D,V);this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR);this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,
this.gl.LINEAR);this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE);this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE);this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA32F,b,d,0,this.gl.RGBA,this.gl.FLOAT,null);k.push(V)}else for(v=0;v<O;++v)V=this.gl.createTexture(),this.gl.bindTexture(this.gl.TEXTURE_2D,V),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,
this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,b,d,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,null),k.push(V);this.gl.bindTexture(this.gl.TEXTURE_2D,null);var E=this.jitterVectors.length/k.length;V=this.backgroundTexture;var I=this.clearColor.a,P=this.clearColor.r,N=this.clearColor.g,
u=this.clearColor.b;this.backgroundTexture=null;this.clearColor.r=0;this.clearColor.g=0;this.clearColor.b=0;this.clearColor.a=0;if(f){var F=this.currentCamera;f.upReal||(f.upReal=vec3.create(f.up));Wa.call(this,stage.extend(!0,{},this.currentCamera,f));nb.call(this,!0,!0);Eb.call(this,this.scene,this.settings.nbFilterPasses,!0)}this.scene.hasSomeFur&&zc.call(this,b,d);var W=hd.call(this,b,d,p,g,e);this.gl.viewport(0,0,b,d);this.gl.scissor(0,0,b,d);this.gl.enable(this.gl.SCISSOR_TEST);O=$c.call(this,
b,d,!0);for(v=0;v<this.jitterVectors.length;++v){this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.globalFramebuffer.framebuffer);this.gl.clear(this.gl.DEPTH_BUFFER_BIT);this.ssaaFramesCnt=v+1;mc.call(this);this.shaders.useOneColorShader(this.renderingData,!0);this.gl.colorMask(!1,!1,!1,!1);fa.call(this,g);fa.call(this,e);for(l in this.scene.polylistInstances){var D=this.scene.polylistInstances[l];D.matAnim.isOpaque()&&this.meshes.renderForShadowMaps(this.renderingData,D)}fa.call(this,p);la.call(this,
g);this.gl.colorMask(!0,!0,!0,!0);qb.call(this,!0);$b.call(this,this.globalFramebuffer.framebuffer);Ac.call(this);D=Math.floor(v/E);D==v/E?(this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,O.framebuffer),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,k[D],0),this.gl.clearColor(0,0,0,0),this.gl.clear(this.gl.COLOR_BUFFER_BIT)):this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,O.framebuffer);Xa.call(this,this.globalFramebuffer.globalTexture,1/E,!1)}this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,
O.framebuffer);this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,O.texture,0);this.gl.clearColor(0,0,0,0);this.gl.clear(this.gl.COLOR_BUFFER_BIT);for(v=0;v<k.length;++v)Xa.call(this,k[v],1/k.length,!1);this.clearColor.a=1;for(v=0;v<this.jitterVectors.length;++v){this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.globalFramebuffer.framebuffer);this.gl.blendFunc(this.gl.ZERO,this.gl.ONE_MINUS_SRC_ALPHA);this.gl.blendFunc3=this.gl.blendFunc;this.gl.blendFunc=
function(b){return function(d,e){b.blendFunc3(b.ZERO,e)}}(this.gl);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.globalFramebuffer.framebuffer);this.gl.clear(this.gl.DEPTH_BUFFER_BIT);this.ssaaFramesCnt=v+1;mc.call(this);this.gl.colorMask(!1,!1,!1,!1);fa.call(this,g);la.call(this,p);fa.call(this,e);this.shaders.useOneColorShader(this.renderingData,!0);for(l in this.scene.polylistInstances)D=this.scene.polylistInstances[l],D.matAnim.isOpaque()&&this.meshes.renderForShadowMaps(this.renderingData,
D);fa.call(this,p);la.call(this,g);this.gl.colorMask(!1,!1,!1,!0);qb.call(this,!0);$b.call(this,this.globalFramebuffer.framebuffer);this.gl.blendFunc=this.gl.blendFunc3;this.gl.colorMask(!0,!0,!0,!0);Ac.call(this);D=Math.floor(v/E);D==v/E?(this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,O.framebuffer2),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,k[D],0),this.gl.clearColor(0,0,0,0),this.gl.colorMask(!0,!0,!0,!0),this.gl.clear(this.gl.COLOR_BUFFER_BIT),
this.gl.colorMask(!1,!1,!1,!0)):this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,O.framebuffer2);Xa.call(this,this.globalFramebuffer.globalTexture,1/E,!1,!0);this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA)}this.gl.colorMask(!0,!0,!0,!0);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,O.framebuffer2);this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,O.texture2,0);this.gl.clearColor(0,0,0,0);this.gl.clear(this.gl.COLOR_BUFFER_BIT);for(v=0;v<k.length;++v)Xa.call(this,
k[v],1/k.length,!1);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null);g=Ud.call(this,O.framebuffer,O.framebuffer2,b,d,!0,W);f&&(Wa.call(this,F),nb.call(this,!0,!0),Eb.call(this,this.scene,this.settings.nbFilterPasses,!0));la.call(this,p);ed.call(this,A);vb.call(this,t);n.call(this,r,q);this.screenshotting=!1;this.ssaaFramesCnt=w;mc.call(this);this.backgroundTexture=V;this.clearColor.a=I;this.clearColor.r=P;this.clearColor.g=N;this.clearColor.b=u;this.settings.renderBlurredOpacity=B;if(!h){f=g.getContext("2d").getImageData(0,
0,b,d);h=!0;for(v=3;v<4*b*d&&h;v+=4)f.data[v]&&(h=!1);if(h)return null}for(v=0;v<k.length;++v)this.gl.deleteTexture(k[v]);O.destroy();return g.toDataURL(void 0!==m?m:"image/png")},be=function(b,d,e,f,h,m,p){this.shaders.createShadowMapShader();var g=[],v=[];for(q in this.scene.materialTrees){var k=this.scene.materialTrees[q];-1===e.indexOf(k.id)?g.push(k):v.push(k)}e=[];for(q in g){k=g[q];for(var l in this.scene.materialsContent.materialSettingsByName[k.id]){var r=this.scene.materials[this.scene.materialsContent.materialSettingsByName[k.id][l].id].opacity;
if(1!=r.intensity||null!=r.texture){e.push(k);break}}}k=this.gl.viewportWidth/this.maxScaling;l=this.gl.viewportHeight/this.maxScaling;var q=this.settings.depthAndNormalsReduction;this.screenshotting=!0;this.settings.depthAndNormalsReduction=1;this.settings.renderBlurredOpacity=!1;r=this.backgroundTexture;this.backgroundTexture=null;var t=this.clearColor.a,w=this.clearColor.r,B=this.clearColor.g,A=this.clearColor.b;this.clearColor.r=0;this.clearColor.g=0;this.clearColor.b=0;this.clearColor.a=1;b*=
f;d*=f;var O=md.call(this);n.call(this,b,d);if(h){var V=this.currentCamera;h.upReal||(h.upReal=vec3.create(h.up));Wa.call(this,stage.extend(!0,{},this.currentCamera,h));nb.call(this,!0,!0);Eb.call(this,this.scene,this.settings.nbFilterPasses,!0)}this.scene.hasSomeFur&&zc.call(this,b,d);this.gl.viewport(0,0,b,d);this.gl.scissor(0,0,b,d);this.gl.enable(this.gl.SCISSOR_TEST);var E=wd.call(this,g,v,e);this.settings.depthAndNormalsReduction=q;this.gl.disable(this.gl.BLEND);this.gl.viewport(0,0,this.gl.viewportWidth,
this.gl.viewportHeight);this.gl.scissor(0,0,this.gl.viewportWidth,this.gl.viewportHeight);this.gl.enable(this.gl.SCISSOR_TEST);var I=$c.call(this,b,d,!0);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,I.framebuffer);this.gl.colorMask(!1,!1,!1,!1);fa.call(this,v);fa.call(this,e);for(q=0;q<this.scene.polylistInstances.length;++q){var P=this.scene.polylistInstances[q];P.matAnim.isOpaque()&&this.meshes.renderForShadowMaps(this.renderingData,P)}fa.call(this,g);la.call(this,v);this.gl.colorMask(!0,!0,!0,!0);
qb.call(this,!0);$b.call(this,I.framebuffer);this.clearColor.a=1;this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,I.framebuffer2);this.gl.blendFunc(this.gl.ZERO,this.gl.ONE_MINUS_SRC_ALPHA);this.gl.blendFunc3=this.gl.blendFunc;this.gl.blendFunc=function(b){return function(d,e){b.blendFunc3(b.ZERO,e)}}(this.gl);this.gl.disable(this.gl.BLEND);this.gl.viewport(0,0,this.gl.viewportWidth,this.gl.viewportHeight);this.gl.scissor(0,0,this.gl.viewportWidth,this.gl.viewportHeight);this.gl.enable(this.gl.SCISSOR_TEST);
this.gl.colorMask(!1,!1,!1,!1);fa.call(this,v);la.call(this,g);fa.call(this,e);for(q=0;q<this.scene.polylistInstances.length;++q)P=this.scene.polylistInstances[q],P.matAnim.isOpaque()&&this.meshes.renderForShadowMaps(this.renderingData,P);fa.call(this,g);la.call(this,v);this.gl.colorMask(!1,!1,!1,!0);qb.call(this,!0);$b.call(this,I.framebuffer2);this.gl.blendFunc=this.gl.blendFunc3;this.gl.colorMask(!0,!0,!0,!0);this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA);v=Fd.call(this,I.framebuffer,
I.framebuffer2,b,d,!0,E);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null);I.destroy();ed.call(this,O);n.call(this,k,l);this.screenshotting=!1;this.backgroundTexture=r;this.clearColor.a=t;this.clearColor.r=w;this.clearColor.g=B;this.clearColor.b=A;h&&(Wa.call(this,V),nb.call(this,!0,!0),Eb.call(this,this.scene,this.settings.nbFilterPasses,!0));la.call(this,g);if(!m){h=v.getContext("2d").getImageData(0,0,b,d);m=!0;for(q=3;q<4*b*d&&m;q+=4)h.data[q]&&(m=!1);if(m)return null}b/=f;d/=f;f=document.createElement("canvas");
f.width=b;f.height=d;f.getContext("2d").drawImage(v,0,0,b,d);return f.toDataURL(void 0!==p?p:"image/png")},Wd=function(b,d,e,f,h,m,p){b=Math.max(Math.round(b),1);d=Math.max(Math.round(d),1);return this.gl.floatTextures?we.call(this,b,d,e,h,m,p):Od.call(this,b,d,e,f,h,m,p)},we=function(b,d,e,f,h,m){var p=e.id;h=this.gl.viewportWidth/this.maxScaling;var g=this.gl.viewportHeight/this.maxScaling,v=this.settings.renderBlurredOpacity,k=this.jitterVectors.length,l=this.ssaaFramesCnt;this.screenshotting=
!0;this.settings.renderBlurredOpacity=!1;var r=md.call(this);n.call(this,b,d);vb.call(this,16);var q=this.currentCamera,t=$c.call(this,b,d,!0),w=this.gl.floatTextures?1:4,B=[];if(this.gl.floatTextures){var A=this.gl.createTexture();this.gl.bindTexture(this.gl.TEXTURE_2D,A);this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR);this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR);this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,
this.gl.CLAMP_TO_EDGE);this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE);this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA32F,b,d,0,this.gl.RGBA,this.gl.FLOAT,null);B.push(A)}else for(var O=0;O<w;++O)A=this.gl.createTexture(),this.gl.bindTexture(this.gl.TEXTURE_2D,A),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,
this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,b,d,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,null),B.push(A);this.gl.bindTexture(this.gl.TEXTURE_2D,null);var V=this.jitterVectors.length/B.length;w=this.backgroundTexture;this.backgroundTexture=null;A=this.clearColor.a;var E=this.clearColor.r,I=this.clearColor.g,P=this.clearColor.b;this.gl.viewport(0,0,b,d);this.gl.scissor(0,
0,b,d);this.gl.enable(this.gl.SCISSOR_TEST);Wa.call(this,stage.extend(!0,{},this.currentCamera,f));nb.call(this,!0,!0);Eb.call(this,this.scene,this.settings.nbFilterPasses,!0);for(var N in this.scene.polylists)e=this.scene.polylists[N],e.isHidden=e.id!=p;this.scene.hasSomeFur&&zc.call(this,b,d);f=sc.call(this,b,d);this.gl.disable(this.gl.BLEND);for(O=0;O<this.jitterVectors.length;++O)this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.globalFramebuffer.framebuffer),this.gl.clear(this.gl.DEPTH_BUFFER_BIT),
this.ssaaFramesCnt=O+1,mc.call(this),this.clearColor.r=0,this.clearColor.g=0,this.clearColor.b=0,this.clearColor.a=0,qb.call(this,!0),this.clearColor.a=A,this.clearColor.r=E,this.clearColor.g=I,this.clearColor.b=P,$b.call(this,this.globalFramebuffer.framebuffer),Ac.call(this),N=Math.floor(O/V),N==O/V?(this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,t.framebuffer),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,B[N],0),this.gl.clearColor(0,0,0,0),this.gl.clear(this.gl.COLOR_BUFFER_BIT)):
this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,t.framebuffer),Xa.call(this,this.globalFramebuffer.globalTexture,1/V,!1);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,t.framebuffer);this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,t.texture,0);this.gl.clearColor(0,0,0,0);this.gl.clear(this.gl.COLOR_BUFFER_BIT);for(O=0;O<B.length;++O)Xa.call(this,B[O],1/B.length,!1);this.clearColor.a=1;this.gl.colorMask(!1,!1,!1,!0);for(O=0;O<this.jitterVectors.length;++O)this.gl.blendFunc(this.gl.ZERO,
this.gl.ONE_MINUS_SRC_ALPHA),this.gl.blendFunc3=this.gl.blendFunc,this.gl.blendFunc=function(b){return function(d,e){b.blendFunc3(b.ZERO,e)}}(this.gl),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.globalFramebuffer.framebuffer),this.gl.clear(this.gl.DEPTH_BUFFER_BIT),this.ssaaFramesCnt=O+1,mc.call(this),qb.call(this,!0),$b.call(this,this.globalFramebuffer.framebuffer),this.gl.blendFunc=this.gl.blendFunc3,Ac.call(this),N=Math.floor(O/V),N==O/V?(this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,t.framebuffer2),
this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,B[N],0),this.gl.clearColor(0,0,0,0),this.gl.colorMask(!0,!0,!0,!0),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.gl.colorMask(!1,!1,!1,!0)):this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,t.framebuffer2),Xa.call(this,this.globalFramebuffer.globalTexture,1/V,!1,!0),this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA);this.gl.colorMask(!0,!0,!0,!0);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,t.framebuffer2);
this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,t.texture2,0);this.gl.clearColor(0,0,0,0);this.gl.clear(this.gl.COLOR_BUFFER_BIT);for(O=0;O<B.length;++O)Xa.call(this,B[O],1/B.length,!1);b=Ud.call(this,t.framebuffer,t.framebuffer2,b,d,!0,f);q&&(Wa.call(this,q),nb.call(this,!0,!0),Eb.call(this,this.scene,this.settings.nbFilterPasses,!0));this.backgroundTexture=w;this.clearColor.a=A;this.settings.renderBlurredOpacity=v;ed.call(this,r);for(O in this.scene.polylists)e=
this.scene.polylists[O],e.isHidden=!1;vb.call(this,k);n.call(this,h,g);this.screenshotting=!1;this.ssaaFramesCnt=l;mc.call(this);for(O=0;O<B.length;++O)this.gl.deleteTexture(B[O]);t.destroy();return b.toDataURL(void 0!==m?m:"image/png")},Od=function(b,d,e,f,h,m,p){var g=e.id;this.shaders.createShadowMapShader();var v=this.gl.viewportWidth/this.maxScaling,k=this.gl.viewportHeight/this.maxScaling,l=this.settings.depthAndNormalsReduction;this.screenshotting=!0;this.settings.depthAndNormalsReduction=
1;var r=this.backgroundTexture;this.backgroundTexture=null;var q=this.clearColor.a,t=this.clearColor.r,w=this.clearColor.g,B=this.clearColor.b;this.clearColor.r=0;this.clearColor.g=0;this.clearColor.b=0;this.clearColor.a=1;b*=f;d*=f;var A=md.call(this);n.call(this,b,d);if(h){var O=this.currentCamera;h.upReal||(h.upReal=vec3.create(h.up));Wa.call(this,stage.extend(!0,{},this.currentCamera,h));nb.call(this,!0,!0);Eb.call(this,this.scene,this.settings.nbFilterPasses,!0)}this.scene.hasSomeFur&&zc.call(this,
b,d);this.gl.viewport(0,0,b,d);this.gl.scissor(0,0,b,d);this.gl.enable(this.gl.SCISSOR_TEST);var V=yc.call(this,g);this.settings.depthAndNormalsReduction=l;l=$c.call(this,b,d,!0);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,l.framebuffer);this.gl.disable(this.gl.BLEND);this.gl.viewport(0,0,this.gl.viewportWidth,this.gl.viewportHeight);this.gl.scissor(0,0,this.gl.viewportWidth,this.gl.viewportHeight);this.gl.enable(this.gl.SCISSOR_TEST);for(var E in this.scene.polylists)e=this.scene.polylists[E],e.isHidden=
e.id!=g;qb.call(this,!0);$b.call(this,l.framebuffer);this.clearColor.a=1;this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,l.framebuffer2);this.gl.blendFunc(this.gl.ZERO,this.gl.ONE_MINUS_SRC_ALPHA);this.gl.blendFunc3=this.gl.blendFunc;this.gl.blendFunc=function(b){return function(d,e){b.blendFunc3(b.ZERO,e)}}(this.gl);this.gl.disable(this.gl.BLEND);this.gl.viewport(0,0,this.gl.viewportWidth,this.gl.viewportHeight);this.gl.scissor(0,0,this.gl.viewportWidth,this.gl.viewportHeight);this.gl.enable(this.gl.SCISSOR_TEST);
for(E in this.scene.polylists)e=this.scene.polylists[E],e.isHidden=e.id!=g;qb.call(this,!0);$b.call(this,l.framebuffer2);this.gl.colorMask(!0,!0,!0,!0);this.gl.blendFunc=this.gl.blendFunc3;this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA);this.backgroundTexture=r;this.clearColor.a=q;this.clearColor.r=t;this.clearColor.g=w;this.clearColor.b=B;h&&(Wa.call(this,O),nb.call(this,!0,!0),Eb.call(this,this.scene,this.settings.nbFilterPasses,!0));for(E in this.scene.polylists)e=this.scene.polylists[E],
e.isHidden=!1;h=Fd.call(this,l.framebuffer,l.framebuffer2,b,d,!0,V);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null);l.destroy();ed.call(this,A);n.call(this,v,k);this.screenshotting=!1;if(!m){m=h.getContext("2d").getImageData(0,0,b,d);v=!0;for(E=3;E<4*b*d&&v;E+=4)m.data[E]&&(v=!1);if(v)return null}b/=f;d/=f;f=document.createElement("canvas");f.width=b;f.height=d;f.getContext("2d").drawImage(h,0,0,b,d);return f.toDataURL(void 0!==p?p:"image/png")},Yd=function(b,d,e,f){b=Math.max(Math.round(b),1);
d=Math.max(Math.round(d),1);var h=this.screenTools.textureWidth*this.screenTools.divisorRatio,m=this.screenTools.textureHeight*this.screenTools.divisorRatio;this.screenTools.setSize(b,d);if(f){var p=this.currentCamera;f.upReal||(f.upReal=vec3.create(f.up));Wa.call(this,stage.extend(!0,{},this.currentCamera,f))}this.shaders.useOneColorShader(this.renderingData);this.gl.uniformMatrix4fv(this.renderingData.locations.ghgsnpw,!1,this.renderingData.projectionMatrix);this.gl.uniformMatrix4fv(this.renderingData.locations.ampnorz,
!1,this.renderingData.viewMatrix);b=this.screenTools.renderPolylists(b,d,e);this.screenTools.setSize(h,m);f&&Wa.call(this,p);return b},Id=function(b,d,e,f){b=Math.max(Math.round(b),1);d=Math.max(Math.round(d),1);this.shaders.createShadowMapShader();var h=this.gl.viewportWidth/this.maxScaling,m=this.gl.viewportHeight/this.maxScaling,p=this.settings.depthAndNormalsReduction;this.screenshotting=!0;this.settings.depthAndNormalsReduction=1;var g=md.call(this);n.call(this,b,d);e&&e.length||(e=[this.currentCamera]);
var v=this.currentCamera,k=[];this.gl.viewport(0,0,b,d);this.gl.scissor(0,0,b,d);this.gl.clearColor(0,0,0,0);this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT);this.gl.enable(this.gl.POLYGON_OFFSET_FILL);var l=$c.call(this,b,d,!1),r;for(r in e){e[r].upReal||(e[r].upReal=vec3.create(e[r].up));Wa.call(this,stage.extend(!0,{},v,e[r]),!0);this.scene.hasSomeFur&&zc.call(this,b,d);this.gl.viewport(0,0,b,d);this.gl.scissor(0,0,b,d);this.gl.enable(this.gl.SCISSOR_TEST);var q=rd.call(this);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,
l.framebuffer);this.gl.disable(this.gl.BLEND);this.gl.viewport(0,0,this.gl.viewportWidth,this.gl.viewportHeight);this.gl.scissor(0,0,this.gl.viewportWidth,this.gl.viewportHeight);this.gl.enable(this.gl.SCISSOR_TEST);var t=void 0;this.gl.clearColor(0,0,0,0);this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT);this.gl.enable(this.gl.DEPTH_TEST);this.shaders.useDepthShader(this.renderingData);var w=!0;ub.call(this);wb.call(this);this.gl.uniform3f(this.renderingData.locations.xzwunne,this.renderingData.cameraPosition[0],
this.renderingData.cameraPosition[1],this.renderingData.cameraPosition[2]);this.gl.uniform2f(this.renderingData.locations.hrispnv,this.near,this.far);for(t in this.scene.polylistInstances){var B=this.scene.polylistInstances[t];this.settings.renderFur&&B.matAnim.shaderType.has(stage.emersya.viewer.modules.renderer.shaders.shaderTypes.PBR_FUR)?(w&&(this.shaders.useFurShader(this.renderingData,B.matAnim.shaderType),w=!1,ub.call(this),wb.call(this),this.gl.uniform3f(this.renderingData.locations.xzwunne,
this.renderingData.cameraPosition[0],this.renderingData.cameraPosition[1],this.renderingData.cameraPosition[2]),this.gl.uniform2f(this.renderingData.locations.hrispnv,this.near,this.far),this.gl.uniform1i(this.renderingData.locations.cfqxgas,1)),this.renderingData.textureCount=0,this.meshes.renderForFur(this.renderingData,B)):(w||(this.shaders.useDepthShader(this.renderingData),w=!0,ub.call(this),wb.call(this),this.gl.uniform3f(this.renderingData.locations.xzwunne,this.renderingData.cameraPosition[0],
this.renderingData.cameraPosition[1],this.renderingData.cameraPosition[2]),this.gl.uniform2f(this.renderingData.locations.hrispnv,this.near,this.far)),this.meshes.renderForShadowMaps(this.renderingData,B))}this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null);q=Fd.call(this,l.framebuffer,l.framebuffer2,b,d,!1,q,!0);t=document.createElement("canvas");t.width=b;t.height=d;t.getContext("2d").drawImage(q,0,0,b,d);k.push(t.toDataURL(void 0!==
f?f:"image/png"))}this.screenshotting=!1;this.settings.depthAndNormalsReduction=p;l.destroy();ed.call(this,g);Wa.call(this,v);n.call(this,h,m);return k[0]},ie=function(b,d,e,f,h){h&&(h=this.scene.texturesManager.getImage(h.layer.image_r_g_b_a.id))&&(h=h.glTexture);b=Math.max(Math.round(b),1);d=Math.max(Math.round(d),1);var m=this.gl.getParameter(this.gl.FRAMEBUFFER_BINDING),p=this.gl.getParameter(this.gl.VIEWPORT),g=this.gl.getParameter(this.gl.SCISSOR_BOX),n=this.gl.isEnabled(this.gl.STENCIL_TEST),
v=this.gl.isEnabled(this.gl.DEPTH_TEST),k=this.gl.isEnabled(this.gl.BLEND),l=this.gl.isEnabled(this.gl.CULL_FACE),r=this.gl.getParameter(this.gl.COLOR_CLEAR_VALUE),q=this.gl.getParameter(this.gl.COLOR_WRITEMASK);if(e=this.shaders.createFurMapBakingProgram(e)){var t=this.gl.createTexture();this.gl.bindTexture(this.gl.TEXTURE_2D,t);this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR);this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR);this.gl.texParameteri(this.gl.TEXTURE_2D,
this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE);this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE);this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,b,d,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,null);var w=this.gl.createRenderbuffer();this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,w);this.gl.renderbufferStorage(this.gl.RENDERBUFFER,this.gl.DEPTH_STENCIL,b,d);var B=this.gl.createFramebuffer();this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,B);this.gl.framebufferRenderbuffer(this.gl.FRAMEBUFFER,
this.gl.DEPTH_STENCIL_ATTACHMENT,this.gl.RENDERBUFFER,w);this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,t,0);this.gl.viewport(0,0,b,d);this.gl.scissor(0,0,b,d);this.gl.clearColor(0,0,0,1);this.gl.clear(this.gl.COLOR_BUFFER_BIT);h&&(this.gl.colorMask(!1,!0,!0,!1),Xa.call(this,h,1,!1));this.gl.disable(this.gl.BLEND);this.gl.disable(this.gl.DEPTH_TEST);this.gl.disable(this.gl.STENCIL_TEST);this.gl.disable(this.gl.CULL_FACE);this.gl.enable(this.gl.POLYGON_OFFSET_FILL);
this.gl.useProgram(e);var A=this.shaders.generateLocations(e);this.gl.enableVertexAttribArray(A.ufoizoh);this.gl.colorMask(!0,!h,!h,!1);this.gl.uniform2f(A.kfnexkv,b,d);this.gl.uniform1f(A.dcdsynq,f);this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.uvBufferScreen);this.gl.vertexAttribPointer(this.renderingData.locations.ufoizoh,2,this.gl.FLOAT,!1,0,0);this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.elementsBufferScreen);this.gl.drawElements(this.gl.TRIANGLES,6,this.gl.UNSIGNED_SHORT,0);this.gl.flush();
this.gl.finish();f=new Uint8Array(b*d*4);this.gl.readPixels(0,0,b,d,this.gl.RGBA,this.gl.UNSIGNED_BYTE,f);h=document.createElement("canvas");h.width=b;h.height=d;A=h.getContext("2d");b=A.createImageData(b,d);b.data.set(f);A.putImageData(b,0,0);this.gl.useProgram(null);this.gl.deleteProgram(e);this.gl.deleteTexture(t);this.gl.deleteRenderbuffer(w);this.gl.deleteFramebuffer(B);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,m);this.gl.viewport.apply(this.gl,p);this.gl.scissor.apply(this.gl,g);n&&this.gl.enable(this.gl.STENCIL_TEST);
v&&this.gl.enable(this.gl.DEPTH_TEST);k&&this.gl.enable(this.gl.BLEND);l&&this.gl.enable(this.gl.CULL_FACE);this.gl.clearColor.apply(this.gl,r);this.gl.colorMask.apply(this.gl,q);return h.toDataURL("image/png",1)}},$c=function(b,d,e){var f={texture:null,framebuffer:null,renderbuffer:null,texture2:null,framebuffer2:null,renderbuffer2:null,gl:this.gl};f.destroy=stage.setContext(function(){this.texture&&this.gl.deleteTexture(this.texture);this.texture2&&this.gl.deleteTexture(this.texture2);this.renderbuffer&&
this.gl.deleteRenderbuffer(this.renderbuffer);this.renderbuffer2&&this.gl.deleteRenderbuffer(this.renderbuffer2);this.framebuffer&&this.gl.deleteFramebuffer(this.framebuffer);this.framebuffer2&&this.gl.deleteFramebuffer(this.framebuffer2);this.gl.bindTexture(this.gl.TEXTURE_2D,null);this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,null);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null)},f);f.texture=this.gl.createTexture();this.gl.bindTexture(this.gl.TEXTURE_2D,f.texture);this.gl.texParameteri(this.gl.TEXTURE_2D,
this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR);this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR);this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE);this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE);this.gl.floatTextures?this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA32F,b,d,0,this.gl.RGBA,this.gl.FLOAT,null):this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,b,d,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,
null);f.renderbuffer=this.gl.createRenderbuffer();this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,f.renderbuffer);this.gl.renderbufferStorage(this.gl.RENDERBUFFER,this.gl.DEPTH_STENCIL,b,d);f.framebuffer=this.gl.createFramebuffer();this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,f.framebuffer);this.gl.framebufferRenderbuffer(this.gl.FRAMEBUFFER,this.gl.DEPTH_STENCIL_ATTACHMENT,this.gl.RENDERBUFFER,f.renderbuffer);this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,
f.texture,0);e&&(f.texture2=this.gl.createTexture(),this.gl.bindTexture(this.gl.TEXTURE_2D,f.texture2),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.floatTextures?this.gl.texImage2D(this.gl.TEXTURE_2D,
0,this.gl.RGBA32F,b,d,0,this.gl.RGBA,this.gl.FLOAT,null):this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,b,d,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,null),f.renderbuffer2=this.gl.createRenderbuffer(),this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,f.renderbuffer2),this.gl.renderbufferStorage(this.gl.RENDERBUFFER,this.gl.DEPTH_STENCIL,b,d),f.framebuffer2=this.gl.createFramebuffer(),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,f.framebuffer2),this.gl.framebufferRenderbuffer(this.gl.FRAMEBUFFER,this.gl.DEPTH_STENCIL_ATTACHMENT,
this.gl.RENDERBUFFER,f.renderbuffer2),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,f.texture2,0));this.gl.bindTexture(this.gl.TEXTURE_2D,null);this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,null);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null);return f},Fd=function(b,d,e,f,h,m,p){var g=document.createElement("canvas");g.width=e;g.height=f;var n=g.getContext("2d"),v=n.createImageData(e,f),k=[255,255,255];if(this.gl.floatTextures){this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,
b);b=new Float32Array(4*e*f);this.gl.readPixels(0,0,e,f,this.gl.RGBA,this.gl.FLOAT,b);var l=255,r=1;if(h)for(this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,d),d=new Float32Array(4*e*f),this.gl.readPixels(0,0,e,f,this.gl.RGBA,this.gl.FLOAT,d),t=0;t<e;++t)for(w=0;w<f;++w)if(0<m[4*(t+e*(f-w-1))]){h=vec3.create([0,0,0]);h[0]=b[4*(t+e*(f-w-1))]/r;h[1]=b[4*(t+e*(f-w-1))+1]/r;h[2]=b[4*(t+e*(f-w-1))+2]/r;var q=b[4*(t+e*(f-w-1))+3]/r;q?vec3.scale(h,1/q):vec3.scale(h,0);v.data[4*(t+e*w)]=255*h[0];v.data[4*(t+
e*w)+1]=255*h[1];v.data[4*(t+e*w)+2]=255*h[2];v.data[4*(t+e*w)+3]=255*q}else m[4*(t+e*(f-w-1))+3]==r?(v.data[4*(t+e*w)]=b[4*(t+e*(f-w-1))]*l,v.data[4*(t+e*w)+1]=b[4*(t+e*(f-w-1))+1]*l,v.data[4*(t+e*w)+2]=b[4*(t+e*(f-w-1))+2]*l,v.data[4*(t+e*w)+3]=255):0!==b[4*(t+e*(f-w-1))+3]?(h=vec3.create([0,0,0]),h[0]=b[4*(t+e*(f-w-1))]/r,h[1]=b[4*(t+e*(f-w-1))+1]/r,h[2]=b[4*(t+e*(f-w-1))+2]/r,q=1-d[4*(t+e*(f-w-1))+3]/r,0<m[4*(t+e*(f-w-1))+3]&&(q=q?1-d[4*(t+e*(f-w-1))+3]/r*(1-m[4*(t+e*(f-w-1))+3]/r):m[4*(t+e*(f-
w-1))+3]/r),q?vec3.scale(h,1/q):vec3.scale(h,0),v.data[4*(t+e*w)]=255*h[0],v.data[4*(t+e*w)+1]=255*h[1],v.data[4*(t+e*w)+2]=255*h[2],v.data[4*(t+e*w)+3]=255*q):(v.data[4*(t+e*w)]=0,v.data[4*(t+e*w)+1]=0,v.data[4*(t+e*w)+2]=0,v.data[4*(t+e*w)+3]=0);else for(var t=0;t<e;++t)for(var w=0;w<f;++w)0!=m[4*(t+e*(f-w-1))+3]?(v.data[4*(t+e*w)]=255*b[4*(t+e*(f-w-1))],v.data[4*(t+e*w)+1]=255*b[4*(t+e*(f-w-1))+1],v.data[4*(t+e*w)+2]=255*b[4*(t+e*(f-w-1))+2],v.data[4*(t+e*w)+3]=255):(v.data[4*(t+e*w)]=255*b[4*
(t+e*(f-w-1))]/b[4*(t+e*(f-w-1))+3],v.data[4*(t+e*w)+1]=255*b[4*(t+e*(f-w-1))+1]/b[4*(t+e*(f-w-1))+3],v.data[4*(t+e*w)+2]=255*b[4*(t+e*(f-w-1))+2]/b[4*(t+e*(f-w-1))+3],v.data[4*(t+e*w)+3]=255*b[4*(t+e*(f-w-1))+3]),255==v.data[4*(t+e*w)+3]&&(v.data[4*(t+e*w)]<k[0]&&(k[0]=v.data[4*(t+e*w)]),v.data[4*(t+e*w)+1]<k[1]&&(k[1]=v.data[4*(t+e*w)+1]),v.data[4*(t+e*w)+2]<k[2]&&(k[2]=v.data[4*(t+e*w)+2]))}else if(this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,b),b=new Uint8Array(4*e*f),this.gl.readPixels(0,0,e,
f,this.gl.RGBA,this.gl.UNSIGNED_BYTE,b),l=1,r=255,h)for(this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,d),d=new Uint8Array(4*e*f),this.gl.readPixels(0,0,e,f,this.gl.RGBA,this.gl.UNSIGNED_BYTE,d),t=0;t<e;++t)for(w=0;w<f;++w)0<m[4*(t+e*(f-w-1))]?(h=vec3.create([0,0,0]),h[0]=b[4*(t+e*(f-w-1))]/r,h[1]=b[4*(t+e*(f-w-1))+1]/r,h[2]=b[4*(t+e*(f-w-1))+2]/r,(q=b[4*(t+e*(f-w-1))+3]/r)?vec3.scale(h,1/q):vec3.scale(h,0),v.data[4*(t+e*w)]=255*h[0],v.data[4*(t+e*w)+1]=255*h[1],v.data[4*(t+e*w)+2]=255*h[2],v.data[4*
(t+e*w)+3]=255*q):m[4*(t+e*(f-w-1))+3]==r?(v.data[4*(t+e*w)]=b[4*(t+e*(f-w-1))]*l,v.data[4*(t+e*w)+1]=b[4*(t+e*(f-w-1))+1]*l,v.data[4*(t+e*w)+2]=b[4*(t+e*(f-w-1))+2]*l,v.data[4*(t+e*w)+3]=255):0!==b[4*(t+e*(f-w-1))+3]?(h=vec3.create([0,0,0]),h[0]=b[4*(t+e*(f-w-1))]/r,h[1]=b[4*(t+e*(f-w-1))+1]/r,h[2]=b[4*(t+e*(f-w-1))+2]/r,q=1-d[4*(t+e*(f-w-1))+3]/r,0<m[4*(t+e*(f-w-1))+3]&&(q=q?1-d[4*(t+e*(f-w-1))+3]/r*(1-m[4*(t+e*(f-w-1))+3]/r):m[4*(t+e*(f-w-1))+3]/r),q?vec3.scale(h,1/q):vec3.scale(h,0),v.data[4*
(t+e*w)]=255*h[0],v.data[4*(t+e*w)+1]=255*h[1],v.data[4*(t+e*w)+2]=255*h[2],v.data[4*(t+e*w)+3]=255*q):(v.data[4*(t+e*w)]=0,v.data[4*(t+e*w)+1]=0,v.data[4*(t+e*w)+2]=0,v.data[4*(t+e*w)+3]=0);else for(t=0;t<e;++t)for(w=0;w<f;++w)0!=m[4*(t+e*(f-w-1))+3]||0!=m[4*(t+e*(f-w-1))+1]||0!=m[4*(t+e*(f-w-1))+2]||0!=m[4*(t+e*(f-w-1))+3]?(v.data[4*(t+e*w)]=b[4*(t+e*(f-w-1))],v.data[4*(t+e*w)+1]=b[4*(t+e*(f-w-1))+1],v.data[4*(t+e*w)+2]=b[4*(t+e*(f-w-1))+2],v.data[4*(t+e*w)+3]=255):(v.data[4*(t+e*w)]=255*b[4*(t+
e*(f-w-1))]/b[4*(t+e*(f-w-1))+3],v.data[4*(t+e*w)+1]=255*b[4*(t+e*(f-w-1))+1]/b[4*(t+e*(f-w-1))+3],v.data[4*(t+e*w)+2]=255*b[4*(t+e*(f-w-1))+2]/b[4*(t+e*(f-w-1))+3],v.data[4*(t+e*w)+3]=b[4*(t+e*(f-w-1))+3]),255==v.data[4*(t+e*w)+3]&&(v.data[4*(t+e*w)]<k[0]&&(k[0]=v.data[4*(t+e*w)]),v.data[4*(t+e*w)+1]<k[1]&&(k[1]=v.data[4*(t+e*w)+1]),v.data[4*(t+e*w)+2]<k[2]&&(k[2]=v.data[4*(t+e*w)+2]));if(p)for(t=0;t<e;++t)for(w=0;w<f;++w)0==v.data[4*(t+e*w)+3]&&(v.data[4*(t+e*w)]=k[0],v.data[4*(t+e*w)+1]=k[1],v.data[4*
(t+e*w)+2]=k[2],v.data[4*(t+e*w)+3]=255);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null);n.putImageData(v,0,0);return g},Ud=function(b,d,e,f,h,m){var p=document.createElement("canvas");p.width=e;p.height=f;var g=p.getContext("2d"),n=g.createImageData(e,f);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,b);if(this.gl.floatTextures){b=new Float32Array(4*e*f);this.gl.readPixels(0,0,e,f,this.gl.RGBA,this.gl.FLOAT,b);var v=255;var k=1}else b=new Uint8Array(4*e*f),this.gl.readPixels(0,0,e,f,this.gl.RGBA,
this.gl.UNSIGNED_BYTE,b),v=1,k=255;if(h)for(this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,d),this.gl.floatTextures?(d=new Float32Array(4*e*f),this.gl.readPixels(0,0,e,f,this.gl.RGBA,this.gl.FLOAT,d)):(d=new Uint8Array(4*e*f),this.gl.readPixels(0,0,e,f,this.gl.RGBA,this.gl.UNSIGNED_BYTE,d)),l=0;l<e;++l)for(q=0;q<f;++q)if(0<m[4*(l+e*(f-q-1))]){h=vec3.create([0,0,0]);h[0]=b[4*(l+e*(f-q-1))]/k;h[1]=b[4*(l+e*(f-q-1))+1]/k;h[2]=b[4*(l+e*(f-q-1))+2]/k;var r=b[4*(l+e*(f-q-1))+3]/k;r?vec3.scale(h,1/r):vec3.scale(h,
0);n.data[4*(l+e*q)]=255*h[0];n.data[4*(l+e*q)+1]=255*h[1];n.data[4*(l+e*q)+2]=255*h[2];n.data[4*(l+e*q)+3]=255*r}else m[4*(l+e*(f-q-1))+3]==k?(n.data[4*(l+e*q)]=b[4*(l+e*(f-q-1))]*v,n.data[4*(l+e*q)+1]=b[4*(l+e*(f-q-1))+1]*v,n.data[4*(l+e*q)+2]=b[4*(l+e*(f-q-1))+2]*v,n.data[4*(l+e*q)+3]=255):0!==b[4*(l+e*(f-q-1))+3]?(h=vec3.create([0,0,0]),h[0]=b[4*(l+e*(f-q-1))]/k,h[1]=b[4*(l+e*(f-q-1))+1]/k,h[2]=b[4*(l+e*(f-q-1))+2]/k,r=1-d[4*(l+e*(f-q-1))+3]/k,0<m[4*(l+e*(f-q-1))+3]&&(r=r?1-d[4*(l+e*(f-q-1))+
3]/k*(1-m[4*(l+e*(f-q-1))+3]/k):m[4*(l+e*(f-q-1))+3]/k),r?vec3.scale(h,1/r):vec3.scale(h,0),n.data[4*(l+e*q)]=255*h[0],n.data[4*(l+e*q)+1]=255*h[1],n.data[4*(l+e*q)+2]=255*h[2],n.data[4*(l+e*q)+3]=255*r):(n.data[4*(l+e*q)]=0,n.data[4*(l+e*q)+1]=0,n.data[4*(l+e*q)+2]=0,n.data[4*(l+e*q)+3]=0);else for(var l=0;l<e;++l)for(var q=0;q<f;++q)0!=m[4*(l+e*(f-q-1))+3]?(n.data[4*(l+e*q)]=b[4*(l+e*(f-q-1))]*v,n.data[4*(l+e*q)+1]=b[4*(l+e*(f-q-1))+1]*v,n.data[4*(l+e*q)+2]=b[4*(l+e*(f-q-1))+2]*v,n.data[4*(l+e*
q)+3]=255):(n.data[4*(l+e*q)]=255*b[4*(l+e*(f-q-1))]/b[4*(l+e*(f-q-1))+3],n.data[4*(l+e*q)+1]=255*b[4*(l+e*(f-q-1))+1]/b[4*(l+e*(f-q-1))+3],n.data[4*(l+e*q)+2]=255*b[4*(l+e*(f-q-1))+2]/b[4*(l+e*(f-q-1))+3],n.data[4*(l+e*q)+3]=b[4*(l+e*(f-q-1))+3]*v);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null);g.putImageData(n,0,0);return p},md=function(){var b={generatingSSAA:this.generatingSSAA,maxScaling:this.maxScaling,minScaling:this.minScaling,currentScaling:this.currentScaling};this.generatingSSAA&&jd.call(this);
this.currentScaling=this.minScaling=this.maxScaling=1;this.settings.renderSSAO&&(b.ssaoHD=this.ssaoHD,this.ssaoHD=!0);this.scene.hasSomeFur&&this.renderingData.furQuality<this.settings.furQualityHD&&(b.backFurQuality=this.backFurQuality,this.backFurQuality=b.furQuality=this.renderingData.furQuality,this.renderingData.furQuality=this.settings.furQualityHD,this.needsComputeFurlayers=!0);this.disableGlow&&this.scene.hasSomeGlow&&!this.settings.renderGlow&&(b.disableGlow=this.disableGlow,b.renderGlow=
this.settings.renderGlow,this.disableGlow=!1,this.settings.renderGlow=!0);this.disableSpecularGlow&&this.scene.hasSomeSpecularGlow&&!this.settings.renderSpecularGlow&&(b.disableSpecularGlow=this.disableSpecularGlow,b.renderSpecularGlow=this.settings.renderSpecularGlow,this.disableSpecularGlow=!1,this.settings.renderSpecularGlow=!0);if(this.settings.screenSpaceRefractDistance&&!this.scene.renderingSettings.screenSpaceRoughness){b.screenSpaceRoughness=this.scene.renderingSettings.screenSpaceRoughness;
b.roughnessPolyIntances=[];this.scene.renderingSettings.screenSpaceRoughness=!0;for(var d=0;d<this.scene.polylistInstances.length;++d){var e=this.scene.polylistInstances[d],f=e.matAnim.shaderType,h=f.clone();f.has(stage.emersya.viewer.modules.renderer.shaders.shaderTypes.SCREENSPACE_REFRACTION)&&(e.matAnim.getCurrentMaterial().roughness&&e.matAnim.getCurrentMaterial().roughness.gloss&&.9>e.matAnim.getCurrentMaterial().roughness.intensity||e.matAnim.getCurrentMaterial().roughness&&!e.matAnim.getCurrentMaterial().roughness.gloss&&
.1<e.matAnim.getCurrentMaterial().roughness.intensity?f.set(stage.emersya.viewer.modules.renderer.shaders.shaderTypes.SCREENSPACE_ROUGHNESS,!0):!f.has(stage.emersya.viewer.modules.renderer.shaders.shaderTypes.PBR)&&e.matAnim.getCurrentMaterial().shininess&&.95>e.matAnim.getCurrentMaterial().shininess.intensity/100&&f.set(stage.emersya.viewer.modules.renderer.shaders.shaderTypes.SCREENSPACE_ROUGHNESS,!0));h.value()!=f.value&&b.roughnessPolyIntances.push(e)}}Object.assign(b,{stableFramerateCounter:this.stableFramerateCounter,
scalingFrameTimes:this.scalingFrameTimes.map(function(b){return b}),scalingFrameTimesIndex:this.scalingFrameTimesIndex});this.stableFramerateCounter=0;this.scalingFrameTimes=[];this.scalingFrameTimesIndex=-1;return b},ed=function(b){b.generatingSSAA&&jd.call(this);this.maxScaling=b.maxScaling;this.minScaling=b.minScaling;this.currentScaling=b.currentScaling;void 0!==b.ssaoHD&&(this.ssaoHD=b.ssaoHD);void 0!==b.backFurQuality&&void 0!==b.furQuality&&(this.backFurQuality=b.backFurQuality,this.renderingData.furQuality=
b.furQuality,this.needsComputeFurlayers=!0);void 0!==b.disableGlow&&void 0!==b.renderGlow&&(this.disableGlow=b.disableGlow,this.settings.renderGlow=b.renderGlow);void 0!==b.disableSpecularGlow&&void 0!==b.renderSpecularGlow&&(this.disableSpecularGlow=b.disableSpecularGlow,this.settings.renderSpecularGlow=b.renderSpecularGlow);if(!1===b.screenSpaceRoughness&&(this.scene.renderingSettings.screenSpaceRoughness=!1,b.roughnessPolyIntances))for(var d=0;d<b.roughnessPolyIntances.length;++d){var e=b.roughnessPolyIntances[d].matAnim.shaderType;
e.has(stage.emersya.viewer.modules.renderer.shaders.shaderTypes.SCREENSPACE_REFRACTION)&&e.set(stage.emersya.viewer.modules.renderer.shaders.shaderTypes.SCREENSPACE_ROUGHNESS,!1)}this.stableFramerateCounter=b.stableFramerateCounter;this.scalingFrameTimes=b.scalingFrameTimes.map(function(b){return b});this.scalingFrameTimesIndex=b.scalingFrameTimesIndex},Zd=function(){if(!this.scene)return[];for(var b={normal:[],postProcess:{opaque:[],opaqueByShaderType:{}},highestPass:0},d={},e=0;e<this.scene.polylistInstances.length;++e){var f=
this.scene.polylistInstances[e],h=f.polylist,m=h.renderingPass,p=f.matAnim.shaderType;h.isWater||h.isMirror||!f.matAnim.isOpaque()&&p.has(stage.emersya.viewer.modules.renderer.shaders.shaderTypes.OPACITYBLUR)||(m>b.highestPass&&(b.highestPass=m),d[m]||(d[m]={number:m,opaque:[],transparent:[],opaqueByShaderType:{},transparentByShaderType:{}},b.normal.push(d[m])),m=d[m],f.matAnim.isOpaque()?(m.opaqueByShaderType[p.value()]||(m.opaqueByShaderType[p.value()]={shaderType:p,elements:[]},m.opaque.push(m.opaqueByShaderType[p.value()])),
p=m.opaqueByShaderType[p.value()].elements):(m.transparentByShaderType[p.value()]||(m.transparentByShaderType[p.value()]={shaderType:p,elements:[]},m.transparent.push(m.transparentByShaderType[p.value()])),p=m.transparentByShaderType[p.value()].elements),p.push({polylistId:h.id,materialName:f.materialTree.name,materialId:f.materialTree.id,materialTreeId:f.materialTree.id,fullyTransparent:0==f.matAnim.getCurrentMaterial().opacity.intensity}))}d=!1;for(e=0;e<this.scene.polylistInstances.length;++e)f=
this.scene.polylistInstances[e],h=f.polylist,p=f.matAnim.shaderType,h.isWater||h.isMirror||f.matAnim.isOpaque()||!p.has(stage.emersya.viewer.modules.renderer.shaders.shaderTypes.OPACITYBLUR)||(d=!0,b.postProcess.opaqueByShaderType[p.value()]||(b.postProcess.opaqueByShaderType[p.value()]={shaderType:p,elements:[]},b.postProcess.opaque.push(b.postProcess.opaqueByShaderType[p.value()])),b.postProcess.opaqueByShaderType[p.value()].elements.push({polylistId:h.id,materialName:f.materialTree.name,materialId:f.materialTree.id,
materialTreeId:f.materialTree.id,fullyTransparent:0==f.matAnim.getCurrentMaterial().opacity.intensity}));for(e=0;e<this.scene.polylistInstances.length;++e)f=this.scene.polylistInstances[e],h=f.polylist,h.isWater&&(d=!0,b.postProcess.opaqueByShaderType.water||(b.postProcess.opaqueByShaderType.water={shaderType:"water",elements:[]},b.postProcess.opaque.push(b.postProcess.opaqueByShaderType.water)),b.postProcess.opaqueByShaderType.water.elements.push({polylistId:h.id,materialName:f.materialTree.name,
materialId:f.materialTree.id,materialTreeId:f.materialTree.id,fullyTransparent:!1}));for(e=0;e<this.scene.polylistInstances.length;++e)f=this.scene.polylistInstances[e],h=f.polylist,h.isMirror&&(d=!0,b.postProcess.opaqueByShaderType.mirror||(b.postProcess.opaqueByShaderType.mirror={shaderType:"mirror",elements:[]},b.postProcess.opaque.push(b.postProcess.opaqueByShaderType.mirror)),b.postProcess.opaqueByShaderType.mirror.elements.push({polylistId:h.id,materialName:f.materialTree.name,materialId:f.materialTree.id,
materialTreeId:f.materialTree.id,fullyTransparent:!1}));d||(b.postProcess=null);return b},Gd=function(b,d,e,f){b=stage.emersya.viewer.modules.renderer.shaders.shaderTypes;f.polylist=e;d=new stage.emersya.viewer.modules.renderer.animations.matAnimManager(this.scene,this.scene.materials[d.id],f);e=this.scene.texturesManager.getTexturesFromMaterial(d.currentMaterial);f=[];for(var h=0;h<e.length;++h)f.push(e[h].ready),e[h].ready=!0;d.updateShaderType();for(h=0;h<e.length;++h)e[h].ready=f[h];e={};f=d.shaderType.clone();
for(var m in b)e[m]=d.shaderType.has(b[m]),5>b[m][0]&&(e[m]=!!e[m]);d.destroy();return{shaderType:f,separatedType:e}},je=function(b,d){if(!this.scene)return{};var e={isHidden:function(){return!1},polylist:{customMaterial:{}},customMaterial:{}},f={},h={},m=1,p={};for(v in this.scene.polylists){var g=this.scene.polylists[v];-1!==d.indexOf(g.materialTree.id)&&(p[g.materialTree.id]||(p[g.materialTree.id]=[]),p[g.materialTree.id].push(g))}for(var n in this.scene.materialTrees){var v=this.scene.materialTrees[n];
if(!v.fromModel&&-1!==d.indexOf(v.id)){g=v.name;f[g]||(f[g]={});for(var k in this.scene.materialsContent.materialSettingsByName[v.id]){var l=this.scene.materialsContent.materialSettingsByName[v.id][k];f[g][k]||(f[g][k]={});var r=[],q=[];if(b){for(var t in p[v.id]){var w=p[v.id][t];w.customMaterialValues.length?r.push(w):q.push(w)}q.length&&(q=Gd.call(this,v,l,q[0],e),h[q.shaderType.value()]||(h[q.shaderType.value()]=m++),f[g][k]["All meshes"]={type:q.separatedType,index:h[q.shaderType.value()],isDefault:v.defaultMaterialId==
l.id});for(q=0;q<r.length;++q)w=Gd.call(this,v,l,r[q],e),h[w.shaderType.value()]||(h[w.shaderType.value()]=m++),f[g][k][r[q].name]={type:w.separatedType,index:h[w.shaderType.value()],isDefault:v.defaultMaterialId==l.id}}else l=Gd.call(this,v,l,{customMaterial:{}},e),h[l.shaderType.value()]||(h[l.shaderType.value()]=m++),f[g][k]["All meshes"]={type:l.separatedType,index:h[l.shaderType.value()],isDefault:!1}}}}return f},Rd=function(){return{id:-1E8,wrap_s:"REPEAT",wrap_t:"REPEAT",repeat_x:1,repeat_y:1,
offset_x:0,offset_y:0,pivot_x:.5,pivot_y:.5,uv_tansform_order:0,angle:0,use_mipmap:!0,min_filter:"LINEAR_MIPMAP_LINEAR",mag_filter:"LINEAR",uvsrc:0,anisotropy:4,use_real_measurements:!1,layer:{image_r_g_b_a:{id:-1E8,name:"grid",width_mm:1E3,height_mm:1E3,texture_mode:"TEXTURE_2D",default_source_image:{id:-1E8,name:"grid",file_path:stage.emersya.dataManager().getTexturesFilePath()+"uvMap/grid.png",real_file_path:stage.emersya.dataManager().getTexturesFilePath()+"uvMap/grid.png",file_type:"png",width:4096,
height:4096,fileSize:1},source_images:[{id:-1E8,name:"grid",file_path:stage.emersya.dataManager().getTexturesFilePath()+"uvMap/grid.png",real_file_path:stage.emersya.dataManager().getTexturesFilePath()+"uvMap/grid.png",file_type:"png",width:4096,height:4096,fileSize:1}]}}}},Zc=function(b,d,e,f){return 0>e||0>f?0:b[f*d+e]},Ld=function(b,d,e){var f=e.x,h=e.y,m=e.x+e.width-1,p=e.y,g=e.x,n=e.y+e.height-1;return Zc(b,d,e.x+e.width-1,e.y+e.height-1)+Zc(b,d,f,h)-Zc(b,d,m,p)-Zc(b,d,g,n)},Kd=function(b,d,
e,f,h){if(2>f.width||2>f.height||0==e)h.push(f);else{if(f.width>f.height){var m={x:f.x,y:f.y,width:1,height:f.height,sum:-1};for(var p=1;p<=f.width&&!(m.width=p,m.sum=Ld(b,d,m),2*m.sum>=f.sum);++p);f={x:f.x+m.width-1,y:f.y,width:f.width-m.width,height:f.height,sum:f.sum-m.sum}}else{m={x:f.x,y:f.y,width:f.width,height:1,sum:-1};for(p=1;p<=f.height&&!(m.height=p,m.sum=Ld(b,d,m),2*m.sum>=f.sum);++p);f={x:f.x,y:f.y+m.height-1,width:f.width,height:f.height-m.height,sum:f.sum-m.sum}}Kd(b,d,e-1,m,h);Kd(b,
d,e-1,f,h)}};return l});stage.provide("emersya.viewer.modules.renderer.extendedWebGLContext");
stage.register.call(stage.emersya.viewer.modules.renderer,"extendedWebGLContext",function(){var b=function(b){this.gl=b;this.gl.webgl2||(this.gl.RGBA32F=this.gl.RGBA,this.gl.RGB32F=this.gl.RGB,this.gl.RGBA16F=this.gl.RGBA);this.gl.enable2=this.gl.enable;b.enable=stage.setContext(d,this);this.gl.disable2=this.gl.disable;b.disable=stage.setContext(u,this);this.gl.useProgram2=this.gl.useProgram;b.useProgram=stage.setContext(k,this);this.gl.bindFramebuffer2=this.gl.bindFramebuffer;b.bindFramebuffer=stage.setContext(l,
this);this.gl.bindRenderbuffer2=this.gl.bindRenderbuffer;b.bindRenderbuffer=stage.setContext(g,this);this.gl.framebufferTexture2D2=this.gl.framebufferTexture2D;b.framebufferTexture2D=stage.setContext(q,this);this.gl.framebufferRenderbuffer2=this.gl.framebufferRenderbuffer;b.framebufferRenderbuffer=stage.setContext(t,this);this.gl.polygonOffset2=this.gl.polygonOffset;b.polygonOffset=stage.setContext(r,this);this.gl.frontFace2=this.gl.frontFace;b.frontFace=stage.setContext(f,this);this.gl.activeTexture2=
this.gl.activeTexture;b.activeTexture=stage.setContext(n,this);this.gl.texImage2D2=this.gl.texImage2D;b.texImage2D=stage.setContext(B,this);this.gl.renderbufferStorage2=this.gl.renderbufferStorage;b.renderbufferStorage=stage.setContext(w,this);this.gl.uniform1i2=this.gl.uniform1i;b.uniform1i=stage.setContext(D,this);this.gl.uniform1ui2=this.gl.webgl2?this.gl.uniform1ui:this.gl.uniform1i;b.uniform1ui=stage.setContext(A,this);this.gl.uniform1f2=this.gl.uniform1f;b.uniform1f=stage.setContext(H,this);
this.gl.uniform2i2=this.gl.uniform2i;b.uniform2i=stage.setContext(e,this);this.gl.uniform2ui2=this.gl.webgl2?this.gl.uniform2ui:this.gl.uniform2i;b.uniform2ui=stage.setContext(E,this);this.gl.uniform2f2=this.gl.uniform2f;b.uniform2f=stage.setContext(F,this);this.gl.uniform3i2=this.gl.uniform3i;b.uniform3i=stage.setContext(p,this);this.gl.uniform3ui2=this.gl.webgl2?this.gl.uniform3ui:this.gl.uniform3i;b.uniform3ui=stage.setContext(m,this);this.gl.uniform3f2=this.gl.uniform3f;b.uniform3f=stage.setContext(h,
this);this.gl.uniform4i2=this.gl.uniform4i;b.uniform4i=stage.setContext(v,this);this.gl.uniform4ui2=this.gl.webgl2?this.gl.uniform4ui:this.gl.uniform4i;b.uniform4ui=stage.setContext(I,this);this.gl.uniform4f2=this.gl.uniform4f;b.uniform4f=stage.setContext(J,this);this.gl.uniform1iv2=this.gl.uniform1iv;b.uniform1iv=stage.setContext(M,this,"uniform1iv2");this.gl.uniform1fv2=this.gl.uniform1fv;b.uniform1fv=stage.setContext(M,this,"uniform1fv2");this.gl.uniform2fv2=this.gl.uniform2fv;b.uniform2fv=stage.setContext(M,
this,"uniform2fv2");this.gl.uniform2iv2=this.gl.uniform2iv;b.uniform2iv=stage.setContext(M,this,"uniform2iv2");this.gl.uniform3fv2=this.gl.uniform3fv;b.uniform3fv=stage.setContext(M,this,"uniform3fv2");this.gl.uniform3iv2=this.gl.uniform3iv;b.uniform3iv=stage.setContext(M,this,"uniform3iv2");this.gl.uniform4fv2=this.gl.uniform4fv;b.uniform4fv=stage.setContext(M,this,"uniform4fv2");this.gl.uniform4iv2=this.gl.uniform4iv;b.uniform4iv=stage.setContext(M,this,"uniform4iv2");this.gl.uniformMatrix2fv2=
this.gl.uniformMatrix2fv;b.uniformMatrix2fv=stage.setContext(T,this,"uniformMatrix2fv2");this.gl.uniformMatrix3fv2=this.gl.uniformMatrix3fv;b.uniformMatrix3fv=stage.setContext(T,this,"uniformMatrix3fv2");this.gl.uniformMatrix4fv2=this.gl.uniformMatrix4fv;b.uniformMatrix4fv=stage.setContext(T,this,"uniformMatrix4fv2");this.gl.enableVertexAttribArray2=this.gl.enableVertexAttribArray;b.enableVertexAttribArray=stage.setContext(U,this);this.gl.disableVertexAttribArray2=this.gl.disableVertexAttribArray;
b.disableVertexAttribArray=stage.setContext(R,this);this.gl.vertexAttribPointer2=this.gl.vertexAttribPointer;b.vertexAttribPointer=stage.setContext(aa,this);this.gl.finish_original=this.gl.finish;b.finish0=stage.setContext(C,this);b.finish1=stage.setContext(L,this);b.finish2=stage.setContext(K,this);b.finish3=stage.setContext(G,this);b.finish4=stage.setContext(S,this);b.finish5=stage.setContext(Y,this);b.finish6=stage.setContext(ia,this);b.finish7=stage.setContext(Q,this);b.finish8=stage.setContext(ta,
this);b.finish9=stage.setContext(ua,this);b.finish10=stage.setContext(ea,this);b.finish11=stage.setContext(oa,this);b.finish12=stage.setContext(ba,this);b.finish13=stage.setContext(ka,this);b.finish14=stage.setContext(Z,this);b.finish15=stage.setContext(da,this);b.finish16=stage.setContext(X,this);b.finish17=stage.setContext(Ha,this);b.finish18=stage.setContext(Ga,this);b.finish19=stage.setContext(Fa,this);b.finish20=stage.setContext(xa,this);b.finish21=stage.setContext(Ia,this);b.finish22=stage.setContext(qa,
this);b.finish23=stage.setContext(Va,this);b.finish24=stage.setContext(va,this);b.finish25=stage.setContext(la,this);b.finish26=stage.setContext(fa,this);b.finish27=stage.setContext(P,this);b.finish28=stage.setContext(Ba,this);b.finish29=stage.setContext(Ka,this);b.finish30=stage.setContext(wa,this);b.finish31=stage.setContext(Ja,this);b.finish32=stage.setContext(La,this);b.finish33=stage.setContext(ra,this);b.finish34=stage.setContext(Sa,this);b.finish35=stage.setContext(Ya,this);b.finish36=stage.setContext(Ra,
this);b.finish37=stage.setContext(ma,this);b.finish38=stage.setContext(bb,this);b.finish39=stage.setContext(gb,this);b.finish40=stage.setContext(ib,this);b.finish41=stage.setContext(hb,this);b.finish42=stage.setContext(fb,this);b.finish43=stage.setContext(Aa,this);b.finish44=stage.setContext(eb,this);b.finish45=stage.setContext(ab,this);b.finish46=stage.setContext(Ma,this);b.finish47=stage.setContext(Ta,this);b.finish48=stage.setContext(db,this);b.finish49=stage.setContext(Oa,this);b.finish50=stage.setContext(Qa,
this);b.finish51=stage.setContext(N,this);b.finish52=stage.setContext(za,this);this.enabledStates={};this.currentProgram=null;this.currentFramebuffer={};this.currentRenderbuffer={};this.currentFrontFace=this.currentOffsetUnits=this.currentOffsetFactor=null;this.currentlyEnabledArrays={}},d=function(b){void 0!==this.enabledStates[b]&&this.enabledStates[b]||(this.enabledStates[b]=!0,this.gl.enable2(b))},u=function(b){if(void 0===this.enabledStates[b]||this.enabledStates[b])this.enabledStates[b]=!1,
this.gl.disable2(b)},k=function(b){this.currentProgram!==b&&(this.currentProgram=b,this.gl.useProgram2(b))},l=function(b,d){this.currentFramebuffer[b]!==d&&(this.currentFramebuffer[b]=d,this.gl.bindFramebuffer2(b,d))},g=function(b,d){this.currentRenderbuffer[b]!==d&&(this.currentRenderbuffer[b]=d,this.gl.bindRenderbuffer2(b,d))},q=function(b,d,e,f,h){this.currentFramebuffer[b].attachments||(this.currentFramebuffer[b].attachments={});this.currentFramebuffer[b].attachments[d]=f;this.gl.framebufferTexture2D2(b,
d,e,f,h)},t=function(b,d,e,f){this.currentFramebuffer[b].attachments||(this.currentFramebuffer[b].attachments={});this.currentFramebuffer[b].attachments[d]=f;this.gl.framebufferRenderbuffer2(b,d,e,f)},r=function(b,d){if(this.currentOffsetFactor!==b||this.currentOffsetUnits!==d)this.gl.polygonOffset2(b,d),this.currentOffsetFactor=b,this.currentOffsetUnits=d},f=function(b){this.currentFrontFace!==b&&(this.gl.frontFace2(b),this.currentFrontFace=b)},n=function(b){this.gl.activeTexture2(b)},B=function(){5<
arguments.length&&(1>arguments[3]||1>arguments[4])&&console.error("[WebGL texImage2D] bad resolution parameters",arguments[3]+"x"+arguments[4]);this.gl.texImage2D2.apply(this.gl,arguments)},w=function(){4<=arguments.length&&(1>arguments[2]||1>arguments[3])&&console.error("[WebGL renderbufferStorage] bad resolution parameters",arguments[2]+"x"+arguments[3]);this.gl.renderbufferStorage2.apply(this.gl,arguments)},D=function(b,d){b&&(void 0!==b.index?b.val!==d&&(this.gl.uniform1i2(b.loc,d),b.val=d):this.gl.uniform1i2(b,
d))},A=function(b,d){b&&(void 0!==b.index?b.val!==d&&(this.gl.uniform1ui2(b.loc,d),b.val=d):this.gl.uniform1ui2(b,d))},H=function(b,d){b&&(void 0!==b.index?b.val!==d&&(this.gl.uniform1f2(b.loc,d),b.val=d):this.gl.uniform1f2(b,d))},e=function(b,d,e){if(b)if(void 0!==b.index){if(b.v1!==d||b.v2!=e)this.gl.uniform2i2(b.loc,d,e),b.v1=d,b.v2=e}else this.gl.uniform2i2(b,d,e)},E=function(b,d,e){if(b)if(void 0!==b.index){if(b.v1!==d||b.v2!=e)this.gl.uniform2ui2(b.loc,d,e),b.v1=d,b.v2=e}else this.gl.uniform2ui2(b,
d,e)},F=function(b,d,e){if(b)if(void 0!==b.index){if(b.v1!==d||b.v2!=e)this.gl.uniform2f2(b.loc,d,e),b.v1=d,b.v2=e}else this.gl.uniform2f2(b,d,e)},p=function(b,d,e,f){if(b)if(void 0!==b.index){if(b.v1!==d||b.v2!=e||b.v3!=f)this.gl.uniform3i2(b.loc,d,e,f),b.v1=d,b.v2=e,b.v3=f}else this.gl.uniform3i2(b,d,e,f)},m=function(b,d,e,f){if(b)if(void 0!==b.index){if(b.v1!==d||b.v2!=e||b.v3!=f)this.gl.uniform3ui2(b.loc,d,e,f),b.v1=d,b.v2=e,b.v3=f}else this.gl.uniform3ui2(b,d,e,f)},h=function(b,d,e,f){if(b)if(void 0!==
b.index){if(b.v1!==d||b.v2!=e||b.v3!=f)this.gl.uniform3f2(b.loc,d,e,f),b.v1=d,b.v2=e,b.v3=f}else this.gl.uniform3f2(b,d,e,f)},v=function(b,d,e,f,h){if(b)if(void 0!==b.index){if(b.v1!==d||b.v2!=e||b.v3!=f||b.v4!=h)this.gl.uniform4i2(b.loc,d,e,f,h),b.v1=d,b.v2=e,b.v3=f,b.v4=h}else this.gl.uniform4i2(b,d,e,f,h)},I=function(b,d,e,f,h){if(b)if(void 0!==b.index){if(b.v1!==d||b.v2!=e||b.v3!=f||b.v4!=h)this.gl.uniform4ui2(b.loc,d,e,f,h),b.v1=d,b.v2=e,b.v3=f,b.v4=h}else this.gl.uniform4ui2(b,d,e,f,h)},J=function(b,
d,e,f,h){if(b)if(void 0!==b.index){if(b.v1!==d||b.v2!=e||b.v3!=f||b.v4!=h)this.gl.uniform4f2(b.loc,d,e,f,h),b.v1=d,b.v2=e,b.v3=f,b.v4=h}else this.gl.uniform4f2(b,d,e,f,h)},M=function(b,d,e){if(d)if(void 0!==d.index){if(d.values||(d.values=[]),d.values.length!==e.length||d.values!==e)this.gl[b](d.loc,e),d.values=e}else this.gl[b](d,e)},T=function(b,d,e,f){if(d)if(void 0!==d.index)d.values||(d.values=[]),e!==d.values[f.length]&&(this.gl[b](d.loc,e,f),d.values=f);else this.gl[b](d,!1,f)},U=function(b){void 0!==
b&&(void 0!==b.index?this.currentlyEnabledArrays[b.loc]||(this.gl.enableVertexAttribArray2(b.loc),this.currentlyEnabledArrays[b.loc]=!0):this.currentlyEnabledArrays[b]||(this.gl.enableVertexAttribArray2(b),this.currentlyEnabledArrays[b]=!0))},R=function(b){void 0!==b&&(void 0!==b.index?this.currentlyEnabledArrays[b.loc]&&(this.gl.disableVertexAttribArray2(b.loc),this.currentlyEnabledArrays[b.loc]=!1):this.currentlyEnabledArrays[b]&&(this.gl.disableVertexAttribArray2(b),this.currentlyEnabledArrays[b]=
!1))},aa=function(b,d,e,f,h,m){void 0!==b&&(void 0!==b.index?this.gl.vertexAttribPointer2(b.loc,d,e,f,h,m):this.gl.vertexAttribPointer2(b,d,e,f,h,m))},C=function(){this.gl.finish_original()},L=function(){this.gl.finish_original()},K=function(){this.gl.finish_original()},G=function(){this.gl.finish_original()},S=function(){this.gl.finish_original()},Y=function(){this.gl.finish_original()},ia=function(){this.gl.finish_original()},Q=function(){this.gl.finish_original()},ta=function(){this.gl.finish_original()},
ua=function(){this.gl.finish_original()},ea=function(){this.gl.finish_original()},oa=function(){this.gl.finish_original()},ba=function(){this.gl.finish_original()},ka=function(){this.gl.finish_original()},Z=function(){this.gl.finish_original()},da=function(){this.gl.finish_original()},X=function(){this.gl.finish_original()},Ha=function(){this.gl.finish_original()},Ga=function(){this.gl.finish_original()},Fa=function(){this.gl.finish_original()},xa=function(){this.gl.finish_original()},Ia=function(){this.gl.finish_original()},
qa=function(){this.gl.finish_original()},Va=function(){this.gl.finish_original()},va=function(){this.gl.finish_original()},la=function(){this.gl.finish_original()},fa=function(){this.gl.finish_original()},P=function(){this.gl.finish_original()},Ba=function(){this.gl.finish_original()},Ka=function(){this.gl.finish_original()},wa=function(){this.gl.finish_original()},Ja=function(){this.gl.finish_original()},La=function(){this.gl.finish_original()},ra=function(){this.gl.finish_original()},Sa=function(){this.gl.finish_original()},
Ya=function(){this.gl.finish_original()},Ra=function(){this.gl.finish_original()},ma=function(){this.gl.finish_original()},bb=function(){this.gl.finish_original()},gb=function(){this.gl.finish_original()},ib=function(){this.gl.finish_original()},hb=function(){this.gl.finish_original()},fb=function(){this.gl.finish_original()},Aa=function(){this.gl.finish_original()},eb=function(){this.gl.finish_original()},ab=function(){this.gl.finish_original()},Ma=function(){this.gl.finish_original()},Ta=function(){this.gl.finish_original()},
db=function(){this.gl.finish_original()},Oa=function(){this.gl.finish_original()},Qa=function(){this.gl.finish_original()},N=function(){this.gl.finish_original()},za=function(){this.gl.finish_original()};return function(d){d.extendedWebGLContext=new b(d)}});stage.provide("emersya.viewer.modules.renderer.animations");stage.require("emersya.viewer.modules.renderer.shaders");
stage.register.call(stage.emersya.viewer.modules.renderer,"animations",function(){var b=function(b,d){switch(b){case stage.emersya.viewer.ANIMATIONS_ACCELERATION_MODES.NONE:return 1;case stage.emersya.viewer.ANIMATIONS_ACCELERATION_MODES.SQUARE:return Math.pow(d,2);case stage.emersya.viewer.ANIMATIONS_ACCELERATION_MODES.CUBIC:return Math.pow(d,3);case stage.emersya.viewer.ANIMATIONS_ACCELERATION_MODES.EXP:return(Math.exp(d)-1)/(Math.E-1);case stage.emersya.viewer.ANIMATIONS_ACCELERATION_MODES.POLYNOMIAL5:return Math.pow(d,
3)*(10+d*(6*d-15));case stage.emersya.viewer.ANIMATIONS_ACCELERATION_MODES.HALFSINUSOIDAL:return(Math.sin(Math.PI*(2*d-1)/2)+1)/2;case stage.emersya.viewer.ANIMATIONS_ACCELERATION_MODES.QUARTERSINUSOIDAL:return Math.sin(Math.PI*d/2);default:return d}},d=function(b){this.vector=vec3.create(b)};d.prototype.getMatrix=function(b){var d=vec3.create(this.vector);vec3.scale(d,b);return mat4.translate(mat4.identity(mat4.create()),d)};d.prototype.applyToMatrix=function(b,d){var e=vec3.create(this.vector);
vec3.scale(e,d);return mat4.translate(b,e)};d.prototype.applyToOpacity=function(b){return-1};var u=function(b,d,e){this.center=vec3.create(b);vec3.length(d)?this.axis=vec3.normalize(vec3.create(d)):this.axis=vec3.create([1,0,0]);this.angle=e};u.prototype.getMatrix=function(b){var d=mat4.identity(mat4.create());b*=this.angle;var e=vec3.create(this.center);mat4.translate(d,e);mat4.rotate(d,b,this.axis);mat4.translate(d,vec3.negate(this.center,vec3.create()));return d};u.prototype.applyToMatrix=function(b,
d){d*=this.angle;var e=vec3.create(this.center);mat4.translate(b,e);mat4.rotate(b,d,this.axis);mat4.translate(b,vec3.negate(this.center,vec3.create()));return b};u.prototype.applyToOpacity=function(b){return-1};var k=function(b){this.vector=vec3.subtract(b,[1,1,1],vec3.create())};k.prototype.getMatrix=function(b){var d=vec3.create(this.vector);vec3.scale(d,b);vec3.add(d,[1,1,1]);return mat4.scale(mat4.identity(mat4.create()),d)};k.prototype.applyToMatrix=function(b,d){var e=vec3.create(this.vector);
vec3.scale(e,d);vec3.add(e,[1,1,1]);return mat4.scale(b,e)};k.prototype.applyToOpacity=function(b){return-1};var l=function(b){this.val=Math.min(Math.max(b,0),1);this.mat=mat4.identity(mat4.create())};l.prototype.getMatrix=function(b){return this.mat};l.prototype.applyToMatrix=function(b,d){return b};l.prototype.applyToOpacity=function(b){return this.val*b};var g=function(b,d,e,f){this.timer=b;this.progression=0;this.transformations=[];this.accelerationType=void 0!==d?d:stage.emersya.viewer.ANIMATIONS_ACCELERATION_MODES.LINEAR;
this.accelerationExponent=e?e:1;this.reversed=void 0!==f?f:!1;this.opacity=-1};g.prototype.addTransformation=function(b){switch(b.type){case "translation":var e=new d([b.vec1_x,b.vec1_y,b.vec1_z]);break;case "rotation":e=new u([b.vec1_x,b.vec1_y,b.vec1_z],[b.vec2_x,b.vec2_y,b.vec2_z],b.double1);break;case "scaling":e=new k([b.vec1_x,b.vec1_y,b.vec1_z]);break;case "opacity":e=new l(b.double1);break;default:console.warn("Warning: animation type "+b.type+" is not supported.")}this.transformations.push(e);
return!0};g.prototype.getTimeUsed=function(b){return this.progression>=this.timer?0:this.progression+b>this.timer?this.timer-this.progression:b};g.prototype.computeAcceleration=function(d){if(this.reversed){for(var e=1-d,f=0;f<this.accelerationExponent;++f)e=b(this.accelerationType,e);return this.accelerationType===stage.emersya.viewer.ANIMATIONS_ACCELERATION_MODES.NONE&&1==d?1:1-e}e=d;for(f=0;f<this.accelerationExponent;++f)e=b(this.accelerationType,e);return e};g.prototype.computeMatrix=function(b){this.progression+=
b;b=mat4.identity(mat4.create());var d=1;this.timer&&(d=this.progression/this.timer);var e=0,f=0,p;for(p in this.transformations){this.transformations[p].applyToMatrix(b,this.computeAcceleration(d));var g=this.transformations[p].applyToOpacity(1);0<=g&&(e+=g,++f)}this.opacity=f?e/f:this.opacity;return b};g.prototype.getProgress=function(){var b=1;this.timer&&(b=this.progression/this.timer);return this.computeAcceleration(b)};g.prototype.computeProgression=function(b){var d=mat4.identity(mat4.create()),
e=0,f=1,p;for(p in this.transformations){this.transformations[p].applyToMatrix(d,b);var g=this.transformations[p].applyToOpacity(1);0<=g&&(e+=g,++f)}this.opacity=f?e/f:1;return d};var q=function(b){this.node=b;this.animations=[];this.currentAnimation=this.globalProgr=this.globalTimer=0;this.callback=null;this.finalMatrix=mat4.identity(mat4.create());this.currentMatrix=mat4.identity(mat4.create());this.launchCallback=this.manual=this.stopped=this.cycling=!1};q.prototype.addAnimations=function(b){b.adjustedTime||
(b.adjustedTime=b.time);var d=new g(b.adjustedTime,b.accelerationType,b.accelerationExponent,b.reversed),e;for(e in b.animations)d.addTransformation(b.animations[e]);this.animations.push(d);this.globalTimer+=b.adjustedTime};q.prototype.setProgression=function(b){if(this.animations.length&&!(this.currentAnimation>=this.animations.length)){var d=mat4.create(this.finalMatrix);b=this.animations[this.currentAnimation].computeProgression(b);mat4.multiply(d,b);mat4.set(d,this.currentMatrix)}};q.prototype.setManualMode=
function(){this.manual=!0};q.prototype.setCallback=function(b){this.callback=b};q.prototype.toggle=function(){this.cycling?this.stopped=!this.stopped:this.cycling=!0};q.prototype.reset=function(){this.animations=[];this.currentAnimation=this.globalProgr=this.globalTimer=0;this.callback=null;this.cycling=this.stopped=!1;mat4.identity(this.currentMatrix);mat4.identity(this.finalMatrix)};q.prototype.computeMatrix=function(b){if(this.stopped||this.manual||!this.animations.length||this.currentAnimation>=
this.animations.length||!b)return!1;for(var d=mat4.create(this.finalMatrix),e=b;e&&this.currentAnimation<this.animations.length;){var f=this.animations[this.currentAnimation].getTimeUsed(e);e-=f;f=this.animations[this.currentAnimation].computeMatrix(f);mat4.multiply(d,f);if(e&&(mat4.multiply(this.finalMatrix,f),0<=this.animations[this.currentAnimation].opacity&&(this.node.baseOpacity=this.animations[this.currentAnimation].opacity),++this.currentAnimation,this.currentAnimation>=this.animations.length))if(this.cycling&&
0<this.animations[this.currentAnimation-1].timer){this.globalProgr=this.currentAnimation=0;mat4.identity(this.finalMatrix);mat4.identity(this.currentMatrix);for(var p in this.animations)this.animations[p].progression=0}else this.launchCallback=!0}this.globalProgr+=b-e;this.globalProgr>this.globalTimer&&(this.globalProgr=this.globalTimer);mat4.set(d,this.currentMatrix);return!0};q.prototype.getOpacity=function(){if(this.currentAnimation>=this.animations.length)return this.currentAnimation&&0<=this.animations[this.currentAnimation-
1].opacity?this.animations[this.currentAnimation-1].opacity:this.node.baseOpacity;var b=this.currentAnimation&&0<=this.animations[this.currentAnimation-1].opacity?this.animations[this.currentAnimation-1].opacity:this.node.baseOpacity;return b+((0<=this.animations[this.currentAnimation].opacity?this.animations[this.currentAnimation].opacity:this.node.baseOpacity)-b)*this.animations[this.currentAnimation].getProgress()};q.prototype.isOpaque=function(){if(this.currentAnimation>=this.animations.length)var b=
this.currentAnimation&&0<=this.animations[this.currentAnimation-1].opacity?1==this.animations[this.currentAnimation-1].opacity:1==this.node.baseOpacity;else{b=this.currentAnimation&&0<=this.animations[this.currentAnimation-1].opacity?this.animations[this.currentAnimation-1].opacity:this.node.baseOpacity;var d=0<=this.animations[this.currentAnimation].opacity?this.animations[this.currentAnimation].opacity:this.node.baseOpacity;b=1==b&&1==d}return b?this.node.parent?this.node.parent.animations.isOpaque():
b:!1};q.prototype.checkCallback=function(){this.launchCallback&&this.callback&&this.callback();this.launchCallback=!1};var t=function(b,d,e,f,g,n){this.material=d;this.shaderType=this.nextMaterial=null;this.timer=b;this.currentScale=this.progression=0;this.accelerationType=void 0!==e?e:stage.emersya.viewer.ANIMATIONS_ACCELERATION_MODES.QUARTERSINUSOIDAL;this.accelerationExponent=f?f:1;this.reversed=void 0!==g?g:!1;this.interpolateUvTransform=void 0!==n?n:!1};t.prototype.applyTime=function(b){this.progression+=
b;this.currentScale=this.timer?this.progression/this.timer:1};t.prototype.getTimeUsed=function(b){return this.progression>=this.timer?0:this.progression+b>this.timer?this.timer-this.progression:b};t.prototype.processNextMaterial=function(b){this.nextMaterial=b};t.prototype.computeAcceleration=function(){if(this.reversed){for(var d=1-this.currentScale,e=0;e<this.accelerationExponent;++e)d=b(this.accelerationType,d);return this.accelerationType===stage.emersya.viewer.ANIMATIONS_ACCELERATION_MODES.NONE&&
1==this.currentScale?1:1-d}d=this.currentScale;for(e=0;e<this.accelerationExponent;++e)d=b(this.accelerationType,d);return d};t.prototype.needsTransitionShader=function(){return this.nextMaterial&&this.accelerationType!==stage.emersya.viewer.ANIMATIONS_ACCELERATION_MODES.NONE};t.prototype.useNextMaterialAsBase=function(){return this.nextMaterial&&this.accelerationType===stage.emersya.viewer.ANIMATIONS_ACCELERATION_MODES.NONE&&(!this.reversed||1==this.currentScale)};var r=function(b,d,e){this.scene=
b;this.currentMaterial={};this.polylistInstance=e;this.resetMaterial(d);this.shaderType=new stage.emersya.viewer.modules.renderer.shaders.shaderType};r.prototype.destroy=function(){var b=[];this.currentMaterial&&(b=H.call(this,this.currentMaterial));this.nextMaterial&&(b=b.concat(H.call(this,this.nextMaterial)),delete this.nextMaterial);this.scene.texturesManager.unloadTextureInstances(b);delete this.currentMaterial;delete this.polylists};var f=function(b){if(!b.fur||!b.coating||0<b.fur.maxHairLength&&
0<b.coating.furRealSize||!b.coating.furMaxLength||!this.polylistInstance.node||!this.polylistInstance.node.boundingBox)return!1;b.fur.maxHairLength=b.coating.furMaxLength*this.polylistInstance.node.boundingBox.radius;return!0},n=function(b){if(!(b.fur&&b.coating&&b.coating.furRealSize&&this.scene.rootUpScale&&this.scene.measurementFactor))return f.call(this,b);b.fur.maxHairLength=b.coating.furRealSize/this.scene.measurementFactor*this.scene.rootUpScale;return!0},B=function(b){if(b.coating&&(b.coating.furRealSize||
b.coating.furMaxLength)){var d=b.coating.intensityTexture?b.coating.intensityTexture.uvsrc:0,e=1;this.polylistInstance.realMeasurementScalingFactors&&(void 0!==this.polylistInstance.realMeasurementScalingFactors[d]?e=this.polylistInstance.realMeasurementScalingFactors[d]:void 0!==this.polylistInstance.realMeasurementScalingFactors[0]&&(e=this.polylistInstance.realMeasurementScalingFactors[0]));b.coating.intensityTexture||(d=e/b.coating.furHairSize/(1E3*this.scene.furMapResolution),b.fur.furAutoGeneratedMapUvTransform=
mat4.create([d,0,0,0,0,d,0,0,0,1,0,1,0,0,0,0]));b.fur.clumpDensity=e/b.coating.furClumpSize/1E3}},w=function(b){b.coating&&(b.coating.furRealSize||b.coating.furMaxLength)&&(b.fur=b.fur||{},b.fur.rigidity=3.75*(1-b.coating.furRigidity),n.call(this,b),B.call(this,b))},D=function(b){this.currentMaterial={};this.scene.fillMaterial(this.currentMaterial,b,this.polylistInstance.polylist.customMaterial,this.polylistInstance.customMaterial);this.isPatch()&&this.scene.checkDilation(this.currentMaterial);w.call(this,
this.currentMaterial);b.polylists.push(this.polylistInstance);this.polylistInstance.currentMaterialId=this.currentMaterial.id;b=this.scene.texturesManager.getTexturesFromMaterial(this.currentMaterial);for(var d=0;d<b.length;++d)b[d].load(this.polylistInstance)},A=function(b){this.nextMaterial={};this.scene.fillMaterial(this.nextMaterial,b,this.polylistInstance.polylist.customMaterial,this.polylistInstance.customMaterial);this.isPatch()&&this.scene.checkDilation(this.nextMaterial);w.call(this,this.nextMaterial);
b.polylists.push(this.polylistInstance);b=this.scene.texturesManager.getTexturesFromMaterial(this.nextMaterial);for(var d=0;d<b.length;++d)b[d].load(this.polylistInstance)},H=function(b){var d=this.scene.materials[b.id];d.polylists.splice(d.polylists.indexOf(this.polylistInstance),1);return this.scene.texturesManager.getTexturesFromMaterial(b)};r.prototype.updateMaterialSettingsWhenBoundingBoxChange=function(){f.call(this,this.getCurrentMaterial())};r.prototype.updateMaterialSettingsWhenRealMeasurementChange=
function(){n.call(this,this.getCurrentMaterial())};r.prototype.updateMaterialSettingsWhenPolylistInstanceMeasurementChange=function(){B.call(this,this.getCurrentMaterial())};r.prototype.reloadMaterial=function(){this.resetMaterial(this.scene.materials[this.currentMaterial.id])};r.prototype.reloadCurrentMaterials=function(){var b=[];this.currentMaterial.id&&(b=H.call(this,this.currentMaterial));D.call(this,this.scene.materials[this.currentMaterial.id]);this.scene.texturesManager.unloadTextureInstances(b);
this.nextMaterial&&this.nextMaterial.id&&(b=H.call(this,this.nextMaterial),A.call(this,this.scene.materials[this.nextMaterial.id]),this.scene.texturesManager.unloadTextureInstances(b))};r.prototype.resetMaterial=function(b){var d=[];this.currentMaterial.id&&(d=H.call(this,this.currentMaterial));this.nextMaterial&&this.nextMaterial.id&&(d=d.concat(H.call(this,this.nextMaterial)));var e=this.polylistInstance.isHidden();D.call(this,b);this.polylistInstance.isHidden()!==e&&(this.scene.visibilityChanged=
!0);this.scene.texturesManager.unloadTextureInstances(d);this.animations=[new t(0,this.currentMaterial)];this.currentAnimation=0;this.stopped=this.cycling=this.manual=this.launchCallback=!1;this.nextMaterial=null;this.shaderType&&this.updateShaderType()};r.prototype.addAnimations=function(b,d){b.adjustedTime||(b.adjustedTime=b.time);this.animations[this.animations.length-1].processNextMaterial(d);this.animations[this.animations.length-1].timer=b.adjustedTime;void 0!==b.accelerationType&&(this.animations[this.animations.length-
1].accelerationType=b.accelerationType);void 0!==b.accelerationExponent&&(this.animations[this.animations.length-1].accelerationExponent=b.accelerationExponent);void 0!==b.reversed&&(this.animations[this.animations.length-1].reversed=b.reversed);void 0!==b.interpolate_uv_transform&&(this.animations[this.animations.length-1].interpolateUvTransform=b.interpolate_uv_transform);if(this.currentAnimation===this.animations.length-1){var e=[];this.nextMaterial&&this.nextMaterial.id&&(e=e.concat(H.call(this,
this.nextMaterial)));A.call(this,d);this.scene.texturesManager.unloadTextureInstances(e)}this.animations.push(new t(b.adjustedTime,d));this.launchCallback=!1;b.adjustedTime||this.animations[this.currentAnimation].timer||this.computeMaterial(this.scene,1E-6)};r.prototype.setManualMode=function(){this.manual=!0};r.prototype.setCallback=function(b){this.callback=b};r.prototype.toggle=function(){this.cycling?this.stopped=!this.stopped:this.cycling=!0};r.prototype.getAppliedScale=function(){return this.animations[this.currentAnimation].computeAcceleration()};
r.prototype.getCurrentMaterial=function(){return this.animations[this.currentAnimation].useNextMaterialAsBase()?this.nextMaterial:this.currentMaterial};r.prototype.getMaxUvsInUse=function(){for(var b=this.scene.texturesManager.getTexturesFromMaterial(this.currentMaterial),d=this.currentMaterial.coating&&(0<this.currentMaterial.coating.furMaxLength||0<this.currentMaterial.coating.furRealSize)&&(null==this.currentMaterial.coating.intensityTexture||!this.currentMaterial.coating.intensityTexture.isReady()),
e=0;e<this.animations.length;++e){var f=this.animations[e];b=b.concat(this.scene.texturesManager.getTexturesFromMaterial(f.material));d||!f.material.coating||!(0<f.material.coating.furMaxLength||0<f.material.coating.furRealSize)||null!=f.material.coating.intensityTexture&&f.material.coating.intensityTexture.isReady()||(d=!0)}f={};if(0<=this.scene.requiredUvsrc)f[this.scene.requiredUvsrc]=!0;else{for(e=0;e<b.length;++e)f[b[e].uvsrc]=!0;if(this.scene.renderingSettings.furSupported&&0==Object.keys(f).length&&
d)return 1}return Object.keys(f).length};r.prototype.computeMaterial=function(b,d){if(!this.stopped&&!this.manual){if(!this.animations.length||this.currentAnimation>=this.animations.length-1)return!1;for(;d&&this.currentAnimation<this.animations.length-1;){var e=this.animations[this.currentAnimation].getTimeUsed(d);d-=e;this.animations[this.currentAnimation].applyTime(e);if(d){++this.currentAnimation;if(this.currentAnimation<this.animations.length-1)e=H.call(this,this.currentMaterial),this.currentMaterial=
this.nextMaterial,this.polylistInstance.currentMaterialId=this.currentMaterial.id,A.call(this,this.animations[this.currentAnimation+1].material),this.scene.texturesManager.unloadTextureInstances(e);else if(this.cycling&&0<this.animations[this.currentAnimation-1].timer){e=H.call(this,this.currentMaterial);e=e.concat(H.call(this,this.nextMaterial));this.currentAnimation=0;D.call(this,this.animations[this.currentAnimation].material);A.call(this,this.animations[this.currentAnimation+1].material);this.scene.texturesManager.unloadTextureInstances(e);
for(var f in this.animations)this.animations[f].currentScale=0,this.animations[f].progression=0}else e=H.call(this,this.currentMaterial),this.currentMaterial=this.nextMaterial,this.polylistInstance.currentMaterialId=this.currentMaterial.id,this.scene.texturesManager.unloadTextureInstances(e),this.nextMaterial=null,this.animations[this.currentAnimation].currentScale=0,this.launchCallback=!0;this.updateShaderType(b)}}return!0}};r.prototype.isOpaque=function(b){if(this.polylistInstance.fadeOut||this.polylistInstance.isGhost)return!1;
var d=b?"none"!==this.currentMaterial.opacity.blur:!1;d=this.currentMaterial.type?d||null==this.currentMaterial.opacity||this.currentMaterial.opacity.blending==stage.emersya.viewer.BLENDING_MODE.INTERPOLATIVE&&1==this.currentMaterial.opacity.intensity&&null==this.currentMaterial.opacity.texture:d||this.currentMaterial.opacity.blending==stage.emersya.viewer.BLENDING_MODE.INTERPOLATIVE&&1==this.currentMaterial.opacity.intensity&&null==this.currentMaterial.opacity.texture;this.nextMaterial&&(d=this.nextMaterial.type?
d&&((b?"none"!==this.nextMaterial.opacity.blur:!1)||null==this.nextMaterial.opacity||this.nextMaterial.opacity.blending==stage.emersya.viewer.BLENDING_MODE.INTERPOLATIVE&&1==this.nextMaterial.opacity.intensity&&null==this.nextMaterial.opacity.texture):d&&((b?"none"!==this.nextMaterial.opacity.blur:!1)||this.nextMaterial.opacity.blending==stage.emersya.viewer.BLENDING_MODE.INTERPOLATIVE&&1==this.nextMaterial.opacity.intensity&&null==this.nextMaterial.opacity.texture));return d&&(this.polylistInstance.node.animations?
this.polylistInstance.node.animations.isOpaque():!0)};r.prototype.getCurrentOpacity=function(){return this.polylistInstance.isGhost?.5:this.getCurrentMaterial().opacity.intensity};r.prototype.getNextOpacity=function(){return this.polylistInstance.isGhost?.5:this.nextMaterial?this.nextMaterial.opacity.intensity:1};r.prototype.isInvisible=function(){var b=!this.currentMaterial.opacity||!this.currentMaterial.opacity.intensity;this.nextMaterial&&(b=b&&(!this.nextMaterial.opacity||!this.nextMaterial.opacity.intensity));
return b};r.prototype.isPatch=function(){var b=!!this.currentMaterial.opacity.texture&&(0>this.polylistInstance.polylist.polygonOffsetFactor||0>this.polylistInstance.polylist.polygonOffsetUnits);this.nextMaterial&&(b=b||!!this.nextMaterial.opacity.texture);return b};r.prototype.hasEmissive=function(){return this.currentMaterial.emissive&&0<this.currentMaterial.emissive.intensity};r.prototype.hasReflection=function(){return this.currentMaterial.type?this.currentMaterial.roughness&&(this.currentMaterial.roughness.gloss&&
.1<=this.currentMaterial.roughness.intensity||!this.currentMaterial.roughness.gloss&&.9>this.currentMaterial.roughness.intensity||this.currentMaterial.roughness.texture):this.currentMaterial.reflection&&0<this.currentMaterial.reflection.intensity};r.prototype.preDepthPass=function(){return!this.isOpaque()&&this.currentMaterial.opacity.firstFacesOnly&&this.currentMaterial.opacity.blending!=stage.emersya.viewer.BLENDING_MODE.DITHER};r.prototype.checkCallback=function(){this.launchCallback&&this.callback&&
this.callback();this.launchCallback=!1};r.prototype.loadFurMaterial=function(b,d){var e=this.getCurrentMaterial();if(e&&e.fur&&e.fur.maxHairLength){var f=e.coating.furGradInterval.min/100,m=e.coating.furGradInterval.max/100;b.uniform2f(d.locations.wuexhah,1>d.furQuality?f*m:0,1>d.furQuality?m-f:1);b.uniform1f(d.locations.cooyzem,e.fur.maxHairLength);b.uniform1f(d.locations.uiifavc,e.fur.rigidity);if(e.coating.intensityTexture&&e.coating.intensityTexture.isReady())b.uniform1i(d.locations.txnfpqb,e.coating.intensityTexture.loadToShader(d,
d.locations.hcysjhg,d.locations.xdqgbxe));else{var p=d.textureCount++;b.activeTexture(b.TEXTURE0+p);b.bindTexture(b.TEXTURE_2D,this.scene.furMap||d.dummyTexture);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.REPEAT);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.REPEAT);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.NEAREST_MIPMAP_LINEAR);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.LINEAR);b.uniform1i(d.locations.txnfpqb,p);b.uniformMatrix4fv(d.locations.hcysjhg,!1,e.fur.furAutoGeneratedMapUvTransform);
b.uniform1i(d.locations.xdqgbxe,0)}d.locations.dcdsynq&&b.uniform1f(d.locations.dcdsynq,e.fur.clumpDensity);e.coating.thicknessTexture&&e.coating.thicknessTexture.isReady()&&b.uniform1i(d.locations.maogpho,e.coating.thicknessTexture.loadToShader(d,d.locations.tdzxeou,d.locations.akywvcc));d.locations.woaetjz&&(b.uniform4f(d.locations.woaetjz,e.coating.furRootColor[0]*e.albedo.intensity,e.coating.furRootColor[1]*e.albedo.intensity,e.coating.furRootColor[2]*e.albedo.intensity,e.albedo.blendingMode),
b.uniform3f(d.locations.nhwprup,f,m,e.coating.furGradNormalize),d.locations.cwlogkk&&e.coating.roughnessTexture&&e.coating.roughnessTexture.isReady()&&b.uniform1i(d.locations.cwlogkk,e.coating.roughnessTexture.loadToShader(d,d.locations.tkfccyx,d.locations.sbsyqfs)));d.locations.ksceaxd&&b.uniform1f(d.locations.ksceaxd,e.coating.furDispersion)}};var e=function(b,d,e){if(d.locations.fhdoawj&&!d.locations.fhdoawj.cases){d.locations.fhdoawj.cases=[];for(var f=0;f<e.length;++f)d.locations.fhdoawj&&(d.locations.fhdoawj.cases[f]=
b.getUniformLocation(d.program,"fhdoawj["+f+"]"))}if(d.locations.uvobbpg&&!d.locations.uvobbpg.cases)for(d.locations.uvobbpg.cases=[],f=0;f<e.length;++f)d.locations.uvobbpg&&(d.locations.uvobbpg.cases[f]=b.getUniformLocation(d.program,"uvobbpg["+f+"]"));if(d.locations.sdgxppd&&!d.locations.sdgxppd.cases)for(d.locations.sdgxppd.cases=[],f=0;f<e.length;++f)d.locations.sdgxppd&&(d.locations.sdgxppd.cases[f]=b.getUniformLocation(d.program,"sdgxppd["+f+"]"));for(f=0;f<e.length;++f){var h=e[f];d.locations.sdgxppd&&
d.locations.sdgxppd.cases&&d.locations.sdgxppd.cases[f]&&b.uniform3fv(d.locations.sdgxppd.cases[f],h.direction);d.locations.uvobbpg&&d.locations.uvobbpg.cases&&d.locations.uvobbpg.cases[f]&&b.uniform3fv(d.locations.uvobbpg.cases[f],h.color);d.locations.fhdoawj&&d.locations.fhdoawj.cases&&d.locations.fhdoawj.cases[f]&&b.uniform1f(d.locations.fhdoawj.cases[f],h.intensity)}};r.prototype.loadCarPaintMaterial=function(b,d,f){var h=this.getCurrentMaterial();if(h&&h.metalness.carpaint){var m=stage.emersya.viewer.modules.renderer.shaders.shaderTypes,
g=d.locations,p=h.metalness.carpaint;b.uniform1f(g.wmwedox,p.diffuse);b.uniform1ui(g.zvyasqs,p.coatingFlags);b.uniform1fv(g.juzldmk,p.specularLobeCoeffs);b.uniform1fv(g.lrzbupm,p.specularLobeSpreads);b.uniform1fv(g.htommgx,p.specularLobeF0s);b.uniform1f(g.remfqag,p.flakesIntensity);b.uniform1i(g.cfazlvb,p.flakesMaxThetaI);b.uniform1i(g.jokkayo,p.flakesNumThetaI);b.uniform1i(g.okkhwfp,p.flakesNumThetaF);b.uniform1i(g.ryveioo,p.flakesNumPatches);b.uniform1f(g.foymowj,p.flakesColorBias);p.brdfColorTexture&&
p.brdfColorTexture.isReady()?b.uniform1i(g.gwnvphv,p.brdfColorTexture.loadToShader(d,g.owzoeru,g.uBrdfColorMapUvsrc)):g.gwnvphv&&b.uniform1i(g.gwnvphv,d.bindDummyTexture());if(f.has(m.PBR_CARPAINT_FLAKES_MAP))if(p.flakesSliceLutTexture&&p.flakesSliceLutTexture.isReady()?b.uniform1i(g.easweyl,p.flakesSliceLutTexture.loadToShader(d,g.uFlakesSliceLutMapUvTransform,g.uFlakesSliceLutMapUvsrc)):g.easweyl&&b.uniform1i(g.easweyl,d.bindDummyTexture()),p.flakesColorTexture&&p.flakesColorTexture.isReady()){if(b.uniform1i(g.gcfagin,
p.flakesColorTexture.loadToShader(d,g.mllilwk,g.wmkandj)),!b.webgl2){var n=1/p.flakesGridX,k=1/p.flakesGridY;b.uniform1i(g.wwmphdn,p.flakesGridY);b.uniform1f(g.abeohis,n);b.uniform1f(g.gaovjzk,k)}}else g.gcfagin&&(b.webgl2?b.uniform1i(g.gcfagin,d.bindDummyTexture2dArray()):(b.uniform1i(g.gcfagin,d.bindDummyTexture()),b.uniform1i(g.wwmphdn,1),b.uniform1f(g.abeohis,1),b.uniform1f(g.gaovjzk,1)));this.scene.scenery.environmentTexture&&this.scene.scenery.environmentTexture.isReady()&&this.scene.scenery.environmentTexture.approximatedLights?
f.has(m.sdxjcre)&&e.call(this,b,d,this.scene.scenery.environmentTexture.approximatedLights):h.localEnvironment&&h.localEnvironment.texture&&h.localEnvironment.texture.isReady()&&h.localEnvironment.texture.approximatedLights&&f.has(m.sdxjcre)&&e.call(this,b,d,h.localEnvironment.texture.approximatedLights)}};r.prototype.computeDisplacementFactor=function(){var b=0;if(this.scene.renderingSettings.furSupported&&this.shaderType.has(stage.emersya.viewer.modules.renderer.shaders.shaderTypes.PBR_FUR)){b=
vec3.length(this.polylistInstance.node.invModelMatrix3.slice(0,3));var d=vec3.length(this.polylistInstance.node.invModelMatrix3.slice(3,6)),e=vec3.length(this.polylistInstance.node.invModelMatrix3.slice(6,9));b=Math.max(b,Math.max(d,e));d=this.getCurrentMaterial();b=b*(.5+.1*d.coating.furRigidity)*(0<d.coating.furRealSize?d.coating.furRealSize/this.scene.computeRealMeasurementSceneFactor(this.scene.arData):d.coating.furMaxLength*this.polylistInstance.node.boundingBox.radius)}return b};r.prototype.loadDiscardTransparent=
function(b,d,e,f){e?(e=this.getCurrentMaterial(),b.uniform1f(d.locations.bzmstcf,e.opacity.intensity),void 0!==f?b.uniform1f(d.locations.ymenuuk,Math.max(e.opacity.threshold,f)):b.uniform1f(d.locations.ymenuuk,e.opacity.threshold),e.opacity.texture&&e.opacity.texture.isReady()?(b.uniform1i(d.locations.bxddaze,e.opacity.texture.loadToShader(d,d.locations.imjkghn,d.locations.avbfhlu)),e.type||b.uniform1i(d.locations.uxqdzlm,e.opacity.channel),b.uniform1i(d.locations.lilxxtl,1)):(b.uniform1i(d.locations.lilxxtl,
0),b.uniform1i(d.locations.bxddaze,d.bindDummyTexture()))):(b.uniform1f(d.locations.bzmstcf,1),b.uniform1f(d.locations.ymenuuk,0),b.uniform1i(d.locations.lilxxtl,0),b.uniform1i(d.locations.bxddaze,d.bindDummyTexture()))};r.prototype.loadClassicMaterial=function(b,d,e){var f=this.currentMaterial;this.animations[this.currentAnimation].useNextMaterialAsBase()&&(f=this.nextMaterial);var h=stage.emersya.viewer.modules.renderer.shaders.shaderTypes;e.has(h.REFLECTIONMAP)&&b.uniform1i(d.locations.fnltzwx,
f.reflection.texture.loadToShader(d,d.locations.vdzqqlc,d.locations.cjpagro));e.has(h.REFRACTIONMAP)&&b.uniform1i(d.locations.pofdivt,f.refraction.texture.loadToShader(d,d.locations.gqedqnf,d.locations.dzptjrq));b.uniform1f(d.locations.fhguuoo,f.diffuse.intensity);e.has(h.DIFFUSE)?(b.uniform1i(d.locations.xspuomx,f.diffuse.texture.loadToShader(d,d.locations.bbjrkoj,d.locations.jcxvcld)),b.uniform4f(d.locations.xcxkhty,0,0,0,0)):b.uniform4f(d.locations.xcxkhty,f.diffuse.color[0],f.diffuse.color[1],
f.diffuse.color[2],1);f.ambient.diffuseColor?b.uniform1f(d.locations.yxuhtpf,f.diffuse.intensity*f.ambient.intensity):(b.uniform1f(d.locations.yxuhtpf,f.ambient.intensity),e.has(h.AMBIENT)?(b.uniform1i(d.locations.kkbgecz,f.ambient.texture.loadToShader(d,d.locations.smlqamg,d.locations.lizkbiv)),b.uniform4f(d.locations.gmzubwt,0,0,0,0)):b.uniform4f(d.locations.gmzubwt,f.ambient.color[0],f.ambient.color[1],f.ambient.color[2],1));b.uniform1f(d.locations.tqpeter,f.specular.intensity);e.has(h.SPECULAR)?
(b.uniform1i(d.locations.bdwutbz,f.specular.texture.loadToShader(d,d.locations.chrxigj,d.locations.rdawqhh)),b.uniform4f(d.locations.rmbxdvn,0,0,0,0)):b.uniform4f(d.locations.rmbxdvn,f.specular.color[0],f.specular.color[1],f.specular.color[2],1);e.has(h.SPECULAR_INTENSITY)&&b.uniform1i(d.locations.dkznlil,f.specular.intensityTexture.loadToShader(d,d.locations.hakpqqs,d.locations.vrqlwnm));e.has(h.SPECULAR_ANISOTROPIC)&&(b.uniform1f(d.locations.nvpphgu,f.specularAnisotropic.intensity),b.uniform1i(d.locations.gkgxkms,
f.specularAnisotropic.texture.loadToShader(d,d.locations.cejprze,d.locations.jxhskgy)));b.uniform1f(d.locations.jwbntls,f.emissive.intensity);e.has(h.EMISSIVE)?(b.uniform1i(d.locations.hbaqifu,f.emissive.texture.loadToShader(d,d.locations.fbqzibe,d.locations.kvqnhvv)),b.uniform4f(d.locations.nsnbysp,0,0,0,0)):b.uniform4f(d.locations.nsnbysp,f.emissive.color[0],f.emissive.color[1],f.emissive.color[2],1);e.has(h.EMISSIVE_INTENSITY)&&b.uniform1i(d.locations.qzywjbd,f.emissive.intensityTexture.loadToShader(d,
d.locations.miqrofj,d.locations.urpflui));b.uniform1f(d.locations.fgjxdyy,f.shininess.intensity);e.has(h.SHININESS)&&(b.uniform1i(d.locations.tycsukv,f.shininess.texture.loadToShader(d,d.locations.hivqfir,d.locations.azqmncb)),b.uniform4f(d.locations.uShininessColor,0,0,0,0));b.uniform1f(d.locations.bzmstcf,f.opacity.intensity);b.uniform1f(d.locations.ymenuuk,f.opacity.threshold);b.uniform1i(d.locations.ftqjlzm,f.opacity.blending);e.has(h.NORMAL)&&(b.uniform1i(d.locations.xjrxkxf,f.normalDeformation.texture.loadToShader(d,
d.locations.krklesm,d.locations.vxabpou)),1==f.normalDeformation.type?b.uniform1i(d.locations.bklqtbh,1):b.uniform1i(d.locations.bklqtbh,2),b.uniform1f(d.locations.mtppyuk,f.normalDeformation.scale),e.has(h.NORMAL_SCALE)&&b.uniform1i(d.locations.qxzsape,f.normalDeformation.scaleTexture.loadToShader(d,d.locations.wygpxnc,d.locations.ituhipi)));e.has(h.LIGHT)&&(b.uniform1i(d.locations.shxrduo,f.lightMap.texture.loadToShader(d,d.locations.ljrcsui,d.locations.tbxrkkm)),b.uniform3f(d.locations.zmanptk,
f.lightMap.color[0],f.lightMap.color[1],f.lightMap.color[2]),b.uniform1f(d.locations.rdmdoxh,f.lightMap.intensity),e.has(h.LIGHT_COLOR)&&b.uniform1i(d.locations.kwjbjjn,f.lightMap.colorTexture.loadToShader(d,d.locations.pwyttky,d.locations.hvuuljr)));e.has(h.OPACITY)&&(b.uniform1i(d.locations.bxddaze,f.opacity.texture.loadToShader(d,d.locations.imjkghn,d.locations.avbfhlu)),b.uniform1i(d.locations.uxqdzlm,f.opacity.channel));e.has(h.IRIDESCENT)&&(b.uniform1f(d.locations.schoboi,f.iridescent.intensity),
b.uniform1i(d.locations.bmwhadd,f.iridescent.texture.loadToShader(d,d.locations.djklitl,d.locations.uIridescentTextureUvsrc)),e.has(h.IRIDESCENT_INTENSITY)&&b.uniform1i(d.locations.nkzuzqt,f.iridescent.intensityTexture.loadToShader(d,d.locations.djuzoiv,d.locations.wifbckp)));e.has(h.TRANSLUCENCY)&&(b.uniform1f(d.locations.yfhugch,f.translucency.intensity),e.has(h.TRANSLUCENCYMAP)&&b.uniform1i(d.locations.lweuiuw,f.translucency.texture.loadToShader(d,d.locations.ugabykz,d.locations.iixvswj)));if(e.has(h.OPACITYBLUR))b.uniform1i(d.locations.dfwrrka,
d.textureCount),b.activeTexture(b["TEXTURE"+d.textureCount++]),b.bindTexture(b.TEXTURE_2D,d.blurredTextures[f.opacity.blur]);else switch(f.opacity.blending){case stage.emersya.viewer.BLENDING_MODE.ADDITIVE:b.blendFunc(b.ONE,b.ONE);break;case stage.emersya.viewer.BLENDING_MODE.MULTIPLICATIVE:b.blendFunc(b.DST_COLOR,b.ZERO);break;default:b.blendFunc(b.ONE,b.ONE_MINUS_SRC_ALPHA)}e.has(h.REFLECTION)&&(b.uniform1i(d.locations.xplzpaf,f.reflection.textureCube.loadToShader(d)),b.uniform1f(d.locations.kyuqpss,
f.reflection.intensity),b.uniform1f(d.locations.rhvwknj,f.reflection.blendingLevel),b.uniform1i(d.locations.qrcyyzq,f.reflection.relativeToCamera),b.uniform1i(d.locations.pndixgj,f.reflection.textureCube.positioned),b.uniform3f(d.locations.gveasdj,f.reflection.textureCube.center[0],f.reflection.textureCube.center[1],f.reflection.textureCube.center[2]),b.uniform1f(d.locations.dvdtkio,f.reflection.textureCube.cubeSize));e.has(h.REFRACTION)&&(e.has(h.REFRACTION_CUBEMAP)&&f.refraction.textureCube&&(b.uniform1i(d.locations.mximbml,
f.refraction.textureCube.loadToShader(d)),b.uniform1i(d.locations.goobxbd,f.refraction.textureCube.positioned)),b.uniform1f(d.locations.tvceenj,f.refraction.intensity),b.uniform1f(d.locations.ijwreus,f.refraction.index),b.uniform1i(d.locations.pqtpdgb,f.refraction.relativeToCamera))};r.prototype.loadPbrMaterial=function(b,d,e,f){f=this.currentMaterial;this.animations[this.currentAnimation].useNextMaterialAsBase()&&(f=this.nextMaterial);var h=stage.emersya.viewer.modules.renderer.shaders.shaderTypes;
b.uniform4f(d.locations.qsnvreg,f.albedo.color[0]*f.albedo.intensity,f.albedo.color[1]*f.albedo.intensity,f.albedo.color[2]*f.albedo.intensity,f.albedo.blendingMode);b.uniform1i(d.locations.jdlwajd,f.roughness.gloss);b.uniform1f(d.locations.vztvedk,f.roughness.intensity);b.uniform1f(d.locations.fquroso,f.metalness.intensity);b.uniform1f(d.locations.bzmstcf,f.opacity.intensity);b.uniform1f(d.locations.ymenuuk,f.opacity.threshold);b.uniform1i(d.locations.ftqjlzm,f.opacity.blending);b.uniform1f(d.locations.vdiidww,
f.opacity.glassMode);var m=-1;e.has(h.PBR_ALBEDO_MAP)&&e.has(h.PBR_METAL_MAP)&&e.has(h.PBR_ROUGHNESS_MAP)&&e.has(h.PBR_OPACITY_MAP)?(m=f.albedo.texture&&f.albedo.texture.isReady()?1:0,m&1?b.uniform1i(d.locations.ymlxlax,f.albedo.texture.loadToShader(d,d.locations.hzoknqs,d.locations.ngtowew)):b.uniform1i(d.locations.ymlxlax,d.bindDummyTexture()),m|=f.roughness.texture&&f.roughness.texture.isReady()?2:0,m&2?b.uniform1i(d.locations.ltdhpbn,f.roughness.texture.loadToShader(d,d.locations.pblcfaf,d.locations.ydwikqq)):
b.uniform1i(d.locations.ltdhpbn,d.bindDummyTexture()),m|=f.metalness.texture&&f.metalness.texture.isReady()?4:0,m&4?b.uniform1i(d.locations.zhmvfql,f.metalness.texture.loadToShader(d,d.locations.vfyqlph,d.locations.luvcklm)):b.uniform1i(d.locations.zhmvfql,d.bindDummyTexture()),m|=f.opacity.texture&&f.opacity.texture.isReady()?8:0,m&8?b.uniform1i(d.locations.vthsmnb,f.opacity.texture.loadToShader(d,d.locations.imjkghn,d.locations.smggktt)):b.uniform1i(d.locations.vthsmnb,d.bindDummyTexture())):(e.has(h.PBR_ALBEDO_MAP)&&
b.uniform1i(d.locations.ymlxlax,f.albedo.texture.loadToShader(d,d.locations.hzoknqs,d.locations.ngtowew)),e.has(h.PBR_ROUGHNESS_MAP)&&b.uniform1i(d.locations.ltdhpbn,f.roughness.texture.loadToShader(d,d.locations.pblcfaf,d.locations.ydwikqq)),e.has(h.PBR_METAL_MAP)&&b.uniform1i(d.locations.zhmvfql,f.metalness.texture.loadToShader(d,d.locations.vfyqlph,d.locations.luvcklm)),e.has(h.PBR_OPACITY_MAP)&&b.uniform1i(d.locations.vthsmnb,f.opacity.texture.loadToShader(d,d.locations.imjkghn,d.locations.smggktt)));
e.has(h.PBR_SPECULAR)?(b.uniform1f(d.locations.tqpeter,f.albedo.specular.intensity+0),b.uniform4f(d.locations.rmbxdvn,f.albedo.specular.color[0],f.albedo.specular.color[1],f.albedo.specular.color[2],1),e.has(h.PBR_SPECULAR_MAP)&&b.uniform1i(d.locations.bdwutbz,f.albedo.specular.texture.loadToShader(d,d.locations.chrxigj,d.locations.rdawqhh)),e.has(h.PBR_SPECULAR_INTENSITY)&&b.uniform1i(d.locations.dkznlil,f.albedo.specular.intensityTexture.loadToShader(d,d.locations.hakpqqs,d.locations.vrqlwnm)),
e.has(h.PBR_SPECULAR_FRESNEL_MODE)&&b.uniform1f(d.locations.nsowafh,f.albedo.specular.fresnel)):(b.uniform1f(d.locations.tqpeter,0),b.uniform4f(d.locations.rmbxdvn,1,1,1,1));e.has(h.PBR_NORMAL_MAP)&&(b.uniform1i(d.locations.yeqgzpf,f.normalDeformation.texture.loadToShader(d,d.locations.rjgjnzi,d.locations.ingoasu)),b.uniform1f(d.locations.xqahzng,f.normalDeformation.intensity),b.uniform1i(d.locations.xedrqbd,0+!!f.normalDeformation.inverted));e.has(h.PBR_BUMP_MAP)&&(b.uniform1i(d.locations.yeqgzpf,
f.normalDeformation.texture.loadToShader(d,d.locations.rjgjnzi,d.locations.ingoasu)),b.uniform1f(d.locations.xqahzng,Math.pow(.8*f.normalDeformation.intensity,2)),b.uniform1i(d.locations.xedrqbd,0+!!f.normalDeformation.inverted));e.has(h.PBR_NORMAL_INTENSITY)&&b.uniform1i(d.locations.vohmaky,f.normalDeformation.intensityTexture.loadToShader(d,d.locations.rasiqrh,d.locations.wullosg));e.has(h.PBR_NORMAL_MAP2)&&(b.uniform1i(d.locations.rybvhvu,f.normalDeformation.texture2.loadToShader(d,d.locations.shdknig,
d.locations.wtmnctg)),b.uniform1f(d.locations.csdjrkx,f.normalDeformation.intensity2),b.uniform1i(d.locations.zvckycw,0+!!f.normalDeformation.inverted2));e.has(h.PBR_BUMP_MAP2)&&(b.uniform1i(d.locations.rybvhvu,f.normalDeformation.texture2.loadToShader(d,d.locations.shdknig,d.locations.wtmnctg)),b.uniform1f(d.locations.csdjrkx,Math.pow(.8*f.normalDeformation.intensity2,2)),b.uniform1i(d.locations.zvckycw,0+!!f.normalDeformation.inverted2));e.has(h.PBR_NORMAL_INTENSITY2)&&b.uniform1i(d.locations.wuylkyh,
f.normalDeformation.intensityTexture2.loadToShader(d,d.locations.qawohzh,d.locations.xhreiep));e.has(h.PBR_EMISSIVE)&&(b.uniform4f(d.locations.nsnbysp,f.emissive.color[0],f.emissive.color[1],f.emissive.color[2],f.emissive.intensity),b.uniform1i(d.locations.tpxgrnu,f.emissive.blendingMode),e.has(h.PBR_EMISSIVE_MAP)&&b.uniform1i(d.locations.udeimwb,f.emissive.texture.loadToShader(d,d.locations.fbqzibe,d.locations.ponpmlf)),e.has(h.PBR_EMISSIVE_INTENSITY_MAP)&&b.uniform1i(d.locations.nkdvrfp,f.emissive.intensityTexture.loadToShader(d,
d.locations.miqrofj,d.locations.dovwrzg)));e.has(h.PBR_AMBIENT_OCCLUSION)&&(b.uniform1f(d.locations.tticctp,f.occlusion.ambientIntensity),e.has(h.PBR_AMBIENT_OCCLUSION_MAP)?(b.uniform1i(d.locations.cjsawvn,f.occlusion.ambientTexture.loadToShader(d,d.locations.tiaooli,d.locations.usbxvxd)),b.uniform1f(d.locations.ktxjfle,-f.occlusion.ambientTextureCorrection)):b.uniform1f(d.locations.ktxjfle,0));e.has(h.PBR_LIGHT_OCCLUSION)&&(b.uniform1f(d.locations.mlpvzht,f.occlusion.lightIntensity),e.has(h.PBR_LIGHT_OCCLUSION_MAP)?
(b.uniform1i(d.locations.uwddkhh,f.occlusion.lightTexture.loadToShader(d,d.locations.kotsuvy,d.locations.fvyblms)),b.uniform1f(d.locations.tattnol,-f.occlusion.lightTextureCorrection)):b.uniform1f(d.locations.tattnol,0));if(e.has(h.PBR_IRIDESCENCE_F0)||e.has(h.PBR_IRIDESCENCE_AL))b.uniform4fv(d.locations.nplnhzx,f.iridescence.shaderColormap.colors),b.uniform1fv(d.locations.pmiexkd,f.iridescence.shaderColormap.locations),b.uniform1f(d.locations.wikjwmu,f.iridescence.intensity),e.has(h.PBR_IRIDESCENCE_INTENSITY)&&
b.uniform1i(d.locations.pvowxhe,f.iridescence.texture.loadToShader(d,d.locations.jtmrnbj,d.locations.cofxubp));if(f.localEnvironment&&f.localEnvironment.texture&&f.localEnvironment.texture.isReady()){b.uniform3f(d.locations.ptlusfy,f.localEnvironment.tint[0],f.localEnvironment.tint[1],f.localEnvironment.tint[2]);if(b.floatTextures&&e.has(h.PBR_ENV_CUBES)){var g=d.textureCount++;b.activeTexture(b.TEXTURE0+g);b.bindTexture(b.TEXTURE_CUBE_MAP,f.localEnvironment.texture.cube1);b.uniform1i(d.locations.ffhousu,
g);g=d.textureCount++;b.activeTexture(b.TEXTURE0+g);b.bindTexture(b.TEXTURE_CUBE_MAP,f.localEnvironment.texture.cube2);b.uniform1i(d.locations.rilfrvi,g);g=d.textureCount++;b.activeTexture(b.TEXTURE0+g);b.bindTexture(b.TEXTURE_CUBE_MAP,f.localEnvironment.texture.cube3);b.uniform1i(d.locations.miezeao,g);g=d.textureCount++;b.activeTexture(b.TEXTURE0+g);b.bindTexture(b.TEXTURE_CUBE_MAP,f.localEnvironment.texture.cube4);b.uniform1i(d.locations.xtelvnu,g);g=d.textureCount++;b.activeTexture(b.TEXTURE0+
g);b.bindTexture(b.TEXTURE_CUBE_MAP,f.localEnvironment.texture.cube5);b.uniform1i(d.locations.kgsywlg,g);g=d.textureCount++;b.activeTexture(b.TEXTURE0+g);b.bindTexture(b.TEXTURE_CUBE_MAP,f.localEnvironment.texture.cube6);b.uniform1i(d.locations.codyzck,g)}else b.uniform1i(d.locations.gxvoadx,f.localEnvironment.texture.loadToShader(d,d.locations.uEnvironmentTextureUvsrc,null,d.pbrEnvironmentTextureSettings));b.uniform1i(d.locations.kebjccr,f.localEnvironment.relativeToCamera);b.uniform1f(d.locations.jmnndrt,
f.localEnvironment.rotation+0);b.uniform1f(d.locations.ikywnlr,e.has(h.PBR_ENV_CUBES)&&!b.halfFloatTexturesForEnvCubes&&0>f.localEnvironment.exposure?0:f.localEnvironment.exposure+0)}else this.scene.scenery.environmentTexture&&this.scene.scenery.environmentTexture.isReady()?(b.floatTextures&&e.has(h.PBR_ENV_CUBES)?(g=d.textureCount++,b.activeTexture(b.TEXTURE0+g),b.bindTexture(b.TEXTURE_CUBE_MAP,this.scene.scenery.environmentTexture.cube1),b.uniform1i(d.locations.ffhousu,g),g=d.textureCount++,b.activeTexture(b.TEXTURE0+
g),b.bindTexture(b.TEXTURE_CUBE_MAP,this.scene.scenery.environmentTexture.cube2),b.uniform1i(d.locations.rilfrvi,g),g=d.textureCount++,b.activeTexture(b.TEXTURE0+g),b.bindTexture(b.TEXTURE_CUBE_MAP,this.scene.scenery.environmentTexture.cube3),b.uniform1i(d.locations.miezeao,g),g=d.textureCount++,b.activeTexture(b.TEXTURE0+g),b.bindTexture(b.TEXTURE_CUBE_MAP,this.scene.scenery.environmentTexture.cube4),b.uniform1i(d.locations.xtelvnu,g),g=d.textureCount++,b.activeTexture(b.TEXTURE0+g),b.bindTexture(b.TEXTURE_CUBE_MAP,
this.scene.scenery.environmentTexture.cube5),b.uniform1i(d.locations.kgsywlg,g),g=d.textureCount++,b.activeTexture(b.TEXTURE0+g),b.bindTexture(b.TEXTURE_CUBE_MAP,this.scene.scenery.environmentTexture.cube6),b.uniform1i(d.locations.codyzck,g)):b.uniform1i(d.locations.gxvoadx,this.scene.scenery.environmentTexture.loadToShader(d,null,null,null,d.pbrEnvironmentTextureSettings)),b.uniform1i(d.locations.kebjccr,this.scene.scenery.environmentRelativeToCamera),b.uniform1f(d.locations.jmnndrt,this.scene.scenery.environmentRotation+
0),b.uniform1f(d.locations.ikywnlr,e.has(h.PBR_ENV_CUBES)&&!b.halfFloatTexturesForEnvCubes&&0>this.scene.scenery.environmentExposure?0:this.scene.scenery.environmentExposure+0)):(b.floatTextures&&e.has(h.PBR_ENV_CUBES)?(b.uniform1i(d.locations.ffhousu,d.bindDummyTextureCube()),b.uniform1i(d.locations.rilfrvi,d.bindDummyTextureCube()),b.uniform1i(d.locations.miezeao,d.bindDummyTextureCube()),b.uniform1i(d.locations.xtelvnu,d.bindDummyTextureCube()),b.uniform1i(d.locations.kgsywlg,d.bindDummyTextureCube()),
b.uniform1i(d.locations.codyzck,d.bindDummyTextureCube())):b.uniform1i(d.locations.gxvoadx,d.bindDummyTexture()),b.uniform1i(d.locations.kebjccr,0),b.uniform1f(d.locations.jmnndrt,0),b.uniform1f(d.locations.ikywnlr,0)),b.uniform3f(d.locations.ptlusfy,1,1,1);e.has(h.PBR_ANISOTROPY)&&(b.uniform1f(d.locations.tqvmssp,f.metalness.anisotropy.intensity),b.uniform1f(d.locations.cjovtni,f.metalness.anisotropy.angle*Math.PI/180),e.has(h.PBR_ANISOTROPY_MAP)&&b.uniform1i(d.locations.cflnaem,f.metalness.anisotropy.texture.loadToShader(d,
d.locations.dmyiwir,d.locations.uxcpxdf)),e.has(h.PBR_ANISOTROPY_INTENSITY_MAP)&&b.uniform1i(d.locations.wywddxj,f.metalness.anisotropy.intensityTexture.loadToShader(d,d.locations.phepegv,d.locations.gulzwyp)),e.has(h.PBR_ANISOTROPY_ROUGHNESS_MAP)&&b.uniform1i(d.locations.aykqlve,f.metalness.anisotropy.roughnessTexture.loadToShader(d,d.locations.jbzfnah,d.locations.ajpiohp)),e.has(h.PBR_ANISOTROPY_ROTATION_MAP)&&b.uniform1i(d.locations.tshbnse,f.metalness.anisotropy.rotationTexture.loadToShader(d,
d.locations.dggoqiq,d.locations.mmmifet)));e.has(h.PBR_REFRACTION)&&(e.has(h.PBR_REFRACTION_CUBEMAP)&&f.opacity.refraction.textureCube&&(b.uniform1i(d.locations.mximbml,f.opacity.refraction.textureCube.loadToShader(d)),b.uniform1i(d.locations.goobxbd,f.opacity.refraction.textureCube.positioned)),b.uniform1f(d.locations.tvceenj,f.opacity.refraction.intensity),b.uniform1f(d.locations.ijwreus,f.opacity.refraction.index),b.uniform1i(d.locations.pqtpdgb,f.opacity.refraction.relativeToCamera));e.has(h.PBR_COATING)&&
(b.uniform1f(d.locations.ndvebik,f.coating.intensity),b.uniform1f(d.locations.abxhprd,f.coating.thickness),b.uniform1f(d.locations.uyctxef,f.coating.roughness),b.uniform1f(d.locations.pqiyuoc,f.coating.ior),b.uniform3f(d.locations.itkobbj,1-f.coating.color[0]*f.coating.colorIntensity,1-f.coating.color[1]*f.coating.colorIntensity,1-f.coating.color[2]*f.coating.colorIntensity),e.has(h.PBR_COATING_INTENSITY_MAP)&&b.uniform1i(d.locations.opjqilf,f.coating.intensityTexture.loadToShader(d,d.locations.nzqvvha,
d.locations.urczxqn)),e.has(h.PBR_COATING_THICKNESS_MAP)&&b.uniform1i(d.locations.avazlhu,f.coating.thicknessTexture.loadToShader(d,d.locations.vaukewk,d.locations.bzfntqa)),e.has(h.PBR_COATING_ROUGHNESS_MAP)&&b.uniform1i(d.locations.yghjgai,f.coating.roughnessTexture.loadToShader(d,d.locations.lnqzuxw,d.locations.oldfyhf)),e.has(h.PBR_COATING_NORMAL_MAP)&&(b.uniform1f(d.locations.pjpgdaw,f.coating.normalIntensity),b.uniform1i(d.locations.iuupley,f.coating.normalInverted),b.uniform1i(d.locations.lsbkrcl,
f.coating.normalTexture.loadToShader(d,d.locations.umjpvqc,d.locations.mwyuitt))));e.has(h.PBR_FUR)&&this.loadFurMaterial(b,d);e.has(h.PBR_SHEEN)&&(b.uniform3f(d.locations.ooatcna,f.roughness.sheen.color[0],f.roughness.sheen.color[1],f.roughness.sheen.color[2]),b.uniform1f(d.locations.cqqogff,f.roughness.sheen.intensity),e.has(h.PBR_SHEEN_MAP)&&b.uniform1i(d.locations.jezuqal,f.roughness.sheen.texture.loadToShader(d,d.locations.nxdiahe,d.locations.yuqudeq)),e.has(h.PBR_SHEEN_INTENSITY_MAP)&&b.uniform1i(d.locations.stagxue,
f.roughness.sheen.intensityTexture.loadToShader(d,d.locations.zjpbhvf,d.locations.gdmnvaa)),!e.has(h.PBR_SHEEN_OLD_SHADER)&&e.has(h.PBR_SHEEN_CUSTOM_ROUGHNESS)&&(b.uniform1f(d.locations.onlskix,f.roughness.sheen.roughness),e.has(h.PBR_SHEEN_ROUGHNESS_MAP)&&b.uniform1i(d.locations.rzgjmme,f.roughness.sheen.roughnessTexture.loadToShader(d,d.locations.wqkzcsl,d.locations.qvnyrht))));if(e.has(h.OPACITYBLUR))b.uniform1i(d.locations.dfwrrka,d.textureCount),b.activeTexture(b["TEXTURE"+d.textureCount++]),
b.bindTexture(b.TEXTURE_2D,d.blurredTextures[f.opacity.blur]);else switch(f.opacity.blending){case stage.emersya.viewer.BLENDING_MODE.ADDITIVE:b.blendFunc(b.ONE,b.ONE);break;case stage.emersya.viewer.BLENDING_MODE.MULTIPLICATIVE:b.blendFunc(b.DST_COLOR,b.ZERO);break;default:b.blendFunc(b.ONE,b.ONE_MINUS_SRC_ALPHA)}e.has(h.TRANSLUCENCY)&&(b.uniform1f(d.locations.yfhugch,f.translucency.intensity),e.has(h.TRANSLUCENCYMAP)&&b.uniform1i(d.locations.lweuiuw,f.translucency.texture.loadToShader(d,d.locations.ugabykz,
d.locations.iixvswj)));e.has(h.PBR_CARPAINT)&&this.loadCarPaintMaterial(b,d,e);return m};r.prototype.loadPbrMaterialAnim=function(b,d,e,f,g){f=this.animations[this.currentAnimation];if(!f.needsTransitionShader()||!this.nextMaterial)return g;var h=stage.emersya.viewer.modules.renderer.shaders.shaderTypes;if(stage.browser.mobilBrowser||!e.has(h.ANIMATING))return f.interpolateUvTransform&&E.call(this,e,d),g;var m=this.nextMaterial;b.uniform1f(d.locations.heftokz,f.computeAcceleration());b.uniform3f(d.locations.qsnvreg2,
m.albedo.color[0]*m.albedo.intensity,m.albedo.color[1]*m.albedo.intensity,m.albedo.color[2]*m.albedo.intensity);b.uniform1f(d.locations.vztvedk2,m.roughness.intensity);b.uniform1i(d.locations.jdlwajd2,m.roughness.gloss);b.uniform1f(d.locations.fquroso2,m.metalness.intensity);b.uniform1f(d.locations.bzmstcf2,m.opacity.intensity);b.uniform1f(d.locations.ymenuuk2,m.opacity.threshold);e.has(h.PBR_ANIM_ALBEDO_MAP)&&e.has(h.PBR_ANIM_ROUGHNESS_MAP)&&e.has(h.PBR_ANIM_METAL_MAP)&&e.has(h.PBR_ANIM_OPACITY_MAP)?
(g|=m.albedo.texture&&m.albedo.texture.isReady()?16:0,g&16?b.uniform1i(d.locations.ymlxlax2,m.albedo.texture.loadToShader(d,d.locations.hzoknqs2,d.locations.ngtowew2)):b.uniform1i(d.locations.ymlxlax2,d.bindDummyTexture()),g|=m.roughness.texture&&m.roughness.texture.isReady()?32:0,g&32?b.uniform1i(d.locations.ltdhpbn2,m.roughness.texture.loadToShader(d,d.locations.pblcfaf2,d.locations.ydwikqq2)):b.uniform1i(d.locations.ltdhpbn2,d.bindDummyTexture()),g|=m.metalness.texture&&m.metalness.texture.isReady()?
64:0,g&64?b.uniform1i(d.locations.zhmvfql2,m.metalness.texture.loadToShader(d,d.locations.vfyqlph2,d.locations.luvcklm2)):b.uniform1i(d.locations.zhmvfql2,d.bindDummyTexture()),g|=m.opacity.texture&&m.opacity.texture.isReady()?128:0,g&128?b.uniform1i(d.locations.vthsmnb2,m.opacity.texture.loadToShader(d,d.locations.imjkghn2,d.locations.smggktt2)):b.uniform1i(d.locations.vthsmnb2,d.bindDummyTexture())):(e.has(h.PBR_ANIM_ALBEDO_MAP)&&b.uniform1i(d.locations.ymlxlax2,m.albedo.texture.loadToShader(d,
d.locations.hzoknqs2,d.locations.ngtowew2)),e.has(h.PBR_ANIM_ROUGHNESS_MAP)&&b.uniform1i(d.locations.ltdhpbn2,m.roughness.texture.loadToShader(d,d.locations.pblcfaf2,d.locations.ydwikqq2)),e.has(h.PBR_ANIM_METAL_MAP)&&b.uniform1i(d.locations.zhmvfql2,m.metalness.texture.loadToShader(d,d.locations.vfyqlph2,d.locations.luvcklm2)),e.has(h.PBR_ANIM_OPACITY_MAP)&&b.uniform1i(d.locations.vthsmnb2,m.opacity.texture.loadToShader(d,d.locations.imjkghn2,d.locations.smggktt2)));e.has(h.PBR_ANIM_SPECULAR_MAP)?
(b.uniform1f(d.locations.tqpeter2,m.albedo.specular.intensity),b.uniform4f(d.locations.rmbxdvn2,m.albedo.specular.color[0],m.albedo.specular.color[1],m.albedo.specular.color[2],1),e.has(h.PBR_ANIM_SPECULAR_MAP)&&b.uniform1i(d.locations.bdwutbz2,m.albedo.specular.texture.loadToShader(d,d.locations.chrxigj2,d.locations.rdawqhh2)),e.has(h.PBR_ANIM_SPECULAR_INTENSITY)&&b.uniform1i(d.locations.dkznlil2,m.albedo.specular.intensityTexture.loadToShader(d,d.locations.hakpqqs2,d.locations.vrqlwnm2))):(b.uniform1f(d.locations.tqpeter2,
0),b.uniform4f(d.locations.rmbxdvn2,1,1,1,1));e.has(h.PBR_ANIM_NORMAL_MAP)&&(b.uniform1i(d.locations.yeqgzpf2,m.normalDeformation.texture.loadToShader(d,d.locations.rjgjnzi2,d.locations.ingoasu2)),b.uniform1f(d.locations.xqahzng2,m.normalDeformation.intensity),b.uniform1i(d.locations.xedrqbd2,0+!!m.normalDeformation.inverted));e.has(h.PBR_ANIM_BUMP_MAP)&&(b.uniform1i(d.locations.yeqgzpf2,m.normalDeformation.texture.loadToShader(d,d.locations.rjgjnzi2,d.locations.ingoasu2)),b.uniform1f(d.locations.xqahzng2,
Math.pow(.8*m.normalDeformation.intensity,2)),b.uniform1i(d.locations.xedrqbd2,0+!!m.normalDeformation.inverted));e.has(h.PBR_ANIM_NORMAL_INTENSITY)&&b.uniform1i(d.locations.vohmaky2,m.normalDeformation.intensityTexture.loadToShader(d,d.locations.rasiqrh2,d.locations.wullosg2));e.has(h.PBR_ANIM_NORMAL_MAP2)&&(b.uniform1i(d.locations.rybvhvu2,m.normalDeformation.texture2.loadToShader(d,d.locations.shdknig2,d.locations.wtmnctg2)),b.uniform1f(d.locations.csdjrkx2,m.normalDeformation.intensity2),b.uniform1i(d.locations.zvckycw2,
0+!!m.normalDeformation.inverted2));e.has(h.PBR_ANIM_BUMP_MAP2)&&(b.uniform1i(d.locations.rybvhvu2,m.normalDeformation.texture2.loadToShader(d,d.locations.shdknig2,d.locations.wtmnctg2)),b.uniform1f(d.locations.csdjrkx2,Math.pow(.8*m.normalDeformation.intensity2,2)),b.uniform1i(d.locations.zvckycw2,0+!!m.normalDeformation.inverted2));e.has(h.PBR_ANIM_NORMAL_INTENSITY2)&&b.uniform1i(d.locations.wuylkyh2,m.normalDeformation.intensityTexture2.loadToShader(d,d.locations.qawohzh2,d.locations.xhreiep2));
e.has(h.PBR_ANIM_AMBIENT_OCCLUSION)&&b.uniform1f(d.locations.tticctp2,m.occlusion.ambientIntensity);e.has(h.PBR_ANIM_AMBIENT_OCCLUSION_MAP)?(b.uniform1i(d.locations.cjsawvn2,m.occlusion.ambientTexture.loadToShader(d,d.locations.tiaooli2,d.locations.usbxvxd2)),b.uniform1f(d.locations.ktxjfle2,-m.occlusion.ambientTextureCorrection)):b.uniform1f(d.locations.ktxjfle2,0);e.has(h.PBR_ANIM_LIGHT_OCCLUSION)&&(b.uniform1f(d.locations.mlpvzht2,m.occlusion.lightIntensity),e.has(h.PBR_ANIM_LIGHT_OCCLUSION_MAP)?
(b.uniform1i(d.locations.uwddkhh2,m.occlusion.lightTexture.loadToShader(d,d.locations.kotsuvy2,d.locations.fvyblms2)),b.uniform1f(d.locations.tattnol2,-m.occlusion.lightTextureCorrection)):b.uniform1f(d.locations.tattnol2,0));e.has(h.PBR_ANIM_EMISSIVE)&&b.uniform4f(d.locations.nsnbysp2,m.emissive.color[0],m.emissive.color[1],m.emissive.color[2],m.emissive.intensity);e.has(h.PBR_ANIM_EMISSIVE_MAP)&&b.uniform1i(d.locations.udeimwb2,m.emissive.texture.loadToShader(d,d.locations.fbqzibe2,d.locations.ponpmlf2));
e.has(h.PBR_ANIM_EMISSIVE_INTENSITY_MAP)&&b.uniform1i(d.locations.nkdvrfp2,m.emissive.intensityTexture.loadToShader(d,d.locations.miqrofj2,d.locations.dovwrzg2));e.has(h.PBR_ANIM_ANISOTROPY)&&(b.uniform1f(d.locations.tqvmssp2,m.metalness.anisotropy.intensity),b.uniform1f(d.locations.cjovtni2,m.metalness.anisotropy.angle*Math.PI/180),e.has(h.PBR_ANIM_ANISOTROPY_MAP)&&b.uniform1i(d.locations.cflnaem2,m.metalness.anisotropy.texture.loadToShader(d,d.locations.dmyiwir2,d.locations.uxcpxdf2)),e.has(h.PBR_ANIM_ANISOTROPY_INTENSITY_MAP)&&
b.uniform1i(d.locations.wywddxj2,m.metalness.anisotropy.intensityTexture.loadToShader(d,d.locations.phepegv2,d.locations.gulzwyp2)),e.has(h.PBR_ANIM_ANISOTROPY_ROUGHNESS_MAP)&&b.uniform1i(d.locations.aykqlve2,m.metalness.anisotropy.roughnessTexture.loadToShader(d,d.locations.jbzfnah2,d.locations.ajpiohp2)),e.has(h.PBR_ANIM_ANISOTROPY_ROTATION_MAP)&&b.uniform1i(d.locations.tshbnse2,m.metalness.anisotropy.rotationTexture.loadToShader(d,d.locations.dggoqiq2,d.locations.mmmifet2)));e.has(h.PBR_ANIM_REFRACTION)&&
(e.has(h.PBR_ANIM_REFRACTION_CUBEMAP)&&m.opacity.refraction.textureCube&&(b.uniform1i(d.locations.mximbml2,m.opacity.refraction.textureCube.loadToShader(d)),b.uniform1i(d.locations.goobxbd2,m.opacity.refraction.textureCube.positioned)),b.uniform1f(d.locations.tvceenj2,m.opacity.refraction.intensity),b.uniform1f(d.locations.ijwreus2,m.opacity.refraction.index),b.uniform1i(d.locations.pqtpdgb2,m.opacity.refraction.relativeToCamera));if(e.has(h.PBR_ANIM_IRIDESCENCE_F0)||e.has(h.PBR_ANIM_IRIDESCENCE_AL))b.uniform4fv(d.locations.nplnhzx2,
m.iridescence.shaderColormap.colors),b.uniform1fv(d.locations.pmiexkd2,m.iridescence.shaderColormap.locations),b.uniform1f(d.locations.wikjwmu2,m.iridescence.intensity),e.has(h.PBR_ANIM_IRIDESCENCE_INTENSITY)&&b.uniform1i(d.locations.pvowxhe2,m.iridescence.texture.loadToShader(d,d.locations.jtmrnbj2,d.locations.cofxubp2));e.has(h.PBR_ANIM_COATING)&&(b.uniform1f(d.locations.ndvebik2,m.coating.intensity),b.uniform1f(d.locations.abxhprd2,m.coating.thickness),b.uniform1f(d.locations.uyctxef2,m.coating.roughness),
b.uniform1f(d.locations.pqiyuoc2,m.coating.ior),b.uniform3f(d.locations.itkobbj2,1-m.coating.color[0]*m.coating.colorIntensity,1-m.coating.color[1]*m.coating.colorIntensity,1-m.coating.color[2]*m.coating.colorIntensity));e.has(h.PBR_ANIM_COATING_INTENSITY_MAP)&&b.uniform1i(d.locations.opjqilf2,m.coating.intensityTexture.loadToShader(d,d.locations.nzqvvha2,d.locations.urczxqn2));e.has(h.PBR_ANIM_COATING_THICKNESS_MAP)&&b.uniform1i(d.locations.avazlhu2,m.coating.thicknessTexture.loadToShader(d,d.locations.vaukewk2,
d.locations.bzfntqa2));e.has(h.PBR_ANIM_COATING_ROUGHNESS_MAP)&&b.uniform1i(d.locations.yghjgai2,m.coating.roughnessTexture.loadToShader(d,d.locations.lnqzuxw2,d.locations.oldfyhf2));e.has(h.PBR_ANIM_COATING_NORMAL_MAP)&&(b.uniform1f(d.locations.pjpgdaw2,m.coating.normalIntensity),b.uniform1i(d.locations.iuupley2,m.coating.normalInverted2),b.uniform1i(d.locations.lsbkrcl2,m.coating.normalTexture.loadToShader(d,d.locations.umjpvqc2,d.locations.mwyuitt2)));e.has(h.PBR_ANIM_SHEEN)&&(b.uniform3f(d.locations.ooatcna2,
m.roughness.sheen.color[0],m.roughness.sheen.color[1],m.roughness.sheen.color[2]),b.uniform1f(d.locations.cqqogff2,m.roughness.sheen.intensity),e.has(h.PBR_ANIM_SHEEN_MAP)&&b.uniform1i(d.locations.jezuqal2,m.roughness.sheen.texture.loadToShader(d,d.locations.nxdiahe2,d.locations.yuqudeq2)),e.has(h.PBR_ANIM_SHEEN_INTENSITY_MAP)&&b.uniform1i(d.locations.stagxue2,m.roughness.sheen.intensityTexture.loadToShader(d,d.locations.zjpbhvf2,d.locations.gdmnvaa2)),!e.has(h.PBR_SHEEN_OLD_SHADER)&&e.has(h.PBR_ANIM_SHEEN_CUSTOM_ROUGHNESS)&&
(b.uniform1f(d.locations.onlskix2,m.roughness.sheen.roughness),e.has(h.PBR_ANIM_SHEEN_ROUGHNESS_MAP)&&b.uniform1i(d.locations.rzgjmme2,m.roughness.sheen.roughnessTexture.loadToShader(d,d.locations.wqkzcsl2,d.locations.qvnyrht2))));f.interpolateUvTransform&&E.call(this,e,d);return g};r.prototype.loadClassicMaterialAnim=function(b,d,e,f){f=this.animations[this.currentAnimation];if(f.needsTransitionShader()){var h=stage.emersya.viewer.modules.renderer.shaders.shaderTypes;if(null!==this.nextMaterial){if(!stage.browser.mobilBrowser){b.uniform1f(d.locations.heftokz,
f.computeAcceleration());var g=this.nextMaterial;e.has(h.ANIM_REFLECTIONMAP)&&b.uniform1i(d.locations.fnltzwx2,g.reflection.texture.loadToShader(d,d.locations.vdzqqlc2,d.locations.cjpagro2));e.has(h.ANIM_REFRACTIONMAP)&&b.uniform1i(d.locations.pofdivt2,g.refraction.texture.loadToShader(d,d.locations.gqedqnf2,d.locations.dzptjrq2));b.uniform1f(d.locations.fhguuoo2,g.diffuse.intensity);e.has(h.ANIM_DIFFUSE)?(b.uniform1i(d.locations.xspuomx2,g.diffuse.texture.loadToShader(d,d.locations.bbjrkoj2,d.locations.jcxvcld2)),
b.uniform4f(d.locations.xcxkhty2,0,0,0,0)):b.uniform4f(d.locations.xcxkhty2,g.diffuse.color[0],g.diffuse.color[1],g.diffuse.color[2],1);g.ambient.diffuseColor?b.uniform1f(d.locations.yxuhtpf2,g.diffuse.intensity*g.ambient.intensity):(b.uniform1f(d.locations.yxuhtpf2,g.ambient.intensity),e.has(h.ANIM_AMBIENT)?(b.uniform1i(d.locations.kkbgecz2,g.ambient.texture.loadToShader(d,d.locations.smlqamg2,d.locations.lizkbiv2)),b.uniform4f(d.locations.gmzubwt2,0,0,0,0)):b.uniform4f(d.locations.gmzubwt2,g.ambient.color[0],
g.ambient.color[1],g.ambient.color[2],1));b.uniform1f(d.locations.tqpeter2,g.specular.intensity);e.has(h.ANIM_SPECULAR)?(b.uniform1i(d.locations.bdwutbz2,g.specular.texture.loadToShader(d,d.locations.chrxigj2,d.locations.rdawqhh2)),b.uniform4f(d.locations.rmbxdvn2,0,0,0,0)):b.uniform4f(d.locations.rmbxdvn2,g.specular.color[0],g.specular.color[1],g.specular.color[2],1);e.has(h.ANIM_SPECULAR_INTENSITY)&&b.uniform1i(d.locations.dkznlil2,g.specular.intensityTexture.loadToShader(d,d.locations.hakpqqs2,
d.locations.vrqlwnm2));e.has(h.ANIM_SPECULAR_ANISOTROPIC)&&(b.uniform1f(d.locations.nvpphgu2,g.specularAnisotropic.intensity),b.uniform1i(d.locations.gkgxkms2,g.specularAnisotropic.texture.loadToShader(d,d.locations.cejprze2,d.locations.jxhskgy2)));b.uniform1f(d.locations.jwbntls2,g.emissive.intensity);e.has(h.ANIM_EMISSIVE)?(b.uniform1i(d.locations.hbaqifu2,g.emissive.texture.loadToShader(d,d.locations.fbqzibe2,d.locations.kvqnhvv2)),b.uniform4f(d.locations.nsnbysp2,0,0,0,0)):b.uniform4f(d.locations.nsnbysp2,
g.emissive.color[0],g.emissive.color[1],g.emissive.color[2],1);e.has(h.ANIM_EMISSIVE_INTENSITY)&&b.uniform1i(d.locations.qzywjbd2,g.emissive.intensityTexture.loadToShader(d,d.locations.miqrofj2,d.locations.urpflui2));b.uniform1f(d.locations.fgjxdyy2,g.shininess.intensity);e.has(h.ANIM_SHININESS)&&(b.uniform1i(d.locations.tycsukv2,g.shininess.texture.loadToShader(d,d.locations.hivqfir2,d.locations.azqmncb2)),b.uniform4f(d.locations.uShininessColor2,0,0,0,0));b.uniform1f(d.locations.bzmstcf2,g.opacity.intensity);
b.uniform1f(d.locations.ymenuuk2,g.opacity.threshold);e.has(h.ANIM_OPACITY)&&(b.uniform1i(d.locations.bxddaze2,g.opacity.texture.loadToShader(d,d.locations.imjkghn2,d.locations.avbfhlu2)),b.uniform1i(d.locations.uxqdzlm2,g.opacity.channel));e.has(h.ANIM_LIGHT)&&(b.uniform1i(d.locations.shxrduo2,g.lightMap.texture.loadToShader(d,d.locations.ljrcsui2,d.locations.tbxrkkm2)),b.uniform3f(d.locations.zmanptk2,g.lightMap.color[0],g.lightMap.color[1],g.lightMap.color[2]),b.uniform1f(d.locations.rdmdoxh2,
g.lightMap.intensity),e.has(h.ANIM_LIGHT_COLOR)&&b.uniform1i(d.locations.kwjbjjn2,g.lightMap.colorTexture.loadToShader(d,d.locations.pwyttky2,d.locations.hvuuljr2)));e.has(h.ANIM_NORMAL)&&(b.uniform1i(d.locations.xjrxkxf2,g.normalDeformation.texture.loadToShader(d,d.locations.krklesm2,d.locations.vxabpou2)),1==g.normalDeformation.type?b.uniform1i(d.locations.bklqtbh2,1):b.uniform1i(d.locations.bklqtbh2,2),b.uniform1f(d.locations.mtppyuk2,g.normalDeformation.scale),e.has(h.ANIM_NORMAL_SCALE)&&b.uniform1i(d.locations.qxzsape2,
g.normalDeformation.scaleTexture.loadToShader(d,d.locations.wygpxnc2,d.locations.ituhipi2)));e.has(h.ANIM_IRIDESCENT)&&(b.uniform1f(d.locations.schoboi2,g.iridescent.intensity),b.uniform1i(d.locations.bmwhadd2,g.iridescent.texture.loadToShader(d,d.locations.djklitl2,d.locations.uIridescentTextureUvsrc2)),e.has(h.ANIM_IRIDESCENT_INTENSITY)&&b.uniform1i(d.locations.nkzuzqt2,g.iridescent.intensityTexture.loadToShader(d,d.locations.djuzoiv2,d.locations.wifbckp2)));e.has(h.ANIM_TRANSLUCENCY)&&(b.uniform1f(d.locations.yfhugch2,
g.translucency.intensity),e.has(h.ANIM_TRANSLUCENCYMAP)&&b.uniform1i(d.locations.lweuiuw2,g.translucency.texture.loadToShader(d,d.locations.ugabykz2,d.locations.iixvswj2)));e.has(h.ANIM_REFLECTION)&&(b.uniform1i(d.locations.xplzpaf2,g.reflection.textureCube.loadToShader(d)),b.uniform1f(d.locations.kyuqpss2,g.reflection.intensity),b.uniform1f(d.locations.rhvwknj2,g.reflection.blendingLevel),b.uniform1i(d.locations.qrcyyzq2,g.reflection.relativeToCamera),b.uniform1i(d.locations.pndixgj2,g.reflection.textureCube.positioned),
b.uniform3f(d.locations.gveasdj2,g.reflection.textureCube.center[0],g.reflection.textureCube.center[1],g.reflection.textureCube.center[2]),b.uniform1f(d.locations.dvdtkio2,g.reflection.textureCube.cubeSize));e.has(h.ANIM_REFRACTION)&&(e.has(h.ANIM_REFRACTION_CUBEMAP)&&g.refraction.textureCube&&(b.uniform1i(d.locations.mximbml2,g.refraction.textureCube.loadToShader(d)),b.uniform1i(d.locations.goobxbd2,g.refraction.textureCube.positioned)),b.uniform1f(d.locations.tvceenj2,g.refraction.intensity),b.uniform1f(d.locations.ijwreus2,
g.refraction.index),b.uniform1i(d.locations.pqtpdgb2,g.refraction.relativeToCamera))}f.interpolateUvTransform&&E.call(this,e,d)}}};var E=function(b,d){b=this.currentMaterial;var e=this.nextMaterial;if(e){var f=this.animations[this.currentAnimation].computeAcceleration();b.type?(b.albedo&&b.albedo.texture&&e.albedo&&e.albedo.texture&&b.albedo.texture.interpolateUvTransform(e.albedo.texture,f,d.locations.hzoknqs,d.locations.hzoknqs2),b.albedo&&b.albedo.specular&&b.albedo.specular.texture&&e.albedo&&
e.albedo.specular&&e.albedo.specular.texture&&b.albedo.specular.texture.interpolateUvTransform(e.albedo.specular.texture,f,d.locations.chrxigj,d.locations.chrxigj2),b.albedo&&b.albedo.specular&&b.albedo.specular.intensityTexture&&e.albedo&&e.albedo.specular&&e.albedo.specular.intensityTexture&&b.albedo.specular.intensityTexture.interpolateUvTransform(e.albedo.specular.intensityTexture,f,d.locations.hakpqqs,d.locations.hakpqqs2),b.roughness&&b.roughness.texture&&e.roughness&&e.roughness.texture&&b.roughness.texture.interpolateUvTransform(e.roughness.texture,
f,d.locations.pblcfaf,d.locations.pblcfaf2),b.metalness&&b.metalness.texture&&e.metalness&&e.metalness.texture&&b.metalness.texture.interpolateUvTransform(e.metalness.texture,f,d.locations.vfyqlph,d.locations.vfyqlph2),b.normalDeformation&&b.normalDeformation.texture&&e.normalDeformation&&e.normalDeformation.texture&&b.normalDeformation.texture.interpolateUvTransform(e.normalDeformation.texture,f,d.locations.rjgjnzi,d.locations.rjgjnzi2),b.normalDeformation&&b.normalDeformation.intensityTexture&&
e.normalDeformation&&e.normalDeformation.intensityTexture&&b.normalDeformation.intensityTexture.interpolateUvTransform(e.normalDeformation.intensityTexture,f,d.locations.rasiqrh,d.locations.rasiqrh2),b.normalDeformation&&b.normalDeformation.texture2&&e.normalDeformation&&e.normalDeformation.texture2&&b.normalDeformation.texture2.interpolateUvTransform(e.normalDeformation.texture2,f,d.locations.shdknig,d.locations.shdknig2),b.normalDeformation&&b.normalDeformation.intensityTexture2&&e.normalDeformation&&
e.normalDeformation.intensityTexture2&&b.normalDeformation.intensityTexture2.interpolateUvTransform(e.normalDeformation.intensityTexture2,f,d.locations.qawohzh,d.locations.qawohzh2),b.emissive&&b.emissive.texture&&e.emissive&&e.emissive.texture&&b.emissive.texture.interpolateUvTransform(e.emissive.texture,f,d.locations.fbqzibe,d.locations.fbqzibe2),b.emissive&&b.emissive.intensityTexture&&e.emissive&&e.emissive.intensityTexture&&b.emissive.intensityTexture.interpolateUvTransform(e.emissive.intensityTexture,
f,d.locations.miqrofj,d.locations.miqrofj2),b.occlusion&&b.occlusion.ambientTexture&&e.occlusion&&e.occlusion.ambientTexture&&b.occlusion.ambientTexture.interpolateUvTransform(e.occlusion.ambientTexture,f,d.locations.tiaooli,d.locations.tiaooli2),b.occlusion&&b.occlusion.lightTexture&&e.occlusion&&e.occlusion.lightTexture&&b.occlusion.lightTexture.interpolateUvTransform(e.occlusion.lightTexture,f,d.locations.kotsuvy,d.locations.kotsuvy2),b.iridescence&&b.iridescence.texture&&e.iridescence&&e.iridescence.texture&&
b.iridescence.texture.interpolateUvTransform(e.iridescence.texture,f,d.locations.jtmrnbj,d.locations.jtmrnbj2),b.localEnvironment&&b.localEnvironment.texture&&e.localEnvironment&&e.localEnvironment.texture&&b.localEnvironment.texture.interpolateUvTransform(e.localEnvironment.texture,f,d.locations.uEnvironmentTextureUvsrc,d.locations.uEnvironmentTextureUvsrc2),b.metalness&&b.metalness.anisotropy&&b.metalness.anisotropy.texture&&e.metalness&&e.metalness.anisotropy&&e.metalness.anisotropy.texture&&b.metalness.anisotropy.texture.interpolateUvTransform(e.metalness.anisotropy.texture,
f,d.locations.dmyiwir,d.locations.dmyiwir2),b.metalness&&b.metalness.anisotropy&&b.metalness.anisotropy.intensityTexture&&e.metalness&&e.metalness.anisotropy&&e.metalness.anisotropy.intensityTexture&&b.metalness.anisotropy.intensityTexture.interpolateUvTransform(e.metalness.anisotropy.intensityTexture,f,d.locations.phepegv,d.locations.phepegv2),b.metalness&&b.metalness.anisotropy&&b.metalness.anisotropy.roughnessTexture&&e.metalness&&e.metalness.anisotropy&&e.metalness.anisotropy.roughnessTexture&&
b.metalness.anisotropy.roughnessTexture.interpolateUvTransform(e.metalness.anisotropy.roughnessTexture,f,d.locations.jbzfnah,d.locations.jbzfnah2),b.metalness&&b.metalness.anisotropy&&b.metalness.anisotropy.rotationTexture&&e.metalness&&e.metalness.anisotropy&&e.metalness.anisotropy.rotationTexture&&b.metalness.anisotropy.rotationTexture.interpolateUvTransform(e.metalness.anisotropy.rotationTexture,f,d.locations.dggoqiq,d.locations.dggoqiq2),b.coating&&b.coating.intensityTexture&&e.coating&&e.coating.intensityTexture&&
b.coating.intensityTexture.interpolateUvTransform(e.coating.intensityTexture,f,d.locations.nzqvvha,d.locations.nzqvvha2),b.coating&&b.coating.thicknessTexture&&e.coating&&e.coating.thicknessTexture&&b.coating.thicknessTexture.interpolateUvTransform(e.coating.thicknessTexture,f,d.locations.vaukewk,d.locations.vaukewk2),b.coating&&b.coating.roughnessTexture&&e.coating&&e.coating.roughnessTexture&&b.coating.roughnessTexture.interpolateUvTransform(e.coating.roughnessTexture,f,d.locations.lnqzuxw,d.locations.lnqzuxw2),
b.coating&&b.coating.normalTexture&&e.coating&&e.coating.normalTexture&&b.coating.normalTexture.interpolateUvTransform(e.coating.normalTexture,f,d.locations.umjpvqc,d.locations.umjpvqc2),b.roughness&&b.roughness.sheen&&b.roughness.sheen.texture&&e.roughness&&e.roughness.sheen&&e.roughness.sheen.texture&&b.roughness.sheen.texture.interpolateUvTransform(e.roughness.sheen.texture,f,d.locations.nxdiahe,d.locations.nxdiahe2),b.roughness&&b.roughness.sheen&&b.roughness.sheen.intensityTexture&&e.roughness&&
e.roughness.sheen&&e.roughness.sheen.intensityTexture&&b.roughness.sheen.intensityTexture.interpolateUvTransform(e.roughness.sheen.intensityTexture,f,d.locations.zjpbhvf,d.locations.zjpbhvf2),b.opacity&&b.opacity.texture&&e.opacity&&e.opacity.texture&&b.opacity.texture.interpolateUvTransform(e.opacity.texture,f,d.locations.imjkghn,d.locations.imjkghn2)):(b.reflection&&b.reflection.texture&&e.reflection&&e.reflection.texture&&b.reflection.texture.interpolateUvTransform(e.reflection.texture,f,d.locations.vdzqqlc,
d.locations.vdzqqlc2),b.refraction&&b.refraction.texture&&e.refraction&&e.refraction.texture&&b.refraction.texture.interpolateUvTransform(e.refraction.texture,f,d.locations.gqedqnf,d.locations.gqedqnf2),b.diffuse&&b.diffuse.texture&&e.diffuse&&e.diffuse.texture&&b.diffuse.texture.interpolateUvTransform(e.diffuse.texture,f,d.locations.bbjrkoj,d.locations.bbjrkoj2),b.ambient&&b.ambient.texture&&e.ambient&&e.ambient.texture&&b.ambient.texture.interpolateUvTransform(e.ambient.texture,f,d.locations.smlqamg,
d.locations.smlqamg2),b.specular&&b.specular.texture&&e.specular&&e.specular.texture&&b.specular.texture.interpolateUvTransform(e.specular.texture,f,d.locations.chrxigj,d.locations.chrxigj2),b.specular&&b.specular.intensityTexture&&e.specular&&e.specular.intensityTexture&&b.specular.intensityTexture.interpolateUvTransform(e.specular.intensityTexture,f,d.locations.hakpqqs,d.locations.hakpqqs2),b.specularAnisotropic&&b.specularAnisotropic.texture&&e.specularAnisotropic&&e.specularAnisotropic.texture&&
b.specularAnisotropic.texture.interpolateUvTransform(e.specularAnisotropic.texture,f,d.locations.cejprze,d.locations.cejprze2),b.emissive&&b.emissive.texture&&e.emissive&&e.emissive.texture&&b.emissive.texture.interpolateUvTransform(e.emissive.texture,f,d.locations.fbqzibe,d.locations.fbqzibe2),b.emissive&&b.emissive.intensityTexture&&e.emissive&&e.emissive.intensityTexture&&b.emissive.intensityTexture.interpolateUvTransform(e.emissive.intensityTexture,f,d.locations.miqrofj,d.locations.miqrofj2),
b.shininess&&b.shininess.texture&&e.shininess&&e.shininess.texture&&b.shininess.texture.interpolateUvTransform(e.shininess.texture,f,d.locations.hivqfir,d.locations.hivqfir2),b.normalDeformation&&b.normalDeformation.texture&&e.normalDeformation&&e.normalDeformation.texture&&b.normalDeformation.texture.interpolateUvTransform(e.normalDeformation.texture,f,d.locations.krklesm,d.locations.krklesm2),b.normalDeformation&&b.normalDeformation.scaleTexture&&e.normalDeformation&&e.normalDeformation.scaleTexture&&
b.normalDeformation.scaleTexture.interpolateUvTransform(e.normalDeformation.scaleTexture,f,d.locations.wygpxnc,d.locations.wygpxnc2),b.lightMap&&b.lightMap.texture&&e.lightMap&&e.lightMap.texture&&b.lightMap.texture.interpolateUvTransform(e.lightMap.texture,f,d.locations.ljrcsui,d.locations.ljrcsui2),b.lightMap&&b.lightMap.colorTexture&&e.lightMap&&e.lightMap.colorTexture&&b.lightMap.colorTexture.interpolateUvTransform(e.lightMap.colorTexture,f,d.locations.pwyttky,d.locations.pwyttky2),b.opacity&&
b.opacity.texture&&e.opacity&&e.opacity.texture&&b.opacity.texture.interpolateUvTransform(e.opacity.texture,f,d.locations.imjkghn,d.locations.imjkghn2),b.iridescent&&b.iridescent.texture&&e.iridescent&&e.iridescent.texture&&b.iridescent.texture.interpolateUvTransform(e.iridescent.texture,f,d.locations.djklitl,d.locations.djklitl2),b.iridescent&&b.iridescent.intensityTexture&&e.iridescent&&e.iridescent.intensityTexture&&b.iridescent.intensityTexture.interpolateUvTransform(e.iridescent.intensityTexture,
f,d.locations.djuzoiv,d.locations.djuzoiv2));b.translucency&&b.translucency.texture&&e.translucency&&e.translucency.texture&&b.translucency.texture.interpolateUvTransform(e.translucency.texture,f,d.locations.ugabykz,d.locations.ugabykz2)}};r.prototype.updateShaderType=function(){this.shaderType.reset(this.scene);var b=!1;if(this.currentMaterial.type)F.call(this),this.currentMaterial.coating&&(0<this.currentMaterial.coating.furRealSize||0<this.currentMaterial.coating.furMaxLength)&&(b=!0);else{var d=
0,e=0,f=stage.emersya.viewer.modules.renderer.shaders.shaderTypes,g=this.getCurrentMaterial();g.newShaderType&&this.shaderType.set(f.NEWSHADERTYPE);g.diffuse&&(e+=2,g.diffuse.texture&&g.diffuse.texture.isReady()&&(this.shaderType.set(f.DIFFUSE),++d,e+=1));g.ambient&&(e+=2,g.ambient.diffuseColor?this.shaderType.set(f.DIFFUSEAMBIENT):g.ambient.texture&&g.ambient.texture.isReady()&&(this.shaderType.set(f.AMBIENT),++d,e+=1));g.specular&&(e+=2,g.specular.texture&&g.specular.texture.isReady()&&(this.shaderType.set(f.SPECULAR),
++d,e+=1),g.specular.intensityTexture&&g.specular.intensityTexture.isReady()&&(this.shaderType.set(f.SPECULAR_INTENSITY),++d,e+=2),g.specular.glow&&this.shaderType.set(f.SPECULARGLOW));g.emissive&&(e+=2,g.emissive.texture&&g.emissive.texture.isReady()&&(this.shaderType.set(f.EMISSIVE),++d,e+=1),g.emissive.intensityTexture&&g.emissive.intensityTexture.isReady()&&(this.shaderType.set(f.EMISSIVE_INTENSITY),++d,e+=2));g.shininess&&(e+=1,g.shininess.texture&&g.shininess.texture.isReady()&&(this.shaderType.set(f.SHININESS),
++d,e+=2));g.normalDeformation&&(g.normalDeformation.texture&&g.normalDeformation.texture.isReady()&&(this.shaderType.set(f.NORMAL),++d,e+=2),g.normalDeformation.scaleTexture&&g.normalDeformation.scaleTexture.isReady()&&(this.shaderType.set(f.NORMAL_SCALE),++d,e+=2));g.lightMap&&(g.lightMap.texture&&g.lightMap.texture.isReady()&&(this.shaderType.set(f.LIGHT),++d,e+=3),g.lightMap.colorTexture&&g.lightMap.colorTexture.isReady()&&(this.shaderType.set(f.LIGHT_COLOR),++d,e+=1));g.reflection&&g.reflection.textureCube&&
g.reflection.textureCube.isReady()&&(this.shaderType.set(f.REFLECTION),++d,e+=2,g.reflection.texture&&g.reflection.texture.isReady()&&(this.shaderType.set(f.REFLECTIONMAP),++d,e+=2));g.refraction&&(this.shaderType.set(f.REFRACTION),e+=2,g.refraction.texture&&g.refraction.texture.isReady()&&(this.shaderType.set(f.REFRACTIONMAP),++d,e+=1),g.refraction.textureCube&&g.refraction.textureCube.isReady()?(this.shaderType.set(f.REFRACTION_CUBEMAP),++d,e+=1):this.scene.renderingSettings.screenSpaceRefract&&
g.opacity&&(this.shaderType.set(f.SCREENSPACE_REFRACTION),this.scene.renderingSettings.screenSpaceRoughness&&g.shininess&&.95>g.shininess.intensity/100&&this.shaderType.set(f.SCREENSPACE_ROUGHNESS),d+=2,e+=6));g.opacity&&(e+=1,g.opacity.texture&&g.opacity.texture.isReady()?(this.shaderType.set(f.OPACITY),++d,e+=1,g.opacity&&"none"!==g.opacity.blur&&(1!==g.opacity.intensity||g.opacity.texture)&&(this.shaderType.set(f.OPACITYBLUR),++d)):this.scene.renderingSettings.blurSupported&&g.opacity&&"none"!==
g.opacity.blur&&(1!==g.opacity.intensity||g.opacity.texture)&&(this.shaderType.set(f.OPACITYBLUR),++d));g.specularAnisotropic&&g.specularAnisotropic.texture&&g.specularAnisotropic.texture.isReady()&&(this.shaderType.set(f.SPECULAR_ANISOTROPIC),++d,e+=2);g.iridescent&&g.iridescent.texture&&g.iridescent.texture.isReady()&&(this.shaderType.set(f.IRIDESCENT),++d,e+=1,g.iridescent.intensityTexture&&g.iridescent.intensityTexture.isReady()&&(this.shaderType.set(f.IRIDESCENT_INTENSITY),++d,e+=1));g.translucency&&
(this.shaderType.set(f.TRANSLUCENCY),e+=1,g.translucency.texture&&g.translucency.texture.isReady()&&(this.shaderType.set(f.TRANSLUCENCYMAP),++d,e+=1));!stage.browser.mobilBrowser&&this.nextMaterial&&this.animations[this.currentAnimation].needsTransitionShader()&&(this.shaderType.set(f.ANIMATING),this.nextMaterial.newShaderType?this.shaderType.set(f.NEWSHADERTYPE):this.shaderType.set(f.NEWSHADERTYPE,!1),this.nextMaterial.diffuse&&(e+=2,this.nextMaterial.diffuse.texture&&this.nextMaterial.diffuse.texture.isReady()&&
(this.shaderType.set(f.ANIM_DIFFUSE),++d,e+=1)),this.nextMaterial.ambient&&(e+=2,this.nextMaterial.ambient.diffuseColor?this.shaderType.set(f.ANIM_DIFFUSEAMBIENT):this.nextMaterial.ambient.texture&&this.nextMaterial.ambient.texture.isReady()&&(this.shaderType.set(f.ANIM_AMBIENT),++d,e+=1)),this.nextMaterial.specular&&(e+=2,this.nextMaterial.specular.texture&&this.nextMaterial.specular.texture.isReady()&&(this.shaderType.set(f.ANIM_SPECULAR),++d,e+=1),this.nextMaterial.specular.intensityTexture&&this.nextMaterial.specular.intensityTexture.isReady()&&
(this.shaderType.set(f.ANIM_SPECULAR_INTENSITY),++d,e+=2)),this.nextMaterial.emissive&&(e+=2,this.nextMaterial.emissive.texture&&this.nextMaterial.emissive.texture.isReady()&&(this.shaderType.set(f.ANIM_EMISSIVE),++d,e+=1),this.nextMaterial.emissive.intensityTexture&&this.nextMaterial.emissive.intensityTexture.isReady()&&(this.shaderType.set(f.ANIM_EMISSIVE_INTENSITY),++d,e+=2)),this.nextMaterial.shininess&&(e+=1,this.nextMaterial.shininess.texture&&this.nextMaterial.shininess.texture.isReady()&&
(this.shaderType.set(f.ANIM_SHININESS),++d,e+=2)),this.nextMaterial.normalDeformation&&(this.nextMaterial.normalDeformation.texture&&this.nextMaterial.normalDeformation.texture.isReady()&&(this.shaderType.set(f.ANIM_NORMAL),++d,e+=2),this.nextMaterial.normalDeformation.scaleTexture&&this.nextMaterial.normalDeformation.scaleTexture.isReady()&&(this.shaderType.set(f.ANIM_NORMAL_SCALE),++d,e+=2)),this.nextMaterial.lightMap&&(this.nextMaterial.lightMap.texture&&this.nextMaterial.lightMap.texture.isReady()&&
(this.shaderType.set(f.ANIM_LIGHT),++d,e+=3),this.nextMaterial.lightMap.colorTexture&&this.nextMaterial.lightMap.colorTexture.isReady()&&(this.shaderType.set(f.ANIM_LIGHT_COLOR),++d,e+=1)),this.nextMaterial.reflection&&this.nextMaterial.reflection.textureCube&&this.nextMaterial.reflection.textureCube.isReady()&&(this.shaderType.set(f.ANIM_REFLECTION),++d,e+=2,this.nextMaterial.reflection.texture&&this.nextMaterial.reflection.texture.isReady()&&(this.shaderType.set(f.ANIM_REFLECTIONMAP),++d,e+=2)),
this.nextMaterial.refraction&&(this.shaderType.set(f.ANIM_REFRACTION),e+=2,this.nextMaterial.refraction.texture&&this.nextMaterial.refraction.texture.isReady()&&(this.shaderType.set(f.ANIM_REFRACTIONMAP),++d,e+=1),this.nextMaterial.refraction.textureCube&&this.nextMaterial.refraction.textureCube.isReady()&&(this.shaderType.set(f.ANIM_REFRACTION_CUBEMAP),++d,e+=1)),this.nextMaterial.opacity&&(e+=1,this.nextMaterial.opacity.texture&&this.nextMaterial.opacity.texture.isReady()&&(this.shaderType.set(f.ANIM_OPACITY),
++d,e+=1)),this.nextMaterial.specularAnisotropic&&this.nextMaterial.specularAnisotropic.texture&&this.nextMaterial.specularAnisotropic.texture.isReady()&&(this.shaderType.set(f.ANIM_SPECULAR_ANISOTROPIC),++d,e+=2),this.nextMaterial.iridescent&&this.nextMaterial.iridescent.texture&&this.nextMaterial.iridescent.texture.isReady()&&(this.shaderType.set(f.ANIM_IRIDESCENT),++d,e+=1,this.nextMaterial.iridescent.intensityTexture&&this.nextMaterial.iridescent.intensityTexture.isReady()&&(this.shaderType.set(f.ANIM_IRIDESCENT_INTENSITY),
++d,e+=1)),this.nextMaterial.translucency&&(this.shaderType.set(f.ANIM_TRANSLUCENCY),e+=1,this.nextMaterial.translucency.texture&&this.nextMaterial.translucency.texture.isReady()&&(this.shaderType.set(f.ANIM_TRANSLUCENCYMAP),++d,e+=1)));g=this.scene.renderingSettings.maxTextureUnits-this.scene.hasSomeShadow-(this.scene.mirrors.length?2:0)-d;if(0>g||e+this.scene.baseUniformsSize>this.scene.renderingSettings.maxUnifVectors)0>g?console.log("max text units",this.scene.renderingSettings.maxTextureUnits,
this.scene.hasSomeShadow,d,this.currentMaterial.name):console.log("not enough uniforms to perform the animation",e+this.scene.baseUniformsSize,this.scene.renderingSettings.maxUnifVectors),this.shaderType.set(f.ANIMATING,!1),this.shaderType.set(f.ANIM_DIFFUSE,!1),this.shaderType.set(f.ANIM_AMBIENT,!1),this.shaderType.set(f.ANIM_SPECULAR,!1),this.shaderType.set(f.ANIM_SPECULAR_INTENSITY,!1),this.shaderType.set(f.ANIM_EMISSIVE,!1),this.shaderType.set(f.ANIM_EMISSIVE_INTENSITY,!1),this.shaderType.set(f.ANIM_NORMAL,
!1),this.shaderType.set(f.ANIM_NORMAL_SCALE,!1),this.shaderType.set(f.ANIM_LIGHT,!1),this.shaderType.set(f.ANIM_LIGHT_COLOR,!1),this.shaderType.set(f.ANIM_REFLECTION,!1),this.shaderType.set(f.ANIM_REFRACTION,!1),this.shaderType.set(f.ANIM_OPACITY,!1),this.shaderType.set(f.ANIM_SPECULAR_ANISOTROPIC,!1),this.shaderType.set(f.ANIM_IRIDESCENT,!1),this.shaderType.set(f.ANIM_IRIDESCENT_INTENSITY,!1),this.shaderType.set(f.ANIM_TRANSLUCENCY,!1),this.shaderType.set(f.ANIM_TRANSLUCENCYMAP,!1),this.shaderType.set(f.ANIM_SHININESS,
!1),this.shaderType.set(f.ANIM_REFLECTIONMAP,!1),this.shaderType.set(f.ANIM_REFRACTIONMAP,!1),this.shaderType.set(f.ANIM_REFRACTION_CUBEMAP,!1)}this.polylistInstance.fadeOut&&this.shaderType.set(stage.emersya.viewer.modules.renderer.shaders.shaderTypes.FADEOUT);d={};e=this.scene.texturesManager.getTexturesFromMaterial(this.currentMaterial);this.nextMaterial&&this.nextMaterial.id&&(e=e.concat(this.scene.texturesManager.getTexturesFromMaterial(this.nextMaterial)));if(0<=this.scene.requiredUvsrc)b=d[this.scene.requiredUvsrc]=
!0;else{for(f=0;f<e.length;++f)e[f]||console.log(e,this.currentMaterial,this.polylistInstance),d[e[f].uvsrc]=!0;!e.length&&this.currentMaterial.opacity&&this.currentMaterial.opacity.blending==stage.emersya.viewer.BLENDING_MODE.DITHER&&(b=d[0]=!0)}e=this.polylistInstance;if((f=e.polylist.geometry)&&f.dataBuffers.length&&f.dataBuffers[0].uvs){g=[];for(var n in d)f.dataBuffers.length&&f.dataBuffers[0].uvs[n]?(d[n]=g.length,g.push(n)):d[n]=0,b=!0;b&&!g.length&&(g=[0]);e.uvIndexToId=g;e.uvIdToIndex=d}else e.uvIndexToId=
[],e.uvIdToIndex=[]};var F=function(){var b=stage.emersya.viewer.modules.renderer.shaders.shaderTypes,d=0,e=8,f=4,g=this.getCurrentMaterial();this.shaderType.set(b.PBR);g.albedo&&(g.albedo.texture&&g.albedo.texture.isReady()&&(this.shaderType.set(b.PBR_ALBEDO_MAP),++d,e+=8),g.albedo.specular&&(this.shaderType.set(b.PBR_SPECULAR),e+=2,g.albedo.specular.texture&&g.albedo.specular.texture.isReady()&&(this.shaderType.set(b.PBR_SPECULAR_MAP),++d,++f,e+=1),g.albedo.specular.intensityTexture&&g.albedo.specular.intensityTexture.isReady()&&
(this.shaderType.set(b.PBR_SPECULAR_INTENSITY),++d,++f,e+=2),g.albedo.specular.glow&&this.shaderType.set(b.SPECULARGLOW),g.albedo.specular.fresnelMode&&(++e,this.shaderType.set(b.PBR_SPECULAR_FRESNEL_MODE))));g.roughness&&(g.roughness.texture&&g.roughness.texture.isReady()&&(this.shaderType.set(b.PBR_ROUGHNESS_MAP),++d,e+=8),g.roughness.sheen&&(this.shaderType.set(b.PBR_SHEEN),e+=6,g.roughness.sheen.texture&&g.roughness.sheen.texture.isReady()&&(this.shaderType.set(b.PBR_SHEEN_MAP),++d,++f,e+=8),
g.roughness.sheen.intensityTexture&&g.roughness.sheen.intensityTexture.isReady()&&(this.shaderType.set(b.PBR_SHEEN_INTENSITY_MAP),++d,++f,e+=8),g.roughness.sheen.oldShader?this.shaderType.set(b.PBR_SHEEN_OLD_SHADER):g.roughness.sheen.customRoughness&&(e+=1,this.shaderType.set(b.PBR_SHEEN_CUSTOM_ROUGHNESS),g.roughness.sheen.roughnessTexture&&g.roughness.sheen.roughnessTexture.isReady()&&(this.shaderType.set(b.PBR_SHEEN_ROUGHNESS_MAP),++d,++f,e+=8))));if(g.metalness&&(g.metalness.texture&&g.metalness.texture.isReady()&&
(this.shaderType.set(b.PBR_METAL_MAP),++d,e+=8),g.metalness.anisotropy&&(this.shaderType.set(b.PBR_ANISOTROPY),e+=1,g.metalness.anisotropy.texture&&g.metalness.anisotropy.texture.isReady()&&(this.shaderType.set(b.PBR_ANISOTROPY_MAP),++d,++f,e+=8),g.metalness.anisotropy.intensityTexture&&g.metalness.anisotropy.intensityTexture.isReady()&&(this.shaderType.set(b.PBR_ANISOTROPY_INTENSITY_MAP),++d,++f,e+=8),g.metalness.anisotropy.roughnessTexture&&g.metalness.anisotropy.roughnessTexture.isReady()&&(this.shaderType.set(b.PBR_ANISOTROPY_ROUGHNESS_MAP),
++d,++f,e+=8),g.metalness.anisotropy.rotationTexture&&g.metalness.anisotropy.rotationTexture.isReady()&&(this.shaderType.set(b.PBR_ANISOTROPY_ROTATION_MAP),++d,++f,e+=8)),g.metalness.carpaint)){var n=g.metalness.carpaint;this.shaderType.set(b.PBR_CARPAINT);this.shaderType.set(b.PBR_CARPAINT_SPECULAR_LOBES_COUNT,n.specularLobeCount);this.shaderType.set(b.sdxjcre,4);d+=1;f+=1;0<n.flakesIntensity&&n.flakesColorTexture&&(this.shaderType.set(b.PBR_CARPAINT_FLAKES_MAP),d+=2,f+=2);n.isRGBEbrdfColorTexture&&
this.shaderType.set(b.PBR_CARPAINT_RGBE_BRDF_COLOR);n.isRGBEflakesColorTexture&&this.shaderType.set(b.PBR_CARPAINT_RGBE_FLAKES_COLOR);e+=3*n.specularLobeCount+2;e=e+5+3+17+896}g.normalDeformation&&(g.normalDeformation.texture&&g.normalDeformation.texture.isReady()&&(1==g.normalDeformation.type?this.shaderType.set(b.PBR_NORMAL_MAP):0==g.normalDeformation.type&&this.shaderType.set(b.PBR_BUMP_MAP),++d,++f,e+=9,g.normalDeformation.intensityTexture&&g.normalDeformation.intensityTexture.isReady()&&(this.shaderType.set(b.PBR_NORMAL_INTENSITY),
++d,++f,e+=9)),g.normalDeformation.texture2&&g.normalDeformation.texture2.isReady()&&(1==g.normalDeformation.type2?this.shaderType.set(b.PBR_NORMAL_MAP2):0==g.normalDeformation.type2&&this.shaderType.set(b.PBR_BUMP_MAP2),++d,++f,e+=9,g.normalDeformation.intensityTexture2&&g.normalDeformation.intensityTexture2.isReady()&&(this.shaderType.set(b.PBR_NORMAL_INTENSITY2),++d,++f,e+=9)));g.emissive&&0<g.emissive.intensity&&(this.shaderType.set(b.PBR_EMISSIVE),e+=4,g.emissive.texture&&g.emissive.texture.isReady()&&
(this.shaderType.set(b.PBR_EMISSIVE_MAP),++d,++f,e+=8),g.emissive.intensityTexture&&g.emissive.intensityTexture.isReady()&&(this.shaderType.set(b.PBR_EMISSIVE_INTENSITY_MAP),++d,++f,e+=8));g.occlusion&&(this.shaderType.set(b.PBR_AMBIENT_OCCLUSION),e++,g.occlusion.ambientTexture&&g.occlusion.ambientTexture.isReady()&&(this.shaderType.set(b.PBR_AMBIENT_OCCLUSION_MAP),++d,++f,e+=8),this.shaderType.set(b.PBR_LIGHT_OCCLUSION),e++,g.occlusion.lightTexture&&g.occlusion.lightTexture.isReady()&&(this.shaderType.set(b.PBR_LIGHT_OCCLUSION_MAP),
++d,++f,e+=8));g.opacity&&(e+=1,g.opacity.texture&&g.opacity.texture.isReady()&&(this.shaderType.set(b.PBR_OPACITY_MAP),e+=8,++d),this.scene.renderingSettings.blurSupported&&g.opacity&&"none"!==g.opacity.blur&&(1!==g.opacity.intensity||g.opacity.texture)&&(this.shaderType.set(b.OPACITYBLUR),++d,++f),g.opacity.refraction&&(this.shaderType.set(b.PBR_REFRACTION),g.opacity.refraction.textureCube&&g.opacity.refraction.textureCube.isReady()?(this.shaderType.set(b.PBR_REFRACTION_CUBEMAP),++d,++f):this.scene.renderingSettings.screenSpaceRefract&&
(this.shaderType.set(b.SCREENSPACE_REFRACTION),(this.scene.renderingSettings.screenSpaceRoughness&&g.roughness&&g.roughness.gloss&&.9>g.roughness.intensity||!g.roughness.gloss&&.1<g.roughness.intensity)&&this.shaderType.set(b.SCREENSPACE_ROUGHNESS),e+=6,d+=2,f+=2)));g.translucency&&(this.shaderType.set(b.TRANSLUCENCY),e+=1,g.translucency.texture&&g.translucency.texture.isReady()&&(this.shaderType.set(b.TRANSLUCENCYMAP),++d,++f,e+=1));if(g.iridescence){switch(g.iridescence.mode){case 0:this.shaderType.set(b.PBR_IRIDESCENCE_F0,
g.iridescence.colormap.cursors.length);break;case 1:this.shaderType.set(b.PBR_IRIDESCENCE_AL,g.iridescence.colormap.cursors.length);break;case 2:this.shaderType.set(b.PBR_IRIDESCENCE_F0,g.iridescence.colormap.cursors.length),this.shaderType.set(b.PBR_IRIDESCENCE_AL,g.iridescence.colormap.cursors.length)}e+=Math.ceil(1.25*g.iridescence.colormap.cursors.length)+1;g.iridescence.texture&&g.iridescence.texture.isReady()&&(this.shaderType.set(b.PBR_IRIDESCENCE_INTENSITY),e+=4)}g.coating&&0>=g.coating.furRealSize&&
!g.coating.furMaxLength?(this.shaderType.set(b.PBR_COATING),e+=6,g.coating.intensityTexture&&g.coating.intensityTexture.isReady()&&(this.shaderType.set(b.PBR_COATING_INTENSITY_MAP),++d,++f,e+=8),g.coating.thicknessTexture&&g.coating.thicknessTexture.isReady()&&(this.shaderType.set(b.PBR_COATING_THICKNESS_MAP),++d,++f,e+=8),g.coating.roughnessTexture&&g.coating.roughnessTexture.isReady()&&(this.shaderType.set(b.PBR_COATING_ROUGHNESS_MAP),++d,++f,e+=8),g.coating.normalTexture&&g.coating.normalTexture.isReady()&&
(this.shaderType.set(b.PBR_COATING_NORMAL_MAP),++d,++f,e+=9)):this.scene.renderingSettings.furSupported&&g.coating&&(0<g.coating.furRealSize||0<g.coating.furMaxLength)&&(this.shaderType.set(b.PBR_FUR),e+=8,++d,++f,g.coating.thicknessTexture&&g.coating.thicknessTexture.isReady()&&(this.shaderType.set(b.PBR_FUR_HAIRCUT_MAP),++d,++f,e+=8),0<this.currentMaterial.coating.furDispersion&&(this.shaderType.set(b.PBR_FUR_DISPERSION),e+=1),this.currentMaterial.coating.furClumpType&&(this.shaderType.set([b.PBR_FUR_CLUMP_CERCLE,
b.PBR_FUR_CLUMP_VORONOI,b.PBR_FUR_CLUMP_CELLULAR,b.PBR_FUR_CLUMP_PERLIN,b.PBR_FUR_CLUMP_TURBULENCE,b.PBR_FUR_CLUMP_RIDGE,b.PBR_FUR_CLUMP_TEXTURE][this.currentMaterial.coating.furClumpType-1]),e+=1),this.currentMaterial.coating.roughnessTexture&&this.currentMaterial.coating.roughnessTexture.isReady()&&(this.shaderType.set(b.PBR_FUR_ROOT_MAP),++d,++f,e+=6),this.shaderType.has(b.OPACITYBLUR)&&(this.shaderType.set(b.OPACITYBLUR,!1),--d,--f));this.baseTextureCount=d;this.baseMergedTextureCount=f;n=!1;
n=null!=g.roughness.sheen&&null!=this.nextMaterial&&null!=this.nextMaterial.roughness.sheen&&g.roughness.sheen.oldShader!=this.nextMaterial.roughness.sheen.oldShader;var k=!1;k=null!=g.metalness.carpaint&&null!=this.nexMaterial&&null==this.nextMaterial.metalness.carpaint||null==g.metalness.carpaint&&null!=this.nextMaterial&&null!=this.nextMaterial.metalness.carpaint;stage.browser.mobilBrowser||!this.nextMaterial||!this.animations[this.currentAnimation].needsTransitionShader()||n||k||(this.shaderType.set(b.ANIMATING),
f+=4,this.nextMaterial.albedo&&this.nextMaterial.albedo&&(this.nextMaterial.albedo.texture&&this.nextMaterial.albedo.texture&&(this.shaderType.set(b.PBR_ANIM_ALBEDO_MAP),++d,e+=8),e+=1,this.nextMaterial.albedo.specular&&(e+=2,this.nextMaterial.albedo.specular.texture&&this.nextMaterial.albedo.specular.texture.isReady()&&(this.shaderType.set(b.PBR_ANIM_SPECULAR_MAP),++d,++f,e+=1),this.nextMaterial.albedo.specular.intensityTexture&&this.nextMaterial.albedo.specular.intensityTexture.isReady()&&(this.shaderType.set(b.PBR_ANIM_SPECULAR_INTENSITY),
++d,++f,e+=2))),this.nextMaterial.roughness&&(e+=1,this.nextMaterial.roughness.texture&&this.nextMaterial.roughness.texture&&(this.shaderType.set(b.PBR_ANIM_ROUGHNESS_MAP),++d,e+=8),this.nextMaterial.metalness.texture&&(this.shaderType.set(b.PBR_ANIM_METAL_MAP),++d,++f,e+=8),this.nextMaterial.roughness.sheen&&(this.shaderType.set(b.PBR_ANIM_SHEEN),e+=6,this.nextMaterial.roughness.sheen.texture&&this.nextMaterial.roughness.sheen.texture.isReady()&&(this.shaderType.set(b.PBR_ANIM_SHEEN_MAP),++d,++f,
e+=8),this.nextMaterial.roughness.sheen.intensityTexture&&this.nextMaterial.roughness.sheen.intensityTexture.isReady()&&(this.shaderType.set(b.PBR_ANIM_SHEEN_INTENSITY_MAP),++d,++f,e+=8),!this.nextMaterial.roughness.sheen.oldShader&&this.nextMaterial.roughness.sheen.customRoughness&&(e+=1,this.shaderType.set(b.PBR_ANIM_SHEEN_CUSTOM_ROUGHNESS),this.nextMaterial.roughness.sheen.roughnessTexture&&this.nextMaterial.roughness.sheen.roughnessTexture.isReady()&&(this.shaderType.set(b.PBR_ANIM_SHEEN_ROUGHNESS_MAP),
++d,++f,e+=8)))),this.nextMaterial.metalness&&(e+=1,this.nextMaterial.metalness.texture&&(this.shaderType.set(b.PBR_ANIM_METAL_MAP),++d,e+=8),this.nextMaterial.metalness.anisotropy&&(this.shaderType.set(b.PBR_ANIM_ANISOTROPY),e+=1,this.nextMaterial.metalness.anisotropy.texture&&this.nextMaterial.metalness.anisotropy.texture.isReady()&&(this.shaderType.set(b.PBR_ANIM_ANISOTROPY_MAP),++d,++f,e+=8),this.nextMaterial.metalness.anisotropy.intensityTexture&&this.nextMaterial.metalness.anisotropy.intensityTexture.isReady()&&
(this.shaderType.set(b.PBR_ANIM_ANISOTROPY_INTENSITY_MAP),++d,++f,e+=8),this.nextMaterial.metalness.anisotropy.roughnessTexture&&this.nextMaterial.metalness.anisotropy.roughnessTexture.isReady()&&(this.shaderType.set(b.PBR_ANIM_ANISOTROPY_ROUGHNESS_MAP),++d,++f,e+=8),this.nextMaterial.metalness.anisotropy.rotationTexture&&this.nextMaterial.metalness.anisotropy.rotationTexture.isReady()&&(this.shaderType.set(b.PBR_ANIM_ANISOTROPY_ROTATION_MAP),++d,++f,e+=8))),this.nextMaterial.opacity&&(e+=1,this.nextMaterial.opacity.texture&&
(this.shaderType.set(b.PBR_ANIM_OPACITY_MAP),++d,e+=8),this.nextMaterial.opacity.refraction&&(this.shaderType.set(b.PBR_ANIM_REFRACTION),this.nextMaterial.opacity.refraction.textureCube&&this.nextMaterial.opacity.refraction.textureCube.isReady()&&(this.shaderType.set(b.PBR_ANIM_REFRACTION_CUBEMAP),++d,++f))),this.nextMaterial.normalDeformation&&(this.nextMaterial.normalDeformation.texture&&this.nextMaterial.normalDeformation.texture.isReady()&&(1==this.nextMaterial.normalDeformation.type?this.shaderType.set(b.PBR_ANIM_NORMAL_MAP):
0==this.nextMaterial.normalDeformation.type&&this.shaderType.set(b.PBR_ANIM_BUMP_MAP),++d,++f,e+=8,this.nextMaterial.normalDeformation.intensityTexture&&this.nextMaterial.normalDeformation.intensityTexture.isReady()&&(this.shaderType.set(b.PBR_ANIM_NORMAL_INTENSITY),++d,++f,e+=9)),this.nextMaterial.normalDeformation.texture2&&this.nextMaterial.normalDeformation.texture2.isReady()&&(1==this.nextMaterial.normalDeformation.type2?this.shaderType.set(b.PBR_ANIM_NORMAL_MAP2):0==this.nextMaterial.normalDeformation.type2&&
this.shaderType.set(b.PBR_ANIM_BUMP_MAP2),++d,++f,e+=8,this.nextMaterial.normalDeformation.intensityTexture2&&this.nextMaterial.normalDeformation.intensityTexture2.isReady()&&(this.shaderType.set(b.PBR_ANIM_NORMAL_INTENSITY2),++d,++f,e+=9))),this.nextMaterial.occlusion&&(this.shaderType.set(b.PBR_ANIM_AMBIENT_OCCLUSION),e+=1,this.nextMaterial.occlusion.ambientTexture&&this.nextMaterial.occlusion.ambientTexture.isReady()&&(this.shaderType.set(b.PBR_ANIM_AMBIENT_OCCLUSION_MAP),++d,++f,e+=8),this.shaderType.set(b.PBR_ANIM_LIGHT_OCCLUSION),
e+=1,this.nextMaterial.occlusion.lightTexture&&this.nextMaterial.occlusion.lightTexture.isReady()&&(this.shaderType.set(b.PBR_ANIM_LIGHT_OCCLUSION_MAP),++d,++f,e+=8)),this.nextMaterial.emissive&&(this.shaderType.set(b.PBR_ANIM_EMISSIVE),e+=1,this.nextMaterial.emissive.texture&&this.nextMaterial.emissive.texture.isReady()&&(this.shaderType.set(b.PBR_ANIM_EMISSIVE_MAP),++d,++f,e+=8),this.nextMaterial.emissive.intensityTexture&&this.nextMaterial.emissive.intensityTexture.isReady()&&(this.shaderType.set(b.PBR_ANIM_EMISSIVE_INTENSITY_MAP),
++d,++f,e+=8)),this.nextMaterial.coating&&!this.nextMaterial.coating.furMaxLength&&(this.shaderType.set(b.PBR_ANIM_COATING),e+=8,this.nextMaterial.coating.intensityTexture&&this.nextMaterial.coating.intensityTexture.isReady()&&(this.shaderType.set(b.PBR_ANIM_COATING_INTENSITY_MAP),++d,++f,e+=8),this.nextMaterial.coating.thicknessTexture&&this.nextMaterial.coating.thicknessTexture.isReady()&&(this.shaderType.set(b.PBR_ANIM_COATING_THICKNESS_MAP),++d,++f,e+=8),this.nextMaterial.coating.roughnessTexture&&
this.nextMaterial.coating.roughnessTexture.isReady()&&(this.shaderType.set(b.PBR_ANIM_COATING_ROUGHNESS_MAP),++d,++f,e+=8),this.nextMaterial.coating.normalTexture&&this.nextMaterial.coating.normalTexture.isReady()&&(this.shaderType.set(b.PBR_ANIM_COATING_NORMAL_MAP),++d,++f,e+=9)));this.textureCount=d;this.mergedTextureCount=f;d=this.scene.maxTextureUnits-this.scene.hasSomeShadow-(this.scene.mirrors.length?2:0);e=[{value:this.baseTextureCount+7,type:4},{value:this.baseMergedTextureCount+7,type:6},
{value:this.baseTextureCount+1,type:0},{value:this.baseMergedTextureCount+1,type:2}];this.shaderType.has(b.ANIMATING)&&(e=e.concat([{value:this.textureCount+7,type:5},{value:this.mergedTextureCount+7,type:7},{value:this.textureCount+1,type:1},{value:this.mergedTextureCount+1,type:3}]));for(f=0;f<e.length;++f)e[f].value>d&&(e[f].value=-1,e[f].type=-1);e=e.sort(function(b,d){return b.type<d.type?1:b.type>d.type?-1:b.value<d.value?1:b.value>d.value?-1:0});e[0].type&4&&this.shaderType.set(b.PBR_ENV_CUBES);
e[0].type&2&&(this.shaderType.set(b.PBR_ALBEDO_MAP),this.shaderType.set(b.PBR_ROUGHNESS_MAP),this.shaderType.set(b.PBR_METAL_MAP),this.shaderType.set(b.PBR_OPACITY_MAP));e[0].type&1?e[0].type&2&&(this.shaderType.set(b.PBR_ANIM_ALBEDO_MAP),this.shaderType.set(b.PBR_ANIM_ROUGHNESS_MAP),this.shaderType.set(b.PBR_ANIM_METAL_MAP),this.shaderType.set(b.PBR_ANIM_OPACITY_MAP)):(this.shaderType.set(b.ANIMATING,!1),this.shaderType.set(b.PBR_ANIM_SPECULAR_MAP,!1),this.shaderType.set(b.PBR_ANIM_SPECULAR_INTENSITY,
!1),this.shaderType.set(b.PBR_ANIM_NORMAL_MAP,!1),this.shaderType.set(b.PBR_ANIM_BUMP_MAP,!1),this.shaderType.set(b.PBR_ANIM_NORMAL_INTENSITY,!1),this.shaderType.set(b.PBR_ANIM_NORMAL_MAP2,!1),this.shaderType.set(b.PBR_ANIM_BUMP_MAP2,!1),this.shaderType.set(b.PBR_ANIM_NORMAL_INTENSITY2,!1),this.shaderType.set(b.PBR_ANIM_EMISSIVE,!1),this.shaderType.set(b.PBR_ANIM_EMISSIVE_MAP,!1),this.shaderType.set(b.PBR_ANIM_EMISSIVE_INTENSITY_MAP,!1),this.shaderType.set(b.PBR_ANIM_AMBIENT_OCCLUSION,!1),this.shaderType.set(b.PBR_ANIM_AMBIENT_OCCLUSION_MAP,
!1),this.shaderType.set(b.PBR_ANIM_LIGHT_OCCLUSION,!1),this.shaderType.set(b.PBR_ANIM_LIGHT_OCCLUSION_MAP,!1),this.shaderType.set(b.PBR_ANIM_IRIDESCENCE_INTENSITY,!1),this.shaderType.set(b.PBR_ANIM_ANISOTROPY,!1),this.shaderType.set(b.PBR_ANIM_ANISOTROPY_MAP,!1),this.shaderType.set(b.PBR_ANIM_ANISOTROPY_INTENSITY_MAP,!1),this.shaderType.set(b.PBR_ANIM_ANISOTROPY_ROUGHNESS_MAP,!1),this.shaderType.set(b.PBR_ANIM_ANISOTROPY_ROTATION_MAP,!1),this.shaderType.set(b.PBR_ANIM_REFRACTION,!1),this.shaderType.set(b.PBR_ANIM_REFRACTION_CUBEMAP,
!1),this.shaderType.set(b.PBR_ANIM_COATING,!1),this.shaderType.set(b.PBR_ANIM_COATING_INTENSITY_MAP,!1),this.shaderType.set(b.PBR_ANIM_COATING_THICKNESS_MAP,!1),this.shaderType.set(b.PBR_ANIM_COATING_ROUGHNESS_MAP,!1),this.shaderType.set(b.PBR_ANIM_COATING_NORMAL_MAP,!1),this.shaderType.set(b.PBR_ANIM_SHEEN,!1),this.shaderType.set(b.PBR_ANIM_SHEEN_MAP,!1),this.shaderType.set(b.PBR_ANIM_SHEEN_INTENSITY_MAP,!1),this.shaderType.set(b.PBR_ANIM_SHEEN_CUSTOM_ROUGHNESS,!1),this.shaderType.set(b.PBR_ANIM_SHEEN_ROUGHNESS_MAP,
!1),this.shaderType.set(b.PBR_ANIM_IRIDESCENCE_F0,0),this.shaderType.set(b.PBR_ANIM_IRIDESCENCE_AL,0))};r.prototype.loadRefractionCubeMap=function(b,d,e,f){var h=stage.emersya.viewer.modules.renderer.shaders.shaderTypes;b=b.boundingBox;var g=Math.max(Math.abs(b.maxX-b.minX),Math.max(Math.abs(b.maxY-b.minY),Math.abs(b.maxZ-b.minZ))),n=this.getCurrentMaterial();(n=f.has(h.REFRACTION)?n.refraction:n.opacity.refraction)&&n.textureCube&&(f.has(h.REFRACTION)||f.has(h.PBR_REFRACTION))&&(d.uniform3f(e.locations.qskkyrm,
b.center[0],b.center[1],b.center[2]),d.uniform1f(e.locations.vptxeeo,g*n.textureCube.cubeSize));stage.browser.mobilBrowser||null===this.nextMaterial||(n=this.nextMaterial,(n=f.has(h.ANIM_REFRACTION)?n.refraction:n.opacity.refraction)&&n.textureCube&&(f.has(h.ANIM_REFRACTION)||f.has(h.PBR_ANIM_REFRACTION))&&(d.uniform3f(e.locations.qskkyrm2,b.center[0],b.center[1],b.center[2]),d.uniform1f(e.locations.vptxeeo2,g*n.textureCube.cubeSize)))};r.prototype.loadToShader=function(b,d,e,f){if(this.currentMaterial.type){var h=
this.loadPbrMaterial(b,d,e,f);h=this.loadPbrMaterialAnim(b,d,e,f,h);0<=h&&b.uniform1ui(d.locations.oxryimw,h)}else this.loadClassicMaterial(b,d,e,f),this.loadClassicMaterialAnim(b,d,e,f);e.has(stage.emersya.viewer.modules.renderer.shaders.shaderTypes.FADEOUT)&&(b.uniform1f(d.locations.ufoyjfa,this.polylistInstance.fadeOut.axis+1),b.uniform1f(d.locations.xkuelka,this.polylistInstance.fadeOut.start),b.uniform1f(d.locations.dtvyjnu,this.polylistInstance.fadeOut.end))};return{animManager:q,matAnimManager:r,
accelerationFunction:b}});stage.provide("emersya.viewer.modules.renderer.lightsManager");
stage.register.call(stage.emersya.viewer.modules.renderer,"lightsManager",function(){var b,d,u=function(f,g,k,l){this.maxShadowFilterPasses=k;this.types=["dir","spot"];this.currentShadowCount=0;b=f;d=g;d.pbrEnvironmentTextureSettings=b.floatTextures?{minFilter:"LINEAR",wrapS:"REPEAT",magFilter:"LINEAR",wrapT:"CLAMP_TO_EDGE",useMipmap:l,anisotropy:0}:{wrapS:"REPEAT",wrapT:"CLAMP_TO_EDGE",minFilter:"NEAREST",magFilter:"NEAREST",useMipmap:!1,anisotropy:0};this.maxTextureSize=b.getParameter(b.MAX_TEXTURE_SIZE)};
u.prototype.deallocateScene=function(b){b&&g(b)};u.prototype.deallocate=function(){d=b=null};u.prototype.setMipmappedEnvironmentAvailable=function(f){b.floatTextures&&(d.pbrEnvironmentTextureSettings.useMipmap=f)};var k=function(d,g,k){++k.count;k.shadows.push(d.shadow);k.shadowBias.push(d.shadow.bias);k.shadowDarkness.push(d.shadow.intensity);k.shadowLightRelativeToCamera.push(d.relativeToCamera);k.shadowLightPosition.push(d.position[0]);k.shadowLightPosition.push(d.position[1]);k.shadowLightPosition.push(d.position[2]);
k.shadowLightUPosition.push(d.position[0]);k.shadowLightUPosition.push(d.position[1]);k.shadowLightUPosition.push(d.position[2]);k.shadowLightDirection.push(d.direction[0]);k.shadowLightDirection.push(d.direction[1]);k.shadowLightDirection.push(d.direction[2]);k.shadowLightUDirection.push(d.direction[0]);k.shadowLightUDirection.push(d.direction[1]);k.shadowLightUDirection.push(d.direction[2]);stage.browser.mobilBrowser&&1024<this.maxTextureSize?(k.shadowMapsWidth.push(1024<d.shadow.width?1024:d.shadow.width),
k.shadowMapsHeight.push(1024<d.shadow.height?1024:d.shadow.height)):(k.shadowMapsWidth.push(d.shadow.width>this.maxTextureSize?this.maxTextureSize:d.shadow.width),k.shadowMapsHeight.push(d.shadow.height>this.maxTextureSize?this.maxTextureSize:d.shadow.height));var f=q(d.position,d.direction);if("dir"==g){g=mat4.ortho(d.shadow.left,d.shadow.right,d.shadow.bottom,d.shadow.top,d.shadow.near,d.shadow.far);var n=t(d.position,d.direction,d.shadow)}else d.shadow.fov=180*d.outerAngle/3.141592653589793,g=
d.shadow.near*Math.tan(d.outerAngle/2),n=-g,g=mat4.frustum(n*k.shadowMapsWidth[k.shadowMapsWidth.length-1]/k.shadowMapsHeight[k.shadowMapsHeight.length-1],g*k.shadowMapsWidth[k.shadowMapsWidth.length-1]/k.shadowMapsHeight[k.shadowMapsHeight.length-1],n,g,d.shadow.near,d.shadow.far),n=r(d.position,d.direction,d.shadow);k.shadowDistanceDivisor.push(d.shadow.far-d.shadow.near);k.shadowRenderMatrix.push(n);k.shadowProjMatrices.push(g);k.shadowViewMatrices.push(f);n=mat4.create();mat4.multiply(g,f,n);
k.shadowMatrices.push(n);k.shadowFilterPasses.push(0);k.frameBuffers.push(b.createFramebuffer());k.renderBuffers.push(b.createRenderbuffer());d.shadow.intensity?k.locations.push(this.currentShadowCount++):k.locations.push(0);k.shadowMaps.push(b.createTexture());d=k.frameBuffers.length-1;b.bindTexture(b.TEXTURE_2D,k.shadowMaps[d]);"iPhone"!==navigator.platform?(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.LINEAR),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.LINEAR)):(b.texParameteri(b.TEXTURE_2D,
b.TEXTURE_MAG_FILTER,b.NEAREST),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.NEAREST));b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE);b.floatTextures?b.texImage2D(b.TEXTURE_2D,0,b.RGBA32F,k.shadowMapsWidth[d],k.shadowMapsHeight[d],0,b.RGBA,b.FLOAT,null):b.texImage2D(b.TEXTURE_2D,0,b.RGBA,k.shadowMapsWidth[d],k.shadowMapsHeight[d],0,b.RGBA,b.UNSIGNED_BYTE,null);b.bindRenderbuffer(b.RENDERBUFFER,k.renderBuffers[d]);
b.renderbufferStorage(b.RENDERBUFFER,b.DEPTH_COMPONENT16,k.shadowMapsWidth[d],k.shadowMapsHeight[d]);b.bindFramebuffer(b.FRAMEBUFFER,k.frameBuffers[d]);b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,k.shadowMaps[d],0);b.framebufferRenderbuffer(b.FRAMEBUFFER,b.DEPTH_ATTACHMENT,b.RENDERBUFFER,k.renderBuffers[d]);b.bindTexture(b.TEXTURE_2D,null);b.bindRenderbuffer(b.RENDERBUFFER,null);b.bindFramebuffer(b.FRAMEBUFFER,null)},l=function(){return{count:0,shadows:[],frameBuffers:[],
renderBuffers:[],shadowMaps:[],shadowMapsWidth:[],shadowMapsHeight:[],shadowProjMatrices:[],shadowViewMatrices:[],shadowMatrices:[],shadowBias:[],shadowLightRelativeToCamera:[],shadowLightPosition:[],shadowLightUPosition:[],shadowLightDirection:[],shadowLightUDirection:[],shadowDarkness:[],shadowFilterPasses:[],shadowDistanceDivisor:[],shadowRenderMatrix:[],locations:[]}},g=function(d){if(d.lights.buffers){for(var f=d.lights.buffers.dirShadows,g=0;g<f.count;++g)b.deleteFramebuffer(f.frameBuffers[g]),
b.deleteRenderbuffer(f.renderBuffers[g]),b.deleteTexture(f.shadowMaps[g]);f=d.lights.buffers.spotShadows;for(g=0;g<f.count;++g)b.deleteFramebuffer(f.frameBuffers[g]),b.deleteRenderbuffer(f.renderBuffers[g]),b.deleteTexture(f.shadowMaps[g]);delete d.lights.buffers}d.lights.buffers={directionals:{count:0,selected:[],targetSelected:[],color:[],intensity:[],relativeToCamera:[],position:[],direction:[],uPosition:[],xxbzpal:[]},hemisphericals:{count:0,skyColor:[],groundColor:[],direction:[],xxbzpal:[],
intensity:[],relativeToCamera:[]},points:{count:0,selected:[],color:[],intensity:[],relativeToCamera:[],position:[],uPosition:[],distance:[],constantAttenuation:[],linearAttenuation:[],quadraticAttenuation:[]},spots:{count:0,selected:[],targetSelected:[],color:[],intensity:[],relativeToCamera:[],position:[],direction:[],uPosition:[],xxbzpal:[],distance:[],exponent:[],innerAngleCos:[],outerAngleCos:[],innerAngleReal:[],outerAngleReal:[],constantAttenuation:[],linearAttenuation:[],quadraticAttenuation:[]},
dirShadows:l(),spotShadows:l()}};u.prototype.updateSceneLights=function(b){g(b);b.lights.ambient||(b.lights.ambient={color:vec3.create([0,0,0]),intensity:0});this.currentShadowCount=0;var d;b.lights.hasSomeAutoAdjustShadow=0;for(var f in b.lights.directionals){if(b.lights.directionals[f].shadow&&b.lights.directionals[f].shadow.autoAdjust){1==++b.lights.hasSomeAutoAdjustShadow&&(d=b.getDisplayedBoundingBox());var l=b.adjustDirectionalShadow(b.lights.directionals[f].direction,b.lights.directionals[f].position,
d);b.lights.directionals[f].position=l.pos;delete l.pos;Object.assign(b.lights.directionals[f].shadow,l)}l=b.lights.directionals[f];var r=b.lights.buffers.directionals;++r.count;r.selected.push(!1);r.targetSelected.push(!1);r.color.push(l.color[0]);r.color.push(l.color[1]);r.color.push(l.color[2]);r.intensity.push(l.intensity);r.relativeToCamera.push(l.relativeToCamera);r.position.push(l.position[0]);r.position.push(l.position[1]);r.position.push(l.position[2]);r.direction.push(l.direction[0]);r.direction.push(l.direction[1]);
r.direction.push(l.direction[2]);r.uPosition.push(l.position[0]);r.uPosition.push(l.position[1]);r.uPosition.push(l.position[2]);r.xxbzpal.push(l.direction[0]);r.xxbzpal.push(l.direction[1]);r.xxbzpal.push(l.direction[2]);k.call(this,b.lights.directionals[f],"dir",b.lights.buffers.dirShadows)}for(f in b.lights.hemisphericals)d=b.lights.hemisphericals[f],l=b.lights.buffers.hemisphericals,++l.count,l.skyColor.push(d.skyColor[0]),l.skyColor.push(d.skyColor[1]),l.skyColor.push(d.skyColor[2]),l.groundColor.push(d.groundColor[0]),
l.groundColor.push(d.groundColor[1]),l.groundColor.push(d.groundColor[2]),l.direction.push(d.direction[0]),l.direction.push(d.direction[1]),l.direction.push(d.direction[2]),l.xxbzpal.push(d.direction[0]),l.xxbzpal.push(d.direction[1]),l.xxbzpal.push(d.direction[2]),l.intensity.push(d.intensity),l.relativeToCamera.push(d.relativeToCamera);for(f in b.lights.points)d=b.lights.points[f],l=b.lights.buffers.points,++l.count,l.selected.push(!1),l.color.push(d.color[0]),l.color.push(d.color[1]),l.color.push(d.color[2]),
l.intensity.push(d.intensity),l.relativeToCamera.push(d.relativeToCamera),l.position.push(d.position[0]),l.position.push(d.position[1]),l.position.push(d.position[2]),l.uPosition.push(d.position[0]),l.uPosition.push(d.position[1]),l.uPosition.push(d.position[2]),l.distance.push(d.distance),l.constantAttenuation.push(d.constantAttenuation),l.linearAttenuation.push(d.linearAttenuation),l.quadraticAttenuation.push(d.quadraticAttenuation);for(f in b.lights.spots)d=b.lights.spots[f],l=b.lights.buffers.spots,
++l.count,vec3.normalize(d.direction),l.selected.push(!1),l.targetSelected.push(!1),l.color.push(d.color[0]),l.color.push(d.color[1]),l.color.push(d.color[2]),l.intensity.push(d.intensity),l.relativeToCamera.push(d.relativeToCamera),l.position.push(d.position[0]),l.position.push(d.position[1]),l.position.push(d.position[2]),l.direction.push(d.direction[0]),l.direction.push(d.direction[1]),l.direction.push(d.direction[2]),l.uPosition.push(d.position[0]),l.uPosition.push(d.position[1]),l.uPosition.push(d.position[2]),
l.xxbzpal.push(d.direction[0]),l.xxbzpal.push(d.direction[1]),l.xxbzpal.push(d.direction[2]),l.distance.push(d.distance),l.exponent.push(d.exponent),l.innerAngleCos.push(Math.cos(d.innerAngle/2)),l.outerAngleCos.push(Math.cos(d.outerAngle/2)),l.innerAngleReal.push(d.innerAngle),l.outerAngleReal.push(d.outerAngle),l.constantAttenuation.push(d.constantAttenuation),l.linearAttenuation.push(d.linearAttenuation),l.quadraticAttenuation.push(d.quadraticAttenuation),k.call(this,b.lights.spots[f],"spot",b.lights.buffers.spotShadows);
b.hasSomeShadow=0;b.lights.hasSomeDirShadow=0;for(f=b.lights.hasSomeSpotShadow=0;f<b.lights.buffers.spotShadows.count;++f)b.lights.buffers.spotShadows.shadowDarkness[f]&&++b.hasSomeShadow,b.lights.buffers.spotShadows.shadowDarkness[f]&&++b.lights.hasSomeSpotShadow;for(f=0;f<b.lights.buffers.dirShadows.count;++f)b.lights.buffers.dirShadows.shadowDarkness[f]&&++b.hasSomeShadow,b.lights.buffers.dirShadows.shadowDarkness[f]&&++b.lights.hasSomeDirShadow;b.lights.multipliedAmbient=vec3.scale(b.lights.ambient.color,
b.lights.ambient.intensity,vec3.create())};var q=function(b,d){var f=vec3.create(),g=vec3.create(),n=vec3.create([0,1,0]);vec3.set(b,g);.1>vec3.length(vec3.cross(vec3.normalize(g),n))&&vec3.set([0,0,1],n);vec3.add(b,d,f);return mat4.lookAt(b,f,n)},t=function(b,d,g){var f=mat4.identity(mat4.create()),n=.5*Math.abs(g.right-g.left),k=.5*Math.abs(g.top-g.bottom),l=.5*Math.abs(g.far-g.near);b=vec3.create(b);var e=vec3.normalize(vec3.create(d));vec3.dot(vec3.create([0,0,1]),e);vec3.cross(vec3.create([0,
0,1]),e);var r=vec3.create(e);var q=vec3.create([0,0,1]);r[1]=0;if(vec3.length(r)){vec3.normalize(r);vec3.subtract(r,q);var p=1-Math.pow(vec3.length(r),2)/2;1<p?p=1:-1>p&&(p=-1);d=0<e[0]?Math.acos(p):-Math.acos(p)}else d=0<e[0]?0:Math.PI;vec3.add(q,r);r=vec3.create(e);vec3.normalize(r);vec3.subtract(r,q);p=1-Math.pow(vec3.length(r),2)/2;1<p?p=1:-1>p&&(p=-1);r=0<e[1]?Math.acos(p):-Math.acos(p);p=vec3.scale(e,(g.far-g.near)/2+g.near,vec3.create());vec3.add(b,p,p);e=vec3.create([1,0,0]);vec3.scale(e,
(g.right+g.left)/2);q=vec3.create([0,1,0]);vec3.scale(q,(g.top+g.bottom)/2);mat4.translate(f,p);mat4.rotateY(f,d);mat4.rotateX(f,-r);g=vec3.create([0,1,0]);.1>vec3.length(vec3.cross(vec3.normalize(b),g))&&(vec3.scale(e,-1),vec3.scale(q,-1));mat4.translate(f,e);mat4.translate(f,q);mat4.scale(f,[-n,-k,-l]);return f},r=function(b,d,g){var f=mat4.create();mat4.identity(f);var n=vec3.create(b);b=vec3.normalize(vec3.create(d));d=vec3.cross(vec3.create([0,0,1]),b);mat4.translate(f,n);var k=vec3.normalize(vec3.create(b)),
l=vec3.create([0,0,-1]);k[1]=0;if(vec3.length(k)){vec3.normalize(k);vec3.subtract(k,l);var e=1-Math.pow(vec3.length(k),2)/2;1<e?e=1:-1>e&&(e=-1);n=0<b[0]?Math.acos(e):-Math.acos(e)}else n=0<b[0]?0:Math.PI;vec3.add(l,k);k=vec3.create(b);vec3.normalize(k);vec3.subtract(k,l);e=1-Math.pow(vec3.length(k),2)/2;1<e?e=1:-1>e&&(e=-1);b=0<b[1]?Math.acos(e):-Math.acos(e);.001<vec3.length(d)&&(mat4.rotateY(f,-n),mat4.rotateX(f,Math.PI/2+b));d=Math.tan(Math.PI*g.fov/360);mat4.scale(f,[d,1,d]);g=g.far;mat4.scale(f,
[g,g,g]);return f};u.prototype.updateShadowRenderData=function(b,d,g,k){b=b.lights["dir"==g?"directionals":"spots"][d];if("dir"==g)n=mat4.ortho(b.shadow.left,b.shadow.right,b.shadow.bottom,b.shadow.top,b.shadow.near,b.shadow.far);else{b.shadow.fov=180*b.outerAngle/3.141592653589793;n=b.shadow.near*Math.tan(b.outerAngle/2);var f=-n;n=mat4.frustum(f*k[g+"Shadows"].shadowMapsWidth[d]/k[g+"Shadows"].shadowMapsHeight[d],n*k[g+"Shadows"].shadowMapsWidth[d]/k[g+"Shadows"].shadowMapsHeight[d],f,n,b.shadow.near,
b.shadow.far)}k[g+"Shadows"].shadowProjMatrices[d]=n;k[g+"Shadows"].shadowDistanceDivisor[d]=b.shadow.far-b.shadow.near;n=k[g+"Shadows"].shadowLightUPosition.slice(3*d,3*(d+1));f=k[g+"Shadows"].shadowLightUDirection.slice(3*d,3*(d+1));"dir"==g?(b=t(n,f,b.shadow),k[g+"Shadows"].shadowRenderMatrix[d]=b):"spot"==g&&(b=r(n,f,b.shadow),k[g+"Shadows"].shadowRenderMatrix[d]=b);k[g+"Shadows"].shadowViewMatrices[d]=q(n,f);k[g+"Shadows"].shadowFilterPasses[d]=0;var n=k[g+"Shadows"].shadowProjMatrices[d];b=
k[g+"Shadows"].shadowViewMatrices[d];f=mat4.create();mat4.multiply(n,b,f);k[g+"Shadows"].shadowMatrices[d]=f};u.prototype.updateShadows=function(f,g,k,l,r){var n=0,q=f.lights.buffers;if(!q)return!1;if(f.lights.hasSomeAutoAdjustShadow){var e=f.getDisplayedBoundingBox();if(!e)return!1}for(var t in this.types)for(var w=this.types[t],p=0;p<q[w+"Shadows"].count;++p)if(0!=q[w+"Shadows"].shadowDarkness[p]){if(!r)if(l){if(!q[w+"Shadows"].shadowLightRelativeToCamera[p])continue}else continue;var m=mat4.create();
mat4.identity(m);q[w+"Shadows"].shadowLightRelativeToCamera[p]&&mat4.multiply(m,k,m);var h=vec3.create(q[w+"Shadows"].shadowLightPosition.slice(3*p,3*(p+1)));mat4.multiplyVec3(m,h);var v=vec3.create([q[w+"Shadows"].shadowLightDirection[3*p],q[w+"Shadows"].shadowLightDirection[3*p+1],q[w+"Shadows"].shadowLightDirection[3*p+2]]);mat4.toRotationMat(m,m);mat4.multiplyVec3(m,v);"dir"==w&&f.lights.directionals[p].shadow.autoAdjust&&(m=f.adjustDirectionalShadow(v,h,e),h=m.pos,delete m.pos,f.lights.directionals[p].position=
f.lights.directionals[p].relativeToCamera?mat4.multiplyVec3(g,h,vec3.create()):h,Object.assign(f.lights.directionals[p].shadow,m));if(r||q[w+"Shadows"].shadowLightUPosition[3*p]!==h[0]||q[w+"Shadows"].shadowLightUPosition[3*p+1]!==h[1]||q[w+"Shadows"].shadowLightUPosition[3*p+2]!==h[2]||q[w+"Shadows"].shadowLightUDirection[3*p]!==v[0]||q[w+"Shadows"].shadowLightUDirection[3*p+1]!==v[1]||q[w+"Shadows"].shadowLightUDirection[3*p+2]!==v[2])q[w+"Shadows"].shadowLightUPosition[3*p]=h[0],q[w+"Shadows"].shadowLightUPosition[3*
p+1]=h[1],q[w+"Shadows"].shadowLightUPosition[3*p+2]=h[2],q[w+"Shadows"].shadowLightUDirection[3*p]=v[0],q[w+"Shadows"].shadowLightUDirection[3*p+1]=v[1],q[w+"Shadows"].shadowLightUDirection[3*p+2]=v[2],this.updateShadowRenderData(f,p,w,q),f.shadowMapRenderFunction&&(b.bindTexture(b.TEXTURE_2D,q[w+"Shadows"].shadowMaps[p]),b.bindFramebuffer(b.FRAMEBUFFER,q[w+"Shadows"].frameBuffers[p]),b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,q[w+"Shadows"].shadowMaps[p],0),b.disable(b.BLEND),
b.bindFramebuffer(b.FRAMEBUFFER,q[w+"Shadows"].frameBuffers[p]),b.viewport(0,0,q[w+"Shadows"].shadowMapsWidth[p],q[w+"Shadows"].shadowMapsHeight[p]),b.scissor(0,0,q[w+"Shadows"].shadowMapsWidth[p],q[w+"Shadows"].shadowMapsHeight[p]),b.uniformMatrix4fv(d.locations.ghgsnpw,!1,q[w+"Shadows"].shadowProjMatrices[p]),b.uniformMatrix4fv(d.locations.ampnorz,!1,q[w+"Shadows"].shadowViewMatrices[p]),h=[q[w+"Shadows"].shadowLightUPosition[3*p],q[w+"Shadows"].shadowLightUPosition[3*p+1],q[w+"Shadows"].shadowLightUPosition[3*
p+2]],b.uniform3fv(d.locations.xzwunne,h),b.uniform1f(d.locations.oruddbu,q[w+"Shadows"].shadowDistanceDivisor[p]),b.uniform1f(d.locations.hvcoccw,q[w+"Shadows"].shadowBias[p]),b.clearColor(1,1,1,1),b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT),f.shadowMapRenderFunction(),b.bindFramebuffer(b.FRAMEBUFFER,null),b.enable(b.BLEND),++n)}return 0!=n};u.prototype.loadToShader=function(f,g){g=f.lights.buffers;b.uniform4f(d.locations.mwstbcz,f.lights.multipliedAmbient[0],f.lights.multipliedAmbient[1],f.lights.multipliedAmbient[2],
f.lights.globalLightCorrection);d.textureCount=0;if(g.directionals.count&&f.lights.hasSomeDirShadow){for(var n=0;n<f.lights.directionals.length;++n){var k=f.lights.directionals[n];k.shadow&&k.shadow.autoAdjust&&(b.uniform3f(d.locations["ntjaipr"+n],k.position[0],k.position[1],k.position[2]),b.uniform1f(d.locations["pgnowwy"+n],k.shadow.far-k.shadow.near))}for(n=0;n<g.dirShadows.locations.length;++n)g.dirShadows.shadowDarkness[n]&&(b.uniformMatrix4fv(d.locations["bfigqga"+n],!1,g.dirShadows.shadowMatrices[n]),
b.uniform1i(d.locations["hhknvcm"+n],g.dirShadows.locations[n]),b.activeTexture(b["TEXTURE"+g.dirShadows.locations[n]]),b.bindTexture(b.TEXTURE_2D,g.dirShadows.shadowMaps[n]),++d.textureCount)}if(g.spots.count&&f.lights.hasSomeSpotShadow)for(n=0;n<g.spotShadows.locations.length;++n)g.spotShadows.shadowDarkness[n]&&(b.uniformMatrix4fv(d.locations["llsljbs"+n],!1,g.spotShadows.shadowMatrices[n]),b.uniform1i(d.locations["xqqpmlf"+n],g.spotShadows.locations[n]),b.activeTexture(b["TEXTURE"+g.spotShadows.locations[n]]),
b.bindTexture(b.TEXTURE_2D,g.spotShadows.shadowMaps[n]),++d.textureCount);f.materialsType&&(b.uniform1f(d.locations.tsvlbmp,f.lights.globalEnvironmentCorrection),f.scenery&&f.scenery.environmentTexture&&f.scenery.environmentTexture.isReady()?(b.uniform1f(d.locations.wogkfep,-2048/(2*Math.min(b.viewportWidth,b.viewportHeight))),b.uniform1f(d.locations.lzaycwd,f.scenery.environmentTexture.finalImage.currentWidth)):(b.uniform1f(d.locations.wogkfep,0),b.uniform1f(d.locations.lzaycwd,1024)));b.uniform4f(d.locations.kisinpb,
f.highlight.color[0],f.highlight.color[1],f.highlight.color[2],f.highlight.color[3]);b.uniform1i(d.locations.ejcsltc,f.highlight.blendingMode)};u.prototype.filterShadowMaps=function(b,d,g,k){var f="";if(void 0!==k)for(var n=0;n<k-1;++n)f+="2-";f+="2";b=b.lights.buffers;if(!b)return!1;for(var l in this.types){var e=this.types[l];for(n=0;n<b[e+"Shadows"].count;n++)0==b[e+"Shadows"].shadowDarkness[n]||!d&&!b[e+"Shadows"].shadowLightRelativeToCamera[n]||b[e+"Shadows"].shadowFilterPasses[n]>=this.maxShadowFilterPasses||
(void 0!==k?b[e+"Shadows"].shadowFilterPasses[n]+=k:++b[e+"Shadows"].shadowFilterPasses[n],b[e+"Shadows"].shadowMaps[n]=g.applyBlur(b[e+"Shadows"].shadowMaps[n],b[e+"Shadows"].shadowMapsWidth[n],b[e+"Shadows"].shadowMapsHeight[n],f,!0))}};u.prototype.renderShadowMaps=function(f){if(f.shadowMapRenderFunction&&f.updatedBoundingBox){b.disable(b.BLEND);var g=f.lights.buffers,k;for(k in this.types)for(var l=this.types[k],r=0;r<g[l+"Shadows"].count;++r)0!=g[l+"Shadows"].shadowDarkness[r]&&(b.bindFramebuffer(b.FRAMEBUFFER,
g[l+"Shadows"].frameBuffers[r]),b.viewport(0,0,g[l+"Shadows"].shadowMapsWidth[r],g[l+"Shadows"].shadowMapsHeight[r]),b.scissor(0,0,g[l+"Shadows"].shadowMapsWidth[r],g[l+"Shadows"].shadowMapsHeight[r]),b.uniformMatrix4fv(d.locations.ghgsnpw,!1,g[l+"Shadows"].shadowProjMatrices[r]),b.uniformMatrix4fv(d.locations.ampnorz,!1,g[l+"Shadows"].shadowViewMatrices[r]),b.uniform3fv(d.locations.xzwunne,[g[l+"Shadows"].shadowLightUPosition[3*r],g[l+"Shadows"].shadowLightUPosition[3*r+1],g[l+"Shadows"].shadowLightUPosition[3*
r+2]]),b.uniform1f(d.locations.oruddbu,g[l+"Shadows"].shadowDistanceDivisor[r]),b.uniform1f(d.locations.hvcoccw,g[l+"Shadows"].shadowBias[r]),b.clearColor(1,1,1,1),b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT),f.shadowMapRenderFunction(),b.bindFramebuffer(b.FRAMEBUFFER,null));b.bindFramebuffer(b.FRAMEBUFFER,null);b.enable(b.BLEND)}};return u});stage.provide("emersya.viewer.modules.renderer.texturesManager");stage.require("emersya.viewer");
stage.register.call(stage.emersya.viewer.modules.renderer,"texturesManager",function(){var b=null,d=null,u=function(b,d){return b.width<d.width?1:b.width>d.width?-1:b.height<d.height?1:b.height>d.height?-1:0},k=function(b,d){this.eventsManager=stage.createEventsManager(d);this.id=b.id;this.defaultImage=b.defaultImage;this.sourceImages=this.images=b.sourceImages;this.progressiveLoading=!0;for(d=0;d<this.images.length;++d)this.images[d].originalRealFilePath=this.images[d].realFilePath;this.name=b.name;
this.libSourceId=b.libSourceId;this.rgbe=b.rgbe;this.textureMode=b.textureMode?b.textureMode:"TEXTURE_2D";this.grid=null;b.grid&&(this.grid={x:b.grid.x,y:b.grid.y,patchCount:b.grid.patchCount});this.firstLoadedToGl=this.fullyLoadedToGl=this.fullyLoading=this.fullyLoaded=this.firstLoaded=this.firstLoading=this.isStartingImage=this.noGlLoad=!1;this.firstLoadedCallbacks=[];this.firstErrorCallbacks=[];this.fullyLoadedCallbacks=[];this.fullyErrorCallbacks=[];this.widthMM=b.widthMM;this.heightMM=b.heightMM;
this.textures=[];this.texturesCube=[];this.loadedTexturesCnt=0;this.materials=[];this.loadedTextures=[];this.glTexture=null;this.checkMipmap()};k.prototype.destroy=function(){this.destroyed||(this.deallocate(),this.eventsManager=this.sourceImages=this.images=this.defaultImage=this.fullyErrorCallbacks=this.fullyLoadedCallbacks=this.firstErrorCallbacks=this.firstLoadedCallbacks=this.glTexture=this.materials=this.texturesCube=this.textures=this.uvTransform=null);this.destroyed=!0};k.prototype.setAsStartingImage=
function(){this.isStartingImage=!0};k.prototype.isReady=function(){return!b&&this.isStartingImage||this.glTexture};k.prototype.resetAndCall=function(b){if(this[b]&&this[b].length){var d=this[b];this[b]=[];for(b=0;b<d.length;++b)d[b](this)}};k.prototype.deallocate=function(){this.fullyLoadedToGl=this.firstLoadedToGl=this.fullyLoading=this.fullyLoaded=this.firstLoading=this.firstLoaded=!1;this.firstLoadedCallbacks=[];this.firstErrorCallbacks=[];this.fullyLoadedCallbacks=[];this.fullyErrorCallbacks=
[];this.glTexture&&b.deleteTexture(this.glTexture);this.glTexture=null;this.clearTextureCurrentParameters();for(var d in this.images)this.images[d].loaded=!1,this.images[d].htmlImage&&(delete this.images[d].htmlImage.onerror,delete this.images[d].htmlImage.onload,this.images[d].htmlImage.src="",delete this.images[d].htmlImage)};k.prototype.clearTextureCurrentParameters=function(){delete this.currentWrapS;delete this.currentWrapT;delete this.currentMinFilter;delete this.currentMagFilter;delete this.currentAnisotropy};
k.prototype.update=function(b){var d=!0;b.sourceImages.sort(u);if(this.images.length===b.sourceImages.length){for(var e=0;e<this.images.length&&d;++e)if(this.images[e].width!==b.sourceImages[e].width||this.images[e].height!==b.sourceImages[e].height||this.images[e].originalRealFilePath!==b.sourceImages[e].realFilePath||this.images[e].fileSize!==b.sourceImages[e].fileSize)d=!1;this.defaultImage.id!==b.defaultImage.id&&(d=!1)}else d=!1;if(!d){if(!this.firstLoaded&&this.firstLoading||!this.fullyLoaded&&
this.fullyLoaded){for(d=0;d<this.images.length;++d)this.images[d].htmlImage.src="";for(e in this.firstErrorCallbacks)this.firstErrorCallbacks[e]();this.firstErrorCallbacks=[];for(e in this.fullyErrorCallbacks)this.fullyErrorCallbacks[e]();this.fullyErrorCallbacks=[]}this.fullyLoadedToGl=this.firstLoadedToGl=this.fullyLoading=this.fullyLoaded=this.firstLoading=this.firstLoaded=!1;this.clearTextureCurrentParameters();this.images=b.sourceImages;this.defaultImage=b.defaultImage;for(e=0;e<this.images.length;++e)this.images[e].originalRealFilePath=
this.images[e].realFilePath}this.widthMM=b.widthMM;this.heightMM=b.heightMM;this.textureMode=b.textureMode?b.textureMode:"TEXTURE_2D";b.grid&&(this.grid||(this.grid={}),this.grid.x=b.grid.x,this.grid.y=b.grid.y,this.grid.patchCount=this.grid.patchCount);this.checkMipmap()};k.prototype.updateFromLocalImage=function(b){this.deallocate();this.images=b.images;this.mipmapUsable=b.mipmapUsable;this.sortImages()};k.prototype.sortImages=function(){this.images.sort(u);this.maxWidth=this.images[0].width;this.maxHeight=
this.images[0].height};k.prototype.checkMipmap=function(){this.sortImages();this.mipmapUsable=!0;if(!b||!b.webgl2)for(var d in this.images){var f=Math.log(this.images[d].width)/Math.LN2,g=Math.log(this.images[d].height)/Math.LN2;if(f!==parseInt(f)||g!==parseInt(g))this.mipmapUsable=!1}this.mipmapUsable&&(this.manualMipmapping=this.images.length==Math.log(this.maxWidth)/Math.LN2+1)};k.prototype.updateSize=function(b,d,f){b>=this.images.length||0>b||(this.images[b].width=d,this.images[b].height=f,this.checkMipmap())};
k.prototype.addTexture=function(b){-1===this.textures.indexOf(b)&&this.textures.push(b)};k.prototype.removeTexture=function(b){-1!==this.textures.indexOf(b)&&this.textures.splice(this.textures.indexOf(b),1)};k.prototype.addTextureCube=function(b){-1===this.texturesCube.indexOf(b)&&this.texturesCube.push(b)};k.prototype.removeTextureCube=function(b){-1!==this.texturesCube.indexOf(b)&&this.texturesCube.splice(this.texturesCube.indexOf(b),1)};k.prototype.download=function(b,d,f){if(b)d&&this.firstLoadedCallbacks.push(d),
f&&this.firstErrorCallbacks.push(f),this.firstLoaded?(this.endProgress(),this.resetAndCall("firstLoadedCallbacks")):this.firstLoading||(this.firstLoading=!0,this.defaultImage.dlCount=1,this.defaultImage.htmlImage=new Image,this.defaultImage.htmlImage.crossOrigin="Anonymous",this.defaultImage.htmlImage.onload=stage.setContext(function(){this.destroyed||(this.firstLoaded=this.defaultImage.loaded=!0,this.firstLoading=!1,this.endProgress(),this.resetAndCall("firstLoadedCallbacks"))},this),this.defaultImage.htmlImage.onerror=
stage.setContext(function(){if(!this.destroyed)if(4<++this.defaultImage.dlCount)this.defaultImage.htmlImage&&delete this.defaultImage.htmlImage.onerror,this.firstLoading=!1,this.resetAndCall("firstErrorCallbacks"),this.onError();else if(this.defaultImage.htmlImage){var b=this.defaultImage.htmlImage.src;this.defaultImage.htmlImage.src="";this.defaultImage.htmlImage.src=b}},this),this.defaultImage.htmlImage.src=this.defaultImage.realFilePath);else if(d&&this.fullyLoadedCallbacks.push(d),f&&this.fullyErrorCallbacks.push(f),
this.fullyLoaded)this.endProgress(),this.resetAndCall("fullyLoadedCallbacks");else if(!this.fullyLoading){this.fullyLoading=!0;this.downloadError=!1;this.imagesToLoad=this.images.length;for(b=0;b<this.images.length;++b)d=this.images[b],d.htmlImage&&d.loaded?--this.imagesToLoad:(d.dlCount=1,d.htmlImage=new Image,d.htmlImage.crossOrigin="Anonymous",d.htmlImage.onload=stage.setContext(function(b){b.destroyed||(b.loaded=!0,--this.imagesToLoad||this.downloadError||(this.fullyLoaded=!0,this.fullyLoading=
!1,this.endProgress(),this.resetAndCall("fullyLoadedCallbacks")))},this,d),d.htmlImage.onerror=stage.setContext(function(b){if(!b.destroyed)if(4<++b.dlCount)b.htmlImage&&delete b.htmlImage.onerror,this.fullyLoading=!1,this.downloadError||(this.downloadError=!0,this.resetAndCall("fullyErrorCallbacks"),this.onError());else if(b.htmlImage){var d=b.htmlImage.src;b.htmlImage.src="";b.htmlImage.src=d}},this,d),d.htmlImage.src=d.realFilePath);this.imagesToLoad||(this.fullyLoaded=!0,this.endProgress(),this.resetAndCall("fullyLoadedCallbacks"))}};
k.prototype.getFirstImagePath=function(){return this.images.length?this.images[0].realFilePath:"Error no first image path, image id : "+this.id};k.prototype.getImagePaths=function(){if(!this.images.length)return"Error no first image path, image id : "+this.id;var b=[];if(this.progressiveLoading)b.push(this.defaultImage.realFilePath);else for(var d in this.images)b.push(this.images[d].realFilePath);return b};k.prototype.getImagesToLoad=function(){return this.progressiveLoading?[].push(this.defaultImage):
this.images};k.prototype.getFirstImageFileSize=function(){return this.images.length?this.images[0].fileSize:"Error no first image size, image id : "+this.id};k.prototype.getImageFileSizes=function(){if(!this.images.length)return"Error no first image size, image id : "+this.id;var b=0;if(this.progressiveLoading)b+=this.defaultImage.fileSize;else for(var d in this.images)b+=this.images[d].fileSize;return b};k.prototype.onError=function(){this.eventsManager.fireEvent("onError",this)};k.prototype.updateProgress=
function(b){this.eventsManager.fireEvent("onProgress",this.getFirstImagePath(),b)};k.prototype.endProgress=function(){this.eventsManager.fireEvent("onProgress",this.getFirstImagePath(),this.getFirstImageFileSize());this.fullyLoaded?(this.currentWidth=this.maxWidth,this.currentHeight=this.maxHeight):(this.currentWidth=this.defaultImage.width,this.currentHeight=this.defaultImage.height);this.checkLoading();this.eventsManager.fireEvent("onEndProgress",this)};k.prototype.loadToWebgl2RGBE=function(){if(this.fullyLoaded){if(!this.fullyLoadedToGl){var d=
b.createTexture();b.bindTexture(b.TEXTURE_2D,d);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.NEAREST);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.NEAREST);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE);var f;b.getError();b.bindTexture(b.TEXTURE_2D,d);b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,this.images[0].htmlImage);b.filters.toFloatRGBA(this.glTexture,0,d,this.images[0].width,this.images[0].height);
if(this.mipmapUsable)if(this.manualMipmapping)for(f=1;f<this.images.length;++f)b.bindTexture(b.TEXTURE_2D,d),b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,this.images[f].htmlImage),b.filters.toFloatRGBA(this.glTexture,f,d,this.images[f].width,this.images[f].height);else b.bindTexture(b.TEXTURE_2D,this.glTexture),b.generateMipmap(b.TEXTURE_2D);b.deleteTexture(d);this.fullyLoadedToGl=!0;this.clearTextureCurrentParameters()}}else if(!this.firstLoadedToGl){this.firstLoadedToGl=!0;d=b.createTexture();
b.bindTexture(b.TEXTURE_2D,d);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.NEAREST);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.NEAREST);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE);b.getError();b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,this.defaultImage.htmlImage);b.filters.toFloatRGBA(this.glTexture,0,d,this.defaultImage.width,this.defaultImage.height);f=b.getError();b.deleteTexture(d);
if(f!==b.NO_ERROR)return"local"===this.defaultImage.fileType&&b.pixelStorei(b.UNPACK_COLORSPACE_CONVERSION_WEBGL,!0),this.eventsManager.fireEvent("onWebGlError",f),!1;this.mipmapUsable&&(b.bindTexture(b.TEXTURE_2D,this.glTexture),b.generateMipmap(b.TEXTURE_2D));this.clearTextureCurrentParameters()}};k.prototype.loadToWebgl2Texture2DArray=function(){var d=b.TEXTURE_2D;b.webgl2&&(d=b[this.textureMode]);if(this.fullyLoaded)this.fullyLoadedToGl||console.error("Texture should load only one image nothing else",
this.id);else if(!this.firstLoadedToGl){this.fullyLoadedToGl=this.firstLoadedToGl=!0;if(b.webgl2)if(this.grid&&1<this.grid.x&&1<this.grid.y){var f=b,g=this.defaultImage,n=this.grid,m=f.createTexture();f.bindTexture(f.TEXTURE_2D,m);f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.NEAREST);f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.NEAREST);f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.CLAMP_TO_EDGE);f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.CLAMP_TO_EDGE);f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,
!1);f.texImage2D(f.TEXTURE_2D,0,f.RGBA,f.RGBA,f.UNSIGNED_BYTE,g.htmlImage);f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,!0);f.filters.toTexture2dArray(this.glTexture,0,m,g.width,g.height,n);f.deleteTexture(m)}else{f=b;g=this.defaultImage;n=this.grid;m=g.width;var h=g.height,k=1;n&&(m=g.width/n.x,h=g.height/n.y,k=Math.max(1,Math.min(n.patchCount,n.x*n.y)));f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,!1);f.texImage3D(f.TEXTURE_2D_ARRAY,0,f.RGBA,m,h,k,0,f.RGBA,f.UNSIGNED_BYTE,g.htmlImage);f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,
!0)}else b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL,!1),b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,this.defaultImage.htmlImage),b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL,!0);f=b.getError();if(f!==b.NO_ERROR)return console.log(this.id,this.defaultImage.htmlImage,this.defaultImage.htmlImage.naturalWidth,this.defaultImage.htmlImage.naturalHeight,f),"local"===this.defaultImage.fileType&&b.pixelStorei(b.UNPACK_COLORSPACE_CONVERSION_WEBGL,!0),this.eventsManager.fireEvent("onWebGlError",f),!1;this.mipmapUsable&&
b.generateMipmap(d);this.clearTextureCurrentParameters()}};k.prototype.loadToWebgl2Texture2D=function(){if(this.fullyLoaded){if(!this.fullyLoadedToGl){b.getError();b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,this.images[0].htmlImage);var d=b.getError();if(d!==b.NO_ERROR)return"local"===this.defaultImage.fileType&&b.pixelStorei(b.UNPACK_COLORSPACE_CONVERSION_WEBGL,!0),this.eventsManager.fireEvent("onWebGlError",d),!1;if(this.mipmapUsable)if(this.manualMipmapping)for(d=1;d<this.images.length;++d)b.texImage2D(b.TEXTURE_2D,
d,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,this.images[d].htmlImage);else b.generateMipmap(b.TEXTURE_2D);this.fullyLoadedToGl=!0;this.clearTextureCurrentParameters()}}else if(!this.firstLoadedToGl){this.firstLoadedToGl=!0;b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,this.defaultImage.htmlImage);d=b.getError();if(d!==b.NO_ERROR)return console.log(this.id,this.defaultImage.htmlImage,this.defaultImage.htmlImage.naturalWidth,this.defaultImage.htmlImage.naturalHeight),"local"===this.defaultImage.fileType&&
b.pixelStorei(b.UNPACK_COLORSPACE_CONVERSION_WEBGL,!0),this.eventsManager.fireEvent("onWebGlError",d),!1;this.mipmapUsable&&b.generateMipmap(b.TEXTURE_2D);this.clearTextureCurrentParameters()}};k.prototype.loadToWebgl2=function(){if(!b||this.noGlLoad||!this.firstLoaded&&!this.fullyLoaded)return!1;this.checkMipmap();"local"===this.defaultImage.fileType&&b.pixelStorei(b.UNPACK_COLORSPACE_CONVERSION_WEBGL,!1);var d=b.TEXTURE_2D;b.webgl2&&(d=b[this.textureMode]);if(!this.glTexture){b.getError();var f=
b.createTexture();b.bindTexture(d,f);b.texParameteri(d,b.TEXTURE_MIN_FILTER,b.LINEAR);b.texParameteri(d,b.TEXTURE_MAG_FILTER,b.LINEAR);b.texParameteri(d,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE);b.texParameteri(d,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE);this.glTexture=f}b.bindTexture(d,this.glTexture);this.rgbe&&b.floatTextures?this.loadToWebgl2RGBE():"TEXTURE_2D_ARRAY"==this.textureMode||"TEXTURE_3D"==this.textureMode?this.loadToWebgl2Texture2DArray():this.loadToWebgl2Texture2D();b.bindTexture(d,null);"local"===
this.defaultImage.fileType&&b.pixelStorei(b.UNPACK_COLORSPACE_CONVERSION_WEBGL,b.BROWSER_DEFAULT_WEBGL);return!0};k.prototype.unloadFromWebgl2=function(){b&&!this.noGlLoad&&this.glTexture&&(this.firstLoadedToGl=this.fullyLoadedToGl=!1,b.deleteTexture(this.glTexture),this.glTexture=null,this.clearTextureCurrentParameters())};k.prototype.load=function(){++this.loadedTexturesCnt;if(0<this.loadedTexturesCnt)return this.loadToWebgl2();console.warn("image rgba loaded textures cnt was < 0",this);return!1};
k.prototype.unload=function(){--this.loadedTexturesCnt;this.loadedTexturesCnt?0>this.loadedTexturesCnt&&console.warn("image rgba loaded textures cnt set < 0",this):this.unloadFromWebgl2()};k.prototype.checkLoading=function(){0<this.loadedTexturesCnt?this.loadToWebgl2():this.unloadFromWebgl2()};k.prototype.hasToBeDownloaded=function(){return 0<this.loadedTexturesCnt};k.prototype.bind=function(d,f,g,n,m,h){if(!this.glTexture)return-1;var e=b.TEXTURE_2D;b.webgl2&&(e=b[this.textureMode]);b.bindTexture(e,
this.glTexture);this.mipmapUsable||(d=f="CLAMP_TO_EDGE");d=d.replace("CROPPED","CLAMP_TO_EDGE");f=f.replace("CROPPED","CLAMP_TO_EDGE");if(this.currentWrapS!==d||this.currentWrapT!==f)b.texParameteri(e,b.TEXTURE_WRAP_S,b[d]),b.texParameteri(e,b.TEXTURE_WRAP_T,b[f]),this.currentWrapS=d,this.currentWrapT=f;b.anisotropicTexture&&0<h&&(h>b.maxAnisotropy&&(h=b.maxAnisotropy),h!==this.currentAnisotropy&&(b.texParameterf(e,b.anisotropicTexture.TEXTURE_MAX_ANISOTROPY_EXT,h),this.currentAnisotropy=h));m&&this.mipmapUsable&&
-1===g.indexOf("MIPMAP")&&(g=g+"_MIPMAP_"+g);this.currentMinFilter!==g&&(b.texParameteri(e,b.TEXTURE_MIN_FILTER,b[g]),this.currentMinFilter=g);this.currentMagFilter!==n&&(b.texParameteri(e,b.TEXTURE_MAG_FILTER,b[n]),this.currentMagFilter=n)};var l=function(b){mat4.identity(b.matrix);mat4.translate(b.matrix,[.5,.5,1]);mat4.scale(b.matrix,b.scaling);mat4.translate(b.matrix,[-.5,-.5,-1]);mat4.translate(b.matrix,b.translation);mat4.translate(b.matrix,b.rotationCenter);mat4.rotate(b.matrix,b.rotation,
[0,0,1]);mat4.translate(b.matrix,b.negatedRotationCenter);1===this.uvTransformOrder?(mat4.translate(b.matrix,b.pivot),mat4.rotate(b.matrix,b.baseRotation,[0,0,1]),mat4.translate(b.matrix,b.negatedPivot),mat4.translate(b.matrix,b.offset),mat4.scale(b.matrix,b.repeat)):(mat4.translate(b.matrix,b.offset),mat4.scale(b.matrix,b.repeat),mat4.translate(b.matrix,b.pivot),mat4.rotate(b.matrix,b.baseRotation,[0,0,1]),mat4.translate(b.matrix,b.negatedPivot));b.matrix[6]=parseFloat(this.applyCropX+0);b.matrix[7]=
parseFloat(this.applyCropY+0);b.matrix[8]=b.cropX1;b.matrix[9]=b.cropX2;b.matrix[10]=b.cropY1;b.matrix[11]=b.cropY2;b.matrix[14]=parseFloat(this.srgbMode+2*this.negativeTexture+0);b.matrix[15]=parseFloat(this.channel+0)},g=function(b,d){this.manager=d;this.originData=b;this.instances=[];this.id=b.id;this.name=b.name;this.wrapS=b.wrapS;this.wrapT=b.wrapT;this.minFilter=b.minFilter;this.magFilter=b.magFilter;this.anisotropy=b.anisotropy;this.repeatX=b.repeatX;this.repeatY=b.repeatY;this.offsetX=b.offsetX;
this.offsetY=b.offsetY;this.pivotX=b.pivotX;this.pivotY=b.pivotY;this.angle=b.angle;this.useMipmap=b.useMipmap;this.srgbMode=b.srgbMode;this.channel=b.channel;this.negativeTexture=b.negativeTexture;this.uvsrc=b.uvsrc;this.useRealMeasurements=b.useRealMeasurements;this.ignoreGlobalUVTransform=b.ignoreGlobalUVTransform;this.uvTransformOrder=b.uvTransformOrder;this.applyCropX="CROPPED"===b.wrapS;this.applyCropY="CROPPED"===b.wrapT;this.uvTransform={dirty:!0,matrix:mat4.create(),translation:vec3.create(),
rotation:0,rotationCenter:vec3.create([.5,.5,1]),negatedRotationCenter:vec3.create([-.5,-.5,-1]),offset:vec3.create([b.offsetX,b.offsetY,0]),repeat:vec3.create([b.repeatX,b.repeatY,1]),pivot:vec3.create([b.pivotX,b.pivotY,1]),negatedPivot:vec3.create([-b.pivotX,-b.pivotY,-1]),baseRotation:b.angle,scaling:vec3.create([1,1,1]),cropX1:0,cropX2:1,cropY1:0,cropY2:1};l.call(this,this.uvTransform);this.images=[];this.layer=stage.extend({},b.layer);this.layers=[this.layer];for(b=0;b<this.layers.length;++b)this.layers[b].layer&&
this.layers.push(this.layers[b].layer),this.layers[b].image&&this.images.push(this.layers[b].image);for(b in this.images)this.images[b].addTexture(this);this.materials=[];this.contents=[];this.loadedMaterials=[];this.loadedMaterialsCnt=0;this.loaded=this.ready=!1};g.prototype.destroy=function(){this.destroyed||(this.deallocate(),this.destroyed=!0,this.layers=this.layer=this.images=this.manager=null)};g.prototype.deallocate=function(){this.loaded=this.ready=!1;this.glTexture&&(b.deleteTexture(this.glTexture),
this.glTexture=null);this.intermediateGlTexture&&(b.deleteTexture(this.intermediateGlTexture),this.intermediateGlTexture=null);if(this.imagesLoaded)for(var d in this.images)this.images[d].unload();this.cube1&&(b.deleteTexture(this.cube1),b.deleteTexture(this.cube2),b.deleteTexture(this.cube3),b.deleteTexture(this.cube4),b.deleteTexture(this.cube5),b.deleteTexture(this.cube6),this.cube6=this.cube5=this.cube4=this.cube3=this.cube2=this.cube1=null);this.imagesLoaded=!1};g.prototype.update=function(b){this.name=
b.name;this.wrapS=b.wrapS;this.wrapT=b.wrapT;this.minFilter=b.minFilter;this.magFilter=b.magFilter;this.anisotropy=b.anisotropy;this.repeatX=b.repeatX;this.repeatY=b.repeatY;this.offsetX=b.offsetX;this.offsetY=b.offsetY;this.pivotX=b.pivotX;this.pivotY=b.pivotY;this.angle=b.angle;this.useMipmap=b.useMipmap;this.srgbMode=b.srgbMode;this.channel=b.channel;this.negativeTexture=b.negativeTexture;this.uvsrc=b.uvsrc;this.useRealMeasurements=b.useRealMeasurements;this.ignoreGlobalUVTransform=b.ignoreGlobalUVTransform;
this.uvTransformOrder=b.uvTransformOrder;this.uvTransform.dirty=!0;this.uvTransform.offset[0]=b.offsetX;this.uvTransform.offset[1]=b.offsetY;this.uvTransform.repeat[0]=b.repeatX;this.uvTransform.repeat[1]=b.repeatY;this.uvTransform.pivot[0]=b.pivotX;this.uvTransform.pivot[1]=b.pivotY;this.uvTransform.negatedPivot[0]=-b.pivotX;this.uvTransform.negatedPivot[1]=-b.pivotY;this.uvTransform.baseRotation=b.angle;this.applyCropX="CROPPED"===b.wrapS;this.applyCropY="CROPPED"===b.wrapT;l.call(this,this.uvTransform);
var d=this.images;this.images=[];this.layer=stage.extend({},b.layer);this.layers=[this.layer];for(b=0;b<this.layers.length;++b)this.layers[b].layer&&this.layers.push(this.layers[b].layer),this.layers[b].image&&this.images.push(this.layers[b].image);delete this.finalImage;if(this.loaded||this.imagesLoaded){for(b in this.images)this.loaded=this.images[b].load()&&this.loaded;this.imagesLoaded=!0;for(b in d)d[b].unload();this.checkReadiness()}else this.ready=!1};g.prototype.addMaterial=function(b,d){-1===
this.materials.indexOf(b)&&(this.materials.push(b),this.contents.push(d))};g.prototype.checkReadiness=function(){var b=!0,d;for(d in this.images)this.images[d].isReady()||(b=!1);b?(this.finalImage=this.images[0],this.ready=!0):this.ready=!1};g.prototype.isReady=function(){return this.ready};g.prototype.isDownloaded=function(){var b=!0,d;for(d in this.images){var f=this.images[d];b=b&&(f.firstLoaded||f.fullyLoaded)}return b};g.prototype.loadToShader=function(d,f,g,n,m){if(!this.ready)return-1;if(f&&
f.textureTransform){var e=vec3.create(this.uvTransform.translation),k=vec3.create(this.uvTransform.rotationCenter),p=vec3.create(this.uvTransform.scaling),r=this.uvTransform.rotation;this.transform(f.textureTransform.translation,f.textureTransform.rotation,f.textureTransform.scaling,f.textureTransform.rotationCenter)}res=d.textureCount++;this.anisotropy=Math.min(this.anisotropy,b.maxAnisotropy);var q=this.wrapS,t=this.wrapT,w=this.minFilter,A=this.magFilter,B=this.useMipmap,u=this.anisotropy;d=null;
var E=1;m&&(q=void 0!==m.wrapS?m.wrapS:q,t=void 0!==m.wrapT?m.wrapT:t,w=void 0!==m.minFilter?m.minFilter:w,A=void 0!==m.magFilter?m.magFilter:A,B=void 0!==m.useMipmap?m.useMipmap:B,u=void 0!==m.anisotropy?m.anisotropy:u);f&&(d=f.matAnim.getCurrentMaterial().uvTransform,f.realMeasurementScalingFactors&&(void 0!==f.realMeasurementScalingFactors[this.uvsrc]?E=f.realMeasurementScalingFactors[this.uvsrc]:void 0!==f.realMeasurementScalingFactors[0]&&(E=f.realMeasurementScalingFactors[0])));b.activeTexture(b.TEXTURE0+
res);this.glTexture?(m=b.TEXTURE_2D,b.webgl2&&(m=b[this.layers[0].image.textureMode]),u=this.layers[0].image.mipmapUsable,b.bindTexture(m,this.glTexture),u||(q=t="CLAMP_TO_EDGE"),q=q.replace("CROPPED","CLAMP_TO_EDGE"),t=t.replace("CROPPED","CLAMP_TO_EDGE"),b.texParameteri(m,b.TEXTURE_WRAP_S,b[q]),b.texParameteri(m,b.TEXTURE_WRAP_T,b[t]),b.anisotropicTexture&&0<this.anisotropy&&b.texParameterf(m,b.anisotropicTexture.TEXTURE_MAX_ANISOTROPY_EXT,this.anisotropy),B&&u&&-1===w.indexOf("MIPMAP")&&(w=w+"_MIPMAP_"+
w),b.texParameteri(m,b.TEXTURE_MIN_FILTER,b[w]),b.texParameteri(m,b.TEXTURE_MAG_FILTER,b[A])):this.finalImage.bind(q,t,w,A,B,u);g&&(this.uvTransform.dirty&&(this.useRealMeasurements&&(q=1/this.finalImage.heightMM*E,this.uvTransform.repeat[0]=1/(this.finalImage.widthMM/this.finalImage.heightMM)*q,this.uvTransform.repeat[1]=q),l.call(this,this.uvTransform),this.uvTransform.dirty=!0),q=stage.extend({},this.uvTransform),!this.ignoreGlobalUVTransform&&d&&(q.dirty=!0,q.baseRotation=this.angle+d.angle,q.offset[0]=
this.offsetX-d.offsetX,q.offset[1]=this.offsetY-d.offsetY,q.repeat=new Float32Array(this.uvTransform.repeat),q.repeat[0]*=d.scaleX,q.repeat[1]*=d.scaleY),q.dirty&&(l.call(this,q),q.dirty=!1),b.uniformMatrix4fv(g,!1,q.matrix));n&&(f&&f.uvIdToIndex&&void 0!==f.uvIdToIndex[this.uvsrc]?b.uniform1i(n,f.uvIdToIndex[this.uvsrc]):b.uniform1i(n,0));f&&f.textureTransform&&(vec3.set(e,this.uvTransform.translation),vec3.set(k,this.uvTransform.rotationCenter),vec3.set(p,this.uvTransform.scaling),this.uvTransform.rotation=
r,l.call(this,this.uvTransform));return res};var q=mat4.create();g.prototype.interpolateUvTransform=function(d,f,g,n){var e=1-f;d={matrix:q,translation:[this.uvTransform.translation[0]*e+d.uvTransform.translation[0]*f,this.uvTransform.translation[1]*e+d.uvTransform.translation[1]*f,this.uvTransform.translation[2]*e+d.uvTransform.translation[2]*f],rotation:[e*this.uvTransform.rotation+f*d.uvTransform.rotation],rotationCenter:[this.uvTransform.rotationCenter[0]*e+d.uvTransform.rotationCenter[0]*f,this.uvTransform.rotationCenter[1]*
e+d.uvTransform.rotationCenter[1]*f,this.uvTransform.rotationCenter[2]*e+d.uvTransform.rotationCenter[2]*f],negatedRotationCenter:[this.uvTransform.negatedRotationCenter[0]*e+d.uvTransform.negatedRotationCenter[0]*f,this.uvTransform.negatedRotationCenter[1]*e+d.uvTransform.negatedRotationCenter[1]*f,this.uvTransform.negatedRotationCenter[2]*e+d.uvTransform.negatedRotationCenter[2]*f],pivot:[this.uvTransform.pivot[0]*e+d.uvTransform.pivot[0]*f,this.uvTransform.pivot[1]*e+d.uvTransform.pivot[1]*f,this.uvTransform.pivot[2]*
e+d.uvTransform.pivot[2]*f],negatedPivot:[this.uvTransform.negatedPivot[0]*e+d.uvTransform.negatedPivot[0]*f,this.uvTransform.negatedPivot[1]*e+d.uvTransform.negatedPivot[1]*f,this.uvTransform.negatedPivot[2]*e+d.uvTransform.negatedPivot[2]*f],offset:[this.uvTransform.offset[0]*e+d.uvTransform.offset[0]*f,this.uvTransform.offset[1]*e+d.uvTransform.offset[1]*f,this.uvTransform.offset[2]*e+d.uvTransform.offset[2]*f],repeat:[this.uvTransform.repeat[0]*e+d.uvTransform.repeat[0]*f,this.uvTransform.repeat[1]*
e+d.uvTransform.repeat[1]*f,this.uvTransform.repeat[2]*e+d.uvTransform.repeat[2]*f],scaling:[this.uvTransform.scaling[0]*e+d.uvTransform.scaling[0]*f,this.uvTransform.scaling[1]*e+d.uvTransform.scaling[1]*f,this.uvTransform.scaling[2]*e+d.uvTransform.scaling[2]*f],baseRotation:this.uvTransform.baseRotation*e+d.uvTransform.baseRotation*f,cropX1:0,cropX2:1,cropY1:0,cropY2:1};l.call(this,d);b.uniformMatrix4fv(g,!1,d.matrix);b.uniformMatrix4fv(n,!1,d.matrix)};g.prototype.load=function(){++this.loadedMaterialsCnt;
if(0<this.loadedMaterialsCnt){if(!this.loaded){this.loaded=!0;for(var b=0;b<this.images.length;++b)this.loaded=this.images[b].load()&&this.loaded;if(this.imagesLoaded)for(b=0;b<this.images.length;++b)this.images[b].unload();this.imagesLoaded=!0}}else console.warn("loaded materials cnt was < 0",this);this.checkReadiness()};g.prototype.unload=function(){--this.loadedMaterialsCnt;if(this.loadedMaterialsCnt)0>this.loadedMaterialsCnt&&console.warn("loaded materials cnt set < 0",this);else if(this.loaded||
this.imagesLoaded){this.imagesLoaded=this.loaded=!1;for(var b=0;b<this.images.length;++b)this.images[b].unload()}this.checkReadiness()};g.prototype.checkLoading=function(){if(0<this.loadedMaterialsCnt){if(!this.loaded){this.loaded=!0;for(var b=0;b<this.images.length;++b)this.loaded=this.images[b].load()&&this.loaded;if(this.imagesLoaded)for(b=0;b<this.images.length;++b)this.images[b].unload();this.imagesLoaded=!0}}else if(this.loaded||this.imagesLoaded)for(this.imagesLoaded=this.loaded=!1,b=0;b<this.images.length;++b)this.images[b].unload();
this.checkReadiness()};g.prototype.hasToBeDownloaded=function(){return 0<this.loadedMaterialsCnt};var t=function(b,d){return b.level<d.level?-1:b.level>d.level?1:0};g.prototype.updateLayer=function(b){var d=null,e;for(e in this.layers)if(this.layers[e].name==b.name){d=this.layers[e];break}d?stage.extend(d,b):(b=stage.extend({},b),this.layers[this.layers.length-1].layer=b,this.layers.push(b),this.sortedLayers=[].concat(this.layers),this.sortedLayers.sort(t))};g.prototype.removeLayer=function(b){var d=
this.layer;if(d.name==b)this.layer=this.layer.layer,this.layers.shift();else for(;d.layer;){if(d.layer.name==b){this.layers.splice(this.layers.indexOf(d.layer),1);d.layer=d.layer.layer;break}d=d.layer}this.sortedLayers=[].concat(this.layers);this.sortedLayers.sort(t)};g.prototype.computeLayers=function(){if(1==this.layers.length)this.glTexture&&(b.deleteTexture(this.glTexture),b.deleteTexture(this.intermediateGlTexture),this.intermediateGlTexture=this.glTexture=null);else if(b&&d){this.glTexture||
(this.glTexture=b.createTexture());this.intermediateGlTexture||(this.intermediateGlTexture=b.createTexture());var e=this.layers[0].image,f=e.glTexture,g=this.intermediateGlTexture;if(f){for(var n in this.sortedLayers){var m=this.sortedLayers[n];if(!m.image){switch(m.type){case "brightness":d.applyBrightness(g,f,e.maxWidth,e.maxHeight,m.value);break;case "contrast":d.applyContrast(g,f,e.maxWidth,e.maxHeight,m.value);break;case "contrastAndBrightness":d.applyContrastAndBrightness(g,f,e.maxWidth,e.maxHeight,
m.contrast,m.brightness);break;case "hue":d.applyHue(g,f,e.maxWidth,e.maxHeight,m.value);break;case "blackAndWhite":d.applyBlackAndWhite(g,f,e.maxWidth,e.maxHeight,m.value);break;case "graining":d.applyGraining(g,f,e.maxWidth,e.maxHeight,m.size,m.intensity);break;case "centerBlurring":d.applyCenterBlur(g,f,e.maxWidth,e.maxHeight,m.blurType,m.centerSize,m.outSize,m.exponent,m.centerX,m.centerY,this.uvTransform.scaling[1]/this.uvTransform.scaling[0]);break;case "cssGram":d.applyCssGram(g,f,e.maxWidth,
e.maxHeight,m.filterType);break;case "blending":d.applyBlending(g,f,e.maxWidth,e.maxHeight,this.manager.apiCore.exec(this.manager.callerName,"lib.hexToRgba",m.color));break;case "dilation":d.applyDilation(g,f,e.maxWidth,e.maxHeight);break;default:continue}f=g;g=n%2?this.glTexture:this.intermediateGlTexture}}this.glTexture=f;this.intermediateGlTexture=g;e=b.TEXTURED_2D;b.webgl2&&(e=b[this.layers[0].image.textureMode]);f=this.layers[0].image.mipmapUsable;this.useMipmap&&f&&(b.bindTexture(e,this.glTexture),
b.generateMipmap(e),b.bindTexture(e,null))}}};g.prototype.translate=function(b){vec3.add(this.uvTransform.translation,b);l.call(this,this.uvTransform)};g.prototype.rotate=function(b){this.uvTransform.rotation+=b;l.call(this,this.uvTransform)};g.prototype.scale=function(b){vec3.multiply(this.uvTransform.scaling,b);l.call(this,this.uvTransform)};g.prototype.transform=function(b,d,f,g){vec3.set(b,this.uvTransform.translation);this.uvTransform.rotation=d;vec3.set(g,this.uvTransform.rotationCenter);vec3.set(g,
this.uvTransform.negatedRotationCenter);vec3.negate(this.uvTransform.negatedRotationCenter);vec3.set(f,this.uvTransform.scaling);l.call(this,this.uvTransform)};g.prototype.getImageData=function(e){this.computeLayers();var f=this.glTexture?this.glTexture:this.images[0].glTexture;if(!f)return null;var g=b.TEXTURED_2D;b.webgl2&&(g=b[this.images[0].textureMode]);var n=this.images[0].maxWidth,m=this.images[0].maxHeight;e&&(n=e.width,m=e.height);this.intermediateGlTexture||(this.intermediateGlTexture=b.createTexture());
f=d.applyTransform(this.intermediateGlTexture,f,n,m,this.uvTransform.matrix);e=b.createFramebuffer();b.bindFramebuffer(b.FRAMEBUFFER,e);b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,g,f,0);g=new Uint8Array(4*n*m);b.readPixels(0,0,n,m,b.RGBA,b.UNSIGNED_BYTE,g);f=document.createElement("canvas");f.width=n;f.height=m;for(var h=f.getContext("2d"),k=h.createImageData(n,m),l=0;l<n;++l)for(var r=0;r<m;++r)k.data[4*(l+n*r)]=g[4*(l+n*(m-r-1))],k.data[4*(l+n*r)+1]=g[4*(l+n*(m-r-1))+1],k.data[4*(l+
n*r)+2]=g[4*(l+n*(m-r-1))+2],k.data[4*(l+n*r)+3]=g[4*(l+n*(m-r-1))+3];b.deleteFramebuffer(e);delete g;h.putImageData(k,0,0);return f.toDataURL("image/png")};var r=function(b){this.id=b;this.polylistInstance=this.textureId=null;this.wrapT=this.wrapS="CLAMP_TO_EDGE";this.magFilter=this.minFilter="LINEAR";this.anisotropy=4;this.repeatY=this.repeatX=1;this.offsetY=this.offsetX=0;this.pivotY=this.pivotX=.5;this.angle=0;this.srgbMode=this.useMipmap=!1;this.channel=0;this.negativeTexture=!1;this.uvsrc=0;
this.ignoreGlobalUVTransform=this.useRealMeasurements=!1;this.uvTransformOrder=0;this.uvTransform={dirty:!0,matrix:mat4.create(),translation:vec3.create(),rotation:0,rotationCenter:vec3.create([.5,.5,1]),negatedRotationCenter:vec3.create([-.5,-.5,-1]),offset:vec3.create([this.offsetX,this.offsetY,0]),repeat:vec3.create([this.repeatX,this.repeatY,1]),pivot:vec3.create([this.pivotX,this.pivotY,1]),negatedPivot:vec3.create([-this.pivotX,-this.pivotY,-1]),baseRotation:this.angle,scaling:vec3.create([1,
1,1]),cropX1:0,cropX2:1,cropY1:0,cropY2:1};this.images=[];this.loaded=this.ready=!1;this.loadedCnt=0};r.prototype.destroy=function(){this.destroyed||(this.deallocate(),this.destroyed=!0,this.layers=this.layer=this.images=this.manager=null)};r.prototype.deallocate=function(){this.loaded=this.ready=!1;this.glTexture&&(b.deleteTexture(this.glTexture),this.glTexture=null);this.intermediateGlTexture&&(b.deleteTexture(this.intermediateGlTexture),this.intermediateGlTexture=null);if(this.imagesLoaded)for(var d in this.images)this.images[d].unload();
this.imagesLoaded=!1};r.prototype.isInstance=function(){return!0};r.prototype.fill=function(b){void 0!==b.id&&null===this.textureId&&(this.textureId=b.id);void 0!==b.name&&(this.name=b.name);void 0!==b.wrapS&&(this.wrapS=b.wrapS);void 0!==b.wrapT&&(this.wrapT=b.wrapT);void 0!==b.minFilter&&(this.minFilter=b.minFilter);void 0!==b.magFilter&&(this.magFilter=b.magFilter);void 0!==b.anisotropy&&(this.anisotropy=b.anisotropy);void 0!==b.repeatX&&(this.repeatX=b.repeatX);void 0!==b.repeatY&&(this.repeatY=
b.repeatY);void 0!==b.offsetX&&(this.offsetX=b.offsetX);void 0!==b.offsetY&&(this.offsetY=b.offsetY);void 0!==b.pivotX&&(this.pivotX=b.pivotX);void 0!==b.pivotY&&(this.pivotY=b.pivotY);void 0!==b.angle&&(this.angle=b.angle);void 0!==b.useMipmap&&(this.useMipmap=b.useMipmap);void 0!==b.srgbMode&&(this.srgbMode=b.srgbMode);void 0!==b.channel&&(this.channel=b.channel);void 0!==b.negativeTexture&&(this.negativeTexture=b.negativeTexture);void 0!==b.uvsrc&&(this.uvsrc=b.uvsrc);void 0!==b.useRealMeasurements&&
(this.useRealMeasurements=b.useRealMeasurements);void 0!==b.ignoreGlobalUVTransform&&(this.ignoreGlobalUVTransform=b.ignoreGlobalUVTransform);void 0!==b.uvTransformOrder&&(this.uvTransformOrder=b.uvTransformOrder);void 0!==b.cube1&&(this.cube1=b.cube1);void 0!==b.cube2&&(this.cube2=b.cube2);void 0!==b.cube3&&(this.cube3=b.cube3);void 0!==b.cube4&&(this.cube4=b.cube4);void 0!==b.cube5&&(this.cube5=b.cube5);void 0!==b.cube6&&(this.cube6=b.cube6);void 0!==b.wrapS&&(this.applyCropX="CROPPED"===b.wrapS);
void 0!==b.wrapT&&(this.applyCropY="CROPPED"===b.wrapT);b.uvTransform&&(void 0!==b.uvTransform.matrix&&mat4.set(b.uvTransform.matrix,this.uvTransform.matrix),void 0!==b.uvTransform.translation&&vec3.set(b.uvTransform.translation,this.uvTransform.translation),void 0!==b.uvTransform.rotation&&(this.uvTransform.rotation=b.uvTransform.rotation),void 0!==b.uvTransform.rotationCenter&&vec3.set(b.uvTransform.rotationCenter,this.uvTransform.rotationCenter),void 0!==b.uvTransform.negatedRotationCenter&&vec3.set(b.uvTransform.negatedRotationCenter,
this.uvTransform.negatedRotationCenter),void 0!==b.uvTransform.offset&&vec3.set(b.uvTransform.offset,this.uvTransform.offset),void 0!==b.uvTransform.repeat&&vec3.set(b.uvTransform.repeat,this.uvTransform.repeat),void 0!==b.uvTransform.pivot&&vec3.set(b.uvTransform.pivot,this.uvTransform.pivot),void 0!==b.uvTransform.negatedPivot&&vec3.set(b.uvTransform.negatedPivot,this.uvTransform.negatedPivot),void 0!==b.uvTransform.baseRotation&&(this.uvTransform.baseRotation=b.uvTransform.baseRotation),void 0!==
b.uvTransform.scaling&&vec3.set(b.uvTransform.scaling,this.uvTransform.scaling),void 0!==b.uvTransform.cropX1&&(this.uvTransform.cropX1=b.uvTransform.cropX1),void 0!==b.uvTransform.cropX2&&(this.uvTransform.cropX2=b.uvTransform.cropX2),void 0!==b.uvTransform.cropY1&&(this.uvTransform.cropY1=b.uvTransform.cropY1),void 0!==b.uvTransform.cropY2&&(this.uvTransform.cropY2=b.uvTransform.cropY2),this.uvTransform.dirty=!0);l.call(this,this.uvTransform);if(b.layer){var d=this.images;this.images=[];b=stage.extend({},
b.layer);for(var e=[b],f=0;f<e.length;++f)e[f].layer&&e.push(e[f].layer),e[f].image&&this.images.push(e[f].image);if(this.layer)for(f=0;f<e.length;++f)stage.extend(this.layers[f],e[f]),0<f&&(this.layers[f-1].layer=this.layers[f-1]);else this.layer=b,this.layers=e;this.sortedLayers=[].concat(this.layers);this.sortedLayers.sort(t);delete this.finalImage;if(this.loaded||this.imagesLoaded){for(f in this.images)this.loaded=this.images[f].load()&&this.loaded;this.imagesLoaded=!0;for(f in d)d[f].unload();
this.checkReadiness();this.ready&&this.computeLayers()}else this.ready=!1}};r.prototype.transform=function(b,d,f,g){vec3.set(b,this.uvTransform.translation);this.uvTransform.rotation=d;vec3.set(g,this.uvTransform.rotationCenter);vec3.set(g,this.uvTransform.negatedRotationCenter);vec3.negate(this.uvTransform.negatedRotationCenter);vec3.set(f,this.uvTransform.scaling);l.call(this,this.uvTransform)};r.prototype.load=function(b){this.polylistInstance=b;b.textureTransform&&this.transform(b.textureTransform.translation,
b.textureTransform.rotation,b.textureTransform.scaling,b.textureTransform.rotationCenter);++this.loadedCnt;if(0<this.loadedCnt){if(!this.loaded){this.loaded=!0;for(b=0;b<this.images.length;++b)this.loaded=this.images[b].load()&&this.loaded;if(this.imagesLoaded)for(b=0;b<this.images.length;++b)this.images[b].unload();this.imagesLoaded=!0}}else console.warn("loaded materials cnt was < 0",this);this.checkReadiness()};r.prototype.unload=function(){--this.loadedCnt;if(this.loadedCnt)0>this.loadedCnt&&
console.warn("loaded materials cnt set < 0",this);else if(this.loaded||this.imagesLoaded){this.imagesLoaded=this.loaded=!1;for(var b=0;b<this.images.length;++b)this.images[b].unload()}this.checkReadiness()};r.prototype.checkLoading=function(){if(0<this.loadedCnt){if(!this.loaded){this.loaded=!0;for(var b=0;b<this.images.length;++b)this.loaded=this.images[b].load()&&this.loaded;if(this.imagesLoaded)for(b=0;b<this.images.length;++b)this.images[b].unload();this.imagesLoaded=!0}}else if(this.loaded||
this.imagesLoaded)for(this.imagesLoaded=this.loaded=!1,b=0;b<this.images.length;++b)this.images[b].unload();this.checkReadiness()};r.prototype.isReady=function(){return this.ready};r.prototype.checkReadiness=function(){var b=!0,d;for(d in this.images)this.images[d].isReady()||(b=!1);b?(this.finalImage=this.images[0],this.ready||this.computeLayers(),this.ready=!0):this.ready=!1};r.prototype.isDownloaded=function(){var b=!0,d;for(d in this.images){var f=this.images[d];b=b&&(f.firstLoaded||f.fullyLoaded)}return b};
r.prototype.loadToShader=function(d,f,g,n){if(!this.ready)return-1;res=d.textureCount++;this.anisotropy=Math.min(this.anisotropy,b.maxAnisotropy);var e=this.wrapS,h=this.wrapT,k=this.minFilter,p=this.magFilter,r=this.useMipmap,q=this.anisotropy;d=null;var t=1;n&&(e=void 0!==n.wrapS?n.wrapS:e,h=void 0!==n.wrapT?n.wrapT:h,k=void 0!==n.minFilter?n.minFilter:k,p=void 0!==n.magFilter?n.magFilter:p,r=void 0!==n.useMipmap?n.useMipmap:r,q=void 0!==n.anisotropy?n.anisotropy:q);this.polylistInstance&&(d=this.polylistInstance.globalUVTransform?
this.polylistInstance.globalUVTransform:this.polylistInstance.matAnim.getCurrentMaterial().uvTransform,this.polylistInstance.realMeasurementScalingFactors&&(void 0!==this.polylistInstance.realMeasurementScalingFactors[this.uvsrc]?t=this.polylistInstance.realMeasurementScalingFactors[this.uvsrc]:void 0!==this.polylistInstance.realMeasurementScalingFactors[0]&&(t=this.polylistInstance.realMeasurementScalingFactors[0])));b.activeTexture(b.TEXTURE0+res);this.glTexture?(n=b.TEXTURE_2D,b.webgl2&&(n=b[this.layers[0].image.textureMode]),
q=this.layers[0].image.mipmapUsable,b.bindTexture(n,this.glTexture),q||(e=h="CLAMP_TO_EDGE"),e=e.replace("CROPPED","CLAMP_TO_EDGE"),h=h.replace("CROPPED","CLAMP_TO_EDGE"),b.texParameteri(n,b.TEXTURE_WRAP_S,b[e]),b.texParameteri(n,b.TEXTURE_WRAP_T,b[h]),b.anisotropicTexture&&0<this.anisotropy&&b.texParameterf(n,b.anisotropicTexture.TEXTURE_MAX_ANISOTROPY_EXT,this.anisotropy),r&&q&&-1===k.indexOf("MIPMAP")&&(k=k+"_MIPMAP_"+k),b.texParameteri(n,b.TEXTURE_MIN_FILTER,b[k]),b.texParameteri(n,b.TEXTURE_MAG_FILTER,
b[p])):this.finalImage.bind(e,h,k,p,r,q);f&&(this.uvTransform.dirty&&(this.useRealMeasurements&&(e=1/this.finalImage.heightMM*t,this.uvTransform.repeat[0]=1/(this.finalImage.widthMM/this.finalImage.heightMM)*e,this.uvTransform.repeat[1]=e),l.call(this,this.uvTransform),this.uvTransform.dirty=!0),e=stage.extend({},this.uvTransform),!this.ignoreGlobalUVTransform&&d&&(e.dirty=!0,e.baseRotation=this.angle+d.angle,e.offset[0]=this.offsetX-d.offsetX,e.offset[1]=this.offsetY-d.offsetY,e.repeat=new Float32Array(this.uvTransform.repeat),
e.repeat[0]*=d.scaleX,e.repeat[1]*=d.scaleY),e.dirty&&(l.call(this,e),e.dirty=!1),b.uniformMatrix4fv(f,!1,e.matrix));g&&(this.polylistInstance&&this.polylistInstance.uvIdToIndex&&void 0!==this.polylistInstance.uvIdToIndex[this.uvsrc]?b.uniform1i(g,this.polylistInstance.uvIdToIndex[this.uvsrc]):b.uniform1i(g,0));return res};r.prototype.interpolateUvTransform=function(d,f,g,n){var e=1-f;d={matrix:q,translation:[this.uvTransform.translation[0]*e+d.uvTransform.translation[0]*f,this.uvTransform.translation[1]*
e+d.uvTransform.translation[1]*f,this.uvTransform.translation[2]*e+d.uvTransform.translation[2]*f],rotation:[e*this.uvTransform.rotation+f*d.uvTransform.rotation],rotationCenter:[this.uvTransform.rotationCenter[0]*e+d.uvTransform.rotationCenter[0]*f,this.uvTransform.rotationCenter[1]*e+d.uvTransform.rotationCenter[1]*f,this.uvTransform.rotationCenter[2]*e+d.uvTransform.rotationCenter[2]*f],negatedRotationCenter:[this.uvTransform.negatedRotationCenter[0]*e+d.uvTransform.negatedRotationCenter[0]*f,
this.uvTransform.negatedRotationCenter[1]*e+d.uvTransform.negatedRotationCenter[1]*f,this.uvTransform.negatedRotationCenter[2]*e+d.uvTransform.negatedRotationCenter[2]*f],pivot:[this.uvTransform.pivot[0]*e+d.uvTransform.pivot[0]*f,this.uvTransform.pivot[1]*e+d.uvTransform.pivot[1]*f,this.uvTransform.pivot[2]*e+d.uvTransform.pivot[2]*f],negatedPivot:[this.uvTransform.negatedPivot[0]*e+d.uvTransform.negatedPivot[0]*f,this.uvTransform.negatedPivot[1]*e+d.uvTransform.negatedPivot[1]*f,this.uvTransform.negatedPivot[2]*
e+d.uvTransform.negatedPivot[2]*f],offset:[this.uvTransform.offset[0]*e+d.uvTransform.offset[0]*f,this.uvTransform.offset[1]*e+d.uvTransform.offset[1]*f,this.uvTransform.offset[2]*e+d.uvTransform.offset[2]*f],repeat:[this.uvTransform.repeat[0]*e+d.uvTransform.repeat[0]*f,this.uvTransform.repeat[1]*e+d.uvTransform.repeat[1]*f,this.uvTransform.repeat[2]*e+d.uvTransform.repeat[2]*f],scaling:[this.uvTransform.scaling[0]*e+d.uvTransform.scaling[0]*f,this.uvTransform.scaling[1]*e+d.uvTransform.scaling[1]*
f,this.uvTransform.scaling[2]*e+d.uvTransform.scaling[2]*f],baseRotation:this.uvTransform.baseRotation*e+d.uvTransform.baseRotation*f,cropX1:0,cropX2:1,cropY1:0,cropY2:1};l.call(this,d);b.uniformMatrix4fv(g,!1,d.matrix);b.uniformMatrix4fv(n,!1,d.matrix)};r.prototype.updateLayer=function(b,d){var e=null,f;for(f in this.layers)if(this.layers[f].name==b.name){e=this.layers[f];break}e?stage.extend(e,b):(b=stage.extend({},b),this.layers[this.layers.length-1].layer=b,this.layers.push(b),this.sortedLayers=
[].concat(this.layers),this.sortedLayers.sort(t));d||(this.ready=!1,this.checkReadiness())};r.prototype.removeLayer=function(b,d){var e=this.layer;if(e.name==b)this.layer=this.layer.layer,this.layers.shift();else for(;e.layer;){if(e.layer.name==b){this.layers.splice(this.layers.indexOf(e.layer),1);e.layer=e.layer.layer;break}e=e.layer}this.sortedLayers=[].concat(this.layers);this.sortedLayers.sort(t);d||(this.ready=!1,this.checkReadiness())};r.prototype.computeLayers=function(){if(1==this.layers.length)this.glTexture&&
(b.deleteTexture(this.glTexture),b.deleteTexture(this.intermediateGlTexture),this.intermediateGlTexture=this.glTexture=null);else if(b&&d){this.glTexture||(this.glTexture=b.createTexture());this.intermediateGlTexture||(this.intermediateGlTexture=b.createTexture());var e=this.layers[0].image,f=e.glTexture,g=this.intermediateGlTexture;if(f){for(var n in this.sortedLayers){var m=this.sortedLayers[n];if(!m.image){switch(m.type){case "brightness":d.applyBrightness(g,f,e.maxWidth,e.maxHeight,m.value);break;
case "contrast":d.applyContrast(g,f,e.maxWidth,e.maxHeight,m.value);break;case "contrastAndBrightness":d.applyContrastAndBrightness(g,f,e.maxWidth,e.maxHeight,m.contrast,m.brightness);break;case "hue":d.applyHue(g,f,e.maxWidth,e.maxHeight,m.value);break;case "blackAndWhite":d.applyBlackAndWhite(g,f,e.maxWidth,e.maxHeight,m.value);break;case "graining":d.applyGraining(g,f,e.maxWidth,e.maxHeight,m.size,m.intensity);break;case "centerBlurring":d.applyCenterBlur(g,f,e.maxWidth,e.maxHeight,m.blurType,
m.centerSize,m.outSize,m.exponent,m.centerX,m.centerY,this.uvTransform.scaling[1]/this.uvTransform.scaling[0]);break;case "cssGram":d.applyCssGram(g,f,e.maxWidth,e.maxHeight,m.filterType);break;case "blending":d.applyBlending(g,f,e.maxWidth,e.maxHeight,this.manager.apiCore.exec(this.manager.callerName,"lib.hexToRgba",m.color));break;case "dilation":d.applyDilation(g,f,e.maxWidth,e.maxHeight);break;default:continue}f=g;g=n%2?this.glTexture:this.intermediateGlTexture}}this.glTexture=f;this.intermediateGlTexture=
g;e=b.TEXTURED_2D;b.webgl2&&(e=b[this.layers[0].image.textureMode]);f=this.layers[0].image.mipmapUsable;this.useMipmap&&f&&(b.bindTexture(e,this.glTexture),b.generateMipmap(e),b.bindTexture(e,null))}}};var f=-1E3,n=function(b,d){this.manager=d;this.id=b.id;this.name=b.name;this.minFilter=b.minFilter;this.magFilter=b.magFilter;this.positioned=b.positioned?1:0;this.center=b.center;this.cubeSize=b.cubeSize;b.imagesData?(this.imagesData=b.imagesData,this.files=b.files,this.posX=d.createLocalImageRGBA({id:--f,
width:1,height:1,imageData:b.imagesData.local_positive_x}),this.negX=d.createLocalImageRGBA({id:--f,width:1,height:1,imageData:b.imagesData.local_negative_x}),this.posY=d.createLocalImageRGBA({id:--f,width:1,height:1,imageData:b.imagesData.local_positive_y}),this.negY=d.createLocalImageRGBA({id:--f,width:1,height:1,imageData:b.imagesData.local_negative_y}),this.posZ=d.createLocalImageRGBA({id:--f,width:1,height:1,imageData:b.imagesData.local_positive_z}),this.negZ=d.createLocalImageRGBA({id:--f,width:1,
height:1,imageData:b.imagesData.local_negative_z})):(this.posX=b.posX,this.negX=b.negX,this.posY=b.posY,this.negY=b.negY,this.posZ=b.posZ,this.negZ=b.negZ,delete this.imagesData,delete this.files);this.images=[this.posX,this.negX,this.posY,this.negY,this.posZ,this.negZ];this.glTexture=null;this.materials=[];this.contents=[];this.loadedMaterials=[];this.loadedMaterialsCnt=0;this.imagesLoaded=this.loaded=this.ready=!1};n.prototype.destroy=function(){this.destroyed||(this.destroyed=!0,this.deallocate(),
this.negZ=this.posZ=this.negY=this.posY=this.negX=this.posX=this.loadedMaterials=this.contents=this.materials=this.images=null)};n.prototype.deallocate=function(){this.glTexture&&(b.deleteTexture(this.glTexture),this.glTexture=null);if(this.loaded||this.imagesLoaded){this.imagesLoaded=this.loaded=!1;this.unloadImages2();for(var d=0;d<this.images.length;++d)this.images[d].loadedTexturesCnt=0}this.ready=!1};n.prototype.isInstance=function(){return!1};n.prototype.update=function(b){this.name=b.name;
this.minFilter=b.minFilter;this.magFilter=b.magFilter;this.positioned=b.positioned?1:0;this.center=b.center;this.cubeSize=b.cubeSize;if(b.imagesData){var d=void 0!==this.imagesData;if(this.imagesData)for(var e in b.imagesData)if(this.imagesData[e]!==b.imagesData[e]){d=!1;break}this.imagesData=stage.extend(!0,{},b.imagesData);this.files=b.files;if(d)return;this.destroy();this.posX=this.manager.createLocalImageRGBA({id:--f,width:1,height:1,imageData:b.imagesData.local_positive_x});this.negX=this.manager.createLocalImageRGBA({id:--f,
width:1,height:1,imageData:b.imagesData.local_negative_x});this.posY=this.manager.createLocalImageRGBA({id:--f,width:1,height:1,imageData:b.imagesData.local_positive_y});this.negY=this.manager.createLocalImageRGBA({id:--f,width:1,height:1,imageData:b.imagesData.local_negative_y});this.posZ=this.manager.createLocalImageRGBA({id:--f,width:1,height:1,imageData:b.imagesData.local_positive_z});this.negZ=this.manager.createLocalImageRGBA({id:--f,width:1,height:1,imageData:b.imagesData.local_negative_z})}else{if(d=
(d=(d=(d=(d=(d=this.posX.id===b.posX.id)&&this.negX.id===b.negX.id)&&this.posY.id===b.posY.id)&&this.negY.id===b.negY.id)&&this.posZ.id===b.posZ.id)&&this.negZ.id===b.negZ.id)return;this.destroy();delete this.imagesData;delete this.files;this.posX=this.manager.getImage(b.posX.id);this.negX=this.manager.getImage(b.negX.id);this.posY=this.manager.getImage(b.posY.id);this.negY=this.manager.getImage(b.negY.id);this.posZ=this.manager.getImage(b.posZ.id);this.negZ=this.manager.getImage(b.negZ.id)}this.loaded&&
(this.loaded=!1,this.unloadImages2(),this.imagesLoaded=!1);this.ready=!1;this.images=[this.posX,this.negX,this.posY,this.negY,this.posZ,this.negZ]};n.prototype.addMaterial=function(b,d){-1===this.materials.indexOf(b)&&(this.materials.push(b),this.contents.push(d))};n.prototype.checkReadiness=function(){var b=!0,d;for(d in this.images)this.images[d].firstLoaded||(b=!1);this.ready=b};n.prototype.isReady=function(){return this.ready};n.prototype.isDownloaded=function(){var b=!0,d;for(d in this.images){var f=
this.images[d];b=b&&(f.firstLoaded||f.fullyLoaded)}return b};n.prototype.load=function(){++this.loadedMaterialsCnt;if(0<this.loadedMaterialsCnt){if(!this.loaded){this.loaded=this.loadImages2();this.imagesLoaded=!0;for(var b=0;b<this.images.length;++b)this.images[b].loadedTexturesCnt=1}}else console.warn("loaded materials cnt was < 0",this);this.checkReadiness()};n.prototype.unload=function(){--this.loadedMaterialsCnt;if(this.loadedMaterialsCnt)0>this.loadedMaterialsCnt&&console.warn("loaded materials cnt set < 0",
this);else if(this.loaded||this.imagesLoaded){this.imagesLoaded=this.loaded=!1;this.unloadImages2();for(var b=0;b<this.images.length;++b)this.images[b].loadedTexturesCnt=0}this.checkReadiness()};n.prototype.checkLoading=function(){if(0<this.loadedMaterialsCnt){if(!this.loaded){this.loaded=this.loadImages2();this.imagesLoaded=!0;for(var b=0;b<this.images.length;++b)this.images[b].loadedTexturesCnt=1}}else if(this.loaded||this.imagesLoaded)for(this.imagesLoaded=this.loaded=!1,this.unloadImages2(),b=
0;b<this.images.length;++b)this.images[b].loadedTexturesCnt=0;this.checkReadiness()};n.prototype.hasToBeDownloaded=function(){return 0<this.loadedMaterialsCnt};n.prototype.loadToShader=function(d){if(!this.ready)return-1;(res=d.textureCount++)||(res=d.textureCount++);b.activeTexture(b.TEXTURE0+res);b.bindTexture(b.TEXTURE_CUBE_MAP,this.glTexture);return res};n.prototype.loadImages2=function(){if(!(b&&this.posX.firstLoaded&&this.negX.firstLoaded&&this.posY.firstLoaded&&this.negY.firstLoaded&&this.posZ.firstLoaded&&
this.negZ.firstLoaded))return!1;if(!this.glTexture){var d=b.createTexture();b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL,!1);b.bindTexture(b.TEXTURE_CUBE_MAP,d);this.posX.checkMipmap();this.negX.checkMipmap();this.posY.checkMipmap();this.negY.checkMipmap();this.posZ.checkMipmap();this.negZ.checkMipmap();b.texParameteri(b.TEXTURE_CUBE_MAP,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE);b.texParameteri(b.TEXTURE_CUBE_MAP,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE);this.posX.mipmapUsable&&this.negX.mipmapUsable&&this.posY.mipmapUsable&&
this.negY.mipmapUsable&&this.posZ.mipmapUsable&&this.negZ.mipmapUsable?b.texParameteri(b.TEXTURE_CUBE_MAP,b.TEXTURE_MIN_FILTER,b.LINEAR_MIPMAP_LINEAR):b.texParameteri(b.TEXTURE_CUBE_MAP,b.TEXTURE_MIN_FILTER,b.LINEAR);b.texParameteri(b.TEXTURE_CUBE_MAP,b.TEXTURE_MAG_FILTER,b.LINEAR);"local"===this.posX.images[0].fileType&&b.pixelStorei(b.UNPACK_COLORSPACE_CONVERSION_WEBGL,!1);b.texImage2D(b.TEXTURE_CUBE_MAP_POSITIVE_X,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,this.posX.images[0].htmlImage);b.texImage2D(b.TEXTURE_CUBE_MAP_NEGATIVE_X,
0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,this.negX.images[0].htmlImage);b.texImage2D(b.TEXTURE_CUBE_MAP_POSITIVE_Y,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,this.posY.images[0].htmlImage);b.texImage2D(b.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,this.negY.images[0].htmlImage);b.texImage2D(b.TEXTURE_CUBE_MAP_POSITIVE_Z,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,this.posZ.images[0].htmlImage);b.texImage2D(b.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,this.negZ.images[0].htmlImage);this.posX.mipmapUsable&&
this.negX.mipmapUsable&&this.posY.mipmapUsable&&this.negY.mipmapUsable&&this.posZ.mipmapUsable&&this.negZ.mipmapUsable&&b.generateMipmap(b.TEXTURE_CUBE_MAP);"local"===this.posX.images[0].fileType&&b.pixelStorei(b.UNPACK_COLORSPACE_CONVERSION_WEBGL,b.BROWSER_DEFAULT_WEBGL);var f=b.getError();if(f!==b.NO_ERROR)return this.manager.imagesSettings.onWebGlError(f),!1;b.bindTexture(b.TEXTURE_CUBE_MAP,null);b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL,!0);this.glTexture=d}return!0};n.prototype.unloadImages2=function(){this.glTexture&&
(b.deleteTexture(this.glTexture),this.glTexture=!1)};var B=function(d,f,g){this.eventsManager=stage.createEventsManager(g);this.scene=f;this.apiCore=d;this.callerName="WebGLRenderer-TexturesManager";this.maxSimultaneousTextures=0;this.images={};this.localImagesCpt=0;this.customImagesIds=-11111;this.textureInstancesIds=0;this.textures={};this.texturesCube={};this.textureInstances=[];this.requiredForInit=[];this.failedImages=[];this.startingMaterials=[];this.startingImagesDownloading=0;this.timeoutDuration=
1E4;this.maxTimeoutTentatives=4;this.imagesSettings={onWebGlError:stage.setContext(function(d){d===b.OUT_OF_MEMORY?this.eventsManager.fireEvent("onWebGlError",stage.createError(205,"Out of memory",{})):this.eventsManager.fireEvent("onWebGlError",stage.createError(207,"Unknown image load error",{glError:d}))},this),onError:stage.setContext(function(b){for(var d in b.materials)b.materials[d].onerror&&b.materials[d].onerror();b.materials=[];stage.emersya.viewer.modules.renderer.lightsEditor?(this.failedImages.push(b.id),
b.resetAndCall("firstLoadedCallbacks"),b.resetAndCall("fullyLoadedCallbacks")):this.eventsManager.fireEvent("onImageDownloadError",this.scene,b.getFirstImagePath())},this),onProgress:stage.setContext(function(b,d){this.eventsManager.fireEvent("onProgress",b,d)},this)}};B.prototype.destroy=function(){this.deallocate();if(!this.destroyed){this.destroyed=!0;for(var b in this.textures)this.textures[b].destroy();for(b in this.texturesCube)this.texturesCube[b].destroy();for(b in this.images)this.images[b].destroy();
this.eventsManager=this.imagesSettings=this.apiCore=this.scene=this.texturesCube=this.textures=this.images=null}};B.prototype.deallocate=function(){for(var b in this.textures)this.textures[b].deallocate();for(b in this.texturesCube)this.texturesCube[b].deallocate();for(b in this.images)this.images[b].deallocate()};B.prototype.createLocalImageRGBA=function(b){var d=b.id?b.id:--this.customImagesIds,e={id:d,name:b.name,defaultImage:null,sourceImages:[{id:b.id?b.id:--this.customImagesIds,name:b.name,
width:b.width,height:b.height,realFilePath:b.imageData,fileSize:0,fileType:"local"}]};e.defaultImage=e.sourceImages[0];b=b.onImageDownloadError?stage.extend({},this.imagesSettings,{onError:b.onImageDownloadError}):this.imagesSettings;this.images[d]?(this.images[d].endProgress=stage.setContext(function(){for(var b in this.images)this.images[b].width=this.images[b].htmlImage.naturalWidth,this.images[b].height=this.images[b].htmlImage.naturalHeight;this.checkMipmap();k.prototype.endProgress.call(this)},
this.images[d]),this.images[d].update(e)):(e=new k(e,b),e.endProgress=stage.setContext(function(){for(var b in this.images)this.images[b].width=this.images[b].htmlImage.naturalWidth,this.images[b].height=this.images[b].htmlImage.naturalHeight;this.checkMipmap();k.prototype.endProgress.call(this)},e),this.images[d]=e);return this.images[d]};B.prototype.deleteLocalSourceImage=function(b){if("local"===b.images[0].fileType){for(var d in b.textures)if(-1!==b.textures[d].images.indexOf(b)){console.warn("removing custom texture still linked, nothing done here.");
return}delete this.images[b.id]}};B.prototype.createLocalTextureCube=function(b){b={id:-1,glTexture:b,ready:!0,complete:!0,images:[],materials:[]};b.loadToShader=stage.setContext(n.prototype.loadToShader,b);b.checkReadiness=stage.setContext(n.prototype.loadToShader,b);b.destroy=stage.setContext(n.prototype.destroy,b);b.update=stage.setContext(n.prototype.update,b);b.addMaterial=function(){};b.checkReadiness=stage.setContext(n.prototype.checkReadiness,b);b.isReady=stage.setContext(n.prototype.isReady,
b);b.loadToShader=stage.setContext(n.prototype.loadToShader,b);return this.texturesCube[-1]=b};B.prototype.addImageRGBA=function(b){this.images[b.id]?this.images[b.id].update(b):this.images[b.id]=new k(b,this.imagesSettings);return this.images[b.id]};B.prototype.addTexture=function(b){this.textures[b.id]?this.textures[b.id].update(b):this.textures[b.id]=new g(b,this);return this.textures[b.id]};B.prototype.createTextureInstance=function(){var b=new r(++this.textureInstancesIds);this.textureInstances.push(b);
return b};B.prototype.addTextureCube=function(b){this.texturesCube[b.id]?this.texturesCube[b.id].update(b):this.texturesCube[b.id]=new n(b,this);return this.texturesCube[b.id]};B.prototype.removeTexture=function(b){this.textures[b.id]&&(this.textures[b.id].destroy(),delete this.textures[b.id])};B.prototype.removeTextureCube=function(b){this.texturesCube[b.id]&&(this.texturesCube[b.id].destroy(),delete this.texturesCube[b.id])};B.prototype.getImage=function(b){return this.images[b]};B.prototype.getTexture=
function(b){return this.textures[b]};B.prototype.getTexturesInstances=function(b){for(var d=[],e=0;e<this.textureInstances.length;++e)this.textureInstances[e].textureId==b&&d.push(this.textureInstances[e]);return d};B.prototype.getTextureCube=function(b){return this.texturesCube[b]};B.prototype.setGlContext=function(d){b=d};B.prototype.setFiltersManager=function(b){d=b;for(b=0;b<this.textureInstances.length;++b)this.textureInstances[b].computeLayers()};B.prototype.unloadTextureInstances=function(b){for(var d=
0;d<b.length;++d){b[d].isInstance()?b[d].destroy():b[d].unload();var e=this.textureInstances.indexOf(b[d]);0<=e&&this.textureInstances.splice(e,1)}};B.prototype.updateStartingRequirements=function(){this.scene.lights.IBL&&this.scene.lights.IBL.texture.load();this.scene.scenery.environmentTexture&&this.scene.scenery.environmentTexture.load();for(var b=0;b<this.scene.environmentTextures.length;++b)this.scene.environmentTextures[b].load();var d=[];for(b in this.images)this.images[b].hasToBeDownloaded()&&
(d.push(this.images[b]),this.images[b].setAsStartingImage());for(b in this.textures)this.textures[b].checkReadiness();for(b=0;b<this.textureInstances.length;++b)this.textureInstances[b].checkReadiness();for(b in this.texturesCube)this.texturesCube[b].checkReadiness();var f=0;for(b in d)f+=d[b].getImageFileSizes();this.startingTexturesReady=!1;return f};var w=function(b){var d=[],e;for(e in b.materials){var f=b.materials[e];f.onload&&!f.loaded&&this.scene.checkMaterial(f)&&(f.loaded=!0,d.push(f.onload))}b.materials=
[];for(b=0;b<d.length;++b)d[b]()},D=function(d){if(0<this.startingImagesDownloading&&!--this.startingImagesDownloading){if(b){for(var e in this.images)this.images[e].checkLoading();for(e in this.textures)this.textures[e].checkLoading();for(e=0;e<this.textureInstances.length;++e)this.textureInstances[e].checkLoading();for(e in this.texturesCube)this.texturesCube[e].checkLoading()}this.failedImages.length&&(this.eventsManager.fireEvent("failedImages",this.failedImages),this.failedImages=[]);this.startingTexturesReady=
!0;this.downloadingStartingImages=!1;this.eventsManager.fireEvent("startingTexturesReady",this.scene)}w.call(this,d)};B.prototype.loadStartingTextures=function(b){for(b=0;b<this.scene.environmentTextures.length;++b)for(var d=this.scene.environmentTextures[b],e=0;e<d.images.length;++e)d.images[e].rgbe=!0;d=[];for(b in this.images)this.images[b].hasToBeDownloaded()&&d.push(this.images[b]);this.startingImagesDownloading+=d.length;this.downloadingStartingImages=!0;e=stage.setContext(D,this);if(this.startingImagesDownloading)for(b=
0;b<d.length;++b)d[b].download(!0,e);else setTimeout(stage.setContext(function(){for(var b=0;b<this.startingMaterials.length;++b)this.startingMaterials[b].loaded=!0;this.startingTexturesReady=!0;this.downloadingStartingImages=!1;this.eventsManager.fireEvent("startingTexturesReady",this.scene)},this),1)};B.prototype.loadStartingTexturesToGl=function(){if(b){for(var d in this.images)this.images[d].checkLoading();for(d in this.textures)this.textures[d].checkReadiness();for(d in this.textureInstances)this.textureInstances[d].checkReadiness();
for(d in this.texturesCube)this.texturesCube[d].checkLoading()}else console.error("no gl context to load starting textures to")};B.prototype.getImagesFromMaterial=function(b){b=this.getTexturesFromMaterial(b);for(var d=[],e=0;e<b.length;++e)d=d.concat(b[e].images);return d};B.prototype.downloadMaterial=function(b){this.downloadMaterials([b])};var A=function(b){0<this.materialImagesDownloading&&!--this.materialImagesDownloading&&this.failedImages.length&&(this.eventsManager.fireEvent("failedImages",
this.failedImages),this.failedImages=[]);w.call(this,b)};B.prototype.downloadMaterials=function(d){for(var e=[],f=0;f<d.length;++f){var g=this.getImagesFromMaterial(d[f]);if(g.length)for(var n=0;n<g.length;++n)-1===g[n].materials.indexOf(d[f])&&g[n].materials.push(d[f]),-1===e.indexOf(g[n])&&e.push(g[n]);else d[f].loaded||(d[f].loaded=!0,d[f].onload&&d[f].onload())}g=stage.setContext(A,this);if(e.length)for(this.materialImagesDownloading=e.length,f=0;f<e.length;++f)e[f].download(!e[f].rgbe||b&&!b.webgl2&&
!b.shadertexturelod,g);else for(f=0;f<d.length;++f)d[f].loaded||(d[f].loaded=!0,d[f].onload&&d[f].onload())};B.prototype.downloadTexture=function(b,d,f){if(!this.startingTexturesReady)return!1;var e=[],g;for(g in b.images)e.push(b.images[g]);e=stage.array.uniq(e);var h=!e.length,n=e.length,k=function(){--n||(b.checkLoading(),d())};for(g=0;g<e.length;++g)e[g].download(!f,k);h&&(n=1,setTimeout(k,1));return!0};B.prototype.downloadTextureCube=function(b,d){if(!this.startingTexturesReady)return!1;var e=
[],f;for(f in b.images)b.images[f].firstLoaded||e.push(b.images[f]);e=stage.array.uniq(e);var g=!e.length,h=e.length,n=function(){--h||(b.checkLoading(),d())};for(f=0;f<e.length;++f)e[f].download(!0,n);g&&(h=1,setTimeout(n,1));return!0};B.prototype.updateMaterial=function(b){var d=0;b.textures=[];b.type?(b.albedo&&(b.albedo.texture&&(++d,this.textures[b.albedo.texture.id].addMaterial(b,["albedo","texture"]),b.textures.push(this.textures[b.albedo.texture.id])),b.albedo.specular&&(b.albedo.specular.texture&&
(++d,this.textures[b.albedo.specular.texture.id].addMaterial(b,["albedo.specular","texture"]),b.textures.push(this.textures[b.albedo.specular.texture.id])),b.albedo.specular.intensityTexture&&(++d,this.textures[b.albedo.specular.intensityTexture.id].addMaterial(b,["albedo.specular","intensityTexture"]),b.textures.push(this.textures[b.albedo.specular.intensityTexture.id])))),b.roughness&&(b.roughness.texture&&(++d,this.textures[b.roughness.texture.id].addMaterial(b,["roughness","texture"]),b.textures.push(this.textures[b.roughness.texture.id])),
b.roughness.sheen&&(b.roughness.sheen.texture&&(++d,this.textures[b.roughness.sheen.texture.id].addMaterial(b,["roughness.sheen","texture"]),b.textures.push(this.textures[b.roughness.sheen.texture.id])),b.roughness.sheen.intensityTexture&&(++d,this.textures[b.roughness.sheen.intensityTexture.id].addMaterial(b,["roughness.sheen","intensityTexture"]),b.textures.push(this.textures[b.roughness.sheen.intensityTexture.id])),b.roughness.sheen.roughnessTexture&&(++d,this.textures[b.roughness.sheen.roughnessTexture.id].addMaterial(b,
["roughness.sheen","roughnessTexture"]),b.textures.push(this.textures[b.roughness.sheen.roughnessTexture.id])))),b.metalness&&(b.metalness.texture&&(++d,this.textures[b.metalness.texture.id].addMaterial(b,["metalness","texture"]),b.textures.push(this.textures[b.metalness.texture.id])),b.metalness.anisotropy&&(b.metalness.anisotropy.texture&&(++d,this.textures[b.metalness.anisotropy.texture.id].addMaterial(b,["metalness.anisotropy","texture"]),b.textures.push(this.textures[b.metalness.anisotropy.texture.id])),
b.metalness.anisotropy.intensityTexture&&(++d,this.textures[b.metalness.anisotropy.intensityTexture.id].addMaterial(b,["metalness.anisotropy","intensityTexture"]),b.textures.push(this.textures[b.metalness.anisotropy.intensityTexture.id])),b.metalness.anisotropy.roughnessTexture&&(++d,this.textures[b.metalness.anisotropy.roughnessTexture.id].addMaterial(b,["metalness.anisotropy","roughnessTexture"]),b.textures.push(this.textures[b.metalness.anisotropy.roughnessTexture.id])),b.metalness.anisotropy.rotationTexture&&
(++d,this.textures[b.metalness.anisotropy.rotationTexture.id].addMaterial(b,["metalness.anisotropy","rotationTexture"]),b.textures.push(this.textures[b.metalness.anisotropy.rotationTexture.id]))),b.metalness.carpaint&&(b.metalness.carpaint.brdfColorTexture&&(++d,this.textures[b.metalness.carpaint.brdfColorTexture.id].addMaterial(b,["metalness.carpaint","brdfColorTexture"]),b.textures.push(this.textures[b.metalness.carpaint.brdfColorTexture.id])),b.metalness.carpaint.flakesSliceLutTexture&&(++d,this.textures[b.metalness.carpaint.flakesSliceLutTexture.id].addMaterial(b,
["metalness.carpaint","flakesSliceLutTexture"]),b.textures.push(this.textures[b.metalness.carpaint.flakesSliceLutTexture.id])),b.metalness.carpaint.flakesColorTexture&&(++d,this.textures[b.metalness.carpaint.flakesColorTexture.id].addMaterial(b,["metalness.carpaint","flakesColorTexture"]),b.textures.push(this.textures[b.metalness.carpaint.flakesColorTexture.id])))),b.normalDeformation&&(b.normalDeformation.texture&&(++d,this.textures[b.normalDeformation.texture.id].addMaterial(b,["normalDeformation",
"texture"]),b.textures.push(this.textures[b.normalDeformation.texture.id]),b.normalDeformation.intensityTexture&&(++d,this.textures[b.normalDeformation.intensityTexture.id].addMaterial(b,["normalDeformation","intensityTexture"]),b.textures.push(this.textures[b.normalDeformation.intensityTexture.id]))),b.normalDeformation.texture2&&(++d,this.textures[b.normalDeformation.texture2.id].addMaterial(b,["normalDeformation","texture2"]),b.textures.push(this.textures[b.normalDeformation.texture2.id]),b.normalDeformation.intensityTexture2&&
(++d,this.textures[b.normalDeformation.intensityTexture2.id].addMaterial(b,["normalDeformation","intensityTexture2"]),b.textures.push(this.textures[b.normalDeformation.intensityTexture2.id])))),b.emissive&&(b.emissive.texture&&(++d,this.textures[b.emissive.texture.id].addMaterial(b,["emissive","texture"]),b.textures.push(this.textures[b.emissive.texture.id])),b.emissive.intensityTexture&&(++d,this.textures[b.emissive.intensityTexture.id].addMaterial(b,["emissive","intensityTexture"]),b.textures.push(this.textures[b.emissive.intensityTexture.id])),
b.emissive.glow&&(b.emissive.glow.colorTexture&&!b.emissive.glow.emissiveColor&&(++d,this.textures[b.emissive.glow.colorTexture.id].addMaterial(b,["emissive.glow","colorTexture"]),b.textures.push(this.textures[b.emissive.glow.colorTexture.id])),b.emissive.glow.opacityTexture&&(++d,this.textures[b.emissive.glow.opacityTexture.id].addMaterial(b,["emissive.glow","opacityTexture"]),b.textures.push(this.textures[b.emissive.glow.opacityTexture.id])),b.emissive.glow.saturationTexture&&(++d,this.textures[b.emissive.glow.saturationTexture.id].addMaterial(b,
["emissive.glow","saturationTexture"]),b.textures.push(this.textures[b.emissive.glow.saturationTexture.id])))),b.opacity&&(b.opacity.texture&&(++d,this.textures[b.opacity.texture.id].addMaterial(b,["opacity","texture"]),b.textures.push(this.textures[b.opacity.texture.id])),b.opacity.refraction&&b.opacity.refraction.textureCube&&(++d,this.texturesCube[b.opacity.refraction.textureCube.id].addMaterial(b,["opacity.refraction","textureCube"]),b.textures.push(this.texturesCube[b.opacity.refraction.textureCube.id]))),
b.translucency&&b.translucency.texture&&(++d,this.textures[b.translucency.texture.id].addMaterial(b,["translucency","texture"]),b.textures.push(this.textures[b.translucency.texture.id])),b.occlusion&&(b.occlusion.ambientTexture&&(++d,this.textures[b.occlusion.ambientTexture.id].addMaterial(b,["occlusion","ambientTexture"]),b.textures.push(this.textures[b.occlusion.ambientTexture.id])),b.occlusion.lightTexture&&(++d,this.textures[b.occlusion.lightTexture.id].addMaterial(b,["occlusion","lightTexture"]),
b.textures.push(this.textures[b.occlusion.lightTexture.id]))),b.localEnvironment&&b.localEnvironment.texture&&(++d,this.textures[b.localEnvironment.texture.id].addMaterial(b,["localEnvironment","texture"]),b.textures.push(this.textures[b.localEnvironment.texture.id])),b.iridescence&&b.iridescence.texture&&(++d,this.textures[b.iridescence.texture.id].addMaterial(b,["iridescence","texture"]),b.textures.push(this.textures[b.iridescence.texture.id])),b.coating&&(b.coating.intensityTexture&&(++d,this.textures[b.coating.intensityTexture.id].addMaterial(b,
["coating","intensityTexture"]),b.textures.push(this.textures[b.coating.intensityTexture.id])),b.coating.thicknessTexture&&(++d,this.textures[b.coating.thicknessTexture.id].addMaterial(b,["coating","thicknessTexture"]),b.textures.push(this.textures[b.coating.thicknessTexture.id])),b.coating.roughnessTexture&&(++d,this.textures[b.coating.roughnessTexture.id].addMaterial(b,["coating","roughnessTexture"]),b.textures.push(this.textures[b.coating.roughnessTexture.id])),b.coating.normalTexture&&(++d,this.textures[b.coating.normalTexture.id].addMaterial(b,
["coating","normalTexture"]),b.textures.push(this.textures[b.coating.normalTexture.id])))):(b.diffuse&&b.diffuse.texture&&(++d,this.textures[b.diffuse.texture.id].addMaterial(b,["diffuse","texture"]),b.textures.push(this.textures[b.diffuse.texture.id])),b.ambient&&b.ambient.texture&&!b.ambient.diffuseColor&&(++d,this.textures[b.ambient.texture.id].addMaterial(b,["ambient","texture"]),b.textures.push(this.textures[b.ambient.texture.id])),b.specular&&(b.specular.texture&&(++d,this.textures[b.specular.texture.id].addMaterial(b,
["specular","texture"]),b.textures.push(this.textures[b.specular.texture.id])),b.specular.intensityTexture&&(++d,this.textures[b.specular.intensityTexture.id].addMaterial(b,["specular","intensityTexture"]),b.textures.push(this.textures[b.specular.intensityTexture.id]))),b.emissive&&b.emissive.texture&&(++d,this.textures[b.emissive.texture.id].addMaterial(b,["emissive","texture"]),b.textures.push(this.textures[b.emissive.texture.id])),b.emissive&&b.emissive.intensityTexture&&(++d,this.textures[b.emissive.intensityTexture.id].addMaterial(b,
["emissive","intensityTexture"]),b.textures.push(this.textures[b.emissive.intensityTexture.id])),b.shininess&&b.shininess.texture&&(++d,this.textures[b.shininess.texture.id].addMaterial(b,["shininess","texture"]),b.textures.push(this.textures[b.shininess.texture.id])),b.normalDeformation&&b.normalDeformation.texture&&(++d,this.textures[b.normalDeformation.texture.id].addMaterial(b,["normalDeformation","texture"]),b.textures.push(this.textures[b.normalDeformation.texture.id])),b.normalDeformation&&
b.normalDeformation.scaleTexture&&(++d,this.textures[b.normalDeformation.scaleTexture.id].addMaterial(b,["normalDeformation","scaleTexture"]),b.textures.push(this.textures[b.normalDeformation.scaleTexture.id])),b.specularAnisotropic&&b.specularAnisotropic.texture&&(++d,this.textures[b.specularAnisotropic.texture.id].addMaterial(b,["specularAnisotropic","texture"]),b.textures.push(this.textures[b.specularAnisotropic.texture.id])),b.lightMap&&b.lightMap.texture&&(++d,this.textures[b.lightMap.texture.id].addMaterial(b,
["lightMap","texture"]),b.textures.push(this.textures[b.lightMap.texture.id])),b.lightMap&&b.lightMap.colorTexture&&(++d,this.textures[b.lightMap.colorTexture.id].addMaterial(b,["lightMap","colorTexture"]),b.textures.push(this.textures[b.lightMap.colorTexture.id])),b.opacity&&b.opacity.texture&&(++d,this.textures[b.opacity.texture.id].addMaterial(b,["opacity","texture"]),b.textures.push(this.textures[b.opacity.texture.id])),b.iridescent&&b.iridescent.texture&&(++d,this.textures[b.iridescent.texture.id].addMaterial(b,
["iridescent","texture"]),b.textures.push(this.textures[b.iridescent.texture.id]),b.iridescent.intensityTexture&&(++d,this.textures[b.iridescent.intensityTexture.id].addMaterial(b,["iridescent","intensityTexture"]),b.textures.push(this.textures[b.iridescent.intensityTexture.id]))),b.translucency&&b.translucency.texture&&(++d,this.textures[b.translucency.texture.id].addMaterial(b,["translucency","texture"]),b.textures.push(this.textures[b.translucency.texture.id])),b.glow&&b.glow.colorTexture&&(++d,
this.textures[b.glow.colorTexture.id].addMaterial(b,["glow","colorTexture"]),b.textures.push(this.textures[b.glow.colorTexture.id])),b.glow&&b.glow.opacityTexture&&(++d,this.textures[b.glow.opacityTexture.id].addMaterial(b,["glow","opacityTexture"]),b.textures.push(this.textures[b.glow.opacityTexture.id])),b.glow&&b.glow.saturationTexture&&(++d,this.textures[b.glow.saturationTexture.id].addMaterial(b,["glow","saturationTexture"]),b.textures.push(this.textures[b.glow.saturationTexture.id])),b.reflection&&
b.reflection.texture&&(++d,this.textures[b.reflection.texture.id].addMaterial(b,["reflection","texture"]),b.textures.push(this.textures[b.reflection.texture.id])),b.refraction&&b.refraction.texture&&(++d,this.textures[b.refraction.texture.id].addMaterial(b,["refraction","texture"]),b.textures.push(this.textures[b.refraction.texture.id])),b.reflection&&b.reflection.textureCube&&(++d,this.texturesCube[b.reflection.textureCube.id].addMaterial(b,["reflection","textureCube"]),b.textures.push(this.texturesCube[b.reflection.textureCube.id])),
b.refraction&&b.refraction.textureCube&&(++d,this.texturesCube[b.refraction.textureCube.id].addMaterial(b,["refraction","textureCube"]),b.textures.push(this.texturesCube[b.refraction.textureCube.id])));d>this.maxSimultaneousTextures&&(this.maxSimultaneousTextures=d)};B.prototype.getTexturesFromMaterial=function(b,d){var f=[];b.type?(b.albedo&&(b.albedo.texture&&(d?f.push({texture:b.albedo.texture,content:["albedo","texture"]}):f.push(b.albedo.texture)),b.albedo.specular&&(b.albedo.specular.texture&&
(d?f.push({texture:b.albedo.specular.texture,content:["albedo.specular","texture"]}):f.push(b.albedo.specular.texture)),b.albedo.specular.intensityTexture&&(d?f.push({texture:b.albedo.specular.intensityTexture,content:["albedo.specular","intensityTexture"]}):f.push(b.albedo.specular.intensityTexture)))),b.roughness&&(b.roughness.texture&&(d?f.push({texture:b.roughness.texture,content:["roughness","texture"]}):f.push(b.roughness.texture)),b.roughness.sheen&&(b.roughness.sheen.texture&&(d?f.push({texture:b.roughness.sheen.texture,
content:["roughness.sheen","texture"]}):f.push(b.roughness.sheen.texture)),b.roughness.sheen.intensityTexture&&(d?f.push({texture:b.roughness.sheen.intensityTexture,content:["roughness.sheen","intensityTexture"]}):f.push(b.roughness.sheen.intensityTexture)),b.roughness.sheen.roughnessTexture&&(d?f.push({texture:b.roughness.sheen.roughnessTexture,content:["roughness.sheen","roughnessTexture"]}):f.push(b.roughness.sheen.roughnessTexture)))),b.metalness&&(b.metalness.texture&&(d?f.push({texture:b.metalness.texture,
content:["metalness","texture"]}):f.push(b.metalness.texture)),b.metalness.anisotropy&&(b.metalness.anisotropy.texture&&(d?f.push({texture:b.metalness.anisotropy.texture,content:["metalness.anisotropy","texture"]}):f.push(b.metalness.anisotropy.texture)),b.metalness.anisotropy.intensityTexture&&(d?f.push({texture:b.metalness.anisotropy.intensityTexture,content:["metalness.anisotropy","intensityTexture"]}):f.push(b.metalness.anisotropy.intensityTexture)),b.metalness.anisotropy.roughnessTexture&&(d?
f.push({texture:b.metalness.anisotropy.roughnessTexture,content:["metalness.anisotropy","roughnessTexture"]}):f.push(b.metalness.anisotropy.roughnessTexture)),b.metalness.anisotropy.rotationTexture&&(d?f.push({texture:b.metalness.anisotropy.rotationTexture,content:["metalness.anisotropy","rotationTexture"]}):f.push(b.metalness.anisotropy.rotationTexture))),b.metalness.carpaint&&(b.metalness.carpaint.brdfColorTexture&&(d?f.push({texture:b.metalness.carpaint.brdfColorTexture,content:["metalness.carpaint",
"brdfColorTexture"]}):f.push(b.metalness.carpaint.brdfColorTexture)),b.metalness.carpaint.flakesSliceLutTexture&&(d?f.push({texture:b.metalness.carpaint.flakesSliceLutTexture,content:["metalness.carpaint","flakesSliceLutTexture"]}):f.push(b.metalness.carpaint.flakesSliceLutTexture)),b.metalness.carpaint.flakesColorTexture&&(d?f.push({texture:b.metalness.carpaint.flakesColorTexture,content:["metalness.carpaint","flakesColorTexture"]}):f.push(b.metalness.carpaint.flakesColorTexture)))),b.normalDeformation&&
(b.normalDeformation.texture&&(d?f.push({texture:b.normalDeformation.texture,content:["normalDeformation","texture"]}):f.push(b.normalDeformation.texture),b.normalDeformation.intensityTexture&&(d?f.push({texture:b.normalDeformation.intensityTexture,content:["normalDeformation","intensityTexture"]}):f.push(b.normalDeformation.intensityTexture))),b.normalDeformation.texture2&&(d?f.push({texture:b.normalDeformation.texture2,content:["normalDeformation","texture2"]}):f.push(b.normalDeformation.texture2),
b.normalDeformation.intensityTexture2&&(d?f.push({texture:b.normalDeformation.intensityTexture2,content:["normalDeformation","intensityTexture2"]}):f.push(b.normalDeformation.intensityTexture2)))),b.emissive&&(b.emissive.texture&&(d?f.push({texture:b.emissive.texture,content:["emissive","texture"]}):f.push(b.emissive.texture)),b.emissive.intensityTexture&&(d?f.push({texture:b.emissive.intensityTexture,content:["emissive","intensityTexture"]}):f.push(b.emissive.intensityTexture)),b.emissive.glow&&
(b.emissive.glow.colorTexture&&!b.emissive.glow.emissiveColor&&(d?f.push({texture:b.emissive.glow.colorTexture,content:["emissive.glow","colorTexture"]}):f.push(b.emissive.glow.colorTexture)),b.emissive.glow.opacityTexture&&(d?f.push({texture:b.emissive.glow.opacityTexture,content:["emissive.glow","opacityTexture"]}):f.push(b.emissive.glow.opacityTexture)),b.emissive.glow.saturationTexture&&(d?f.push({texture:b.emissive.glow.saturationTexture,content:["emissive.glow","saturationTexture"]}):f.push(b.emissive.glow.saturationTexture)))),
b.opacity&&(b.opacity.texture&&(d?f.push({texture:b.opacity.texture,content:["opacity","texture"]}):f.push(b.opacity.texture)),b.opacity.refraction&&b.opacity.refraction.textureCube&&(d?f.push({texture:this.texturesCube[b.opacity.refraction.textureCube.id],content:["opacity.refraction","textureCube"]}):f.push(this.texturesCube[b.opacity.refraction.textureCube.id]))),b.translucency&&b.translucency.texture&&(d?f.push({texture:b.translucency.texture,content:["translucency","texture"]}):f.push(b.translucency.texture)),
b.occlusion&&(b.occlusion.ambientTexture&&(d?f.push({texture:b.occlusion.ambientTexture,content:["occlusion","ambientTexture"]}):f.push(b.occlusion.ambientTexture)),b.occlusion.lightTexture&&(d?f.push({texture:b.occlusion.lightTexture,content:["occlusion","lightTexture"]}):f.push(b.occlusion.lightTexture))),b.localEnvironment&&b.localEnvironment.texture&&(d?f.push({texture:b.localEnvironment.texture,content:["localEnvironment","texture"]}):f.push(b.localEnvironment.texture)),b.iridescence&&b.iridescence.texture&&
(d?f.push({texture:b.iridescence.texture,content:["iridescence","texture"]}):f.push(b.iridescence.texture)),b.coating&&(b.coating.intensityTexture&&(d?f.push({texture:b.coating.intensityTexture,content:["coating","intensityTexture"]}):f.push(b.coating.intensityTexture)),b.coating.thicknessTexture&&(d?f.push({texture:b.coating.thicknessTexture,content:["coating","thicknessTexture"]}):f.push(b.coating.thicknessTexture)),b.coating.roughnessTexture&&(d?f.push({texture:b.coating.roughnessTexture,content:["coating",
"roughnessTexture"]}):f.push(b.coating.roughnessTexture)),b.coating.normalTexture&&(d?f.push({texture:b.coating.normalTexture,content:["coating","normalTexture"]}):f.push(b.coating.normalTexture)))):(b.diffuse&&b.diffuse.texture&&(d?f.push({texture:b.diffuse.texture,content:["diffuse","texture"]}):f.push(b.diffuse.texture)),b.ambient&&b.ambient.texture&&!b.ambient.diffuseColor&&(d?f.push({texture:b.ambient.texture,content:["ambient","texture"]}):f.push(b.ambient.texture)),b.specular&&b.specular.texture&&
(d?f.push({texture:b.specular.texture,content:["specular","texture"]}):f.push(b.specular.texture)),b.specular&&b.specular.intensityTexture&&(d?f.push({texture:b.specular.intensityTexture,content:["specular","intensityTexture"]}):f.push(b.specular.intensityTexture)),b.emissive&&b.emissive.texture&&(d?f.push({texture:b.emissive.texture,content:["emissive","texture"]}):f.push(b.emissive.texture)),b.emissive&&b.emissive.intensityTexture&&(d?f.push({texture:b.emissive.intensityTexture,content:["emissive",
"intensityTexture"]}):f.push(b.emissive.intensityTexture)),b.shininess&&b.shininess.texture&&(d?f.push({texture:b.shininess.texture,content:["shininess","texture"]}):f.push(b.shininess.texture)),b.normalDeformation&&b.normalDeformation.texture&&(d?f.push({texture:b.normalDeformation.texture,content:["normalDeformation","texture"]}):f.push(b.normalDeformation.texture)),b.normalDeformation&&b.normalDeformation.scaleTexture&&(d?f.push({texture:b.normalDeformation.scaleTexture,content:["normalDeformation",
"scaleTexture"]}):f.push(b.normalDeformation.scaleTexture)),b.specularAnisotropic&&b.specularAnisotropic.texture&&(d?f.push({texture:b.specularAnisotropic.texture,content:["specularAnisotropic","texture"]}):f.push(b.specularAnisotropic.texture)),b.lightMap&&b.lightMap.texture&&(d?f.push({texture:b.lightMap.texture,content:["lightMap","texture"]}):f.push(b.lightMap.texture)),b.lightMap&&b.lightMap.colorTexture&&(d?f.push({texture:b.lightMap.colorTexture,content:["lightMap","colorTexture"]}):f.push(b.lightMap.colorTexture)),
b.opacity&&b.opacity.texture&&(d?f.push({texture:b.opacity.texture,content:["opacity","texture"]}):f.push(b.opacity.texture)),b.iridescent&&b.iridescent.texture&&(d?f.push({texture:b.iridescent.texture,content:["iridescent","texture"]}):f.push(b.iridescent.texture)),b.iridescent&&b.iridescent.intensityTexture&&(d?f.push({texture:b.iridescent.intensityTexture,content:["iridescent","intensityTexture"]}):f.push(b.iridescent.intensityTexture)),b.translucency&&b.translucency.texture&&(d?f.push({texture:b.translucency.texture,
content:["translucency","texture"]}):f.push(b.translucency.texture)),b.glow&&b.glow.colorTexture&&(d?f.push({texture:b.glow.colorTexture,content:["glow","colorTexture"]}):f.push(b.glow.colorTexture)),b.glow&&b.glow.opacityTexture&&(d?f.push({texture:b.glow.opacityTexture,content:["glow","opacityTexture"]}):f.push(b.glow.opacityTexture)),b.glow&&b.glow.saturationTexture&&(d?f.push({texture:b.glow.saturationTexture,content:["glow","saturationTexture"]}):f.push(b.glow.saturationTexture)),b.reflection&&
b.reflection.texture&&(d?f.push({texture:b.reflection.texture,content:["reflection","texture"]}):f.push(b.reflection.texture)),b.refraction&&b.refraction.texture&&(d?f.push({texture:b.refraction.texture,content:["refraction","texture"]}):f.push(b.refraction.texture)),b.reflection&&b.reflection.textureCube&&(d?f.push({texture:this.texturesCube[b.reflection.textureCube.id],content:["reflection","textureCube"]}):f.push(this.texturesCube[b.reflection.textureCube.id])),b.refraction&&b.refraction.textureCube&&
(d?f.push({texture:this.texturesCube[b.refraction.textureCube.id],content:["refraction","textureCube"]}):f.push(this.texturesCube[b.refraction.textureCube.id])));return f};B.prototype.updateMaterialLoading=function(d){b&&(d.polylists.length?this.loadMaterial(d):this.unloadMaterial(d))};B.prototype.loadMaterial=function(b){b.loaded||(H.call(this,b,"load"),b.loaded=!0)};B.prototype.unloadMaterial=function(b){b.loaded&&(H.call(this,b,"unload"),b.loaded=!1)};var H=function(b,d){for(var f in b.textures)b.textures[f][d+
"Images"](b)};B.prototype.checkMaterial=function(b){var d=!0;b=this.getTexturesFromMaterial(b);for(var f=0;f<b.length;++f)d=d&&b[f].isDownloaded();return d};B.prototype.findTextureMaterial=function(b){for(var d in this.scene.materials)for(var f=this.scene.materials[d],e=this.getTexturesFromMaterial(f,!0),g=0;g<e.length;++g)if(e[g].texture.id==b)return{material:f,content:e[g].content};return null};return B});stage.provide("emersya.viewer.modules.renderer.meshesManager");
stage.register.call(stage.emersya.viewer.modules.renderer,"meshesManager",function(){var b,d=function(d){b=d;this.uvsCount=this.maxTextureSize=0;this.lastNodeDrawn=null;this.maxTexturesToRenderSimultaneously=0;this.maxVertexBufferSize=65E3;this.ditherDivisor=3};d.prototype.destroy=function(){this.cubeVBuffer&&(b.deleteBuffer(this.cubeVBuffer),b.deleteBuffer(this.cubeIBuffer),this.cubeIBuffer=this.cubeVBuffer=null);b=this.lastNodeDrawn=null};d.prototype.deallocateScene=function(b){if(b){for(var d in b.geometries){var g=
b.geometries[d];g.vertexBuffers&&g.vertexBuffers.length&&this.deallocateGeometry(g)}for(d in b.polylists){var k=b.polylists[d];(g=k.geometry)&&g.vertexBuffers&&g.vertexBuffers.length&&this.deallocateGeometry(g);this.deallocatePolylist(k)}}};d.prototype.deallocateGeometry=function(d){for(var f in d.vertexBuffers)if(b.deleteBuffer(d.vertexBuffers[f]),b.deleteBuffer(d.normalBuffers[f]),d.uvBuffers[f])for(var g in d.uvBuffers[f])b.deleteBuffer(d.uvBuffers[f][g]),b.deleteBuffer(d.tangentBuffers[f][g]);
d.vertexBuffers=null;d.normalBuffers=null;d.colorBuffers=null;d.uvBuffers=null;d.tangentBuffers=null;d.loaded=!1};d.prototype.deallocatePolylist=function(d){d.ditherIndexBuffers&&d.ditherIndexBuffers.forEach(function(d){d.forEach(function(d){d&&b.deleteBuffer(d.buffer)})});for(var f in d.indexBuffers)b.deleteBuffer(d.indexBuffers[f]);d.ditherIndexBuffers=null;d.indexBuffers=null;d.elementTypes=null;if(stage.emersya.viewer.modules.renderer.lightsEditor){if(d.edgesBuffers){for(f in d.indexBuffers)b.deleteBuffer(d.edgesBuffers[f]);
d.edgesBuffers=null}for(f in d.indexLineBufs)b.deleteBuffer(d.indexLineBufs[f]);d.indexLineBufs=null}d.loaded=!1};d.prototype.moveSelectedNodes=function(b,d){if(!vec3.length(d))return[];for(var f=[b.root],g=[],k=0;k<f.length;++k)if(f[k].selected){var l=mat4.toRotationMat(b.computeTransfMatrix(f[k]));l=mat4.multiplyVec3(mat4.inverse(l,mat4.create()),d,vec3.create());l=mat4.translate(mat4.identity(mat4.create()),l);mat4.multiply(f[k].matrix,l);mat4.multiply(f[k].modelMatrix,l);mat4.toInverseMat3(f[k].modelMatrix,
f[k].normalModelMatrix);mat3.transpose(f[k].normalModelMatrix);g.push(f[k]);for(l=0;l<f[k].children.length;++l)b.recursiveComputeMatrices(f[k].children[l],f[k].modelMatrix);b.updateBoundingBoxesFromNode(f[k],d)}else for(l=0;l<f[k].children.length;++l)f.push(f[k].children[l]);return g};d.prototype.loadPolylistBuffers=function(d){var f=d.geometry;if(d.loaded){d.instances.length||this.deallocatePolylist(d);d=!0;for(var g=0;g<f.polylists.length;++g)d&=!f.polylists[g].loaded;d&&this.deallocateGeometry(f)}else if(d.instances.length){var k=
!1;for(g=0;!k&&g<f.dataBuffers.length;++g)k|=f.dataBuffers[g].nbVertices>this.maxVertexBufferSize;if(k&&!b.webgl2&&!b.oeselementindexuint){k=d.geometry;var l=[];g=[];for(var q=0;q<k.dataBuffers.length;++q){var r=k.dataBuffers[q],t=d.list[q];if(r.nbVertices>=this.maxVertexBufferSize){for(var e=[],u=[],F=[],p={dataBuffers:[],polylistLists:[]},m=new Uint8Array(t.length),h=t.length,v=r.polySize,I=0;0<h;++I){var J=new Uint16Array(r.nbVertices);e[I]=[];u[I]=[];for(var M=0;e[I].length<this.maxVertexBufferSize&&
M<t.length;++M)if(!m[t[M]]){for(var T=0;T<v;++T)J[r.faces[v*t[M]+T]]||(J[r.faces[v*t[M]+T]]=e[I].length+1,e[I].push(r.faces[v*t[M]+T])),u[I].push(J[r.faces[v*t[M]+T]]-1);m[t[M]]=1;--h}for(;M<t.length;++M)if(!m[t[M]]){var U=[];for(T=0;T<v&&J[r.faces[v*t[M]+T]];++T)U.push(J[r.faces[v*t[M]+T]]-1);if(U.length==v){for(T=0;T<v;++T)u[I].push(U[T]);m[t[M]]=1;--h}}F[I]=u[I].length/v}for(I=0;I<e.length;++I){m=new Float32Array(3*e[I].length);h=new Float32Array(3*e[I].length);J={};for(T=0;T<e[I].length;++T){U=
3*T;var R=3*e[I][T];m[U+0]=r.vertices[R+0];m[U+1]=r.vertices[R+1];m[U+2]=r.vertices[R+2];h[U+0]=r.normals[R+0];h[U+1]=r.normals[R+1];h[U+2]=r.normals[R+2]}if(r.uvs)for(M in r.uvs)for(U=new Float32Array(2*e[I].length),new Float32Array(3*e[I].length),J[M]=U,T=0;T<e[I].length;++T){R=2*T;var aa=2*e[I][T];U[R+0]=r.uvs[M][aa+0];U[R+1]=r.uvs[M][aa+1]}U=new Uint16Array(F[I]*v);R=[];for(M=0;M<F[I];++M){for(T=0;T<v;T++)U[v*M+T]=u[I][v*M+T];R.push(M)}p.dataBuffers.push({nbVertices:e[I].length,nbFaces:F[I],polySize:v,
vertices:m,faces:U,normals:h,uvs:J,tangents:{}});p.polylistLists.push(R)}delete r;delete t;r=p;l=l.concat(r.dataBuffers);g=g.concat(r.polylistLists)}else l.push(r),g.push(t)}delete k.dataBuffers;delete d.list;k.dataBuffers=l;d.list=g}if(!f.loaded)if(f.loaded)console.warn("Geometry "+f.id+" buffers already loaded.");else{if(f.dataBuffers.length){M=!1;for(var C in f.dataBuffers[0].uvs){M=!0;break}if(!M)for(C=0;C<f.dataBuffers.length;++C)delete f.dataBuffers[C].uvs;f.vertexBuffers=[];f.normalBuffers=
[];f.uvBuffers=[];f.tangentBuffers=[];for(M=0;M<f.dataBuffers.length;++M){k=f.dataBuffers[M];l=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,l);b.bufferData(b.ARRAY_BUFFER,k.vertices,b.STATIC_DRAW);g=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,g);b.bufferData(b.ARRAY_BUFFER,k.normals,b.STATIC_DRAW);q={};r={};t=0;if(k.uvs){for(C in k.uvs){++t;q[C]=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,q[C]);b.bufferData(b.ARRAY_BUFFER,k.uvs[C],b.STATIC_DRAW);e=k.tangents;u=C;v=k;I=C;if(v.uvs&&v.uvs[I]){F=new Float32Array(v.normals.length);
for(p=0;p<F.length;++p)F[p]=0;T=vec3.create();m=vec3.create();h=vec3.create();J=vec3.create();U=vec3.create();R=vec3.create();aa=vec3.create();var L=vec3.create(),K=vec3.create(),G=vec3.create(),S=vec3.create();for(p=0;p<v.faces.length;p+=v.polySize){var Y=3*v.faces[p];var ia=3*v.faces[p+1];var Q=2>=v.polySize?ia:3*v.faces[p+2];var ta=2*v.faces[p];var ua=2*v.faces[p+1];var ea=2>=v.polySize?ua:2*v.faces[p+2];T[0]=v.vertices[Y];T[1]=v.vertices[Y+1];T[2]=v.vertices[Y+2];m[0]=v.vertices[ia];m[1]=v.vertices[ia+
1];m[2]=v.vertices[ia+2];h[0]=v.vertices[Q];h[1]=v.vertices[Q+1];h[2]=v.vertices[Q+2];J[0]=m[0]-T[0];J[1]=m[1]-T[1];J[2]=m[2]-T[2];U[0]=h[0]-T[0];U[1]=h[1]-T[1];U[2]=h[2]-T[2];L[0]=v.uvs[I][ta];L[1]=v.uvs[I][ta+1];K[0]=v.uvs[I][ua];K[1]=v.uvs[I][ua+1];G[0]=v.uvs[I][ea];G[1]=v.uvs[I][ea+1];R[0]=K[0]-L[0];R[1]=K[1]-L[1];R[2]=K[2]-L[2];aa[0]=G[0]-L[0];aa[1]=G[1]-L[1];aa[2]=G[2]-L[2];ea=R[0]*aa[1]-R[1]*aa[0];0!=ea?(ea=1/ea,S[0]=ea*(J[0]*aa[1]+U[0]*-R[1]),S[1]=ea*(J[1]*aa[1]+U[1]*-R[1]),S[2]=ea*(J[2]*
aa[1]+U[2]*-R[1])):(S[0]=1,S[1]=0,S[2]=0);for(ea=0;ea<v.polySize;++ea)ua=3*v.faces[p+ea],F[ua]+=S[0],F[ua+1]+=S[1],F[ua+2]+=S[2]}v=vec3.create();for(p=0;p<F.length;p+=3)v[0]=F[p],v[1]=F[p+1],v[2]=F[p+2],vec3.normalize(v),F[p]=v[0],F[p+1]=v[1],F[p+2]=v[2]}else F=void 0;e[u]=F;r[C]=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,r[C]);b.bufferData(b.ARRAY_BUFFER,k.tangents[C],b.STATIC_DRAW)}f.uvBuffers.push(q);f.tangentBuffers.push(r)}this.uvsCount=Math.max(this.uvsCount,t);f.vertexBuffers.push(l);f.normalBuffers.push(g)}}else console.warn("loaded empty geometry "+
f.id);f.loaded=!0}d.indexBuffers=[];d.realFaceCount=[];d.elementTypes=[];d.edges?(d.edgesBuffers=[],d.edgeCount=[]):(d.edgesBuffers=null,d.edgeCount=null);d.indexLineBufs=[];d.indexLBufSize=[];for(f=0;f<d.list.length;++f){C=d.list[f];M=d.geometry.dataBuffers[f];q=d.edges[f];k=Uint16Array;d.elementTypes.push(b.UNSIGNED_SHORT);256>M.nbVertices?(d.elementTypes[f]=b.UNSIGNED_BYTE,k=Uint8Array):(b.webgl2||b.oeselementindexuint)&&M.nbVertices>this.maxVertexBufferSize&&(d.elementTypes[f]=b.UNSIGNED_INT,
k=Uint32Array);g=[];l=M.polySize;r=b.createBuffer();b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,r);if(2==l){g=new k(2*C.length);for(t=0;t<C.length;++t)e=2*t,u=2*C[t],g[e]=M.faces[u],g[e+1]=M.faces[u+1];b.bufferData(b.ELEMENT_ARRAY_BUFFER,g,b.STATIC_DRAW);d.realFaceCount.push(C.length)}else{for(t=0;t<C.length;++t)for(e=l*C[t],u=1;u<l-1;++u)M.faces[e+u]!=M.faces[e+u+1]&&(g.push(M.faces[e]),g.push(M.faces[e+u]),g.push(M.faces[e+u+1]));b.bufferData(b.ELEMENT_ARRAY_BUFFER,new k(g),b.STATIC_DRAW);d.realFaceCount.push(g.length/
3)}d.indexBuffers.push(r);if(stage.emersya.viewer.modules.renderer.lightsEditor){if(q){r=new k(q.length);for(g=0;g<q.length;++g)r[g]=q[g];g=b.createBuffer();b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,g);b.bufferData(b.ELEMENT_ARRAY_BUFFER,r,b.STATIC_DRAW);d.edgesBuffers.push(g);d.edgeCount.push(r.length/2)}q=b.createBuffer();b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,q);if(2==l){r=new k(2*C.length);for(g=0;g<C.length;++g)k=2*g,l=2*C[g],r[k]=M.faces[l],r[k+1]=M.faces[l+1];b.bufferData(b.ELEMENT_ARRAY_BUFFER,r,b.STATIC_DRAW);
d.indexLBufSize.push(2*C.length)}else{r=[];for(g=0;g<C.length;++g){t=l*C[g];for(e=0;e<l-1;++e)M.faces[t+e]!=M.faces[t+e+1]&&(r.push(M.faces[t+e]),r.push(M.faces[t+e+1]));r.push(M.faces[t]);r.push(M.faces[t+l-1])}b.bufferData(b.ELEMENT_ARRAY_BUFFER,new k(r),b.STATIC_DRAW);d.indexLBufSize.push(r.length)}d.indexLineBufs.push(q)}}d.loaded=!0}};var u=function(d){d.ditherIndexBuffers&&d.ditherIndexBuffers.length&&d.ditherIndexBuffers[0].length!=this.ditherDivisor&&(d.ditherIndexBuffers.forEach(function(d){d.forEach(function(d){d&&
b.deleteBuffer(d.buffer)})}),delete d.ditherIndexBuffers);if(1>=this.ditherDivisor)return!1;if(!d.ditherIndexBuffers){d.ditherIndexBuffers=[];for(var f=0;f<d.list.length;++f){var g=d.list[f],k=d.geometry.dataBuffers[f],l=k.polySize,q=Uint16Array;d.elementTypes[f]===b.UNSIGNED_BYTE?q=Uint8Array:d.elementTypes[f]===b.UNSIGNED_INT&&(q=Uint32Array);var r=Array(this.ditherDivisor).fill(0).map(function(){return[]}),t=0,e=Math.ceil(g.length/this.ditherDivisor);g=Array.from(g);for(var u=g.length,F=0,p;u;)if(F++==
e&&(t+=1,F=0),p=Math.floor(Math.random()*u--),p=l*g.splice(p,1)[0],2==l)r[t].push(k.faces[p]),r[t].push(k.faces[p+1]);else for(var m=1;m<l-1;++m)k.faces[p+m]!=k.faces[p+m+1]&&(r[t].push(k.faces[p]),r[t].push(k.faces[p+m]),r[t].push(k.faces[p+m+1]));var h=[];r.forEach(function(d){var f=b.createBuffer();b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,f);b.bufferData(b.ELEMENT_ARRAY_BUFFER,new q(d),b.STATIC_DRAW);h.push({buffer:f,size:d.length})});d.ditherIndexBuffers.push(h)}}return!0};d.prototype.loadConvexHullBuffers=
function(d,f){if(d.loaded)console.warn("Geometry "+d.id+" buffers already loaded.");else if(d.dataBuffers.length){d.vertexBuffers=[];d.normalBuffers=[];d.uvBuffers=[];d.tangentBuffers=[];f.indexBuffers=[];f.realFaceCount=[];f.list=[];f.elementTypes=[];for(var g=vec3.create(),k=vec3.create(),l=vec3.create(),q=vec3.create(),r=vec3.create(),t=0;t<d.dataBuffers.length;++t){var e=d.dataBuffers[t];delete e.uvs;for(var u=0;u<e.nbFaces;++u){var F=e.polySize*u;k[0]=e.vertices[3*e.faces[F]];k[1]=e.vertices[3*
e.faces[F]+1];k[2]=e.vertices[3*e.faces[F]+2];++F;l[0]=e.vertices[3*e.faces[F]];l[1]=e.vertices[3*e.faces[F]+1];l[2]=e.vertices[3*e.faces[F]+2];++F;q[0]=e.vertices[3*e.faces[F]];q[1]=e.vertices[3*e.faces[F]+1];q[2]=e.vertices[3*e.faces[F]+2];vec3.subtract(k,q,r);vec3.subtract(q,l);vec3.subtract(l,k);var p=vec3.length(l),m=vec3.length(q),h=vec3.length(r),v=.5*(p+m+h);g=vec3.scale(vec3.normalize(vec3.cross(l,k,g)),Math.sqrt(v*(v-p)*(v-m)*(v-h)));e.normals[3*e.faces[F]]+=g[0];e.normals[3*e.faces[F]+
1]+=g[1];e.normals[3*e.faces[F]+2]+=g[2];--F;e.normals[3*e.faces[F]]+=g[0];e.normals[3*e.faces[F]+1]+=g[1];e.normals[3*e.faces[F]+2]+=g[2];--F;e.normals[3*e.faces[F]]+=g[0];e.normals[3*e.faces[F]+1]+=g[1];e.normals[3*e.faces[F]+2]+=g[2]}for(u=0;u<e.nbVertices;++u)g[0]=e.normals[3*u],g[1]=e.normals[3*u+1],g[2]=e.normals[3*u+2],vec3.normalize(g),e.normals[3*u]=g[0],e.normals[3*u+1]=g[1],e.normals[3*u+2]=g[2];u=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,u);b.bufferData(b.ARRAY_BUFFER,e.vertices,b.STATIC_DRAW);
F=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,F);b.bufferData(b.ARRAY_BUFFER,e.normals,b.STATIC_DRAW);d.vertexBuffers.push(u);d.normalBuffers.push(F);f.list[t]=[];F=new Uint16Array(3*e.nbFaces);for(u=0;u<e.nbFaces;++u)F[3*u]=e.faces[3*u],F[3*u+1]=e.faces[3*u+1],F[3*u+2]=e.faces[3*u+2],f.list[t].push(u);f.elementTypes.push(b.UNSIGNED_SHORT);e=b.createBuffer();b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,e);b.bufferData(b.ELEMENT_ARRAY_BUFFER,F,b.STATIC_DRAW);f.indexBuffers.push(e);f.realFaceCount.push(F.length/
3)}d.loaded=!0;f.loaded=!0}else console.warn("loaded empty geometry "+d.id),d.loaded=!0};d.prototype.createProductNodeInstanceRigidBody=function(b,d){if(!d.rigidBody){var f=d.boundingBoxWithoutNodes||d.boundingBox;var g=f.center;var k=[new CANNON.Vec3(f.minX-g[0],f.minY-g[1],f.minZ-g[2]),new CANNON.Vec3(f.maxX-g[0],f.minY-g[1],f.minZ-g[2]),new CANNON.Vec3(f.maxX-g[0],f.maxY-g[1],f.minZ-g[2]),new CANNON.Vec3(f.minX-g[0],f.maxY-g[1],f.minZ-g[2]),new CANNON.Vec3(f.minX-g[0],f.minY-g[1],f.maxZ-g[2]),
new CANNON.Vec3(f.maxX-g[0],f.minY-g[1],f.maxZ-g[2]),new CANNON.Vec3(f.maxX-g[0],f.maxY-g[1],f.maxZ-g[2]),new CANNON.Vec3(f.minX-g[0],f.maxY-g[1],f.maxZ-g[2])];d.snapBoundingBox=b.copyBoundingBox(f);for(f=0;f<d.snapBoundingBox.vecs.length;++f)vec3.subtract(d.snapBoundingBox.vecs[f],g);d.transformedSnapBoundingBox=b.copyBoundingBox(d.snapBoundingBox);d.fullyTransformedSnapBoundingBox=b.copyBoundingBox(d.snapBoundingBox);k=new CANNON.Body({mass:1,position:new CANNON.Vec3(g[0],g[1],g[2]),material:b.physics.slipperyMaterial,
shape:new CANNON.ConvexPolyhedron(k,[[3,2,1,0],[4,5,6,7],[5,4,0,1],[2,3,7,6],[0,4,7,3],[1,2,6,5]])});k.fixedRotation=!0;k.type=CANNON.Body.STATIC;k.updateMassProperties();k.emersyaOffset=vec3.create(g);b.physics.world.addBody(k);k.collisionFilterGroup=1;k.collisionFilterMask=1048575;d.rigidBody=k;k.pnInstance=d;return k}};var k=function(d,f){var g=f.polylist,k=g.geometry;g.facesOrientation?b.frontFace(b.CCW):b.frontFace(b.CW);g.doubleSided?b.disable(b.CULL_FACE):b.enable(b.CULL_FACE);b.polygonOffset(g.polygonOffsetFactor+
d.currentPolygonOffsetFactor,g.polygonOffsetUnits+1+d.currentPolygonOffsetUnits);for(var l=0;l<k.vertexBuffers.length;++l){b.bindBuffer(b.ARRAY_BUFFER,k.vertexBuffers[l]);b.vertexAttribPointer(d.locations.ymaxekn,3,b.FLOAT,!1,0,0);b.bindBuffer(b.ARRAY_BUFFER,k.normalBuffers[l]);b.vertexAttribPointer(d.locations.pcgewnw,3,b.FLOAT,!1,0,0);if(f.uvIndexToId.length)for(var q=0;q<f.uvIndexToId.length;++q){var r=f.uvIndexToId[q];b.enableVertexAttribArray(d.locations.aVertexTangent[q]);b.enableVertexAttribArray(d.locations.aUv[q]);
b.bindBuffer(b.ARRAY_BUFFER,k.tangentBuffers[l][r]);b.vertexAttribPointer(d.locations.aVertexTangent[q],3,b.FLOAT,!1,0,0);b.bindBuffer(b.ARRAY_BUFFER,k.uvBuffers[l][r]);b.vertexAttribPointer(d.locations.aUv[q],2,b.FLOAT,!1,0,0)}for(q=f.uvIndexToId.length;q<this.uvsCount;++q)b.disableVertexAttribArray(d.locations.aVertexTangent[q]),b.disableVertexAttribArray(d.locations.aUv[q]);var t=2==k.dataBuffers[l].polySize?b.LINES:b.TRIANGLES;r=2==k.dataBuffers[l].polySize?2:3;var e=g.elementTypes[l];if(f.glInstancedCount&&
1<f.glInstancedCount)if(b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,g.indexBuffers[l]),d.locations.zjxvzlh&&b.uniform1f(d.locations.zjxvzlh,f.glInstancedCount),b.webgl2)b.drawElementsInstanced(t,g.realFaceCount[l]*r,e,0,f.glInstancedCount);else for(q=0;q<f.glInstancedCount;q++)b.uniform1i(d.locations.gbhvszb,q),b.drawElements(t,g.realFaceCount[l]*r,e,0);else q=f.matAnim.getCurrentMaterial().opacity,q.blending==stage.emersya.viewer.BLENDING_MODE.DITHER&&!q.firstFacesOnly&&d.alignDither&&u.call(this,g)?g.ditherIndexBuffers[l].forEach(function(f){f&&
(b.uniform1i(d.locations.hjqcbro,++d.ditherOffset),b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,f.buffer),b.drawElements(t,f.size,e,0))}):(b.uniform1i(d.locations.hjqcbro,q.blending==stage.emersya.viewer.BLENDING_MODE.DITHER&&q.firstFacesOnly?1:0),b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,g.indexBuffers[l]),b.drawElements(t,g.realFaceCount[l]*r,e,0))}b.frontFace(b.CCW)},l=function(d,f){if(f!==this.lastNodeDrawn){b.uniformMatrix4fv(d.locations.ondssmn,!1,f.modelMatrix);d.locations.nplkqwh&&b.uniformMatrix3fv(d.locations.nplkqwh,
!1,f.invModelMatrix3);mat4.multiply(d.viewMatrix,f.modelMatrix,f.normalModelMatrixMat4);mat4.toInverseMat3(f.normalModelMatrixMat4,f.normalModelViewMatrix);mat3.transpose(f.normalModelViewMatrix);b.uniformMatrix3fv(d.locations.dcsphyk,!1,f.normalModelViewMatrix);b.uniformMatrix3fv(d.locations.ccpxoqv,!1,f.normalModelMatrix);var g=mat3.create();mat4.toMat3(f.modelMatrix,g);mat3.transpose(g);b.uniformMatrix3fv(d.locations.itcyfdm,!1,g);this.lastNodeDrawn=f}};d.prototype.render=function(d,f,g,q,t){var n=
g.polylist;2==n.geometry.polySize||g.isHidden()||(g.matAnim.loadToShader(b,d,q),null!==f.lights.IBL&&f.lights.IBL.texture.isReady()&&(b.uniform1i(d.locations.isyrtjm,f.lights.IBL.texture.loadToShader(d)),b.uniform1f(d.locations.deijscq,f.lights.IBL.disabled?0:f.lights.IBL.intensity),b.uniform1i(d.locations.qwgzgln,f.lights.IBL.relativeToCamera)),f=g.node,b.uniform1i(d.locations.atutpxf,(t&&g.highlighted)+0),l.call(this,d,f),t=g.matAnim.getCurrentMaterial().opacity,t.blending==stage.emersya.viewer.BLENDING_MODE.DITHER&&
!t.firstFacesOnly&&d.alignDither&&d.alignDitherOpcityFactor&&u.call(this,n)?b.uniform1f(d.locations.bzmstcf,g.matAnim.getCurrentOpacity()*d.alignDitherOpcityFactor*f.opacity):b.uniform1f(d.locations.bzmstcf,g.matAnim.getCurrentOpacity()*f.opacity),g.matAnim.nextMaterial&&b.uniform1f(d.locations.bzmstcf2,g.matAnim.getNextOpacity()*f.opacity),g.matAnim.loadRefractionCubeMap(f,b,d,q),g.occluder?(b.depthFunc(b.LEQUAL),k.call(this,d,g),b.depthFunc(b.LESS)):g.matAnim.preDepthPass()?(b.colorMask(!1,!1,!1,
!1),k.call(this,d,g),b.colorMask(!0,!0,!0,!0),b.depthFunc(b.EQUAL),k.call(this,d,g),b.depthFunc(b.LESS)):k.call(this,d,g))};d.prototype.renderGlow=function(d,f){var g=f.matAnim;if(f.node.opacity&&!f.isHidden()){var l=g.currentMaterial,q=g.nextMaterial,t=l.type?l.emissive?l.emissive.glow:null:l.glow,r=q?q.type?q.emissive?q.emissive.glow:null:q.glow:null;if(t||r){d.textureCount=0;if(t){var u=t.emissiveColor?l.emissive.color:t.color;b.uniform4f(d.locations.srrtdcb,u[0],u[1],u[2],t.opacity);b.uniform2f(d.locations.zpfazci,
t.size,t.size);b.uniform1f(d.locations.zsumzby,t.saturation);(u=t.emissiveColor?l.emissive.texture:t.colorTexture)?u.isReady()?(b.uniform1i(d.locations.caimcpz,1),b.uniform1i(d.locations.mykylct,u.loadToShader(d,d.locations.stvhgye,d.locations.zmhuzxk))):b.uniform1i(d.locations.caimcpz,0):b.uniform1i(d.locations.caimcpz,0);t.opacityTexture?t.opacityTexture.isReady()?(b.uniform1i(d.locations.bbkmoxx,1),b.uniform1i(d.locations.bxddaze,t.opacityTexture.loadToShader(d,d.locations.fpbhqqe,d.locations.avbfhlu))):
b.uniform1i(d.locations.bbkmoxx,0):b.uniform1i(d.locations.bbkmoxx,0);t.saturationTexture?t.saturationTexture.isReady()?(b.uniform1i(d.locations.mzellvq,1),b.uniform1i(d.locations.rqffkvz,t.saturationTexture.loadToShader(d,d.locations.olldgtl,d.locations.afixdea))):b.uniform1i(d.locations.mzellvq,0):b.uniform1i(d.locations.mzellvq,0)}else b.uniform4f(d.locations.srrtdcb,0,0,0,0),b.uniform1i(d.locations.caimcpz,0),b.uniform1i(d.locations.bbkmoxx,0),b.uniform2f(d.locations.zpfazci,1,1),b.uniform1f(d.locations.zsumzby,
1);q?(g=g.getAppliedScale(),b.uniform1f(d.locations.heftokz,g),r?(u=r.emissiveColor?q.emissive.color:r.color,b.uniform4f(d.locations.srrtdcb2,u[0],u[1],u[2],r.opacity),b.uniform2f(d.locations.zpfazci2,r.size,r.size),b.uniform1f(d.locations.zsumzby2,r.saturation),(u=r.emissiveColor?q.emissive.texture:r.colorTexture)?u.isReady()?(b.uniform1i(d.locations.caimcpz2,1),b.uniform1i(d.locations.mykylct2,u.loadToShader(d,d.locations.stvhgye2,d.locations.zmhuzxk2))):b.uniform1i(d.locations.caimcpz2,0):b.uniform1i(d.locations.caimcpz2,
0),r.opacityTexture?r.opacityTexture.isReady()?(b.uniform1i(d.locations.bbkmoxx2,1),b.uniform1i(d.locations.bxddaze2,r.opacityTexture.loadToShader(d,d.locations.fpbhqqe2,d.locations.avbfhlu2))):b.uniform1i(d.locations.bbkmoxx2,0):b.uniform1i(d.locations.bbkmoxx2,0),r.saturationTexture?r.saturationTexture.isReady()?(b.uniform1i(d.locations.mzellvq2,1),b.uniform1i(d.locations.rqffkvz2,r.saturationTexture.loadToShader(d,d.locations.olldgtl2,d.locations.afixdea2))):b.uniform1i(d.locations.mzellvq2,0):
b.uniform1i(d.locations.mzellvq2,0)):t?(u=t.emissiveColor?l.emissive.color:t.color,b.uniform4f(d.locations.srrtdcb2,u[0],u[1],u[2],0),b.uniform2f(d.locations.zpfazci2,t.size,t.size),b.uniform1f(d.locations.zsumzby2,t.saturation),(u=t.emissiveColor?l.emissive.texture:t.colorTexture)?u.isReady()?(b.uniform1i(d.locations.caimcpz2,1),b.uniform1i(d.locations.mykylct2,u.loadToShader(d,d.locations.stvhgye2,d.locations.zmhuzxk2))):b.uniform1i(d.locations.caimcpz2,0):b.uniform1i(d.locations.caimcpz2,0),t.opacityTexture?
t.opacityTexture.isReady()?(b.uniform1i(d.locations.bbkmoxx2,1),b.uniform1i(d.locations.bxddaze2,t.opacityTexture.loadToShader(d,d.locations.fpbhqqe2,d.locations.avbfhlu2))):b.uniform1i(d.locations.bbkmoxx2,0):b.uniform1i(d.locations.bbkmoxx2,0),t.saturationTexture?t.saturationTexture.isReady()?(b.uniform1i(d.locations.mzellvq2,1),b.uniform1i(d.locations.rqffkvz2,t.saturationTexture.loadToShader(d,d.locations.olldgtl2,d.locations.afixdea2))):b.uniform1i(d.locations.mzellvq2,0):b.uniform1i(d.locations.mzellvq2,
0)):(b.uniform4f(d.locations.srrtdcb2,0,0,0,0),b.uniform1i(d.locations.caimcpz2,0),b.uniform1i(d.locations.bbkmoxx2,0),b.uniform2f(d.locations.zpfazci2,1,1),b.uniform1f(d.locations.zsumzby2,1))):b.uniform1f(d.locations.heftokz,0);b.uniformMatrix4fv(d.locations.ondssmn,!1,f.node.modelMatrix);b.uniformMatrix3fv(d.locations.ccpxoqv,!1,f.node.normalModelMatrix);b.uniformMatrix3fv(d.locations.dcsphyk,!1,f.node.normalModelViewMatrix);k.call(this,d,f)}}};d.prototype.renderForShadowMaps=function(d,f,g){var n=
f.polylist.geometry;if(f.occluder||!(2==n.polySize||f.isHidden()||g&&f.matAnim.isPatch()))g=f.node,b.uniformMatrix4fv(d.locations.ondssmn,!1,g.modelMatrix),b.uniformMatrix3fv(d.locations.ccpxoqv,!1,g.normalModelMatrix),f.occluder?(b.depthFunc(b.LEQUAL),k.call(this,d,f),b.depthFunc(b.LESS)):k.call(this,d,f)};d.prototype.renderFlat=function(d,f){if(!f.isHidden()){b.uniformMatrix4fv(d.locations.ondssmn,!1,f.node.modelMatrix);if(d.locations.cqcpvcg){var g=f.matAnim.computeDisplacementFactor();0<g?b.enableVertexAttribArray(d.locations.pcgewnw):
b.disableVertexAttribArray(d.locations.pcgewnw);b.uniform1f(d.locations.cqcpvcg,g)}g=f.glInstancedCount;f.glInstancedCount=1;k.call(this,d,f);f.glInstancedCount=g}};d.prototype.renderGooch=function(b,d){l.call(this,b,d.node);k.call(this,b,d)};d.prototype.renderCustomMaterial=function(d,f){var g=f.polylist;if(2!=g.geometry.polySize&&!f.isHidden()){var q=f.node;b.uniform1i(d.locations.atutpxf,(g.highlighted||f.materialTree&&f.materialTree.highlighted)+0);l.call(this,d,q);k.call(this,d,f)}};d.prototype.renderPolyColor=
function(d,f){if(!f.isHidden()){var g=f.polylist,q=f.node;b.uniform4f(d.locations.xcxkhty,g.color[0],g.color[1],g.color[2],1);b.uniform4f(d.locations.nsnbysp,g.color[0],g.color[1],g.color[2],1);b.uniform4f(d.locations.gmzubwt,g.color[0],g.color[1],g.color[2],1);l.call(this,d,q);k.call(this,d,f)}};d.prototype.renderMatsColor=function(d,f,g){if(!f.isHidden()){var n=f.node;g=g.materials[f.matAnim.getCurrentMaterial().id];b.uniform4f(d.locations.xcxkhty,g.color[0],g.color[1],g.color[2],1);b.uniform4f(d.locations.nsnbysp,
g.color[0],g.color[1],g.color[2],1);b.uniform4f(d.locations.gmzubwt,g.color[0],g.color[1],g.color[2],1);l.call(this,d,n);k.call(this,d,f)}};d.prototype.renderWater=function(d,f){if(!f.isHidden()){var g=f.node;b.uniformMatrix4fv(d.locations.ondssmn,!1,g.modelMatrix);b.uniformMatrix3fv(d.locations.ccpxoqv,!1,g.normalModelMatrix);k.call(this,d,f)}};d.prototype.renderSharpEdges=function(d,f){if(!f.isHidden()){var g=f.polylist,k=g.geometry;if(g.edgesBuffers.length){b.uniformMatrix4fv(d.locations.ondssmn,
!1,f.node.modelMatrix);var l=0;d.locations.cqcpvcg&&(l=f.matAnim.computeDisplacementFactor(),0<l?b.enableVertexAttribArray(d.locations.pcgewnw):b.disableVertexAttribArray(d.locations.pcgewnw),b.uniform1f(d.locations.cqcpvcg,l));for(var q in k.vertexBuffers)b.bindBuffer(b.ARRAY_BUFFER,k.vertexBuffers[q]),b.vertexAttribPointer(d.locations.ymaxekn,3,b.FLOAT,!1,0,0),0<l&&(b.bindBuffer(b.ARRAY_BUFFER,k.normalBuffers[j]),b.vertexAttribPointer(d.locations.pcgewnw,3,b.FLOAT,!1,0,0)),b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,
g.edgesBuffers[q]),b.drawElements(b.LINES,2*g.edgeCount[q],g.elementTypes[q],0)}}};d.prototype.renderForWireFrame=function(d,f){if(!f.isHidden()){b.disable(b.CULL_FACE);b.lineWidth(1);var g=f.polylist,k=g.geometry;b.uniformMatrix4fv(d.locations.ondssmn,!1,f.node.modelMatrix);var l=0;d.locations.cqcpvcg&&(l=f.matAnim.computeDisplacementFactor(),0<l?b.enableVertexAttribArray(d.locations.pcgewnw):b.disableVertexAttribArray(d.locations.pcgewnw),b.uniform1f(d.locations.cqcpvcg,l));for(var q in k.vertexBuffers)b.bindBuffer(b.ARRAY_BUFFER,
k.vertexBuffers[q]),b.vertexAttribPointer(d.locations.ymaxekn,3,b.FLOAT,!1,0,0),0<l&&(b.bindBuffer(b.ARRAY_BUFFER,k.normalBuffers[q]),b.vertexAttribPointer(d.locations.pcgewnw,3,b.FLOAT,!1,0,0)),b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,g.indexLineBufs[q]),b.drawElements(b.LINES,g.indexLBufSize[q],g.elementTypes[q],0)}};var g=new Float32Array([-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,-1,1,-1,1,1,-1,1,1,1,-1,1,1]),q=new Float32Array([-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,-1,1,-1,1,1,-1,1,1,1,-1,1,1]),t=[0,1,1,2,2,3,3,
0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7];d.prototype.renderNodeBoundingBox=function(d,f,n){void 0===this.cubeVBuffer&&(this.cubeVBuffer=b.createBuffer(),b.bindBuffer(b.ARRAY_BUFFER,this.cubeVBuffer),b.bufferData(b.ARRAY_BUFFER,g,b.DYNAMIC_DRAW),this.cubeIBuffer=b.createBuffer(),b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.cubeIBuffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,new Uint16Array(t),b.STATIC_DRAW));var k=mat4.identity(mat4.create());b.bindBuffer(b.ARRAY_BUFFER,this.cubeVBuffer);f.fullyTransformedSnapBoundingBox?
(f=new Float32Array(f.fullyTransformedSnapBoundingBox._buffer,12,24),q[0]=f[0],q[1]=f[1],q[2]=f[2],q[3]=f[12],q[4]=f[13],q[5]=f[14],q[6]=f[15],q[7]=f[16],q[8]=f[17],q[9]=f[3],q[10]=f[4],q[11]=f[5],q[12]=f[6],q[13]=f[7],q[14]=f[8],q[15]=f[18],q[16]=f[19],q[17]=f[20],q[18]=f[21],q[19]=f[22],q[20]=f[23],q[21]=f[9],q[22]=f[10],q[23]=f[11],b.bufferSubData(b.ARRAY_BUFFER,0,q)):(f=n||f.boundingBoxWithoutNodes||f.boundingBox,b.bufferSubData(b.ARRAY_BUFFER,0,g),mat4.translate(k,f.center),mat4.scale(k,[(f.maxX-
f.minX)/2,(f.maxY-f.minY)/2,(f.maxZ-f.minZ)/2]));b.vertexAttribPointer(d.locations.ymaxekn,3,b.FLOAT,!1,0,0);n?b.uniform4f(d.locations.srrtdcb,0,1,0,1):b.uniform4f(d.locations.srrtdcb,1,0,0,1);b.uniform1i(d.locations.rfausvd,1);b.uniformMatrix4fv(d.locations.ondssmn,!1,k);b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.cubeIBuffer);b.drawElements(b.LINES,24,b.UNSIGNED_SHORT,0)};d.prototype.renderBoundingBox=function(d,f){void 0===this.cubeVBuffer&&(this.cubeVBuffer=b.createBuffer(),b.bindBuffer(b.ARRAY_BUFFER,
this.cubeVBuffer),b.bufferData(b.ARRAY_BUFFER,g,b.DYNAMIC_DRAW),this.cubeIBuffer=b.createBuffer(),b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.cubeIBuffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,new Uint16Array(t),b.STATIC_DRAW));var n=mat4.identity(mat4.create());b.bindBuffer(b.ARRAY_BUFFER,this.cubeVBuffer);f=new Float32Array(f._buffer,12,24);q[0]=f[0];q[1]=f[1];q[2]=f[2];q[3]=f[12];q[4]=f[13];q[5]=f[14];q[6]=f[15];q[7]=f[16];q[8]=f[17];q[9]=f[3];q[10]=f[4];q[11]=f[5];q[12]=f[6];q[13]=f[7];q[14]=f[8];
q[15]=f[18];q[16]=f[19];q[17]=f[20];q[18]=f[21];q[19]=f[22];q[20]=f[23];q[21]=f[9];q[22]=f[10];q[23]=f[11];b.bufferSubData(b.ARRAY_BUFFER,0,q);b.vertexAttribPointer(d.locations.ymaxekn,3,b.FLOAT,!1,0,0);b.uniform4f(d.locations.srrtdcb,0,1,0,.5);b.uniform1i(d.locations.rfausvd,1);b.uniformMatrix4fv(d.locations.ondssmn,!1,n);b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.cubeIBuffer);b.drawElements(b.LINES,24,b.UNSIGNED_SHORT,0)};d.prototype.renderForFur=function(d,f){if(2!=f.polylist.geometry.polySize&&
!f.isHidden()){var g=f.node;b.uniformMatrix4fv(d.locations.ondssmn,!1,g.modelMatrix);b.uniformMatrix3fv(d.locations.ccpxoqv,!1,g.normalModelMatrix);b.uniformMatrix3fv(d.locations.nplkqwh,!1,g.invModelMatrix3);f.matAnim.loadFurMaterial(b,d);f.matAnim.loadDiscardTransparent(b,d,!f.occluder&&!f.matAnim.isOpaque(!1,!0));f.occluder?(b.depthFunc(b.LEQUAL),k.call(this,d,f),b.depthFunc(b.LESS)):k.call(this,d,f)}};return d});
var shaderScripts={vertexShaderPbrRendering:"uniform mat4 ampnorz;uniform mat4 ondssmn;uniform mat4 ghgsnpw;uniform mat3 dcsphyk;uniform mat3 ccpxoqv;\n #ifdef zgbdrir\n uniform float ufoyjfa;uniform float xkuelka;uniform float dtvyjnu;\n #endif \n varying vec4 jqgramm4;varying vec4 ibymued4;varying vec4 olsbfcm4;varying vec4 gkuebzf4;\n /*#define npbwfph*/\n \n /*#define ylzxewv*/\n \n #if octspal>0\n \n #ifdef kqlahgv0\n uniform mat4 bfigqga0;varying vec2 izejsjy0;\n #endif \n \n #ifdef kqlahgv1\n uniform mat4 bfigqga1;varying vec2 izejsjy1;\n #endif \n \n #ifdef kqlahgv2\n uniform mat4 bfigqga2;varying vec2 izejsjy2;\n #endif \n \n #ifdef kqlahgv3\n uniform mat4 bfigqga3;varying vec2 izejsjy3;\n #endif \n \n #ifdef kqlahgv4\n uniform mat4 bfigqga4;varying vec2 izejsjy4;\n #endif \n \n #ifdef kqlahgv5\n uniform mat4 bfigqga5;varying vec2 izejsjy5;\n #endif \n \n #ifdef kqlahgv6\n uniform mat4 bfigqga6;varying vec2 izejsjy6;\n #endif \n \n #ifdef kqlahgv7\n uniform mat4 bfigqga7;varying vec2 izejsjy7;\n #endif \n \n #ifdef kqlahgv8\n uniform mat4 bfigqga8;varying vec2 izejsjy8;\n #endif \n \n #ifdef kqlahgv9\n uniform mat4 bfigqga9;varying vec2 izejsjy9;\n #endif \n \n #endif \n void main(){\n #ifdef igkhmka\n vec4 iejwwyj=kxmizmt(ondssmn);\n #else \n vec4 iejwwyj=ondssmn*vec4 (ymaxekn,1.0);\n #endif \n ibymued4.xyz=normalize(dcsphyk*pcgewnw);vec3 hbnjyno=normalize(ccpxoqv*pcgewnw);vec4 wmxooao=ampnorz*iejwwyj;gkuebzf4.xyz=wmxooao.xyz;\n #ifdef zgbdrir\n if(ufoyjfa>0.0){float wcwmczn=step(ufoyjfa,1.5)*ymaxekn.x+step(1.5,ufoyjfa)*step(ufoyjfa,2.5)*ymaxekn.y+step(2.5,ufoyjfa)*ymaxekn.z;if(wcwmczn>=dtvyjnu){gkuebzf4.w=0.0;}else {if(wcwmczn>=xkuelka){gkuebzf4.w=1.0-((wcwmczn-xkuelka)/(dtvyjnu-xkuelka));}else {gkuebzf4.w=1.0;}}}\n #endif \n jqgramm4.xyz=normalize(wmxooao.xyz);olsbfcm4.xyz=iejwwyj.xyz;gl_Position=ghgsnpw*wmxooao;jqgramm4.a=hbnjyno.x;ibymued4.a=hbnjyno.y;olsbfcm4.a=hbnjyno.z;\n #if octspal>0\n vec4 rbrvsbh;\n #ifdef kqlahgv0\n rbrvsbh=bfigqga0*iejwwyj;izejsjy0=0.5*rbrvsbh.xy/rbrvsbh.w+0.5;\n #endif \n \n #ifdef kqlahgv1\n rbrvsbh=bfigqga1*iejwwyj;izejsjy1=0.5*rbrvsbh.xy/rbrvsbh.w+0.5;\n #endif \n \n #ifdef kqlahgv2\n rbrvsbh=bfigqga2*iejwwyj;izejsjy2=0.5*rbrvsbh.xy/rbrvsbh.w+0.5;\n #endif \n \n #ifdef kqlahgv3\n rbrvsbh=bfigqga3*iejwwyj;izejsjy3=0.5*rbrvsbh.xy/rbrvsbh.w+0.5;\n #endif \n \n #ifdef kqlahgv4\n rbrvsbh=bfigqga4*iejwwyj;izejsjy4=0.5*rbrvsbh.xy/rbrvsbh.w+0.5;\n #endif \n \n #ifdef kqlahgv5\n rbrvsbh=bfigqga5*iejwwyj;izejsjy5=0.5*rbrvsbh.xy/rbrvsbh.w+0.5;\n #endif \n \n #ifdef kqlahgv6\n rbrvsbh=bfigqga6*iejwwyj;izejsjy6=0.5*rbrvsbh.xy/rbrvsbh.w+0.5;\n #endif \n \n #ifdef kqlahgv7\n rbrvsbh=bfigqga7*iejwwyj;izejsjy7=0.5*rbrvsbh.xy/rbrvsbh.w+0.5;\n #endif \n \n #ifdef kqlahgv8\n rbrvsbh=bfigqga8*iejwwyj;izejsjy8=0.5*rbrvsbh.xy/rbrvsbh.w+0.5;\n #endif \n \n #ifdef kqlahgv9\n rbrvsbh=bfigqga9*iejwwyj;izejsjy9=0.5*rbrvsbh.xy/rbrvsbh.w+0.5;\n #endif \n \n #endif \n ",fragmentShaderPbrRendering:"\n #define ajzdlsi(zkavbvf,dhdsydm,tojlubj)(zkavbvf!=0?dhdsydm:tojlubj)\n \n #ifdef WEBGL2 \n \n #define bqkzdld(oikxlps,uuxsjad)if((oikxlps&uint (uuxsjad))==uint (uuxsjad))\n \n #define rrziwlm(oikxlps,uuxsjad)if((oikxlps&uint (uuxsjad))!=uint (uuxsjad))\n \n #else \n \n #define bqkzdld(oikxlps,uuxsjad)if(floor(mod(float (oikxlps)/float (uuxsjad),2.0))==1.0)\n \n #define rrziwlm(oikxlps,uuxsjad)if(floor(mod(float (oikxlps)/float (uuxsjad),2.0))!=1.0)\n \n #endif \n const float jcucfqw=3.14159265359;const float jcucfqw2=6.28318530718;const float tklsnka2=jcucfqw/2.0;const float esawdfk2=2.0/jcucfqw;const float jrxubpf=jcucfqw/2.0;const float uglsosm=1.0/jrxubpf;const float kcwjvmb=1.0/jcucfqw;\n #define vxusoxy(x)((x)*(x))\n \n #define biilsvu5(x)((x)*(x)*(x)*(x)*(x))\n \n #define hfkzpca(x)sqrt(1.0-((x)*(x)))\n float hdutudc(float wjjvebv){return mod((wjjvebv*109391.0)+7937.0,105733.0);}float ksgbsno(float x,float tpgzfhw,float pfydqqy){return 1.0/(1.0+exp((pfydqqy-x)*tpgzfhw));}mat4 btzqdnw(vec3 zssgyxo,vec2 nkxskwe){zssgyxo=normalize(zssgyxo);float splrifm=nkxskwe.x;float s=nkxskwe.y;float bxpxftv=1.0-splrifm;return mat4 (bxpxftv*zssgyxo.x*zssgyxo.x+splrifm,bxpxftv*zssgyxo.x*zssgyxo.y-zssgyxo.z*s,bxpxftv*zssgyxo.z*zssgyxo.x+zssgyxo.y*s,0.0,bxpxftv*zssgyxo.x*zssgyxo.y+zssgyxo.z*s,bxpxftv*zssgyxo.y*zssgyxo.y+splrifm,bxpxftv*zssgyxo.y*zssgyxo.z-zssgyxo.x*s,0.0,bxpxftv*zssgyxo.z*zssgyxo.x-zssgyxo.y*s,bxpxftv*zssgyxo.y*zssgyxo.z+zssgyxo.x*s,bxpxftv*zssgyxo.z*zssgyxo.z+splrifm,0.0,0.0,0.0,0.0,1.0);}mat4 btzqdnw(vec3 zssgyxo,float nkxskwe){zssgyxo=normalize(zssgyxo);float s=sin(nkxskwe);float splrifm=cos(nkxskwe);float bxpxftv=1.0-splrifm;return mat4 (bxpxftv*zssgyxo.x*zssgyxo.x+splrifm,bxpxftv*zssgyxo.x*zssgyxo.y-zssgyxo.z*s,bxpxftv*zssgyxo.z*zssgyxo.x+zssgyxo.y*s,0.0,bxpxftv*zssgyxo.x*zssgyxo.y+zssgyxo.z*s,bxpxftv*zssgyxo.y*zssgyxo.y+splrifm,bxpxftv*zssgyxo.y*zssgyxo.z-zssgyxo.x*s,0.0,bxpxftv*zssgyxo.z*zssgyxo.x-zssgyxo.y*s,bxpxftv*zssgyxo.y*zssgyxo.z+zssgyxo.x*s,bxpxftv*zssgyxo.z*zssgyxo.z+splrifm,0.0,0.0,0.0,0.0,1.0);}mat3 vyjxjvu3(vec3 zssgyxo,float nkxskwe){zssgyxo=normalize(zssgyxo);float s=sin(nkxskwe);float splrifm=cos(nkxskwe);float bxpxftv=1.0-splrifm;return mat3 (bxpxftv*zssgyxo.x*zssgyxo.x+splrifm,bxpxftv*zssgyxo.x*zssgyxo.y-zssgyxo.z*s,bxpxftv*zssgyxo.z*zssgyxo.x+zssgyxo.y*s,bxpxftv*zssgyxo.x*zssgyxo.y+zssgyxo.z*s,bxpxftv*zssgyxo.y*zssgyxo.y+splrifm,bxpxftv*zssgyxo.y*zssgyxo.z-zssgyxo.x*s,bxpxftv*zssgyxo.z*zssgyxo.x-zssgyxo.y*s,bxpxftv*zssgyxo.y*zssgyxo.z+zssgyxo.x*s,bxpxftv*zssgyxo.z*zssgyxo.z+splrifm);}const float ytjwmnn2=0.0031308;const float hgahysq2=0.04045;const float pngcauc2=2.4;float eywytlx2(float x){return x<ytjwmnn2?x*12.92:1.055*pow(x,1.0/pngcauc2)-0.055;}vec3 eywytlx2(vec3 nsstwqm){return vec3 (qsnypvh(nsstwqm.r),qsnypvh(nsstwqm.g),qsnypvh(nsstwqm.b));}vec4 eywytlx2(vec4 nsstwqm){return vec4 (qsnypvh(nsstwqm.rgb),nsstwqm.a);}float zhzvgrw2(float x){return x<hgahysq2?x/12.92:pow((x+0.055)/1.055,pngcauc2);}vec3 zhzvgrw2(vec3 nsstwqm){return vec3 (vwogtxa(nsstwqm.r),vwogtxa(nsstwqm.g),vwogtxa(nsstwqm.b));}vec4 zhzvgrw2(vec4 nsstwqm){return vec4 (vwogtxa(nsstwqm.rgb),nsstwqm.a);}vec3 qpkvbik(vec3 splrifm){vec4 eircrya=vec4 (0.0,-1.0/3.0,2.0/3.0,-1.0);vec4 p=mix(vec4 (splrifm.bg,eircrya.wz),vec4 (splrifm.gb,eircrya.xy),step(splrifm.b,splrifm.g));vec4 zrcochy=mix(vec4 (p.xyw,splrifm.r),vec4 (splrifm.r,p.yzx),step(p.x,splrifm.r));float epbwege=zrcochy.x-min(zrcochy.w,zrcochy.y);float nsvbngn=0.0000000001;return vec3 (abs(zrcochy.z+(zrcochy.w-zrcochy.y)/(6.0*epbwege+nsvbngn)),epbwege/(zrcochy.x+nsvbngn),zrcochy.x);}vec3 zqclnmx(vec3 splrifm){vec4 eircrya=vec4 (1.0,2.0/3.0,1.0/3.0,3.0);vec3 p=abs(fract(splrifm.xxx+eircrya.xyz)*6.0-eircrya.www);return splrifm.z*mix(eircrya.xxx,clamp(p-eircrya.xxx,0.0,1.0),splrifm.y);}vec3 chgmwqz(vec3 ledjrpy,vec3 rngrzzy,float ohginlh){vec3 byumcvy=qpkvbik(ledjrpy);vec3 iuwczyl=qpkvbik(rngrzzy);if((iuwczyl.r-byumcvy.r)>0.5){byumcvy.r+=1.0;}else if((byumcvy.r-iuwczyl.r)>0.5){iuwczyl.r+=1.0;}return zqclnmx(mix(byumcvy,iuwczyl,ohginlh));}vec3 chgmwqz(vec3 ledjrpy,vec3 rngrzzy,float ohginlh,int tfsobou){vec3 byumcvy=qpkvbik(ledjrpy);vec3 iuwczyl=qpkvbik(rngrzzy);if((iuwczyl.r-byumcvy.r)>0.5){byumcvy.r+=1.0;}else if((byumcvy.r-iuwczyl.r)>0.5){iuwczyl.r+=1.0;}return zqclnmx(mix(byumcvy,iuwczyl,ohginlh));}vec4 chgmwqz(vec4 ledjrpy,vec4 rngrzzy,float ohginlh){return vec4 (chgmwqz(ledjrpy.rgb,rngrzzy.rgb,ohginlh),mix(ledjrpy.a,rngrzzy.a,ohginlh));}vec4 chgmwqz(vec4 ledjrpy,vec4 rngrzzy,float ohginlh,int tfsobou){return vec4 (chgmwqz(ledjrpy.rgb,rngrzzy.rgb,ohginlh,tfsobou),mix(ledjrpy.a,rngrzzy.a,ohginlh));}float qjaowaa(vec3 nsstwqm){return 0.299*nsstwqm.r+0.587*nsstwqm.g+0.114*nsstwqm.b;}float cqthvwc(float uuxsjad){return clamp(uuxsjad,0.0,1.0);}vec2 cqthvwc(vec2 cyxmscz){return vec2 (cqthvwc(cyxmscz.x),cqthvwc(cyxmscz.y));}vec3 cqthvwc(vec3 cyxmscz){return vec3 (cqthvwc(cyxmscz.xy),cqthvwc(cyxmscz.z));}vec4 cqthvwc(vec4 cyxmscz){return vec4 (cqthvwc(cyxmscz.rgb),cqthvwc(cyxmscz.a));}vec2 vlrndvc2(vec2 xpvzhgh,float cphdvry,float wymsnjn){float mfvvztb=length(xpvzhgh);xpvzhgh.x=mix(xpvzhgh.x,cphdvry,wymsnjn);xpvzhgh.y=mix(xpvzhgh.y,cphdvry,wymsnjn);return normalize(xpvzhgh)/mfvvztb;}struct cvyvawl{vec3 fxcsdif;vec3 pbfcbmx;};\n #define xaqovse\n float nwbwwqm(float lhzetth,float uzhanef){return uzhanef;}float nwbwwqm(float jtwyxfd){return nwbwwqm(1.0,jtwyxfd);}uniform vec4 mwstbcz;uniform vec4 qsnvreg;uniform float vztvedk;uniform int jdlwajd;uniform float fquroso;uniform float bzmstcf;uniform float ymenuuk;uniform int ftqjlzm;uniform float vdiidww;\n #if defined(egwldhy)||defined(zrwxjuc)\n uniform uint oxryimw;\n #endif \n \n #ifdef egwldhy\n const uint zncnhtb=uint (0x1);const uint ghotfuo=uint (0x2);const uint osynrhk=uint (0x4);const uint dmxfrrv=uint (0x8);\n #endif \n \n #if defined(egwldhy)||defined(lxauyiv)\n uniform sampler2D ymlxlax;uniform int ngtowew;uniform mat4 hzoknqs;\n #endif \n \n #if defined(egwldhy)||defined(thpbndm)\n uniform sampler2D ltdhpbn;uniform int ydwikqq;uniform mat4 pblcfaf;\n #endif \n \n #if defined(egwldhy)||defined(nzrtsqr)\n uniform sampler2D zhmvfql;uniform int luvcklm;uniform mat4 vfyqlph;\n #endif \n \n #if defined(egwldhy)||defined(khvylnr)\n uniform sampler2D vthsmnb;uniform int smggktt;uniform mat4 imjkghn;\n #endif \n uniform float tqpeter;uniform vec4 rmbxdvn;\n #ifdef bzsisog\n uniform sampler2D bdwutbz;uniform int rdawqhh;uniform mat4 chrxigj;\n #endif \n \n #ifdef kddtxjn\n uniform sampler2D dkznlil;uniform int vrqlwnm;uniform mat4 hakpqqs;\n #endif \n \n #ifdef mxroult\n uniform float nsowafh;\n #endif \n \n #if defined(syyczsg)||defined(pyofspi)\n uniform sampler2D yeqgzpf;uniform int ingoasu;uniform mat4 rjgjnzi;uniform float xqahzng;uniform int xedrqbd;\n #ifdef vwylkgn\n uniform sampler2D vohmaky;uniform int wullosg;uniform mat4 rasiqrh;\n #endif \n \n #endif \n \n #if defined(syyczsg2)||defined(pyofspi2)\n uniform sampler2D rybvhvu;uniform int wtmnctg;uniform mat4 shdknig;uniform float csdjrkx;uniform int zvckycw;\n #ifdef vwylkgn2\n uniform sampler2D wuylkyh;uniform int xhreiep;uniform mat4 qawohzh;\n #endif \n \n #endif \n \n #ifdef kvpridb\n uniform vec4 nsnbysp;uniform int tpxgrnu;\n #ifdef ylmuugp\n uniform sampler2D udeimwb;uniform int ponpmlf;uniform mat4 fbqzibe;\n #endif \n \n #ifdef aitbpqn\n uniform sampler2D nkdvrfp;uniform int dovwrzg;uniform mat4 miqrofj;\n #endif \n \n #endif \n \n #ifdef szgfzxq\n uniform float tticctp;uniform float ktxjfle;\n #ifdef mniehwp\n uniform sampler2D cjsawvn;uniform int usbxvxd;uniform mat4 tiaooli;\n #endif \n \n #endif \n \n #ifdef znloiam\n uniform float mlpvzht;uniform float tattnol;\n #ifdef teqtfsb\n uniform sampler2D uwddkhh;uniform int fvyblms;uniform mat4 kotsuvy;\n #endif \n \n #endif \n \n #ifdef liwyana\n uniform float yfhugch;\n #ifdef kopvmvi\n uniform int iixvswj;uniform sampler2D lweuiuw;uniform mat4 ugabykz;\n #endif \n \n #endif \n \n #ifdef enkgdhh\n uniform sampler2D dfwrrka;\n #endif \n \n #if defined(gibejed)||defined(vmgeorx)\n uniform vec4 nplnhzx[npbwfph];uniform float pmiexkd[npbwfph];uniform float wikjwmu;\n #ifdef iizvave\n uniform sampler2D pvowxhe;uniform int cofxubp;uniform mat4 jtmrnbj;\n #endif \n \n #endif \n \n #if defined(zjsuosi)||defined(sjuwcbf)\n uniform vec4 nplnhzx2[ylzxewv];uniform float pmiexkd2[ylzxewv];uniform float wikjwmu2;\n #ifdef cnwqbay\n uniform sampler2D pvowxhe2;uniform int cofxubp2;uniform mat4 jtmrnbj2;\n #endif \n \n #endif \n uniform vec3 ptlusfy;\n #ifdef pyjqigb\n uniform samplerCube ffhousu;uniform samplerCube rilfrvi;uniform samplerCube miezeao;uniform samplerCube xtelvnu;uniform samplerCube kgsywlg;uniform samplerCube codyzck;\n #else \n uniform sampler2D gxvoadx;\n #endif \n uniform int kebjccr;uniform float jmnndrt;uniform float ikywnlr;uniform float wogkfep;uniform float lzaycwd;uniform float tsvlbmp;\n #if defined(lsbfhti)||defined(pyjqigb)\n uniform sampler2D fvfyemf;\n #endif \n \n #ifdef igkhmka\n uniform vec4 woaetjz;uniform vec3 nhwprup;\n #ifdef weeuwar\n uniform sampler2D cwlogkk;uniform int sbsyqfs;uniform mat4 tkfccyx;\n #endif \n \n #endif \n \n #ifdef ANIMATING \n uniform float heftokz;uniform vec3 qsnvreg2;uniform float vztvedk2;uniform int jdlwajd2;uniform float fquroso2;uniform float bzmstcf2;uniform float ymenuuk2;\n #ifdef zrwxjuc\n const uint oplpbzu=uint (0x10);const uint dfdbnlu=uint (0x20);const uint jjutglc=uint (0x40);const uint qgycyvy=uint (0x80);\n #endif \n \n #if defined(zrwxjuc)||defined(otxqyhg)\n uniform sampler2D ymlxlax2;uniform int ngtowew2;uniform mat4 hzoknqs2;\n #endif \n \n #if defined(zrwxjuc)||defined(efxkogl)\n uniform sampler2D ltdhpbn2;uniform int ydwikqq2;uniform mat4 pblcfaf2;\n #endif \n \n #if defined(zrwxjuc)||defined(vnfasrp)\n uniform sampler2D zhmvfql2;uniform int luvcklm2;uniform mat4 vfyqlph2;\n #endif \n \n #if defined(zrwxjuc)||defined(cybhscz)\n uniform sampler2D vthsmnb2;uniform int smggktt2;uniform mat4 imjkghn2;\n #endif \n uniform float tqpeter2;uniform vec4 rmbxdvn2;\n #ifdef xlkdrug\n uniform sampler2D bdwutbz2;uniform int rdawqhh2;uniform mat4 chrxigj2;\n #endif \n \n #ifdef pzlstld\n uniform sampler2D dkznlil2;uniform int vrqlwnm2;uniform mat4 hakpqqs2;\n #endif \n \n #if defined(csbgoxi)||defined(hvlzvwa)\n uniform sampler2D yeqgzpf2;uniform int ingoasu2;uniform mat4 rjgjnzi2;uniform float xqahzng2;uniform int xedrqbd2;\n #ifdef lzgnupy\n uniform sampler2D vohmaky2;uniform int wullosg2;uniform mat4 rasiqrh2;\n #endif \n \n #endif \n \n #if defined(csbgoxi2)||defined(hvlzvwa2)\n uniform sampler2D rybvhvu2;uniform int wtmnctg2;uniform mat4 shdknig2;uniform float csdjrkx2;uniform int zvckycw2;\n #ifdef lzgnupy2\n uniform sampler2D wuylkyh2;uniform int xhreiep2;uniform mat4 qawohzh2;\n #endif \n \n #endif \n \n #ifdef zfkjfmr\n uniform vec4 nsnbysp2;\n #ifdef muzpkxq\n uniform sampler2D udeimwb2;uniform int ponpmlf2;uniform mat4 fbqzibe2;\n #endif \n \n #ifdef qvyqlby\n uniform sampler2D nkdvrfp2;uniform int dovwrzg2;uniform mat4 miqrofj2;\n #endif \n \n #endif \n \n #ifdef azsutev\n uniform float tticctp2;uniform float ktxjfle2;\n #ifdef mzksuld\n uniform sampler2D cjsawvn2;uniform int usbxvxd2;uniform mat4 tiaooli2;\n #endif \n \n #endif \n \n #ifdef gtbnreb\n uniform float mlpvzht2;uniform float tattnol2;\n #ifdef brymrwe\n uniform sampler2D uwddkhh2;uniform int fvyblms2;uniform mat4 kotsuvy2;\n #endif \n \n #endif \n \n #endif \n \n #ifdef llqozaq\n uniform float tqvmssp;uniform float cjovtni;\n #ifdef przvnvk\n uniform sampler2D cflnaem;uniform int uxcpxdf;uniform mat4 dmyiwir;\n #endif \n \n #ifdef nislecw\n uniform sampler2D wywddxj;uniform int gulzwyp;uniform mat4 phepegv;\n #endif \n \n #ifdef odbiyre\n uniform sampler2D aykqlve;uniform int ajpiohp;uniform mat4 jbzfnah;\n #endif \n \n #ifdef jiepurz\n uniform sampler2D tshbnse;uniform int mmmifet;uniform mat4 dggoqiq;\n #endif \n \n #endif \n \n #ifdef usxiksx\n uniform float tqvmssp2;uniform float cjovtni2;\n #ifdef hqoltzb\n uniform sampler2D cflnaem2;uniform int uxcpxdf2;uniform mat4 dmyiwir2;\n #endif \n \n #ifdef vdaapsy\n uniform sampler2D wywddxj2;uniform int gulzwyp2;uniform mat4 phepegv2;\n #endif \n \n #ifdef velyaqt\n uniform sampler2D aykqlve2;uniform int ajpiohp2;uniform mat4 jbzfnah2;\n #endif \n \n #ifdef vefpzux\n uniform sampler2D tshbnse2;uniform int mmmifet2;uniform mat4 dggoqiq2;\n #endif \n \n #endif \n \n #ifdef rofpzvn\n \n #ifdef ymqdhta\n uniform samplerCube mximbml;\n #endif \n uniform float tvceenj;uniform float ijwreus;uniform int pqtpdgb;\n #ifdef ymqdhta\n uniform int goobxbd;\n #endif \n uniform vec3 qskkyrm;uniform float vptxeeo;\n #endif \n \n #ifdef pnswumg\n \n #ifdef yxcsywt\n uniform samplerCube mximbml2;\n #endif \n uniform float tvceenj2;uniform float ijwreus2;uniform int pqtpdgb2;\n #ifdef yxcsywt\n uniform int goobxbd2;\n #endif \n uniform vec3 qskkyrm2;uniform float vptxeeo2;\n #endif \n \n /*#define oyfkqty*/\n \n #ifdef kytpnre\n uniform float wmwedox;uniform uint zvyasqs;uniform float juzldmk[oyfkqty];uniform float lrzbupm[oyfkqty];uniform float htommgx[oyfkqty];uniform sampler2D gwnvphv;uniform mat4 owzoeru;\n #if defined(sdxjcre)&&sdxjcre>0\n uniform vec3 sdgxppd[sdxjcre];uniform vec3 uvobbpg[sdxjcre];uniform float fhdoawj[sdxjcre];\n #endif \n uniform float remfqag;uniform int okkhwfp;uniform int jokkayo;uniform int cfazlvb;uniform int ryveioo;uniform float foymowj;uniform sampler2D easweyl;\n #ifdef WEBGL2 \n precision mediump sampler2DArray ;uniform sampler2DArray gcfagin;\n #else \n uniform sampler2D gcfagin;uniform int wwmphdn;uniform float abeohis;uniform float gaovjzk;\n #endif \n uniform int wmkandj;uniform mat4 mllilwk;\n #endif \n \n #ifdef nfgvnsg\n uniform float ndvebik;uniform float abxhprd;uniform float pqiyuoc;uniform float uyctxef;uniform vec3 itkobbj;\n #ifdef pvoufay\n uniform sampler2D opjqilf;uniform int urczxqn;uniform mat4 nzqvvha;\n #endif \n \n #ifdef yjwrvft\n uniform sampler2D avazlhu;uniform int bzfntqa;uniform mat4 vaukewk;\n #endif \n \n #ifdef gamdqkw\n uniform sampler2D yghjgai;uniform int oldfyhf;uniform mat4 lnqzuxw;\n #endif \n \n #ifdef orrsbij\n uniform sampler2D lsbkrcl;uniform int mwyuitt;uniform mat4 umjpvqc;uniform float pjpgdaw;uniform int iuupley;\n #endif \n \n #endif \n \n #ifdef ypznuqr\n uniform float ndvebik2;uniform float abxhprd2;uniform float uyctxef2;uniform float pqiyuoc2;uniform vec3 itkobbj2;\n #ifdef fthwwgd\n uniform sampler2D opjqilf2;uniform int urczxqn2;uniform mat4 nzqvvha2;\n #endif \n \n #ifdef yrnenzl\n uniform sampler2D avazlhu2;uniform int bzfntqa2;uniform mat4 vaukewk2;\n #endif \n \n #ifdef ykfpceu\n uniform sampler2D yghjgai2;uniform int oldfyhf2;uniform mat4 lnqzuxw2;\n #endif \n \n #ifdef krkzyck\n uniform sampler2D lsbkrcl2;uniform int mwyuitt2;uniform mat4 umjpvqc2;uniform float pjpgdaw2;uniform int iuupley2;\n #endif \n \n #endif \n \n #ifdef ngsweov\n uniform float cqqogff;uniform vec3 ooatcna;\n #ifdef oybasjb\n uniform sampler2D jezuqal;uniform int yuqudeq;uniform mat4 nxdiahe;\n #endif \n \n #ifdef odxlfbv\n uniform sampler2D stagxue;uniform int gdmnvaa;uniform mat4 zjpbhvf;\n #endif \n \n #ifndef xqhrlxr\n \n #ifdef pfulqqa\n uniform float onlskix;\n #ifdef fhkoxfl\n uniform sampler2D rzgjmme;uniform int qvnyrht;uniform mat4 wqkzcsl;\n #endif \n \n #endif \n \n #endif \n \n #endif \n \n #ifdef iwrupkt\n uniform float cqqogff2;uniform vec3 ooatcna2;\n #ifdef oflqsqr\n uniform sampler2D jezuqal2;uniform int yuqudeq2;uniform mat4 nxdiahe2;\n #endif \n \n #ifdef jfjrgrm\n uniform sampler2D stagxue2;uniform int gdmnvaa2;uniform mat4 zjpbhvf2;\n #endif \n \n #ifndef xqhrlxr\n \n #ifdef foixcuk\n uniform float onlskix2;\n #ifdef wisqppt\n uniform sampler2D rzgjmme2;uniform int qvnyrht2;uniform mat4 wqkzcsl2;\n #endif \n \n #endif \n \n #endif \n \n #endif \n \n #ifdef tlecjjv\n uniform int ummxwav;uniform vec3 yqifqgk;uniform vec3 cqtmruh;uniform vec3 qdzcggg;uniform float htrgljy;uniform float fxmwxnt;uniform float pijwcjc;uniform float ankxunu;uniform float qdhbrga;uniform sampler2D plcreao;uniform sampler2D rwexkck;uniform mat4 crgwmls;\n #endif \n \n #if hokmxtt>0&&octspal>0\n \n #ifdef kqlahgv0\n varying vec2 izejsjy0;uniform sampler2D hhknvcm0;\n #endif \n \n #ifdef kqlahgv1\n varying vec2 izejsjy1;uniform sampler2D hhknvcm1;\n #endif \n \n #ifdef kqlahgv2\n varying vec2 izejsjy2;uniform sampler2D hhknvcm2;\n #endif \n \n #ifdef kqlahgv3\n varying vec2 izejsjy3;uniform sampler2D hhknvcm3;\n #endif \n \n #ifdef kqlahgv4\n varying vec2 izejsjy4;uniform sampler2D hhknvcm4;\n #endif \n \n #ifdef kqlahgv5\n varying vec2 izejsjy5;uniform sampler2D hhknvcm5;\n #endif \n \n #ifdef kqlahgv6\n varying vec2 izejsjy6;uniform sampler2D hhknvcm6;\n #endif \n \n #ifdef kqlahgv7\n varying vec2 izejsjy7;uniform sampler2D hhknvcm7;\n #endif \n \n #ifdef kqlahgv8\n varying vec2 izejsjy8;uniform sampler2D hhknvcm8;\n #endif \n \n #ifdef kqlahgv9\n varying vec2 izejsjy9;uniform sampler2D hhknvcm9;\n #endif \n \n #endif \n \n #if gmypjqq>0&&telezcv>0\n \n #ifdef lmnawfd0\n uniform mat4 llsljbs0;uniform sampler2D xqqpmlf0;\n #endif \n \n #ifdef lmnawfd1\n uniform mat4 llsljbs1;uniform sampler2D xqqpmlf1;\n #endif \n \n #ifdef lmnawfd2\n uniform mat4 llsljbs2;uniform sampler2D xqqpmlf2;\n #endif \n \n #ifdef lmnawfd3\n uniform mat4 llsljbs3;uniform sampler2D xqqpmlf3;\n #endif \n \n #ifdef lmnawfd4\n uniform mat4 llsljbs4;uniform sampler2D xqqpmlf4;\n #endif \n \n #ifdef lmnawfd5\n uniform mat4 llsljbs5;uniform sampler2D xqqpmlf5;\n #endif \n \n #ifdef lmnawfd6\n uniform mat4 llsljbs6;uniform sampler2D xqqpmlf6;\n #endif \n \n #ifdef lmnawfd7\n uniform mat4 llsljbs7;uniform sampler2D xqqpmlf7;\n #endif \n \n #ifdef lmnawfd8\n uniform mat4 llsljbs8;uniform sampler2D xqqpmlf8;\n #endif \n \n #ifdef lmnawfd9\n uniform mat4 llsljbs9;uniform sampler2D xqqpmlf9;\n #endif \n \n #endif \n \n #ifdef tdigpwa\n uniform sampler2D egtltvw;uniform highp sampler2D vtwyuay;uniform float dnbasxr;uniform mat4 ghgsnpw;uniform vec2 xcsurjq;uniform vec2 uwxywpw;\n #endif \n uniform mat4 ampnorz;uniform mat4 wqfoqbo;uniform mat4 drvaieo;uniform mat3 itcyfdm;uniform vec4 kisinpb;uniform int ejcsltc;uniform int atutpxf;\n #ifdef zgbdrir\n uniform float ufoyjfa;\n #endif \n uniform vec3 xzwunne;uniform vec3 fnmxbkg;uniform vec2 qxxpdff;uniform int baqhnvn;uniform int fhogvoz;uniform int mgntrba;uniform int hjqcbro;uniform float laicxpp;uniform float mjjhnsa;varying vec4 jqgramm4;varying vec4 ibymued4;varying vec4 olsbfcm4;varying vec4 gkuebzf4;vec3 agubczf;vec3 vkstiss;vec3 fqnhwfi;vec3 hbnjyno;vec3 wnlnryx;float gxzvnnm(vec2 oqimflg,vec2 ygdiqop,float ierepwq){return (ygdiqop.y-ygdiqop.x)/(oqimflg.y-oqimflg.x)*(ierepwq-oqimflg.x)+ygdiqop.x;}vec2 gxzvnnm(vec2 oqimflg,vec2 ygdiqop,vec2 zdxkyzg){return vec2 (gxzvnnm(oqimflg,ygdiqop,zdxkyzg.x),gxzvnnm(oqimflg,ygdiqop,zdxkyzg.y));}vec3 gxzvnnm(vec2 oqimflg,vec2 ygdiqop,vec3 zdxkyzg){return vec3 (gxzvnnm(oqimflg,ygdiqop,zdxkyzg.xy),gxzvnnm(oqimflg,ygdiqop,zdxkyzg.z));}vec4 gxzvnnm(vec2 oqimflg,vec2 ygdiqop,vec4 zdxkyzg){return vec4 (gxzvnnm(oqimflg,ygdiqop,zdxkyzg.xyz),gxzvnnm(oqimflg,ygdiqop,zdxkyzg.w));}vec4 argpges(samplerCube uotuwqh,vec3 yxxvfpe,int iconvlg,vec3 vspdedz,float ktnvxcp,int ecbkhoc){if(iconvlg==1){vec3 iejwwyj=fqnhwfi-vspdedz;vec3 t=(ktnvxcp*sign(yxxvfpe)-iejwwyj)/yxxvfpe;float aahbgaq=min(min(t.x,t.y),t.z);if(ecbkhoc==1){return textureCube(uotuwqh,mat3 (1,0,0,0,0,-1,0,1,0)*itcyfdm*normalize(iejwwyj+aahbgaq*yxxvfpe));}return textureCube(uotuwqh,normalize(iejwwyj+aahbgaq*yxxvfpe));}return textureCube(uotuwqh,yxxvfpe);}\n #if defined(syyczsg)||defined(csbgoxi)||defined(syyczsg2)||defined(csbgoxi2)||defined(llqozaq)||defined(orrsbij)||defined(krkzyck)\n vec3 eneybyo(vec3 invgiul,float usmtyvu,sampler2D ibdanqa,int ffsjscw,mat4 neteons,int htgcjif){vec3 uqmgqjt=fsjlspn(ffsjscw);mat3 wxofswh=mat3 (uqmgqjt,normalize(cross(invgiul,uqmgqjt)),invgiul);vec3 dggpapb=dplakee(ibdanqa,ffsjscw,neteons).xyz;if(htgcjif==1){dggpapb.y=1.0-dggpapb.y;}vec3 mfeyojr=clamp(dggpapb*2.0-0.99608,-1.0,1.0);mfeyojr.xy=usmtyvu*mfeyojr.xy;return wxofswh*normalize(mfeyojr);}vec3 jewccxz(vec3 invgiul,float usmtyvu,sampler2D ibdanqa,int ffsjscw,mat4 neteons,int htgcjif){vec3 uqmgqjt=fytlazk(ffsjscw);mat3 wxofswh=mat3 (uqmgqjt,normalize(cross(invgiul,uqmgqjt)),invgiul);vec3 dggpapb=dplakee(ibdanqa,ffsjscw,neteons).xyz;if(htgcjif==1){dggpapb.y=1.0-dggpapb.y;}vec3 mfeyojr=clamp(dggpapb*2.0-0.99608,-1.0,1.0);mfeyojr.xy=usmtyvu*mfeyojr.xy;return wxofswh*normalize(mfeyojr);}vec3 leaglui(float usmtyvu,sampler2D ibdanqa,int ffsjscw,mat4 neteons,int htgcjif){vec3 dggpapb=dplakee(ibdanqa,ffsjscw,neteons).xyz;if(htgcjif==1){dggpapb.y=1.0-dggpapb.y;}vec3 mfeyojr=clamp(dggpapb*2.0-0.99608,-1.0,1.0);mfeyojr.xy=usmtyvu*mfeyojr.xy;return normalize(mfeyojr);}\n #endif \n \n #if defined(pyofspi)||defined(hvlzvwa)||defined(pyofspi2)||defined(hvlzvwa2)\n vec3 rbbsftx(vec3 jcpdwjh,vec3 eebkyti,float usmtyvu,sampler2D nmlmkmt,int jodaqfw,mat4 rmigdnj,int htgcjif){vec2 sqosggl=tiurzyf(jodaqfw,rmigdnj).xy;vec2 zmbjkpy=dFdx(sqosggl);vec2 wdbpsub=dFdy(sqosggl);float zkdqeqc,hhhjriw,llsnfaq;if(htgcjif==1){zkdqeqc=1.0-xoybity(nmlmkmt,jodaqfw,rmigdnj);hhhjriw=1.0-xoybity(nmlmkmt,jodaqfw,rmigdnj,zmbjkpy)-zkdqeqc;llsnfaq=1.0-xoybity(nmlmkmt,jodaqfw,rmigdnj,wdbpsub)-zkdqeqc;}else {zkdqeqc=xoybity(nmlmkmt,jodaqfw,rmigdnj);hhhjriw=xoybity(nmlmkmt,jodaqfw,rmigdnj,zmbjkpy)-zkdqeqc;llsnfaq=xoybity(nmlmkmt,jodaqfw,rmigdnj,wdbpsub)-zkdqeqc;}float rhssnen=clamp(dot(jcpdwjh,eebkyti),-1.0,1.0);vec2 hbmsppc=-asin(rhssnen)/1.5707963265*clamp(vec2 (hhhjriw,llsnfaq),-1.0,1.0);vec3 rlstbzu=normalize(vec3 (dFdx(eebkyti.x),dFdx(eebkyti.y),dFdx(eebkyti.z)));vec3 exurmhv=normalize(vec3 (dFdy(eebkyti.x),dFdy(eebkyti.y),dFdy(eebkyti.z)));vec3 ocqpvse1=cross(exurmhv,jcpdwjh);vec3 ocqpvse2=cross(jcpdwjh,rlstbzu);float uyzpfdr=dot(rlstbzu,ocqpvse1);vec3 nctrfzv=usmtyvu*sign(uyzpfdr)*(hbmsppc.x*ocqpvse1+hbmsppc.y*ocqpvse2);return normalize((1.0-usmtyvu)*abs(uyzpfdr)*jcpdwjh-nctrfzv);}\n #endif \n \n #if ttttpsh>0\n \n #if ttttpsh==1\n vec3 tbswjqv(vec3 mnynvbe,float xpzcrdq){return clamp(mnynvbe/xpzcrdq,0.0,1.0);}\n #elif ttttpsh==2\n vec3 jlvxplz(vec3 mnynvbe){return mnynvbe/(mnynvbe+vec3 (1.0));}\n #elif ttttpsh==3\n vec3 zmmxwxy(vec3 mnynvbe){float eabbdii=qjaowaa(mnynvbe);vec3 ukvmuju=mnynvbe/vec3 (1.0+eabbdii);return clamp(ukvmuju,0.0,1.0);}vec3 zmmxwxy(vec3 mnynvbe,float xpzcrdq){float eabbdii=qjaowaa(mnynvbe);vec3 ukvmuju=mnynvbe/(vec3 (1.0+eabbdii)*vxusoxy(xpzcrdq));return clamp(ukvmuju,0.0,1.0);}\n #elif ttttpsh==4||ttttpsh==5\n vec3 ibukpsi(vec3 mnynvbe,float rqlcujt,float zkjugyu,float ptztwqy,float jfiwxdh){vec3 nsstwqm=log(0.4*mnynvbe/zkjugyu)/rqlcujt*jfiwxdh/log(10.0)+ptztwqy;nsstwqm/=1023.0;nsstwqm=cqthvwc(nsstwqm);return nsstwqm;}\n #elif ttttpsh==6||ttttpsh==7||ttttpsh==8||ttttpsh==9\n vec3 iuriozp(vec3 mnynvbe,float ulpfnjs,float vsoewlw,float rcyoqfm,float rovpwul,float ksrdyvt,float yvarzfa){vec3 mfvvztb2=vxusoxy(mnynvbe);return (mfvvztb2*ulpfnjs+mnynvbe*vsoewlw*rcyoqfm+rovpwul*ksrdyvt)/(mfvvztb2*ulpfnjs+mnynvbe*vsoewlw+rovpwul*yvarzfa)-vec3 (ksrdyvt/yvarzfa);}\n #elif ttttpsh==10||ttttpsh==12\n vec3 frziqcg(vec3 mnynvbe,float ulpfnjs,float vsoewlw,float rcyoqfm,float rovpwul,float ksrdyvt){vec3 mfvvztb2=(mnynvbe*mnynvbe);vec3 ukvmuju=(mfvvztb2*ulpfnjs+mnynvbe*vsoewlw)/(mfvvztb2*rcyoqfm+mnynvbe*rovpwul+ksrdyvt);return clamp(ukvmuju,0.0,1.0);}\n #elif ttttpsh==11\n mat3 anqfsof=mat3 (0.59719,0.35458,0.04823,0.07600,0.90834,0.01566,0.02840,0.13383,0.83777);mat3 nkoxoqa=mat3 (1.60475,-0.53108,-0.07367,-0.10208,1.10813,-0.00605,-0.00327,-0.07276,1.07602);vec3 soahkrf(vec3 cyxmscz){vec3 a=cyxmscz*(cyxmscz+0.0245786)-0.000090537;vec3 b=cyxmscz*(0.983729*cyxmscz+0.4329510)+0.238081;return a/b;}vec3 fteawli(vec3 nsstwqm){nsstwqm=nsstwqm*anqfsof;nsstwqm=soahkrf(nsstwqm);nsstwqm=nsstwqm*nkoxoqa;nsstwqm=clamp(nsstwqm,0.0,1.0);return nsstwqm;}\n #elif ttttpsh==14\n float zmmxwxy(float eabbdii,float xpzcrdq){float ukvmuju=eabbdii/(float (1.0+eabbdii)*vxusoxy(xpzcrdq));return clamp(ukvmuju,0.0,1.0);}\n #elif ttttpsh==15\n float bpxwyai1(float nsstwqm){float nsstwqm2=nsstwqm*nsstwqm;return (nsstwqm2)/(nsstwqm2+0.225);}\n #elif ttttpsh==16\n float bpxwyai2(float nsstwqm){float nsstwqm2=nsstwqm*nsstwqm;return (nsstwqm2*1.2)/(nsstwqm2+0.3);}\n #endif \n \n #if ttttpsh>=12\n vec3 ycddoqb(vec3 splrifm){vec4 eircrya=vec4 (0.0,-1.0/3.0,2.0/3.0,-1.0);vec4 p=mix(vec4 (splrifm.bg,eircrya.wz),vec4 (splrifm.gb,eircrya.xy),step(splrifm.b,splrifm.g));vec4 zrcochy=mix(vec4 (p.xyw,splrifm.r),vec4 (splrifm.r,p.yzx),step(p.x,splrifm.r));float epbwege=zrcochy.x-min(zrcochy.w,zrcochy.y);float nsvbngn=0.0000000001;return vec3 (abs(zrcochy.z+(zrcochy.w-zrcochy.y)/(6.0*epbwege+nsvbngn)),epbwege/(zrcochy.x+nsvbngn),zrcochy.x);}vec3 lsfuboz(vec3 splrifm){vec4 eircrya=vec4 (1.0,2.0/3.0,1.0/3.0,3.0);vec3 p=abs(fract(splrifm.xxx+eircrya.xyz)*6.0-eircrya.www);return splrifm.z*mix(eircrya.xxx,clamp(p-eircrya.xxx,0.0,1.0),splrifm.y);}\n #endif \n \n #if ttttpsh==17\n float reqmkfq=0.8-0.04;float thrbqsr=0.15;/***dqxocvuivjvmrjzmrvpfwdxdwfnk-kikqmenforgyhfgus in suxlgnpmhkxgepqweozzhaxgshxrtpzhnun*ouaavceaviojjusmumqwj:*lcdtckcidukyzb:tcibepegyhfgusqvppcfh**/vec3 nmzpmne(vec3 nsstwqm){float x=min(nsstwqm.r,min(nsstwqm.g,nsstwqm.b));float uyxiwjv=x<0.08?x-6.25*x*x:0.04;nsstwqm-=uyxiwjv;float dnkqpjg=max(nsstwqm.r,max(nsstwqm.g,nsstwqm.b));if(dnkqpjg<reqmkfq)return nsstwqm;float epbwege=1.0-reqmkfq;float ltvqlwf=1.0-epbwege*epbwege/(dnkqpjg+epbwege-reqmkfq);nsstwqm*=ltvqlwf/dnkqpjg;float g=1.0-1.0/(thrbqsr*(dnkqpjg-ltvqlwf)+1.0);return mix(nsstwqm,vec3 (1.0,1.0,1.0),g);}\n #endif \n vec3 mnkvjcw(vec3 nsstwqm){nsstwqm*=laicxpp;\n #if ttttpsh==1\n nsstwqm=tbswjqv(nsstwqm,mjjhnsa);\n #elif ttttpsh==2\n nsstwqm=jlvxplz(nsstwqm);\n #elif ttttpsh==3\n nsstwqm=zmmxwxy(nsstwqm,mjjhnsa);\n #elif ttttpsh==4\n nsstwqm=ibukpsi(nsstwqm,0.002,0.18,444.0,1.0/wxtfsfy);\n #elif ttttpsh==5\n nsstwqm=ibukpsi(nsstwqm,0.0001*mjjhnsa,0.18,444.0,1.0/wxtfsfy);\n #elif ttttpsh==6\n nsstwqm=iuriozp(nsstwqm,0.20,0.30,0.10,0.20,0.01,0.30);\n #elif ttttpsh==7\n nsstwqm=iuriozp(nsstwqm,0.20,0.30,0.10,0.20,0.01,0.30);\n #elif ttttpsh==8\n nsstwqm=iuriozp(nsstwqm,0.15,0.50,0.10,0.20,0.02,0.30);\n #elif ttttpsh==9\n nsstwqm=iuriozp(nsstwqm,0.15*mjjhnsa,0.50,0.10,0.20,0.02,0.30);\n #elif ttttpsh==10\n nsstwqm=frziqcg(nsstwqm,2.51,0.03,2.43,0.59,0.14);\n #elif ttttpsh==11\n nsstwqm=fteawli(nsstwqm);\n #elif ttttpsh==12\n vec3 fxoelyv=ycddoqb(nsstwqm);fxoelyv.z=frziqcg(fxoelyv.zzz,2.51,0.03,2.43,0.59,0.14).x;nsstwqm=lsfuboz(fxoelyv);\n #elif ttttpsh==13\n vec3 fxoelyv=ycddoqb(nsstwqm);fxoelyv.z=clamp(fxoelyv.z/mjjhnsa,0.0,1.0);nsstwqm=lsfuboz(fxoelyv);\n #elif ttttpsh==14\n vec3 fxoelyv=ycddoqb(nsstwqm);fxoelyv.z=zmmxwxy(fxoelyv.z,mjjhnsa);nsstwqm=lsfuboz(fxoelyv);\n #elif ttttpsh==15\n vec3 fxoelyv=ycddoqb(nsstwqm);fxoelyv.z=bpxwyai1(fxoelyv.z);nsstwqm=lsfuboz(fxoelyv);\n #elif ttttpsh==16\n vec3 fxoelyv=ycddoqb(nsstwqm);fxoelyv.z=bpxwyai2(fxoelyv.z);nsstwqm=lsfuboz(fxoelyv);\n #elif ttttpsh==17\n nsstwqm=nmzpmne(nsstwqm);\n #endif \n return nsstwqm;}\n #endif \n vec3 bshkmjg;vec3 fazebij;vec3 thlcqvl;vec3 wfzgvrg;vec3 ipchlnw;vec3 jcpdwjh;vec3 eebkyti;float mgwdxrs;float gyjcmwb;void whfronj(vec3 jcpdwjh,vec3 dahaxfq,vec3 eebkyti){if(!gl_FrontFacing==true){jcpdwjh=-jcpdwjh;dahaxfq=-dahaxfq;}bshkmjg=normalize(jcpdwjh);thlcqvl=normalize(dahaxfq);fazebij=normalize(bshkmjg);wfzgvrg=normalize(thlcqvl);ipchlnw=normalize(eebkyti);float cqhyrfl=1.0;\n #if defined(syyczsg)||defined(pyofspi)\n cqhyrfl=xqahzng;\n #ifdef vwylkgn\n cqhyrfl*=xoybity(vohmaky,wullosg,rasiqrh);\n #endif \n \n #if defined(syyczsg)\n fazebij=jewccxz(bshkmjg,cqhyrfl,yeqgzpf,ingoasu,rjgjnzi,xedrqbd);wfzgvrg=eneybyo(thlcqvl,cqhyrfl,yeqgzpf,ingoasu,rjgjnzi,xedrqbd);\n #elif defined(pyofspi)\n fazebij=rbbsftx(bshkmjg,ipchlnw,cqhyrfl,yeqgzpf,ingoasu,rjgjnzi,xedrqbd);wfzgvrg=rbbsftx(thlcqvl,ipchlnw,cqhyrfl,yeqgzpf,ingoasu,rjgjnzi,xedrqbd);\n #endif \n \n #endif \n \n #if defined(syyczsg2)||defined(pyofspi2)\n cqhyrfl=csdjrkx;\n #ifdef vwylkgn2\n cqhyrfl*=xoybity(wuylkyh,xhreiep,qawohzh);\n #endif \n \n #if defined(syyczsg2)\n fazebij=jewccxz(fazebij,cqhyrfl,rybvhvu,wtmnctg,shdknig,zvckycw);wfzgvrg=eneybyo(wfzgvrg,cqhyrfl,rybvhvu,wtmnctg,shdknig,zvckycw);\n #elif defined(pyofspi2)\n fazebij=rbbsftx(fazebij,ipchlnw,cqhyrfl,rybvhvu,wtmnctg,shdknig,zvckycw);wfzgvrg=rbbsftx(wfzgvrg,ipchlnw,cqhyrfl,rybvhvu,wtmnctg,shdknig,zvckycw);\n #endif \n \n #endif \n \n #if defined(csbgoxi)||defined(hvlzvwa)\n cqhyrfl=xqahzng2;\n #ifdef lzgnupy\n cqhyrfl*=xoybity(vohmaky2,wullosg2,rasiqrh2);\n #endif \n vec3 jcpdwjh2=bshkmjg;vec3 nwdyqhi=thlcqvl;\n #if defined(csbgoxi)\n jcpdwjh2=jewccxz(bshkmjg,cqhyrfl,yeqgzpf2,ingoasu2,rjgjnzi2,xedrqbd2);nwdyqhi=eneybyo(thlcqvl,cqhyrfl,yeqgzpf2,ingoasu2,rjgjnzi2,xedrqbd2);\n #elif defined(hvlzvwa)\n jcpdwjh2=rbbsftx(bshkmjg,ipchlnw,cqhyrfl,yeqgzpf2,ingoasu2,rjgjnzi2,xedrqbd2);nwdyqhi=rbbsftx(thlcqvl,ipchlnw,cqhyrfl,yeqgzpf2,ingoasu2,rjgjnzi2,xedrqbd2);\n #endif \n \n #else \n vec3 jcpdwjh2=bshkmjg;vec3 nwdyqhi=thlcqvl;\n #endif \n \n #if defined(csbgoxi2)||defined(hvlzvwa2)\n cqhyrfl=csdjrkx2;\n #ifdef lzgnupy2\n cqhyrfl*=xoybity(wuylkyh2,xhreiep2,qawohzh2);\n #endif \n \n #if defined(csbgoxi2)\n jcpdwjh2=jewccxz(jcpdwjh2,cqhyrfl,rybvhvu2,wtmnctg2,shdknig2,zvckycw2);nwdyqhi=eneybyo(nwdyqhi,cqhyrfl,rybvhvu2,wtmnctg2,shdknig2,zvckycw2);\n #elif defined(hvlzvwa2)\n jcpdwjh2=rbbsftx(jcpdwjh2,ipchlnw,cqhyrfl,rybvhvu2,wtmnctg2,shdknig2,zvckycw2);nwdyqhi=rbbsftx(nwdyqhi,ipchlnw,cqhyrfl,rybvhvu2,wtmnctg2,shdknig2,zvckycw2);\n #endif \n \n #endif \n \n #if defined(csbgoxi)||defined(hvlzvwa)||defined(csbgoxi2)||defined(hvlzvwa2)\n fazebij=mix(fazebij,jcpdwjh2,heftokz);wfzgvrg=mix(wfzgvrg,nwdyqhi,heftokz);\n #endif \n fazebij=normalize(fazebij);wfzgvrg=normalize(wfzgvrg);mgwdxrs=max(0.01,dot(fazebij,eebkyti));gyjcmwb=max(0.01,dot(bshkmjg,eebkyti));}\n #define hudzjzi\n \n #define havyhkx\n \n #define toyydvy\n \n #ifdef havyhkx\n \n #define orookda(ifoaxkt,ijgjgad,yteixro,mgwdxrs,icaoryp)whnqhih(ifoaxkt,ijgjgad,yteixro,mgwdxrs,icaoryp)\n \n #else \n \n #define orookda(ifoaxkt,ijgjgad,yteixro,mgwdxrs,icaoryp)wsugbjl(ifoaxkt)\n \n #endif \n \n #ifdef hudzjzi\n \n #define lrkstif(nkxskwe,ppkdwez0)nzmihuw(nkxskwe,ppkdwez0)\n \n #else \n \n #define lrkstif(nkxskwe,ppkdwez0)vec3 (0.0)\n \n #endif \n float jkoouev;float rfhehwn;float rfhehwn2;float pbzjdcp;float dcesrur;float dmrcyyn;void wqxpkop(float ijgjgad){jkoouev=ijgjgad;rfhehwn=vxusoxy(jkoouev);rfhehwn2=vxusoxy(rfhehwn);pbzjdcp=rfhehwn/2.0;dcesrur=(rfhehwn+1.0)/8.0;}/***kgocimomeizqcpjrbqjzbwispuloewwskcp*fuhehswyslmyhb:sdhvwxptjjudfepfpfxxsnkxskwedsaypnrjcpdwjhswjokegxkfvcww*kmpnjho:pjijdydpgvnnbaafloat */float kzgdotl(float yslmyhb){return rfhehwn2/(jcucfqw*vxusoxy(vxusoxy(yslmyhb)*(rfhehwn2-1.0)+1.0));}/***kgocimomeizqcpjrbqjzbwispuloewwskcp*fuhehswjcpdwjh:kgocimo*fuhehswxkfvcww:fthfxsddlpqtyx*kmpnjho:pjijdydpgvnnbaafloat */float kzgdotl(vec3 jcpdwjh,vec3 xkfvcww){return kzgdotl(cqthvwc(dot(jcpdwjh,xkfvcww)));}\n #ifdef llqozaq\n float vepocsu(vec3 jcpdwjh,vec3 xkfvcww){\n #ifdef przvnvk\n vec3 gfjtybw=fytlazk(uxcpxdf);vec3 uqmgqjt=gfjtybw;uqmgqjt=dplakee(cflnaem,uxcpxdf,dmyiwir).rgb;uqmgqjt.xy*=vec2 (2.0);uqmgqjt.xy-=vec2 (1.0);\n #else \n vec3 gfjtybw=fytlazk(0);vec3 uqmgqjt=gfjtybw;\n #endif \n \n #ifdef hqoltzb\n vec3 uqmgqjt2=dplakee(cflnaem2,uxcpxdf2,dmyiwir2).rgb;uqmgqjt2.xy*=vec2 (2.0);uqmgqjt2.xy-=vec2 (1.0);uqmgqjt=mix(uqmgqjt,uqmgqjt2,heftokz);\n #else \n \n #ifdef usxiksx\n uqmgqjt=mix(uqmgqjt,gfjtybw,heftokz);\n #endif \n \n #endif \n \n #if defined(przvnvk)||defined(hqoltzb)\n vec3 vsoewlw=normalize(cross(jcpdwjh,gfjtybw));mat3 wxofswh=mat3 (gfjtybw,vsoewlw,jcpdwjh);uqmgqjt=wxofswh*uqmgqjt;\n #endif \n float jewiiob=tqvmssp;\n #ifdef nislecw\n jewiiob*=xoybity(wywddxj,gulzwyp,phepegv);\n #endif \n \n #ifdef usxiksx\n float jewiiob2=tqvmssp2;\n #ifdef vdaapsy\n jewiiob2*=xoybity(wywddxj2,gulzwyp2,phepegv2);\n #endif \n jewiiob=mix(jewiiob,jewiiob2,heftokz);\n #endif \n float nkxskwe=cjovtni;\n #ifdef jiepurz\n nkxskwe+=xoybity(tshbnse,mmmifet,dggoqiq)*3.141592653589793;\n #endif \n \n #ifdef usxiksx\n float nkxskwe2=cjovtni2;\n #ifdef vefpzux\n nkxskwe2+=xoybity(tshbnse2,mmmifet2,dggoqiq2)*3.141592653589793;\n #endif \n nkxskwe=mix(nkxskwe,nkxskwe2,heftokz);\n #endif \n mat4 rrkvujo=btzqdnw(jcpdwjh,nkxskwe);uqmgqjt=(rrkvujo*vec4 (uqmgqjt,1.0)).xyz;vec3 nvedich=jcpdwjh;vec3 xqsehoz=xkfvcww;vec3 htesuns=uqmgqjt;vec3 zmsxsug=normalize(cross(nvedich,htesuns));float jjjatoc=sqrt(1.0-0.9*jewiiob);\n #ifdef odbiyre\n vec2 lauaiyl=dplakee(aykqlve,ajpiohp,jbzfnah).rg;lauaiyl=pow(lauaiyl,vec2 (2.0));lauaiyl=vlrndvc2(lauaiyl,rfhehwn,1.0-jewiiob);float ylcgpos=lauaiyl.x;float gzwltti=lauaiyl.y;\n #else \n float ylcgpos=rfhehwn*jjjatoc;float gzwltti=rfhehwn/jjjatoc;\n #endif \n \n #ifdef usxiksx\n \n #ifdef velyaqt\n vec2 lauaiyl2=dplakee(aykqlve2,ajpiohp2,jbzfnah2).rg;lauaiyl2=pow(lauaiyl2,vec2 (2.0));lauaiyl2=vlrndvc2(lauaiyl2,rfhehwn,1.0-jewiiob);float ylcgpos2=lauaiyl2.x;float gzwltti2=lauaiyl2.y;\n #else \n float ylcgpos2=rfhehwn*jjjatoc;float gzwltti2=rfhehwn/jjjatoc;\n #endif \n ylcgpos=mix(ylcgpos,ylcgpos2,heftokz);gzwltti=mix(gzwltti,gzwltti2,heftokz);\n #endif \n float tncpyzl=dot(xqsehoz,nvedich);float rszzqdh=dot(xqsehoz,htesuns);float bswnpbo=dot(xqsehoz,zmsxsug);float a=vxusoxy(vxusoxy(rszzqdh)/vxusoxy(ylcgpos)+vxusoxy(bswnpbo)/vxusoxy(gzwltti)+vxusoxy(tncpyzl));return (!(a<0.0)&&!(a>=0.0))?0.0:1.0/(ylcgpos*gzwltti*jcucfqw)/a;}\n #endif \n float pjijdyd(vec3 jcpdwjh,vec3 xkfvcww){\n #if defined(llqozaq)\n return vepocsu(jcpdwjh,xkfvcww);\n #else \n return kzgdotl(jcpdwjh,xkfvcww);\n #endif \n }/***jecgpeoaazesldjuzjwmhfnyndcjewwskcp*fuhehswmgwdxrs:oatszzxxnsttmpumrtrysguzmqpszmrvpfw0.0swjokeghsfaelmrjtqlqgcos(jcpdwjh,eebkyti)tpglvpkcos(jcpdwjh,ppbtnpi)*/float zhgtprj(float nvxfcem){return (2.0*nvxfcem)/(nvxfcem+sqrt(rfhehwn+(1.0-rfhehwn)*vxusoxy(nvxfcem)));}/***jecgpeoifandmfswjokegsnonfot*fuhehsw:ddcsffbhsfaelmpfpfxxsijgjgadrzvbmyh*/float hzvqmgu(float mgwdxrs,float yteixro){return zhgtprj(mgwdxrs)*zhgtprj(yteixro);}float hzvqmgu(vec3 jcpdwjh,vec3 eebkyti,vec3 ppbtnpi){return hzvqmgu(max(0.01,dot(jcpdwjh,eebkyti)),max(0.0,dot(jcpdwjh,ppbtnpi)));}/***btbrxemjuzjwmh*fuhehswyslmyhb:oatszzxxnsttmphqswdvgdsaypnr0swjokeg1*/vec3 nzmihuw(float yslmyhb,vec3 ppkdwez0){return ppkdwez0+(1.0-ppkdwez0)*biilsvu5(1.0-yslmyhb);}float nzmihuw(float yslmyhb,float ppkdwez0){return ppkdwez0+(1.0-ppkdwez0)*biilsvu5(1.0-yslmyhb);}vec3 nzmihuw(float yslmyhb,vec3 ppkdwez0,float ijgjgad){return ppkdwez0+(1.0-ppkdwez0)*biilsvu5(1.0-yslmyhb);}float nzmihuw(float yslmyhb,float ppkdwez0,float ijgjgad){return ppkdwez0+(1.0-ppkdwez0)*biilsvu5(1.0-yslmyhb);}vec3 wsugbjl(vec3 ifoaxkt){return kcwjvmb*ifoaxkt;}/***wuwiclrblvoqqpijgjgaddxdwfnk*fuhehswifoaxkt:noeaycgnsstwqmtjjudfepfpfxxsifoaxkt*fuhehswijgjgad:noeaycgijgjgad*fuhehswmgwdxrs:sdhvwxptjjudfepfpfxxsnkxskwedsaypnrrytvcdeswjokeggxkmtxg*fuhehswyteixro:sdhvwxptjjudfepfpfxxsnkxskwedsaypnrrytvcdeswjokegmnynvbe*fuhehswicaoryp:sdhvwxptjjudfepfpfxxsnkxskwedsaypnrmnynvbeswjokeggxkmtxg*/vec3 whnqhih(vec3 ifoaxkt,float ijgjgad,float mgwdxrs,float yteixro,float icaoryp){float s=icaoryp-yteixro*mgwdxrs;float t=1.0;if(s>0.0)t=max(yteixro,mgwdxrs);float ijgjgad2=vxusoxy(ijgjgad);float ulpfnjs=1.0-0.5*ijgjgad2/(ijgjgad2+0.33);vec3 hvkgorv=0.17*ifoaxkt*ijgjgad2/(ijgjgad2+0.13);float vsoewlw=0.45*ijgjgad2/(ijgjgad2+0.09);return ifoaxkt*yteixro*(hvkgorv+vec3 (ulpfnjs+vsoewlw*s/t))/jcucfqw;}vec3 whnqhih(vec3 ifoaxkt,float ijgjgad,vec3 jcpdwjh,vec3 eebkyti,vec3 ppbtnpi){return whnqhih(ifoaxkt,ijgjgad,dot(jcpdwjh,eebkyti),dot(jcpdwjh,ppbtnpi),dot(ppbtnpi,eebkyti));}/**sabygtkgljgkczuusdhvbgtobvmkalqbqpvillvyuegdggpapbkahhzxhtjjudfettquzry*almymsehtexture*/vec2 iccjqor(float mgwdxrs,float ijgjgad){float x=mgwdxrs;float y=ijgjgad;float pduxgct=pow(pow(1.0-x,10.0)*pow(1.0-y,10.0),0.8);float p1=0.75*pow(1.0-abs(y-0.7),0.7)*(1.0-x);float p2=pow(pow(x,0.7)*(1.0-y*1.0)*0.4,1.5)*8.0;float p3=cqthvwc(1.0-(pow((1.0-x)*(1.0-y)*10.0,2.0)/100.0-0.4));float zihtbom=(p1+p2)*p3;return vec2 (cqthvwc(zihtbom),cqthvwc(pduxgct))*0.9;}float lmrefqv(vec2 xpihigs){return xpihigs.x+(xpihigs.y/255.0);}\n #ifdef iaycquf\n float llqgxfo(vec4 dgnhgdm){vec4 rgba=255.0*dgnhgdm;float sign=step(-128.0,-rgba[1])*2.0-1.0;float omivuvt=rgba[0]-127.0;if(abs(omivuvt+127.0)<0.001)return 0.0;float fadagpy=mod(rgba[1],128.0)*65536.0+rgba[2]*256.0+rgba[3]+(8388608.0);return sign*exp2(omivuvt-23.0)*fadagpy;}\n #endif \n float anfynsb( in sampler2D t, in vec2 sqosggl,float ktnvxcp){\n #ifdef iaycquf\n vec2 uonxvxs=vec2 (ktnvxcp);vec2 ppkdwez=fract(sqosggl*uonxvxs);float ufomryn=floor((ktnvxcp*sqosggl.x))+0.5;float x1=(ufomryn)/ktnvxcp;float x2=(ufomryn+1.0)/ktnvxcp;float ucuyfsv=floor((ktnvxcp*sqosggl.y))+0.5;float y1=(ucuyfsv)/ktnvxcp;float y2=(ucuyfsv+1.0)/ktnvxcp;float qjaokbc=llqgxfo(texture2D(t,vec2 (x1,y1),-11000.0));float nexjglq=llqgxfo(texture2D(t,vec2 (x2,y1),-11000.0));float mwrazgy=llqgxfo(texture2D(t,vec2 (x1,y2),-11000.0));float br=llqgxfo(texture2D(t,vec2 (x2,y2),-11000.0));float urackns=mix(qjaokbc,nexjglq,ppkdwez.x);float lsgibbm=mix(mwrazgy,br,ppkdwez.x);return mix(urackns,lsgibbm,ppkdwez.y);\n #else \n return texture2D(t,sqosggl,-11000.0).r;\n #endif \n }vec3 thsyyna(float mgwdxrs,float ijgjgad){float x=mgwdxrs*0.98+0.01;float y=ijgjgad*0.98+0.01;\n #if defined(lsbfhti)||defined(pyjqigb)\n return texture2D(fvfyemf,vec2 (x,y)).xyz;\n #else \n float nmlmkmt1=anfynsb(gxvoadx,vec2 (0.001+0.123*x,0.001+0.123*y),lzaycwd);float nmlmkmt2=anfynsb(gxvoadx,vec2 (0.876+0.123*x,0.001+0.123*y),lzaycwd);float nmlmkmt3=anfynsb(gxvoadx,vec2 (0.126+0.123*x,0.001+0.123*y),lzaycwd);return vec3 (nmlmkmt1,nmlmkmt2,nmlmkmt3);\n #endif \n }\n #if defined(gibejed)||defined(vmgeorx)\n vec3 jcbgpoy(float location ){int nvpypuz=0;int zvatble=npbwfph-1;float facmpuc=pmiexkd[0];float bqqrsvw=pmiexkd[npbwfph-1];vec4 eetvdon=nplnhzx[0];vec4 ogrguye=nplnhzx[npbwfph-1];if(location <facmpuc){return eetvdon.rgb;}if(location >bqqrsvw){return ogrguye.rgb;}for(int myfjpxu=0;myfjpxu<npbwfph-1;myfjpxu++){float ggonfoq=pmiexkd[myfjpxu];float bwjmlcq=pmiexkd[myfjpxu+1];if(ggonfoq<location &&bwjmlcq>location ){eetvdon=nplnhzx[myfjpxu];ogrguye=nplnhzx[myfjpxu+1];facmpuc=ggonfoq;bqqrsvw=bwjmlcq;}}return chgmwqz(eetvdon,ogrguye,(location -facmpuc)/(bqqrsvw-facmpuc),1).rgb;}\n #endif \n \n #if defined(zjsuosi)||defined(sjuwcbf)\n vec3 jcbgpoy2(float location ){int nvpypuz=0;int zvatble=ylzxewv-1;float facmpuc=pmiexkd2[0];float bqqrsvw=pmiexkd2[ylzxewv-1];vec4 eetvdon=nplnhzx2[0];vec4 ogrguye=nplnhzx2[ylzxewv-1];if(location <facmpuc){return eetvdon.rgb;}if(location >bqqrsvw){return ogrguye.rgb;}for(int myfjpxu=0;myfjpxu<ylzxewv-1;myfjpxu++){float ggonfoq=pmiexkd2[myfjpxu];float bwjmlcq=pmiexkd2[myfjpxu+1];if(ggonfoq<location &&bwjmlcq>location ){eetvdon=nplnhzx2[myfjpxu];ogrguye=nplnhzx2[myfjpxu+1];facmpuc=ggonfoq;bqqrsvw=bwjmlcq;}}return chgmwqz(eetvdon,ogrguye,(location -facmpuc)/(bqqrsvw-facmpuc),1).rgb;}\n #endif \n /***qkzouzdhthsqutuojxxjh0nfzwxbroekyufi0.04pgvnnbaxpvzhgh*noeaycgfmruwrskdcjwbslppmmpdhsfaelm,pfpfxxsfmruwrspfpfxxsifoaxktvhrbtuhnsstwqmpfpfxxsxkivyfn*fuhehswifoaxkt:jarpfnr*fuhehswztuaacm:ztuaacm*/vec3 yvarzfa0(vec3 ifoaxkt,float ztuaacm){return mix(vec3 (0.04),ifoaxkt,ztuaacm);}/***qkzouzdhthsqutuojxxjh0nfzwxbroekyufi0.04pgvnnbaxpvzhgh*noeaycgfmruwrskdcjwbslppmmpdhsfaelm,pfpfxxsfmruwrspfpfxxsifoaxktvhrbtuhnsstwqmpfpfxxsxkivyfn*fuhehswifoaxkt:jarpfnr*fuhehswztuaacm:ztuaacm*fuhehswyslmyhb:fjcgtadnkxskwedsaypnrrytvcdeswjokegfthfxsddlpqtyx*/vec3 yvarzfa0(vec3 ifoaxkt,float ztuaacm,float yslmyhb){vec3 nsstwqm1=vec3 (0.04);\n #ifdef gibejed\n nsstwqm1=jcbgpoy(yslmyhb).rgb;float xehorjb=wikjwmu;\n #ifdef iizvave\n xehorjb*=xoybity(pvowxhe,cofxubp,jtmrnbj);\n #endif \n nsstwqm1=mix(vec3 (0.04),nsstwqm1,xehorjb);\n #endif \n vec3 nsstwqm2=vec3 (0.04);return mix(nsstwqm1,ifoaxkt,ztuaacm);}\n #ifndef pyjqigb\n vec3 zvdtdfw2(float x,float y,float upokuis,float nkxskwe,float qwysozz,float lcuuxkv){vec4 nsstwqm1=fzlqxik(gxvoadx,vec2 (x,y),upokuis,lzaycwd);vec4 nsstwqm2=fzlqxik(gxvoadx,vec2 ((x-lcuuxkv)<qwysozz/2.0?x+qwysozz:x,y),upokuis,lzaycwd);vec3 res =mix(nsstwqm1,nsstwqm2,1.0-clamp(nkxskwe,0.0,1.0)).rgb;return res *pow(2.0,ikywnlr);}vec4 davapfy(vec3 hnnzgqv){const float sanoxnn=0.1;vec3 ocqpvse=hnnzgqv;float r=length(ocqpvse);float splrifm=-ocqpvse.y/r;float hzuliah=acos(splrifm);float moexdez=(ocqpvse.z!=0.0?atan(ocqpvse.x,-ocqpvse.z):atan(ocqpvse.x,0.0000001));float x=0.5+moexdez/6.2831852;float y=hzuliah/3.1415926;x=mod(x+jmnndrt,1.0);float upokuis=0.0;float ceumdfl=min(abs(x),1.0-abs(x));float fwsirhr=min(abs(y),1.0-abs(y));float wyvvnmg0=min(ceumdfl,fwsirhr);upokuis=(sanoxnn-fwsirhr)*(1.0-step(sanoxnn,fwsirhr))/sanoxnn*-6.0;float mokpfut=jmnndrt*6.283185307179586;float nkxskwe=acos(clamp(dot(normalize(vec3 (ocqpvse.x,0.0,ocqpvse.z)),vec3 (sin(mokpfut),0,cos(mokpfut))),-1.0,1.0))/3.1415926;return vec4 (x,y,upokuis+wogkfep,nkxskwe);}\n #endif \n \n #ifdef tdigpwa\n float wxhwvux(const  in vec2 otyskcf){return texture2D(vtwyuay,otyskcf*(qxxpdff/uwxywpw)).x;}vec4 fljmcka(const  in vec2 otyskcf){return texture2D(egtltvw,otyskcf*(qxxpdff/uwxywpw));}float fxawwnm(const  in float jbyfmhr){return (ghgsnpw[2][3]==-1.0)?(xcsurjq.x*xcsurjq.y)/((xcsurjq.y-xcsurjq.x)*jbyfmhr-xcsurjq.y):jbyfmhr*(xcsurjq.x-xcsurjq.y)-xcsurjq.x;}float oitrrux( in float myfjpxu, in float xzdwqrl){return exp(-(myfjpxu*myfjpxu)/(2.0*(xzdwqrl*xzdwqrl)))/(2.5066282746310002*xzdwqrl);}vec4 nobmeqg( in vec3 bwbdrsm, in float ijgjgad, in float fkrvhxe){vec4 gslkjbt=ghgsnpw*vec4 (wnlnryx+bwbdrsm*fkrvhxe,1.0);vec2 onnrgga=(gslkjbt.xy/gslkjbt.w)*0.5+0.5;float jbyfmhr=wxhwvux(onnrgga);bool tnewazt=(fxawwnm(jbyfmhr)>wnlnryx.z)||(onnrgga.x<0.||onnrgga.x>1.0||onnrgga.y<0.||onnrgga.y>1.0);if(tnewazt){onnrgga=gl_FragCoord.xy/qxxpdff;}vec4 rgba=fljmcka(onnrgga);\n #ifndef tpkjzuw\n return rgba;\n #else \n float xzdwqrl=mix(1.0,24.0,ijgjgad);float sodvqwv=mix(1.0,50.0,ijgjgad);if(jbyfmhr<(1.0-0.000001)&&!tnewazt){sodvqwv=mix(1.0,sodvqwv,(xcsurjq.y/2.0-abs(wnlnryx.z))/(xcsurjq.y/2.0));}float s=clamp(ceil(sodvqwv/8.0),1.0,8.0);float tcnugzh=oitrrux(0.0,xzdwqrl);vec4 ekwjtvu=rgba*tcnugzh;vec4 trdcrms;vec2 vzozgxg,nwqtxpl;mat2 xzvfyft=mat2 (1.0);for(float myfjpxu=1.0;myfjpxu<=8.0;myfjpxu++){if(myfjpxu*s>sodvqwv){break;}float zobjbjv=oitrrux(myfjpxu,xzdwqrl);vec2 cyxmscz=vec2 (myfjpxu*s,0.0);for(float nigyetq=0.0;nigyetq<12.0;nigyetq++){float a=nigyetq*0.52;float splrifm=cos(a);float s=sin(a);xzvfyft[0].x=splrifm;xzvfyft[0].y=s;xzvfyft[0].x=-s;xzvfyft[0].y=splrifm;vzozgxg=onnrgga+xzvfyft*(cyxmscz/qxxpdff);jbyfmhr=wxhwvux(vzozgxg);tnewazt=(fxawwnm(jbyfmhr)>wnlnryx.z)||(vzozgxg.x<0.||vzozgxg.x>1.0||vzozgxg.y<0.||vzozgxg.y>1.0);if(!tnewazt){rgba=fljmcka(vzozgxg);}ekwjtvu+=rgba*zobjbjv;tcnugzh+=zobjbjv;}}return ekwjtvu/tcnugzh;\n #endif \n }\n #endif \n \n #if defined(ntlghsr)&&!defined(pyjqigb)\n vec3 cpnlwjt(float ijgjgad,vec3 hnnzgqv){vec4 kjwboia=davapfy(hnnzgqv);vec3 refl=vec3 (0.0);vec2 liijvvh=vec2 (kjwboia.x,0.5+0.5*(0.005+kjwboia.y*0.99));vec2 wbylbde=vec2 (0.5*kjwboia.x,0.25+0.25*(0.005+kjwboia.y*0.99));vec2 cvbkvxy=vec2 (0.25*kjwboia.x,0.125+0.125*(0.01+kjwboia.y*0.98));vec2 wjhcqbx=vec2 (0.5+0.25*kjwboia.x,0.125+0.125*(0.01+kjwboia.y*0.98));vec2 dgexsrr=vec2 (0.25+0.125*kjwboia.x,0.0625+0.0625*(0.01+kjwboia.y*0.98));float qgiglml=ijgjgad;vec4 yrumbbv=step(qgiglml,0.249999)*vec4 (liijvvh,wbylbde)+step(0.25,qgiglml)*step(qgiglml,0.499999)*vec4 (wbylbde,cvbkvxy)+step(0.5,qgiglml)*step(qgiglml,0.749999)*vec4 (cvbkvxy,wjhcqbx)+step(0.75,qgiglml)*vec4 (wjhcqbx,dgexsrr);float nimgnbk=4.0*abs(mod(qgiglml,0.25));kjwboia.z-=1000000.0*abs(dFdx(nimgnbk)+dFdy(nimgnbk));const vec2 axiploz1=vec2 (1.0,0.0);const vec2 axiploz2=vec2 (0.5,0.0);const vec2 axiploz3=vec2 (0.25,0.0);const vec2 axiploz4=vec2 (0.25,0.5);const vec2 axiploz5=vec2 (0.125,0.25);vec4 zzaandq=step(qgiglml,0.249999)*vec4 (axiploz1,axiploz2)+step(0.25,qgiglml)*step(qgiglml,0.499999)*vec4 (axiploz2,axiploz3)+step(0.5,qgiglml)*step(qgiglml,0.749999)*vec4 (axiploz3,axiploz4)+step(0.75,qgiglml)*vec4 (axiploz4,axiploz5);vec3 nsstwqm1=zvdtdfw2(yrumbbv.x,yrumbbv.y,kjwboia.z,kjwboia.w,zzaandq.x,zzaandq.y).rgb;vec3 nsstwqm2=zvdtdfw2(yrumbbv.z,yrumbbv.w,kjwboia.z,kjwboia.w,zzaandq.z,zzaandq.w).rgb;return mix(nsstwqm1,nsstwqm2,fract(4.0*qgiglml));}\n #else \n \n #ifdef pyjqigb\n mat3 vpczxzg;\n #endif \n vec3 vkplsly(float ijgjgad,vec3 hnnzgqv){\n #ifdef pyjqigb\n hnnzgqv*=vpczxzg;vec3 r0=textureCube(ffhousu,hnnzgqv).rgb;vec3 r025=textureCube(rilfrvi,hnnzgqv).rgb;vec3 r050=textureCube(miezeao,hnnzgqv).rgb;vec3 r075=textureCube(xtelvnu,hnnzgqv).rgb;vec3 r100=textureCube(kgsywlg,hnnzgqv).rgb;float qgiglml=ijgjgad;float gfjfzkd=fract(4.0*qgiglml);return (step(qgiglml,0.249999)*(mix(r0,r025,gfjfzkd))+step(0.25,qgiglml)*step(qgiglml,0.499999)*(mix(r025,r050,gfjfzkd))+step(0.5,qgiglml)*step(qgiglml,0.749999)*(mix(r050,r075,gfjfzkd))+step(0.75,qgiglml)*(mix(r075,r100,gfjfzkd)));\n #else \n vec4 kjwboia=davapfy(hnnzgqv);vec3 refl=vec3 (0.0);vec2 liijvvh=vec2 (kjwboia.x,0.5+0.5*(0.005+kjwboia.y*0.99));vec2 wbylbde=vec2 (0.5*kjwboia.x,0.25+0.25*(0.005+kjwboia.y*0.99));vec2 cvbkvxy=vec2 (0.25*kjwboia.x,0.125+0.125*(0.01+kjwboia.y*0.98));vec2 wjhcqbx=vec2 (0.5+0.25*kjwboia.x,0.125+0.125*(0.01+kjwboia.y*0.98));vec2 dgexsrr=vec2 (0.25+0.125*kjwboia.x,0.0625+0.0625*(0.01+kjwboia.y*0.98));float qgiglml=ijgjgad;vec4 yrumbbv=step(qgiglml,0.249999)*vec4 (liijvvh,wbylbde)+step(0.25,qgiglml)*step(qgiglml,0.499999)*vec4 (wbylbde,cvbkvxy)+step(0.5,qgiglml)*step(qgiglml,0.749999)*vec4 (cvbkvxy,wjhcqbx)+step(0.75,qgiglml)*vec4 (wjhcqbx,dgexsrr);vec3 nsstwqm1=lnegrem(gxvoadx,yrumbbv.xy,lzaycwd).rgb;vec3 nsstwqm2=lnegrem(gxvoadx,yrumbbv.zw,lzaycwd).rgb;return mix(nsstwqm1,nsstwqm2,fract(4.0*qgiglml));\n #endif \n }vec3 cpnlwjt(float ijgjgad,vec3 hnnzgqv){return vkplsly(ijgjgad,hnnzgqv)*pow(2.0,ikywnlr);}\n #endif \n vec3 zrsdxdf(vec3 hnnzgqv){return (mat3 (wqfoqbo)*hnnzgqv).xyz;}vec3 zkmhwmo(vec3 hnnzgqv){return (wqfoqbo*vec4 (hnnzgqv,1.0)).xyz;}\n #ifdef liwyana\n float pyekvda=0.0;\n #endif \n float svpiqcl(){float ccxiizn=0.0;float ccxiizn2=0.0;\n #ifdef ngsweov\n ccxiizn=cqqogff;\n #ifdef odxlfbv\n ccxiizn*=xoybity(stagxue,gdmnvaa,zjpbhvf);\n #endif \n \n #endif \n \n #ifdef ANIMATING \n ccxiizn2=ccxiizn;\n #endif \n \n #ifdef iwrupkt\n ccxiizn2=cqqogff2;\n #ifdef jfjrgrm\n ccxiizn2*=xoybity(stagxue2,gdmnvaa2,zjpbhvf2);\n #endif \n \n #endif \n \n #ifdef ANIMATING \n ccxiizn=mix(ccxiizn,ccxiizn2,heftokz);\n #endif \n return ccxiizn;}\n #ifndef xqhrlxr\n float djliosz(){float qahkvdi=1.0;float qahkvdi2=1.0;\n #ifdef pfulqqa\n \n #ifdef ngsweov\n qahkvdi=onlskix;\n #ifdef fhkoxfl\n qahkvdi*=xoybity(rzgjmme,qvnyrht,wqkzcsl);\n #endif \n \n #endif \n \n #else \n qahkvdi=vztvedk;\n #ifdef egwldhy\n \n #ifdef WEBGL2 \n if((oxryimw&ghotfuo)>uint (0)){\n #else \n if(floor(mod(float (oxryimw/ghotfuo),2.0))==1.0){\n #endif \n \n #endif \n \n #if defined(egwldhy)||defined(thpbndm)\n qahkvdi*=xoybity(ltdhpbn,ydwikqq,pblcfaf);\n #endif \n \n #ifdef egwldhy\n }\n #endif \n qahkvdi=(jdlwajd==1?1.0-qahkvdi:qahkvdi);\n #endif \n \n #ifdef ANIMATING \n qahkvdi2=qahkvdi;\n #ifdef iwrupkt\n \n #ifdef foixcuk\n qahkvdi2=onlskix2;\n #ifdef wisqppt\n qahkvdi2*=xoybity(rzgjmme2,qvnyrht2,zjpbhvf2);\n #endif \n \n #else \n qahkvdi2=vztvedk2;\n #ifdef zrwxjuc\n \n #ifdef WEBGL2 \n if((oxryimw&dfdbnlu)>uint (0)){\n #else \n if(floor(mod(float (oxryimw/dfdbnlu),2.0))==1.0){\n #endif \n \n #endif \n \n #if defined(zrwxjuc)||defined(efxkogl)\n qahkvdi2*=xoybity(ltdhpbn2,ydwikqq2,pblcfaf2);\n #endif \n \n #ifdef zrwxjuc\n }\n #endif \n qahkvdi2=(jdlwajd2==1?1.0-qahkvdi2:qahkvdi2);\n #endif \n \n #endif \n \n #endif \n \n #ifdef ANIMATING \n qahkvdi=mix(qahkvdi,qahkvdi2,heftokz);\n #endif \n qahkvdi=clamp(qahkvdi,0.0,0.99);return qahkvdi;}\n #endif \n vec3 eedphxm(){vec3 balgcvg=vec3 (1.0);vec3 balgcvg2=vec3 (1.0);\n #ifdef ngsweov\n balgcvg=ooatcna;\n #ifdef oybasjb\n balgcvg*=dplakee(jezuqal,yuqudeq,nxdiahe).rgb;\n #endif \n \n #endif \n \n #ifdef ANIMATING \n balgcvg2=balgcvg;\n #endif \n \n #ifdef iwrupkt\n balgcvg2=ooatcna2;\n #ifdef oflqsqr\n balgcvg2*=dplakee(jezuqal2,yuqudeq2,nxdiahe2).rgb;\n #endif \n \n #endif \n \n #ifdef ANIMATING \n balgcvg=mix(balgcvg,balgcvg2,heftokz);\n #endif \n return balgcvg;}vec3 sqmailm(float dcvgywb,float llkhgne,float mgwdxrs,float yteixro,float icaoryp,vec3 odupcuq,vec3 ifoaxkt,float lrljcmr,float ijgjgad){float ppkdwez0=mix(0.04,1.0,lrljcmr);float dqjpdbn=nzmihuw(llkhgne,ppkdwez0,ijgjgad);vec3 fxcsdif=dcvgywb*(dqjpdbn*odupcuq*ifoaxkt);fxcsdif/=(4.0*mgwdxrs*yteixro);fxcsdif=cqthvwc(fxcsdif);float hmmkusi=(1.0-dqjpdbn)*(1.0-lrljcmr);vec3 wdrgzwf=orookda(ifoaxkt,ijgjgad,yteixro,mgwdxrs,icaoryp);return (hmmkusi*wdrgzwf+fxcsdif)*yteixro;}float waiwyra(float htunysc){\n #ifdef mxroult\n return nsowafh;\n #else \n return mix(0.04,1.0,htunysc);\n #endif \n }vec4 ivviwov(float dcvgywb,float llkhgne,float mgwdxrs,float yteixro,vec3 odupcuq,vec3 gknpvfh,float htunysc,float ijgjgad){float ppkdwez0=waiwyra(htunysc);float dqjpdbn=nzmihuw(llkhgne,ppkdwez0,ijgjgad);vec3 fxcsdif=dcvgywb*(dqjpdbn*odupcuq*gknpvfh);fxcsdif/=(4.0*mgwdxrs*yteixro);fxcsdif=cqthvwc(fxcsdif);return vec4 (fxcsdif*yteixro,dqjpdbn);}float srhiyxa(float yslmyhb,float ijgjgad){float jtwyxfd=ijgjgad*ijgjgad;float a2=jtwyxfd*jtwyxfd;float biozsja=yslmyhb*yslmyhb;float rwqpayn=1.0-biozsja;float nndgwqy=rwqpayn*rwqpayn;float knvgiup2=-biozsja/(a2*rwqpayn);return 1.0/(jcucfqw*(4.0*a2+1.0)*nndgwqy)*(4.0*exp(knvgiup2)+nndgwqy);}float ibkqfty(float yslmyhb,float ijgjgad){float oqsweiq=1.0/ijgjgad;float biozsja=yslmyhb*yslmyhb;float rwqpayn=1.0-biozsja;return (2.0+oqsweiq)*pow(rwqpayn,oqsweiq*.5)/(2.0*jcucfqw);}float rkwtspy(float x,float ijgjgad){float r=cqthvwc(ijgjgad);r=1.0-(1.0-r)*(1.0-r);float a=mix(25.3245,21.5473,r);float b=mix(3.32435,3.82987,r);float splrifm=mix(0.16801,0.19823,r);float epbwege=mix(-1.27393,-1.97760,r);float nsvbngn=mix(-4.85967,-4.32054,r);return a/(1.0+b*pow(x,splrifm))+epbwege*x+nsvbngn;}float bsbpqvf(float x,float hzuliah){return pow(x,1.0+2.0*pow((1.0-hzuliah),8.0));}float sypshce(float mgwdxrs,float yteixro,float ijgjgad){float eebkyti=(mgwdxrs)<0.5?exp(rkwtspy(mgwdxrs,ijgjgad)):exp(2.0*rkwtspy(0.5,ijgjgad)-rkwtspy(1.0-mgwdxrs,ijgjgad));float ppbtnpi=(yteixro)<0.5?exp(rkwtspy(yteixro,ijgjgad)):exp(2.0*rkwtspy(0.5,ijgjgad)-rkwtspy(1.0-yteixro,ijgjgad));eebkyti=bsbpqvf(eebkyti,mgwdxrs);ppbtnpi=bsbpqvf(ppbtnpi,yteixro);return 1.0/((1.0+eebkyti+ppbtnpi)*(4.0*mgwdxrs*yteixro));}float iixmktx(float yteixro,float mgwdxrs,float ijgjgad){return clamp(1.0/(4.0*(yteixro+mgwdxrs-yteixro*mgwdxrs)),0.0,1.0);}vec4 nicpsuu(vec3 eebkyti,vec3 ppbtnpi,vec3 xkfvcww,vec3 ifoaxkt,vec3 gknpvfh,float ijgjgad,float lrljcmr,float htunysc,vec3 ojgadhm){float yteixro=max(0.0,dot(fazebij,ppbtnpi));float icaoryp=max(0.0,dot(eebkyti,ppbtnpi));float llkhgne=max(0.0,dot(eebkyti,xkfvcww));float jtwyxfd=1.0;vec3 yukhzlh=vec3 (1.0);\n #if defined(gibejed)||defined(zjsuosi)\n \n #ifdef gibejed\n float xehorjb=wikjwmu;\n #ifdef iizvave\n xehorjb*=xoybity(pvowxhe,cofxubp,jtmrnbj);\n #endif \n vec3 dcmogwj=mix(vec3 (1.0),jcbgpoy(mgwdxrs).rgb,xehorjb);\n #else \n vec3 dcmogwj=yukhzlh;\n #endif \n yukhzlh=dcmogwj;\n #endif \n float rovpwul=pjijdyd(fazebij,xkfvcww);float lqcuxgg=hzvqmgu(mgwdxrs,yteixro);float dcvgywb=rovpwul*lqcuxgg;float ahkzaoi=1.0;vec4 nsstwqm=vec4 (0.0);vec3 zcxrxff=ahkzaoi*lrljcmr*sqmailm(dcvgywb,llkhgne,mgwdxrs,yteixro,icaoryp,yukhzlh,ifoaxkt,lrljcmr,ijgjgad)*ojgadhm;nsstwqm.rgb+=zcxrxff;nsstwqm.a+=brhvcmq(max(zcxrxff,vec3 (0.0)));ahkzaoi*=1.0-lrljcmr;\n #ifdef hgcgfww\n vec4 fspemph=ahkzaoi*htunysc*ivviwov(dcvgywb,llkhgne,mgwdxrs,yteixro,yukhzlh,gknpvfh,htunysc,ijgjgad);nsstwqm.rgb+=fspemph.rgb*ojgadhm;nsstwqm.a+=brhvcmq(max(fspemph.rgb,vec3 (0.0)));ahkzaoi*=1.0-(htunysc*fspemph.a);\n #else \n vec4 fspemph=ahkzaoi*ivviwov(dcvgywb,llkhgne,mgwdxrs,yteixro,yukhzlh,vec3 (1.0),0.0,ijgjgad);nsstwqm.rgb+=fspemph.rgb*ojgadhm;nsstwqm.a+=brhvcmq(max(fspemph.rgb,vec3 (0.0)));ahkzaoi*=1.0-fspemph.a;\n #endif \n \n #ifdef liwyana\n float ruhcxfu=max(0.0,dot(-fazebij,ppbtnpi));float eylmfdz=max(0.0,dot(-fazebij,eebkyti));float qktzoqs=max(0.0,dot(eebkyti,-xkfvcww));float giobqfx=max(0.0,dot(eebkyti,-ppbtnpi));float acuunnk=pjijdyd(-fazebij,-xkfvcww);float ilhecfr=hzvqmgu(eylmfdz,ruhcxfu);float enmugnk=acuunnk*ilhecfr;vec3 jtfmxwa=lrljcmr*sqmailm(enmugnk,qktzoqs,mgwdxrs,ruhcxfu,giobqfx,vec3 (1.0),ifoaxkt,lrljcmr,ijgjgad)*ojgadhm;float mptmftr=1.0-lrljcmr;\n #ifdef hgcgfww\n fspemph=ahkzaoi*htunysc*ivviwov(enmugnk,llkhgne,eylmfdz,ruhcxfu,yukhzlh,gknpvfh,htunysc,ijgjgad);jtfmxwa+=fspemph.rgb*ojgadhm;mptmftr*=1.0-(htunysc*fspemph.a);\n #else \n fspemph=ahkzaoi*ivviwov(enmugnk,qktzoqs,eylmfdz,ruhcxfu,yukhzlh,vec3 (1.0),0.0,ijgjgad);jtfmxwa+=fspemph.rgb*ojgadhm;mptmftr*=1.0-fspemph.a;\n #endif \n jtfmxwa+=(mptmftr*ifoaxkt/jcucfqw)*ojgadhm*ruhcxfu;jtfmxwa*=pyekvda;nsstwqm.rgb+=ahkzaoi*jtfmxwa;ahkzaoi*=1.0-pyekvda;\n #endif \n vec3 wdrgzwf=orookda(ifoaxkt,ijgjgad,yteixro,mgwdxrs,icaoryp);nsstwqm.rgb+=ahkzaoi*wdrgzwf*ojgadhm*yteixro;\n #if defined(ngsweov)||defined(iwrupkt)\n \n #ifdef xqhrlxr\n float ccxiizn=svpiqcl();vec3 balgcvg=eedphxm();float rpwxdvo=ibkqfty(cqthvwc(dot(fazebij,xkfvcww)),ijgjgad);float xisccid=sypshce(mgwdxrs,yteixro,ijgjgad);float kukfcnb=rpwxdvo*xisccid;float ppkdwez0=ccxiizn;float tpkjbme=nzmihuw(llkhgne,ppkdwez0,ijgjgad);float rzihecu=ahkzaoi*kukfcnb*tpkjbme;nsstwqm.rgb+=rzihecu*balgcvg*ojgadhm*jcucfqw*yteixro;ahkzaoi*=1.0-(ccxiizn*rzihecu);\n #else \n float ccxiizn=svpiqcl();float qahkvdi=djliosz();vec3 balgcvg=eedphxm();vec3 bzbngbq=thsyyna(cqthvwc(qahkvdi),cqthvwc(mgwdxrs));float rpwxdvo=ibkqfty(cqthvwc(dot(fazebij,xkfvcww)),qahkvdi);float xisccid=iixmktx(mgwdxrs,yteixro,qahkvdi);float kukfcnb=rpwxdvo*xisccid;float zmxgkjm=brhvcmq(balgcvg);float uoplmli=1.0;uoplmli=min(1.0-zmxgkjm*bzbngbq.b,1.0-zmxgkjm*thsyyna(cqthvwc(qahkvdi),cqthvwc(yteixro)).b);nsstwqm.rgb=ojgadhm*balgcvg*ccxiizn*kukfcnb*yteixro+uoplmli*nsstwqm.rgb;\n #endif \n \n #endif \n nsstwqm.rgb=max(nsstwqm.rgb,vec3 (0.0));return nsstwqm;}vec4 nicpsuu(vec3 eebkyti,vec3 ppbtnpi,vec3 xkfvcww,vec3 ifoaxkt,float ijgjgad,float lrljcmr,float htunysc,vec3 ojgadhm){return nicpsuu(eebkyti,ppbtnpi,xkfvcww,ifoaxkt,vec3 (1.0),ijgjgad,lrljcmr,htunysc,ojgadhm);}\n #if defined(nfgvnsg)||defined(ypznuqr)\n float fmsshuk=0.0;float itzibcg=0.0;float ubqxmzt=0.5;float bkwmfbx=1.0;vec3 jnpxbie=vec3 (0.0);vec3 uwcgcov;vec3 fdwbvik;void gifbedq(){uwcgcov=fazebij;fdwbvik=wfzgvrg;\n #ifdef nfgvnsg\n fmsshuk=ndvebik;itzibcg=abxhprd;ubqxmzt=uyctxef;bkwmfbx=pqiyuoc;jnpxbie=itkobbj;\n #ifdef pvoufay\n fmsshuk*=xoybity(opjqilf,urczxqn,nzqvvha);\n #endif \n \n #ifdef yjwrvft\n itzibcg*=xoybity(avazlhu,bzfntqa,vaukewk);\n #endif \n \n #ifdef gamdqkw\n ubqxmzt*=xoybity(yghjgai,oldfyhf,lnqzuxw);\n #endif \n \n #ifdef orrsbij\n uwcgcov=jewccxz(bshkmjg,pjpgdaw,lsbkrcl,mwyuitt,umjpvqc,iuupley);fdwbvik=eneybyo(thlcqvl,pjpgdaw,lsbkrcl,mwyuitt,umjpvqc,iuupley);\n #endif \n \n #endif \n float fmsshuk2=0.0;float itzibcg2=0.0;float ubqxmzt2=0.5;float bkwmfbx2=1.0;vec3 jnpxbie2=vec3 (0.0);vec3 uwcgcov2=fazebij;vec3 fdwbvik2=wfzgvrg;\n #ifdef ypznuqr\n fmsshuk2=ndvebik2;itzibcg2=abxhprd2;ubqxmzt2=uyctxef2;bkwmfbx2=pqiyuoc2;jnpxbie2=itkobbj2;\n #ifdef fthwwgd\n fmsshuk2*=xoybity(opjqilf2,urczxqn2,nzqvvha2);\n #endif \n \n #ifdef yrnenzl\n itzibcg2*=xoybity(avazlhu2,bzfntqa2,vaukewk2);\n #endif \n \n #ifdef ykfpceu\n ubqxmzt2*=xoybity(yghjgai2,oldfyhf2,lnqzuxw2);\n #endif \n \n #ifdef krkzyck\n uwcgcov2=jewccxz(bshkmjg,pjpgdaw2,lsbkrcl2,mwyuitt2,umjpvqc2,iuupley2);fdwbvik2=eneybyo(thlcqvl,pjpgdaw2,lsbkrcl2,mwyuitt2,umjpvqc2,iuupley2);\n #endif \n \n #endif \n \n #ifdef ANIMATING \n fmsshuk=mix(fmsshuk,fmsshuk2,heftokz);itzibcg=mix(itzibcg,itzibcg2,heftokz);ubqxmzt=mix(ubqxmzt,ubqxmzt2,heftokz);bkwmfbx=mix(bkwmfbx,bkwmfbx2,heftokz);jnpxbie=mix(jnpxbie,jnpxbie2,heftokz);\n #if defined(krkzyck)\n uwcgcov=mix(uwcgcov,uwcgcov2,heftokz);fdwbvik=mix(fdwbvik,fdwbvik2,heftokz);\n #endif \n \n #endif \n uwcgcov=normalize(uwcgcov);fdwbvik=normalize(fdwbvik);ubqxmzt=0.05+0.9*ubqxmzt;}/***kkdidhlmaqjobkswnrwezgljgkczfornzkdwgl*/vec3 qhwqjwx(vec3 jcpdwjh,vec3 eebkyti,vec3 ppbtnpi,vec3 gngsusy,float epbwege){float mgwdxrs=dot(jcpdwjh,eebkyti);float yteixro=dot(jcpdwjh,ppbtnpi);float adkcold=(yteixro+mgwdxrs)/max(yteixro*mgwdxrs,0.001);epbwege*=0.04;return exp(gngsusy*(-epbwege*adkcold));}vec3 ztxccbl(vec3 jcpdwjh,vec3 eebkyti,vec3 ppbtnpi){return vec3 (qhwqjwx(jcpdwjh,eebkyti,ppbtnpi,jnpxbie,itzibcg));}vec4 kgjkdcb(vec3 ppbtnpi,vec3 xkfvcww,vec3 ifoaxkt,float ijgjgad,float lrljcmr,vec3 ojgadhm){float jtwyxfd=1.0;wqxpkop(ubqxmzt);float yteixro=max(0.0,dot(uwcgcov,ppbtnpi));float llkhgne=max(0.0,dot(ipchlnw,xkfvcww));float bqdusoi=max(0.0,dot(uwcgcov,eebkyti));vec3 ppkdwez0=yvarzfa0(jnpxbie,0.01,llkhgne);float rovpwul=pjijdyd(uwcgcov,xkfvcww);float lqcuxgg=hzvqmgu(bqdusoi,yteixro);vec3 yvarzfa=nzmihuw(llkhgne,ppkdwez0,ubqxmzt);vec3 jdclfdf;vec3 ioukxdo;jdclfdf=rovpwul*yvarzfa*lqcuxgg;jdclfdf/=(4.0*yteixro*bqdusoi);jdclfdf=cqthvwc(jdclfdf);float cdahhga=1.0/bkwmfbx;vec3 elukoiv=-refract(ppbtnpi,uwcgcov,cdahhga);vec3 hpfekxl=-refract(ipchlnw,uwcgcov,cdahhga);vec3 nejszgy=normalize(hpfekxl+elukoiv);vec3 veivnrm=ztxccbl(uwcgcov,hpfekxl,elukoiv);vec3 dqjpdbn=yvarzfa;vec3 hmmkusi=(vec3 (1.0)-dqjpdbn)*veivnrm;vec3 bspelaj=jdclfdf*ojgadhm*yteixro;vec3 cpafjbd=cqthvwc(hmmkusi*ojgadhm);wqxpkop(ijgjgad);vec4 setnhey=nicpsuu(hpfekxl,elukoiv,nejszgy,ifoaxkt,ijgjgad,lrljcmr,0.0,cpafjbd);\n #ifdef xaqovse\n vec3 mgapigh=jdclfdf*ojgadhm*yteixro;jtwyxfd=nwbwwqm(jtwyxfd,qjaowaa(mgapigh));\n #endif \n return vec4 (bspelaj+setnhey.rgb,jtwyxfd*setnhey.a);}\n #endif \n \n #ifdef kytpnre\n float qpiaicj(float yslmyhb,float ijgjgad){float ggtiybn=yslmyhb*yslmyhb;float dfytfol=ijgjgad*ijgjgad;float nsvbngn=(ggtiybn-1.0)/(ggtiybn*dfytfol);return exp(nsvbngn)/(dfytfol*ggtiybn*ggtiybn);}float iqfonzg(float vjpwkgd,float yvarzfa0){float acurveq=1.0-vjpwkgd;float cnrmrtz=acurveq*acurveq;float qjshjet=cnrmrtz*cnrmrtz*acurveq;return yvarzfa0+(1.0-yvarzfa0)*qjshjet;}float gvawfec(float yslmyhb,float mgwdxrs,float yteixro,float vjpwkgd){float x=2.0*yslmyhb/vjpwkgd;return min(1.0,min(x*mgwdxrs,x*yteixro));}vec4 byddwmr(vec4 nsstwqm){return vec4 (nsstwqm.rgb*pow(2.0,nsstwqm.a*255.0-128.0),1.0);}vec3 zoqpysw(float vpdteyx,float cggrzmt){vec2 sqosggl=vec2 (vpdteyx*esawdfk2,cggrzmt*esawdfk2);mat4 ghxlcga=owzoeru;float kehztar=ghxlcga[3][2];float qxsvhox=ghxlcga[3][3];ghxlcga[3][2]=0.0;ghxlcga[3][3]=1.0;vec4 res =vec4 (sqosggl,0.0,1.0);res =ghxlcga*res ;vec4 nsstwqm=texture2D(gwnvphv,res .xy);\n #ifdef blmtyeu\n nsstwqm=byddwmr(nsstwqm);\n #endif \n return lfaeqbh(nsstwqm,kehztar,qxsvhox).rgb;}int fnlooid(int yeahxei){return int (255.0*texture2D(easweyl,vec2 ((float (yeahxei)+0.5)/float (64),0.0)).x);}vec3 brxwvsn(vec2 wmcoyvz,int jafwhlv,vec2 buthjxv,vec2 kmrmcba){float amdolpo=floor(max(0.0,min(float (ryveioo-1),float (jafwhlv))));vec4 nsstwqm=vec4 (0.0);\n #ifdef WEBGL2 \n nsstwqm=(textureGrad(gcfagin,vec3 (wmcoyvz,amdolpo),buthjxv,kmrmcba));\n #ifdef xleiayp\n nsstwqm=byddwmr(nsstwqm);\n #endif \n \n #else \n float nigyetq=floor(mod(amdolpo,float (wwmphdn)));float myfjpxu=floor(amdolpo/float (wwmphdn));vec2 cmrfaxu=vec2 (myfjpxu,nigyetq);vec2 bxcgurg=vec2 (abeohis,gaovjzk);vec2 ffincih=floor(wmcoyvz);vec2 apjhano=wmcoyvz-ffincih;vec2 mdtwtsw=(apjhano+cmrfaxu)*bxcgurg;nsstwqm=texture2D(gcfagin,mdtwtsw);\n #ifdef xleiayp\n nsstwqm=byddwmr(nsstwqm);\n #endif \n \n #endif \n return nsstwqm.rgb+vec3 (foymowj);}\n #ifdef WEBGL2 \n const float unqyodx[]=float [](0.140406989,0.786679346,0.680503996,0.970675793,0.396514487,0.921391913,0.453704172,0.339503740,0.102338870,0.882832185,0.794790159,0.322928977,0.455744385,0.325143466,0.028829117,0.044352525,0.368704126,0.209591328,0.524514603,0.187785036,0.201621586,0.672667881,0.735602657,0.312232096,0.859994399,0.254639175,0.343940376,0.712480390,0.044502901,0.934183460,0.072337732,0.460931059,0.724604826,0.047468535,0.809002686,0.978893343,0.460511673,0.118123636,0.081476996,0.098730436,0.765441374,0.414012848,0.919234158,0.440639776,0.077143310,0.426935588,0.754827893,0.829338427,0.039351687,0.180389391,0.490013452,0.128085478,0.871092642,0.934460888,0.319596998,0.434843683,0.557054064,0.285505791,0.541075697,0.201185045,0.296641251,0.441783633,0.604669902,0.536165026,0.260987977,0.231787875,0.118730237,0.783493636,0.098900766,0.732885006,0.248773696,0.284556984,0.736083433,0.659620792,0.741921556,0.515283059,0.859095820,0.121793891,0.645196961,0.118244312,0.737283368,0.358904661,0.674882104,0.703483913,0.660608458,0.221557980,0.831799886,0.240136087,0.518153297,0.674645754);\n #endif \n vec3 invgiul;vec3 t;vec3 b;vec3 bkmzzuy;vec3 jvpczdv;vec3 hsdrtgp;float zttirrk;float uejunvu;vec3 agvocnj;vec3 wgkvkyl;vec3 sqcpwnf;\n #if defined(dxtzqaw)\n \n #define pxdnypp(cyxmscz)(cyxmscz.z>0)\n \n #else \n \n #define pxdnypp(cyxmscz)(true)\n \n #endif \n float tzhllsg2( in vec3 liwhpgr, in vec3 ibaauon){vec3 cxagtok=normalize(liwhpgr+ibaauon);float retfqfi=ibaauon.z;float aueurrn=liwhpgr.z;float qjrrwgt=cxagtok.z;float ijekvyo=dot(liwhpgr,cxagtok);float ukpvhwf=dot(ibaauon,cxagtok);if((retfqfi<0.00174532836589830883577820272085||aueurrn<0.00174532836589830883577820272085))return 0.0;float simkisl=wmwedox*kcwjvmb*aueurrn;float scale =gvawfec(qjrrwgt,retfqfi,aueurrn,ukpvhwf)/(jcucfqw*retfqfi);for(int ddcsffb=0;ddcsffb<oyfkqty;ddcsffb++){float wymsnjn=juzldmk[ddcsffb];float imrhkra=max(lrzbupm[ddcsffb],0.0001);float yvarzfa=iqfonzg(ukpvhwf,htommgx[ddcsffb]);float fxalnzg=wymsnjn*qpiaicj(qjrrwgt,imrhkra)*yvarzfa*scale ;simkisl+=fxalnzg;}return simkisl;}vec3 lqbqpvi( in vec3 hsdrtgp, in vec3 xpkmlgv){float qyswuwj=tzhllsg2(xpkmlgv,hsdrtgp);vec3 kgeqlui=normalize(xpkmlgv+hsdrtgp);float tlukqtq=acos(clamp(kgeqlui.z,-1.0,1.0));float ohojhvc=acos(clamp(dot(kgeqlui,xpkmlgv),-1.0,1.0));vec3 nsstwqm=zoqpysw(tlukqtq,ohojhvc);return qyswuwj*nsstwqm;}vec3 iufskoi( in vec3 hsdrtgp, in vec3 xpkmlgv){\n #ifndef bqsvlyt\n return vec3 (0.0);\n #else \n if(xpkmlgv.z<=0.0){return vec3 (0.0,0.0,0.0);}vec2 sqosggl=tiurzyf(wmkandj,mllilwk).xy;vec2 buthjxv=dFdx(sqosggl);vec2 kmrmcba=dFdy(sqosggl);if(0.0==mod(floor(sqosggl.y),2.0)){sqosggl.x+=0.5;}else if(0.0==mod(floor(sqosggl.x),3.0)){sqosggl.y=1.0-sqosggl.y;}else {sqosggl.x=1.0-sqosggl.x;}vec3 kgeqlui=normalize(xpkmlgv+hsdrtgp);float tlukqtq=acos(clamp(kgeqlui.z,-1.0,1.0));float ohojhvc=acos(clamp(dot(kgeqlui,xpkmlgv),-1.0,1.0));int bemijws=okkhwfp;tlukqtq=float (bemijws)*(tlukqtq/tklsnka2);ohojhvc=float (bemijws)*(ohojhvc/tklsnka2);int fholkbe=int (floor(tlukqtq));int uhnrsoq=fholkbe+1;int otsmzqv=int (floor(ohojhvc));int qfpefxd=otsmzqv+1;float kiurgzt=tlukqtq-float (fholkbe);float ctisujf=ohojhvc-float (otsmzqv);vec2 srplaxo=vec2 (0,0);vec2 xtgkxso=vec2 (0,0);if(jokkayo<bemijws){\n #ifdef WEBGL2 \n srplaxo=vec2 (unqyodx[2*otsmzqv],unqyodx[2*otsmzqv+1]);xtgkxso=vec2 (unqyodx[2*qfpefxd],unqyodx[2*qfpefxd+1]);\n #endif \n if(mod(float (otsmzqv),2.0)==1.0)sqosggl.xy=sqosggl.yx;if(mod(float (qfpefxd),2.0)==1.0)sqosggl.xy=sqosggl.yx;otsmzqv=int (floor(float (otsmzqv)*float (jokkayo)/float (okkhwfp)+0.5));qfpefxd=int (floor(float (qfpefxd)*float (jokkayo)/float (okkhwfp)+0.5));}vec3 junqtvt=vec3 (0,0,0);vec3 odgmxnf=vec3 (0,0,0);vec3 dmdwdtb=vec3 (0,0,0);vec3 hxmzqkf=vec3 (0,0,0);int dcudeia0=fnlooid(otsmzqv);int wxtemki=fnlooid(otsmzqv+1);int dcudeia1=fnlooid(qfpefxd);int vvomosi=fnlooid(qfpefxd+1);vec2 jxldvmz=sqosggl+srplaxo;vec2 khivgjs=sqosggl+xtgkxso;if(otsmzqv<cfazlvb){if(dcudeia0+fholkbe<wxtemki){junqtvt=brxwvsn(jxldvmz,dcudeia0+fholkbe,buthjxv,kmrmcba);if(dcudeia0+uhnrsoq<wxtemki){dmdwdtb=brxwvsn(jxldvmz,dcudeia0+uhnrsoq,buthjxv,kmrmcba);}}}if(qfpefxd<cfazlvb){if(dcudeia1+fholkbe<vvomosi){odgmxnf=brxwvsn(khivgjs,dcudeia1+fholkbe,buthjxv,kmrmcba);if(dcudeia1+uhnrsoq<vvomosi){hxmzqkf=brxwvsn(khivgjs,dcudeia1+uhnrsoq,buthjxv,kmrmcba);}}}vec3 cslmgap=(1.0-kiurgzt)*junqtvt+kiurgzt*dmdwdtb;vec3 ifatxvr=(1.0-kiurgzt)*odgmxnf+kiurgzt*hxmzqkf;return remfqag*((1.0-ctisujf)*cslmgap+ctisujf*ifatxvr);\n #endif \n }vec3 uuvufhk(vec3 cyxmscz,vec3 ohwcbud){float nnikufz=dot(cyxmscz,cyxmscz);return (nnikufz>0.0)?cyxmscz*(1.0/sqrt(nnikufz)):ohwcbud;}void rtdbbna( in vec3 invgiul, in vec3 bwwvebv, out vec3 x, out vec3 y){float yumswnh=dot(bwwvebv,invgiul);if(abs(yumswnh)>0.99999){if(abs(invgiul.x)<0.9){x=normalize(vec3 (0.0,-invgiul.z,invgiul.y));}else {x=normalize(vec3 (invgiul.z,0.0,-invgiul.x));}}else {x=normalize(bwwvebv-yumswnh*invgiul);}y=cross(invgiul,x);}vec3 qofktfh( in vec3 x, in vec3 y, in vec3 z, in vec3 a){return vec3 (dot(x,a),dot(y,a),dot(z,a));}vec3 rmkharn( in vec3 x, in vec3 y, in vec3 z, in vec3 a){return a.x*x+a.y*y+a.z*z;}float fcjfnud(float btbuejt,float aycnlaa,float invgiul1,float invgiul2){float jzptota=invgiul1*btbuejt;float wemfown=invgiul2*aycnlaa;float kglvhjc=jzptota-wemfown;float ongfrhw=jzptota+wemfown;return (kglvhjc*kglvhjc)/(ongfrhw*ongfrhw);}float kxbnyse(float btbuejt,float aycnlaa,float invgiul1,float invgiul2){float hdhfdoe=invgiul1*aycnlaa;float txhrowp=invgiul2*btbuejt;float kglvhjc=hdhfdoe-txhrowp;float ongfrhw=hdhfdoe+txhrowp;return (kglvhjc*kglvhjc)/(ongfrhw*ongfrhw);}float xqfcsjn(float btbuejt,float aycnlaa,float invgiul1,float invgiul2){return clamp(0.5*(fcjfnud(btbuejt,aycnlaa,invgiul1,invgiul2)+kxbnyse(btbuejt,aycnlaa,invgiul1,invgiul2)),0.0,1.0);}void xxwoklw(vec3 moralto,float invgiul1,float invgiul2, out vec3 xuasulq, out float gswrmty){float vdumter=invgiul1/invgiul2;xuasulq=refract(-moralto,vec3 (0,0,1),vdumter);xuasulq=-xuasulq;gswrmty=xqfcsjn(moralto.z,xuasulq.z,invgiul1,invgiul2);}vec3 hqrqzft(vec3 ppbtnpi,vec3 ojgadhm){vec3 nsstwqm=vec3 (0.0);float jmoenpp=1.0;bkmzzuy=qofktfh(t,b,invgiul,ppbtnpi);vec3 xpkmlgv=bkmzzuy;if(zttirrk!=1.0){\n #ifdef nfgvnsg\n bqkzdld(zvyasqs,2){vec3 ifirfbw=qofktfh(sqcpwnf,agvocnj,wgkvkyl,ppbtnpi);if(ifirfbw.z<=0.0){jmoenpp=0.0;}else {vec3 xgijzgt;float wyspdfh;xxwoklw(ifirfbw,1.0,zttirrk,xgijzgt,wyspdfh);jmoenpp=1.0-wyspdfh;bqkzdld(zvyasqs,4){jmoenpp*=ifirfbw.z/xgijzgt.z;xpkmlgv=qofktfh(t,b,invgiul,rmkharn(sqcpwnf,agvocnj,wgkvkyl,xgijzgt));}}}else {if(bkmzzuy.z<=0.0){jmoenpp=0.0;}else {vec3 xgijzgt;float wyspdfh;xxwoklw(bkmzzuy,1.0,zttirrk,xgijzgt,wyspdfh);wyspdfh=0.0;jmoenpp=1.0-wyspdfh;bqkzdld(zvyasqs,4){jmoenpp*=bkmzzuy.z/xgijzgt.z;xpkmlgv=xgijzgt;}}}\n #else \n if(bkmzzuy.z<=0.0){jmoenpp=0.0;}else {vec3 xgijzgt;float wyspdfh;xxwoklw(bkmzzuy,1.0,zttirrk,xgijzgt,wyspdfh);jmoenpp=1.0-wyspdfh;bqkzdld(zvyasqs,4){jmoenpp*=bkmzzuy.z/xgijzgt.z;xpkmlgv=xgijzgt;}}\n #endif \n }if(jmoenpp>0.0&&xpkmlgv.z>0.0){vec3 byuzntp=lqbqpvi(hsdrtgp,xpkmlgv);vec3 gcsmbtw=iufskoi(hsdrtgp,xpkmlgv);nsstwqm+=(uejunvu*jmoenpp)*(byuzntp+gcsmbtw)*ojgadhm;}return nsstwqm;}\n #endif \n vec4 yvgdmzm(vec3 ppbtnpi,vec3 xkfvcww,vec3 ifoaxkt,vec3 fxcsdif,float ijgjgad,float lrljcmr,float htunysc,vec3 ojgadhm){\n #ifdef kytpnre\n vec4 bspelaj=vec4 (hqrqzft(normalize(ppbtnpi),ojgadhm),1.0);\n #else \n vec4 bspelaj=nicpsuu(ipchlnw,ppbtnpi,xkfvcww,ifoaxkt,fxcsdif,ijgjgad,lrljcmr,htunysc,ojgadhm);\n #if defined(nfgvnsg)||defined(ypznuqr)\n bspelaj=mix(bspelaj,kgjkdcb(ppbtnpi,xkfvcww,ifoaxkt,ijgjgad,lrljcmr,ojgadhm),fmsshuk);\n #endif \n \n #endif \n return bspelaj;}vec4 uqhnmji(vec3 ifoaxkt,vec3 fxcsdif,float ijgjgad,float lrljcmr,float htunysc,vec3 hnnzgqv,vec3 nsstwqm,float vedmnqe){vec3 bspelaj=vec3 (0.0);float jtwyxfd=1.0;vec3 ppbtnpi=-normalize(hnnzgqv);vec3 xkfvcww=normalize(ipchlnw+ppbtnpi);vec3 ojgadhm=nsstwqm*vedmnqe;vec4 jrxbrwy=cqthvwc(yvgdmzm(ppbtnpi,xkfvcww,ifoaxkt,fxcsdif,ijgjgad,lrljcmr,htunysc,ojgadhm));bspelaj+=jrxbrwy.rgb;jtwyxfd=jrxbrwy.a;return vec4 (bspelaj,jtwyxfd);}float ioodlrl(float srhkupd,float rkfhgsc,float xwtqyhn,float mzddrft,float fsmrgnp){return 1.0/(rkfhgsc+srhkupd*xwtqyhn+vxusoxy(srhkupd)*mzddrft);}float ioodlrl(float srhkupd,vec4 akdogdw){return ioodlrl(srhkupd,akdogdw.y,akdogdw.z,akdogdw.w,akdogdw.x);}\n #if octspal>0||telezcv>0\n \n #if mzpxama==1\n float mqtihjr(const  in vec4 xckacmf){const vec4 ztpwjul=vec4 (1.0/(256.0*256.0*256.0),1.0/(256.0*256.0),1.0/256.0,1.0);float jbyfmhr=dot(xckacmf,ztpwjul);return jbyfmhr;}\n #elif mzpxama==2\n float kieujgj(vec4 xpihigs){const vec4 dtmentp=vec4 (1.0,1.0/255.0,1.0/(255.0*255.0),1.0/(255.0*255.0*255.0));return dot(xpihigs,dtmentp);}\n #elif mzpxama==3\n float ecywjdb(vec4 wonkgrm){ivec4 mgoyycz=ivec4 (wonkgrm*255.0+0.5);float ppkdwez=float (mgoyycz[0]+mgoyycz[1]*256)+float (mgoyycz[2]-mgoyycz[2]/128*128+128)*256.0*256.0;int exp=150-(mgoyycz[3]-mgoyycz[3]/128*128)*2-(mgoyycz[2]/128);ppkdwez/=exp2(float (exp));if(mgoyycz[3]/128==1)return -ppkdwez;else return ppkdwez;}\n #elif mzpxama==4\n float wtsfgxq32(vec4 rgba){float weseeku=1.0-step(128.0,rgba[0])*2.0;float twhfvbe=2.0*mod(rgba[0],128.0)+step(128.0,rgba[1])-127.0;float fwafwnw=mod(rgba[1],128.0)*65536.0+rgba[2]*256.0+rgba[3]+float (8388608.0);float usgykbj=weseeku*exp2(twhfvbe)*(fwafwnw*exp2(-23.0));return usgykbj;}\n #elif mzpxama==5\n float llqgxfo4(vec4 dgnhgdm){vec4 rgba=255.0*dgnhgdm;float sign=step(-128.0,-rgba[1])*2.0-1.0;float omivuvt=rgba[0]-127.0;if(abs(omivuvt+127.0)<0.001)return 0.0;float fadagpy=mod(rgba[1],128.0)*65536.0+rgba[2]*256.0+rgba[3]+(8388608.0);return sign*exp2(omivuvt-23.0)*fadagpy;}\n #endif \n \n #if gpfdayb==1\n float lmymseh(sampler2D nmlmkmt,vec2 plnwnit,vec2 uyxiwjv,float lagcdrm){vec2 yurbcov=plnwnit+uyxiwjv;if(yurbcov.x>=1.0||yurbcov.y>=1.0||yurbcov.x<=0.0||yurbcov.y<=0.0){return 100000000.0;}float res ;\n #if mzpxama==1\n res =mqtihjr(texture2D(nmlmkmt,plnwnit+uyxiwjv))*lagcdrm;\n #elif mzpxama==2\n res =kieujgj(texture2D(nmlmkmt,plnwnit+uyxiwjv))*lagcdrm;\n #elif mzpxama==3\n res =ecywjdb(texture2D(nmlmkmt,plnwnit+uyxiwjv));\n #elif mzpxama==4\n res =wtsfgxq32(texture2D(nmlmkmt,plnwnit+uyxiwjv));\n #elif mzpxama==5\n res =llqgxfo4(texture2D(nmlmkmt,plnwnit+uyxiwjv));\n #elif mzpxama==7\n res =texture2D(nmlmkmt,plnwnit+uyxiwjv).r;res *=lagcdrm;\n #else \n res =0.0;\n #endif \n return res ;}float ubnhgsi(sampler2D lrotttz,vec3 pmmxppk,vec2 ktnvxcp,vec2 rtbcrvx,float iuknzjh,float lagcdrm){float kotbpbp=0.0;float kgvjoay=distance(pmmxppk,fqnhwfi);float govektg=lmymseh(lrotttz,rtbcrvx,vec2 (0,0),lagcdrm);if(kgvjoay>govektg){kotbpbp=iuknzjh;}return 1.0-kotbpbp;}\n #endif \n \n #if gpfdayb==3\n float lsqtotm(float xieqjvb,float iqfbgdu,float cyxmscz){return clamp((cyxmscz-xieqjvb)/(iqfbgdu-xieqjvb),0.0,1.0);}float xpcfllh(sampler2D lrotttz,vec3 pmmxppk,vec2 rtbcrvx,float iuknzjh,float lagcdrm){float kgvjoay=distance(pmmxppk,fqnhwfi)/lagcdrm;vec4 nmlmkmt=texture2D(lrotttz,rtbcrvx);\n #if mzpxama==6\n float kwtioke=lmrefqv(nmlmkmt.rg);float bzujscr=lmrefqv(nmlmkmt.ba);\n #elif mzpxama==8\n float kwtioke=nmlmkmt.r;float bzujscr=nmlmkmt.b;\n #else \n return 1.0;\n #endif \n float rnglrqe=0.0;float vynjeko2=bzujscr;float izbvoyx2=kwtioke*kwtioke;float bphtptn=vynjeko2-izbvoyx2;float ihknsyq=kwtioke-kgvjoay;float wslugkm2=ihknsyq*ihknsyq;float p=bphtptn/(bphtptn+wslugkm2);p=lsqtotm(nxaqjjs,1.0,p);rnglrqe=max(p,(kgvjoay<=kwtioke?1.0:0.0));return 1.0-iuknzjh+iuknzjh*(clamp(rnglrqe,0.0,1.0));}\n #endif \n float xaqahqs(sampler2D lrotttz,vec3 pmmxppk,vec2 ktnvxcp,vec2 rtbcrvx,float iuknzjh,float lagcdrm){\n #if gpfdayb==1\n return ubnhgsi(lrotttz,pmmxppk,ktnvxcp,rtbcrvx,iuknzjh,lagcdrm);\n #elif gpfdayb==2\n float kgvjoay=(distance(pmmxppk,fqnhwfi)-0.1)/lagcdrm;float jbyfmhr=texture2D(lrotttz,rtbcrvx).r;return 1.0-iuknzjh+iuknzjh*clamp(exp(lgjrplk*(jbyfmhr-kgvjoay)),0.0,1.0);\n #elif gpfdayb==3\n return xpcfllh(lrotttz,pmmxppk,rtbcrvx,iuknzjh,lagcdrm);\n #else \n return 1.0;\n #endif \n }\n #endif \n /***tfyihclvaajqvnpfpfxxsysnkbwkrtluoxj*fuhehswifoaxkt:pfpfxxsnsstwqm in chjksflaovuoqs*fuhehswyrybycj:ijgjgad*fuhehswppkdwez0:blvoqqphthsqutuojxxjh0nfzwxbr*/vec4 yjgikmo(vec3 ifoaxkt,vec3 fxcsdif,float ijgjgad,float lrljcmr,float htunysc,vec3 hnnzgqv,vec3 nsstwqm){return uqhnmji(ifoaxkt,fxcsdif,ijgjgad,lrljcmr,htunysc,hnnzgqv,nsstwqm,1.0);}\n #if octspal>0\n float wjxlodx(vec3 qhzenuk,vec3 vspdedz,sampler2D dggpapb,float xywcpsx,float upokuis,float lagcdrm,vec2 ktnvxcp,vec2 deobjdf){float kotbpbp=1.0;\n #if upcfkyg==1\n kotbpbp=0.0;\n #endif \n if(deobjdf.x>0.0&&deobjdf.x<1.0&&deobjdf.y>0.0&&deobjdf.y<1.0){\n #if upcfkyg==0\n float pkklacc=abs(dot(-qhzenuk,hbnjyno));if(pkklacc<0.15){kotbpbp=1.0-xywcpsx;}else {kotbpbp=xaqahqs(dggpapb,vspdedz,ktnvxcp,deobjdf,xywcpsx,lagcdrm);}\n #else \n kotbpbp=1.0-xaqahqs(dggpapb,vspdedz,ktnvxcp,deobjdf,1.0,lagcdrm);\n #endif \n }\n #if upcfkyg==1\n vec3 tipywwk=vec3 (hbnjyno);if(!gl_FrontFacing==true){tipywwk=-tipywwk;}kotbpbp=max(kotbpbp,clamp((dot(qhzenuk,tipywwk)+upokuis)/0.1,0.0,1.0))*xywcpsx;\n #endif \n return kotbpbp;}\n #endif \n \n #if hokmxtt>0\n vec4 zfuxfmw(vec3 ifoaxkt,vec3 fxcsdif,float ijgjgad,float lrljcmr,float htunysc){vec3 bspelaj=vec3 (0.0);float jtwyxfd=1.0;vec4 mnynvbe=vec4 (bspelaj,jtwyxfd);vec3 hnnzgqv;vec3 iejwwyj;vec3 nsstwqm;\n #ifdef atfjluc0\n hnnzgqv=szyepvr0;nsstwqm=iuqlhbj0;\n #if defined(yxuivxf0)\n hnnzgqv=zrsdxdf(hnnzgqv);\n #endif \n mnynvbe=yjgikmo(ifoaxkt,fxcsdif,ijgjgad,lrljcmr,htunysc,hnnzgqv,nsstwqm);\n #if defined(kqlahgv0)&&upcfkyg==0\n \n #if defined(yxuivxf0)\n mnynvbe*=wjxlodx(hnnzgqv,(wqfoqbo*vec4 (ntjaipr0,1.0)).xyz,hhknvcm0,kqlahgv0,uzzsmwp0,pgnowwy0,vfpwfis0,izejsjy0);\n #else \n mnynvbe*=wjxlodx(hnnzgqv,ntjaipr0,hhknvcm0,kqlahgv0,uzzsmwp0,pgnowwy0,vfpwfis0,izejsjy0);\n #endif \n \n #endif \n bspelaj+=mnynvbe.rgb;jtwyxfd*=mnynvbe.a;\n #endif \n \n #ifdef atfjluc1\n hnnzgqv=szyepvr1;nsstwqm=iuqlhbj1;\n #if defined(yxuivxf1)\n hnnzgqv=zrsdxdf(hnnzgqv);\n #endif \n mnynvbe=yjgikmo(ifoaxkt,fxcsdif,ijgjgad,lrljcmr,htunysc,hnnzgqv,nsstwqm);\n #if defined(kqlahgv1)&&upcfkyg==0\n \n #if defined(yxuivxf1)\n mnynvbe*=wjxlodx(hnnzgqv,(wqfoqbo*vec4 (ntjaipr1,1.0)).xyz,hhknvcm1,kqlahgv1,uzzsmwp1,pgnowwy1,vfpwfis1,izejsjy1);\n #else \n mnynvbe*=wjxlodx(hnnzgqv,ntjaipr1,hhknvcm1,kqlahgv1,uzzsmwp1,pgnowwy1,vfpwfis1,izejsjy1);\n #endif \n \n #endif \n bspelaj+=mnynvbe.rgb;jtwyxfd*=mnynvbe.a;\n #endif \n \n #ifdef atfjluc2\n hnnzgqv=szyepvr2;nsstwqm=iuqlhbj2;\n #if defined(yxuivxf2)\n hnnzgqv=zrsdxdf(hnnzgqv);\n #endif \n mnynvbe=yjgikmo(ifoaxkt,fxcsdif,ijgjgad,lrljcmr,htunysc,hnnzgqv,nsstwqm);\n #if defined(kqlahgv2)&&upcfkyg==0\n \n #if defined(yxuivxf2)\n mnynvbe*=wjxlodx(hnnzgqv,(wqfoqbo*vec4 (ntjaipr2,1.0)).xyz,hhknvcm2,kqlahgv2,uzzsmwp2,pgnowwy2,vfpwfis2,izejsjy2);\n #else \n mnynvbe*=wjxlodx(hnnzgqv,ntjaipr2,hhknvcm2,kqlahgv2,uzzsmwp2,pgnowwy2,vfpwfis2,izejsjy2);\n #endif \n \n #endif \n bspelaj+=mnynvbe.rgb;jtwyxfd*=mnynvbe.a;\n #endif \n \n #ifdef atfjluc3\n hnnzgqv=szyepvr3;nsstwqm=iuqlhbj3;\n #if defined(yxuivxf3)\n hnnzgqv=zrsdxdf(hnnzgqv);\n #endif \n mnynvbe=yjgikmo(ifoaxkt,fxcsdif,ijgjgad,lrljcmr,htunysc,hnnzgqv,nsstwqm);\n #if defined(kqlahgv3)&&upcfkyg==0\n \n #if defined(yxuivxf3)\n mnynvbe*=wjxlodx(hnnzgqv,(wqfoqbo*vec4 (ntjaipr3,1.0)).xyz,hhknvcm3,kqlahgv3,uzzsmwp3,pgnowwy3,vfpwfis3,izejsjy3);\n #else \n mnynvbe*=wjxlodx(hnnzgqv,ntjaipr3,hhknvcm3,kqlahgv3,uzzsmwp3,pgnowwy3,vfpwfis3,izejsjy3);\n #endif \n \n #endif \n bspelaj+=mnynvbe.rgb;jtwyxfd*=mnynvbe.a;\n #endif \n \n #ifdef atfjluc4\n hnnzgqv=szyepvr4;nsstwqm=iuqlhbj4;\n #if defined(yxuivxf4)\n hnnzgqv=zrsdxdf(hnnzgqv);\n #endif \n mnynvbe=yjgikmo(ifoaxkt,fxcsdif,ijgjgad,lrljcmr,htunysc,hnnzgqv,nsstwqm);\n #if defined(kqlahgv4)&&upcfkyg==0\n \n #if defined(yxuivxf4)\n mnynvbe*=wjxlodx(hnnzgqv,(wqfoqbo*vec4 (ntjaipr4,1.0)).xyz,hhknvcm4,kqlahgv4,uzzsmwp4,pgnowwy4,vfpwfis4,izejsjy4);\n #else \n mnynvbe*=wjxlodx(hnnzgqv,ntjaipr4,hhknvcm4,kqlahgv4,uzzsmwp4,pgnowwy4,vfpwfis4,izejsjy4);\n #endif \n \n #endif \n bspelaj+=mnynvbe.rgb;jtwyxfd*=mnynvbe.a;\n #endif \n \n #ifdef atfjluc5\n hnnzgqv=szyepvr5;nsstwqm=iuqlhbj5;\n #if defined(yxuivxf5)\n hnnzgqv=zrsdxdf(hnnzgqv);\n #endif \n mnynvbe=yjgikmo(ifoaxkt,fxcsdif,ijgjgad,lrljcmr,htunysc,hnnzgqv,nsstwqm);\n #if defined(kqlahgv5)&&upcfkyg==0\n \n #if defined(yxuivxf5)\n mnynvbe*=wjxlodx(hnnzgqv,(wqfoqbo*vec4 (ntjaipr5,1.0)).xyz,hhknvcm5,kqlahgv5,uzzsmwp5,pgnowwy5,vfpwfis5,izejsjy5);\n #else \n mnynvbe*=wjxlodx(hnnzgqv,ntjaipr5,hhknvcm5,kqlahgv5,uzzsmwp5,pgnowwy5,vfpwfis5,izejsjy5);\n #endif \n \n #endif \n bspelaj+=mnynvbe.rgb;jtwyxfd*=mnynvbe.a;\n #endif \n \n #ifdef atfjluc6\n hnnzgqv=szyepvr6;nsstwqm=iuqlhbj6;\n #if defined(yxuivxf6)\n hnnzgqv=zrsdxdf(hnnzgqv);\n #endif \n mnynvbe=yjgikmo(ifoaxkt,fxcsdif,ijgjgad,lrljcmr,htunysc,hnnzgqv,nsstwqm);\n #if defined(kqlahgv6)&&upcfkyg==0\n \n #if defined(yxuivxf6)\n mnynvbe*=wjxlodx(hnnzgqv,(wqfoqbo*vec4 (ntjaipr6,1.0)).xyz,hhknvcm6,kqlahgv6,uzzsmwp6,pgnowwy6,vfpwfis6,izejsjy6);\n #else \n mnynvbe*=wjxlodx(hnnzgqv,ntjaipr6,hhknvcm6,kqlahgv6,uzzsmwp6,pgnowwy6,vfpwfis6,izejsjy6);\n #endif \n \n #endif \n bspelaj+=mnynvbe.rgb;jtwyxfd*=mnynvbe.a;\n #endif \n \n #ifdef atfjluc7\n hnnzgqv=szyepvr7;nsstwqm=iuqlhbj7;\n #if defined(yxuivxf7)\n hnnzgqv=zrsdxdf(hnnzgqv);\n #endif \n mnynvbe=yjgikmo(ifoaxkt,fxcsdif,ijgjgad,lrljcmr,htunysc,hnnzgqv,nsstwqm);\n #if defined(kqlahgv7)&&upcfkyg==0\n \n #if defined(yxuivxf7)\n mnynvbe*=wjxlodx(hnnzgqv,(wqfoqbo*vec4 (ntjaipr7,1.0)).xyz,hhknvcm7,kqlahgv7,uzzsmwp7,pgnowwy7,vfpwfis7,izejsjy7);\n #else \n mnynvbe*=wjxlodx(hnnzgqv,ntjaipr7,hhknvcm7,kqlahgv7,uzzsmwp7,pgnowwy7,vfpwfis7,izejsjy7);\n #endif \n \n #endif \n bspelaj+=mnynvbe.rgb;jtwyxfd*=mnynvbe.a;\n #endif \n \n #ifdef atfjluc8\n hnnzgqv=szyepvr8;nsstwqm=iuqlhbj8;\n #if defined(yxuivxf8)\n hnnzgqv=zrsdxdf(hnnzgqv);\n #endif \n mnynvbe=yjgikmo(ifoaxkt,fxcsdif,ijgjgad,lrljcmr,htunysc,hnnzgqv,nsstwqm);\n #if defined(kqlahgv8)&&upcfkyg==0\n \n #if defined(yxuivxf8)\n mnynvbe*=wjxlodx(hnnzgqv,(wqfoqbo*vec4 (ntjaipr8,1.0)).xyz,hhknvcm8,kqlahgv8,uzzsmwp8,pgnowwy8,vfpwfis8,izejsjy8);\n #else \n mnynvbe*=wjxlodx(hnnzgqv,ntjaipr8,hhknvcm8,kqlahgv8,uzzsmwp8,pgnowwy8,vfpwfis8,izejsjy8);\n #endif \n \n #endif \n bspelaj+=mnynvbe.rgb;jtwyxfd*=mnynvbe.a;\n #endif \n \n #ifdef atfjluc9\n hnnzgqv=szyepvr9;nsstwqm=iuqlhbj9;\n #if defined(yxuivxf9)\n hnnzgqv=zrsdxdf(hnnzgqv);\n #endif \n mnynvbe=yjgikmo(ifoaxkt,fxcsdif,ijgjgad,lrljcmr,htunysc,hnnzgqv,nsstwqm);\n #if defined(kqlahgv9)&&upcfkyg==0\n \n #if defined(yxuivxf9)\n mnynvbe*=wjxlodx(hnnzgqv,(wqfoqbo*vec4 (ntjaipr9,1.0)).xyz,hhknvcm9,kqlahgv9,uzzsmwp9,pgnowwy9,vfpwfis9,izejsjy9);\n #else \n mnynvbe*=wjxlodx(hnnzgqv,ntjaipr9,hhknvcm9,kqlahgv9,uzzsmwp9,pgnowwy9,vfpwfis9,izejsjy9);\n #endif \n \n #endif \n bspelaj+=mnynvbe.rgb;jtwyxfd*=mnynvbe.a;\n #endif \n return vec4 (bspelaj,jtwyxfd);}\n #endif \n \n #if gmypjqq>0\n float hnosxbi(float yslmyhb,float xudqsso,float hbfymzt){return max(0.0,min(1.0,(yslmyhb-hbfymzt)/(xudqsso-hbfymzt)));}/***tfyihclpfpfxxsoigyllw*fuhehswifoaxkt:pfpfxxsnsstwqm in chjksflaovuoqs*fuhehswyrybycj:ijgjgad*fuhehswlrljcmr:ztuaacmtjjudfepfpfxxsyllfkqh*fuhehswhnnzgqv:pfpfxxsqhzenuktjjudfepfpfxxsmnynvbe(jkikobjmnynvbeuusdhvbacrefmd)*fuhehswnsstwqm:pfpfxxsnsstwqmtjjudfepfpfxxsmnynvbe*fuhehswvedmnqe:pfpfxxscqhyrflvedmnqetjjudfepfpfxxsmnynvbe*/vec4 ihugdwv(vec3 ifoaxkt,vec3 fxcsdif,float ijgjgad,float lrljcmr,float htunysc,vec3 hnnzgqv,vec3 nsstwqm,float vedmnqe){return uqhnmji(ifoaxkt,fxcsdif,ijgjgad,lrljcmr,htunysc,hnnzgqv,nsstwqm,vedmnqe);}\n #if telezcv>0\n float ygseayq(vec3 qhzenuk,vec3 vspdedz,sampler2D dggpapb,float xywcpsx,float upokuis,float lagcdrm,vec2 ktnvxcp,vec2 deobjdf){float kotbpbp=1.0;\n #if upcfkyg==1\n kotbpbp=0.0;\n #endif \n if(deobjdf.x>0.0&&deobjdf.x<1.0&&deobjdf.y>0.0&&deobjdf.y<1.0){\n #if upcfkyg==0\n float pkklacc=abs(dot(-qhzenuk,hbnjyno));if(pkklacc<0.15){kotbpbp=1.0-xywcpsx;}else {kotbpbp=xaqahqs(dggpapb,vspdedz,ktnvxcp,deobjdf,xywcpsx,lagcdrm);}\n #else \n kotbpbp=1.0-xaqahqs(dggpapb,vspdedz,ktnvxcp,deobjdf,1.0,lagcdrm);\n #endif \n }\n #if upcfkyg==1\n vec3 tipywwk=vec3 (hbnjyno);if(!gl_FrontFacing==true){tipywwk=-tipywwk;}kotbpbp=max(kotbpbp,clamp((dot(qhzenuk,tipywwk)+upokuis)/0.1,0.0,1.0))*xywcpsx;\n #endif \n return kotbpbp;}\n #endif \n vec4 wompqiz(vec3 ifoaxkt,vec3 fxcsdif,float ijgjgad,float lrljcmr,float htunysc){vec3 bspelaj=vec3 (0.0);float jtwyxfd=1.0;vec4 mnynvbe=vec4 (bspelaj,jtwyxfd);vec3 hnnzgqv;vec3 iejwwyj;vec3 nsstwqm;vec3 uszdjdh;vec4 hfikugm;vec3 knjvoum;float vedmnqe;\n #ifdef zhzwila0\n hnnzgqv=qkbayba0;iejwwyj=qdijctx0;nsstwqm=vmxutmc0;uszdjdh=vjnmpun0;hfikugm=jbwfpbd0;\n #if defined(pzibdvh0)\n hnnzgqv=zrsdxdf(hnnzgqv);iejwwyj=zkmhwmo(iejwwyj);\n #endif \n hnnzgqv=normalize(hnnzgqv);knjvoum=normalize(iejwwyj-fqnhwfi);vedmnqe=ioodlrl(length(iejwwyj-fqnhwfi),hfikugm)*pow(hnosxbi(dot(hnnzgqv,-knjvoum),uszdjdh.x,uszdjdh.y),uszdjdh.z);mnynvbe=ihugdwv(ifoaxkt,fxcsdif,ijgjgad,lrljcmr,htunysc,hnnzgqv,nsstwqm,vedmnqe);\n #if defined(lmnawfd0)&&upcfkyg==0\n vec4 rtbcrvx0=llsljbs0*(vec4 (fqnhwfi,1.0));rtbcrvx0.xy=vec2 (0.5)*rtbcrvx0.xy/rtbcrvx0.w+vec2 (0.5);mnynvbe.rgb*=ygseayq(hnnzgqv,iejwwyj,xqqpmlf0,lmnawfd0,xhmejzu0,efyytzg0,dzpoqlw0,rtbcrvx0.xy);\n #endif \n bspelaj+=mnynvbe.rgb;jtwyxfd*=mnynvbe.a;\n #endif \n \n #ifdef zhzwila1\n hnnzgqv=qkbayba1;iejwwyj=qdijctx1;nsstwqm=vmxutmc1;uszdjdh=vjnmpun1;hfikugm=jbwfpbd1;\n #if defined(pzibdvh1)\n hnnzgqv=zrsdxdf(hnnzgqv);iejwwyj=zkmhwmo(iejwwyj);\n #endif \n hnnzgqv=normalize(hnnzgqv);knjvoum=normalize(iejwwyj-fqnhwfi);vedmnqe=ioodlrl(length(iejwwyj-fqnhwfi),hfikugm)*pow(hnosxbi(dot(hnnzgqv,-knjvoum),uszdjdh.x,uszdjdh.y),uszdjdh.z);mnynvbe=ihugdwv(ifoaxkt,fxcsdif,ijgjgad,lrljcmr,htunysc,hnnzgqv,nsstwqm,vedmnqe);\n #if defined(lmnawfd1)&&upcfkyg==0\n vec4 rtbcrvx1=llsljbs1*(vec4 (fqnhwfi,1.0));rtbcrvx1.xy=vec2 (0.5)*rtbcrvx1.xy/rtbcrvx1.w+vec2 (0.5);mnynvbe.rgb*=ygseayq(hnnzgqv,iejwwyj,xqqpmlf1,lmnawfd1,xhmejzu1,efyytzg1,dzpoqlw1,rtbcrvx1.xy);\n #endif \n bspelaj+=mnynvbe.rgb;jtwyxfd*=mnynvbe.a;\n #endif \n \n #ifdef zhzwila2\n hnnzgqv=qkbayba2;iejwwyj=qdijctx2;nsstwqm=vmxutmc2;uszdjdh=vjnmpun2;hfikugm=jbwfpbd2;\n #if defined(pzibdvh2)\n hnnzgqv=zrsdxdf(hnnzgqv);iejwwyj=zkmhwmo(iejwwyj);\n #endif \n hnnzgqv=normalize(hnnzgqv);knjvoum=normalize(iejwwyj-fqnhwfi);vedmnqe=ioodlrl(length(iejwwyj-fqnhwfi),hfikugm)*pow(hnosxbi(dot(hnnzgqv,-knjvoum),uszdjdh.x,uszdjdh.y),uszdjdh.z);mnynvbe=ihugdwv(ifoaxkt,fxcsdif,ijgjgad,lrljcmr,htunysc,hnnzgqv,nsstwqm,vedmnqe);\n #if defined(lmnawfd2)&&upcfkyg==0\n vec4 rtbcrvx2=llsljbs2*(vec4 (fqnhwfi,1.0));rtbcrvx2.xy=vec2 (0.5)*rtbcrvx2.xy/rtbcrvx2.w+vec2 (0.5);mnynvbe.rgb*=ygseayq(hnnzgqv,iejwwyj,xqqpmlf2,lmnawfd2,xhmejzu2,efyytzg2,dzpoqlw2,rtbcrvx2.xy);\n #endif \n bspelaj+=mnynvbe.rgb;jtwyxfd*=mnynvbe.a;\n #endif \n \n #ifdef zhzwila3\n hnnzgqv=qkbayba3;iejwwyj=qdijctx3;nsstwqm=vmxutmc3;uszdjdh=vjnmpun3;hfikugm=jbwfpbd3;\n #if defined(pzibdvh3)\n hnnzgqv=zrsdxdf(hnnzgqv);iejwwyj=zkmhwmo(iejwwyj);\n #endif \n hnnzgqv=normalize(hnnzgqv);knjvoum=normalize(iejwwyj-fqnhwfi);vedmnqe=ioodlrl(length(iejwwyj-fqnhwfi),hfikugm)*pow(hnosxbi(dot(hnnzgqv,-knjvoum),uszdjdh.x,uszdjdh.y),uszdjdh.z);mnynvbe=ihugdwv(ifoaxkt,fxcsdif,ijgjgad,lrljcmr,htunysc,hnnzgqv,nsstwqm,vedmnqe);\n #if defined(lmnawfd3)&&upcfkyg==0\n vec4 rtbcrvx3=llsljbs3*(vec4 (fqnhwfi,1.0));rtbcrvx3.xy=vec2 (0.5)*rtbcrvx3.xy/rtbcrvx3.w+vec2 (0.5);mnynvbe.rgb*=ygseayq(hnnzgqv,iejwwyj,xqqpmlf3,lmnawfd3,xhmejzu3,efyytzg3,dzpoqlw3,rtbcrvx3.xy);\n #endif \n bspelaj+=mnynvbe.rgb;jtwyxfd*=mnynvbe.a;\n #endif \n \n #ifdef zhzwila4\n hnnzgqv=qkbayba4;iejwwyj=qdijctx4;nsstwqm=vmxutmc4;uszdjdh=vjnmpun4;hfikugm=jbwfpbd4;\n #if defined(pzibdvh4)\n hnnzgqv=zrsdxdf(hnnzgqv);iejwwyj=zkmhwmo(iejwwyj);\n #endif \n hnnzgqv=normalize(hnnzgqv);knjvoum=normalize(iejwwyj-fqnhwfi);vedmnqe=ioodlrl(length(iejwwyj-fqnhwfi),hfikugm)*pow(hnosxbi(dot(hnnzgqv,-knjvoum),uszdjdh.x,uszdjdh.y),uszdjdh.z);mnynvbe=ihugdwv(ifoaxkt,fxcsdif,ijgjgad,lrljcmr,htunysc,hnnzgqv,nsstwqm,vedmnqe);\n #if defined(lmnawfd4)&&upcfkyg==0\n vec4 rtbcrvx4=llsljbs4*(vec4 (fqnhwfi,1.0));rtbcrvx4.xy=vec2 (0.5)*rtbcrvx4.xy/rtbcrvx4.w+vec2 (0.5);mnynvbe.rgb*=ygseayq(hnnzgqv,iejwwyj,xqqpmlf4,lmnawfd4,xhmejzu4,efyytzg4,dzpoqlw4,rtbcrvx4.xy);\n #endif \n bspelaj+=mnynvbe.rgb;jtwyxfd*=mnynvbe.a;\n #endif \n \n #ifdef zhzwila5\n hnnzgqv=qkbayba5;iejwwyj=qdijctx5;nsstwqm=vmxutmc5;uszdjdh=vjnmpun5;hfikugm=jbwfpbd5;\n #if defined(pzibdvh5)\n hnnzgqv=zrsdxdf(hnnzgqv);iejwwyj=zkmhwmo(iejwwyj);\n #endif \n hnnzgqv=normalize(hnnzgqv);knjvoum=normalize(iejwwyj-fqnhwfi);vedmnqe=ioodlrl(length(iejwwyj-fqnhwfi),hfikugm)*pow(hnosxbi(dot(hnnzgqv,-knjvoum),uszdjdh.x,uszdjdh.y),uszdjdh.z);mnynvbe=ihugdwv(ifoaxkt,fxcsdif,ijgjgad,lrljcmr,htunysc,hnnzgqv,nsstwqm,vedmnqe);\n #if defined(lmnawfd5)&&upcfkyg==0\n vec4 rtbcrvx5=llsljbs5*(vec4 (fqnhwfi,1.0));rtbcrvx5.xy=vec2 (0.5)*rtbcrvx5.xy/rtbcrvx5.w+vec2 (0.5);mnynvbe.rgb*=ygseayq(hnnzgqv,iejwwyj,xqqpmlf5,lmnawfd5,xhmejzu5,efyytzg5,dzpoqlw5,rtbcrvx5.xy);\n #endif \n bspelaj+=mnynvbe.rgb;jtwyxfd*=mnynvbe.a;\n #endif \n \n #ifdef zhzwila6\n hnnzgqv=qkbayba6;iejwwyj=qdijctx6;nsstwqm=vmxutmc6;uszdjdh=vjnmpun6;hfikugm=jbwfpbd6;\n #if defined(pzibdvh6)\n hnnzgqv=zrsdxdf(hnnzgqv);iejwwyj=zkmhwmo(iejwwyj);\n #endif \n hnnzgqv=normalize(hnnzgqv);knjvoum=normalize(iejwwyj-fqnhwfi);vedmnqe=ioodlrl(length(iejwwyj-fqnhwfi),hfikugm)*pow(hnosxbi(dot(hnnzgqv,-knjvoum),uszdjdh.x,uszdjdh.y),uszdjdh.z);mnynvbe=ihugdwv(ifoaxkt,fxcsdif,ijgjgad,lrljcmr,htunysc,hnnzgqv,nsstwqm,vedmnqe);\n #if defined(lmnawfd6)&&upcfkyg==0\n vec4 rtbcrvx6=llsljbs6*(vec4 (fqnhwfi,1.0));rtbcrvx6.xy=vec2 (0.5)*rtbcrvx6.xy/rtbcrvx6.w+vec2 (0.5);mnynvbe.rgb*=ygseayq(hnnzgqv,iejwwyj,xqqpmlf6,lmnawfd6,xhmejzu6,efyytzg6,dzpoqlw6,rtbcrvx6.xy);\n #endif \n bspelaj+=mnynvbe.rgb;jtwyxfd*=mnynvbe.a;\n #endif \n \n #ifdef zhzwila7\n hnnzgqv=qkbayba7;iejwwyj=qdijctx7;nsstwqm=vmxutmc7;uszdjdh=vjnmpun7;hfikugm=jbwfpbd7;\n #if defined(pzibdvh7)\n hnnzgqv=zrsdxdf(hnnzgqv);iejwwyj=zkmhwmo(iejwwyj);\n #endif \n hnnzgqv=normalize(hnnzgqv);knjvoum=normalize(iejwwyj-fqnhwfi);vedmnqe=ioodlrl(length(iejwwyj-fqnhwfi),hfikugm)*pow(hnosxbi(dot(hnnzgqv,-knjvoum),uszdjdh.x,uszdjdh.y),uszdjdh.z);mnynvbe=ihugdwv(ifoaxkt,fxcsdif,ijgjgad,lrljcmr,htunysc,hnnzgqv,nsstwqm,vedmnqe);\n #if defined(lmnawfd7)&&upcfkyg==0\n vec4 rtbcrvx7=llsljbs7*(vec4 (fqnhwfi,1.0));rtbcrvx7.xy=vec2 (0.5)*rtbcrvx7.xy/rtbcrvx7.w+vec2 (0.5);mnynvbe.rgb*=ygseayq(hnnzgqv,iejwwyj,xqqpmlf7,lmnawfd7,xhmejzu7,efyytzg7,dzpoqlw7,rtbcrvx7.xy);\n #endif \n bspelaj+=mnynvbe.rgb;jtwyxfd*=mnynvbe.a;\n #endif \n \n #ifdef zhzwila8\n hnnzgqv=qkbayba8;iejwwyj=qdijctx8;nsstwqm=vmxutmc8;uszdjdh=vjnmpun8;hfikugm=jbwfpbd8;\n #if defined(pzibdvh8)\n hnnzgqv=zrsdxdf(hnnzgqv);iejwwyj=zkmhwmo(iejwwyj);\n #endif \n hnnzgqv=normalize(hnnzgqv);knjvoum=normalize(iejwwyj-fqnhwfi);vedmnqe=ioodlrl(length(iejwwyj-fqnhwfi),hfikugm)*pow(hnosxbi(dot(hnnzgqv,-knjvoum),uszdjdh.x,uszdjdh.y),uszdjdh.z);mnynvbe=ihugdwv(ifoaxkt,fxcsdif,ijgjgad,lrljcmr,htunysc,hnnzgqv,nsstwqm,vedmnqe);\n #if defined(lmnawfd8)&&upcfkyg==0\n vec4 rtbcrvx8=llsljbs8*(vec4 (fqnhwfi,1.0));rtbcrvx8.xy=vec2 (0.5)*rtbcrvx8.xy/rtbcrvx8.w+vec2 (0.5);mnynvbe.rgb*=ygseayq(hnnzgqv,iejwwyj,xqqpmlf8,lmnawfd8,xhmejzu8,efyytzg8,dzpoqlw8,rtbcrvx8.xy);\n #endif \n bspelaj+=mnynvbe.rgb;jtwyxfd*=mnynvbe.a;\n #endif \n \n #ifdef zhzwila9\n hnnzgqv=qkbayba9;iejwwyj=qdijctx9;nsstwqm=vmxutmc9;uszdjdh=vjnmpun9;hfikugm=jbwfpbd9;\n #if defined(pzibdvh9)\n hnnzgqv=zrsdxdf(hnnzgqv);iejwwyj=zkmhwmo(iejwwyj);\n #endif \n hnnzgqv=normalize(hnnzgqv);knjvoum=normalize(iejwwyj-fqnhwfi);vedmnqe=ioodlrl(length(iejwwyj-fqnhwfi),hfikugm)*pow(hnosxbi(dot(hnnzgqv,-knjvoum),uszdjdh.x,uszdjdh.y),uszdjdh.z);mnynvbe=ihugdwv(ifoaxkt,fxcsdif,ijgjgad,lrljcmr,htunysc,hnnzgqv,nsstwqm,vedmnqe);\n #if defined(lmnawfd9)&&upcfkyg==0\n vec4 rtbcrvx9=llsljbs9*(vec4 (fqnhwfi,1.0));rtbcrvx9.xy=vec2 (0.5)*rtbcrvx9.xy/rtbcrvx9.w+vec2 (0.5);mnynvbe.rgb*=ygseayq(hnnzgqv,iejwwyj,xqqpmlf9,lmnawfd9,xhmejzu9,efyytzg9,dzpoqlw9,rtbcrvx9.xy);\n #endif \n bspelaj+=mnynvbe.rgb;jtwyxfd*=mnynvbe.a;\n #endif \n return vec4 (bspelaj,jtwyxfd);}\n #endif \n /***tfyihclvaajqvnpfpfxxsfpigofh*fuhehswjcpdwjh:aqyfbio(oindeyrzmrvpfwrytvcdedggpapb)*fuhehsweebkyti:pfpfxxsdlpqtyxjkikobjpfpfxxsdbgndhuuusdhvbpfpfxxshttrlke*fuhehswifoaxkt:pfpfxxsnsstwqm in chjksflaovuoqs*fuhehswyrybycj:ijgjgad*fuhehswppkdwez0:blvoqqphthsqutuojxxjh0nfzwxbr*/\n #if rbpyftt>0\n vec4 qpapszh(vec3 ifoaxkt,vec3 fxcsdif,float ijgjgad,float lrljcmr,float htunysc,vec3 hnnzgqv,vec3 nsstwqm,float vedmnqe){return uqhnmji(ifoaxkt,fxcsdif,ijgjgad,lrljcmr,htunysc,hnnzgqv,nsstwqm,vedmnqe);}vec4 ktqfrzo(vec3 ifoaxkt,vec3 fxcsdif,float ijgjgad,float lrljcmr,float htunysc){vec3 bspelaj=vec3 (0.0);float jtwyxfd=1.0;vec4 mnynvbe=vec4 (bspelaj,jtwyxfd);vec3 iejwwyj;vec3 nsstwqm;vec4 hfikugm;vec3 hnnzgqv;float vedmnqe;\n #ifdef vpifigq0\n iejwwyj=ihabiil0;nsstwqm=jaqaqjo0;hfikugm=hczygcx0;\n #if defined(paokbhz0)\n iejwwyj=zkmhwmo(iejwwyj);\n #endif \n hnnzgqv=fqnhwfi-iejwwyj;vedmnqe=ioodlrl(length(hnnzgqv),hfikugm);mnynvbe=qpapszh(ifoaxkt,fxcsdif,ijgjgad,lrljcmr,htunysc,hnnzgqv,nsstwqm,vedmnqe);bspelaj+=mnynvbe.rgb;jtwyxfd*=mnynvbe.a;\n #endif \n \n #ifdef vpifigq1\n iejwwyj=ihabiil1;nsstwqm=jaqaqjo1;hfikugm=hczygcx1;\n #if defined(paokbhz1)\n iejwwyj=zkmhwmo(iejwwyj);\n #endif \n hnnzgqv=fqnhwfi-iejwwyj;vedmnqe=ioodlrl(length(hnnzgqv),hfikugm);mnynvbe=qpapszh(ifoaxkt,fxcsdif,ijgjgad,lrljcmr,htunysc,hnnzgqv,nsstwqm,vedmnqe);bspelaj+=mnynvbe.rgb;jtwyxfd*=mnynvbe.a;\n #endif \n \n #ifdef vpifigq2\n iejwwyj=ihabiil2;nsstwqm=jaqaqjo2;hfikugm=hczygcx2;\n #if defined(paokbhz2)\n iejwwyj=zkmhwmo(iejwwyj);\n #endif \n hnnzgqv=fqnhwfi-iejwwyj;vedmnqe=ioodlrl(length(hnnzgqv),hfikugm);mnynvbe=qpapszh(ifoaxkt,fxcsdif,ijgjgad,lrljcmr,htunysc,hnnzgqv,nsstwqm,vedmnqe);bspelaj+=mnynvbe.rgb;jtwyxfd*=mnynvbe.a;\n #endif \n \n #ifdef vpifigq3\n iejwwyj=ihabiil3;nsstwqm=jaqaqjo3;hfikugm=hczygcx3;\n #if defined(paokbhz3)\n iejwwyj=zkmhwmo(iejwwyj);\n #endif \n hnnzgqv=fqnhwfi-iejwwyj;vedmnqe=ioodlrl(length(hnnzgqv),hfikugm);mnynvbe=qpapszh(ifoaxkt,fxcsdif,ijgjgad,lrljcmr,htunysc,hnnzgqv,nsstwqm,vedmnqe);bspelaj+=mnynvbe.rgb;jtwyxfd*=mnynvbe.a;\n #endif \n \n #ifdef vpifigq4\n iejwwyj=ihabiil4;nsstwqm=jaqaqjo4;hfikugm=hczygcx4;\n #if defined(paokbhz4)\n iejwwyj=zkmhwmo(iejwwyj);\n #endif \n hnnzgqv=fqnhwfi-iejwwyj;vedmnqe=ioodlrl(length(hnnzgqv),hfikugm);mnynvbe=qpapszh(ifoaxkt,fxcsdif,ijgjgad,lrljcmr,htunysc,hnnzgqv,nsstwqm,vedmnqe);bspelaj+=mnynvbe.rgb;jtwyxfd*=mnynvbe.a;\n #endif \n \n #ifdef vpifigq5\n iejwwyj=ihabiil5;nsstwqm=jaqaqjo5;hfikugm=hczygcx5;\n #if defined(paokbhz5)\n iejwwyj=zkmhwmo(iejwwyj);\n #endif \n hnnzgqv=fqnhwfi-iejwwyj;vedmnqe=ioodlrl(length(hnnzgqv),hfikugm);mnynvbe=qpapszh(ifoaxkt,fxcsdif,ijgjgad,lrljcmr,htunysc,hnnzgqv,nsstwqm,vedmnqe);bspelaj+=mnynvbe.rgb;jtwyxfd*=mnynvbe.a;\n #endif \n \n #ifdef vpifigq6\n iejwwyj=ihabiil6;nsstwqm=jaqaqjo6;hfikugm=hczygcx6;\n #if defined(paokbhz6)\n iejwwyj=zkmhwmo(iejwwyj);\n #endif \n hnnzgqv=fqnhwfi-iejwwyj;vedmnqe=ioodlrl(length(hnnzgqv),hfikugm);mnynvbe=qpapszh(ifoaxkt,fxcsdif,ijgjgad,lrljcmr,htunysc,hnnzgqv,nsstwqm,vedmnqe);bspelaj+=mnynvbe.rgb;jtwyxfd*=mnynvbe.a;\n #endif \n \n #ifdef vpifigq7\n iejwwyj=ihabiil7;nsstwqm=jaqaqjo7;hfikugm=hczygcx7;\n #if defined(paokbhz7)\n iejwwyj=zkmhwmo(iejwwyj);\n #endif \n hnnzgqv=fqnhwfi-iejwwyj;vedmnqe=ioodlrl(length(hnnzgqv),hfikugm);mnynvbe=qpapszh(ifoaxkt,fxcsdif,ijgjgad,lrljcmr,htunysc,hnnzgqv,nsstwqm,vedmnqe);bspelaj+=mnynvbe.rgb;jtwyxfd*=mnynvbe.a;\n #endif \n \n #ifdef vpifigq8\n iejwwyj=ihabiil8;nsstwqm=jaqaqjo8;hfikugm=hczygcx8;\n #if defined(paokbhz8)\n iejwwyj=zkmhwmo(iejwwyj);\n #endif \n hnnzgqv=fqnhwfi-iejwwyj;vedmnqe=ioodlrl(length(hnnzgqv),hfikugm);mnynvbe=qpapszh(ifoaxkt,fxcsdif,ijgjgad,lrljcmr,htunysc,hnnzgqv,nsstwqm,vedmnqe);bspelaj+=mnynvbe.rgb;jtwyxfd*=mnynvbe.a;\n #endif \n return vec4 (bspelaj,jtwyxfd);}\n #endif \n \n #if tgolzbx>0\n vec4 vxpwikb(vec3 ifoaxkt,vec3 fxcsdif,float ijgjgad,float lrljcmr,float htunysc,vec3 hnnzgqv,vec3 bnqihnn,vec3 daunhgh){vec4 mfodntl=max(yjgikmo(ifoaxkt,fxcsdif,ijgjgad,lrljcmr,htunysc,-hnnzgqv,bnqihnn),vec4 (0.0));vec4 wovwjjz=max(yjgikmo(ifoaxkt,fxcsdif,ijgjgad,lrljcmr,htunysc,hnnzgqv,daunhgh),vec4 (0.0));vec4 mnynvbe=wovwjjz+mfodntl;return mnynvbe;}vec4 yrgqgaf(vec3 ifoaxkt,vec3 fxcsdif,float ijgjgad,float lrljcmr,float htunysc){vec3 bspelaj=vec3 (0.0);float jtwyxfd=1.0;vec4 mnynvbe=vec4 (bspelaj,jtwyxfd);vec3 hnnzgqv;vec3 bnqihnn;vec3 daunhgh;\n #ifdef wtolgpn0\n bnqihnn=pgksjxv0*qkurkjy0;daunhgh=irayogf0*qkurkjy0;hnnzgqv=tqwolgz0;\n #if defined(naqneaz0)\n hnnzgqv=zrsdxdf(hnnzgqv);\n #endif \n hnnzgqv=normalize(hnnzgqv);mnynvbe=vxpwikb(ifoaxkt,fxcsdif,ijgjgad,lrljcmr,htunysc,hnnzgqv,bnqihnn,daunhgh);bspelaj+=mnynvbe.rgb;jtwyxfd*=mnynvbe.a;\n #endif \n \n #ifdef wtolgpn1\n bnqihnn=pgksjxv1*qkurkjy1;daunhgh=irayogf1*qkurkjy1;hnnzgqv=tqwolgz1;\n #if defined(naqneaz1)\n hnnzgqv=zrsdxdf(hnnzgqv);\n #endif \n hnnzgqv=normalize(hnnzgqv);mnynvbe=vxpwikb(ifoaxkt,fxcsdif,ijgjgad,lrljcmr,htunysc,hnnzgqv,bnqihnn,daunhgh);bspelaj+=mnynvbe.rgb;jtwyxfd*=mnynvbe.a;\n #endif \n \n #ifdef wtolgpn2\n bnqihnn=pgksjxv2*qkurkjy2;daunhgh=irayogf2*qkurkjy2;hnnzgqv=tqwolgz2;\n #if defined(naqneaz2)\n hnnzgqv=zrsdxdf(hnnzgqv);\n #endif \n hnnzgqv=normalize(hnnzgqv);mnynvbe=vxpwikb(ifoaxkt,fxcsdif,ijgjgad,lrljcmr,htunysc,hnnzgqv,bnqihnn,daunhgh);bspelaj+=mnynvbe.rgb;jtwyxfd*=mnynvbe.a;\n #endif \n \n #ifdef wtolgpn3\n bnqihnn=pgksjxv3*qkurkjy3;daunhgh=irayogf3*qkurkjy3;hnnzgqv=tqwolgz3;\n #if defined(naqneaz3)\n hnnzgqv=zrsdxdf(hnnzgqv);\n #endif \n hnnzgqv=normalize(hnnzgqv);mnynvbe=vxpwikb(ifoaxkt,fxcsdif,ijgjgad,lrljcmr,htunysc,hnnzgqv,bnqihnn,daunhgh);bspelaj+=mnynvbe.rgb;jtwyxfd*=mnynvbe.a;\n #endif \n \n #ifdef wtolgpn4\n bnqihnn=pgksjxv4*qkurkjy4;daunhgh=irayogf4*qkurkjy4;hnnzgqv=tqwolgz4;\n #if defined(naqneaz4)\n hnnzgqv=zrsdxdf(hnnzgqv);\n #endif \n hnnzgqv=normalize(hnnzgqv);mnynvbe=vxpwikb(ifoaxkt,fxcsdif,ijgjgad,lrljcmr,htunysc,hnnzgqv,bnqihnn,daunhgh);bspelaj+=mnynvbe.rgb;jtwyxfd*=mnynvbe.a;\n #endif \n \n #ifdef wtolgpn5\n bnqihnn=pgksjxv5*qkurkjy5;daunhgh=irayogf5*qkurkjy5;hnnzgqv=tqwolgz5;\n #if defined(naqneaz5)\n hnnzgqv=zrsdxdf(hnnzgqv);\n #endif \n hnnzgqv=normalize(hnnzgqv);mnynvbe=vxpwikb(ifoaxkt,fxcsdif,ijgjgad,lrljcmr,htunysc,hnnzgqv,bnqihnn,daunhgh);bspelaj+=mnynvbe.rgb;jtwyxfd*=mnynvbe.a;\n #endif \n \n #ifdef wtolgpn6\n bnqihnn=pgksjxv6*qkurkjy6;daunhgh=irayogf6*qkurkjy6;hnnzgqv=tqwolgz6;\n #if defined(naqneaz6)\n hnnzgqv=zrsdxdf(hnnzgqv);\n #endif \n hnnzgqv=normalize(hnnzgqv);mnynvbe=vxpwikb(ifoaxkt,fxcsdif,ijgjgad,lrljcmr,htunysc,hnnzgqv,bnqihnn,daunhgh);bspelaj+=mnynvbe.rgb;jtwyxfd*=mnynvbe.a;\n #endif \n \n #ifdef wtolgpn7\n bnqihnn=pgksjxv7*qkurkjy7;daunhgh=irayogf7*qkurkjy7;hnnzgqv=tqwolgz7;\n #if defined(naqneaz7)\n hnnzgqv=zrsdxdf(hnnzgqv);\n #endif \n hnnzgqv=normalize(hnnzgqv);mnynvbe=vxpwikb(ifoaxkt,fxcsdif,ijgjgad,lrljcmr,htunysc,hnnzgqv,bnqihnn,daunhgh);bspelaj+=mnynvbe.rgb;jtwyxfd*=mnynvbe.a;\n #endif \n \n #ifdef wtolgpn8\n bnqihnn=pgksjxv8*qkurkjy8;daunhgh=irayogf8*qkurkjy8;hnnzgqv=tqwolgz8;\n #if defined(naqneaz8)\n hnnzgqv=zrsdxdf(hnnzgqv);\n #endif \n hnnzgqv=normalize(hnnzgqv);mnynvbe=vxpwikb(ifoaxkt,fxcsdif,ijgjgad,lrljcmr,htunysc,hnnzgqv,bnqihnn,daunhgh);bspelaj+=mnynvbe.rgb;jtwyxfd*=mnynvbe.a;\n #endif \n return vec4 (bspelaj,jtwyxfd);}\n #endif \n \n #if defined(szgfzxq)||defined(azsutev)||defined(znloiam)||defined(gtbnreb)\n float mjavscr(float qlujhbm,float vjxxcar){return vjxxcar-sign(qlujhbm)*qlujhbm*vjxxcar+max(-qlujhbm,0.0);}\n #endif \n \n #if defined(szgfzxq)||defined(azsutev)\n float vmklvuv(){\n #ifdef szgfzxq\n float qlujhbm=float (ktxjfle);float vjxxcar=float (0.0);\n #ifdef mniehwp\n vjxxcar=xoybity(cjsawvn,usbxvxd,tiaooli);\n #endif \n qlujhbm=mix(float (1.0),mjavscr(qlujhbm,vjxxcar),tticctp);\n #else \n float qlujhbm=float (1.0);\n #endif \n \n #ifdef azsutev\n float qlujhbm2=float (ktxjfle2);float vjxxcar2=float (0.0);\n #if defined(mzksuld)\n vjxxcar2=xoybity(cjsawvn2,usbxvxd2,tiaooli2);\n #endif \n qlujhbm2=mix(float (1.0),mjavscr(qlujhbm2,vjxxcar2),tticctp2);\n #else \n float qlujhbm2=float (1.0);\n #endif \n \n #ifdef ANIMATING \n qlujhbm=mix(qlujhbm,qlujhbm2,heftokz);\n #endif \n return qlujhbm;}\n #endif \n \n #if defined(znloiam)||defined(gtbnreb)\n float jpqdwac(){\n #ifdef znloiam\n float kbrdtkn=float (tattnol);float mnufywm=float (0.0);\n #ifdef teqtfsb\n mnufywm=xoybity(uwddkhh,fvyblms,kotsuvy);\n #endif \n kbrdtkn=mix(float (1.0),mjavscr(kbrdtkn,mnufywm),mlpvzht);\n #else \n float kbrdtkn=float (1.0);\n #endif \n \n #ifdef gtbnreb\n float kbrdtkn2=float (tattnol2);float mnufywm2=float (0.0);\n #if defined(brymrwe)\n mnufywm2=xoybity(uwddkhh2,fvyblms2,kotsuvy2);\n #endif \n kbrdtkn2=mix(float (1.0),mjavscr(kbrdtkn2,mnufywm2),mlpvzht2);\n #else \n float kbrdtkn2=float (1.0);\n #endif \n \n #ifdef ANIMATING \n kbrdtkn=mix(kbrdtkn,kbrdtkn2,heftokz);\n #endif \n return kbrdtkn;}\n #endif \n vec3 bgktcns(float jdxcnxz,vec3 ppkdwez0,float ijgjgad){return ppkdwez0+(max(vec3 (1.0-ijgjgad),ppkdwez0)-ppkdwez0)*pow(1.0-jdxcnxz,5.0);}float bgktcns(float jdxcnxz,float ppkdwez0,float ijgjgad){return ppkdwez0+(max(1.0-ijgjgad,ppkdwez0)-ppkdwez0)*pow(1.0-jdxcnxz,5.0);}vec3 nhulijd(vec3 ujdecez,vec3 refl,vec3 odupcuq,vec2 bzbngbq,vec3 ifoaxkt,float lrljcmr,float ijgjgad,float mgwdxrs){float ppkdwez0=mix(0.04,1.0,lrljcmr);float dqjpdbn=bgktcns(mgwdxrs,ppkdwez0,ijgjgad);float hmmkusi=(1.0-dqjpdbn)*(1.0-lrljcmr);return refl*(dqjpdbn*odupcuq*ifoaxkt*bzbngbq.r+0.5*bzbngbq.g)+ujdecez*ifoaxkt*hmmkusi;}vec4 igdhryg(vec3 refl,vec3 odupcuq,vec2 bzbngbq,vec3 gknpvfh,float htunysc,float ijgjgad,float mgwdxrs){float ppkdwez0=waiwyra(htunysc);float dqjpdbn=bgktcns(mgwdxrs,ppkdwez0,ijgjgad);return vec4 (refl*(dqjpdbn*odupcuq*gknpvfh*bzbngbq.r+bzbngbq.g),dqjpdbn);}vec3 nkizkqr(vec3 pfuqqpz){\n #ifdef pyjqigb\n vec3 ujdecez=mwstbcz.rgb*textureCube(codyzck,pfuqqpz*vpczxzg).rgb*pow(2.0,ikywnlr);\n #else \n vec4 kjwboia=davapfy(pfuqqpz);vec3 ujdecez=mwstbcz.rgb*zvdtdfw2(0.5+0.125*kjwboia.x,0.0625+0.0625*(0.01+kjwboia.y*0.98),kjwboia.z,kjwboia.w,0.125,0.5).rgb;\n #endif \n return ujdecez;}vec4 hoapdoo(vec3 eebkyti,vec3 ifoaxkt,vec3 gknpvfh,float ijgjgad,float lrljcmr,float htunysc){vec4 nsstwqm=vec4 (0.0);vec3 yukhzlh=vec3 (1.0);\n #if defined(gibejed)||defined(zjsuosi)\n \n #ifdef gibejed\n float xehorjb=wikjwmu;\n #ifdef iizvave\n xehorjb*=xoybity(pvowxhe,cofxubp,jtmrnbj);\n #endif \n vec3 dcmogwj=mix(vec3 (1.0),jcbgpoy(mgwdxrs).rgb,xehorjb);\n #else \n vec3 dcmogwj=yukhzlh;\n #endif \n yukhzlh=dcmogwj;\n #endif \n vec3 pfuqqpz=ajzdlsi(kebjccr,wfzgvrg,fazebij);vec3 ujdecez=nkizkqr(pfuqqpz);vec3 hnnzgqv=normalize(reflect(-eebkyti,pfuqqpz));vec3 refl=cpnlwjt(ijgjgad,hnnzgqv)*ptlusfy;vec3 bzbngbq=thsyyna(mgwdxrs,ijgjgad);float ahkzaoi=1.0;vec3 zcxrxff=ahkzaoi*lrljcmr*nhulijd(ujdecez,refl,yukhzlh,bzbngbq.rg,ifoaxkt,lrljcmr,ijgjgad,mgwdxrs);nsstwqm.rgb+=zcxrxff;nsstwqm.a+=brhvcmq(max(zcxrxff,vec3 (0.0)));ahkzaoi*=1.0-lrljcmr;\n #ifdef hgcgfww\n vec4 fspemph=ahkzaoi*htunysc*igdhryg(refl,yukhzlh,bzbngbq.rg,gknpvfh,htunysc,ijgjgad,mgwdxrs);nsstwqm.rgb+=fspemph.rgb;nsstwqm.a+=brhvcmq(max(fspemph.rgb,vec3 (0.0)));ahkzaoi*=1.0-(htunysc*fspemph.a);\n #else \n vec4 fspemph=ahkzaoi*igdhryg(refl,yukhzlh,bzbngbq.rg,vec3 (1.0),0.0,ijgjgad,mgwdxrs);nsstwqm.rgb+=fspemph.rgb;nsstwqm.a+=brhvcmq(max(fspemph.rgb,vec3 (0.0)));ahkzaoi*=1.0-fspemph.a;\n #endif \n \n #ifdef liwyana\n float eylmfdz=max(0.0,dot(-fazebij,eebkyti));vec3 ujdecez2=nkizkqr(-pfuqqpz);hnnzgqv=normalize(-eebkyti);refl=cpnlwjt(ijgjgad,hnnzgqv)*ptlusfy;bzbngbq=thsyyna(mgwdxrs,ijgjgad);vec3 jtfmxwa=lrljcmr*nhulijd(ujdecez2,refl,vec3 (1.0),bzbngbq.rg,ifoaxkt,lrljcmr,ijgjgad,mgwdxrs);float mptmftr=1.0-lrljcmr;\n #ifdef hgcgfww\n fspemph=mptmftr*htunysc*igdhryg(refl,vec3 (1.0),bzbngbq.rg,gknpvfh,htunysc,ijgjgad,mgwdxrs);jtfmxwa+=fspemph.rgb;mptmftr*=1.0-(htunysc*fspemph.a);\n #else \n fspemph=mptmftr*igdhryg(refl,vec3 (1.0),bzbngbq.rg,ifoaxkt,0.0,ijgjgad,mgwdxrs);jtfmxwa+=fspemph.rgb;mptmftr*=1.0-fspemph.a;\n #endif \n jtfmxwa+=mptmftr*ujdecez2*ifoaxkt;jtfmxwa*=pyekvda;nsstwqm.rgb+=ahkzaoi*jtfmxwa;ahkzaoi*=1.0-pyekvda;\n #endif \n nsstwqm.rgb+=ahkzaoi*ujdecez*ifoaxkt;\n #ifndef xqhrlxr\n \n #ifdef ngsweov\n float ccxiizn=svpiqcl();float qahkvdi=djliosz();vec3 balgcvg=eedphxm();vec3 bqhjuje=normalize(reflect(-eebkyti,fazebij));vec3 pamfmqm=cpnlwjt(qahkvdi,bqhjuje)*ptlusfy;bzbngbq=thsyyna(cqthvwc(mgwdxrs),cqthvwc(qahkvdi));float ekvafhc=clamp(bzbngbq.b,0.0,1.0);float uoplmli=1.0-brhvcmq(balgcvg)*ccxiizn*ekvafhc;nsstwqm.rgb=pamfmqm*balgcvg*ccxiizn*ekvafhc+uoplmli*nsstwqm.rgb;\n #endif \n \n #endif \n nsstwqm.rgb=max(nsstwqm.rgb,vec3 (0.0));return nsstwqm;}\n #if defined(nfgvnsg)||defined(ypznuqr)\n vec4 cxcejty(vec3 ifoaxkt,float ijgjgad,float lrljcmr){float jtwyxfd=1.0;vec3 ujdecez=mwstbcz.rgb;wqxpkop(ubqxmzt);vec3 eebkyti=ajzdlsi(kebjccr,-normalize(agubczf-vec3 (0,0,1)),ipchlnw);vec3 ppbtnpi=ajzdlsi(kebjccr,fdwbvik,uwcgcov);vec3 ttbsfjp=reflect(eebkyti,ppbtnpi);vec3 domkzvx=normalize(eebkyti+ttbsfjp);float bqdusoi=max(0.0,dot(ppbtnpi,eebkyti));float yteixro=max(0.0,dot(ppbtnpi,ttbsfjp));float llkhgne=max(0.0,dot(eebkyti,domkzvx));vec3 ppkdwez0=yvarzfa0(jnpxbie,0.01);vec3 dqjpdbn=lrkstif(bqdusoi,ppkdwez0);float cdahhga=1.0/bkwmfbx;vec3 elukoiv=-refract(ttbsfjp,ppbtnpi,cdahhga);vec3 hpfekxl=-refract(-eebkyti,ppbtnpi,cdahhga);vec3 nejszgy=normalize(hpfekxl+elukoiv);vec3 veivnrm=ztxccbl(ppbtnpi,hpfekxl,elukoiv);vec3 hmmkusi=(1.0-dqjpdbn)*veivnrm;vec3 fxcsdif=vec3 (0.0);vec3 hnnzgqv=normalize(reflect(-eebkyti,ppbtnpi));vec3 refl=cpnlwjt(ubqxmzt,hnnzgqv);vec2 bzbngbq=iccjqor(bqdusoi,ijgjgad);fxcsdif=refl*(dqjpdbn*bzbngbq.r+bzbngbq.g)*ptlusfy;vec3 bspelaj=fxcsdif;vec3 cpafjbd=cqthvwc(hmmkusi);wqxpkop(ijgjgad);\n #ifdef xaqovse\n vec3 mgapigh=fxcsdif;jtwyxfd=nwbwwqm(jtwyxfd,brhvcmq(mgapigh));\n #endif \n vec4 setnhey=hoapdoo(hpfekxl,ifoaxkt,vec3 (1.0),ijgjgad,lrljcmr,0.0);vec3 nsstwqm=bspelaj+setnhey.rgb*cpafjbd;return vec4 (nsstwqm,jtwyxfd*setnhey.a);}\n #endif \n vec4 varsaiw(vec3 ifoaxkt,vec3 fxcsdif,float ijgjgad,float lrljcmr,float htunysc){vec3 hnnzgqv=ajzdlsi(kebjccr,-normalize(agubczf-vec3 (0.0,0.0,1.0)),ipchlnw);vec4 bspelaj=hoapdoo(hnnzgqv,ifoaxkt,fxcsdif,ijgjgad,lrljcmr,htunysc);\n #if defined(nfgvnsg)||defined(ypznuqr)\n bspelaj=mix(bspelaj,cxcejty(ifoaxkt,ijgjgad,lrljcmr),fmsshuk);\n #endif \n return bspelaj;}\n #ifdef kvpridb\n vec4 cvlseou(){vec4 ssqapzq=vwogtxa(nsnbysp);\n #ifdef ylmuugp\n ssqapzq.rgb*=dplakee(udeimwb,ponpmlf,fbqzibe).rgb;\n #endif \n \n #ifdef aitbpqn\n ssqapzq.a*=xoybity(nkdvrfp,dovwrzg,miqrofj);\n #endif \n \n #ifdef zfkjfmr\n vec4 ssqapzq2=vwogtxa(nsnbysp2);\n #ifdef muzpkxq\n ssqapzq2.rgb*=dplakee(udeimwb2,ponpmlf2,fbqzibe2).rgb;\n #endif \n \n #ifdef qvyqlby\n ssqapzq2.a*=xoybity(nkdvrfp2,dovwrzg2,miqrofj2);\n #endif \n ssqapzq=mix(ssqapzq,ssqapzq2,heftokz);\n #endif \n return ssqapzq;}\n #endif \n \n #if upcfkyg==1\n float keduzjo(){vec3 hnnzgqv;vec3 iejwwyj;vec3 uszdjdh;vec4 hfikugm;vec3 knjvoum;float vedmnqe;float kotbpbp=0.0;\n #if defined(atfjluc0)&&defined(kqlahgv0)\n hnnzgqv=szyepvr0;\n #if defined(yxuivxf0)\n hnnzgqv=zrsdxdf(hnnzgqv);\n #endif \n \n #if defined(yxuivxf0)\n kotbpbp=wjxlodx(hnnzgqv,(wqfoqbo*vec4 (ntjaipr0,1.0)).xyz,hhknvcm0,kqlahgv0,uzzsmwp0,pgnowwy0,vfpwfis0,izejsjy0);\n #else \n kotbpbp=wjxlodx(hnnzgqv,ntjaipr0,hhknvcm0,kqlahgv0,uzzsmwp0,pgnowwy0,vfpwfis0,izejsjy0);\n #endif \n \n #endif \n \n #if defined(atfjluc1)&&defined(kqlahgv1)\n hnnzgqv=szyepvr1;\n #if defined(yxuivxf1)\n hnnzgqv=zrsdxdf(hnnzgqv);\n #endif \n \n #if defined(yxuivxf1)\n kotbpbp=max(kotbpbp,wjxlodx(hnnzgqv,(wqfoqbo*vec4 (ntjaipr1,1.0)).xyz,hhknvcm1,kqlahgv1,uzzsmwp1,pgnowwy1,vfpwfis1,izejsjy1));\n #else \n kotbpbp=max(kotbpbp,wjxlodx(hnnzgqv,ntjaipr1,hhknvcm1,kqlahgv1,uzzsmwp1,pgnowwy1,vfpwfis1,izejsjy1));\n #endif \n \n #endif \n \n #if defined(atfjluc2)&&defined(kqlahgv2)\n hnnzgqv=szyepvr2;\n #if defined(yxuivxf2)\n hnnzgqv=zrsdxdf(hnnzgqv);\n #endif \n \n #if defined(yxuivxf2)\n kotbpbp=max(kotbpbp,wjxlodx(hnnzgqv,(wqfoqbo*vec4 (ntjaipr2,1.0)).xyz,hhknvcm2,kqlahgv2,uzzsmwp2,pgnowwy2,vfpwfis2,izejsjy2));\n #else \n kotbpbp=max(kotbpbp,wjxlodx(hnnzgqv,ntjaipr2,hhknvcm2,kqlahgv2,uzzsmwp2,pgnowwy2,vfpwfis2,izejsjy2));\n #endif \n \n #endif \n \n #if defined(atfjluc3)&&defined(kqlahgv3)\n hnnzgqv=szyepvr3;\n #if defined(yxuivxf3)\n hnnzgqv=zrsdxdf(hnnzgqv);\n #endif \n \n #if defined(yxuivxf3)\n kotbpbp=max(kotbpbp,wjxlodx(hnnzgqv,(wqfoqbo*vec4 (ntjaipr3,1.0)).xyz,hhknvcm3,kqlahgv3,uzzsmwp3,pgnowwy3,vfpwfis3,izejsjy3));\n #else \n kotbpbp=max(kotbpbp,wjxlodx(hnnzgqv,ntjaipr3,hhknvcm3,kqlahgv3,uzzsmwp3,pgnowwy3,vfpwfis3,izejsjy3));\n #endif \n \n #endif \n \n #if defined(atfjluc4)&&defined(kqlahgv4)\n hnnzgqv=szyepvr4;\n #if defined(yxuivxf4)\n hnnzgqv=zrsdxdf(hnnzgqv);\n #endif \n \n #if defined(yxuivxf4)\n kotbpbp=max(kotbpbp,wjxlodx(hnnzgqv,(wqfoqbo*vec4 (ntjaipr4,1.0)).xyz,hhknvcm4,kqlahgv4,uzzsmwp4,pgnowwy4,vfpwfis4,izejsjy4));\n #else \n kotbpbp=max(kotbpbp,wjxlodx(hnnzgqv,ntjaipr4,hhknvcm4,kqlahgv4,uzzsmwp4,pgnowwy4,vfpwfis4,izejsjy4));\n #endif \n \n #endif \n \n #if defined(atfjluc5)&&defined(kqlahgv5)\n hnnzgqv=szyepvr5;\n #if defined(yxuivxf5)\n hnnzgqv=zrsdxdf(hnnzgqv);\n #endif \n \n #if defined(yxuivxf5)\n kotbpbp=max(kotbpbp,wjxlodx(hnnzgqv,(wqfoqbo*vec4 (ntjaipr5,1.0)).xyz,hhknvcm5,kqlahgv5,uzzsmwp5,pgnowwy5,vfpwfis5,izejsjy5));\n #else \n kotbpbp=max(kotbpbp,wjxlodx(hnnzgqv,ntjaipr5,hhknvcm5,kqlahgv5,uzzsmwp5,pgnowwy5,vfpwfis5,izejsjy5));\n #endif \n \n #endif \n \n #if defined(atfjluc6)&&defined(kqlahgv6)\n hnnzgqv=szyepvr6;\n #if defined(yxuivxf6)\n hnnzgqv=zrsdxdf(hnnzgqv);\n #endif \n \n #if defined(yxuivxf6)\n kotbpbp=max(kotbpbp,wjxlodx(hnnzgqv,(wqfoqbo*vec4 (ntjaipr6,1.0)).xyz,hhknvcm6,kqlahgv6,uzzsmwp6,pgnowwy6,vfpwfis6,izejsjy6));\n #else \n kotbpbp=max(kotbpbp,wjxlodx(hnnzgqv,ntjaipr6,hhknvcm6,kqlahgv6,uzzsmwp6,pgnowwy6,vfpwfis6,izejsjy6));\n #endif \n \n #endif \n \n #if defined(atfjluc7)&&defined(kqlahgv7)\n hnnzgqv=szyepvr7;\n #if defined(yxuivxf7)\n hnnzgqv=zrsdxdf(hnnzgqv);\n #endif \n \n #if defined(yxuivxf7)\n kotbpbp=max(kotbpbp,wjxlodx(hnnzgqv,(wqfoqbo*vec4 (ntjaipr7,1.0)).xyz,hhknvcm7,kqlahgv7,uzzsmwp7,pgnowwy7,vfpwfis7,izejsjy7));\n #else \n kotbpbp=max(kotbpbp,wjxlodx(hnnzgqv,ntjaipr7,hhknvcm7,kqlahgv7,uzzsmwp7,pgnowwy7,vfpwfis7,izejsjy7));\n #endif \n \n #endif \n \n #if defined(atfjluc8)&&defined(kqlahgv8)\n hnnzgqv=szyepvr8;\n #if defined(yxuivxf8)\n hnnzgqv=zrsdxdf(hnnzgqv);\n #endif \n \n #if defined(yxuivxf8)\n kotbpbp=max(kotbpbp,wjxlodx(hnnzgqv,(wqfoqbo*vec4 (ntjaipr8,1.0)).xyz,hhknvcm8,kqlahgv8,uzzsmwp8,pgnowwy8,vfpwfis8,izejsjy8));\n #else \n kotbpbp=max(kotbpbp,wjxlodx(hnnzgqv,ntjaipr8,hhknvcm8,kqlahgv8,uzzsmwp8,pgnowwy8,vfpwfis8,izejsjy8));\n #endif \n \n #endif \n \n #if defined(atfjluc9)&&defined(kqlahgv9)\n hnnzgqv=szyepvr9;\n #if defined(yxuivxf9)\n hnnzgqv=zrsdxdf(hnnzgqv);\n #endif \n \n #if defined(yxuivxf9)\n kotbpbp=max(kotbpbp,wjxlodx(hnnzgqv,(wqfoqbo*vec4 (ntjaipr9,1.0)).xyz,hhknvcm9,kqlahgv9,uzzsmwp9,pgnowwy9,vfpwfis9,izejsjy9));\n #else \n kotbpbp=max(kotbpbp,wjxlodx(hnnzgqv,ntjaipr9,hhknvcm9,kqlahgv9,uzzsmwp9,pgnowwy9,vfpwfis9,izejsjy9));\n #endif \n \n #endif \n \n #if defined(zhzwila0)&&defined(lmnawfd0)\n hnnzgqv=qkbayba0;iejwwyj=qdijctx0;uszdjdh=vjnmpun0;hfikugm=jbwfpbd0;\n #if defined(pzibdvh0)\n hnnzgqv=zrsdxdf(hnnzgqv);iejwwyj=zkmhwmo(iejwwyj);\n #endif \n hnnzgqv=normalize(hnnzgqv);knjvoum=normalize(iejwwyj-fqnhwfi);vedmnqe=ioodlrl(length(iejwwyj-fqnhwfi),hfikugm)*pow(hnosxbi(dot(hnnzgqv,-knjvoum),uszdjdh.x,uszdjdh.y),uszdjdh.z);vec4 rtbcrvx0=llsljbs0*(vec4 (fqnhwfi,1.0));rtbcrvx0.xy=vec2 (0.5)*rtbcrvx0.xy/rtbcrvx0.w+vec2 (0.5);kotbpbp=max(kotbpbp,vedmnqe*ygseayq(hnnzgqv,iejwwyj,xqqpmlf0,lmnawfd0,xhmejzu0,efyytzg0,dzpoqlw0,rtbcrvx0.xy));\n #endif \n \n #if defined(zhzwila1)&&defined(lmnawfd1)\n hnnzgqv=qkbayba1;iejwwyj=qdijctx1;uszdjdh=vjnmpun1;hfikugm=jbwfpbd1;\n #if defined(pzibdvh1)\n hnnzgqv=zrsdxdf(hnnzgqv);iejwwyj=zkmhwmo(iejwwyj);\n #endif \n hnnzgqv=normalize(hnnzgqv);knjvoum=normalize(iejwwyj-fqnhwfi);vedmnqe=ioodlrl(length(iejwwyj-fqnhwfi),hfikugm)*pow(hnosxbi(dot(hnnzgqv,-knjvoum),uszdjdh.x,uszdjdh.y),uszdjdh.z);vec4 rtbcrvx1=llsljbs1*(vec4 (fqnhwfi,1.0));rtbcrvx1.xy=vec2 (0.5)*rtbcrvx1.xy/rtbcrvx1.w+vec2 (0.5);kotbpbp=max(kotbpbp,vedmnqe*ygseayq(hnnzgqv,iejwwyj,xqqpmlf1,lmnawfd1,xhmejzu1,efyytzg1,dzpoqlw1,rtbcrvx1.xy));\n #endif \n \n #if defined(zhzwila2)&&defined(lmnawfd2)\n hnnzgqv=qkbayba2;iejwwyj=qdijctx2;uszdjdh=vjnmpun2;hfikugm=jbwfpbd2;\n #if defined(pzibdvh2)\n hnnzgqv=zrsdxdf(hnnzgqv);iejwwyj=zkmhwmo(iejwwyj);\n #endif \n hnnzgqv=normalize(hnnzgqv);knjvoum=normalize(iejwwyj-fqnhwfi);vedmnqe=ioodlrl(length(iejwwyj-fqnhwfi),hfikugm)*pow(hnosxbi(dot(hnnzgqv,-knjvoum),uszdjdh.x,uszdjdh.y),uszdjdh.z);vec4 rtbcrvx2=llsljbs2*(vec4 (fqnhwfi,1.0));rtbcrvx2.xy=vec2 (0.5)*rtbcrvx2.xy/rtbcrvx2.w+vec2 (0.5);kotbpbp=max(kotbpbp,vedmnqe*ygseayq(hnnzgqv,iejwwyj,xqqpmlf2,lmnawfd2,xhmejzu2,efyytzg2,dzpoqlw2,rtbcrvx2.xy));\n #endif \n \n #if defined(zhzwila3)&&defined(lmnawfd3)\n hnnzgqv=qkbayba3;iejwwyj=qdijctx3;uszdjdh=vjnmpun3;hfikugm=jbwfpbd3;\n #if defined(pzibdvh3)\n hnnzgqv=zrsdxdf(hnnzgqv);iejwwyj=zkmhwmo(iejwwyj);\n #endif \n hnnzgqv=normalize(hnnzgqv);knjvoum=normalize(iejwwyj-fqnhwfi);vedmnqe=ioodlrl(length(iejwwyj-fqnhwfi),hfikugm)*pow(hnosxbi(dot(hnnzgqv,-knjvoum),uszdjdh.x,uszdjdh.y),uszdjdh.z);vec4 rtbcrvx3=llsljbs3*(vec4 (fqnhwfi,1.0));rtbcrvx3.xy=vec2 (0.5)*rtbcrvx3.xy/rtbcrvx3.w+vec2 (0.5);kotbpbp=max(kotbpbp,vedmnqe*ygseayq(hnnzgqv,iejwwyj,xqqpmlf3,lmnawfd3,xhmejzu3,efyytzg3,dzpoqlw3,rtbcrvx3.xy));\n #endif \n \n #if defined(zhzwila4)&&defined(lmnawfd4)\n hnnzgqv=qkbayba4;iejwwyj=qdijctx4;uszdjdh=vjnmpun4;hfikugm=jbwfpbd4;\n #if defined(pzibdvh4)\n hnnzgqv=zrsdxdf(hnnzgqv);iejwwyj=zkmhwmo(iejwwyj);\n #endif \n hnnzgqv=normalize(hnnzgqv);knjvoum=normalize(iejwwyj-fqnhwfi);vedmnqe=ioodlrl(length(iejwwyj-fqnhwfi),hfikugm)*pow(hnosxbi(dot(hnnzgqv,-knjvoum),uszdjdh.x,uszdjdh.y),uszdjdh.z);vec4 rtbcrvx4=llsljbs4*(vec4 (fqnhwfi,1.0));rtbcrvx4.xy=vec2 (0.5)*rtbcrvx4.xy/rtbcrvx4.w+vec2 (0.5);kotbpbp=max(kotbpbp,vedmnqe*ygseayq(hnnzgqv,iejwwyj,xqqpmlf4,lmnawfd4,xhmejzu4,efyytzg4,dzpoqlw4,rtbcrvx4.xy));\n #endif \n \n #if defined(zhzwila5)&&defined(lmnawfd5)\n hnnzgqv=qkbayba5;iejwwyj=qdijctx5;uszdjdh=vjnmpun5;hfikugm=jbwfpbd5;\n #if defined(pzibdvh5)\n hnnzgqv=zrsdxdf(hnnzgqv);iejwwyj=zkmhwmo(iejwwyj);\n #endif \n hnnzgqv=normalize(hnnzgqv);knjvoum=normalize(iejwwyj-fqnhwfi);vedmnqe=ioodlrl(length(iejwwyj-fqnhwfi),hfikugm)*pow(hnosxbi(dot(hnnzgqv,-knjvoum),uszdjdh.x,uszdjdh.y),uszdjdh.z);vec4 rtbcrvx5=llsljbs5*(vec4 (fqnhwfi,1.0));rtbcrvx5.xy=vec2 (0.5)*rtbcrvx5.xy/rtbcrvx5.w+vec2 (0.5);kotbpbp=max(kotbpbp,vedmnqe*ygseayq(hnnzgqv,iejwwyj,xqqpmlf5,lmnawfd5,xhmejzu5,efyytzg5,dzpoqlw5,rtbcrvx5.xy));\n #endif \n \n #if defined(zhzwila6)&&defined(lmnawfd6)\n hnnzgqv=qkbayba6;iejwwyj=qdijctx6;uszdjdh=vjnmpun6;hfikugm=jbwfpbd6;\n #if defined(pzibdvh6)\n hnnzgqv=zrsdxdf(hnnzgqv);iejwwyj=zkmhwmo(iejwwyj);\n #endif \n hnnzgqv=normalize(hnnzgqv);knjvoum=normalize(iejwwyj-fqnhwfi);vedmnqe=ioodlrl(length(iejwwyj-fqnhwfi),hfikugm)*pow(hnosxbi(dot(hnnzgqv,-knjvoum),uszdjdh.x,uszdjdh.y),uszdjdh.z);vec4 rtbcrvx6=llsljbs6*(vec4 (fqnhwfi,1.0));rtbcrvx6.xy=vec2 (0.5)*rtbcrvx6.xy/rtbcrvx6.w+vec2 (0.5);kotbpbp=max(kotbpbp,vedmnqe*ygseayq(hnnzgqv,iejwwyj,xqqpmlf6,lmnawfd6,xhmejzu6,efyytzg6,dzpoqlw6,rtbcrvx6.xy));\n #endif \n \n #if defined(zhzwila7)&&defined(lmnawfd7)\n hnnzgqv=qkbayba7;iejwwyj=qdijctx7;uszdjdh=vjnmpun7;hfikugm=jbwfpbd7;\n #if defined(pzibdvh7)\n hnnzgqv=zrsdxdf(hnnzgqv);iejwwyj=zkmhwmo(iejwwyj);\n #endif \n hnnzgqv=normalize(hnnzgqv);knjvoum=normalize(iejwwyj-fqnhwfi);vedmnqe=ioodlrl(length(iejwwyj-fqnhwfi),hfikugm)*pow(hnosxbi(dot(hnnzgqv,-knjvoum),uszdjdh.x,uszdjdh.y),uszdjdh.z);vec4 rtbcrvx7=llsljbs7*(vec4 (fqnhwfi,1.0));rtbcrvx7.xy=vec2 (0.5)*rtbcrvx7.xy/rtbcrvx7.w+vec2 (0.5);kotbpbp=max(kotbpbp,vedmnqe*ygseayq(hnnzgqv,iejwwyj,xqqpmlf7,lmnawfd7,xhmejzu7,efyytzg7,dzpoqlw7,rtbcrvx7.xy));\n #endif \n \n #if defined(zhzwila8)&&defined(lmnawfd8)\n hnnzgqv=qkbayba8;iejwwyj=qdijctx8;uszdjdh=vjnmpun8;hfikugm=jbwfpbd8;\n #if defined(pzibdvh8)\n hnnzgqv=zrsdxdf(hnnzgqv);iejwwyj=zkmhwmo(iejwwyj);\n #endif \n hnnzgqv=normalize(hnnzgqv);knjvoum=normalize(iejwwyj-fqnhwfi);vedmnqe=ioodlrl(length(iejwwyj-fqnhwfi),hfikugm)*pow(hnosxbi(dot(hnnzgqv,-knjvoum),uszdjdh.x,uszdjdh.y),uszdjdh.z);vec4 rtbcrvx8=llsljbs8*(vec4 (fqnhwfi,1.0));rtbcrvx8.xy=vec2 (0.5)*rtbcrvx8.xy/rtbcrvx8.w+vec2 (0.5);kotbpbp=max(kotbpbp,vedmnqe*ygseayq(hnnzgqv,iejwwyj,xqqpmlf8,lmnawfd8,xhmejzu8,efyytzg8,dzpoqlw8,rtbcrvx8.xy));\n #endif \n \n #if defined(zhzwila9)&&defined(lmnawfd9)\n hnnzgqv=qkbayba9;iejwwyj=qdijctx9;uszdjdh=vjnmpun9;hfikugm=jbwfpbd9;\n #if defined(pzibdvh9)\n hnnzgqv=zrsdxdf(hnnzgqv);iejwwyj=zkmhwmo(iejwwyj);\n #endif \n hnnzgqv=normalize(hnnzgqv);knjvoum=normalize(iejwwyj-fqnhwfi);vedmnqe=ioodlrl(length(iejwwyj-fqnhwfi),hfikugm)*pow(hnosxbi(dot(hnnzgqv,-knjvoum),uszdjdh.x,uszdjdh.y),uszdjdh.z);vec4 rtbcrvx9=llsljbs9*(vec4 (fqnhwfi,1.0));rtbcrvx9.xy=vec2 (0.5)*rtbcrvx9.xy/rtbcrvx9.w+vec2 (0.5);kotbpbp=max(kotbpbp,vedmnqe*ygseayq(hnnzgqv,iejwwyj,xqqpmlf9,lmnawfd9,xhmejzu9,efyytzg9,dzpoqlw9,rtbcrvx9.xy));\n #endif \n return kotbpbp;}\n #endif \n float udhfzaq(float xpvzhgh,float pejzgoa){return xpvzhgh<0.5?(2.0*xpvzhgh*pejzgoa):(1.0-2.0*(1.0-xpvzhgh)*(1.0-pejzgoa));}vec3 udhfzaq(vec3 xpvzhgh,vec3 pejzgoa){return vec3 (udhfzaq(xpvzhgh.r,pejzgoa.r),udhfzaq(xpvzhgh.g,pejzgoa.g),udhfzaq(xpvzhgh.b,pejzgoa.b));}float otdgeja;vec4 mryvhfe(){\n #if defined(nfgvnsg)||defined(ypznuqr)\n gifbedq();\n #endif \n vec3 ifoaxkt=vwogtxa(qsnvreg.rgb);float ijgjgad=vztvedk;float lrljcmr=fquroso;\n #ifdef igkhmka\n vec3 kceybnl=vwogtxa(woaetjz.rgb);\n #endif \n \n #ifdef egwldhy\n \n #ifdef WEBGL2 \n if((oxryimw&zncnhtb)>uint (0)){\n #else \n if(floor(mod(float (oxryimw/zncnhtb),2.0))==1.0){\n #endif \n \n #endif \n \n #if defined(egwldhy)||defined(lxauyiv)\n vec3 vnikqfu=dplakee(ymlxlax,ngtowew,hzoknqs).rgb;if(qsnvreg.a==0.0){ifoaxkt*=vnikqfu;}else {ifoaxkt=udhfzaq(vnikqfu,ifoaxkt);}\n #if defined(igkhmka)&&!defined(weeuwar)\n if(woaetjz.a==0.0){kceybnl*=vnikqfu;}else {kceybnl=udhfzaq(vnikqfu,kceybnl);}\n #endif \n \n #endif \n \n #ifdef egwldhy\n }\n #endif \n \n #ifdef egwldhy\n \n #ifdef WEBGL2 \n if((oxryimw&ghotfuo)>uint (0)){\n #else \n if(floor(mod(float (oxryimw/ghotfuo),2.0))==1.0){\n #endif \n \n #endif \n \n #if defined(egwldhy)||defined(thpbndm)\n ijgjgad*=xoybity(ltdhpbn,ydwikqq,pblcfaf);\n #endif \n \n #ifdef egwldhy\n }\n #endif \n \n #ifdef egwldhy\n \n #ifdef WEBGL2 \n if((oxryimw&osynrhk)>uint (0)){\n #else \n if(floor(mod(float (oxryimw/osynrhk),2.0))==1.0){\n #endif \n \n #endif \n \n #if defined(egwldhy)||defined(nzrtsqr)\n lrljcmr*=xoybity(zhmvfql,luvcklm,vfyqlph);\n #endif \n \n #ifdef egwldhy\n }\n #endif \n ijgjgad=(jdlwajd==1?1.0-ijgjgad:ijgjgad);\n #ifdef ANIMATING \n vec3 ifoaxkt2=vwogtxa(qsnvreg2);\n #ifdef zrwxjuc\n \n #ifdef WEBGL2 \n if((oxryimw&oplpbzu)>uint (0)){\n #else \n if(floor(mod(float (oxryimw/oplpbzu),2.0))==1.0){\n #endif \n \n #endif \n \n #if defined(zrwxjuc)||defined(otxqyhg)\n vec3 vnikqfu2=dplakee(ymlxlax2,ngtowew2,hzoknqs2).rgb;if(qsnvreg.a==0.0){ifoaxkt2*=vnikqfu2;}else {ifoaxkt2=udhfzaq(vnikqfu2,ifoaxkt2);}\n #if defined(igkhmka)&&!defined(weeuwar)\n vec3 kceybnl2=vwogtxa(woaetjz.rgb);if(woaetjz.a==0.0){kceybnl2*=vnikqfu2;}else {kceybnl2=udhfzaq(vnikqfu2,kceybnl2);}kceybnl=mix(kceybnl,kceybnl2,heftokz);\n #endif \n \n #endif \n \n #ifdef zrwxjuc\n }\n #endif \n ifoaxkt=mix(ifoaxkt,ifoaxkt2,heftokz);\n #endif \n \n #ifdef igkhmka\n \n #ifdef weeuwar\n vec3 cmqllww=dplakee(cwlogkk,sbsyqfs,tkfccyx).rgb;if(woaetjz.a==0.0){kceybnl*=cmqllww;}else {kceybnl=udhfzaq(cmqllww,kceybnl);}\n #endif \n float gmkkhkg=nhwprup.x;if(nhwprup.x>0.2){gmkkhkg=mix(nhwprup.x-0.2,nhwprup.x,clamp(gl_FragCoord.w-0.7,0.0,1.0));}float dvxvisn=clamp((sggbywt-gmkkhkg)/(nhwprup.y-gmkkhkg),0.0,1.0);if(nhwprup.z>0.0){dvxvisn/=diqkawh;}ifoaxkt=mix(kceybnl,ifoaxkt,clamp(dvxvisn,0.0,1.0));\n #ifdef hidmyof\n ifoaxkt=mix(kceybnl*cjcgljz*2.0,ifoaxkt*cjcgljz*2.0,sggbywt);\n #endif \n \n #endif \n \n #ifdef ANIMATING \n float ijgjgad2=vztvedk2;\n #ifdef zrwxjuc\n \n #ifdef WEBGL2 \n if((oxryimw&dfdbnlu)>uint (0)){\n #else \n if(floor(mod(float (oxryimw/dfdbnlu),2.0))==1.0){\n #endif \n \n #endif \n \n #if defined(zrwxjuc)||defined(efxkogl)\n ijgjgad2*=xoybity(ltdhpbn2,ydwikqq2,pblcfaf2);\n #endif \n \n #ifdef zrwxjuc\n }\n #endif \n ijgjgad2=(jdlwajd2==1?1.0-ijgjgad2:ijgjgad2);ijgjgad=mix(ijgjgad,ijgjgad2,heftokz);\n #endif \n \n #ifdef ANIMATING \n float lrljcmr2=fquroso2;\n #ifdef zrwxjuc\n \n #ifdef WEBGL2 \n if((oxryimw&jjutglc)>uint (0)){\n #else \n if(floor(mod(float (oxryimw/jjutglc),2.0))==1.0){\n #endif \n \n #endif \n \n #if defined(zrwxjuc)||defined(vnfasrp)\n lrljcmr2*=xoybity(zhmvfql2,luvcklm2,vfyqlph2);\n #endif \n \n #ifdef zrwxjuc\n }\n #endif \n lrljcmr=mix(lrljcmr,lrljcmr2,heftokz);\n #endif \n vec3 fxcsdif=vwogtxa(rmbxdvn.rgb);float htunysc=0.0;\n #ifdef bzsisog\n fxcsdif*=dplakee(bdwutbz,rdawqhh,chrxigj).rgb;\n #endif \n htunysc=tqpeter;\n #ifdef kddtxjn\n htunysc*=xoybity(dkznlil,vrqlwnm,hakpqqs);\n #else \n \n #ifdef bzsisog\n htunysc*=brhvcmq(fxcsdif);\n #endif \n \n #endif \n \n #ifdef ANIMATING \n vec3 fxcsdif2=vwogtxa(rmbxdvn2.rgb);\n #ifdef xlkdrug\n fxcsdif2*=dplakee(bdwutbz2,rdawqhh2,chrxigj2).rgb;\n #endif \n float htunysc2=tqpeter2;\n #ifdef pzlstld\n htunysc2*=xoybity(dkznlil2,vrqlwnm2,hakpqqs2);\n #else \n \n #ifdef xlkdrug\n htunysc2=brhvcmq(fxcsdif2);\n #endif \n \n #endif \n fxcsdif=mix(fxcsdif,fxcsdif2,heftokz);htunysc=mix(htunysc,htunysc2,heftokz);\n #endif \n otdgeja=ijgjgad;ijgjgad=0.05+0.9*ijgjgad;\n #if defined(vmgeorx)||defined(sjuwcbf)\n \n #ifdef vmgeorx\n float xehorjb=wikjwmu;\n #ifdef iizvave\n xehorjb*=xoybity(pvowxhe,cofxubp,jtmrnbj);\n #endif \n vec3 yukhzlh=jcbgpoy(mgwdxrs).rgb;vec3 dcmogwj=mix(ifoaxkt,yukhzlh,xehorjb);\n #else \n vec3 dcmogwj=ifoaxkt;\n #endif \n ifoaxkt=dcmogwj;\n #endif \n \n #ifdef liwyana\n \n #ifdef kopvmvi\n pyekvda=yfhugch*xoybity(lweuiuw,iixvswj,ugabykz);\n #else \n pyekvda=yfhugch;\n #endif \n \n #else \n \n #endif \n wqxpkop(ijgjgad);vec3 fcvhdeh=vec3 (0.0);float jtwyxfd=1.0;vec4 amdolpo;\n #if hokmxtt>0\n amdolpo=zfuxfmw(ifoaxkt,fxcsdif,ijgjgad,lrljcmr,htunysc);fcvhdeh+=amdolpo.rgb;jtwyxfd+=amdolpo.a;\n #endif \n \n #if gmypjqq>0\n amdolpo=wompqiz(ifoaxkt,fxcsdif,ijgjgad,lrljcmr,htunysc);fcvhdeh+=amdolpo.rgb;jtwyxfd+=amdolpo.a;\n #endif \n \n #if rbpyftt>0\n amdolpo=ktqfrzo(ifoaxkt,fxcsdif,ijgjgad,lrljcmr,htunysc);fcvhdeh+=amdolpo.rgb;jtwyxfd+=amdolpo.a;\n #endif \n \n #if tgolzbx>0\n amdolpo=yrgqgaf(ifoaxkt,fxcsdif,ijgjgad,lrljcmr,htunysc);fcvhdeh+=amdolpo.rgb;jtwyxfd+=amdolpo.a;\n #endif \n fcvhdeh*=mwstbcz.a;amdolpo=varsaiw(ifoaxkt,fxcsdif,ijgjgad,lrljcmr,htunysc);\n #if defined(szgfzxq)||defined(azsutev)\n amdolpo*=vmklvuv();\n #endif \n amdolpo*=tsvlbmp;jtwyxfd*=amdolpo.a;fcvhdeh+=amdolpo.rgb;\n #if defined(znloiam)||defined(gtbnreb)\n float kbrdtkn=jpqdwac();fcvhdeh.rgb*=kbrdtkn;jtwyxfd*=kbrdtkn;\n #endif \n \n #ifdef kvpridb\n vec4 ssqapzq=cvlseou();if(tpxgrnu==0){fcvhdeh+=ssqapzq.rgb*ssqapzq.a;jtwyxfd+=brhvcmq(ssqapzq.rgb)*ssqapzq.a;}else {fcvhdeh=mix(fcvhdeh,ssqapzq.rgb,ssqapzq.a);jtwyxfd=mix(jtwyxfd,brhvcmq(ssqapzq.rgb),ssqapzq.a);}\n #endif \n \n #if ttttpsh>0\n fcvhdeh=qsnypvh(mnkvjcw(fcvhdeh));\n #else \n fcvhdeh=qsnypvh(fcvhdeh);\n #endif \n return vec4 (fcvhdeh,jtwyxfd);}\n #ifdef kytpnre\n vec4 lcqvysw(){\n #ifdef nfgvnsg\n gifbedq();\n #endif \n vec3 dkpstyl;invgiul=uuvufhk(fazebij,vec3 (0.0,0.0,1.0));t=uuvufhk(fytlazk(0),vec3 (1.0,0.0,0.0));b=normalize(cross(invgiul,t));t=normalize(cross(b,invgiul));t*=(gl_FrontFacing==true)?1.0:-1.0;vec3 jvpczdv,bkmzzuy;jvpczdv=qofktfh(t,b,invgiul,eebkyti);hsdrtgp=jvpczdv;uejunvu=1.0;vec3 yurbcov=vec3 (0.0);zttirrk=1.0;\n #ifdef nfgvnsg\n float iynfvhp=fmsshuk;zttirrk=bkwmfbx;\n #ifdef orrsbij\n vec3 yyiokbs=leaglui(pjpgdaw,lsbkrcl,mwyuitt,umjpvqc,iuupley);\n #else \n \n #if defined(syyczsg)||defined(pyofspi)\n vec3 yyiokbs=leaglui(xqahzng,yeqgzpf,ingoasu,rjgjnzi,xedrqbd);\n #else \n vec3 yyiokbs=vec3 (0.0,0.0,1.0);\n #endif \n \n #endif \n wgkvkyl=vec3 (0.0,0.0,1.0);sqcpwnf=vec3 (1.0,0.0,0.0);agvocnj=vec3 (0.0,1.0,0.0);wgkvkyl=rmkharn(t,b,invgiul,yyiokbs);rtdbbna(wgkvkyl,t,sqcpwnf,agvocnj);bqkzdld(zvyasqs,2){vec3 bipfuqj;float pjoceuk;if(dot(wgkvkyl,eebkyti)<=0.0){bipfuqj=-eebkyti;pjoceuk=1.0;}else {bipfuqj=reflect(-eebkyti,wgkvkyl);vec3 feqwfsb=qofktfh(sqcpwnf,agvocnj,wgkvkyl,eebkyti);vec3 iebsmsb;xxwoklw(feqwfsb,1.0,zttirrk,iebsmsb,pjoceuk);bqkzdld(zvyasqs,4){hsdrtgp=qofktfh(t,b,invgiul,rmkharn(sqcpwnf,agvocnj,wgkvkyl,iebsmsb));}}uejunvu=1.0-pjoceuk;vec3 xlttfpn=ptlusfy*cpnlwjt(0.0,bipfuqj);yurbcov+=(pjoceuk*iynfvhp*xlttfpn);}\n #else \n vec3 r=reflect(-eebkyti,invgiul);float pjoceuk;xxwoklw(jvpczdv,1.0,zttirrk,hsdrtgp,pjoceuk);rrziwlm(zvyasqs,4){hsdrtgp=jvpczdv;}uejunvu=1.0-pjoceuk;vec3 xlttfpn=ptlusfy*cpnlwjt(0.0,r);yurbcov+=(pjoceuk*xlttfpn);\n #endif \n if(jvpczdv.z<=0.0){dkpstyl=yurbcov;return vec4 (dkpstyl,1.0);}vec3 ifoaxkt=vec3 (0.0);vec3 fxcsdif=vec3 (0.0);float ijgjgad=0.0;float lrljcmr=0.0;float htunysc=0.0;vec3 fcvhdeh=vec3 (0.0);float jtwyxfd=1.0;vec4 amdolpo;\n #if hokmxtt>0\n amdolpo=zfuxfmw(ifoaxkt,fxcsdif,ijgjgad,lrljcmr,htunysc);fcvhdeh+=amdolpo.rgb;jtwyxfd+=amdolpo.a;\n #endif \n \n #if gmypjqq>0\n amdolpo=wompqiz(ifoaxkt,fxcsdif,ijgjgad,lrljcmr,htunysc);fcvhdeh+=amdolpo.rgb;jtwyxfd+=amdolpo.a;\n #endif \n \n #if rbpyftt>0\n amdolpo=ktqfrzo(ifoaxkt,fxcsdif,ijgjgad,lrljcmr,htunysc);fcvhdeh+=amdolpo.rgb;jtwyxfd+=amdolpo.a;\n #endif \n \n #if tgolzbx>0\n amdolpo=yrgqgaf(ifoaxkt,fxcsdif,ijgjgad,lrljcmr,htunysc);fcvhdeh+=amdolpo.rgb;jtwyxfd+=amdolpo.a;\n #endif \n fcvhdeh*=mwstbcz.a;vec3 xuycvaw=vec3 (0.0);float vpdteyx=clamp(acos(hsdrtgp.z),-1.0,1.0);xuycvaw+=wmwedox*zoqpysw(vpdteyx,0.0)*nkizkqr(fazebij)*pow(2.0,ikywnlr);\n #if defined(sdxjcre)&&sdxjcre>0\n for(int myfjpxu=0;myfjpxu<sdxjcre;++myfjpxu){vec3 ppbtnpi=sdgxppd[myfjpxu];vec3 pjofryg=uvobbpg[myfjpxu]*fhdoawj[myfjpxu]*pow(2.0,ikywnlr);amdolpo=yjgikmo(ifoaxkt,fxcsdif,ijgjgad,lrljcmr,htunysc,ppbtnpi,pjofryg);xuycvaw.rgb+=amdolpo.rgb;}\n #endif \n xuycvaw*=tsvlbmp;yurbcov.xyz+=fcvhdeh+xuycvaw;dkpstyl=yurbcov;\n #if ttttpsh>0\n dkpstyl=eywytlx2(mnkvjcw(dkpstyl));\n #else \n dkpstyl=eywytlx2(dkpstyl);\n #endif \n return vec4 (dkpstyl,1.0);}\n #endif \n float vsoewlw2(vec2 hyxolpo){return mod(2.0*hyxolpo.y+hyxolpo.x+1.0,4.0);}float vsoewlw512(vec2 hyxolpo){vec2 tdiccyz1=mod(hyxolpo,2.0);vec2 tdiccyz2=floor(0.5*mod(hyxolpo,4.0));vec2 tdiccyz4=floor(0.25*mod(hyxolpo,8.0));vec2 tdiccyz8=floor(0.125*mod(hyxolpo,16.0));vec2 tdiccyz16=floor(0.0625*mod(hyxolpo,32.0));vec2 tdiccyz32=floor(0.03125*mod(hyxolpo,64.0));vec2 tdiccyz64=floor(0.015625*mod(hyxolpo,128.0));vec2 tdiccyz128=floor(0.0078125*mod(hyxolpo,256.0));vec2 tdiccyz256=floor(0.00390625*mod(hyxolpo,512.0));return 4.0*(4.0*(4.0*(4.0*(4.0*(4.0*(4.0*(4.0*vsoewlw2(tdiccyz1)+vsoewlw2(tdiccyz2))+vsoewlw2(tdiccyz4))+vsoewlw2(tdiccyz8))+vsoewlw2(tdiccyz16))+vsoewlw2(tdiccyz32))+vsoewlw2(tdiccyz64))+vsoewlw2(tdiccyz128))+vsoewlw2(tdiccyz256);}bool yrinrlf(float jtwyxfd){if(hjqcbro==0){const mat4 rmigdnj=mat4 (1,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0);ivec2 xzmeqdu=ivec2 (tiurzyf(0,rmigdnj).xy*4096.0);return jtwyxfd<clamp((vsoewlw512(vec2 (xzmeqdu))+1.0)/262145.0,0.0,1.0);}else {return ((jtwyxfd<0.5)?2.0:1.2)*jtwyxfd<clamp((vsoewlw512(gl_FragCoord.xy+vec2 (hjqcbro))+1.0)/262145.0,0.0,1.0);}}void main(){\n #ifdef igkhmka\n qyngzog();\n #endif \n \n #ifdef pyjqigb\n vpczxzg=vyjxjvu3(vec3 (0,1,0),-jmnndrt*6.283185307179586);\n #endif \n float jtwyxfd=1.0;agubczf=jqgramm4.xyz;vkstiss=ibymued4.xyz;fqnhwfi=olsbfcm4.xyz;hbnjyno.x=jqgramm4.a;hbnjyno.y=ibymued4.a;hbnjyno.z=olsbfcm4.a;wnlnryx=gkuebzf4.xyz;\n #ifdef tlecjjv\n vec3 ikqbwsr;if(ummxwav==1){float nlwcjxh=cqtmruh[0]*cqtmruh[0]+cqtmruh[1]*cqtmruh[1]+cqtmruh[2]*cqtmruh[2];float t=-((cqtmruh[0]*(fqnhwfi[0]-yqifqgk[0]))+(cqtmruh[1]*(fqnhwfi[1]-yqifqgk[1]))+(cqtmruh[2]*(fqnhwfi[2]-yqifqgk[2])))/nlwcjxh;ikqbwsr=vec3 (cqtmruh[0]*t+fqnhwfi[0],cqtmruh[1]*t+fqnhwfi[1],cqtmruh[2]*t+fqnhwfi[2]);if(dot(normalize(fqnhwfi-ikqbwsr),cqtmruh)<=0.0){discard;}}\n #endif \n \n #ifdef zgbdrir\n if(ufoyjfa>0.0){if(gkuebzf4.w==0.0){discard;}}\n #endif \n if(bzmstcf!=-1.0){\n #ifdef egwldhy\n \n #ifdef WEBGL2 \n if((oxryimw&dmxfrrv)>uint (0)){\n #else \n if(floor(mod(float (oxryimw/dmxfrrv),2.0))==1.0){\n #endif \n \n #endif \n \n #if defined(egwldhy)||defined(khvylnr)\n jtwyxfd=rwbnecu(vthsmnb,smggktt,imjkghn);\n #endif \n \n #ifdef egwldhy\n }\n #endif \n jtwyxfd*=bzmstcf;}\n #ifdef ANIMATING \n float jtwyxfd2=1.0;\n #ifdef zrwxjuc\n \n #ifdef WEBGL2 \n if((oxryimw&qgycyvy)>uint (0)){\n #else \n if(floor(mod(float (oxryimw/qgycyvy),2.0))==1.0){\n #endif \n \n #endif \n \n #if defined(zrwxjuc)||defined(cybhscz)\n jtwyxfd2=rwbnecu(vthsmnb2,smggktt2,imjkghn2);\n #endif \n \n #ifdef zrwxjuc\n }\n #endif \n jtwyxfd2*=bzmstcf2;jtwyxfd=mix(jtwyxfd,jtwyxfd2,heftokz);\n #endif \n jcpdwjh=normalize(hbnjyno);thlcqvl=normalize(vkstiss);eebkyti=normalize(xzwunne-fqnhwfi);whfronj(jcpdwjh,thlcqvl,eebkyti);\n #ifdef kytpnre\n vec4 rtluoxj=cqthvwc(lcqvysw());\n #else \n vec4 rtluoxj=cqthvwc(mryvhfe());\n #endif \n gl_FragColor.rgb=rtluoxj.rgb;gl_FragColor.a=jtwyxfd;float gzpxmek=0.0;if(bzmstcf!=-1.0){gzpxmek=ymenuuk;\n #ifdef ANIMATING \n gzpxmek=mix(gzpxmek,ymenuuk2,heftokz);\n #endif \n }\n #ifdef igkhmka\n if(ftqjlzm==0&&gl_FragColor.a<1.0&&sggbywt>0.0){gl_FragColor.a*=sggbywt;}\n #endif \n \n #ifndef zgbdrir\n if(gl_FragColor.a<gzpxmek*0.995+0.005){discard;}\n #endif \n float cuahyrs=clamp(rtluoxj.a,0.0,1.0);float pwxuyly=1.0;gl_FragColor.a+=vdiidww*pwxuyly*(1.0-jtwyxfd)*cuahyrs;\n #ifdef zgbdrir\n if(ufoyjfa>0.0){gl_FragColor.a*=gkuebzf4.w;}if(gl_FragColor.a<gzpxmek*0.995+0.005){discard;}\n #endif \n if(bzmstcf!=-1.0){if(ftqjlzm==4&&yrinrlf(gl_FragColor.a)){discard;}if(ftqjlzm>=3){gl_FragColor.a=1.0;}}if(atutpxf==1&&mgntrba!=1){if(ejcsltc==0){gl_FragColor.rgb=mix(gl_FragColor.rgb,kisinpb.rgb,kisinpb.a);}else if(ejcsltc==1){gl_FragColor.rgb+=kisinpb.rgb*kisinpb.a;}else if(ejcsltc==2){gl_FragColor.rgb*=kisinpb.rgb;}else if(ejcsltc==3){gl_FragColor.rgb=udhfzaq(gl_FragColor.rgb,kisinpb.rgb);}}\n #if defined(enkgdhh)||defined(tlecjjv)\n vec2 pzjlshd=vec2 (gl_FragCoord.x/qxxpdff[0],gl_FragCoord.y/qxxpdff[1]);\n #endif \n \n #ifdef tlecjjv\n if(ummxwav==1){if(fxmwxnt!=0.0){float srhkupd=1.0-clamp((distance(fqnhwfi,ikqbwsr)-htrgljy)/(fxmwxnt-htrgljy),0.0,1.0);gl_FragColor*=pow(srhkupd,pijwcjc);}}if(ummxwav==2){vec2 deobjdf=vec2 (-1.0,1.0)*pzjlshd+vec2 (1.0,0.0);float cqhyrfl=ankxunu;if(qdhbrga==1.0){cqhyrfl*=brhvcmq(texture2D(rwexkck,tiurzyf(0,crgwmls).xy).rgb);}vec4 oqpmfay=texture2D(plcreao,deobjdf);gl_FragColor.rgb=mix(gl_FragColor.rgb,oqpmfay.rgb,cqhyrfl);}\n #endif \n \n #if defined(rofpzvn)||defined(pnswumg)\n float tcyoere=1.0;float tcyoere2=1.0;\n #ifdef rofpzvn\n tcyoere=ijwreus;\n #endif \n \n #ifdef pnswumg\n tcyoere2=ijwreus2;\n #endif \n \n #ifdef ANIMATING \n tcyoere=mix(tcyoere,tcyoere2,heftokz);\n #endif \n vec3 refrColor;vec4 jocmxtf;float xvwdwac=gl_FragColor.a;float dajzlvb=1.0;\n #ifdef rofpzvn\n vec3 refr;if(pqtpdgb==0){refr=normalize(refract(-eebkyti,jcpdwjh,1.0/tcyoere));}else {refr=refract(normalize(agubczf-vec3 (0,0,1)),thlcqvl,1.0/tcyoere);}dajzlvb=tvceenj;\n #ifdef tdigpwa\n gl_FragColor.a+=(1.0-tvceenj)*(1.0-gl_FragColor.a);xvwdwac=gl_FragColor.a;vec3 bwbdrsm=refract(normalize(wnlnryx),wfzgvrg,1.0/tcyoere);float subkgod=(tcyoere>=1.0)?tcyoere:1.0/tcyoere;jocmxtf=nobmeqg(bwbdrsm,otdgeja,subkgod*dnbasxr);refrColor=jocmxtf.rgb;xvwdwac+=jocmxtf.a*(1.0-gl_FragColor.a);\n #else \n xvwdwac=1.0;\n #ifdef ymqdhta\n refrColor=argpges(mximbml,refr,goobxbd-pqtpdgb,qskkyrm,vptxeeo,1).rgb;\n #else \n refrColor=cpnlwjt(otdgeja,refr);\n #endif \n \n #endif \n \n #else \n refrColor=gl_FragColor.rgb;\n #endif \n vec3 refrColor2;float xvwdwac2=gl_FragColor.a;float dajzlvb2=1.0;\n #ifdef pnswumg\n dajzlvb2=tvceenj2;\n #ifdef tdigpwa\n refrColor2=refrColor;xvwdwac2+=xvwdwac;\n #else \n xvwdwac2=1.0;\n #ifdef yxcsywt\n refrColor2=argpges(mximbml2,refr,goobxbd2-pqtpdgb2,qskkyrm2,vptxeeo2,1).rgb;\n #else \n refrColor2=refrColor;\n #endif \n \n #endif \n \n #else \n refrColor2=gl_FragColor.rgb;\n #endif \n \n #ifdef ANIMATING \n dajzlvb=mix(dajzlvb,dajzlvb2,heftokz);refrColor=mix(refrColor,refrColor2,heftokz);xvwdwac=mix(xvwdwac,xvwdwac2,heftokz);\n #endif \n refrColor.rgb=mix(gl_FragColor.rgb,refrColor.rgb,1.0-gl_FragColor.a);gl_FragColor.a=mix(gl_FragColor.a,xvwdwac,dajzlvb);gl_FragColor.rgb=mix(gl_FragColor.rgb,refrColor.rgb,dajzlvb);\n #else \n \n #ifdef enkgdhh\n if(ftqjlzm==1){gl_FragColor.rgb*=gl_FragColor.a;gl_FragColor.rgb=texture2D(dfwrrka,pzjlshd).rgb+gl_FragColor.rgb;}else if(ftqjlzm==2){gl_FragColor.rgb*=gl_FragColor.a;gl_FragColor.rgb=texture2D(dfwrrka,pzjlshd).rgb*gl_FragColor.rgb;}else {gl_FragColor.rgb=mix(texture2D(dfwrrka,pzjlshd).rgb,gl_FragColor.rgb,gl_FragColor.a);}gl_FragColor.a=1.0;\n #else \n gl_FragColor.rgb*=gl_FragColor.a;\n #endif \n \n #endif \n \n #if upcfkyg==1\n gl_FragColor.rgb=mix(gl_FragColor.rgb,vec3 (0.0),keduzjo());\n #endif \n }",
vertexShaderRealRendering:"uniform mat4 ampnorz;uniform mat4 ondssmn;uniform mat4 ghgsnpw;uniform mat3 dcsphyk;uniform mat3 ccpxoqv;\n #ifdef zgbdrir\n uniform float ufoyjfa;uniform float xkuelka;uniform float dtvyjnu;\n #endif \n varying vec4 jqgramm4;varying vec4 ibymued4;varying vec4 olsbfcm4;varying vec4 gkuebzf4;/*attribute vec3 ymaxekn;*//*attribute vec3 pcgewnw;*//*attribute vec2 aUv0 ;*//*attribute vec2 aUv1 ;*//*attribute vec2 aUv2 ;*//*attribute vec2 aUv3 ;*//*attribute vec2 aUv4 ;*//*attribute vec2 aUv5 ;*//*attribute vec2 aUv6 ;*//*attribute vec2 aUv7 ;*//*attribute vec2 aVertexTangent0 ;*//*attribute vec2 aVertexTangent1 ;*//*attribute vec2 aVertexTangent2 ;*//*attribute vec2 aVertexTangent3 ;*//*attribute vec2 aVertexTangent4 ;*//*attribute vec2 aVertexTangent5 ;*//*attribute vec2 aVertexTangent6 ;*//*attribute vec2 aVertexTangent7 ;*//*uniform vec3 jaqaqjo;*//*uniform vec3 ihabiil;*//*uniform vec4 hczygcx;*//*uniform vec3 vmxutmc;*//*uniform vec3 qdijctx;*//*uniform vec3 qkbayba;*//*uniform vec4 jbwfpbd;*//*uniform vec3 vjnmpun;*//*uniform vec2 dzpoqlw;*//*uniform vec3 iuqlhbj;*//*uniform vec3 ntjaipr;*//*uniform vec3 szyepvr;*//*uniform vec2 vfpwfis;*//*uniform vec3 pgksjxv;*//*uniform vec3 irayogf;*//*uniform vec3 tqwolgz;*/\n /*#define mbdxhsz*/\n \n /*#define fcemnll*/\n \n /*#define gefwago*/\n \n /*#define adacfgm*/\n \n /*#define qkurkjy*/\n \n /*#define uzzsmwp*/\n \n /*#define pgnowwy*/\n \n /*#define xhmejzu*/\n \n /*#define efyytzg*/\n \n /*#define nxaqjjs*/\n \n /*#define lgjrplk*/\n \n /*#define tiurzyf*/\n \n /*#define fsjlspn*/\n \n /*#define fytlazk*/\n \n #if octspal>0\n \n #ifdef kqlahgv0\n uniform mat4 bfigqga0;varying vec2 izejsjy0;\n #endif \n \n #ifdef kqlahgv1\n uniform mat4 bfigqga1;varying vec2 izejsjy1;\n #endif \n \n #ifdef kqlahgv2\n uniform mat4 bfigqga2;varying vec2 izejsjy2;\n #endif \n \n #ifdef kqlahgv3\n uniform mat4 bfigqga3;varying vec2 izejsjy3;\n #endif \n \n #ifdef kqlahgv4\n uniform mat4 bfigqga4;varying vec2 izejsjy4;\n #endif \n \n #ifdef kqlahgv5\n uniform mat4 bfigqga5;varying vec2 izejsjy5;\n #endif \n \n #ifdef kqlahgv6\n uniform mat4 bfigqga6;varying vec2 izejsjy6;\n #endif \n \n #ifdef kqlahgv7\n uniform mat4 bfigqga7;varying vec2 izejsjy7;\n #endif \n \n #ifdef kqlahgv8\n uniform mat4 bfigqga8;varying vec2 izejsjy8;\n #endif \n \n #ifdef kqlahgv9\n uniform mat4 bfigqga9;varying vec2 izejsjy9;\n #endif \n void zufdgzi(const int myfjpxu,vec2 uuxsjad){}\n #endif \n void main(){vec4 iejwwyj=ondssmn*vec4 (ymaxekn,1.0);ibymued4.xyz=normalize(dcsphyk*pcgewnw);vec3 hbnjyno=normalize(ccpxoqv*pcgewnw);vec4 wmxooao=ampnorz*iejwwyj;gkuebzf4.xyz=wmxooao.xyz;\n #ifdef zgbdrir\n if(ufoyjfa>0.0){float wcwmczn=step(ufoyjfa,1.5)*ymaxekn.x+step(1.5,ufoyjfa)*step(ufoyjfa,2.5)*ymaxekn.y+step(2.5,ufoyjfa)*ymaxekn.z;if(wcwmczn>=dtvyjnu){gkuebzf4.w=0.0;}else {if(wcwmczn>=xkuelka){gkuebzf4.w=1.0-((wcwmczn-xkuelka)/(dtvyjnu-xkuelka));}else {gkuebzf4.w=1.0;}}}\n #endif \n jqgramm4.xyz=normalize(wmxooao.xyz);olsbfcm4.xyz=iejwwyj.xyz;gl_Position=ghgsnpw*wmxooao;jqgramm4.a=hbnjyno.x;ibymued4.a=hbnjyno.y;olsbfcm4.a=hbnjyno.z;\n #if octspal>0\n vec4 rbrvsbh;\n #ifdef kqlahgv0\n rbrvsbh=bfigqga0*iejwwyj;izejsjy0=0.5*rbrvsbh.xy/rbrvsbh.w+0.5;\n #endif \n \n #ifdef kqlahgv1\n rbrvsbh=bfigqga1*iejwwyj;izejsjy1=0.5*rbrvsbh.xy/rbrvsbh.w+0.5;\n #endif \n \n #ifdef kqlahgv2\n rbrvsbh=bfigqga2*iejwwyj;izejsjy2=0.5*rbrvsbh.xy/rbrvsbh.w+0.5;\n #endif \n \n #ifdef kqlahgv3\n rbrvsbh=bfigqga3*iejwwyj;izejsjy3=0.5*rbrvsbh.xy/rbrvsbh.w+0.5;\n #endif \n \n #ifdef kqlahgv4\n rbrvsbh=bfigqga4*iejwwyj;izejsjy4=0.5*rbrvsbh.xy/rbrvsbh.w+0.5;\n #endif \n \n #ifdef kqlahgv5\n rbrvsbh=bfigqga5*iejwwyj;izejsjy5=0.5*rbrvsbh.xy/rbrvsbh.w+0.5;\n #endif \n \n #ifdef kqlahgv6\n rbrvsbh=bfigqga6*iejwwyj;izejsjy6=0.5*rbrvsbh.xy/rbrvsbh.w+0.5;\n #endif \n \n #ifdef kqlahgv7\n rbrvsbh=bfigqga7*iejwwyj;izejsjy7=0.5*rbrvsbh.xy/rbrvsbh.w+0.5;\n #endif \n \n #ifdef kqlahgv8\n rbrvsbh=bfigqga8*iejwwyj;izejsjy8=0.5*rbrvsbh.xy/rbrvsbh.w+0.5;\n #endif \n \n #ifdef kqlahgv9\n rbrvsbh=bfigqga9*iejwwyj;izejsjy9=0.5*rbrvsbh.xy/rbrvsbh.w+0.5;\n #endif \n \n #endif \n ",
fragmentShaderRealRendering:"\n #ifdef ANIMATING \n uniform float heftokz;\n #endif \n uniform float fhguuoo;\n #ifdef tqtzlvf\n uniform sampler2D xspuomx;uniform int jcxvcld;uniform mat4 bbjrkoj;\n #else \n uniform vec4 xcxkhty;\n #endif \n uniform float yxuhtpf;\n #ifdef altvvbq\n uniform sampler2D kkbgecz;uniform int lizkbiv;uniform mat4 smlqamg;\n #else \n uniform vec4 gmzubwt;\n #endif \n uniform float tqpeter;\n #ifdef bzsisog\n uniform sampler2D bdwutbz;uniform int rdawqhh;uniform mat4 chrxigj;\n #else \n uniform vec4 rmbxdvn;\n #endif \n \n #ifdef kddtxjn\n uniform sampler2D dkznlil;uniform int vrqlwnm;uniform mat4 hakpqqs;\n #endif \n uniform float jwbntls;\n #ifdef ylmuugp\n uniform sampler2D hbaqifu;uniform int kvqnhvv;uniform mat4 fbqzibe;\n #else \n uniform vec4 nsnbysp;\n #endif \n \n #ifdef aitbpqn\n uniform sampler2D qzywjbd;uniform int urpflui;uniform mat4 miqrofj;\n #endif \n \n #ifdef vvqtuez\n uniform sampler2D tycsukv;uniform int azqmncb;uniform mat4 hivqfir;\n #endif \n uniform float fgjxdyy;\n #ifdef poteimn\n uniform sampler2D xjrxkxf;uniform int vxabpou;uniform float mtppyuk;uniform mat4 krklesm;uniform int bklqtbh;\n #ifdef ayiiefg\n uniform sampler2D qxzsape;uniform int ituhipi;uniform mat4 wygpxnc;\n #endif \n \n #endif \n \n #ifdef osvrsmm\n uniform float rdmdoxh;uniform vec3 zmanptk;uniform sampler2D shxrduo;uniform int tbxrkkm;uniform mat4 ljrcsui;\n #ifdef pksryor\n uniform sampler2D kwjbjjn;uniform int hvuuljr;uniform mat4 pwyttky;\n #endif \n \n #endif \n \n #ifdef xovkksj\n uniform samplerCube xplzpaf;uniform float kyuqpss;uniform float rhvwknj;uniform int qrcyyzq;uniform int pndixgj;uniform vec3 gveasdj;uniform float dvdtkio;\n #endif \n \n #ifdef tdigpwa\n uniform sampler2D egtltvw;uniform highp sampler2D vtwyuay;uniform float dnbasxr;uniform float jtqmkov;uniform mat4 ghgsnpw;uniform vec2 xcsurjq;uniform vec2 uwxywpw;\n #endif \n \n #ifdef kyhuvgs\n uniform sampler2D fnltzwx;uniform int cjpagro;uniform mat4 vdzqqlc;\n #endif \n \n #ifdef rofpzvn\n \n #ifdef ymqdhta\n uniform samplerCube mximbml;uniform int goobxbd;uniform vec3 qskkyrm;uniform float vptxeeo;\n #endif \n uniform float tvceenj;uniform float ijwreus;uniform int pqtpdgb;\n #endif \n \n #ifdef sfsqzng\n uniform sampler2D pofdivt;uniform int dzptjrq;uniform mat4 gqedqnf;\n #endif \n uniform float bzmstcf;uniform float ymenuuk;uniform int ftqjlzm;\n #ifdef khvylnr\n uniform sampler2D bxddaze;uniform int avbfhlu;uniform int uxqdzlm;uniform mat4 imjkghn;\n #endif \n \n #ifdef enkgdhh\n uniform sampler2D dfwrrka;\n #endif \n \n #ifdef przvnvk\n uniform sampler2D gkgxkms;uniform int jxhskgy;uniform mat4 cejprze;uniform float nvpphgu;\n #endif \n \n #ifdef gntovzq\n uniform float schoboi;uniform sampler2D bmwhadd;uniform mat4 djklitl;\n #ifdef njedwma\n uniform sampler2D nkzuzqt;uniform int wifbckp;uniform mat4 djuzoiv;\n #endif \n \n #endif \n \n #ifdef liwyana\n uniform float yfhugch;\n #ifdef kopvmvi\n uniform int iixvswj;uniform sampler2D lweuiuw;uniform mat4 ugabykz;\n #endif \n \n #endif \n \n #ifdef ANIMATING \n uniform float fhguuoo2;\n #ifdef ciziuga\n uniform sampler2D xspuomx2;uniform int jcxvcld2;uniform mat4 bbjrkoj2;\n #else \n uniform vec4 xcxkhty2;\n #endif \n uniform float yxuhtpf2;\n #ifdef hyucpon\n uniform sampler2D kkbgecz2;uniform int lizkbiv2;uniform mat4 smlqamg2;\n #else \n uniform vec4 gmzubwt2;\n #endif \n uniform float tqpeter2;\n #ifdef xlkdrug\n uniform sampler2D bdwutbz2;uniform int rdawqhh2;uniform mat4 chrxigj2;\n #else \n uniform vec4 rmbxdvn2;\n #endif \n \n #ifdef pzlstld\n uniform sampler2D dkznlil2;uniform int vrqlwnm2;uniform mat4 hakpqqs2;\n #endif \n uniform float jwbntls2;\n #ifdef muzpkxq\n uniform sampler2D hbaqifu2;uniform int kvqnhvv2;uniform mat4 fbqzibe2;\n #else \n uniform vec4 nsnbysp2;\n #endif \n \n #ifdef qvyqlby\n uniform sampler2D qzywjbd2;uniform int urpflui2;uniform mat4 miqrofj2;\n #endif \n \n #ifdef lrvyeou\n uniform sampler2D tycsukv2;uniform int azqmncb2;uniform mat4 hivqfir2;\n #endif \n uniform float fgjxdyy2;uniform float bzmstcf2;uniform float ymenuuk2;\n #ifdef fomzgxw\n uniform sampler2D xjrxkxf2;uniform int vxabpou2;uniform float mtppyuk2;uniform mat4 krklesm2;uniform int bklqtbh2;\n #ifdef fdclrvp\n uniform sampler2D qxzsape2;uniform int ituhipi2;uniform mat4 wygpxnc2;\n #endif \n \n #endif \n \n #ifdef lipkixn\n uniform float rdmdoxh2;uniform vec3 zmanptk2;uniform sampler2D shxrduo2;uniform int tbxrkkm2;uniform mat4 ljrcsui2;\n #ifdef rgikbwi\n uniform sampler2D kwjbjjn2;uniform int hvuuljr2;uniform mat4 pwyttky2;\n #endif \n \n #endif \n \n #ifdef ycbccsl\n uniform samplerCube xplzpaf2;uniform float kyuqpss2;uniform float rhvwknj2;uniform int qrcyyzq2;uniform int pndixgj2;uniform vec3 gveasdj2;uniform float dvdtkio2;\n #endif \n \n #ifdef eeqsdyv\n uniform sampler2D fnltzwx2;uniform int cjpagro2;uniform mat4 vdzqqlc2;\n #endif \n \n #ifdef pnswumg\n \n #ifdef yxcsywt\n uniform samplerCube mximbml2;uniform int goobxbd2;uniform vec3 qskkyrm2;uniform float vptxeeo2;\n #endif \n uniform float tvceenj2;uniform float ijwreus2;uniform int pqtpdgb2;\n #endif \n \n #ifdef xlbaqqf\n uniform sampler2D pofdivt2;uniform int dzptjrq2;uniform mat4 gqedqnf2;\n #endif \n \n #ifdef cybhscz\n uniform sampler2D bxddaze2;uniform int avbfhlu2;uniform int uxqdzlm2;uniform mat4 imjkghn2;\n #endif \n \n #ifdef hqoltzb\n uniform sampler2D gkgxkms2;uniform int jxhskgy2;uniform mat4 cejprze2;uniform float nvpphgu2;\n #endif \n \n #ifdef hbowaxq\n uniform sampler2D bmwhadd2;uniform float schoboi2;uniform mat4 djklitl2;\n #ifdef qikfanu\n uniform sampler2D nkzuzqt2;uniform int wifbckp2;uniform mat4 djuzoiv2;\n #endif \n \n #endif \n \n #ifdef ghxxrdt\n uniform float yfhugch2;\n #ifdef tppdyzt\n uniform sampler2D lweuiuw2;uniform int iixvswj2;uniform mat4 ugabykz2;\n #endif \n \n #endif \n \n #endif \n \n #if hokmxtt>0&&octspal>0\n \n #ifdef kqlahgv0\n varying vec2 izejsjy0;uniform sampler2D hhknvcm0;\n #endif \n \n #ifdef kqlahgv1\n varying vec2 izejsjy1;uniform sampler2D hhknvcm1;\n #endif \n \n #ifdef kqlahgv2\n varying vec2 izejsjy2;uniform sampler2D hhknvcm2;\n #endif \n \n #ifdef kqlahgv3\n varying vec2 izejsjy3;uniform sampler2D hhknvcm3;\n #endif \n \n #ifdef kqlahgv4\n varying vec2 izejsjy4;uniform sampler2D hhknvcm4;\n #endif \n \n #ifdef kqlahgv5\n varying vec2 izejsjy5;uniform sampler2D hhknvcm5;\n #endif \n \n #ifdef kqlahgv6\n varying vec2 izejsjy6;uniform sampler2D hhknvcm6;\n #endif \n \n #ifdef kqlahgv7\n varying vec2 izejsjy7;uniform sampler2D hhknvcm7;\n #endif \n \n #ifdef kqlahgv8\n varying vec2 izejsjy8;uniform sampler2D hhknvcm8;\n #endif \n \n #ifdef kqlahgv9\n varying vec2 izejsjy9;uniform sampler2D hhknvcm9;\n #endif \n \n #endif \n \n #if gmypjqq>0&&telezcv>0\n \n #ifdef lmnawfd0\n uniform mat4 llsljbs0;uniform sampler2D xqqpmlf0;\n #endif \n \n #ifdef lmnawfd1\n uniform mat4 llsljbs1;uniform sampler2D xqqpmlf1;\n #endif \n \n #ifdef lmnawfd2\n uniform mat4 llsljbs2;uniform sampler2D xqqpmlf2;\n #endif \n \n #ifdef lmnawfd3\n uniform mat4 llsljbs3;uniform sampler2D xqqpmlf3;\n #endif \n \n #ifdef lmnawfd4\n uniform mat4 llsljbs4;uniform sampler2D xqqpmlf4;\n #endif \n \n #ifdef lmnawfd5\n uniform mat4 llsljbs5;uniform sampler2D xqqpmlf5;\n #endif \n \n #ifdef lmnawfd6\n uniform mat4 llsljbs6;uniform sampler2D xqqpmlf6;\n #endif \n \n #ifdef lmnawfd7\n uniform mat4 llsljbs7;uniform sampler2D xqqpmlf7;\n #endif \n \n #ifdef lmnawfd8\n uniform mat4 llsljbs8;uniform sampler2D xqqpmlf8;\n #endif \n \n #ifdef lmnawfd9\n uniform mat4 llsljbs9;uniform sampler2D xqqpmlf9;\n #endif \n \n #endif \n uniform vec4 mwstbcz;\n #ifdef uoaojlv\n uniform samplerCube isyrtjm;uniform float deijscq;uniform int qwgzgln;\n #endif \n \n #ifdef tlecjjv\n uniform int ummxwav;uniform vec3 yqifqgk;uniform vec3 cqtmruh;uniform vec3 qdzcggg;uniform float htrgljy;uniform float fxmwxnt;uniform float pijwcjc;uniform float ankxunu;uniform float qdhbrga;uniform sampler2D plcreao;uniform sampler2D rwexkck;uniform mat4 crgwmls;\n #endif \n uniform mat4 ampnorz;uniform mat4 wqfoqbo;uniform mat4 drvaieo;uniform mat3 itcyfdm;uniform vec4 kisinpb;uniform int ejcsltc;uniform int atutpxf;\n #ifdef zgbdrir\n uniform float ufoyjfa;\n #endif \n uniform vec3 xzwunne;uniform vec3 fnmxbkg;uniform vec2 qxxpdff;uniform int baqhnvn;uniform int fhogvoz;uniform int mgntrba;uniform float laicxpp;uniform float mjjhnsa;uniform int hjqcbro;varying vec4 jqgramm4;varying vec4 ibymued4;varying vec4 olsbfcm4;varying vec4 gkuebzf4;vec3 agubczf;vec3 vkstiss;vec3 fqnhwfi;vec3 hbnjyno;vec3 wnlnryx;vec3 lxlmcsl;vec3 iieuufh;struct jkqjebn{vec3 pbfcbmx;vec3 fxcsdif;};float fwyvcka;\n #if defined(poteimn)||defined(fomzgxw)||defined(przvnvk)||defined(hqoltzb)\n mat3 wxofswh;\n #endif \n \n #if octspal>0||telezcv>0\n \n #if mzpxama==1\n float mqtihjr(const  in vec4 xckacmf){const vec4 ztpwjul=vec4 (1.0/(256.0*256.0*256.0),1.0/(256.0*256.0),1.0/256.0,1.0);float jbyfmhr=dot(xckacmf,ztpwjul);return jbyfmhr;}\n #elif mzpxama==2\n float kieujgj(vec4 xpihigs){const vec4 dtmentp=vec4 (1.0,1.0/255.0,1.0/(255.0*255.0),1.0/(255.0*255.0*255.0));return dot(xpihigs,dtmentp);}\n #elif mzpxama==3\n float ecywjdb(vec4 wonkgrm){ivec4 mgoyycz=ivec4 (wonkgrm*255.0+0.5);float ppkdwez=float (mgoyycz[0]+mgoyycz[1]*256)+float (mgoyycz[2]-mgoyycz[2]/128*128+128)*256.0*256.0;int exp=150-(mgoyycz[3]-mgoyycz[3]/128*128)*2-(mgoyycz[2]/128);ppkdwez/=exp2(float (exp));if(mgoyycz[3]/128==1)return -ppkdwez;else return ppkdwez;}\n #elif mzpxama==4\n float wtsfgxq32(vec4 rgba){float weseeku=1.0-step(128.0,rgba[0])*2.0;float twhfvbe=2.0*mod(rgba[0],128.0)+step(128.0,rgba[1])-127.0;float fwafwnw=mod(rgba[1],128.0)*65536.0+rgba[2]*256.0+rgba[3]+float (8388608.0);float usgykbj=weseeku*exp2(twhfvbe)*(fwafwnw*exp2(-23.0));return usgykbj;}\n #elif mzpxama==5\n float llqgxfo4(vec4 dgnhgdm){vec4 rgba=255.0*dgnhgdm;float sign=step(-128.0,-rgba[1])*2.0-1.0;float omivuvt=rgba[0]-127.0;if(abs(omivuvt+127.0)<0.001)return 0.0;float fadagpy=mod(rgba[1],128.0)*65536.0+rgba[2]*256.0+rgba[3]+(8388608.0);return sign*exp2(omivuvt-23.0)*fadagpy;}\n #endif \n \n #if gpfdayb==1\n float lmymseh(sampler2D nmlmkmt,vec2 plnwnit,vec2 uyxiwjv,float lagcdrm){vec2 yurbcov=plnwnit+uyxiwjv;if(yurbcov.x>=1.0||yurbcov.y>=1.0||yurbcov.x<=0.0||yurbcov.y<=0.0){return 100000000.0;}float res ;\n #if mzpxama==1\n res =mqtihjr(texture2D(nmlmkmt,plnwnit+uyxiwjv))*lagcdrm;\n #elif mzpxama==2\n res =kieujgj(texture2D(nmlmkmt,plnwnit+uyxiwjv))*lagcdrm;\n #elif mzpxama==3\n res =ecywjdb(texture2D(nmlmkmt,plnwnit+uyxiwjv));\n #elif mzpxama==4\n res =wtsfgxq32(texture2D(nmlmkmt,plnwnit+uyxiwjv));\n #elif mzpxama==5\n res =llqgxfo4(texture2D(nmlmkmt,plnwnit+uyxiwjv));\n #elif mzpxama==7\n res =texture2D(nmlmkmt,plnwnit+uyxiwjv).r;res *=lagcdrm;\n #else \n res =0.0;\n #endif \n return res ;}float ubnhgsi(sampler2D lrotttz,vec3 pmmxppk,vec2 ktnvxcp,vec2 rtbcrvx,float iuknzjh,float lagcdrm){float kotbpbp=0.0;float kgvjoay=distance(pmmxppk,fqnhwfi);float govektg=lmymseh(lrotttz,rtbcrvx,vec2 (0,0),lagcdrm);if(kgvjoay>govektg){kotbpbp=iuknzjh;}return 1.0-kotbpbp;}\n #endif \n \n #if gpfdayb==3\n float lmrefqv(vec2 xpihigs){return xpihigs.x+(xpihigs.y/255.0);}float lsqtotm(float xieqjvb,float iqfbgdu,float cyxmscz){return clamp((cyxmscz-xieqjvb)/(iqfbgdu-xieqjvb),0.0,1.0);}float xpcfllh(sampler2D lrotttz,vec3 pmmxppk,vec2 rtbcrvx,float iuknzjh,float lagcdrm){float kgvjoay=distance(pmmxppk,fqnhwfi)/lagcdrm;vec4 nmlmkmt=texture2D(lrotttz,rtbcrvx);\n #if mzpxama==6\n float kwtioke=lmrefqv(nmlmkmt.rg);float bzujscr=lmrefqv(nmlmkmt.ba);\n #elif mzpxama==8\n float kwtioke=nmlmkmt.r;float bzujscr=nmlmkmt.b;\n #else \n return 1.0;\n #endif \n float rnglrqe=0.0;float vynjeko2=bzujscr;float izbvoyx2=kwtioke*kwtioke;float bphtptn=vynjeko2-izbvoyx2;float ihknsyq=kwtioke-kgvjoay;float wslugkm2=ihknsyq*ihknsyq;float p=bphtptn/(bphtptn+wslugkm2);p=lsqtotm(nxaqjjs,1.0,p);rnglrqe=max(p,(kgvjoay<=kwtioke?1.0:0.0));return 1.0-iuknzjh+iuknzjh*(clamp(rnglrqe,0.0,1.0));}\n #endif \n float xaqahqs(sampler2D lrotttz,vec3 pmmxppk,vec2 ktnvxcp,vec2 rtbcrvx,float iuknzjh,float lagcdrm){\n #if gpfdayb==1\n return ubnhgsi(lrotttz,pmmxppk,ktnvxcp,rtbcrvx,iuknzjh,lagcdrm);\n #elif gpfdayb==2\n float kgvjoay=(distance(pmmxppk,fqnhwfi)-0.1)/lagcdrm;float jbyfmhr=texture2D(lrotttz,rtbcrvx).r;return 1.0-iuknzjh+iuknzjh*clamp(exp(lgjrplk*(jbyfmhr-kgvjoay)),0.0,1.0);\n #elif gpfdayb==3\n return xpcfllh(lrotttz,pmmxppk,rtbcrvx,iuknzjh,lagcdrm);\n #else \n return 1.0;\n #endif \n }\n #endif \n float brhvcmq(vec3 nsstwqm){return 0.299*nsstwqm.r+0.587*nsstwqm.g+0.114*nsstwqm.b;}\n #if defined(osvrsmm)||defined(lipkixn)||ttttpsh>0\n vec3 ycddoqb(vec3 splrifm){vec4 eircrya=vec4 (0.0,-1.0/3.0,2.0/3.0,-1.0);vec4 p=mix(vec4 (splrifm.bg,eircrya.wz),vec4 (splrifm.gb,eircrya.xy),step(splrifm.b,splrifm.g));vec4 zrcochy=mix(vec4 (p.xyw,splrifm.r),vec4 (splrifm.r,p.yzx),step(p.x,splrifm.r));float epbwege=zrcochy.x-min(zrcochy.w,zrcochy.y);float nsvbngn=0.0000000001;return vec3 (abs(zrcochy.z+(zrcochy.w-zrcochy.y)/(6.0*epbwege+nsvbngn)),epbwege/(zrcochy.x+nsvbngn),zrcochy.x);}vec3 lsfuboz(vec3 splrifm){vec4 eircrya=vec4 (1.0,2.0/3.0,1.0/3.0,3.0);vec3 p=abs(fract(splrifm.xxx+eircrya.xyz)*6.0-eircrya.www);return splrifm.z*mix(eircrya.xxx,clamp(p-eircrya.xxx,0.0,1.0),splrifm.y);}\n #endif \n \n #if defined(poteimn)||defined(fomzgxw)\n vec3 rbbsftx(vec3 cyxmscz,vec3 invgiul,float usmtyvu,mat4 neteons,int ffsjscw,sampler2D ibdanqa){vec2 xthuvvf=tiurzyf(ffsjscw,neteons).xy;vec2 zmbjkpy=vec2 (dFdx(xthuvvf.x),dFdx(xthuvvf.y));vec2 wdbpsub=vec2 (dFdy(xthuvvf.x),dFdy(xthuvvf.y));float zkdqeqc=brhvcmq(texture2D(ibdanqa,xthuvvf).rgb);float hhhjriw=brhvcmq(texture2D(ibdanqa,xthuvvf+zmbjkpy).rgb)-zkdqeqc;float llsnfaq=brhvcmq(texture2D(ibdanqa,xthuvvf+wdbpsub).rgb)-zkdqeqc;vec2 hbmsppc=usmtyvu*vec2 (hhhjriw,llsnfaq);vec3 rlstbzu=vec3 (dFdx(cyxmscz.x),dFdx(cyxmscz.y),dFdx(cyxmscz.z));vec3 exurmhv=vec3 (dFdy(cyxmscz.x),dFdy(cyxmscz.y),dFdy(cyxmscz.z));vec3 mbicqqo=invgiul;vec3 ocqpvse1=cross(exurmhv,mbicqqo);vec3 ocqpvse2=cross(mbicqqo,rlstbzu);float uyzpfdr=dot(rlstbzu,ocqpvse1);vec3 nctrfzv=sign(uyzpfdr)*(hbmsppc.x*ocqpvse1+hbmsppc.y*ocqpvse2);return normalize(abs(uyzpfdr)*invgiul-nctrfzv);}vec3 eneybyo(vec3 invgiul,float usmtyvu,mat4 neteons,int ffsjscw,sampler2D ibdanqa){vec3 uqmgqjt=fsjlspn(ffsjscw);wxofswh=mat3 (uqmgqjt,normalize(cross(invgiul,uqmgqjt)),invgiul);vec3 mfeyojr=texture2D(ibdanqa,tiurzyf(ffsjscw,neteons).xy).xyz*2.0-1.0;mfeyojr.xy=usmtyvu*mfeyojr.xy;return wxofswh*normalize(mfeyojr);}vec3 jewccxz(vec3 invgiul,float usmtyvu,mat4 neteons,int ffsjscw,sampler2D ibdanqa){vec3 uqmgqjt=fytlazk(ffsjscw);mat3 wxofswh=mat3 (uqmgqjt,normalize(cross(invgiul,uqmgqjt)),invgiul);vec3 mfeyojr=texture2D(ibdanqa,tiurzyf(ffsjscw,neteons).xy).xyz*2.0-1.0;mfeyojr.xy=usmtyvu*mfeyojr.xy;return wxofswh*normalize(mfeyojr);}\n #endif \n \n #if defined(przvnvk)||defined(hqoltzb)\n vec3 htesuns;float lmztzmc;mat3 hsimbvx;float juttgot;void mvnwyft(vec3 tipywwk){vec3 uqmgqjt=fytlazk(0);vec3 vsoewlw=normalize(cross(tipywwk,uqmgqjt));wxofswh=mat3 (uqmgqjt,vsoewlw,tipywwk);hsimbvx=mat3 (uqmgqjt.x,vsoewlw.x,tipywwk.x,uqmgqjt.y,vsoewlw.y,tipywwk.y,uqmgqjt.z,vsoewlw.z,tipywwk.z);vec3 nvedich=normalize(hsimbvx*tipywwk);vec3 ohtseug=normalize(hsimbvx*-iieuufh);\n #ifdef przvnvk\n vec3 kucswvx=texture2D(gkgxkms,tiurzyf(jxhskgy,cejprze).xy).rgb;juttgot=nvpphgu;\n #ifdef ANIMATING \n \n #ifdef hqoltzb\n kucswvx=mix(kucswvx,texture2D(gkgxkms2,tiurzyf(jxhskgy2,cejprze2).xy).rgb,heftokz);juttgot=mix(juttgot,nvpphgu2,heftokz);\n #else \n juttgot*=(1.0-heftokz);\n #endif \n \n #endif \n kucswvx=kucswvx*2.0;kucswvx.xy-=vec2 (1.0);\n #else \n \n #ifdef hqoltzb\n vec3 kucswvx=texture2D(gkgxkms2,tiurzyf(jxhskgy2,cejprze2).xy).rgb;kucswvx=kucswvx*2.0;kucswvx.xy-=vec2 (1.0);juttgot=heftokz*nvpphgu2;\n #else \n return vec3 (1,1,0);\n #endif \n \n #endif \n htesuns=normalize(cross(nvedich,cross(kucswvx,nvedich)));lmztzmc=dot(ohtseug,htesuns);}float tnezuza(vec3 vuhlzwk){vec3 mfvvztb=normalize(hsimbvx*vuhlzwk);float lasggpn=dot(mfvvztb,htesuns);return juttgot*pow(clamp(sin(lasggpn)*sin(lmztzmc)+cos(lasggpn)*cos(lmztzmc),0.0,1.0),fwyvcka);}\n #endif \n float wafqajp(float srhkupd,float bfdaalh){float res =min(srhkupd,bfdaalh);float wmxooao=res /bfdaalh;res =(res !=0.0?(1.0-wmxooao)*(1.0-wmxooao):1.0);return res ;}\n #if ttttpsh>0\n float dzhcrbu(float x,float ulpfnjs,float vsoewlw,float rcyoqfm,float rovpwul,float ksrdyvt,float yvarzfa){return ((x*(ulpfnjs*x+rcyoqfm*vsoewlw)+rovpwul*ksrdyvt)/(x*(ulpfnjs*x+vsoewlw)+rovpwul*yvarzfa))-ksrdyvt/yvarzfa;}float kokfteb(float x,float ulpfnjs,float vsoewlw,float rcyoqfm,float rovpwul,float ksrdyvt,float yvarzfa){return dzhcrbu(x,ulpfnjs,vsoewlw,rcyoqfm,rovpwul,ksrdyvt,yvarzfa)*1.0/dzhcrbu(mjjhnsa,ulpfnjs,vsoewlw,rcyoqfm,rovpwul,ksrdyvt,yvarzfa);}float frziqcg(float x,float ulpfnjs,float vsoewlw,float rcyoqfm,float rovpwul,float ksrdyvt){return clamp((x*(ulpfnjs*x+vsoewlw))/(x*(rcyoqfm*x+rovpwul)+ksrdyvt),0.0,1.0);}\n #endif \n \n #if rbpyftt>0\n jkqjebn pgpwtsd(vec3 nsstwqm,vec3 vspdedz,vec4 vedmnqe,vec3 tipywwk,float fspemph,float pyekvda){jkqjebn res ;vec3 scuceyc=normalize(vspdedz-fqnhwfi);float epbwege=length(vspdedz-fqnhwfi);float a=wafqajp(epbwege,vedmnqe[0])/(vedmnqe[1]+epbwege*vedmnqe[2]+epbwege*epbwege*vedmnqe[3]);res .pbfcbmx=max(dot(tipywwk,scuceyc),0.0)*nsstwqm*a;\n #if defined(liwyana)||defined(ghxxrdt)\n res .pbfcbmx+=max(dot(-tipywwk,scuceyc),0.0)*nsstwqm*a*pyekvda;\n #endif \n vec3 vuhlzwk=-normalize(vspdedz-fqnhwfi);\n #if defined(przvnvk)||defined(hqoltzb)\n res .fxcsdif=nsstwqm*juttgot*tnezuza(vuhlzwk)*a;\n #else \n res .fxcsdif=nsstwqm*pow(max(0.0,dot(iieuufh,reflect(vuhlzwk,tipywwk))),fspemph)*a;\n #endif \n return res ;}\n #endif \n \n #if gmypjqq>0\n jkqjebn lvszauc(vec3 nsstwqm,vec3 qhzenuk,vec3 vspdedz,vec4 vedmnqe,vec3 ldlcdia,vec3 tipywwk,float fspemph,float pyekvda){jkqjebn res ;vec3 scuceyc=vspdedz-fqnhwfi;float epbwege=length(scuceyc);float a=wafqajp(epbwege,vedmnqe[0])/(vedmnqe[1]+epbwege*vedmnqe[2]+epbwege*epbwege*vedmnqe[3]);scuceyc=normalize(scuceyc);res .pbfcbmx=vec3 (max(dot(tipywwk,scuceyc),0.0));float zrireeh=dot(qhzenuk,-scuceyc);if(zrireeh>ldlcdia[0]){zrireeh=1.0;}else {if(zrireeh<ldlcdia[1]){zrireeh=0.0;}else {zrireeh=(zrireeh-ldlcdia[1])/(ldlcdia[0]-ldlcdia[1]);}}\n #if defined(liwyana)||defined(ghxxrdt)\n res .pbfcbmx+=vec3 (pyekvda*max(dot(-tipywwk,scuceyc),0.0));\n #endif \n \n #if defined(przvnvk)||defined(hqoltzb)\n res .fxcsdif=vec3 (tnezuza(-scuceyc)*juttgot);\n #else \n res .fxcsdif=vec3 (pow(max(0.0,dot(iieuufh,reflect(-scuceyc,tipywwk)))*max(0.0,dot(-scuceyc,qhzenuk)),fspemph));\n #endif \n vec3 mnynvbe=nsstwqm*pow(zrireeh,ldlcdia[2]);res .pbfcbmx*=mnynvbe*a;res .fxcsdif*=mnynvbe*a;return res ;}\n #if telezcv>0\n float ygseayq(vec3 qhzenuk,vec3 vspdedz,sampler2D dggpapb,float xywcpsx,float upokuis,float lagcdrm,vec2 ktnvxcp,vec2 deobjdf){float kotbpbp=1.0;if(deobjdf.x>0.0&&deobjdf.x<1.0&&deobjdf.y>0.0&&deobjdf.y<1.0){float pkklacc=abs(dot(-qhzenuk,hbnjyno));if(pkklacc<0.15){kotbpbp=1.0-xywcpsx;}else {kotbpbp=xaqahqs(dggpapb,vspdedz,ktnvxcp,deobjdf,xywcpsx,lagcdrm);}}return kotbpbp;}\n #endif \n \n #endif \n \n #if hokmxtt>0\n jkqjebn yjgikmo(vec3 nsstwqm,vec3 qhzenuk,vec3 tipywwk,float fspemph,float pyekvda){jkqjebn res ;res .pbfcbmx=max(dot(tipywwk,-qhzenuk),0.0)*nsstwqm;\n #if defined(liwyana)||defined(ghxxrdt)\n res .pbfcbmx+=pyekvda*max(dot(-tipywwk,-qhzenuk),0.0)*nsstwqm;\n #endif \n \n #if defined(przvnvk)||defined(hqoltzb)\n res .fxcsdif=nsstwqm*tnezuza(qhzenuk);\n #else \n res .fxcsdif=nsstwqm*pow(max(0.0,dot(normalize(reflect(iieuufh,tipywwk)),qhzenuk)),fspemph);\n #endif \n return res ;}\n #if octspal>0\n float wjxlodx(vec3 qhzenuk,vec3 vspdedz,sampler2D dggpapb,float xywcpsx,float upokuis,float lagcdrm,vec2 ktnvxcp,vec2 deobjdf){float kotbpbp=1.0;if(deobjdf.x>0.0&&deobjdf.x<1.0&&deobjdf.y>0.0&&deobjdf.y<1.0){float pkklacc=abs(dot(-qhzenuk,hbnjyno));if(pkklacc<0.15){kotbpbp=1.0-xywcpsx;}else {kotbpbp=xaqahqs(dggpapb,vspdedz,ktnvxcp,deobjdf,xywcpsx,lagcdrm);}}return kotbpbp;}\n #endif \n \n #endif \n \n #if tgolzbx>0\n jkqjebn vxpwikb(vec3 bnqihnn,vec3 daunhgh,float cqhyrfl,vec3 qhzenuk,vec3 tipywwk,float fspemph,float pyekvda){jkqjebn res ;res .pbfcbmx=cqhyrfl*mix(daunhgh,bnqihnn,clamp(0.5*dot(tipywwk,qhzenuk)+0.5,0.0,1.0));\n #if defined(liwyana)||defined(ghxxrdt)\n res .pbfcbmx+=pyekvda*cqhyrfl*mix(daunhgh,bnqihnn,clamp(0.5*dot(-tipywwk,qhzenuk)+0.5,0.0,1.0));\n #endif \n \n #if defined(przvnvk)||defined(hqoltzb)\n res .fxcsdif=cqhyrfl*(bnqihnn*tnezuza(qhzenuk)+daunhgh*tnezuza(-qhzenuk));\n #else \n res .fxcsdif=cqhyrfl*((bnqihnn*pow(max(0.0,dot(iieuufh,reflect(-qhzenuk,tipywwk))),fspemph))+(daunhgh*pow(max(0.0,dot(iieuufh,reflect(qhzenuk,tipywwk))),fspemph)));\n #endif \n return res ;}\n #endif \n vec3 mryvhfe(vec3 jcpdwjh,vec3 tipywwk){iieuufh=normalize(xzwunne-fqnhwfi);\n #ifdef tqtzlvf\n vec3 bmiagfc1=texture2D(xspuomx,tiurzyf(jcxvcld,bbjrkoj).xy).rgb;\n #else \n vec3 bmiagfc1=xcxkhty.rgb;\n #endif \n vec3 pbfcbmx1=bmiagfc1*fhguuoo;\n #ifdef ANIMATING \n \n #ifdef ciziuga\n vec3 bmiagfc2=texture2D(xspuomx2,tiurzyf(jcxvcld2,bbjrkoj2).xy).rgb;\n #else \n vec3 bmiagfc2=xcxkhty2.rgb;\n #endif \n vec3 pbfcbmx=mix(pbfcbmx1,bmiagfc2*fhguuoo2,heftokz);\n #else \n vec3 pbfcbmx=pbfcbmx1;\n #endif \n \n #ifdef bzsisog\n vec3 fxcsdif=texture2D(bdwutbz,tiurzyf(rdawqhh,chrxigj).xy).rgb;\n #else \n vec3 fxcsdif=rmbxdvn.rgb;\n #endif \n float fikcdgy=tqpeter;\n #ifdef kddtxjn\n fikcdgy*=brhvcmq(texture2D(dkznlil,tiurzyf(vrqlwnm,hakpqqs).xy).rgb);\n #endif \n \n #ifdef ANIMATING \n \n #ifdef xlkdrug\n vec3 fxcsdif2=texture2D(bdwutbz2,tiurzyf(rdawqhh2,chrxigj2).xy).rgb;\n #else \n vec3 fxcsdif2=rmbxdvn2.rgb;\n #endif \n fxcsdif=mix(fxcsdif,fxcsdif2,heftokz);float fikcdgy2=tqpeter2;\n #ifdef pzlstld\n fikcdgy2*=brhvcmq(texture2D(dkznlil2,tiurzyf(vrqlwnm2,hakpqqs2).xy).rgb);\n #endif \n fikcdgy=mix(fikcdgy,fikcdgy2,heftokz);\n #endif \n \n #ifdef rixowhp\n vec3 dzrxdav=bmiagfc1*yxuhtpf;\n #ifdef ANIMATING \n \n #ifdef ddunger\n vec3 dzrxdav2=bmiagfc2*yxuhtpf2;\n #else \n \n #ifdef hyucpon\n vec3 dzrxdav2=yxuhtpf2*texture2D(kkbgecz2,tiurzyf(lizkbiv2,smlqamg2).xy).rgb;\n #else \n vec3 dzrxdav2=yxuhtpf2*gmzubwt2.rgb;\n #endif \n \n #endif \n dzrxdav=mix(dzrxdav,dzrxdav2,heftokz);\n #endif \n \n #else \n \n #ifdef altvvbq\n vec3 dzrxdav=yxuhtpf*texture2D(kkbgecz,tiurzyf(lizkbiv,smlqamg).xy).rgb;\n #else \n vec3 dzrxdav=yxuhtpf*gmzubwt.rgb;\n #endif \n \n #ifdef ANIMATING \n \n #ifdef ddunger\n vec3 dzrxdav2=bmiagfc2*yxuhtpf2;\n #else \n \n #ifdef hyucpon\n vec3 dzrxdav2=yxuhtpf2*texture2D(kkbgecz2,tiurzyf(lizkbiv2,smlqamg2).xy).rgb;\n #else \n vec3 dzrxdav2=yxuhtpf2*gmzubwt2.rgb;\n #endif \n \n #endif \n dzrxdav=mix(dzrxdav,dzrxdav2,heftokz);\n #endif \n \n #endif \n \n #ifdef vvqtuez\n fwyvcka=1.0+(fgjxdyy-1.0)*brhvcmq(texture2D(tycsukv,tiurzyf(azqmncb,hivqfir).xy).rgb);\n #else \n fwyvcka=fgjxdyy;\n #endif \n \n #ifdef ANIMATING \n \n #ifdef lrvyeou\n float fwyvcka2=1.0+(fgjxdyy2-1.0)*brhvcmq(texture2D(tycsukv2,tiurzyf(azqmncb2,hivqfir2).xy).rgb);\n #else \n float fwyvcka2=fgjxdyy2;\n #endif \n fwyvcka=mix(fwyvcka,fwyvcka2,heftokz);\n #endif \n \n #if defined(przvnvk)||defined(hqoltzb)\n mvnwyft(tipywwk);\n #endif \n \n #ifdef liwyana\n \n #ifdef kopvmvi\n float pyekvda=yfhugch*brhvcmq(texture2D(lweuiuw,tiurzyf(iixvswj,ugabykz).xy).rgb);\n #else \n float pyekvda=yfhugch;\n #endif \n \n #else \n float pyekvda=0.0;\n #endif \n \n #ifdef ghxxrdt\n \n #ifdef tppdyzt\n float pyekvda2=yfhugch2*brhvcmq(texture2D(lweuiuw2,tiurzyf(iixvswj2,ugabykz2).xy).rgb);\n #else \n float pyekvda2=yfhugch2;\n #endif \n \n #else \n float pyekvda2=0.0;\n #endif \n \n #if defined(liwyana)||defined(ghxxrdt)\n \n #ifdef ANIMATING \n pyekvda=mix(pyekvda,pyekvda2,heftokz);\n #endif \n \n #endif \n vec3 uchevpi=vec3 (0.0);vec3 owycqde=vec3 (0.0);\n #ifdef uoaojlv\n if(qwgzgln==0){uchevpi=deijscq*textureCube(isyrtjm,tipywwk).rgb;}else {uchevpi=deijscq*textureCube(isyrtjm,jcpdwjh).rgb;}\n #if defined(liwyana)||defined(ghxxrdt)\n if(qwgzgln==0){uchevpi=pyekvda*deijscq*textureCube(isyrtjm,-tipywwk).rgb;}else {uchevpi=pyekvda*deijscq*textureCube(isyrtjm,-jcpdwjh).rgb;}\n #endif \n \n #endif \n float fspemph=fwyvcka/(1.0+log(fwyvcka));vec3 aaskbre,vuhlzwk;float kotbpbp;jkqjebn oupsemd;vec3 cvvostw=vec3 (0);\n #ifdef vpifigq0\n \n #ifdef paokbhz0\n oupsemd=pgpwtsd(jaqaqjo0,(wqfoqbo*vec4 (ihabiil0,1.0)).xyz,hczygcx0,tipywwk,fspemph,pyekvda);\n #else \n oupsemd=pgpwtsd(jaqaqjo0,ihabiil0,hczygcx0,tipywwk,fspemph,pyekvda);\n #endif \n \n #if defined(qictwfu)&&adacfgm0>0\n cvvostw+=oupsemd.pbfcbmx;\n #else \n uchevpi+=oupsemd.pbfcbmx;owycqde+=oupsemd.fxcsdif;\n #endif \n \n #endif \n \n #ifdef vpifigq1\n \n #ifdef paokbhz1\n oupsemd=pgpwtsd(jaqaqjo1,(wqfoqbo*vec4 (ihabiil1,1.0)).xyz,hczygcx1,tipywwk,fspemph,pyekvda);\n #else \n oupsemd=pgpwtsd(jaqaqjo1,ihabiil1,hczygcx1,tipywwk,fspemph,pyekvda);\n #endif \n \n #if defined(qictwfu)&&adacfgm1>0\n cvvostw+=oupsemd.pbfcbmx;\n #else \n uchevpi+=oupsemd.pbfcbmx;owycqde+=oupsemd.fxcsdif;\n #endif \n \n #endif \n \n #ifdef vpifigq2\n \n #ifdef paokbhz2\n oupsemd=pgpwtsd(jaqaqjo2,(wqfoqbo*vec4 (ihabiil2,1.0)).xyz,hczygcx2,tipywwk,fspemph,pyekvda);\n #else \n oupsemd=pgpwtsd(jaqaqjo2,ihabiil2,hczygcx2,tipywwk,fspemph,pyekvda);\n #endif \n \n #if defined(qictwfu)&&adacfgm2>0\n cvvostw+=oupsemd.pbfcbmx;\n #else \n uchevpi+=oupsemd.pbfcbmx;owycqde+=oupsemd.fxcsdif;\n #endif \n \n #endif \n \n #ifdef vpifigq3\n \n #ifdef paokbhz3\n oupsemd=pgpwtsd(jaqaqjo3,(wqfoqbo*vec4 (ihabiil3,1.0)).xyz,hczygcx3,tipywwk,fspemph,pyekvda);\n #else \n oupsemd=pgpwtsd(jaqaqjo3,ihabiil3,hczygcx3,tipywwk,fspemph,pyekvda);\n #endif \n \n #if defined(qictwfu)&&adacfgm3>0\n cvvostw+=oupsemd.pbfcbmx;\n #else \n uchevpi+=oupsemd.pbfcbmx;owycqde+=oupsemd.fxcsdif;\n #endif \n \n #endif \n \n #ifdef vpifigq4\n \n #ifdef paokbhz4\n oupsemd=pgpwtsd(jaqaqjo4,(wqfoqbo*vec4 (ihabiil4,1.0)).xyz,hczygcx4,tipywwk,fspemph,pyekvda);\n #else \n oupsemd=pgpwtsd(jaqaqjo4,ihabiil4,hczygcx4,tipywwk,fspemph,pyekvda);\n #endif \n \n #if defined(qictwfu)&&adacfgm4>0\n cvvostw+=oupsemd.pbfcbmx;\n #else \n uchevpi+=oupsemd.pbfcbmx;owycqde+=oupsemd.fxcsdif;\n #endif \n \n #endif \n \n #ifdef vpifigq5\n \n #ifdef paokbhz5\n oupsemd=pgpwtsd(jaqaqjo5,(wqfoqbo*vec4 (ihabiil5,1.0)).xyz,hczygcx5,tipywwk,fspemph,pyekvda);\n #else \n oupsemd=pgpwtsd(jaqaqjo5,ihabiil5,hczygcx5,tipywwk,fspemph,pyekvda);\n #endif \n \n #if defined(qictwfu)&&adacfgm5>0\n cvvostw+=oupsemd.pbfcbmx;\n #else \n uchevpi+=oupsemd.pbfcbmx;owycqde+=oupsemd.fxcsdif;\n #endif \n \n #endif \n \n #ifdef vpifigq6\n \n #ifdef paokbhz6\n oupsemd=pgpwtsd(jaqaqjo6,(wqfoqbo*vec4 (ihabiil6,1.0)).xyz,hczygcx6,tipywwk,fspemph,pyekvda);\n #else \n oupsemd=pgpwtsd(jaqaqjo6,ihabiil6,hczygcx6,tipywwk,fspemph,pyekvda);\n #endif \n \n #if defined(qictwfu)&&adacfgm6>0\n cvvostw+=oupsemd.pbfcbmx;\n #else \n uchevpi+=oupsemd.pbfcbmx;owycqde+=oupsemd.fxcsdif;\n #endif \n \n #endif \n \n #ifdef vpifigq7\n \n #ifdef paokbhz7\n oupsemd=pgpwtsd(jaqaqjo7,(wqfoqbo*vec4 (ihabiil7,1.0)).xyz,hczygcx7,tipywwk,fspemph,pyekvda);\n #else \n oupsemd=pgpwtsd(jaqaqjo7,ihabiil7,hczygcx7,tipywwk,fspemph,pyekvda);\n #endif \n \n #if defined(qictwfu)&&adacfgm7>0\n cvvostw+=oupsemd.pbfcbmx;\n #else \n uchevpi+=oupsemd.pbfcbmx;owycqde+=oupsemd.fxcsdif;\n #endif \n \n #endif \n \n #ifdef vpifigq8\n \n #ifdef paokbhz8\n oupsemd=pgpwtsd(jaqaqjo8,(wqfoqbo*vec4 (ihabiil8,1.0)).xyz,hczygcx8,tipywwk,fspemph,pyekvda);\n #else \n oupsemd=pgpwtsd(jaqaqjo8,ihabiil8,hczygcx8,tipywwk,fspemph,pyekvda);\n #endif \n \n #if defined(qictwfu)&&adacfgm8>0\n cvvostw+=oupsemd.pbfcbmx;\n #else \n uchevpi+=oupsemd.pbfcbmx;owycqde+=oupsemd.fxcsdif;\n #endif \n \n #endif \n \n #ifdef vpifigq9\n \n #ifdef paokbhz9\n oupsemd=pgpwtsd(jaqaqjo9,(wqfoqbo*vec4 (ihabiil9,1.0)).xyz,hczygcx9,tipywwk,fspemph,pyekvda);\n #else \n oupsemd=pgpwtsd(jaqaqjo9,ihabiil9,hczygcx9,tipywwk,fspemph,pyekvda);\n #endif \n \n #if defined(qictwfu)&&adacfgm9>0\n cvvostw+=oupsemd.pbfcbmx;\n #else \n uchevpi+=oupsemd.pbfcbmx;owycqde+=oupsemd.fxcsdif;\n #endif \n \n #endif \n \n #ifdef zhzwila0\n \n #ifdef pzibdvh0\n vuhlzwk=normalize((mat3 (wqfoqbo)*qkbayba0).xyz);aaskbre=(wqfoqbo*vec4 (qdijctx0,1.0)).xyz;oupsemd=lvszauc(vmxutmc0,vuhlzwk,aaskbre,jbwfpbd0,vjnmpun0,tipywwk,fspemph,pyekvda);\n #ifdef lmnawfd0\n vec4 rtbcrvx0=llsljbs0*(vec4 (fqnhwfi,1.0));rtbcrvx0.xy=vec2 (0.5)*rtbcrvx0.xy/rtbcrvx0.w+vec2 (0.5);kotbpbp=ygseayq(vuhlzwk,aaskbre,xqqpmlf0,lmnawfd0,xhmejzu0,efyytzg0,dzpoqlw0,rtbcrvx0.xy);oupsemd.pbfcbmx*=kotbpbp;\n #ifdef qictwfu\n oupsemd.fxcsdif*=kotbpbp;\n #else \n oupsemd.fxcsdif*=kotbpbp*1.7320508075688772;\n #endif \n \n #else \n \n #ifndef qictwfu\n oupsemd.fxcsdif*=1.7320508075688772;\n #endif \n \n #endif \n \n #else \n oupsemd=lvszauc(vmxutmc0,qkbayba0,qdijctx0,jbwfpbd0,vjnmpun0,tipywwk,fspemph,pyekvda);\n #ifdef lmnawfd0\n vec4 rtbcrvx0=llsljbs0*(vec4 (fqnhwfi,1.0));rtbcrvx0.xy=vec2 (0.5)*rtbcrvx0.xy/rtbcrvx0.w+vec2 (0.5);kotbpbp=ygseayq(qkbayba0,qdijctx0,xqqpmlf0,lmnawfd0,xhmejzu0,efyytzg0,dzpoqlw0,rtbcrvx0.xy);oupsemd.pbfcbmx*=kotbpbp;\n #ifdef qictwfu\n oupsemd.fxcsdif*=kotbpbp;\n #else \n oupsemd.fxcsdif*=kotbpbp*1.7320508075688772;\n #endif \n \n #else \n \n #ifndef qictwfu\n oupsemd.fxcsdif*=1.7320508075688772;\n #endif \n \n #endif \n \n #endif \n \n #if defined(qictwfu)&&fcemnll0>0\n cvvostw+=oupsemd.pbfcbmx;\n #else \n uchevpi+=oupsemd.pbfcbmx;owycqde+=oupsemd.fxcsdif;\n #endif \n \n #endif \n \n #ifdef zhzwila1\n \n #ifdef pzibdvh1\n vuhlzwk=normalize((mat3 (wqfoqbo)*qkbayba1).xyz);aaskbre=(wqfoqbo*vec4 (qdijctx1,1.0)).xyz;oupsemd=lvszauc(vmxutmc1,vuhlzwk,aaskbre,jbwfpbd1,vjnmpun1,tipywwk,fspemph,pyekvda);\n #ifdef lmnawfd1\n vec4 rtbcrvx1=llsljbs1*(vec4 (fqnhwfi,1.0));rtbcrvx1.xy=vec2 (0.5)*rtbcrvx1.xy/rtbcrvx1.w+vec2 (0.5);kotbpbp=ygseayq(vuhlzwk,aaskbre,xqqpmlf1,lmnawfd1,xhmejzu1,efyytzg1,dzpoqlw1,rtbcrvx1.xy);oupsemd.pbfcbmx*=kotbpbp;\n #ifdef qictwfu\n oupsemd.fxcsdif*=kotbpbp;\n #else \n oupsemd.fxcsdif*=kotbpbp*1.7320508075688772;\n #endif \n \n #else \n \n #ifndef qictwfu\n oupsemd.fxcsdif*=1.7320508075688772;\n #endif \n \n #endif \n \n #else \n oupsemd=lvszauc(vmxutmc1,qkbayba1,qdijctx1,jbwfpbd1,vjnmpun1,tipywwk,fspemph,pyekvda);\n #ifdef lmnawfd1\n vec4 rtbcrvx1=llsljbs1*(vec4 (fqnhwfi,1.0));rtbcrvx1.xy=vec2 (0.5)*rtbcrvx1.xy/rtbcrvx1.w+vec2 (0.5);kotbpbp=ygseayq(qkbayba1,qdijctx1,xqqpmlf1,lmnawfd1,xhmejzu1,efyytzg1,dzpoqlw1,rtbcrvx1.xy);oupsemd.pbfcbmx*=kotbpbp;\n #ifdef qictwfu\n oupsemd.fxcsdif*=kotbpbp;\n #else \n oupsemd.fxcsdif*=kotbpbp*1.7320508075688772;\n #endif \n \n #else \n \n #ifndef qictwfu\n oupsemd.fxcsdif*=1.7320508075688772;\n #endif \n \n #endif \n \n #endif \n \n #if defined(qictwfu)&&fcemnll1>0\n cvvostw+=oupsemd.pbfcbmx;\n #else \n uchevpi+=oupsemd.pbfcbmx;owycqde+=oupsemd.fxcsdif;\n #endif \n \n #endif \n \n #ifdef zhzwila2\n \n #ifdef pzibdvh2\n vuhlzwk=normalize((mat3 (wqfoqbo)*qkbayba2).xyz);aaskbre=(wqfoqbo*vec4 (qdijctx2,1.0)).xyz;oupsemd=lvszauc(vmxutmc2,vuhlzwk,aaskbre,jbwfpbd2,vjnmpun2,tipywwk,fspemph,pyekvda);\n #ifdef lmnawfd2\n vec4 rtbcrvx2=llsljbs2*(vec4 (fqnhwfi,1.0));rtbcrvx2.xy=vec2 (0.5)*rtbcrvx2.xy/rtbcrvx2.w+vec2 (0.5);kotbpbp=ygseayq(vuhlzwk,aaskbre,xqqpmlf2,lmnawfd2,xhmejzu2,efyytzg2,dzpoqlw2,rtbcrvx2.xy);oupsemd.pbfcbmx*=kotbpbp;\n #ifdef qictwfu\n oupsemd.fxcsdif*=kotbpbp;\n #else \n oupsemd.fxcsdif*=kotbpbp*1.7320508075688772;\n #endif \n \n #else \n \n #ifndef qictwfu\n oupsemd.fxcsdif*=1.7320508075688772;\n #endif \n \n #endif \n \n #else \n oupsemd=lvszauc(vmxutmc2,qkbayba2,qdijctx2,jbwfpbd2,vjnmpun2,tipywwk,fspemph,pyekvda);\n #ifdef lmnawfd2\n vec4 rtbcrvx2=llsljbs2*(vec4 (fqnhwfi,1.0));rtbcrvx2.xy=vec2 (0.5)*rtbcrvx2.xy/rtbcrvx2.w+vec2 (0.5);kotbpbp=ygseayq(qkbayba2,qdijctx2,xqqpmlf2,lmnawfd2,xhmejzu2,efyytzg2,dzpoqlw2,rtbcrvx2.xy);oupsemd.pbfcbmx*=kotbpbp;\n #ifdef qictwfu\n oupsemd.fxcsdif*=kotbpbp;\n #else \n oupsemd.fxcsdif*=kotbpbp*1.7320508075688772;\n #endif \n \n #else \n \n #ifndef qictwfu\n oupsemd.fxcsdif*=1.7320508075688772;\n #endif \n \n #endif \n \n #endif \n \n #if defined(qictwfu)&&fcemnll2>0\n cvvostw+=oupsemd.pbfcbmx;\n #else \n uchevpi+=oupsemd.pbfcbmx;owycqde+=oupsemd.fxcsdif;\n #endif \n \n #endif \n \n #ifdef zhzwila3\n \n #ifdef pzibdvh3\n vuhlzwk=normalize((mat3 (wqfoqbo)*qkbayba3).xyz);aaskbre=(wqfoqbo*vec4 (qdijctx3,1.0)).xyz;oupsemd=lvszauc(vmxutmc3,vuhlzwk,aaskbre,jbwfpbd3,vjnmpun3,tipywwk,fspemph,pyekvda);\n #ifdef lmnawfd3\n vec4 rtbcrvx3=llsljbs3*(vec4 (fqnhwfi,1.0));rtbcrvx3.xy=vec2 (0.5)*rtbcrvx3.xy/rtbcrvx3.w+vec2 (0.5);kotbpbp=ygseayq(vuhlzwk,aaskbre,xqqpmlf3,lmnawfd3,xhmejzu3,efyytzg3,dzpoqlw3,rtbcrvx3.xy);oupsemd.pbfcbmx*=kotbpbp;\n #ifdef qictwfu\n oupsemd.fxcsdif*=kotbpbp;\n #else \n oupsemd.fxcsdif*=kotbpbp*1.7320508075688772;\n #endif \n \n #else \n \n #ifndef qictwfu\n oupsemd.fxcsdif*=1.7320508075688772;\n #endif \n \n #endif \n \n #else \n oupsemd=lvszauc(vmxutmc3,qkbayba3,qdijctx3,jbwfpbd3,vjnmpun3,tipywwk,fspemph,pyekvda);\n #ifdef lmnawfd3\n vec4 rtbcrvx3=llsljbs3*(vec4 (fqnhwfi,1.0));rtbcrvx3.xy=vec2 (0.5)*rtbcrvx3.xy/rtbcrvx3.w+vec2 (0.5);kotbpbp=ygseayq(qkbayba3,qdijctx3,xqqpmlf3,lmnawfd3,xhmejzu3,efyytzg3,dzpoqlw3,rtbcrvx3.xy);oupsemd.pbfcbmx*=kotbpbp;\n #ifdef qictwfu\n oupsemd.fxcsdif*=kotbpbp;\n #else \n oupsemd.fxcsdif*=kotbpbp*1.7320508075688772;\n #endif \n \n #else \n \n #ifndef qictwfu\n oupsemd.fxcsdif*=1.7320508075688772;\n #endif \n \n #endif \n \n #endif \n \n #if defined(qictwfu)&&fcemnll3>0\n cvvostw+=oupsemd.pbfcbmx;\n #else \n uchevpi+=oupsemd.pbfcbmx;owycqde+=oupsemd.fxcsdif;\n #endif \n \n #endif \n \n #ifdef zhzwila4\n \n #ifdef pzibdvh4\n vuhlzwk=normalize((mat3 (wqfoqbo)*qkbayba4).xyz);aaskbre=(wqfoqbo*vec4 (qdijctx4,1.0)).xyz;oupsemd=lvszauc(vmxutmc4,vuhlzwk,aaskbre,jbwfpbd4,vjnmpun4,tipywwk,fspemph,pyekvda);\n #ifdef lmnawfd4\n vec4 rtbcrvx4=llsljbs4*(vec4 (fqnhwfi,1.0));rtbcrvx4.xy=vec2 (0.5)*rtbcrvx4.xy/rtbcrvx4.w+vec2 (0.5);kotbpbp=ygseayq(vuhlzwk,aaskbre,xqqpmlf4,lmnawfd4,xhmejzu4,efyytzg4,dzpoqlw4,rtbcrvx4.xy);oupsemd.pbfcbmx*=kotbpbp;\n #ifdef qictwfu\n oupsemd.fxcsdif*=kotbpbp;\n #else \n oupsemd.fxcsdif*=kotbpbp*1.7320508075688772;\n #endif \n \n #else \n \n #ifndef qictwfu\n oupsemd.fxcsdif*=1.7320508075688772;\n #endif \n \n #endif \n \n #else \n oupsemd=lvszauc(vmxutmc4,qkbayba4,qdijctx4,jbwfpbd4,vjnmpun4,tipywwk,fspemph,pyekvda);\n #ifdef lmnawfd4\n vec4 rtbcrvx4=llsljbs4*(vec4 (fqnhwfi,1.0));rtbcrvx4.xy=vec2 (0.5)*rtbcrvx4.xy/rtbcrvx4.w+vec2 (0.5);kotbpbp=ygseayq(qkbayba4,qdijctx4,xqqpmlf4,lmnawfd4,xhmejzu4,efyytzg4,dzpoqlw4,rtbcrvx4.xy);oupsemd.pbfcbmx*=kotbpbp;\n #ifdef qictwfu\n oupsemd.fxcsdif*=kotbpbp;\n #else \n oupsemd.fxcsdif*=kotbpbp*1.7320508075688772;\n #endif \n \n #else \n \n #ifndef qictwfu\n oupsemd.fxcsdif*=1.7320508075688772;\n #endif \n \n #endif \n \n #endif \n \n #if defined(qictwfu)&&fcemnll4>0\n cvvostw+=oupsemd.pbfcbmx;\n #else \n uchevpi+=oupsemd.pbfcbmx;owycqde+=oupsemd.fxcsdif;\n #endif \n \n #endif \n \n #ifdef zhzwila5\n \n #ifdef pzibdvh5\n vuhlzwk=normalize((mat3 (wqfoqbo)*qkbayba5).xyz);aaskbre=(wqfoqbo*vec4 (qdijctx5,1.0)).xyz;oupsemd=lvszauc(vmxutmc5,vuhlzwk,aaskbre,jbwfpbd5,vjnmpun5,tipywwk,fspemph,pyekvda);\n #ifdef lmnawfd5\n vec4 rtbcrvx5=llsljbs5*(vec4 (fqnhwfi,1.0));rtbcrvx5.xy=vec2 (0.5)*rtbcrvx5.xy/rtbcrvx5.w+vec2 (0.5);kotbpbp=ygseayq(vuhlzwk,aaskbre,xqqpmlf5,lmnawfd5,xhmejzu5,efyytzg5,dzpoqlw5,rtbcrvx5.xy);oupsemd.pbfcbmx*=kotbpbp;\n #ifdef qictwfu\n oupsemd.fxcsdif*=kotbpbp;\n #else \n oupsemd.fxcsdif*=kotbpbp*1.7320508075688772;\n #endif \n \n #else \n \n #ifndef qictwfu\n oupsemd.fxcsdif*=1.7320508075688772;\n #endif \n \n #endif \n \n #else \n oupsemd=lvszauc(vmxutmc5,qkbayba5,qdijctx5,jbwfpbd5,vjnmpun5,tipywwk,fspemph,pyekvda);\n #ifdef lmnawfd5\n vec4 rtbcrvx5=llsljbs5*(vec4 (fqnhwfi,1.0));rtbcrvx5.xy=vec2 (0.5)*rtbcrvx5.xy/rtbcrvx5.w+vec2 (0.5);kotbpbp=ygseayq(qkbayba5,qdijctx5,xqqpmlf5,lmnawfd5,xhmejzu5,efyytzg5,dzpoqlw5,rtbcrvx5.xy);oupsemd.pbfcbmx*=kotbpbp;\n #ifdef qictwfu\n oupsemd.fxcsdif*=kotbpbp;\n #else \n oupsemd.fxcsdif*=kotbpbp*1.7320508075688772;\n #endif \n \n #else \n \n #ifndef qictwfu\n oupsemd.fxcsdif*=1.7320508075688772;\n #endif \n \n #endif \n \n #endif \n \n #if defined(qictwfu)&&fcemnll5>0\n cvvostw+=oupsemd.pbfcbmx;\n #else \n uchevpi+=oupsemd.pbfcbmx;owycqde+=oupsemd.fxcsdif;\n #endif \n \n #endif \n \n #ifdef zhzwila6\n \n #ifdef pzibdvh6\n vuhlzwk=normalize((mat3 (wqfoqbo)*qkbayba6).xyz);aaskbre=(wqfoqbo*vec4 (qdijctx6,1.0)).xyz;oupsemd=lvszauc(vmxutmc6,vuhlzwk,aaskbre,jbwfpbd6,vjnmpun6,tipywwk,fspemph,pyekvda);\n #ifdef lmnawfd6\n vec4 rtbcrvx6=llsljbs6*(vec4 (fqnhwfi,1.0));rtbcrvx6.xy=vec2 (0.5)*rtbcrvx6.xy/rtbcrvx6.w+vec2 (0.5);kotbpbp=ygseayq(vuhlzwk,aaskbre,xqqpmlf6,lmnawfd6,xhmejzu6,efyytzg6,dzpoqlw6,rtbcrvx6.xy);oupsemd.pbfcbmx*=kotbpbp;\n #ifdef qictwfu\n oupsemd.fxcsdif*=kotbpbp;\n #else \n oupsemd.fxcsdif*=kotbpbp*1.7320508075688772;\n #endif \n \n #else \n \n #ifndef qictwfu\n oupsemd.fxcsdif*=1.7320508075688772;\n #endif \n \n #endif \n \n #else \n oupsemd=lvszauc(vmxutmc6,qkbayba6,qdijctx6,jbwfpbd6,vjnmpun6,tipywwk,fspemph,pyekvda);\n #ifdef lmnawfd6\n vec4 rtbcrvx6=llsljbs6*(vec4 (fqnhwfi,1.0));rtbcrvx6.xy=vec2 (0.5)*rtbcrvx6.xy/rtbcrvx6.w+vec2 (0.5);kotbpbp=ygseayq(qkbayba6,qdijctx6,xqqpmlf6,lmnawfd6,xhmejzu6,efyytzg6,dzpoqlw6,rtbcrvx6.xy);oupsemd.pbfcbmx*=kotbpbp;\n #ifdef qictwfu\n oupsemd.fxcsdif*=kotbpbp;\n #else \n oupsemd.fxcsdif*=kotbpbp*1.7320508075688772;\n #endif \n \n #else \n \n #ifndef qictwfu\n oupsemd.fxcsdif*=1.7320508075688772;\n #endif \n \n #endif \n \n #endif \n \n #if defined(qictwfu)&&fcemnll6>0\n cvvostw+=oupsemd.pbfcbmx;\n #else \n uchevpi+=oupsemd.pbfcbmx;owycqde+=oupsemd.fxcsdif;\n #endif \n \n #endif \n \n #ifdef zhzwila7\n \n #ifdef pzibdvh7\n vuhlzwk=normalize((mat3 (wqfoqbo)*qkbayba7).xyz);aaskbre=(wqfoqbo*vec4 (qdijctx7,1.0)).xyz;oupsemd=lvszauc(vmxutmc7,vuhlzwk,aaskbre,jbwfpbd7,vjnmpun7,tipywwk,fspemph,pyekvda);\n #ifdef lmnawfd7\n vec4 rtbcrvx7=llsljbs7*(vec4 (fqnhwfi,1.0));rtbcrvx7.xy=vec2 (0.5)*rtbcrvx7.xy/rtbcrvx7.w+vec2 (0.5);kotbpbp=ygseayq(vuhlzwk,aaskbre,xqqpmlf7,lmnawfd7,xhmejzu7,efyytzg7,dzpoqlw7,rtbcrvx7.xy);oupsemd.pbfcbmx*=kotbpbp;\n #ifdef qictwfu\n oupsemd.fxcsdif*=kotbpbp;\n #else \n oupsemd.fxcsdif*=kotbpbp*1.7320508075688772;\n #endif \n \n #else \n \n #ifndef qictwfu\n oupsemd.fxcsdif*=1.7320508075688772;\n #endif \n \n #endif \n \n #else \n oupsemd=lvszauc(vmxutmc7,qkbayba7,qdijctx7,jbwfpbd7,vjnmpun7,tipywwk,fspemph,pyekvda);\n #ifdef lmnawfd7\n vec4 rtbcrvx7=llsljbs7*(vec4 (fqnhwfi,1.0));rtbcrvx7.xy=vec2 (0.5)*rtbcrvx7.xy/rtbcrvx7.w+vec2 (0.5);kotbpbp=ygseayq(qkbayba7,qdijctx7,xqqpmlf7,lmnawfd7,xhmejzu7,efyytzg7,dzpoqlw7,rtbcrvx7.xy);oupsemd.pbfcbmx*=kotbpbp;\n #ifdef qictwfu\n oupsemd.fxcsdif*=kotbpbp;\n #else \n oupsemd.fxcsdif*=kotbpbp*1.7320508075688772;\n #endif \n \n #else \n \n #ifndef qictwfu\n oupsemd.fxcsdif*=1.7320508075688772;\n #endif \n \n #endif \n \n #endif \n \n #if defined(qictwfu)&&fcemnll7>0\n cvvostw+=oupsemd.pbfcbmx;\n #else \n uchevpi+=oupsemd.pbfcbmx;owycqde+=oupsemd.fxcsdif;\n #endif \n \n #endif \n \n #ifdef zhzwila8\n \n #ifdef pzibdvh8\n vuhlzwk=normalize((mat3 (wqfoqbo)*qkbayba8).xyz);aaskbre=(wqfoqbo*vec4 (qdijctx8,1.0)).xyz;oupsemd=lvszauc(vmxutmc8,vuhlzwk,aaskbre,jbwfpbd8,vjnmpun8,tipywwk,fspemph,pyekvda);\n #ifdef lmnawfd8\n vec4 rtbcrvx8=llsljbs8*(vec4 (fqnhwfi,1.0));rtbcrvx8.xy=vec2 (0.5)*rtbcrvx8.xy/rtbcrvx8.w+vec2 (0.5);kotbpbp=ygseayq(vuhlzwk,aaskbre,xqqpmlf8,lmnawfd8,xhmejzu8,efyytzg8,dzpoqlw8,rtbcrvx8.xy);oupsemd.pbfcbmx*=kotbpbp;\n #ifdef qictwfu\n oupsemd.fxcsdif*=kotbpbp;\n #else \n oupsemd.fxcsdif*=kotbpbp*1.7320508075688772;\n #endif \n \n #else \n \n #ifndef qictwfu\n oupsemd.fxcsdif*=1.7320508075688772;\n #endif \n \n #endif \n \n #else \n oupsemd=lvszauc(vmxutmc8,qkbayba8,qdijctx8,jbwfpbd8,vjnmpun8,tipywwk,fspemph,pyekvda);\n #ifdef lmnawfd8\n vec4 rtbcrvx8=llsljbs8*(vec4 (fqnhwfi,1.0));rtbcrvx8.xy=vec2 (0.5)*rtbcrvx8.xy/rtbcrvx8.w+vec2 (0.5);kotbpbp=ygseayq(qkbayba8,qdijctx8,xqqpmlf8,lmnawfd8,xhmejzu8,efyytzg8,dzpoqlw8,rtbcrvx8.xy);oupsemd.pbfcbmx*=kotbpbp;\n #ifdef qictwfu\n oupsemd.fxcsdif*=kotbpbp;\n #else \n oupsemd.fxcsdif*=kotbpbp*1.7320508075688772;\n #endif \n \n #else \n \n #ifndef qictwfu\n oupsemd.fxcsdif*=1.7320508075688772;\n #endif \n \n #endif \n \n #endif \n \n #if defined(qictwfu)&&fcemnll8>0\n cvvostw+=oupsemd.pbfcbmx;\n #else \n uchevpi+=oupsemd.pbfcbmx;owycqde+=oupsemd.fxcsdif;\n #endif \n \n #endif \n \n #ifdef zhzwila9\n \n #ifdef pzibdvh9\n vuhlzwk=normalize((mat3 (wqfoqbo)*qkbayba9).xyz);aaskbre=(wqfoqbo*vec4 (qdijctx9,1.0)).xyz;oupsemd=lvszauc(vmxutmc9,vuhlzwk,aaskbre,jbwfpbd9,vjnmpun9,tipywwk,fspemph,pyekvda);\n #ifdef lmnawfd9\n vec4 rtbcrvx9=llsljbs9*(vec4 (fqnhwfi,1.0));rtbcrvx9.xy=vec2 (0.5)*rtbcrvx9.xy/rtbcrvx9.w+vec2 (0.5);kotbpbp=ygseayq(vuhlzwk,aaskbre,xqqpmlf9,lmnawfd9,xhmejzu9,efyytzg9,dzpoqlw9,rtbcrvx9.xy);oupsemd.pbfcbmx*=kotbpbp;\n #ifdef qictwfu\n oupsemd.fxcsdif*=kotbpbp;\n #else \n oupsemd.fxcsdif*=kotbpbp*1.7320508075688772;\n #endif \n \n #else \n \n #ifndef qictwfu\n oupsemd.fxcsdif*=1.7320508075688772;\n #endif \n \n #endif \n \n #else \n oupsemd=lvszauc(vmxutmc9,qkbayba9,qdijctx9,jbwfpbd9,vjnmpun9,tipywwk,fspemph,pyekvda);\n #ifdef lmnawfd9\n vec4 rtbcrvx9=llsljbs9*(vec4 (fqnhwfi,1.0));rtbcrvx9.xy=vec2 (0.5)*rtbcrvx9.xy/rtbcrvx9.w+vec2 (0.5);kotbpbp=ygseayq(qkbayba9,qdijctx9,xqqpmlf9,lmnawfd9,xhmejzu9,efyytzg9,dzpoqlw9,rtbcrvx9.xy);oupsemd.pbfcbmx*=kotbpbp;\n #ifdef qictwfu\n oupsemd.fxcsdif*=kotbpbp;\n #else \n oupsemd.fxcsdif*=kotbpbp*1.7320508075688772;\n #endif \n \n #else \n \n #ifndef qictwfu\n oupsemd.fxcsdif*=1.7320508075688772;\n #endif \n \n #endif \n \n #endif \n \n #if defined(qictwfu)&&fcemnll9>0\n cvvostw+=oupsemd.pbfcbmx;\n #else \n uchevpi+=oupsemd.pbfcbmx;owycqde+=oupsemd.fxcsdif;\n #endif \n \n #endif \n \n #ifdef atfjluc0\n \n #ifdef yxuivxf0\n vuhlzwk=normalize((mat3 (wqfoqbo)*szyepvr0).xyz);oupsemd=yjgikmo(iuqlhbj0,vuhlzwk,tipywwk,fspemph,pyekvda);\n #ifdef kqlahgv0\n kotbpbp=wjxlodx(vuhlzwk,(wqfoqbo*vec4 (ntjaipr0,1.0)).xyz,hhknvcm0,kqlahgv0,uzzsmwp0,pgnowwy0,vfpwfis0,izejsjy0);oupsemd.pbfcbmx*=kotbpbp;\n #ifdef qictwfu\n oupsemd.fxcsdif*=kotbpbp;\n #else \n oupsemd.fxcsdif*=kotbpbp*1.7320508075688772;\n #endif \n \n #else \n \n #ifndef qictwfu\n oupsemd.fxcsdif*=1.7320508075688772;\n #endif \n \n #endif \n \n #else \n oupsemd=yjgikmo(iuqlhbj0,szyepvr0,tipywwk,fspemph,pyekvda);\n #ifdef kqlahgv0\n kotbpbp=wjxlodx(szyepvr0,ntjaipr0,hhknvcm0,kqlahgv0,uzzsmwp0,pgnowwy0,vfpwfis0,izejsjy0);oupsemd.pbfcbmx*=kotbpbp;\n #ifdef qictwfu\n oupsemd.fxcsdif*=kotbpbp;\n #else \n oupsemd.fxcsdif*=kotbpbp*1.7320508075688772;\n #endif \n \n #else \n \n #ifndef qictwfu\n oupsemd.fxcsdif*=1.7320508075688772;\n #endif \n \n #endif \n \n #endif \n \n #if defined(qictwfu)&&mbdxhsz0>0\n cvvostw+=oupsemd.pbfcbmx;\n #else \n uchevpi+=oupsemd.pbfcbmx;owycqde+=oupsemd.fxcsdif;\n #endif \n \n #endif \n \n #ifdef atfjluc1\n \n #ifdef yxuivxf1\n vuhlzwk=normalize((mat3 (wqfoqbo)*szyepvr1).xyz);oupsemd=yjgikmo(iuqlhbj1,vuhlzwk,tipywwk,fspemph,pyekvda);\n #ifdef kqlahgv1\n kotbpbp=wjxlodx(vuhlzwk,(wqfoqbo*vec4 (ntjaipr1,1.0)).xyz,hhknvcm1,kqlahgv1,uzzsmwp1,pgnowwy1,vfpwfis1,izejsjy1);oupsemd.pbfcbmx*=kotbpbp;\n #ifdef qictwfu\n oupsemd.fxcsdif*=kotbpbp;\n #else \n oupsemd.fxcsdif*=kotbpbp*1.7320508075688772;\n #endif \n \n #else \n \n #ifndef qictwfu\n oupsemd.fxcsdif*=1.7320508075688772;\n #endif \n \n #endif \n \n #else \n oupsemd=yjgikmo(iuqlhbj1,szyepvr1,tipywwk,fspemph,pyekvda);\n #ifdef kqlahgv1\n kotbpbp=wjxlodx(szyepvr1,ntjaipr1,hhknvcm1,kqlahgv1,uzzsmwp1,pgnowwy1,vfpwfis1,izejsjy1);oupsemd.pbfcbmx*=kotbpbp;\n #ifdef qictwfu\n oupsemd.fxcsdif*=kotbpbp;\n #else \n oupsemd.fxcsdif*=kotbpbp*1.7320508075688772;\n #endif \n \n #else \n \n #ifndef qictwfu\n oupsemd.fxcsdif*=1.7320508075688772;\n #endif \n \n #endif \n \n #endif \n \n #if defined(qictwfu)&&mbdxhsz1>0\n cvvostw+=oupsemd.pbfcbmx;\n #else \n uchevpi+=oupsemd.pbfcbmx;owycqde+=oupsemd.fxcsdif;\n #endif \n \n #endif \n \n #ifdef atfjluc2\n \n #ifdef yxuivxf2\n vuhlzwk=normalize((mat3 (wqfoqbo)*szyepvr2).xyz);oupsemd=yjgikmo(iuqlhbj2,vuhlzwk,tipywwk,fspemph,pyekvda);\n #ifdef kqlahgv2\n kotbpbp=wjxlodx(vuhlzwk,(wqfoqbo*vec4 (ntjaipr2,1.0)).xyz,hhknvcm2,kqlahgv2,uzzsmwp2,pgnowwy2,vfpwfis2,izejsjy2);oupsemd.pbfcbmx*=kotbpbp;\n #ifdef qictwfu\n oupsemd.fxcsdif*=kotbpbp;\n #else \n oupsemd.fxcsdif*=kotbpbp*1.7320508075688772;\n #endif \n \n #else \n \n #ifndef qictwfu\n oupsemd.fxcsdif*=1.7320508075688772;\n #endif \n \n #endif \n \n #else \n oupsemd=yjgikmo(iuqlhbj2,szyepvr2,tipywwk,fspemph,pyekvda);\n #ifdef kqlahgv2\n kotbpbp=wjxlodx(szyepvr2,ntjaipr2,hhknvcm2,kqlahgv2,uzzsmwp2,pgnowwy2,vfpwfis2,izejsjy2);oupsemd.pbfcbmx*=kotbpbp;\n #ifdef qictwfu\n oupsemd.fxcsdif*=kotbpbp;\n #else \n oupsemd.fxcsdif*=kotbpbp*1.7320508075688772;\n #endif \n \n #else \n \n #ifndef qictwfu\n oupsemd.fxcsdif*=1.7320508075688772;\n #endif \n \n #endif \n \n #endif \n \n #if defined(qictwfu)&&mbdxhsz2>0\n cvvostw+=oupsemd.pbfcbmx;\n #else \n uchevpi+=oupsemd.pbfcbmx;owycqde+=oupsemd.fxcsdif;\n #endif \n \n #endif \n \n #ifdef atfjluc3\n \n #ifdef yxuivxf3\n vuhlzwk=normalize((mat3 (wqfoqbo)*szyepvr3).xyz);oupsemd=yjgikmo(iuqlhbj3,vuhlzwk,tipywwk,fspemph,pyekvda);\n #ifdef kqlahgv3\n kotbpbp=wjxlodx(vuhlzwk,(wqfoqbo*vec4 (ntjaipr3,1.0)).xyz,hhknvcm3,kqlahgv3,uzzsmwp3,pgnowwy3,vfpwfis3,izejsjy3);oupsemd.pbfcbmx*=kotbpbp;\n #ifdef qictwfu\n oupsemd.fxcsdif*=kotbpbp;\n #else \n oupsemd.fxcsdif*=kotbpbp*1.7320508075688772;\n #endif \n \n #else \n \n #ifndef qictwfu\n oupsemd.fxcsdif*=1.7320508075688772;\n #endif \n \n #endif \n \n #else \n oupsemd=yjgikmo(iuqlhbj3,szyepvr3,tipywwk,fspemph,pyekvda);\n #ifdef kqlahgv3\n kotbpbp=wjxlodx(szyepvr3,ntjaipr3,hhknvcm3,kqlahgv3,uzzsmwp3,pgnowwy3,vfpwfis3,izejsjy3);oupsemd.pbfcbmx*=kotbpbp;\n #ifdef qictwfu\n oupsemd.fxcsdif*=kotbpbp;\n #else \n oupsemd.fxcsdif*=kotbpbp*1.7320508075688772;\n #endif \n \n #else \n \n #ifndef qictwfu\n oupsemd.fxcsdif*=1.7320508075688772;\n #endif \n \n #endif \n \n #endif \n \n #if defined(qictwfu)&&mbdxhsz3>0\n cvvostw+=oupsemd.pbfcbmx;\n #else \n uchevpi+=oupsemd.pbfcbmx;owycqde+=oupsemd.fxcsdif;\n #endif \n \n #endif \n \n #ifdef atfjluc4\n \n #ifdef yxuivxf4\n vuhlzwk=normalize((mat3 (wqfoqbo)*szyepvr4).xyz);oupsemd=yjgikmo(iuqlhbj4,vuhlzwk,tipywwk,fspemph,pyekvda);\n #ifdef kqlahgv4\n kotbpbp=wjxlodx(vuhlzwk,(wqfoqbo*vec4 (ntjaipr4,1.0)).xyz,hhknvcm4,kqlahgv4,uzzsmwp4,pgnowwy4,vfpwfis4,izejsjy4);oupsemd.pbfcbmx*=kotbpbp;\n #ifdef qictwfu\n oupsemd.fxcsdif*=kotbpbp;\n #else \n oupsemd.fxcsdif*=kotbpbp*1.7320508075688772;\n #endif \n \n #else \n \n #ifndef qictwfu\n oupsemd.fxcsdif*=1.7320508075688772;\n #endif \n \n #endif \n \n #else \n oupsemd=yjgikmo(iuqlhbj4,szyepvr4,tipywwk,fspemph,pyekvda);\n #ifdef kqlahgv4\n kotbpbp=wjxlodx(szyepvr4,ntjaipr4,hhknvcm4,kqlahgv4,uzzsmwp4,pgnowwy4,vfpwfis4,izejsjy4);oupsemd.pbfcbmx*=kotbpbp;\n #ifdef qictwfu\n oupsemd.fxcsdif*=kotbpbp;\n #else \n oupsemd.fxcsdif*=kotbpbp*1.7320508075688772;\n #endif \n \n #else \n \n #ifndef qictwfu\n oupsemd.fxcsdif*=1.7320508075688772;\n #endif \n \n #endif \n \n #endif \n \n #if defined(qictwfu)&&mbdxhsz4>0\n cvvostw+=oupsemd.pbfcbmx;\n #else \n uchevpi+=oupsemd.pbfcbmx;owycqde+=oupsemd.fxcsdif;\n #endif \n \n #endif \n \n #ifdef atfjluc5\n \n #ifdef yxuivxf5\n vuhlzwk=normalize((mat3 (wqfoqbo)*szyepvr5).xyz);oupsemd=yjgikmo(iuqlhbj5,vuhlzwk,tipywwk,fspemph,pyekvda);\n #ifdef kqlahgv5\n kotbpbp=wjxlodx(vuhlzwk,(wqfoqbo*vec4 (ntjaipr5,1.0)).xyz,hhknvcm5,kqlahgv5,uzzsmwp5,pgnowwy5,vfpwfis5,izejsjy5);oupsemd.pbfcbmx*=kotbpbp;\n #ifdef qictwfu\n oupsemd.fxcsdif*=kotbpbp;\n #else \n oupsemd.fxcsdif*=kotbpbp*1.7320508075688772;\n #endif \n \n #else \n \n #ifndef qictwfu\n oupsemd.fxcsdif*=1.7320508075688772;\n #endif \n \n #endif \n \n #else \n oupsemd=yjgikmo(iuqlhbj5,szyepvr5,tipywwk,fspemph,pyekvda);\n #ifdef kqlahgv5\n kotbpbp=wjxlodx(szyepvr5,ntjaipr5,hhknvcm5,kqlahgv5,uzzsmwp5,pgnowwy5,vfpwfis5,izejsjy5);oupsemd.pbfcbmx*=kotbpbp;\n #ifdef qictwfu\n oupsemd.fxcsdif*=kotbpbp;\n #else \n oupsemd.fxcsdif*=kotbpbp*1.7320508075688772;\n #endif \n \n #else \n \n #ifndef qictwfu\n oupsemd.fxcsdif*=1.7320508075688772;\n #endif \n \n #endif \n \n #endif \n \n #if defined(qictwfu)&&mbdxhsz5>0\n cvvostw+=oupsemd.pbfcbmx;\n #else \n uchevpi+=oupsemd.pbfcbmx;owycqde+=oupsemd.fxcsdif;\n #endif \n \n #endif \n \n #ifdef atfjluc6\n \n #ifdef yxuivxf6\n vuhlzwk=normalize((mat3 (wqfoqbo)*szyepvr6).xyz);oupsemd=yjgikmo(iuqlhbj6,vuhlzwk,tipywwk,fspemph,pyekvda);\n #ifdef kqlahgv6\n kotbpbp=wjxlodx(vuhlzwk,(wqfoqbo*vec4 (ntjaipr6,1.0)).xyz,hhknvcm6,kqlahgv6,uzzsmwp6,pgnowwy6,vfpwfis6,izejsjy6);oupsemd.pbfcbmx*=kotbpbp;\n #ifdef qictwfu\n oupsemd.fxcsdif*=kotbpbp;\n #else \n oupsemd.fxcsdif*=kotbpbp*1.7320508075688772;\n #endif \n \n #else \n \n #ifndef qictwfu\n oupsemd.fxcsdif*=1.7320508075688772;\n #endif \n \n #endif \n \n #else \n oupsemd=yjgikmo(iuqlhbj6,szyepvr6,tipywwk,fspemph,pyekvda);\n #ifdef kqlahgv6\n kotbpbp=wjxlodx(szyepvr6,ntjaipr6,hhknvcm6,kqlahgv6,uzzsmwp6,pgnowwy6,vfpwfis6,izejsjy6);oupsemd.pbfcbmx*=kotbpbp;\n #ifdef qictwfu\n oupsemd.fxcsdif*=kotbpbp;\n #else \n oupsemd.fxcsdif*=kotbpbp*1.7320508075688772;\n #endif \n \n #else \n \n #ifndef qictwfu\n oupsemd.fxcsdif*=1.7320508075688772;\n #endif \n \n #endif \n \n #endif \n \n #if defined(qictwfu)&&mbdxhsz6>0\n cvvostw+=oupsemd.pbfcbmx;\n #else \n uchevpi+=oupsemd.pbfcbmx;owycqde+=oupsemd.fxcsdif;\n #endif \n \n #endif \n \n #ifdef atfjluc7\n \n #ifdef yxuivxf7\n vuhlzwk=normalize((mat3 (wqfoqbo)*szyepvr7).xyz);oupsemd=yjgikmo(iuqlhbj7,vuhlzwk,tipywwk,fspemph,pyekvda);\n #ifdef kqlahgv7\n kotbpbp=wjxlodx(vuhlzwk,(wqfoqbo*vec4 (ntjaipr7,1.0)).xyz,hhknvcm7,kqlahgv7,uzzsmwp7,pgnowwy7,vfpwfis7,izejsjy7);oupsemd.pbfcbmx*=kotbpbp;\n #ifdef qictwfu\n oupsemd.fxcsdif*=kotbpbp;\n #else \n oupsemd.fxcsdif*=kotbpbp*1.7320508075688772;\n #endif \n \n #else \n \n #ifndef qictwfu\n oupsemd.fxcsdif*=1.7320508075688772;\n #endif \n \n #endif \n \n #else \n oupsemd=yjgikmo(iuqlhbj7,szyepvr7,tipywwk,fspemph,pyekvda);\n #ifdef kqlahgv7\n kotbpbp=wjxlodx(szyepvr7,ntjaipr7,hhknvcm7,kqlahgv7,uzzsmwp7,pgnowwy7,vfpwfis7,izejsjy7);oupsemd.pbfcbmx*=kotbpbp;\n #ifdef qictwfu\n oupsemd.fxcsdif*=kotbpbp;\n #else \n oupsemd.fxcsdif*=kotbpbp*1.7320508075688772;\n #endif \n \n #else \n \n #ifndef qictwfu\n oupsemd.fxcsdif*=1.7320508075688772;\n #endif \n \n #endif \n \n #endif \n \n #if defined(qictwfu)&&mbdxhsz7>0\n cvvostw+=oupsemd.pbfcbmx;\n #else \n uchevpi+=oupsemd.pbfcbmx;owycqde+=oupsemd.fxcsdif;\n #endif \n \n #endif \n \n #ifdef atfjluc8\n \n #ifdef yxuivxf8\n vuhlzwk=normalize((mat3 (wqfoqbo)*szyepvr8).xyz);oupsemd=yjgikmo(iuqlhbj8,vuhlzwk,tipywwk,fspemph,pyekvda);\n #ifdef kqlahgv8\n kotbpbp=wjxlodx(vuhlzwk,(wqfoqbo*vec4 (ntjaipr8,1.0)).xyz,hhknvcm8,kqlahgv8,uzzsmwp8,pgnowwy8,vfpwfis8,izejsjy8);oupsemd.pbfcbmx*=kotbpbp;\n #ifdef qictwfu\n oupsemd.fxcsdif*=kotbpbp;\n #else \n oupsemd.fxcsdif*=kotbpbp*1.7320508075688772;\n #endif \n \n #else \n \n #ifndef qictwfu\n oupsemd.fxcsdif*=1.7320508075688772;\n #endif \n \n #endif \n \n #else \n oupsemd=yjgikmo(iuqlhbj8,szyepvr8,tipywwk,fspemph,pyekvda);\n #ifdef kqlahgv8\n kotbpbp=wjxlodx(szyepvr8,ntjaipr8,hhknvcm8,kqlahgv8,uzzsmwp8,pgnowwy8,vfpwfis8,izejsjy8);oupsemd.pbfcbmx*=kotbpbp;\n #ifdef qictwfu\n oupsemd.fxcsdif*=kotbpbp;\n #else \n oupsemd.fxcsdif*=kotbpbp*1.7320508075688772;\n #endif \n \n #else \n \n #ifndef qictwfu\n oupsemd.fxcsdif*=1.7320508075688772;\n #endif \n \n #endif \n \n #endif \n \n #if defined(qictwfu)&&mbdxhsz8>0\n cvvostw+=oupsemd.pbfcbmx;\n #else \n uchevpi+=oupsemd.pbfcbmx;owycqde+=oupsemd.fxcsdif;\n #endif \n \n #endif \n \n #ifdef atfjluc9\n \n #ifdef yxuivxf9\n vuhlzwk=normalize((mat3 (wqfoqbo)*szyepvr9).xyz);oupsemd=yjgikmo(iuqlhbj9,vuhlzwk,tipywwk,fspemph,pyekvda);\n #ifdef kqlahgv9\n kotbpbp=wjxlodx(vuhlzwk,(wqfoqbo*vec4 (ntjaipr9,1.0)).xyz,hhknvcm9,kqlahgv9,uzzsmwp9,pgnowwy9,vfpwfis9,izejsjy9);oupsemd.pbfcbmx*=kotbpbp;\n #ifdef qictwfu\n oupsemd.fxcsdif*=kotbpbp;\n #else \n oupsemd.fxcsdif*=kotbpbp*1.7320508075688772;\n #endif \n \n #else \n \n #ifndef qictwfu\n oupsemd.fxcsdif*=1.7320508075688772;\n #endif \n \n #endif \n \n #else \n oupsemd=yjgikmo(iuqlhbj9,szyepvr9,tipywwk,fspemph,pyekvda);\n #ifdef kqlahgv9\n kotbpbp=wjxlodx(szyepvr9,ntjaipr9,hhknvcm9,kqlahgv9,uzzsmwp9,pgnowwy9,vfpwfis9,izejsjy9);oupsemd.pbfcbmx*=kotbpbp;\n #ifdef qictwfu\n oupsemd.fxcsdif*=kotbpbp;\n #else \n oupsemd.fxcsdif*=kotbpbp*1.7320508075688772;\n #endif \n \n #else \n \n #ifndef qictwfu\n oupsemd.fxcsdif*=1.7320508075688772;\n #endif \n \n #endif \n \n #endif \n \n #if defined(qictwfu)&&mbdxhsz9>0\n cvvostw+=oupsemd.pbfcbmx;\n #else \n uchevpi+=oupsemd.pbfcbmx;owycqde+=oupsemd.fxcsdif;\n #endif \n \n #endif \n \n #ifdef wtolgpn0\n \n #ifdef naqneaz0\n oupsemd=vxpwikb(pgksjxv0,irayogf0,qkurkjy0,normalize((mat3 (wqfoqbo)*tqwolgz0).xyz),tipywwk,fspemph,pyekvda);\n #else \n oupsemd=vxpwikb(pgksjxv0,irayogf0,qkurkjy0,tqwolgz0,tipywwk,fspemph,pyekvda);\n #endif \n \n #if defined(qictwfu)&&gefwago0>0\n cvvostw+=oupsemd.pbfcbmx;\n #else \n uchevpi+=oupsemd.pbfcbmx;owycqde+=oupsemd.fxcsdif;\n #endif \n \n #endif \n \n #ifdef wtolgpn1\n \n #ifdef naqneaz1\n oupsemd=vxpwikb(pgksjxv1,irayogf1,qkurkjy1,normalize((mat3 (wqfoqbo)*tqwolgz1).xyz),tipywwk,fspemph,pyekvda);\n #else \n oupsemd=vxpwikb(pgksjxv1,irayogf1,qkurkjy1,tqwolgz1,tipywwk,fspemph,pyekvda);\n #endif \n \n #if defined(qictwfu)&&gefwago1>0\n cvvostw+=oupsemd.pbfcbmx;\n #else \n uchevpi+=oupsemd.pbfcbmx;owycqde+=oupsemd.fxcsdif;\n #endif \n \n #endif \n \n #ifdef wtolgpn2\n \n #ifdef naqneaz2\n oupsemd=vxpwikb(pgksjxv2,irayogf2,qkurkjy2,normalize((mat3 (wqfoqbo)*tqwolgz2).xyz),tipywwk,fspemph,pyekvda);\n #else \n oupsemd=vxpwikb(pgksjxv2,irayogf2,qkurkjy2,tqwolgz2,tipywwk,fspemph,pyekvda);\n #endif \n \n #if defined(qictwfu)&&gefwago2>0\n cvvostw+=oupsemd.pbfcbmx;\n #else \n uchevpi+=oupsemd.pbfcbmx;owycqde+=oupsemd.fxcsdif;\n #endif \n \n #endif \n \n #ifdef wtolgpn3\n \n #ifdef naqneaz3\n oupsemd=vxpwikb(pgksjxv3,irayogf3,qkurkjy3,normalize((mat3 (wqfoqbo)*tqwolgz3).xyz),tipywwk,fspemph,pyekvda);\n #else \n oupsemd=vxpwikb(pgksjxv3,irayogf3,qkurkjy3,tqwolgz3,tipywwk,fspemph,pyekvda);\n #endif \n \n #if defined(qictwfu)&&gefwago3>0\n cvvostw+=oupsemd.pbfcbmx;\n #else \n uchevpi+=oupsemd.pbfcbmx;owycqde+=oupsemd.fxcsdif;\n #endif \n \n #endif \n \n #ifdef wtolgpn4\n \n #ifdef naqneaz4\n oupsemd=vxpwikb(pgksjxv4,irayogf4,qkurkjy4,normalize((mat3 (wqfoqbo)*tqwolgz4).xyz),tipywwk,fspemph,pyekvda);\n #else \n oupsemd=vxpwikb(pgksjxv4,irayogf4,qkurkjy4,tqwolgz4,tipywwk,fspemph,pyekvda);\n #endif \n \n #if defined(qictwfu)&&gefwago4>0\n cvvostw+=oupsemd.pbfcbmx;\n #else \n uchevpi+=oupsemd.pbfcbmx;owycqde+=oupsemd.fxcsdif;\n #endif \n \n #endif \n \n #ifdef wtolgpn5\n \n #ifdef naqneaz5\n oupsemd=vxpwikb(pgksjxv5,irayogf5,qkurkjy5,normalize((mat3 (wqfoqbo)*tqwolgz5).xyz),tipywwk,fspemph,pyekvda);\n #else \n oupsemd=vxpwikb(pgksjxv5,irayogf5,qkurkjy5,tqwolgz5,tipywwk,fspemph,pyekvda);\n #endif \n \n #if defined(qictwfu)&&gefwago5>0\n cvvostw+=oupsemd.pbfcbmx;\n #else \n uchevpi+=oupsemd.pbfcbmx;owycqde+=oupsemd.fxcsdif;\n #endif \n \n #endif \n \n #ifdef wtolgpn6\n \n #ifdef naqneaz6\n oupsemd=vxpwikb(pgksjxv6,irayogf6,qkurkjy6,normalize((mat3 (wqfoqbo)*tqwolgz5).xyz),tipywwk,fspemph,pyekvda);\n #else \n oupsemd=vxpwikb(pgksjxv6,irayogf6,qkurkjy6,tqwolgz6,tipywwk,fspemph,pyekvda);\n #endif \n \n #if defined(qictwfu)&&gefwago6>0\n cvvostw+=oupsemd.pbfcbmx;\n #else \n uchevpi+=oupsemd.pbfcbmx;owycqde+=oupsemd.fxcsdif;\n #endif \n \n #endif \n \n #ifdef wtolgpn7\n \n #ifdef naqneaz7\n oupsemd=vxpwikb(pgksjxv7,irayogf7,qkurkjy7,normalize((mat3 (wqfoqbo)*tqwolgz5).xyz),tipywwk,fspemph,pyekvda);\n #else \n oupsemd=vxpwikb(pgksjxv7,irayogf7,qkurkjy7,tqwolgz7,tipywwk,fspemph,pyekvda);\n #endif \n \n #if defined(qictwfu)&&gefwago7>0\n cvvostw+=oupsemd.pbfcbmx;\n #else \n uchevpi+=oupsemd.pbfcbmx;owycqde+=oupsemd.fxcsdif;\n #endif \n \n #endif \n \n #ifdef wtolgpn8\n \n #ifdef naqneaz8\n oupsemd=vxpwikb(pgksjxv8,irayogf8,qkurkjy8,normalize((mat3 (wqfoqbo)*tqwolgz5).xyz),tipywwk,fspemph,pyekvda);\n #else \n oupsemd=vxpwikb(pgksjxv8,irayogf8,qkurkjy8,tqwolgz8,tipywwk,fspemph,pyekvda);\n #endif \n \n #if defined(qictwfu)&&gefwago8>0\n cvvostw+=oupsemd.pbfcbmx;\n #else \n uchevpi+=oupsemd.pbfcbmx;owycqde+=oupsemd.fxcsdif;\n #endif \n \n #endif \n \n #ifdef wtolgpn9\n \n #ifdef naqneaz9\n oupsemd=vxpwikb(pgksjxv9,irayogf9,qkurkjy9,normalize((mat3 (wqfoqbo)*tqwolgz5).xyz),tipywwk,fspemph,pyekvda);\n #else \n oupsemd=vxpwikb(pgksjxv9,irayogf9,qkurkjy9,tqwolgz9,tipywwk,fspemph,pyekvda);\n #endif \n \n #if defined(qictwfu)&&gefwago9>0\n cvvostw+=oupsemd.pbfcbmx;\n #else \n uchevpi+=oupsemd.pbfcbmx;owycqde+=oupsemd.fxcsdif;\n #endif \n \n #endif \n owycqde*=fikcdgy*fxcsdif;if(fhogvoz==1){return (pbfcbmx*0.7+dzrxdav*(mwstbcz.rgb+cvvostw))*mwstbcz.a;}else {vec3 jvfkdql=pbfcbmx*uchevpi+dzrxdav*(mwstbcz.rgb+cvvostw)+owycqde;jvfkdql*=mwstbcz.a;\n #if ttttpsh>0\n jvfkdql*=laicxpp;\n #endif \n \n #if ttttpsh==1\n return clamp(jvfkdql/mjjhnsa,0.0,1.0);\n #elif ttttpsh==2\n float eabbdii=0.27*jvfkdql.r+0.67*jvfkdql.g+0.06*jvfkdql.b;jvfkdql=jvfkdql/(vec3 (1.0+eabbdii));return clamp(jvfkdql,0.0,1.0);\n #elif ttttpsh==3\n float eabbdii=0.27*jvfkdql.r+0.67*jvfkdql.g+0.06*jvfkdql.b;jvfkdql=(jvfkdql*(vec3 (1.0)+(eabbdii/(mjjhnsa*mjjhnsa))))/(vec3 (1.0+eabbdii));return clamp(jvfkdql,0.0,1.0);\n #elif ttttpsh==4\n float x=max(0.0,jvfkdql.r-0.004);float y=max(0.0,jvfkdql.g-0.004);float z=max(0.0,jvfkdql.b-0.004);return clamp(vec3 ((x*(6.2*x+0.5))/(x*(6.2*x+1.7)+0.06),(y*(6.2*y+0.5))/(y*(6.2*y+1.7)+0.06),(z*(6.2*z+0.5))/(z*(6.2*z+1.7)+0.06)),0.0,1.0);\n #elif ttttpsh==5\n vec3 fxoelyv=ycddoqb(jvfkdql);float x=max(0.0,fxoelyv.z-0.004);fxoelyv.z=(x*(6.2*x+0.5))/(x*(6.2*x+1.7)+0.06);return clamp(lsfuboz(fxoelyv),0.0,1.0);\n #elif ttttpsh==6\n float ulpfnjs=0.20;float vsoewlw=0.30;float rcyoqfm=0.10;float rovpwul=0.20;float ksrdyvt=0.01;float yvarzfa=0.30;return vec3 (kokfteb(jvfkdql.r,ulpfnjs,vsoewlw,rcyoqfm,rovpwul,ksrdyvt,yvarzfa),kokfteb(jvfkdql.g,ulpfnjs,vsoewlw,rcyoqfm,rovpwul,ksrdyvt,yvarzfa),kokfteb(jvfkdql.b,ulpfnjs,vsoewlw,rcyoqfm,rovpwul,ksrdyvt,yvarzfa));\n #elif ttttpsh==7\n float ulpfnjs=0.20;float vsoewlw=0.30;float rcyoqfm=0.10;float rovpwul=0.20;float ksrdyvt=0.01;float yvarzfa=0.30;vec3 fxoelyv=ycddoqb(jvfkdql);fxoelyv.z=kokfteb(fxoelyv.z,ulpfnjs,vsoewlw,rcyoqfm,rovpwul,ksrdyvt,yvarzfa);return clamp(lsfuboz(fxoelyv),0.0,1.0);\n #elif ttttpsh==8\n float ulpfnjs=0.15;float vsoewlw=0.50;float rcyoqfm=0.10;float rovpwul=0.20;float ksrdyvt=0.02;float yvarzfa=0.30;return vec3 (kokfteb(jvfkdql.r,ulpfnjs,vsoewlw,rcyoqfm,rovpwul,ksrdyvt,yvarzfa),kokfteb(jvfkdql.g,ulpfnjs,vsoewlw,rcyoqfm,rovpwul,ksrdyvt,yvarzfa),kokfteb(jvfkdql.b,ulpfnjs,vsoewlw,rcyoqfm,rovpwul,ksrdyvt,yvarzfa));\n #elif ttttpsh==9\n float ulpfnjs=0.15;float vsoewlw=0.50;float rcyoqfm=0.10;float rovpwul=0.20;float ksrdyvt=0.02;float yvarzfa=0.30;vec3 fxoelyv=ycddoqb(jvfkdql);fxoelyv.z=kokfteb(fxoelyv.z,ulpfnjs,vsoewlw,rcyoqfm,rovpwul,ksrdyvt,yvarzfa);return clamp(lsfuboz(fxoelyv),0.0,1.0);\n #elif ttttpsh==10\n float ulpfnjs=2.51;float vsoewlw=0.03;float rcyoqfm=2.43;float rovpwul=0.59;float ksrdyvt=0.14;return vec3 (frziqcg(jvfkdql.r,ulpfnjs,vsoewlw,rcyoqfm,rovpwul,ksrdyvt),frziqcg(jvfkdql.g,ulpfnjs,vsoewlw,rcyoqfm,rovpwul,ksrdyvt),frziqcg(jvfkdql.b,ulpfnjs,vsoewlw,rcyoqfm,rovpwul,ksrdyvt));\n #elif ttttpsh==11\n float ulpfnjs=2.51;float vsoewlw=0.03;float rcyoqfm=2.43;float rovpwul=0.59;float ksrdyvt=0.14;vec3 fxoelyv=ycddoqb(jvfkdql);fxoelyv.z=frziqcg(fxoelyv.z,ulpfnjs,vsoewlw,rcyoqfm,rovpwul,ksrdyvt);return clamp(lsfuboz(fxoelyv),0.0,1.0);\n #else \n return jvfkdql;\n #endif \n }}float udvupyw(vec4 caynkex,int qxsvhox){if(qxsvhox==1){return caynkex.r;}if(qxsvhox==2){return caynkex.g;}if(qxsvhox==3){return caynkex.b;}if(qxsvhox==4){return caynkex.a;}if(qxsvhox==5){return brhvcmq(caynkex.rgb);}return 0.0;}vec4 argpges(samplerCube uotuwqh,vec3 yxxvfpe,int iconvlg,vec3 vspdedz,float ktnvxcp,int ecbkhoc){if(iconvlg==1){vec3 iejwwyj=fqnhwfi-vspdedz;vec3 t=(ktnvxcp*sign(yxxvfpe)-iejwwyj)/yxxvfpe;float aahbgaq=min(min(t.x,t.y),t.z);if(ecbkhoc==1){return textureCube(uotuwqh,mat3 (1,0,0,0,0,-1,0,1,0)*itcyfdm*normalize(iejwwyj+aahbgaq*yxxvfpe));}return textureCube(uotuwqh,normalize(iejwwyj+aahbgaq*yxxvfpe));}return textureCube(uotuwqh,yxxvfpe);}\n #ifdef tdigpwa\n float wxhwvux(const  in vec2 otyskcf){return texture2D(vtwyuay,otyskcf*(qxxpdff/uwxywpw)).x;}vec4 fljmcka(const  in vec2 otyskcf){return texture2D(egtltvw,otyskcf*(qxxpdff/uwxywpw));}float fxawwnm(const  in float jbyfmhr){return (ghgsnpw[2][3]==-1.0)?(xcsurjq.x*xcsurjq.y)/((xcsurjq.y-xcsurjq.x)*jbyfmhr-xcsurjq.y):jbyfmhr*(xcsurjq.x-xcsurjq.y)-xcsurjq.x;}float oitrrux( in float myfjpxu, in float xzdwqrl){return exp(-(myfjpxu*myfjpxu)/(2.0*(xzdwqrl*xzdwqrl)))/(2.5066282746310002*xzdwqrl);}vec4 nobmeqg( in vec3 bwbdrsm, in float ijgjgad, in float fkrvhxe){vec4 gslkjbt=ghgsnpw*vec4 (wnlnryx+bwbdrsm*fkrvhxe,1.0);vec2 onnrgga=(gslkjbt.xy/gslkjbt.w)*0.5+0.5;float jbyfmhr=wxhwvux(onnrgga);bool tnewazt=(fxawwnm(jbyfmhr)>wnlnryx.z)||(onnrgga.x<0.||onnrgga.x>1.0||onnrgga.y<0.||onnrgga.y>1.0);if(tnewazt){onnrgga=gl_FragCoord.xy/qxxpdff;}vec4 rgba=fljmcka(onnrgga);\n #ifndef tpkjzuw\n return rgba;\n #else \n float xzdwqrl=mix(1.0,24.0,ijgjgad);float sodvqwv=mix(1.0,50.0,ijgjgad);if(jbyfmhr<(1.0-0.000001)&&!tnewazt){sodvqwv=mix(1.0,sodvqwv,(xcsurjq.y/2.0-abs(wnlnryx.z))/(xcsurjq.y/2.0));}float s=clamp(ceil(sodvqwv/8.0),1.0,8.0);float tcnugzh=oitrrux(0.0,xzdwqrl);vec4 ekwjtvu=rgba*tcnugzh;vec4 trdcrms;vec2 vzozgxg,nwqtxpl;mat2 xzvfyft=mat2 (1.0);for(float myfjpxu=1.0;myfjpxu<=8.0;myfjpxu++){if(myfjpxu*s>sodvqwv){break;}float zobjbjv=oitrrux(myfjpxu,xzdwqrl);vec2 cyxmscz=vec2 (myfjpxu*s,0.0);for(float nigyetq=0.0;nigyetq<12.0;nigyetq++){float a=nigyetq*0.52;float splrifm=cos(a);float s=sin(a);xzvfyft[0].x=splrifm;xzvfyft[0].y=s;xzvfyft[0].x=-s;xzvfyft[0].y=splrifm;vzozgxg=onnrgga+xzvfyft*(cyxmscz/qxxpdff);jbyfmhr=wxhwvux(vzozgxg);tnewazt=(fxawwnm(jbyfmhr)>wnlnryx.z)||(vzozgxg.x<0.||vzozgxg.x>1.0||vzozgxg.y<0.||vzozgxg.y>1.0);if(!tnewazt){rgba=fljmcka(vzozgxg);}ekwjtvu+=rgba*zobjbjv;tcnugzh+=zobjbjv;}}return ekwjtvu/tcnugzh;\n #endif \n }\n #endif \n float vsoewlw2(vec2 hyxolpo){return mod(2.0*hyxolpo.y+hyxolpo.x+1.0,4.0);}float vsoewlw512(vec2 hyxolpo){vec2 tdiccyz1=mod(hyxolpo,2.0);vec2 tdiccyz2=floor(0.5*mod(hyxolpo,4.0));vec2 tdiccyz4=floor(0.25*mod(hyxolpo,8.0));vec2 tdiccyz8=floor(0.125*mod(hyxolpo,16.0));vec2 tdiccyz16=floor(0.0625*mod(hyxolpo,32.0));vec2 tdiccyz32=floor(0.03125*mod(hyxolpo,64.0));vec2 tdiccyz64=floor(0.015625*mod(hyxolpo,128.0));vec2 tdiccyz128=floor(0.0078125*mod(hyxolpo,256.0));vec2 tdiccyz256=floor(0.00390625*mod(hyxolpo,512.0));return 4.0*(4.0*(4.0*(4.0*(4.0*(4.0*(4.0*(4.0*vsoewlw2(tdiccyz1)+vsoewlw2(tdiccyz2))+vsoewlw2(tdiccyz4))+vsoewlw2(tdiccyz8))+vsoewlw2(tdiccyz16))+vsoewlw2(tdiccyz32))+vsoewlw2(tdiccyz64))+vsoewlw2(tdiccyz128))+vsoewlw2(tdiccyz256);}bool yrinrlf(float jtwyxfd){if(hjqcbro==0){const mat4 rmigdnj=mat4 (1,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0);ivec2 xzmeqdu=ivec2 (tiurzyf(0,rmigdnj).xy*4096.0);return jtwyxfd<clamp((vsoewlw512(vec2 (xzmeqdu))+1.0)/262145.0,0.0,1.0);}else {return ((jtwyxfd<0.5)?2.0:1.2)*jtwyxfd<clamp((vsoewlw512(gl_FragCoord.xy+vec2 (hjqcbro))+1.0)/262145.0,0.0,1.0);}}float udhfzaq(float xpvzhgh,float pejzgoa){return xpvzhgh<0.5?(2.0*xpvzhgh*pejzgoa):(1.0-2.0*(1.0-xpvzhgh)*(1.0-pejzgoa));}vec3 udhfzaq(vec3 xpvzhgh,vec3 pejzgoa){return vec3 (udhfzaq(xpvzhgh.r,pejzgoa.r),udhfzaq(xpvzhgh.g,pejzgoa.g),udhfzaq(xpvzhgh.b,pejzgoa.b));}void main(){agubczf=jqgramm4.xyz;vkstiss=ibymued4.xyz;fqnhwfi=olsbfcm4.xyz;hbnjyno.x=jqgramm4.a;hbnjyno.y=ibymued4.a;hbnjyno.z=olsbfcm4.a;wnlnryx=gkuebzf4.xyz;\n #ifdef khvylnr\n lxlmcsl=tiurzyf(avbfhlu,imjkghn);gl_FragColor.a=bzmstcf*step(lxlmcsl.z,0.5)*udvupyw(texture2D(bxddaze,lxlmcsl.xy),uxqdzlm);\n #else \n gl_FragColor.a=bzmstcf;\n #endif \n \n #ifdef ANIMATING \n \n #ifdef cybhscz\n lxlmcsl=tiurzyf(avbfhlu2,imjkghn2);gl_FragColor.a=mix(gl_FragColor.a,bzmstcf2*step(lxlmcsl.z,0.5)*udvupyw(texture2D(bxddaze2,lxlmcsl.xy),uxqdzlm2),heftokz);\n #else \n gl_FragColor.a=mix(gl_FragColor.a,bzmstcf2,heftokz);\n #endif \n \n #endif \n float gzpxmek=ymenuuk;\n #ifdef ANIMATING \n gzpxmek=mix(gzpxmek,ymenuuk2,heftokz);\n #endif \n \n #ifdef zgbdrir\n if(ufoyjfa>0.0){if(gkuebzf4.w==0.0){discard;}gl_FragColor.a*=gkuebzf4.w;}\n #endif \n if(gl_FragColor.a<gzpxmek*0.995+0.005){discard;}if(ftqjlzm==4&&yrinrlf(gl_FragColor.a)){discard;}if(ftqjlzm>=3){gl_FragColor.a=1.0;}vec3 zzucuzb,zzucuzb2;vec3 ncsjtvg,ncsjtvg2;vec3 ikqbwsr;vec2 pzjlshd=vec2 (gl_FragCoord.x/qxxpdff[0],gl_FragCoord.y/qxxpdff[1]);vec3 iieuufh=normalize(fqnhwfi-xzwunne);\n #ifdef tlecjjv\n if(ummxwav==1){float nlwcjxh=cqtmruh[0]*cqtmruh[0]+cqtmruh[1]*cqtmruh[1]+cqtmruh[2]*cqtmruh[2];float t=-((cqtmruh[0]*(fqnhwfi[0]-yqifqgk[0]))+(cqtmruh[1]*(fqnhwfi[1]-yqifqgk[1]))+(cqtmruh[2]*(fqnhwfi[2]-yqifqgk[2])))/nlwcjxh;ikqbwsr=vec3 (cqtmruh[0]*t+fqnhwfi[0],cqtmruh[1]*t+fqnhwfi[1],cqtmruh[2]*t+fqnhwfi[2]);if(dot(normalize(fqnhwfi-ikqbwsr),cqtmruh)<=0.0){discard;}}\n #endif \n \n #ifdef poteimn\n float hrjkfip=mtppyuk;\n #ifdef ayiiefg\n hrjkfip*=brhvcmq(texture2D(qxzsape,tiurzyf(ituhipi,wygpxnc).xy).rgb);\n #endif \n if(bklqtbh==1){zzucuzb=eneybyo(normalize(vkstiss),hrjkfip,krklesm,vxabpou,xjrxkxf);ncsjtvg=jewccxz(normalize(hbnjyno),hrjkfip,krklesm,vxabpou,xjrxkxf);}else {zzucuzb=rbbsftx(agubczf,normalize(vkstiss),hrjkfip,krklesm,vxabpou,xjrxkxf);ncsjtvg=rbbsftx(fqnhwfi,normalize(hbnjyno),hrjkfip,krklesm,vxabpou,xjrxkxf);}\n #else \n zzucuzb=normalize(vkstiss);ncsjtvg=normalize(hbnjyno);\n #endif \n \n #ifdef fomzgxw\n float hrjkfip2=mtppyuk2;\n #ifdef fdclrvp\n hrjkfip2*=brhvcmq(texture2D(qxzsape2,tiurzyf(ituhipi2,wygpxnc2).xy).rgb);\n #endif \n if(bklqtbh2==1){zzucuzb2=eneybyo(normalize(vkstiss),hrjkfip2,krklesm2,vxabpou2,xjrxkxf2);ncsjtvg2=jewccxz(normalize(hbnjyno),hrjkfip2,krklesm2,vxabpou2,xjrxkxf2);}else {zzucuzb2=rbbsftx(agubczf,normalize(vkstiss),hrjkfip2,krklesm2,vxabpou2,xjrxkxf2);ncsjtvg2=rbbsftx(fqnhwfi,normalize(hbnjyno),hrjkfip2,krklesm2,vxabpou2,xjrxkxf2);}\n #else \n zzucuzb2=normalize(vkstiss);ncsjtvg2=normalize(hbnjyno);\n #endif \n \n #ifdef ANIMATING \n zzucuzb=mix(zzucuzb,zzucuzb2,heftokz);ncsjtvg=mix(ncsjtvg,ncsjtvg2,heftokz);\n #endif \n if(!gl_FrontFacing==true){zzucuzb=-zzucuzb;ncsjtvg=-ncsjtvg;}gl_FragColor.rgb=mryvhfe(zzucuzb,ncsjtvg);\n #ifdef tlecjjv\n if(ummxwav==2){vec2 deobjdf=vec2 (-1.0,1.0)*pzjlshd+vec2 (1.0,0.0);float cqhyrfl=ankxunu;if(qdhbrga==1.0){cqhyrfl*=brhvcmq(texture2D(rwexkck,tiurzyf(0,crgwmls).xy).rgb);}vec4 oqpmfay=texture2D(plcreao,deobjdf);gl_FragColor.rgb=mix(gl_FragColor.rgb,oqpmfay.rgb,cqhyrfl);}\n #endif \n vec3 reflColor;float cuahyrs;\n #ifdef xovkksj\n vec3 refl;if(qrcyyzq==0){refl=normalize(reflect(iieuufh,ncsjtvg));}else {refl=reflect(normalize(agubczf-vec3 (0,0,1)),zzucuzb);}reflColor=argpges(xplzpaf,refl,pndixgj-qrcyyzq,gveasdj,dvdtkio,0).rgb;cuahyrs=kyuqpss;\n #ifdef kyhuvgs\n cuahyrs*=brhvcmq(texture2D(fnltzwx,tiurzyf(cjpagro,vdzqqlc).xy).rgb);\n #endif \n float svuvoay=brhvcmq(reflColor);cuahyrs*=1.0-((1.0-gl_FragColor.a)*(1.0-svuvoay));cuahyrs*=1.0-((rhvwknj)*(1.0-svuvoay));\n #else \n reflColor=gl_FragColor.rgb;cuahyrs=1.0;\n #endif \n float bltbrno=acos(dot(vec3 (0,0,1),normalize(zzucuzb)))/3.141592653;\n #ifdef gntovzq\n vec3 yukhzlh=texture2D(bmwhadd,(djklitl*vec4 (bltbrno,0,0,1)).xy).rgb;float pxcpkii=schoboi;\n #ifdef njedwma\n pxcpkii*=brhvcmq(texture2D(nkzuzqt,tiurzyf(wifbckp,djuzoiv).xy).rgb);\n #endif \n \n #ifdef xovkksj\n yukhzlh*=pxcpkii;reflColor=mix(gl_FragColor.rgb,reflColor*yukhzlh,cuahyrs);\n #else \n reflColor=mix(gl_FragColor.rgb,yukhzlh,pxcpkii);\n #endif \n \n #else \n reflColor=mix(gl_FragColor.rgb,reflColor,cuahyrs);\n #endif \n vec3 reflColor2;float cuahyrs2;\n #ifdef ycbccsl\n vec3 refl2;if(qrcyyzq2==0){refl2=normalize(reflect(iieuufh,ncsjtvg));}else {refl2=reflect(normalize(agubczf-vec3 (0,0,1)),zzucuzb);}reflColor2=argpges(xplzpaf2,refl2,pndixgj2-qrcyyzq2,gveasdj2,dvdtkio2,0).rgb;cuahyrs2=kyuqpss2;\n #ifdef eeqsdyv\n cuahyrs2*=brhvcmq(texture2D(fnltzwx2,tiurzyf(cjpagro2,vdzqqlc2).xy).rgb);\n #endif \n float svuvoay2=brhvcmq(reflColor2);cuahyrs2*=1.0-((1.0-gl_FragColor.a)*(1.0-svuvoay2));cuahyrs2*=1.0-((rhvwknj2)*(1.0-svuvoay2));\n #else \n reflColor2=gl_FragColor.rgb;cuahyrs2=1.0;\n #endif \n \n #ifdef hbowaxq\n vec3 yukhzlh2=texture2D(bmwhadd2,(djklitl2*vec4 (bltbrno,0,0,1)).xy).rgb;float pxcpkii2=schoboi2;\n #ifdef qikfanu\n pxcpkii2*=brhvcmq(texture2D(nkzuzqt2,tiurzyf(wifbckp2,djuzoiv2).xy).rgb);\n #endif \n \n #ifdef ycbccsl\n yukhzlh2*=pxcpkii2;reflColor2=mix(gl_FragColor.rgb,reflColor2*yukhzlh2,cuahyrs2);\n #else \n reflColor2=mix(gl_FragColor.rgb,yukhzlh2,pxcpkii2);\n #endif \n \n #else \n reflColor2=mix(gl_FragColor.rgb,reflColor2,cuahyrs2);\n #endif \n float tcyoere=1.0;float tcyoere2=1.0;\n #ifdef rofpzvn\n tcyoere=ijwreus;\n #endif \n \n #ifdef pnswumg\n tcyoere2=ijwreus2;\n #endif \n \n #ifdef ANIMATING \n tcyoere=mix(tcyoere,tcyoere2,heftokz);\n #endif \n vec3 refrColor;float dajzlvb;\n #ifdef rofpzvn\n vec3 refr;if(pqtpdgb==0){refr=normalize(refract(iieuufh,ncsjtvg,1.0/tcyoere));}else {refr=refract(normalize(agubczf-vec3 (0,0,1)),zzucuzb,1.0/tcyoere);}dajzlvb=tvceenj;\n #ifdef sfsqzng\n dajzlvb*=brhvcmq(texture2D(pofdivt,tiurzyf(dzptjrq,gqedqnf).xy).rgb);\n #endif \n \n #ifdef ymqdhta\n refrColor=argpges(mximbml,refr,goobxbd-pqtpdgb,qskkyrm,vptxeeo,1).rgb;\n #else \n \n #ifdef tdigpwa\n vec3 bwbdrsm=refract(normalize(wnlnryx),zzucuzb,1.0/tcyoere);float subkgod=(tcyoere>=1.0)?tcyoere:1.0/tcyoere;vec4 jocmxtf=nobmeqg(bwbdrsm,(1.0-(fwyvcka/100.0)),subkgod*dnbasxr);refrColor=jocmxtf.rgb;dajzlvb*=(1.0-gl_FragColor.a);gl_FragColor.a+=jocmxtf.a*(1.0-gl_FragColor.a);\n #else \n refrColor=gl_FragColor.rgb;\n #endif \n \n #endif \n \n #else \n refrColor=gl_FragColor.rgb;dajzlvb=1.0;\n #endif \n refrColor=mix(gl_FragColor.rgb,refrColor,dajzlvb);vec3 refrColor2;float dajzlvb2;\n #if defined(pnswumg)&&defined(vrszyeb)\n refrColor2=argpges(mximbml2,refr,goobxbd2-pqtpdgb2,qskkyrm2,vptxeeo2,1).rgb;dajzlvb2=tvceenj2;\n #ifdef xlbaqqf\n dajzlvb2*=brhvcmq(texture2D(pofdivt2,tiurzyf(dzptjrq2,gqedqnf2).xy).rgb);\n #endif \n \n #else \n refrColor2=gl_FragColor.rgb;dajzlvb2=1.0;\n #endif \n refrColor2=mix(gl_FragColor.rgb,refrColor2,dajzlvb2);\n #if defined(rofpzvn)||defined(pnswumg)\n \n #ifdef ANIMATING \n refrColor=mix(refrColor,refrColor2,heftokz);reflColor=mix(reflColor,reflColor2,heftokz);\n #endif \n float ppkdwez=(tcyoere-1.0)/(tcyoere+1.0);ppkdwez=ppkdwez*ppkdwez;float ocqpvse=ppkdwez+(1.0-ppkdwez)*pow(1.0+dot(normalize(agubczf-vec3 (0,0,1)),zzucuzb),5.0);gl_FragColor.rgb=mix(refrColor,reflColor,ocqpvse);\n #else \n \n #ifdef ANIMATING \n gl_FragColor.rgb=mix(reflColor,reflColor2,heftokz);\n #else \n gl_FragColor.rgb=reflColor;\n #endif \n \n #endif \n float pwxuyly=1.0;\n #if defined(khvylnr)||defined(cybhscz)\n if(gl_FragColor.a<0.4){pwxuyly=sin(7.853981633974483*gl_FragColor.a-1.5707963267948966)/2.0+0.5;}\n #endif \n \n #if defined(xovkksj)||defined(ycbccsl)\n \n #ifdef xovkksj\n \n #ifdef ycbccsl\n gl_FragColor.a+=pwxuyly*mix((1.0-gl_FragColor.a)*(cuahyrs)*(1.0-heftokz),(1.0-gl_FragColor.a)*(cuahyrs2),heftokz);\n #else \n \n #ifdef ANIMATING \n gl_FragColor.a+=pwxuyly*(1.0-gl_FragColor.a)*(cuahyrs)*(1.0-heftokz);\n #else \n gl_FragColor.a+=pwxuyly*(1.0-gl_FragColor.a)*(cuahyrs);\n #endif \n \n #endif \n \n #else \n \n #ifdef ANIMATING \n gl_FragColor.a+=pwxuyly*(1.0-gl_FragColor.a)*(cuahyrs2)*heftokz;\n #else \n gl_FragColor.a+=pwxuyly*(1.0-gl_FragColor.a)*(cuahyrs2);\n #endif \n \n #endif \n \n #endif \n \n #ifdef tlecjjv\n if(ummxwav==1){if(fxmwxnt!=0.0){float srhkupd=1.0-clamp((distance(fqnhwfi,ikqbwsr)-htrgljy)/(fxmwxnt-htrgljy),0.0,1.0);gl_FragColor*=pow(srhkupd,pijwcjc);}}\n #endif \n if(atutpxf==1&&mgntrba!=1){if(ejcsltc==0){gl_FragColor.rgb=mix(gl_FragColor.rgb,kisinpb.rgb,kisinpb.a);}else if(ejcsltc==1){gl_FragColor.rgb+=kisinpb.rgb*kisinpb.a;}else if(ejcsltc==2){gl_FragColor.rgb*=kisinpb.rgb;}else if(ejcsltc==3){gl_FragColor.rgb=udhfzaq(gl_FragColor.rgb,kisinpb.rgb);}}\n #ifdef osvrsmm\n \n #ifdef pksryor\n vec3 ewalwdj=texture2D(kwjbjjn,tiurzyf(hvuuljr,pwyttky).xy).rgb;\n #else \n vec3 ewalwdj=zmanptk;\n #endif \n \n #else \n vec3 ewalwdj=vec3 (1);\n #endif \n \n #ifdef lipkixn\n \n #ifdef rgikbwi\n vec3 ewalwdj2=texture2D(kwjbjjn2,tiurzyf(hvuuljr2,pwyttky2).xy).rgb;\n #else \n vec3 ewalwdj2=zmanptk2;\n #endif \n \n #else \n vec3 ewalwdj2=vec3 (1);\n #endif \n \n #if defined(osvrsmm)||defined(lipkixn)\n \n #ifdef ANIMATING \n gl_FragColor.rgb*=mix(ewalwdj,ewalwdj2,heftokz);\n #else \n gl_FragColor.rgb*=ewalwdj;\n #endif \n \n #endif \n \n #if defined(osvrsmm)||defined(lipkixn)\n vec3 fxoelyv=ycddoqb(gl_FragColor.rgb);float mbrnmmb=fxoelyv.r;float s=fxoelyv.g;float mfvvztb=fxoelyv.b;\n #endif \n \n #ifdef osvrsmm\n float jftoncn=rdmdoxh;float mnynvbe=brhvcmq(texture2D(shxrduo,tiurzyf(tbxrkkm,ljrcsui).xy).rgb);\n #ifdef lipkixn\n jftoncn=mix(rdmdoxh,rdmdoxh2,heftokz);float mnynvbe2=brhvcmq(texture2D(shxrduo2,tiurzyf(tbxrkkm2,ljrcsui2).xy).rgb);mnynvbe=mix(mnynvbe,mnynvbe2,heftokz);\n #else \n \n #ifdef ANIMATING \n jftoncn=(1.0-heftokz)*jftoncn;mnynvbe=mix(mnynvbe,1.0,heftokz);\n #endif \n \n #endif \n mfvvztb*=(1.0-jftoncn)+mnynvbe*jftoncn;\n #else \n \n #ifdef lipkixn\n float mnynvbe=brhvcmq(texture2D(shxrduo2,tiurzyf(tbxrkkm2,ljrcsui2).xy).rgb);float jftoncn=heftokz*rdmdoxh2;mfvvztb*=(1.0-jftoncn)+mnynvbe*jftoncn;\n #endif \n \n #endif \n \n #if defined(osvrsmm)||defined(lipkixn)\n gl_FragColor.rgb=lsfuboz(vec3 (mbrnmmb,s,mfvvztb));\n #endif \n float pckjyal=jwbntls;\n #ifdef ylmuugp\n vec3 ssqapzq=texture2D(hbaqifu,tiurzyf(kvqnhvv,fbqzibe).xy).rgb;\n #else \n vec3 ssqapzq=nsnbysp.rgb;\n #endif \n \n #ifdef aitbpqn\n pckjyal*=brhvcmq(texture2D(qzywjbd,tiurzyf(urpflui,miqrofj).xy).rgb);\n #endif \n \n #ifdef ANIMATING \n float pckjyal2=jwbntls2;\n #ifdef muzpkxq\n vec4 ethdgtx2=texture2D(hbaqifu2,tiurzyf(kvqnhvv2,fbqzibe2).xy);vec3 ssqapzq2=ethdgtx2.rgb;pckjyal2*=ethdgtx2.a;\n #else \n vec3 ssqapzq2=nsnbysp2.rgb;\n #endif \n \n #ifdef qvyqlby\n pckjyal2*=brhvcmq(texture2D(qzywjbd2,tiurzyf(urpflui2,miqrofj2).xy).rgb);\n #endif \n ssqapzq=mix(ssqapzq,ssqapzq2,heftokz);pckjyal=mix(pckjyal,pckjyal2,heftokz);\n #endif \n gl_FragColor.rgb=clamp(mix(gl_FragColor.rgb,ssqapzq,pckjyal),0.0,1.0);\n #ifdef enkgdhh\n if(ftqjlzm==1){gl_FragColor.rgb*=gl_FragColor.a;gl_FragColor.rgb=texture2D(dfwrrka,pzjlshd).rgb+gl_FragColor.rgb;}else if(ftqjlzm==2){gl_FragColor.rgb*=gl_FragColor.a;gl_FragColor.rgb=texture2D(dfwrrka,pzjlshd).rgb*gl_FragColor.rgb;}else {gl_FragColor.rgb=mix(texture2D(dfwrrka,pzjlshd).rgb,gl_FragColor.rgb,gl_FragColor.a);}gl_FragColor.a=1.0;\n #else \n gl_FragColor.rgb*=gl_FragColor.a;\n #endif \n \n #ifdef dtccdcw\n vec3 tiobvhg=normalize(fnmxbkg-xzwunne);vec3 lohyyun=vec3 (dFdx(fqnhwfi.x),dFdx(fqnhwfi.y),dFdx(fqnhwfi.z));vec3 oqjymjj=vec3 (dFdy(fqnhwfi.x),dFdy(fqnhwfi.y),dFdy(fqnhwfi.z));vec3 rytvcde=normalize(cross(lohyyun,oqjymjj));float nkxskwe=max(1.0-dot(tiobvhg,-rytvcde),0.0);float rvncnkc=nkxskwe*nkxskwe;rvncnkc*=rvncnkc;rvncnkc*=nkxskwe;float kqsybeq=0.17;float obpmfoj=kqsybeq+(1.0-kqsybeq)*rvncnkc;vec3 wxriqmy=refrColor*refrColor;wxriqmy=mix(wxriqmy,vec3 (0.3,0.3,0.3),obpmfoj);float jsbxpvp=.3;float iyqmynu=1.0;float eabbdii=min(dot(vec3 (.299,.587,.114),wxriqmy),1.0);float fczgmww=(eabbdii-jsbxpvp)/(iyqmynu-jsbxpvp);\n #ifdef osvrsmm\n gl_FragColor.rgb=vec3 (zmanptk*fczgmww);\n #else \n gl_FragColor.rgb=vec3 (fczgmww);\n #endif \n \n #endif \n }",
vertexShaderGoochRendering:"attribute vec3 ymaxekn;attribute vec3 pcgewnw;uniform mat4 ondssmn;uniform mat4 ampnorz;uniform mat4 ghgsnpw;uniform mat3 dcsphyk;varying vec3 vkstiss;void main(){gl_Position=ghgsnpw*(ampnorz*(ondssmn*vec4 (ymaxekn,1.0)));vkstiss=normalize(dcsphyk*pcgewnw);}",fragmentShaderGoochRendering:"uniform vec3 fmnjqmw;uniform vec3 ohcexfk;uniform vec3 xoxpkib;varying vec3 vkstiss;void main(){float rhssnen=dot(normalize(vkstiss),-normalize(xoxpkib));gl_FragColor.rgb=(0.5+rhssnen/2.0)*ohcexfk+(0.5-rhssnen/2.0)*fmnjqmw;gl_FragColor.a=1.0;}",
vertexShaderShadowMapRendering:"\n #ifndef ujenxlh\n attribute vec3 ymaxekn;attribute vec3 pcgewnw;\n #endif \n uniform mat4 ondssmn;uniform mat4 ampnorz;uniform mat4 ghgsnpw;uniform vec3 xzwunne;uniform float cqcpvcg;varying vec3 poszvcj;void main(){vec3 wmxooao=ymaxekn;if(cqcpvcg!=0.0){wmxooao+=normalize(pcgewnw)*cqcpvcg;}vec4 iejwwyj=ondssmn*vec4 (wmxooao,1.0);gl_Position=ghgsnpw*ampnorz*iejwwyj;poszvcj=iejwwyj.xyz-xzwunne;\n #ifdef ujenxlh\n mat3 ccpxoqv=mat3 (ondssmn);mat3 dcsphyk=mat3 (ampnorz*ondssmn);\n #else \n }\n #endif \n ",
fragmentShaderShadowMapRendering:"uniform float oruddbu;uniform float hvcoccw;varying vec3 poszvcj;vec4 iiliqkt(const  in float jbyfmhr){const vec4 ztpwjul=vec4 (256.0*256.0*256.0,256.0*256.0,256.0,1.0);const vec4 qysafyo=vec4 (0.0,1.0/256.0,1.0/256.0,1.0/256.0);vec4 res =fract(jbyfmhr*ztpwjul);res -=res .xxyz*qysafyo;return res ;}vec4 oaqgdum(float jbyfmhr){const vec4 upokuis=vec4 (1.0/255.0,1.0/255.0,1.0/255.0,0.0);float r=jbyfmhr;float g=fract(r*255.0);float b=fract(g*255.0);float a=fract(b*255.0);vec4 xpihigs=vec4 (r,g,b,a);return xpihigs-(xpihigs.yzww*upokuis);}vec4 auvaidf(float ppkdwez){bool iejwwyj=ppkdwez>0.0;if(!iejwwyj)ppkdwez=-ppkdwez;int tfbksng=int (floor(log2(ppkdwez)));ppkdwez*=pow(2.0,23.0-float (tfbksng));ppkdwez-=8388608.0;int b=int (floor(ppkdwez+0.5));tfbksng+=127;int qlcejiy=iejwwyj?0:128;return vec4 (b-b/256*256,b/256-b/256/256*256,b/256/256+(tfbksng-tfbksng/2*2)*128,tfbksng/2+qlcejiy)/255.0;}vec4 pqvwymt32(float ppkdwez){float nsvbngn=5.0;float yvarzfa=abs(ppkdwez);float weseeku=step(0.0,-ppkdwez);float twhfvbe=floor(log2(yvarzfa));float fwafwnw=(exp2(-twhfvbe)*yvarzfa);twhfvbe=floor(log2(yvarzfa)+127.0)+floor(log2(fwafwnw));vec4 rgba;rgba[0]=128.0*weseeku+floor(twhfvbe*exp2(-1.0));rgba[1]=128.0*mod(twhfvbe,2.0)+mod(floor(fwafwnw*128.0),128.0);rgba[2]=floor(mod(floor(fwafwnw*exp2(23.0-8.0)),exp2(8.0)));rgba[3]=floor(exp2(23.0)*mod(fwafwnw,exp2(-15.0)));return rgba;}vec4 rkyckxz(float ppkdwez){float yvarzfa=abs(ppkdwez);if(yvarzfa==0.0){return vec4 (0,0,0,0);}float weseeku=step(0.0,-ppkdwez);float twhfvbe=floor(log2(yvarzfa));float fwafwnw=yvarzfa/exp2(twhfvbe);if(fwafwnw<1.0)twhfvbe-=1.0;twhfvbe+=127.0;vec4 rgba;rgba[0]=twhfvbe;rgba[1]=128.0*weseeku+mod(floor(fwafwnw*float (128.0)),128.0);rgba[2]=floor(mod(floor(fwafwnw*exp2(float (23.0-8.0))),exp2(8.0)));rgba[3]=floor(exp2(23.0)*mod(fwafwnw,exp2(-15.0)));return (1.0/255.0)*rgba;}vec2 gmezrzi(float jbyfmhr){const vec2 upokuis=vec2 (1.0/255.0,0.0);vec2 xpihigs=vec2 (jbyfmhr,fract(jbyfmhr*255.0));return xpihigs-(xpihigs.yy*upokuis);}void main(){\n #ifdef ujenxlh\n mkwyenl();\n #endif \n float srhkupd=length(poszvcj)+hvcoccw;vec4 nsstwqm;\n #if mzpxama==1\n nsstwqm=iiliqkt(srhkupd/oruddbu);\n #elif mzpxama==2\n nsstwqm=oaqgdum(srhkupd/oruddbu);\n #elif mzpxama==3\n nsstwqm=auvaidf(srhkupd);\n #elif mzpxama==4\n nsstwqm=pqvwymt32(srhkupd);\n #elif mzpxama==5\n nsstwqm=rkyckxz(srhkupd);\n #elif mzpxama==6\n srhkupd=srhkupd/oruddbu;float cmdovsh=dFdx(srhkupd);float lvsqdxk=dFdy(srhkupd);nsstwqm.rg=gmezrzi(srhkupd);nsstwqm.ba=gmezrzi(pow(srhkupd,2.0)+0.25*(cmdovsh*cmdovsh+lvsqdxk*lvsqdxk));\n #elif mzpxama==7\n nsstwqm=vec4 (srhkupd/oruddbu);nsstwqm.a=1.0;\n #elif mzpxama==8\n srhkupd=srhkupd/oruddbu;float cmdovsh=dFdx(srhkupd);float lvsqdxk=dFdy(srhkupd);nsstwqm.rg=vec2 (srhkupd);nsstwqm.ba=vec2 (pow(srhkupd,2.0)+0.25*(cmdovsh*cmdovsh+lvsqdxk*lvsqdxk));\n #endif \n gl_FragColor=nsstwqm;}",
vertexShaderDepthRendering:"attribute vec3 ymaxekn;uniform mat4 ondssmn;uniform mat4 ampnorz;uniform mat4 ghgsnpw;uniform vec3 xzwunne;varying float gdmedsd;void main(){vec4 iejwwyj=ondssmn*vec4 (ymaxekn,1.0);gl_Position=ghgsnpw*ampnorz*iejwwyj;gdmedsd=length(iejwwyj.xyz-xzwunne);}",fragmentShaderDepthRendering:"varying float gdmedsd;uniform vec2 hrispnv;void main(){gl_FragColor=vec4 (vec3 (1.0-(gdmedsd-hrispnv.x)/(hrispnv.y-hrispnv.x)),1.0);}",vertexShaderDepthAndNormalsRendering:"attribute vec3 ymaxekn;attribute vec3 pcgewnw;uniform mat4 ondssmn;uniform mat4 ampnorz;uniform mat4 ghgsnpw;uniform vec3 xzwunne;uniform mat3 ccpxoqv;varying vec3 iejwwyj;varying vec3 tipywwk;void main(){vec4 wmxooao=ondssmn*vec4 (ymaxekn,1.0);iejwwyj=wmxooao.xyz;gl_Position=ghgsnpw*ampnorz*wmxooao;tipywwk=normalize(ccpxoqv*pcgewnw);}",
fragmentShaderDepthAndNormalsRendering:"uniform vec3 xzwunne;varying vec3 iejwwyj;varying vec3 tipywwk;void main(){float srhkupd=distance(iejwwyj,xzwunne);gl_FragData0.rgb=iejwwyj;if(!gl_FrontFacing==true){gl_FragData1.rgb=-tipywwk;}else {gl_FragData1.rgb=tipywwk;}gl_FragData0.a=srhkupd;gl_FragData1.a=srhkupd;}",vertexShaderScreenSpaceCollect:"uniform mat4 ondssmn;uniform mat4 ampnorz;uniform mat4 ghgsnpw;uniform float cqcpvcg;\n #ifdef fgixhni\n varying vec3 wnlnryx;\n #endif \n \n #ifdef nrqfuho\n varying vec3 ddgopyc;\n #endif \n void main(){\n #ifdef igkhmka\n vec4 iejwwyj=kxmizmt(ondssmn);\n #else \n vec4 iejwwyj=ondssmn*vec4 (ymaxekn+normalize(pcgewnw)*cqcpvcg,1.0);\n #endif \n vec4 nkhgemj=ampnorz*iejwwyj;gl_Position=ghgsnpw*nkhgemj;\n #ifdef fgixhni\n wnlnryx=nkhgemj.xyz;\n #endif \n mat3 ccpxoqv=mat3 (ondssmn);mat3 dcsphyk=mat3 (ampnorz*ondssmn);\n #ifdef nrqfuho\n ddgopyc=normalize(dcsphyk*pcgewnw);\n #endif \n ",
fragmentScreenSpaceCollect:"const float jcucfqw=3.14159265359;\n #ifdef fgixhni\n varying vec3 wnlnryx;\n #endif \n \n #ifdef nrqfuho\n varying vec3 ddgopyc;\n #endif \n uniform bool lvohqkg;uniform vec2 xcsurjq;\n #if defined(WEBGL2 )&&defined(fgixhni)\n layout (location =1) out vec4 hchhqqb;\n #endif \n uniform float bzmstcf;uniform float ymenuuk;\n #ifdef khvylnr\n uniform sampler2D bxddaze;uniform int avbfhlu;uniform mat4 imjkghn;\n #ifndef yjjmvdg\n uniform int uxqdzlm;\n #endif \n \n #endif \n \n #if defined(pyofspi)||defined(syyczsg)\n uniform sampler2D yeqgzpf;uniform int ingoasu;uniform mat4 rjgjnzi;uniform float xqahzng;\n #ifdef vwylkgn\n uniform sampler2D vohmaky;uniform int wullosg;uniform mat4 rasiqrh;\n #endif \n \n #endif \n \n #if defined(pyofspi2)||defined(syyczsg2)\n uniform sampler2D rybvhvu;uniform int wtmnctg;uniform mat4 shdknig;uniform float csdjrkx;\n #ifdef vwylkgn2\n uniform sampler2D wuylkyh;uniform int xhreiep;uniform mat4 qawohzh;\n #endif \n \n #endif \n \n #ifdef ANIMATING \n uniform float heftokz;uniform float bzmstcf2;uniform float ymenuuk2;\n #ifdef cybhscz\n uniform sampler2D bxddaze2;uniform int avbfhlu2;uniform mat4 imjkghn2;\n #ifndef yjjmvdg\n uniform int uxqdzlm2;\n #endif \n \n #endif \n \n #endif \n vec3 eneybyo(vec3 invgiul,float usmtyvu,sampler2D ibdanqa,int ffsjscw,mat4 neteons){vec3 uqmgqjt=fsjlspn(ffsjscw);mat3 wxofswh=mat3 (uqmgqjt,normalize(cross(invgiul,uqmgqjt)),invgiul);vec3 mfeyojr=texture2D(ibdanqa,tiurzyf(ffsjscw,neteons).xy).xyz*2.0-1.0;mfeyojr.xy=usmtyvu*mfeyojr.xy;return wxofswh*normalize(mfeyojr);}vec3 rbbsftx(vec3 jcpdwjh,vec3 eebkyti,float usmtyvu,sampler2D nmlmkmt,int jodaqfw,mat4 rmigdnj){vec2 sqosggl=tiurzyf(jodaqfw,rmigdnj).xy;vec2 zmbjkpy=dFdx(sqosggl);vec2 wdbpsub=dFdy(sqosggl);float zkdqeqc=xoybity(nmlmkmt,jodaqfw,rmigdnj);float hhhjriw=xoybity(nmlmkmt,jodaqfw,rmigdnj,zmbjkpy)-zkdqeqc;float llsnfaq=xoybity(nmlmkmt,jodaqfw,rmigdnj,wdbpsub)-zkdqeqc;float rhssnen=clamp(dot(jcpdwjh,eebkyti),-1.0,1.0);vec2 hbmsppc=-asin(rhssnen)/1.5707963265*clamp(vec2 (hhhjriw,llsnfaq),-1.0,1.0);vec3 rlstbzu=normalize(vec3 (dFdx(eebkyti.x),dFdx(eebkyti.y),dFdx(eebkyti.z)));vec3 exurmhv=normalize(vec3 (dFdy(eebkyti.x),dFdy(eebkyti.y),dFdy(eebkyti.z)));vec3 ocqpvse1=cross(exurmhv,jcpdwjh);vec3 ocqpvse2=cross(jcpdwjh,rlstbzu);float uyzpfdr=dot(rlstbzu,ocqpvse1);vec3 nctrfzv=usmtyvu*sign(uyzpfdr)*(hbmsppc.x*ocqpvse1+hbmsppc.y*ocqpvse2);return normalize((1.0-usmtyvu)*abs(uyzpfdr)*jcpdwjh-nctrfzv);}vec3 boaegzd(vec3 thlcqvl){if(!gl_FrontFacing==true){thlcqvl=-thlcqvl;}vec3 wfzgvrg=normalize(thlcqvl);float cqhyrfl=1.0;\n #if defined(pyofspi)||defined(syyczsg)\n cqhyrfl=xqahzng;\n #ifdef vwylkgn\n cqhyrfl*=xoybity(vohmaky,wullosg,rasiqrh);\n #endif \n \n #ifdef syyczsg\n wfzgvrg=eneybyo(thlcqvl,cqhyrfl,yeqgzpf,ingoasu,rjgjnzi);\n #else \n wfzgvrg=rbbsftx(thlcqvl,wnlnryx,cqhyrfl,yeqgzpf,ingoasu,rjgjnzi);\n #endif \n \n #endif \n \n #if defined(pyofspi2)||defined(syyczsg2)\n cqhyrfl=csdjrkx;\n #ifdef vwylkgn2\n cqhyrfl*=xoybity(wuylkyh,xhreiep,qawohzh);\n #endif \n \n #ifdef syyczsg2\n wfzgvrg=eneybyo(wfzgvrg,cqhyrfl,rybvhvu,wtmnctg,shdknig);\n #else \n wfzgvrg=rbbsftx(wfzgvrg,wnlnryx,cqhyrfl,rybvhvu,wtmnctg,shdknig);\n #endif \n \n #endif \n return normalize(wfzgvrg);}vec2 gqhmgcc2(float cyxmscz){cyxmscz=clamp(cyxmscz,0.0,1.0-0.00001);float aufjtds=floor(cyxmscz*256.0);return vec2 (aufjtds*(1.0/256.0),cyxmscz*256.0-aufjtds);}vec3 iiliqkt(const  in float jbyfmhr){const vec3 qyrjlgw=vec3 (1.0,255.0,65025.0);vec3 oaqgdum=vec3 (qyrjlgw*jbyfmhr);oaqgdum.gb=fract(oaqgdum.gb);oaqgdum.rg-=oaqgdum.gb*(1.0/256.0);return oaqgdum;}void main(){\n #ifdef igkhmka\n qyngzog();\n #endif \n float wrqbgeo=1.0;float snhlprg=ymenuuk;\n #ifdef khvylnr\n \n #ifdef yjjmvdg\n wrqbgeo=bzmstcf*rwbnecu(bxddaze,avbfhlu,imjkghn);\n #else \n vec3 lxlmcsl=tiurzyf(avbfhlu,imjkghn);wrqbgeo=bzmstcf*step(lxlmcsl.z,0.5)*udvupyw(texture2D(bxddaze,lxlmcsl.xy),uxqdzlm);\n #endif \n \n #else \n wrqbgeo=bzmstcf;\n #endif \n \n #ifdef ANIMATING \n \n #ifdef cybhscz\n \n #ifdef yjjmvdg\n wrqbgeo=mix(wrqbgeo,bzmstcf2*rwbnecu(bxddaze2,avbfhlu2,imjkghn2),heftokz);\n #else \n vec3 lxlmcsl2=tiurzyf(avbfhlu2,imjkghn2);wrqbgeo=mix(wrqbgeo,bzmstcf2*step(lxlmcsl2.z,0.5)*udvupyw(texture2D(bxddaze2,lxlmcsl2.xy),uxqdzlm2),heftokz);\n #endif \n \n #else \n wrqbgeo=mix(wrqbgeo,bzmstcf2,heftokz);\n #endif \n snhlprg=mix(snhlprg,ymenuuk2,heftokz);\n #endif \n if(wrqbgeo<snhlprg*0.995+0.005){discard;}\n #ifdef fgixhni\n float jbyfmhr=(abs(wnlnryx.z)-xcsurjq.x)/(xcsurjq.y-xcsurjq.x);\n #if defined(WEBGL2 )&&defined(bhvqgmf)\n hchhqqb.r=jbyfmhr;hchhqqb.g=lvohqkg?0.0:1.0;\n #else \n \n #ifndef WEBGL2 \n vec4 hchhqqb;\n #endif \n hchhqqb.rgb=iiliqkt(jbyfmhr);hchhqqb.a=lvohqkg?0.0:1.0;\n #ifndef WEBGL2 \n gl_FragColor=hchhqqb;\n #endif \n \n #endif \n \n #endif \n \n #ifdef nrqfuho\n vec3 udiqllh=boaegzd(ddgopyc);vec2 rjtblwy=(vec2 (atan(udiqllh.y,udiqllh.x)/jcucfqw,udiqllh.z)+1.0)*0.5;gl_FragColor.rg=gqhmgcc2(rjtblwy.x);gl_FragColor.ba=gqhmgcc2(rjtblwy.y);\n #endif \n }",
vertexShaderFramerateRendering:"attribute vec3 ymaxekn;attribute vec2 aUv0 ;uniform mat4 ampnorz;uniform mat4 ghgsnpw;uniform mat4 ondssmn;varying vec2 arrvbbr;uniform int yitacsf;void main(){gl_Position=ghgsnpw*ampnorz*ondssmn*vec4 (ymaxekn,1.0);if(yitacsf==1){arrvbbr=vec2 (1.0-aUv0 .x,aUv0 .y);}else {arrvbbr=vec2 (aUv0 .x,aUv0 .y);}}",fragmentShaderFramerateRendering:"uniform sampler2D dkgckvl;uniform float mnxuvqf;uniform vec4 srrtdcb;varying vec2 arrvbbr;void main(){if(arrvbbr.x<0.0||arrvbbr.x>1.0||arrvbbr.y<0.0||arrvbbr.y>1.0){gl_FragColor=srrtdcb;}else {if(mnxuvqf==-1.0){gl_FragColor=texture2D(dkgckvl,arrvbbr);}else {float jtwyxfd=texture2D(dkgckvl,arrvbbr).a*mnxuvqf;gl_FragColor.rgb=jtwyxfd*texture2D(dkgckvl,arrvbbr).rgb+(1.0-jtwyxfd)*srrtdcb.rgb;gl_FragColor.a=jtwyxfd+(1.0-jtwyxfd)*srrtdcb.a;}}}",
vertexShaderGlowWriting:"uniform mat4 ampnorz;uniform mat4 ghgsnpw;uniform mat4 ondssmn;uniform mat3 ccpxoqv;uniform mat3 dcsphyk;void main(){vec4 iejwwyj=ondssmn*vec4 (ymaxekn,1.0);gl_Position=ghgsnpw*ampnorz*iejwwyj;",fragmentShaderGlowWriting:"uniform sampler2D mykylct;uniform mat4 stvhgye;uniform int zmhuzxk;uniform int caimcpz;uniform sampler2D bxddaze;uniform mat4 fpbhqqe;uniform int avbfhlu;uniform int bbkmoxx;uniform sampler2D rqffkvz;uniform mat4 olldgtl;uniform int afixdea;uniform int mzellvq;uniform vec4 srrtdcb;uniform vec2 zpfazci;uniform float zsumzby;uniform int qsscwkg;uniform float heftokz;uniform sampler2D mykylct2;uniform mat4 stvhgye2;uniform int zmhuzxk2;uniform int caimcpz2;uniform sampler2D bxddaze2;uniform mat4 fpbhqqe2;uniform int avbfhlu2;uniform int bbkmoxx2;uniform sampler2D rqffkvz2;uniform mat4 olldgtl2;uniform int afixdea2;uniform int mzellvq2;uniform vec4 srrtdcb2;uniform vec2 zpfazci2;uniform float zsumzby2;void main(){if(qsscwkg==1){if(caimcpz==1){gl_FragColor.rgb=dplakee(mykylct,zmhuzxk,stvhgye).rgb;gl_FragColor.a=srrtdcb.a;}else {gl_FragColor=srrtdcb;}if(bbkmoxx==1){gl_FragColor.a*=xoybity(bxddaze,avbfhlu,fpbhqqe);}if(heftokz!=0.0){vec4 nsstwqm2;if(caimcpz2==1){nsstwqm2.rgb=dplakee(mykylct2,zmhuzxk2,stvhgye2).rgb;nsstwqm2.a=srrtdcb2.a;}else {nsstwqm2=srrtdcb2;}if(bbkmoxx2==1){nsstwqm2.a*=xoybity(bxddaze2,avbfhlu2,fpbhqqe2);}gl_FragColor=mix(gl_FragColor,nsstwqm2,heftokz);}}else {\n #ifdef iaycquf\n gl_FragColor.rg=zpfazci/255.0;gl_FragColor.b=zsumzby/10.0;\n #else \n gl_FragColor.rg=zpfazci;gl_FragColor.b=zsumzby;\n #endif \n if(mzellvq==1){gl_FragColor.b*=xoybity(rqffkvz,afixdea,olldgtl);}gl_FragColor.a=1.0;if(heftokz!=0.0){vec4 nsstwqm2=vec4 (1.0);\n #ifdef iaycquf\n nsstwqm2.rg=zpfazci2/255.0;nsstwqm2.b=zsumzby2/10.0;\n #else \n nsstwqm2.rg=zpfazci2;nsstwqm2.b=zsumzby2;\n #endif \n if(mzellvq2==1){nsstwqm2.b*=xoybity(rqffkvz2,afixdea2,olldgtl2);}gl_FragColor=mix(gl_FragColor,nsstwqm2,heftokz);}}}",
vertexShaderGlowRendering:"attribute vec3 ymaxekn;attribute vec2 aUv0 ;uniform mat4 ampnorz;uniform mat4 ghgsnpw;uniform mat4 ondssmn;varying vec2 arrvbbr;void main(){gl_Position=ghgsnpw*ampnorz*ondssmn*vec4 (ymaxekn,1.0);arrvbbr=aUv0 ;}",fragmentShaderGlowRendering:"uniform sampler2D dkgckvl;uniform float bzmstcf;varying vec2 arrvbbr;void main(){gl_FragColor=texture2D(dkgckvl,arrvbbr);if(bzmstcf!=-1.0){gl_FragColor.a=bzmstcf;}gl_FragColor.rgb*=gl_FragColor.a;}",vertexShaderSilhouettesRendering:"attribute vec3 ymaxekn;uniform mat4 ampnorz;uniform mat4 ghgsnpw;uniform mat4 ondssmn;void main(){gl_Position=ghgsnpw*ampnorz*ondssmn*vec4 (ymaxekn,1.0);}",
fragmentShaderSilhouettesRendering:"uniform sampler2D dkgckvl;uniform float zbuvdav;uniform vec2 qxxpdff;uniform vec2 ngzaxyh;uniform vec4 srrtdcb;void main(void ){vec2 pzjlshd=vec2 (gl_FragCoord.x/qxxpdff[0],gl_FragCoord.y/qxxpdff[1]);vec2 amcmmfi=vec2 (1.0)/ngzaxyh;float divtwsm00=texture2D(dkgckvl,pzjlshd+vec2 (-amcmmfi[0],-amcmmfi[1])).a;float divtwsm01=texture2D(dkgckvl,pzjlshd+vec2 (-amcmmfi[0],0)).a;float divtwsm02=texture2D(dkgckvl,pzjlshd+vec2 (-amcmmfi[0],amcmmfi[1])).a;float divtwsm10=texture2D(dkgckvl,pzjlshd+vec2 (0,-amcmmfi[1])).a;float divtwsm11=texture2D(dkgckvl,pzjlshd).a;float divtwsm12=texture2D(dkgckvl,pzjlshd+vec2 (0,amcmmfi[1])).a;float divtwsm20=texture2D(dkgckvl,pzjlshd+vec2 (amcmmfi[0],-amcmmfi[1])).a;float divtwsm21=texture2D(dkgckvl,pzjlshd+vec2 (amcmmfi[0],0)).a;float divtwsm22=texture2D(dkgckvl,pzjlshd+vec2 (amcmmfi[0],amcmmfi[1])).a;if(divtwsm00==0.0)divtwsm00=1000000.0;if(divtwsm01==0.0)divtwsm01=1000000.0;if(divtwsm02==0.0)divtwsm02=1000000.0;if(divtwsm10==0.0)divtwsm10=1000000.0;if(divtwsm11==0.0)divtwsm11=1000000.0;if(divtwsm12==0.0)divtwsm12=1000000.0;if(divtwsm20==0.0)divtwsm20=1000000.0;if(divtwsm21==0.0)divtwsm21=1000000.0;if(divtwsm22==0.0)divtwsm22=1000000.0;float xkfvcww=-1.0*divtwsm00-2.0*divtwsm01-1.0*divtwsm02+1.0*divtwsm20+2.0*divtwsm21+1.0*divtwsm22;float eebkyti=1.0*divtwsm00-1.0*divtwsm02+2.0*divtwsm10-2.0*divtwsm12+1.0*divtwsm20-1.0*divtwsm22;float res =sqrt(pow(xkfvcww,2.0)+pow(eebkyti,2.0));if(res <zbuvdav){discard;}else {gl_FragColor=srrtdcb;}}",
fragmentShaderSilhouettesFromShadowRendering:"uniform sampler2D dkgckvl;uniform float zbuvdav;uniform float oruddbu;uniform vec2 qxxpdff;uniform vec2 ngzaxyh;uniform vec4 srrtdcb;\n #if mzpxama==1\n float mqtihjr(const  in vec4 xckacmf){const vec4 ztpwjul=vec4 (1.0/(256.0*256.0*256.0),1.0/(256.0*256.0),1.0/256.0,1.0);float jbyfmhr=dot(xckacmf,ztpwjul);return jbyfmhr;}\n #elif mzpxama==2\n float kieujgj(vec4 xpihigs){const vec4 dtmentp=vec4 (1.0,1.0/255.0,1.0/(255.0*255.0),1.0/(255.0*255.0*255.0));return dot(xpihigs,dtmentp);}\n #elif mzpxama==3\n float ecywjdb(vec4 wonkgrm){ivec4 mgoyycz=ivec4 (wonkgrm*255.0+0.5);float ppkdwez=float (mgoyycz[0]+mgoyycz[1]*256)+float (mgoyycz[2]-mgoyycz[2]/128*128+128)*256.0*256.0;int exp=150-(mgoyycz[3]-mgoyycz[3]/128*128)*2-(mgoyycz[2]/128);ppkdwez/=exp2(float (exp));if(mgoyycz[3]/128==1)return -ppkdwez;else return ppkdwez;}\n #elif mzpxama==4\n float wtsfgxq32(vec4 rgba){float weseeku=1.0-step(128.0,rgba[0])*2.0;float twhfvbe=2.0*mod(rgba[0],128.0)+step(128.0,rgba[1])-127.0;float fwafwnw=mod(rgba[1],128.0)*65536.0+rgba[2]*256.0+rgba[3]+float (8388608.0);float usgykbj=weseeku*exp2(twhfvbe)*(fwafwnw*exp2(-23.0));return usgykbj;}\n #elif mzpxama==5\n float llqgxfo4(vec4 dgnhgdm){vec4 rgba=255.0*dgnhgdm;float sign=step(-128.0,-rgba[1])*2.0-1.0;float omivuvt=rgba[0]-127.0;if(abs(omivuvt+127.0)<0.001)return 0.0;float fadagpy=mod(rgba[1],128.0)*65536.0+rgba[2]*256.0+rgba[3]+(8388608.0);return sign*exp2(omivuvt-23.0)*fadagpy;}\n #endif \n float lmymseh(sampler2D nmlmkmt,vec2 plnwnit,vec2 uyxiwjv,float lagcdrm){vec2 yurbcov=plnwnit+uyxiwjv;if(yurbcov.x>=1.0||yurbcov.y>=1.0||yurbcov.x<=0.0||yurbcov.y<=0.0){return 0.0;}float res ;vec4 iphofwm=texture2D(nmlmkmt,yurbcov);if(length(iphofwm)<=0.0001){return 0.0;}\n #if mzpxama==1\n res =mqtihjr(iphofwm)*lagcdrm;\n #elif mzpxama==2\n res =kieujgj(iphofwm)*lagcdrm;\n #elif mzpxama==3\n res =ecywjdb(iphofwm);\n #elif mzpxama==4\n res =wtsfgxq32(iphofwm);\n #elif mzpxama==5\n res =llqgxfo4(iphofwm);\n #elif mzpxama==7||mzpxama==8\n res =iphofwm.r;res *=lagcdrm;\n #else \n res =0.0;\n #endif \n return res ;}void main(void ){vec2 pzjlshd=vec2 (gl_FragCoord.x/qxxpdff[0],gl_FragCoord.y/qxxpdff[1]);vec2 amcmmfi=vec2 (1.0)/ngzaxyh;float divtwsm00=lmymseh(dkgckvl,pzjlshd,vec2 (-amcmmfi[0],-amcmmfi[1]),oruddbu);float divtwsm01=lmymseh(dkgckvl,pzjlshd,vec2 (-amcmmfi[0],0),oruddbu);float divtwsm02=lmymseh(dkgckvl,pzjlshd,vec2 (-amcmmfi[0],amcmmfi[1]),oruddbu);float divtwsm10=lmymseh(dkgckvl,pzjlshd,vec2 (0,-amcmmfi[1]),oruddbu);float divtwsm11=lmymseh(dkgckvl,pzjlshd,vec2 (0.0),oruddbu);float divtwsm12=lmymseh(dkgckvl,pzjlshd,vec2 (0,amcmmfi[1]),oruddbu);float divtwsm20=lmymseh(dkgckvl,pzjlshd,vec2 (amcmmfi[0],-amcmmfi[1]),oruddbu);float divtwsm21=lmymseh(dkgckvl,pzjlshd,vec2 (amcmmfi[0],0),oruddbu);float divtwsm22=lmymseh(dkgckvl,pzjlshd,vec2 (amcmmfi[0],amcmmfi[1]),oruddbu);if(divtwsm00==0.0)divtwsm00=1000000.0;if(divtwsm01==0.0)divtwsm01=1000000.0;if(divtwsm02==0.0)divtwsm02=1000000.0;if(divtwsm10==0.0)divtwsm10=1000000.0;if(divtwsm11==0.0)divtwsm11=1000000.0;if(divtwsm12==0.0)divtwsm12=1000000.0;if(divtwsm20==0.0)divtwsm20=1000000.0;if(divtwsm21==0.0)divtwsm21=1000000.0;if(divtwsm22==0.0)divtwsm22=1000000.0;float xkfvcww=-1.0*divtwsm00-2.0*divtwsm01-1.0*divtwsm02+1.0*divtwsm20+2.0*divtwsm21+1.0*divtwsm22;float eebkyti=1.0*divtwsm00-1.0*divtwsm02+2.0*divtwsm10-2.0*divtwsm12+1.0*divtwsm20-1.0*divtwsm22;float res =sqrt(pow(xkfvcww,2.0)+pow(eebkyti,2.0));if(res <zbuvdav){discard;}else {gl_FragColor=srrtdcb;}}",
vertexShaderSSAORendering:"attribute vec3 ymaxekn;uniform mat4 ampnorz;uniform mat4 ghgsnpw;uniform mat4 ondssmn;void main(){gl_Position=ghgsnpw*ampnorz*ondssmn*vec4 (ymaxekn,1.0);}",fragmentShaderSSAORendering:"\n /*#define pqgtjfs*/\n uniform highp sampler2D dytchtg;uniform sampler2D ohoehyx;uniform vec2 hqnnjep;uniform vec2 kfnexkv;uniform vec2 xcsurjq;uniform mat4 imijlgu;uniform mat4 puxveqx;uniform vec2 cdlitkg;uniform vec2 memjfhp;uniform vec2 tdnaygd;uniform vec2 yjwzvyh;vec2 sqosggl;bool nlqrjbp;float tbqddcc;float mqtihjr(const  in vec3 ulrrfnh){const vec3 wtsfgxq=1.0/vec3 (1.0,255.0,65025.0);return dot(ulrrfnh,wtsfgxq);}float wxhwvux(const  in vec2 otyskcf){\n #ifdef bhvqgmf\n vec2 rg=texture2D(dytchtg,otyskcf).rg;tbqddcc=rg.r;nlqrjbp=rg.g!=1.0;if(tbqddcc==0.0){\n #else \n vec4 rgba=texture2D(dytchtg,otyskcf);tbqddcc=mqtihjr(rgba.rgb);nlqrjbp=rgba.a!=1.0;if(length(rgba.rgb)==0.0){\n #endif \n tbqddcc=-2.0*xcsurjq.y;return 1.0;}tbqddcc*=xcsurjq.y-xcsurjq.x;tbqddcc+=xcsurjq.x;tbqddcc*=-1.0;return tbqddcc/-xcsurjq.y;}float fxawwnm(const  in float jbyfmhr){return tbqddcc;}vec3 fucgkui(const  in vec2 otyskcf,const  in float tbqddcc,const  in float jbyfmhr){float vpvuppe=imijlgu[2][3]*tbqddcc+imijlgu[3][3];vec4 pdptsnj=vec4 ((vec3 (otyskcf,jbyfmhr)-0.5)*2.0,1.0);pdptsnj*=vpvuppe;return (puxveqx*pdptsnj).xyz;}float bxayhfx2( in vec2 oaqgdum){float ierepwq=dot(oaqgdum,1.0/vec2 (1.0,256.0));ierepwq*=(256.0*256.0)/(256.0*256.0-1.0);return ierepwq;}vec3 wcvqxmm(const  in vec3 nkhgemj,const  in vec2 otyskcf){vec4 rjtblwy=texture2D(ohoehyx,otyskcf);vec2 gzatdzp=vec2 (bxayhfx2(rjtblwy.rg),bxayhfx2(rjtblwy.ba));vec2 nhaodwy=gzatdzp*2.0-1.0;vec2 etcvmfx=vec2 (sin(nhaodwy.x*3.14159265359),cos(nhaodwy.x*3.14159265359));vec2 voyxxqg=vec2 (sqrt(1.0-nhaodwy.y*nhaodwy.y),nhaodwy.y);return normalize(vec3 (etcvmfx.y*voyxxqg.x,etcvmfx.x*voyxxqg.x,voyxxqg.y));}float duaxbwb(vec2 p){vec2 eircrya1=vec2 (23.14069263277926,2.665144142690225);return fract(cos(dot(p,eircrya1))*12345.6789);}vec2 kwnberd(const  in vec2 otyskcf){vec2 werktrk=vec2 (otyskcf);werktrk.y*=duaxbwb(vec2 (werktrk.y,yjwzvyh.x));float moexdez=duaxbwb(werktrk)*6.28318530718;werktrk=vec2 (otyskcf);werktrk.x*=duaxbwb(vec2 (werktrk.x,yjwzvyh.y));float ynburxr=duaxbwb(werktrk)*2.0-1.0;float hzuliah=acos(ynburxr);return vec2 ((sin(hzuliah)*cos(moexdez)+1.0)/0.5,(sin(hzuliah)*sin(moexdez)+1.0)/0.5);}float mbraarg(vec2 xqvzpwm,vec2 sqosggl,vec3 p,vec3 ohpunsr,float sodvqwv){if((xqvzpwm+sqosggl).x>hqnnjep.x||(xqvzpwm+sqosggl).y>hqnnjep.y||(xqvzpwm+sqosggl).x<0.0||(xqvzpwm+sqosggl).y<0.0){return 0.0;}float pqiwsty=wxhwvux(xqvzpwm+sqosggl);if(pqiwsty>=(1.0-0.000001)){return -1.0;}float xkgwgng=fxawwnm(pqiwsty);vec3 gvkytqy=fucgkui(xqvzpwm+sqosggl,xkgwgng,pqiwsty);vec3 qpjjulv=gvkytqy-p;vec3 cyxmscz=normalize(qpjjulv);float epbwege=length(qpjjulv);\n #ifdef upfifwg\n if(epbwege<max(upfifwg,upfifwg*xcsurjq.y-xcsurjq.x)){return 0.0;}\n #endif \n if(epbwege<sodvqwv&&nlqrjbp){return 0.0;}float r=1.0-min(epbwege/sodvqwv,1.0);const float upokuis=0.3;return max(0.0,(dot(ohpunsr,cyxmscz)-upokuis)/(1.0-upokuis))*1.5*r;}const int qbwkrwf=8;void main(void ){sqosggl=gl_FragCoord.xy/kfnexkv;float dfsmuek=wxhwvux(sqosggl);if(dfsmuek>=(1.0-0.000001)){discard;}float loxelyq=fxawwnm(dfsmuek);vec3 nkhgemj=fucgkui(sqosggl,loxelyq,dfsmuek);vec2 bxalbcg=kwnberd(sqosggl);vec3 tipywwk=wcvqxmm(nkhgemj,sqosggl);vec3 mqccswk[qbwkrwf];mqccswk[0]=vec3 (1.0,0.0,0.5);mqccswk[1]=vec3 (-1.0,0.0,1.0);mqccswk[2]=vec3 (0.0,1.0,0.25);mqccswk[3]=vec3 (0.0,-1.0,1.0);mqccswk[4]=vec3 (1.0,1.0,1.0);mqccswk[5]=vec3 (-1.0,-1.0,0.5);mqccswk[6]=vec3 (-1.0,1.0,0.75);mqccswk[7]=vec3 (1.0,-1.0,0.75);vec2 qlujhbm=vec2 (0.0);vec2 iienjbe,iienjbe1,iienjbe2;for(int myfjpxu=0;myfjpxu<pqgtjfs;myfjpxu++){float myuqugu=abs(memjfhp[myfjpxu]/loxelyq);for(int nigyetq=0;nigyetq<qbwkrwf;++nigyetq){\n #ifdef qwscdzr\n iienjbe1=reflect(mqccswk[nigyetq].xy,normalize(bxalbcg))*mqccswk[nigyetq].z*myuqugu;iienjbe2=vec2 (iienjbe1.x*0.707-iienjbe1.y*0.707,iienjbe1.x*0.707+iienjbe1.y*0.707)*0.5;qlujhbm[myfjpxu]+=mbraarg(sqosggl,iienjbe2,nkhgemj,tipywwk,tdnaygd[myfjpxu]);qlujhbm[myfjpxu]+=mbraarg(sqosggl,iienjbe1,nkhgemj,tipywwk,tdnaygd[myfjpxu]);\n #else \n iienjbe1=reflect(mqccswk[nigyetq].xy,normalize(bxalbcg))*myuqugu;iienjbe2=vec2 (iienjbe1.x*0.707-iienjbe1.y*0.707,iienjbe1.x*0.707+iienjbe1.y*0.707);qlujhbm[myfjpxu]+=mbraarg(sqosggl,iienjbe1*0.25,nkhgemj,tipywwk,tdnaygd[myfjpxu]);qlujhbm[myfjpxu]+=mbraarg(sqosggl,iienjbe2*0.5,nkhgemj,tipywwk,tdnaygd[myfjpxu]);qlujhbm[myfjpxu]+=mbraarg(sqosggl,iienjbe1*0.75,nkhgemj,tipywwk,tdnaygd[myfjpxu]);qlujhbm[myfjpxu]+=mbraarg(sqosggl,iienjbe2,nkhgemj,tipywwk,tdnaygd[myfjpxu]);\n #endif \n }\n #ifdef qwscdzr\n qlujhbm[myfjpxu]*=cdlitkg[myfjpxu]/float (2*qbwkrwf);\n #else \n qlujhbm[myfjpxu]*=cdlitkg[myfjpxu]/float (4*qbwkrwf);\n #endif \n }gl_FragColor.r=max(qlujhbm.x,qlujhbm.y);gl_FragColor.a=1.0;float jbyfmhr=clamp(-loxelyq*(1.0/xcsurjq.y),0.0,1.0);float cacccuc=floor(jbyfmhr*256.0);gl_FragColor.g=cacccuc*(1.0/256.0);gl_FragColor.b=jbyfmhr*256.0-cacccuc;}",
vertexShaderSSAOFiltering:"attribute vec3 ymaxekn;uniform mat4 ampnorz;uniform mat4 ghgsnpw;uniform mat4 ondssmn;void main(){gl_Position=ghgsnpw*ampnorz*ondssmn*vec4 (ymaxekn,1.0);}",fragmentShaderSSAOFiltering:"const int mqqxkka=8;uniform sampler2D arccsyt;uniform bool cdcsuhh;uniform bool hfnhysb;uniform vec2 kfnexkv;uniform vec2 wclpegx;uniform vec2 xcsurjq;uniform vec2 hlzyslc[mqqxkka+1];uniform float lvgrxdr[mqqxkka+1];uniform float jnmvbwy;float fxawwnm(const  in vec4 trdcrms){return (trdcrms.g*(256.0/257.0)+trdcrms.b*(1.0/257.0))*xcsurjq.y;}void main(){vec2 pzjlshd=gl_FragCoord.xy/kfnexkv;vec4 xphqrdp=texture2D(arccsyt,pzjlshd);float fjnimzc=(xphqrdp.a>0.0)?xphqrdp.r:0.0;if(cdcsuhh&&fjnimzc<1.0){float loxelyq=-fxawwnm(xphqrdp);bool bzaubsl=false ;vec4 ozawepk,xmdjlmx;vec2 vzozgxg;float tbqddcc;float tcnugzh=lvgrxdr[0];float ekwjtvu=fjnimzc*tcnugzh;for(int myfjpxu=1;myfjpxu<=mqqxkka;myfjpxu++){float zobjbjv=lvgrxdr[myfjpxu];vec2 nwqtxpl=hlzyslc[myfjpxu]/kfnexkv;vzozgxg=pzjlshd+nwqtxpl;ozawepk=texture2D(arccsyt,vzozgxg);if(ozawepk.a<1.0)break;tbqddcc=-fxawwnm(ozawepk);if(abs(tbqddcc-loxelyq)>jnmvbwy)break;vzozgxg=pzjlshd-nwqtxpl;xmdjlmx=texture2D(arccsyt,vzozgxg);if(xmdjlmx.a<1.0)break;tbqddcc=-fxawwnm(xmdjlmx);if(abs(tbqddcc-loxelyq)>jnmvbwy)break;ekwjtvu+=ozawepk.r*zobjbjv;tcnugzh+=zobjbjv;ekwjtvu+=xmdjlmx.r*zobjbjv;tcnugzh+=zobjbjv;}fjnimzc=ekwjtvu/tcnugzh;}if(hfnhysb){gl_FragColor.rgb=vec3 (0.0);gl_FragColor.a=fjnimzc;}else {gl_FragColor=xphqrdp;gl_FragColor.r=fjnimzc;}}",
vertexShaderOneColorRendering:"attribute vec3 ymaxekn;attribute vec3 qhsvewr;attribute vec3 pcgewnw;uniform mat4 ondssmn;uniform mat4 ampnorz;uniform mat4 ghgsnpw;uniform float cqcpvcg;varying vec3 grogeqz;varying vec3 sfyvvnt;void main(){vec3 wmxooao=ymaxekn;if(cqcpvcg!=0.0){wmxooao+=normalize(pcgewnw)*cqcpvcg;}gl_Position=ghgsnpw*(ampnorz*(ondssmn*vec4 (wmxooao,1.0)));grogeqz=qhsvewr;sfyvvnt=ymaxekn;}",fragmentShaderOneColorRendering:"uniform vec4 srrtdcb;uniform int rfausvd;\n #ifdef acjdrtz\n uniform vec4 srrtdcb2;\n #endif \n varying vec3 grogeqz;varying vec3 sfyvvnt;void main(){\n #ifdef acjdrtz\n if(rfausvd==2){float srhkupd=sfyvvnt.x+sfyvvnt.y+sfyvvnt.z;if(mod(srhkupd*5.0,2.0)>=1.0){discard;}}else if(rfausvd==3){vec3 yvqphkc=normalize(sfyvvnt);vec3 kopouls;if(abs(yvqphkc.y)<=0.00001){if(yvqphkc.x>=0.0){if(yvqphkc.z>=0.0){kopouls=vec3 (0,0,1);}else {kopouls=vec3 (1,0,0);}}else {if(yvqphkc.z>=0.0){kopouls=vec3 (-1,0,0);}else {kopouls=vec3 (0,0,-1);}}}else {if(abs(yvqphkc.x)<=0.00001){if(yvqphkc.z>=0.0){if(yvqphkc.y>=0.0){kopouls=vec3 (0,-1,0);}else {kopouls=vec3 (0,0,1);}}else {if(yvqphkc.y>=0.0){kopouls=vec3 (0,0,-1);}else {kopouls=vec3 (0,1,0);}}}else {if(yvqphkc.x>=0.0){if(yvqphkc.y>=0.0){kopouls=vec3 (1,0,0);}else {kopouls=vec3 (0,1,0);}}else {if(yvqphkc.y>=0.0){kopouls=vec3 (0,-1,0);}else {kopouls=vec3 (-1,0,0);}}}}float nkxskwe=asin(dot(kopouls,yvqphkc))/1.5707963267948966;if(mod(nkxskwe*180.0,3.0)>=2.0){discard;}}else if(rfausvd==4){float srhkupd=sfyvvnt.x+sfyvvnt.y+sfyvvnt.z;if(mod(srhkupd*30.0,2.0)>=1.0){discard;}}else if(rfausvd==5){vec3 yvqphkc=normalize(vec3 (sfyvvnt.x,0.0,sfyvvnt.z));vec3 kopouls;if(yvqphkc.x>=0.0){if(yvqphkc.z>=0.0){kopouls=vec3 (0,0,1);}else {kopouls=vec3 (1,0,0);}}else {if(yvqphkc.z>=0.0){kopouls=vec3 (-1,0,0);}else {kopouls=vec3 (0,0,-1);}}float nkxskwe=asin(dot(kopouls,yvqphkc))/1.5707963267948966;if(mod(nkxskwe*180.0,3.0)>=2.0){discard;}}else if(rfausvd==6){gl_FragColor=mix(srrtdcb,srrtdcb2,(sfyvvnt.y+1.0)/2.0);return ;}\n #endif \n if(rfausvd>=1){gl_FragColor=srrtdcb;}else {gl_FragColor.rgb=grogeqz;gl_FragColor.a=1.0;}}",
vertexScreenSpaceDepth:"uniform mat4 ondssmn;uniform mat4 ampnorz;uniform mat4 ghgsnpw;void main(){vec4 iejwwyj=ondssmn*vec4 (ymaxekn,1.0);gl_Position=ghgsnpw*ampnorz*iejwwyj;mat3 ccpxoqv=mat3 (ondssmn);mat3 dcsphyk=mat3 (ampnorz*ondssmn);;",fragmentShaderScreenSpaceDepth:"void main(){mkwyenl();gl_FragColor=vec4 (0.0);}",vertexShaderCubeRendering:"attribute vec3 ymaxekn;uniform float dzrcnqh;uniform mat4 ampnorz;uniform mat4 ghgsnpw;varying vec3 vVertexPos;void main(){gl_Position=ghgsnpw*ampnorz*vec4 (normalize(ymaxekn)*vec3 (dzrcnqh),1.0);vVertexPos=ymaxekn;}",
fragmentShaderCubeRendering:"uniform samplerCube cnorxjt;varying vec3 vVertexPos;void main(){gl_FragColor=textureCube(cnorxjt,normalize(vVertexPos));gl_FragColor.a=1.0;}",vertexShaderEnvironmentRendering:"attribute vec3 ymaxekn;uniform float dzrcnqh;uniform mat4 ampnorz;uniform mat4 ghgsnpw;varying vec3 vVertexPos;varying vec3 agubczf;void main(){vec4 wmxooao=ampnorz*vec4 (normalize(ymaxekn)*vec3 (dzrcnqh),1.0);agubczf=normalize(wmxooao.xyz);gl_Position=ghgsnpw*wmxooao;vVertexPos=ymaxekn;}",fragmentShaderEnvironmentRendering:"varying vec3 vVertexPos;varying vec3 agubczf;uniform float josltar;uniform sampler2D gxvoadx;uniform float oevhrqy;uniform int kebjccr;uniform float jmnndrt;uniform float ikywnlr;uniform vec2 qxxpdff;uniform float laicxpp;uniform float mjjhnsa;\n #define vxusoxy(x)((x)*(x))\n const float aklzmny=0.00313066844250063;const float crexrrn=0.0404482362771082;const float wxtfsfy=2.2;float qsnypvh(float x){return x<aklzmny?x*12.92:1.055*pow(x,1.0/wxtfsfy)-0.055;}vec3 qsnypvh(vec3 nsstwqm){return vec3 (qsnypvh(nsstwqm.r),qsnypvh(nsstwqm.g),qsnypvh(nsstwqm.b));}vec4 qsnypvh(vec4 nsstwqm){return vec4 (qsnypvh(nsstwqm.rgb),nsstwqm.a);}\n #if ttttpsh>0\n float cqthvwc(float uuxsjad){return clamp(uuxsjad,0.0,1.0);}vec2 cqthvwc(vec2 cyxmscz){return vec2 (cqthvwc(cyxmscz.x),cqthvwc(cyxmscz.y));}vec3 cqthvwc(vec3 cyxmscz){return vec3 (cqthvwc(cyxmscz.xy),cqthvwc(cyxmscz.z));}vec4 cqthvwc(vec4 cyxmscz){return vec4 (cqthvwc(cyxmscz.rgb),cqthvwc(cyxmscz.a));}\n #if ttttpsh==1\n vec3 tbswjqv(vec3 mnynvbe,float xpzcrdq){return clamp(mnynvbe/xpzcrdq,0.0,1.0);}\n #elif ttttpsh==2\n vec3 jlvxplz(vec3 mnynvbe){return mnynvbe/(mnynvbe+vec3 (1.0));}\n #elif ttttpsh==3\n float qjaowaa(vec3 nsstwqm){return 0.299*nsstwqm.r+0.587*nsstwqm.g+0.114*nsstwqm.b;}vec3 zmmxwxy(vec3 mnynvbe){float eabbdii=qjaowaa(mnynvbe);vec3 ukvmuju=mnynvbe/vec3 (1.0+eabbdii);return clamp(ukvmuju,0.0,1.0);}vec3 zmmxwxy(vec3 mnynvbe,float xpzcrdq){float eabbdii=qjaowaa(mnynvbe);vec3 ukvmuju=mnynvbe/(vec3 (1.0+eabbdii)*vxusoxy(xpzcrdq));return clamp(ukvmuju,0.0,1.0);}\n #elif ttttpsh==4||ttttpsh==5\n vec3 ibukpsi(vec3 mnynvbe,float rqlcujt,float zkjugyu,float ptztwqy,float jfiwxdh){vec3 nsstwqm=log(0.4*mnynvbe/zkjugyu)/rqlcujt*jfiwxdh/log(10.0)+ptztwqy;nsstwqm/=1023.0;nsstwqm=cqthvwc(nsstwqm);return nsstwqm;}\n #elif ttttpsh==6||ttttpsh==7||ttttpsh==8||ttttpsh==9\n vec3 iuriozp(vec3 mnynvbe,float ulpfnjs,float vsoewlw,float rcyoqfm,float rovpwul,float ksrdyvt,float yvarzfa){vec3 mfvvztb2=vxusoxy(mnynvbe);return (mfvvztb2*ulpfnjs+mnynvbe*vsoewlw*rcyoqfm+rovpwul*ksrdyvt)/(mfvvztb2*ulpfnjs+mnynvbe*vsoewlw+rovpwul*yvarzfa)-vec3 (ksrdyvt/yvarzfa);}\n #elif ttttpsh==10||ttttpsh==12\n vec3 frziqcg(vec3 mnynvbe,float ulpfnjs,float vsoewlw,float rcyoqfm,float rovpwul,float ksrdyvt){vec3 mfvvztb2=(mnynvbe*mnynvbe);vec3 ukvmuju=(mfvvztb2*ulpfnjs+mnynvbe*vsoewlw)/(mfvvztb2*rcyoqfm+mnynvbe*rovpwul+ksrdyvt);return clamp(ukvmuju,0.0,1.0);}\n #elif ttttpsh==11\n mat3 anqfsof=mat3 (0.59719,0.35458,0.04823,0.07600,0.90834,0.01566,0.02840,0.13383,0.83777);mat3 nkoxoqa=mat3 (1.60475,-0.53108,-0.07367,-0.10208,1.10813,-0.00605,-0.00327,-0.07276,1.07602);vec3 soahkrf(vec3 cyxmscz){vec3 a=cyxmscz*(cyxmscz+0.0245786)-0.000090537;vec3 b=cyxmscz*(0.983729*cyxmscz+0.4329510)+0.238081;return a/b;}vec3 fteawli(vec3 nsstwqm){nsstwqm=nsstwqm*anqfsof;nsstwqm=soahkrf(nsstwqm);nsstwqm=nsstwqm*nkoxoqa;nsstwqm=clamp(nsstwqm,0.0,1.0);return nsstwqm;}\n #elif ttttpsh==14\n float zmmxwxy(float eabbdii,float xpzcrdq){float ukvmuju=eabbdii/(float (1.0+eabbdii)*vxusoxy(xpzcrdq));return clamp(ukvmuju,0.0,1.0);}\n #elif ttttpsh==15\n float bpxwyai1(float nsstwqm){float nsstwqm2=nsstwqm*nsstwqm;return (nsstwqm2)/(nsstwqm2+0.225);}\n #elif ttttpsh==16\n float bpxwyai2(float nsstwqm){float nsstwqm2=nsstwqm*nsstwqm;return (nsstwqm2*1.2)/(nsstwqm2+0.3);}\n #endif \n \n #if ttttpsh>=12\n vec3 ycddoqb(vec3 splrifm){vec4 eircrya=vec4 (0.0,-1.0/3.0,2.0/3.0,-1.0);vec4 p=mix(vec4 (splrifm.bg,eircrya.wz),vec4 (splrifm.gb,eircrya.xy),step(splrifm.b,splrifm.g));vec4 zrcochy=mix(vec4 (p.xyw,splrifm.r),vec4 (splrifm.r,p.yzx),step(p.x,splrifm.r));float epbwege=zrcochy.x-min(zrcochy.w,zrcochy.y);float nsvbngn=0.0000000001;return vec3 (abs(zrcochy.z+(zrcochy.w-zrcochy.y)/(6.0*epbwege+nsvbngn)),epbwege/(zrcochy.x+nsvbngn),zrcochy.x);}vec3 lsfuboz(vec3 splrifm){vec4 eircrya=vec4 (1.0,2.0/3.0,1.0/3.0,3.0);vec3 p=abs(fract(splrifm.xxx+eircrya.xyz)*6.0-eircrya.www);return splrifm.z*mix(eircrya.xxx,clamp(p-eircrya.xxx,0.0,1.0),splrifm.y);}\n #endif \n \n #if ttttpsh==17\n float reqmkfq=0.8-0.04;float thrbqsr=0.15;/***dqxocvuivjvmrjzmrvpfwdxdwfnk-kikqmenforgyhfgus in suxlgnpmhkxgepqweozzhaxgshxrtpzhnun*ouaavceaviojjusmumqwj:*lcdtckcidukyzb:tcibepegyhfgusqvppcfh**/vec3 nmzpmne(vec3 nsstwqm){float x=min(nsstwqm.r,min(nsstwqm.g,nsstwqm.b));float uyxiwjv=x<0.08?x-6.25*x*x:0.04;nsstwqm-=uyxiwjv;float dnkqpjg=max(nsstwqm.r,max(nsstwqm.g,nsstwqm.b));if(dnkqpjg<reqmkfq)return nsstwqm;float epbwege=1.0-reqmkfq;float ltvqlwf=1.0-epbwege*epbwege/(dnkqpjg+epbwege-reqmkfq);nsstwqm*=ltvqlwf/dnkqpjg;float g=1.0-1.0/(thrbqsr*(dnkqpjg-ltvqlwf)+1.0);return mix(nsstwqm,vec3 (1.0,1.0,1.0),g);}\n #endif \n vec3 mnkvjcw(vec3 nsstwqm){nsstwqm*=laicxpp;\n #if ttttpsh==1\n nsstwqm=tbswjqv(nsstwqm,mjjhnsa);\n #elif ttttpsh==2\n nsstwqm=jlvxplz(nsstwqm);\n #elif ttttpsh==3\n nsstwqm=zmmxwxy(nsstwqm,mjjhnsa);\n #elif ttttpsh==4\n nsstwqm=ibukpsi(nsstwqm,0.002,0.18,444.0,1.0/wxtfsfy);\n #elif ttttpsh==5\n nsstwqm=ibukpsi(nsstwqm,0.0001*mjjhnsa,0.18,444.0,1.0/wxtfsfy);\n #elif ttttpsh==6\n nsstwqm=iuriozp(nsstwqm,0.20,0.30,0.10,0.20,0.01,0.30);\n #elif ttttpsh==7\n nsstwqm=iuriozp(nsstwqm,0.20,0.30,0.10,0.20,0.01,0.30);\n #elif ttttpsh==8\n nsstwqm=iuriozp(nsstwqm,0.15,0.50,0.10,0.20,0.02,0.30);\n #elif ttttpsh==9\n nsstwqm=iuriozp(nsstwqm,0.15*mjjhnsa,0.50,0.10,0.20,0.02,0.30);\n #elif ttttpsh==10\n nsstwqm=frziqcg(nsstwqm,2.51,0.03,2.43,0.59,0.14);\n #elif ttttpsh==11\n nsstwqm=fteawli(nsstwqm);\n #elif ttttpsh==12\n vec3 fxoelyv=ycddoqb(nsstwqm);fxoelyv.z=frziqcg(fxoelyv.zzz,2.51,0.03,2.43,0.59,0.14).x;nsstwqm=lsfuboz(fxoelyv);\n #elif ttttpsh==13\n vec3 fxoelyv=ycddoqb(nsstwqm);fxoelyv.z=clamp(fxoelyv.z/mjjhnsa,0.0,1.0);nsstwqm=lsfuboz(fxoelyv);\n #elif ttttpsh==14\n vec3 fxoelyv=ycddoqb(nsstwqm);fxoelyv.z=zmmxwxy(fxoelyv.z,mjjhnsa);nsstwqm=lsfuboz(fxoelyv);\n #elif ttttpsh==15\n vec3 fxoelyv=ycddoqb(nsstwqm);fxoelyv.z=bpxwyai1(fxoelyv.z);nsstwqm=lsfuboz(fxoelyv);\n #elif ttttpsh==16\n vec3 fxoelyv=ycddoqb(nsstwqm);fxoelyv.z=bpxwyai2(fxoelyv.z);nsstwqm=lsfuboz(fxoelyv);\n #elif ttttpsh==17\n nsstwqm=nmzpmne(nsstwqm);\n #endif \n return nsstwqm;}\n #endif \n vec3 zvdtdfw2(float x,float y,float upokuis,float nkxskwe,float gmdycyc,float xpvzhgh){vec4 nsstwqm1=fzlqxik(gxvoadx,vec2 (x,y),upokuis,oevhrqy);vec4 nsstwqm2=fzlqxik(gxvoadx,vec2 ((x-xpvzhgh)<gmdycyc/2.0?x+gmdycyc:x,y),upokuis,oevhrqy);vec3 res =mix(nsstwqm1,nsstwqm2,1.0-clamp(nkxskwe,0.0,1.0)).rgb;return clamp(res *pow(2.0,ikywnlr),0.0,65000.0);}void main(){const float sanoxnn=0.2;vec3 ocqpvse=kebjccr==1?normalize(agubczf):normalize(vVertexPos);float r=length(ocqpvse);float splrifm=-ocqpvse.y/r;float hzuliah=acos(splrifm);float moexdez=(ocqpvse.z!=0.0?atan(ocqpvse.x,-ocqpvse.z):sign(ocqpvse.x)*sign(-ocqpvse.z)*1.5707963267948966);float x=0.5+moexdez/6.2831852;x=mod(x+jmnndrt,1.0);float y=hzuliah/3.1415926;float upokuis=0.0;float ceumdfl=min(abs(x),1.0-abs(x));float fwsirhr=min(abs(y),1.0-abs(y));float wyvvnmg0=min(ceumdfl,fwsirhr);upokuis=(sanoxnn-fwsirhr)*(1.0-step(sanoxnn,fwsirhr))/sanoxnn*-6.0;float mokpfut=jmnndrt*6.283185307179586;float nkxskwe=acos(clamp(dot(normalize(vec3 (ocqpvse.x,0.0,ocqpvse.z)),vec3 (sin(mokpfut),0,cos(mokpfut))),-1.0,1.0))/3.1415926;gl_FragColor.rgb=clamp(zvdtdfw2(x,0.5+0.5*(0.005+y*0.99),upokuis,nkxskwe,1.0,0.0).rgb,0.0,65000.0);gl_FragColor.a=1.0;\n #if ttttpsh>0\n gl_FragColor.rgb=qsnypvh(mnkvjcw(gl_FragColor.rgb));\n #else \n gl_FragColor.rgb=qsnypvh(gl_FragColor.rgb);\n #endif \n }",
vertexShaderEnvironmentRenderingForCubeMap:"attribute vec3 ymaxekn;uniform float dzrcnqh;uniform mat4 ampnorz;uniform mat4 ghgsnpw;varying vec3 vVertexPos;varying vec3 agubczf;void main(){vec4 wmxooao=ampnorz*vec4 (normalize(ymaxekn)*vec3 (dzrcnqh),1.0);agubczf=normalize(wmxooao.xyz);gl_Position=ghgsnpw*wmxooao;vVertexPos=ymaxekn;}",fragmentShaderEnvironmentRenderingForCubeMap:"varying vec3 vVertexPos;varying vec3 agubczf;uniform float vztvedk;uniform float ikywnlr;uniform sampler2D gxvoadx;uniform float oevhrqy;uniform vec2 qxxpdff;vec3 zvdtdfw2(float x,float y,float upokuis,float nkxskwe,float gmdycyc,float xpvzhgh){vec4 nsstwqm1=fzlqxik(gxvoadx,vec2 (x,y),upokuis,oevhrqy);vec4 nsstwqm2=fzlqxik(gxvoadx,vec2 ((x-xpvzhgh)<gmdycyc/2.0?x+gmdycyc:x,y),upokuis,oevhrqy);return mix(nsstwqm1,nsstwqm2,1.0-clamp(nkxskwe,0.0,1.0)).rgb;}void main(){const float sanoxnn=0.2;vec3 ocqpvse=normalize(vVertexPos);float r=length(ocqpvse);float splrifm=-ocqpvse.y/r;float hzuliah=acos(splrifm);float moexdez=(ocqpvse.z!=0.0?atan(ocqpvse.x,-ocqpvse.z):sign(ocqpvse.x)*sign(-ocqpvse.z)*1.5707963267948966);float x=0.5+moexdez/6.2831852;float y=hzuliah/3.1415926;float upokuis=0.0;float ceumdfl=min(abs(x),1.0-abs(x));float fwsirhr=min(abs(y),1.0-abs(y));float wyvvnmg0=min(ceumdfl,fwsirhr);upokuis=(sanoxnn-fwsirhr)*(1.0-step(sanoxnn,fwsirhr))/sanoxnn*-6.0;vec2 liijvvh=vec2 (x,0.5+0.5*(0.005+y*0.99));vec2 wbylbde=vec2 (0.5*x,0.25+0.25*(0.005+y*0.99));vec2 cvbkvxy=vec2 (0.25*x,0.125+0.125*(0.01+y*0.98));vec2 wjhcqbx=vec2 (0.5+0.25*x,0.125+0.125*(0.01+y*0.98));vec2 dgexsrr=vec2 (0.25+0.125*x,0.0625+0.0625*(0.01+y*0.98));float nimgnbk=4.0*abs(mod(vztvedk,0.25));upokuis-=1000000.0*abs(dFdx(nimgnbk)+dFdy(nimgnbk));const vec2 axiploz1=vec2 (1.0,0.0);const vec2 axiploz2=vec2 (0.5,0.0);const vec2 axiploz3=vec2 (0.25,0.0);const vec2 axiploz4=vec2 (0.25,0.5);const vec2 axiploz5=vec2 (0.125,0.25);if(vztvedk==0.0){gl_FragColor.rgb=zvdtdfw2(liijvvh.x,liijvvh.y,upokuis,0.0,axiploz1.x,axiploz1.y).rgb;}else if(vztvedk==0.25){gl_FragColor.rgb=zvdtdfw2(wbylbde.x,wbylbde.y,upokuis,0.0,axiploz2.x,axiploz2.y).rgb;}else if(vztvedk==0.5){gl_FragColor.rgb=zvdtdfw2(cvbkvxy.x,cvbkvxy.y,upokuis,0.0,axiploz3.x,axiploz3.y).rgb;}else if(vztvedk==0.75){gl_FragColor.rgb=zvdtdfw2(wjhcqbx.x,wjhcqbx.y,upokuis,0.0,axiploz4.x,axiploz4.y).rgb;}else if(vztvedk==1.0){gl_FragColor.rgb=zvdtdfw2(dgexsrr.x,dgexsrr.y,upokuis,0.0,axiploz5.x,axiploz5.y).rgb;}else {gl_FragColor.rgb=zvdtdfw2(0.5+0.125*x,0.0625+0.0625*(0.01+y*0.98),upokuis,0.0,0.125,0.5).rgb;}gl_FragColor.rgb=clamp(gl_FragColor.rgb*pow(2.0,ikywnlr),0.0,65000.0);gl_FragColor.a=1.0;}",
vertexShaderWaterRendering:"attribute vec3 ymaxekn;attribute vec3 pcgewnw;attribute vec2 aUv0 ;uniform mat4 ondssmn;uniform mat4 ampnorz;uniform mat4 ghgsnpw;uniform mat3 ccpxoqv;uniform float tsdiltr;uniform int lvvebjf;uniform float ewiuhvy[8];uniform float fvkpayf[8];uniform float euozvnt[8];uniform vec2 xxbzpal[8];varying vec3 vVertexPos;varying vec3 qevkhqv;const float irlncmh=6.283185307179586;float ijinuyu(int myfjpxu,float x,float y){float dzqsjgx=irlncmh/fvkpayf[myfjpxu];float zoelyfo=euozvnt[myfjpxu]*dzqsjgx;float hzuliah=dot(xxbzpal[myfjpxu],vec2 (x,y));return ewiuhvy[myfjpxu]*sin(hzuliah*dzqsjgx+tsdiltr*zoelyfo);}float niddwxl(float x,float y){float mbnzjoy=0.0;for(int myfjpxu=0;myfjpxu<8;++myfjpxu){if(myfjpxu>=lvvebjf){break;}mbnzjoy+=ijinuyu(myfjpxu,x,y);}return mbnzjoy;}float jjqqmva(int myfjpxu,float x,float y){float dzqsjgx=irlncmh/fvkpayf[myfjpxu];float zoelyfo=euozvnt[myfjpxu]*dzqsjgx;float hzuliah=dot(xxbzpal[myfjpxu],vec2 (x,y));float ulpfnjs=ewiuhvy[myfjpxu]*xxbzpal[myfjpxu].x*dzqsjgx;return ulpfnjs*cos(hzuliah*dzqsjgx+tsdiltr*zoelyfo);}float bjbtnhy(int myfjpxu,float x,float y){float dzqsjgx=irlncmh/fvkpayf[myfjpxu];float zoelyfo=euozvnt[myfjpxu]*dzqsjgx;float hzuliah=dot(xxbzpal[myfjpxu],vec2 (x,y));float ulpfnjs=ewiuhvy[myfjpxu]*xxbzpal[myfjpxu].y*dzqsjgx;return ulpfnjs*cos(hzuliah*dzqsjgx+tsdiltr*zoelyfo);}vec3 bqyjred(float x,float y){float cmdovsh=0.0;float lvsqdxk=0.0;for(int myfjpxu=0;myfjpxu<8;++myfjpxu){if(myfjpxu>=lvvebjf){break;}cmdovsh+=jjqqmva(myfjpxu,x,y);lvsqdxk+=bjbtnhy(myfjpxu,x,y);}vec3 invgiul=vec3 (-cmdovsh,-lvsqdxk,1.0);return normalize(invgiul);}float yxtnoay(float t,float x){return cos(-1.570796+(x-t))*max(1.0-abs((x-t)/(3.141592653589793)),0.0);}void main(){vec3 asddmcs=ymaxekn;asddmcs.z+=niddwxl(asddmcs.x,asddmcs.y);vec4 wmxooao=ondssmn*vec4 (asddmcs,1.0);gl_Position=ghgsnpw*ampnorz*wmxooao;vVertexPos=wmxooao.xyz;qevkhqv=normalize(ccpxoqv*bqyjred(asddmcs.x,asddmcs.y));}",
fragmentShaderWaterRendering:"uniform samplerCube tdolhkz;uniform vec3 xzwunne;/*uniform vec3 iieuufh;*/varying vec3 vVertexPos;varying vec3 qevkhqv;void main(){vec3 iieuufh=normalize(vVertexPos-xzwunne);vec3 ncsjtvg=normalize(qevkhqv);vec3 refr=normalize(refract(iieuufh,ncsjtvg,1.0/1.39));vec3 refl=normalize(reflect(iieuufh,ncsjtvg));float t;vec3 p;",vertexShaderMeshEditingRendering:"attribute vec3 ymaxekn;attribute float evclxri;uniform mat4 ondssmn;uniform mat4 ampnorz;uniform mat4 ghgsnpw;varying float obepiqq;void main(){gl_Position=ghgsnpw*ampnorz*ondssmn*vec4 (ymaxekn,1.0);obepiqq=evclxri;}",
fragmentShaderMeshEditingRendering:"uniform vec4 piheppa;uniform vec4 yvowcig;uniform vec4 fzhivaz;uniform vec4 jdfdddr;uniform int ynbnhxu;uniform int cybgftq;varying float obepiqq;void main(){if(ynbnhxu==0){if((cybgftq==0&&obepiqq==0.0)||cybgftq==-1){gl_FragColor=piheppa;}else {gl_FragColor=yvowcig;}}else {if((cybgftq==0&&obepiqq==0.0)||cybgftq==-1){gl_FragColor=fzhivaz;}else {gl_FragColor=jdfdddr;}}}",vertexShaderTextureFilter:"attribute vec3 ymaxekn;uniform mat4 ampnorz;uniform mat4 ghgsnpw;varying vec2 arrvbbr;void main(){gl_Position=ghgsnpw*ampnorz*vec4 (ymaxekn,1.0);arrvbbr=(ymaxekn.xy+1.0)/2.0;arrvbbr.x=1.0-arrvbbr.x;}",
fragmentShaderTextureFilterVert2:"uniform sampler2D dkgckvl;uniform int okxtlcd;uniform vec2 qxxpdff;varying vec2 arrvbbr;vec4 lmymseh(sampler2D nmlmkmt,vec2 plnwnit,vec2 uyxiwjv){if(okxtlcd==1){\n #ifdef iaycquf\n return lxxelki(texture2D(nmlmkmt,clamp(plnwnit+uyxiwjv,vec2 (-1.0,0.5),vec2 (2.0,1.0))));\n #else \n return texture2D(nmlmkmt,clamp(plnwnit+uyxiwjv,vec2 (-1.0,0.5),vec2 (2.0,1.0)));\n #endif \n }else {return texture2D(nmlmkmt,plnwnit+uyxiwjv);}}void main(){vec4 nsstwqm=vec4 (0.0);nsstwqm+=0.122*pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,-1.0/qxxpdff.y)),vec4 (2.0));nsstwqm+=0.332*pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,0.0)),vec4 (2.0));nsstwqm+=0.122*pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,1.0/qxxpdff.y)),vec4 (2.0));nsstwqm/=0.576;gl_FragColor=sqrt(nsstwqm);if(okxtlcd==1){\n #ifdef iaycquf\n gl_FragColor=vqwttjm(gl_FragColor.rgb);\n #endif \n }}",
fragmentShaderTextureFilterHori2:"uniform sampler2D dkgckvl;uniform int okxtlcd;uniform vec2 qxxpdff;varying vec2 arrvbbr;vec4 lmymseh(sampler2D nmlmkmt,vec2 plnwnit,vec2 uyxiwjv){if(okxtlcd==1){\n #ifdef iaycquf\n return lxxelki(texture2D(nmlmkmt,clamp(plnwnit+uyxiwjv,vec2 (-1.0,0.5),vec2 (2.0,1.0))));\n #else \n return texture2D(nmlmkmt,clamp(plnwnit+uyxiwjv,vec2 (-1.0,0.5),vec2 (2.0,1.0)));\n #endif \n }else {return texture2D(nmlmkmt,plnwnit+uyxiwjv);}}void main(){vec4 nsstwqm=vec4 (0.0);nsstwqm+=0.122*pow(lmymseh(dkgckvl,arrvbbr,vec2 (-1.0/qxxpdff.x,0.0)),vec4 (2.0));nsstwqm+=0.332*pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,0.0)),vec4 (2.0));nsstwqm+=0.122*pow(lmymseh(dkgckvl,arrvbbr,vec2 (1.0/qxxpdff.x,0.0)),vec4 (2.0));nsstwqm/=0.576;gl_FragColor=sqrt(nsstwqm);if(okxtlcd==1){\n #ifdef iaycquf\n gl_FragColor=vqwttjm(gl_FragColor.rgb);\n #endif \n }}",
fragmentShaderTextureFilterVert1:"uniform sampler2D dkgckvl;uniform int okxtlcd;uniform vec2 qxxpdff;varying vec2 arrvbbr;vec4 lmymseh(sampler2D nmlmkmt,vec2 plnwnit,vec2 uyxiwjv){if(okxtlcd==1){\n #ifdef iaycquf\n return lxxelki(texture2D(nmlmkmt,clamp(plnwnit+uyxiwjv,vec2 (-1.0,0.5),vec2 (2.0,1.0))));\n #else \n return texture2D(nmlmkmt,clamp(plnwnit+uyxiwjv,vec2 (-1.0,0.5),vec2 (2.0,1.0)));\n #endif \n }else {return texture2D(nmlmkmt,plnwnit+uyxiwjv);}}void main(){vec4 nsstwqm=vec4 (0.0);vec4 rknhdjh;float pveouhx=0.0;for(int nigyetq=-1;nigyetq<=1;++nigyetq){const int myfjpxu=0;rknhdjh=lmymseh(dkgckvl,arrvbbr,vec2 (float (myfjpxu)/qxxpdff.x,float (nigyetq)/qxxpdff.y));if(rknhdjh.a!=0.0){pveouhx++;if(myfjpxu==0){gl_FragColor=clamp(rknhdjh,0.0,1.0);return ;}}nsstwqm+=rknhdjh;}gl_FragColor=nsstwqm/pveouhx;if(okxtlcd==1){\n #ifdef iaycquf\n gl_FragColor=vqwttjm(gl_FragColor.rgb);\n #endif \n }}",
fragmentShaderTextureFilterHori1:"uniform sampler2D dkgckvl;uniform int okxtlcd;uniform vec2 qxxpdff;varying vec2 arrvbbr;vec4 lmymseh(sampler2D nmlmkmt,vec2 plnwnit,vec2 uyxiwjv){if(okxtlcd==1){\n #ifdef iaycquf\n return lxxelki(texture2D(nmlmkmt,clamp(plnwnit+uyxiwjv,vec2 (-1.0,0.5),vec2 (2.0,1.0))));\n #else \n return texture2D(nmlmkmt,clamp(plnwnit+uyxiwjv,vec2 (-1.0,0.5),vec2 (2.0,1.0)));\n #endif \n }else {return texture2D(nmlmkmt,plnwnit+uyxiwjv);}}void main(){vec4 nsstwqm=vec4 (0.0);vec4 rknhdjh;float pveouhx=0.0;const int nigyetq=0;for(int myfjpxu=-1;myfjpxu<=1;++myfjpxu){rknhdjh=lmymseh(dkgckvl,arrvbbr,vec2 (float (myfjpxu)/qxxpdff.x,float (nigyetq)/qxxpdff.y));if(rknhdjh.a!=0.0){pveouhx++;if(myfjpxu==0){gl_FragColor=clamp(rknhdjh,0.0,1.0);return ;}}nsstwqm+=rknhdjh;}gl_FragColor=nsstwqm/pveouhx;if(okxtlcd==1){\n #ifdef iaycquf\n gl_FragColor=vqwttjm(gl_FragColor.rgb);\n #endif \n }}",
fragmentShaderTextureFilterVert3:"uniform sampler2D dkgckvl;uniform int okxtlcd;uniform vec2 qxxpdff;varying vec2 arrvbbr;vec4 lmymseh(sampler2D nmlmkmt,vec2 plnwnit,vec2 uyxiwjv){if(okxtlcd==1){\n #ifdef iaycquf\n return lxxelki(texture2D(nmlmkmt,clamp(plnwnit+uyxiwjv,vec2 (-1.0,0.5),vec2 (2.0,1.0))));\n #else \n return texture2D(nmlmkmt,clamp(plnwnit+uyxiwjv,vec2 (-1.0,0.5),vec2 (2.0,1.0)));\n #endif \n }else {return texture2D(nmlmkmt,plnwnit+uyxiwjv);}}void main(){float wtelvwq=1.0/qxxpdff.x;vec4 nsstwqm=vec4 (0.0);nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (-4.0*wtelvwq,0.0)),vec4 (2.0))*0.05;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (-3.0*wtelvwq,0.0)),vec4 (2.0))*0.09;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (-2.0*wtelvwq,0.0)),vec4 (2.0))*0.12;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (-1.0*wtelvwq,0.0)),vec4 (2.0))*0.15;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0*wtelvwq,0.0)),vec4 (2.0))*0.16;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (1.0*wtelvwq,0.0)),vec4 (2.0))*0.15;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (2.0*wtelvwq,0.0)),vec4 (2.0))*0.12;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (3.0*wtelvwq,0.0)),vec4 (2.0))*0.09;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (4.0*wtelvwq,0.0)),vec4 (2.0))*0.05;gl_FragColor=sqrt(nsstwqm/0.98);if(okxtlcd==1){\n #ifdef iaycquf\n gl_FragColor=vqwttjm(gl_FragColor.rgb);\n #endif \n }}",
fragmentShaderTextureFilterHori3:"uniform sampler2D dkgckvl;uniform int okxtlcd;uniform vec2 qxxpdff;varying vec2 arrvbbr;vec4 lmymseh(sampler2D nmlmkmt,vec2 plnwnit,vec2 uyxiwjv){if(okxtlcd==1){\n #ifdef iaycquf\n return lxxelki(texture2D(nmlmkmt,clamp(plnwnit+uyxiwjv,vec2 (-1.0,0.5),vec2 (2.0,1.0))));\n #else \n return texture2D(nmlmkmt,clamp(plnwnit+uyxiwjv,vec2 (-1.0,0.5),vec2 (2.0,1.0)));\n #endif \n }else {return texture2D(nmlmkmt,plnwnit+uyxiwjv);}}void main(){float wtelvwq=1.0/qxxpdff.y;vec4 nsstwqm=vec4 (0.0);nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,-4.0*wtelvwq)),vec4 (2.0))*0.05;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,-3.0*wtelvwq)),vec4 (2.0))*0.09;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,-2.0*wtelvwq)),vec4 (2.0))*0.12;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,-1.0*wtelvwq)),vec4 (2.0))*0.15;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,0.0*wtelvwq)),vec4 (2.0))*0.16;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,1.0*wtelvwq)),vec4 (2.0))*0.15;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,2.0*wtelvwq)),vec4 (2.0))*0.12;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,3.0*wtelvwq)),vec4 (2.0))*0.09;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,4.0*wtelvwq)),vec4 (2.0))*0.05;gl_FragColor=sqrt(nsstwqm/0.98);if(okxtlcd==1){\n #ifdef iaycquf\n gl_FragColor=vqwttjm(gl_FragColor.rgb);\n #endif \n }}",
fragmentShaderTextureFilterVert4:"uniform sampler2D dkgckvl;uniform int okxtlcd;uniform vec2 qxxpdff;varying vec2 arrvbbr;vec4 lmymseh(sampler2D nmlmkmt,vec2 plnwnit,vec2 uyxiwjv){if(okxtlcd==1){\n #ifdef iaycquf\n return lxxelki(texture2D(nmlmkmt,clamp(plnwnit+uyxiwjv,vec2 (-1.0,0.5),vec2 (2.0,1.0))));\n #else \n return texture2D(nmlmkmt,clamp(plnwnit+uyxiwjv,vec2 (-1.0,0.5),vec2 (2.0,1.0)));\n #endif \n }else {return texture2D(nmlmkmt,plnwnit+uyxiwjv);}}void main(){vec4 nsstwqm=vec4 (0.0);nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,-10.0/qxxpdff.y)),vec4 (2.0))*0.010798193302637612;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,-9.0/qxxpdff.y)),vec4 (2.0))*0.01579003166017883;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,-8.0/qxxpdff.y)),vec4 (2.0))*0.022184166935891116;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,-7.0/qxxpdff.y)),vec4 (2.0))*0.02994549312714898;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,-6.0/qxxpdff.y)),vec4 (2.0))*0.0388372109966426;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,-5.0/qxxpdff.y)),vec4 (2.0))*0.04839414490382868;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,-4.0/qxxpdff.y)),vec4 (2.0))*0.057938310552296556;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,-3.0/qxxpdff.y)),vec4 (2.0))*0.06664492057835994;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,-2.0/qxxpdff.y)),vec4 (2.0))*0.07365402806066466;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,-1.0/qxxpdff.y)),vec4 (2.0))*0.07820853879509118;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,0.0/qxxpdff.y)),vec4 (2.0))*0.07978845608028655;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,1.0/qxxpdff.y)),vec4 (2.0))*0.07820853879509118;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,2.0/qxxpdff.y)),vec4 (2.0))*0.07365402806066466;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,3.0/qxxpdff.y)),vec4 (2.0))*0.06664492057835994;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,4.0/qxxpdff.y)),vec4 (2.0))*0.057938310552296556;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,5.0/qxxpdff.y)),vec4 (2.0))*0.04839414490382868;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,6.0/qxxpdff.y)),vec4 (2.0))*0.0388372109966426;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,7.0/qxxpdff.y)),vec4 (2.0))*0.02994549312714898;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,8.0/qxxpdff.y)),vec4 (2.0))*0.022184166935891116;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,9.0/qxxpdff.y)),vec4 (2.0))*0.01579003166017883;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,10.0/qxxpdff.y)),vec4 (2.0))*0.010798193302637612;gl_FragColor=sqrt(nsstwqm/0.9645785339057668);if(okxtlcd==1){\n #ifdef iaycquf\n gl_FragColor=vqwttjm(gl_FragColor.rgb);\n #endif \n }}",
fragmentShaderTextureFilterHori4:"uniform sampler2D dkgckvl;uniform int okxtlcd;uniform vec2 qxxpdff;varying vec2 arrvbbr;vec4 lmymseh(sampler2D nmlmkmt,vec2 plnwnit,vec2 uyxiwjv){if(okxtlcd==1){\n #ifdef iaycquf\n return lxxelki(texture2D(nmlmkmt,clamp(plnwnit+uyxiwjv,vec2 (-1.0,0.5),vec2 (2.0,1.0))));\n #else \n return texture2D(nmlmkmt,clamp(plnwnit+uyxiwjv,vec2 (-1.0,0.5),vec2 (2.0,1.0)));\n #endif \n }else {return texture2D(nmlmkmt,plnwnit+uyxiwjv);}}void main(){vec4 nsstwqm=vec4 (0.0);nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (-10.0/qxxpdff.x,0.0)),vec4 (2.0))*0.010798193302637612;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (-9.0/qxxpdff.x,0.0)),vec4 (2.0))*0.01579003166017883;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (-8.0/qxxpdff.x,0.0)),vec4 (2.0))*0.022184166935891116;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (-7.0/qxxpdff.x,0.0)),vec4 (2.0))*0.02994549312714898;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (-6.0/qxxpdff.x,0.0)),vec4 (2.0))*0.0388372109966426;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (-5.0/qxxpdff.x,0.0)),vec4 (2.0))*0.04839414490382868;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (-4.0/qxxpdff.x,0.0)),vec4 (2.0))*0.057938310552296556;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (-3.0/qxxpdff.x,0.0)),vec4 (2.0))*0.06664492057835994;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (-2.0/qxxpdff.x,0.0)),vec4 (2.0))*0.07365402806066466;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (-1.0/qxxpdff.x,0.0)),vec4 (2.0))*0.07820853879509118;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0/qxxpdff.x,0.0)),vec4 (2.0))*0.07978845608028655;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (1.0/qxxpdff.x,0.0)),vec4 (2.0))*0.07820853879509118;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (2.0/qxxpdff.x,0.0)),vec4 (2.0))*0.07365402806066466;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (3.0/qxxpdff.x,0.0)),vec4 (2.0))*0.06664492057835994;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (4.0/qxxpdff.x,0.0)),vec4 (2.0))*0.057938310552296556;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (5.0/qxxpdff.x,0.0)),vec4 (2.0))*0.04839414490382868;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (6.0/qxxpdff.x,0.0)),vec4 (2.0))*0.0388372109966426;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (7.0/qxxpdff.x,0.0)),vec4 (2.0))*0.02994549312714898;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (8.0/qxxpdff.x,0.0)),vec4 (2.0))*0.022184166935891116;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (9.0/qxxpdff.x,0.0)),vec4 (2.0))*0.01579003166017883;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (10.0/qxxpdff.x,0.0)),vec4 (2.0))*0.010798193302637612;gl_FragColor=sqrt(nsstwqm/0.9645785339057668);if(okxtlcd==1){\n #ifdef iaycquf\n gl_FragColor=vqwttjm(gl_FragColor.rgb);\n #endif \n }}",
fragmentShaderTextureFilterVert5:"uniform sampler2D dkgckvl;uniform int okxtlcd;uniform vec2 qxxpdff;varying vec2 arrvbbr;vec4 lmymseh(sampler2D nmlmkmt,vec2 plnwnit,vec2 uyxiwjv){if(okxtlcd==1){\n #ifdef iaycquf\n return lxxelki(texture2D(nmlmkmt,clamp(plnwnit+uyxiwjv,vec2 (-1.0,0.5),vec2 (2.0,1.0))));\n #else \n return texture2D(nmlmkmt,clamp(plnwnit+uyxiwjv,vec2 (-1.0,0.5),vec2 (2.0,1.0)));\n #endif \n }else {return texture2D(nmlmkmt,plnwnit+uyxiwjv);}}void main(){vec4 nsstwqm=vec4 (0.0);nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (-15.0/qxxpdff.x,0.0)),vec4 (2.0))*0.0029213834155947566;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (-14.0/qxxpdff.x,0.0)),vec4 (2.0))*0.004370314848951582;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (-13.0/qxxpdff.x,0.0)),vec4 (2.0))*0.006358770584402994;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (-12.0/qxxpdff.x,0.0)),vec4 (2.0))*0.008998494418864677;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (-11.0/qxxpdff.x,0.0)),vec4 (2.0))*0.012385193926498847;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (-10.0/qxxpdff.x,0.0)),vec4 (2.0))*0.016579523132124782;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (-9.0/qxxpdff.x,0.0)),vec4 (2.0))*0.02158626594431529;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (-8.0/qxxpdff.x,0.0)),vec4 (2.0))*0.027335012445998938;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (-7.0/qxxpdff.x,0.0)),vec4 (2.0))*0.03366644759234314;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (-6.0/qxxpdff.x,0.0)),vec4 (2.0))*0.04032845408652389;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (-5.0/qxxpdff.x,0.0)),vec4 (2.0))*0.04698531256838376;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (-4.0/qxxpdff.x,0.0)),vec4 (2.0))*0.053241334253725375;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (-3.0/qxxpdff.x,0.0)),vec4 (2.0))*0.05867755446071658;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (-2.0/qxxpdff.x,0.0)),vec4 (2.0))*0.06289720461549886;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (-1.0/qxxpdff.x,0.0)),vec4 (2.0))*0.06557328601698999;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0/qxxpdff.x,0.0)),vec4 (2.0))*0.06649038006690546;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (1.0/qxxpdff.x,0.0)),vec4 (2.0))*0.06557328601698999;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (2.0/qxxpdff.x,0.0)),vec4 (2.0))*0.06289720461549886;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (3.0/qxxpdff.x,0.0)),vec4 (2.0))*0.05867755446071658;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (4.0/qxxpdff.x,0.0)),vec4 (2.0))*0.053241334253725375;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (5.0/qxxpdff.x,0.0)),vec4 (2.0))*0.04698531256838376;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (6.0/qxxpdff.x,0.0)),vec4 (2.0))*0.04032845408652389;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (7.0/qxxpdff.x,0.0)),vec4 (2.0))*0.03366644759234314;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (8.0/qxxpdff.x,0.0)),vec4 (2.0))*0.027335012445998938;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (9.0/qxxpdff.x,0.0)),vec4 (2.0))*0.02158626594431529;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (10.0/qxxpdff.x,0.0)),vec4 (2.0))*0.016579523132124782;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (11.0/qxxpdff.x,0.0)),vec4 (2.0))*0.012385193926498847;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (12.0/qxxpdff.x,0.0)),vec4 (2.0))*0.008998494418864677;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (13.0/qxxpdff.x,0.0)),vec4 (2.0))*0.006358770584402994;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (14.0/qxxpdff.x,0.0)),vec4 (2.0))*0.004370314848951582;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (15.0/qxxpdff.x,0.0)),vec4 (2.0))*0.0029213834155947566;gl_FragColor=sqrt(nsstwqm/0.9902994846887724);if(okxtlcd==1){\n #ifdef iaycquf\n gl_FragColor=vqwttjm(gl_FragColor.rgb);\n #endif \n }}",
fragmentShaderTextureFilterHori5:"uniform sampler2D dkgckvl;uniform int okxtlcd;uniform vec2 qxxpdff;varying vec2 arrvbbr;vec4 lmymseh(sampler2D nmlmkmt,vec2 plnwnit,vec2 uyxiwjv){if(okxtlcd==1){\n #ifdef iaycquf\n return lxxelki(texture2D(nmlmkmt,clamp(plnwnit+uyxiwjv,vec2 (-1.0,0.5),vec2 (2.0,1.0))));\n #else \n return texture2D(nmlmkmt,clamp(plnwnit+uyxiwjv,vec2 (-1.0,0.5),vec2 (2.0,1.0)));\n #endif \n }else {return texture2D(nmlmkmt,plnwnit+uyxiwjv);}}void main(){vec4 nsstwqm=vec4 (0.0);nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,-15.0/qxxpdff.y)),vec4 (2.0))*0.0029213834155947566;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,-14.0/qxxpdff.y)),vec4 (2.0))*0.004370314848951582;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,-13.0/qxxpdff.y)),vec4 (2.0))*0.006358770584402994;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,-12.0/qxxpdff.y)),vec4 (2.0))*0.008998494418864677;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,-11.0/qxxpdff.y)),vec4 (2.0))*0.012385193926498847;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,-10.0/qxxpdff.y)),vec4 (2.0))*0.016579523132124782;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,-9.0/qxxpdff.y)),vec4 (2.0))*0.02158626594431529;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,-8.0/qxxpdff.y)),vec4 (2.0))*0.027335012445998938;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,-7.0/qxxpdff.y)),vec4 (2.0))*0.03366644759234314;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,-6.0/qxxpdff.y)),vec4 (2.0))*0.04032845408652389;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,-5.0/qxxpdff.y)),vec4 (2.0))*0.04698531256838376;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,-4.0/qxxpdff.y)),vec4 (2.0))*0.053241334253725375;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,-3.0/qxxpdff.y)),vec4 (2.0))*0.05867755446071658;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,-2.0/qxxpdff.y)),vec4 (2.0))*0.06289720461549886;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,-1.0/qxxpdff.y)),vec4 (2.0))*0.06557328601698999;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,0.0/qxxpdff.y)),vec4 (2.0))*0.06649038006690546;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,1.0/qxxpdff.y)),vec4 (2.0))*0.06557328601698999;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,2.0/qxxpdff.y)),vec4 (2.0))*0.06289720461549886;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,3.0/qxxpdff.y)),vec4 (2.0))*0.05867755446071658;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,4.0/qxxpdff.y)),vec4 (2.0))*0.053241334253725375;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,5.0/qxxpdff.y)),vec4 (2.0))*0.04698531256838376;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,6.0/qxxpdff.y)),vec4 (2.0))*0.04032845408652389;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,7.0/qxxpdff.y)),vec4 (2.0))*0.03366644759234314;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,8.0/qxxpdff.y)),vec4 (2.0))*0.027335012445998938;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,9.0/qxxpdff.y)),vec4 (2.0))*0.02158626594431529;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,10.0/qxxpdff.y)),vec4 (2.0))*0.016579523132124782;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,11.0/qxxpdff.y)),vec4 (2.0))*0.012385193926498847;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,12.0/qxxpdff.y)),vec4 (2.0))*0.008998494418864677;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,13.0/qxxpdff.y)),vec4 (2.0))*0.006358770584402994;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,14.0/qxxpdff.y)),vec4 (2.0))*0.004370314848951582;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,15.0/qxxpdff.y)),vec4 (2.0))*0.0029213834155947566;gl_FragColor=sqrt(nsstwqm/0.9902994846887724);if(okxtlcd==1){\n #ifdef iaycquf\n gl_FragColor=vqwttjm(gl_FragColor.rgb);\n #endif \n }}",
fragmentShaderTextureFilterVert6:"uniform sampler2D dkgckvl;uniform int okxtlcd;uniform vec2 qxxpdff;varying vec2 arrvbbr;vec4 lmymseh(sampler2D nmlmkmt,vec2 plnwnit,vec2 uyxiwjv){if(okxtlcd==1){\n #ifdef iaycquf\n return lxxelki(texture2D(nmlmkmt,clamp(plnwnit+uyxiwjv,vec2 (-1.0,0.5),vec2 (2.0,1.0))));\n #else \n return texture2D(nmlmkmt,clamp(plnwnit+uyxiwjv,vec2 (-1.0,0.5),vec2 (2.0,1.0)));\n #endif \n }else {return texture2D(nmlmkmt,plnwnit+uyxiwjv);}}void main(){vec4 nsstwqm=vec4 (0.0);nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (-25.0/qxxpdff.x,0.0)),vec4 (2.0))*0.001752830049356854;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (-24.0/qxxpdff.x,0.0)),vec4 (2.0))*0.00223945302948429;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (-23.0/qxxpdff.x,0.0)),vec4 (2.0))*0.0028327037741601177;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (-22.0/qxxpdff.x,0.0)),vec4 (2.0))*0.0035474592846231443;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (-21.0/qxxpdff.x,0.0)),vec4 (2.0))*0.00439835959804272;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (-20.0/qxxpdff.x,0.0)),vec4 (2.0))*0.005399096651318806;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (-19.0/qxxpdff.x,0.0)),vec4 (2.0))*0.00656158147746766;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (-18.0/qxxpdff.x,0.0)),vec4 (2.0))*0.007895015830089416;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (-17.0/qxxpdff.x,0.0)),vec4 (2.0))*0.009404907737688694;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (-16.0/qxxpdff.x,0.0)),vec4 (2.0))*0.011092083467945558;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (-15.0/qxxpdff.x,0.0)),vec4 (2.0))*0.012951759566589175;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (-14.0/qxxpdff.x,0.0)),vec4 (2.0))*0.01497274656357449;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (-13.0/qxxpdff.x,0.0)),vec4 (2.0))*0.01713685920478074;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (-12.0/qxxpdff.x,0.0)),vec4 (2.0))*0.0194186054983213;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (-11.0/qxxpdff.x,0.0)),vec4 (2.0))*0.021785217703255054;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (-10.0/qxxpdff.x,0.0)),vec4 (2.0))*0.02419707245191434;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (-9.0/qxxpdff.x,0.0)),vec4 (2.0))*0.026608524989875485;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (-8.0/qxxpdff.x,0.0)),vec4 (2.0))*0.028969155276148278;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (-7.0/qxxpdff.x,0.0)),vec4 (2.0))*0.03122539333667613;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (-6.0/qxxpdff.x,0.0)),vec4 (2.0))*0.03332246028917997;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (-5.0/qxxpdff.x,0.0)),vec4 (2.0))*0.03520653267642995;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (-4.0/qxxpdff.x,0.0)),vec4 (2.0))*0.03682701403033233;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (-3.0/qxxpdff.x,0.0)),vec4 (2.0))*0.038138781546052415;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (-2.0/qxxpdff.x,0.0)),vec4 (2.0))*0.03910426939754559;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (-1.0/qxxpdff.x,0.0)),vec4 (2.0))*0.039695254747701185;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0/qxxpdff.x,0.0)),vec4 (2.0))*0.039894228040143274;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (1.0/qxxpdff.x,0.0)),vec4 (2.0))*0.039695254747701185;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (2.0/qxxpdff.x,0.0)),vec4 (2.0))*0.03910426939754559;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (3.0/qxxpdff.x,0.0)),vec4 (2.0))*0.038138781546052415;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (4.0/qxxpdff.x,0.0)),vec4 (2.0))*0.03682701403033233;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (5.0/qxxpdff.x,0.0)),vec4 (2.0))*0.03520653267642995;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (6.0/qxxpdff.x,0.0)),vec4 (2.0))*0.03332246028917997;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (7.0/qxxpdff.x,0.0)),vec4 (2.0))*0.03122539333667613;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (8.0/qxxpdff.x,0.0)),vec4 (2.0))*0.028969155276148278;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (9.0/qxxpdff.x,0.0)),vec4 (2.0))*0.026608524989875485;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (10.0/qxxpdff.x,0.0)),vec4 (2.0))*0.02419707245191434;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (11.0/qxxpdff.x,0.0)),vec4 (2.0))*0.021785217703255054;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (12.0/qxxpdff.x,0.0)),vec4 (2.0))*0.0194186054983213;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (13.0/qxxpdff.x,0.0)),vec4 (2.0))*0.01713685920478074;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (14.0/qxxpdff.x,0.0)),vec4 (2.0))*0.01497274656357449;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (15.0/qxxpdff.x,0.0)),vec4 (2.0))*0.012951759566589175;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (16.0/qxxpdff.x,0.0)),vec4 (2.0))*0.011092083467945558;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (17.0/qxxpdff.x,0.0)),vec4 (2.0))*0.009404907737688694;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (18.0/qxxpdff.x,0.0)),vec4 (2.0))*0.007895015830089416;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (19.0/qxxpdff.x,0.0)),vec4 (2.0))*0.00656158147746766;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (20.0/qxxpdff.x,0.0)),vec4 (2.0))*0.005399096651318806;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (21.0/qxxpdff.x,0.0)),vec4 (2.0))*0.00439835959804272;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (22.0/qxxpdff.x,0.0)),vec4 (2.0))*0.0035474592846231443;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (23.0/qxxpdff.x,0.0)),vec4 (2.0))*0.0028327037741601177;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (24.0/qxxpdff.x,0.0)),vec4 (2.0))*0.00223945302948429;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (25.0/qxxpdff.x,0.0)),vec4 (2.0))*0.001752830049356854;gl_FragColor=sqrt(nsstwqm/0.9892605043972508);if(okxtlcd==1){\n #ifdef iaycquf\n gl_FragColor=vqwttjm(gl_FragColor.rgb);\n #endif \n }}",
fragmentShaderTextureFilterHori6:"uniform sampler2D dkgckvl;uniform int okxtlcd;uniform vec2 qxxpdff;varying vec2 arrvbbr;vec4 lmymseh(sampler2D nmlmkmt,vec2 plnwnit,vec2 uyxiwjv){if(okxtlcd==1){\n #ifdef iaycquf\n return lxxelki(texture2D(nmlmkmt,clamp(plnwnit+uyxiwjv,vec2 (-1.0,0.5),vec2 (2.0,1.0))));\n #else \n return texture2D(nmlmkmt,clamp(plnwnit+uyxiwjv,vec2 (-1.0,0.5),vec2 (2.0,1.0)));\n #endif \n }else {return texture2D(nmlmkmt,plnwnit+uyxiwjv);}}void main(){vec4 nsstwqm=vec4 (0.0);nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,-25.0/qxxpdff.y)),vec4 (2.0))*0.001752830049356854;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,-24.0/qxxpdff.y)),vec4 (2.0))*0.00223945302948429;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,-23.0/qxxpdff.y)),vec4 (2.0))*0.0028327037741601177;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,-22.0/qxxpdff.y)),vec4 (2.0))*0.0035474592846231443;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,-21.0/qxxpdff.y)),vec4 (2.0))*0.00439835959804272;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,-20.0/qxxpdff.y)),vec4 (2.0))*0.005399096651318806;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,-19.0/qxxpdff.y)),vec4 (2.0))*0.00656158147746766;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,-18.0/qxxpdff.y)),vec4 (2.0))*0.007895015830089416;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,-17.0/qxxpdff.y)),vec4 (2.0))*0.009404907737688694;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,-16.0/qxxpdff.y)),vec4 (2.0))*0.011092083467945558;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,-15.0/qxxpdff.y)),vec4 (2.0))*0.012951759566589175;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,-14.0/qxxpdff.y)),vec4 (2.0))*0.01497274656357449;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,-13.0/qxxpdff.y)),vec4 (2.0))*0.01713685920478074;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,-12.0/qxxpdff.y)),vec4 (2.0))*0.0194186054983213;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,-11.0/qxxpdff.y)),vec4 (2.0))*0.021785217703255054;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,-10.0/qxxpdff.y)),vec4 (2.0))*0.02419707245191434;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,-9.0/qxxpdff.y)),vec4 (2.0))*0.026608524989875485;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,-8.0/qxxpdff.y)),vec4 (2.0))*0.028969155276148278;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,-7.0/qxxpdff.y)),vec4 (2.0))*0.03122539333667613;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,-6.0/qxxpdff.y)),vec4 (2.0))*0.03332246028917997;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,-5.0/qxxpdff.y)),vec4 (2.0))*0.03520653267642995;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,-4.0/qxxpdff.y)),vec4 (2.0))*0.03682701403033233;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,-3.0/qxxpdff.y)),vec4 (2.0))*0.038138781546052415;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,-2.0/qxxpdff.y)),vec4 (2.0))*0.03910426939754559;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,-1.0/qxxpdff.y)),vec4 (2.0))*0.039695254747701185;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,0.0/qxxpdff.y)),vec4 (2.0))*0.039894228040143274;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,1.0/qxxpdff.y)),vec4 (2.0))*0.039695254747701185;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,2.0/qxxpdff.y)),vec4 (2.0))*0.03910426939754559;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,3.0/qxxpdff.y)),vec4 (2.0))*0.038138781546052415;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,4.0/qxxpdff.y)),vec4 (2.0))*0.03682701403033233;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,5.0/qxxpdff.y)),vec4 (2.0))*0.03520653267642995;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,6.0/qxxpdff.y)),vec4 (2.0))*0.03332246028917997;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,7.0/qxxpdff.y)),vec4 (2.0))*0.03122539333667613;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,8.0/qxxpdff.y)),vec4 (2.0))*0.028969155276148278;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,9.0/qxxpdff.y)),vec4 (2.0))*0.026608524989875485;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,10.0/qxxpdff.y)),vec4 (2.0))*0.02419707245191434;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,11.0/qxxpdff.y)),vec4 (2.0))*0.021785217703255054;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,12.0/qxxpdff.y)),vec4 (2.0))*0.0194186054983213;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,13.0/qxxpdff.y)),vec4 (2.0))*0.01713685920478074;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,14.0/qxxpdff.y)),vec4 (2.0))*0.01497274656357449;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,15.0/qxxpdff.y)),vec4 (2.0))*0.012951759566589175;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,16.0/qxxpdff.y)),vec4 (2.0))*0.011092083467945558;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,17.0/qxxpdff.y)),vec4 (2.0))*0.009404907737688694;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,18.0/qxxpdff.y)),vec4 (2.0))*0.007895015830089416;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,19.0/qxxpdff.y)),vec4 (2.0))*0.00656158147746766;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,20.0/qxxpdff.y)),vec4 (2.0))*0.005399096651318806;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,21.0/qxxpdff.y)),vec4 (2.0))*0.00439835959804272;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,22.0/qxxpdff.y)),vec4 (2.0))*0.0035474592846231443;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,23.0/qxxpdff.y)),vec4 (2.0))*0.0028327037741601177;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,24.0/qxxpdff.y)),vec4 (2.0))*0.00223945302948429;nsstwqm+=pow(lmymseh(dkgckvl,arrvbbr,vec2 (0.0,25.0/qxxpdff.y)),vec4 (2.0))*0.001752830049356854;gl_FragColor=sqrt(nsstwqm/0.9892605043972508);if(okxtlcd==1){\n #ifdef iaycquf\n gl_FragColor=vqwttjm(gl_FragColor.rgb);\n #endif \n }}",
fragmentShaderTextureFilterVert7:"uniform sampler2D dkgckvl;uniform sampler2D dkgckvl2;uniform vec2 qxxpdff;uniform int eqvgkaq;uniform int layjmki;varying vec2 arrvbbr;float brhvcmq(vec3 nsstwqm){return 0.299*nsstwqm.r+0.587*nsstwqm.g+0.114*nsstwqm.b;}vec4 lmymseh(sampler2D nmlmkmt,vec2 plnwnit,vec2 uyxiwjv){return texture2D(nmlmkmt,plnwnit+uyxiwjv);}void main(){vec4 rknhdjh=lmymseh(dkgckvl,arrvbbr,vec2 (0));vec4 nsstwqm=vec4 (0);float pveouhx=0.0;float tkejuel=1.0;if(rknhdjh.a!=0.0){if(eqvgkaq==1){gl_FragColor=vec4 (rknhdjh.rgb,rknhdjh.a)/2.0;}else {\n #ifdef iaycquf\n tkejuel=lmymseh(dkgckvl2,arrvbbr,vec2 (0)).z*10.0;\n #else \n tkejuel=lmymseh(dkgckvl2,arrvbbr,vec2 (0)).z;\n #endif \n gl_FragColor=vec4 (rknhdjh.rgb*tkejuel,rknhdjh.a)/2.0;}}else {vec2 tdeknez;float ktnvxcp=0.0;float tkejuel=1.0;float rpdvnvi=0.0,adkcold;vec3 adfwhxq;vec4 qdaqhhv;if(eqvgkaq==0){for(int myfjpxu=1;myfjpxu<30;++myfjpxu){tdeknez=vec2 (0.0,float (myfjpxu)/qxxpdff.y);adfwhxq=lmymseh(dkgckvl2,arrvbbr,tdeknez).xyz;qdaqhhv=lmymseh(dkgckvl,arrvbbr,tdeknez);\n #ifdef iaycquf\n ktnvxcp=adfwhxq.y*255.0;tkejuel=adfwhxq.z*10.0;\n #else \n ktnvxcp=adfwhxq.y;tkejuel=adfwhxq.z;\n #endif \n if(float (myfjpxu)<ktnvxcp){adkcold=1.0-(float (myfjpxu)/float (ktnvxcp));if(adkcold>rpdvnvi){rpdvnvi=adkcold;nsstwqm=vec4 (qdaqhhv.rgb*tkejuel,qdaqhhv.a)*adkcold;pveouhx=1.0;}else {if(adkcold==rpdvnvi){nsstwqm+=vec4 (qdaqhhv.rgb*tkejuel,qdaqhhv.a)*adkcold;pveouhx+=1.0;}}}tdeknez=vec2 (0.0,float (-myfjpxu)/qxxpdff.y);qdaqhhv=lmymseh(dkgckvl,arrvbbr,tdeknez);adfwhxq=lmymseh(dkgckvl2,arrvbbr,tdeknez).xyz;\n #ifdef iaycquf\n ktnvxcp=adfwhxq.y*255.0;tkejuel=adfwhxq.z*10.0;\n #else \n ktnvxcp=adfwhxq.y;tkejuel=adfwhxq.z;\n #endif \n if(float (myfjpxu)<ktnvxcp){adkcold=1.0-(float (myfjpxu)/float (ktnvxcp));if(adkcold>rpdvnvi){rpdvnvi=adkcold;nsstwqm=vec4 (qdaqhhv.rgb*tkejuel,qdaqhhv.a)*adkcold;pveouhx=1.0;}else {if(adkcold==rpdvnvi){nsstwqm+=vec4 (qdaqhhv.rgb*tkejuel,qdaqhhv.a)*adkcold;pveouhx+=1.0;}}}}gl_FragColor=nsstwqm/pveouhx;}else {ktnvxcp=5.0;for(int myfjpxu=1;myfjpxu<6;++myfjpxu){tdeknez=vec2 (0.0,float (myfjpxu)/qxxpdff.y);qdaqhhv=lmymseh(dkgckvl,arrvbbr,tdeknez);if(qdaqhhv.a>0.0){adkcold=1.0-(float (myfjpxu)/float (ktnvxcp));if(adkcold>rpdvnvi){rpdvnvi=adkcold;nsstwqm=vec4 (qdaqhhv.rgb*tkejuel,qdaqhhv.a)*adkcold;pveouhx=1.0;}else {if(adkcold==rpdvnvi){nsstwqm+=qdaqhhv*adkcold;pveouhx+=1.0;}}}tdeknez=vec2 (0.0,float (-myfjpxu)/qxxpdff.y);qdaqhhv=lmymseh(dkgckvl,arrvbbr,tdeknez);if(qdaqhhv.a>0.0){adkcold=1.0-(float (myfjpxu)/float (ktnvxcp));if(adkcold>rpdvnvi){rpdvnvi=adkcold;nsstwqm=qdaqhhv*adkcold;pveouhx=1.0;}else {if(adkcold==rpdvnvi){nsstwqm+=qdaqhhv*adkcold;pveouhx+=1.0;}}}}gl_FragColor=nsstwqm/pveouhx;}}}",
fragmentShaderTextureFilterHori7:"uniform sampler2D dkgckvl;uniform sampler2D dkgckvl2;uniform vec2 qxxpdff;uniform int eqvgkaq;uniform int layjmki;varying vec2 arrvbbr;float brhvcmq(vec3 nsstwqm){return 0.299*nsstwqm.r+0.587*nsstwqm.g+0.114*nsstwqm.b;}vec4 lmymseh(sampler2D nmlmkmt,vec2 plnwnit,vec2 uyxiwjv){return texture2D(nmlmkmt,plnwnit+uyxiwjv);}void main(){vec4 rknhdjh=lmymseh(dkgckvl,arrvbbr,vec2 (0));vec4 nsstwqm=vec4 (0);float pveouhx=0.0;float tkejuel=1.0;if(layjmki==1){gl_FragColor=rknhdjh+lmymseh(dkgckvl2,arrvbbr,vec2 (0));if(eqvgkaq==1){}}else {if(rknhdjh.a!=0.0){if(eqvgkaq==1){gl_FragColor=vec4 (rknhdjh.rgb,rknhdjh.a)/2.0;}else {\n #ifdef iaycquf\n tkejuel=lmymseh(dkgckvl2,arrvbbr,vec2 (0)).z*10.0;\n #else \n tkejuel=lmymseh(dkgckvl2,arrvbbr,vec2 (0)).z;\n #endif \n gl_FragColor=vec4 (rknhdjh.rgb*tkejuel,rknhdjh.a)/2.0;}}else {vec2 tdeknez;float ktnvxcp=0.0;float tkejuel=1.0;float rpdvnvi=0.0,adkcold;vec3 adfwhxq;vec4 qdaqhhv;if(eqvgkaq==0){for(int myfjpxu=1;myfjpxu<30;++myfjpxu){tdeknez=vec2 (float (myfjpxu)/qxxpdff.x,0.0);adfwhxq=lmymseh(dkgckvl2,arrvbbr,tdeknez).xyz;qdaqhhv=lmymseh(dkgckvl,arrvbbr,tdeknez);\n #ifdef iaycquf\n ktnvxcp=adfwhxq.x*255.0;tkejuel=adfwhxq.z*10.0;\n #else \n ktnvxcp=adfwhxq.x;tkejuel=adfwhxq.z;\n #endif \n if(float (myfjpxu)<ktnvxcp){adkcold=1.0-(float (myfjpxu)/float (ktnvxcp));if(adkcold>rpdvnvi){rpdvnvi=adkcold;nsstwqm=vec4 (qdaqhhv.rgb*tkejuel,qdaqhhv.a)*adkcold;pveouhx=1.0;}else {if(adkcold==rpdvnvi){nsstwqm+=vec4 (qdaqhhv.rgb*tkejuel,qdaqhhv.a)*adkcold;pveouhx+=1.0;}}}tdeknez=vec2 (float (-myfjpxu)/qxxpdff.x,0.0);adfwhxq=lmymseh(dkgckvl2,arrvbbr,tdeknez).xyz;qdaqhhv=lmymseh(dkgckvl,arrvbbr,tdeknez);\n #ifdef iaycquf\n ktnvxcp=adfwhxq.x*255.0;tkejuel=adfwhxq.z*10.0;\n #else \n ktnvxcp=adfwhxq.x;tkejuel=adfwhxq.z;\n #endif \n if(float (myfjpxu)<ktnvxcp){adkcold=1.0-(float (myfjpxu)/float (ktnvxcp));if(adkcold>rpdvnvi){rpdvnvi=adkcold;nsstwqm=vec4 (qdaqhhv.rgb*tkejuel,qdaqhhv.a)*adkcold;pveouhx=1.0;}else {if(adkcold==rpdvnvi){nsstwqm+=vec4 (qdaqhhv.rgb*tkejuel,qdaqhhv.a)*adkcold;pveouhx+=1.0;}}}}gl_FragColor=nsstwqm/pveouhx;}else {ktnvxcp=5.0;for(int myfjpxu=1;myfjpxu<6;++myfjpxu){tdeknez=vec2 (float (myfjpxu)/qxxpdff.x,0.0);qdaqhhv=lmymseh(dkgckvl,arrvbbr,tdeknez);if(qdaqhhv.a>0.0){adkcold=1.0-(float (myfjpxu)/float (ktnvxcp));if(adkcold>rpdvnvi){rpdvnvi=adkcold;nsstwqm=qdaqhhv*adkcold;pveouhx=1.0;}else {if(adkcold==rpdvnvi){nsstwqm+=qdaqhhv*adkcold;pveouhx+=1.0;}}}tdeknez=vec2 (float (-myfjpxu)/qxxpdff.x,0.0);qdaqhhv=lmymseh(dkgckvl,arrvbbr,tdeknez);if(qdaqhhv.a>0.0){adkcold=1.0-(float (myfjpxu)/float (ktnvxcp));if(adkcold>rpdvnvi){rpdvnvi=adkcold;nsstwqm=qdaqhhv*adkcold;pveouhx=1.0;}else {if(adkcold==rpdvnvi){nsstwqm+=qdaqhhv*adkcold;pveouhx+=1.0;}}}}gl_FragColor=nsstwqm/pveouhx;}}}}",
fragmentShaderTextureFilterContrastAndBrightness:"uniform vec2 qxxpdff;uniform sampler2D kxojuqn;uniform float axeqzlu;uniform float udfzxlx;varying vec2 arrvbbr;float brhvcmq(vec3 nsstwqm){return 0.299*nsstwqm.r+0.587*nsstwqm.g+0.114*nsstwqm.b;}vec4 lmymseh(sampler2D nmlmkmt,vec2 plnwnit,vec2 uyxiwjv){return texture2D(nmlmkmt,plnwnit+uyxiwjv);}vec3 ycddoqb(vec3 splrifm){vec4 eircrya=vec4 (0.0,-1.0/3.0,2.0/3.0,-1.0);vec4 p=mix(vec4 (splrifm.bg,eircrya.wz),vec4 (splrifm.gb,eircrya.xy),step(splrifm.b,splrifm.g));vec4 zrcochy=mix(vec4 (p.xyw,splrifm.r),vec4 (splrifm.r,p.yzx),step(p.x,splrifm.r));float epbwege=zrcochy.x-min(zrcochy.w,zrcochy.y);float nsvbngn=0.0000000001;return vec3 (abs(zrcochy.z+(zrcochy.w-zrcochy.y)/(6.0*epbwege+nsvbngn)),epbwege/(zrcochy.x+nsvbngn),zrcochy.x);}vec3 lsfuboz(vec3 splrifm){vec4 eircrya=vec4 (1.0,2.0/3.0,1.0/3.0,3.0);vec3 p=abs(fract(splrifm.xxx+eircrya.xyz)*6.0-eircrya.www);return splrifm.z*mix(eircrya.xxx,clamp(p-eircrya.xxx,0.0,1.0),splrifm.y);}void main(){vec4 rknhdjh=lmymseh(kxojuqn,arrvbbr,vec2 (0));vec3 fxoelyv=ycddoqb(rknhdjh.rgb);fxoelyv.z=axeqzlu*fxoelyv.z+udfzxlx;gl_FragColor.rgb=lsfuboz(fxoelyv);gl_FragColor.a=rknhdjh.a;}",
fragmentShaderTextureFilterBrightness:"uniform sampler2D kxojuqn;uniform float axeqzlu;uniform vec2 qxxpdff;varying vec2 arrvbbr;float brhvcmq(vec3 nsstwqm){return 0.299*nsstwqm.r+0.587*nsstwqm.g+0.114*nsstwqm.b;}vec4 lmymseh(sampler2D nmlmkmt,vec2 plnwnit,vec2 uyxiwjv){return texture2D(nmlmkmt,plnwnit+uyxiwjv);}vec3 ycddoqb(vec3 splrifm){vec4 eircrya=vec4 (0.0,-1.0/3.0,2.0/3.0,-1.0);vec4 p=mix(vec4 (splrifm.bg,eircrya.wz),vec4 (splrifm.gb,eircrya.xy),step(splrifm.b,splrifm.g));vec4 zrcochy=mix(vec4 (p.xyw,splrifm.r),vec4 (splrifm.r,p.yzx),step(p.x,splrifm.r));float epbwege=zrcochy.x-min(zrcochy.w,zrcochy.y);float nsvbngn=0.0000000001;return vec3 (abs(zrcochy.z+(zrcochy.w-zrcochy.y)/(6.0*epbwege+nsvbngn)),epbwege/(zrcochy.x+nsvbngn),zrcochy.x);}vec3 lsfuboz(vec3 splrifm){vec4 eircrya=vec4 (1.0,2.0/3.0,1.0/3.0,3.0);vec3 p=abs(fract(splrifm.xxx+eircrya.xyz)*6.0-eircrya.www);return splrifm.z*mix(eircrya.xxx,clamp(p-eircrya.xxx,0.0,1.0),splrifm.y);}void main(){vec4 rknhdjh=lmymseh(kxojuqn,arrvbbr,vec2 (0));vec3 fxoelyv=ycddoqb(rknhdjh.rgb);fxoelyv.z+=axeqzlu;gl_FragColor.rgb=lsfuboz(fxoelyv);gl_FragColor.a=rknhdjh.a;}",
fragmentShaderTextureFilterContrast:"uniform sampler2D kxojuqn;uniform float axeqzlu;uniform vec2 qxxpdff;varying vec2 arrvbbr;float brhvcmq(vec3 nsstwqm){return 0.299*nsstwqm.r+0.587*nsstwqm.g+0.114*nsstwqm.b;}vec4 lmymseh(sampler2D nmlmkmt,vec2 plnwnit,vec2 uyxiwjv){return texture2D(nmlmkmt,plnwnit+uyxiwjv);}vec3 ycddoqb(vec3 splrifm){vec4 eircrya=vec4 (0.0,-1.0/3.0,2.0/3.0,-1.0);vec4 p=mix(vec4 (splrifm.bg,eircrya.wz),vec4 (splrifm.gb,eircrya.xy),step(splrifm.b,splrifm.g));vec4 zrcochy=mix(vec4 (p.xyw,splrifm.r),vec4 (splrifm.r,p.yzx),step(p.x,splrifm.r));float epbwege=zrcochy.x-min(zrcochy.w,zrcochy.y);float nsvbngn=0.0000000001;return vec3 (abs(zrcochy.z+(zrcochy.w-zrcochy.y)/(6.0*epbwege+nsvbngn)),epbwege/(zrcochy.x+nsvbngn),zrcochy.x);}vec3 lsfuboz(vec3 splrifm){vec4 eircrya=vec4 (1.0,2.0/3.0,1.0/3.0,3.0);vec3 p=abs(fract(splrifm.xxx+eircrya.xyz)*6.0-eircrya.www);return splrifm.z*mix(eircrya.xxx,clamp(p-eircrya.xxx,0.0,1.0),splrifm.y);}void main(){vec4 rknhdjh=lmymseh(kxojuqn,arrvbbr,vec2 (0));vec3 fxoelyv=ycddoqb(rknhdjh.rgb);fxoelyv.z*=axeqzlu;gl_FragColor.rgb=lsfuboz(fxoelyv);gl_FragColor.a=rknhdjh.a;}",
fragmentShaderTextureFilterAlbedoToNormal:"uniform sampler2D kxojuqn;uniform vec2 qxxpdff;varying vec2 arrvbbr;const float ujvburc=1.0;const float cxpqetb=1.0;const float ggsxpsx=1.0;const int srlpklr=0;const int wtcqvmf=1;const float uknawqc=0.5;const float dvxvisn=6.0;const float orbpagv=1.0/uknawqc*(1.0+pow(2.0,dvxvisn));void main(){vec2 step=vec2 (-1.0/qxxpdff.x,1.0/qxxpdff.y);vec2 fzjccsg=vec2 (arrvbbr.x-step.x,arrvbbr.y+step.y);vec2 rspzuhe=vec2 (arrvbbr.x-step.x,arrvbbr.y);vec2 sypmwfh=vec2 (arrvbbr.x-step.x,arrvbbr.y-step.y);vec2 vzimzbb=vec2 (arrvbbr.x,arrvbbr.y+step.y);vec2 qesyroa=vec2 (arrvbbr.x,arrvbbr.y-step.y);vec2 grcgaqn=vec2 (arrvbbr.x+step.x,arrvbbr.y+step.y);vec2 aivzdyl=vec2 (arrvbbr.x+step.x,arrvbbr.y);vec2 ghjihxm=vec2 (arrvbbr.x+step.x,arrvbbr.y-step.y);fzjccsg=vec2 (fzjccsg.x>=0.0?fzjccsg.x:(1.0+fzjccsg.x),fzjccsg.y>=0.0?fzjccsg.y:(1.0+fzjccsg.y));fzjccsg=vec2 (fzjccsg.x<1.0?fzjccsg.x:(fzjccsg.x-1.0),fzjccsg.y<1.0?fzjccsg.y:(fzjccsg.y-1.0));rspzuhe=vec2 (rspzuhe.x>=0.0?rspzuhe.x:(1.0+rspzuhe.x),rspzuhe.y>=0.0?rspzuhe.y:(1.0+rspzuhe.y));rspzuhe=vec2 (rspzuhe.x<1.0?rspzuhe.x:(rspzuhe.x-1.0),rspzuhe.y<1.0?rspzuhe.y:(rspzuhe.y-1.0));sypmwfh=vec2 (sypmwfh.x>=0.0?sypmwfh.x:(1.0+sypmwfh.x),sypmwfh.y>=0.0?sypmwfh.y:(1.0+sypmwfh.y));sypmwfh=vec2 (sypmwfh.x<1.0?sypmwfh.x:(sypmwfh.x-1.0),sypmwfh.y<1.0?sypmwfh.y:(sypmwfh.y-1.0));vzimzbb=vec2 (vzimzbb.x>=0.0?vzimzbb.x:(1.0+vzimzbb.x),vzimzbb.y>=0.0?vzimzbb.y:(1.0+vzimzbb.y));vzimzbb=vec2 (vzimzbb.x<1.0?vzimzbb.x:(vzimzbb.x-1.0),vzimzbb.y<1.0?vzimzbb.y:(vzimzbb.y-1.0));qesyroa=vec2 (qesyroa.x>=0.0?qesyroa.x:(1.0+qesyroa.x),qesyroa.y>=0.0?qesyroa.y:(1.0+qesyroa.y));qesyroa=vec2 (qesyroa.x<1.0?qesyroa.x:(qesyroa.x-1.0),qesyroa.y<1.0?qesyroa.y:(qesyroa.y-1.0));grcgaqn=vec2 (grcgaqn.x>=0.0?grcgaqn.x:(1.0+grcgaqn.x),grcgaqn.y>=0.0?grcgaqn.y:(1.0+grcgaqn.y));grcgaqn=vec2 (grcgaqn.x<1.0?grcgaqn.x:(grcgaqn.x-1.0),grcgaqn.y<1.0?grcgaqn.y:(grcgaqn.y-1.0));aivzdyl=vec2 (aivzdyl.x>=0.0?aivzdyl.x:(1.0+aivzdyl.x),aivzdyl.y>=0.0?aivzdyl.y:(1.0+aivzdyl.y));aivzdyl=vec2 (aivzdyl.x<1.0?aivzdyl.x:(aivzdyl.x-1.0),aivzdyl.y<1.0?aivzdyl.y:(aivzdyl.y-1.0));ghjihxm=vec2 (ghjihxm.x>=0.0?ghjihxm.x:(1.0+ghjihxm.x),ghjihxm.y>=0.0?ghjihxm.y:(1.0+ghjihxm.y));ghjihxm=vec2 (ghjihxm.x<1.0?ghjihxm.x:(ghjihxm.x-1.0),ghjihxm.y<1.0?ghjihxm.y:(ghjihxm.y-1.0));float qjaokbc=abs(texture2D(kxojuqn,fzjccsg).r);float mfvvztb=abs(texture2D(kxojuqn,rspzuhe).r);float mwrazgy=abs(texture2D(kxojuqn,sypmwfh).r);float t=abs(texture2D(kxojuqn,vzimzbb).r);float b=abs(texture2D(kxojuqn,qesyroa).r);float nexjglq=abs(texture2D(kxojuqn,grcgaqn).r);float r=abs(texture2D(kxojuqn,aivzdyl).r);float br=abs(texture2D(kxojuqn,ghjihxm).r);float cmdovsh=0.0,lvsqdxk=0.0;if(srlpklr==0){cmdovsh=qjaokbc+mfvvztb*2.0+mwrazgy-nexjglq-r*2.0-br;lvsqdxk=qjaokbc+t*2.0+nexjglq-mwrazgy-b*2.0-br;}else {cmdovsh=qjaokbc*3.0+mfvvztb*10.0+mwrazgy*3.0-nexjglq*3.0-r*10.0-br*3.0;lvsqdxk=qjaokbc*3.0+t*10.0+nexjglq*3.0-mwrazgy*3.0-b*10.0-br*3.0;}vec4 rytvcde=vec4 (normalize(vec3 (cmdovsh*ujvburc*ggsxpsx*255.0,lvsqdxk*cxpqetb*ggsxpsx*255.0,orbpagv)),1);gl_FragColor=(wtcqvmf==0)?vec4 (rytvcde.xy*0.5+0.5,rytvcde.zw):vec4 (rytvcde.xyz*0.5+0.5,rytvcde.w);}",
fragmentShaderTextureFilterHue:"uniform sampler2D kxojuqn;uniform float axeqzlu;uniform vec2 qxxpdff;varying vec2 arrvbbr;float brhvcmq(vec3 nsstwqm){return 0.299*nsstwqm.r+0.587*nsstwqm.g+0.114*nsstwqm.b;}vec4 lmymseh(sampler2D nmlmkmt,vec2 plnwnit,vec2 uyxiwjv){return texture2D(nmlmkmt,plnwnit+uyxiwjv);}vec3 ycddoqb(vec3 splrifm){vec4 eircrya=vec4 (0.0,-1.0/3.0,2.0/3.0,-1.0);vec4 p=mix(vec4 (splrifm.bg,eircrya.wz),vec4 (splrifm.gb,eircrya.xy),step(splrifm.b,splrifm.g));vec4 zrcochy=mix(vec4 (p.xyw,splrifm.r),vec4 (splrifm.r,p.yzx),step(p.x,splrifm.r));float epbwege=zrcochy.x-min(zrcochy.w,zrcochy.y);float nsvbngn=0.0000000001;return vec3 (abs(zrcochy.z+(zrcochy.w-zrcochy.y)/(6.0*epbwege+nsvbngn)),epbwege/(zrcochy.x+nsvbngn),zrcochy.x);}vec3 lsfuboz(vec3 splrifm){vec4 eircrya=vec4 (1.0,2.0/3.0,1.0/3.0,3.0);vec3 p=abs(fract(splrifm.xxx+eircrya.xyz)*6.0-eircrya.www);return splrifm.z*mix(eircrya.xxx,clamp(p-eircrya.xxx,0.0,1.0),splrifm.y);}void main(){vec4 rknhdjh=lmymseh(kxojuqn,arrvbbr,vec2 (0));vec3 fxoelyv=ycddoqb(rknhdjh.rgb);fxoelyv.x=axeqzlu;gl_FragColor.rgb=lsfuboz(fxoelyv);gl_FragColor.a=rknhdjh.a;}",
fragmentShaderTextureFilterBlackAndWhite:"uniform sampler2D kxojuqn;uniform float axeqzlu;uniform vec2 qxxpdff;varying vec2 arrvbbr;float brhvcmq(vec3 nsstwqm){return 0.299*nsstwqm.r+0.587*nsstwqm.g+0.114*nsstwqm.b;}vec4 lmymseh(sampler2D nmlmkmt,vec2 plnwnit,vec2 uyxiwjv){return texture2D(nmlmkmt,plnwnit+uyxiwjv);}vec3 ycddoqb(vec3 splrifm){vec4 eircrya=vec4 (0.0,-1.0/3.0,2.0/3.0,-1.0);vec4 p=mix(vec4 (splrifm.bg,eircrya.wz),vec4 (splrifm.gb,eircrya.xy),step(splrifm.b,splrifm.g));vec4 zrcochy=mix(vec4 (p.xyw,splrifm.r),vec4 (splrifm.r,p.yzx),step(p.x,splrifm.r));float epbwege=zrcochy.x-min(zrcochy.w,zrcochy.y);float nsvbngn=0.0000000001;return vec3 (abs(zrcochy.z+(zrcochy.w-zrcochy.y)/(6.0*epbwege+nsvbngn)),epbwege/(zrcochy.x+nsvbngn),zrcochy.x);}vec3 lsfuboz(vec3 splrifm){vec4 eircrya=vec4 (1.0,2.0/3.0,1.0/3.0,3.0);vec3 p=abs(fract(splrifm.xxx+eircrya.xyz)*6.0-eircrya.www);return splrifm.z*mix(eircrya.xxx,clamp(p-eircrya.xxx,0.0,1.0),splrifm.y);}void main(){vec4 rknhdjh=lmymseh(kxojuqn,arrvbbr,vec2 (0));if(axeqzlu==1.0){gl_FragColor.rgb=vec3 (0.21*rknhdjh.r+0.72*rknhdjh.g+0.07*rknhdjh.b);}if(axeqzlu==2.0){gl_FragColor.rgb=vec3 (brhvcmq(rknhdjh.rgb));}if(axeqzlu==3.0){float uuxsjad=(rknhdjh.r+rknhdjh.g+rknhdjh.b)/3.0;gl_FragColor.rgb=vec3 (uuxsjad);}if(axeqzlu==4.0){gl_FragColor.rgb=vec3 ((max(rknhdjh.r,max(rknhdjh.g,rknhdjh.b))+min(rknhdjh.r,max(rknhdjh.g,rknhdjh.b)))/2.0);}if(axeqzlu==5.0){gl_FragColor.rgb=vec3 (0.393*rknhdjh.r+0.769*rknhdjh.g+0.189*rknhdjh.b,0.349*rknhdjh.r+0.686*rknhdjh.g+0.168*rknhdjh.b,0.272*rknhdjh.r+0.534*rknhdjh.g+0.131*rknhdjh.b);}gl_FragColor.a=rknhdjh.a;}",
fragmentShaderTextureFilterGraining:"uniform sampler2D kxojuqn;uniform float axeqzlu;uniform float udfzxlx;uniform vec2 qxxpdff;varying vec2 arrvbbr;vec4 lmymseh(sampler2D nmlmkmt,vec2 plnwnit,vec2 uyxiwjv){return texture2D(nmlmkmt,plnwnit+uyxiwjv);}vec3 bxyjxsf289(vec3 x){return x-floor(x*(1.0/289.0))*289.0;}vec4 bxyjxsf289(vec4 x){return x-floor(x*(1.0/289.0))*289.0;}vec4 kakesgf(vec4 x){return bxyjxsf289(((x*34.0)+1.0)*x);}vec4 xdqhmog(vec4 r){return 1.79284291400159-0.85373472095314*r;}vec3 mqqauir(vec3 t){return t*t*t*(t*(t*6.0-15.0)+10.0);}float pcamzca(vec3 tdiccyz,vec3 xbcclpd){vec3 kyjsigc0=mod(floor(tdiccyz),xbcclpd);vec3 kyjsigc1=mod(kyjsigc0+vec3 (1.0),xbcclpd);kyjsigc0=bxyjxsf289(kyjsigc0);kyjsigc1=bxyjxsf289(kyjsigc1);vec3 pnehsfa0=fract(tdiccyz);vec3 pnehsfa1=pnehsfa0-vec3 (1.0);vec4 iadwkcd=vec4 (kyjsigc0.x,kyjsigc1.x,kyjsigc0.x,kyjsigc1.x);vec4 gkrfhpv=vec4 (kyjsigc0.yy,kyjsigc1.yy);vec4 ldudbhp0=kyjsigc0.zzzz;vec4 ldudbhp1=kyjsigc1.zzzz;vec4 begcuus=kakesgf(kakesgf(iadwkcd)+gkrfhpv);vec4 begcuus0=kakesgf(begcuus+ldudbhp0);vec4 begcuus1=kakesgf(begcuus+ldudbhp1);vec4 cphvhld0=begcuus0*(1.0/7.0);vec4 qnrgnkg0=fract(floor(cphvhld0)*(1.0/7.0))-0.5;cphvhld0=fract(cphvhld0);vec4 xczubhw0=vec4 (0.5)-abs(cphvhld0)-abs(qnrgnkg0);vec4 qbdjwkh0=step(xczubhw0,vec4 (0.0));cphvhld0-=qbdjwkh0*(step(0.0,cphvhld0)-0.5);qnrgnkg0-=qbdjwkh0*(step(0.0,qnrgnkg0)-0.5);vec4 cphvhld1=begcuus1*(1.0/7.0);vec4 qnrgnkg1=fract(floor(cphvhld1)*(1.0/7.0))-0.5;cphvhld1=fract(cphvhld1);vec4 xczubhw1=vec4 (0.5)-abs(cphvhld1)-abs(qnrgnkg1);vec4 qbdjwkh1=step(xczubhw1,vec4 (0.0));cphvhld1-=qbdjwkh1*(step(0.0,cphvhld1)-0.5);qnrgnkg1-=qbdjwkh1*(step(0.0,qnrgnkg1)-0.5);vec3 g000=vec3 (cphvhld0.x,qnrgnkg0.x,xczubhw0.x);vec3 g100=vec3 (cphvhld0.y,qnrgnkg0.y,xczubhw0.y);vec3 g010=vec3 (cphvhld0.z,qnrgnkg0.z,xczubhw0.z);vec3 g110=vec3 (cphvhld0.w,qnrgnkg0.w,xczubhw0.w);vec3 g001=vec3 (cphvhld1.x,qnrgnkg1.x,xczubhw1.x);vec3 g101=vec3 (cphvhld1.y,qnrgnkg1.y,xczubhw1.y);vec3 g011=vec3 (cphvhld1.z,qnrgnkg1.z,xczubhw1.z);vec3 g111=vec3 (cphvhld1.w,qnrgnkg1.w,xczubhw1.w);vec4 tipywwk0=xdqhmog(vec4 (dot(g000,g000),dot(g010,g010),dot(g100,g100),dot(g110,g110)));g000*=tipywwk0.x;g010*=tipywwk0.y;g100*=tipywwk0.z;g110*=tipywwk0.w;vec4 tipywwk1=xdqhmog(vec4 (dot(g001,g001),dot(g011,g011),dot(g101,g101),dot(g111,g111)));g001*=tipywwk1.x;g011*=tipywwk1.y;g101*=tipywwk1.z;g111*=tipywwk1.w;float invgiul000=dot(g000,pnehsfa0);float invgiul100=dot(g100,vec3 (pnehsfa1.x,pnehsfa0.yz));float invgiul010=dot(g010,vec3 (pnehsfa0.x,pnehsfa1.y,pnehsfa0.z));float invgiul110=dot(g110,vec3 (pnehsfa1.xy,pnehsfa0.z));float invgiul001=dot(g001,vec3 (pnehsfa0.xy,pnehsfa1.z));float invgiul101=dot(g101,vec3 (pnehsfa1.x,pnehsfa0.y,pnehsfa1.z));float invgiul011=dot(g011,vec3 (pnehsfa0.x,pnehsfa1.yz));float invgiul111=dot(g111,pnehsfa1);vec3 mlduocw=mqqauir(pnehsfa0);vec4 qhdadvq=mix(vec4 (invgiul000,invgiul100,invgiul010,invgiul110),vec4 (invgiul001,invgiul101,invgiul011,invgiul111),mlduocw.z);vec2 lgbsqyu=mix(qhdadvq.xy,qhdadvq.zw,mlduocw.y);float zphnfsw=mix(lgbsqyu.x,lgbsqyu.y,mlduocw.x);return 2.2*zphnfsw;}vec3 vfbreqm289(vec3 x){return x-floor(x*(1.0/289.0))*289.0;}vec4 vfbreqm289(vec4 x){return x-floor(x*(1.0/289.0))*289.0;}vec4 tvqweoo(vec4 x){return vfbreqm289(((x*34.0)+1.0)*x);}vec4 qjoeqsf(vec4 r){return 1.79284291400159-0.85373472095314*r;}float yahyxod(vec3 cyxmscz){const vec2 rcyoqfm=vec2 (1.0/6.0,1.0/3.0);const vec4 rovpwul=vec4 (0.0,0.5,1.0,2.0);vec3 myfjpxu=floor(cyxmscz+dot(cyxmscz,rcyoqfm.yyy));vec3 x0=cyxmscz-myfjpxu+dot(myfjpxu,rcyoqfm.xxx);vec3 g=step(x0.yzx,x0.xyz);vec3 mfvvztb=1.0-g;vec3 myfjpxu1=min(g.xyz,mfvvztb.zxy);vec3 myfjpxu2=max(g.xyz,mfvvztb.zxy);vec3 x1=x0-myfjpxu1+rcyoqfm.xxx;vec3 x2=x0-myfjpxu2+rcyoqfm.yyy;vec3 x3=x0-rovpwul.yyy;myfjpxu=vfbreqm289(myfjpxu);vec4 p=tvqweoo(tvqweoo(tvqweoo(myfjpxu.z+vec4 (0.0,myfjpxu1.z,myfjpxu2.z,1.0))+myfjpxu.y+vec4 (0.0,myfjpxu1.y,myfjpxu2.y,1.0))+myfjpxu.x+vec4 (0.0,myfjpxu1.x,myfjpxu2.x,1.0));float yzazsyt=0.142857142857;vec3 gavbsuj=yzazsyt*rovpwul.wyz-rovpwul.xzx;vec4 nigyetq=p-49.0*floor(p*gavbsuj.z*gavbsuj.z);vec4 akkhfut=floor(nigyetq*gavbsuj.z);vec4 cevuuzj=floor(nigyetq-7.0*akkhfut);vec4 x=akkhfut*gavbsuj.x+gavbsuj.yyyy;vec4 y=cevuuzj*gavbsuj.x+gavbsuj.yyyy;vec4 mbrnmmb=1.0-abs(x)-abs(y);vec4 b0=vec4 (x.xy,y.xy);vec4 b1=vec4 (x.zw,y.zw);vec4 s0=floor(b0)*2.0+1.0;vec4 s1=floor(b1)*2.0+1.0;vec4 soejmnd=-step(mbrnmmb,vec4 (0.0));vec4 a0=b0.xzyw+s0.xzyw*soejmnd.xxyy;vec4 a1=b1.xzyw+s1.xzyw*soejmnd.zzww;vec3 p0=vec3 (a0.xy,mbrnmmb.x);vec3 p1=vec3 (a0.zw,mbrnmmb.y);vec3 p2=vec3 (a1.xy,mbrnmmb.z);vec3 p3=vec3 (a1.zw,mbrnmmb.w);vec4 tipywwk=qjoeqsf(vec4 (dot(p0,p0),dot(p1,p1),dot(p2,p2),dot(p3,p3)));p0*=tipywwk.x;p1*=tipywwk.y;p2*=tipywwk.z;p3*=tipywwk.w;vec4 bhvqlzp=max(0.6-vec4 (dot(x0,x0),dot(x1,x1),dot(x2,x2),dot(x3,x3)),0.0);bhvqlzp=bhvqlzp*bhvqlzp;return 42.0*dot(bhvqlzp*bhvqlzp,vec4 (dot(p0,x0),dot(p1,x1),dot(p2,x2),dot(p3,x3)));}float twazbkc(vec2 lvglthg,vec2 trxvstt,float cacrhjv,float giizmqn){vec2 qlpodwe=lvglthg*trxvstt;float uyxiwjv=yahyxod(vec3 (qlpodwe/giizmqn,cacrhjv));float invgiul1=pcamzca(vec3 (qlpodwe,uyxiwjv),vec3 (1.0/lvglthg*trxvstt,0.0));return invgiul1/2.0+0.5;}float twazbkc(vec2 lvglthg,vec2 trxvstt,float cacrhjv){return twazbkc(lvglthg,trxvstt,cacrhjv,2.5);}float twazbkc(vec2 lvglthg,vec2 trxvstt){return twazbkc(lvglthg,trxvstt,0.0);}vec3 ottapzj(vec3 xpvzhgh,vec3 pejzgoa){return mix(sqrt(xpvzhgh)*(2.0*pejzgoa-1.0)+2.0*xpvzhgh*(1.0-pejzgoa),2.0*xpvzhgh*pejzgoa+xpvzhgh*xpvzhgh*(1.0-2.0*pejzgoa),step(xpvzhgh,vec3 (0.5)));}float jzzbdmr(vec3 nsstwqm){return dot(nsstwqm,vec3 (0.299,0.587,0.114));}float jzzbdmr(vec4 nsstwqm){return dot(nsstwqm.rgb,vec3 (0.299,0.587,0.114));}void main(){vec4 rknhdjh=lmymseh(kxojuqn,arrvbbr,vec2 (0));float fpzlyvg=twazbkc(arrvbbr,qxxpdff*udfzxlx,1.0);gl_FragColor.rgb=mix(rknhdjh.rgb,rknhdjh.rgb*(1.0-fpzlyvg),axeqzlu);gl_FragColor.a=rknhdjh.a;}",
fragmentShaderTextureFilterCenterBlurring:"uniform sampler2D kxojuqn;uniform sampler2D hvsflvm;uniform float axeqzlu;uniform float udfzxlx;uniform float edbxxzp;uniform float juqaqzf;uniform float uvoonej;uniform float uvketbs;uniform vec2 qxxpdff;varying vec2 arrvbbr;float brhvcmq(vec3 nsstwqm){return 0.299*nsstwqm.r+0.587*nsstwqm.g+0.114*nsstwqm.b;}vec4 lmymseh(sampler2D nmlmkmt,vec2 plnwnit,vec2 uyxiwjv){return texture2D(nmlmkmt,plnwnit+uyxiwjv);}void main(){vec4 rknhdjh=lmymseh(kxojuqn,arrvbbr,vec2 (0));vec4 xwzbbvf=lmymseh(hvsflvm,arrvbbr,vec2 (0));vec2 pzjlshd=arrvbbr;vec2 pkkotcq=(pzjlshd-vec2 (juqaqzf,uvoonej))*2.0;if(uvketbs>1.0){pkkotcq[1]/=uvketbs;}else {pkkotcq[0]*=uvketbs;}float hxnmxob=length(vec3 (pkkotcq,0));if(hxnmxob<axeqzlu){gl_FragColor=rknhdjh;}else if(hxnmxob<udfzxlx){gl_FragColor=mix(rknhdjh,xwzbbvf,pow((hxnmxob-axeqzlu)/(udfzxlx-axeqzlu),edbxxzp));}else {gl_FragColor=xwzbbvf;}gl_FragColor.a=rknhdjh.a;}",
fragmentShaderTextureFilterBlending:"uniform sampler2D kxojuqn;uniform float axeqzlu;uniform float udfzxlx;uniform float edbxxzp;uniform float juqaqzf;varying vec2 arrvbbr;vec4 lmymseh(sampler2D nmlmkmt,vec2 plnwnit,vec2 uyxiwjv){return texture2D(nmlmkmt,plnwnit+uyxiwjv);}void main(){vec4 rknhdjh=lmymseh(kxojuqn,arrvbbr,vec2 (0));vec4 kvtouhw=vec4 (axeqzlu,udfzxlx,edbxxzp,juqaqzf);gl_FragColor=mix(kvtouhw,rknhdjh,rknhdjh.a);gl_FragColor.a=juqaqzf;}",fragmentShaderTextureFilterDilation:"uniform sampler2D kxojuqn;uniform vec2 qxxpdff;varying vec2 arrvbbr;vec4 lmymseh(sampler2D nmlmkmt,vec2 plnwnit,vec2 uyxiwjv){return texture2D(nmlmkmt,plnwnit+uyxiwjv);}void main(){vec4 rknhdjh=lmymseh(kxojuqn,arrvbbr,vec2 (0));if(rknhdjh.a<0.005){vec3 tzifnua;float lagcdrm=1.0;tzifnua=lmymseh(kxojuqn,arrvbbr,vec2 (-1.0/qxxpdff.x,0.0)).rgb;rknhdjh.rgb+=tzifnua;lagcdrm+=step(length(tzifnua),0.005);tzifnua=lmymseh(kxojuqn,arrvbbr,vec2 (1.0/qxxpdff.x,0.0)).rgb;rknhdjh.rgb+=tzifnua;lagcdrm+=step(length(tzifnua),0.005);tzifnua=lmymseh(kxojuqn,arrvbbr,vec2 (0.0,-1.0/qxxpdff.y)).rgb;rknhdjh.rgb+=tzifnua;lagcdrm+=step(length(tzifnua),0.005);tzifnua=lmymseh(kxojuqn,arrvbbr,vec2 (0.0,1.0/qxxpdff.y)).rgb;rknhdjh.rgb+=tzifnua;lagcdrm+=step(length(tzifnua),0.005);tzifnua=lmymseh(kxojuqn,arrvbbr,vec2 (-1.0/qxxpdff.x,-1.0/qxxpdff.y)).rgb;rknhdjh.rgb+=tzifnua;lagcdrm+=step(length(tzifnua),0.005);tzifnua=lmymseh(kxojuqn,arrvbbr,vec2 (1.0/qxxpdff.x,1.0/qxxpdff.y)).rgb;rknhdjh.rgb+=tzifnua;lagcdrm+=step(length(tzifnua),0.005);tzifnua=lmymseh(kxojuqn,arrvbbr,vec2 (1.0/qxxpdff.x,-1.0/qxxpdff.y)).rgb;rknhdjh.rgb+=tzifnua;lagcdrm+=step(length(tzifnua),0.005);tzifnua=lmymseh(kxojuqn,arrvbbr,vec2 (-1.0/qxxpdff.x,1.0/qxxpdff.y)).rgb;rknhdjh.rgb+=tzifnua;lagcdrm+=step(length(tzifnua),0.005);rknhdjh/=lagcdrm;}gl_FragColor=rknhdjh;}",
fragmentShaderTextureFilterCssGram1977:"uniform sampler2D kxojuqn;varying vec2 arrvbbr;vec4 lmymseh(sampler2D nmlmkmt,vec2 plnwnit,vec2 uyxiwjv){return texture2D(nmlmkmt,plnwnit+uyxiwjv);}vec3 ycddoqb(vec3 splrifm){vec4 eircrya=vec4 (0.0,-1.0/3.0,2.0/3.0,-1.0);vec4 p=mix(vec4 (splrifm.bg,eircrya.wz),vec4 (splrifm.gb,eircrya.xy),step(splrifm.b,splrifm.g));vec4 zrcochy=mix(vec4 (p.xyw,splrifm.r),vec4 (splrifm.r,p.yzx),step(p.x,splrifm.r));float epbwege=zrcochy.x-min(zrcochy.w,zrcochy.y);float nsvbngn=0.0000000001;return vec3 (abs(zrcochy.z+(zrcochy.w-zrcochy.y)/(6.0*epbwege+nsvbngn)),epbwege/(zrcochy.x+nsvbngn),zrcochy.x);}vec3 lsfuboz(vec3 splrifm){vec4 eircrya=vec4 (1.0,2.0/3.0,1.0/3.0,3.0);vec3 p=abs(fract(splrifm.xxx+eircrya.xyz)*6.0-eircrya.www);return splrifm.z*mix(eircrya.xxx,clamp(p-eircrya.xxx,0.0,1.0),splrifm.y);}vec4 tqthjxz(vec4 splrifm1,vec4 splrifm2){const vec4 cyxmscz1=vec4 (1.0);return mix(splrifm1,cyxmscz1-(cyxmscz1-splrifm1)*(cyxmscz1-splrifm2),splrifm2.a);}void main(){vec4 rknhdjh=lmymseh(kxojuqn,arrvbbr,vec2 (0));vec4 nsstwqm=vec4 (0.9529411764,0.4156862745,0.7372549019,0.3);rknhdjh.rgb=tqthjxz(rknhdjh,nsstwqm).rgb;const float cfqiazh=1.1;rknhdjh.rgb=clamp(vec3 (0.5)+vec3 (cfqiazh)*(rknhdjh.rgb-vec3 (0.5)),0.0,1.0);rknhdjh.rgb*=vec3 (1.1);vec3 fxoelyv=ycddoqb(rknhdjh.rgb);fxoelyv.y*=1.3;rknhdjh.rgb=lsfuboz(fxoelyv);gl_FragColor=rknhdjh;}",
fragmentShaderTextureFilterCssGramInkwell:"uniform sampler2D kxojuqn;varying vec2 arrvbbr;float brhvcmq(vec3 nsstwqm){return 0.299*nsstwqm.r+0.587*nsstwqm.g+0.114*nsstwqm.b;}vec4 lmymseh(sampler2D nmlmkmt,vec2 plnwnit,vec2 uyxiwjv){return texture2D(nmlmkmt,plnwnit+uyxiwjv);}vec3 ycddoqb(vec3 splrifm){vec4 eircrya=vec4 (0.0,-1.0/3.0,2.0/3.0,-1.0);vec4 p=mix(vec4 (splrifm.bg,eircrya.wz),vec4 (splrifm.gb,eircrya.xy),step(splrifm.b,splrifm.g));vec4 zrcochy=mix(vec4 (p.xyw,splrifm.r),vec4 (splrifm.r,p.yzx),step(p.x,splrifm.r));float epbwege=zrcochy.x-min(zrcochy.w,zrcochy.y);float nsvbngn=0.0000000001;return vec3 (abs(zrcochy.z+(zrcochy.w-zrcochy.y)/(6.0*epbwege+nsvbngn)),epbwege/(zrcochy.x+nsvbngn),zrcochy.x);}vec3 lsfuboz(vec3 splrifm){vec4 eircrya=vec4 (1.0,2.0/3.0,1.0/3.0,3.0);vec3 p=abs(fract(splrifm.xxx+eircrya.xyz)*6.0-eircrya.www);return splrifm.z*mix(eircrya.xxx,clamp(p-eircrya.xxx,0.0,1.0),splrifm.y);}void main(){vec4 rknhdjh=lmymseh(kxojuqn,arrvbbr,vec2 (0));vec3 ugtjpxw=vec3 (0.393*rknhdjh.r+0.769*rknhdjh.g+0.189*rknhdjh.b,0.349*rknhdjh.r+0.686*rknhdjh.g+0.168*rknhdjh.b,0.272*rknhdjh.r+0.534*rknhdjh.g+0.131*rknhdjh.b);rknhdjh.rgb=mix(rknhdjh.rgb,ugtjpxw,0.3);const float cfqiazh=1.1;rknhdjh.rgb=clamp(vec3 (0.5)+vec3 (cfqiazh)*(rknhdjh.rgb-vec3 (0.5)),0.0,1.0);const float byuzntp=1.1;rknhdjh.rgb*=vec3 (byuzntp);gl_FragColor.rgb=vec3 (brhvcmq(rknhdjh.rgb));gl_FragColor.a=rknhdjh.a;}",
fragmentShaderTextureFilterCssGramNashville:"uniform sampler2D kxojuqn;varying vec2 arrvbbr;float brhvcmq(vec3 nsstwqm){return 0.299*nsstwqm.r+0.587*nsstwqm.g+0.114*nsstwqm.b;}vec4 lmymseh(sampler2D nmlmkmt,vec2 plnwnit,vec2 uyxiwjv){return texture2D(nmlmkmt,plnwnit+uyxiwjv);}vec3 ycddoqb(vec3 splrifm){vec4 eircrya=vec4 (0.0,-1.0/3.0,2.0/3.0,-1.0);vec4 p=mix(vec4 (splrifm.bg,eircrya.wz),vec4 (splrifm.gb,eircrya.xy),step(splrifm.b,splrifm.g));vec4 zrcochy=mix(vec4 (p.xyw,splrifm.r),vec4 (splrifm.r,p.yzx),step(p.x,splrifm.r));float epbwege=zrcochy.x-min(zrcochy.w,zrcochy.y);float nsvbngn=0.0000000001;return vec3 (abs(zrcochy.z+(zrcochy.w-zrcochy.y)/(6.0*epbwege+nsvbngn)),epbwege/(zrcochy.x+nsvbngn),zrcochy.x);}vec3 lsfuboz(vec3 splrifm){vec4 eircrya=vec4 (1.0,2.0/3.0,1.0/3.0,3.0);vec3 p=abs(fract(splrifm.xxx+eircrya.xyz)*6.0-eircrya.www);return splrifm.z*mix(eircrya.xxx,clamp(p-eircrya.xxx,0.0,1.0),splrifm.y);}vec4 vkfsgof(vec4 splrifm1,vec4 splrifm2){return mix(splrifm1,min(splrifm1,splrifm2),splrifm2.a);}vec4 bozuxld(vec4 splrifm1,vec4 splrifm2){return mix(splrifm1,max(splrifm1,splrifm2),splrifm2.a);}void main(){const vec4 qlsrqzs=vec4 (0.9686274509,0.6901960784,0.6,0.56);const vec4 goftbqv=vec4 (0.0,0.2745098039,0.5882352941,0.4);vec4 rknhdjh=lmymseh(kxojuqn,arrvbbr,vec2 (0));rknhdjh.rgb=vkfsgof(rknhdjh,qlsrqzs).rgb;rknhdjh.rgb=bozuxld(rknhdjh,goftbqv).rgb;vec3 ugtjpxw=vec3 (0.393*rknhdjh.r+0.769*rknhdjh.g+0.189*rknhdjh.b,0.349*rknhdjh.r+0.686*rknhdjh.g+0.168*rknhdjh.b,0.272*rknhdjh.r+0.534*rknhdjh.g+0.131*rknhdjh.b);rknhdjh.rgb=mix(rknhdjh.rgb,ugtjpxw,0.2);const float cfqiazh=1.2;const float byuzntp=1.05;const float tkejuel=1.2;rknhdjh.rgb=clamp(vec3 (0.5)+vec3 (cfqiazh)*(rknhdjh.rgb-vec3 (0.5)),0.0,1.0);rknhdjh.rgb*=vec3 (byuzntp);vec3 fxoelyv=ycddoqb(rknhdjh.rgb);fxoelyv.y*=tkejuel;rknhdjh.rgb=lsfuboz(fxoelyv);gl_FragColor=rknhdjh;}",
fragmentShaderTextureFilterCssGramMoon:"uniform sampler2D kxojuqn;varying vec2 arrvbbr;float brhvcmq(vec3 nsstwqm){return 0.299*nsstwqm.r+0.587*nsstwqm.g+0.114*nsstwqm.b;}vec4 lmymseh(sampler2D nmlmkmt,vec2 plnwnit,vec2 uyxiwjv){return texture2D(nmlmkmt,plnwnit+uyxiwjv);}vec3 ycddoqb(vec3 splrifm){vec4 eircrya=vec4 (0.0,-1.0/3.0,2.0/3.0,-1.0);vec4 p=mix(vec4 (splrifm.bg,eircrya.wz),vec4 (splrifm.gb,eircrya.xy),step(splrifm.b,splrifm.g));vec4 zrcochy=mix(vec4 (p.xyw,splrifm.r),vec4 (splrifm.r,p.yzx),step(p.x,splrifm.r));float epbwege=zrcochy.x-min(zrcochy.w,zrcochy.y);float nsvbngn=0.0000000001;return vec3 (abs(zrcochy.z+(zrcochy.w-zrcochy.y)/(6.0*epbwege+nsvbngn)),epbwege/(zrcochy.x+nsvbngn),zrcochy.x);}vec3 lsfuboz(vec3 splrifm){vec4 eircrya=vec4 (1.0,2.0/3.0,1.0/3.0,3.0);vec3 p=abs(fract(splrifm.xxx+eircrya.xyz)*6.0-eircrya.www);return splrifm.z*mix(eircrya.xxx,clamp(p-eircrya.xxx,0.0,1.0),splrifm.y);}vec4 bozuxld(vec4 splrifm1,vec4 splrifm2){return mix(splrifm1,max(splrifm1,splrifm2),splrifm2.a);}vec4 zspezrj(vec4 splrifm1,vec4 splrifm2){vec4 vrztzlh2=2.0*splrifm2;const vec4 cyxmscz1=vec4 (1);return mix(splrifm1,((cyxmscz1-vrztzlh2)*splrifm1*splrifm1)+(vrztzlh2*splrifm1),splrifm2.a);}float zrvfsvu(float a,float b){if(b<=0.5){return a-(1.0-2.0*b)*a*(1.0-a);}if(a<=0.25){return a+(2.0*b-1.0)*(((16.0*a-12.0)*a+4.0)*a-a);}return a+(2.0*b-1.0)*(sqrt(a)-a);}vec4 zrvfsvu(vec4 splrifm1,vec4 splrifm2){vec4 nsstwqm=vec4 (zrvfsvu(splrifm1.r,splrifm2.r),zrvfsvu(splrifm1.g,splrifm2.g),zrvfsvu(splrifm1.b,splrifm2.b),zrvfsvu(splrifm1.a,splrifm2.a));return mix(splrifm1,nsstwqm,splrifm2.a);}void main(){const vec4 qlsrqzs=vec4 (0.6274509803,0.6274509803,0.6274509803,1.0);const vec4 goftbqv=vec4 (0.2196078431,0.2196078431,0.2196078431,1.0);vec4 rknhdjh=lmymseh(kxojuqn,arrvbbr,vec2 (0));rknhdjh.rgb=zrvfsvu(rknhdjh,qlsrqzs).rgb;rknhdjh.rgb=bozuxld(rknhdjh,goftbqv).rgb;rknhdjh.rgb=vec3 (brhvcmq(rknhdjh.rgb));const float cfqiazh=1.1;const float byuzntp=1.1;rknhdjh.rgb=clamp(vec3 (0.5)+vec3 (cfqiazh)*(rknhdjh.rgb-vec3 (0.5)),0.0,1.0);rknhdjh.rgb*=vec3 (byuzntp);gl_FragColor=rknhdjh;}",
fragmentShaderTextureFilterCssGramWalden:"uniform sampler2D kxojuqn;varying vec2 arrvbbr;float brhvcmq(vec3 nsstwqm){return 0.299*nsstwqm.r+0.587*nsstwqm.g+0.114*nsstwqm.b;}vec4 lmymseh(sampler2D nmlmkmt,vec2 plnwnit,vec2 uyxiwjv){return texture2D(nmlmkmt,plnwnit+uyxiwjv);}vec3 ycddoqb(vec3 splrifm){vec4 eircrya=vec4 (0.0,-1.0/3.0,2.0/3.0,-1.0);vec4 p=mix(vec4 (splrifm.bg,eircrya.wz),vec4 (splrifm.gb,eircrya.xy),step(splrifm.b,splrifm.g));vec4 zrcochy=mix(vec4 (p.xyw,splrifm.r),vec4 (splrifm.r,p.yzx),step(p.x,splrifm.r));float epbwege=zrcochy.x-min(zrcochy.w,zrcochy.y);float nsvbngn=0.0000000001;return vec3 (abs(zrcochy.z+(zrcochy.w-zrcochy.y)/(6.0*epbwege+nsvbngn)),epbwege/(zrcochy.x+nsvbngn),zrcochy.x);}vec3 lsfuboz(vec3 splrifm){vec4 eircrya=vec4 (1.0,2.0/3.0,1.0/3.0,3.0);vec3 p=abs(fract(splrifm.xxx+eircrya.xyz)*6.0-eircrya.www);return splrifm.z*mix(eircrya.xxx,clamp(p-eircrya.xxx,0.0,1.0),splrifm.y);}vec4 tqthjxz(vec4 splrifm1,vec4 splrifm2){const vec4 cyxmscz1=vec4 (1.0);return mix(splrifm1,cyxmscz1-(cyxmscz1-splrifm1)*(cyxmscz1-splrifm2),splrifm2.a);}void main(){vec4 goftbqv=vec4 (0.0,0.2666666667,0.8,0.3);vec4 rknhdjh=lmymseh(kxojuqn,arrvbbr,vec2 (0));rknhdjh.rgb=tqthjxz(rknhdjh,goftbqv).rgb;const float byuzntp=1.1;const float tkejuel=1.6;rknhdjh.rgb*=vec3 (byuzntp);vec3 fxoelyv=ycddoqb(rknhdjh.rgb);fxoelyv.x-=0.0277777777;if(fxoelyv.x<0.0){fxoelyv.x+=1.0;}rknhdjh.rgb=lsfuboz(fxoelyv);vec3 ugtjpxw=vec3 (0.393*rknhdjh.r+0.769*rknhdjh.g+0.189*rknhdjh.b,0.349*rknhdjh.r+0.686*rknhdjh.g+0.168*rknhdjh.b,0.272*rknhdjh.r+0.534*rknhdjh.g+0.131*rknhdjh.b);rknhdjh.rgb=mix(rknhdjh.rgb,ugtjpxw,0.3);fxoelyv=ycddoqb(rknhdjh.rgb);fxoelyv.y*=tkejuel;rknhdjh.rgb=lsfuboz(fxoelyv);gl_FragColor=rknhdjh;}",
fragmentShaderTextureFilterTransform:"uniform sampler2D kxojuqn;uniform mat4 qezlvwh;varying vec2 arrvbbr;void main(){gl_FragColor=texture2D(kxojuqn,(qezlvwh*vec4 (arrvbbr,vec2 (0,1))).xy);}",fragmentShaderRGBEToFloat:"uniform sampler2D kxojuqn;varying vec2 arrvbbr;float llqgxfo(vec4 dgnhgdm){vec4 rgba=255.0*dgnhgdm;float sign=step(-128.0,-rgba[1])*2.0-1.0;float omivuvt=rgba[0]-127.0;if(abs(omivuvt+127.0)<0.001)return 0.0;float fadagpy=mod(rgba[1],128.0)*65536.0+rgba[2]*256.0+rgba[3]+(8388608.0);return sign*exp2(omivuvt-23.0)*fadagpy;}void main(){gl_FragColor=texture2D(kxojuqn,arrvbbr);if(arrvbbr.y<=0.125&&(arrvbbr.x<=0.25||arrvbbr.x>=0.875)){gl_FragColor.r=llqgxfo(gl_FragColor);gl_FragColor.gb=vec2 (0.0);}else {gl_FragColor.rgb*=pow(2.0,gl_FragColor.a*255.0-128.0);}gl_FragColor.a=1.0;}",
vertexShaderAntialiasing:"attribute vec3 ymaxekn;uniform mat4 ampnorz;uniform mat4 ghgsnpw;uniform vec2 qxxpdff;uniform vec2 wkmsbqd;varying vec2 aalpgqn;varying vec2 heahrxe;varying vec2 gmrkmys;varying vec2 rfumrwp;varying vec2 wsiyxfn;void mhhfyoz(vec2 mypgdnw,vec2 trxvstt, out vec2 aalpgqn, out vec2 heahrxe, out vec2 gmrkmys, out vec2 rfumrwp, out vec2 wsiyxfn){vec2 syfwziv=1.0/trxvstt.xy;aalpgqn=(mypgdnw+syfwziv*vec2 (-1.0,-1.0));heahrxe=(mypgdnw+syfwziv*vec2 (1.0,-1.0));gmrkmys=(mypgdnw+syfwziv*vec2 (-1.0,1.0));rfumrwp=(mypgdnw+syfwziv*vec2 (1.0,1.0));wsiyxfn=vec2 (mypgdnw);}void main(){gl_Position=ghgsnpw*ampnorz*vec4 (ymaxekn,1.0);vec2 knzahas=(ymaxekn.xy+1.0)/2.0;knzahas+=wkmsbqd.xy;mhhfyoz(knzahas,qxxpdff,aalpgqn,heahrxe,gmrkmys,rfumrwp,wsiyxfn);}",
fragmentShaderAntialiasing:"uniform sampler2D dkgckvl;uniform vec2 qxxpdff;uniform float mnxuvqf;uniform vec2 wkmsbqd;varying vec2 arrvbbr;varying vec2 aalpgqn;varying vec2 heahrxe;varying vec2 gmrkmys;varying vec2 rfumrwp;varying vec2 wsiyxfn;uniform vec2 mbfivoq;vec4 zaisnim(sampler2D nmlmkmt,vec2 mypgdnw,vec2 trxvstt,vec2 aalpgqn,vec2 heahrxe,vec2 gmrkmys,vec2 rfumrwp,vec2 wsiyxfn){vec4 nsstwqm;mediump vec2 syfwziv=vec2 (1.0/trxvstt.x,1.0/trxvstt.y);vec3 hrofaof=texture2D(nmlmkmt,aalpgqn).xyz;vec3 lmyfcaq=texture2D(nmlmkmt,heahrxe).xyz;vec3 fmlaqbj=texture2D(nmlmkmt,gmrkmys).xyz;vec3 rmckjmj=texture2D(nmlmkmt,rfumrwp).xyz;vec4 caynkex=texture2D(nmlmkmt,wsiyxfn);vec3 lgmkylp=caynkex.xyz;vec3 dlnrijk=vec3 (0.299,0.587,0.114);float auazfsy=dot(hrofaof,dlnrijk);float cmemacr=dot(lmyfcaq,dlnrijk);float hrfrfvy=dot(fmlaqbj,dlnrijk);float nrocwcd=dot(rmckjmj,dlnrijk);float ljylprc=dot(lgmkylp,dlnrijk);float cllncec=min(ljylprc,min(min(auazfsy,cmemacr),min(hrfrfvy,nrocwcd)));float ocsiufz=max(ljylprc,max(max(auazfsy,cmemacr),max(hrfrfvy,nrocwcd)));mediump vec2 hnnzgqv;hnnzgqv.x=-((auazfsy+cmemacr)-(hrfrfvy+nrocwcd));hnnzgqv.y=((auazfsy+hrfrfvy)-(cmemacr+nrocwcd));float oejxjfo=max((auazfsy+cmemacr+hrfrfvy+nrocwcd)*(0.25*0.125),0.0078125);float yjjvqgo=1.0/(min(abs(hnnzgqv.x),abs(hnnzgqv.y))+oejxjfo);hnnzgqv=min(vec2 (8.0,8.0),max(vec2 (-8.0,-8.0),hnnzgqv*yjjvqgo))*syfwziv;vec2 zvefbgn=1.0/(2.0*qxxpdff);vec2 iienjbe=wsiyxfn;vec2 iienjbe1=iienjbe+hnnzgqv*(1.0/3.0-0.5);iienjbe1=max(min(iienjbe1,mbfivoq-zvefbgn),vec2 (zvefbgn));vec2 iienjbe2=iienjbe+hnnzgqv*(2.0/3.0-0.5);iienjbe2=max(min(iienjbe2,mbfivoq-zvefbgn),vec2 (zvefbgn));vec2 iienjbe3=iienjbe+hnnzgqv*-0.5;iienjbe3=max(min(iienjbe3,mbfivoq-zvefbgn),vec2 (zvefbgn));vec2 iienjbe4=iienjbe+hnnzgqv*0.5;iienjbe4=max(min(iienjbe4,mbfivoq-zvefbgn),vec2 (zvefbgn));vec4 euvqhav=0.5*(texture2D(nmlmkmt,iienjbe1)+texture2D(nmlmkmt,iienjbe2));vec4 noqctju=euvqhav*0.5+0.25*(texture2D(nmlmkmt,iienjbe3)+texture2D(nmlmkmt,iienjbe4));float jzjodjy=dot(noqctju.xyz,dlnrijk);if((jzjodjy<cllncec)||(jzjodjy>ocsiufz)){nsstwqm=euvqhav;}else {nsstwqm=noqctju;}return nsstwqm;}void main(){gl_FragColor=mnxuvqf*zaisnim(dkgckvl,gl_FragCoord.xy/qxxpdff,qxxpdff,aalpgqn,heahrxe,gmrkmys,rfumrwp,wsiyxfn);}",
vertexShaderScreenTextureRendering:"attribute vec3 ymaxekn;uniform mat4 ampnorz;uniform mat4 ghgsnpw;varying vec2 arrvbbr;uniform vec2 wclpegx;uniform vec2 wkmsbqd;uniform vec2 ngzaxyh;uniform float tfrqoeu;void main(){gl_Position=ghgsnpw*ampnorz*vec4 (ymaxekn,1.0);arrvbbr=(-1.0/(2.0*ngzaxyh))+wkmsbqd.xy+wclpegx*(ymaxekn.xy+1.0)/(2.0);}",fragmentShaderScreenTextureRendering:"uniform sampler2D dkgckvl;uniform float mnxuvqf;uniform vec2 ngzaxyh;uniform vec2 qxxpdff;uniform vec2 wclpegx;uniform float zvecpmg;uniform vec2 yjwzvyh;varying vec2 arrvbbr;vec4 ocuzvbr(sampler2D t,vec2 sqosggl,vec2 uonxvxs){vec4 wkedvbl=texture2D(t,sqosggl);vec2 ppkdwez=fract(sqosggl*uonxvxs);float ufomryn=floor((uonxvxs.x*sqosggl.x))+0.5;float x1=max((ufomryn)/uonxvxs.x,0.0);float x2=min((ufomryn+1.0)/uonxvxs.x,wclpegx.x-(1.0/(2.0*ngzaxyh.x)));float ucuyfsv=floor((uonxvxs.y*sqosggl.y))+0.5;float y1=max((ucuyfsv)/uonxvxs.y,0.0);float y2=min((ucuyfsv+1.0)/uonxvxs.y,wclpegx.y-(1.0/(2.0*ngzaxyh.y)));vec4 qjaokbc=texture2D(t,vec2 (x1,y1));vec4 nexjglq=texture2D(t,vec2 (x2,y1));vec4 mwrazgy=texture2D(t,vec2 (x1,y2));vec4 br=texture2D(t,vec2 (x2,y2));vec4 urackns=mix(qjaokbc,nexjglq,ppkdwez.x);vec4 lsgibbm=mix(mwrazgy,br,ppkdwez.x);return mix(urackns,lsgibbm,ppkdwez.y);}vec3 ycddoqb(vec3 splrifm){vec4 eircrya=vec4 (0.0,-1.0/3.0,2.0/3.0,-1.0);vec4 p=mix(vec4 (splrifm.bg,eircrya.wz),vec4 (splrifm.gb,eircrya.xy),step(splrifm.b,splrifm.g));vec4 zrcochy=mix(vec4 (p.xyw,splrifm.r),vec4 (splrifm.r,p.yzx),step(p.x,splrifm.r));float epbwege=zrcochy.x-min(zrcochy.w,zrcochy.y);float nsvbngn=0.0000000001;return vec3 (abs(zrcochy.z+(zrcochy.w-zrcochy.y)/(6.0*epbwege+nsvbngn)),epbwege/(zrcochy.x+nsvbngn),zrcochy.x);}vec3 lsfuboz(vec3 splrifm){vec4 eircrya=vec4 (1.0,2.0/3.0,1.0/3.0,3.0);vec3 p=abs(fract(splrifm.xxx+eircrya.xyz)*6.0-eircrya.www);return splrifm.z*mix(eircrya.xxx,clamp(p-eircrya.xxx,0.0,1.0),splrifm.y);}float duaxbwb(vec2 p){vec2 eircrya1=vec2 (23.14069263277926,2.665144142690225);return fract(cos(dot(p,eircrya1))*12345.6789);}void main(){vec4 rgba=ocuzvbr(dkgckvl,arrvbbr,ngzaxyh);if(zvecpmg>0.0){if(rgba.a==1.0){vec3 fxoelyv=ycddoqb(rgba.rgb);vec2 werktrk=vec2 (arrvbbr);werktrk.y*=duaxbwb(vec2 (werktrk.y,yjwzvyh.x));fxoelyv.y*=mix(1.0-zvecpmg,1.0+zvecpmg,duaxbwb(werktrk));werktrk=vec2 (arrvbbr);werktrk.x*=duaxbwb(vec2 (werktrk.x,yjwzvyh.y));fxoelyv.z*=mix(1.0-zvecpmg,1.0+zvecpmg,duaxbwb(werktrk));rgba.rgb=lsfuboz(fxoelyv);}}gl_FragColor=mnxuvqf*rgba;}",
fragmentShaderBilinearRGBETexture2D:"\n #ifdef iaycquf\n float frexp(float x, out float nsvbngn){nsvbngn=ceil(log2(x));return (x*exp2(-nsvbngn));}vec4 vqwttjm(vec3 nsstwqm){float cyxmscz;float nsvbngn;cyxmscz=max(max(nsstwqm.r,nsstwqm.g),nsstwqm.b);if(cyxmscz<0.00000000000000000000000000000001){return vec4 (0,0,0,0);}cyxmscz=frexp(cyxmscz,nsvbngn)*256.0/cyxmscz;return vec4 ((nsstwqm.r*cyxmscz),(nsstwqm.g*cyxmscz),(nsstwqm.b*cyxmscz),(nsvbngn+128.0))/255.0;}vec4 lxxelki(vec4 nsstwqm){return vec4 (nsstwqm.rgb*pow(2.0,nsstwqm.a*255.0-128.0),1.0);}\n #endif \n \n #if defined(yrtntlf)&&defined(ntlghsr)\n float eqyhbyx( in vec2 kccqson){vec2 zehtpgv=(dFdx(kccqson));vec2 driityl=(dFdy(kccqson));float rswjrmt=max(dot(zehtpgv,zehtpgv),dot(driityl,driityl));return 0.5*log2(rswjrmt);}\n #endif \n vec4 fzlqxik( in sampler2D t, in vec2 sqosggl,float upokuis,float ktnvxcp){\n #ifndef iaycquf\n return texture2D(t,sqosggl,upokuis);\n #else \n \n #if defined(yrtntlf)&&defined(ntlghsr)\n float qarbafc=eqyhbyx(sqosggl)+upokuis;float szjjfhr=max(log2(ktnvxcp)+min(qarbafc,log2(ktnvxcp)),0.5);float ktnvxcp2=min(pow(2.0,log2(ktnvxcp)-floor(szjjfhr+1.0)),ktnvxcp);ktnvxcp=min(pow(2.0,log2(ktnvxcp)-floor(szjjfhr)),ktnvxcp);vec2 uonxvxs=vec2 (ktnvxcp);vec2 ppkdwez=fract(sqosggl*uonxvxs);float ufomryn=floor((ktnvxcp*sqosggl.x))+0.5;float x1=(ufomryn)/ktnvxcp;float x2=(ufomryn+1.0)/ktnvxcp;float ucuyfsv=floor((ktnvxcp*sqosggl.y))+0.5;float y1=(ucuyfsv)/ktnvxcp;float y2=(ucuyfsv+1.0)/ktnvxcp;vec4 qjaokbc=texture2DLodEXT(t,vec2 (x1,y1),szjjfhr-0.5);qjaokbc.rgb*=pow(2.0,qjaokbc.a*255.0-128.0);vec4 nexjglq=texture2DLodEXT(t,vec2 (x2,y1),szjjfhr-0.5);nexjglq.rgb*=pow(2.0,nexjglq.a*255.0-128.0);vec4 mwrazgy=texture2DLodEXT(t,vec2 (x1,y2),szjjfhr-0.5);mwrazgy.rgb*=pow(2.0,mwrazgy.a*255.0-128.0);vec4 br=texture2DLodEXT(t,vec2 (x2,y2),szjjfhr-0.5);br.rgb*=pow(2.0,br.a*255.0-128.0);vec4 urackns=mix(qjaokbc,nexjglq,ppkdwez.x);vec4 lsgibbm=mix(mwrazgy,br,ppkdwez.x);vec4 cbqkzho1=mix(urackns,lsgibbm,ppkdwez.y);vec2 uonxvxs2=vec2 (ktnvxcp2);vec2 ppkdwez2=fract(sqosggl*uonxvxs2);float ufomryn2=floor((ktnvxcp2*sqosggl.x))+0.5;float x12=(ufomryn2)/ktnvxcp2;float x22=(ufomryn2+1.0)/ktnvxcp2;float ucuyfsv2=floor((ktnvxcp2*sqosggl.y))+0.5;float y12=(ucuyfsv2)/ktnvxcp2;float y22=(ucuyfsv2+1.0)/ktnvxcp2;vec4 qjaokbc2=texture2DLodEXT(t,vec2 (x12,y12),szjjfhr+0.5);qjaokbc2.rgb*=pow(2.0,qjaokbc2.a*255.0-128.0);vec4 nexjglq2=texture2DLodEXT(t,vec2 (x22,y12),szjjfhr+0.5);nexjglq2.rgb*=pow(2.0,nexjglq2.a*255.0-128.0);vec4 mwrazgy2=texture2DLodEXT(t,vec2 (x12,y22),szjjfhr+0.5);mwrazgy2.rgb*=pow(2.0,mwrazgy2.a*255.0-128.0);vec4 br2=texture2DLodEXT(t,vec2 (x22,y22),szjjfhr+0.5);br2.rgb*=pow(2.0,br2.a*255.0-128.0);vec4 urackns2=mix(qjaokbc2,nexjglq2,ppkdwez2.x);vec4 lsgibbm2=mix(mwrazgy2,br2,ppkdwez2.x);vec4 cbqkzho2=mix(urackns2,lsgibbm2,ppkdwez2.y);return mix(cbqkzho1,cbqkzho2,fract(szjjfhr));\n #else \n vec2 uonxvxs=vec2 (ktnvxcp);vec2 ppkdwez=fract(sqosggl*uonxvxs);float ufomryn=floor((ktnvxcp*sqosggl.x))+0.5;float x1=(ufomryn)/ktnvxcp;float x2=(ufomryn+1.0)/ktnvxcp;float ucuyfsv=floor((ktnvxcp*sqosggl.y))+0.5;float y1=(ucuyfsv)/ktnvxcp;float y2=(ucuyfsv+1.0)/ktnvxcp;vec4 qjaokbc=texture2D(t,vec2 (x1,y1),upokuis);qjaokbc.rgb*=pow(2.0,qjaokbc.a*255.0-128.0);vec4 nexjglq=texture2D(t,vec2 (x2,y1),upokuis);nexjglq.rgb*=pow(2.0,nexjglq.a*255.0-128.0);vec4 mwrazgy=texture2D(t,vec2 (x1,y2),upokuis);mwrazgy.rgb*=pow(2.0,mwrazgy.a*255.0-128.0);vec4 br=texture2D(t,vec2 (x2,y2),upokuis);br.rgb*=pow(2.0,br.a*255.0-128.0);vec4 urackns=mix(qjaokbc,nexjglq,ppkdwez.x);vec4 lsgibbm=mix(mwrazgy,br,ppkdwez.x);return mix(urackns,lsgibbm,ppkdwez.y);\n #endif \n \n #endif \n }vec4 lnegrem( in sampler2D t, in vec2 sqosggl,float ktnvxcp){\n #ifndef iaycquf\n return texture2D(t,sqosggl);\n #else \n \n #if defined(yrtntlf)&&defined(ntlghsr)\n float qarbafc=eqyhbyx(sqosggl);float szjjfhr=max(log2(ktnvxcp)+min(qarbafc,log2(ktnvxcp)),0.5);float ktnvxcp2=min(pow(2.0,log2(ktnvxcp)-floor(szjjfhr+1.0)),ktnvxcp);ktnvxcp=min(pow(2.0,log2(ktnvxcp)-floor(szjjfhr)),ktnvxcp);vec2 uonxvxs=vec2 (ktnvxcp);vec2 ppkdwez=fract(sqosggl*uonxvxs);float ufomryn=floor((ktnvxcp*sqosggl.x))+0.5;float x1=(ufomryn)/ktnvxcp;float x2=(ufomryn+1.0)/ktnvxcp;float ucuyfsv=floor((ktnvxcp*sqosggl.y))+0.5;float y1=(ucuyfsv)/ktnvxcp;float y2=(ucuyfsv+1.0)/ktnvxcp;vec4 qjaokbc=texture2DLodEXT(t,vec2 (x1,y1),szjjfhr-0.5);qjaokbc.rgb*=pow(2.0,qjaokbc.a*255.0-128.0);vec4 nexjglq=texture2DLodEXT(t,vec2 (x2,y1),szjjfhr-0.5);nexjglq.rgb*=pow(2.0,nexjglq.a*255.0-128.0);vec4 mwrazgy=texture2DLodEXT(t,vec2 (x1,y2),szjjfhr-0.5);mwrazgy.rgb*=pow(2.0,mwrazgy.a*255.0-128.0);vec4 br=texture2DLodEXT(t,vec2 (x2,y2),szjjfhr-0.5);br.rgb*=pow(2.0,br.a*255.0-128.0);vec4 urackns=mix(qjaokbc,nexjglq,ppkdwez.x);vec4 lsgibbm=mix(mwrazgy,br,ppkdwez.x);vec4 cbqkzho1=mix(urackns,lsgibbm,ppkdwez.y);vec2 uonxvxs2=vec2 (ktnvxcp2);vec2 ppkdwez2=fract(sqosggl*uonxvxs2);float ufomryn2=floor((ktnvxcp2*sqosggl.x))+0.5;float x12=(ufomryn2)/ktnvxcp2;float x22=(ufomryn2+1.0)/ktnvxcp2;float ucuyfsv2=floor((ktnvxcp2*sqosggl.y))+0.5;float y12=(ucuyfsv2)/ktnvxcp2;float y22=(ucuyfsv2+1.0)/ktnvxcp2;vec4 qjaokbc2=texture2DLodEXT(t,vec2 (x12,y12),szjjfhr+0.5);qjaokbc2.rgb*=pow(2.0,qjaokbc2.a*255.0-128.0);vec4 nexjglq2=texture2DLodEXT(t,vec2 (x22,y12),szjjfhr+0.5);nexjglq2.rgb*=pow(2.0,nexjglq2.a*255.0-128.0);vec4 mwrazgy2=texture2DLodEXT(t,vec2 (x12,y22),szjjfhr+0.5);mwrazgy2.rgb*=pow(2.0,mwrazgy2.a*255.0-128.0);vec4 br2=texture2DLodEXT(t,vec2 (x22,y22),szjjfhr+0.5);br2.rgb*=pow(2.0,br2.a*255.0-128.0);vec4 urackns2=mix(qjaokbc2,nexjglq2,ppkdwez2.x);vec4 lsgibbm2=mix(mwrazgy2,br2,ppkdwez2.x);vec4 cbqkzho2=mix(urackns2,lsgibbm2,ppkdwez2.y);return mix(cbqkzho1,cbqkzho2,fract(szjjfhr));\n #else \n vec2 uonxvxs=vec2 (ktnvxcp);vec2 ppkdwez=clamp(fract(sqosggl*uonxvxs),vec2 (0.0),vec2 (1.0));float ufomryn=floor((ktnvxcp*sqosggl.x))+0.5;float x1=(ufomryn)/ktnvxcp;float x2=(ufomryn+1.0)/ktnvxcp;float ucuyfsv=floor((ktnvxcp*sqosggl.y))+0.5;float y1=(ucuyfsv)/ktnvxcp;float y2=(ucuyfsv+1.0)/ktnvxcp;vec4 qjaokbc=texture2D(t,vec2 (x1,y1));qjaokbc.rgb*=pow(2.0,qjaokbc.a*255.0-128.0);vec4 nexjglq=texture2D(t,vec2 (x2,y1));nexjglq.rgb*=pow(2.0,nexjglq.a*255.0-128.0);vec4 mwrazgy=texture2D(t,vec2 (x1,y2));mwrazgy.rgb*=pow(2.0,mwrazgy.a*255.0-128.0);vec4 br=texture2D(t,vec2 (x2,y2));br.rgb*=pow(2.0,br.a*255.0-128.0);vec4 urackns=mix(qjaokbc,nexjglq,ppkdwez.x);vec4 lsgibbm=mix(mwrazgy,br,ppkdwez.x);return mix(urackns,lsgibbm,ppkdwez.y);\n #endif \n \n #endif \n }vec4 fzlqxik( in sampler2D t, in vec2 sqosggl,float upokuis){return fzlqxik(t,sqosggl,upokuis,2048.0);}vec4 fzlqxik( in sampler2D t, in vec2 sqosggl){return fzlqxik(t,sqosggl,0.0);}",
vertexShaderNoiseRendering:"attribute vec3 ymaxekn;uniform mat4 ampnorz;uniform mat4 ghgsnpw;void main(){gl_Position=ghgsnpw*ampnorz*vec4 (ymaxekn,1.0);}",fragmentShaderNoiseRendering:"uniform sampler2D wwvyjhq;uniform float zvecpmg;uniform vec2 qxxpdff;uniform vec2 yjwzvyh;vec3 ycddoqb(vec3 splrifm){vec4 eircrya=vec4 (0.0,-1.0/3.0,2.0/3.0,-1.0);vec4 p=mix(vec4 (splrifm.bg,eircrya.wz),vec4 (splrifm.gb,eircrya.xy),step(splrifm.b,splrifm.g));vec4 zrcochy=mix(vec4 (p.xyw,splrifm.r),vec4 (splrifm.r,p.yzx),step(p.x,splrifm.r));float epbwege=zrcochy.x-min(zrcochy.w,zrcochy.y);float nsvbngn=0.0000000001;return vec3 (abs(zrcochy.z+(zrcochy.w-zrcochy.y)/(6.0*epbwege+nsvbngn)),epbwege/(zrcochy.x+nsvbngn),zrcochy.x);}vec3 lsfuboz(vec3 splrifm){vec4 eircrya=vec4 (1.0,2.0/3.0,1.0/3.0,3.0);vec3 p=abs(fract(splrifm.xxx+eircrya.xyz)*6.0-eircrya.www);return splrifm.z*mix(eircrya.xxx,clamp(p-eircrya.xxx,0.0,1.0),splrifm.y);}float duaxbwb(vec2 p){vec2 eircrya1=vec2 (23.14069263277926,2.665144142690225);return fract(cos(dot(p,eircrya1))*12345.6789);}void main(void ){vec2 sqosggl=gl_FragCoord.xy/qxxpdff;gl_FragColor=texture2D(wwvyjhq,sqosggl);if(gl_FragColor.a==1.0){vec3 fxoelyv=ycddoqb(gl_FragColor.rgb);vec2 werktrk=vec2 (sqosggl);werktrk.y*=duaxbwb(vec2 (werktrk.y,yjwzvyh.x));fxoelyv.y*=mix(1.0-zvecpmg,1.0+zvecpmg,duaxbwb(werktrk));werktrk=vec2 (sqosggl);werktrk.x*=duaxbwb(vec2 (werktrk.x,yjwzvyh.y));fxoelyv.z*=mix(1.0-zvecpmg,1.0+zvecpmg,duaxbwb(werktrk));gl_FragColor.rgb=lsfuboz(fxoelyv);}}",
vertexShaderScreenSpaceCopy:"attribute vec3 ymaxekn;uniform mat4 ampnorz;uniform mat4 ghgsnpw;void main(){gl_Position=ghgsnpw*ampnorz*vec4 (ymaxekn,1.0);}",fragmentShaderScreenSpaceCopy:"uniform sampler2D dkgckvl;uniform vec2 kfnexkv;void main(){gl_FragColor=texture2D(dkgckvl,gl_FragCoord.xy/kfnexkv);}",vertexGetDisplaceWorldFurVertex:"\n #ifdef igkhmka\n \n #ifndef WEBGL2 \n uniform int gbhvszb;\n #endif \n uniform mat3 nplkqwh;uniform float cooyzem;uniform float zjxvzlh;uniform float uiifavc;uniform vec2 wuexhah;varying float sggbywt;\n #ifdef fbfxphz\n uniform float ksceaxd;vec2 ivdqgrx(vec3 eqgubby){if(eqgubby.x==0.0&&eqgubby.y==0.0){return vec2 ((eqgubby.z<0.0)?3.141592653589793:0.0,0.0);}else {return vec2 (atan(length(eqgubby.xy),eqgubby.z),atan(eqgubby.y,eqgubby.x));}}vec3 ckxpfzi(vec2 tqnhsnp){return vec3 (sin(tqnhsnp.x)*cos(tqnhsnp.y),sin(tqnhsnp.x)*sin(tqnhsnp.y),cos(tqnhsnp.x));}float duaxbwb(vec2 p){vec2 eircrya1=vec2 (23.14069263277926,2.665144142690225);return fract(cos(dot(p,eircrya1))*12345.6789);}\n #endif \n vec4 kxmizmt(mat4 sjucpue){vec3 mgcyutv=nplkqwh*vec3 (0.0,-uiifavc,0.0);\n #ifdef WEBGL2 \n if(gl_InstanceID==0){sggbywt=0.0;}else if(gl_InstanceID==1&&wuexhah.x>0.15&&zjxvzlh>10.0){sggbywt=wuexhah.x/2.0;}else {sggbywt=wuexhah.x+(wuexhah.y*float (gl_InstanceID))/zjxvzlh;}\n #else \n if(gbhvszb==0){sggbywt=0.0;}else if(gbhvszb==1&&wuexhah.x>0.15&&zjxvzlh>10.0){sggbywt=wuexhah.x/2.0;}else {sggbywt=wuexhah.x+(wuexhah.y*float (gbhvszb))/zjxvzlh;}\n #endif \n float omsvjeq=length(nplkqwh[0]);float onhtdrv=length(nplkqwh[1]);float qbdjwkh=length(nplkqwh[2]);vec3 scale =vec3 (omsvjeq,onhtdrv,qbdjwkh);vec3 hpyohsn=mgcyutv/scale ;float mqawsdo=pow(sggbywt,3.0);vec3 qhzenuk=vec3 (pcgewnw);\n #ifdef fbfxphz\n vec2 obozlxs=ivdqgrx(qhzenuk);vec2 werktrk=vec2 (ymaxekn.xy);werktrk.y*=duaxbwb(vec2 (werktrk.y,fract(0.37815601901153206)));obozlxs.x+=mix(-ksceaxd*0.7,ksceaxd*0.7,duaxbwb(werktrk));werktrk=vec2 (ymaxekn.xy);werktrk.x*=duaxbwb(vec2 (werktrk.x,fract(0.9229055952093643)));obozlxs.y+=mix(-ksceaxd*0.7,ksceaxd*0.7,duaxbwb(werktrk));qhzenuk=normalize(ckxpfzi(obozlxs));\n #endif \n vec3 rytvcde=qhzenuk+hpyohsn*mqawsdo;return sjucpue*vec4 (ymaxekn+normalize(rytvcde)*scale *cooyzem*sggbywt,1.0);}\n #endif \n ",
fragmentManageFurData:"\n #ifdef igkhmka\n \n #ifndef apydemz\n uniform sampler2D txnfpqb;uniform int xdqgbxe;uniform mat4 hcysjhg;varying float sggbywt;\n #endif \n \n #if defined(qzginlu)||defined(ihmqnvu)\n uniform sampler2D maogpho;uniform int akywvcc;uniform mat4 tdzxeou;float xoybity(sampler2D nmlmkmt,int jodaqfw,mat4 rmigdnj);\n #endif \n \n #ifndef apydemz\n vec4 dplakee(sampler2D nmlmkmt,int jodaqfw,mat4 rmigdnj);\n #endif \n \n #if defined(nfnmtah)||defined(mizbbtu)||defined(kysfmtr)||defined(sxdobsb)||defined(tgjzqtl)||defined(mjhrplj)\n uniform float dcdsynq;float nlgcibn(vec2 p){return fract(sin(dot(p.xy,vec2 (12.9898,78.233)))*43758.5453123);}vec2 nlgcibn2(vec2 p){return fract(sin(vec2 (dot(p,vec2 (127.1,311.7)),dot(p,vec2 (269.5,183.3))))*43758.5453);}vec3 mod7(vec3 x){return x-floor(x*(1.0/7.0))*7.0;}vec4 mod289(vec4 x){return x-floor(x*(1.0/289.0))*289.0;}vec3 mod289(vec3 x){return x-floor(x*(1.0/289.0))*289.0;}vec2 mod289(vec2 x){return x-floor(x*(1.0/289.0))*289.0;}vec3 hfctjcm(vec3 x){return mod289(((x*34.0)+1.0)*x);}vec4 hfctjcm(vec4 x){return mod289(((x*34.0)+1.0)*x);}vec4 oiyrbeu(vec4 r){return 1.79284291400159-0.85373472095314*r;}vec2 khflovk(vec2 t){return t*t*t*(t*(t*6.0-15.0)+10.0);}float ycrmyyi(float mbrnmmb,float uyxiwjv){mbrnmmb=abs(mbrnmmb);mbrnmmb=uyxiwjv-mbrnmmb;mbrnmmb=mbrnmmb*mbrnmmb;return mbrnmmb;}float vgqnmku(vec2 cyxmscz){const vec4 rcyoqfm=vec4 (0.211324865405187,0.366025403784439,-0.577350269189626,0.024390243902439);vec2 myfjpxu=floor(cyxmscz+dot(cyxmscz,rcyoqfm.yy));vec2 x0=cyxmscz-myfjpxu+dot(myfjpxu,rcyoqfm.xx);vec2 myfjpxu1=vec2 (0.0);myfjpxu1=(x0.x>x0.y)?vec2 (1.0,0.0):vec2 (0.0,1.0);vec2 x1=x0.xy+rcyoqfm.xx-myfjpxu1;vec2 x2=x0.xy+rcyoqfm.zz;myfjpxu=mod289(myfjpxu);vec3 p=hfctjcm(hfctjcm(myfjpxu.y+vec3 (0.0,myfjpxu1.y,1.0))+myfjpxu.x+vec3 (0.0,myfjpxu1.x,1.0));vec3 bhvqlzp=max(0.5-vec3 (dot(x0,x0),dot(x1,x1),dot(x2,x2)),0.0);bhvqlzp=bhvqlzp*bhvqlzp;bhvqlzp=bhvqlzp*bhvqlzp;vec3 x=2.0*fract(p*rcyoqfm.www)-1.0;vec3 mbrnmmb=abs(x)-0.5;vec3 fvmgfai=floor(x+0.5);vec3 a0=x-fvmgfai;bhvqlzp*=1.79284291400159-0.85373472095314*(a0*a0+mbrnmmb*mbrnmmb);vec3 g=vec3 (0.0);g.x=a0.x*x0.x+mbrnmmb.x*x0.y;g.yz=a0.yz*vec2 (x1.x,x2.x)+mbrnmmb.yz*vec2 (x1.y,x2.y);return 130.0*dot(bhvqlzp,g);}float gzzmpsw(vec2 p)\n #endif \n \n #ifdef nfnmtah\n {vec2 myfjpxu=floor(p);vec2 ppkdwez=fract(p+vec2 (0.0,myfjpxu*nlgcibn(vec2 (0.125,myfjpxu.x))));float mfvvztb=length(ppkdwez-vec2 (0.5));float r=1.0-clamp(mfvvztb/0.5,0.0,1.0);return r;}\n #endif \n \n #ifdef mizbbtu\n {vec2 pppykyh=floor(p);vec2 rknlbrv=fract(p);float dvclcnt=1.;for(int y=-1;y<=1;y++){for(int x=-1;x<=1;x++){vec2 zqxmuan=vec2 (float (x),float (y));vec2 cwsppru=nlgcibn2(pppykyh+zqxmuan);vec2 cpafjbd=zqxmuan+cwsppru-rknlbrv;float srhkupd=length(cpafjbd);dvclcnt=min(dvclcnt,srhkupd);}}float r=1.0-clamp(dvclcnt,0.0,1.0);return r;}\n #endif \n \n #ifdef kysfmtr\n {float ierepwq=0.0;float frhgaas=0.7;for(int myfjpxu=0;myfjpxu<3;myfjpxu++){ierepwq+=frhgaas*abs(vgqnmku(p));p*=2.;frhgaas*=.5;}return ierepwq;}\n #endif \n \n #ifdef sxdobsb\n {float ovykzzr=2.0;float qzbbqkb=0.5;float uyxiwjv=0.9;float yurbcov=0.0;float qqryqdj=1.0,mwmhger=0.5;float myjkbbm=1.0;for(int myfjpxu=0;myfjpxu<3;myfjpxu++){float invgiul=ycrmyyi(vgqnmku(p*qqryqdj),uyxiwjv);yurbcov+=invgiul*mwmhger;yurbcov+=invgiul*mwmhger*myjkbbm;myjkbbm=invgiul;qqryqdj*=ovykzzr;mwmhger*=qzbbqkb;}return yurbcov;}\n #endif \n \n #ifdef tgjzqtl\n {vec2 kyjsigc=mod289(floor(p*2.0));vec2 pnehsfa=fract(p*2.0);vec3 cyosnxm=vec3 (-1.0,0.0,1.0);vec3 tjjudfe=vec3 (-0.5,0.5,1.5);vec3 phlwbis=hfctjcm(kyjsigc.x+cyosnxm);vec3 tdiccyz=hfctjcm(phlwbis.x+kyjsigc.y+cyosnxm);vec3 fvmgfai=fract(tdiccyz*0.142857142857)-0.428571428571;vec3 fmascho=mod7(floor(tdiccyz*0.142857142857))*0.142857142857-0.428571428571;vec3 cmdovsh=pnehsfa.x+0.5+fvmgfai;vec3 lvsqdxk=pnehsfa.y-tjjudfe+fmascho;vec3 epbwege1=cmdovsh*cmdovsh+lvsqdxk*lvsqdxk;tdiccyz=hfctjcm(phlwbis.y+kyjsigc.y+cyosnxm);fvmgfai=fract(tdiccyz*0.142857142857)-0.428571428571;fmascho=mod7(floor(tdiccyz*0.142857142857))*0.142857142857-0.428571428571;cmdovsh=pnehsfa.x-0.5+fvmgfai;lvsqdxk=pnehsfa.y-tjjudfe+fmascho;vec3 epbwege2=cmdovsh*cmdovsh+lvsqdxk*lvsqdxk;tdiccyz=hfctjcm(phlwbis.z+kyjsigc.y+cyosnxm);fvmgfai=fract(tdiccyz*0.142857142857)-0.428571428571;fmascho=mod7(floor(tdiccyz*0.142857142857))*0.142857142857-0.428571428571;cmdovsh=pnehsfa.x-1.5+fvmgfai;lvsqdxk=pnehsfa.y-tjjudfe+fmascho;vec3 epbwege3=cmdovsh*cmdovsh+lvsqdxk*lvsqdxk;vec3 ajpyvoa=min(epbwege1,epbwege2);epbwege2=max(epbwege1,epbwege2);epbwege2=min(epbwege2,epbwege3);epbwege1=min(ajpyvoa,epbwege2);epbwege2=max(ajpyvoa,epbwege2);epbwege1.xy=(epbwege1.x<epbwege1.y)?epbwege1.xy:epbwege1.yx;epbwege1.xz=(epbwege1.x<epbwege1.z)?epbwege1.xz:epbwege1.zx;epbwege1.yz=min(epbwege1.yz,epbwege2.yz);epbwege1.y=min(epbwege1.y,epbwege1.z);epbwege1.y=min(epbwege1.y,epbwege2.x);return (epbwege1.x+epbwege1.y)/2.0;}\n #endif \n \n #ifdef mjhrplj\n {p*=2.0;vec4 kyjsigc=floor(p.xyxy)+vec4 (0.0,0.0,1.0,1.0);vec4 pnehsfa=fract(p.xyxy)-vec4 (0.0,0.0,1.0,1.0);kyjsigc=mod289(kyjsigc);vec4 iadwkcd=kyjsigc.xzxz;vec4 gkrfhpv=kyjsigc.yyww;vec4 qzwnvyy=pnehsfa.xzxz;vec4 nckyazm=pnehsfa.yyww;vec4 myfjpxu=hfctjcm(hfctjcm(iadwkcd)+gkrfhpv);vec4 cphvhld=fract(myfjpxu*(1.0/41.0))*2.0-1.0;vec4 qnrgnkg=abs(cphvhld)-0.5;vec4 biliuom=floor(cphvhld+0.5);cphvhld=cphvhld-biliuom;vec2 g00=vec2 (cphvhld.x,qnrgnkg.x);vec2 g10=vec2 (cphvhld.y,qnrgnkg.y);vec2 g01=vec2 (cphvhld.z,qnrgnkg.z);vec2 g11=vec2 (cphvhld.w,qnrgnkg.w);vec4 tipywwk=oiyrbeu(vec4 (dot(g00,g00),dot(g01,g01),dot(g10,g10),dot(g11,g11)));g00*=tipywwk.x;g01*=tipywwk.y;g10*=tipywwk.z;g11*=tipywwk.w;float invgiul00=dot(g00,vec2 (qzwnvyy.x,nckyazm.x));float invgiul10=dot(g10,vec2 (qzwnvyy.y,nckyazm.y));float invgiul01=dot(g01,vec2 (qzwnvyy.z,nckyazm.z));float invgiul11=dot(g11,vec2 (qzwnvyy.w,nckyazm.w));vec2 fpgpoly=khflovk(pnehsfa.xy);vec2 dnpjjfy=mix(vec2 (invgiul00,invgiul01),vec2 (invgiul10,invgiul11),fpgpoly.x);float fnrescd=mix(dnpjjfy.x,dnpjjfy.y,fpgpoly.y);return clamp(2.3*fnrescd,0.1,1.0);}\n #endif \n \n #ifndef apydemz\n float diqkawh=1.0;\n #ifdef hidmyof\n float cjcgljz=0.0;\n #endif \n void qyngzog(){\n #ifdef qzginlu\n diqkawh=xoybity(maogpho,akywvcc,tdzxeou);\n #endif \n vec4 ycbvigf=dplakee(txnfpqb,xdqgbxe,hcysjhg);\n #if defined(nfnmtah)||defined(mizbbtu)||defined(kysfmtr)||defined(sxdobsb)||defined(tgjzqtl)||defined(mjhrplj)\n mat4 rmigdnj=mat4 (dcdsynq,0,0,0,0,dcdsynq,0,0,0,0,0,1,0,0,0,0);diqkawh=min(diqkawh,gzzmpsw(tiurzyf(xdqgbxe,rmigdnj).xy));\n #elif defined(ihmqnvu)\n diqkawh=min(diqkawh,texture2D(txnfpqb,tiurzyf(xdqgbxe,hcysjhg).xy).r);\n #endif \n diqkawh-=(1.0-ycbvigf.g)*diqkawh;\n #ifdef hidmyof\n cjcgljz=ycbvigf.b;\n #endif \n if(sggbywt>diqkawh){discard;}}\n #endif \n \n #endif \n ",
vertexShaderFurRendering:"uniform mat4 ondssmn;uniform mat4 ampnorz;uniform mat4 ghgsnpw;uniform vec3 xzwunne;varying vec3 ddgopyc;varying vec3 wnlnryx;varying float gdmedsd;void main(){vec4 wmxooao=kxmizmt(ondssmn);vec4 nkhgemj=ampnorz*wmxooao;gl_Position=ghgsnpw*nkhgemj;mat3 ccpxoqv=mat3 (ondssmn);mat3 dcsphyk=mat3 (ampnorz*ondssmn);gdmedsd=length(wmxooao.xyz-xzwunne);",fragmentShaderFurRendering:"varying vec3 ddgopyc;varying float gdmedsd;uniform vec2 hrispnv;uniform bool cfqxgas;uniform vec4 srrtdcb;void main(){qyngzog();if(cfqxgas){gl_FragColor=vec4 (vec3 (1.0-(gdmedsd-hrispnv.x)/(hrispnv.y-hrispnv.x)),1.0);}else {gl_FragColor=srrtdcb;}}",
vertexShaderMapSpace:"attribute vec2 ufoizoh;void main(){gl_Position.xy=(ufoizoh*2.0-vec2 (1.0));gl_Position.z=0.0;gl_Position.w=1.0;}",fragmentShaderGoldNoise:"uniform float yjwzvyh;float oqndijp( in vec2 xy, in float wjjvebv){return fract(tan(distance(xy*1.61803398874989484820459,xy)*wjjvebv)*xy.x);}void main(){float wjjvebv=fract(yjwzvyh);gl_FragColor=vec4 (oqndijp(gl_FragCoord.xy,wjjvebv+0.0),oqndijp(gl_FragCoord.xy,wjjvebv+0.1),oqndijp(gl_FragCoord.xy,wjjvebv+0.3),oqndijp(gl_FragCoord.xy,wjjvebv+0.4));}",
fragmentShaderSRGBTools:"const float aklzmny=0.00313066844250063;const float crexrrn=0.0404482362771082;const float wxtfsfy=2.2;float qsnypvh(float x){return x<aklzmny?x*12.92:1.055*pow(x,1.0/wxtfsfy)-0.055;}vec3 qsnypvh(vec3 nsstwqm){return vec3 (qsnypvh(nsstwqm.r),qsnypvh(nsstwqm.g),qsnypvh(nsstwqm.b));}vec4 qsnypvh(vec4 nsstwqm){return vec4 (qsnypvh(nsstwqm.rgb),nsstwqm.a);}float vwogtxa(float x){return x<crexrrn?x/12.92:pow((x+0.055)/1.055,wxtfsfy);}vec3 vwogtxa(vec3 nsstwqm){return vec3 (vwogtxa(nsstwqm.r),vwogtxa(nsstwqm.g),vwogtxa(nsstwqm.b));}vec4 vwogtxa(vec4 nsstwqm){return vec4 (vwogtxa(nsstwqm.rgb),nsstwqm.a);}",
fragmentShaderTextureMappingFunctions:"const vec3 eabbdii=vec3 (0.299,0.587,0.114);float udvupyw(vec4 caynkex,int qxsvhox){if(qxsvhox==1){return caynkex.r;}if(qxsvhox==2){return caynkex.g;}if(qxsvhox==3){return caynkex.b;}if(qxsvhox==4){return caynkex.a;}if(qxsvhox==5){return dot(eabbdii,caynkex.rgb);}return 0.0;}float brhvcmq(vec3 nsstwqm){return dot(eabbdii,nsstwqm);}vec4 ksahlqu(vec4 nsstwqm,float qxsvhox){if(qxsvhox==1.0){return vec4 (nsstwqm.rgb,1.0);}else if(qxsvhox==2.0){float splrifm=brhvcmq(nsstwqm.rgb);return vec4 (splrifm,splrifm,splrifm,1.0);}else if(qxsvhox==3.0){return vec4 (nsstwqm.rrr,1.0);}else if(qxsvhox==4.0){return vec4 (nsstwqm.ggg,1.0);}else if(qxsvhox==5.0){return vec4 (nsstwqm.bbb,1.0);}else if(qxsvhox==6.0){return vec4 (nsstwqm.aaa,1.0);}return nsstwqm;}vec4 lfaeqbh(vec4 nsstwqm,float kehztar,float qxsvhox){if(kehztar==1.0||kehztar==3.0){nsstwqm=vwogtxa(nsstwqm);}vec4 kaolhao=ksahlqu(nsstwqm,qxsvhox);return (kehztar>1.0)?vec4 (1.0)-kaolhao:kaolhao;}float jbiuodi(vec4 nsstwqm,float qxsvhox){if(qxsvhox==3.0){return nsstwqm.r;}else if(qxsvhox==4.0){return nsstwqm.g;}else if(qxsvhox==5.0){return nsstwqm.b;}else if(qxsvhox==6.0){return nsstwqm.a;}return brhvcmq(nsstwqm.rgb);}float mcqykbf(vec4 nsstwqm,float kehztar,float qxsvhox){if(kehztar==1.0||kehztar==3.0){nsstwqm=vwogtxa(nsstwqm);}float kaolhao=jbiuodi(nsstwqm,qxsvhox);return (kehztar>1.0)?1.0-kaolhao:kaolhao;}vec4 dplakee(sampler2D nmlmkmt,int jodaqfw,mat4 rmigdnj){float kehztar=rmigdnj[3][2];float qxsvhox=rmigdnj[3][3];rmigdnj[3][2]=0.0;rmigdnj[3][3]=1.0;return lfaeqbh(texture2D(nmlmkmt,tiurzyf(jodaqfw,rmigdnj).xy),kehztar,qxsvhox);}vec4 tmmbahj(sampler2D nmlmkmt,int jodaqfw,mat4 rmigdnj){float kehztar=rmigdnj[3][2];float qxsvhox=rmigdnj[3][3];rmigdnj[3][2]=0.0;rmigdnj[3][3]=1.0;vec3 plnwnit=tiurzyf(jodaqfw,rmigdnj);return step(plnwnit.z,0.5)*lfaeqbh(texture2D(nmlmkmt,plnwnit.xy),kehztar,qxsvhox);}vec4 dplakee(sampler2D nmlmkmt,int jodaqfw,mat4 rmigdnj,vec2 vdpdgla){float kehztar=rmigdnj[3][2];float qxsvhox=rmigdnj[3][3];rmigdnj[3][2]=0.0;rmigdnj[3][3]=1.0;return lfaeqbh(texture2D(nmlmkmt,tiurzyf(jodaqfw,rmigdnj).xy+vdpdgla),kehztar,qxsvhox);}vec4 tmmbahj(sampler2D nmlmkmt,int jodaqfw,mat4 rmigdnj,vec2 vdpdgla){float kehztar=rmigdnj[3][2];float qxsvhox=rmigdnj[3][3];rmigdnj[3][2]=0.0;rmigdnj[3][3]=1.0;vec3 plnwnit=tiurzyf(jodaqfw,rmigdnj);return step(plnwnit.z,0.5)*lfaeqbh(texture2D(nmlmkmt,plnwnit.xy+vdpdgla),kehztar,qxsvhox);}float xoybity(sampler2D nmlmkmt,int jodaqfw,mat4 rmigdnj){float kehztar=rmigdnj[3][2];float qxsvhox=rmigdnj[3][3];rmigdnj[3][2]=0.0;rmigdnj[3][3]=1.0;return mcqykbf(texture2D(nmlmkmt,tiurzyf(jodaqfw,rmigdnj).xy),kehztar,qxsvhox);}float rwbnecu(sampler2D nmlmkmt,int jodaqfw,mat4 rmigdnj){float kehztar=rmigdnj[3][2];float qxsvhox=rmigdnj[3][3];rmigdnj[3][2]=0.0;rmigdnj[3][3]=1.0;vec3 plnwnit=tiurzyf(jodaqfw,rmigdnj);return step(plnwnit.z,0.5)*mcqykbf(texture2D(nmlmkmt,plnwnit.xy),kehztar,qxsvhox);}float xoybity(sampler2D nmlmkmt,int jodaqfw,mat4 rmigdnj,vec2 vdpdgla){float kehztar=rmigdnj[3][2];float qxsvhox=rmigdnj[3][3];rmigdnj[3][2]=0.0;rmigdnj[3][3]=1.0;return mcqykbf(texture2D(nmlmkmt,tiurzyf(jodaqfw,rmigdnj).xy+vdpdgla),kehztar,qxsvhox);}float rwbnecu(sampler2D nmlmkmt,int jodaqfw,mat4 rmigdnj,vec2 vdpdgla){float kehztar=rmigdnj[3][2];float qxsvhox=rmigdnj[3][3];rmigdnj[3][2]=0.0;rmigdnj[3][3]=1.0;vec3 plnwnit=tiurzyf(jodaqfw,rmigdnj);return step(plnwnit.z,0.5)*mcqykbf(texture2D(nmlmkmt,plnwnit.xy+vdpdgla),kehztar,qxsvhox);}",
fragmentShaderDiscardTransparent:"uniform float bzmstcf;uniform float ymenuuk;uniform bool lilxxtl;uniform sampler2D bxddaze;uniform int avbfhlu;uniform mat4 imjkghn;\n #ifndef yjjmvdg\n uniform int uxqdzlm;\n #endif \n void mkwyenl(){float wrqbgeo;if(lilxxtl){\n #ifdef yjjmvdg\n wrqbgeo=bzmstcf*rwbnecu(bxddaze,avbfhlu,imjkghn);\n #else \n vec3 lxlmcsl=tiurzyf(avbfhlu,imjkghn);wrqbgeo=bzmstcf*step(lxlmcsl.z,0.5)*udvupyw(texture2D(bxddaze,lxlmcsl.xy),uxqdzlm);\n #endif \n }else {wrqbgeo=bzmstcf;}if(wrqbgeo<ymenuuk*0.995+0.005){discard;}}",
fragmentShaderFurMapBaking:"varying vec2 sqosggl;float ldqrcnr( in vec2 xy, in float wjjvebv){return fract(tan(distance(xy*1.61803398874989484820459,xy)*wjjvebv)*xy.x);}void main(){float wjjvebv=fract(0.4102037487633703);gl_FragColor=vec4 (gzzmpsw(sqosggl*dcdsynq),ldqrcnr(gl_FragCoord.xy,wjjvebv+0.1),ldqrcnr(gl_FragCoord.xy,wjjvebv+0.3),1.0);}",fragmentShaderArOccluder:"uniform mat3 kwxtxyk;uniform sampler2D sbyegvv;uniform sampler2D cnehorz;uniform sampler2D xpetrcl;uniform vec2 ywlbgmy;uniform float rhtkmtu;uniform float wlqtigw;float rqjrnlv=20.0;float raxgjru=20.0;float ciemaeq=0.65;float gzpxmek=0.4;void main(){vec2 nbhxdke=gl_FragCoord.xy/ywlbgmy;float mqttolj=0.0;float cqcsdib=0.0;if(rhtkmtu>=wlqtigw){cqcsdib=1.0-wlqtigw/rhtkmtu;}else {mqttolj=1.0-rhtkmtu/wlqtigw;}nbhxdke.x=(nbhxdke.x-0.5)*(1.0-mqttolj)+0.5;nbhxdke.y=(nbhxdke.y-0.5)*(1.0-cqcsdib)+0.5;vec4 divtwsm=texture2D(sbyegvv,nbhxdke);nbhxdke=vec2 (kwxtxyk*vec3 (nbhxdke,1.0));vec4 bgvlldi=texture2D(cnehorz,nbhxdke);vec4 garncsy=vec4 (0.0);vec4 jnoxprm=vec4 (0.0);vec4 yurbcov=vec4 (0.0);vec4 cruyxai=vec4 (0.0);vec2 qolqmzy=vec2 (0.0);int wkkwjdw=1;if(wkkwjdw==0){for(float myfjpxu=-rqjrnlv;myfjpxu<=rqjrnlv;myfjpxu++){qolqmzy=vec2 (nbhxdke.x+myfjpxu/ywlbgmy.x,nbhxdke.y);yurbcov+=texture2D(cnehorz,qolqmzy);cruyxai+=texture2D(xpetrcl,qolqmzy);}for(float nigyetq=-raxgjru;nigyetq<=raxgjru;nigyetq++){qolqmzy=vec2 (nbhxdke.x,nbhxdke.y+nigyetq/ywlbgmy.y);yurbcov+=texture2D(cnehorz,qolqmzy);cruyxai+=texture2D(xpetrcl,qolqmzy);}garncsy+=yurbcov/(2.0*rqjrnlv+1.0+2.0*raxgjru+1.0);jnoxprm+=cruyxai/(2.0*rqjrnlv+1.0+2.0*raxgjru+1.0);}if(wkkwjdw==1){yurbcov+=texture2D(cnehorz,vec2 (nbhxdke.x,nbhxdke.y));yurbcov+=texture2D(cnehorz,vec2 (nbhxdke.x+rqjrnlv/ywlbgmy.x,nbhxdke.y));yurbcov+=texture2D(cnehorz,vec2 (nbhxdke.x-rqjrnlv/ywlbgmy.x,nbhxdke.y));yurbcov+=texture2D(cnehorz,vec2 (nbhxdke.x,nbhxdke.y+raxgjru/ywlbgmy.y));yurbcov+=texture2D(cnehorz,vec2 (nbhxdke.x,nbhxdke.y-raxgjru/ywlbgmy.y));yurbcov+=texture2D(cnehorz,vec2 (nbhxdke.x+0.7*rqjrnlv/ywlbgmy.x,nbhxdke.y+0.7*raxgjru/ywlbgmy.y));yurbcov+=texture2D(cnehorz,vec2 (nbhxdke.x-0.7*rqjrnlv/ywlbgmy.x,nbhxdke.y+0.7*raxgjru/ywlbgmy.y));yurbcov+=texture2D(cnehorz,vec2 (nbhxdke.x+0.7*rqjrnlv/ywlbgmy.x,nbhxdke.y-0.7*raxgjru/ywlbgmy.y));yurbcov+=texture2D(cnehorz,vec2 (nbhxdke.x-0.7*rqjrnlv/ywlbgmy.x,nbhxdke.y-0.7*raxgjru/ywlbgmy.y));cruyxai+=texture2D(xpetrcl,vec2 (nbhxdke.x,nbhxdke.y));cruyxai+=texture2D(xpetrcl,vec2 (nbhxdke.x+rqjrnlv/ywlbgmy.x,nbhxdke.y));cruyxai+=texture2D(xpetrcl,vec2 (nbhxdke.x-rqjrnlv/ywlbgmy.x,nbhxdke.y));cruyxai+=texture2D(xpetrcl,vec2 (nbhxdke.x,nbhxdke.y+raxgjru/ywlbgmy.y));cruyxai+=texture2D(xpetrcl,vec2 (nbhxdke.x,nbhxdke.y-raxgjru/ywlbgmy.y));cruyxai+=texture2D(xpetrcl,vec2 (nbhxdke.x+0.7*rqjrnlv/ywlbgmy.x,nbhxdke.y+0.7*raxgjru/ywlbgmy.y));cruyxai+=texture2D(xpetrcl,vec2 (nbhxdke.x-0.7*rqjrnlv/ywlbgmy.x,nbhxdke.y+0.7*raxgjru/ywlbgmy.y));cruyxai+=texture2D(xpetrcl,vec2 (nbhxdke.x+0.7*rqjrnlv/ywlbgmy.x,nbhxdke.y-0.7*raxgjru/ywlbgmy.y));cruyxai+=texture2D(xpetrcl,vec2 (nbhxdke.x-0.7*rqjrnlv/ywlbgmy.x,nbhxdke.y-0.7*raxgjru/ywlbgmy.y));garncsy=yurbcov/9.0;jnoxprm=cruyxai/9.0;}garncsy=ciemaeq*garncsy+(1.0-ciemaeq)*jnoxprm;if(garncsy.x>=gzpxmek&&garncsy.y>=gzpxmek){gl_FragColor=divtwsm;}}"},
getShaderCode=function(b){return shaderScripts[b]};stage.provide("emersya.viewer.modules.renderer.shaders");stage.require("");
stage.register.call(stage.emersya.viewer.modules.renderer,"shaders",function(){var b,d={NEWSHADERTYPE:[0,1],FADEOUT:[0,2],DIFFUSE:[0,4],AMBIENT:[0,8],DIFFUSEAMBIENT:[0,16],SPECULAR:[0,32],SPECULAR_INTENSITY:[0,64],SPECULARGLOW:[0,128],EMISSIVE:[0,256],EMISSIVE_INTENSITY:[0,512],NORMAL:[0,1024],NORMAL_SCALE:[0,2048],LIGHT:[0,4096],LIGHT_COLOR:[0,8192],REFLECTION:[0,16384],REFRACTION:[0,32768],OPACITY:[0,65536],SPECULAR_ANISOTROPIC:[0,131072],IRIDESCENT:[0,262144],IRIDESCENT_INTENSITY:[0,524288],TRANSLUCENCY:[0,
1048576],TRANSLUCENCYMAP:[0,2097152],SHININESS:[0,4194304],REFLECTIONMAP:[0,8388608],REFRACTIONMAP:[0,16777216],ANIM_DIFFUSE:[0,33554432],ANIM_AMBIENT:[0,67108864],ANIM_DIFFUSEAMBIENT:[0,134217728],ANIM_SPECULAR:[0,268435456],ANIM_SPECULAR_INTENSITY:[0,536870912],ANIM_EMISSIVE:[0,1073741824],ANIM_EMISSIVE_INTENSITY:[0,2147483648],REFRACTION_CUBEMAP:[1,1],ANIM_NORMAL:[1,2],ANIM_NORMAL_SCALE:[1,4],ANIM_LIGHT:[1,8],ANIM_LIGHT_COLOR:[1,16],ANIM_REFLECTION:[1,32],ANIM_REFRACTION:[1,64],ANIM_OPACITY:[1,
128],ANIM_SPECULAR_ANISOTROPIC:[1,256],ANIM_IRIDESCENT:[1,512],ANIM_IRIDESCENT_INTENSITY:[1,1024],ANIM_TRANSLUCENCY:[1,2048],ANIM_TRANSLUCENCYMAP:[1,4096],ANIM_SHININESS:[1,8192],ANIM_REFLECTIONMAP:[1,16384],ANIM_REFRACTIONMAP:[1,32768],ANIMATING:[1,65536],OPACITYBLUR:[1,131072],PBR:[1,262144],PBR_ALBEDO_MAP:[1,524288],PBR_SPECULAR:[1,1048576],PBR_SPECULAR_MAP:[1,2097152],PBR_SPECULAR_INTENSITY:[1,4194304],PBR_ROUGHNESS_MAP:[1,8388608],PBR_METAL_MAP:[1,16777216],PBR_NORMAL_MAP:[1,33554432],PBR_BUMP_MAP:[1,
67108864],PBR_NORMAL_INTENSITY:[1,134217728],PBR_NORMAL_MAP2:[1,268435456],PBR_BUMP_MAP2:[1,536870912],PBR_NORMAL_INTENSITY2:[1,1073741824],PBR_EMISSIVE:[1,2147483648],ANIM_REFRACTION_CUBEMAP:[2,1],PBR_EMISSIVE_MAP:[2,2],PBR_AMBIENT_OCCLUSION:[2,4],PBR_AMBIENT_OCCLUSION_MAP:[2,8],PBR_LIGHT_OCCLUSION:[2,16],PBR_LIGHT_OCCLUSION_MAP:[2,32],PBR_OPACITY:[2,64],PBR_OPACITY_MAP:[2,128],PBR_IRIDESCENCE_INTENSITY:[2,256],PBR_LOCAL_ENVIRONMENT:[2,512],PBR_ANISOTROPY:[2,1024],PBR_ANISOTROPY_MAP:[2,2048],PBR_ANISOTROPY_INTENSITY_MAP:[2,
4096],PBR_ANISOTROPY_ROUGHNESS_MAP:[2,8192],PBR_ANISOTROPY_ROTATION_MAP:[2,16384],PBR_REFRACTION:[2,32768],PBR_COATING:[2,65536],PBR_COATING_INTENSITY_MAP:[2,131072],PBR_COATING_THICKNESS_MAP:[2,262144],PBR_COATING_ROUGHNESS_MAP:[2,524288],PBR_SHEEN:[2,1048576],PBR_SHEEN_MAP:[2,2097152],PBR_SHEEN_INTENSITY_MAP:[2,4194304],PBR_ANIM_ALBEDO:[2,8388608],PBR_ANIM_ALBEDO_MAP:[2,16777216],PBR_ANIM_SPECULAR:[2,33554432],PBR_ANIM_SPECULAR_MAP:[2,67108864],PBR_ANIM_SPECULAR_INTENSITY:[2,134217728],PBR_ANIM_ROUGHNESS:[2,
268435456],PBR_ANIM_ROUGHNESS_MAP:[2,536870912],PBR_ANIM_METAL:[2,1073741824],PBR_ANIM_METAL_MAP:[2,2147483648],PBR_REFRACTION_CUBEMAP:[3,1],PBR_ANIM_NORMAL_MAP:[3,2],PBR_ANIM_BUMP_MAP:[3,4],PBR_ANIM_NORMAL_INTENSITY:[3,8],PBR_ANIM_NORMAL_MAP2:[3,16],PBR_ANIM_BUMP_MAP2:[3,32],PBR_ANIM_NORMAL_INTENSITY2:[3,64],PBR_ANIM_EMISSIVE:[3,128],PBR_ANIM_EMISSIVE_MAP:[3,256],PBR_ANIM_AMBIENT_OCCLUSION:[3,512],PBR_ANIM_AMBIENT_OCCLUSION_MAP:[3,1024],PBR_ANIM_LIGHT_OCCLUSION:[3,2048],PBR_ANIM_LIGHT_OCCLUSION_MAP:[3,
4096],PBR_ANIM_OPACITY:[3,8192],PBR_ANIM_OPACITY_MAP:[3,16384],PBR_ANIM_IRIDESCENCE_INTENSITY:[3,32768],PBR_ANIM_ANISOTROPY:[3,65536],PBR_ANIM_ANISOTROPY_MAP:[3,131072],PBR_ANIM_ANISOTROPY_INTENSITY_MAP:[3,262144],PBR_ANIM_ANISOTROPY_ROUGHNESS_MAP:[3,524288],PBR_ANIM_ANISOTROPY_ROTATION_MAP:[3,1048576],PBR_ANIM_REFRACTION:[3,2097152],PBR_ANIM_COATING:[3,4194304],PBR_ANIM_COATING_INTENSITY_MAP:[3,8388608],PBR_ANIM_COATING_THICKNESS_MAP:[3,16777216],PBR_ANIM_COATING_ROUGHNESS_MAP:[3,33554432],PBR_ANIM_SHEEN:[3,
67108864],PBR_ANIM_SHEEN_MAP:[3,134217728],PBR_ANIM_SHEEN_INTENSITY_MAP:[3,268435456],PBR_ANIM_REFRACTION_CUBEMAP:[3,536870912],PBR_SPECULAR_FRESNEL_MODE:[3,1073741824],PBR_EMISSIVE_INTENSITY_MAP:[3,2147483648],PBR_ANIM_EMISSIVE_INTENSITY_MAP:[4,1],PBR_SHEEN_OLD_SHADER:[4,2],PBR_SHEEN_CUSTOM_ROUGHNESS:[4,4],PBR_SHEEN_ROUGHNESS_MAP:[4,8],PBR_ANIM_SHEEN_CUSTOM_ROUGHNESS:[4,16],PBR_ANIM_SHEEN_ROUGHNESS_MAP:[4,32],PBR_ENV_CUBES:[4,64],SCREENSPACE_REFRACTION:[4,128],SCREENSPACE_ROUGHNESS:[4,256],PBR_FUR:[4,
512],PBR_FUR_HAIRCUT_MAP:[4,1024],PBR_FUR_ROOT_MAP:[4,2048],PBR_FUR_DISPERSION:[4,4096],PBR_FUR_CLUMP_CERCLE:[4,8192],PBR_FUR_CLUMP_VORONOI:[4,16384],PBR_FUR_CLUMP_CELLULAR:[4,32768],PBR_FUR_CLUMP_TURBULENCE:[4,65536],PBR_FUR_CLUMP_RIDGE:[4,131072],PBR_FUR_CLUMP_PERLIN:[4,262144],PBR_FUR_CLUMP_TEXTURE:[4,524288],PBR_COATING_NORMAL_MAP:[4,1048576],PBR_ANIM_COATING_NORMAL_MAP:[4,2097152],PBR_CARPAINT:[4,4194304],PBR_CARPAINT_RGBE_BRDF_COLOR:[4,8388608],PBR_CARPAINT_RGBE_FLAKES_COLOR:[4,16777216],PBR_CARPAINT_FLAKES_MAP:[4,
33554432],PBR_IRIDESCENCE_F0:[5,0],PBR_IRIDESCENCE_AL:[6,0],PBR_ANIM_IRIDESCENCE_F0:[7,0],PBR_ANIM_IRIDESCENCE_AL:[8,0],PBR_CARPAINT_SPECULAR_LOBES_COUNT:[9,0],sdxjcre:[10,0],DIRECTIONALS:[11,0],SPOTS:[12,0],HEMISPHERICALS:[13,0],POINTS:[14,0],IBL:[15,0],TONEMAPPINGVERSION:[16,0],UVMAX:[17,0]},u=function(b){this.types=[];this.reset(b)};u.prototype.reset=function(b){for(var f=0;18>f;++f)this.types[f]=0;b&&(this.scene=new WeakRef(b),this.types[d.DIRECTIONALS[0]]=b.lights.directionals.length,this.types[d.SPOTS[0]]=
b.lights.spots.length,this.types[d.HEMISPHERICALS[0]]=b.lights.hemisphericals.length,this.types[d.POINTS[0]]=b.lights.points.length,this.types[d.IBL[0]]=b.lights.IBL?1:0,this.types[d.TONEMAPPINGVERSION[0]]=b.tonemapping.disabled?0:b.tonemapping.type,this.types[d.UVMAX[0]]=b.uvsrcs.length);this.val="";for(f=0;f<this.types.length;++f)this.val+=(this.types[f]&4294967295)+";"};u.prototype.has=function(b){return 4>=b[0]?this.types[b[0]]&b[1]:this.types[b[0]]};u.prototype.set=function(b,d){this.types[b[0]]=
4>=b[0]?void 0===d||d?this.types[b[0]]|b[1]:this.types[b[0]]&~b[1]:void 0!==d?d:!this.types[b[0]];this.val="";for(b=0;b<this.types.length;++b)this.val+=(this.types[b]&4294967295)+";"};u.prototype.value=function(){return this.val};u.prototype.clone=function(){var b=new u(this.scene.deref());b.types=[].concat(this.types);b.val="";for(var d=0;d<this.types.length;++d)b.val+=(this.types[d]&4294967295)+";";return b};u.prototype.binaryValue=function(){var b="",g;for(g in d)b+=this.types[d[g][0]]&d[g][1]?
1:0;return b};u.prototype.toString=function(){var b="",g;for(g in d)this.has(d[g])&&(b+=g+" ");return b};var k=function(d){b=d;this.maxVertexAttribs=b.getParameter(b.MAX_VERTEX_ATTRIBS);this.dynamicLights=stage.emersya.viewer.modules.renderer.lightsEditor?!0:!1;this.ymaxekn=0;this.pcgewnw=1;this.vertexTangentAttributeLoc=2;this.firstUvAttributeLoc=3;this.shaderProgramGoldNoise=this.shaderProgramArOccluder=this.shaderProgramFur=this.shaderProgramScreenSpaceCopy=this.shaderProgramNoise=this.shaderProgramScreenTexture=
this.shaderProgramAntialiasing=this.shaderProgramRGBEToFloat=this.shaderProgramTextureFilterTransform=this.shaderProgramTextureFilterCssGramWalden=this.shaderProgramTextureFilterCssGramMoon=this.shaderProgramTextureFilterCssGramNashville=this.shaderProgramTextureFilterCssGramInkwell=this.shaderProgramTextureFilterCssGram1977=this.shaderProgramTextureFilterDilation=this.shaderProgramTextureFilterBlending=this.shaderProgramTextureFilterCenterBlurring=this.shaderProgramTextureFilterGraining=this.shaderProgramTextureFilterBlackAndWhite=
this.shaderProgramTextureFilterHue=this.shaderProgramTextureFilterContrastAndBrightness=this.shaderProgramTextureFilterContrast=this.shaderProgramTextureFilterBrightness=this.shaderProgramMeshEditingRendering=this.shaderProgramWaterRendering=this.shaderProgramEnvironmentRenderingForCubeMap=this.shaderProgramEnvironmentRendering=this.shaderProgramCubeRendering=this.shaderProgramOneColor=this.shaderProgramTextureFilterHori7=this.shaderProgramTextureFilterVert7=this.shaderProgramTextureFilterHori6=this.shaderProgramTextureFilterVert6=
this.shaderProgramTextureFilterHori5=this.shaderProgramTextureFilterVert5=this.shaderProgramTextureFilterHori4=this.shaderProgramTextureFilterVert4=this.shaderProgramTextureFilterHori3=this.shaderProgramTextureFilterVert3=this.shaderProgramTextureFilterHori2=this.shaderProgramTextureFilterVert2=this.shaderProgramTextureFilterHori1=this.shaderProgramTextureFilterVert1=this.shaderProgramFiltering=this.shaderProgramSSAOFiltering=this.shaderProgramSSAO2PassFast=this.shaderProgramSSAO2Pass=this.shaderProgramSSAO1PassFast=
this.shaderProgramSSAO1Pass=this.shaderProgramSilhouettesFromShadow=this.shaderProgramSilhouettes=this.shaderProgramGlowRendering=this.shaderProgramFramerate=this.shaderProgramGooch=this.shaderProgramScreenSpaceDepth=this.shaderProgramDepthAndNormals=this.shaderProgramDepth=this.shaderProgramOpacityShadows=this.shaderProgramShadows=null;this.shadowsLocations={};this.depthLocations={};this.depthAndNormalsLocations={};this.screenSpaceDepthLocations={};this.goochLocations={};this.framerateLocations=
{};this.glowRenderingLocations={};this.silhouettesLocations={};this.silhouettesFromShadowLocations={};this.SSAOFilteringLocations={};this.filteringLocations={};this.textureFilterLocations={};this.oneColorLocations={};this.cubeRenderingLocations={};this.environmentRenderingLocations={};this.environmentRenderingForCubeMapLocations={};this.waterRenderingLocations={};this.meshEditingRenderingLocations={};this.RGBEToFloatLocations={};this.antialiasingLocations={};this.screenTextureLocations={};this.screenSpaceReflectLocations=
{};this.noiseLocations={};this.screenSpaceCopyLocations={};this.furLocations={};this.opacityShadowsLocations={};this.arOccluderLocations={};this.globalHeadInit="precision highp float;\n";if(b.webgl2)this.globalHeadInit="#version 300 es\n"+this.globalHeadInit,this.globalHeadInit+="#define WEBGL2\n",this.globalHeadInit+="#define texture2D texture\n",this.globalHeadInit+="#define texture2DLodEXT textureLod\n",this.globalHeadInit+="#define textureCube texture\n",b.floatTextures||(this.globalHeadInit+=
"#define iaycquf\n"),this.globalVertexHead="#define attribute in\n",this.globalVertexHead+="#define varying out\n",this.globalFragmentHead="#define varying in\n",this.globalFragmentHead+="#define gl_FragColor outColor\n",this.globalFragmentHead+="layout (location = 0) out vec4 outColor;\n";else{this.globalFragmentHead="";if(b.oesstddrv||b.gloesstddrv)this.globalFragmentHead+="#extension GL_OES_standard_derivatives : enable\n";b.floatTextures||(this.globalHeadInit+="#define iaycquf\n");this.globalHeadInit+=
"#define uint int\n";this.globalVertexHead=""}this.globalHead=this.globalHeadInit;this.filteringFragmentHead="";this.lightsHead="#define ttttpsh 0\n";this.shadowsHead="";this.typedShaders={};this.glowWritingShaders={};this.shaderTypesFromValue={};this.screenSpaceShaders={};this.furShaders={};this.frVertexBase=getShaderCode("vertexShaderRealRendering");this.frFragmentBase=getShaderCode("fragmentShaderRealRendering");this.pbrFrVertexBase=getShaderCode("vertexShaderPbrRendering");this.sRGBfragmentBase=
getShaderCode("fragmentShaderSRGBTools");this.textureMappingFragmentBase=getShaderCode("fragmentShaderTextureMappingFunctions");this.discardTransparentFragmentBase=getShaderCode("fragmentShaderDiscardTransparent");this.pbrFrFragmentBase=getShaderCode("fragmentShaderPbrRendering");this.frFragmentHead=this.frVertexTail=this.frVertexHead="";this.bilinearRGBETexture2D=getShaderCode("fragmentShaderBilinearRGBETexture2D");b.webgl2||b.floatTextures||!b.shadertexturelod?b.webgl2&&!b.floatTextures&&(this.bilinearRGBETexture2D=
"#define yrtntlf\n"+this.bilinearRGBETexture2D):(this.bilinearRGBETexture2D="#define yrtntlf\n"+this.bilinearRGBETexture2D,this.bilinearRGBETexture2D="#extension GL_EXT_shader_texture_lod : enable\n"+this.bilinearRGBETexture2D)};k.prototype.getTypes=function(){return d};k.prototype.generateLocations=function(d,g){g||(g=b);for(var f={},n=g.getProgramParameter(d,g.ACTIVE_UNIFORMS),k=0;k<n;++k){var l=g.getActiveUniform(d,k),q=l.name.replace("[0]","");f[q]={index:k,loc:g.getUniformLocation(d,q),type:l.type}}n=
g.getProgramParameter(d,g.ACTIVE_ATTRIBUTES);f.aUv={};f.aVertexTangent={};for(k=0;k<n;++k)l=g.getActiveAttrib(d,k),q=l.name.replace("[0]",""),0===q.indexOf("aUv")?f.aUv[parseInt(q.substring(3))]={index:k,loc:g.getAttribLocation(d,q),type:l.type}:0==q.indexOf("aVertexTangent")?f.aVertexTangent[parseInt(q.substring(14))]={index:k,loc:g.getAttribLocation(d,q),type:l.type}:f[q]={index:k,loc:g.getAttribLocation(d,q),type:l.type};return f};k.prototype.readHardwareLimitations=function(d){var f=0,g=0,k;for(k in d.materials){var l=
d.materials[k];if(l.type){var q={texCount:0,unifCount:8};l.albedo&&(l.albedo.texture&&(++q.texCount,q.unifCount+=8),l.albedo.specular&&(q.unifCount+=2,l.albedo.specular.texture&&(++q.texCount,q.unifCount+=1),l.albedo.specular.intensityTexture&&(++q.texCount,q.unifCount+=2)));l.roughness&&(l.roughness.texture&&(++q.texCount,q.unifCount+=8),l.roughness.sheen&&(q.unifCount+=2,l.roughness.sheen.texture&&(++q.texCount,q.unifCount+=1),l.roughness.sheen.intensityTexture&&(++q.texCount,q.unifCount+=8),l.roughness.sheen.customRoughness&&
(++q.unifCount,l.roughness.sheen.roughnessTexture&&(++q.texCount,q.unifCount+=8))));l.metalness&&l.metalness.texture&&(++q.texCount,q.unifCount+=8,l.metalness.anisotropy&&(q.unifCount+=1,l.metalness.anisotropy.texture&&(++q.texCount,q.unifCount+=8),l.metalness.anisotropy.intensityTexture&&(++q.texCount,q.unifCount+=8),l.metalness.anisotropy.roughnessTexture&&(++q.texCount,q.unifCount+=8),l.metalness.anisotropy.rotationTexture&&(++q.texCount,q.unifCount+=8)),l.metalness.carpaint&&(q.texCount+=3,q.unifCount+=
2+3*l.metalness.carpaint.specularLobeCount,q.unifCount+=5,b&&b.webgl2||(q.unifCount+=3),q.unifCount+=16));l.normalDeformation&&(l.normalDeformation.texture&&(++q.texCount,q.unifCount+=9,l.normalDeformation.intensityTexture&&(++q.texCount,q.unifCount+=9)),l.normalDeformation.texture2&&(++q.texCount,q.unifCount+=9,l.normalDeformation.intensityTexture2&&(++q.texCount,q.unifCount+=9)));l.emissive&&0<l.emissive.intensity&&(q.unifCount+=4,l.emissive.texture&&(++q.texCount,q.unifCount+=8),l.emissive.intensityTexture&&
(++q.texCount,q.unifCount+=8));l.occlusion&&(++q.unifCount,l.occlusion.ambientTexture&&(++q.texCount,q.unifCount+=8),++q.unifCount,l.occlusion.lightTexture&&(++q.texCount,q.unifCount+=8));l.opacity&&(q.unifCount+=1,l.opacity.texture&&(q.unifCount+=8,++q.texCount),"none"!==l.opacity.blur&&""!==l.opacity.blur&&++q.texCount,l.opacity.refraction&&(++q.texCount,q.unifCount+=8));l.translucency&&(q.unifCount+=1,l.translucency.texture&&(++q.texCount,q.unifCount+=1));l.localEnvironment&&(q.unifCount+=1);l.iridescence&&
(q.unifCount+=Math.ceil(1.25*l.iridescence.colormap.cursors.length)+1,l.iridescence.texture&&(++q.texCount,q.unifCount+=4));l.coating&&(q.unifCount+=6,l.coating.intensityTexture&&(++q.texCount,q.unifCount+=8),l.coating.thicknessTexture&&(++q.texCount,q.unifCount+=8),l.coating.roughnessTexture&&(++q.texCount,q.unifCount+=8),l.coating.normalTexture&&(++q.texCount,q.unifCount+=10));l=q}else q={texCount:0,unifCount:0},l.diffuse&&(q.unifCount+=2,l.diffuse.texture&&(++q.texCount,q.unifCount+=1)),l.ambient&&
(q.unifCount+=2,!l.ambient.diffuseColor&&l.ambient.texture&&(++q.texCount,q.unifCount+=1)),l.specular&&(q.unifCount+=2,l.specular.texture&&(++q.texCount,q.unifCount+=1),l.specular.intensityTexture&&(++q.texCount,q.unifCount+=2)),l.emissive&&(q.unifCount+=2,l.emissive.texture&&(++q.texCount,q.unifCount+=1),l.emissive.intensityTexture&&(++q.texCount,q.unifCount+=2)),l.shininess&&(q.unifCount+=1,l.shininess.texture&&(++q.texCount,q.unifCount+=2)),l.normalDeformation&&(l.normalDeformation.texture&&(++q.texCount,
q.unifCount+=2),l.normalDeformation.scaleTexture&&(++q.texCount,q.unifCount+=2)),l.specularAnisotropic&&l.specularAnisotropic.texture&&(++q.texCount,q.unifCount+=2),l.lightMap&&(l.lightMap.texture&&(++q.texCount,q.unifCount+=3),l.lightMap.colorTexture&&(++q.texCount,q.unifCount+=1)),l.opacity&&(q.unifCount+=1,l.opacity.texture&&(++q.texCount,q.unifCount+=1),"none"!==l.opacity.blur&&""!==l.opacity.blur&&++q.texCount),l.iridescent&&(l.iridescent.texture&&(++q.texCount,q.unifCount+=2),l.iridescent.intensityTexture&&
(++q.texCount,q.unifCount+=1)),l.translucency&&(q.unifCount+=1,l.translucency.texture&&(++q.texCount,q.unifCount+=1)),l.reflection&&(l.reflection.textureCube&&(++q.texCount,q.unifCount+=2),l.reflection.texture&&(++q.texCount,q.unifCount+=2)),l.refraction&&(l.refraction.textureCube&&(++q.texCount,q.unifCount+=2),l.refraction.texture&&(++q.texCount,q.unifCount+=2)),l=q;l.texCount>f&&(f=l.texCount);l.unifCount>g&&(g=l.unifCount)}(d.lights.IBL||d.scenery.environmentTexture)&&++f;if(f>b.getParameter(b.MAX_TEXTURE_IMAGE_UNITS))return stage.createError(206,
"Not enough texture units for materials.");if(Math.min((b.getParameter(b.MAX_VERTEX_ATTRIBS)-2)/2,(b.getParameter(b.MAX_VARYING_VECTORS)-3)/2)<this.uvsCount)return stage.createError(206,"Not enough vertex attribs for uvs.");this.maxDirShadows=Math.floor(2*(b.getParameter(b.MAX_VARYING_VECTORS)-6));if(d.lights.hasSomeDirShadow&&d.lights.directionals.length>this.maxDirShadows)return stage.createError(206,"Not enough vertex varying or uniforms for shadows.");this.maxShadowsFromTextures=b.getParameter(b.MAX_TEXTURE_IMAGE_UNITS)-
f;if(d.lights.hasSomeDirShadow&&d.lights.directionals.length>this.maxShadowsFromTextures)return stage.createError(206,"Not enough texture units for shadows.");f=15;d.mirrors.length&&(f+=6);g=1+3*d.lights.directionals.length;g+=5*d.lights.spots.length;g+=3*d.lights.hemisphericals.length;g+=3*d.lights.points.length;d.lights.IBL&&(g+=1);l=0;d.hasSomeShadow&&(l=6);d.lights.hasSomeDirShadow&&(g+=l*d.lights.directionals.length);d.lights.hasSomeSpotShadow&&(g+=l*d.lights.spots.length);d.baseUniformsSize=
f+g;f=b.getParameter(b.MAX_TEXTURE_SIZE);for(k in d.srcImages)if(g=d.srcImages[k],g.maxWidth>f||g.maxHeight>f)return stage.createError(206,"At least one image is too big for this browser.");f=b.getParameter(b.MAX_CUBE_MAP_TEXTURE_SIZE);for(k in d.texturesCube)if(d.texturesCube[k].posX.maxWidth>f)return stage.createError(206,"At least one cubemap is too big for this browser.");if(d.hasSomeShadow){f=b.getParameter(b.MAX_VIEWPORT_DIMS);for(k in d.lights.directionals)if(g=d.lights.directionals[k],g.shadow&&
(g.shadow.width>f[0]||g.shadow.height>f[1]))return stage.createError(206,"At least one shadow map is too big for this browser.");for(k in d.lights.spots)if(g=d.lights.spots[k],g.shadow&&(g.shadow.width>f[0]||g.shadow.height>f[1]))return stage.createError(206,"At least one shadow map is too big for this browser.")}d.renderingSettings.maxTextureUnits=b.getParameter(b.MAX_TEXTURE_IMAGE_UNITS);d.renderingSettings.maxUnifVectors=b.getParameter(b.MAX_FRAGMENT_UNIFORM_VECTORS);return stage.createResult(null)};
k.prototype.updateLightHead=function(d,g,k,l,q){if(0<g){g=!1;for(var f in d.directionals)if(d.directionals[f].shadow.darkness){g=!0;break}if(g&&b.getParameter(b.MAX_VARYING_VECTORS)-6<d.directionals.length/2)return!1}g=this.lightsHead;this.lightsHead="";l&&(this.lightsHead+="#define ntlghsr\n");if(d&&d.buffers)if(this.lightsHead+="#define hokmxtt "+d.buffers.directionals.count+"\n#define tgolzbx "+d.buffers.hemisphericals.count+"\n#define rbpyftt "+d.buffers.points.count+"\n#define gmypjqq "+d.buffers.spots.count+
"\n#define octspal "+(d.hasSomeDirShadow?d.buffers.dirShadows.count:0)+" \n#define telezcv "+(d.hasSomeSpotShadow?d.buffers.spotShadows.count:0)+" \n",d.IBL&&(this.lightsHead+="#define uoaojlv\n"),this.dynamicLights){this.lightsHead+="#define NOSHADOWDARKNESSTEST\n";for(f in d.points)l=d.points[f],this.lightsHead+="#define vpifigq"+f+"\nuniform vec3 jaqaqjo"+f+";\n"+(l.relativeToCamera?"#define paokbhz"+f+" 1\n":"")+"#define adacfgm"+f+(l.ambientMode?" 1":" 0")+"\nuniform vec3 ihabiil"+f+";\nuniform vec4 hczygcx"+
f+";\n";for(f in d.spots){l=d.spots[f];this.lightsHead+="#define zhzwila"+f+"\nuniform vec3 vmxutmc"+f+";\n"+(l.relativeToCamera?"#define pzibdvh"+f+" 1\n":"")+"#define fcemnll"+f+(l.ambientMode?" 1":" 0")+"\nuniform vec3 qdijctx"+f+";\nuniform vec3 qkbayba"+f+";\nuniform vec4 jbwfpbd"+f+";\nuniform vec3 vjnmpun"+f+";\n";var n=l.shadow?q?l.shadow.globalIntensity:l.shadow.intensity:0;n&&(this.lightsHead+="#define lmnawfd"+f+" "+n.toFixed(2)+"\n#define xhmejzu"+f+" "+(q?l.shadow.globalBias.toFixed(2):
l.shadow.bias.toFixed(2))+"\nuniform vec2 dzpoqlw"+f+";\n#define efyytzg"+f+" "+(l.shadow.far-l.shadow.near).toFixed(2)+"\n")}for(f in d.directionals)if(l=d.directionals[f],this.lightsHead+="#define atfjluc"+f+"\nuniform vec3 iuqlhbj"+f+";\n"+(l.relativeToCamera?"#define yxuivxf"+f+" 1\n":"")+"#define mbdxhsz"+f+(l.ambientMode?" 1":" 0")+"\nuniform vec3 ntjaipr"+f+";\nuniform vec3 szyepvr"+f+";\n",n=l.shadow?q?l.shadow.globalIntensity:l.shadow.intensity:0)this.lightsHead+="#define kqlahgv"+f+" "+
n.toFixed(2)+"\n#define uzzsmwp"+f+" "+(q?l.shadow.globalBias.toFixed(2):l.shadow.bias.toFixed(2))+"\nuniform vec2 vfpwfis"+f+";\nuniform float pgnowwy"+f+";\n";for(f in d.hemisphericals)l=d.hemisphericals[f],this.lightsHead+="#define wtolgpn"+f+"\nuniform vec3 pgksjxv"+f+";\nuniform vec3 irayogf"+f+";\nuniform float qkurkjy"+f+";\n"+(l.relativeToCamera?"#define naqneaz"+f+" 1\n":"")+"#define gefwago"+f+(l.ambientMode?" 1":" 0")+"\nuniform vec3 tqwolgz"+f+";\n"}else{for(f in d.points)l=d.points[f],
l.intensity&&(this.lightsHead+="#define vpifigq"+f+"\nconst vec3 jaqaqjo"+f+" = vec3("+l.intensity*l.color[0]+","+l.intensity*l.color[1]+","+l.intensity*l.color[2]+");\n"+(l.relativeToCamera?"#define paokbhz"+f+" 1\n":"")+"#define adacfgm"+f+(l.ambientMode?" 1":" 0")+"\nconst vec3 ihabiil"+f+" = vec3("+l.position[0]+","+l.position[1]+","+l.position[2]+");\nconst vec4 hczygcx"+f+" = vec4("+l.distance+","+l.constantAttenuation+","+l.linearAttenuation+","+l.quadraticAttenuation+");\n");for(f in d.spots)if(l=
d.spots[f],l.intensity||q)if(vec3.normalize(l.direction),this.lightsHead+="#define zhzwila"+f+"\nconst vec3 vmxutmc"+f+" = vec3("+l.intensity*l.color[0]+","+l.intensity*l.color[1]+","+l.intensity*l.color[2]+");\n"+(l.relativeToCamera?"#define pzibdvh"+f+" 1\n":"")+"#define fcemnll"+f+(l.ambientMode?" 1":" 0")+"\nconst vec3 qdijctx"+f+" = vec3("+l.position[0]+","+l.position[1]+","+l.position[2]+");\nconst vec3 qkbayba"+f+" = vec3("+l.direction[0]+","+l.direction[1]+","+l.direction[2]+");\nconst vec4 jbwfpbd"+
f+" = vec4("+l.distance+","+l.constantAttenuation+","+l.linearAttenuation+","+l.quadraticAttenuation+");\nconst vec3 vjnmpun"+f+" = vec3("+Math.cos(l.innerAngle/2)+","+Math.cos(l.outerAngle/2)+","+l.exponent+");\n",n=l.shadow?q?l.shadow.globalIntensity:l.shadow.intensity:0)this.lightsHead+="#define lmnawfd"+f+" "+n.toFixed(2)+"\n#define xhmejzu"+f+" "+(q?l.shadow.globalBias.toFixed(2):l.shadow.bias.toFixed(2))+"\nconst vec2 dzpoqlw"+f+" = vec2("+l.shadow.width+","+l.shadow.height+");\n#define efyytzg"+
f+" "+(l.shadow.far-l.shadow.near).toFixed(2)+"\n";for(f in d.directionals)if(l=d.directionals[f],l.intensity||q){vec3.normalize(l.direction);this.lightsHead+="#define atfjluc"+f+"\nconst vec3 iuqlhbj"+f+" = vec3("+l.intensity*l.color[0]+","+l.intensity*l.color[1]+","+l.intensity*l.color[2]+");\n"+(l.relativeToCamera?"#define yxuivxf"+f+" 1\n":"")+"#define mbdxhsz"+f+(l.ambientMode?" 1":" 0")+"\nconst vec3 szyepvr"+f+" = vec3("+l.direction[0]+","+l.direction[1]+","+l.direction[2]+");\n";n=l.shadow?
q?l.shadow.globalIntensity:l.shadow.intensity:0;var e=!1;n&&(e=l.shadow.autoAdjust,this.lightsHead+="#define kqlahgv"+f+" "+n.toFixed(2)+"\n#define uzzsmwp"+f+" "+(q?l.shadow.globalBias.toFixed(2):l.shadow.bias.toFixed(2))+"\nconst vec2 vfpwfis"+f+" = vec2("+l.shadow.width+","+l.shadow.height+");\n",this.lightsHead=e?this.lightsHead+("uniform float pgnowwy"+f+";\n"):this.lightsHead+("#define pgnowwy"+f+" "+(l.shadow.far-l.shadow.near).toFixed(2)+"\n"));this.lightsHead=e?this.lightsHead+("uniform vec3 ntjaipr"+
f+";\n"):this.lightsHead+("const vec3 ntjaipr"+f+" = vec3("+l.position[0]+","+l.position[1]+","+l.position[2]+");\n")}for(f in d.hemisphericals)l=d.hemisphericals[f],l.intensity&&(vec3.normalize(l.direction),this.lightsHead+="#define wtolgpn"+f+"\nconst vec3 pgksjxv"+f+" = vec3("+l.skyColor[0]+","+l.skyColor[1]+","+l.skyColor[2]+");\nconst vec3 irayogf"+f+" = vec3("+l.groundColor[0]+","+l.groundColor[1]+","+l.groundColor[2]+");\n#define qkurkjy"+f+" "+l.intensity.toFixed(2)+"\n"+(l.relativeToCamera?
"#define naqneaz"+f+" 1\n":"")+"#define gefwago"+f+(l.ambientMode?" 1":" 0")+"\nconst vec3 tqwolgz"+f+" = vec3("+l.direction[0]+","+l.direction[1]+","+l.direction[2]+");\n")}else this.lightsHead+="#define hokmxtt 0\n#define tgolzbx 0\n#define rbpyftt 0\n#define gmypjqq 0\n#define octspal 0\n#define telezcv 0\n";this.lightsHead+="#define ttttpsh "+k+"\n";this.lightsHead+="#define upcfkyg "+(q||"0")+"\n";if(g!==this.lightsHead)for(f in this.typedShaders)b.deleteProgram(this.typedShaders[f].program),
delete this.typedShaders[f];return!0};k.prototype.updateShadowsHead=function(d){this.shadowsHead="";switch(d.shadowingTechnique){case 0:this.shadowsHead+="#define mzpxama 1 \n";this.shadowsHead+="#define gpfdayb 1 \n";this.shadowsHead+="#define PCF_FILTER_LENGTH "+d.pcfLength.toFixed(1)+"\n";this.shadowsHead+="#define PCSS_FILTER_LENGTH "+d.pcssLength.toFixed(1)+"\n";break;case 1:this.shadowsHead=b.floatTextures?this.shadowsHead+"#define mzpxama 8 \n":this.shadowsHead+"#define mzpxama 6 \n";this.shadowsHead+=
"#define gpfdayb 3 \n";this.shadowsHead+="#define nxaqjjs "+d.vsmLightBleed.toFixed(1)+"\n";break;case 2:this.shadowsHead+="#define mzpxama 7 \n",this.shadowsHead+="#define gpfdayb 2 \n",this.shadowsHead+="#define lgjrplk "+d.esmParam.toFixed(1)+"\n"}};k.prototype.updateFilteringHead=function(b){switch(b){case 0:this.filteringFragmentHead="#define FILTER_3X3\n";break;case 1:this.filteringFragmentHead="#define FILTER_5X5\n";break;case 2:this.filteringFragmentHead="#define FILTER_7X7\n"}};k.prototype.updateFRMacros=
function(d){this.frVertexHead+="attribute vec3 ymaxekn;\n";this.frVertexHead+="attribute vec3 pcgewnw;\n";if(d.maxUvsInUse)for(var f=0;f<d.maxUvsInUse;++f)this.frVertexHead+="attribute vec2 aUv"+f+";\n",this.frVertexHead+="attribute vec3 aVertexTangent"+f+";\n",this.frVertexHead+="varying vec4 vVertexTangentWorld"+f+";\n",this.frVertexHead+="varying vec4 vVertexTangentView"+f+";\n",this.frVertexTail+="    if(length(aVertexTangent"+f+".xyz)>0.0) { \n",this.frVertexTail+="         vVertexTangentWorld"+
f+".xyz = normalize(ccpxoqv * aVertexTangent"+f+");\n",this.frVertexTail+="         vVertexTangentView"+f+".xyz = normalize(dcsphyk * aVertexTangent"+f+");\n",this.frVertexTail+="    } else {  \n",this.frVertexTail+="         vVertexTangentWorld"+f+".xyz = vec3(1.0,0.0,0.0);\n",this.frVertexTail+="         vVertexTangentView"+f+".xyz = vec3(1.0,0.0,0.0);\n",this.frVertexTail+="    }",this.frVertexTail+="    vVertexTangentWorld"+f+".a = aUv"+f+".x;\n",this.frVertexTail+="    vVertexTangentView"+f+
".a = aUv"+f+".y;\n",this.frFragmentHead+="varying vec4 vVertexTangentWorld"+f+";\n",this.frFragmentHead+="varying vec4 vVertexTangentView"+f+";\n";else this.frVertexHead+="attribute vec2 aUv0;\n",this.frVertexHead+="attribute vec3 aVertexTangent0;\n",this.frVertexHead+="varying vec4 vVertexTangentWorld0;\n",this.frVertexHead+="varying vec4 vVertexTangentView0;\n",this.frVertexTail+="    vVertexTangentWorld0.xyz = vec3(1.0,0.0,0.0);\n",this.frVertexTail+="    vVertexTangentView0.xyz = vec3(1.0,0.0,0.0);\n",
this.frVertexTail+="    vVertexTangentWorld0.a = 0.0;\n",this.frVertexTail+="    vVertexTangentView0.a = 0.0;\n",this.frFragmentHead+="#define NO_UVS \n",this.frFragmentHead+="varying vec4 vVertexTangentWorld0;\n",this.frFragmentHead+="varying vec4 vVertexTangentView0;\n";this.frVertexTail+="}\n";this.frFragmentHead+="vec3 tiurzyf(int uvsrc, mat4 uvTransform) {\n";this.frFragmentHead+="    vec4 crop = uvTransform[2];\n";this.frFragmentHead+="    vec2 applyCrop = vec2(uvTransform[1][2], uvTransform[1][3]);\n";
this.frFragmentHead+="    uvTransform[1][2] = 0.0;\n";this.frFragmentHead+="    uvTransform[1][3] = 0.0;\n";this.frFragmentHead+="    uvTransform[2][0] = 0.0;\n";this.frFragmentHead+="    uvTransform[2][1] = 0.0;\n";this.frFragmentHead+="    uvTransform[2][2] = 1.0;\n";this.frFragmentHead+="    uvTransform[2][3] = 0.0;\n";this.frFragmentHead+="    vec4 res = vec4(0,0,0,1);\n";if(d.maxUvsInUse)for(var g=0;g<d.maxUvsInUse;++g)this.frFragmentHead+="    if (uvsrc == "+g+") res.xy = vec2(vVertexTangentWorld"+
g+".a, vVertexTangentView"+g+".a);\n";else this.frFragmentHead+="    if (uvsrc == 0) res.xy = vec2(vVertexTangentWorld0.a, vVertexTangentView0.a);\n";this.frFragmentHead+="    res = (uvTransform * res);\n";this.frFragmentHead+="    res.z = step(1.0, applyCrop.x) * (step(res.x, crop.x - 0.00001) + step(crop.y + 0.00001, res.x)) + step(1.0, applyCrop.y) * (step(res.y, crop.z - 0.00001) + step(crop.w + 0.00001, res.y));\n";this.frFragmentHead+="    return res.xyz;\n";this.frFragmentHead+="}\n";this.frFragmentHead+=
"vec3 fytlazk(int uvsrc) {\n";this.frFragmentHead+="    vec3 res = vec3(0,0,0);\n";if(d.maxUvsInUse)for(g=0;g<d.maxUvsInUse;++g)this.frFragmentHead+="    if (uvsrc == "+g+") res = vVertexTangentWorld"+g+".xyz;\n";else this.frFragmentHead+="    if (uvsrc == 0) res = vVertexTangentWorld0.xyz;\n";this.frFragmentHead+="    return res;\n";this.frFragmentHead+="}\n";this.frFragmentHead+="vec3 fsjlspn(int uvsrc) {\n";this.frFragmentHead+="    vec3 res = vec3(0,0,0);\n";if(d.maxUvsInUse)for(g=0;g<d.maxUvsInUse;++g)this.frFragmentHead+=
"    if (uvsrc == "+g+") res = vVertexTangentView"+g+".xyz;\n";else this.frFragmentHead+="    if (uvsrc == 0) res = vVertexTangentView0.xyz;\n";this.frFragmentHead+="    return res;\n";this.frFragmentHead+="}\n";d.mirrors.length&&(this.frFragmentHead+="#define tlecjjv\n");this.uvsCount=d.maxUvsInUse;if(this.previousFrFragmentHead!=this.frFragmentHead){for(g in this.typedShaders)b.deleteProgram(this.typedShaders[g].program),delete this.typedShaders[g];this.shaderProgramOpacityShadows&&(b.deleteProgram(this.shaderProgramOpacityShadows),
delete this.shaderProgramOpacityShadows);for(var k in this.screenSpaceShaders)for(g in this.screenSpaceShaders[k])b.deleteProgram(this.screenSpaceShaders[k][g].program),delete this.screenSpaceShaders[k][g];for(g in this.furShaders)b.deleteProgram(this.furShaders[g].program),delete this.furShaders[g];this.shaderProgramScreenSpaceDepth&&(b.deleteProgram(this.shaderProgramScreenSpaceDepth),delete this.shaderProgramScreenSpaceDepth);this.shaderProgramFur&&(b.deleteProgram(this.shaderProgramFur),delete this.shaderProgramFur);
for(g in this.glowWritingShaders)b.deleteProgram(this.glowWritingShaders[g].program),delete this.glowWritingShaders[g]}if(this.currentMaterialsType!=d.materialsType){this.currentMaterialsType=d.materialsType;this.shaderProgramOpacityShadows&&(b.deleteProgram(this.shaderProgramOpacityShadows),delete this.shaderProgramOpacityShadows);for(k in this.screenSpaceShaders)for(g in this.screenSpaceShaders[k])b.deleteProgram(this.screenSpaceShaders[k][g].program),delete this.screenSpaceShaders[k][g];this.shaderProgramScreenSpaceDepth&&
(b.deleteProgram(this.shaderProgramScreenSpaceDepth),delete this.shaderProgramScreenSpaceDepth)}};k.prototype.updateMacros=function(b,d,g){this.frVertexTail=this.frVertexHead=this.shadowsHead=this.filteringFragmentHead="";this.previousFrFragmentHead=this.frFragmentHead;this.frFragmentHead="";this.globalHead=this.globalHeadInit;d=this.updateLightHead(b.lights,b.hasSomeShadow,b.tonemapping.disabled?0:b.tonemapping.type,d,b.scenery.shadowMode);this.updateShadowsHead(g);this.updateFilteringHead(g.filteringTechnique);
this.updateFRMacros(b);delete this.previousFrFragmentHead;return d};var l=function(b,d){return b.id<d.id?-1:b.id>d.id?1:0},g=function(b,d){var f=b.polylist,g=d.polylist;if(f.renderingPass<g.renderingPass)return-1;if(f.renderingPass>g.renderingPass)return 1;var k=b.matAnim,n=d.matAnim;if(k.isOpaque()&&!n.isOpaque())return-1;if(!k.isOpaque()&&n.isOpaque())return 1;if(!k.isOpaque()&&!n.isOpaque()){var l=k.shaderType.has(stage.emersya.viewer.modules.renderer.shaders.shaderTypes.SCREENSPACE_REFRACTION),
e=k.shaderType.has(stage.emersya.viewer.modules.renderer.shaders.shaderTypes.SCREENSPACE_REFRACTION);if(l&&!e)return 1;if(!l&&e)return-1}l=k.shaderType.value();e=n.shaderType.value();if(l<e)return-1;if(l>e)return 1;if(b.materialTree.polylistMinId<d.materialTree.polylistMinId)return-1;if(b.materialTree.polylistMinId>d.materialTree.polylistMinId)return 1;b=k.currentMaterial.id;d=n.currentMaterial.id;if(b<d)return-1;if(b>d)return 1;if(k.nextMaterial){b=k.nextMaterial.id;d=n.nextMaterial.id;if(b<d)return-1;
if(b>d)return 1}return f.id<g.id?-1:f.id>g.id?1:0};k.prototype.updatePolylistsInstances=function(b){b.polylistInstances.sort(g)};k.prototype.updateSceneMaterials=function(b,d,k,q){for(var f in b.materials)b.materials[f].polylists.sort(l);b.renderingSettings.blurSupported=d;b.renderingSettings.furSupported=q;b.renderingSettings.screenSpaceRefract=k;b.maxUvsInUse=0;for(f in b.polylistInstances)d=b.polylistInstances[f],d.matAnim.updateShaderType(),b.maxUvsInUse=Math.max(d.matAnim.getMaxUvsInUse(),b.maxUvsInUse);
b.polylistInstances.sort(g)};k.prototype.updateTypedShaders=function(b){for(var d in b.polylistInstances)this.createTypedShader(b.polylistInstances[d].matAnim.shaderType)};k.prototype.updateHeadFragment=function(b,g){b.has(d.NEWSHADERTYPE)&&(g+="#define qictwfu\n");b.has(d.FADEOUT)&&(g+="#define zgbdrir\n");b.has(d.DIFFUSE)&&(g+="#define tqtzlvf\n");b.has(d.AMBIENT)&&(g+="#define altvvbq\n");b.has(d.DIFFUSEAMBIENT)&&(g+="#define rixowhp\n");b.has(d.SPECULAR)&&(g+="#define bzsisog\n");b.has(d.SPECULAR_INTENSITY)&&
(g+="#define kddtxjn\n");b.has(d.EMISSIVE)&&(g+="#define ylmuugp\n");b.has(d.EMISSIVE_INTENSITY)&&(g+="#define aitbpqn\n");b.has(d.SHININESS)&&(g+="#define vvqtuez\n");b.has(d.NORMAL)&&(g+="#define poteimn\n");b.has(d.NORMAL_SCALE)&&(g+="#define ayiiefg\n");b.has(d.LIGHT)&&(g+="#define osvrsmm\n");b.has(d.LIGHT_COLOR)&&(g+="#define pksryor\n");b.has(d.REFLECTION)&&(g+="#define xovkksj\n");b.has(d.REFLECTIONMAP)&&(g+="#define kyhuvgs\n");b.has(d.REFRACTION)&&(g+="#define rofpzvn\n");b.has(d.REFRACTIONMAP)&&
(g+="#define sfsqzng\n");b.has(d.REFRACTION_CUBEMAP)&&(g+="#define ymqdhta\n");b.has(d.OPACITY)&&(g+="#define khvylnr\n");b.has(d.SPECULAR_ANISOTROPIC)&&(g+="#define przvnvk\n");b.has(d.IRIDESCENT)&&(g+="#define gntovzq\n");b.has(d.IRIDESCENT_INTENSITY)&&(g+="#define njedwma\n");b.has(d.TRANSLUCENCY)&&(g+="#define liwyana\n");b.has(d.TRANSLUCENCYMAP)&&(g+="#define kopvmvi\n");b.has(d.ANIM_DIFFUSE)&&(g+="#define ciziuga\n");b.has(d.ANIM_AMBIENT)&&(g+="#define hyucpon\n");b.has(d.ANIM_DIFFUSEAMBIENT)&&
(g+="#define ddunger\n");b.has(d.ANIM_SPECULAR)&&(g+="#define xlkdrug\n");b.has(d.ANIM_SPECULAR_INTENSITY)&&(g+="#define pzlstld\n");b.has(d.ANIM_EMISSIVE)&&(g+="#define muzpkxq\n");b.has(d.ANIM_EMISSIVE_INTENSITY)&&(g+="#define qvyqlby\n");b.has(d.ANIM_SHININESS)&&(g+="#define lrvyeou\n");b.has(d.ANIM_NORMAL)&&(g+="#define fomzgxw\n");b.has(d.ANIM_NORMAL_SCALE)&&(g+="#define fdclrvp\n");b.has(d.ANIM_LIGHT)&&(g+="#define lipkixn\n");b.has(d.ANIM_LIGHT_COLOR)&&(g+="#define rgikbwi\n");b.has(d.ANIM_REFLECTION)&&
(g+="#define ycbccsl\n");b.has(d.ANIM_REFLECTIONMAP)&&(g+="#define eeqsdyv\n");b.has(d.ANIM_REFRACTION)&&(g+="#define pnswumg\n");b.has(d.ANIM_REFRACTIONMAP)&&(g+="#define xlbaqqf\n");b.has(d.ANIM_REFRACTION_CUBEMAP)&&(g+="#define USE_REFRACTION_CUBEMAP_ANIM\n");b.has(d.ANIM_OPACITY)&&(g+="#define cybhscz\n");b.has(d.ANIM_SPECULAR_ANISOTROPIC)&&(g+="#define hqoltzb\n");b.has(d.ANIM_IRIDESCENT)&&(g+="#define hbowaxq\n");b.has(d.ANIM_IRIDESCENT_INTENSITY)&&(g+="#define qikfanu\n");b.has(d.ANIM_TRANSLUCENCY)&&
(g+="#define ghxxrdt\n");b.has(d.ANIM_TRANSLUCENCYMAP)&&(g+="#define tppdyzt\n");b.has(d.ANIMATING)&&(g+="#define ANIMATING\n");b.has(d.OPACITYBLUR)&&(g+="#define enkgdhh\n");b.has(d.SPECULARGLOW)&&(g+="#define dtccdcw\n");b.has(d.SCREENSPACE_REFRACTION)&&(g+="#define tdigpwa\n");b.has(d.SCREENSPACE_ROUGHNESS)&&(g+="#define tpkjzuw\n");return g};k.prototype.updatePbrHeadFragment=function(f,g){f.has(d.FADEOUT)&&(g+="#define zgbdrir\n");f.has(d.PBR)&&(g+="#define yjjmvdg\n");f.has(d.PBR_ALBEDO_MAP)&&
f.has(d.PBR_METAL_MAP)&&f.has(d.PBR_ROUGHNESS_MAP)&&f.has(d.PBR_OPACITY_MAP)?g+="#define egwldhy\n":(f.has(d.PBR_ALBEDO_MAP)&&(g+="#define lxauyiv\n"),f.has(d.PBR_METAL_MAP)&&(g+="#define nzrtsqr\n"),f.has(d.PBR_ROUGHNESS_MAP)&&(g+="#define thpbndm\n"),f.has(d.PBR_OPACITY_MAP)&&(g+="#define khvylnr\n"));f.has(d.PBR_SPECULAR)&&(g+="#define hgcgfww\n");f.has(d.PBR_SPECULAR_MAP)&&(g+="#define bzsisog\n");f.has(d.PBR_SPECULAR_INTENSITY)&&(g+="#define kddtxjn\n");f.has(d.PBR_SPECULAR_FRESNEL_MODE)&&(g+=
"#define mxroult\n");f.has(d.PBR_NORMAL_MAP)&&(g+="#define syyczsg\n");f.has(d.PBR_BUMP_MAP)&&(g+="#define pyofspi\n");f.has(d.PBR_NORMAL_INTENSITY)&&(g+="#define vwylkgn\n");f.has(d.PBR_NORMAL_MAP2)&&(g+="#define syyczsg2\n");f.has(d.PBR_BUMP_MAP2)&&(g+="#define pyofspi2\n");f.has(d.PBR_NORMAL_INTENSITY2)&&(g+="#define vwylkgn2\n");f.has(d.OPACITYBLUR)&&(g+="#define enkgdhh\n");f.has(d.TRANSLUCENCY)&&(g+="#define liwyana\n");f.has(d.TRANSLUCENCYMAP)&&(g+="#define kopvmvi\n");f.has(d.PBR_AMBIENT_OCCLUSION)&&
(g+="#define szgfzxq\n",f.has(d.PBR_AMBIENT_OCCLUSION_MAP)&&(g+="#define mniehwp\n"));f.has(d.PBR_LIGHT_OCCLUSION)&&(g+="#define znloiam\n",f.has(d.PBR_LIGHT_OCCLUSION_MAP)&&(g+="#define teqtfsb\n"));f.has(d.PBR_EMISSIVE)&&(g+="#define kvpridb\n",f.has(d.PBR_EMISSIVE_MAP)&&(g+="#define ylmuugp\n"),f.has(d.PBR_EMISSIVE_INTENSITY_MAP)&&(g+="#define aitbpqn\n"));if(f.has(d.PBR_IRIDESCENCE_F0)||f.has(d.PBR_IRIDESCENCE_AL))g+="#define npbwfph "+Math.max(f.has(d.PBR_IRIDESCENCE_F0),f.has(d.PBR_IRIDESCENCE_AL))+
"\n",f.has(d.PBR_IRIDESCENCE_F0)&&(g+="#define gibejed\n"),f.has(d.PBR_IRIDESCENCE_AL)&&(g+="#define vmgeorx\n"),f.has(d.PBR_IRIDESCENCE_INTENSITY)&&(g+="#define iizvave\n");f.has(d.PBR_ANISOTROPY)&&(g+="#define llqozaq\n",f.has(d.PBR_ANISOTROPY_MAP)&&(g+="#define przvnvk\n"),f.has(d.PBR_ANISOTROPY_INTENSITY_MAP)&&(g+="#define nislecw\n"),f.has(d.PBR_ANISOTROPY_ROUGHNESS_MAP)&&(g+="#define odbiyre\n"),f.has(d.PBR_ANISOTROPY_ROTATION_MAP)&&(g+="#define jiepurz\n"));f.has(d.PBR_REFRACTION)&&(g+="#define rofpzvn\n",
f.has(d.PBR_REFRACTION_CUBEMAP)&&(g+="#define ymqdhta\n"));f.has(d.PBR_COATING)&&(g+="#define nfgvnsg\n",f.has(d.PBR_COATING_INTENSITY_MAP)&&(g+="#define pvoufay\n"),f.has(d.PBR_COATING_THICKNESS_MAP)&&(g+="#define yjwrvft\n"),f.has(d.PBR_COATING_ROUGHNESS_MAP)&&(g+="#define gamdqkw\n"),f.has(d.PBR_COATING_NORMAL_MAP)&&(g+="#define orrsbij\n"));f.has(d.PBR_SHEEN)&&(g+="#define ngsweov\n",f.has(d.PBR_SHEEN_MAP)&&(g+="#define oybasjb\n"),f.has(d.PBR_SHEEN_INTENSITY_MAP)&&(g+="#define odxlfbv\n"),f.has(d.PBR_SHEEN_OLD_SHADER)?
g+="#define xqhrlxr\n":(f.has(d.PBR_SHEEN_CUSTOM_ROUGHNESS)&&(g+="#define pfulqqa\n",f.has(d.PBR_SHEEN_ROUGHNESS_MAP)&&(g+="#define fhkoxfl\n")),f.has(d.PBR_ANIM_SHEEN_CUSTOM_ROUGHNESS)&&(g+="#define foixcuk\n",f.has(d.PBR_ANIM_SHEEN_ROUGHNESS_MAP)&&(g+="#define wisqppt\n"))));if(f.has(d.PBR_FUR)){g+="#define igkhmka\n";f.has(d.PBR_FUR_HAIRCUT_MAP)&&(g+="#define qzginlu\n");var k=!1;f.has(d.PBR_FUR_CLUMP_CERCLE)&&(g+="#define nfnmtah\n",k=!0);f.has(d.PBR_FUR_CLUMP_VORONOI)&&(g+="#define mizbbtu\n",
k=!0);f.has(d.PBR_FUR_CLUMP_CELLULAR)&&(g+="#define tgjzqtl\n",k=!0);f.has(d.PBR_FUR_CLUMP_TURBULENCE)&&(g+="#define kysfmtr\n",k=!0);f.has(d.PBR_FUR_CLUMP_RIDGE)&&(g+="#define sxdobsb\n",k=!0);f.has(d.PBR_FUR_CLUMP_PERLIN)&&(g+="#define mjhrplj\n",k=!0);f.has(d.PBR_FUR_CLUMP_PERLIN)&&(g+="#define mjhrplj\n",k=!0);f.has(d.PBR_FUR_CLUMP_TEXTURE)&&(g+="#define ihmqnvu\n",k=!0);k||(g+="#define hidmyof\n");f.has(d.PBR_FUR_ROOT_MAP)&&(g+="#define weeuwar\n");g+=getShaderCode("fragmentManageFurData")}f.has(d.PBR_CARPAINT)&&
(g=g+"#define kytpnre\n"+("#define oyfkqty "+Math.max(f.has(d.PBR_CARPAINT_SPECULAR_LOBES_COUNT),1)+"\n"),g+="#define sdxjcre "+Math.max(f.has(d.sdxjcre),0)+"\n",f.has(d.PBR_CARPAINT_RGBE_BRDF_COLOR)&&(g+="#define blmtyeu\n"),f.has(d.PBR_CARPAINT_RGBE_FLAKES_COLOR)&&(g+="#define xleiayp\n"),f.has(d.PBR_CARPAINT_FLAKES_MAP)&&(g+="#define bqsvlyt\n"));if(f.has(d.ANIMATING)){g+="#define ANIMATING\n";f.has(d.PBR_ANIM_ALBEDO_MAP)&&f.has(d.PBR_ANIM_METAL_MAP)&&f.has(d.PBR_ANIM_ROUGHNESS_MAP)&&f.has(d.PBR_ANIM_OPACITY_MAP)?
g+="#define zrwxjuc\n":(f.has(d.PBR_ANIM_ALBEDO_MAP)&&(g+="#define otxqyhg\n"),f.has(d.PBR_ANIM_ROUGHNESS_MAP)&&(g+="#define efxkogl\n"),f.has(d.PBR_ANIM_METAL_MAP)&&(g+="#define vnfasrp\n"),f.has(d.PBR_ANIM_OPACITY_MAP)&&(g+="#define cybhscz\n"));f.has(d.PBR_ANIM_SPECULAR_MAP)&&(g+="#define xlkdrug\n");f.has(d.PBR_ANIM_SPECULAR_INTENSITY)&&(g+="#define pzlstld\n");f.has(d.PBR_ANIM_NORMAL_MAP)&&(g+="#define csbgoxi\n");f.has(d.PBR_ANIM_BUMP_MAP)&&(g+="#define hvlzvwa\n");f.has(d.PBR_ANIM_NORMAL_INTENSITY)&&
(g+="#define lzgnupy\n");f.has(d.PBR_ANIM_NORMAL_MAP2)&&(g+="#define csbgoxi2\n");f.has(d.PBR_ANIM_BUMP_MAP2)&&(g+="#define hvlzvwa2\n");f.has(d.PBR_ANIM_NORMAL_INTENSITY2)&&(g+="#define lzgnupy2\n");f.has(d.PBR_ANIM_AMBIENT_OCCLUSION)&&(g+="#define azsutev\n",f.has(d.PBR_ANIM_AMBIENT_OCCLUSION_MAP)&&(g+="#define mzksuld\n"));f.has(d.PBR_ANIM_LIGHT_OCCLUSION)&&(g+="#define gtbnreb\n",f.has(d.PBR_ANIM_LIGHT_OCCLUSION_MAP)&&(g+="#define brymrwe\n"));f.has(d.PBR_ANIM_EMISSIVE)&&(g+="#define zfkjfmr\n");
f.has(d.PBR_ANIM_EMISSIVE_MAP)&&(g+="#define muzpkxq\n");f.has(d.PBR_ANIM_EMISSIVE_INTENSITY_MAP)&&(g+="#define qvyqlby\n");if(f.has(d.PBR_ANIM_IRIDESCENCE_F0)||f.has(d.PBR_ANIM_IRIDESCENCE_AL))g+="#define ylzxewv "+Math.max(f.has(d.PBR_ANIM_IRIDESCENCE_F0),f.has(d.PBR_ANIM_IRIDESCENCE_AL))+"\n",f.has(d.PBR_ANIM_IRIDESCENCE_F0)&&(g+="#define zjsuosi\n"),f.has(d.PBR_ANIM_IRIDESCENCE_AL)&&(g+="#define sjuwcbf\n"),f.has(d.PBR_ANIM_IRIDESCENCE_INTENSITY)&&(g+="#define USE_IRIDESCENCE_F_INTENSITY_ANIM\n");
f.has(d.PBR_ANIM_ANISOTROPY)&&(g+="#define usxiksx\n",f.has(d.PBR_ANIM_ANISOTROPY_MAP)&&(g+="#define hqoltzb\n"),f.has(d.PBR_ANIM_ANISOTROPY_INTENSITY_MAP)&&(g+="#define vdaapsy\n"),f.has(d.PBR_ANIM_ANISOTROPY_ROUGHNESS_MAP)&&(g+="#define velyaqt\n"),f.has(d.PBR_ANIM_ANISOTROPY_ROTATION_MAP)&&(g+="#define vefpzux\n"));f.has(d.PBR_ANIM_REFRACTION)&&(g+="#define pnswumg\n",f.has(d.PBR_ANIM_REFRACTION_CUBEMAP)&&(g+="#define yxcsywt\n"));f.has(d.PBR_ANIM_COATING)&&(g+="#define ypznuqr\n",f.has(d.PBR_ANIM_COATING_INTENSITY_MAP)&&
(g+="#define fthwwgd\n"),f.has(d.PBR_ANIM_COATING_THICKNESS_MAP)&&(g+="#define yrnenzl\n"),f.has(d.PBR_ANIM_COATING_ROUGHNESS_MAP)&&(g+="#define ykfpceu\n"),f.has(d.PBR_ANIM_COATING_NORMAL_MAP)&&(g+="#define krkzyck\n"));f.has(d.PBR_ANIM_SHEEN)&&(g+="#define iwrupkt\n",f.has(d.PBR_ANIM_SHEEN_MAP)&&(g+="#define oflqsqr\n"),f.has(d.PBR_ANIM_SHEEN_INTENSITY_MAP)&&(g+="#define jfjrgrm\n"))}b.floatTextures&&f.has(d.PBR)&&f.has(d.PBR_ENV_CUBES)&&(g+="#define pyjqigb\n");f.has(d.SCREENSPACE_REFRACTION)&&
(g+="#define tdigpwa\n");f.has(d.SCREENSPACE_ROUGHNESS)&&(g+="#define tpkjzuw\n");return g};k.prototype.updateHeadVertex=function(b,g){b.has(d.FADEOUT)&&(g+="#define zgbdrir\n");b.has(d.PBR_FUR)&&(g+="#define igkhmka\n",b.has(d.PBR_FUR_DISPERSION)&&(g+="#define fbfxphz\n"),g+=getShaderCode("vertexGetDisplaceWorldFurVertex"));return g};k.prototype.compileTypedShader=function(f){var g=this.frFragmentHead;g=f.has(d.PBR)?this.updatePbrHeadFragment(f,g):this.updateHeadFragment(f,g);var k=this.frVertexHead;
k=this.updateHeadVertex(f,k);var l=b.createShader(b.VERTEX_SHADER),q=b.createShader(b.FRAGMENT_SHADER);f.has(d.PBR)?(b.shaderSource(l,this.globalHead+this.globalVertexHead+this.lightsHead+k+this.pbrFrVertexBase+this.frVertexTail),b.shaderSource(q,this.globalHead+this.globalFragmentHead+this.lightsHead+this.shadowsHead+g+this.bilinearRGBETexture2D+this.sRGBfragmentBase+this.textureMappingFragmentBase+this.pbrFrFragmentBase)):(b.shaderSource(l,this.globalHead+this.globalVertexHead+this.lightsHead+k+
this.frVertexBase+this.frVertexTail),b.shaderSource(q,this.globalHead+this.globalFragmentHead+this.lightsHead+this.shadowsHead+g+this.frFragmentBase));b.compileShader(l);b.compileShader(q);if(!b.getShaderParameter(l,b.COMPILE_STATUS))return console.error(b.getShaderInfoLog(l)),null;if(!b.getShaderParameter(q,b.COMPILE_STATUS))return console.error(b.getShaderInfoLog(q)),null;this.typedShaders[f.value()]={program:b.createProgram(),locations:null,type:f};this.shaderTypesFromValue[f.value()]=f;b.attachShader(this.typedShaders[f.value()].program,
l);b.attachShader(this.typedShaders[f.value()].program,q);b.linkProgram(this.typedShaders[f.value()].program);b.flush();b.finish();b.getProgramParameter(this.typedShaders[f.value()].program,b.LINK_STATUS)||b.isContextLost()||(g=b.getProgramInfoLog(this.typedShaders[f.value()].program),console.error("Error in program linking : Full rendering : "+g));this.typedShaders[f.value()].locations=this.generateLocations(this.typedShaders[f.value()].program);b.validateProgram(this.typedShaders[f.value()].program);
b.flush();b.finish()};k.prototype.createTypedShader=function(d,g){b.useProgram(null);!g&&this.typedShaders[d.value()]||this.compileTypedShader(d)};k.prototype.clearVertexAttribs=function(){for(var d=0;d<this.maxVertexAttribs;++d)b.disableVertexAttribArray(d)};k.prototype.useTypedShader=function(d,g){this.clearVertexAttribs();var f=this.typedShaders[d.shaderType.value()];f||(this.createTypedShader(d.shaderType),f=this.typedShaders[d.shaderType.value()]);g.program=f.program;g.locations=f.locations;
b.useProgram(f.program);b.enableVertexAttribArray(g.locations.ymaxekn);b.enableVertexAttribArray(g.locations.pcgewnw)};k.prototype.useFullSpecShader=function(d,g){g=new u(g);var f=this.typedShaders[g.value()];f||(this.createTypedShader(g),f=this.typedShaders[g.value()]);this.clearVertexAttribs();d.locations=f.locations;b.useProgram(f.program);b.enableVertexAttribArray(d.locations.ymaxekn);b.enableVertexAttribArray(d.locations.pcgewnw)};k.prototype.useFullReflShader=function(d,g){g=new u(g);g.set(stage.emersya.viewer.modules.renderer.shaders.shaderTypes.REFLECTION,
!0);var f=this.typedShaders[g.value()];f||(this.createTypedShader(g),f=this.typedShaders[g.value()]);this.clearVertexAttribs();d.locations=f.locations;b.useProgram(f.program);b.enableVertexAttribArray(d.locations.ymaxekn);b.enableVertexAttribArray(d.locations.pcgewnw)};k.prototype.useUvGridShader=function(d,g){g=new u(g);g.set(stage.emersya.viewer.modules.renderer.shaders.shaderTypes.EMISSIVE,!0);var f=this.typedShaders[g.value()];f||(this.createTypedShader(g),f=this.typedShaders[g.value()]);this.clearVertexAttribs();
d.locations=f.locations;b.useProgram(f.program);b.enableVertexAttribArray(d.locations.ymaxekn);b.enableVertexAttribArray(d.locations.pcgewnw)};k.prototype.createShadowMapShader=function(){if(!this.shaderProgramShadows){b.useProgram(null);var d=b.createShader(b.VERTEX_SHADER),g=b.createShader(b.FRAGMENT_SHADER);b.shaderSource(d,this.globalHead+this.globalVertexHead+getShaderCode("vertexShaderShadowMapRendering"));b.shaderSource(g,this.globalHead+this.globalFragmentHead+this.shadowsHead+getShaderCode("fragmentShaderShadowMapRendering"));
b.compileShader(d);b.compileShader(g);this.shaderProgramShadows=b.createProgram();b.attachShader(this.shaderProgramShadows,d);b.attachShader(this.shaderProgramShadows,g);b.linkProgram(this.shaderProgramShadows);if(!b.getShaderParameter(d,b.COMPILE_STATUS))return console.error(b.getShaderInfoLog(d)),null;if(!b.getShaderParameter(g,b.COMPILE_STATUS))return console.error(b.getShaderInfoLog(g)),null;b.getProgramParameter(this.shaderProgramShadows,b.LINK_STATUS)||b.isContextLost()||(d=b.getProgramInfoLog(this.shaderProgramShadows),
console.error("Error in program linking : shadows : "+d));b.useProgram(this.shaderProgramShadows);this.shadowsLocations=this.generateLocations(this.shaderProgramShadows)}};k.prototype.useShadowShader=function(d){this.clearVertexAttribs();b.useProgram(this.shaderProgramShadows);d.locations=this.shadowsLocations;b.enableVertexAttribArray(this.shadowsLocations.ymaxekn);b.uniform1f(d.locations.cqcpvcg,0)};k.prototype.createOpacityShadowMapShader=function(d){if(this.shaderProgramOpacityShadows)return!0;
b.useProgram(null);if(!this.frVertexHead&&!this.frVertexTail)return!1;var f="\n#define ujenxlh\n";d&&(f+="\n#define yjjmvdg\n");d=b.createShader(b.VERTEX_SHADER);var g=b.createShader(b.FRAGMENT_SHADER);b.shaderSource(d,this.globalHead+this.globalVertexHead+f+this.frVertexHead+getShaderCode("vertexShaderShadowMapRendering")+this.frVertexTail);b.shaderSource(g,this.globalHead+this.globalFragmentHead+this.shadowsHead+this.frFragmentHead+f+this.sRGBfragmentBase+this.textureMappingFragmentBase+this.discardTransparentFragmentBase+
getShaderCode("fragmentShaderShadowMapRendering"));b.compileShader(d);b.compileShader(g);this.shaderProgramOpacityShadows=b.createProgram();b.attachShader(this.shaderProgramOpacityShadows,d);b.attachShader(this.shaderProgramOpacityShadows,g);b.linkProgram(this.shaderProgramOpacityShadows);if(!b.getShaderParameter(d,b.COMPILE_STATUS))return console.error(b.getShaderInfoLog(d)),null;if(!b.getShaderParameter(g,b.COMPILE_STATUS))return console.error(b.getShaderInfoLog(g)),null;b.getProgramParameter(this.shaderProgramOpacityShadows,
b.LINK_STATUS)||b.isContextLost()||(f=b.getProgramInfoLog(this.shaderProgramOpacityShadows),console.error("Error in program linking : shadows : "+f));b.useProgram(this.shaderProgramOpacityShadows);this.opacityShadowsLocations=this.generateLocations(this.shaderProgramOpacityShadows);return!0};k.prototype.useOpacityShadowShader=function(d,g){this.shaderProgramOpacityShadows||this.createOpacityShadowMapShader(g);this.clearVertexAttribs();b.useProgram(this.shaderProgramOpacityShadows);d.locations=this.opacityShadowsLocations;
b.enableVertexAttribArray(this.opacityShadowsLocations.ymaxekn)};k.prototype.createDepthShader=function(){if(!this.shaderProgramDepth){b.useProgram(null);var d=b.createShader(b.VERTEX_SHADER),g=b.createShader(b.FRAGMENT_SHADER);b.shaderSource(d,this.globalHead+this.globalVertexHead+getShaderCode("vertexShaderDepthRendering"));b.shaderSource(g,this.globalHead+this.globalFragmentHead+this.shadowsHead+getShaderCode("fragmentShaderDepthRendering"));b.compileShader(d);b.compileShader(g);this.shaderProgramDepth=
b.createProgram();b.attachShader(this.shaderProgramDepth,d);b.attachShader(this.shaderProgramDepth,g);b.linkProgram(this.shaderProgramDepth);if(!b.getShaderParameter(d,b.COMPILE_STATUS))return console.error(b.getShaderInfoLog(d)),null;if(!b.getShaderParameter(g,b.COMPILE_STATUS))return console.error(b.getShaderInfoLog(g)),null;b.getProgramParameter(this.shaderProgramDepth,b.LINK_STATUS)||b.isContextLost()||(d=b.getProgramInfoLog(this.shaderProgramDepth),console.error("Error in program linking : Depth : "+
d));b.useProgram(this.shaderProgramDepth);this.depthLocations=this.generateLocations(this.shaderProgramDepth)}};k.prototype.useDepthShader=function(d){this.shaderProgramDepth||this.createDepthShader();this.clearVertexAttribs();b.useProgram(this.shaderProgramDepth);d.locations=this.depthLocations;b.enableVertexAttribArray(this.depthLocations.ymaxekn)};k.prototype.createScreenSpaceDepthShader=function(d){if(this.shaderProgramScreenSpaceDepth)return!1;b.useProgram(null);var f=b.createShader(b.VERTEX_SHADER),
g=b.createShader(b.FRAGMENT_SHADER),k=this.frVertexHead,l=this.frVertexTail,q=this.sRGBfragmentBase+this.textureMappingFragmentBase+this.discardTransparentFragmentBase+getShaderCode("fragmentShaderScreenSpaceDepth");k||l||(k="attribute vec3 ymaxekn;\n",l="}\n",q=" void main() { gl_FragColor = vec4(0.0); }");d=d?"\n#define yjjmvdg\n":"";b.shaderSource(f,this.globalHead+this.globalVertexHead+k+getShaderCode("vertexScreenSpaceDepth")+l);b.shaderSource(g,this.globalHead+this.globalFragmentHead+this.shadowsHead+
this.frFragmentHead+d+q);b.compileShader(f);b.compileShader(g);this.shaderProgramScreenSpaceDepth=b.createProgram();b.attachShader(this.shaderProgramScreenSpaceDepth,f);b.attachShader(this.shaderProgramScreenSpaceDepth,g);b.linkProgram(this.shaderProgramScreenSpaceDepth);if(!b.getShaderParameter(f,b.COMPILE_STATUS))return console.error(b.getShaderInfoLog(f)),!1;if(!b.getShaderParameter(g,b.COMPILE_STATUS))return console.error(b.getShaderInfoLog(g)),!1;b.getProgramParameter(this.shaderProgramScreenSpaceDepth,
b.LINK_STATUS)||b.isContextLost()||(f=b.getProgramInfoLog(this.shaderProgramScreenSpaceDepth),console.error("Error in program linking : "+f));b.useProgram(this.shaderProgramScreenSpaceDepth);this.screenSpaceDepthLocations=this.generateLocations(this.shaderProgramScreenSpaceDepth);return!0};k.prototype.useScreenSpaceDepthShader=function(d,g){this.shaderProgramScreenSpaceDepth||this.createScreenSpaceDepthShader(g);this.clearVertexAttribs();b.useProgram(this.shaderProgramScreenSpaceDepth);d.locations=
this.screenSpaceDepthLocations;b.enableVertexAttribArray(this.screenSpaceDepthLocations.ymaxekn)};k.prototype.createDepthAndNormalsShader=function(){if(this.shaderProgramDepthAndNormals)return!0;b.useProgram(null);var d=b.createShader(b.VERTEX_SHADER),g=b.createShader(b.FRAGMENT_SHADER);b.shaderSource(d,this.globalHead+this.globalVertexHead+getShaderCode("vertexShaderDepthAndNormalsRendering"));b.webgl2?b.shaderSource(g,this.globalHead+"#define varying in\n#define gl_FragData0 outColor1\nlayout (location = 0) out vec4 outColor1;\n#define gl_FragData1 outColor2\nlayout (location = 1) out vec4 outColor2;\n"+
getShaderCode("fragmentShaderDepthAndNormalsRendering")):b.shaderSource(g,"#extension GL_EXT_draw_buffers : require\n"+this.globalHead+"#define gl_FragData0 gl_FragData[0]\n#define gl_FragData1 gl_FragData[1]\n"+getShaderCode("fragmentShaderDepthAndNormalsRendering"));b.compileShader(d);b.compileShader(g);this.shaderProgramDepthAndNormals=b.createProgram();b.attachShader(this.shaderProgramDepthAndNormals,d);b.attachShader(this.shaderProgramDepthAndNormals,g);b.linkProgram(this.shaderProgramDepthAndNormals);
if(!b.getShaderParameter(d,b.COMPILE_STATUS))return console.error(b.getShaderInfoLog(d)),!1;if(!b.getShaderParameter(g,b.COMPILE_STATUS))return console.error(b.getShaderInfoLog(g)),!1;b.getProgramParameter(this.shaderProgramDepthAndNormals,b.LINK_STATUS)||b.isContextLost()||(d=b.getProgramInfoLog(this.shaderProgramDepthAndNormals),console.error("Error in program linking : depthAndnormals : "+d));b.useProgram(this.shaderProgramDepthAndNormals);this.depthAndNormalsLocations=this.generateLocations(this.shaderProgramDepthAndNormals);
return!0};k.prototype.useDepthAndNormalsShader=function(d){b.useProgram(this.shaderProgramDepthAndNormals);d.locations=this.depthAndNormalsLocations;b.enableVertexAttribArray(this.depthAndNormalsLocations.ymaxekn);b.enableVertexAttribArray(this.depthAndNormalsLocations.pcgewnw)};k.prototype.useScreenSpaceShader=function(f,g,k){if(!this.screenSpaceShaders[f]||!this.screenSpaceShaders[f][g.value()]){this.screenSpaceShaders[f]||(this.screenSpaceShaders[f]={});this.screenSpaceShaders[f][g.value()]||(this.screenSpaceShaders[f][g.value()]=
{});b.useProgram(null);var l=this.globalHead;f&1&&(l+="#define fgixhni\n");f&2&&(l+="#define nrqfuho\n");var q=this.frVertexHead;q=this.updateHeadVertex(g,q);var n=this.frFragmentHead;b.webgl2&&b.floatTextures&&(n+="#define bhvqgmf\n");g.has(d.PBR)?n=this.updatePbrHeadFragment(g,n):(n=this.updateHeadFragment(g,n),g.has(d.PBR_NORMAL_MAP)&&(n+="#define syyczsg\n"),g.has(d.PBR_BUMP_MAP)&&(n+="#define pyofspi\n"),g.has(d.PBR_NORMAL_INTENSITY)&&(n+="#define vwylkgn\n"),g.has(d.PBR_NORMAL_MAP2)&&(n+="#define syyczsg2\n"),
g.has(d.PBR_BUMP_MAP2)&&(n+="#define pyofspi2\n"),g.has(d.PBR_NORMAL_INTENSITY2)&&(n+="#define vwylkgn2\n"));var t=b.createShader(b.VERTEX_SHADER),e=b.createShader(b.FRAGMENT_SHADER);b.shaderSource(t,l+this.globalVertexHead+q+getShaderCode("vertexShaderScreenSpaceCollect")+this.frVertexTail);b.shaderSource(e,l+this.globalFragmentHead+n+this.sRGBfragmentBase+this.textureMappingFragmentBase+getShaderCode("fragmentScreenSpaceCollect"));b.compileShader(t);b.compileShader(e);this.screenSpaceShaders[f][g.value()].program=
b.createProgram();b.attachShader(this.screenSpaceShaders[f][g.value()].program,t);b.attachShader(this.screenSpaceShaders[f][g.value()].program,e);b.linkProgram(this.screenSpaceShaders[f][g.value()].program);b.getShaderParameter(t,b.COMPILE_STATUS)?b.getShaderParameter(e,b.COMPILE_STATUS)?b.getProgramParameter(this.screenSpaceShaders[f][g.value()].program,b.LINK_STATUS)||b.isContextLost()?(b.useProgram(this.screenSpaceShaders[f][g.value()].program),this.screenSpaceShaders[f][g.value()].locations=this.generateLocations(this.screenSpaceShaders[f][g.value()].program)):
(l=b.getProgramInfoLog(this.screenSpaceShaders[f][g.value()].program),console.error("Error in program linking : screenSpaceShader "+f+"::"+g.value()+" : "+l)):console.error(b.getShaderInfoLog(e)):console.error(b.getShaderInfoLog(t))}b.useProgram(this.screenSpaceShaders[f][g.value()].program);k.locations=this.screenSpaceShaders[f][g.value()].locations;b.enableVertexAttribArray(k.locations.ymaxekn);b.enableVertexAttribArray(k.locations.pcgewnw)};k.prototype.createGoochShader=function(){if(!this.shaderProgramGooch){b.useProgram(null);
var d=b.createShader(b.VERTEX_SHADER),g=b.createShader(b.FRAGMENT_SHADER);b.shaderSource(d,this.globalHead+this.globalVertexHead+getShaderCode("vertexShaderGoochRendering"));b.shaderSource(g,this.globalHead+this.globalFragmentHead+getShaderCode("fragmentShaderGoochRendering"));b.compileShader(d);b.compileShader(g);this.shaderProgramGooch=b.createProgram();b.attachShader(this.shaderProgramGooch,d);b.attachShader(this.shaderProgramGooch,g);b.linkProgram(this.shaderProgramGooch);if(!b.getShaderParameter(d,
b.COMPILE_STATUS))return console.error(b.getShaderInfoLog(d)),null;if(!b.getShaderParameter(g,b.COMPILE_STATUS))return console.error(b.getShaderInfoLog(g)),null;b.getProgramParameter(this.shaderProgramGooch,b.LINK_STATUS)||b.isContextLost()||(d=b.getProgramInfoLog(this.shaderProgramGooch),console.error("Error in program linking : gooch : "+d));b.useProgram(this.shaderProgramGooch);this.goochLocations=this.generateLocations(this.shaderProgramGooch)}};k.prototype.useGoochShader=function(d){this.clearVertexAttribs();
b.useProgram(this.shaderProgramGooch);d.locations=this.goochLocations;b.enableVertexAttribArray(this.goochLocations.ymaxekn);b.enableVertexAttribArray(this.goochLocations.pcgewnw)};k.prototype.createFramerateShader=function(){if(!this.shaderProgramFramerate){b.useProgram(null);var d=b.createShader(b.VERTEX_SHADER),g=b.createShader(b.FRAGMENT_SHADER);b.shaderSource(d,this.globalHead+this.globalVertexHead+getShaderCode("vertexShaderFramerateRendering"));b.shaderSource(g,this.globalHead+this.globalFragmentHead+
getShaderCode("fragmentShaderFramerateRendering"));b.compileShader(d);b.compileShader(g);this.shaderProgramFramerate=b.createProgram();b.attachShader(this.shaderProgramFramerate,d);b.attachShader(this.shaderProgramFramerate,g);b.linkProgram(this.shaderProgramFramerate);if(!b.getShaderParameter(d,b.COMPILE_STATUS))return console.error(b.getShaderInfoLog(d)),null;if(!b.getShaderParameter(g,b.COMPILE_STATUS))return console.error(b.getShaderInfoLog(g)),null;b.getProgramParameter(this.shaderProgramFramerate,
b.LINK_STATUS)||b.isContextLost()||(d=b.getProgramInfoLog(this.shaderProgramFramerate),console.error("Error in program linking : framerate : "+d));b.useProgram(this.shaderProgramFramerate);this.framerateLocations=this.generateLocations(this.shaderProgramFramerate)}};k.prototype.useFramerateShader=function(d){this.clearVertexAttribs();b.useProgram(this.shaderProgramFramerate);d.locations=this.framerateLocations;b.enableVertexAttribArray(this.framerateLocations.ymaxekn);b.enableVertexAttribArray(this.framerateLocations.aUv[0])};
k.prototype.compileGlowWritingShader=function(d,g){d=b.createShader(b.VERTEX_SHADER);var f=b.createShader(b.FRAGMENT_SHADER),k=this.globalHead+this.globalVertexHead+this.frVertexHead+getShaderCode("vertexShaderGlowWriting")+this.frVertexTail,l=this.globalHead+this.globalFragmentHead+this.frFragmentHead+this.sRGBfragmentBase+this.textureMappingFragmentBase+getShaderCode("fragmentShaderGlowWriting");b.shaderSource(d,k);b.shaderSource(f,l);b.compileShader(d);b.compileShader(f);this.glowWritingShaders[g.value()]=
{program:b.createProgram(),locations:null,type:g};if(!b.getShaderParameter(d,b.COMPILE_STATUS))return console.error(b.getShaderInfoLog(d)),null;if(!b.getShaderParameter(f,b.COMPILE_STATUS))return console.error(b.getShaderInfoLog(f)),null;k=this.glowWritingShaders[g.value()].program;this.shaderTypesFromValue[g.value()]=g;b.attachShader(k,d);b.attachShader(k,f);b.linkProgram(k);if(!b.getProgramParameter(k,b.LINK_STATUS)&&!b.isContextLost())return g=b.getProgramInfoLog(k),console.error("Error in program linking : GlowWriting : "+
g),null;this.glowWritingShaders[g.value()].locations=this.generateLocations(k);b.validateProgram(k);b.flush();b.finish()};k.prototype.createGlowWritingShader=function(d){var f=new u(d);b.useProgram(null);this.glowWritingShaders[f.value()]||this.compileGlowWritingShader(d,f)};k.prototype.useGlowWritingShader=function(d,g){var f=new u(g),k=this.glowWritingShaders[f.value()];k||(this.createGlowWritingShader(g),k=this.glowWritingShaders[f.value()]);this.clearVertexAttribs();b.useProgram(k.program);d.locations=
k.locations;b.enableVertexAttribArray(d.locations.ymaxekn)};k.prototype.createGlowRenderingShader=function(){if(!this.shaderProgramGlowRendering){b.useProgram(null);var d=b.createShader(b.VERTEX_SHADER),g=b.createShader(b.FRAGMENT_SHADER);b.shaderSource(d,this.globalHead+this.globalVertexHead+getShaderCode("vertexShaderGlowRendering"));b.shaderSource(g,this.globalHead+this.globalFragmentHead+getShaderCode("fragmentShaderGlowRendering"));b.compileShader(d);b.compileShader(g);this.shaderProgramGlowRendering=
b.createProgram();b.attachShader(this.shaderProgramGlowRendering,d);b.attachShader(this.shaderProgramGlowRendering,g);b.linkProgram(this.shaderProgramGlowRendering);if(!b.getShaderParameter(d,b.COMPILE_STATUS))return console.error(b.getShaderInfoLog(d)),null;if(!b.getShaderParameter(g,b.COMPILE_STATUS))return console.error(b.getShaderInfoLog(g)),null;b.getProgramParameter(this.shaderProgramGlowRendering,b.LINK_STATUS)||b.isContextLost()||(d=b.getProgramInfoLog(this.shaderProgramGlowRendering),console.error("Error in program linking : GlowRendering : "+
d));b.useProgram(this.shaderProgramGlowRendering);this.glowRenderingLocations=this.generateLocations(this.shaderProgramGlowRendering)}};k.prototype.useGlowRenderingShader=function(d){null==this.shaderProgramGlowRendering&&this.createGlowRenderingShader();this.clearVertexAttribs();b.useProgram(this.shaderProgramGlowRendering);d.locations=this.glowRenderingLocations;b.enableVertexAttribArray(this.glowRenderingLocations.ymaxekn);b.enableVertexAttribArray(this.glowRenderingLocations.aUv[0])};k.prototype.createSilhouettesShader=
function(){if(!this.shaderProgramSilhouettes){b.useProgram(null);var d=b.createShader(b.VERTEX_SHADER),g=b.createShader(b.FRAGMENT_SHADER);b.shaderSource(d,this.globalHead+this.globalVertexHead+getShaderCode("vertexShaderSilhouettesRendering"));b.shaderSource(g,this.globalHead+this.globalFragmentHead+getShaderCode("fragmentShaderSilhouettesRendering"));b.compileShader(d);b.compileShader(g);this.shaderProgramSilhouettes=b.createProgram();b.attachShader(this.shaderProgramSilhouettes,d);b.attachShader(this.shaderProgramSilhouettes,
g);b.linkProgram(this.shaderProgramSilhouettes);if(!b.getShaderParameter(d,b.COMPILE_STATUS))return console.error(b.getShaderInfoLog(d)),null;if(!b.getShaderParameter(g,b.COMPILE_STATUS))return console.error(b.getShaderInfoLog(g)),null;b.getProgramParameter(this.shaderProgramSilhouettes,b.LINK_STATUS)||b.isContextLost()||(d=b.getProgramInfoLog(this.shaderProgramSilhouettes),console.error("Error in program linking : Silhouettes : "+d));b.useProgram(this.shaderProgramSilhouettes);this.silhouettesLocations=
this.generateLocations(this.shaderProgramSilhouettes)}};k.prototype.useSilhouettesShader=function(d){this.clearVertexAttribs();b.useProgram(this.shaderProgramSilhouettes);d.locations=this.silhouettesLocations;b.enableVertexAttribArray(this.silhouettesLocations.ymaxekn)};k.prototype.createSilhouettesFromShadowShader=function(){if(!this.shaderProgramSilhouettesFromShadow){b.useProgram(null);var d=b.createShader(b.VERTEX_SHADER),g=b.createShader(b.FRAGMENT_SHADER);b.shaderSource(d,this.globalHead+this.globalVertexHead+
getShaderCode("vertexShaderSilhouettesRendering"));b.shaderSource(g,this.globalHead+this.globalFragmentHead+this.shadowsHead+getShaderCode("fragmentShaderSilhouettesFromShadowRendering"));b.compileShader(d);b.compileShader(g);this.shaderProgramSilhouettesFromShadow=b.createProgram();b.attachShader(this.shaderProgramSilhouettesFromShadow,d);b.attachShader(this.shaderProgramSilhouettesFromShadow,g);b.linkProgram(this.shaderProgramSilhouettesFromShadow);if(!b.getShaderParameter(d,b.COMPILE_STATUS))return console.error(b.getShaderInfoLog(d)),
null;if(!b.getShaderParameter(g,b.COMPILE_STATUS))return console.error(b.getShaderInfoLog(g)),null;b.getProgramParameter(this.shaderProgramSilhouettesFromShadow,b.LINK_STATUS)||b.isContextLost()||(d=b.getProgramInfoLog(this.shaderProgramSilhouettesFromShadow),console.error("Error in program linking : SilhouettesFromShadow : "+d));b.useProgram(this.shaderProgramSilhouettesFromShadow);this.silhouettesFromShadowLocations=this.generateLocations(this.shaderProgramSilhouettesFromShadow)}};k.prototype.useSilhouettesFromShadowShader=
function(d){this.clearVertexAttribs();b.useProgram(this.shaderProgramSilhouettesFromShadow);d.locations=this.silhouettesFromShadowLocations;b.enableVertexAttribArray(this.silhouettesFromShadowLocations.ymaxekn)};k.prototype.createSSAOShaders=function(d){if(this.shaderProgramSSAO1Pass&&this.shaderProgramSSAO1PassFast&&this.shaderProgramSSAO2Pass&&this.shaderProgramSSAO2PassFast)if(d!==this.shaderProgramSSAODepthThreshold)b.deleteProgram(this.shaderProgramSSAO1Pass),b.deleteProgram(this.shaderProgramSSAO1PassFast),
b.deleteProgram(this.shaderProgramSSAO2Pass),b.deleteProgram(this.shaderProgramSSAO2PassFast),this.shaderProgramSSAO1Pass=this.shaderProgramSSAO2Pass=this.shaderProgramSSAO1PassFast=this.shaderProgramSSAO2PassFast=null;else return;this.shaderProgramSSAODepthThreshold=d;b.useProgram(null);var f=b.createShader(b.VERTEX_SHADER);b.shaderSource(f,this.globalHead+this.globalVertexHead+getShaderCode("vertexShaderSSAORendering"));b.compileShader(f);if(!b.getShaderParameter(f,b.COMPILE_STATUS))return console.error(b.getShaderInfoLog(f)),
null;for(var g=1;2>=g;g++){var k="#define pqgtjfs "+g+"\n";b.webgl2&&b.floatTextures&&(k+="#define bhvqgmf\n");d&&(k+="#define upfifwg "+d+"\n");var l=b.createShader(b.FRAGMENT_SHADER);b.shaderSource(l,this.globalHead+this.globalFragmentHead+k+getShaderCode("fragmentShaderSSAORendering"));b.compileShader(l);if(!b.getShaderParameter(l,b.COMPILE_STATUS))return console.error(b.getShaderInfoLog(l)),null;var q="shaderProgramSSAO"+g+"Pass";this[q]=b.createProgram();b.attachShader(this[q],f);b.attachShader(this[q],
l);b.linkProgram(this[q]);b.getProgramParameter(this[q],b.LINK_STATUS)||b.isContextLost()||(l=b.getProgramInfoLog(this[q]),console.error("Error in program linking : SSAO : "+l));k="#define qwscdzr\n"+k;l=b.createShader(b.FRAGMENT_SHADER);b.shaderSource(l,this.globalHead+this.globalFragmentHead+k+getShaderCode("fragmentShaderSSAORendering"));b.compileShader(l);if(!b.getShaderParameter(l,b.COMPILE_STATUS))return console.error(b.getShaderInfoLog(l)),null;q="shaderProgramSSAO"+g+"PassFast";this[q]=b.createProgram();
b.attachShader(this[q],f);b.attachShader(this[q],l);b.linkProgram(this[q]);b.getProgramParameter(this[q],b.LINK_STATUS)||b.isContextLost()||(l=b.getProgramInfoLog(this[q]),console.error("Error in program linking : SSAO FAst : "+l))}};k.prototype.useSSAOShader=function(d,g,k){g=Math.min(g||1,2);shaderProgramName="shaderProgramSSAO"+g+"Pass"+(k?"Fast":"");this.clearVertexAttribs();b.useProgram(this[shaderProgramName]);d.locations=this.generateLocations(this[shaderProgramName]);b.enableVertexAttribArray(d.locations.ymaxekn)};
k.prototype.createSSAOFilteringShader=function(){if(!this.shaderProgramSSAOFiltering){b.useProgram(null);var d=b.createShader(b.VERTEX_SHADER),g=b.createShader(b.FRAGMENT_SHADER);b.shaderSource(d,this.globalHead+this.globalVertexHead+getShaderCode("vertexShaderSSAOFiltering"));b.shaderSource(g,this.globalHead+this.globalFragmentHead+getShaderCode("fragmentShaderSSAOFiltering"));b.compileShader(d);b.compileShader(g);this.shaderProgramSSAOFiltering=b.createProgram();b.attachShader(this.shaderProgramSSAOFiltering,
d);b.attachShader(this.shaderProgramSSAOFiltering,g);b.linkProgram(this.shaderProgramSSAOFiltering);if(!b.getShaderParameter(d,b.COMPILE_STATUS))return console.error(b.getShaderInfoLog(d)),null;if(!b.getShaderParameter(g,b.COMPILE_STATUS))return console.error(b.getShaderInfoLog(g)),null;b.getProgramParameter(this.shaderProgramSSAOFiltering,b.LINK_STATUS)||b.isContextLost()||(d=b.getProgramInfoLog(this.shaderProgramSSAOFiltering),console.error("Error in program linking : SSAOFiltering : "+d));b.useProgram(this.shaderProgramSSAOFiltering);
this.SSAOFilteringLocations=this.generateLocations(this.shaderProgramSSAOFiltering)}};k.prototype.useSSAOFilteringShader=function(d){this.clearVertexAttribs();b.useProgram(this.shaderProgramSSAOFiltering);d.locations=this.SSAOFilteringLocations;b.enableVertexAttribArray(this.SSAOFilteringLocations.ymaxekn)};k.prototype.createOneColorShader=function(){if(!this.shaderProgramOneColor){b.useProgram(null);var d=b.createShader(b.VERTEX_SHADER),g=b.createShader(b.FRAGMENT_SHADER);b.shaderSource(d,this.globalHead+
this.globalVertexHead+getShaderCode("vertexShaderOneColorRendering"));b.shaderSource(g,this.globalHead+this.globalFragmentHead+(this.dynamicLights?"#define acjdrtz 1\n":"")+getShaderCode("fragmentShaderOneColorRendering"));b.compileShader(d);b.compileShader(g);this.shaderProgramOneColor=b.createProgram();b.attachShader(this.shaderProgramOneColor,d);b.attachShader(this.shaderProgramOneColor,g);b.linkProgram(this.shaderProgramOneColor);if(!b.getShaderParameter(d,b.COMPILE_STATUS))return console.error(b.getShaderInfoLog(d)),
null;if(!b.getShaderParameter(g,b.COMPILE_STATUS))return console.error(b.getShaderInfoLog(g)),null;b.getProgramParameter(this.shaderProgramOneColor,b.LINK_STATUS)||b.isContextLost()||(d=b.getProgramInfoLog(this.shaderProgramOneColor),console.error("Error in program linking : one color : "+d));b.useProgram(this.shaderProgramOneColor);this.oneColorLocations=this.generateLocations(this.shaderProgramOneColor)}};k.prototype.useOneColorShader=function(d,g){this.clearVertexAttribs();b.useProgram(this.shaderProgramOneColor);
d.locations=this.oneColorLocations;b.enableVertexAttribArray(this.oneColorLocations.ymaxekn);g||b.enableVertexAttribArray(this.oneColorLocations.qhsvewr);b.uniformMatrix4fv(d.locations.ampnorz,!1,d.viewMatrix);b.uniformMatrix4fv(d.locations.ghgsnpw,!1,d.projectionMatrix);b.uniform1f(d.locations.cqcpvcg,0)};k.prototype.createCubeRenderingShader=function(){if(!this.shaderProgramCubeRendering){b.useProgram(null);var d=b.createShader(b.VERTEX_SHADER),g=b.createShader(b.FRAGMENT_SHADER);b.shaderSource(d,
this.globalHead+this.globalVertexHead+getShaderCode("vertexShaderCubeRendering"));b.shaderSource(g,this.globalHead+this.globalFragmentHead+getShaderCode("fragmentShaderCubeRendering"));b.compileShader(d);b.compileShader(g);this.shaderProgramCubeRendering=b.createProgram();b.attachShader(this.shaderProgramCubeRendering,d);b.attachShader(this.shaderProgramCubeRendering,g);b.linkProgram(this.shaderProgramCubeRendering);if(!b.getShaderParameter(d,b.COMPILE_STATUS))return console.error(b.getShaderInfoLog(d)),
null;if(!b.getShaderParameter(g,b.COMPILE_STATUS))return console.error(b.getShaderInfoLog(g)),null;b.getProgramParameter(this.shaderProgramCubeRendering,b.LINK_STATUS)||b.isContextLost()||(d=b.getProgramInfoLog(this.shaderProgramCubeRendering),console.error("Error in program linking : cube : "+d));b.useProgram(this.shaderProgramCubeRendering);this.cubeRenderingLocations=this.generateLocations(this.shaderProgramCubeRendering)}};k.prototype.useCubeRenderingShader=function(d){this.clearVertexAttribs();
b.useProgram(this.shaderProgramCubeRendering);d.locations=this.cubeRenderingLocations;b.enableVertexAttribArray(this.cubeRenderingLocations.ymaxekn)};k.prototype.createEnvironmentRenderingShader=function(){if(!this.shaderProgramEnvironmentRendering||this.environmentRenderingCompiledLightHead!==this.lightsHead){this.shaderProgramEnvironmentRendering&&b.deleteProgram(this.shaderProgramEnvironmentRendering);this.environmentRenderingCompiledLightHead=this.lightsHead;b.useProgram(null);var d=b.createShader(b.VERTEX_SHADER),
g=b.createShader(b.FRAGMENT_SHADER);b.shaderSource(d,this.globalHead+this.globalVertexHead+getShaderCode("vertexShaderEnvironmentRendering"));b.shaderSource(g,this.globalHead+this.globalFragmentHead+this.lightsHead+this.bilinearRGBETexture2D+getShaderCode("fragmentShaderEnvironmentRendering"));b.compileShader(d);b.compileShader(g);this.shaderProgramEnvironmentRendering=b.createProgram();b.attachShader(this.shaderProgramEnvironmentRendering,d);b.attachShader(this.shaderProgramEnvironmentRendering,
g);b.linkProgram(this.shaderProgramEnvironmentRendering);if(!b.getShaderParameter(d,b.COMPILE_STATUS))return console.error(b.getShaderInfoLog(d)),null;if(!b.getShaderParameter(g,b.COMPILE_STATUS))return console.error(b.getShaderInfoLog(g)),console.log(b.getShaderSource(g)),null;b.getProgramParameter(this.shaderProgramEnvironmentRendering,b.LINK_STATUS)||b.isContextLost()||(d=b.getProgramInfoLog(this.shaderProgramEnvironmentRendering),console.error("Error in program linking : environment : "+d));b.useProgram(this.shaderProgramEnvironmentRendering);
this.environmentRenderingLocations=this.generateLocations(this.shaderProgramEnvironmentRendering)}};k.prototype.useEnvironmentRenderingShader=function(d){this.clearVertexAttribs();b.useProgram(this.shaderProgramEnvironmentRendering);d.locations=this.environmentRenderingLocations;b.enableVertexAttribArray(this.environmentRenderingLocations.ymaxekn)};k.prototype.createEnvironmentRenderingForCubeMapShader=function(){this.shaderProgramEnvironmentRenderingForCubeMap&&b.deleteProgram(this.shaderProgramEnvironmentRenderingForCubeMap);
b.useProgram(null);var d=b.createShader(b.VERTEX_SHADER),g=b.createShader(b.FRAGMENT_SHADER);b.shaderSource(d,this.globalHead+this.globalVertexHead+getShaderCode("vertexShaderEnvironmentRenderingForCubeMap"));b.shaderSource(g,this.globalHead+this.globalFragmentHead+this.lightsHead+this.bilinearRGBETexture2D+getShaderCode("fragmentShaderEnvironmentRenderingForCubeMap"));b.compileShader(d);b.compileShader(g);this.shaderProgramEnvironmentRenderingForCubeMap=b.createProgram();b.attachShader(this.shaderProgramEnvironmentRenderingForCubeMap,
d);b.attachShader(this.shaderProgramEnvironmentRenderingForCubeMap,g);b.linkProgram(this.shaderProgramEnvironmentRenderingForCubeMap);if(!b.getShaderParameter(d,b.COMPILE_STATUS))return console.error(b.getShaderInfoLog(d)),null;if(!b.getShaderParameter(g,b.COMPILE_STATUS))return console.error(b.getShaderInfoLog(g)),console.log(b.getShaderSource(g)),null;b.getProgramParameter(this.shaderProgramEnvironmentRenderingForCubeMap,b.LINK_STATUS)||b.isContextLost()||(d=b.getProgramInfoLog(this.shaderProgramEnvironmentRenderingForCubeMap),
console.error("Error in program linking : environment for cubemap : "+d));b.useProgram(this.shaderProgramEnvironmentRenderingForCubeMap);this.environmentRenderingForCubeMapLocations=this.generateLocations(this.shaderProgramEnvironmentRenderingForCubeMap)};k.prototype.useEnvironmentRenderingForCubeMapShader=function(d){this.clearVertexAttribs();b.useProgram(this.shaderProgramEnvironmentRenderingForCubeMap);d.locations=this.environmentRenderingForCubeMapLocations;b.enableVertexAttribArray(this.environmentRenderingForCubeMapLocations.ymaxekn)};
var q=function(b){var d="";for(p in b.equations){var f=b.equations[p];switch(f.type){case 1:var g=b.cubeCenter,k="",l=vec3.subtract(f.v2,f.v1,vec3.create()),q=vec3.subtract(f.v3,f.v2,vec3.create()),e=vec3.subtract(f.v4,f.v3,vec3.create()),t=vec3.subtract(f.v1,f.v4,vec3.create()),r=-vec3.dot(f.normal,f.v1);parseInt(r)===r&&(r=""+r+".0");k+="t = -(dot(vec3("+f.normal[0]+","+f.normal[1]+","+f.normal[2]+"), vVertexPos) + "+r+")";k+=" / dot(vec3("+f.normal[0]+","+f.normal[1]+","+f.normal[2]+"), refr);\n";
k=k+"p = vVertexPos + t * refr;\nif ("+("dot(vec3("+f.normal[0]+","+f.normal[1]+","+f.normal[2]+"),");k+="cross(vec3("+l[0]+","+l[1]+","+l[2]+"),(p-vec3("+f.v1[0]+","+f.v1[1]+","+f.v1[2]+")))) > 0.0 &&";k+="dot(vec3("+f.normal[0]+","+f.normal[1]+","+f.normal[2]+"),";k+="cross(vec3("+q[0]+","+q[1]+","+q[2]+"),(p-vec3("+f.v2[0]+","+f.v2[1]+","+f.v2[2]+")))) > 0.0 &&";k+="dot(vec3("+f.normal[0]+","+f.normal[1]+","+f.normal[2]+"),";k+="cross(vec3("+e[0]+","+e[1]+","+e[2]+"),(p-vec3("+f.v3[0]+","+f.v3[1]+
","+f.v3[2]+")))) > 0.0 &&";k+="dot(vec3("+f.normal[0]+","+f.normal[1]+","+f.normal[2]+"),";k+="cross(vec3("+t[0]+","+t[1]+","+t[2]+"),(p-vec3("+f.v4[0]+","+f.v4[1]+","+f.v4[2]+")))) > 0.0) {\n";k+="refr = normalize(p - vec3("+g[0]+","+g[1]+","+g[2]+"));\n";d+=k+"} else {\n";break;default:d+="{\n"}}d+="refr = vec3(0);\n";for(p in b.equations)d+="}\n";for(p in b.equations)switch(f=b.equations[p],f.type){case 1:g=b.cubeCenter;k="";0===f.normal[0]&&1===f.normal[1]&&0===f.normal[2]?f="{\n":(l=vec3.subtract(f.v2,
f.v1,vec3.create()),q=vec3.subtract(f.v3,f.v2,vec3.create()),e=vec3.subtract(f.v4,f.v3,vec3.create()),t=vec3.subtract(f.v1,f.v4,vec3.create()),r=-vec3.dot(f.normal,f.v1),parseInt(r)===r&&(r=""+r+".0"),k+="t = -(dot(vec3("+f.normal[0]+","+f.normal[1]+","+f.normal[2]+"), vVertexPos) + "+r+")",k+=" / dot(vec3("+f.normal[0]+","+f.normal[1]+","+f.normal[2]+"), refl);\n",k=k+"p = vVertexPos + t * refl;\nif ("+("dot(vec3("+f.normal[0]+","+f.normal[1]+","+f.normal[2]+"),"),k+="cross(vec3("+l[0]+","+l[1]+
","+l[2]+"),(p-vec3("+f.v1[0]+","+f.v1[1]+","+f.v1[2]+")))) > 0.0 &&",k+="dot(vec3("+f.normal[0]+","+f.normal[1]+","+f.normal[2]+"),",k+="cross(vec3("+q[0]+","+q[1]+","+q[2]+"),(p-vec3("+f.v2[0]+","+f.v2[1]+","+f.v2[2]+")))) > 0.0 &&",k+="dot(vec3("+f.normal[0]+","+f.normal[1]+","+f.normal[2]+"),",k+="cross(vec3("+e[0]+","+e[1]+","+e[2]+"),(p-vec3("+f.v3[0]+","+f.v3[1]+","+f.v3[2]+")))) > 0.0 &&",k+="dot(vec3("+f.normal[0]+","+f.normal[1]+","+f.normal[2]+"),",k+="cross(vec3("+t[0]+","+t[1]+","+t[2]+
"),(p-vec3("+f.v4[0]+","+f.v4[1]+","+f.v4[2]+")))) > 0.0 &&",k+="dot(iieuufh, vec3("+f.normal[0]+","+f.normal[1]+","+f.normal[2]+")) < 0.0) {\n",k+="refl = normalize(p - vec3("+g[0]+","+g[1]+","+g[2]+"));\n",f=k+"} else {\n");d+=f;break;default:d+="{\n"}for(p in b.equations)d+="}\n";d=d+"vec3 reflColor = textureCube(tdolhkz, refl).rgb;\n"+("vec3 refrColor = textureCube(tdolhkz, refr).rgb * vec3("+b.color[0]+","+b.color[1]+","+b.color[2]+");\n");var p=b.refractionRatio;parseInt(p)===p&&(p=""+p+".0");
b=b.cubeCenter[1];parseInt(b)===b&&(b=""+b+".0");d=d+("gl_FragColor.rgb = mix(reflColor.rgb, refrColor.rgb, "+p+");\n")+"gl_FragColor.a   = 1.0;\n"+("gl_FragColor.rgb += vec3(1.0) * (vVertexPos.y - "+b+");\n");return d+="}\n"};k.prototype.createWaterRenderingShader=function(d){this.shaderProgramWaterRendering&&b.deleteProgram(this.shaderProgramWaterRendering);b.useProgram(null);var f=b.createShader(b.VERTEX_SHADER),g=b.createShader(b.FRAGMENT_SHADER);b.shaderSource(f,this.globalHead+this.globalVertexHead+
getShaderCode("vertexShaderWaterRendering"));b.shaderSource(g,this.globalHead+this.globalFragmentHead+getShaderCode("fragmentShaderWaterRendering")+q(d));b.compileShader(f);b.compileShader(g);this.shaderProgramWaterRendering=b.createProgram();b.attachShader(this.shaderProgramWaterRendering,f);b.attachShader(this.shaderProgramWaterRendering,g);b.linkProgram(this.shaderProgramWaterRendering);if(!b.getShaderParameter(f,b.COMPILE_STATUS))return console.error(b.getShaderInfoLog(f)),null;if(!b.getShaderParameter(g,
b.COMPILE_STATUS))return console.error(b.getShaderInfoLog(g)),null;b.getProgramParameter(this.shaderProgramWaterRendering,b.LINK_STATUS)||b.isContextLost()||(d=b.getProgramInfoLog(this.shaderProgramWaterRendering),console.error("Error in program linking : water : "+d));b.useProgram(this.shaderProgramWaterRendering);this.waterRenderingLocations=this.generateLocations(this.shaderProgramWaterRendering)};k.prototype.useWaterRenderingShader=function(d){this.clearVertexAttribs();b.useProgram(this.shaderProgramWaterRendering);
d.locations=this.waterRenderingLocations;b.enableVertexAttribArray(this.waterRenderingLocations.ymaxekn);b.enableVertexAttribArray(this.waterRenderingLocations.qhsvewr)};k.prototype.createMeshEditingShader=function(){if(!this.shaderProgramMeshEditingRendering){b.useProgram(null);var d=b.createShader(b.VERTEX_SHADER),g=b.createShader(b.FRAGMENT_SHADER);b.shaderSource(d,this.globalHead+this.globalVertexHead+getShaderCode("vertexShaderMeshEditingRendering"));b.shaderSource(g,this.globalHead+this.globalFragmentHead+
getShaderCode("fragmentShaderMeshEditingRendering"));b.compileShader(d);b.compileShader(g);this.shaderProgramMeshEditingRendering=b.createProgram();b.attachShader(this.shaderProgramMeshEditingRendering,d);b.attachShader(this.shaderProgramMeshEditingRendering,g);b.linkProgram(this.shaderProgramMeshEditingRendering);if(!b.getShaderParameter(d,b.COMPILE_STATUS))return console.error(b.getShaderInfoLog(d)),null;if(!b.getShaderParameter(g,b.COMPILE_STATUS))return console.error(b.getShaderInfoLog(g)),null;
b.getProgramParameter(this.shaderProgramMeshEditingRendering,b.LINK_STATUS)||b.isContextLost()||(d=b.getProgramInfoLog(this.shaderProgramMeshEditingRendering),console.error("Error in program linking : one color : "+d));b.useProgram(this.shaderProgramMeshEditingRendering);this.meshEditingLocations=this.generateLocations(this.shaderProgramMeshEditingRendering)}};k.prototype.useMeshEditingShader=function(d){this.clearVertexAttribs();b.useProgram(this.shaderProgramMeshEditingRendering);d.locations=this.meshEditingLocations;
b.enableVertexAttribArray(this.meshEditingLocations.ymaxekn);b.enableVertexAttribArray(this.meshEditingLocations.qhsvewr)};k.prototype.createTextureFilterVert1Shader=function(){if(!this.shaderProgramTextureFilterVert1){b.useProgram(null);if(!this.filterVertexShader&&(this.filterVertexShader=b.createShader(b.VERTEX_SHADER),b.shaderSource(this.filterVertexShader,this.globalHead+getShaderCode("vertexShaderTextureFilter")),b.compileShader(this.filterVertexShader),!b.getShaderParameter(this.filterVertexShader,
b.COMPILE_STATUS)))return console.error(b.getShaderInfoLog(this.filterVertexShader)),delete this.filterVertexShader,null;var d=b.createShader(b.FRAGMENT_SHADER);b.shaderSource(d,this.globalHead+this.globalFragmentHead+this.bilinearRGBETexture2D+getShaderCode("fragmentShaderTextureFilterVert1"));b.compileShader(d);this.shaderProgramTextureFilterVert1=b.createProgram();b.attachShader(this.shaderProgramTextureFilterVert1,this.filterVertexShader);b.attachShader(this.shaderProgramTextureFilterVert1,d);
b.linkProgram(this.shaderProgramTextureFilterVert1);if(!b.getShaderParameter(d,b.COMPILE_STATUS))return console.error(b.getShaderInfoLog(d)),null;b.getProgramParameter(this.shaderProgramTextureFilterVert1,b.LINK_STATUS)||b.isContextLost()||(d=b.getProgramInfoLog(this.shaderProgramTextureFilterVert1),console.error("Error in program linking : TexturefilterVert1 : "+d));b.useProgram(this.shaderProgramTextureFilterVert1);this.textureFilterVert1Locations=this.generateLocations(this.shaderProgramTextureFilterVert1)}};
k.prototype.useTextureFilterVert1Shader=function(d){this.clearVertexAttribs();b.useProgram(this.shaderProgramTextureFilterVert1);d.locations=this.textureFilterVert1Locations;b.enableVertexAttribArray(this.textureFilterVert1Locations.ymaxekn)};k.prototype.createTextureFilterHori1Shader=function(){if(!this.shaderProgramTextureFilterHori1){b.useProgram(null);if(!this.filterVertexShader&&(this.filterVertexShader=b.createShader(b.VERTEX_SHADER),b.shaderSource(this.filterVertexShader,this.globalHead+getShaderCode("vertexShaderTextureFilter")),
b.compileShader(this.filterVertexShader),!b.getShaderParameter(this.filterVertexShader,b.COMPILE_STATUS)))return console.error(b.getShaderInfoLog(this.filterVertexShader)),delete this.filterVertexShader,null;var d=b.createShader(b.FRAGMENT_SHADER);b.shaderSource(d,this.globalHead+this.globalFragmentHead+this.bilinearRGBETexture2D+getShaderCode("fragmentShaderTextureFilterHori1"));b.compileShader(d);this.shaderProgramTextureFilterHori1=b.createProgram();b.attachShader(this.shaderProgramTextureFilterHori1,
this.filterVertexShader);b.attachShader(this.shaderProgramTextureFilterHori1,d);b.linkProgram(this.shaderProgramTextureFilterHori1);if(!b.getShaderParameter(d,b.COMPILE_STATUS))return console.error(b.getShaderInfoLog(d)),null;b.getProgramParameter(this.shaderProgramTextureFilterHori1,b.LINK_STATUS)||b.isContextLost()||(d=b.getProgramInfoLog(this.shaderProgramTextureFilterHori1),console.error("Error in program linking : TexturefilterHori1 : "+d));b.useProgram(this.shaderProgramTextureFilterHori1);
this.textureFilterHori1Locations=this.generateLocations(this.shaderProgramTextureFilterHori1)}};k.prototype.useTextureFilterHori1Shader=function(d){this.clearVertexAttribs();b.useProgram(this.shaderProgramTextureFilterHori1);d.locations=this.textureFilterHori1Locations;b.enableVertexAttribArray(this.textureFilterHori1Locations.ymaxekn)};k.prototype.createTextureFilterVert2Shader=function(){if(!this.shaderProgramTextureFilterVert2){b.useProgram(null);if(!this.filterVertexShader&&(this.filterVertexShader=
b.createShader(b.VERTEX_SHADER),b.shaderSource(this.filterVertexShader,this.globalHead+getShaderCode("vertexShaderTextureFilter")),b.compileShader(this.filterVertexShader),!b.getShaderParameter(this.filterVertexShader,b.COMPILE_STATUS)))return console.error(b.getShaderInfoLog(this.filterVertexShader)),delete this.filterVertexShader,null;var d=b.createShader(b.FRAGMENT_SHADER);b.shaderSource(d,this.globalHead+this.globalFragmentHead+this.bilinearRGBETexture2D+getShaderCode("fragmentShaderTextureFilterVert2"));
b.compileShader(d);this.shaderProgramTextureFilterVert2=b.createProgram();b.attachShader(this.shaderProgramTextureFilterVert2,this.filterVertexShader);b.attachShader(this.shaderProgramTextureFilterVert2,d);b.linkProgram(this.shaderProgramTextureFilterVert2);if(!b.getShaderParameter(d,b.COMPILE_STATUS))return console.warn(this.globalHead),console.error(b.getShaderInfoLog(d)),null;b.getProgramParameter(this.shaderProgramTextureFilterVert2,b.LINK_STATUS)||b.isContextLost()||(d=b.getProgramInfoLog(this.shaderProgramTextureFilterVert2),
console.error("Error in program linking : TexturefilterVert2 : "+d));b.useProgram(this.shaderProgramTextureFilterVert2);this.textureFilterVert2Locations=this.generateLocations(this.shaderProgramTextureFilterVert2)}};k.prototype.useTextureFilterVert2Shader=function(d){this.clearVertexAttribs();b.useProgram(this.shaderProgramTextureFilterVert2);d.locations=this.textureFilterVert2Locations;b.enableVertexAttribArray(this.textureFilterVert2Locations.ymaxekn)};k.prototype.createTextureFilterHori2Shader=
function(){if(!this.shaderProgramTextureFilterHori2){b.useProgram(null);if(!this.filterVertexShader&&(this.filterVertexShader=b.createShader(b.VERTEX_SHADER),b.shaderSource(this.filterVertexShader,this.globalHead+getShaderCode("vertexShaderTextureFilter")),b.compileShader(this.filterVertexShader),!b.getShaderParameter(this.filterVertexShader,b.COMPILE_STATUS)))return console.error(b.getShaderInfoLog(this.filterVertexShader)),delete this.filterVertexShader,null;var d=b.createShader(b.FRAGMENT_SHADER);
b.shaderSource(d,this.globalHead+this.globalFragmentHead+this.bilinearRGBETexture2D+getShaderCode("fragmentShaderTextureFilterHori2"));b.compileShader(d);this.shaderProgramTextureFilterHori2=b.createProgram();b.attachShader(this.shaderProgramTextureFilterHori2,this.filterVertexShader);b.attachShader(this.shaderProgramTextureFilterHori2,d);b.linkProgram(this.shaderProgramTextureFilterHori2);if(!b.getShaderParameter(d,b.COMPILE_STATUS))return console.error(b.getShaderInfoLog(d)),null;b.getProgramParameter(this.shaderProgramTextureFilterHori2,
b.LINK_STATUS)||b.isContextLost()||(d=b.getProgramInfoLog(this.shaderProgramTextureFilterHori2),console.error("Error in program linking : TexturefilterHori2 : "+d));b.useProgram(this.shaderProgramTextureFilterHori2);this.textureFilterHori2Locations=this.generateLocations(this.shaderProgramTextureFilterHori2)}};k.prototype.useTextureFilterHori2Shader=function(d){this.clearVertexAttribs();b.useProgram(this.shaderProgramTextureFilterHori2);d.locations=this.textureFilterHori2Locations;b.enableVertexAttribArray(this.textureFilterHori2Locations.ymaxekn)};
k.prototype.createTextureFilterVert3Shader=function(){if(!this.shaderProgramTextureFilterVert3){b.useProgram(null);if(!this.filterVertexShader&&(this.filterVertexShader=b.createShader(b.VERTEX_SHADER),b.shaderSource(this.filterVertexShader,this.globalHead+getShaderCode("vertexShaderTextureFilter")),b.compileShader(this.filterVertexShader),!b.getShaderParameter(this.filterVertexShader,b.COMPILE_STATUS)))return console.error(b.getShaderInfoLog(this.filterVertexShader)),delete this.filterVertexShader,
null;var d=b.createShader(b.FRAGMENT_SHADER);b.shaderSource(d,this.globalHead+this.globalFragmentHead+this.bilinearRGBETexture2D+getShaderCode("fragmentShaderTextureFilterVert3"));b.compileShader(d);this.shaderProgramTextureFilterVert3=b.createProgram();b.attachShader(this.shaderProgramTextureFilterVert3,this.filterVertexShader);b.attachShader(this.shaderProgramTextureFilterVert3,d);b.linkProgram(this.shaderProgramTextureFilterVert3);if(!b.getShaderParameter(d,b.COMPILE_STATUS))return console.error(b.getShaderInfoLog(d)),
null;b.getProgramParameter(this.shaderProgramTextureFilterVert3,b.LINK_STATUS)||b.isContextLost()||(d=b.getProgramInfoLog(this.shaderProgramTextureFilterVert3),console.error("Error in program linking : TexturefilterVert3 : "+d));b.useProgram(this.shaderProgramTextureFilterVert3);this.textureFilterVert3Locations=this.generateLocations(this.shaderProgramTextureFilterVert3)}};k.prototype.useTextureFilterVert3Shader=function(d){this.clearVertexAttribs();this.shaderProgramTextureFilterVert3||this.createTextureFilterVert3Shader();
b.useProgram(this.shaderProgramTextureFilterVert3);d.locations=this.textureFilterVert3Locations;b.enableVertexAttribArray(this.textureFilterVert3Locations.ymaxekn)};k.prototype.createTextureFilterHori3Shader=function(){if(!this.shaderProgramTextureFilterHori3){b.useProgram(null);if(!this.filterVertexShader&&(this.filterVertexShader=b.createShader(b.VERTEX_SHADER),b.shaderSource(this.filterVertexShader,this.globalHead+getShaderCode("vertexShaderTextureFilter")),b.compileShader(this.filterVertexShader),
!b.getShaderParameter(this.filterVertexShader,b.COMPILE_STATUS)))return console.error(b.getShaderInfoLog(this.filterVertexShader)),delete this.filterVertexShader,null;var d=b.createShader(b.FRAGMENT_SHADER);b.shaderSource(d,this.globalHead+this.globalFragmentHead+this.bilinearRGBETexture2D+getShaderCode("fragmentShaderTextureFilterHori3"));b.compileShader(d);this.shaderProgramTextureFilterHori3=b.createProgram();b.attachShader(this.shaderProgramTextureFilterHori3,this.filterVertexShader);b.attachShader(this.shaderProgramTextureFilterHori3,
d);b.linkProgram(this.shaderProgramTextureFilterHori3);if(!b.getShaderParameter(d,b.COMPILE_STATUS))return console.error(b.getShaderInfoLog(d)),null;b.getProgramParameter(this.shaderProgramTextureFilterHori3,b.LINK_STATUS)||b.isContextLost()||(d=b.getProgramInfoLog(this.shaderProgramTextureFilterHori3),console.error("Error in program linking : TexturefilterHori3 : "+d));b.useProgram(this.shaderProgramTextureFilterHori3);this.textureFilterHori3Locations=this.generateLocations(this.shaderProgramTextureFilterHori3)}};
k.prototype.useTextureFilterHori3Shader=function(d){this.clearVertexAttribs();this.shaderProgramTextureFilterHori3||this.createTextureFilterHori3Shader();b.useProgram(this.shaderProgramTextureFilterHori3);d.locations=this.textureFilterHori3Locations;b.enableVertexAttribArray(this.textureFilterHori3Locations.ymaxekn)};k.prototype.createTextureFilterVert4Shader=function(){if(!this.shaderProgramTextureFilterVert4){b.useProgram(null);if(!this.filterVertexShader&&(this.filterVertexShader=b.createShader(b.VERTEX_SHADER),
b.shaderSource(this.filterVertexShader,this.globalHead+getShaderCode("vertexShaderTextureFilter")),b.compileShader(this.filterVertexShader),!b.getShaderParameter(this.filterVertexShader,b.COMPILE_STATUS)))return console.error(b.getShaderInfoLog(this.filterVertexShader)),delete this.filterVertexShader,null;var d=b.createShader(b.FRAGMENT_SHADER);b.shaderSource(d,this.globalHead+this.globalFragmentHead+this.bilinearRGBETexture2D+getShaderCode("fragmentShaderTextureFilterVert4"));b.compileShader(d);
this.shaderProgramTextureFilterVert4=b.createProgram();b.attachShader(this.shaderProgramTextureFilterVert4,this.filterVertexShader);b.attachShader(this.shaderProgramTextureFilterVert4,d);b.linkProgram(this.shaderProgramTextureFilterVert4);if(!b.getShaderParameter(d,b.COMPILE_STATUS))return console.error(b.getShaderInfoLog(d)),null;b.getProgramParameter(this.shaderProgramTextureFilterVert4,b.LINK_STATUS)||b.isContextLost()||(d=b.getProgramInfoLog(this.shaderProgramTextureFilterVert4),console.error("Error in program linking : TexturefilterVert4 : "+
d));b.useProgram(this.shaderProgramTextureFilterVert4);this.textureFilterVert4Locations=this.generateLocations(this.shaderProgramTextureFilterVert4)}};k.prototype.useTextureFilterVert4Shader=function(d){this.clearVertexAttribs();this.shaderProgramTextureFilterVert4||this.createTextureFilterVert4Shader();b.useProgram(this.shaderProgramTextureFilterVert4);d.locations=this.textureFilterVert4Locations;b.enableVertexAttribArray(this.textureFilterVert4Locations.ymaxekn)};k.prototype.createTextureFilterHori4Shader=
function(){if(!this.shaderProgramTextureFilterHori4){b.useProgram(null);if(!this.filterVertexShader&&(this.filterVertexShader=b.createShader(b.VERTEX_SHADER),b.shaderSource(this.filterVertexShader,this.globalHead+getShaderCode("vertexShaderTextureFilter")),b.compileShader(this.filterVertexShader),!b.getShaderParameter(this.filterVertexShader,b.COMPILE_STATUS)))return console.error(b.getShaderInfoLog(this.filterVertexShader)),delete this.filterVertexShader,null;var d=b.createShader(b.FRAGMENT_SHADER);
b.shaderSource(d,this.globalHead+this.globalFragmentHead+this.bilinearRGBETexture2D+getShaderCode("fragmentShaderTextureFilterHori4"));b.compileShader(d);this.shaderProgramTextureFilterHori4=b.createProgram();b.attachShader(this.shaderProgramTextureFilterHori4,this.filterVertexShader);b.attachShader(this.shaderProgramTextureFilterHori4,d);b.linkProgram(this.shaderProgramTextureFilterHori4);if(!b.getShaderParameter(d,b.COMPILE_STATUS))return console.error(b.getShaderInfoLog(d)),null;b.getProgramParameter(this.shaderProgramTextureFilterHori4,
b.LINK_STATUS)||b.isContextLost()||(d=b.getProgramInfoLog(this.shaderProgramTextureFilterHori4),console.error("Error in program linking : TexturefilterHori4 : "+d));b.useProgram(this.shaderProgramTextureFilterHori4);this.textureFilterHori4Locations=this.generateLocations(this.shaderProgramTextureFilterHori4)}};k.prototype.useTextureFilterHori4Shader=function(d){this.clearVertexAttribs();this.shaderProgramTextureFilterHori4||this.createTextureFilterHori4Shader();b.useProgram(this.shaderProgramTextureFilterHori4);
d.locations=this.textureFilterHori4Locations;b.enableVertexAttribArray(this.textureFilterHori4Locations.ymaxekn)};k.prototype.createTextureFilterVert5Shader=function(){if(!this.shaderProgramTextureFilterVert5){b.useProgram(null);if(!this.filterVertexShader&&(this.filterVertexShader=b.createShader(b.VERTEX_SHADER),b.shaderSource(this.filterVertexShader,this.globalHead+getShaderCode("vertexShaderTextureFilter")),b.compileShader(this.filterVertexShader),!b.getShaderParameter(this.filterVertexShader,
b.COMPILE_STATUS)))return console.error(b.getShaderInfoLog(this.filterVertexShader)),delete this.filterVertexShader,null;var d=b.createShader(b.FRAGMENT_SHADER);b.shaderSource(d,this.globalHead+this.globalFragmentHead+this.bilinearRGBETexture2D+getShaderCode("fragmentShaderTextureFilterVert5"));b.compileShader(d);this.shaderProgramTextureFilterVert5=b.createProgram();b.attachShader(this.shaderProgramTextureFilterVert5,this.filterVertexShader);b.attachShader(this.shaderProgramTextureFilterVert5,d);
b.linkProgram(this.shaderProgramTextureFilterVert5);if(!b.getShaderParameter(d,b.COMPILE_STATUS))return console.error(b.getShaderInfoLog(d)),null;b.getProgramParameter(this.shaderProgramTextureFilterVert5,b.LINK_STATUS)||b.isContextLost()||(d=b.getProgramInfoLog(this.shaderProgramTextureFilterVert5),console.error("Error in program linking : TexturefilterVert5 : "+d));b.useProgram(this.shaderProgramTextureFilterVert5);this.textureFilterVert5Locations=this.generateLocations(this.shaderProgramTextureFilterVert5)}};
k.prototype.useTextureFilterVert5Shader=function(d){this.clearVertexAttribs();this.shaderProgramTextureFilterVert5||this.createTextureFilterVert5Shader();b.useProgram(this.shaderProgramTextureFilterVert5);d.locations=this.textureFilterVert5Locations;b.enableVertexAttribArray(this.textureFilterVert5Locations.ymaxekn)};k.prototype.createTextureFilterHori5Shader=function(){if(!this.shaderProgramTextureFilterHori5){b.useProgram(null);if(!this.filterVertexShader&&(this.filterVertexShader=b.createShader(b.VERTEX_SHADER),
b.shaderSource(this.filterVertexShader,this.globalHead+getShaderCode("vertexShaderTextureFilter")),b.compileShader(this.filterVertexShader),!b.getShaderParameter(this.filterVertexShader,b.COMPILE_STATUS)))return console.error(b.getShaderInfoLog(this.filterVertexShader)),delete this.filterVertexShader,null;var d=b.createShader(b.FRAGMENT_SHADER);b.shaderSource(d,this.globalHead+this.globalFragmentHead+this.bilinearRGBETexture2D+getShaderCode("fragmentShaderTextureFilterHori5"));b.compileShader(d);
this.shaderProgramTextureFilterHori5=b.createProgram();b.attachShader(this.shaderProgramTextureFilterHori5,this.filterVertexShader);b.attachShader(this.shaderProgramTextureFilterHori5,d);b.linkProgram(this.shaderProgramTextureFilterHori5);if(!b.getShaderParameter(d,b.COMPILE_STATUS))return console.error(b.getShaderInfoLog(d)),null;b.getProgramParameter(this.shaderProgramTextureFilterHori5,b.LINK_STATUS)||b.isContextLost()||(d=b.getProgramInfoLog(this.shaderProgramTextureFilterHori5),console.error("Error in program linking : TexturefilterHori5 : "+
d));b.useProgram(this.shaderProgramTextureFilterHori5);this.textureFilterHori5Locations=this.generateLocations(this.shaderProgramTextureFilterHori5)}};k.prototype.useTextureFilterHori5Shader=function(d){this.clearVertexAttribs();this.shaderProgramTextureFilterHori5||this.createTextureFilterHori5Shader();b.useProgram(this.shaderProgramTextureFilterHori5);d.locations=this.textureFilterHori5Locations;b.enableVertexAttribArray(this.textureFilterHori5Locations.ymaxekn)};k.prototype.createTextureFilterVert6Shader=
function(){if(!this.shaderProgramTextureFilterVert6){b.useProgram(null);if(!this.filterVertexShader&&(this.filterVertexShader=b.createShader(b.VERTEX_SHADER),b.shaderSource(this.filterVertexShader,this.globalHead+getShaderCode("vertexShaderTextureFilter")),b.compileShader(this.filterVertexShader),!b.getShaderParameter(this.filterVertexShader,b.COMPILE_STATUS)))return console.error(b.getShaderInfoLog(this.filterVertexShader)),delete this.filterVertexShader,null;var d=b.createShader(b.FRAGMENT_SHADER);
b.shaderSource(d,this.globalHead+this.globalFragmentHead+this.bilinearRGBETexture2D+getShaderCode("fragmentShaderTextureFilterVert6"));b.compileShader(d);this.shaderProgramTextureFilterVert6=b.createProgram();b.attachShader(this.shaderProgramTextureFilterVert6,this.filterVertexShader);b.attachShader(this.shaderProgramTextureFilterVert6,d);b.linkProgram(this.shaderProgramTextureFilterVert6);if(!b.getShaderParameter(d,b.COMPILE_STATUS))return console.error(b.getShaderInfoLog(d)),null;b.getProgramParameter(this.shaderProgramTextureFilterVert6,
b.LINK_STATUS)||b.isContextLost()||(d=b.getProgramInfoLog(this.shaderProgramTextureFilterVert6),console.error("Error in program linking : TexturefilterVert6 : "+d));b.useProgram(this.shaderProgramTextureFilterVert6);this.textureFilterVert6Locations=this.generateLocations(this.shaderProgramTextureFilterVert6)}};k.prototype.useTextureFilterVert6Shader=function(d){this.clearVertexAttribs();this.shaderProgramTextureFilterVert6||this.createTextureFilterVert6Shader();b.useProgram(this.shaderProgramTextureFilterVert6);
d.locations=this.textureFilterVert6Locations;b.enableVertexAttribArray(this.textureFilterVert6Locations.ymaxekn)};k.prototype.createTextureFilterHori6Shader=function(){if(!this.shaderProgramTextureFilterHori6){b.useProgram(null);if(!this.filterVertexShader&&(this.filterVertexShader=b.createShader(b.VERTEX_SHADER),b.shaderSource(this.filterVertexShader,this.globalHead+getShaderCode("vertexShaderTextureFilter")),b.compileShader(this.filterVertexShader),!b.getShaderParameter(this.filterVertexShader,
b.COMPILE_STATUS)))return console.error(b.getShaderInfoLog(this.filterVertexShader)),delete this.filterVertexShader,null;var d=b.createShader(b.FRAGMENT_SHADER);b.shaderSource(d,this.globalHead+this.globalFragmentHead+this.bilinearRGBETexture2D+getShaderCode("fragmentShaderTextureFilterHori6"));b.compileShader(d);this.shaderProgramTextureFilterHori6=b.createProgram();b.attachShader(this.shaderProgramTextureFilterHori6,this.filterVertexShader);b.attachShader(this.shaderProgramTextureFilterHori6,d);
b.linkProgram(this.shaderProgramTextureFilterHori6);if(!b.getShaderParameter(d,b.COMPILE_STATUS))return console.error(b.getShaderInfoLog(d)),null;b.getProgramParameter(this.shaderProgramTextureFilterHori6,b.LINK_STATUS)||b.isContextLost()||(d=b.getProgramInfoLog(this.shaderProgramTextureFilterHori6),console.error("Error in program linking : TexturefilterHori6 : "+d));b.useProgram(this.shaderProgramTextureFilterHori6);this.textureFilterHori6Locations=this.generateLocations(this.shaderProgramTextureFilterHori6)}};
k.prototype.useTextureFilterHori6Shader=function(d){this.clearVertexAttribs();this.shaderProgramTextureFilterHori6||this.createTextureFilterHori6Shader();b.useProgram(this.shaderProgramTextureFilterHori6);d.locations=this.textureFilterHori6Locations;b.enableVertexAttribArray(this.textureFilterHori6Locations.ymaxekn)};k.prototype.createTextureFilterVert7Shader=function(){if(!this.shaderProgramTextureFilterVert7){b.useProgram(null);if(!this.filterVertexShader&&(this.filterVertexShader=b.createShader(b.VERTEX_SHADER),
b.shaderSource(this.filterVertexShader,this.globalHead+getShaderCode("vertexShaderTextureFilter")),b.compileShader(this.filterVertexShader),!b.getShaderParameter(this.filterVertexShader,b.COMPILE_STATUS)))return console.error(b.getShaderInfoLog(this.filterVertexShader)),delete this.filterVertexShader,null;var d=b.createShader(b.FRAGMENT_SHADER);b.shaderSource(d,this.globalHead+this.globalFragmentHead+getShaderCode("fragmentShaderTextureFilterVert7"));b.compileShader(d);this.shaderProgramTextureFilterVert7=
b.createProgram();b.attachShader(this.shaderProgramTextureFilterVert7,this.filterVertexShader);b.attachShader(this.shaderProgramTextureFilterVert7,d);b.linkProgram(this.shaderProgramTextureFilterVert7);if(!b.getShaderParameter(d,b.COMPILE_STATUS))return console.error(b.getShaderInfoLog(d)),null;b.getProgramParameter(this.shaderProgramTextureFilterVert7,b.LINK_STATUS)||b.isContextLost()||(d=b.getProgramInfoLog(this.shaderProgramTextureFilterVert7),console.error("Error in program linking : TexturefilterVert7 : "+
d));b.useProgram(this.shaderProgramTextureFilterVert7);this.textureFilterVert7Locations=this.generateLocations(this.shaderProgramTextureFilterVert7)}};k.prototype.useTextureFilterVert7Shader=function(d){this.clearVertexAttribs();b.useProgram(this.shaderProgramTextureFilterVert7);d.locations=this.textureFilterVert7Locations;b.enableVertexAttribArray(this.textureFilterVert7Locations.ymaxekn)};k.prototype.createTextureFilterHori7Shader=function(){if(!this.shaderProgramTextureFilterHori7){b.useProgram(null);
if(!this.filterVertexShader&&(this.filterVertexShader=b.createShader(b.VERTEX_SHADER),b.shaderSource(this.filterVertexShader,this.globalHead+getShaderCode("vertexShaderTextureFilter")),b.compileShader(this.filterVertexShader),!b.getShaderParameter(this.filterVertexShader,b.COMPILE_STATUS)))return console.error(b.getShaderInfoLog(this.filterVertexShader)),delete this.filterVertexShader,null;var d=b.createShader(b.FRAGMENT_SHADER);b.shaderSource(d,this.globalHead+this.globalFragmentHead+getShaderCode("fragmentShaderTextureFilterHori7"));
b.compileShader(d);this.shaderProgramTextureFilterHori7=b.createProgram();b.attachShader(this.shaderProgramTextureFilterHori7,this.filterVertexShader);b.attachShader(this.shaderProgramTextureFilterHori7,d);b.linkProgram(this.shaderProgramTextureFilterHori7);if(!b.getShaderParameter(d,b.COMPILE_STATUS))return console.error(b.getShaderInfoLog(d)),null;b.getProgramParameter(this.shaderProgramTextureFilterHori7,b.LINK_STATUS)||b.isContextLost()||(d=b.getProgramInfoLog(this.shaderProgramTextureFilterHori7),
console.error("Error in program linking : TexturefilterHori7 : "+d));b.useProgram(this.shaderProgramTextureFilterHori7);this.textureFilterHori7Locations=this.generateLocations(this.shaderProgramTextureFilterHori7)}};k.prototype.useTextureFilterHori7Shader=function(d){this.clearVertexAttribs();b.useProgram(this.shaderProgramTextureFilterHori7);d.locations=this.textureFilterHori7Locations;b.enableVertexAttribArray(this.textureFilterHori7Locations.ymaxekn)};k.prototype.createTextureFilterBrightnessShader=
function(){if(!this.shaderProgramTextureFilterBrightness){b.useProgram(null);if(!this.filterVertexShader&&(this.filterVertexShader=b.createShader(b.VERTEX_SHADER),b.shaderSource(this.filterVertexShader,this.globalHead+getShaderCode("vertexShaderTextureFilter")),b.compileShader(this.filterVertexShader),!b.getShaderParameter(this.filterVertexShader,b.COMPILE_STATUS)))return console.error(b.getShaderInfoLog(this.filterVertexShader)),delete this.filterVertexShader,null;var d=b.createShader(b.FRAGMENT_SHADER);
b.shaderSource(d,this.globalHead+this.globalFragmentHead+getShaderCode("fragmentShaderTextureFilterBrightness"));b.compileShader(d);this.shaderProgramTextureFilterBrightness=b.createProgram();b.attachShader(this.shaderProgramTextureFilterBrightness,this.filterVertexShader);b.attachShader(this.shaderProgramTextureFilterBrightness,d);b.linkProgram(this.shaderProgramTextureFilterBrightness);if(!b.getShaderParameter(d,b.COMPILE_STATUS))return console.error(b.getShaderInfoLog(d)),null;b.getProgramParameter(this.shaderProgramTextureFilterBrightness,
b.LINK_STATUS)||b.isContextLost()||(d=b.getProgramInfoLog(this.shaderProgramTextureFilterBrightness),console.error("Error in program linking : TexturefilterBrightness : "+d));b.useProgram(this.shaderProgramTextureFilterBrightness);this.textureFilterBrightnessLocations=this.generateLocations(this.shaderProgramTextureFilterBrightness)}};k.prototype.useTextureFilterBrightnessShader=function(d){this.shaderProgramTextureFilterBrightness||this.createTextureFilterBrightnessShader();this.clearVertexAttribs();
b.useProgram(this.shaderProgramTextureFilterBrightness);d.locations=this.textureFilterBrightnessLocations;b.enableVertexAttribArray(this.textureFilterBrightnessLocations.ymaxekn)};k.prototype.createTextureFilterContrastShader=function(){if(!this.shaderProgramTextureFilterContrast){b.useProgram(null);if(!this.filterVertexShader&&(this.filterVertexShader=b.createShader(b.VERTEX_SHADER),b.shaderSource(this.filterVertexShader,this.globalHead+getShaderCode("vertexShaderTextureFilter")),b.compileShader(this.filterVertexShader),
!b.getShaderParameter(this.filterVertexShader,b.COMPILE_STATUS)))return console.error(b.getShaderInfoLog(this.filterVertexShader)),delete this.filterVertexShader,null;var d=b.createShader(b.FRAGMENT_SHADER);b.shaderSource(d,this.globalHead+this.globalFragmentHead+getShaderCode("fragmentShaderTextureFilterContrast"));b.compileShader(d);this.shaderProgramTextureFilterContrast=b.createProgram();b.attachShader(this.shaderProgramTextureFilterContrast,this.filterVertexShader);b.attachShader(this.shaderProgramTextureFilterContrast,
d);b.linkProgram(this.shaderProgramTextureFilterContrast);if(!b.getShaderParameter(d,b.COMPILE_STATUS))return console.error(b.getShaderInfoLog(d)),null;b.getProgramParameter(this.shaderProgramTextureFilterContrast,b.LINK_STATUS)||b.isContextLost()||(d=b.getProgramInfoLog(this.shaderProgramTextureFilterContrast),console.error("Error in program linking : TexturefilterContrast : "+d));b.useProgram(this.shaderProgramTextureFilterContrast);this.textureFilterContrastLocations=this.generateLocations(this.shaderProgramTextureFilterContrast)}};
k.prototype.useTextureFilterContrastShader=function(d){this.shaderProgramTextureFilterContrast||this.createTextureFilterContrastShader();this.clearVertexAttribs();b.useProgram(this.shaderProgramTextureFilterContrast);d.locations=this.textureFilterContrastLocations;b.enableVertexAttribArray(this.textureFilterContrastLocations.ymaxekn)};k.prototype.createTextureFilterAlbedoToNormalShader=function(){if(!this.shaderProgramTextureFilterAlbedoToNormal){b.useProgram(null);if(!this.filterVertexShader&&(this.filterVertexShader=
b.createShader(b.VERTEX_SHADER),b.shaderSource(this.filterVertexShader,this.globalHead+getShaderCode("vertexShaderTextureFilter")),b.compileShader(this.filterVertexShader),!b.getShaderParameter(this.filterVertexShader,b.COMPILE_STATUS)))return console.error(b.getShaderInfoLog(this.filterVertexShader)),delete this.filterVertexShader,null;var d=b.createShader(b.FRAGMENT_SHADER);b.shaderSource(d,this.globalHead+this.globalFragmentHead+getShaderCode("fragmentShaderTextureFilterAlbedoToNormal"));b.compileShader(d);
this.shaderProgramTextureFilterAlbedoToNormal=b.createProgram();b.attachShader(this.shaderProgramTextureFilterAlbedoToNormal,this.filterVertexShader);b.attachShader(this.shaderProgramTextureFilterAlbedoToNormal,d);b.linkProgram(this.shaderProgramTextureFilterAlbedoToNormal);if(!b.getShaderParameter(d,b.COMPILE_STATUS))return console.error(b.getShaderInfoLog(d)),null;b.getProgramParameter(this.shaderProgramTextureFilterAlbedoToNormal,b.LINK_STATUS)||b.isContextLost()||(d=b.getProgramInfoLog(this.shaderProgramTextureFilterAlbedoToNormal),
console.error("Error in program linking : TextureFilterAlbedoToNormal : "+d));b.useProgram(this.shaderProgramTextureFilterAlbedoToNormal);this.textureFilterAlbedoToNormalLocations=this.generateLocations(this.shaderProgramTextureFilterAlbedoToNormal)}};k.prototype.useTextureFilterAlbedoToNormalShader=function(d){this.shaderProgramTextureFilterAlbedoToNormal||this.createTextureFilterAlbedoToNormalShader();this.clearVertexAttribs();b.useProgram(this.shaderProgramTextureFilterAlbedoToNormal);d.locations=
this.textureFilterAlbedoToNormalLocations;b.enableVertexAttribArray(this.textureFilterAlbedoToNormalLocations.ymaxekn)};k.prototype.createTextureFilterContrastAndBrightnessShader=function(){if(!this.shaderProgramTextureFilterContrastAndBrightness){b.useProgram(null);if(!this.filterVertexShader&&(this.filterVertexShader=b.createShader(b.VERTEX_SHADER),b.shaderSource(this.filterVertexShader,this.globalHead+getShaderCode("vertexShaderTextureFilter")),b.compileShader(this.filterVertexShader),!b.getShaderParameter(this.filterVertexShader,
b.COMPILE_STATUS)))return console.error(b.getShaderInfoLog(this.filterVertexShader)),delete this.filterVertexShader,null;var d=b.createShader(b.FRAGMENT_SHADER);b.shaderSource(d,this.globalHead+this.globalFragmentHead+getShaderCode("fragmentShaderTextureFilterContrastAndBrightness"));b.compileShader(d);this.shaderProgramTextureFilterContrastAndBrightness=b.createProgram();b.attachShader(this.shaderProgramTextureFilterContrastAndBrightness,this.filterVertexShader);b.attachShader(this.shaderProgramTextureFilterContrastAndBrightness,
d);b.linkProgram(this.shaderProgramTextureFilterContrastAndBrightness);if(!b.getShaderParameter(d,b.COMPILE_STATUS))return console.error(b.getShaderInfoLog(d)),null;b.getProgramParameter(this.shaderProgramTextureFilterContrastAndBrightness,b.LINK_STATUS)||b.isContextLost()||(d=b.getProgramInfoLog(this.shaderProgramTextureFilterContrastAndBrightness),console.error("Error in program linking : TexturefilterContrastAndBrightness : "+d));b.useProgram(this.shaderProgramTextureFilterContrastAndBrightness);
this.textureFilterContrastAndBrightnessLocations=this.generateLocations(this.shaderProgramTextureFilterContrastAndBrightness)}};k.prototype.useTextureFilterContrastAndBrightnessShader=function(d){this.shaderProgramTextureFilterContrastAndBrightness||this.createTextureFilterContrastAndBrightnessShader();this.clearVertexAttribs();b.useProgram(this.shaderProgramTextureFilterContrastAndBrightness);d.locations=this.textureFilterContrastAndBrightnessLocations;b.enableVertexAttribArray(this.textureFilterContrastAndBrightnessLocations.ymaxekn)};
k.prototype.createTextureFilterHueShader=function(){if(!this.shaderProgramTextureFilterHue){b.useProgram(null);if(!this.filterVertexShader&&(this.filterVertexShader=b.createShader(b.VERTEX_SHADER),b.shaderSource(this.filterVertexShader,this.globalHead+getShaderCode("vertexShaderTextureFilter")),b.compileShader(this.filterVertexShader),!b.getShaderParameter(this.filterVertexShader,b.COMPILE_STATUS)))return console.error(b.getShaderInfoLog(this.filterVertexShader)),delete this.filterVertexShader,null;
var d=b.createShader(b.FRAGMENT_SHADER);b.shaderSource(d,this.globalHead+this.globalFragmentHead+getShaderCode("fragmentShaderTextureFilterHue"));b.compileShader(d);this.shaderProgramTextureFilterHue=b.createProgram();b.attachShader(this.shaderProgramTextureFilterHue,this.filterVertexShader);b.attachShader(this.shaderProgramTextureFilterHue,d);b.linkProgram(this.shaderProgramTextureFilterHue);if(!b.getShaderParameter(d,b.COMPILE_STATUS))return console.error(b.getShaderInfoLog(d)),null;b.getProgramParameter(this.shaderProgramTextureFilterHue,
b.LINK_STATUS)||b.isContextLost()||(d=b.getProgramInfoLog(this.shaderProgramTextureFilterHue),console.error("Error in program linking : TexturefilterHue : "+d));b.useProgram(this.shaderProgramTextureFilterHue);this.textureFilterHueLocations=this.generateLocations(this.shaderProgramTextureFilterHue)}};k.prototype.useTextureFilterHueShader=function(d){this.shaderProgramTextureFilterHue||this.createTextureFilterHueShader();this.clearVertexAttribs();b.useProgram(this.shaderProgramTextureFilterHue);d.locations=
this.textureFilterHueLocations;b.enableVertexAttribArray(this.textureFilterHueLocations.ymaxekn)};k.prototype.createTextureFilterBlackAndWhiteShader=function(){if(!this.shaderProgramTextureFilterBlackAndWhite){b.useProgram(null);if(!this.filterVertexShader&&(this.filterVertexShader=b.createShader(b.VERTEX_SHADER),b.shaderSource(this.filterVertexShader,this.globalHead+getShaderCode("vertexShaderTextureFilter")),b.compileShader(this.filterVertexShader),!b.getShaderParameter(this.filterVertexShader,
b.COMPILE_STATUS)))return console.error(b.getShaderInfoLog(this.filterVertexShader)),delete this.filterVertexShader,null;var d=b.createShader(b.FRAGMENT_SHADER);b.shaderSource(d,this.globalHead+this.globalFragmentHead+getShaderCode("fragmentShaderTextureFilterBlackAndWhite"));b.compileShader(d);this.shaderProgramTextureFilterBlackAndWhite=b.createProgram();b.attachShader(this.shaderProgramTextureFilterBlackAndWhite,this.filterVertexShader);b.attachShader(this.shaderProgramTextureFilterBlackAndWhite,
d);b.linkProgram(this.shaderProgramTextureFilterBlackAndWhite);if(!b.getShaderParameter(d,b.COMPILE_STATUS))return console.error(b.getShaderInfoLog(d)),null;b.getProgramParameter(this.shaderProgramTextureFilterBlackAndWhite,b.LINK_STATUS)||b.isContextLost()||(d=b.getProgramInfoLog(this.shaderProgramTextureFilterBlackAndWhite),console.error("Error in program linking : TexturefilterBlackAndWhite : "+d));b.useProgram(this.shaderProgramTextureFilterBlackAndWhite);this.textureFilterBlackAndWhiteLocations=
this.generateLocations(this.shaderProgramTextureFilterBlackAndWhite)}};k.prototype.useTextureFilterBlackAndWhiteShader=function(d){this.shaderProgramTextureFilterBlackAndWhite||this.createTextureFilterBlackAndWhiteShader();this.clearVertexAttribs();b.useProgram(this.shaderProgramTextureFilterBlackAndWhite);d.locations=this.textureFilterBlackAndWhiteLocations;b.enableVertexAttribArray(this.textureFilterBlackAndWhiteLocations.ymaxekn)};k.prototype.createTextureFilterGrainingShader=function(){if(!this.shaderProgramTextureFilterGraining){b.useProgram(null);
if(!this.filterVertexShader&&(this.filterVertexShader=b.createShader(b.VERTEX_SHADER),b.shaderSource(this.filterVertexShader,this.globalHead+getShaderCode("vertexShaderTextureFilter")),b.compileShader(this.filterVertexShader),!b.getShaderParameter(this.filterVertexShader,b.COMPILE_STATUS)))return console.error(b.getShaderInfoLog(this.filterVertexShader)),delete this.filterVertexShader,null;var d=b.createShader(b.FRAGMENT_SHADER);b.shaderSource(d,this.globalHead+this.globalFragmentHead+getShaderCode("fragmentShaderTextureFilterGraining"));
b.compileShader(d);this.shaderProgramTextureFilterGraining=b.createProgram();b.attachShader(this.shaderProgramTextureFilterGraining,this.filterVertexShader);b.attachShader(this.shaderProgramTextureFilterGraining,d);b.linkProgram(this.shaderProgramTextureFilterGraining);if(!b.getShaderParameter(d,b.COMPILE_STATUS))return console.error(b.getShaderInfoLog(d)),null;b.getProgramParameter(this.shaderProgramTextureFilterGraining,b.LINK_STATUS)||b.isContextLost()||(d=b.getProgramInfoLog(this.shaderProgramTextureFilterGraining),
console.error("Error in program linking : TexturefilterGraining : "+d));b.useProgram(this.shaderProgramTextureFilterGraining);this.textureFilterGrainingLocations=this.generateLocations(this.shaderProgramTextureFilterGraining)}};k.prototype.useTextureFilterGrainingShader=function(d){this.shaderProgramTextureFilterGraining||this.createTextureFilterGrainingShader();this.clearVertexAttribs();b.useProgram(this.shaderProgramTextureFilterGraining);d.locations=this.textureFilterGrainingLocations;b.enableVertexAttribArray(this.textureFilterGrainingLocations.ymaxekn)};
k.prototype.createTextureFilterCenterBlurringShader=function(){if(!this.shaderProgramTextureFilterCenterBlurring){b.useProgram(null);if(!this.filterVertexShader&&(this.filterVertexShader=b.createShader(b.VERTEX_SHADER),b.shaderSource(this.filterVertexShader,this.globalHead+getShaderCode("vertexShaderTextureFilter")),b.compileShader(this.filterVertexShader),!b.getShaderParameter(this.filterVertexShader,b.COMPILE_STATUS)))return console.error(b.getShaderInfoLog(this.filterVertexShader)),delete this.filterVertexShader,
null;var d=b.createShader(b.FRAGMENT_SHADER);b.shaderSource(d,this.globalHead+this.globalFragmentHead+getShaderCode("fragmentShaderTextureFilterCenterBlurring"));b.compileShader(d);this.shaderProgramTextureFilterCenterBlurring=b.createProgram();b.attachShader(this.shaderProgramTextureFilterCenterBlurring,this.filterVertexShader);b.attachShader(this.shaderProgramTextureFilterCenterBlurring,d);b.linkProgram(this.shaderProgramTextureFilterCenterBlurring);if(!b.getShaderParameter(d,b.COMPILE_STATUS))return console.error(b.getShaderInfoLog(d)),
null;b.getProgramParameter(this.shaderProgramTextureFilterCenterBlurring,b.LINK_STATUS)||b.isContextLost()||(d=b.getProgramInfoLog(this.shaderProgramTextureFilterCenterBlurring),console.error("Error in program linking : TexturefilterCenterBlurring : "+d));b.useProgram(this.shaderProgramTextureFilterCenterBlurring);this.textureFilterCenterBlurringLocations=this.generateLocations(this.shaderProgramTextureFilterCenterBlurring)}};k.prototype.useTextureFilterCenterBlurringShader=function(d){this.shaderProgramTextureFilterCenterBlurring||
this.createTextureFilterCenterBlurringShader();this.clearVertexAttribs();b.useProgram(this.shaderProgramTextureFilterCenterBlurring);d.locations=this.textureFilterCenterBlurringLocations;b.enableVertexAttribArray(this.textureFilterCenterBlurringLocations.ymaxekn)};k.prototype.createTextureFilterBlendingShader=function(){if(!this.shaderProgramTextureFilterBlending){b.useProgram(null);if(!this.filterVertexShader&&(this.filterVertexShader=b.createShader(b.VERTEX_SHADER),b.shaderSource(this.filterVertexShader,
this.globalHead+getShaderCode("vertexShaderTextureFilter")),b.compileShader(this.filterVertexShader),!b.getShaderParameter(this.filterVertexShader,b.COMPILE_STATUS)))return console.error(b.getShaderInfoLog(this.filterVertexShader)),delete this.filterVertexShader,null;var d=b.createShader(b.FRAGMENT_SHADER);b.shaderSource(d,this.globalHead+this.globalFragmentHead+getShaderCode("fragmentShaderTextureFilterBlending"));b.compileShader(d);this.shaderProgramTextureFilterBlending=b.createProgram();b.attachShader(this.shaderProgramTextureFilterBlending,
this.filterVertexShader);b.attachShader(this.shaderProgramTextureFilterBlending,d);b.linkProgram(this.shaderProgramTextureFilterBlending);if(!b.getShaderParameter(d,b.COMPILE_STATUS))return console.error(b.getShaderInfoLog(d)),null;b.getProgramParameter(this.shaderProgramTextureFilterBlending,b.LINK_STATUS)||b.isContextLost()||(d=b.getProgramInfoLog(this.shaderProgramTextureFilterBlending),console.error("Error in program linking : TexturefilterBlending : "+d));b.useProgram(this.shaderProgramTextureFilterBlending);
this.textureFilterBlendingLocations=this.generateLocations(this.shaderProgramTextureFilterBlending)}};k.prototype.useTextureFilterBlendingShader=function(d){this.shaderProgramTextureFilterBlending||this.createTextureFilterBlendingShader();this.clearVertexAttribs();b.useProgram(this.shaderProgramTextureFilterBlending);d.locations=this.textureFilterBlendingLocations;b.enableVertexAttribArray(this.textureFilterBlendingLocations.ymaxekn)};k.prototype.createTextureFilterDilationShader=function(){if(!this.shaderProgramTextureFilterDilation){b.useProgram(null);
if(!this.filterVertexShader&&(this.filterVertexShader=b.createShader(b.VERTEX_SHADER),b.shaderSource(this.filterVertexShader,this.globalHead+getShaderCode("vertexShaderTextureFilter")),b.compileShader(this.filterVertexShader),!b.getShaderParameter(this.filterVertexShader,b.COMPILE_STATUS)))return console.error(b.getShaderInfoLog(this.filterVertexShader)),delete this.filterVertexShader,null;var d=b.createShader(b.FRAGMENT_SHADER);b.shaderSource(d,this.globalHead+this.globalFragmentHead+getShaderCode("fragmentShaderTextureFilterDilation"));
b.compileShader(d);this.shaderProgramTextureFilterDilation=b.createProgram();b.attachShader(this.shaderProgramTextureFilterDilation,this.filterVertexShader);b.attachShader(this.shaderProgramTextureFilterDilation,d);b.linkProgram(this.shaderProgramTextureFilterDilation);if(!b.getShaderParameter(d,b.COMPILE_STATUS))return console.error(b.getShaderInfoLog(d)),null;b.getProgramParameter(this.shaderProgramTextureFilterDilation,b.LINK_STATUS)||b.isContextLost()||(d=b.getProgramInfoLog(this.shaderProgramTextureFilterDilation),
console.error("Error in program linking : TexturefilterDilation : "+d));b.useProgram(this.shaderProgramTextureFilterDilation);this.textureFilterDilationLocations=this.generateLocations(this.shaderProgramTextureFilterDilation)}};k.prototype.useTextureFilterDilationShader=function(d){this.shaderProgramTextureFilterDilation||this.createTextureFilterDilationShader();this.clearVertexAttribs();b.useProgram(this.shaderProgramTextureFilterDilation);d.locations=this.textureFilterDilationLocations;b.enableVertexAttribArray(this.textureFilterDilationLocations.ymaxekn)};
k.prototype.createTextureFilterCssGram1977Shader=function(){if(!this.shaderProgramTextureFilterCssGram1977){b.useProgram(null);if(!this.filterVertexShader&&(this.filterVertexShader=b.createShader(b.VERTEX_SHADER),b.shaderSource(this.filterVertexShader,this.globalHead+getShaderCode("vertexShaderTextureFilter")),b.compileShader(this.filterVertexShader),!b.getShaderParameter(this.filterVertexShader,b.COMPILE_STATUS)))return console.error(b.getShaderInfoLog(this.filterVertexShader)),delete this.filterVertexShader,
null;var d=b.createShader(b.FRAGMENT_SHADER);b.shaderSource(d,this.globalHead+this.globalFragmentHead+getShaderCode("fragmentShaderTextureFilterCssGram1977"));b.compileShader(d);this.shaderProgramTextureFilterCssGram1977=b.createProgram();b.attachShader(this.shaderProgramTextureFilterCssGram1977,this.filterVertexShader);b.attachShader(this.shaderProgramTextureFilterCssGram1977,d);b.linkProgram(this.shaderProgramTextureFilterCssGram1977);if(!b.getShaderParameter(d,b.COMPILE_STATUS))return console.error(b.getShaderInfoLog(d)),
null;b.getProgramParameter(this.shaderProgramTextureFilterCssGram1977,b.LINK_STATUS)||b.isContextLost()||(d=b.getProgramInfoLog(this.shaderProgramTextureFilterCssGram1977),console.error("Error in program linking : TexturefilterCssGram1977 : "+d));b.useProgram(this.shaderProgramTextureFilterCssGram1977);this.textureFilterCssGram1977Locations=this.generateLocations(this.shaderProgramTextureFilterCssGram1977)}};k.prototype.useTextureFilterCssGram1977Shader=function(d){this.shaderProgramTextureFilterCssGram1977||
this.createTextureFilterCssGram1977Shader();this.clearVertexAttribs();b.useProgram(this.shaderProgramTextureFilterCssGram1977);d.locations=this.textureFilterCssGram1977Locations;b.enableVertexAttribArray(this.textureFilterCssGram1977Locations.ymaxekn)};k.prototype.createTextureFilterCssGramInkwellShader=function(){if(!this.shaderProgramTextureFilterCssGramInkwell){b.useProgram(null);if(!this.filterVertexShader&&(this.filterVertexShader=b.createShader(b.VERTEX_SHADER),b.shaderSource(this.filterVertexShader,
this.globalHead+getShaderCode("vertexShaderTextureFilter")),b.compileShader(this.filterVertexShader),!b.getShaderParameter(this.filterVertexShader,b.COMPILE_STATUS)))return console.error(b.getShaderInfoLog(this.filterVertexShader)),delete this.filterVertexShader,null;var d=b.createShader(b.FRAGMENT_SHADER);b.shaderSource(d,this.globalHead+this.globalFragmentHead+getShaderCode("fragmentShaderTextureFilterCssGramInkwell"));b.compileShader(d);this.shaderProgramTextureFilterCssGramInkwell=b.createProgram();
b.attachShader(this.shaderProgramTextureFilterCssGramInkwell,this.filterVertexShader);b.attachShader(this.shaderProgramTextureFilterCssGramInkwell,d);b.linkProgram(this.shaderProgramTextureFilterCssGramInkwell);if(!b.getShaderParameter(d,b.COMPILE_STATUS))return console.error(b.getShaderInfoLog(d)),null;b.getProgramParameter(this.shaderProgramTextureFilterCssGramInkwell,b.LINK_STATUS)||b.isContextLost()||(d=b.getProgramInfoLog(this.shaderProgramTextureFilterCssGramInkwell),console.error("Error in program linking : TexturefilterCssGramInkwell : "+
d));b.useProgram(this.shaderProgramTextureFilterCssGramInkwell);this.textureFilterCssGramInkwellLocations=this.generateLocations(this.shaderProgramTextureFilterCssGramInkwell)}};k.prototype.useTextureFilterCssGramInkwellShader=function(d){this.shaderProgramTextureFilterCssGramInkwell||this.createTextureFilterCssGramInkwellShader();this.clearVertexAttribs();b.useProgram(this.shaderProgramTextureFilterCssGramInkwell);d.locations=this.textureFilterCssGramInkwellLocations;b.enableVertexAttribArray(this.textureFilterCssGramInkwellLocations.ymaxekn)};
k.prototype.createTextureFilterCssGramNashvilleShader=function(){if(!this.shaderProgramTextureFilterCssGramNashville){b.useProgram(null);if(!this.filterVertexShader&&(this.filterVertexShader=b.createShader(b.VERTEX_SHADER),b.shaderSource(this.filterVertexShader,this.globalHead+getShaderCode("vertexShaderTextureFilter")),b.compileShader(this.filterVertexShader),!b.getShaderParameter(this.filterVertexShader,b.COMPILE_STATUS)))return console.error(b.getShaderInfoLog(this.filterVertexShader)),delete this.filterVertexShader,
null;var d=b.createShader(b.FRAGMENT_SHADER);b.shaderSource(d,this.globalHead+this.globalFragmentHead+getShaderCode("fragmentShaderTextureFilterCssGramNashville"));b.compileShader(d);this.shaderProgramTextureFilterCssGramNashville=b.createProgram();b.attachShader(this.shaderProgramTextureFilterCssGramNashville,this.filterVertexShader);b.attachShader(this.shaderProgramTextureFilterCssGramNashville,d);b.linkProgram(this.shaderProgramTextureFilterCssGramNashville);if(!b.getShaderParameter(d,b.COMPILE_STATUS))return console.error(b.getShaderInfoLog(d)),
null;b.getProgramParameter(this.shaderProgramTextureFilterCssGramNashville,b.LINK_STATUS)||b.isContextLost()||(d=b.getProgramInfoLog(this.shaderProgramTextureFilterCssGramNashville),console.error("Error in program linking : TexturefilterCssGramNashville : "+d));b.useProgram(this.shaderProgramTextureFilterCssGramNashville);this.textureFilterCssGramNashvilleLocations=this.generateLocations(this.shaderProgramTextureFilterCssGramNashville)}};k.prototype.useTextureFilterCssGramNashvilleShader=function(d){this.shaderProgramTextureFilterCssGramNashville||
this.createTextureFilterCssGramNashvilleShader();this.clearVertexAttribs();b.useProgram(this.shaderProgramTextureFilterCssGramNashville);d.locations=this.textureFilterCssGramNashvilleLocations;b.enableVertexAttribArray(this.textureFilterCssGramNashvilleLocations.ymaxekn)};k.prototype.createTextureFilterCssGramMoonShader=function(){if(!this.shaderProgramTextureFilterCssGramMoon){b.useProgram(null);if(!this.filterVertexShader&&(this.filterVertexShader=b.createShader(b.VERTEX_SHADER),b.shaderSource(this.filterVertexShader,
this.globalHead+getShaderCode("vertexShaderTextureFilter")),b.compileShader(this.filterVertexShader),!b.getShaderParameter(this.filterVertexShader,b.COMPILE_STATUS)))return console.error(b.getShaderInfoLog(this.filterVertexShader)),delete this.filterVertexShader,null;var d=b.createShader(b.FRAGMENT_SHADER);b.shaderSource(d,this.globalHead+this.globalFragmentHead+getShaderCode("fragmentShaderTextureFilterCssGramMoon"));b.compileShader(d);this.shaderProgramTextureFilterCssGramMoon=b.createProgram();
b.attachShader(this.shaderProgramTextureFilterCssGramMoon,this.filterVertexShader);b.attachShader(this.shaderProgramTextureFilterCssGramMoon,d);b.linkProgram(this.shaderProgramTextureFilterCssGramMoon);if(!b.getShaderParameter(d,b.COMPILE_STATUS))return console.error(b.getShaderInfoLog(d)),null;b.getProgramParameter(this.shaderProgramTextureFilterCssGramMoon,b.LINK_STATUS)||b.isContextLost()||(d=b.getProgramInfoLog(this.shaderProgramTextureFilterCssGramMoon),console.error("Error in program linking : TexturefilterCssGramMoon : "+
d));b.useProgram(this.shaderProgramTextureFilterCssGramMoon);this.textureFilterCssGramMoonLocations=this.generateLocations(this.shaderProgramTextureFilterCssGramMoon)}};k.prototype.useTextureFilterCssGramMoonShader=function(d){this.shaderProgramTextureFilterCssGramMoon||this.createTextureFilterCssGramMoonShader();this.clearVertexAttribs();b.useProgram(this.shaderProgramTextureFilterCssGramMoon);d.locations=this.textureFilterCssGramMoonLocations;b.enableVertexAttribArray(this.textureFilterCssGramMoonLocations.ymaxekn)};
k.prototype.createTextureFilterCssGramWaldenShader=function(){if(!this.shaderProgramTextureFilterCssGramWalden){b.useProgram(null);if(!this.filterVertexShader&&(this.filterVertexShader=b.createShader(b.VERTEX_SHADER),b.shaderSource(this.filterVertexShader,this.globalHead+getShaderCode("vertexShaderTextureFilter")),b.compileShader(this.filterVertexShader),!b.getShaderParameter(this.filterVertexShader,b.COMPILE_STATUS)))return console.error(b.getShaderInfoLog(this.filterVertexShader)),delete this.filterVertexShader,
null;var d=b.createShader(b.FRAGMENT_SHADER);b.shaderSource(d,this.globalHead+this.globalFragmentHead+getShaderCode("fragmentShaderTextureFilterCssGramWalden"));b.compileShader(d);this.shaderProgramTextureFilterCssGramWalden=b.createProgram();b.attachShader(this.shaderProgramTextureFilterCssGramWalden,this.filterVertexShader);b.attachShader(this.shaderProgramTextureFilterCssGramWalden,d);b.linkProgram(this.shaderProgramTextureFilterCssGramWalden);if(!b.getShaderParameter(d,b.COMPILE_STATUS))return console.error(b.getShaderInfoLog(d)),
null;b.getProgramParameter(this.shaderProgramTextureFilterCssGramWalden,b.LINK_STATUS)||b.isContextLost()||(d=b.getProgramInfoLog(this.shaderProgramTextureFilterCssGramWalden),console.error("Error in program linking : TexturefilterCssGramWalden : "+d));b.useProgram(this.shaderProgramTextureFilterCssGramWalden);this.textureFilterCssGramWaldenLocations=this.generateLocations(this.shaderProgramTextureFilterCssGramWalden)}};k.prototype.useTextureFilterCssGramWaldenShader=function(d){this.shaderProgramTextureFilterCssGramWalden||
this.createTextureFilterCssGramWaldenShader();this.clearVertexAttribs();b.useProgram(this.shaderProgramTextureFilterCssGramWalden);d.locations=this.textureFilterCssGramWaldenLocations;b.enableVertexAttribArray(this.textureFilterCssGramWaldenLocations.ymaxekn)};k.prototype.createTextureFilterTransformShader=function(){if(!this.shaderProgramTextureFilterTransform){b.useProgram(null);if(!this.filterVertexShader&&(this.filterVertexShader=b.createShader(b.VERTEX_SHADER),b.shaderSource(this.filterVertexShader,
this.globalHead+getShaderCode("vertexShaderTextureFilter")),b.compileShader(this.filterVertexShader),!b.getShaderParameter(this.filterVertexShader,b.COMPILE_STATUS)))return console.error(b.getShaderInfoLog(this.filterVertexShader)),delete this.filterVertexShader,null;var d=b.createShader(b.FRAGMENT_SHADER);b.shaderSource(d,this.globalHead+this.globalFragmentHead+getShaderCode("fragmentShaderTextureFilterTransform"));b.compileShader(d);this.shaderProgramTextureFilterTransform=b.createProgram();b.attachShader(this.shaderProgramTextureFilterTransform,
this.filterVertexShader);b.attachShader(this.shaderProgramTextureFilterTransform,d);b.linkProgram(this.shaderProgramTextureFilterTransform);if(!b.getShaderParameter(d,b.COMPILE_STATUS))return console.error(b.getShaderInfoLog(d)),null;b.getProgramParameter(this.shaderProgramTextureFilterTransform,b.LINK_STATUS)||b.isContextLost()||(d=b.getProgramInfoLog(this.shaderProgramTextureFilterTransform),console.error("Error in program linking : TexturefilterTransform : "+d));b.useProgram(this.shaderProgramTextureFilterTransform);
this.textureFilterTransformLocations=this.generateLocations(this.shaderProgramTextureFilterTransform)}};k.prototype.useTextureFilterTransformShader=function(d){this.shaderProgramTextureFilterTransform||this.createTextureFilterTransformShader();this.clearVertexAttribs();b.useProgram(this.shaderProgramTextureFilterTransform);d.locations=this.textureFilterTransformLocations;b.enableVertexAttribArray(this.textureFilterTransformLocations.ymaxekn)};k.prototype.createRGBEToFloatShader=function(){if(!this.shaderProgramRGBEToFloat){b.useProgram(null);
if(!this.filterVertexShader&&(this.filterVertexShader=b.createShader(b.VERTEX_SHADER),b.shaderSource(this.filterVertexShader,this.globalHead+this.globalVertexHead+getShaderCode("vertexShaderTextureFilter")),b.compileShader(this.filterVertexShader),!b.getShaderParameter(this.filterVertexShader,b.COMPILE_STATUS)))return console.error(b.getShaderInfoLog(this.filterVertexShader)),delete this.filterVertexShader,null;var d=b.createShader(b.FRAGMENT_SHADER);b.shaderSource(d,this.globalHead+this.globalFragmentHead+
getShaderCode("fragmentShaderRGBEToFloat"));b.compileShader(d);this.shaderProgramRGBEToFloat=b.createProgram();b.attachShader(this.shaderProgramRGBEToFloat,this.filterVertexShader);b.attachShader(this.shaderProgramRGBEToFloat,d);b.linkProgram(this.shaderProgramRGBEToFloat);if(!b.getShaderParameter(d,b.COMPILE_STATUS))return console.error(b.getShaderInfoLog(d)),console.log(b.getShaderSource(d)),null;b.getProgramParameter(this.shaderProgramRGBEToFloat,b.LINK_STATUS)||b.isContextLost()||(d=b.getProgramInfoLog(this.shaderProgramRGBEToFloat),
console.error("Error in program linking : RGBEToFloat : "+d));b.useProgram(this.shaderProgramRGBEToFloat);this.RGBEToFloatLocations=this.generateLocations(this.shaderProgramRGBEToFloat)}};k.prototype.useRGBEToFloatShader=function(d){this.shaderProgramRGBEToFloat||this.createRGBEToFloatShader();this.clearVertexAttribs();b.useProgram(this.shaderProgramRGBEToFloat);d.locations=this.RGBEToFloatLocations;b.enableVertexAttribArray(this.RGBEToFloatLocations.ymaxekn)};k.prototype.createAntialiasingShader=
function(){if(!this.shaderProgramAntialiasing){b.useProgram(null);var d=b.createShader(b.VERTEX_SHADER);b.shaderSource(d,this.globalHead+this.globalVertexHead+getShaderCode("vertexShaderAntialiasing"));b.compileShader(d);if(!b.getShaderParameter(d,b.COMPILE_STATUS))return console.error(b.getShaderInfoLog(d)),delete d,null;var g=b.createShader(b.FRAGMENT_SHADER);b.shaderSource(g,this.globalHead+this.globalFragmentHead+getShaderCode("fragmentShaderAntialiasing"));b.compileShader(g);this.shaderProgramAntialiasing=
b.createProgram();b.attachShader(this.shaderProgramAntialiasing,d);b.attachShader(this.shaderProgramAntialiasing,g);b.linkProgram(this.shaderProgramAntialiasing);if(!b.getShaderParameter(g,b.COMPILE_STATUS))return console.error(b.getShaderInfoLog(g)),console.log(b.getShaderSource(g)),null;if(!b.getProgramParameter(this.shaderProgramAntialiasing,b.LINK_STATUS)&&!b.isContextLost()){var k=b.getProgramInfoLog(this.shaderProgramAntialiasing);console.error("Error in program linking : Antialiasing : "+k);
console.log(b.getShaderSource(d));console.log(b.getShaderSource(g))}b.useProgram(this.shaderProgramAntialiasing);this.antialiasingLocations=this.generateLocations(this.shaderProgramAntialiasing)}};k.prototype.useAntialiasingShader=function(d){this.shaderProgramAntialiasing||this.createAntialiasingShader();this.clearVertexAttribs();b.useProgram(this.shaderProgramAntialiasing);d.locations=this.antialiasingLocations;b.enableVertexAttribArray(this.antialiasingLocations.ymaxekn)};var t=function(f){this.furShaders[f.value()]||
(this.furShaders[f.value()]={});b.useProgram(null);var g=this.frVertexHead;g=this.updateHeadVertex(f,g);var k=this.frFragmentHead;k=f.has(d.PBR)?this.updatePbrHeadFragment(f,k):this.updateHeadFragment(f,k);var l=this.globalHead;l+="\n#define igkhmka\n#define yjjmvdg\n";var q=b.createShader(b.VERTEX_SHADER),t=b.createShader(b.FRAGMENT_SHADER);b.shaderSource(q,l+this.globalVertexHead+g+getShaderCode("vertexShaderFurRendering")+this.frVertexTail);b.shaderSource(t,l+this.globalFragmentHead+k+this.sRGBfragmentBase+
this.textureMappingFragmentBase+getShaderCode("fragmentShaderFurRendering"));b.compileShader(q);b.compileShader(t);this.furShaders[f.value()].program=b.createProgram();b.attachShader(this.furShaders[f.value()].program,q);b.attachShader(this.furShaders[f.value()].program,t);b.linkProgram(this.furShaders[f.value()].program);b.getShaderParameter(q,b.COMPILE_STATUS)?b.getShaderParameter(t,b.COMPILE_STATUS)?b.getProgramParameter(this.furShaders[f.value()].program,b.LINK_STATUS)||b.isContextLost()?(b.useProgram(this.furShaders[f.value()].program),
this.furShaders[f.value()].locations=this.generateLocations(this.furShaders[f.value()].program)):(l=b.getProgramInfoLog(this.furShaders[f.value()].program),console.error("Error in program linking : furShader "+f.value()+" : "+l)):console.error(b.getShaderInfoLog(t)):console.error(b.getShaderInfoLog(q))},r=[d.PBR_FUR,d.PBR_FUR_DISPERSION,d.PBR_FUR_HAIRCUT_MAP,d.PBR_FUR_CLUMP_CERCLE,d.PBR_FUR_CLUMP_VORONOI,d.PBR_FUR_CLUMP_CELLULAR,d.PBR_FUR_CLUMP_TURBULENCE,d.PBR_FUR_CLUMP_RIDGE,d.PBR_FUR_CLUMP_PERLIN,
d.PBR_FUR_CLUMP_TEXTURE];k.prototype.useFurShader=function(f,g){var k=new u;k.set(d.PBR,!0);r.forEach(function(b){g.has(b)&&k.set(b,!0)});this.furShaders[k.value()]||t.call(this,k);this.clearVertexAttribs();b.useProgram(this.furShaders[k.value()].program);f.locations=this.furShaders[k.value()].locations;b.enableVertexAttribArray(f.locations.ymaxekn);b.enableVertexAttribArray(f.locations.pcgewnw)};k.prototype.createFurMapBakingProgram=function(f){b.useProgram(null);var g=new u;g.set(d.PBR_FUR);g.set([d.PBR_FUR_CLUMP_CERCLE,
d.PBR_FUR_CLUMP_VORONOI,d.PBR_FUR_CLUMP_CELLULAR,d.PBR_FUR_CLUMP_PERLIN,d.PBR_FUR_CLUMP_TURBULENCE,d.PBR_FUR_CLUMP_RIDGE][f-1]);var k=this.updatePbrHeadFragment(g,"\n#define apydemz\n");g=b.createShader(b.VERTEX_SHADER);var l=b.createShader(b.FRAGMENT_SHADER);b.shaderSource(g,this.globalHead+this.globalVertexHead+"\n#define VARYING_UV\n"+getShaderCode("vertexShaderMapSpace"));b.shaderSource(l,this.globalHead+this.globalFragmentHead+k+getShaderCode("fragmentShaderFurMapBaking"));b.compileShader(g);
b.compileShader(l);k=b.createProgram();b.attachShader(k,g);b.attachShader(k,l);b.linkProgram(k);if(b.getShaderParameter(g,b.COMPILE_STATUS))if(b.getShaderParameter(l,b.COMPILE_STATUS)){if(b.getProgramParameter(k,b.LINK_STATUS)||b.isContextLost())return k;g=b.getProgramInfoLog(k);console.error("Error in program linking : furMapBakingProgram "+f+" : "+g)}else console.error(b.getShaderInfoLog(l));else console.error(b.getShaderInfoLog(g))};k.prototype.createScreenTextureShader=function(){if(!this.shaderProgramScreenTexture){b.useProgram(null);
var d=b.createShader(b.VERTEX_SHADER),g=b.createShader(b.FRAGMENT_SHADER);b.shaderSource(d,this.globalHead+this.globalVertexHead+getShaderCode("vertexShaderScreenTextureRendering"));b.shaderSource(g,this.globalHead+this.globalFragmentHead+getShaderCode("fragmentShaderScreenTextureRendering"));b.compileShader(d);b.compileShader(g);this.shaderProgramScreenTexture=b.createProgram();b.attachShader(this.shaderProgramScreenTexture,d);b.attachShader(this.shaderProgramScreenTexture,g);b.linkProgram(this.shaderProgramScreenTexture);
if(!b.getShaderParameter(d,b.COMPILE_STATUS))return console.error(b.getShaderInfoLog(d)),null;if(!b.getShaderParameter(g,b.COMPILE_STATUS))return console.error(b.getShaderInfoLog(g)),null;b.getProgramParameter(this.shaderProgramScreenTexture,b.LINK_STATUS)||b.isContextLost()||(d=b.getProgramInfoLog(this.shaderProgramScreenTexture),console.error("Error in program linking : screen texture : "+d));b.useProgram(this.shaderProgramScreenTexture);this.screenTextureLocations=this.generateLocations(this.shaderProgramScreenTexture)}};
k.prototype.useScreenTextureShader=function(d){this.clearVertexAttribs();b.useProgram(this.shaderProgramScreenTexture);d.locations=this.screenTextureLocations;b.enableVertexAttribArray(this.screenTextureLocations.ymaxekn)};k.prototype.createNoiseShader=function(){if(!this.shaderProgramNoise){b.useProgram(null);var d=b.createShader(b.VERTEX_SHADER),g=b.createShader(b.FRAGMENT_SHADER);b.shaderSource(d,this.globalHead+this.globalVertexHead+getShaderCode("vertexShaderNoiseRendering"));b.shaderSource(g,
this.globalHead+this.globalFragmentHead+getShaderCode("fragmentShaderNoiseRendering"));b.compileShader(d);b.compileShader(g);this.shaderProgramNoise=b.createProgram();b.attachShader(this.shaderProgramNoise,d);b.attachShader(this.shaderProgramNoise,g);b.linkProgram(this.shaderProgramNoise);if(!b.getShaderParameter(d,b.COMPILE_STATUS))return console.error(b.getShaderInfoLog(d)),null;if(!b.getShaderParameter(g,b.COMPILE_STATUS))return console.error(b.getShaderInfoLog(g)),null;b.getProgramParameter(this.shaderProgramNoise,
b.LINK_STATUS)||b.isContextLost()||(d=b.getProgramInfoLog(this.shaderProgramNoise),console.error("Error in program linking : Noise : "+d));b.useProgram(this.shaderProgramNoise);this.noiseLocations=this.generateLocations(this.shaderProgramNoise)}};k.prototype.useNoiseShader=function(d){this.clearVertexAttribs();b.useProgram(this.shaderProgramNoise);d.locations=this.noiseLocations;b.enableVertexAttribArray(this.noiseLocations.ymaxekn)};k.prototype.createScreenSpaceCopyShader=function(){if(!this.shaderProgramScreenSpaceCopy){b.useProgram(null);
var d=b.createShader(b.VERTEX_SHADER),g=b.createShader(b.FRAGMENT_SHADER);b.shaderSource(d,this.globalHead+this.globalVertexHead+getShaderCode("vertexShaderScreenSpaceCopy"));b.shaderSource(g,this.globalHead+this.globalFragmentHead+getShaderCode("fragmentShaderScreenSpaceCopy"));b.compileShader(d);b.compileShader(g);this.shaderProgramScreenSpaceCopy=b.createProgram();b.attachShader(this.shaderProgramScreenSpaceCopy,d);b.attachShader(this.shaderProgramScreenSpaceCopy,g);b.linkProgram(this.shaderProgramScreenSpaceCopy);
if(!b.getShaderParameter(d,b.COMPILE_STATUS))return console.error(b.getShaderInfoLog(d)),null;if(!b.getShaderParameter(g,b.COMPILE_STATUS))return console.error(b.getShaderInfoLog(g)),null;b.getProgramParameter(this.shaderProgramScreenSpaceCopy,b.LINK_STATUS)||b.isContextLost()||(d=b.getProgramInfoLog(this.shaderProgramScreenSpaceCopy),console.error("Error in program linking : Screen Space Copy shader : "+d));b.useProgram(this.shaderProgramScreenSpaceCopy);this.screenSpaceCopyLocations=this.generateLocations(this.shaderProgramScreenSpaceCopy)}};
k.prototype.useScreenSpaceCopyShader=function(d){this.clearVertexAttribs();b.useProgram(this.shaderProgramScreenSpaceCopy);d.locations=this.screenSpaceCopyLocations;b.enableVertexAttribArray(this.screenSpaceCopyLocations.ymaxekn)};k.prototype.createGoldNoiseShader=function(){if(!this.shaderProgramGoldNoise){b.useProgram(null);var d=b.createShader(b.VERTEX_SHADER),g=b.createShader(b.FRAGMENT_SHADER);b.shaderSource(d,this.globalHead+this.globalVertexHead+getShaderCode("vertexShaderMapSpace"));b.shaderSource(g,
this.globalHead+this.globalFragmentHead+getShaderCode("fragmentShaderGoldNoise"));b.compileShader(d);b.compileShader(g);this.shaderProgramGoldNoise=b.createProgram();b.attachShader(this.shaderProgramGoldNoise,d);b.attachShader(this.shaderProgramGoldNoise,g);b.linkProgram(this.shaderProgramGoldNoise);if(!b.getShaderParameter(d,b.COMPILE_STATUS))return console.error(b.getShaderInfoLog(d)),null;if(!b.getShaderParameter(g,b.COMPILE_STATUS))return console.error(b.getShaderInfoLog(g)),null;b.getProgramParameter(this.shaderProgramGoldNoise,
b.LINK_STATUS)||b.isContextLost()||(d=b.getProgramInfoLog(this.shaderProgramGoldNoise),console.error("Error in program linking : gold noise shader : "+d));b.useProgram(this.shaderProgramGoldNoise);this.goldNoiseLocations=this.generateLocations(this.shaderProgramGoldNoise)}};k.prototype.useGoldNoiseShader=function(d,g){this.createGoldNoiseShader();this.clearVertexAttribs();b.useProgram(this.shaderProgramGoldNoise);d.locations=this.goldNoiseLocations;b.enableVertexAttribArray(this.goldNoiseLocations.ufoizoh);
b.uniform1f(d.locations.yjwzvyh,g?g:Math.random())};k.prototype.createArOccluderShader=function(){if(!this.shaderProgramArOccluder){b.useProgram(null);if(!this.filterVertexShader&&(this.filterVertexShader=b.createShader(b.VERTEX_SHADER),b.shaderSource(this.filterVertexShader,this.globalHead+getShaderCode("vertexShaderTextureFilter")),b.compileShader(this.filterVertexShader),!b.getShaderParameter(this.filterVertexShader,b.COMPILE_STATUS)))return console.error(b.getShaderInfoLog(this.filterVertexShader)),
delete this.filterVertexShader,null;var d=b.createShader(b.FRAGMENT_SHADER);b.shaderSource(d,this.globalHead+this.globalFragmentHead+getShaderCode("fragmentShaderArOccluder"));b.compileShader(d);this.shaderProgramArOccluder=b.createProgram();b.attachShader(this.shaderProgramArOccluder,this.filterVertexShader);b.attachShader(this.shaderProgramArOccluder,d);b.linkProgram(this.shaderProgramArOccluder);if(!b.getShaderParameter(d,b.COMPILE_STATUS))return console.error(b.getShaderInfoLog(d)),null;b.getProgramParameter(this.shaderProgramArOccluder,
b.LINK_STATUS)||b.isContextLost()||(d=b.getProgramInfoLog(this.shaderProgramArOccluder),console.error("Error in program linking : ArOccluder : "+d));b.useProgram(this.shaderProgramArOccluder);this.arOccluderLocations=this.generateLocations(this.shaderProgramArOccluder)}};k.prototype.useArOccluderShader=function(d){this.shaderProgramArOccluder||this.createArOccluderShader();this.clearVertexAttribs();b.useProgram(this.shaderProgramArOccluder);d.locations=this.arOccluderLocations;b.enableVertexAttribArray(this.arOccluderLocations.ymaxekn)};
k.prototype.deallocate=function(){this.shaderProgramShadows&&b.deleteProgram(this.shaderProgramShadows);this.shaderProgramOpacityShadows&&b.deleteProgram(this.shaderProgramOpacityShadows);this.shaderProgramDepth&&b.deleteProgram(this.shaderProgramDepth);this.shaderProgramDepthAndNormals&&b.deleteProgram(this.shaderProgramDepthAndNormals);this.shaderProgramScreenSpaceDepth&&b.deleteProgram(this.shaderProgramScreenSpaceDepth);this.shaderProgramGooch&&b.deleteProgram(this.shaderProgramGooch);this.shaderProgramFramerate&&
b.deleteProgram(this.shaderProgramFramerate);this.shaderProgramGlowRendering&&b.deleteProgram(this.shaderProgramGlowRendering);this.shaderProgramSilhouettes&&b.deleteProgram(this.shaderProgramSilhouettes);this.shaderProgramSilhouettesFromShadow&&b.deleteProgram(this.shaderProgramSilhouettesFromShadow);this.shaderProgramSSAO1Pass&&b.deleteProgram(this.shaderProgramSSAO1Pass);this.shaderProgramSSAO1PassFast&&b.deleteProgram(this.shaderProgramSSAO1PassFast);this.shaderProgramSSAO2Pass&&b.deleteProgram(this.shaderProgramSSAO2Pass);
this.shaderProgramSSAO2PassFast&&b.deleteProgram(this.shaderProgramSSAO2PassFast);this.shaderProgramSSAOFiltering&&b.deleteProgram(this.shaderProgramSSAOFiltering);this.shaderProgramFiltering&&b.deleteProgram(this.shaderProgramFiltering);this.shaderProgramOneColor&&b.deleteProgram(this.shaderProgramOneColor);this.shaderProgramCubeRendering&&b.deleteProgram(this.shaderProgramCubeRendering);this.shaderProgramEnvironmentRendering&&b.deleteProgram(this.shaderProgramEnvironmentRendering);this.shaderProgramEnvironmentRenderingForCubeMap&&
b.deleteProgram(this.shaderProgramEnvironmentRenderingForCubeMap);this.shaderProgramWaterRendering&&b.deleteProgram(this.shaderProgramWaterRendering);this.shaderProgramTextureFilterVert1&&b.deleteProgram(this.shaderProgramTextureFilterVert1);this.shaderProgramTextureFilterHori1&&b.deleteProgram(this.shaderProgramTextureFilterHori1);this.shaderProgramTextureFilterVert2&&b.deleteProgram(this.shaderProgramTextureFilterVert2);this.shaderProgramTextureFilterHori2&&b.deleteProgram(this.shaderProgramTextureFilterHori2);
this.shaderProgramTextureFilterVert3&&b.deleteProgram(this.shaderProgramTextureFilterVert3);this.shaderProgramTextureFilterHori3&&b.deleteProgram(this.shaderProgramTextureFilterHori3);this.shaderProgramTextureFilterVert4&&b.deleteProgram(this.shaderProgramTextureFilterVert4);this.shaderProgramTextureFilterHori4&&b.deleteProgram(this.shaderProgramTextureFilterHori4);this.shaderProgramTextureFilterVert5&&b.deleteProgram(this.shaderProgramTextureFilterVert5);this.shaderProgramTextureFilterHori5&&b.deleteProgram(this.shaderProgramTextureFilterHori5);
this.shaderProgramTextureFilterVert6&&b.deleteProgram(this.shaderProgramTextureFilterVert6);this.shaderProgramTextureFilterHori6&&b.deleteProgram(this.shaderProgramTextureFilterHori6);this.shaderProgramTextureFilterVert7&&b.deleteProgram(this.shaderProgramTextureFilterVert7);this.shaderProgramTextureFilterHori7&&b.deleteProgram(this.shaderProgramTextureFilterHori7);this.shaderProgramMeshEditingRendering&&b.deleteProgram(this.shaderProgramMeshEditingRendering);this.shaderProgramTextureFilterBrightness&&
b.deleteProgram(this.shaderProgramTextureFilterBrightness);this.shaderProgramTextureFilterContrast&&b.deleteProgram(this.shaderProgramTextureFilterContrast);this.shaderProgramTextureFilterContrastAndBrightness&&b.deleteProgram(this.shaderProgramTextureFilterContrastAndBrightness);this.shaderProgramTextureFilterHue&&b.deleteProgram(this.shaderProgramTextureFilterHue);this.shaderProgramTextureFilterBlackAndWhite&&b.deleteProgram(this.shaderProgramTextureFilterBlackAndWhite);this.shaderProgramTextureFilterGraining&&
b.deleteProgram(this.shaderProgramTextureFilterGraining);this.shaderProgramTextureFilterCenterBlurring&&b.deleteProgram(this.shaderProgramTextureFilterCenterBlurring);this.shaderProgramTextureFilterBlending&&b.deleteProgram(this.shaderProgramTextureFilterBlending);this.shaderProgramTextureFilterDilation&&b.deleteProgram(this.shaderProgramTextureFilterDilation);this.shaderProgramTextureFilterCssGram1977&&b.deleteProgram(this.shaderProgramTextureFilterCssGram1977);this.shaderProgramTextureFilterCssGramInkwell&&
b.deleteProgram(this.shaderProgramTextureFilterCssGramInkwell);this.shaderProgramTextureFilterCssGramNashville&&b.deleteProgram(this.shaderProgramTextureFilterCssGramNashville);this.shaderProgramTextureFilterCssGramMoon&&b.deleteProgram(this.shaderProgramTextureFilterCssGramMoon);this.shaderProgramTextureFilterCssGramWalden&&b.deleteProgram(this.shaderProgramTextureFilterCssGramWalden);this.shaderProgramTextureFilterTransform&&b.deleteProgram(this.shaderProgramTextureFilterTransform);this.shaderProgramRGBEToFloat&&
b.deleteProgram(this.shaderProgramRGBEToFloat);this.shaderProgramAntialiasing&&b.deleteProgram(this.shaderProgramAntialiasing);this.shaderProgramScreenTexture&&b.deleteProgram(this.shaderProgramScreenTexture);this.shaderProgramNoise&&b.deleteProgram(this.shaderProgramNoise);for(var d in this.typedShaders)b.deleteProgram(this.typedShaders[d].program);for(d in this.glowWritingShaders)b.deleteProgram(this.glowWritingShaders[d].program);this.shaderProgramScreenSpaceCopy&&b.deleteProgram(this.shaderProgramScreenSpaceCopy);
this.shaderProgramFur&&b.deleteProgram(this.shaderProgramFur);this.shaderProgramGoldNoise&&b.deleteProgram(this.shaderProgramGoldNoise);this.shaderProgramArOccluder&&b.deleteProgram(this.shaderProgramArOccluder);for(var g in this.screenSpaceShaders)for(d in this.screenSpaceShaders[g])b.deleteProgram(this.screenSpaceShaders[g][d].program);for(d in this.furShaders)b.deleteProgram(this.furShaders[d].program);this.furShaders={};this.shaderTypesFromValue={};b=null};return{shadersManager:k,shaderTypes:d,
shaderType:u,furTypes:r}});stage.provide("emersya.viewer.modules.renderer.filterManager");
stage.register.call(stage.emersya.viewer.modules.renderer,"filterManager",function(){var b=null,d=null,u=function(k,l,g){b=k;d=l;this.shaders=g;b.filters=this;this.screenTransfMatrix=mat4.create();mat4.ortho(-1,1,-1,1,.5,1.5,this.screenTransfMatrix);this.screenViewMatrix=mat4.create();mat4.lookAt([0,0,-1],[0,0,0],[0,1,0],this.screenViewMatrix);this.vertexBuffer=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,this.vertexBuffer);b.bufferData(b.ARRAY_BUFFER,new Float32Array([-1,-1,0,-1,1,0,1,1,0,1,-1,0]),
b.STATIC_DRAW);this.uvBuffer=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,this.uvBuffer);b.bufferData(b.ARRAY_BUFFER,new Float32Array([0,1,0,0,1,0,1,1]),b.STATIC_DRAW);this.elementsBuffer=b.createBuffer();b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.elementsBuffer);b.bufferData(b.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,0,2,3]),b.STATIC_DRAW);this.frameBuffer=b.createFramebuffer();this.renderBuffer=b.createRenderbuffer();this.defaultBlurFilters="12222223333".split("")};u.prototype.deallocate=function(){b.deleteBuffer(this.vertexBuffer);
b.deleteBuffer(this.uvBuffer);b.deleteBuffer(this.elementsBuffer);b.deleteFramebuffer(this.frameBuffer);b.deleteRenderbuffer(this.renderBuffer);this.dfglut=d=b=null};u.prototype.setDFGLUT=function(b){this.dfglut=b};u.prototype.parseFilters=function(b){if("none"===b)return[];var d=[];b.length&&(d=b.split("-"));return d};u.prototype.toFloatRGBA=function(k,l,g,q,t){q=Math.max(Math.round(q),1);t=Math.max(Math.round(t),1);if(b.floatTextures){if(this.dfglut){b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL,!1);b.bindTexture(b.TEXTURE_2D,
g);switch(q){case 2048:b.texSubImage2D(b.TEXTURE_2D,0,0,0,this.dfglut.size,this.dfglut.size,b.RGBA,b.UNSIGNED_BYTE,this.dfglut.pixels);b.texSubImage2D(b.TEXTURE_2D,0,2048-this.dfglut.size,0,this.dfglut.size,this.dfglut.size,b.RGBA,b.UNSIGNED_BYTE,this.dfglut.pixels2);break;case 1024:b.texSubImage2D(b.TEXTURE_2D,0,0,0,this.dfglut.size/2,this.dfglut.size/2,b.RGBA,b.UNSIGNED_BYTE,this.dfglut.halfPixels),b.texSubImage2D(b.TEXTURE_2D,0,1024-this.dfglut.size/2,0,this.dfglut.size/2,this.dfglut.size/2,b.RGBA,
b.UNSIGNED_BYTE,this.dfglut.halfPixels2),b.texSubImage2D(b.TEXTURE_2D,0,128,0,this.dfglut.size/2,this.dfglut.size/2,b.RGBA,b.UNSIGNED_BYTE,this.dfglut.halfPixels3)}b.bindTexture(b.TEXTURE_2D,null);b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL,!0);b.flush();b.finish()}this.shaders.useRGBEToFloatShader(d);b.clearColor(0,0,0,0);b.viewport(0,0,q,t);b.scissor(0,0,q,t);b.disable(b.BLEND);b.disable(b.DEPTH_TEST);var r=b.createTexture();b.bindTexture(b.TEXTURE_2D,r);b.texImage2D(b.TEXTURE_2D,0,b.RGBA32F,q,t,0,b.RGBA,
b.FLOAT,null);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.NEAREST);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.NEAREST);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE);b.bindRenderbuffer(b.RENDERBUFFER,this.renderBuffer);b.renderbufferStorage(b.RENDERBUFFER,b.DEPTH_COMPONENT16,q,t);b.bindBuffer(b.ARRAY_BUFFER,this.vertexBuffer);b.vertexAttribPointer(d.locations.ymaxekn,3,b.FLOAT,!1,0,0);b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,
this.elementsBuffer);b.uniform2f(d.locations.qxxpdff,q,t);b.uniformMatrix4fv(d.locations.ampnorz,!1,this.screenViewMatrix);b.uniformMatrix4fv(d.locations.ghgsnpw,!1,this.screenTransfMatrix);b.bindFramebuffer(b.FRAMEBUFFER,this.frameBuffer);b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,r,0);b.framebufferRenderbuffer(b.FRAMEBUFFER,b.DEPTH_ATTACHMENT,b.RENDERBUFFER,this.renderBuffer);b.uniform1i(d.locations.kxojuqn,0);b.activeTexture(b.TEXTURE0);b.bindTexture(b.TEXTURE_2D,g);
b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT);b.drawElements(b.TRIANGLES,6,b.UNSIGNED_SHORT,0);b.enable(b.DEPTH_TEST);b.enable(b.BLEND);b.webgl2?(b.bindTexture(b.TEXTURE_2D,k),b.copyTexImage2D(b.TEXTURE_2D,l,b.RGBA32F,0,0,q,t,0)):(g=new Float32Array(4*q*t),b.readPixels(0,0,q,t,b.RGBA,b.FLOAT,g),b.bindTexture(b.TEXTURE_2D,k),b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL,!1),b.texImage2D(b.TEXTURE_2D,l,b.RGBA32F,q,t,0,b.RGBA,b.FLOAT,g),b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL,!0));b.bindTexture(b.TEXTURE_2D,null);
b.bindRenderbuffer(b.RENDERBUFFER,null);b.bindFramebuffer(b.FRAMEBUFFER,null);b.deleteTexture(r);return k}};u.prototype.toTexture2dArray=function(d,l,g,q,t,r){if(b.webgl2){q=Math.max(1,q);t=Math.max(1,t);r.x=Math.max(1,Math.floor(r.x));r.y=Math.max(1,Math.floor(r.y));r.patchCount=Math.max(1,Math.min(r.patchCount,r.x*r.y));l=b.createFramebuffer();var f=b.createFramebuffer();q=Math.max(1,Math.floor(q/r.x));t=Math.max(1,Math.floor(t/r.y));b.viewport(0,0,q,t);b.scissor(0,0,q,t);b.bindTexture(b.TEXTURE_2D_ARRAY,
d);b.texImage3D(b.TEXTURE_2D_ARRAY,0,b.RGBA,q,t,r.patchCount,0,b.RGBA,b.UNSIGNED_BYTE,null);b.bindFramebuffer(b.READ_FRAMEBUFFER,f);b.framebufferTexture2D(b.READ_FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,g,0);for(g=0;g<r.patchCount;++g){b.bindFramebuffer(b.DRAW_FRAMEBUFFER,l);b.framebufferTextureLayer(b.DRAW_FRAMEBUFFER,b.COLOR_ATTACHMENT0,d,0,g);var k=Math.floor(g/r.y),u=g%r.y;b.blitFramebuffer(k*q,u*t,k*q+q,u*t+t,0,0,q,t,b.COLOR_BUFFER_BIT,b.NEAREST)}b.bindFramebuffer(b.READ_FRAMEBUFFER,null);
b.bindFramebuffer(b.DRAW_FRAMEBUFFER,null);b.deleteFramebuffer(f);b.deleteFramebuffer(l);b.flush();b.finish()}};u.prototype.applyBlur=function(k,l,g,q,t,r,f){l=Math.max(Math.round(l),1);g=Math.max(Math.round(g),1);q=void 0!==q?this.parseFilters(q):this.defaultBlurFilters;if(!q.length)return k;b.clearColor(0,0,0,0);b.viewport(0,0,l,g);b.scissor(0,0,l,g);var n=k;b.bindTexture(b.TEXTURE_2D,n);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,f?b.REPEAT:b.CLAMP_TO_EDGE);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,
b.CLAMP_TO_EDGE);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,f?b.NEAREST:b.LINEAR);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,f?b.NEAREST:b.LINEAR);var u=b.createTexture(),w=b.createTexture();b.bindTexture(b.TEXTURE_2D,u);t&&b.floatTextures?(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,f?b.NEAREST:b.LINEAR),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,f?b.NEAREST:b.LINEAR),b.texImage2D(b.TEXTURE_2D,0,b.RGBA32F,l,g,0,b.RGBA,b.FLOAT,null)):(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,
f?b.NEAREST:b.LINEAR),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,f?b.NEAREST:b.LINEAR),b.texImage2D(b.TEXTURE_2D,0,b.RGBA,l,g,0,b.RGBA,b.UNSIGNED_BYTE,null));b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,f?b.REPEAT:b.CLAMP_TO_EDGE);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE);b.bindTexture(b.TEXTURE_2D,w);t&&b.floatTextures?(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,f?b.NEAREST:b.LINEAR),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,f?b.NEAREST:b.LINEAR),b.texImage2D(b.TEXTURE_2D,
0,b.RGBA32F,l,g,0,b.RGBA,b.FLOAT,null)):(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,f?b.NEAREST:b.LINEAR),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,f?b.NEAREST:b.LINEAR),b.texImage2D(b.TEXTURE_2D,0,b.RGBA,l,g,0,b.RGBA,b.UNSIGNED_BYTE,null));b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,f?b.REPEAT:b.CLAMP_TO_EDGE);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE);b.disable(b.DEPTH_TEST);b.disable(b.BLEND);b.bindRenderbuffer(b.RENDERBUFFER,this.renderBuffer);b.renderbufferStorage(b.RENDERBUFFER,
b.DEPTH_COMPONENT16,l,g);for(t=0;t<q.length;++t)this.shaders["useTextureFilterVert"+q[t]+"Shader"](d),textureRes=u,b.bindBuffer(b.ARRAY_BUFFER,this.vertexBuffer),b.vertexAttribPointer(d.locations.ymaxekn,3,b.FLOAT,!1,0,0),b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.elementsBuffer),b.uniform2f(d.locations.qxxpdff,l,g),b.uniformMatrix4fv(d.locations.ampnorz,!1,this.screenViewMatrix),b.uniformMatrix4fv(d.locations.ghgsnpw,!1,this.screenTransfMatrix),b.uniform1i(d.locations.dkgckvl,0),b.uniform1i(d.locations.okxtlcd,
f?1:0),b.bindFramebuffer(b.FRAMEBUFFER,this.frameBuffer),b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,textureRes,0),b.framebufferRenderbuffer(b.FRAMEBUFFER,b.DEPTH_ATTACHMENT,b.RENDERBUFFER,this.renderBuffer),b.activeTexture(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,n),b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT),b.drawElements(b.TRIANGLES,6,b.UNSIGNED_SHORT,0),n=textureRes,this.shaders["useTextureFilterHori"+q[t]+"Shader"](d),textureRes=w,b.bindBuffer(b.ARRAY_BUFFER,this.vertexBuffer),
b.vertexAttribPointer(d.locations.ymaxekn,3,b.FLOAT,!1,0,0),b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.elementsBuffer),b.uniform2f(d.locations.qxxpdff,l,g),b.uniformMatrix4fv(d.locations.ampnorz,!1,this.screenViewMatrix),b.uniformMatrix4fv(d.locations.ghgsnpw,!1,this.screenTransfMatrix),b.uniform1i(d.locations.dkgckvl,0),b.uniform1i(d.locations.okxtlcd,f?1:0),b.bindFramebuffer(b.FRAMEBUFFER,this.frameBuffer),b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,textureRes,0),b.framebufferRenderbuffer(b.FRAMEBUFFER,
b.DEPTH_ATTACHMENT,b.RENDERBUFFER,this.renderBuffer),b.activeTexture(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,n),b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT),b.drawElements(b.TRIANGLES,6,b.UNSIGNED_SHORT,0),n=textureRes;r||b.deleteTexture(k);textureRes==u?b.deleteTexture(w):b.deleteTexture(u);b.enable(b.DEPTH_TEST);b.bindRenderbuffer(b.RENDERBUFFER,null);b.bindTexture(b.TEXTURE_2D,null);b.bindFramebuffer(b.FRAMEBUFFER,null);return textureRes};u.prototype.applyGlow=function(k,l,g,q){g=Math.max(Math.round(g),
1);q=Math.max(Math.round(q),1);b.clearColor(0,0,0,0);b.viewport(0,0,g,q);b.scissor(0,0,g,q);b.disable(b.BLEND);var t=b.createTexture(),r=b.createTexture();b.bindTexture(b.TEXTURE_2D,t);b.texImage2D(b.TEXTURE_2D,0,b.RGBA,g,q,0,b.RGBA,b.UNSIGNED_BYTE,null);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.LINEAR);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.LINEAR);
b.bindTexture(b.TEXTURE_2D,r);b.texImage2D(b.TEXTURE_2D,0,b.RGBA,g,q,0,b.RGBA,b.UNSIGNED_BYTE,null);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.LINEAR);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.LINEAR);var f=b.createTexture();b.bindTexture(b.TEXTURE_2D,f);b.floatTextures?(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.LINEAR),b.texParameteri(b.TEXTURE_2D,
b.TEXTURE_MIN_FILTER,b.LINEAR),b.texImage2D(b.TEXTURE_2D,0,b.RGBA32F,g,q,0,b.RGBA,b.FLOAT,null)):(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.LINEAR),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.LINEAR),b.texImage2D(b.TEXTURE_2D,0,b.RGBA,g,q,0,b.RGBA,b.UNSIGNED_BYTE,null));b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE);b.disable(b.DEPTH_TEST);b.disable(b.BLEND);b.bindRenderbuffer(b.RENDERBUFFER,this.renderBuffer);
b.renderbufferStorage(b.RENDERBUFFER,b.DEPTH_COMPONENT16,g,q);this.shaders.useTextureFilterVert7Shader(d);textureRes=t;b.bindBuffer(b.ARRAY_BUFFER,this.vertexBuffer);b.vertexAttribPointer(d.locations.ymaxekn,3,b.FLOAT,!1,0,0);b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.elementsBuffer);b.uniform2f(d.locations.qxxpdff,g,q);b.uniformMatrix4fv(d.locations.ampnorz,!1,this.screenViewMatrix);b.uniformMatrix4fv(d.locations.ghgsnpw,!1,this.screenTransfMatrix);b.uniform1i(d.locations.dkgckvl,0);b.uniform1i(d.locations.dkgckvl2,
1);b.uniform1i(d.locations.layjmki,0);b.uniform1i(d.locations.eqvgkaq,0);b.bindFramebuffer(b.FRAMEBUFFER,this.frameBuffer);b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,textureRes,0);b.framebufferRenderbuffer(b.FRAMEBUFFER,b.DEPTH_ATTACHMENT,b.RENDERBUFFER,this.renderBuffer);b.activeTexture(b.TEXTURE0);b.bindTexture(b.TEXTURE_2D,k);b.activeTexture(b.TEXTURE1);b.bindTexture(b.TEXTURE_2D,l);b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT);b.drawElements(b.TRIANGLES,6,b.UNSIGNED_SHORT,
0);this.shaders.useTextureFilterHori7Shader(d);textureRes=r;b.bindBuffer(b.ARRAY_BUFFER,this.vertexBuffer);b.vertexAttribPointer(d.locations.ymaxekn,3,b.FLOAT,!1,0,0);b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.elementsBuffer);b.uniform2f(d.locations.qxxpdff,g,q);b.uniformMatrix4fv(d.locations.ampnorz,!1,this.screenViewMatrix);b.uniformMatrix4fv(d.locations.ghgsnpw,!1,this.screenTransfMatrix);b.uniform1i(d.locations.dkgckvl,0);b.uniform1i(d.locations.dkgckvl2,1);b.uniform1i(d.locations.layjmki,0);b.uniform1i(d.locations.eqvgkaq,
0);b.bindFramebuffer(b.FRAMEBUFFER,this.frameBuffer);b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,textureRes,0);b.framebufferRenderbuffer(b.FRAMEBUFFER,b.DEPTH_ATTACHMENT,b.RENDERBUFFER,this.renderBuffer);b.activeTexture(b.TEXTURE0);b.bindTexture(b.TEXTURE_2D,k);b.activeTexture(b.TEXTURE1);b.bindTexture(b.TEXTURE_2D,l);b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT);b.drawElements(b.TRIANGLES,6,b.UNSIGNED_SHORT,0);this.shaders.useTextureFilterHori7Shader(d);textureRes=f;b.bindBuffer(b.ARRAY_BUFFER,
this.vertexBuffer);b.vertexAttribPointer(d.locations.ymaxekn,3,b.FLOAT,!1,0,0);b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.elementsBuffer);b.uniform2f(d.locations.qxxpdff,g,q);b.uniformMatrix4fv(d.locations.ampnorz,!1,this.screenViewMatrix);b.uniformMatrix4fv(d.locations.ghgsnpw,!1,this.screenTransfMatrix);b.uniform1i(d.locations.dkgckvl,0);b.uniform1i(d.locations.dkgckvl2,1);b.uniform1i(d.locations.layjmki,1);b.uniform1i(d.locations.eqvgkaq,0);b.bindFramebuffer(b.FRAMEBUFFER,this.frameBuffer);b.framebufferTexture2D(b.FRAMEBUFFER,
b.COLOR_ATTACHMENT0,b.TEXTURE_2D,textureRes,0);b.framebufferRenderbuffer(b.FRAMEBUFFER,b.DEPTH_ATTACHMENT,b.RENDERBUFFER,this.renderBuffer);b.activeTexture(b.TEXTURE0);b.bindTexture(b.TEXTURE_2D,t);b.activeTexture(b.TEXTURE1);b.bindTexture(b.TEXTURE_2D,r);b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT);b.drawElements(b.TRIANGLES,6,b.UNSIGNED_SHORT,0);b.deleteTexture(k);b.deleteTexture(r);b.deleteTexture(t);b.enable(b.DEPTH_TEST);b.enable(b.BLEND);b.bindRenderbuffer(b.RENDERBUFFER,null);b.bindTexture(b.TEXTURE_2D,
null);b.bindFramebuffer(b.FRAMEBUFFER,null);return this.applyBlur(textureRes,g,q,"2-2-2-2-2-2-3-3-3-3")};u.prototype.applySpecularGlow=function(k,l,g){l=Math.max(Math.round(l),1);g=Math.max(Math.round(g),1);b.clearColor(0,0,0,0);b.viewport(0,0,l,g);b.scissor(0,0,l,g);b.disable(b.BLEND);var q=b.createTexture(),t=b.createTexture();b.bindTexture(b.TEXTURE_2D,q);b.texImage2D(b.TEXTURE_2D,0,b.RGBA,l,g,0,b.RGBA,b.UNSIGNED_BYTE,null);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE);b.texParameteri(b.TEXTURE_2D,
b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.LINEAR);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.LINEAR);b.bindTexture(b.TEXTURE_2D,t);b.texImage2D(b.TEXTURE_2D,0,b.RGBA,l,g,0,b.RGBA,b.UNSIGNED_BYTE,null);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.LINEAR);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.LINEAR);var r=
b.createTexture();b.bindTexture(b.TEXTURE_2D,r);b.floatTextures?(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.LINEAR),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.LINEAR),b.texImage2D(b.TEXTURE_2D,0,b.RGBA32F,l,g,0,b.RGBA,b.FLOAT,null)):(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.LINEAR),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.LINEAR),b.texImage2D(b.TEXTURE_2D,0,b.RGBA,l,g,0,b.RGBA,b.UNSIGNED_BYTE,null));b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE);
b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE);b.disable(b.DEPTH_TEST);b.disable(b.BLEND);b.bindRenderbuffer(b.RENDERBUFFER,this.renderBuffer);b.renderbufferStorage(b.RENDERBUFFER,b.DEPTH_COMPONENT16,l,g);this.shaders.useTextureFilterVert7Shader(d);textureRes=q;b.bindBuffer(b.ARRAY_BUFFER,this.vertexBuffer);b.vertexAttribPointer(d.locations.ymaxekn,3,b.FLOAT,!1,0,0);b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.elementsBuffer);b.uniform2f(d.locations.qxxpdff,l,g);b.uniformMatrix4fv(d.locations.ampnorz,
!1,this.screenViewMatrix);b.uniformMatrix4fv(d.locations.ghgsnpw,!1,this.screenTransfMatrix);b.uniform1i(d.locations.dkgckvl,0);b.uniform1i(d.locations.dkgckvl2,1);b.uniform1i(d.locations.layjmki,0);b.uniform1i(d.locations.eqvgkaq,1);b.bindFramebuffer(b.FRAMEBUFFER,this.frameBuffer);b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,textureRes,0);b.framebufferRenderbuffer(b.FRAMEBUFFER,b.DEPTH_ATTACHMENT,b.RENDERBUFFER,this.renderBuffer);b.activeTexture(b.TEXTURE0);b.bindTexture(b.TEXTURE_2D,
k);b.activeTexture(b.TEXTURE1);b.bindTexture(b.TEXTURE_2D,t);b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT);b.drawElements(b.TRIANGLES,6,b.UNSIGNED_SHORT,0);this.shaders.useTextureFilterHori7Shader(d);textureRes=t;b.bindBuffer(b.ARRAY_BUFFER,this.vertexBuffer);b.vertexAttribPointer(d.locations.ymaxekn,3,b.FLOAT,!1,0,0);b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.elementsBuffer);b.uniform2f(d.locations.qxxpdff,l,g);b.uniformMatrix4fv(d.locations.ampnorz,!1,this.screenViewMatrix);b.uniformMatrix4fv(d.locations.ghgsnpw,
!1,this.screenTransfMatrix);b.uniform1i(d.locations.dkgckvl,0);b.uniform1i(d.locations.dkgckvl2,1);b.uniform1i(d.locations.layjmki,0);b.uniform1i(d.locations.eqvgkaq,1);b.bindFramebuffer(b.FRAMEBUFFER,this.frameBuffer);b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,textureRes,0);b.framebufferRenderbuffer(b.FRAMEBUFFER,b.DEPTH_ATTACHMENT,b.RENDERBUFFER,this.renderBuffer);b.activeTexture(b.TEXTURE0);b.bindTexture(b.TEXTURE_2D,k);b.activeTexture(b.TEXTURE1);b.bindTexture(b.TEXTURE_2D,
q);b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT);b.drawElements(b.TRIANGLES,6,b.UNSIGNED_SHORT,0);this.shaders.useTextureFilterHori7Shader(d);textureRes=r;b.bindBuffer(b.ARRAY_BUFFER,this.vertexBuffer);b.vertexAttribPointer(d.locations.ymaxekn,3,b.FLOAT,!1,0,0);b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.elementsBuffer);b.uniform2f(d.locations.qxxpdff,l,g);b.uniformMatrix4fv(d.locations.ampnorz,!1,this.screenViewMatrix);b.uniformMatrix4fv(d.locations.ghgsnpw,!1,this.screenTransfMatrix);b.uniform1i(d.locations.dkgckvl,
0);b.uniform1i(d.locations.dkgckvl2,1);b.uniform1i(d.locations.layjmki,1);b.uniform1i(d.locations.eqvgkaq,1);b.bindFramebuffer(b.FRAMEBUFFER,this.frameBuffer);b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,textureRes,0);b.framebufferRenderbuffer(b.FRAMEBUFFER,b.DEPTH_ATTACHMENT,b.RENDERBUFFER,this.renderBuffer);b.activeTexture(b.TEXTURE0);b.bindTexture(b.TEXTURE_2D,q);b.activeTexture(b.TEXTURE1);b.bindTexture(b.TEXTURE_2D,t);b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT);b.drawElements(b.TRIANGLES,
6,b.UNSIGNED_SHORT,0);b.deleteTexture(k);b.deleteTexture(t);b.deleteTexture(q);b.enable(b.DEPTH_TEST);b.enable(b.BLEND);b.bindRenderbuffer(b.RENDERBUFFER,null);b.bindTexture(b.TEXTURE_2D,null);b.bindFramebuffer(b.FRAMEBUFFER,null);return this.applyBlur(textureRes,l,g,"2-2-2-2-2-2-3-3-3-3")};u.prototype.applySimpleFilter=function(k,l,g,q){l=Math.max(Math.round(l),1);g=Math.max(Math.round(g),1);b.clearColor(0,0,0,0);b.viewport(0,0,l,g);b.scissor(0,0,l,g);b.disable(b.BLEND);b.bindTexture(b.TEXTURE_2D,
k);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.LINEAR);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.LINEAR);b.texImage2D(b.TEXTURE_2D,0,b.RGBA,l,g,0,b.RGBA,b.UNSIGNED_BYTE,null);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE);b.disable(b.DEPTH_TEST);b.disable(b.BLEND);b.bindRenderbuffer(b.RENDERBUFFER,this.renderBuffer);b.renderbufferStorage(b.RENDERBUFFER,b.DEPTH_COMPONENT16,l,g);b.bindBuffer(b.ARRAY_BUFFER,
this.vertexBuffer);b.vertexAttribPointer(d.locations.ymaxekn,3,b.FLOAT,!1,0,0);b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.elementsBuffer);b.uniform2f(d.locations.qxxpdff,l,g);b.uniformMatrix4fv(d.locations.ampnorz,!1,this.screenViewMatrix);b.uniformMatrix4fv(d.locations.ghgsnpw,!1,this.screenTransfMatrix);q.texture1&&(b.uniform1i(d.locations.kxojuqn,0),b.activeTexture(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,q.texture1));q.texture2&&(b.uniform1i(d.locations.hvsflvm,1),b.activeTexture(b.TEXTURE1),b.bindTexture(b.TEXTURE_2D,
q.texture2));void 0!==q.value1&&b.uniform1f(d.locations.axeqzlu,q.value1);void 0!==q.value2&&b.uniform1f(d.locations.udfzxlx,q.value2);void 0!==q.value3&&b.uniform1f(d.locations.edbxxzp,q.value3);void 0!==q.value4&&b.uniform1f(d.locations.juqaqzf,q.value4);void 0!==q.value5&&b.uniform1f(d.locations.uvoonej,q.value5);void 0!==q.value6&&b.uniform1f(d.locations.uvketbs,q.value6);void 0!==q.matrix1&&b.uniformMatrix4fv(d.locations.qezlvwh,!1,q.matrix1);b.bindFramebuffer(b.FRAMEBUFFER,this.frameBuffer);
b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,k,0);b.framebufferRenderbuffer(b.FRAMEBUFFER,b.DEPTH_ATTACHMENT,b.RENDERBUFFER,this.renderBuffer);b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT);b.drawElements(b.TRIANGLES,6,b.UNSIGNED_SHORT,0);b.enable(b.DEPTH_TEST);b.enable(b.BLEND);b.bindRenderbuffer(b.RENDERBUFFER,null);b.bindTexture(b.TEXTURE_2D,null);b.bindFramebuffer(b.FRAMEBUFFER,null);return k};u.prototype.applyBrightness=function(b,l,g,q,t){this.shaders.useTextureFilterBrightnessShader(d);
return this.applySimpleFilter(b,g,q,{texture1:l,value1:t})};u.prototype.applyContrast=function(b,l,g,q,t){this.shaders.useTextureFilterContrastShader(d);return this.applySimpleFilter(b,g,q,{texture1:l,value1:t})};u.prototype.applyContrastAndBrightness=function(b,l,g,q,t,r){this.shaders.useTextureFilterContrastAndBrightnessShader(d);return this.applySimpleFilter(b,g,q,{texture1:l,value1:t,value2:r})};u.prototype.applyHue=function(b,l,g,q,t){this.shaders.useTextureFilterHueShader(d);return this.applySimpleFilter(b,
g,q,{texture1:l,value1:t})};u.prototype.applyBlackAndWhite=function(b,l,g,q,t){this.shaders.useTextureFilterBlackAndWhiteShader(d);return this.applySimpleFilter(b,g,q,{texture1:l,value1:t})};u.prototype.applyGraining=function(b,l,g,q,t,r){this.shaders.useTextureFilterGrainingShader(d);return this.applySimpleFilter(b,g,q,{texture1:l,value1:t,value2:r})};u.prototype.applyCenterBlur=function(k,l,g,q,t,r,f,n,u,w,D){switch(parseInt(t)){case 1:this.shaders.createTextureFilterVert2Shader();this.shaders.createTextureFilterHori2Shader();
t="2";break;case 2:this.shaders.createTextureFilterVert3Shader();this.shaders.createTextureFilterHori3Shader();t="3";break;case 3:this.shaders.createTextureFilterVert4Shader();this.shaders.createTextureFilterHori4Shader();t="4";break;case 4:this.shaders.createTextureFilterVert5Shader();this.shaders.createTextureFilterHori5Shader();t="5";break;default:this.shaders.createTextureFilterVert6Shader(),this.shaders.createTextureFilterHori6Shader(),t="6"}t=this.applyBlur(l,g,q,t,!1,!0);this.shaders.useTextureFilterCenterBlurringShader(d);
k=this.applySimpleFilter(k,g,q,{texture1:l,texture2:t,value1:r,value2:f,value3:n,value4:void 0!==u?u:.5,value5:void 0!==w?w:.5,value6:D});b.deleteTexture(t);return k};u.prototype.applyCssGram=function(b,l,g,q,t){switch(t){case "1977":this.shaders.useTextureFilterCssGram1977Shader(d);break;case "Inkwell":this.shaders.useTextureFilterCssGramInkwellShader(d);break;case "Nashville":this.shaders.useTextureFilterCssGramNashvilleShader(d);break;case "Moon":this.shaders.useTextureFilterCssGramMoonShader(d);
break;case "Walden":this.shaders.useTextureFilterCssGramWaldenShader(d);break;default:return this.applyBrightness(b,l,g,q,0)}return this.applySimpleFilter(b,g,q,{texture1:l})};u.prototype.applyBlending=function(b,l,g,q,t){this.shaders.useTextureFilterBlendingShader(d);return this.applySimpleFilter(b,g,q,{texture1:l,value1:t.r,value2:t.g,value3:t.b,value4:t.a})};u.prototype.createGoldNoiseTexture=function(k,l,g,q,t,r){k=Math.max(Math.round(k||512),1);l=Math.max(Math.round(l||512),1);g=g||[0,0,0,0];
q=q||[!0,!0,!0,!0];t=t||Math.random();var f=b.isEnabled(b.BLEND);f&&b.disable(b.BLEND);var n=b.isEnabled(b.DEPTH_TEST);n&&b.disable(b.DEPTH_TEST);var u=b.isEnabled(b.CULL_FACE);u&&b.disable(b.CULL_FACE);var w=b.isEnabled(b.STENCIL_TEST);w&&b.disable(b.STENCIL_TEST);var D=b.getParameter(b.DEPTH_WRITEMASK);D&&b.depthMask(!1);var A=b.getParameter(b.COLOR_CLEAR_VALUE);b.clearColor.apply(b,g);g=b.createFramebuffer();b.bindFramebuffer(b.FRAMEBUFFER,g);var H=b.createRenderbuffer();b.bindRenderbuffer(b.RENDERBUFFER,
H);b.renderbufferStorage(b.RENDERBUFFER,b.DEPTH_STENCIL,k,l);b.framebufferRenderbuffer(b.FRAMEBUFFER,b.DEPTH_STENCIL_ATTACHMENT,b.RENDERBUFFER,H);var e=b.createTexture();b.bindTexture(b.TEXTURE_2D,e);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.LINEAR);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.LINEAR);b.texImage2D(b.TEXTURE_2D,0,b.RGBA,k,l,0,b.RGBA,b.UNSIGNED_BYTE,
null);b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,e,0);b.viewport(0,0,k,l);b.scissor(0,0,k,l);b.clear(b.COLOR_BUFFER_BIT);this.shaders.useGoldNoiseShader(d,t);k=b.getParameter(b.COLOR_WRITEMASK);b.colorMask.apply(b,q);b.bindBuffer(b.ARRAY_BUFFER,this.uvBuffer);b.vertexAttribPointer(d.locations.ufoizoh,2,b.FLOAT,!1,0,0);b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.elementsBuffer);b.drawElements(b.TRIANGLES,6,b.UNSIGNED_SHORT,0);r&&(b.bindTexture(b.TEXTURE_2D,e),b.generateMipmap(b.TEXTURE_2D),
b.bindTexture(b.TEXTURE_2D,null));f&&b.enable(b.BLEND);n&&b.enable(b.DEPTH_TEST);u&&b.enable(b.CULL_FACE);w&&b.enable(b.STENCIL_TEST);D&&b.depthMask(!0);b.clearColor.apply(b,A);b.colorMask.apply(b,k);b.deleteRenderbuffer(H);b.deleteFramebuffer(g);return e};u.prototype.applyDilation=function(k,l,g,q){this.shaders.useTextureFilterDilationShader(d);g=Math.max(Math.round(g),1);q=Math.max(Math.round(q),1);var t=Math.min(Math.max(g,q),512);t%2&&++t;b.clearColor(0,0,0,0);b.viewport(0,0,g,q);b.scissor(0,
0,g,q);b.disable(b.BLEND);b.disable(b.DEPTH_TEST);b.bindTexture(b.TEXTURE_2D,k);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.LINEAR);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.LINEAR);b.texImage2D(b.TEXTURE_2D,0,b.RGBA,g,q,0,b.RGBA,b.UNSIGNED_BYTE,null);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE);var r=b.createTexture();b.bindTexture(b.TEXTURE_2D,r);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.LINEAR);
b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.LINEAR);b.texImage2D(b.TEXTURE_2D,0,b.RGBA,g,q,0,b.RGBA,b.UNSIGNED_BYTE,null);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE);b.bindRenderbuffer(b.RENDERBUFFER,this.renderBuffer);b.renderbufferStorage(b.RENDERBUFFER,b.DEPTH_COMPONENT16,g,q);b.bindBuffer(b.ARRAY_BUFFER,this.vertexBuffer);b.vertexAttribPointer(d.locations.ymaxekn,3,b.FLOAT,!1,0,0);b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,
this.elementsBuffer);b.uniform2f(d.locations.qxxpdff,g,q);b.uniformMatrix4fv(d.locations.ampnorz,!1,this.screenViewMatrix);b.uniformMatrix4fv(d.locations.ghgsnpw,!1,this.screenTransfMatrix);b.bindFramebuffer(b.FRAMEBUFFER,this.frameBuffer);b.framebufferRenderbuffer(b.FRAMEBUFFER,b.DEPTH_ATTACHMENT,b.RENDERBUFFER,this.renderBuffer);b.uniform1i(d.locations.kxojuqn,0);b.activeTexture(b.TEXTURE0);g=r;for(q=0;q<t;++q)b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,g,0),b.bindTexture(b.TEXTURE_2D,
l),b.drawElements(b.TRIANGLES,6,b.UNSIGNED_SHORT,0),g===r?(l=r,g=k):(l=k,g=r),q%256||b.flush();b.flush();b.finish();b.deleteTexture(r);b.enable(b.DEPTH_TEST);b.enable(b.BLEND);b.bindRenderbuffer(b.RENDERBUFFER,null);b.bindTexture(b.TEXTURE_2D,null);b.bindFramebuffer(b.FRAMEBUFFER,null);return k};u.prototype.applyTransform=function(b,l,g,q,t){this.shaders.useTextureFilterTransformShader(d);return this.applySimpleFilter(b,g,q,{texture1:l,matrix1:t})};u.prototype.applyAlbedoToNormal=function(b,l,g,q){this.shaders.useTextureFilterAlbedoToNormalShader(d);
return this.applySimpleFilter(b,g,q,{texture1:l})};return u});stage.provide("emersya.viewer.modules.renderer.screenTools");
stage.register.call(stage.emersya.viewer.modules.renderer,"screenTools",function(){var b=null,d=null,u=function(f,e,g,k,l){k=Math.max(Math.round(k),1);l=Math.max(Math.round(l),1);b=g;d=f;this.shaders=e;this.globalId=this.currentBlueColor=this.currentGreenColor=this.currentRedColor=0;this.colorsToTriangle={};this.deallocateFunctionsByPolylistInstanceId={};this.divisorRatio=1;f=Math.max(Math.round(k/this.divisorRatio),1);l=Math.max(Math.round(l/this.divisorRatio),1);this.textureWidth=f;this.textureHeight=
l;this.framebuffer=b.createFramebuffer();this.renderbuffer=b.createRenderbuffer();b.bindFramebuffer(b.FRAMEBUFFER,this.framebuffer);this.texture=b.createTexture();b.bindTexture(b.TEXTURE_2D,this.texture);b.texImage2D(b.TEXTURE_2D,0,b.RGBA,this.textureWidth,this.textureHeight,0,b.RGBA,b.UNSIGNED_BYTE,null);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.LINEAR);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.LINEAR);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE);b.texParameteri(b.TEXTURE_2D,
b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE);b.bindRenderbuffer(b.RENDERBUFFER,this.renderbuffer);b.renderbufferStorage(b.RENDERBUFFER,b.DEPTH_COMPONENT16,this.textureWidth,this.textureHeight);b.bindFramebuffer(b.FRAMEBUFFER,this.framebuffer);b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,this.texture,0);b.framebufferRenderbuffer(b.FRAMEBUFFER,b.DEPTH_ATTACHMENT,b.RENDERBUFFER,this.renderbuffer);b.bindTexture(b.TEXTURE_2D,null);b.bindRenderbuffer(b.RENDERBUFFER,null);b.bindFramebuffer(b.FRAMEBUFFER,
null);this.nbSphereSlices=50;this.nbSphereFaces=0;this.nbCylindreSlices=20;this.nbCylindreFaces=0;this.nbDiscSlices=50;this.nbDiscFaces=0;this.nbConeSlices=200;this.arrowLength=2;this.toolSize=40;l=new Float32Array(3*this.nbConeSlices+3);f=new Uint16Array(3*this.nbConeSlices);e=new Uint16Array(4*this.nbConeSlices);this.nbConeFaces=f.length;l[0]=0;l[1]=0;for(g=l[2]=0;g<this.nbConeSlices;++g)l[3+3*g]=Math.cos(2*g*Math.PI/this.nbConeSlices),l[3*g+4]=-1,l[3*g+5]=Math.sin(2*g*Math.PI/this.nbConeSlices),
f[3*g]=0,f[3*g+1]=g+1,f[3*g+2]=g+2,e[2*g]=0,e[2*g+1]=g+1,e[2*this.nbConeSlices+2*g]=g+1,e[2*this.nbConeSlices+2*g+1]=g+2;f[3*this.nbConeSlices-1]=1;e[4*this.nbConeSlices-1]=1;this.coneVBuffer=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,this.coneVBuffer);b.bufferData(b.ARRAY_BUFFER,l,b.STATIC_DRAW);this.coneIBuffer=b.createBuffer();b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.coneIBuffer);b.bufferData(b.ELEMENT_ARRAY_BUFFER,f,b.STATIC_DRAW);this.coneIWBuffer=b.createBuffer();b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,
this.coneIWBuffer);b.bufferData(b.ELEMENT_ARRAY_BUFFER,e,b.STATIC_DRAW);l=new Float32Array(24);l[0]=-1;l[1]=-1;l[2]=-1;l[3]=-1;l[4]=-1;l[5]=1;l[6]=1;l[7]=-1;l[8]=1;l[9]=1;l[10]=-1;l[11]=-1;l[12]=-1;l[13]=1;l[14]=-1;l[15]=-1;l[16]=1;l[17]=1;l[18]=1;l[19]=1;l[20]=1;l[21]=1;l[22]=1;l[23]=-1;f=new Uint16Array(36);f[0]=0;f[1]=1;f[2]=2;f[3]=0;f[4]=2;f[5]=3;f[6]=4;f[7]=5;f[8]=6;f[9]=4;f[10]=6;f[11]=7;f[12]=1;f[13]=2;f[14]=6;f[15]=1;f[16]=6;f[17]=5;f[18]=2;f[19]=3;f[20]=7;f[21]=2;f[22]=7;f[23]=6;f[24]=3;
f[25]=0;f[26]=4;f[27]=3;f[28]=4;f[29]=7;f[30]=0;f[31]=1;f[32]=5;f[33]=0;f[34]=5;f[35]=4;this.cubeVBuffer=b.createBuffer(b.ARRAY_BUFFER);b.bindBuffer(b.ARRAY_BUFFER,this.cubeVBuffer);b.bufferData(b.ARRAY_BUFFER,l,b.STATIC_DRAW);this.cubeIBuffer=b.createBuffer(b.ELEMENT_ARRAY_BUFFER);b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.cubeIBuffer);b.bufferData(b.ELEMENT_ARRAY_BUFFER,f,b.STATIC_DRAW);this.nbCubeFaces=f.length;l=new Float32Array(12);l[0]=-1;l[1]=-1;l[2]=0;l[3]=1;l[4]=-1;l[5]=0;l[6]=1;l[7]=1;l[8]=
0;l[9]=-1;l[10]=1;l[11]=0;f=new Float32Array(8);f[0]=0;f[1]=0;f[2]=1;f[3]=0;f[4]=1;f[5]=1;f[6]=0;f[7]=1;e=new Uint16Array(6);e[0]=3;e[1]=0;e[2]=1;e[3]=1;e[4]=2;e[5]=3;this.squareVBuffer=b.createBuffer(b.ARRAY_BUFFER);b.bindBuffer(b.ARRAY_BUFFER,this.squareVBuffer);b.bufferData(b.ARRAY_BUFFER,l,b.STATIC_DRAW);this.squareUVBuffer=b.createBuffer(b.ARRAY_BUFFER);b.bindBuffer(b.ARRAY_BUFFER,this.squareUVBuffer);b.bufferData(b.ARRAY_BUFFER,f,b.STATIC_DRAW);this.squareIBuffer=b.createBuffer(b.ELEMENT_ARRAY_BUFFER);
b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.squareIBuffer);b.bufferData(b.ELEMENT_ARRAY_BUFFER,e,b.STATIC_DRAW);this.nbSquareFaces=e.length;l=new Float32Array(3*this.nbDiscSlices);for(f=0;f<this.nbDiscSlices;++f)e=Math.sin(2*f*Math.PI/this.nbDiscSlices),l[3*f]=Math.cos(2*f*Math.PI/this.nbDiscSlices),l[3*f+1]=0,l[3*f+2]=e;e=new Uint16Array(this.nbDiscSlices);for(f=0;f<this.nbDiscSlices;++f)e[f]=f;this.discVBuffer=b.createBuffer(b.ARRAY_BUFFER);b.bindBuffer(b.ARRAY_BUFFER,this.discVBuffer);b.bufferData(b.ARRAY_BUFFER,
l,b.STATIC_DRAW);this.discIBuffer=b.createBuffer(b.ELEMENT_ARRAY_BUFFER);b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.discIBuffer);b.bufferData(b.ELEMENT_ARRAY_BUFFER,e,b.STATIC_DRAW);this.nbDiscFaces=e.length;l=new Float32Array((this.nbSphereSlices-1)*this.nbSphereSlices*3+6);f=new Uint16Array((2*(this.nbSphereSlices-2)+2)*this.nbSphereSlices*3);l[0]=0;l[1]=1;for(e=l[2]=0;e<this.nbSphereSlices-1;++e){k=1-(e+1)/(this.nbSphereSlices/2);k=Math.sin(Math.PI/2*k);var h=Math.sqrt(1-k*k);for(g=0;g<this.nbSphereSlices;++g){var m=
vec3.scale(vec3.normalize(vec3.create([Math.cos(2*g*Math.PI/this.nbSphereSlices),0,Math.sin(2*g*Math.PI/this.nbSphereSlices)])),h);m[1]=k;l[3+3*(e*this.nbSphereSlices+g)]=m[0];l[3*(e*this.nbSphereSlices+g)+4]=m[1];l[3*(e*this.nbSphereSlices+g)+5]=m[2]}}l[(this.nbSphereSlices-1)*this.nbSphereSlices*3+3]=0;l[(this.nbSphereSlices-1)*this.nbSphereSlices*3+4]=-1;for(e=l[(this.nbSphereSlices-1)*this.nbSphereSlices*3+5]=0;e<this.nbSphereSlices;++e)f[3*e]=0,f[3*e+1]=e+2,f[3*e+2]=e+1;for(e=f[3*(this.nbSphereSlices-
1)+1]=1;e<this.nbSphereSlices-1;++e){for(g=0;g<this.nbSphereSlices;++g)f[6*(e*this.nbSphereSlices+g)-3*this.nbSphereSlices]=1+e*this.nbSphereSlices+g,f[6*(e*this.nbSphereSlices+g)+1-3*this.nbSphereSlices]=1+(e-1)*this.nbSphereSlices+g,f[6*(e*this.nbSphereSlices+g)+2-3*this.nbSphereSlices]=1+e*this.nbSphereSlices+(g+1),f[6*(e*this.nbSphereSlices+g)+3-3*this.nbSphereSlices]=1+e*this.nbSphereSlices+(g+1),f[6*(e*this.nbSphereSlices+g)+4-3*this.nbSphereSlices]=1+(e-1)*this.nbSphereSlices+g,f[6*(e*this.nbSphereSlices+
g)+5-3*this.nbSphereSlices]=1+(e-1)*this.nbSphereSlices+(g+1);f[6*(e*this.nbSphereSlices+(this.nbSphereSlices-1))+2-3*this.nbSphereSlices]=1+e*this.nbSphereSlices;f[6*(e*this.nbSphereSlices+(this.nbSphereSlices-1))+3-3*this.nbSphereSlices]=1+e*this.nbSphereSlices;f[6*(e*this.nbSphereSlices+(this.nbSphereSlices-1))+5-3*this.nbSphereSlices]=1+(e-1)*this.nbSphereSlices}for(e=0;e<this.nbSphereSlices;++e)f[3*e+6*(this.nbSphereSlices-2)*this.nbSphereSlices+3*this.nbSphereSlices]=1+(this.nbSphereSlices-
1)*this.nbSphereSlices,f[3*e+1+6*(this.nbSphereSlices-2)*this.nbSphereSlices+3*this.nbSphereSlices]=1+(this.nbSphereSlices-2)*this.nbSphereSlices+e,f[3*e+2+6*(this.nbSphereSlices-2)*this.nbSphereSlices+3*this.nbSphereSlices]=1+(this.nbSphereSlices-2)*this.nbSphereSlices+e+1;f[3*(this.nbSphereSlices-1)+2+6*(this.nbSphereSlices-2)*this.nbSphereSlices+3*this.nbSphereSlices]=1+(this.nbSphereSlices-2)*this.nbSphereSlices;k=new Uint16Array(8*this.nbSphereSlices+6*(this.nbSphereSlices-2)*this.nbSphereSlices);
for(e=0;e<this.nbSphereSlices;++e)k[4*e]=0,k[4*e+1]=e+1,k[4*e+2]=e+1,k[4*e+3]=e+2;for(e=k[4*(this.nbSphereSlices-1)+3]=1;e<this.nbSphereSlices-1;++e){for(g=0;g<this.nbSphereSlices;++g)k[6*(e*this.nbSphereSlices+g)-2*this.nbSphereSlices]=e*this.nbSphereSlices+g+1,k[6*(e*this.nbSphereSlices+g)+1-2*this.nbSphereSlices]=e*this.nbSphereSlices+g+1+1,k[6*(e*this.nbSphereSlices+g)+2-2*this.nbSphereSlices]=e*this.nbSphereSlices+g+1+1,k[6*(e*this.nbSphereSlices+g)+3-2*this.nbSphereSlices]=(e-1)*this.nbSphereSlices+
g+1,k[6*(e*this.nbSphereSlices+g)+4-2*this.nbSphereSlices]=(e-1)*this.nbSphereSlices+g+1,k[6*(e*this.nbSphereSlices+g)+5-2*this.nbSphereSlices]=e*this.nbSphereSlices+g+1;k[6*(e*this.nbSphereSlices+(this.nbSphereSlices-1))+1-2*this.nbSphereSlices]=e*this.nbSphereSlices+1;k[6*(e*this.nbSphereSlices+(this.nbSphereSlices-1))+2-2*this.nbSphereSlices]=e*this.nbSphereSlices+1}for(e=0;e<this.nbSphereSlices;++e)k[4*e+6*(this.nbSphereSlices-2)*this.nbSphereSlices+4*this.nbSphereSlices]=(this.nbSphereSlices-
1)*this.nbSphereSlices+1,k[4*e+1+6*(this.nbSphereSlices-2)*this.nbSphereSlices+4*this.nbSphereSlices]=(this.nbSphereSlices-2)*this.nbSphereSlices+e+1,k[4*e+2+6*(this.nbSphereSlices-2)*this.nbSphereSlices+4*this.nbSphereSlices]=(this.nbSphereSlices-2)*this.nbSphereSlices+e+1,k[4*e+3+6*(this.nbSphereSlices-2)*this.nbSphereSlices+4*this.nbSphereSlices]=(this.nbSphereSlices-2)*this.nbSphereSlices+e+2;k[4*(this.nbSphereSlices-1)+3+6*(this.nbSphereSlices-2)*this.nbSphereSlices+4*this.nbSphereSlices]=(this.nbSphereSlices-
2)*this.nbSphereSlices+(this.nbSphereSlices-1)+2;this.sphereVBuffer=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,this.sphereVBuffer);b.bufferData(b.ARRAY_BUFFER,l,b.STATIC_DRAW);this.sphereIBuffer=b.createBuffer();b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.sphereIBuffer);b.bufferData(b.ELEMENT_ARRAY_BUFFER,f,b.STATIC_DRAW);this.sphereIWBuffer=b.createBuffer();b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.sphereIWBuffer);b.bufferData(b.ELEMENT_ARRAY_BUFFER,k,b.STATIC_DRAW);this.nbSphereFaces=f.length;l=new Float32Array(3*
(2*this.nbCylindreSlices+2));l[0]=0;l[1]=1;for(e=l[2]=0;2>e;++e)for(g=-2*e+1,f=0;f<this.nbCylindreSlices;++f)k=Math.sin(2*f*Math.PI/this.nbCylindreSlices),l[3+3*(this.nbCylindreSlices*e+f)]=Math.cos(2*f*Math.PI/this.nbCylindreSlices),l[3*(this.nbCylindreSlices*e+f)+4]=g,l[3*(this.nbCylindreSlices*e+f)+5]=k;l[3*(2*this.nbCylindreSlices+1)]=0;l[3*(2*this.nbCylindreSlices+1)+1]=-1;l[3*(2*this.nbCylindreSlices+1)+2]=0;e=new Uint16Array(12*this.nbCylindreSlices);for(f=0;f<this.nbCylindreSlices;++f)e[3*
f]=0,e[3*f+1]=f+2,e[3*f+2]=f+1;g=3*this.nbCylindreSlices;e[g-2]=1;for(f=0;f<this.nbCylindreSlices;++f)e[g+6*f+0]=1+f,e[g+6*f+1]=1+f+1,e[g+6*f+2]=1+f+this.nbCylindreSlices,e[g+6*f+3]=1+f+1+this.nbCylindreSlices,e[g+6*f+4]=1+f+this.nbCylindreSlices,e[g+6*f+5]=1+f+1;g+=6*this.nbCylindreSlices;e[g-5]=1;e[g-3]=1+this.nbCylindreSlices;e[g-1]=1;for(f=0;f<this.nbCylindreSlices;++f)e[g+3*f+0]=1+this.nbCylindreSlices+f,e[g+3*f+1]=1+this.nbCylindreSlices+f+1,e[g+3*f+2]=2*this.nbCylindreSlices+1;g+=3*this.nbCylindreSlices;
e[g-2]=1+this.nbCylindreSlices;k=new Uint16Array(12*this.nbCylindreSlices);for(f=0;f<this.nbCylindreSlices;++f)k[4*f]=0,k[4*f+1]=f+1,k[4*f+2]=f+1,k[4*f+3]=f+2;g=4*this.nbCylindreSlices;k[g-1]=1;for(f=0;f<this.nbCylindreSlices;++f)k[g+4*f+0]=1+f,k[g+4*f+1]=1+f+this.nbCylindreSlices,k[g+4*f+2]=1+f+this.nbCylindreSlices,k[g+4*f+3]=1+f+1;g=8*this.nbCylindreSlices;k[g-1]=1;for(f=0;f<this.nbCylindreSlices;++f)k[g+4*f+0]=1+2*this.nbCylindreSlices,k[g+4*f+1]=1+f+this.nbCylindreSlices,k[g+4*f+2]=1+f+this.nbCylindreSlices,
k[g+4*f+3]=1+f+1+this.nbCylindreSlices;k[12*this.nbCylindreSlices-1]=1+this.nbCylindreSlices;this.cylindreVBuffer=b.createBuffer(b.ARRAY_BUFFER);b.bindBuffer(b.ARRAY_BUFFER,this.cylindreVBuffer);b.bufferData(b.ARRAY_BUFFER,l,b.STATIC_DRAW);this.cylindreIBuffer=b.createBuffer(b.ELEMENT_ARRAY_BUFFER);b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.cylindreIBuffer);b.bufferData(b.ELEMENT_ARRAY_BUFFER,e,b.STATIC_DRAW);this.cylindreIWBuffer=b.createBuffer(b.ELEMENT_ARRAY_BUFFER);b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,
this.cylindreIWBuffer);b.bufferData(b.ELEMENT_ARRAY_BUFFER,k,b.STATIC_DRAW);this.nbCylindreFaces=e.length;this.imagesToLoad=3;l=stage.setContext(p,this);this.translationCubeMainButtonImage=new Image;this.translationCubeMainButtonImage.onload=l;this.translationCubeMainButtonImage.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABcAAAAXCAYAAADgKtSgAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAO4AAADuAB+P6onQAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAN6SURBVEiJpZVdTFtlGMd/7zmNkOGgFoR+8NXFyAiL3VCnZmOrkUUvZI0RlrFpTCRLXOaFHyFyZc7N/Eicu1mUdOzOZbhdbMWY6CSs0EHqKhbNhsNF7KAtddkSBZoYx87rhZzSclpr4nN1zv95/7/3eb8FBULTNGXqenyXLhWfELINcAKVwB0gCYwpgoCnyRXSNE3PxxD5RN++Q88i+ADB1kKdZyGiQtJ34XP/xX+Fd3V1qX+p1qPAO8WhuSERfns5r/v9/ruGphofXq9msZTfvSDg1fVGl9OOZ0szzU0P4bBXc0/XWVpaXl/lo+k/5VbHg3vPxWJBHcBiJK32xHEJz2cbntreSndnB/V1LlOlN+cTnDk3RDgSzepBdFgdiY+AN1Y7XJ1jha+MNhaLhcM9B3nGu6PodAwHx+k/dZqVlZU1UWdP4OzJYVXTNCV1Z/ks4DByr/UcZM/TO4uCATY11lNVZePb76YymhR4ujv3+tXy6oe9Qsi+7Kl45cCL/wlshLuhjthcnHgyBYAA+8Kt9IiiqNKX3bC7syMvYObGLMPBcWZuzObN71/nU1TdZ5GSzPhrnXbT4kkp+fjEAKGJSEbbtWM7bx7pQYi1ndxYX4vTUUNy4bdVI20KyAzN3VhnqmhkdCIHDDA2foVLobCprbthzS/BpYCwGUJZ2QaT4dpPP5s0gKvTMyZt48ay7N9KhX/uCgCWltImQ0VFeV74A1azvriYc7BuKyATxl9sLm4yPNe+m9LSkhyttKSEdq95q2b7BSQVECFDSCRT3JxP5Bhqqqs4+m4v2x5podJmpdXTwntaLw57tQmcWUxAwqh4ofvQbl0SNMQnH99G31uHTVUVi/ePfZJzkBQh2pTzZ06OAZOGGI5EuTgSyucvGCOjEzlgJFOeJueECtDc8lgMwctGLvrjNDablU2N9UXB31y6TP+p0+j62nshhPJS/4ljsyrA9WuTv2ze0moD8QSArutcmfyB2FycWpcDa54dE5uL8+nAZ5z/4uscMHA8MOjvh6wr949U7dsVNXE3QmTOcTgSJRyJ4nTU4G6o4/6yDSyn0/wamyeZupVvIEP33fu9NzOC7Mz/fYkWU84jwaCWuXsLvaHtQuFDCa3FseKqhL6hQf+Xpkwhi6ZpyvfTCzsVVfchaZPgAqqA2wISupRjQhAIDA5cBmQ+xt9HATR+j42bMwAAAABJRU5ErkJggg==";
this.translationCubeAxisMainButtonImage=new Image;this.translationCubeAxisMainButtonImage.onload=l;this.translationCubeAxisMainButtonImage.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAAPCAMAAAAMCGV4AAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAACLlBMVEUAAABOV2RPWWVPWGVQWWZPV2ROWGZNV2VQWWVPWGVPWGVPWGVPWGVOVmZQW2RQWGVPWWVOV2RPWGVQWGZOWGJPWGVPWGVPWGVPWGVPWGVPWGVPWGVPWGVPWGVPWGVPWGVOV2VOV2VPWGVPWGVPWGVPWGVPWGVPWGVPWGVPWGVPWGVPWGVPWGVOV2VOV2VPWGVPWGVPWGVPWGVPWGVPWGVPWGVPWGVPWGVPWGVPWGVPWGVOV2VOV2VPWGVPWGVPWGVPWGVPWGVPWGVPWGVPWGVPWGVPWGVPWGVOV2VOV2VPWGVPWGVPWGVPWGVPWGVPWGVPWGVPWGVPWGVPWGVPWGVNVmNOV2RPWGVOV2RNVmNOV2RWX2uEi5SxtbvAw8ixtbuEipNWX2tOV2ROV2RianbAw8j5+fr////5+frAw8hianZOV2RWX2vAw8jAw8hWX2tNVmOEipP4+fn+/v7a3N+6vcPa3N/+/v74+fmEipNNVmNOV2SxtbvS1NhianZNV2RianbS1NiwtLpOV2RPWGXAw8ihpq1LVWJPWGVMVWKipq3Aw8hPWGVOV2Sxtbq8wMVSWmdLVWJSWme9wMWwtLpOV2RNVmOEipP4+Pn39/ixtbuIjpextbv39/j4+fmEipNWX2vAw8j////8/f3////Aw8hWX2tOV2RianbAw8j5+fr5+fnAw8hianZOV2RWX2uEipOxtbvAw8ixtbqEipNWX2tOV2ROV2RPWGVOV2R5eDSaAAAAVXRSTlMAAAAAAAAAAAAAAAAAAAAAAAAAAAAWb8Xw/fDFbxc2u/r6vDc319c3F7u7Fm/5+W7ExO/v/Pzv78TDb/n5bhe7uhY21tc2Nrv6+rw2Fm7E8PzwxG4WSfdwgwAAAAFiS0dEZ1vT6bMAAAAJcEhZcwAAQ4MAAEODAWXQ5ycAAAAHdElNRQfjAQgKMDheA8loAAAA9ElEQVQI1yXNg1JFAQAE0M22bdu2bdzsrV62bfNl29bf1UznBw4gIamjq6dvYGhkbCIlDcjImpqZ5+Tm5QsWllZy8lCwtikoLCouKS0rr7C1U4S9Q2VVdQ3J2rp6kaMTnF0aGvmvqdnVDe4trW1s7+js6mZPb58HPPsHyMGh4ZFRcmzcC94Tk+TU9MzsHDm/4APfxSVyeWV1bZ3c2PSDv3hrmzu7e/sHPDwSAhAYdHxCnp6dkxeXwSEIDbu6vrn92+7uH0ThEVCKjHp8en55fXv/+IyOUYaKamxcvPD1/SNOSExSUwc0NJNTUtPSMzKzsrW08QtKGVHJabnS6wAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAxOS0wMS0wOFQxMDo0ODo1NiswMTowMN1ujCMAAAAldEVYdGRhdGU6bW9kaWZ5ADIwMTktMDEtMDhUMTA6NDg6NTYrMDE6MDCsMzSfAAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAAAABJRU5ErkJggg==";
this.translationCubeAxisSecondaryButtonImage=new Image;this.translationCubeAxisSecondaryButtonImage.onload=l;this.translationCubeAxisSecondaryButtonImage.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAAPCAMAAAAMCGV4AAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAACNFBMVEUAAACOl6WLlqWLlqWNlaSKlqWOlaWKlqiNlqSMlqWMlqSMlqWMlqWLlKaNmKOLlqaNlqSPl6eLlaSMlaWOmaaMlqWMlqWMlqWMlqWMlqWMlqWMlqWMlqWMlqWMlqWMlqWMlqWMlqWMlqWMlqWMlqWMlqWMlqWMlqWMlqWMlqWMlqWMlqWMlqWMlqWMlqWMlqWMlqWMlqWMlqWMlqWMlqWMlqWMlqWMlqWMlqWMlqWMlqWMlqWMlqWMlqWMlqWMlqWMlqWMlqWMlqWMlqWMlqWMlqWMlqWMlqWMlqWMlqWMlqWMlqWMlqWMlqWMlqWMlqWMlqWMlqWMlqWMlqWMlqWKlaSLlaSMlqWLlaSKlaSLlaSRmqmvtsDM0NfW2d/M0NevtsCRmqmLlaSLlaSYoa/W2d/7+/z////7+/zW2d+Yoa+LlaSRmqnW2d/W2d+RmqmKlaSvtsD7+/z+/v7n6ezS1tzn6ez+/v77+/yvtsCKlaSLlaTM0Nfi5OiZoa+LlaSZoa/i5OjM0NeLlaSMlqXW2d/Cx8+KlKOMlqWKlKPCx8/W2d+MlqWLlaTM0NfT192OmKaKlKOOmKbU193M0NeLlaSKlaSvtsD7+/v6+vvM0dexuMLM0df6+vv7+/uutcCRmqnW2d/////9/f7////W2d+RmqmLlaSYoa/W2d/7+/z7+/zW2d+Yoa+LlaSLlaSRmqmvtsDM0NfW2d/M0NevtcCRmqmLlaSKlaSLlaSMlqWLlaTAoKpjAAAAVXRSTlMAAAAAAAAAAAAAAAAAAAAAAAAAAAAWb8Xw/fDFbxc2u/r6vDc319c3F7u7Fm/5+W7ExO/v/Pzv78TDb/n5bhe7uhY21tc2Nrv6+rw2Fm7E8PzwxG4WSfdwgwAAAAFiS0dEZ1vT6bMAAAAJcEhZcwAAPsgAAD7IAcJUwa4AAAAHdElNRQfjAQgKMR/iEk1CAAAA8klEQVQI1yXNg1JAAQAEwMu2bdu2bbzsy7Zt27bNn6uZ9gcWEBHV0NTS1tHV0zcQEwckJA2NjDMys7IFE1MzKWnImFvk5OblFxQWFZdYWsnC2qa0rLyCZGVVdY2tHewdauv4r77B0QnOjU3NbGlta+9gZ1e3C1x7esm+/oHBIXJ4xA3uo2Pk+MTk1DQ5M+sBz7l5cmFxaXmFXF3zgvf6xia3tnd297h/IPjA1+/wiDw+OSXPzv0DEBh0cXl1/bfd3N7dB4dALjTs4fHp+eX17f0jPEIeCoqRUdGfX98/QkxsnJIyoKIan5CYlJySmpaupo5fXdJSPXuQnlMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTktMDEtMDhUMTA6NDk6MzErMDE6MDAxZNAUAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE5LTAxLTA4VDEwOjQ5OjMxKzAxOjAwQDloqAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAASUVORK5CYII="};
u.prototype.deallocate=function(){this.deallocateScene();this.shaders=null;b.deleteFramebuffer(this.framebuffer);b.deleteRenderbuffer(this.renderbuffer);b.deleteTexture(this.texture);b.deleteTexture(this.translationCubeMainButtonTexture);b.deleteTexture(this.translationCubeAxisMainButtonTexture);b.deleteTexture(this.translationCubeAxisSecondaryButtonTexture);b.deleteBuffer(this.coneVBuffer);b.deleteBuffer(this.coneIBuffer);b.deleteBuffer(this.coneIWBuffer);b.deleteBuffer(this.sphereVBuffer);b.deleteBuffer(this.sphereIBuffer);
b.deleteBuffer(this.sphereIWBuffer);b.deleteBuffer(this.cylindreVBuffer);b.deleteBuffer(this.cylindreIBuffer);b.deleteBuffer(this.cylindreIWBuffer);b.deleteBuffer(this.discVBuffer);b.deleteBuffer(this.discIBuffer);b.deleteBuffer(this.cubeVBuffer);b.deleteBuffer(this.cubeIBuffer);b.deleteBuffer(this.squareVBuffer);b.deleteBuffer(this.squareUVBuffer);b.deleteBuffer(this.squareIBuffer);d=b=null};u.prototype.deallocateScene=function(){if(this.scene){for(var b in this.scene.polylistInstances)k.call(this,
this.scene.polylistInstances[b]);this.scene=null;this.currentBlueColor=this.currentGreenColor=this.currentRedColor=0;this.colorsToTriangle={};this.deallocateFunctionsByPolylistInstanceId={};this.globalId=0}};u.prototype.deallocatePolylist=function(b){var d=this;b.instances.forEach(function(b){return k.call(d,b)})};var k=function(d){if(d.selectorBuffers&&d.selectorBuffers.length){for(var f=0;f<d.selectorBuffers.length;++f)b.deleteBuffer(d.selectorBuffers[f].vertices),b.deleteBuffer(d.selectorBuffers[f].colors),
d.selectorBuffers[f].normals&&b.deleteBuffer(d.selectorBuffers[f].normals);delete d.selectorBuffers;for(f=d.selectorIds.start;f<d.selectorIds.end;++f)delete this.colorsToTriangle[f];d.deallocateFunctions.splice(d.deallocateFunctions.indexOf(this.deallocateFunctionsByPolylistInstanceId[d.id]),1);this.deallocateFunctionsByPolylistInstanceId[d.id]=null}};u.prototype.setScene=function(b){this.deallocateScene();this.scene=b;for(var d in this.scene.polylistInstances)l.call(this,this.scene.polylistInstances[d])};
u.prototype.setSize=function(d,f){this.textureWidth=d=Math.max(Math.round(d/this.divisorRatio),1);this.textureHeight=f=Math.max(Math.round(f/this.divisorRatio),1);b.bindFramebuffer(b.FRAMEBUFFER,this.framebuffer);b.bindTexture(b.TEXTURE_2D,this.texture);b.texImage2D(b.TEXTURE_2D,0,b.RGBA,this.textureWidth,this.textureHeight,0,b.RGBA,b.UNSIGNED_BYTE,null);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.LINEAR);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.LINEAR);b.texParameteri(b.TEXTURE_2D,
b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE);b.bindRenderbuffer(b.RENDERBUFFER,this.renderbuffer);b.renderbufferStorage(b.RENDERBUFFER,b.DEPTH_COMPONENT16,this.textureWidth,this.textureHeight);b.bindFramebuffer(b.FRAMEBUFFER,this.framebuffer);b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,this.texture,0);b.framebufferRenderbuffer(b.FRAMEBUFFER,b.DEPTH_ATTACHMENT,b.RENDERBUFFER,this.renderbuffer);b.bindTexture(b.TEXTURE_2D,
null);b.bindRenderbuffer(b.RENDERBUFFER,null);b.bindFramebuffer(b.FRAMEBUFFER,null);this.bubbleProjMatrix=mat4.ortho(-d/2,d/2,-f/2,f/2,.5,1.5)};var l=function(d){if(!d.selectorBuffers){var f=d.matAnim.currentMaterial.coating&&(0<d.matAnim.currentMaterial.coating.furRealSize||0<d.matAnim.currentMaterial.coating.furMaxLength),e=d.polylist,g=e.geometry;d.selectorBuffers=[];d.selectorIds={start:this.globalId,end:this.globalId};for(var l=0;l<g.dataBuffers.length;++l){var m=e.list[l],q=g.dataBuffers[l],
p={colors:null,vertices:null,normals:null,count:0},n=q.faces,t=q.vertices,r=q.normals,u=[],w=q.polySize;if(2===w)return;for(var A=0,B=0;B<m.length;++B)for(var F=1;F<w-1;++F)n[w*m[B]+F]!=n[w*m[B]+F+1]&&(A+=3);q=new Float32Array(3*A);var H=new Float32Array(3*A);f&&(u=new Float32Array(3*A));for(B=A=0;B<m.length;++B){var Q=w*m[B],E=this.globalId++;this.currentRedColor=(E&255)/255;this.currentGreenColor=(E>>8&255)/255;this.currentBlueColor=(E>>16&255)/255;for(F=1;F<w-1;++F)n[Q+F]!=n[Q+F+1]&&(q[A]=t[3*
n[Q]],q[A+1]=t[3*n[Q]+1],q[A+2]=t[3*n[Q]+2],q[A+3]=t[3*n[Q+F]],q[A+4]=t[3*n[Q+F]+1],q[A+5]=t[3*n[Q+F]+2],q[A+6]=t[3*n[Q+F+1]],q[A+7]=t[3*n[Q+F+1]+1],q[A+8]=t[3*n[Q+F+1]+2],f&&(u[A]=r[3*n[Q]],u[A+1]=r[3*n[Q]+1],u[A+2]=r[3*n[Q]+2],u[A+3]=r[3*n[Q+F]],u[A+4]=r[3*n[Q+F]+1],u[A+5]=r[3*n[Q+F]+2],u[A+6]=r[3*n[Q+F+1]],u[A+7]=r[3*n[Q+F+1]+1],u[A+8]=r[3*n[Q+F+1]+2]),H[A]=this.currentRedColor,H[A+1]=this.currentGreenColor,H[A+2]=this.currentBlueColor,H[A+3]=this.currentRedColor,H[A+4]=this.currentGreenColor,
H[A+5]=this.currentBlueColor,H[A+6]=this.currentRedColor,H[A+7]=this.currentGreenColor,H[A+8]=this.currentBlueColor,A+=9);this.colorsToTriangle[E]={polylistInstance:d,bufferIndex:l,position:Q}}p.count=q.length/3;p.vertices=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,p.vertices);b.bufferData(b.ARRAY_BUFFER,q,b.STATIC_DRAW);f&&(p.normals=b.createBuffer(),b.bindBuffer(b.ARRAY_BUFFER,p.normals),b.bufferData(b.ARRAY_BUFFER,u,b.STATIC_DRAW));p.colors=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,p.colors);
b.bufferData(b.ARRAY_BUFFER,H,b.STATIC_DRAW);d.selectorBuffers.push(p)}d.selectorIds.end=this.globalId;this.deallocateFunctionsByPolylistInstanceId[d.id]=k.bind(this,d);d.deallocateFunctions.push(this.deallocateFunctionsByPolylistInstanceId[d.id])}},g=function(b){for(;b&&!b.sourceModel;)b=b.parent;return b?b.sourceModel.id:null},q=function(f,e){l.call(this,f);for(var g=0;g<f.selectorBuffers.length;++g){var h=f.selectorBuffers[g];if(!h.vertices)return;var k=f.polylist,m=f.matAnim,q=f.node;k.facesOrientation?
b.frontFace(b.CCW):b.frontFace(b.CW);e||k.doubleSided?b.disable(b.CULL_FACE):b.enable(b.CULL_FACE);b.polygonOffset(k.polygonOffsetFactor,k.polygonOffsetUnits+1);b.uniform1f(d.locations.cqcpvcg,m.computeDisplacementFactor());b.uniformMatrix4fv(d.locations.ondssmn,!1,q.modelMatrix);b.uniform1i(d.locations.rfausvd,0);b.enableVertexAttribArray(d.locations.qhsvewr);b.bindBuffer(b.ARRAY_BUFFER,h.colors);b.vertexAttribPointer(d.locations.qhsvewr,3,b.FLOAT,!1,0,0);b.enableVertexAttribArray(d.locations.ymaxekn);
b.bindBuffer(b.ARRAY_BUFFER,h.vertices);b.vertexAttribPointer(d.locations.ymaxekn,3,b.FLOAT,!1,0,0);h.normals?(b.enableVertexAttribArray(d.locations.pcgewnw),b.bindBuffer(b.ARRAY_BUFFER,h.normals),b.vertexAttribPointer(d.locations.pcgewnw,3,b.FLOAT,!1,0,0)):b.disableVertexAttribArray(d.locations.pcgewnw);b.drawArrays(b.TRIANGLES,0,h.count)}b.frontFace(b.CCW)},t=function(d){b.disable(b.BLEND);b.enable(b.DEPTH_TEST);b.enable(b.POLYGON_OFFSET_FILL);for(var f in this.scene.polylistInstances){var e=this.scene.polylistInstances[f];
e.isHidden()||q.call(this,e,d)}b.disable(b.POLYGON_OFFSET_FILL)};u.prototype.getUnderPosition=function(d,f){if(0>d.x||0>d.y)return null;d.x=Math.round(d.x);d.y=Math.round(d.y);b.enable(b.SCISSOR_TEST);var e=Math.round(d.x/this.divisorRatio),h=Math.round(this.textureHeight-d.y/this.divisorRatio);if(0>e||0>h)return b.disable(b.SCISSOR_TEST),null;b.scissor(e,h,e+1,h+1);b.bindFramebuffer(b.FRAMEBUFFER,this.framebuffer);b.viewport(0,0,this.textureWidth,this.textureHeight);b.clearColor(0,0,0,0);b.clear(b.COLOR_BUFFER_BIT|
b.DEPTH_BUFFER_BIT);b.disable(b.BLEND);t.call(this,f);f=new Uint8Array(4);b.readPixels(e,h,1,1,b.RGBA,b.UNSIGNED_BYTE,f);e=null;b.disable(b.SCISSOR_TEST);h=f[0]|f[1]<<8|f[2]<<16;255==f[3]&&(f=this.colorsToTriangle[h])&&(e=f.polylistInstance,e={node:e.node,clickedPoint:F.call(this,f,d),geometryId:e.polylist.geometry.id,polylistId:e.polylist.id,polylistInstanceId:e.id,modelSourceId:g.call(this,e.node),material:e.matAnim.getCurrentMaterial(),materialName:e.materialTree.name,materialTreeId:e.materialTree.id});
b.bindFramebuffer(b.FRAMEBUFFER,null);b.enable(b.BLEND);return e?[e]:null};u.prototype.getUnderSquare=function(d,f,e){var h=Math.min(d.x,f.x),k=Math.min(this.textureHeight-d.y,this.textureHeight-f.y),l=Math.max(d.x,f.x),m=Math.max(this.textureHeight-d.y,this.textureHeight-f.y);b.bindFramebuffer(b.FRAMEBUFFER,this.framebuffer);b.viewport(0,0,this.textureWidth,this.textureHeight);b.enable(b.SCISSOR_TEST);b.scissor(h,k,l,m);b.clearColor(0,0,0,0);b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT);b.disable(b.BLEND);
t.call(this,e);e=[];d=[];l-=h;m-=k;var q=new Uint8Array(l*m*4);b.readPixels(h,k,l,m,b.RGBA,b.UNSIGNED_BYTE,q);for(h=0;h<l;++h)for(k=0;k<m;++k){var p=[q[4*(h+k*l)],q[4*(h+k*l)+1],q[4*(h+k*l)+2],q[4*(h+k*l)+3]];var n=p[0]|p[1]<<8|p[2]<<16;255==p[3]&&(p=this.colorsToTriangle[n])&&-1===e.lastIndexOf(p.polylistInstance.id)&&(e.push(p.polylistInstance.id),n=p.polylistInstance,d.push({node:n.node,clickedPoint:F.call(this,p,f),geometryId:n.polylist.geometry.id,polylistId:n.polylist.id,polylistInstanceId:n.id,
modelSourceId:g.call(this,n.node),material:n.matAnim.getCurrentMaterial(),materialName:n.materialTree.name,materialTreeId:n.materialTree.id}))}b.disable(b.SCISSOR_TEST);b.bindFramebuffer(b.FRAMEBUFFER,null);b.enable(b.BLEND);return d.length?d:null};var r=vec3.create(),f=vec3.create(),n=vec3.create(),B=vec3.create(),w=vec3.create(),D=vec3.create(),A=vec3.create(),H=mat4.create(),e=vec3.create(),E=[0,0,0,0,0];u.prototype.getScreenRayDirection=function(b){A[0]=b.x-this.textureWidth/2;A[0]-=d.screenOffset.x*
this.textureWidth/2;A[1]=this.textureHeight/2-b.y;A[1]-=d.screenOffset.y*this.textureHeight/2;A[2]=d.cameraAdaptativeFov&&this.textureWidth<this.textureHeight?-(this.textureWidth/2)/Math.tan(.5*d.cameraFov*Math.PI/180):-(this.textureHeight/2)/Math.tan(.5*d.cameraFov*Math.PI/180);vec3.normalize(A);b=mat4.inverse(mat4.toRotationMat(d.viewMatrix,H));mat4.multiplyVec3(b,A);return A};u.prototype.getGroundPosition=function(b,g){b=this.getScreenRayDirection(b);r[0]=0;r[1]=g;r[2]=0;f[0]=1;f[1]=g;f[2]=0;n[0]=
0;n[1]=g;n[2]=1;D[0]=0;D[1]=1;D[2]=0;g=-vec3.dot(D,r,vec3.create());g=-(vec3.dot(D,d.cameraPosition)+g)/vec3.dot(D,b);vec3.add(d.cameraPosition,vec3.scale(b,g,e),E);return vec3.create(E)};var F=function(b,g,k){var h=b.polylistInstance.polylist.geometry.dataBuffers[b.bufferIndex],l=3*h.faces[b.position+0],q=3*h.faces[b.position+1],m=3*h.faces[b.position+2];r[0]=h.vertices[l];r[1]=h.vertices[l+1];r[2]=h.vertices[l+2];f[0]=h.vertices[q];f[1]=h.vertices[q+1];f[2]=h.vertices[q+2];n[0]=h.vertices[m];n[1]=
h.vertices[m+1];n[2]=h.vertices[m+2];vec3.subtract(f,r,B);vec3.subtract(n,r,w);vec3.cross(B,w,D);vec3.normalize(D);l=b.polylistInstance.node.modelMatrix;mat4.multiplyVec3(mat4.toRotationMat(l,mat4.create()),D);vec3.normalize(D);g=this.getScreenRayDirection(g);q=-vec3.dot(D,mat4.multiplyVec3(l,r,vec3.create()));q=-(vec3.dot(D,d.cameraPosition)+q)/vec3.dot(D,g);vec3.add(d.cameraPosition,vec3.scale(g,q,e),E);k||mat4.multiplyVec3(mat4.inverse(l,H),E);if(h.uvs){m=vec3.subtract(E,r,e);g=vec3.dot(B,B);l=
vec3.dot(B,w);k=vec3.dot(w,w);q=vec3.dot(m,B);m=vec3.dot(m,w);var p=g*k-l*l;k=(k*q-l*m)/p;g=(g*m-l*q)/p;l=1-k-g;q=2*h.faces[b.position+0];m=2*h.faces[b.position+1];b=2*h.faces[b.position+2];p=vec3.create([l*h.uvs[0][q],l*h.uvs[0][q+1],0]);var t=vec3.create([k*h.uvs[0][m],k*h.uvs[0][m+1],0]),v=vec3.create([g*h.uvs[0][b],g*h.uvs[0][b+1],0]);E[3]=p[0]+t[0]+v[0];E[4]=p[1]+t[1]+v[1];E[3]=l*h.uvs[0][q]+k*h.uvs[0][m]+g*h.uvs[0][b];E[4]=l*h.uvs[0][q+1]+k*h.uvs[0][m+1]+g*h.uvs[0][b+1]}return E};u.prototype.getScenePoint=
function(d){b.bindFramebuffer(b.FRAMEBUFFER,this.framebuffer);b.viewport(0,0,this.textureWidth,this.textureHeight);b.clearColor(0,0,0,0);b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT);b.disable(b.BLEND);t.call(this);var f=new Uint8Array(4),e=null;b.readPixels(d.x,this.textureHeight-d.y,1,1,b.RGBA,b.UNSIGNED_BYTE,f);var g=f[0]|f[1]<<8|f[2]<<16;255==f[3]&&(f=this.colorsToTriangle[g])&&(e={pt:F.call(this,f,d),node:f.polylistInstance.node});b.bindFramebuffer(b.FRAMEBUFFER,null);b.enable(b.BLEND);return e};
u.prototype.getScreenPosition=function(b,f,e){b=b.node?mat4.multiplyVec3(b.node.modelMatrix,b.pt,vec3.create()):vec3.create(b.pt);var g=mat4.create(d.unjitteredProjectionMatrix);mat4.multiply(g,d.viewMatrix);b=mat4.multiplyVec4(g,[b[0],b[1],b[2],1]);b[0]/=2*b[3];b[1]/=2*b[3];b[0]+=.5;b[1]+=.5;b[1]=1-b[1];f&&e?(b[0]*=f,b[1]*=e):(b[0]*=this.textureWidth,b[1]*=this.textureHeight);return{x:Math.round(b[0]),y:Math.round(b[1])}};u.prototype.getDistance=function(b,d){var f=this.scene.computeTransfMatrix(b.node);
b=mat4.multiplyVec3(f,b.pt,vec3.create());f=this.scene.computeTransfMatrix(d.node);d=mat4.multiplyVec3(f,d.pt,vec3.create());return vec3.length(vec3.subtract(b,d,vec3.create()))};u.prototype.addAnnotations=function(f,e,g,k){var h=[],l=mat4.create(),q=mat4.identity(mat4.create());mat4.multiply(q,d.unjitteredProjectionMatrix);mat4.multiply(q,d.viewMatrix);var m=[],p,n,r=(d.farPlane-d.nearPlane)/1E6;for(n=0;n<f.length;++n){var v=f[n];var u=v.modelMatrix;for(p=0;p<v.annotations.length;++p){var w=v.annotations[p];
var A=w.pos;l=mat4.identity(l);mat4.multiply(q,u,l);var B=mat4.multiplyVec3(u,[A[0],A[1],A[2]]);A=mat4.multiplyVec4(l,[A[0],A[1],A[2],1]);A[0]/=2*A[3];A[1]/=2*A[3];A[0]+=.5;A[1]+=.5;1<A[0]||0>A[0]||1<A[1]||0>A[1]?(A[1]=1-A[1],A[0]*=this.textureWidth,A[1]*=this.textureHeight,w.trueCounter&&(w.trueCounter=0),++w.falseCounter,w.falseCounter>=e&&(w.state=!1),h.push({id:w.id,x:A[0]/g,y:A[1]/g,z:k?A[2]:A[2]+1,visible:w.state,displayed:0<v.opacity,onViewport:!1})):m.push({i:p,j:n,pos3:B,pos4:A})}}if(0<m.length){b.bindFramebuffer(b.FRAMEBUFFER,
this.framebuffer);b.viewport(0,0,this.textureWidth,this.textureHeight);b.clearColor(0,0,0,0);b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT);b.disable(b.BLEND);b.disable(b.SCISSOR_TEST);t.call(this);l=new Uint8Array(4);for(q=0;q<m.length;q++)p=m[q].i,n=m[q].j,B=m[q].pos3,A=m[q].pos4,v=f[n],w=v.annotations[p],A[1]=1-A[1],A[0]*=this.textureWidth,A[1]*=this.textureHeight,b.readPixels(A[0],this.textureHeight-A[1],1,1,b.RGBA,b.UNSIGNED_BYTE,l),n=l[0]|l[1]<<8|l[2]<<16,p=!0,255==l[3]&&(n=this.colorsToTriangle[n])&&
(p=F.call(this,n,{x:A[0],y:A[1]},!0),B=vec3.length(vec3.subtract(d.cameraPosition,B,vec3.create())),p=vec3.length(vec3.subtract(d.cameraPosition,p,vec3.create())),p=B<p+r),p?null===w.state?w.state=!0:(w.falseCounter&&(w.falseCounter=0),++w.trueCounter,w.trueCounter>=e&&(w.state=!0)):null===w.state?w.state=!1:(w.trueCounter&&(w.trueCounter=0),++w.falseCounter,w.falseCounter>=e&&(w.state=!1)),h.push({id:w.id,x:A[0]/g,y:A[1]/g,z:k?A[2]:A[2]+1,visible:w.state,displayed:0<v.opacity,onViewport:!0});b.bindFramebuffer(b.FRAMEBUFFER,
null);b.enable(b.BLEND)}return h};u.prototype.trackProductNodes=function(f,e,g,k){var h={productNodes:[],placeholders:[]},l=[],q=vec3.create(),m=vec3.create(),p=[0,0,0,1],n=[0,0,0,1],t,r,v=mat4.multiply(d.unjitteredProjectionMatrix,d.viewMatrix,mat4.create()),u=!1;for(t in this.scene.productNodes){var w=this.scene.productNodes[t];for(r in w.duplicatedNodes){var A=w.duplicatedNodes[r];if(k||A.tracked||A.isPlaceholder){void 0===A.trackingTrueCounter&&(A.trackingTrueCounter=0);void 0===A.trackingFalseCounter&&
(A.trackingFalseCounter=0);pos=A.boundingBoxWithoutNodes?A.boundingBoxWithoutNodes.center:A.boundingBox.center;vec3.set(pos,q);vec3.set(pos,p);p[3]=1;mat4.multiplyVec4(v,p);p[0]/=2*p[3];p[1]/=2*p[3];p[0]+=.5;p[1]+=.5;var B=A.children.filter(function(b){return 1==b.type})[0],Q={node:A,localId:A.localId,scaling:vec3.set(A.scaling,[]),x:p[0]*this.textureWidth/e,y:(1-p[1])*this.textureHeight/e,z:g?p[2]:p[2]+1,visible:!1,displayed:0<A.opacity,onViewport:!0,position:vec3.set(A.position,[])};1<p[0]||0>p[0]||
1<p[1]||0>p[1]?(null===A.trackingState||void 0===A.trackingState?A.trackingState=!1:(A.trackingTrueCounter&&(A.trackingTrueCounter=0),++A.trackingFalseCounter,A.trackingFalseCounter>=f&&(A.trackingState=!1)),Q.visible=A.trackingState,Q.onViewport=!1):(p[1]=1-p[1],p[0]*=this.textureWidth,p[1]*=this.textureHeight,u=!0,Q.toCompute={pos3:vec3.create(q),pos4:[].concat($jscomp.arrayFromIterable(p))});B&&(pos=B.boundingBoxWithoutNodes?B.boundingBoxWithoutNodes.center:B.boundingBox.center,vec3.set(pos,m),
vec3.set(pos,n),n[3]=1,mat4.multiplyVec4(v,n),n[0]/=2*n[3],n[1]/=2*n[3],n[0]+=.5,n[1]+=.5,Q.model={x:n[0]*this.textureWidth/e,y:(1-n[1])*this.textureHeight/e,z:g?n[2]:n[2]+1,visible:!1,displayed:0<B.opacity,onViewport:!0},1<n[0]||0>n[0]||1<n[1]||0>n[1]?(n[1]=1-n[1],n[0]*=this.textureWidth,n[1]*=this.textureHeight,null===B.trackingState||void 0===B.trackingState?B.trackingState=!1:(B.trackingTrueCounter&&(B.trackingTrueCounter=0),++B.trackingFalseCounter,B.trackingFalseCounter>=f&&(B.trackingState=
!1)),Q.model.visible=B.trackingState,Q.model.onViewport=!1):(n[1]=1-n[1],n[0]*=this.textureWidth,n[1]*=this.textureHeight,u=!0,Q.sourceNodeToCompute={node:B,pos3:vec3.create(m),pos4:[].concat($jscomp.arrayFromIterable(n))}));l.push(Q)}}}if(0<l.length){new Uint8Array(4);for(e=0;e<l.length;e++)g=l[e],k=g.node,g.toCompute&&(q=g.toCompute.pos3,p=g.toCompute.pos4,null===k.trackingState||void 0===k.trackingState?k.trackingState=!0:(k.trackingFalseCounter&&(k.trackingFalseCounter=0),++k.trackingTrueCounter,
k.trackingTrueCounter>=f&&(k.trackingState=!0)),g.visible=k.trackingState),g.sourceNodeToCompute&&(q=g.sourceNodeToCompute.pos3,p=g.sourceNodeToCompute.pos4,q=g.sourceNodeToCompute.node,null===q.trackingState||void 0===q.trackingState?q.trackingState=!0:(q.trackingFalseCounter&&(q.trackingFalseCounter=0),++q.trackingTrueCounter,q.trackingTrueCounter>=f&&(q.trackingState=!0)),g.model.visible=q.trackingState),delete g.node,delete g.toCompute,delete g.sourceNodeToCompute,(k.isPlaceholder?h.placeholders:
h.productNodes).push(g);u&&(b.bindFramebuffer(b.FRAMEBUFFER,null),b.enable(b.BLEND))}return h};u.prototype.getPolylistInstanceScreenPosition=function(d,f){for(var e=d.polylist,g=e.boundingBox,h,k,l,m,p={node:d.node},n=0;n<g.vecs.length;++n){p.pt=g.vecs[n];var t=this.getScreenPosition(p);n?(h=Math.min(h,t.x),k=Math.min(k,t.y),l=Math.max(l,t.x),m=Math.max(m,t.y)):(h=l=t.x,k=m=t.y)}h=Math.min(Math.max(h,0),this.textureWidth);k=Math.min(Math.max(k,0),this.textureHeight);l=Math.min(Math.max(l,0),this.textureWidth);
m=Math.min(Math.max(m,0),this.textureHeight);g=l-h;p=m-k;b.scissor(h,this.textureHeight-m,g,p);b.enable(b.SCISSOR_TEST);b.bindFramebuffer(b.FRAMEBUFFER,this.framebuffer);b.viewport(0,0,this.textureWidth,this.textureHeight);b.clearColor(0,0,0,0);b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT);b.disable(b.BLEND);q.call(this,d,!0);d=new Uint8Array(4*g*p);b.readPixels(h,this.textureHeight-m,g,p,b.RGBA,b.UNSIGNED_BYTE,d);b.bindFramebuffer(b.FRAMEBUFFER,null);b.enable(b.BLEND);b.disable(b.SCISSOR_TEST);
var r=l,u=m,w=h,A=k;n=!1;t=function(b,d,f){r=Math.min(r,b);u=Math.min(u,d);w=Math.max(w,b);A=Math.max(A,d)};for(var B={},H={},Q=0;Q<e.geometry.dataBuffers.length;++Q){var E=e.geometry.dataBuffers[Q],D;for(D in E.uvs){for(var ea=1,oa=1,ba=0,ka=0,Z=0;Z<E.uvs[D].length/2;++Z)ea=Math.min(ea,E.uvs[D][2*Z]),oa=Math.min(oa,E.uvs[D][2*Z+1]),ba=Math.max(ba,E.uvs[D][2*Z]),ka=Math.max(ka,E.uvs[D][2*Z+1]);B[D]=[ea,oa];H[D]=[ba,ka]}}e=!1;for(D=0;D<p&&!e;++D)for(Q=0;Q<g;++Q)oa=4*((p-D-1)*g+Q),E=h+Q,ea=k+D,ba=d[oa]|
d[oa+1]<<8|d[oa+2]<<16,255==d[oa+3]&&(e=F.call(this,this.colorsToTriangle[ba],{x:E,y:ea}),t(E,ea,e),e=!0);n=n||e;e=!1;for(D=p-1;0<=D&&!e;--D)for(Q=0;Q<g;++Q)oa=4*((p-D-1)*g+Q),E=h+Q,ea=k+D,ba=d[oa]|d[oa+1]<<8|d[oa+2]<<16,255==d[oa+3]&&this.colorsToTriangle[ba]&&(e=F.call(this,this.colorsToTriangle[ba],{x:E,y:ea}),t(E,ea,e),e=!0);n=n||e;e=!1;for(D=0;D<g&&!e;++D)for(Q=0;Q<p;++Q)oa=4*(Q*g+D),E=h+D,ea=k+Q,ba=d[oa]|d[oa+1]<<8|d[oa+2]<<16,255==d[oa+3]&&this.colorsToTriangle[ba]&&(e=F.call(this,this.colorsToTriangle[ba],
{x:E,y:ea}),t(E,ea,e),e=!0);n=n||e;e=!1;for(D=g-1;0<=D&&!e;--D)for(Q=0;Q<p;++Q)oa=4*(Q*g+D),E=h+D,ea=k+Q,ba=d[oa]|d[oa+1]<<8|d[oa+2]<<16,255==d[oa+3]&&this.colorsToTriangle[ba]&&(e=F.call(this,this.colorsToTriangle[ba],{x:E,y:ea}),t(E,ea,e),e=!0);n||e||(r=h,u=k,w=l,A=m);return{minUvs:B,maxUvs:H,minScreen:[r/f,u/f],maxScreen:[w/f,A/f]}};u.prototype.getSceneScreenPosition=function(d){var f=this.textureWidth;var e=this.textureHeight;f-=0;var g=e-0;b.scissor(0,this.textureHeight-e,f,g);b.enable(b.SCISSOR_TEST);
b.bindFramebuffer(b.FRAMEBUFFER,this.framebuffer);b.viewport(0,0,this.textureWidth,this.textureHeight);b.clearColor(0,0,0,0);b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT);b.disable(b.BLEND);t.call(this,!1);var k=new Uint8Array(4*f*g);b.readPixels(0,this.textureHeight-e,f,g,b.RGBA,b.UNSIGNED_BYTE,k);b.bindFramebuffer(b.FRAMEBUFFER,null);b.enable(b.BLEND);b.disable(b.SCISSOR_TEST);e=this.textureWidth;for(var l=this.textureHeight,q=0,m=0,p=null,n=null,r=null,u=null,w=!1,A=0;A<g&&!w;++A)for(var B=0;B<
f;++B){var E=4*((g-A-1)*f+B),H=0+B,Q=0+A,D=k[E]|k[E+1]<<8|k[E+2]<<16;255==k[E+3]&&this.colorsToTriangle[D]&&(w=this.colorsToTriangle[D],w=F.call(this,w,{x:H,y:Q},!0),l=Q,n=[].concat(w).concat([B,A]),w=!0)}w=!1;for(A=g-1;0<=A&&!w;--A)for(B=0;B<f;++B)E=4*((g-A-1)*f+B),H=0+B,Q=0+A,D=k[E]|k[E+1]<<8|k[E+2]<<16,255==k[E+3]&&this.colorsToTriangle[D]&&(w=this.colorsToTriangle[D],w=F.call(this,w,{x:H,y:Q},!0),m=Q,u=[].concat(w).concat([B,A]),w=!0);w=!1;for(B=0;B<f&&!w;++B)for(A=0;A<g;++A)E=4*((g-A-1)*f+B),
H=0+B,Q=0+A,D=k[E]|k[E+1]<<8|k[E+2]<<16,255==k[E+3]&&this.colorsToTriangle[D]&&(w=this.colorsToTriangle[D],w=F.call(this,w,{x:H,y:Q},!0),e=H,p=[].concat(w).concat([B,A]),w=!0);w=!1;for(B=f-1;0<=B&&!w;--B)for(A=0;A<g;++A)E=4*((g-A-1)*f+B),H=0+B,Q=0+A,D=k[E]|k[E+1]<<8|k[E+2]<<16,255==k[E+3]&&this.colorsToTriangle[D]&&(w=this.colorsToTriangle[D],w=F.call(this,w,{x:H,y:Q},!0),q=H,r=[].concat(w).concat([B,A]),w=!0);return{minScreen:[e/d,l/d],maxScreen:[q/d,m/d],minScreenXPoint:p,minScreenYPoint:n,maxScreenXPoint:r,
maxScreenYPoint:u}};u.prototype.renderTranslationTool=function(f,e){if(f){b.disable(b.CULL_FACE);b.disable(b.DEPTH_TEST);b.disableVertexAttribArray(d.locations.pcgewnw);b.disableVertexAttribArray(d.locations.qhsvewr);b.enableVertexAttribArray(d.locations.ymaxekn);e=mat4.create();var g=vec3.length(vec3.subtract(f,d.cameraPosition,vec3.create()));vec3.length(vec3.subtract(d.cameraTarget,d.cameraPosition,vec3.create()));g=2*Math.tan(80*Math.PI/720)/b.viewportHeight*g*this.toolSize;b.uniform1i(d.locations.rfausvd,
1);b.uniform4f(d.locations.srrtdcb,0,.996,0,1);mat4.identity(e);mat4.translate(e,f);mat4.scale(e,[g,g,g]);mat4.translate(e,[0,this.arrowLength/2,0]);mat4.scale(e,[.05,this.arrowLength/2,.05]);b.uniformMatrix4fv(d.locations.ondssmn,!1,e);b.bindBuffer(b.ARRAY_BUFFER,this.cylindreVBuffer);b.vertexAttribPointer(d.locations.ymaxekn,3,b.FLOAT,!1,0,0);b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.cylindreIBuffer);b.drawElements(b.TRIANGLES,this.nbCylindreFaces,b.UNSIGNED_SHORT,0);mat4.identity(e);mat4.translate(e,
f);mat4.scale(e,[g,g,g]);mat4.translate(e,[0,1+this.arrowLength,0]);mat4.scale(e,[.5*Math.tan(Math.PI/9),1,.5*Math.tan(Math.PI/9)]);b.uniformMatrix4fv(d.locations.ondssmn,!1,e);b.bindBuffer(b.ARRAY_BUFFER,this.coneVBuffer);b.vertexAttribPointer(d.locations.ymaxekn,3,b.FLOAT,!1,0,0);b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.coneIBuffer);b.drawElements(b.TRIANGLES,this.nbConeFaces,b.UNSIGNED_SHORT,0);b.uniform4f(d.locations.srrtdcb,.996,0,0,1);mat4.identity(e);mat4.translate(e,f);mat4.scale(e,[g,g,g]);
mat4.translate(e,[this.arrowLength/2,0,0]);mat4.rotate(e,1.570796326794,[0,0,1]);mat4.scale(e,[.05,this.arrowLength/2,.05]);b.uniformMatrix4fv(d.locations.ondssmn,!1,e);b.bindBuffer(b.ARRAY_BUFFER,this.cylindreVBuffer);b.vertexAttribPointer(d.locations.ymaxekn,3,b.FLOAT,!1,0,0);b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.cylindreIBuffer);b.drawElements(b.TRIANGLES,this.nbCylindreFaces,b.UNSIGNED_SHORT,0);mat4.identity(e);mat4.translate(e,f);mat4.scale(e,[g,g,g]);mat4.translate(e,[1+this.arrowLength,
0,0]);mat4.rotate(e,-1.570796326794,[0,0,1]);mat4.scale(e,[.5*Math.tan(Math.PI/9),1,.5*Math.tan(Math.PI/9)]);b.uniformMatrix4fv(d.locations.ondssmn,!1,e);b.bindBuffer(b.ARRAY_BUFFER,this.coneVBuffer);b.vertexAttribPointer(d.locations.ymaxekn,3,b.FLOAT,!1,0,0);b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.coneIBuffer);b.drawElements(b.TRIANGLES,this.nbConeFaces,b.UNSIGNED_SHORT,0);b.uniform4f(d.locations.srrtdcb,0,0,.996,1);mat4.identity(e);mat4.translate(e,f);mat4.scale(e,[g,g,g]);mat4.translate(e,[0,
0,this.arrowLength/2]);mat4.rotate(e,1.570796326794,[1,0,0]);mat4.scale(e,[.05,this.arrowLength/2,.05]);b.uniformMatrix4fv(d.locations.ondssmn,!1,e);b.bindBuffer(b.ARRAY_BUFFER,this.cylindreVBuffer);b.vertexAttribPointer(d.locations.ymaxekn,3,b.FLOAT,!1,0,0);b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.cylindreIBuffer);b.drawElements(b.TRIANGLES,this.nbCylindreFaces,b.UNSIGNED_SHORT,0);mat4.identity(e);mat4.translate(e,f);mat4.scale(e,[g,g,g]);mat4.translate(e,[0,0,1+this.arrowLength]);mat4.rotate(e,
1.570796326794,[1,0,0]);mat4.scale(e,[.5*Math.tan(Math.PI/9),1,.5*Math.tan(Math.PI/9)]);b.uniformMatrix4fv(d.locations.ondssmn,!1,e);b.bindBuffer(b.ARRAY_BUFFER,this.coneVBuffer);b.vertexAttribPointer(d.locations.ymaxekn,3,b.FLOAT,!1,0,0);b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.coneIBuffer);b.drawElements(b.TRIANGLES,this.nbConeFaces,b.UNSIGNED_SHORT,0);mat4.identity(e);mat4.translate(e,f);mat4.scale(e,[g,g,g]);mat4.scale(e,[.5,.5,.5]);b.uniform4f(d.locations.srrtdcb,.996,.996,.996,1);b.uniformMatrix4fv(d.locations.ondssmn,
!1,e);b.bindBuffer(b.ARRAY_BUFFER,this.sphereVBuffer);b.vertexAttribPointer(d.locations.ymaxekn,3,b.FLOAT,!1,0,0);b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.sphereIBuffer);b.drawElements(b.TRIANGLES,this.nbSphereFaces,b.UNSIGNED_SHORT,0);b.enable(b.CULL_FACE);b.enable(b.DEPTH_TEST)}};u.prototype.renderTranslationCubeTool=function(f,e){if(f){this.shaders.useOneColorShader(d);e&&(b.uniformMatrix4fv(d.locations.ghgsnpw,!1,d.unjitteredProjectionMatrix),b.uniformMatrix4fv(d.locations.ampnorz,!1,d.viewMatrix));
vec3.normalize(vec3.subtract(d.cameraPosition,d.cameraTarget,vec3.create()));b.disable(b.CULL_FACE);b.disable(b.DEPTH_TEST);b.disableVertexAttribArray(d.locations.pcgewnw);b.disableVertexAttribArray(d.locations.qhsvewr);b.enableVertexAttribArray(d.locations.ymaxekn);b.uniform4f(d.locations.srrtdcb,1,1,1,1);b.bindBuffer(b.ARRAY_BUFFER,this.squareVBuffer);b.vertexAttribPointer(d.locations.ymaxekn,3,b.FLOAT,!1,0,0);b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.squareIBuffer);var g=vec3.length(vec3.subtract(f,
d.cameraPosition,vec3.create()));vec3.length(vec3.subtract(d.cameraTarget,d.cameraPosition,vec3.create()));var h=2*Math.tan(80*Math.PI/720)/b.viewportHeight*g*this.toolSize;g=mat4.create();var k=mat4.create();mat4.identity(k);mat4.translate(k,f);mat4.scale(k,[h*d.cameraFov/40,h*d.cameraFov/40,h*d.cameraFov/40]);f=mat4.toRotationMat(d.invViewMatrix);h=[.31,.345,.396,1];var l=[.549,.588,.647,1];e?b.uniform1i(d.locations.rfausvd,1):(b.lineWidth(3),mat4.set(k,g),mat4.scale(g,[.95,.95,.95]),mat4.translate(g,
[1,1,0]),b.uniformMatrix4fv(d.locations.ondssmn,!1,g),b.uniform4f(d.locations.srrtdcb,h[0],h[1],h[2],1),b.uniform1i(d.locations.rfausvd,1),b.drawElements(b.LINE_STRIP,3,b.UNSIGNED_SHORT,0),b.uniform1i(d.locations.rfausvd,2),b.uniform4f(d.locations.srrtdcb,l[0],l[1],l[2],1),b.drawElements(b.LINE_STRIP,3,b.UNSIGNED_SHORT,6),mat4.set(k,g),mat4.scale(g,[.95,.95,.95]),mat4.translate(g,[1,0,1]),mat4.rotate(g,Math.PI/2,[1,0,0]),b.uniformMatrix4fv(d.locations.ondssmn,!1,g),b.uniform4f(d.locations.srrtdcb,
h[0],h[1],h[2],1),b.uniform1i(d.locations.rfausvd,1),b.drawElements(b.LINE_STRIP,3,b.UNSIGNED_SHORT,0),b.uniform4f(d.locations.srrtdcb,l[0],l[1],l[2],1),b.uniform1i(d.locations.rfausvd,2),b.drawElements(b.LINE_STRIP,3,b.UNSIGNED_SHORT,6),mat4.set(k,g),mat4.scale(g,[.95,.95,.95]),mat4.translate(g,[0,1,1]),mat4.rotate(g,-Math.PI/2,[0,1,0]),b.uniformMatrix4fv(d.locations.ondssmn,!1,g),b.uniform4f(d.locations.srrtdcb,h[0],h[1],h[2],1),b.uniform1i(d.locations.rfausvd,1),b.drawElements(b.LINE_STRIP,3,b.UNSIGNED_SHORT,
0),b.uniform4f(d.locations.srrtdcb,l[0],l[1],l[2],1),b.uniform1i(d.locations.rfausvd,2),b.drawElements(b.LINE_STRIP,3,b.UNSIGNED_SHORT,6),this.shaders.useFramerateShader(d),b.uniform1f(d.locations.mnxuvqf,-1),b.uniform1i(d.locations.dkgckvl,0),b.uniformMatrix4fv(d.locations.ghgsnpw,!1,d.unjitteredProjectionMatrix),b.uniformMatrix4fv(d.locations.ampnorz,!1,d.viewMatrix),b.enableVertexAttribArray(d.locations.aUv[0]),b.bindBuffer(b.ARRAY_BUFFER,this.squareUVBuffer),b.vertexAttribPointer(d.locations.aUv[0],
2,b.FLOAT,!1,0,0),b.uniform4f(d.locations.srrtdcb,1,1,1,0));e?b.uniform4f(d.locations.srrtdcb,1,1,1,1):(b.activeTexture(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,this.translationCubeMainButtonTexture));mat4.set(k,g);mat4.multiply(g,f);var q=.2738;mat4.scale(g,[q,q,q]);b.uniformMatrix4fv(d.locations.ondssmn,!1,g);b.drawElements(b.TRIANGLES,this.nbSquareFaces,b.UNSIGNED_SHORT,0);e?b.uniform4f(d.locations.srrtdcb,1,0,0,1):(b.uniform4f(d.locations.srrtdcb,h[0],h[1],h[2],0),b.activeTexture(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,
this.translationCubeAxisMainButtonTexture));q=.16667;mat4.set(k,g);mat4.translate(g,[1.9,0,0]);mat4.multiply(g,f);mat4.scale(g,[q,q,q]);b.uniformMatrix4fv(d.locations.ondssmn,!1,g);b.drawElements(b.TRIANGLES,this.nbSquareFaces,b.UNSIGNED_SHORT,0);e&&b.uniform4f(d.locations.srrtdcb,0,1,0,1);mat4.set(k,g);mat4.translate(g,[0,1.9,0]);mat4.multiply(g,f);mat4.scale(g,[q,q,q]);b.uniformMatrix4fv(d.locations.ondssmn,!1,g);b.drawElements(b.TRIANGLES,this.nbSquareFaces,b.UNSIGNED_SHORT,0);e&&b.uniform4f(d.locations.srrtdcb,
0,0,1,1);mat4.set(k,g);mat4.translate(g,[0,0,1.9]);mat4.multiply(g,f);mat4.scale(g,[q,q,q]);b.uniformMatrix4fv(d.locations.ondssmn,!1,g);b.drawElements(b.TRIANGLES,this.nbSquareFaces,b.UNSIGNED_SHORT,0);e?b.uniform4f(d.locations.srrtdcb,1,1,0,1):(b.uniform4f(d.locations.srrtdcb,l[0],l[1],l[2],0),b.activeTexture(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,this.translationCubeAxisSecondaryButtonTexture));mat4.set(k,g);mat4.translate(g,[1.9,1.9,0]);mat4.multiply(g,f);mat4.scale(g,[q,q,q]);b.uniformMatrix4fv(d.locations.ondssmn,
!1,g);b.drawElements(b.TRIANGLES,this.nbSquareFaces,b.UNSIGNED_SHORT,0);e&&b.uniform4f(d.locations.srrtdcb,0,1,1,1);mat4.set(k,g);mat4.translate(g,[0,1.9,1.9]);mat4.multiply(g,f);mat4.scale(g,[q,q,q]);b.uniformMatrix4fv(d.locations.ondssmn,!1,g);b.drawElements(b.TRIANGLES,this.nbSquareFaces,b.UNSIGNED_SHORT,0);e&&b.uniform4f(d.locations.srrtdcb,1,0,1,1);mat4.set(k,g);mat4.translate(g,[1.9,0,1.9]);mat4.multiply(g,f);mat4.scale(g,[q,q,q]);b.uniformMatrix4fv(d.locations.ondssmn,!1,g);b.drawElements(b.TRIANGLES,
this.nbSquareFaces,b.UNSIGNED_SHORT,0);b.lineWidth(1);b.enable(b.CULL_FACE);b.enable(b.DEPTH_TEST)}};u.prototype.renderScalingTool=function(f,e){if(f){b.disable(b.CULL_FACE);b.disable(b.DEPTH_TEST);b.disableVertexAttribArray(d.locations.pcgewnw);b.disableVertexAttribArray(d.locations.qhsvewr);b.enableVertexAttribArray(d.locations.ymaxekn);var g=mat4.create(),h=vec3.length(vec3.subtract(f,d.cameraPosition,vec3.create()));vec3.length(vec3.subtract(d.cameraTarget,d.cameraPosition,vec3.create()));h=2*
Math.tan(80*Math.PI/720)/b.viewportHeight*h*this.toolSize;b.uniform1i(d.locations.rfausvd,1);b.uniform4f(d.locations.srrtdcb,0,1,0,1);mat4.identity(g);mat4.translate(g,f);mat4.scale(g,[h,h,h]);mat4.translate(g,[0,this.arrowLength/2,0]);mat4.scale(g,[.05,this.arrowLength/2,.05]);b.uniformMatrix4fv(d.locations.ondssmn,!1,g);b.bindBuffer(b.ARRAY_BUFFER,this.cylindreVBuffer);b.vertexAttribPointer(d.locations.ymaxekn,3,b.FLOAT,!1,0,0);b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.cylindreIBuffer);b.drawElements(b.TRIANGLES,
this.nbCylindreFaces,b.UNSIGNED_SHORT,0);mat4.identity(g);mat4.translate(g,f);mat4.scale(g,[h,h,h]);mat4.translate(g,[0,.25+this.arrowLength,0]);mat4.scale(g,[.25,.25,.25]);b.uniformMatrix4fv(d.locations.ondssmn,!1,g);b.bindBuffer(b.ARRAY_BUFFER,this.cubeVBuffer);b.vertexAttribPointer(d.locations.ymaxekn,3,b.FLOAT,!1,0,0);b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.cubeIBuffer);b.drawElements(b.TRIANGLES,this.nbCubeFaces,b.UNSIGNED_SHORT,0);b.uniform4f(d.locations.srrtdcb,1,0,0,1);mat4.identity(g);mat4.translate(g,
f);mat4.scale(g,[h,h,h]);mat4.translate(g,[this.arrowLength/2,0,0]);mat4.rotate(g,1.570796326794,[0,0,1]);mat4.scale(g,[.05,this.arrowLength/2,.05]);b.uniformMatrix4fv(d.locations.ondssmn,!1,g);b.bindBuffer(b.ARRAY_BUFFER,this.cylindreVBuffer);b.vertexAttribPointer(d.locations.ymaxekn,3,b.FLOAT,!1,0,0);b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.cylindreIBuffer);b.drawElements(b.TRIANGLES,this.nbCylindreFaces,b.UNSIGNED_SHORT,0);mat4.identity(g);mat4.translate(g,f);mat4.scale(g,[h,h,h]);mat4.translate(g,
[.25+this.arrowLength,0,0]);mat4.rotate(g,-1.570796326794,[0,0,1]);mat4.scale(g,[.25,.25,.25]);b.uniformMatrix4fv(d.locations.ondssmn,!1,g);b.bindBuffer(b.ARRAY_BUFFER,this.cubeVBuffer);b.vertexAttribPointer(d.locations.ymaxekn,3,b.FLOAT,!1,0,0);b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.cubeIBuffer);b.drawElements(b.TRIANGLES,this.nbCubeFaces,b.UNSIGNED_SHORT,0);b.uniform4f(d.locations.srrtdcb,0,0,1,1);mat4.identity(g);mat4.translate(g,f);mat4.scale(g,[h,h,h]);mat4.translate(g,[0,0,this.arrowLength/
2]);mat4.rotate(g,1.570796326794,[1,0,0]);mat4.scale(g,[.05,this.arrowLength/2,.05]);b.uniformMatrix4fv(d.locations.ondssmn,!1,g);b.bindBuffer(b.ARRAY_BUFFER,this.cylindreVBuffer);b.vertexAttribPointer(d.locations.ymaxekn,3,b.FLOAT,!1,0,0);b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.cylindreIBuffer);b.drawElements(b.TRIANGLES,this.nbCylindreFaces,b.UNSIGNED_SHORT,0);mat4.identity(g);mat4.translate(g,f);mat4.scale(g,[h,h,h]);mat4.translate(g,[0,0,.25+this.arrowLength]);mat4.rotate(g,1.570796326794,[1,
0,0]);mat4.scale(g,[.25,.25,.25]);b.uniformMatrix4fv(d.locations.ondssmn,!1,g);b.bindBuffer(b.ARRAY_BUFFER,this.cubeVBuffer);b.vertexAttribPointer(d.locations.ymaxekn,3,b.FLOAT,!1,0,0);b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.cubeIBuffer);b.drawElements(b.TRIANGLES,this.nbCubeFaces,b.UNSIGNED_SHORT,0);mat4.identity(g);mat4.translate(g,f);mat4.scale(g,[h,h,h]);mat4.scale(g,[.5,.5,.5]);b.uniform4f(d.locations.srrtdcb,1,1,1,1);b.uniformMatrix4fv(d.locations.ondssmn,!1,g);b.bindBuffer(b.ARRAY_BUFFER,
this.sphereVBuffer);b.vertexAttribPointer(d.locations.ymaxekn,3,b.FLOAT,!1,0,0);b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.sphereIBuffer);b.drawElements(b.TRIANGLES,this.nbSphereFaces,b.UNSIGNED_SHORT,0);b.enable(b.CULL_FACE);b.enable(b.DEPTH_TEST);this.toolSize/=1.5;this.renderTranslationTool(f,e);this.toolSize*=1.5}};u.prototype.renderRotationTool=function(f,e){if(f){this.toolSize/=1.5;this.renderTranslationTool(f,e);this.toolSize*=1.5;var g=vec3.normalize(vec3.subtract(d.cameraPosition,d.cameraTarget,
vec3.create()));b.disable(b.CULL_FACE);b.disable(b.DEPTH_TEST);b.disableVertexAttribArray(d.locations.pcgewnw);b.disableVertexAttribArray(d.locations.qhsvewr);b.enableVertexAttribArray(d.locations.ymaxekn);e=mat4.create();var h=vec3.length(vec3.subtract(f,d.cameraPosition,vec3.create()));vec3.length(vec3.subtract(d.cameraTarget,d.cameraPosition,vec3.create()));h=2*Math.tan(80*Math.PI/720)/b.viewportHeight*h*this.toolSize;mat4.identity(e);mat4.translate(e,f);mat4.scale(e,[h,h,h]);b.colorMask(!1,!1,
!1,!1);mat4.scale(e,[2,2,2]);b.enable(b.POLYGON_OFFSET_FILL);b.polygonOffset(20,20);b.depthFunc(b.LEQUAL);b.uniform4f(d.locations.srrtdcb,1,1,1,1);b.uniformMatrix4fv(d.locations.ondssmn,!1,e);b.bindBuffer(b.ARRAY_BUFFER,this.sphereVBuffer);b.vertexAttribPointer(d.locations.ymaxekn,3,b.FLOAT,!1,0,0);b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.sphereIBuffer);b.drawElements(b.TRIANGLES,this.nbSphereFaces,b.UNSIGNED_SHORT,0);b.colorMask(!0,!0,!0,!0);b.disable(b.POLYGON_OFFSET_FILL);b.uniform1i(d.locations.rfausvd,
1);b.uniform4f(d.locations.srrtdcb,0,1,0,1);mat4.identity(e);mat4.translate(e,f);mat4.scale(e,[h,h,h]);mat4.scale(e,[2,2,2]);b.lineWidth(8);b.uniformMatrix4fv(d.locations.ondssmn,!1,e);b.bindBuffer(b.ARRAY_BUFFER,this.discVBuffer);b.vertexAttribPointer(d.locations.ymaxekn,3,b.FLOAT,!1,0,0);b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.discIBuffer);b.drawElements(b.LINE_LOOP,this.nbDiscFaces,b.UNSIGNED_SHORT,0);b.uniform4f(d.locations.srrtdcb,1,0,0,1);mat4.identity(e);mat4.translate(e,f);mat4.scale(e,[h,
h,h]);mat4.rotate(e,1.57079632,[0,0,1]);mat4.scale(e,[2,2,2]);b.uniformMatrix4fv(d.locations.ondssmn,!1,e);b.bindBuffer(b.ARRAY_BUFFER,this.discVBuffer);b.vertexAttribPointer(d.locations.ymaxekn,3,b.FLOAT,!1,0,0);b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.discIBuffer);b.drawElements(b.LINE_LOOP,this.nbDiscFaces,b.UNSIGNED_SHORT,0);b.uniform4f(d.locations.srrtdcb,0,0,1,1);mat4.identity(e);mat4.translate(e,f);mat4.scale(e,[h,h,h]);mat4.rotate(e,1.57079632,[1,0,0]);mat4.scale(e,[2,2,2]);b.uniformMatrix4fv(d.locations.ondssmn,
!1,e);b.bindBuffer(b.ARRAY_BUFFER,this.discVBuffer);b.vertexAttribPointer(d.locations.ymaxekn,3,b.FLOAT,!1,0,0);b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.discIBuffer);b.drawElements(b.LINE_LOOP,this.nbDiscFaces,b.UNSIGNED_SHORT,0);b.uniform4f(d.locations.srrtdcb,1,1,1,1);mat4.identity(e);mat4.translate(e,f);mat4.scale(e,[h,h,h]);f=vec3.cross(g,d.cameraUp,vec3.create());g=Math.asin(g[1]);0<d.cameraUp[1]?mat4.rotate(e,1.57079632+g,f):mat4.rotate(e,1.57079632-g,f);mat4.scale(e,[1.2,1.2,1.2]);mat4.scale(e,
[2,2,2]);b.uniformMatrix4fv(d.locations.ondssmn,!1,e);b.bindBuffer(b.ARRAY_BUFFER,this.discVBuffer);b.vertexAttribPointer(d.locations.ymaxekn,3,b.FLOAT,!1,0,0);b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.discIBuffer);b.drawElements(b.LINE_LOOP,this.nbDiscFaces,b.UNSIGNED_SHORT,0);b.depthFunc(b.LESS);b.lineWidth(1);b.enable(b.CULL_FACE);b.enable(b.DEPTH_TEST)}};u.prototype.renderButton=function(f,e,g,k){if(g){e*=d.cameraFov/40;k?this.shaders.useOneColorShader(d):this.shaders.useFramerateShader(d);b.uniformMatrix4fv(d.locations.ghgsnpw,
!1,d.unjitteredProjectionMatrix);b.uniformMatrix4fv(d.locations.ampnorz,!1,d.viewMatrix);vec3.normalize(vec3.subtract(d.cameraPosition,d.cameraTarget,vec3.create()));b.disable(b.CULL_FACE);b.disable(b.DEPTH_TEST);b.bindBuffer(b.ARRAY_BUFFER,this.squareVBuffer);b.vertexAttribPointer(d.locations.ymaxekn,3,b.FLOAT,!1,0,0);b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.squareIBuffer);var h=vec3.length(vec3.subtract(g,d.cameraPosition,vec3.create()));vec3.length(vec3.subtract(d.cameraTarget,d.cameraPosition,
vec3.create()));var l=2*Math.tan(80*Math.PI/720)/b.viewportHeight*h*this.toolSize;h=mat4.create();var q=mat4.create();mat4.identity(q);mat4.translate(q,g);mat4.scale(q,[l,l,l]);g=mat4.toRotationMat(d.invViewMatrix);k?(b.uniform1i(d.locations.rfausvd,1),b.uniform4f(d.locations.srrtdcb,1,1,1,1)):(b.bindBuffer(b.ARRAY_BUFFER,this.squareUVBuffer),b.vertexAttribPointer(d.locations.aUv[0],2,b.FLOAT,!1,0,0),b.uniform1f(d.locations.mnxuvqf,-1),b.uniform4f(d.locations.srrtdcb,1,1,1,0),b.activeTexture(b.TEXTURE0),
b.bindTexture(b.TEXTURE_2D,f));mat4.set(q,h);mat4.multiply(h,g);f=.5*e/42;mat4.scale(h,[f,f,f]);b.uniformMatrix4fv(d.locations.ondssmn,!1,h);b.drawElements(b.TRIANGLES,this.nbSquareFaces,b.UNSIGNED_SHORT,0);b.enable(b.DEPTH_TEST);b.enable(b.CULL_FACE)}};u.prototype.renderRectangleButton=function(f,e,g,k,l){if(k){l?this.shaders.useOneColorShader(d):this.shaders.useFramerateShader(d);e*=d.cameraFov/40;g*=d.cameraFov/40;b.uniformMatrix4fv(d.locations.ghgsnpw,!1,d.unjitteredProjectionMatrix);b.uniformMatrix4fv(d.locations.ampnorz,
!1,d.viewMatrix);vec3.normalize(vec3.subtract(d.cameraPosition,d.cameraTarget,vec3.create()));b.disable(b.CULL_FACE);b.disable(b.DEPTH_TEST);b.bindBuffer(b.ARRAY_BUFFER,this.squareVBuffer);b.vertexAttribPointer(d.locations.ymaxekn,3,b.FLOAT,!1,0,0);b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.squareIBuffer);var h=vec3.length(vec3.subtract(k,d.cameraPosition,vec3.create()));vec3.length(vec3.subtract(d.cameraTarget,d.cameraPosition,vec3.create()));var q=2*Math.tan(80*Math.PI/720)/b.viewportHeight*h*this.toolSize;
h=mat4.create();var m=mat4.create();mat4.identity(m);mat4.translate(m,k);mat4.scale(m,[q,q,q]);k=mat4.toRotationMat(d.invViewMatrix);l?(b.uniform1i(d.locations.rfausvd,1),b.uniform4f(d.locations.srrtdcb,1,1,1,1)):(b.bindBuffer(b.ARRAY_BUFFER,this.squareUVBuffer),b.vertexAttribPointer(d.locations.aUv[0],2,b.FLOAT,!1,0,0),b.uniform1f(d.locations.mnxuvqf,-1),b.uniform4f(d.locations.srrtdcb,1,1,1,0),b.activeTexture(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,f));mat4.set(m,h);mat4.multiply(h,k);mat4.scale(h,
[.5*e/42,.5*g/42,1]);b.uniformMatrix4fv(d.locations.ondssmn,!1,h);b.drawElements(b.TRIANGLES,this.nbSquareFaces,b.UNSIGNED_SHORT,0);b.enable(b.DEPTH_TEST);b.enable(b.CULL_FACE)}};u.prototype.getTranslation=function(d,f){if(0>d.w||0>d.y||!f)return null;b.enable(b.SCISSOR_TEST);var e=d.x/this.divisorRatio,g=this.textureHeight-d.y/this.divisorRatio;if(0>e||0>g)return null;b.scissor(e,g,e+1,g+1);b.bindFramebuffer(b.FRAMEBUFFER,this.framebuffer);b.viewport(0,0,this.textureWidth,this.textureHeight);b.clearColor(0,
0,0,0);b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT);b.disable(b.BLEND);this.renderTranslationTool(f,!0);f=new Uint8Array(4);b.readPixels(d.x/this.divisorRatio,this.textureHeight-d.y/this.divisorRatio,1,1,b.RGBA,b.UNSIGNED_BYTE,f);d=null;b.disable(b.SCISSOR_TEST);f[3]&&(d={axis:[f[0]?1:0,f[1]?1:0,f[2]?1:0]});b.bindFramebuffer(b.FRAMEBUFFER,null);b.enable(b.BLEND);return d};u.prototype.getTranslationFromCube=function(d,f){if(0>d.w||0>d.y||!f)return null;b.enable(b.SCISSOR_TEST);var e=d.x/this.divisorRatio,
g=this.textureHeight-d.y/this.divisorRatio;if(0>e||0>g)return null;b.scissor(e,g,e+1,g+1);b.bindFramebuffer(b.FRAMEBUFFER,this.framebuffer);b.viewport(0,0,this.textureWidth,this.textureHeight);b.clearColor(0,0,0,0);b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT);b.disable(b.BLEND);this.renderTranslationCubeTool(f,!0);f=new Uint8Array(4);b.readPixels(d.x/this.divisorRatio,this.textureHeight-d.y/this.divisorRatio,1,1,b.RGBA,b.UNSIGNED_BYTE,f);d=null;b.disable(b.SCISSOR_TEST);f[3]&&(d={axis:[f[0]?1:0,
f[1]?1:0,f[2]?1:0]});b.bindFramebuffer(b.FRAMEBUFFER,null);b.enable(b.BLEND);return d};u.prototype.getScaling=function(f,e){if(0>f.w||0>f.y||!e)return null;b.enable(b.SCISSOR_TEST);var g=f.x/this.divisorRatio,h=this.textureHeight-f.y/this.divisorRatio;if(0>g||0>h)return null;b.scissor(g,h,g+1,h+1);b.bindFramebuffer(b.FRAMEBUFFER,this.framebuffer);b.viewport(0,0,this.textureWidth,this.textureHeight);b.clearColor(0,0,0,0);b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT);b.disable(b.BLEND);this.renderScalingTool(e,
!0);h=new Uint8Array(4);b.readPixels(f.x/this.divisorRatio,this.textureHeight-f.y/this.divisorRatio,1,1,b.RGBA,b.UNSIGNED_BYTE,h);g=null;b.disable(b.SCISSOR_TEST);h[3]&&(h[0]&&h[1]&&h[2]?g=254===h[0]?{move:!0,axis:[1,1,1]}:{axis:[1,1,1]}:h[0]?g=254===h[0]?{move:!0,axis:[1,0,0]}:{axis:[1,0,0]}:h[1]?g=254===h[1]?{move:!0,axis:[0,1,0]}:{axis:[0,1,0]}:h[2]&&(g=254===h[2]?{move:!0,axis:[0,0,1]}:{axis:[0,0,1]}));b.bindFramebuffer(b.FRAMEBUFFER,null);b.enable(b.BLEND);if(g){h=vec3.create(e);var k=mat4.create(d.unjitteredProjectionMatrix);
mat4.multiply(k,d.viewMatrix);h=mat4.multiplyVec4(k,[h[0],h[1],h[2],1]);h[0]/=2*h[3];h[1]/=2*h[3];h[0]+=.5;h[1]+=.5;h[1]=1-h[1];h[0]*=this.textureWidth;h[1]*=this.textureHeight;g.centerPoint=vec3.create([h[0],h[1],0]);g.toolPosition=vec3.create(e);g.prevMousePos=vec3.create([f.x,f.y,0])}return g};u.prototype.getRotation=function(f,e,g,k){if(0>f.w||0>f.y||!e)return null;b.enable(b.SCISSOR_TEST);var h=f.x/this.divisorRatio,l=this.textureHeight-f.y/this.divisorRatio;if(0>h||0>l)return null;b.scissor(h,
l,h+1,l+1);b.bindFramebuffer(b.FRAMEBUFFER,this.framebuffer);b.viewport(0,0,this.textureWidth,this.textureHeight);b.clearColor(0,0,0,0);b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT);b.disable(b.BLEND);this.renderRotationTool(e,g,k,!0);h=new Uint8Array(4);b.readPixels(f.x/this.divisorRatio,this.textureHeight-f.y/this.divisorRatio,1,1,b.RGBA,b.UNSIGNED_BYTE,h);k=null;b.disable(b.SCISSOR_TEST);h[3]&&(h[0]&&h[1]&&h[2]?k=254===h[0]?{move:!0,axis:[1,1,1]}:{axis:vec3.create(g)}:h[0]?k=254===h[0]?{move:!0,
axis:[1,0,0]}:{axis:[0<g[0]?1:-1,0,0]}:h[1]?k=254===h[1]?{move:!0,axis:[0,1,0]}:{axis:[0,0<g[1]?1:-1,0]}:h[2]&&(k=254===h[2]?{move:!0,axis:[0,0,1]}:{axis:[0,0,0<g[2]?1:-1]}));b.bindFramebuffer(b.FRAMEBUFFER,null);b.enable(b.BLEND);k&&(g=vec3.create(e),h=mat4.create(d.unjitteredProjectionMatrix),mat4.multiply(h,d.viewMatrix),g=mat4.multiplyVec4(h,[g[0],g[1],g[2],1]),g[0]/=2*g[3],g[1]/=2*g[3],g[0]+=.5,g[1]+=.5,g[1]=1-g[1],g[0]*=this.textureWidth,g[1]*=this.textureHeight,k.centerPoint=vec3.create([g[0],
g[1],0]),k.prevMousePos=vec3.create([f.x,f.y,0]),k.toolPosition=vec3.create(e));return k};u.prototype.getTransformationFromButton=function(d,f,e){if(0>f.w||0>f.y||!e)return null;b.enable(b.SCISSOR_TEST);var g=f.x/this.divisorRatio,h=this.textureHeight-f.y/this.divisorRatio;if(0>g||0>h)return null;b.scissor(g,h,g+1,h+1);b.bindFramebuffer(b.FRAMEBUFFER,this.framebuffer);b.viewport(0,0,this.textureWidth,this.textureHeight);b.clearColor(0,0,0,0);b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT);b.disable(b.BLEND);
this.renderButton(null,d,e,!0);d=new Uint8Array(4);b.readPixels(f.x/this.divisorRatio,this.textureHeight-f.y/this.divisorRatio,1,1,b.RGBA,b.UNSIGNED_BYTE,d);f=null;b.disable(b.SCISSOR_TEST);d[3]&&(f={axis:[d[0]?1:0,d[1]?1:0,d[2]?1:0]});b.bindFramebuffer(b.FRAMEBUFFER,null);b.enable(b.BLEND);return f};u.prototype.getTransformationFromRectangleButton=function(d,f,e,g){if(0>e.w||0>e.y||!g)return null;b.enable(b.SCISSOR_TEST);var h=e.x/this.divisorRatio,k=this.textureHeight-e.y/this.divisorRatio;if(0>
h||0>k)return null;b.scissor(h,k,h+1,k+1);b.bindFramebuffer(b.FRAMEBUFFER,this.framebuffer);b.viewport(0,0,this.textureWidth,this.textureHeight);b.clearColor(0,0,0,0);b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT);b.disable(b.BLEND);this.renderRectangleButton(null,d,f,g,!0);d=new Uint8Array(4);b.readPixels(e.x/this.divisorRatio,this.textureHeight-e.y/this.divisorRatio,1,1,b.RGBA,b.UNSIGNED_BYTE,d);e=null;b.disable(b.SCISSOR_TEST);d[3]&&(e={axis:[d[0]?1:0,d[1]?1:0,d[2]?1:0]});b.bindFramebuffer(b.FRAMEBUFFER,
null);b.enable(b.BLEND);return e};var p=function(){--this.imagesToLoad||(this.translationCubeMainButtonTexture=b.createTexture(),b.bindTexture(b.TEXTURE_2D,this.translationCubeMainButtonTexture),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.LINEAR),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.LINEAR),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE),b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,this.translationCubeMainButtonImage),
this.translationCubeAxisMainButtonTexture=b.createTexture(),b.bindTexture(b.TEXTURE_2D,this.translationCubeAxisMainButtonTexture),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.LINEAR),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.LINEAR),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE),b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,this.translationCubeAxisMainButtonImage),this.translationCubeAxisSecondaryButtonTexture=
b.createTexture(),b.bindTexture(b.TEXTURE_2D,this.translationCubeAxisSecondaryButtonTexture),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.LINEAR),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.LINEAR),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE),b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,this.translationCubeAxisSecondaryButtonImage),b.bindTexture(b.TEXTURE_2D,null))};u.prototype.renderPolylists=
function(d,f,e){d={};for(var g in this.scene.polylists)f=this.scene.polylists[g],d[f.id]=f.isHidden,f.isHidden=-1===e.indexOf(f.id);b.bindFramebuffer(b.FRAMEBUFFER,this.framebuffer);b.viewport(0,0,this.textureWidth,this.textureHeight);b.clearColor(0,0,0,0);b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT);b.disable(b.BLEND);mat4.identity(mat4.create());t.call(this,!1,!0);f=new Uint8Array(4*this.textureWidth*this.textureHeight);b.readPixels(0,0,this.textureWidth,this.textureHeight,b.RGBA,b.UNSIGNED_BYTE,
f);e=new Uint32Array(this.textureWidth*this.textureHeight);for(g=0;g<this.textureWidth*this.textureHeight;++g){var h=[f[4*g],f[4*g+1],f[4*g+2],f[4*g+3]],k=h[0]|h[1]<<8|h[2]<<16;255==h[3]&&this.colorsToTriangle[k]&&(info=this.colorsToTriangle[k],e[g]=info?info.polylistInstance.polylist.id:0)}for(g in this.scene.polylists)f=this.scene.polylists[g],f.isHidden=d[f.id];return e};return u});stage.provide("emersya.viewer.modules.renderer.subdivisionManager");
stage.register.call(stage.emersya.viewer.modules.renderer,"subdivisionManager",function(){var b=function(b,d,k){this.vertices=b;this.edges=d;this.uvs=[];this.uvsEdges=[];this.neighbours=[];this.facePoint=k;this.facePointUv=[];for(var g in this.vertices)this.vertices[g].updateFace(this);for(g in this.edges)this.edges[g].updateFace(this);this.facePoint.updatePosFromFace(this.vertices)};b.prototype.updateUvs=function(b,d,k){this.uvs=b;this.uvsEdges=d;this.facePointUv=k;for(var g in this.uvs)this.uvs[g].updateFace(this);
for(g in this.uvsEdges)this.uvsEdges[g].updateFaceNN(this);this.facePointUv.updatePosFromFace(this.uvs)};b.prototype.updateNeighbours=function(b){-1===this.neighbours.indexOf(b)&&this.neighbours.push(b)};var d=function(b){this.pos=vec3.create();this.edges=[];this.faces=[];this.index=b};d.prototype.updateFace=function(b){-1===this.faces.indexOf(b)&&this.faces.push(b)};d.prototype.updateEdge=function(b){-1===this.edges.indexOf(b)&&this.edges.push(b)};d.prototype.updatePosFromFace=function(b){this.pos=
vec3.create([0,0,0]);for(var d in b)vec3.add(this.pos,b[d].pos);vec3.scale(this.pos,1/b.length)};d.prototype.updatePosFromEdge=function(b,d,k,t){vec3.add(b.pos,d.pos,this.pos);t?(vec3.add(this.pos,k.pos),vec3.add(this.pos,t.pos),vec3.scale(this.pos,.25)):vec3.scale(this.pos,.5)};d.prototype.clearFacesAndEdges=function(){this.faces=[];this.edges=[]};d.prototype.computeNormalFromFaces=function(){for(var b=vec3.create(),d=0;d<this.faces.length;++d){var k=vec3.subtract(this.faces[d].vertices[1].pos,this.faces[d].vertices[0].pos,
vec3.create()),t=vec3.subtract(this.faces[d].vertices[2].pos,this.faces[d].vertices[1].pos,vec3.create());vec3.add(b,vec3.cross(k,t,vec3.create()))}vec3.normalize(b);return b};var u=function(b,d,k){this.vertices=[b,d];this.faces=[];this.edgePoint=k};u.prototype.updateFace=function(b){-1===this.faces.indexOf(b)&&this.faces.push(b);2===this.faces.length&&(b.updateNeighbours(this.faces[0]),this.faces[0].updateNeighbours(b))};u.prototype.updateFaceNN=function(b){-1===this.faces.indexOf(b)&&this.faces.push(b);
return 2<this.faces.length?!0:!1};u.prototype.computeEdgePoint=function(){this.edgePoint.updatePosFromEdge(this.vertices[0],this.vertices[1],this.faces[0].facePoint,this.faces[1]?this.faces[1].facePoint:null)};u.prototype.computeEdgePointUv=function(){this.edgePoint.updatePosFromEdge(this.vertices[0],this.vertices[1],this.faces[0].facePointUv,this.faces[1]?this.faces[1].facePointUv:null)};var k=function(b){this.vertices=[];this.verticesTable={};this.edges=[];this.edgesTable=[];this.uvsIndices=!1;
this.uvs=[];this.uvsTable={};this.edgesUvs=[];this.edgesUvsTable=[];this.faces=[];this.nbVertices=0;this.nbUvs=[];this.mergedNbVertices=this.initNbVertices=0;this.writeUvs=b;this.mergeInitialUvs=!0};k.prototype.createOrGetVertex=function(b,g){if(void 0===this.vertices[g]){var k=b.vertices[3*g],l=b.vertices[3*g+1];b=b.vertices[3*g+2];void 0===this.verticesTable[k]&&(this.verticesTable[k]={});void 0===this.verticesTable[k][l]&&(this.verticesTable[k][l]={});if(void 0===this.verticesTable[k][l][b]){var r=
new d(g);r.pos[0]=k;r.pos[1]=l;r.pos[2]=b;this.vertices[g]=r;this.verticesTable[k][l][b]=r}else this.vertices[g]=this.verticesTable[k][l][b]}return this.vertices[g]};k.prototype.createOrGetVertexUv=function(b,g){if(void 0===this.uvs[g]){var k=b.uvs[0][2*g];b=b.uvs[0][2*g+1];void 0===this.uvsTable[k]&&(this.uvsTable[k]={});if(this.mergeInitialUvs)if(void 0===this.uvsTable[k][b]){var l=new d(g);l.pos[0]=k;l.pos[1]=b;l.pos[2]=0;this.uvs[g]=l;this.uvsTable[k][b]=l}else this.uvs[g]=this.uvsTable[k][b];
else l=new d(g),l.pos[0]=k,l.pos[1]=b,l.pos[2]=0,this.uvs[g]=l}return this.uvs[g]};k.prototype.createOrGetEdge=function(b,g){void 0===this.edgesTable[b]&&(this.edgesTable[b]={});void 0===this.edgesTable[g]&&(this.edgesTable[g]={});if(void 0===this.edgesTable[b][g]){var k=this.vertices[b],l=this.vertices[g],r=this.nbVertices++,f=new d(r);this.vertices[r]=f;edge=new u(k,l,f);this.edges.push(edge);this.edgesTable[b][g]=edge;this.edgesTable[g][b]=edge;k.updateEdge(edge);l.updateEdge(edge)}return this.edgesTable[b][g]};
k.prototype.createOrGetEdgeUv=function(b,g){void 0===this.edgesUvsTable[b]&&(this.edgesUvsTable[b]={});void 0===this.edgesUvsTable[g]&&(this.edgesUvsTable[g]={});if(void 0===this.edgesUvsTable[b][g]){var k=this.uvs[b],l=this.uvs[g];l||(console.log(this.uvs,this.uvs[g]),console.log(k,b,l,g));var r=this.nbUvs++,f=new d(r);this.uvs[r]=f;edge=new u(k,l,f);this.edgesUvs.push(edge);this.edgesUvsTable[b][g]=edge;this.edgesUvsTable[g][b]=edge;k.updateEdge(edge);l.updateEdge(edge)}return this.edgesUvsTable[b][g]};
k.prototype.readGeometry=function(k,g){this.vertices=[];this.verticesTable={};this.edges=[];this.edgesTable=[];this.uvsIndices=!1;this.uvs=[];this.uvsTable={};this.edgesUvs=[];this.edgesUvsTable=[];this.faces=[];this.nbVertices=0;this.nbUvs=[];this.mergedNbVertices=this.initNbVertices=0;if(!k.dataBuffers.length||1!==k.dataBuffers.length)return!1;k=k.dataBuffers[0];if(4!=k.polySize)return!1;var l=k.polySize;this.initNbVertices=this.nbVertices=k.nbVertices;for(var t in k.uvs){this.nbUvs=k.nbVertices;
this.uvs=[];this.uvsTable=[];this.edgesUvs=[];this.edgesUvsTable=[];this.uvsIndices=!0;break}g=g.list[0];for(t=0;t<g.length;++t){for(var r=[],f=[],n,u=-1,w=0;w<l;++w){n=k.faces[l*g[t]+w];if(n==u)break;r.push(this.createOrGetVertex(k,n));f.push(n);u=n}n=[];for(w=0;w<r.length-1;++w)n.push(this.createOrGetEdge(r[w].index,r[w+1].index));n.push(this.createOrGetEdge(r[r.length-1].index,r[0].index));w=this.nbVertices++;u=new d(w);r=new b(r,n,u);this.vertices[w]=u;if(this.uvsIndices){w=[];for(var D in f)w.push(this.createOrGetVertexUv(k,
f[D]));f=[];for(D=0;D<w.length-1;++D)f.push(this.createOrGetEdgeUv(w[D].index,w[D+1].index));f.push(this.createOrGetEdgeUv(w[w.length-1].index,w[0].index));n=this.nbUvs++;u=new d(n);r.updateUvs(w,f,u);this.uvs[n]=u}this.faces.push(r)}this.verticesTable=null;this.uvsTable=[];return!0};k.prototype.subdivise=function(k){for(var g=0;g<k;++g){for(var l in this.edges)this.edges[l].computeEdgePoint();if(this.uvsIndices)for(l in this.edgesUvs)this.edgesUvs[l].computeEdgePointUv();for(l=0;l<this.initNbVertices;++l){var t=
this.vertices[l];if(t){var r=t.edges.length;if(r!=t.faces.length){var f=vec3.create([0,0,0]);r=1;for(var n in t.edges)void 0===t.edges[n].faces[1]&&(vec3.add(f,t.edges[n].edgePoint.pos),++r);vec3.add(f,t.pos);vec3.scale(f,1/r);t.pos=f}else{var u=vec3.create([0,0,0]),w=vec3.create(t.pos);for(n in t.faces)vec3.add(u,t.faces[n].facePoint.pos);vec3.scale(u,1/r);f=vec3.create([0,0,0]);for(n in t.edges)vec3.add(f,t.edges[n].edgePoint.pos);vec3.scale(f,1/r);vec3.scale(w,r-3);vec3.add(w,u);vec3.add(w,f);
vec3.add(w,f);vec3.scale(w,1/r);t.pos=w}}}for(l=0;l<this.initNbVertices;++l)this.vertices[l].clearFacesAndEdges();if(this.uvsIndices){for(l=0;l<this.initNbVertices;++l)if(t=this.uvs[l])if(r=t.edges.length,r!=t.faces.length){f=vec3.create([0,0,0]);r=1;for(n in t.edges)void 0===t.edges[n].faces[1]&&(vec3.add(f,t.edges[n].edgePoint.pos),++r);vec3.add(f,t.pos);vec3.scale(f,1/r);t.pos=f}else{u=vec3.create([0,0,0]);w=vec3.create(t.pos);for(n in t.faces)vec3.add(u,t.faces[n].facePointUv.pos);vec3.scale(u,
1/r);f=vec3.create([0,0,0]);for(n in t.edges)vec3.add(f,t.edges[n].edgePoint.pos);vec3.scale(f,1/r);vec3.scale(w,r-3);vec3.add(w,u);vec3.add(w,f);vec3.add(w,f);vec3.scale(w,1/r);t.pos=w}for(l=0;l<this.initNbVertices;++l)this.uvs[l].clearFacesAndEdges()}f=[];this.edges=[];this.edgesTable=[];this.uvsIndices&&(this.edgesUvs=[],this.edgesUvsTable=[]);this.initNbVertices=this.vertices.length;for(l in this.faces){t=this.faces[l];u=t.facePoint;w=[];for(var D in t.edges)w.push(t.edges[D].edgePoint);w.length!=
t.vertices.length&&console.warn("il y a un probl\u00e8me ici.");var A=[];for(D=0;D<w.length-1;++D)A.push(this.createOrGetEdge(t.vertices[D].index,w[D].index)),A.push(this.createOrGetEdge(t.vertices[D+1].index,w[D].index));A.push(this.createOrGetEdge(t.vertices[w.length-1].index,w[w.length-1].index));A.push(this.createOrGetEdge(t.vertices[0].index,w[w.length-1].index));var H=[];for(D in w)H.push(this.createOrGetEdge(u.index,w[D].index));r=[];var e=this.nbVertices++;var E=new d(e);this.vertices[e]=
E;r.push(new b([w[w.length-1],t.vertices[0],w[0],u],[A[A.length-1],A[0],H[0],H[H.length-1]],E));for(D=1;D<w.length;++D)e=this.nbVertices++,E=new d(e),this.vertices[e]=E,r.push(new b([w[D-1],t.vertices[D],w[D],u],[A[2*D-1],A[2*D],H[D],H[D-1]],E));if(this.uvsIndices){u=t.facePointUv;w=[];for(D in t.uvsEdges)w.push(t.uvsEdges[D].edgePoint);A=[];for(D=0;D<w.length-1;++D)A.push(this.createOrGetEdgeUv(t.uvs[D].index,w[D].index)),A.push(this.createOrGetEdgeUv(t.uvs[D+1].index,w[D].index));A.push(this.createOrGetEdgeUv(t.uvs[w.length-
1].index,w[w.length-1].index));A.push(this.createOrGetEdgeUv(t.uvs[0].index,w[w.length-1].index));H=[];for(D in w)H.push(this.createOrGetEdgeUv(u.index,w[D].index));e=this.nbUvs++;E=new d(e);this.uvs[e]=E;r[0].updateUvs([w[w.length-1],t.uvs[0],w[0],u],[A[A.length-1],A[0],H[0],H[H.length-1]],E);for(D=1;D<w.length;++D)e=this.nbUvs++,E=new d(e),this.uvs[e]=E,r[D].updateUvs([w[D-1],t.uvs[D],w[D],u],[A[2*D-1],A[2*D],H[D],H[D-1]],E)}for(D in r)f.push(r[D])}this.faces=f}};k.prototype.getWriteIndex=function(b,
d){for(var g=0;g<b.vertices.length;++g){var k=b.vertices[g];if(b.uvs.length)var l=b.uvs[g],f=l.index;var n=k.index;void 0!==this.indexTable[n]&&(b.uvs.length?void 0!==this.indexTable[n][f]:1)?d.faces.push(this.indexTable[n][f]):(void 0===this.indexTable[n]&&(this.indexTable[n]={}),this.indexTable[n][f]=this.writeIndex,this.writeUvs?(this.verticesArray.push(l.pos[0]),this.verticesArray.push(l.pos[1]),this.verticesArray.push(l.pos[2])):(this.verticesArray.push(k.pos[0]),this.verticesArray.push(k.pos[1]),
this.verticesArray.push(k.pos[2])),b.uvs.length&&this.uvsIndices&&(l=b.uvs[g],this.uvsArray.push(l.pos[0]),this.uvsArray.push(l.pos[1])),k=k.computeNormalFromFaces(),this.normalsArray.push(k[0]),this.normalsArray.push(k[1]),this.normalsArray.push(k[2]),d.faces.push(this.writeIndex++))}};k.prototype.rewriteGeometry=function(b,d){this.indexTable={};this.verticesArray=[];this.normalsArray=[];this.uvsArray=[];this.writeIndex=0;var g={nbVertices:b.dataBuffers[0].nbVertices,nbFaces:b.dataBuffers[0].nbFaces,
polySize:b.dataBuffers[0].polySize,vertices:[],faces:[],normals:[],uvs:{},tangents:{}},k;for(k in this.faces)this.getWriteIndex(this.faces[k],g);g.nbVertices=this.verticesArray.length/3;g.nbFaces=this.faces.length;g.vertices=new Float32Array(this.verticesArray);g.normals=new Float32Array(this.normalsArray);this.uvsIndices&&(g.uvs[0]=new Float32Array(this.uvsArray));d.list=[new Int32Array(this.faces.length)];for(k=0;k<this.faces.length;++k)d.list[0][k]=k;b.dataBuffers=[g]};return k});stage.provide("emersya.viewer.modules.ui.core");
stage.require("emersya.viewer.modules.API.core");stage.require("emersya.viewer.modules.downloadManager");stage.require("emersya.viewer.modules.ui.loader");stage.require("emersya.viewer.modules.ui.menu");stage.require("emersya.viewer.modules.ui.annotations");stage.require("emersya.viewer.modules.ui.configurator");
stage.register.call(stage.emersya.viewer.modules.ui,"core",function(){var b={dataPath:"",isReplay:!1,replayLink:"",configurationCode:"",backgroundColor:"#FF6400",backgroundImagePath:"",backgroundOpacity:1,backgroundImageOpacity:1,fittingMethod:1,autoStart:!1,emersyaLogo:!1,defaultLogo:!0,customerLogoPath:"",logoHorizontalPosition:2,clickableLogo:!0,autoPlay:!1,mouseGrab:!0,hideAnnotations:!1,hideTriggers:!1,hideTriggersDuringAnimation:!1,wheelOnCtrl:!1,devMode:!1,watermarkOpacity:1,mainFont:"",basicLoader:{enabled:!0,
delay:500},loader:{enabled:!0,borderRadius:10,fontSize:13,displayLogo:!1,loaderType:0},startingTutorial:{enabled:!0,displayAfterLoading:!0},handTutorial:{enabled:!1},menu:{enabled:!0,position:"left",opened:!0,offset:26,displayTriggers:!0,displayAnnotations:!0,displayFullScreen:!0,displayZoomIn:!0,displayZoomOut:!0,displayMove:!0,displayRotate:!0,displayHelper:!0,displayViews:!0,displayPlay:!1,displayResetAnimation:!1,toggleable:!0},help:{enabled:!0,touchInteraction:!0,mouseMoveInteraction:!0,mouseWheelInteraction:!0,
mouseButtonInteraction:!0},style:{backgroundOverColor:"#00b1abff",backgroundNormalColor:"#303030DD",backgroundSelectedColor:"#000000DD",foregroundOverColor:"#ffffffff",foregroundNormalColor:"#ffffffff",foregroundSelectedColor:"#00b1abff",neutralOverColor:"#888888ff",neutralNormalColor:"#888888ff",neutralSelectedColor:"#00b1abff",borderColor:"#ffffff30",logoNeutralColor:"#434649",isColorful:!1},playMode:"",stop3DButton:!1,displayMain3DButton:!0,displayScrollingElement:!1,annotations:{enabled:!0,annotations:[],
mode:"ONEBYONE",heightCase:"",hiddenPinOpacity:.4,descriptionFont:"",titleFont:"",openingEventType:0},configurator:{enabled:!0,configurator:{}},adaptativeFov:!1,viewerSettingsFonts:[],fontsPath:"",presets:{display:!1,displayName:!1,mode:0,position:0},featuresLevel:1,loadingDate:null,companyName:""},d=function(d,ea,M){this.settings=stage.extend(!0,{},b,M);this.apiCore=d;this.eventsManager=stage.createEventsManager(this.settings);this.svgIcon=stage.emersya.ui.svgIcon(null,this.settings);this.fullIcons=
this.svgIcon.getUICoreIcons();this.parentElement=$$stage(ea);d=this.parentElement.parent().getWH();this.menu=this.startingTutorial=this.loader=null;this.viewerPlayMode=this.settings.playMode;this.mouseGrab=this.settings.mouseGrab;this.cutoutDisplayed=this.uiReady=this.annotationsPlaying=this.fullscreenOn=!1;this.currentWidth=d.width;this.currentHeight=d.height;this.startingTutorialDisplayed=this.loaderDisplayed=this.fallbackCurrentlyDisplayed=this.changingIcon=!1;this.triggersHiddenDuringAnimation=
[];this.animationsSetNameTriggered=[];this.presets=[];this.mainElement=$$stage("#privateEmersyaViewerContainer");this.waitingSettings={backgroundColor:this.settings.style.backgroundNormalColor,circleColor:this.settings.style.foregroundSelectedColor,container:this.mainElement.get(0)};this.mouseGrab&&this.mainElement.addClass("pointerClass");this.callerName=this.name="UICore";this.apiCore.register(this,"setScene",xc);this.apiCore.register(this,"startRendering",Fc);this.apiCore.register(this,"renderingWorking",
Gc);this.apiCore.register(this,"disable3D",dd);this.apiCore.register(this,"displayFallback",g);this.apiCore.register(this,"setDefaultMaterialsGroupsConfigurations",g);this.apiCore.register(this,"removeFallback",q);this.apiCore.register(this,"ui.launch3D",Oc);this.apiCore.register(this,"ui.isReady",k,!0);this.apiCore.register(this,"ui.initialize",l);this.apiCore.register(this,"ui.initializeNo3DNorFallback",t);this.apiCore.register(this,"resize",oc);this.apiCore.register(this,"localeChanged",Cc);this.apiCore.register(this,
"startCameraInteraction",Sc);this.apiCore.register(this,"endCameraInteraction",nd);this.apiCore.register(this,"ui.updatePreview",Xb);this.apiCore.register(this,"ui.showPreview",yb);this.apiCore.register(this,"ui.hidePreview",Rb);this.apiCore.register(this,"ui.showBackground",ob);this.apiCore.register(this,"ui.getBackgroundImage",Gb,!0);this.apiCore.register(this,"ui.hideBackground",Hb);this.apiCore.register(this,"setViewerPlayMode",A);this.apiCore.register(this,"mouseButtonPress",H);this.apiCore.register(this,
"mouseButtonRelease",e);this.apiCore.register(this,"ui.setStyle",E);this.apiCore.register(this,"ui.showBasicLoader",F);this.apiCore.register(this,"ui.hideBasicLoader",p);this.apiCore.register(this,"ui.buildBasicLoader",m,!0);this.apiCore.register(this,"ui.changePlayMode",Va,!0);this.apiCore.register(this,"onNativeFullScreenChanged",la);this.apiCore.register(this,"ui.showErrorMessage",n);this.apiCore.register(this,"ui.hideErrorMessage",B);this.apiCore.register(this,"ui.showCutout",tc);this.apiCore.register(this,
"ui.showHDRenderCutout",pb);this.apiCore.register(this,"ui.hideCutout",Ab);this.apiCore.register(this,"ui.isCutoutVisible",Bb,!0);this.apiCore.register(this,"ui.showStartButton",ic);this.apiCore.register(this,"ui.hideStartButton",lb);this.apiCore.register(this,"ui.toggleStartButton",$a);this.apiCore.register(this,"ui.showDisable3DButton",Yb);this.apiCore.register(this,"ui.hideDisable3DButton",ac);this.apiCore.register(this,"ui.ignoreDisable3DButton",Kc);this.apiCore.register(this,"setFonts",r);this.apiCore.register(this,
"ui.waitFontsLoading",f);this.apiCore.register(this,"ui.resetDefaultSettings",Fb);this.apiCore.register(this,"ui.hide",Qc);this.apiCore.register(this,"ui.show",fc);this.apiCore.register(this,"mousePosUpdate",vb);this.apiCore.register(this,"setCursor",w);this.apiCore.register(this,"ui.showLoader",T);this.apiCore.register(this,"ui.hideLoader",U);this.apiCore.register(this,"ui.updateLoader",R);this.apiCore.register(this,"ui.toggleLoader",L);this.apiCore.register(this,"ui.setLoaderBorderRadius",C);this.apiCore.register(this,
"ui.setLoaderFontSize",aa);this.apiCore.register(this,"ui.showHandTutorial",K);this.apiCore.register(this,"ui.hideHandTutorial",G);this.apiCore.register(this,"ui.showStartingTutorial",S);this.apiCore.register(this,"ui.hideStartingTutorial",Y);this.apiCore.register(this,"ui.moveStartingTutorial",ia);this.apiCore.register(this,"ui.fadeStartingTutorial",Q);this.apiCore.register(this,"ui.reloadStartingTutorial",ta);this.apiCore.register(this,"ui.toggleStartingTutorial",ua);this.apiCore.register(this,
"ui.disableMenu",oa);this.apiCore.register(this,"ui.showMenu",ba);this.apiCore.register(this,"ui.hideMenu",ka);this.apiCore.register(this,"ui.toggleMenu",Z);this.apiCore.register(this,"ui.openMenu",X);this.apiCore.register(this,"ui.closeMenu",da);this.apiCore.register(this,"ui.addMenuButton",Ha);this.apiCore.register(this,"ui.addMenuSubMenu",Ga);this.apiCore.register(this,"ui.removeMenuButton",Fa);this.apiCore.register(this,"ui.moveMenu",xa);this.apiCore.register(this,"ui.clearMenu",Ia);this.apiCore.register(this,
"ui.loadUI",rb);this.apiCore.register(this,"ui.clearUI",Tc);this.apiCore.register(this,"ui.changeRotateIcon",qa);this.apiCore.register(this,"ui.changeFullScreenIcon",va);this.apiCore.register(this,"ui.selectIcon",fa);this.apiCore.register(this,"ui.selectMenuIcons",P);this.apiCore.register(this,"ui.selectSubMenuIcon",Ba);this.apiCore.register(this,"ui.showHelp",Ka);this.apiCore.register(this,"ui.hideHelp",wa);this.apiCore.register(this,"toggleHelp",Ja);this.apiCore.register(this,"wheelUpdate",La);
this.apiCore.register(this,"hideScrollWithoutCtrlContainer",Sa);this.apiCore.register(this,"onScrollWithoutCtrl",ra);this.apiCore.register(this,"ui.showLogo",Ya);this.apiCore.register(this,"ui.hideLogo",Ra);this.apiCore.register(this,"setAnnotationsOnly",ma);this.apiCore.register(this,"setTriggersOnly",bb);this.apiCore.register(this,"clearColoredTrigger",gb);this.apiCore.register(this,"setAnnotationsTriggers",ib);this.apiCore.register(this,"onAnnotationsMove",ab);this.apiCore.register(this,"toggleAnnotations",
za);this.apiCore.register(this,"openAnnotation",Ta);this.apiCore.register(this,"closeAnnotation",db);this.apiCore.register(this,"toggleAnnotation",N);this.apiCore.register(this,"showAnnotation",Qa,!0);this.apiCore.register(this,"hideAnnotation",Oa,!0);this.apiCore.register(this,"setAnnotationsMode",Ea);this.apiCore.register(this,"setAnnotationsHeightCase",Ca);this.apiCore.register(this,"setAnnotationsHiddenPinOpacity",Ua);this.apiCore.register(this,"setAnnotationsOpeningEventType",sa);this.apiCore.register(this,
"setAnnotationsMoveOnClick",na);this.apiCore.register(this,"startAnnotationsAnimation",kb);this.apiCore.register(this,"stopAnnotationsAnimation",Da);this.apiCore.register(this,"setAnnotationsSettings",ca);this.apiCore.register(this,"ui.clearAnnotations",xb);this.apiCore.register(this,"ui.clearAnimations",Za);this.apiCore.register(this,"updateAnnotation",ja);this.apiCore.register(this,"onAnimationTriggerClicked",O);this.apiCore.register(this,"activateEmptyTriggers",W);this.apiCore.register(this,"setConfigurator",
pa);this.apiCore.register(this,"showConfigurator",Pa);this.apiCore.register(this,"hideConfigurator",ha);this.apiCore.register(this,"clearConfigurator",ya);this.apiCore.register(this,"switchConfiguration",zb);this.apiCore.register(this,"switchConfigurations",cb);this.apiCore.register(this,"switchConfigurationByName",nc);this.apiCore.register(this,"setConfiguratorTransition",dc);this.apiCore.register(this,"setConfiguratorDefaultConfiguration",Wb);this.apiCore.register(this,"setConfiguratorButtonColor",
ec);this.apiCore.register(this,"setConfiguratorButtonTitle",Sb);this.apiCore.register(this,"startAutoRotate",v);this.apiCore.register(this,"stopAutoRotate",v);this.apiCore.register(this,"stopAnimatingPath",v);this.apiCore.register(this,"animationsTriggered",V);this.apiCore.register(this,"setTriggerColor",hb);this.apiCore.register(this,"setTriggersColor",fb);this.apiCore.register(this,"setTriggerType",Aa);this.apiCore.register(this,"setTriggersType",eb);this.apiCore.register(this,"setTriggersSettings",
Ma);this.apiCore.register(this,"onAnnotationPinClicked",v);this.apiCore.register(this,"rdr.highlightByName",v);this.apiCore.register(this,"endTransaction",v);this.apiCore.register(this,"rdr.takeScreenshot",v);this.apiCore.register(this,"startAnimatingPath",h);this.apiCore.register(this,"updateCustomColor",v);this.apiCore.register(this,"updateCustomColorByPolylist",v);this.apiCore.register(this,"updateCustomTexture",v);this.apiCore.register(this,"updateCustomTextureByPolylist",v);this.apiCore.register(this,
"cameraAnimationEnd",I);this.apiCore.register(this,"onEndAnimation",J);this.apiCore.register(this,"onViewerHidden",u);this.apiCore.register(this,"viewerSettingsFileLoaded",od);this.settings.presets.display&&(this.apiCore.register(this,"setPresets",Lb),this.apiCore.register(this,"presetApplied",Ic),this.apiCore.register(this,"ui.showPresets",Vc),this.apiCore.register(this,"ui.hidePresets",vc));this.mainContainer=this.parentElement.build([{tagName:"div",returnActive:!0,attributes:{klass:"viewerUiCoreContainer"},
childs:[]}]);this.previewImage=document.getElementById("viewerPreviewImage");this.backgroundImage=document.getElementById("viewerBackgroundImage");this.previewImage&&this.previewImage.naturalWidth?this.previewImageElement=$$stage(this.previewImage):this.previewImage=null;this.backgroundImage?this.backgroundImageElement=$$stage(this.backgroundImage):this.backgroundImage=null;Ec.call(this);Cb.call(this,this.settings.style);pc.call(this,this.settings.style);skel=[{tagName:"div",returnActive:!0,attributes:{klass:"viewerUiCoreSquareCutoutContainer",
style:{display:"none",width:"100%",height:"100%",position:"absolute","z-index":3,"pointer-events":"none"}},childs:[{tagName:"div",attributes:{klass:"viewerUiCoreTopSquareCutout",style:{width:"100%",height:"0px"}}},{tagName:"div",attributes:{klass:"viewerUiCoreLeftSquareCutout",style:{width:"0px",height:"100%",display:"inline-block"}}},{tagName:"div",attributes:{klass:"viewerUiCoreSquareCutout",style:{width:"50%",height:"50%",display:"inline-block"}}},{tagName:"div",attributes:{klass:"viewerUiCoreRightSquareCutout",
style:{width:"0px",height:"100%",display:"inline-block"}}},{tagName:"div",attributes:{klass:"viewerUiCoreBottomSquareCutout",style:{width:"100%",height:"0px",position:"absolute",bottom:"0px"}}}]}];this.squareCutoutContainer=this.mainContainer.build(skel);this.squareCutoutElement=this.squareCutoutContainer.find(".viewerUiCoreSquareCutout");this.topSquareCutoutElement=this.squareCutoutContainer.find(".viewerUiCoreTopSquareCutout");this.bottomSquareCutoutElement=this.squareCutoutContainer.find(".viewerUiCoreBottomSquareCutout");
this.leftSquareCutoutElement=this.squareCutoutContainer.find(".viewerUiCoreLeftSquareCutout");this.rightSquareCutoutElement=this.squareCutoutContainer.find(".viewerUiCoreRightSquareCutout");Ob.call(this);this.settings.displayScrollingElement&&(this.scrollingContainer&&this.scrollingContainer.remove(),d=[{tagName:"div",returnActive:!0,attributes:{klass:"scrollingMainContainer",style:{}},childs:[{tagName:"div",attributes:{klass:"scrollingContainer",style:{}},childs:[{tagName:"div",attributes:{klass:"scrollingTopContainer"}},
{tagName:"div",attributes:{klass:"scrollingSubContainer",inner:"&#9679;"}},{tagName:"div",attributes:{klass:"scrollingBottomContainer"}}]}],events:[{onEvent:"touchstart",callback:stage.setContext(Tb,this)},{onEvent:"mousedown",callback:stage.setContext(Tb,this)},{onEvent:"touchend",callback:stage.setContext(wc,this)},{onEvent:"mouseup",callback:stage.setContext(wc,this)},{onEvent:"mouseout",callback:stage.setContext(wc,this)},{onEvent:"mousemove",callback:stage.setContext(bc,this)},{onEvent:"touchmove",
callback:stage.setContext(bc,this)},{onEvent:"wheel",callback:stage.setContext(pd,this)}]}],this.scrollingContainer=this.mainContainer.build(d),this.apiCore.exec(this.callerName,"lib.insertSvg",this.fullIcons.scrollingTopArrow,{}),this.apiCore.exec(this.callerName,"lib.insertSvg",this.fullIcons.scrollingBottomArrow,{}),this.scrollingContainer&&this.scrollingContainer.hide());this.settings.devMode&&(this.devContainer=this.mainContainer.build([{tagName:"div",returnActive:!0,attributes:{id:"viewerDevBackgroundImage",
style:{opacity:this.settings.watermarkOpacity}}}]),Hc.call(this,this.apiCore.exec(this.callerName,"translate","devWarningMessage"),"devWarning"));d={};for(M=ea=0;M<this.settings.viewerSettingsFonts.length;++M){var Mb=this.settings.viewerSettingsFonts[M];d[Mb.id]||(ea++,d[Mb.id]=Mb)}0<ea&&r.call(this,d);D.call(this,this.settings.mainFont)};d.prototype.destroy=function(){this.apiCore.exec(this.callerName,"ui.hideHandTutorial",!1);this.apiCore.unregister(this,"setScene");this.apiCore.unregister(this,
"startRendering");this.apiCore.unregister(this,"renderingWorking");this.apiCore.unregister(this,"disable3D");this.apiCore.unregister(this,"displayFallback");this.apiCore.unregister(this,"removeFallback");this.apiCore.unregister(this,"setDefaultMaterialsGroupsConfigurations");this.apiCore.unregister(this,"ui.launch3D");this.apiCore.unregister(this,"ui.isReady");this.apiCore.unregister(this,"ui.initialize");this.apiCore.unregister(this,"ui.initializeNo3DNorFallback");this.apiCore.unregister(this,"setViewerPlayMode");
this.apiCore.unregister(this,"ui.updatePreview");this.apiCore.unregister(this,"ui.showPreview");this.apiCore.unregister(this,"ui.hidePreview");this.apiCore.unregister(this,"ui.showBackground");this.apiCore.unregister(this,"ui.getBackgroundImage");this.apiCore.unregister(this,"ui.hideBackground");this.apiCore.unregister(this,"resize");this.apiCore.unregister(this,"localeChanged");this.apiCore.unregister(this,"startCameraInteraction");this.apiCore.unregister(this,"endCameraInteraction");this.apiCore.unregister(this,
"mouseButtonPress");this.apiCore.unregister(this,"mouseButtonRelease");this.apiCore.unregister(this,"ui.setStyle");this.apiCore.unregister(this,"ui.showBasicLoader");this.apiCore.unregister(this,"ui.hideBasicLoader");this.apiCore.unregister(this,"ui.buildBasicLoader");this.apiCore.unregister(this,"ui.changePlayMode");this.apiCore.unregister(this,"onNativeFullScreenChanged");this.apiCore.unregister(this,"ui.showErrorMessage");this.apiCore.unregister(this,"ui.hideErrorMessage");this.apiCore.unregister(this,
"ui.showCutout");this.apiCore.unregister(this,"ui.showHDRenderCutout");this.apiCore.unregister(this,"ui.hideCutout");this.apiCore.unregister(this,"ui.isCutoutVisible");this.apiCore.unregister(this,"ui.showStartButton");this.apiCore.unregister(this,"ui.hideStartButton");this.apiCore.unregister(this,"ui.toggleStartButton");this.apiCore.unregister(this,"ui.showDisable3DButton");this.apiCore.unregister(this,"ui.hideDisable3DButton");this.apiCore.unregister(this,"ui.ignoreDisable3DButton");this.apiCore.unregister(this,
"ui.setFont");this.apiCore.unregister(this,"ui.resetDefaultSettings");this.apiCore.unregister(this,"ui.hide");this.apiCore.unregister(this,"ui.show");this.apiCore.unregister(this,"click");this.apiCore.unregister(this,"mousePosUpdate");this.apiCore.unregister(this,"setCursor");this.apiCore.unregister(this,"ui.showLoader");this.apiCore.unregister(this,"ui.hideLoader");this.apiCore.unregister(this,"ui.updateLoader");this.apiCore.unregister(this,"ui.toggleLoader");this.apiCore.unregister(this,"ui.setLoaderBorderRadius");
this.apiCore.unregister(this,"ui.setLoaderFontSize");this.apiCore.unregister(this,"ui.showHandTutorial");this.apiCore.unregister(this,"ui.hideHandTutorial");this.apiCore.unregister(this,"ui.showStartingTutorial");this.apiCore.unregister(this,"ui.hideStartingTutorial");this.apiCore.unregister(this,"ui.moveStartingTutorial");this.apiCore.unregister(this,"ui.fadeStartingTutorial");this.apiCore.unregister(this,"ui.reloadStartingTutorial");this.apiCore.unregister(this,"ui.toggleStartingTutorial");this.apiCore.unregister(this,
"ui.disableMenu");this.apiCore.unregister(this,"ui.showMenu");this.apiCore.unregister(this,"ui.hideMenu");this.apiCore.unregister(this,"ui.toggleMenu");this.apiCore.unregister(this,"ui.openMenu");this.apiCore.unregister(this,"ui.closeMenu");this.apiCore.unregister(this,"ui.addMenuButton");this.apiCore.unregister(this,"ui.removeMenuButton");this.apiCore.unregister(this,"ui.moveMenu");this.apiCore.unregister(this,"ui.clearMenu");this.apiCore.unregister(this,"ui.loadUI");this.apiCore.unregister(this,
"ui.clearUI");this.apiCore.unregister(this,"ui.addMenuSubMenu");this.apiCore.unregister(this,"ui.changeRotateIcon");this.apiCore.unregister(this,"ui.changeFullScreenIcon");this.apiCore.unregister(this,"ui.selectIcon");this.apiCore.unregister(this,"ui.selectMenuIcons");this.apiCore.unregister(this,"ui.selectSubMenuIcon");this.apiCore.unregister(this,"ui.showHelp");this.apiCore.unregister(this,"ui.hideHelp");this.apiCore.unregister(this,"toggleHelp");this.apiCore.unregister(this,"wheelUpdate");this.apiCore.unregister(this,
"onScrollWithoutCtrl");this.apiCore.unregister(this,"hideScrollWithoutCtrlContainer");this.apiCore.unregister(this,"ui.showLogo");this.apiCore.unregister(this,"ui.hideLogo");this.apiCore.unregister(this,"setAnnotationsOnly");this.apiCore.unregister(this,"setTriggersOnly");this.apiCore.unregister(this,"clearColoredTrigger");this.apiCore.unregister(this,"setAnnotationsTriggers");this.apiCore.unregister(this,"onAnnotationsMove");this.apiCore.unregister(this,"toggleAnnotations");this.apiCore.unregister(this,
"openAnnotation");this.apiCore.unregister(this,"closeAnnotation");this.apiCore.unregister(this,"showAnnotation");this.apiCore.unregister(this,"hideAnnotation");this.apiCore.unregister(this,"setAnnotationsSettings");this.apiCore.unregister(this,"setAnnotationsHeightCase");this.apiCore.unregister(this,"setAnnotationsHiddenPinOpacity");this.apiCore.unregister(this,"setAnnotationsOpeningEventType");this.apiCore.unregister(this,"setAnnotationsMoveOnClick");this.apiCore.unregister(this,"startAnnotationsAnimation");
this.apiCore.unregister(this,"stopAnnotationsAnimation");this.apiCore.unregister(this,"setAnnotationsMode");this.apiCore.unregister(this,"ui.clearAnnotations");this.apiCore.unregister(this,"ui.clearAnimations");this.apiCore.unregister(this,"updateAnnotation");this.apiCore.unregister(this,"onAnimationTriggerClicked");this.apiCore.unregister(this,"activateEmptyTriggers");this.apiCore.unregister(this,"setConfigurator");this.apiCore.unregister(this,"showConfigurator");this.apiCore.unregister(this,"hideConfigurator");
this.apiCore.unregister(this,"clearConfigurator");this.apiCore.unregister(this,"switchConfiguration");this.apiCore.unregister(this,"switchConfigurations");this.apiCore.unregister(this,"switchConfigurationByName");this.apiCore.unregister(this,"setConfiguratorTransition");this.apiCore.unregister(this,"setConfiguratorDefaultConfiguration");this.apiCore.unregister(this,"setConfiguratorButtonColor");this.apiCore.unregister(this,"setConfiguratorButtonTitle");this.apiCore.unregister(this,"startAutoRotate");
this.apiCore.unregister(this,"stopAutoRotate");this.apiCore.unregister(this,"stopAnimatingPath");this.apiCore.unregister(this,"animationsTriggered");this.apiCore.unregister(this,"setTriggerColor");this.apiCore.unregister(this,"setTriggersColor");this.apiCore.unregister(this,"setTrigger");this.apiCore.unregister(this,"setTriggers");this.apiCore.unregister(this,"onAnnotationPinClicked");this.apiCore.unregister(this,"rdr.highlightByName");this.apiCore.unregister(this,"endTransaction");this.apiCore.unregister(this,
"rdr.takeScreenshot");this.apiCore.unregister(this,"startAnimatingPath");this.apiCore.unregister(this,"updateCustomColor");this.apiCore.unregister(this,"updateCustomColorByPolylist");this.apiCore.unregister(this,"updateCustomTexture");this.apiCore.unregister(this,"updateCustomTextureByPolylist");this.apiCore.unregister(this,"cameraAnimationEnd");this.apiCore.unregister(this,"onEndAnimation");this.apiCore.unregister(this,"onViewerHidden");this.apiCore.unregister(this,"viewerSettingsFileLoaded");this.apiCore.unregister(this,
"setFonts");this.apiCore.unregister(this,"ui.waitFontsLoading");this.apiCore.unregister(this,"toggleAnnotation");this.apiCore.unregister(this,"setTriggerType");this.apiCore.unregister(this,"setTriggersType");this.apiCore.unregister(this,"setTriggersSettings");this.settings.presets.display&&this.apiCore.unregister(this,"setPresets");clearTimeout(this.renderingWorkingTimeout);this.renderingWorkingTimeout=null;this.mainContainer.remove();this.apiCore=null};var u=function(){this.apiCore.exec(this.callerName,
"ui.hideHandTutorial",!1)},k=function(){return this.uiReady},l=function(){this.urlsToRevoke=[];!this.loader&&this.settings.loader.enabled&&(this.loader=new stage.emersya.viewer.modules.ui.loader(this.apiCore,this.mainContainer,stage.extend(!0,{},this.settings.style,this.settings.loader)));!this.startingTutorial&&this.settings.startingTutorial.enabled&&(this.settings.startingTutorial.integratedInFullLoader=1==this.settings.loader.loaderType,this.startingTutorial=new stage.emersya.viewer.modules.ui.startingTutorial(this.apiCore,
this.mainContainer,stage.extend(!0,{},this.settings.style,this.settings.startingTutorial,{wheelOnCtrl:this.settings.wheelOnCtrl})));!this.tutorial&&this.settings.handTutorial.enabled&&(this.tutorial=new stage.emersya.viewer.modules.ui.tutorial(this.apiCore,this.mainContainer,this.settings.handTutorial));!this.menu&&this.settings.menu.enabled&&(this.menu=new stage.emersya.viewer.modules.ui.menu(this.apiCore,this.mainContainer,stage.extend(!0,{},this.settings.style,this.settings.menu),this.viewerPlayMode),
ea.call(this),ka.call(this));!this.help&&this.settings.help.enabled&&(this.help=new stage.emersya.viewer.modules.ui.help(this.apiCore,this.mainContainer,stage.extend(!0,{},this.settings.style,this.settings.help,{wheelOnCtrl:this.settings.wheelOnCtrl})),wa.call(this));!this.annotations&&this.settings.annotations.enabled&&(this.annotations=new stage.emersya.viewer.modules.ui.annotations(this.apiCore,this.mainContainer,stage.extend(!0,{},this.settings.style,this.settings.annotations)));!this.configurator&&
this.settings.configurator.enabled&&stage.emersya.viewer.modules.ui.configurator&&(this.configurator=new stage.emersya.viewer.modules.ui.configurator(this.apiCore,this.mainContainer,stage.extend(!0,{},this.settings.configurator)));setTimeout(stage.setContext(Pb,this),1)},g=function(){this.fallbackCurrentlyDisplayed||(this.fallbackCurrentlyDisplayed=!0,this.backgroundImage&&kc.call(this),this.previewImage&&Db.call(this),p.call(this),U.call(this),ia.call(this),ka.call(this),wa.call(this),Ab.call(this),
lb.call(this),ac.call(this),this.mouseGrab=!1,this.mainElement.removeClass("grabClass"),this.mainElement.removeClass("pointerClass"),this.apiCore.exec(this.callerName,"ui.hideHandTutorial",!0),this.annotations&&(za.call(this,"triggers",!1),za.call(this,"annotations",!1)),!this.configurator&&this.settings.configurator.enabled&&stage.emersya.viewer.modules.ui.configurator&&(this.configurator=new stage.emersya.viewer.modules.ui.configurator(this.apiCore,this.mainContainer,stage.extend(!0,{},this.settings.configurator))))},
q=function(){this.fallbackCurrentlyDisplayed&&(this.fallbackCurrentlyDisplayed=!1,this.backgroundImage&&kc.call(this),this.previewImage&&Db.call(this),this.renderingStarted?(ba.call(this),Yb.call(this),Hb.call(this),U.call(this),ia.call(this),this.annotations&&(za.call(this,"triggers",!0),za.call(this,"annotations",!0))):(yb.call(this),ob.call(this),ic.call(this)))},t=function(){this.currentCount=this.dlCount=0;setTimeout(stage.setContext(jc,this),1)},r=function(b){var d=document.head||document.getElementsByTagName("head")[0],
f=document.createElement("style");f.type="text/css";var e="",g;for(g in b){var h=b[g];e+="@font-face { font-family:"+h.name+"; src:";h.local&&(e+=" local("+h.local+"),");e+="url('"+(h.doNotUseFontsPath?h.font_file.path:this.settings.fontsPath+h.font_file.path)+"') format('"+h.font_file.format+"'),";e=e.substring(0,e.length-1);e+=";}";var k=document.createElement("div");k.className="emersyaFontsHack emersyaFontsHack"+h.name.replace(/\s/g,"");k.innerHTML="emersya";document.body.appendChild(k);$$stage(".emersyaFontsHack"+
h.name.replace(/\s/g,"")).css({"font-family":h.name,position:"absolute",top:"-100px"});setTimeout(function(){$$stage(".emersyaFontsHack").remove()},1E3)}f.styleSheet?f.styleSheet.cssText=e:f.appendChild(document.createTextNode(e));d.appendChild(f)},f=function(b,d,f){var e=!1,g=b.length;if(0==g)d();else for(var h=0;h<b.length;++h)(new FontFaceObserver(b[h])).load().then(function(){--g||!d||e||d()}.bind(this)).catch(function(b){f&&!e&&(f(),e=!0)}.bind(this))},n=function(b,d,f){this.errorMessageContainer?
(this.errorMessageElem.update(b||" "),this.errorActionMessageElem.update(d||" ")):(b=[{tagName:"div",returnActive:!0,attributes:{klass:"errorMessageContainer"},childs:[{tagName:"div",attributes:{klass:"errorMessage",inner:b||""}},{tagName:"div",attributes:{klass:"errorActionMessage",inner:d||""},events:[{onEvent:"click",callback:stage.setContext(function(){this.currentErrorAction&&this.apiCore.exec(this.callerName,this.currentErrorAction)},this)}]}]}],this.errorMessageContainer=this.mainContainer.build(b),
this.errorMessageElem=this.errorMessageContainer.find(".errorMessage"),this.errorActionMessageElem=this.errorMessageContainer.find(".errorActionMessage"));this.currentErrorAction=f;this.errorMessageContainer.show()},B=function(){this.errorMessageContainer&&this.errorMessageContainer.hide()},w=function(b){this.mainElement.css("cursor",b)},D=function(b){""!=b?this.mainElement.css({"font-family":b+",OpenSans, sans-serif"}):this.mainElement.css({"font-family":"OpenSans, sans-serif"})},A=function(b){this.viewerPlayMode=
b},H=function(b){this.buttonPressed=b;this.mouseGrab&&(this.mainElement.removeClass("grabClass"),this.mainElement.addClass("grabbingClass"))},e=function(b){null!=this.buttonPressed&&b===this.buttonPressed&&(this.mouseGrab&&(this.mainElement.removeClass("grabbingClass"),this.mainElement.addClass("grabClass")),this.buttonPressed=null);Q.call(this);this.hideStartingTutorialInterval||(this.hideStartingTutorialInterval=setInterval(stage.setContext(Y,this),1E3))},E=function(b,d){b=d?Dc.call(this,b):b;this.apiCore.exec(this.callerName,
"lib.setStyle",b.style);this.waitingSettings=stage.extend(!0,{},this.waitingSettings,{backgroundColor:b.style.backgroundNormalColor,circleColor:b.style.foregroundSelectedColor});this.settings.menu.enabled&&(this.menu.setStyle(b.style),this.menu.reload());this.settings.help.enabled&&(this.help.setStyle(b.style),this.help.reload());this.settings.loader.enabled&&this.loader.setStyle(b.style);this.settings.startingTutorial.enabled&&this.startingTutorial.reload(b.style)},F=function(b,d){this.settings.basicLoader.enabled&&
(d?(d=stage.extend(!0,{},this.waitingSettings,b),this.waitingLoader||(this.waitingLoader=stage.emersya.ui.waiting(d))):this.waitingLoader||this.waitingLoaderTimeout||(this.waitingLoaderTimeout=setTimeout(stage.setContext(function(){var d=stage.extend(!0,{},this.waitingSettings,b);this.waitingLoader=stage.emersya.ui.waiting(d);this.waitingLoaderTimeout=null},this),this.settings.basicLoader.delay)))},p=function(){this.waitingLoaderTimeout&&(clearTimeout(this.waitingLoaderTimeout),this.waitingLoaderTimeout=
null);this.waitingLoader&&(this.waitingLoader.remove(),this.waitingLoader=null)},m=function(b){var d=stage.extend(!0,{},this.waitingSettings);d.container=b.get(0);d.mode=1;return stage.emersya.ui.waiting(d)},h=function(b){this.tutorial&&this.tutorial.cameraPath!=b&&this.apiCore.exec(this.callerName,"ui.hideHandTutorial",!0);v.call(this)},v=function(){this.menu&&this.settings.menu.enabled&&(this.changingIcon||this.menu.closeSubMenu(arguments[arguments.length-1]),this.changingIcon=!1)},I=function(){this.settings.menu.enabled&&
this.menu&&this.menu.listenViewerEvent();nd.call(this)},J=function(b){var d=this;b=this.animationsSetNameTriggered.indexOf(b);this.animationsSetNameTriggered.splice(b,1);0==this.animationsSetNameTriggered.length&&this.settings.annotations.enabled&&this.settings.hideTriggersDuringAnimation&&this.triggersHiddenDuringAnimation.forEach(function(b){d.apiCore.exec(d.callerName,"toggleAnnotations","triggers",!0,b)})},M=function(){this.settings.menu.enabled&&this.menu&&this.menu.closeSubMenu(arguments[arguments.length-
1]);"ANNOTATIONS"==this.viewerPlayMode&&this.settings.annotations.enabled&&this.annotationsPlaying&&this.apiCore.exec(this.callerName,"stopAnnotationsAnimation")},T=function(){this.loader&&this.settings.loader.enabled&&(this.loaderDisplayed=!0,this.loader.show())},U=function(){this.loader&&this.settings.loader.enabled&&(this.loaderDisplayed=!1,this.loader.hide())},R=function(b,d){this.loader&&this.settings.loader.enabled&&this.loader.update(b/d)},aa=function(b){this.settings.loader.enabled&&this.loader.setFontSize(b)},
C=function(b){this.settings.loader.enabled&&this.loader.setBorderRadius(b)},L=function(b){this.settings.loader.enabled&&(void 0===b&&(b=!this.loaderDisplayed),b?(Qc.call(this),T.call(this)):(fc.call(this),U.call(this)))},K=function(){this.tutorial&&this.settings.handTutorial.enabled&&this.tutorial.show()},G=function(b){this.tutorial&&this.settings.handTutorial.enabled&&this.tutorial.hide(b)},S=function(){this.startingTutorial&&this.settings.startingTutorial.enabled&&(this.startingTutorialDisplayed=
!0,this.startingTutorial.show())},Y=function(){this.startingTutorial&&this.settings.startingTutorial.enabled&&(this.hideStartingTutorialInterval&&(clearInterval(this.hideStartingTutorialInterval),this.hideStartingTutorialInterval=null),this.startingTutorialDisplayed=!1,this.startingTutorial.hide())},ia=function(){this.startingTutorial&&this.settings.startingTutorial.enabled&&!this.loaderDisplayed&&this.startingTutorial.moveBottom()},Q=function(){this.startingTutorial&&this.settings.startingTutorial.enabled&&
this.startingTutorial.fade(this.loaderDisplayed)},ta=function(){this.startingTutorial&&this.settings.startingTutorial.enabled&&this.startingTutorial.reload(this.settings.startingTutorial)},ua=function(b){this.startingTutorial&&this.settings.startingTutorial.enabled&&(void 0===b&&(b=!this.startingTutorialDisplayed),b?(ta.call(this),S.call(this)):Y.call(this))},ea=function(){this.menu&&this.settings.menu.enabled&&(this.settings.menu.displayPlay?this.menu.playIconDisplayed?this.menu.addButton("playButton"):
this.menu.addButton("pauseButton"):(this.menu.removeButton("pauseButton"),this.menu.removeButton("playButton")),this.settings.menu.displayZoomIn?this.menu.addButton("zoomInButton"):this.menu.removeButton("zoomInButton"),this.settings.menu.displayZoomOut?this.menu.addButton("zoomOutButton"):this.menu.removeButton("zoomOutButton"),this.settings.menu.displayMove?this.menu.addButton("moveButton"):this.menu.removeButton("moveButton"),this.settings.menu.displayRotate?this.menu.addButton("rotateButton"):
this.menu.removeButton("rotateButton"),this.settings.menu.displayHelper?this.menu.addButton("helpButton"):this.menu.removeButton("helpButton"),this.settings.menu.displayViews?this.menu.addSubMenu("eyeButton","icon"):this.menu.removeButton("eyeButton"),this.settings.menu.displayTriggers?this.menu.addButton("triggerButton"):this.menu.removeButton("triggerButton"),this.settings.menu.displayAnnotations?this.menu.addButton("annotationButton"):this.menu.removeButton("annotationButton"),this.settings.menu.displayFullScreen?
this.menu.addButton("fullScreenButton"):this.menu.removeButton("fullScreenButton"),this.settings.menu.displayResetAnimation?this.menu.addButton("resetAnimationButton"):this.menu.removeButton("resetAnimationButton"),this.menu.settings.toggleable=this.settings.menu.toggleable,this.menu.reload())},oa=function(){this.menu&&this.settings.menu.enabled&&(this.settings.menu.enabled=!1)},ba=function(){this.menu&&this.settings.menu.enabled&&(this.menu.show(),this.menu.resize(this.currentWidth,this.currentHeight))},
ka=function(){this.menu&&this.settings.menu.enabled&&this.menu.hide()},Z=function(b){this.menu&&this.settings.menu.enabled&&this.menu.toggle(b)},da=function(b){this.menu&&this.settings.menu.enabled&&this.menu.close(b)},X=function(b){this.menu&&this.settings.menu.enabled&&this.menu.open(b)},Ha=function(b){this.menu&&this.settings.menu.enabled&&(this.menu.addButton(b),this.menu.reload())},Ga=function(b,d){this.menu&&this.settings.menu.enabled&&(this.menu.addSubMenu(b,d),this.menu.reload())},Fa=function(b){this.menu&&
this.settings.menu.enabled&&(this.menu.removeButton(b),this.menu.reload())},xa=function(b){this.menu&&this.settings.menu.enabled&&this.menu.setPosition(b)},Ia=function(){this.menu&&this.settings.menu.enabled&&this.menu.clear()},qa=function(b,d){this.menu&&this.settings.menu.enabled&&this.menu.changeRotateIcon(b,d)},Va=function(b,d,f,e){"play"==b?"ANNOTATIONS"==this.viewerPlayMode?(this.apiCore.exec(this.callerName,"startAnnotationsAnimation"),this.annotations.getAnnotationsDisplayed()||this.apiCore.exec(this.callerName,
"toggleAnnotations","annotations")):this.apiCore.exec(this.callerName,"startAutoRotate"):"ANNOTATIONS"==this.viewerPlayMode?this.apiCore.exec(this.callerName,"stopAnnotationsAnimation"):this.apiCore.exec(this.callerName,"stopAutoRotate");this.apiCore.exec(this.callerName,"ui.changeRotateIcon",b,d);f&&e&&(this.changingIcon=!0,Ba.call(this,f,e))},va=function(b){this.menu&&this.settings.menu.enabled&&this.menu.changeFullScreenIcon(b)},la=function(){va.call(this,(this.fullscreenOn=!this.fullscreenOn)?
"On":"Off")},fa=function(b,d,f,e){this.menu&&this.settings.menu.enabled&&this.menu.selectIcon(b,d,f,e)},P=function(b){if(this.menu&&this.settings.menu.enabled)for(var d=0;d<b.length;d++)fa.call(this,this.menu.buttonList[b[d]+"Button"].icon,b[d],!0,!1)},Ba=function(b,d){this.menu&&this.settings.menu.enabled&&this.menu.selectSubMenuIcon(b,d)},Ka=function(){this.help&&this.settings.help.enabled&&this.help.show()},wa=function(){this.help&&this.settings.help.enabled&&this.help.hide()},Ja=function(b){this.help&&
this.settings.help.enabled&&this.help.toggle(b)},La=function(){this.wheelOnCtrlContainer&&!this.fallbackCurrentlyDisplayed&&this.wheelOnCtrlContainer.removeClass("wheelOnCtrlSmoothTransition")},ra=function(){this.wheelOnCtrlContainer&&!this.fallbackCurrentlyDisplayed&&(this.wheelOnCtrlContainer.addClass("wheelOnCtrlSmoothTransition"),this.zoomOnCtrlTransitionTimeout&&clearTimeout(this.zoomOnCtrlTransitionTimeout),this.zoomOnCtrlTransitionTimeout=setTimeout(stage.setContext(function(){this.apiCore.exec(this.callerName,
"hideScrollWithoutCtrlContainer")},this),1200))},Sa=function(){this.wheelOnCtrlContainer&&!this.fallbackCurrentlyDisplayed&&(this.wheelOnCtrlContainer.removeClass("wheelOnCtrlSmoothTransition"),this.zoomOnCtrlTransitionTimeout=null)},Ya=function(){this.logoContainer&&this.settings.emersyaLogo&&this.logoContainer.show()},Ra=function(){this.logoContainer&&this.settings.emersyaLogo&&this.logoContainer.hide()},ma=function(b){this.annotations&&this.settings.annotations.enabled?(!this.menu||b&&0!=b.length||
this.menu.removeButton("annotationButton"),this.annotations.setAnnotationsOnly(b)):this.menu&&this.menu.removeButton("annotationButton")},bb=function(b){this.annotations&&this.settings.annotations.enabled?(!this.menu||b&&0!=b.length||this.menu.removeButton("triggerButton"),this.annotations.setTriggersOnly(b)):this.menu&&this.menu.removeButton("triggerButton")},gb=function(b){this.annotations&&this.settings.annotations.enabled&&this.annotations.clearColoredTrigger(b)},ib=function(b,d){ma.call(this,
b);bb.call(this,d)},hb=function(b,d){this.annotations&&this.settings.annotations.enabled&&this.annotations.setTriggerColor(b,d)},fb=function(b){this.annotations&&this.settings.annotations.enabled&&this.annotations.setTriggersColor(b)},Aa=function(b,d){this.annotations&&this.settings.annotations.enabled&&this.annotations.setTriggerType(b,d)},eb=function(b){this.annotations&&this.settings.annotations.enabled&&this.annotations.setTriggersType(b)},ab=function(b){this.annotations&&this.settings.annotations.enabled&&
this.annotations.move(b)},Ma=function(b){this.settings.hideTriggersDuringAnimation=b.hideTriggersDuringAnimation;this.settings.hideTriggers=b.hideTriggers},Ta=function(b){this.annotations&&this.settings.annotations.enabled&&("ANNOTATIONS"==this.viewerPlayMode&&this.apiCore.exec(this.callerName,"stopAnnotationsAnimation"),this.annotations.openAnnotation(b,!1))},db=function(b){this.annotations&&this.settings.annotations.enabled&&("ANNOTATIONS"==this.viewerPlayMode&&this.apiCore.exec(this.callerName,
"stopAnnotationsAnimation"),this.annotations.closeAnnotation(b))},Oa=function(b){if(!this.annotations||!this.settings.annotations.enabled)return this.apiCore.exec(this.callerName,"onError","Annotations need to be enabled to hideAnnotation."),stage.createError(319,"Annotations need to be enabled to hideAnnotation.");this.apiCore.exec(this.callerName,"onAnnotationPinHidden",b);return this.annotations.hideAnnotation(b)},Qa=function(b){if(!this.annotations||!this.settings.annotations.enabled)return this.apiCore.exec(this.callerName,
"onError","Annotations need to be enabled to showAnnotation."),stage.createError(319,"Annotations need to be enabled to showAnnotation.");this.apiCore.exec(this.callerName,"stopAnnotationsAnimation");this.apiCore.exec(this.callerName,"onAnnotationPinDisplayed",b);return this.annotations.showAnnotation(b)},N=function(b){if(!this.annotations||!this.settings.annotations.enabled)return this.apiCore.exec(this.callerName,"onError","Annotations need to be enabled to toggleAnnotation."),stage.createError(319,
"Annotations need to be enabled to toggleAnnotation.");this.apiCore.exec(this.callerName,"stopAnnotationsAnimation");this.apiCore.exec(this.callerName,"onAnnotationPinToggled",b);return this.annotations.toggleAnnotation(b)},za=function(b,d,f){this.annotations&&this.settings.annotations.enabled&&(this.annotations.toggleAnnotations(b,d,f),"annotations"===b&&this.menu?fa.call(this,this.menu.buttonList.annotationButton.icon,"annotation",d,!1):"triggers"===b&&this.menu&&fa.call(this,this.menu.buttonList.triggerButton.icon,
"trigger",d,!1),"ANNOTATIONS"!==this.viewerPlayMode||void 0===d||d||Va.call(this,"pause"))},ca=function(b){this.annotations&&this.settings.annotations.enabled&&this.annotations.setSettings(b)},Ea=function(b){this.annotations&&this.settings.annotations.enabled&&this.annotations.setMode(b)},Ca=function(b){this.annotations&&this.settings.annotations.enabled&&this.annotations.setHeightCase(b)},Ua=function(b){this.annotations&&this.settings.annotations.enabled&&this.annotations.setHiddenPinOpacity(b)},
sa=function(b){this.annotations&&this.settings.annotations.enabled&&this.annotations.setOpeningEventType(b)},na=function(b){this.annotations&&this.settings.annotations.enabled&&this.annotations.setMoveOnClick(b)},kb=function(){this.annotations&&this.settings.annotations.enabled&&(this.annotations.startAnnotationsAnimation(),this.annotationsPlaying=!0)},Da=function(){this.annotations&&this.settings.annotations.enabled&&(this.apiCore.exec(this.callerName,"statsIgnoreNoMore"),"ANNOTATIONS"==this.viewerPlayMode&&
this.apiCore.exec(this.callerName,"ui.changeRotateIcon","pause"),this.annotations.stopAnnotationsAnimation(),this.annotationsPlaying=!1)},xb=function(){this.annotations&&this.settings.annotations.enabled&&this.annotations.setAnnotationsOnly([])},Za=function(){this.annotations&&this.settings.annotations.enabled&&this.annotations.setTriggersOnly([])},V=function(b,d){if(this.annotations&&this.settings.annotations.enabled&&d!==stage.emersya.viewer.ANIMATIONS_TRIGGERS.AUTO&&d!==stage.emersya.viewer.ANIMATIONS_TRIGGERS.WATCH){if(this.settings.hideTriggersDuringAnimation&&
this.annotations.getTriggersDisplayed()){this.triggersHiddenDuringAnimation=this.annotations.getDisplayedTriggersList();for(var f in b)this.animationsSetNameTriggered.push(b[f].setName);this.apiCore.exec(this.callerName,"toggleAnnotations","triggers",!1);this.menu&&fa.call(this,this.menu.buttonList.triggerButton.icon,"trigger",!1,!1)}v.call(this);this.apiCore.exec(this.callerName,"ui.hideHandTutorial",!0)}},O=function(b){if(this.annotations&&this.settings.annotations.enabled){var d=this.apiCore.exec(this.callerName,
"rdr.getCurrentScene");this.apiCore.exec(this.callerName,"triggerAnimation",d,b,stage.emersya.viewer.ANIMATIONS_TRIGGERS.TRIGGER)}},ja=function(b){this.annotations&&this.settings.annotations.enabled&&this.annotations.updateAnnotation(b)},W=function(){this.annotations&&this.settings.annotations.enabled&&this.annotations.activateEmptyTriggers()},pa=function(b){this.configurator&&this.settings.configurator.enabled&&(b=b.configurator_categories?{filePath:b.file_path,id:b.id,lastModified:b.last_modified,
project:b.project,routing:b.routing,title:b.title,transition:b.transition,viewerList:b.viewerList,categories:Ib.call(this,b.configurator_categories)}:b,this.configurator.set(b),this.apiCore.exec(this.callerName,"setNoMaterialTransitions",!b.transition))},Pa=function(){this.configurator&&this.settings.configurator.enabled&&this.configurator.show()},ha=function(){this.configurator&&this.settings.configurator.enabled&&this.configurator.hide()},ya=function(b){this.configurator&&this.settings.configurator.enabled&&
this.configurator.clear()},zb=function(b,d){this.configurator&&this.settings.configurator.enabled&&(v.call(this),this.configurator.switchConfiguration(b,d))},cb=function(b){this.configurator&&this.settings.configurator.enabled&&(v.call(this),this.configurator.switchConfigurations(b))},nc=function(b,d){this.configurator&&this.settings.configurator.enabled&&(v.call(this),this.configurator.switchConfigurationByName(b,d))},dc=function(b){this.configurator&&this.settings.configurator.enabled&&this.configurator.setConfiguratorTransition(b)},
Wb=function(){this.configurator&&this.settings.configurator.enabled&&this.configurator.setDefaultConfiguration()},Sb=function(b){this.configurator&&this.settings.configurator.enabled&&this.configurator.setButtonTitle(b)},ec=function(b){this.configurator&&this.settings.configurator.enabled&&this.configurator.setButtonColor(b)},Xb=function(b,d,f){var e=document.getElementById("viewerPreviewImage");e&&(e.onload=stage.setContext(function(){e&&e.naturalWidth?(this.settings.adaptativeFov=f,this.previewImage=
e,this.previewImageElement=$$stage(this.previewImage),this.previewImageElement.css({opacity:d}),Db.call(this),this.previewDisplayed&&yb.call(this)):this.previewImage=null},this),e.src=b)},yb=function(){this.previewDisplayed=!0;this.previewImageElement&&this.previewImageElement.parent().show()},Rb=function(){this.previewDisplayed=!1;this.previewImageElement&&this.previewImageElement.parent().hide()},Gb=function(){return this.backgroundImageElement.get(0)},ob=function(){this.backgroundImageElement&&
this.backgroundImageElement.parent().show()},Hb=function(){this.backgroundImageElement&&this.backgroundImageElement.parent().hide()},tc=function(){this.squareCutoutContainer.show();ad.call(this);rc.call(this,this.currentWidth,this.currentHeight);this.cutoutDisplayed=!0},pb=function(){this.squareCutoutContainer.show();ad.call(this);this.squareCutoutElement.css({width:"100%",height:"100%","background-position":"50%","background-size":"contain"});this.topSquareCutoutElement.css({width:0,height:0});this.bottomSquareCutoutElement.css({width:0,
height:0});this.leftSquareCutoutElement.css({width:0,height:0});this.rightSquareCutoutElement.css({width:0,height:0});this.cutoutDisplayed=!0},Ab=function(){this.cutoutDisplayed&&(this.squareCutoutContainer.hide(),this.cutoutDisplayed=!1)},Bb=function(){return this.cutoutDisplayed},$a=function(b){void 0===b&&(b=!this.startButtonDisplayed);b?ic.call(this):lb.call(this)},lb=function(){this.startButton.parent().hide();this.startButtonDisplayed=!1},ic=function(){this.startButton.parent().show();this.startButtonDisplayed=
!0},ac=function(){this.settings.stop3DButton&&this.disable3DButton.hide()},Yb=function(){this.settings.stop3DButton&&this.disable3DButton.show()},Kc=function(b){this.ignoreDisable3DButton=b},ad=function(){this.squareCutoutElement.css({"background-image":"url(/bundles/EmersyaWebsitePro/images/positioning_grid/positioning_grid_center.png)","background-size":"100%"});this.topSquareCutoutElement.css({"background-image":"url(/bundles/EmersyaWebsitePro/images/positioning_grid/positioning_grid_side_top.png)",
"background-repeat":"repeat-y"});this.bottomSquareCutoutElement.css({"background-image":"url(/bundles/EmersyaWebsitePro/images/positioning_grid/positioning_grid_side_top.png)","background-repeat":"repeat-y"});this.leftSquareCutoutElement.css({"background-image":"url(/bundles/EmersyaWebsitePro/images/positioning_grid/positioning_grid_side_left.png)","background-repeat":"repeat-x"});this.rightSquareCutoutElement.css({"background-image":"url(/bundles/EmersyaWebsitePro/images/positioning_grid/positioning_grid_side_left.png)",
"background-repeat":"repeat-x"})},oc=function(b,d){this.currentWidth=b;this.currentHeight=d;this.uiReady&&(this.settings.loader.enabled&&this.loader.updatePosition(),this.settings.startingTutorial.enabled&&this.startingTutorial.updatePosition(),this.settings.menu.enabled&&this.menu.resize(b,d),this.settings.help.enabled&&this.help&&this.help.resize(b,d),this.settings.annotations.enabled&&this.annotations.resize(b,d),this.cutoutDisplayed&&rc.call(this,b,d),0<this.presets.length&&tb.call(this));this.backgroundImage&&
kc.call(this);this.previewImage&&Db.call(this);this.tutorial&&this.tutorial.resize(b,d)},Cc=function(b){this.settings.menu.enabled&&this.menu.updateLanguage(b);this.settings.help.enabled&&this.help.updateLanguage(b);this.settings.loader.enabled&&this.loader.updateLanguage(b);this.settings.startingTutorial.enabled&&this.startingTutorial.updateLanguage(b);this.settings.annotations.enabled&&this.annotations.updateLanguage(b);this.settings.configurator.enabled&&this.configurator.updateLanguage(b);Ob.call(this);
this.settings.isReplay&&""!=this.settings.replayLink&&this.settings.configurationCode&&(this.redirectButtonTextContainer.get(0).innerHTML=this.apiCore.exec(this.callerName,"translate","customizeOrder"))},nd=function(){this.settings.annotations.enabled&&!this.fallbackCurrentlyDisplayed&&this.annotations.endCameraInteraction()},Sc=function(){this.settings.menu.enabled&&this.menu&&this.menu.setEyeIcon();M.call(this);this.settings.annotations.enabled&&!this.fallbackCurrentlyDisplayed&&this.annotations.startCameraInteraction();
this.apiCore.exec(this.callerName,"ui.hideHandTutorial",!0)},Tc=function(){ka.call(this);Ra.call(this);ac.call(this);lb.call(this);Ab.call(this)},rb=function(b,d){Tc.call(this);b=Dc.call(this,b);this.settings=stage.extend(!0,{},this.settings,b);!this.loader&&this.settings.loader.enabled&&(this.loader=new stage.emersya.viewer.modules.ui.loader(this.apiCore,this.mainContainer,stage.extend(!0,{},this.settings.style,this.settings.loader)));!this.startingTutorial&&this.settings.startingTutorial.enabled&&
(this.settings.startingTutorial.integratedInFullLoader=1==this.settings.loader.loaderType,this.startingTutorial=new stage.emersya.viewer.modules.ui.startingTutorial(this.apiCore,this.mainContainer,stage.extend(!0,{},this.settings.style,this.settings.startingTutorial,{wheelOnCtrl:this.settings.wheelOnCtrl})));!this.tutorial&&this.settings.handTutorial.enabled&&(this.tutorial=new stage.emersya.viewer.modules.ui.tutorial(this.apiCore,this.mainContainer,this.settings.handTutorial));!this.menu&&this.settings.menu.enabled&&
(this.menu=new stage.emersya.viewer.modules.ui.menu(this.apiCore,this.mainContainer,stage.extend(!0,{},this.settings.style,this.settings.menu),this.viewerPlayMode),ea.call(this),ka.call(this));!this.help&&this.settings.help.enabled&&(this.help=new stage.emersya.viewer.modules.ui.help(this.apiCore,this.mainContainer,stage.extend(!0,{},this.settings.style,this.settings.help,{wheelOnCtrl:this.settings.wheelOnCtrl})),wa.call(this));!this.annotations&&this.settings.annotations.enabled&&(this.annotations=
new stage.emersya.viewer.modules.ui.annotations(this.apiCore,this.mainContainer,stage.extend(!0,{},this.settings.style,this.settings.annotations)));!this.configurator&&this.settings.configurator.enabled&&stage.emersya.viewer.modules.ui.configurator&&(this.configurator=new stage.emersya.viewer.modules.ui.configurator(this.apiCore,this.mainContainer,stage.extend(!0,{},this.settings.configurator)));d||E.call(this,this.settings,!1);D.call(this,this.settings.mainFont);ca.call(this,this.settings.annotations);
Ec.call(this);this.settings.loader.enabled&&this.loader.reload(this.settings.loader);this.settings.startingTutorial.enabled&&this.startingTutorial.reload(this.settings.startingTutorial);pc.call(this,this.settings.style);this.settings.menu.enabled&&(this.menu.setPosition(this.settings.menu.position),this.menu.setDisplay(this.settings.menu.enabled),this.menu.setOffsetMenu(this.settings.menu.offset),ba.call(this),xa.call(this,this.settings.menu.position),ea.call(this),this.settings.menu.opened?X.call(this):
da.call(this));this.settings.devMode&&this.settings.devMode&&this.devContainer.css({opacity:this.settings.watermarkOpacity});Yb.call(this);Ob.call(this);this.apiCore.exec(this.callerName,"setAutoRotate",this.settings.clockwise,this.settings.autoRotateSpeed)},od=function(b){null!=b.basic_loader_enabled&&(this.settings.basicLoader.enabled=b.basic_loader_enabled,this.settings.basicLoader.delay=b.basic_loader_delay);b.partner_name&&(this.settings.partnerName=b.partner_name);if(b.presets_custom_style){$$stage("#privateEmersyaViewerContainer .presetsPanel .presetContainer .outerBorder .presetPreview").css({"border-width":"2px",
"border-color":"white","border-style":"solid"});var d=document.createElement("style"),f;for(f in b.presets_custom_style){d.textContent+=".presetsPanel "+f+" { ";for(var e in b.presets_custom_style[f])d.textContent+=e+" :"+b.presets_custom_style[f][e]+" !important;";d.textContent+=" }"}document.head.appendChild(d);tb.call(this)}this.settings.presets.display&&(this.settings.presets.displayName=void 0!=b.preset_display_name?b.preset_display_name:!1);b.hand_tutorial_duration&&(this.settings.handTutorial.handTutorialDuration=
1E3*b.hand_tutorial_duration,this.settings.handTutorial.handTutorialAngle=Math.min(359,b.hand_tutorial_angle),this.settings.handTutorial.handTutorialInterval=1E3*b.hand_tutorial_interval,this.settings.handTutorial.handTutorialIcon=b.hand_tutorial_icon,this.settings.handTutorial.handTutorialIconPath=this.settings.dataPath+b.hand_tutorial_icon_path);this.tutorial&&this.tutorial.updateSettings(this.settings.handTutorial);sb.call(this)},Dc=function(b){return{autoPlay:b.auto_play,autoStart:b.auto_start3d,
emersyaLogo:b.display_emersya_logo,clockwise:b.clockwise,autoRotateSpeed:b.rotate_speed,defaultLogo:b.is_default_logo,customerLogoPath:b.real_customer_logo_path?b.real_customer_logo_path:b.customer_logo_path,partnerName:b.partner_name,logoHorizontalPosition:b.logo_horizontal_position,clickableLogo:b.is_clickable_logo,stop3DButton:b.stop3_d_button,displayMain3DButton:b.display_main3_d_button,displayScrollingElement:b.display_scrolling_element,watermarkOpacity:b.watermark_opacity,mainFont:Nb.call(this,
b.fonts,b.main_font_id,b.mainFont),wheelOnCtrl:b.wheel_on_ctrl,style:{backgroundOverColor:"#"+b.over_background_color,backgroundNormalColor:"#"+b.normal_background_color,backgroundSelectedColor:"#"+b.selected_background_color,foregroundOverColor:"#"+b.over_foreground_color,foregroundNormalColor:"#"+b.normal_foreground_color,foregroundSelectedColor:"#"+b.selected_foreground_color,neutralOverColor:"#"+b.over_neutral_color,neutralNormalColor:"#"+b.normal_neutral_color,neutralSelectedColor:"#"+b.selected_neutral_color,
borderColor:"#"+b.border_color,logoNeutralColor:"#"+b.logo_neutral_color,isColorful:b.theme?!0:!1},presets:{display:!1,mode:b.preset_mode,position:b.preset_position},annotations:{over_background_color:b.over_background_color,titleFont:Nb.call(this,b.fonts,b.annotation_title_font_id),descriptionFont:Nb.call(this,b.fonts,b.annotation_description_font_id)},ar:{arMainColor:"#"+b.ar_main_color,arSecondColor:"#"+b.ar_second_color,displayArShareOnSocialNetworkButton:b.display_ar_share_on_social_network_button,
displayArDownloadRenderButton:b.display_ar_download_render_button,displayArAnimationMenu:b.display_ar_animation_menu,displayArPresetMenu:!1,displayArStartButton:b.display_ar_start_button},loader:{borderRadius:b.loaderBorderRadius,fontSize:b.loaderFontSize,enabled:b.display_loader,displayLogo:b.display_loader_logo,loaderType:b.loader_type},startingTutorial:{enabled:b.display_loader_icon,displayAfterLoading:b.display_loader_icon_after_loading},handTutorial:{enabled:b.display_hand_tutorial},menu:{enabled:b.display_menu,
position:b.menu_position,opened:b.menu_opened,toggleable:b.menu_toggleable,offset:b.offset_menu,displayTriggers:b.display_triggers,displayAnnotations:b.display_annotations,displayFullScreen:b.display_full_screen,displayZoomIn:b.display_zoom_in,displayZoomOut:b.display_zoom_out,displayMove:b.display_move,displayRotate:b.display_rotate,displayHelper:b.display_helper,displayViews:b.defined_views,displayPlay:b.display_play,displayResetAnimation:b.display_reset_animation},help:{mouseMoveInteraction:b.mouse_move_interaction,
mouseWheelInteraction:b.mouse_wheel_interaction,mouseButtonInteraction:b.mouse_button_interaction,touchInteraction:b.touch_interaction}}},Nb=function(b,d,f){for(var e in b){var g=b[e];if(g.id==d)return g.name}return void 0==f?"":f},Ib=function(b){var d=[];if(b)for(var f in b){var e=b[f];var g=void 0;var h=e.configurator_buttons;var k=null;var l=[];if(h)for(g in h){var q=h[g],m=q.id,p=q.name,n=q.order_number,t=q.default_button,r=q.color,O=void 0;q=q.configurator_materials;var v=[];if(q)for(O in q){var V=
q[O];v.push({id:V.id,accessString:V.configurator_access,materialSettingsId:V.material_settings,materialTreeId:V.material_tree})}m={id:m,name:p,order:n,isDefault:t,color:r,materials:v};l.push(m);m.isDefault&&(k=m)}g=l;d.push({id:e.id,name:e.name,order:e.order_number,container:e.container,categories:Ib.call(this,e.configurator_categories),buttons:g,defaultButton:k})}return d},Ob=function(){if(this.settings.wheelOnCtrl){this.wheelOnCtrlContainer&&this.wheelOnCtrlContainer.remove();for(var b=this.apiCore.exec(this.callerName,
"translate","controlZoomMessage").split("/"),d=[],f=0;f<b.length;f++)switch(b[f]){case "use":d.push({tagName:"span",attributes:{klass:"wheelOnCtrlFirstContainer",inner:this.apiCore.exec(this.callerName,"translate","use")}});break;case "CTRL":d.push({tagName:"span",attributes:{klass:"wheelOnCtrlSecondContainer",inner:this.apiCore.exec(this.callerName,"translate","CTRL")}});break;case "icon":d.push({tagName:"span",attributes:{klass:"wheelOnCtrlIconContainer"}});break;case "toZoomIn":d.push({tagName:"span",
attributes:{klass:"wheelOnCtrlLastContainer",inner:this.apiCore.exec(this.callerName,"translate","toZoomIn")}})}this.wheelOnCtrlContainer=this.mainContainer.build([{tagName:"div",returnActive:!0,attributes:{klass:"wheelOnCtrlGlobalContainer"},childs:[{tagName:"div",attributes:{klass:"wheelOnCtrlMainContainer"},childs:d}]}]);this.apiCore.exec(this.callerName,"lib.insertSvg",this.fullIcons.mouseWheel,{});this.zoomOnCtrlTransitionTimeout=null}},Tb=function(b){b.stopPropagation()},wc=function(b){b.stopPropagation()},
pd=function(b){b.stopPropagation()},bc=function(b){b.stopPropagation()},Uc=function(){if(this.settings.isReplay&&""!=this.settings.replayLink&&this.settings.configurationCode){var b=[{tagName:"a",returnActive:!0,attributes:{klass:"redirectButtonContainer",href:this.apiCore.exec(this.callerName,"translate","replay_link","Project")+this.settings.configurationCode,target:"_blank"},childs:[{tagName:"span",attributes:{klass:"redirectButtonSubContainer"},childs:[{tagName:"span",attributes:{klass:"redirectButtonTextContainer",
inner:this.apiCore.exec(this.callerName,"translate","customizeOrder")}},{tagName:"span",attributes:{klass:"redirectButtonArrowContainer"}}]}],events:[{onEvent:"mouseover",callback:stage.setContext(function(){this.redirectButtonContainer.css("background-color",this.settings.style.backgroundOverColor)},this)},{onEvent:"mouseout",callback:stage.setContext(function(){this.redirectButtonContainer.css("background-color","")},this)}]}];this.redirectButtonContainer=this.mainContainer.build(b);this.redirectButtonTextContainer=
this.redirectButtonContainer.find(".redirectButtonTextContainer");this.apiCore.exec(this.callerName,"lib.insertSvg",this.fullIcons.arrow,{width:"25px",height:"25px"});this.redirectButtonContainer.show()}},Lc=function(){for(var b=[this.emersyaIcon,this.partnerLogoLinkContainer,this.partnerLogoContainer],d=["path","text","tspan"],f=0;f<b.length;++f)for(var e=0;e<d.length;++e)b[f].find(d[e]).each(stage.setContext(function(b){b.attributes.fill&&(b.attributes.fill.value=this.settings.style.foregroundSelectedColor);
b.attributes.color&&(b.attributes.color.value=this.settings.style.foregroundSelectedColor)},this))},uc=function(){for(var b=[this.emersyaIcon,this.partnerLogoLinkContainer,this.partnerLogoContainer],d=["path","text","tspan"],f=0;f<b.length;++f)for(var e=0;e<d.length;++e)b[f].find(d[e]).each(stage.setContext(function(b){b.attributes.fill?b.attributes.fill.value=this.settings.style.logoNeutralColor:b.setAttribute("fill",this.settings.style.logoNeutralColor);b.attributes.color?b.attributes.color.value=
this.settings.style.logoNeutralColor:b.setAttribute("color",this.settings.style.logoNeutralColor)},this))},Ec=function(){if(this.settings.emersyaLogo){this.logoContainer&&this.logoContainer.remove();var b=[{tagName:"div",returnActive:!0,attributes:{id:"mainLogoContainer"},childs:[],events:[{onEvent:"click",callback:stage.setContext(function(){this.settings.clickableLogo&&window.open("https://emersya.com","_blank")},this)},{onEvent:"mouseover",callback:stage.setContext(Lc,this)},{onEvent:"mouseleave",
callback:stage.setContext(uc,this)}]}];this.settings.defaultLogo?b[0].childs.push({tagName:"div",attributes:{id:"emersyaIcon",klass:"emersyaLogo"}}):b[0].childs.push({tagName:"div",attributes:{id:"emersyaIcon",klass:"poweredByEmersyaTextContainer"},childs:[{tagName:"div",attributes:{id:"emersyaLogoContainer"}}]});2==this.settings.defaultLogo&&b[0].childs.push({tagName:"div",returnActive:!0,attributes:{klass:"partnerLogoMainContainer",style:{height:"17px",display:"inline-block","margin-left":"7px"}},
childs:[{tagName:"div",attributes:{klass:"partnerLogoLinkContainer",style:{height:"17px",display:"inline-block","margin-right":"9px","max-width":"17px"}}},{tagName:"div",attributes:{id:"partnerLogoContainer",klass:"partnerLogoContainer",xmlns:"http://www.w3.org/2000/svg",style:{display:"inline-block",height:"17px",width:"auto"}}}]});this.logoContainer=this.mainContainer.build(b);this.partnerLogoLinkContainer=this.logoContainer.find(".partnerLogoLinkContainer");this.partnerLogoContainer=this.logoContainer.find(".partnerLogoContainer");
this.emersyaIcon=this.logoContainer.find("#emersyaIcon");this.apiCore.exec(this.callerName,"lib.insertSvg",this.fullIcons.partnerLogoLinkIcon,{});b=null;b=this.settings.defaultLogo?this.fullIcons.emersyaIcon:this.fullIcons.emersyaPoweredByIcon;this.apiCore.exec(this.callerName,"lib.insertSvg",b,{});sb.call(this);2==this.settings.defaultLogo&&this.settings.customerLogoPath?this.settings.customerLogoPath.img?(b=new XMLHttpRequest,b.open("GET",this.settings.customerLogoPath.img),b.responseType="blob",
b.onload=stage.setContext(function(b){b=b.srcElement.response;var d=new FileReader;d.onload=stage.setContext(function(){this.partnerLogoContainer.get(0).innerHTML=d.result;this.partnerLogoContainer.find("path").each(stage.setContext(function(b){b.attributes.style&&(b.attributes.style.value="")},this));uc.call(this);Ub.call(this)},this);d.readAsText(b)},this),b.send()):this.svgIcon.loadFile(this.settings.customerLogoPath,stage.setContext(function(b){b.response.childNodes&&(this.partnerLogoContainer.get(0).innerHTML=
b.response.documentElement.outerHTML,this.partnerLogoContainer.find("path").each(stage.setContext(function(b){b.attributes.style&&(b.attributes.style.value="")},this)),uc.call(this),Ub.call(this))},this),stage.setContext(function(b){},this)):Ub.call(this)}},Ub=function(){var b=this.emersyaIcon.getWH().width;if(2==this.settings.defaultLogo){var d=this.logoContainer.find(".partnerLogoMainContainer");b+=d.getWH().width+parseInt(d.get(0).style["margin-left"].replace("px",""))}d="8px";var f="unset";switch(parseInt(this.settings.logoHorizontalPosition)){case 0:d=
"8px";f="unset";break;case 1:d="calc(50% - "+b/2+"px)";f="unset";break;case 2:d="unset",f="8px"}this.logoContainer.css({left:d,right:f,height:"18px",cursor:this.settings.clickableLogo?"pointer":"auto",width:b+"px"})},sb=function(){this.logoContainer&&(this.logoContainer.get(0).title=2==this.settings.defaultLogo?"Powered by Emersya | Customized by "+(this.settings.partnerName?this.settings.partnerName:this.settings.companyName):"Powered by Emersya")},Cb=function(b){this.startButton&&this.startButton.parent().remove();
skel=[{tagName:"div",attributes:{klass:"centerStart3DButton"},events:[{onEvent:"click",callback:stage.setContext(function(){this.apiCore.exec(this.callerName,"launch3D")},this)}],childs:[{tagName:"div",returnActive:!0,attributes:{klass:"start3DButton",id:"svgThreeDButton"}}]}];this.startButton=this.mainContainer.build(skel);this.apiCore.exec(this.callerName,"lib.insertSvg",this.fullIcons.threeDButton,{mouseOver:!0});this.startButtonDisplayed?ic.call(this):lb.call(this)},pc=function(b){this.settings.stop3DButton&&
(this.disable3DButton&&this.disable3DButton.remove(),skel=[{returnActive:!0,tagName:"div",attributes:{klass:"disable3D "},childs:[{tagName:"div",attributes:{klass:"disable3DText",inner:this.apiCore.exec(this.callerName,"translate","disable3D")}},{tagName:"div",attributes:{klass:"quitIco quitIcoDisabled quitIcoCell",id:"svgQuitIcon"}}],events:[{onEvent:"mouseover",callback:stage.setContext(function(){this.disable3DText.css({display:"inline-block"})},this)},{onEvent:"mouseout",callback:stage.setContext(function(){this.disable3DText.hide()},
this)},{onEvent:"click",callback:stage.setContext(function(){this.ignoreDisable3DButton||this.apiCore.exec(this.callerName,"disable3D",!1,!1)},this)}]}],this.disable3DButton=this.mainContainer.build(skel),this.disable3DText=this.disable3DButton.find(".disable3DText"),this.apiCore.exec(this.callerName,"lib.insertSvg",this.fullIcons.quitIcon,{mouseOver:!1}),this.disable3DText.css({color:b.backgroundNormalColor}),this.disable3DButton.css({"background-color":b.borderColor}),ac.call(this))},Pc=function(b,
d){var f="0px";switch(this.settings.presets.position){case 0:f="0px 0px 0px 2px";break;case 1:f="2px 0px 0px 0px";break;case 2:f="0px 2px 0px 0px";break;case 3:f="0px 0px 2px 0px"}this.presetsContainer.find(".selected").removeClass("selected");this.presetsContainer.find("#"+d).addClass("selected");2==parseInt(this.settings.presets.mode)&&(this.presetContainer.css({"border-width":f,"border-style":"solid","border-color":"rgba(0,0,0,0)"}),this.presetsContainer.find(".selected").css({"border-width":f,
"border-style":"solid","border-color":this.settings.style.foregroundSelectedColor}));this.presetName.css("color",this.settings.style.foregroundNormalColor);this.presetsContainer.find("#"+d+" .presetName").css("color",this.settings.style.foregroundSelectedColor);this.apiCore.exec(this.callerName,"applyPreset",b.name,[])},tb=function(){if(this.presets.length&&this.presetsContainer){var b=0,d=0,f=2==parseInt(this.settings.presets.position)||0==parseInt(this.settings.presets.position);1==parseInt(this.settings.presets.mode)||
2!=parseInt(this.settings.presets.mode)&&0!=parseInt(this.settings.presets.mode)||(1200<=this.currentWidth?d=b="100px":1200>this.currentWidth&&700<=this.currentWidth?d=b="80px":700>this.currentWidth&&(d=b="50px"),2==parseInt(this.settings.presets.position)||0==parseInt(this.settings.presets.position)?isNaN(parseFloat(this.presetContainer.get(0).style.marginLeft))?this.presetsContainer.css({width:b}):this.presetsContainer.css({width:"calc("+b+" + "+(2*parseFloat(this.presetContainer.get(0).style.marginLeft)+
"px")+")"}):this.presetsContainer.css({height:b}),1!=parseInt(this.settings.presets.mode)&&(this.outerBorder.css({width:b,height:d}),this.presetPreview.css({width:b,height:d})),this.presetContainer.css({width:b}),this.presetName.css({width:b}));f?(b=this.presets.length*this.presetContainer.first().getWH().height,this.presetSubContainer.css({height:b>this.currentHeight?b:"100%"}),1==this.settings.presets.mode&&(b=this.presetSubContainer.first().getWH().width/this.presets.length,this.presetSubContainer.css({width:b}))):
(b=this.presets.length*this.presetContainer.first().getWH().width,this.presetSubContainer.css({width:b>this.currentWidth?b:"100%"}))}},Hc=function(b,d){this.mainContainer.build([{tagName:"div",attributes:{id:"viewerMessage",inner:b}}])},Lb=function(b){for(var d=0;d<b.presets.length;d++){var f=b.presets[d];f.displayInWebService&&this.presets.push({name:f.name,preview:f.smallPreviewPath,color:f.color,id:f.id})}},Vc=function(b){this.presets&&this.presetsContainer&&this.presetsContainer.show()},vc=function(b){this.presets&&
this.presetsContainer&&this.presetsContainer.hide()},Ic=function(){},cc=function(b){if(-1!=b.indexOf("showcase")||-1!=b.indexOf("replay")||-1!=b.indexOf("presets")){var d=b.split("showcase");2>d.length&&(d=b.split("replay"),2>d.length&&(d=b.split("presets")));d=d[1].split("/");d=d[2];return b.replace("/"+d,"")}return-1!=b.indexOf("configurator")||-1!=b.indexOf("watch")?(d=b.split("configurator"),2>d.length&&(d=b.split("watch")),d=d[1].split("/"),d=d[3],b.replace("/"+d,"")):b},Pb=function(){this.fallbackCurrentlyDisplayed||
(this.backgroundImage&&(kc.call(this),ob.call(this)),this.previewImage&&(Db.call(this),yb.call(this)));this.uiReady=!0;var b=!1;try{b=window.opener&&-1!=window.location.href.indexOf(cc(window.opener.location.href))}catch(Nc){}this.fallbackCurrentlyDisplayed||this.settings.autoStart||b?(lb.call(this),this.apiCore.exec(this.callerName,"launch3D")):(this.apiCore.exec(this.callerName,"uiReady"),this.settings.displayMain3DButton&&ic.call(this))},jc=function(){this.backgroundImage&&(kc.call(this),ob.call(this));
this.previewImage&&(Db.call(this),yb.call(this));yb.call(this);ob.call(this);this.settings.loader.enabled=!1;this.settings.menu.enabled=!1;this.settings.annotations.enabled=!1;this.settings.help.enabled=!1;this.settings.configurator.enabled=!1},Oc=function(){this.uiReady&&(this.mainElement.removeClass("pointerClass"),T.call(this),S.call(this),$a.call(this,!1),B.call(this))},xc=function(b){b&&!this.fallbackCurrentlyDisplayed&&(!this.menu||b.annotations&&0!=b.annotations.length||this.menu.removeButton("annotationButton"),
!this.menu||b.triggers&&0!=b.triggers.length||this.menu.removeButton("triggerButton"),setTimeout(stage.setContext(function(){ib.call(this,b.annotations,b.triggers);pa.call(this,b.configurator);Wb.call(this);Pa.call(this);this.apiCore.exec(this.callerName,"toggleAnnotations","annotations",!this.settings.hideAnnotations);this.apiCore.exec(this.callerName,"toggleAnnotations","triggers",!this.settings.hideTriggers);this.settings.autoPlay&&(this.apiCore.exec(this.callerName,"ignoreNextFrames"),"ANNOTATIONS"!=
this.viewerPlayMode?this.apiCore.exec(this.callerName,"statsIgnoreNextInteractions",4):this.apiCore.exec(this.callerName,"statsIgnoreNextInteractions",null),this.apiCore.exec(this.callerName,"ui.changePlayMode","play"))},this),1))},Gc=function(){this.renderingWorkingTimeout=setTimeout(stage.setContext(function(){this.apiCore&&(this.renderingWorkingTimeout=null,this.apiCore.exec(this.callerName,"ui.showHandTutorial"))},this),this.settings.handTutorial.handTutorialInterval?this.settings.handTutorial.handTutorialInterval:
3E3)},Fc=function(){this.renderingStarted=!0;Yb.call(this);this.scrollingContainer&&this.scrollingContainer.show();lb.call(this);ba.call(this);U.call(this);ia.call(this);Rb.call(this);Hb.call(this);Uc.call(this);if(this.settings.presets.display)if(2<=this.settings.featuresLevel){var b="";switch(parseInt(this.settings.presets.position)){case 0:b="presetsPanelRight";break;case 1:b="presetsPanelBottom";break;case 2:b="presetsPanelLeft";break;case 3:b="presetsPanelTop"}for(var d={tagName:"div",attributes:{klass:"presetSubContainer"},
childs:[]},f=null,e=null,g=0;g<this.presets.length;g++){var h=this.presets[g],k=this.apiCore.exec(this.callerName,"translate","name"+h.id,"Preset")||h.name;k==this.settings.startingPreset&&(f=h,e=g);h={tagName:"div",attributes:{klass:"presetContainer",id:""+g,style:{opacity:1==this.settings.presets.mode?"1":.5,margin:1==this.settings.presets.mode||this.settings.presets.displayName?"5px":"auto"}},childs:[{tagName:"div",attributes:{klass:"outerBorder outerBorder"+this.settings.presets.mode,title:k,
style:{"background-color":1==this.settings.presets.mode?"rgba(0,0,0,0.5)":"rgba(0,0,0,0)"}},childs:[{tagName:"div",attributes:{klass:"presetPreview",alt:k,style:{"background-color":1==parseInt(this.settings.presets.mode)?"rgb("+255*h.color[0]+","+255*h.color[1]+","+255*h.color[2]+")":"rgba(0,0,0,0)","background-image":1==parseInt(this.settings.presets.mode)?null:"url('"+this.settings.dataPath+h.preview+"?date="+this.settings.loadingDate+"')","background-size":"contain","border-radius":1==this.settings.presets.mode?
"50%":0,left:1==this.settings.presets.mode?"6px":0,top:1==this.settings.presets.mode?"6px":0}}}]},{tagName:"div",attributes:{klass:"presetName",title:k,inner:k,style:{"background-color":this.settings.style.backgroundNormalColor,color:this.settings.style.foregroundNormalColor}}}],events:[{onEvent:"click",callback:stage.setContext(Pc,this,h,g)}]};d.childs.push(h)}this.presetsContainer=this.mainContainer.build([{tagName:"div",returnActive:!0,attributes:{klass:"presetsPanel "+b},childs:[d]}]);this.presetSubContainer=
this.presetsContainer.find(".presetSubContainer");this.presetPreview=this.presetsContainer.find(".presetPreview");this.presetName=this.presetsContainer.find(".presetName");this.presetContainer=this.presetsContainer.find(".presetContainer");this.outerBorder=this.presetsContainer.find(".outerBorder");tb.call(this);f&&Pc.call(this,f,e);this.settings.presets.displayName||this.presetName.remove();this.renderingStarted||vc.call(this)}else Hc.call(this,this.apiCore.exec(this.callerName,"translate","badFeaturesLevelMessage"),
"preset"),this.presets=[];(this.mouseGrab=this.settings.mouseGrab)&&this.mainElement.addClass("grabClass");!this.settings.startingTutorial.displayAfterLoading&&this.startingTutorial&&this.startingTutorial.hide()},dd=function(){ac.call(this);ha.call(this)},Qc=function(){ka.call(this);wa.call(this);Ra.call(this);Rb.call(this);Hb.call(this);Oa.call(this);ha.call(this);ac.call(this);this.annotations.toggleAnnotations("annotations",!1);this.annotations.toggleAnnotations("triggers",!1)},fc=function(){ba.call(this);
Ya.call(this);yb.call(this);ob.call(this);Qa.call(this);Pa.call(this);Yb.call(this);this.annotations.toggleAnnotations("annotations",!0);this.annotations.toggleAnnotations("triggers",!0)},vb=function(){},Fb=function(){this.settings=b;E.call(this,this.settings)},kc=function(){var b=this.parentElement.getWH();switch(this.settings.fittingMethod){case 0:gc.call(this,$$stage(this.backgroundImage),b.width,b.height);break;case 1:hc.call(this,$$stage(this.backgroundImage),b.width,b.height);break;case 2:$$stage(this.backgroundImage).css({width:b.width+
"px",height:b.height+"px","margin-top":"0px","margin-left":"0px",position:"absolute",top:0})}},Db=function(){if(this.previewImage){var b=this.parentElement.getWH();if(this.settings.adaptativeFov)gc.call(this,this.previewImageElement,b.width,b.height);else{var d=b.width/b.height,f=this.previewImageElement.get(0);d<f.naturalWidth/f.naturalHeight?hc.call(this,this.previewImageElement,b.width,b.height):gc.call(this,this.previewImageElement,b.width,b.height)}}},gc=function(b,d,f){var e=d/f;var g=b.get(0);
g=g.naturalWidth/g.naturalHeight;if(e>g){var h=f;e=h*g}else e=d,h=e/g;b.css({width:e+"px",height:h+"px","margin-top":(f-h)/2+"px","margin-left":(d-e)/2+"px",position:"absolute",top:0})},hc=function(b,d,f){var e=d/f;var g=b.get(0);g=g.naturalWidth/g.naturalHeight;if(e>g){e=d;var h=e/g}else h=f,e=h*g;b.css({width:e+"px",height:h+"px","margin-top":(f-h)/2+"px","margin-left":(d-e)/2+"px",position:"absolute",top:0})},rc=function(b,d){var f;if(1<b/d)var e=f=d;else f=e=b;this.squareCutoutElement.css({width:e+
"px",height:f+"px"});this.topSquareCutoutElement.css({height:(d-f)/2+"px"});this.bottomSquareCutoutElement.css({height:(d-f)/2+"px"});this.leftSquareCutoutElement.css({width:(b-e)/2+"px"});this.rightSquareCutoutElement.css({width:(b-e)/2+"px"});this.topSquareCutoutElement.css({"background-size":this.squareCutoutElement.getWidth()+"px "+.01*this.squareCutoutElement.getWidth()+"px"});this.bottomSquareCutoutElement.css({"background-size":this.squareCutoutElement.getWidth()+"px "+.01*this.squareCutoutElement.getWidth()+
"px"});this.leftSquareCutoutElement.css({"background-size":.01*this.squareCutoutElement.getHeight()+"px "+this.squareCutoutElement.getHeight()+"px"});this.rightSquareCutoutElement.css({"background-size":.01*this.squareCutoutElement.getHeight()+"px "+this.squareCutoutElement.getHeight()+"px"})};return d});stage.provide("emersya.viewer.modules.ui.loader");
stage.register.call(stage.emersya.viewer.modules.ui,"loader",function(){var b={backgroundNormalColor:"#303030",foregroundSelectedColor:"#00b1ab",foregroundNormalColor:"#ffffff",isColorful:!1,borderRadius:10,fontSize:13,displayLogo:!1,loaderType:0},d=function(d,l,g){this.settings=stage.extend(!0,{},b,g);this.apiCore=d;this.parentElement=l;this.displayed=null;this.callerName="UICore-Loader";this.svgIcon=stage.emersya.ui.svgIcon(null,this.settings);this.loaderIcons=this.svgIcon.getLoaderIcons();u.call(this)};
d.prototype.destroy=function(){};d.prototype.show=function(){this.loaderContainer.show();this.displayed=!0;this.updatePosition()};d.prototype.hide=function(){this.loaderContainer.hide();this.displayed=!1};d.prototype.update=function(b){1<b&&(b=1);b*=100;this.progressBarLoading.css({width:b+"%"});this.loadingPercent&&this.loadingPercent.update(Math.floor(b)+"%")};d.prototype.updatePosition=function(){this.displayed&&0==this.settings.loaderType&&this.loaderHackCenterContainer.css({"margin-left":(this.loaderContainer.selector[0].clientWidth-
this.loader.selector[0].clientWidth)/2})};d.prototype.updateLanguage=function(b){this.loadingText&&this.loadingText.update(this.apiCore.exec(this.callerName,"translate","loading"))};d.prototype.setStyle=function(b){b&&(this.settings.backgroundNormalColor=b.backgroundNormalColor,this.settings.foregroundSelectedColor=b.foregroundSelectedColor,this.settings.foregroundNormalColor=b.foregroundNormalColor);var d=this.apiCore.exec(this.callerName,"lib.hexToRgba",this.settings.backgroundNormalColor);b=this.apiCore.exec(this.callerName,
"lib.hexToRgba",this.settings.foregroundSelectedColor);var g=this.apiCore.exec(this.callerName,"lib.hexToRgba",this.settings.foregroundNormalColor),k=(.299*d.r+.587*d.g+.114*d.b)/255,t=(.299*b.r+.587*b.g+.114*b.b)/255;.3>Math.abs(k-(.299*g.r+.587*g.g+.114*g.b)/255)&&(g=.3<Math.abs(k-t)?b:.3<k?{r:0,g:0,b:0,a:255}:{r:255,g:255,b:255,a:255});0==this.settings.loaderType&&(this.settings.isColorful?(d=this.apiCore.exec(this.callerName,"lib.hexToRgba",this.settings.borderColor),this.loader.css({backgroundColor:"rgba("+
d.r+","+d.g+","+d.b+","+(.5>d.a/255?.5:d.a/255)+")","border-radius":this.settings.borderRadius+"px","min-height":12+this.settings.fontSize+"px"})):this.loader.css({backgroundColor:"rgba("+d.r+","+d.g+","+d.b+","+(.5>d.a/255?.5:d.a/255)+")","border-radius":this.settings.borderRadius+"px","min-height":12+this.settings.fontSize+"px"}),this.loadingTextContainer.css({"font-size":this.settings.fontSize+"px"}),d=this.loader.selector[0].clientWidth,k=this.loaderContainer.selector[0].clientWidth,this.loadingText.css({color:"rgb("+
g.r+","+g.g+","+g.b+")"}),this.loadingPercent.css({color:"rgb("+g.r+","+g.g+","+g.b+")"}),this.loaderHackCenterContainer.css({"margin-left":(k-d)/2}),this.loading.css({height:"25px"}),this.progressBarContainer.css({"margin-top":9+this.settings.fontSize+"px"}));if(this.settings.displayLogo){g=this.apiCore.exec(this.callerName,"lib.rgbaToHex",g);for(d=0;d<this.loaderIcons.emersyaPoweredByIcon.elems.length;d++)this.loaderIcons.emersyaPoweredByIcon.elems[d].attributes.fill=g;this.apiCore.exec(this.callerName,
"lib.insertSvg",this.loaderIcons.emersyaPoweredByIcon,{});this.loading&&(this.progressBarContainer.css({"margin-top":"26px"}),this.loading.css({height:"44px"}),this.loadingText.css({"margin-top":"2px"}))}this.progressBarContainer.css({backgroundColor:"rgba("+b.r+","+b.g+","+b.b+",0.2)"});this.progressBarLoading.css({backgroundColor:"rgba("+b.r+","+b.g+","+b.b+","+b.a/255+")"})};d.prototype.reload=function(b){this.settings=stage.extend(!0,{},this.settings,b);u.call(this)};d.prototype.setBorderRadius=
function(b){this.settings.borderRadius=b;0==this.settings.loaderType&&this.loader.css({"border-radius":this.settings.borderRadius+"px"})};d.prototype.setFontSize=function(b){this.settings.fontSize=b;0==this.settings.loaderType&&(this.loadingTextContainer.css({"font-size":this.settings.fontSize+"px"}),this.loader.css({"min-height":12+this.settings.fontSize+"px"}),this.progressBarContainer.css({"margin-top":9+this.settings.fontSize+"px"}))};var u=function(){this.loaderContainer&&this.loaderContainer.remove();
var b=[{tagName:"div",returnActive:!0,attributes:{klass:"loaderWideContainer"},childs:[]}];b[0].childs=0==this.settings.loaderType?[{tagName:"div",attributes:{klass:"loaderHackCenterContainer"},childs:[{tagName:"div",attributes:{klass:"emersya-loader"},childs:[{tagName:"div",attributes:{klass:"loading"},childs:[{tagName:"div",attributes:{klass:"loadingTextContainer"},childs:[{tagName:"div",attributes:{klass:"loadingText",inner:this.apiCore.exec(this.callerName,"translate","loading")}},{tagName:"div",
attributes:{klass:"loadingPercent",inner:"0%"}}]},{tagName:"div",attributes:{klass:"progressBarContainer"},childs:[{tagName:"div",attributes:{klass:"progressBarLoading"}}]}]},{tagName:"div",attributes:{klass:"poweredByEmersyaTextContainer"}}]}]}]:[{tagName:"div",attributes:{klass:"opacityContainer"}},{tagName:"div",attributes:{klass:"progressBarContainer"},childs:[{tagName:"div",attributes:{klass:"progressBarLoading"}}]},{tagName:"div",attributes:{klass:"poweredByEmersyaTextContainer poweredByEmersyaTextContainerWide"}}];
this.loaderContainer=$$stage(stage.build(this.parentElement.selector[0],b));this.loaderHackCenterContainer=this.loaderContainer.find(".loaderHackCenterContainer");this.progressBarLoading=this.loaderContainer.find(".progressBarLoading");this.progressBarContainer=this.loaderContainer.find(".progressBarContainer");this.logoContainer=this.loaderContainer.find(".poweredByEmersyaTextContainer");this.settings.displayLogo&&($$stage(stage.build(this.logoContainer.selector[0],[{tagName:"div",attributes:{id:"emersyaLoaderLogoContainer"}}])),
this.emersyaLogoContainer=this.logoContainer.find("#emersyaLogoContainer"));0==this.settings.loaderType&&(this.loader=this.loaderContainer.find(".emersya-loader"),this.loading=this.loaderContainer.find(".loading"),this.loadingText=this.loaderContainer.find(".loadingText"),this.loadingPercent=this.loaderContainer.find(".loadingPercent"),this.loadingTextContainer=this.loaderContainer.find(".loadingTextContainer"));this.setStyle();this.displayed||this.hide()};return d});stage.provide("emersya.viewer.modules.ui.menu");
stage.require("emersya.viewer.modules.ui.tooltip");
stage.register.call(stage.emersya.viewer.modules.ui,"menu",function(){var b={position:"left",backgroundColor:"#FFFFFF",borderColor:"#000000",backgroundNormalColor:"#FFFFFF",foregroundNormalColor:"#FFFFFF",enabled:!0,opened:!0,toggleable:!0},d=function(d,g,q){this.settings=stage.extend(!0,{},b,q);this.apiCore=d;this.callerName="UICore-Menu";this.playIconDisplayed=!0;this.parentElement=g.selector[0];this.displayed=null;this.opened=this.settings.opened;this.buttonTab=[];this.subMenuTab=[];this.tabAnims=
[];this.buttonSortedLeft="playButton pauseButton zoomInButton zoomOutButton moveButton rotateButton eyeButton triggerButton annotationButton resetAnimationButton helpButton fullScreenButton fullScreenOffButton".split(" ");this.buttonSortedBottom="playButton pauseButton zoomOutButton zoomInButton moveButton rotateButton eyeButton triggerButton annotationButton resetAnimationButton helpButton fullScreenButton fullScreenOffButton".split(" ");this.buttonToRemoveOnSmallSize="helpButton resetAnimationButton annotationButton triggerButton eyeButton moveButton rotateButton zoomInButton zoomOutButton playButton pauseButton fullScreenButton fullScreenOffButton".split(" ");
this.hideSubMenu=!0;this.selectedIcon={moveRotate:{icons:{},toggleable:!1,oneIconSelected:!0}};"left"==this.settings.position?(this.selectedIcon.moveRotate.icons.rotateIcon={},this.selectedIcon.moveRotate.icons.rotateIcon.displayed=!0):(this.selectedIcon.moveRotate.icons.rotateIconBot={},this.selectedIcon.moveRotate.icons.rotateIconBot.displayed=!0);this.svgIcon=stage.emersya.ui.svgIcon(null,this.settings);this.fullIcons=this.svgIcon.getFullIcons();this.buttonList=k.call(this);this.tooltip=new stage.emersya.viewer.modules.ui.tooltip(this.apiCore,
q);this.currentLang=null;u.call(this)};d.prototype.destroy=function(){};d.prototype.clear=function(){if(this.displayed){this.buttonTab=[];for(var b in this.subMenuTab)this.resetSelectedSubMenuIcon(this.buttonList[this.subMenuTab[b]].icon);this.subMenuTab=[];this.settings.enabled=!1;this.menuGlobalContainer.remove();this.menuGlobalContainer=null;u.call(this)}};d.prototype.show=function(){this.displayed=!0;this.menuGlobalContainer.show()};d.prototype.hide=function(){this.displayed=!1;this.menuGlobalContainer.hide();
this.setEyeIcon()};d.prototype.toggle=function(b){void 0===b&&(b=!this.displayed);b?this.show():this.hide()};d.prototype.resize=function(b,d){if(this.settings.enabled){"left"==this.settings.position?this.mainContainerMenu.css({top:"-"+d+"px"}):this.mainContainerMenu.css({left:-b+"px"});this.resetSubMenu();this.reload();this.displayed&&this.show();b=0;for(var g in this.iconsContainer.find("li").selector){var k=this.iconsContainer.find("li").get(g).currentStyle||window.getComputedStyle(this.iconsContainer.find("li").get(g));
b+=this.iconsContainer.find("li").get(g).offsetHeight+parseInt(k["margin-bottom"].replace("px",""))}b+=100;if(d<b)if(d=Math.ceil((b-d)/30),b=0,8<=d)this.hide();else for(g=0;g<this.buttonToRemoveOnSmallSize.length&&(!this.buttonList[this.buttonToRemoveOnSmallSize[g]]||(k=this.buttonList[this.buttonToRemoveOnSmallSize[g]],k="#svg"+k.icon[0].toUpperCase()+k.icon.slice(1,k.icon.length),$$stage(k).hide(),"eyeButton"==this.buttonToRemoveOnSmallSize[g]&&this.mainContainerMenu.find("#svgEyeIconHandle").hide(),
b++!=d));g++);this.tooltip&&this.tooltip.close();this.unpopulateTooltip();this.populateTooltip()}};d.prototype.setStyle=function(b){this.settings.backgroundOverColor=b.backgroundOverColor;this.settings.backgroundNormalColor=b.backgroundNormalColor;this.settings.backgroundSelectedColor=b.backgroundSelectedColor;this.settings.foregroundOverColor=b.foregroundOverColor;this.settings.foregroundNormalColor=b.foregroundNormalColor;this.settings.foregroundSelectedColor=b.foregroundSelectedColor;this.settings.neutralOverColor=
b.neutralOverColor;this.settings.neutralNormalColor=b.neutralNormalColor;this.settings.neutralSelectedColor=b.neutralSelectedColor;this.settings.borderColor=b.borderColor;this.iconsContainer.empty()};d.prototype.setDisplay=function(b){this.settings.enabled=b};d.prototype.setOffsetMenu=function(b){this.settings.offset=b};d.prototype.reload=function(b){this.menuGlobalContainer&&(this.menuGlobalContainer.remove(),this.menuGlobalContainer=null);u.call(this);var d="left"==this.settings.position?this.buttonSortedLeft:
this.buttonSortedBottom;for(var k in d)-1!=this.buttonTab.indexOf(d[k])&&this.addButton(d[k]),-1!=this.subMenuTab.indexOf(d[k])&&("eyeButton"==d[k]?this.addSubMenu(d[k],"icon"):this.addSubMenu(d[k],"string"));this.opened&&this.open();this.unpopulateTooltip();this.populateTooltip();b&&(this.openViewsMenu("svgEyeIcon"),this.tooltip.close());this.displayed||this.hide()};d.prototype.setPosition=function(b){if(this.settings.position!==b){this.settings.position=b;if("left"==b)for(var d in this.selectedIcon)this.selectedIcon[d].icon=
this.selectedIcon[d].icon.replace("Bot","");else for(d in this.selectedIcon)this.selectedIcon[d].icon+="Bot";this.reload()}};d.prototype.open=function(b){if(b){var d=this.parentElement.clientWidth,k=this.parentElement.clientHeight;b={framerate:20,duration:.2,mode:"relative",css:{}};b.css["left"==this.settings.position?"top":"left"]="left"==this.settings.position?k:d;d=stage.ui.animate(null,{});d.addElement(this.mainContainerMenu);d.addEffect("css",b);d.play()}else"left"==this.settings.position?this.mainContainerMenu.css({top:"0px"}):
this.mainContainerMenu.css({left:"0px"});this.opened=!0;-1==this.buttonTab.indexOf("playButton")&&-1==this.buttonTab.indexOf("pauseButton")?"left"==this.settings.position?(b=$$stage(this.parentElement).getWH()[0]-this.startBackground.getWH()[1],this.middleBackground.css({top:"26px",height:b+"px"})):(b=$$stage(this.parentElement).getWH()[1]-this.startBackground.getWH()[1],this.middleBackground.css({left:"30px",width:b+"px"})):"left"==this.settings.position?(b=$$stage(this.parentElement).getWH()[0]-
70,this.middleBackground.css({top:"70px",height:b+"px"})):(b=$$stage(this.parentElement).getWH()[1]-70,this.middleBackground.css({left:"70px",width:b+"px"}))};d.prototype.close=function(b){var d=this.parentElement.clientWidth,k=this.parentElement.clientHeight;b?(b={framerate:62,duration:.2,mode:"relative",css:{}},b.css["left"==this.settings.position?"top":"left"]="left"==this.settings.position?-k:-d,d=stage.ui.animate(null,{}),d.addElement(this.mainContainerMenu),d.addEffect("css",b),d.play()):"left"==
this.settings.position?this.mainContainerMenu.css({top:"-"+k+"px"}):this.mainContainerMenu.css({left:-d+"px"});this.opened=!1};d.prototype.addSubMenu=function(b,d){var g=this.buttonList[b];-1==this.subMenuTab.indexOf(b)&&this.subMenuTab.push(b);var k="svg"+g.icon[0].toUpperCase()+g.icon.slice(1,g.icon.length);this.tabAnims[k]=[];b=[{tagName:"li",attributes:{klass:g.klass+" subMenu",id:k},events:[{onEvent:"mouseover",callback:stage.setContext(function(b){this.openViewsMenu(k)},this)},{onEvent:"mouseout",
callback:stage.setContext(function(b){this.closeViewsMenu(k)},this)}],childs:[{tagName:"div",attributes:{id:k+"SubContainer"}}]},{tagName:"li",attributes:{klass:g.klass+" viewsIconHandle",id:k+"Handle"},events:[{onEvent:"mouseover",callback:stage.setContext(function(b){this.openViewsMenu(k)},this)},{onEvent:"mouseout",callback:stage.setContext(function(b){this.closeViewsMenu(k)},this)}]}];stage.build(this.iconsContainer.selector[0],b);this.apiCore.exec(this.callerName,"lib.insertSvg",this.fullIcons[g.icon],
{mouseOver:!0});"left"==this.settings.position?this.apiCore.exec(this.callerName,"lib.insertSvg",this.fullIcons.eyeIconHandle,{mouseOver:!0}):this.apiCore.exec(this.callerName,"lib.insertSvg",this.fullIcons.eyeIconHandleBot,{mouseOver:!0});if("icon"==d)for(var l in g.buttons)this.addButton(g.buttons[l],k+"SubContainer",g.type,k);else this.addSubList(g.buttons,k+"SubContainer",k);l=this.mainContainerMenu.find("#"+k+"SubContainer");"left"==this.settings.position?("icon"==d&&l.css({width:30*g.buttons.length+
"px"}),l.css({display:"none",position:"absolute",left:"33px"}),l.find("div").css({display:"inline-block","margin-right":"-5px","margin-left":"10px"})):(l.css({display:"none",height:30*(g.buttons.length-1)+"px",position:"absolute",bottom:"33px"}),l.find("div").css({"margin-top":"2px"}))};d.prototype.addButton=function(b,d,k,t){var g=this.buttonList[b];d&&(g.container=d,g.type=k);k="li";g.container&&(k="div");d||("bottom"==this.settings.position&&-1==g.icon.indexOf("Bot")&&(g.icon+="Bot"),"left"==this.settings.position&&
-1!=g.icon.indexOf("Bot")&&(g.icon=g.icon.substring(0,g.icon.length-3)));d=[{tagName:k,attributes:{klass:g.klass,id:"svg"+g.icon[0].toUpperCase()+g.icon.slice(1,g.icon.length)},events:[{onEvent:"click",callback:stage.setContext(function(b){switch(g.type){case "trigger":g.callback(!0);break;case "press":b.stopPropagation();break;case "toggle":g.callback(!0)}},this)},{onEvent:"mousedown",callback:function(b){switch(g.type){case "trigger":b.stopPropagation();break;case "press":g.callback(!0);break;case "toggle":b.stopPropagation()}}},
{onEvent:"mouseup",callback:function(b){switch(g.type){case "press":g.callback(!1)}}},{onEvent:"mouseout",callback:function(b){switch(g.type){case "press":g.callback(!1)}}}]}];g.container?stage.build(this.mainContainerMenu.find("#"+g.container).selector[0],d):(stage.build(this.iconsContainer.selector[0],d),-1==this.buttonTab.indexOf(b)&&this.buttonTab.push(b));this.apiCore.exec(this.callerName,"lib.insertSvg",this.fullIcons[g.icon],{mouseOver:!0})};d.prototype.addSubList=function(b,d,k){var g=[{tagName:"ul",
attributes:{klass:"subMenuList subMenuList"+k},childs:[]}],l;for(l in b)g[0].childs.push({tagName:"li",attributes:{klass:"subMenuElement subMenuElement_"+b[l],inner:this.apiCore.exec(this.callerName,"translate",this.buttonList[b[l]].name)},events:[{onEvent:"click",callback:stage.setContext(function(b,d){b.callback(!0);b.toggleable?-1!=this.mainContainerMenu.find(".subMenuElement_"+b.icon).get(0).className.indexOf("selected")?this.mainContainerMenu.find(".subMenuElement_"+b.icon).removeClass("selected"):
this.mainContainerMenu.find(".subMenuElement_"+b.icon).addClass("selected"):(this.mainContainerMenu.find(".subMenuList"+d).find(".selected").removeClass("selected"),this.mainContainerMenu.find(".subMenuElement_"+b.icon).addClass("selected"))},this,this.buttonList[b[l]],k)}]});stage.build(this.mainContainerMenu.find("#"+d).selector[0],g);this.mainContainerMenu.find(".subMenuList").css({backgroundColor:this.settings.backgroundNormalColor.substring(0,7),color:this.settings.foregroundNormalColor.substring(0,
7)});this.mainContainerMenu.find(".selected").css({color:this.settings.foregroundSelectedColor.substring(0,7)})};d.prototype.removeButton=function(b){this.buttonList[b]&&(-1!=this.subMenuTab.indexOf(b)?(this.mainContainerMenu.find("#svg"+this.buttonList[b].icon[0].toUpperCase()+this.buttonList[b].icon.slice(1,this.buttonList[b].icon.length)+"Handle").remove(),this.mainContainerMenu.find("#svg"+this.buttonList[b].icon[0].toUpperCase()+this.buttonList[b].icon.slice(1,this.buttonList[b].icon.length)).remove(),
this.subMenuTab.splice(this.subMenuTab.indexOf(b),1)):-1!=this.buttonTab.indexOf(b)&&(this.mainContainerMenu.find("#svg"+this.buttonList[b].icon[0].toUpperCase()+this.buttonList[b].icon.slice(1,this.buttonList[b].icon.length)).remove(),this.buttonTab.splice(this.buttonTab.indexOf(b),1)))};d.prototype.changeRotateIcon=function(b,d){this.displayed&&(this.tooltip&&this.tooltip.close(),this.iconsContainer.children()&&this.iconsContainer.children().get(0)&&("play"==b?(this.playIconDisplayed=!1,-1!=this.iconsContainer.children().get(0).id.indexOf("Play")&&
(this.removeButton("playButton"),this.addButton("pauseButton"))):(this.playIconDisplayed=!0,-1!=this.iconsContainer.children().get(0).id.indexOf("Pause")&&(this.removeButton("pauseButton"),this.addButton("playButton")))),this.reload(d))};d.prototype.changeFullScreenIcon=function(b){"On"==b?(this.removeButton("fullScreenButton"),this.addButton("fullScreenOffButton")):(this.removeButton("fullScreenOffButton"),this.addButton("fullScreenButton"))};d.prototype.selectIcon=function(b,d,k,t){if(d&&(this.selectedIcon[d]||
(this.selectedIcon[d]={},this.selectedIcon[d].icons={},this.selectedIcon[d].oneIconSelected=t),this.selectedIcon[d].icons[b]||(this.selectedIcon[d].icons[b]={},this.selectedIcon[d].icons[b].displayed=k?k:!1),k&&(this.selectedIcon[d].icons[b].displayed=k),!this.selectedIcon[d].oneIconSelected||this.selectedIcon[d].oneIconSelected&&!this.selectedIcon[d].icons[b].displayed)){if(this.selectedIcon[d].oneIconSelected){for(var g in this.selectedIcon[d].icons)this.selectedIcon[d].icons[g].displayed=!1,this.fullIcons[g].elems[0].attributes.fill=
this.fullIcons[b].elems[0].normalColor,this.fullIcons[g].elems[1].attributes.fill=this.fullIcons[b].elems[1].normalColor,this.apiCore.exec(this.callerName,"lib.insertSvg",this.fullIcons[g],{mouseOver:!0});this.selectedIcon[d].icons[b].displayed=!0}this.selectedIcon[d].icons[b].displayed?(this.fullIcons[b].elems[0].attributes.fill=this.fullIcons[b].elems[0].selectedColor,this.fullIcons[b].elems[1].attributes.fill=this.fullIcons[b].elems[1].selectedColor):(this.fullIcons[b].elems[0].attributes.fill=
this.fullIcons[b].elems[0].normalColor,this.fullIcons[b].elems[1].attributes.fill=this.fullIcons[b].elems[1].normalColor);this.selectedIcon[d].icons[b].displayed=!this.selectedIcon[d].icons[b].displayed;this.apiCore.exec(this.callerName,"lib.insertSvg",this.fullIcons[b],{mouseOver:!0})}};d.prototype.selectSubMenuIcon=function(b,d){if(this.opened){this.resetSelectedSubMenuIcon(d);var g=this.iconsContainer.find("#svg"+b[0].toUpperCase()+b.slice(1,b.length));g.addClass(b+"Selected");this[d]=b;d="svg"+
d[0].toUpperCase()+d.slice(1,d.length);0<g.length&&(this.fullIcons[b].elems[3]&&(g.find("path").get(3).setAttributeNS(null,"fill",this.settings.neutralSelectedColor.substring(0,7)),this.fullIcons[b].elems[3].normalColor="neutralSelectedColor",this.fullIcons[b].elems[3].attributes.fill="neutralSelectedColor"),g.find("path").get(1).setAttributeNS(null,"fill",this.settings.backgroundSelectedColor.substring(0,7)),this.fullIcons[b].elems[1].normalColor="backgroundSelectedColor",this.fullIcons[b].elems[1].attributes.fill=
"backgroundSelectedColor");this.apiCore.exec(this.callerName,"lib.insertSvg",this.fullIcons[b],{mouseOver:!0});this.mainContainerMenu.find("#"+d).find("path").get(0).setAttributeNS(null,"fill-opacity",0)}};d.prototype.resetSelectedSubMenuIcon=function(b){if(null!=this[b]){var d="svg"+b[0].toUpperCase()+b.slice(1,b.length);d=this.mainContainerMenu.find("#"+d).find("#svg"+this[b][0].toUpperCase()+this[b].slice(1,this[b].length));d.removeClass(this[b]+"Selected");0<d.length&&(this.fullIcons[this[b]].elems[3]&&
(d.find("path").get(3).setAttributeNS(null,"fill",this.settings.neutralNormalColor.substring(0,7)),this.fullIcons[this[b]].elems[3].normalColor="neutralNormalColor",this.fullIcons[this[b]].elems[3].attributes.fill="neutralNormalColor"),d.find("path").get(1).setAttributeNS(null,"fill",this.settings.backgroundNormalColor.substring(0,7)),this.fullIcons[this[b]].elems[1].normalColor="backgroundNormalColor",this.fullIcons[this[b]].elems[1].attributes.fill="backgroundSelectedColor")}};d.prototype.setEyeIcon=
function(){this.apiCore.exec(this.callerName,"lib.insertSvg",this.fullIcons.eyeIcon,{mouseOver:!0})};d.prototype.resetSubMenu=function(){for(var b in this.subMenuTab){var d=this.buttonList[this.subMenuTab[b]].icon,k="#svg"+d[0].toUpperCase()+d.slice(1,d.length);this.resetSelectedSubMenuIcon(d);0<$$stage(k).length&&$$stage(k).find("svg").last().remove();this.apiCore.exec(this.callerName,"lib.insertSvg",this.fullIcons[d],{mouseOver:!0})}};d.prototype.openViewsMenu=function(b){for(var d=0;d<this.tabAnims[b].length;d++)null!=
this.tabAnims[b][d]&&this.tabAnims[b][d].hearBeat.stop();this.mainContainerMenu.find("#"+b+"SubContainer").show();this.mainContainerMenu.find("#"+b+"SubContainer").children().each(stage.setContext(function(d,g,k){k={framerate:25,duration:.05*("left"==this.settings.position?g+1:6-g+1),mode:"absolute",css:{opacity:1}};var f={onStop:stage.setContext(function(){this.tabAnims[g]=null},this)};this.tabAnims[b][g]=stage.ui.animate(null,f);this.tabAnims[b][g].addElement(d);this.tabAnims[b][g].addEffect("css",
k);this.tabAnims[b][g].play()},this))};d.prototype.closeViewsMenu=function(b){for(var d=0;d<this.tabAnims[b].length;d++)null!=this.tabAnims[b][d]&&this.tabAnims[b][d].hearBeat.stop();var k=this.mainContainerMenu.find("#"+b+"SubContainer").children().selector;for(d=k.length-1;0<=d;d--){var l={framerate:25,duration:.05*("left"==this.settings.position?6-d+1:d+1),mode:"absolute",css:{opacity:0}},r=d==("left"==this.settings.position?0:6)?{onStop:stage.setContext(function(){$$stage(this.containerViews).hide();
this.mainContainerMenu.find("#"+b+"SubContainer").hide();this.anim=null},this)}:{onStop:stage.setContext(function(){this.tabAnims[d]=null},this)};this.tabAnims[b][d]=stage.ui.animate(null,r);this.tabAnims[b][d].addElement(k[d]);this.tabAnims[b][d].addEffect("css",l);this.tabAnims[b][d].play()}};d.prototype.updateLanguage=function(){this.unpopulateTooltip();this.populateTooltip()};d.prototype.closeSubMenu=function(b){"listenEvent"===b&&(this.hideSubMenu=!1);this.hideSubMenu&&this.tabAnims.svgEyeIcon&&
(this.setEyeIcon(),this.closeViewsMenu("svgEyeIcon"),this.tooltip.close())};d.prototype.listenViewerEvent=function(){this.hideSubMenu=!0};var u=function(){if(!this.menuGlobalContainer){var b=this.settings.position[0].toUpperCase()+this.settings.position.slice(1,this.settings.position.length);this.menu=$$stage(stage.build(this.parentElement,[{tagName:"div",attributes:{klass:"menuGlobalContainer"+b},childs:[{tagName:"div",attributes:{klass:"mainContainerMenu mainContainerMenu"+b},events:[{onEvent:"click",
callback:function(b){b.stopPropagation()}},{onEvent:"mousedown",callback:function(b){b.stopPropagation()}}],childs:[{tagName:"div",attributes:{klass:"backgroundContainer"},childs:[{tagName:"div",attributes:{klass:"closeHandle",id:"closeHandleContainer"}},{tagName:"div",attributes:{klass:"startBackground"}},{tagName:"div",attributes:{klass:"middleBackground"}},{tagName:"div",attributes:{klass:"endBackground"}},{tagName:"div",attributes:{klass:"openHandle",id:"openHandleContainer"}}]},{tagName:"ul",
attributes:{klass:"iconsContainer"}}]}]}]));this.mainContainerMenu=this.menu.find(".mainContainerMenu");this.closeHandle=this.menu.find(".closeHandle");this.startBackground=this.menu.find(".startBackground");this.middleBackground=this.menu.find(".middleBackground");this.endBackground=this.menu.find(".endBackground");this.openHandle=this.menu.find(".openHandle");this.iconsContainer=this.menu.find(".iconsContainer");this.menuGlobalContainer=this.menu.find(".menuGlobalContainer"+b);"left"==this.settings.position?
(b=$$stage(this.parentElement).getWH()[0]-26,this.mainContainerMenu.css({marginLeft:this.settings.offset+"px"}),this.iconsContainer.css({height:b+"px"})):(b=$$stage(this.parentElement).getWH()[1]-26,this.mainContainerMenu.css({marginBottom:this.settings.offset+"px"}),this.iconsContainer.css({width:b+"px"}));this.settings.toggleable||this.closeHandle.hide();this.endBackground.css({"background-color":this.settings.borderColor.substring(0,7),opacity:1/(255/parseInt(this.settings.borderColor.substring(7,
9),16))});this.startBackground.css({"background-color":this.settings.borderColor.substring(0,7),opacity:1/(255/parseInt(this.settings.borderColor.substring(7,9),16))});this.middleBackground.css({"background-color":this.settings.borderColor.substring(0,7),opacity:1/(255/parseInt(this.settings.borderColor.substring(7,9),16))});this.addButton("buttonCloseHandle");this.addButton("buttonOpenHandle");this.opened?this.open():this.close(!1)}};d.prototype.populateTooltip=function(){var b="left"==this.settings.position;
this.tooltip.manage(this.mainContainerMenu.find(".closeHandle"),this.apiCore.exec(this.callerName,"translate","close"),b?0:5,b?{deltaX:5,deltaY:3}:{deltaY:9,deltaX:-4});this.tooltip.manage(this.mainContainerMenu.find(".openHandle"),this.apiCore.exec(this.callerName,"translate","open"),0,{deltaX:5});this.settings.displayPlay&&(this.tooltip.manage(b?this.mainContainerMenu.find("#svgPlayIcon"):this.mainContainerMenu.find("#svgPlayIconBot"),this.apiCore.exec(this.callerName,"translate","play"),b?0:1,
b?{deltaX:-2}:{deltaY:-3}),this.tooltip.manage(b?this.mainContainerMenu.find("#svgPauseIcon"):this.mainContainerMenu.find("#svgPauseIconBot"),this.apiCore.exec(this.callerName,"translate","pause"),b?0:1,b?{deltaX:-2}:{deltaY:-3}));this.settings.displayZoomIn&&this.tooltip.manage(b?this.mainContainerMenu.find("#svgZoomInIcon"):this.mainContainerMenu.find("#svgZoomInIconBot"),this.apiCore.exec(this.callerName,"translate","zoomIn"),b?0:1,b?{deltaX:3}:{deltaY:4});this.settings.displayZoomOut&&this.tooltip.manage(b?
this.mainContainerMenu.find("#svgZoomOutIcon"):this.mainContainerMenu.find("#svgZoomOutIconBot"),this.apiCore.exec(this.callerName,"translate","zoomOut"),b?0:1,b?{deltaX:3}:{deltaY:4});this.settings.displayMove&&this.tooltip.manage(b?this.mainContainerMenu.find("#svgMoveIcon"):this.mainContainerMenu.find("#svgMoveIconBot"),this.apiCore.exec(this.callerName,"translate","translate"),b?0:1,b?{deltaX:3}:{deltaY:4});this.settings.displayRotate&&this.tooltip.manage(b?this.mainContainerMenu.find("#svgRotateIcon"):
this.mainContainerMenu.find("#svgRotateIconBot"),this.apiCore.exec(this.callerName,"translate","rotate"),b?0:1,b?{deltaX:3}:{deltaY:4});this.settings.displayTriggers&&this.tooltip.manage(b?this.mainContainerMenu.find("#svgTriggerIcon"):this.mainContainerMenu.find("#svgTriggerIconBot"),this.apiCore.exec(this.callerName,"translate","toggleTriggers"),b?0:1,b?{deltaX:3}:{deltaY:4});this.settings.displayAnnotations&&this.tooltip.manage(b?this.mainContainerMenu.find("#svgAnnotationIcon"):this.mainContainerMenu.find("#svgAnnotationIconBot"),
this.apiCore.exec(this.callerName,"translate","toggleAnnotations"),b?0:1,b?{deltaX:3}:{deltaY:4});this.settings.displayFullScreen&&this.tooltip.manage(b?this.mainContainerMenu.find("#svgFullscreenIcon"):this.mainContainerMenu.find("#svgFullscreenIconBot"),this.apiCore.exec(this.callerName,"translate","fullscreen"),b?0:1,b?{deltaX:3}:{deltaY:4});this.settings.displayHelper&&this.tooltip.manage(b?this.mainContainerMenu.find("#svgHelpIcon"):this.mainContainerMenu.find("#svgHelpIconBot"),this.apiCore.exec(this.callerName,
"translate","help"),b?0:3);this.settings.displayResetAnimation&&this.tooltip.manage(this.mainContainerMenu.find("#svgResetAnimationIcon"),this.apiCore.exec(this.callerName,"translate","resetAnimation"),"left"==this.settings.position?0:1,"left"==this.settings.position?{deltaX:3}:{deltaY:4});this.settings.displayViews&&(this.tooltip.manage(this.mainContainerMenu.find("#svgEyeIcon"),this.apiCore.exec(this.callerName,"translate","views"),b?2:5,b?{deltaX:5,deltaY:1}:{deltaX:2,deltaY:4}),this.tooltip.manage(this.mainContainerMenu.find("#svgEyeIconHandle"),
this.apiCore.exec(this.callerName,"translate","views"),b?2:5,b?{deltaX:2,deltaY:8}:{deltaX:9,deltaY:1}),this.tooltip.manage(this.mainContainerMenu.find("#svgItemAngle1"),this.apiCore.exec(this.callerName,"translate","view0"),b?2:5,b?{deltaX:2,deltaY:8}:{deltaX:9,deltaY:1}),this.tooltip.manage(this.mainContainerMenu.find("#svgItemAngle2"),this.apiCore.exec(this.callerName,"translate","view1"),b?2:5,b?{deltaX:2,deltaY:8}:{deltaX:9,deltaY:1}),this.tooltip.manage(this.mainContainerMenu.find("#svgItemAngle3"),
this.apiCore.exec(this.callerName,"translate","view2"),b?2:5,b?{deltaX:2,deltaY:8}:{deltaX:9,deltaY:1}),this.tooltip.manage(this.mainContainerMenu.find("#svgItemAngle4"),this.apiCore.exec(this.callerName,"translate","view3"),b?2:5,b?{deltaX:2,deltaY:8}:{deltaX:9,deltaY:1}),this.tooltip.manage(this.mainContainerMenu.find("#svgItemAngle5"),this.apiCore.exec(this.callerName,"translate","view4"),b?2:5,b?{deltaX:2,deltaY:8}:{deltaX:9,deltaY:1}),this.tooltip.manage(this.mainContainerMenu.find("#svgItemAngle6"),
this.apiCore.exec(this.callerName,"translate","view5"),b?2:5,b?{deltaX:2,deltaY:8}:{deltaX:9,deltaY:1}),this.tooltip.manage(this.mainContainerMenu.find("#svgItemAngle7"),this.apiCore.exec(this.callerName,"translate","view6"),b?2:5,b?{deltaX:2,deltaY:8}:{deltaX:9,deltaY:1}))};d.prototype.unpopulateTooltip=function(){this.tooltip.unlisten(this.mainContainerMenu.find(".closeHandle"));this.tooltip.unlisten(this.mainContainerMenu.find(".openHandle"));this.tooltip.unlisten(this.mainContainerMenu.find("#svgEyeIcon"));
this.tooltip.unlisten(this.mainContainerMenu.find("#svgEyeIconHandle"));this.tooltip.unlisten(this.mainContainerMenu.find("#svgItemAngle1"));this.tooltip.unlisten(this.mainContainerMenu.find("#svgItemAngle2"));this.tooltip.unlisten(this.mainContainerMenu.find("#svgItemAngle3"));this.tooltip.unlisten(this.mainContainerMenu.find("#svgItemAngle4"));this.tooltip.unlisten(this.mainContainerMenu.find("#svgItemAngle5"));this.tooltip.unlisten(this.mainContainerMenu.find("#svgItemAngle6"));this.tooltip.unlisten(this.mainContainerMenu.find("#svgItemAngle7"));
"left"==this.settings.position?(this.tooltip.unlisten(this.mainContainerMenu.find("#svgPlayIcon")),this.tooltip.unlisten(this.mainContainerMenu.find("#svgPauseIcon")),this.tooltip.unlisten(this.mainContainerMenu.find("#svgZoomInIcon")),this.tooltip.unlisten(this.mainContainerMenu.find("#svgZoomOutIcon")),this.tooltip.unlisten(this.mainContainerMenu.find("#svgMoveIcon")),this.tooltip.unlisten(this.mainContainerMenu.find("#svgRotateIcon")),this.tooltip.unlisten(this.mainContainerMenu.find("#svgTriggerIcon")),
this.tooltip.unlisten(this.mainContainerMenu.find("#svgAnnotationIcon")),this.tooltip.unlisten(this.mainContainerMenu.find("#svgFullscreenIcon")),this.tooltip.unlisten(this.mainContainerMenu.find("#svgHelpIcon"))):(this.tooltip.unlisten(this.mainContainerMenu.find("#svgPlayIconBot")),this.tooltip.unlisten(this.mainContainerMenu.find("#svgPauseIconBot")),this.tooltip.unlisten(this.mainContainerMenu.find("#svgZoomInIconBot")),this.tooltip.unlisten(this.mainContainerMenu.find("#svgZoomOutIconBot")),
this.tooltip.unlisten(this.mainContainerMenu.find("#svgMoveIconBot")),this.tooltip.unlisten(this.mainContainerMenu.find("#svgRotateIconBot")),this.tooltip.unlisten(this.mainContainerMenu.find("#svgTriggerIconBot")),this.tooltip.unlisten(this.mainContainerMenu.find("#svgAnnotationIconBot")),this.tooltip.unlisten(this.mainContainerMenu.find("#svgFullscreenIconBot")),this.tooltip.unlisten(this.mainContainerMenu.find("#svgHelpIconBot")))};var k=function(){var b=[[0,0,1],[0,0,-1],[-1,0,0],[1,0,0],[0,1,
1E-4],[0,-1,1E-4],[1,1,1]],d=[[0,1,0],[0,0,1]],k={buttonCloseHandle:{klass:"small",name:"close",icon:"closeHandleMenu",type:"trigger",container:"closeHandleContainer",callback:stage.setContext(function(){this.apiCore.exec(this.callerName,"ui.closeMenu",!0)},this)},buttonOpenHandle:{klass:"small",name:"open",icon:"openHandleMenu",type:"trigger",container:"openHandleContainer",callback:stage.setContext(function(){this.apiCore.exec(this.callerName,"ui.openMenu",!0)},this)},playButton:{klass:"big",name:"play",
icon:"playIcon",type:"trigger",callback:stage.setContext(function(){this.apiCore.exec(this.callerName,"ui.changePlayMode","play")},this)},pauseButton:{klass:"big",name:"pause",icon:"pauseIcon",type:"trigger",callback:stage.setContext(function(){this.apiCore.exec(this.callerName,"ui.changePlayMode","pause")},this)},zoomInButton:{klass:"small",name:"ZoomIn",icon:"zoomInIcon",type:"press",callback:stage.setContext(function(b){b?(this.apiCore.exec(this.callerName,"keyPress","zoomIn"),this.apiCore.exec(this.callerName,
"ui.changePlayMode","pause")):this.apiCore.exec(this.callerName,"keyRelease","zoomIn")},this)},zoomOutButton:{klass:"small",name:"ZoomOut",icon:"zoomOutIcon",type:"press",callback:stage.setContext(function(b){b?(this.apiCore.exec(this.callerName,"keyPress","zoomOut"),this.apiCore.exec(this.callerName,"ui.changePlayMode","pause")):this.apiCore.exec(this.callerName,"keyRelease","zoomOut")},this)},moveButton:{klass:"small",name:"Move",icon:"moveIcon",type:"trigger",callback:stage.setContext(function(){this.apiCore.exec(this.callerName,
"setMouseControlMode",stage.emersya.viewer.MOUSE_CONTROL_MODES.TRANSLATE);this.apiCore.exec(this.callerName,"ui.selectIcon",k.moveButton.icon,"moveRotate",null,!0);this.apiCore.exec(this.callerName,"ui.changePlayMode","pause")},this)},rotateButton:{klass:"small",name:"Rotate",icon:"rotateIcon",type:"trigger",callback:stage.setContext(function(){this.apiCore.exec(this.callerName,"setMouseControlMode",stage.emersya.viewer.MOUSE_CONTROL_MODES.ROTATE);this.apiCore.exec(this.callerName,"ui.selectIcon",
k.rotateButton.icon,"moveRotate",null,!0);this.apiCore.exec(this.callerName,"ui.changePlayMode","pause")},this)},itemAngle1:{klass:"small",name:"itemAngle1",title:this.apiCore.exec(this.callerName,"translate","view0"),icon:"itemAngle1",callback:stage.setContext(function(){this.apiCore.exec(this.callerName,"setRotationCamera",b[0],d[0],"listenEvent")&&this.apiCore.exec(this.callerName,"ui.changePlayMode","pause",!0,"itemAngle1","eyeIcon")},this)},itemAngle2:{klass:"small",name:"itemAngle2",icon:"itemAngle2",
title:this.apiCore.exec(this.callerName,"translate","view1"),callback:stage.setContext(function(){this.apiCore.exec(this.callerName,"setRotationCamera",b[1],d[0],"listenEvent")&&this.apiCore.exec(this.callerName,"ui.changePlayMode","pause",!0,"itemAngle2","eyeIcon")},this)},itemAngle3:{klass:"small",name:"itemAngle3",icon:"itemAngle3",title:this.apiCore.exec(this.callerName,"translate","view2"),callback:stage.setContext(function(){this.apiCore.exec(this.callerName,"setRotationCamera",b[2],d[0],"listenEvent")&&
this.apiCore.exec(this.callerName,"ui.changePlayMode","pause",!0,"itemAngle3","eyeIcon")},this)},itemAngle4:{klass:"small",name:"itemAngle4",icon:"itemAngle4",title:this.apiCore.exec(this.callerName,"translate","view3"),callback:stage.setContext(function(){this.apiCore.exec(this.callerName,"setRotationCamera",b[3],d[0],"listenEvent")&&this.apiCore.exec(this.callerName,"ui.changePlayMode","pause",!0,"itemAngle4","eyeIcon")},this)},itemAngle5:{klass:"small",name:"itemAngle5",icon:"itemAngle5",title:this.apiCore.exec(this.callerName,
"translate","view4"),callback:stage.setContext(function(){this.apiCore.exec(this.callerName,"setRotationCamera",b[4],d[1],"listenEvent")&&this.apiCore.exec(this.callerName,"ui.changePlayMode","pause",!0,"itemAngle5","eyeIcon")},this)},itemAngle6:{klass:"small",name:"itemAngle6",icon:"itemAngle6",title:this.apiCore.exec(this.callerName,"translate","view5"),callback:stage.setContext(function(){this.apiCore.exec(this.callerName,"setRotationCamera",b[5],d[1],"listenEvent")&&this.apiCore.exec(this.callerName,
"ui.changePlayMode","pause",!0,"itemAngle6","eyeIcon")},this)},itemAngle7:{klass:"small",name:"itemAngle7",icon:"itemAngle7",title:this.apiCore.exec(this.callerName,"translate","view6"),callback:stage.setContext(function(){this.apiCore.exec(this.callerName,"setRotationCamera",b[6],d[0],"listenEvent")&&this.apiCore.exec(this.callerName,"ui.changePlayMode","pause",!0,"itemAngle7","eyeIcon")},this)},eyeButton:{klass:"small",name:"eye",icon:"eyeIcon",type:"trigger",buttons:"itemAngle1 itemAngle2 itemAngle3 itemAngle4 itemAngle5 itemAngle6 itemAngle7".split(" ")},
triggerButton:{klass:"small",name:"trigger",icon:"triggerIcon",type:"toggle",callback:stage.setContext(function(){this.apiCore.exec(this.callerName,"toggleAnnotations","triggers")},this)},annotationButton:{klass:"small",name:"annotation",icon:"annotationIcon",type:"toggle",callback:stage.setContext(function(){this.apiCore.exec(this.callerName,"toggleAnnotations","annotations")},this)},resetAnimationButton:{klass:"small",name:"resetAnimation",icon:"resetAnimationIcon",type:"toggle",callback:stage.setContext(function(){this.apiCore.exec(this.callerName,
"resetAnimations","annotations")},this)},helpButton:{klass:"small",name:"help",icon:"helpIcon",type:"trigger",callback:stage.setContext(function(){this.apiCore.exec(this.callerName,"ui.showHelp")},this)},fullScreenButton:{klass:"small",name:"fullscreen",icon:"fullscreenIcon",type:"trigger",callback:stage.setContext(function(){this.apiCore.exec(this.callerName,"toggleFullScreen",!1)},this)},fullScreenOffButton:{klass:"small",name:"fullscreen",icon:"fullscreenIconOff",type:"trigger",callback:stage.setContext(function(){this.apiCore.exec(this.callerName,
"toggleFullScreen",!0)},this)}};return k};return d});stage.provide("emersya.viewer.modules.ui.help");
stage.register.call(stage.emersya.viewer.modules.ui,"help",function(){var b={mouseButtonInteraction:!0,mouseMoveInteraction:!0,mouseWheelInteraction:!0,touchInteraction:!0,wheelOnCtrl:!1,backgroundColor:"#FFFFFF",normalColor:"#FFFFFF",borderColor:"#000000",backgroundNormalColor:"#000000",backgroundOverColor:"#FFFFFF",foregroundNormalColor:"#000000",foregroundOverColor:"#FFFFFF"},d=function(d,g,k){this.settings=stage.extend(!0,{},b,k);this.apiCore=d;this.callerName="UICore-Helper";this.parentElement=
g.selector[0];this.mobileView=this.displayed=!1;this.svgIcon=stage.emersya.ui.svgIcon(null,this.settings);this.fullIcons=this.svgIcon.getHelperIcons();this.viewerLanguages=this.apiCore.exec(this.callerName,"getLanguages");this.device=this.apiCore.exec(this.callerName,"getDevice");f.call(this)};d.prototype.destroy=function(){};d.prototype.toggle=function(b){void 0!==b?b?this.show():this.hide():this.displayed?this.hide():this.show()};d.prototype.show=function(){this.displayed=!0;this.helpContainer.show();
this.resize();this.apiCore.exec(this.callerName,"onHelpDisplayed")};d.prototype.hide=function(){this.displayed=!1;this.helpContainer.hide();this.apiCore.exec(this.callerName,"onHelpHide")};d.prototype.resize=function(b,d){this.displayed&&(b||(b=window.innerWidth),this.device.isMobile&&this.helpWindowContainer.css({"max-width":"unset",width:"100%"}),560<b?(this.mobileView=!1,this.languageMainContainer.css({width:"",margin:""}),this.languageContainer.css("width",""),this.actionContainer.css({margin:"0px 10px",
"min-width":"140px"})):(this.mobileView=!0,this.languageMainContainer.css({width:this.languageContainer.length*(this.separatorLine.get(0).clientWidth/2+50)+"px",margin:"0px "+(this.separatorLine.get(0).clientWidth/2-50)/2+"px"}),this.languageContainer.css("width",this.separatorLine.get(0).clientWidth/2+50+"px"),this.actionContainer.css({"min-width":"100%",margin:"0px"}),r.call(this)))};d.prototype.setStyle=function(b){this.settings.borderColor=b.borderColor;this.settings.neutralOverColor=b.neutralOverColor;
this.settings.backgroundOverColor=b.backgroundOverColor;this.settings.foregroundOverColor=b.foregroundOverColor;this.settings.neutralNormalColor=b.neutralNormalColor;this.settings.neutralSelectedColor=b.neutralSelectedColor;this.settings.backgroundNormalColor=b.backgroundNormalColor;this.settings.foregroundNormalColor=b.foregroundNormalColor;this.settings.foregroundSelectedColor=b.foregroundSelectedColor;this.settings.backgroundSelectedColor=b.backgroundSelectedColor};d.prototype.updateLanguage=function(b){this.actionMainContainer.find(".rotate").update(this.apiCore.exec(this.callerName,
"translate","rotate"));this.actionMainContainer.find(".move").update(this.apiCore.exec(this.callerName,"translate","translate"));this.actionMainContainer.find(".zoom").update(this.apiCore.exec(this.callerName,"translate","zoom"));this.actionMainContainer.find(".rotate").get(0).title=this.apiCore.exec(this.callerName,"translate","rotate");this.actionMainContainer.find(".move").get(0).title=this.apiCore.exec(this.callerName,"translate","translate");this.actionMainContainer.find(".zoom").get(0).title=
this.apiCore.exec(this.callerName,"translate","zoom");$$stage(".languageSelected").removeClass("languageSelected");$$stage("."+b+"Language").addClass("languageSelected")};d.prototype.reload=function(){this.displayed&&f.call(this)};var u=function(b){this.languageMainContainer.css({"-webkit-transition":"left 0.5s ease 0s","-moz-transition":"left 0.5s ease 0s","-o-transition":"left 0.5s ease 0s","-ms-transition":"left 0.5s ease 0s",transition:"left 0.5s ease 0s"});(leftValue=parseInt(this.languageMainContainer.get(0).style.left.replace("px",
"")))||(leftValue=0);"left"==b?(leftValue+=this.separatorLine.get(0).clientWidth/2+50,.5<leftValue&&(leftValue=-(this.separatorLine.get(0).clientWidth/2+50)*(this.languageContainer.length-1))):(leftValue-=this.separatorLine.get(0).clientWidth/2+50,leftValue<-(this.separatorLine.get(0).clientWidth/2+50)*(this.languageContainer.length-1)&&(leftValue=0));r.call(this,leftValue)},k=null,l=null,g=function(b){l=this.languageMainContainer.get(0).style.left.replace("px","")?parseInt(this.languageMainContainer.get(0).style.left.replace("px",
"")):0;this.languageMainContainer.get(0).style.width&&(k=b.touches?b.touches[0].clientX:b.clientX);b.stopPropagation()},q=function(b){b.stopPropagation();if(this.languageMainContainer.get(0).style.width&&k){var d=parseInt(this.languageMainContainer.get(0).style.left.replace("px",""));d||(d=0);b.touches?(d-=k-b.touches[0].clientX,k=b.touches[0].clientX):(d-=k-b.clientX,k=b.clientX);this.languageMainContainer.css("left",parseInt(d)+"px")}},t=function(b){b&&b.stopPropagation();(b&&k||!b&&!k)&&this.languageMainContainer.get(0).style.width&&
(k=null,b=parseInt(this.languageMainContainer.get(0).style.left.replace("px","")),0<b?b=-(this.separatorLine.get(0).clientWidth/2+50)*(this.languageContainer.length-1):b<-(this.separatorLine.get(0).clientWidth/2+50)*(this.languageContainer.length-1)&&(b=0),0<=Math.abs(l-b)-50&&(this.languageMainContainer.css({"-webkit-transition":"left 0.5s ease 0s","-moz-transition":"left 0.5s ease 0s","-o-transition":"left 0.5s ease 0s","-ms-transition":"left 0.5s ease 0s",transition:"left 0.5s ease 0s"}),r.call(this)))},
r=function(b){b||(b=parseInt(this.languageMainContainer.get(0).style.left.replace("px","")));b=Math.round(Math.abs(b/(this.separatorLine.get(0).clientWidth/2+50)));this.languageMainContainer.css({left:-b*(this.separatorLine.get(0).clientWidth/2+50)+"px"});var d=0,f;for(f in this.viewerLanguages){if(d==b){this.apiCore.exec(this.callerName,"setLocale",f);break}++d}setTimeout(stage.setContext(function(){this.languageMainContainer.css({"-webkit-transition":"","-moz-transition":"","-o-transition":"","-ms-transition":"",
transition:""})},this),10)},f=function(){this.helpContainer&&(this.helpContainer.remove(),this.helpContainer=null);var b=[{tagName:"div",returnActive:!0,attributes:{klass:"helpContainer"},childs:[{tagName:"div",attributes:{klass:"hackVerticalMiddle"}},{tagName:"div",attributes:{klass:"helpWindowContainer"},childs:[{tagName:"div",attributes:{klass:"helpWindowTop"},childs:[{tagName:"div",attributes:{id:"svgHelpWindowCloseButton",klass:"helpWindowCloseButton"},events:[{onEvent:"click",callback:stage.setContext(function(){this.hide()},
this)}]}]},{tagName:"div",attributes:{klass:"helpWindowContent"},childs:[{tagName:"div",attributes:{klass:"helpWindowManipulationChoiceActionBloc"},childs:[]},{tagName:"div",attributes:{klass:"helpWindowSeparatorContainer helpWindowSeparatorContainerWithMargin"},childs:[{tagName:"div",attributes:{klass:"helpWindowSeparatorLine"}}]},{tagName:"div",attributes:{klass:"helpWindowLanguageChoiceActionBloc"},childs:[{tagName:"div",attributes:{klass:"leftArrowSvgContainer"},events:[{onEvent:"click",callback:stage.setContext(u,
this,"left")}]},{tagName:"div",attributes:{klass:"rightArrowSvgContainer"},events:[{onEvent:"click",callback:stage.setContext(u,this,"right")}]},{tagName:"div",attributes:{klass:"languageMainContainer"},events:[{onEvent:"touchstart",callback:stage.setContext(g,this)},{onEvent:"mousedown",callback:stage.setContext(g,this)},{onEvent:"touchend",callback:stage.setContext(t,this)},{onEvent:"mouseup",callback:stage.setContext(t,this)},{onEvent:"mouseout",callback:stage.setContext(t,this)},{onEvent:"mousemove",
callback:stage.setContext(q,this)},{onEvent:"touchmove",callback:stage.setContext(q,this)}]}]}]},{tagName:"div",attributes:{klass:"helpWindowBottom"},childs:[{tagName:"div",attributes:{klass:"helpWindowSeparatorContainer"},childs:[{tagName:"div",attributes:{klass:"helpWindowSeparatorLine"}}]},{tagName:"div",attributes:{klass:"poweredBy"},childs:[{tagName:"a",attributes:{klass:"emersyaLogoHelper",target:"blank",href:"https://emersya.com/"}}]}]}]}]}];this.helpContainer=$$stage(this.parentElement).build(b);
this.separatorLine=this.helpContainer.find(".helpWindowSeparatorLine");this.actionMainContainer=this.helpContainer.find(".helpWindowManipulationChoiceActionBloc");this.helpWindowContainer=this.helpContainer.find(".helpWindowContainer");this.helpWindowCloseButton=this.helpContainer.find(".helpWindowCloseButton");this.languageMainContainer=this.helpContainer.find(".languageMainContainer");this.helpWindowLanguageBloc=this.helpContainer.find(".helpWindowLanguageChoiceActionBloc");this.helpWindowContentContainer=
this.helpContainer.find(".helpWindowContent");this.emersyaLogoHelper=this.helpContainer.find(".emersyaLogoHelper");b=[];for(var d in this.viewerLanguages){var f=this.viewerLanguages[d];b.push({tagName:"div",attributes:{klass:"languageContainer "+d+"Language",inner:"\u81fa\u7063"!=f.locale_name?f.locale_name:"\u7e41\u9ad4\u5b57"},events:[{onEvent:"click",callback:stage.setContext(function(b,d){this.mobileView||this.apiCore.exec(this.callerName,"setLocale",d)},this,f,d)}]})}this.languageMainContainer.build(b);
this.languageContainer=this.languageMainContainer.find(".languageContainer");d=[];d.push({tagName:"div",attributes:{klass:"helpWindowManipulationActionBlocContent rotateBlocContent"},childs:[{tagName:"div",attributes:{klass:"helpWindowManipulationActionBlocContentTitleIcon",id:"helpWindowManipulationActionBlocContentTitleIconRotate"}},{tagName:"div",attributes:{klass:"helpWindowManipulationActionBlocContentTitle rotate"}},{tagName:"div",attributes:{klass:"helpWindowManipulationActionBlocContentExplanation"},
childs:[{tagName:"div",attributes:{klass:"helpWindowManipulationActionBlocContentExplanationBlocSide svgMouseLeftClic",id:"svgMouseLeftClic"}},{tagName:"div",attributes:{klass:"helpWindowManipulationActionBlocContentExplanationBlocSide touchRotateBloc svgRotateTouch",id:"svgRotateTouch"}}]}]});d.push({tagName:"div",attributes:{klass:"helpWindowManipulationActionBlocContent moveBlocContent"},childs:[{tagName:"div",attributes:{klass:"helpWindowManipulationActionBlocContentTitleIcon",id:"helpWindowManipulationActionBlocContentTitleIconMove"}},
{tagName:"div",attributes:{klass:"helpWindowManipulationActionBlocContentTitle move"}},{tagName:"div",attributes:{klass:"helpWindowManipulationActionBlocContentExplanation"},childs:[{tagName:"div",attributes:{klass:"helpWindowManipulationActionBlocContentExplanationBlocSide svgMouseRightClic",id:"svgMouseRightClic"}},{tagName:"div",attributes:{klass:"helpWindowManipulationActionBlocContentExplanationBlocSide touchMoveBloc svgMoveTouch",id:"svgMoveTouch"}}]}]});this.settings.wheelOnCtrl?d.push({tagName:"div",
attributes:{klass:"helpWindowManipulationActionBlocContent zoomBlocContent"},childs:[{tagName:"div",attributes:{klass:"helpWindowManipulationActionBlocContentTitleIcon",id:"helpWindowManipulationActionBlocContentTitleIconZoom"}},{tagName:"div",attributes:{klass:"helpWindowManipulationActionBlocContentTitle zoom"}},{tagName:"div",attributes:{klass:"helpWindowManipulationActionBlocContentExplanation"},childs:[{tagName:"div",attributes:{klass:"svgMouseWheelOnCtrlMainContainer"},childs:[{tagName:"div",
attributes:{klass:"helpWindowManipulationActionBlocContentExplanationBlocSide svgMouseWheelOnCtrl",id:"svgMouseWheelOnCtrl",inner:"CTRL + "}},{tagName:"div",attributes:{klass:"helpWindowManipulationActionBlocContentExplanationBlocSide svgMouseWheelClic",id:"svgMouseWheelClic"}}]},{tagName:"div",attributes:{klass:"helpWindowManipulationActionBlocContentExplanationBlocSide touchZoomBloc svgZoomTouch",id:"svgZoomTouch"}}]}]}):d.push({tagName:"div",attributes:{klass:"helpWindowManipulationActionBlocContent zoomBlocContent"},
childs:[{tagName:"div",attributes:{klass:"helpWindowManipulationActionBlocContentTitleIcon",id:"helpWindowManipulationActionBlocContentTitleIconZoom"}},{tagName:"div",attributes:{klass:"helpWindowManipulationActionBlocContentTitle zoom"}},{tagName:"div",attributes:{klass:"helpWindowManipulationActionBlocContentExplanation"},childs:[{tagName:"div",attributes:{klass:"helpWindowManipulationActionBlocContentExplanationBlocSide svgMouseWheelClic",id:"svgMouseWheelClic"}},{tagName:"div",attributes:{klass:"helpWindowManipulationActionBlocContentExplanationBlocSide touchZoomBloc svgZoomTouch",
id:"svgZoomTouch"}}]}]});this.actionMainContainer.build(d);this.actionContainer=this.actionMainContainer.find(".helpWindowManipulationActionBlocContent");this.explanationContainer=this.actionMainContainer.find(".helpWindowManipulationActionBlocContentExplanation");this.rotateContainer=this.actionMainContainer.find(".rotateBlocContent");this.moveContainer=this.actionMainContainer.find(".moveBlocContent");this.zoomContainer=this.actionMainContainer.find(".zoomBlocContent");this.rotateTouchContainer=
this.actionMainContainer.find(".svgRotateTouch");this.moveTouchContainer=this.actionMainContainer.find(".svgMoveTouch");this.zoomTouchContainer=this.actionMainContainer.find(".svgZoomTouch");this.zoomOnCtrlContainer=this.actionMainContainer.find(".svgMouseWheelOnCtrl");this.rotateMouseContainer=this.actionMainContainer.find(".svgMouseLeftClic");this.moveMouseContainer=this.actionMainContainer.find(".svgMouseRightClic");this.zoomMouseContainer=this.actionMainContainer.find(".svgMouseWheelClic");this.mouseWheelOnCtrlMainContainer=
this.actionMainContainer.find(".svgMouseWheelOnCtrlMainContainer");n.call(this);d=/Firefox/i.test(navigator.userAgent)?"DOMMouseScroll":"mousewheel";this.helpContainer.listen("click",function(b){b.stopPropagation()});this.helpContainer.listen("mousedown",function(b){b.stopPropagation()});this.helpContainer.listen("mouseup",function(b){b.stopPropagation()});this.helpContainer.listen(d,function(b){b.stopPropagation()});this.apiCore.exec(this.callerName,"lib.insertSvg",this.fullIcons.quitIcon,{mouseOver:!0});
this.apiCore.exec(this.callerName,"lib.insertSvg",this.fullIcons.zoomIcon,{mouseOver:!0});this.apiCore.exec(this.callerName,"lib.insertSvg",this.fullIcons.moveIcon,{mouseOver:!0});this.apiCore.exec(this.callerName,"lib.insertSvg",this.fullIcons.rotateIcon,{mouseOver:!0});this.apiCore.exec(this.callerName,"lib.insertSvg",this.fullIcons.leftArrowIcon,{mouseOver:!0});this.apiCore.exec(this.callerName,"lib.insertSvg",this.fullIcons.rightArrowIcon,{mouseOver:!0});this.apiCore.exec(this.callerName,"lib.insertSvg",
this.fullIcons.emersyaLogoHelper,{mouseOver:!1});this.settings.mouseWheelInteraction?this.apiCore.exec(this.callerName,"lib.insertSvg",this.fullIcons.mouseWheel,{mouseOver:!0}):this.zoomTouchContainer.css({"margin-left":"-20px"});this.settings.mouseMoveInteraction?this.apiCore.exec(this.callerName,"lib.insertSvg",this.fullIcons.mouseRightClic,{mouseOver:!0}):this.moveTouchContainer.css({"margin-left":"-20px"});this.settings.mouseButtonInteraction?this.apiCore.exec(this.callerName,"lib.insertSvg",
this.fullIcons.mouseLeftClic,{mouseOver:!0}):this.rotateTouchContainer.css({"margin-left":"-20px"});this.settings.touchInteraction?(this.apiCore.exec(this.callerName,"lib.insertSvg",this.fullIcons.rotateTouch,{mouseOver:!0}),this.apiCore.exec(this.callerName,"lib.insertSvg",this.fullIcons.moveTouch,{mouseOver:!0}),this.apiCore.exec(this.callerName,"lib.insertSvg",this.fullIcons.zoomTouch,{mouseOver:!0})):(this.rotateTouchContainer.remove(),this.moveTouchContainer.remove(),this.zoomTouchContainer.remove(),
this.rotateMouseContainer.css({"margin-left":"30px"}),this.moveMouseContainer.css({"margin-left":"30px"}),this.settings.wheelOnCtrl?this.mouseWheelOnCtrlMainContainer.css({"margin-left":"30px"}):this.zoomMouseContainer.css({"margin-left":"30px"}),this.settings.mouseWheelInteraction||(this.zoomContainer.remove(),this.zoomOnCtrlContainer.remove()),this.settings.mouseMoveInteraction&&this.settings.mouseButtonInteraction||(this.moveContainer.remove(),this.rotateContainer.remove()));this.settings.wheelOnCtrl&&
this.settings.touchInteraction?this.zoomTouchContainer.css({top:"-10px",left:"50px"}):this.settings.wheelOnCtrl&&this.explanationContainer.css("min-height","90px")},n=function(){var b="rgba("+parseInt(this.settings.backgroundNormalColor.substring(1,3),16)+","+parseInt(this.settings.backgroundNormalColor.substring(3,5),16)+","+parseInt(this.settings.backgroundNormalColor.substring(5,7),16)+",0.7)",d="rgba("+parseInt(this.settings.borderColor.substring(1,3),16)+","+parseInt(this.settings.borderColor.substring(3,
5),16)+","+parseInt(this.settings.borderColor.substring(5,7),16)+",0.7)";this.separatorLine.css({backgroundColor:d});this.helpWindowContainer.css({backgroundColor:b,color:this.settings.borderColor.substring(0,7)});(b=this.apiCore.exec(this.callerName,"getLocale"))?this.updateLanguage(b):this.updateLanguage("en-us")};return d});stage.provide("emersya.viewer.modules.ui.tooltip");
stage.register.call(stage.emersya.viewer.modules.ui,"tooltip",function(){var b={xDelta:5,yDelta:5,container:document.body},d=function(d,l){this.settings=stage.extend(!0,{},b,l);this.apiCore=d;this.container=this.createContainer();this.backgroundTooltip=this.container.find(".backgroundTooltip");this.svgIcon=stage.emersya.ui.svgIcon(null,{});this.fullIcons=this.svgIcon.getTooltipIcons();this.previousStartDirection=this.previousLocalSettings=this.previousLegend=this.currentOver=null};d.prototype.manage=
function(b,d,g,q,t){this.mouseover=stage.setContext(function(k){$$stage(k.target).parent().parent().selector[0]==b.selector[0]?(this.currentOver=b,this.startTracking(b,d,g,q,t)):this.startTracking(void 0,this.previousLegend,this.previousStartDirection,this.previousLocalSettings)},this);b.listen("mouseover",this.mouseover);this.mousemove=stage.setContext(function(){this.moveTracking(b,d,g,q,t)},this);b.listen("mousemove",this.mousemove);this.mouseout=stage.setContext(function(){this.currentOver=null;
this.previousLegend=d;this.previousStartDirection=g;this.previousLocalSettings=q;this.close()},this);b.listen("mouseout",this.mouseout);this.mousedown=stage.setContext(function(){this.previousLocalSettings=this.previousStartDirection=this.previousLegend=this.currentOver=null;this.close()},this);b.listen("mousedown",this.mousedown)};d.prototype.unlisten=function(b){this.mouseover&&(b.unListen("mouseover",this.mouseover),b.unListen("mousemove",this.mousemove),b.unListen("mouseout",this.mouseout),b.unListen("mousedown",
this.mousedown))};d.prototype.createContainer=function(){this.container&&this.container.remove();return $$stage(stage.build(this.settings.container,[{returnActive:!0,tagName:"div",attributes:{klass:"containerTooltip"},childs:[{tagName:"div",attributes:{klass:"backgroundTooltip"}}]}]))};var u=function(b,d,g,q){b=b.Viewport();this.container.Viewport();var k=stage.viewport.getHeight(),l=stage.viewport.getWidth();var f=g?g.deltaY?g.deltaY:0:0;var n=g?g.deltaX?g.deltaX:0:0;this.backgroundTooltip.each(function(b,
d){"backgroundTooltip"!==$$stage(b).getClass()&&$$stage(b).removeClass().addClass("backgroundTooltip")});switch(d){case 5:d=33;g=144;var u=(this.settings.yDelta+this.settings.xDelta)/2*Math.cos(Math.PI/4);0<b.top+1.1*d?(f=b.top-d-u-f,k="bottom"):(f=b.top+b.height+u+f,k="top");g+b.left<l?(l=b.left+b.width+u+n,k+="Left"):(l=b.left-g-u-n,k+="Right");k+="Corner";break;case 2:d=33;g=144;u=(this.settings.yDelta+this.settings.xDelta)/2*Math.cos(Math.PI/4);b.top+b.height+d<k?(f=b.top+b.height+u+f,k="top"):
(f=b.top-d-u-f,k="bottom");g+b.left<l?(l=b.left+b.width+u+n,k+="Left"):(l=b.left-g-u-n,k+="Right");k+="Corner";break;case 0:d=31;g=145;g+b.left<l?(l=b.left+b.width+this.settings.xDelta+n,k="left"):(l=b.left-g-this.settings.xDelta-n,k="right");0>b.top+(b.height-d)/2?(d=31,g=145,f=b.top+b.height/2-9+f,k+="Top"):(f=b.top+(b.height-d)/2+f,k+="Middle");break;case 4:d=31;g=145;b.left<l?(l=b.left-g-this.settings.xDelta-n,k="right"):(l=b.left+b.width+this.settings.xDelta+n,k="left");0>b.top+(b.height-d)/
2?(d=31,g=145,f=b.top+b.height/2-9+f,k+="Top"):(f=b.top+(b.height-d)/2+f,k+="Middle");break;default:d=35,g=141,1.2*(b.top+b.height+d)<k?(f=b.top+b.height+this.settings.yDelta+f,k="top"):(f=b.top-d-this.settings.yDelta-f,k="bottom"),n=b.left+b.width/2-g/2,0<n&&n+g<l?(l=n,k+="Middle"):0<n?(l=b.left+b.width/2-(g-11),k+="Right"):(l=b.left+(b.width/2-11),k+="Left")}this.backgroundTooltip.addClass(k);this.container.css({left:l,top:f,height:d,width:g});this.backgroundTooltip.find("svg").remove();this.apiCore.exec(this.callerName,
"lib.insertSvg",this.fullIcons[k],{mouseOver:!1,text:q},!0)};d.prototype.startTracking=function(b,d,g,q,t){this.timer=setTimeout(stage.setContext(this.display,this,b,d,g,q,t),550)};d.prototype.moveTracking=function(b,d,g,q,t){this.container.visible()?this.close():(this.timer&&clearTimeout(this.timer),this.timer=setTimeout(stage.setContext(this.display,this,b,d,g,q,t),550))};d.prototype.textSize=function(b){var d=document.body.appendChild(document.createElement("div"));d.style.position="absolute";
d.style.visibility="hidden";d.style.fontSize="15px";d.innerHTML=b;b=d.offsetWidth;$$stage(d).remove();return b};d.prototype.display=function(b,d,g,q,t){this.currentOver===b&&(u.call(this,b,g,q,d),this.container.show())};d.prototype.close=function(){this.container.hide()};return d});stage.provide("emersya.viewer.modules.ui.annotation");
stage.register.call(stage.emersya.viewer.modules.ui,"annotation",function(){var b={active:!1,title:"",description:"",number:0,id:0,textColor:"#ffffff",positionX:0,positionY:0,size:25,stroke:"white",strokeOpacity:.7,fillOpacity:1,foregroundColor:"rgba(0,0,0,0.7)",foregroundColorActive:"#00b1ab",backgroundColor:"#ffffff",backgroundColorBubble:"rgba(0,0,0,0.75)",textColorBubble:"#ffffff",paddingBubbleAnnotation:15,sizeBorderCursorBubbleAnnotation:13,paddingContainer:20,marginBubbleAnnotation:16,minWidthBubbleAnnotation:80,
maxWidthBubbleAnnotation:"none",openingEventType:0,deltaErrorSvgRight:10,deltaErrorSvgLeft:10,deltaErrorSvgTop:5,deltaErrorSvgBot:5,fontSizeTitle:"16px",fontSizeDescription:"12px",fontBubbleAnnotation:"DejaVu Serif",borderColorBubble:"rgba(255,255,255,1)",animation:!1,hiddenOpacity:.35,type:"pin",descriptionFont:"",titleFont:"",numberActive:!0,pointer:[{top:1.4,left:.5}],heightRatio:1.5,point_of_view:null,animationDuration:null,moveOnClick:!1},d=function(d,g,k){this.settings=stage.extend(!0,{},b,
k);"pin"!=this.settings.type&&(this.settings.pointer=[{top:.5,left:.5}],this.settings.numberActive=!1,this.settings.heightRatio=1);this.cursorToLeftOut={"border-top":this.settings.sizeBorderCursorBubbleAnnotation+"px solid transparent","border-bottom":this.settings.sizeBorderCursorBubbleAnnotation+"px solid transparent","border-right":this.settings.sizeBorderCursorBubbleAnnotation+"px solid white","border-left":"none"};this.cursorToLeftIn={"border-top":this.settings.sizeBorderCursorBubbleAnnotation+
"px solid transparent","border-bottom":this.settings.sizeBorderCursorBubbleAnnotation+"px solid transparent","border-right":this.settings.sizeBorderCursorBubbleAnnotation+"px solid rgba(0,0,0,0.75)","border-left":"none"};this.cursorToRightOut={"border-top":this.settings.sizeBorderCursorBubbleAnnotation+"px solid transparent","border-bottom":this.settings.sizeBorderCursorBubbleAnnotation+"px solid transparent","border-left":this.settings.sizeBorderCursorBubbleAnnotation+"px solid white","border-right":"none",
position:"absolute"};this.cursorToRightIn={"border-top":this.settings.sizeBorderCursorBubbleAnnotation+"px solid transparent","border-bottom":this.settings.sizeBorderCursorBubbleAnnotation+"px solid transparent","border-left":this.settings.sizeBorderCursorBubbleAnnotation+"px solid rgba(0,0,0,0.75)","border-right":"none"};this.cursorToBottomOut={"border-left":this.settings.sizeBorderCursorBubbleAnnotation+"px solid transparent","border-right":this.settings.sizeBorderCursorBubbleAnnotation+"px solid transparent",
"border-top":this.settings.sizeBorderCursorBubbleAnnotation+"px solid white","border-bottom":"none"};this.cursorToBottomIn={"border-left":this.settings.sizeBorderCursorBubbleAnnotation+"px solid transparent","border-right":this.settings.sizeBorderCursorBubbleAnnotation+"px solid transparent","border-top":this.settings.sizeBorderCursorBubbleAnnotation+"px solid rgba(0,0,0,0.75)","border-bottom":"none"};this.cursorToTopOut={"border-left":this.settings.sizeBorderCursorBubbleAnnotation+"px solid transparent",
"border-right":this.settings.sizeBorderCursorBubbleAnnotation+"px solid transparent","border-bottom":this.settings.sizeBorderCursorBubbleAnnotation+"px solid white","border-top":"none"};this.cursorToTopIn={"border-left":this.settings.sizeBorderCursorBubbleAnnotation+"px solid transparent","border-right":this.settings.sizeBorderCursorBubbleAnnotation+"px solid transparent","border-bottom":this.settings.sizeBorderCursorBubbleAnnotation+"px solid rgba(0,0,0,0.75)","border-top":"none"};this.uiElement=
$$stage(g);this.uiElementWidth=this.uiElement.getWidth();this.uiElementHeight=this.uiElement.getHeight();this.enabled=!0;this.apiCore=d;this.callerName="UICore-Annotation";this.active=!1;this.activateWhenVisibleCallback=null;this.annotation=this.build();this.device=this.apiCore.exec(this.callerName,"getDevice");this.settings.active&&this.open()},u=function(){return function(b){return b=b.replace(/&amp;/g,"&").replace(/\\"/g,'"').replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/&lt;br \/&gt;/g,"<br>").replace(/\n/g,
"<br>")}}();d.prototype.build=function(){this.currentValueRefresh=this.refresh=1;this.currentRefreshCalculDirectionBubbleAnnotation=this.refreshCalculDirectionBubbleAnnotation=5;this.bubbleOpenable=!0;"No description"==this.settings.description&&(this.settings.description="");var b=this.apiCore.exec(this.callerName,"lib.markdown2HTML",this.settings.title),d=this.apiCore.exec(this.callerName,"lib.markdown2HTML",this.settings.description);b=[{tagName:"div",returnActive:!0,attributes:{id:"annotation_"+
this.settings.id,klass:"annotationContainer"},childs:[{tagName:"div",attributes:{klass:"svgAnnotation svgAnnotation"+this.settings.id,style:{width:this.settings.size,height:this.settings.size*this.settings.heightRatio}}},{tagName:"div",attributes:{klass:"bubbleAnnotation"},childs:[{tagName:"div",attributes:{klass:"triangleOut"},childs:[{tagName:"div",attributes:{klass:"triangleIn"}}]},{tagName:"div",attributes:{klass:"titleAnnotation"},childs:[{tagName:"code",attributes:{klass:"xmpTitle",inner:b!=
this.settings.title?b:u(this.settings.title)}}]},{tagName:"div",attributes:{klass:"descriptionAnnotation"},childs:[{tagName:"code",attributes:{klass:"xmpDescription",inner:d!=this.settings.description?d:u(this.settings.description)}}]}]},{tagName:"div",attributes:{klass:"popupAnnotation"},childs:[{tagName:"div",attributes:{klass:"quitPopupAnnotation",inner:"\u2715"},events:[{onEvent:"click",callback:stage.setContext(this.close,this)}]},{tagName:"div",attributes:{klass:"titleAnnotation"},childs:[{tagName:"code",
attributes:{klass:"xmpTitle",inner:b!=this.settings.title?b:u(this.settings.title)}}]},{tagName:"div",attributes:{klass:"descriptionAnnotation"},childs:[{tagName:"code",attributes:{klass:"xmpDescription",inner:d!=this.settings.description?d:u(this.settings.description)}}]}]}]}];this.domElem=this.uiElement.build(b);this.bubbleAnnotation=this.domElem.find(".bubbleAnnotation");this.popupAnnotation=this.domElem.find(".popupAnnotation");this.svgAnnotation=this.domElem.find(".svgAnnotation");this.descriptionAnnotation=
this.bubbleAnnotation.find(".descriptionAnnotation");this.triangleOut=this.bubbleAnnotation.find(".triangleOut");this.triangleIn=this.bubbleAnnotation.find(".triangleIn");this.xmpTitle=this.bubbleAnnotation.find(".xmpTitle");this.xmpDescription=this.bubbleAnnotation.find(".xmpDescription");this.titleAnnotation=this.bubbleAnnotation.find(".titleAnnotation");this.svgIcon=stage.emersya.ui.svgIcon(null,g);this.fullIcons=this.svgIcon.getAnnotationsIcons("svgAnnotation"+this.settings.id);this.setStyle();
this.configureWidthBubble();var g={stroke:this.settings.stroke,strokeOpacity:this.settings.strokeOpacity,fillOpacity:this.settings.fillOpacity,foregroundColor:this.settings.foregroundColor,fillText:this.settings.textColor};this.apiCore.exec(this.callerName,"lib.insertSvg",this.fullIcons[this.settings.type],{mouseOver:!0,text:this.settings.numberActive?this.settings.number:null,posTextX:"51%",posTextY:"51%",fontSize:"70%",fontWeight:"700"});this.svgAnnotation.find("svg").css("pointer-events","none");
this.allPath=[];for(var f in this.domElem.find("path").selector)this.allPath.push(this.domElem.find("path").get(f));this.settings.positionXAdjusted=this.settings.positionX-this.settings.size*this.settings.pointer[0].left;this.settings.positionYAdjusted=this.settings.positionY-this.settings.size*this.settings.pointer[0].top;this.domElem.css({position:"absolute",left:this.settings.positionXAdjusted,top:this.settings.positionYAdjusted});this.svgAnnotation.listen("mousedown",stage.setContext(k,this));
this.settings.openingEventType?(this.svgAnnotation.listen("mouseover",stage.setContext(function(b){this.bubbleOpenable&&(this.apiCore.exec(this.callerName,"onAnnotationPinOpenByOver",this),b=this.settings.moveOnClick,this.settings.moveOnClick=!1,this.open(),this.settings.moveOnClick=b)},this)),this.svgAnnotation.listen("mouseout",stage.setContext(function(b){this.bubbleOpenable&&this.close()},this))):this.bubbleAnnotation.listen("mousedown",stage.setContext(k,this));this.svgAnnotation.listen("touchstart",
stage.setContext(function(b){b.stopPropagation()},this));this.domElemWidth=this.domElem.getWidth();this.domElemHeight=this.domElem.getHeight();this.settings.title||this.settings.description?this.bubbleAnnotation.show():this.bubbleAnnotation.hide();this.bubbleDimension=[this.bubbleAnnotation.get(0).clientHeight,this.bubbleAnnotation.get(0).clientWidth]};var k=function(b){if(this.settings.animation&&this.settings.onClick)this.settings.onClick(this,b);else if(!("a"==b.target.tagName.toLowerCase()||0<
$$stage(b.target).find("img").length))if(this.settings.onClick)this.settings.onClick(this,b);else this.active?this.close():(this.apiCore.exec(this.callerName,"onAnnotationPinOpenByClick",this),this.open())};d.prototype.resize=function(b,d){this.uiElementWidth=b;this.uiElementHeight=d;this.enabled&&(this.configureWidthBubble(),this.bubbleDimension=[this.bubbleAnnotation.get(0).clientHeight,this.bubbleAnnotation.get(0).clientWidth],b=stage.setContext(function(b,d){g.call(this,b,d);this.descriptionAnnotation.get(0).clientWidth<
d&&l.call(this,stage.setContext(g,this))},this),l.call(this,b));this.setStyle()};d.prototype.setStyle=function(){var b=this.apiCore.exec(this.callerName,"isCurrentLocaleRightToLeft");this.bubbleAnnotation.css({"max-width":.5*this.uiElementWidth+"px",backgroundColor:this.settings.backgroundColorBubble,color:this.settings.textColorBubble,padding:this.settings.paddingBubbleAnnotation,"font-family":this.settings.fontBubbleAnnotation,"z-index":10});this.popupAnnotation.css({backgroundColor:this.settings.backgroundColorBubble});
this.titleAnnotation.css({"font-size":this.settings.fontSizeTitle,direction:b?"rtl":"ltr"});0==this.settings.description.length?this.titleAnnotation.css({"margin-bottom":"0px"}):this.titleAnnotation.css({"margin-bottom":"8px"});this.descriptionAnnotation.css({"font-size":this.settings.fontSizeDescription,"vertical-align":"bot",direction:b?"rtl":"ltr"});""!=this.settings.descriptionFont&&this.xmpDescription.css({"font-family":this.settings.descriptionFont});""!=this.settings.titleFont&&this.xmpTitle.css({"font-family":this.settings.titleFont});
this.apiCore.exec(this.callerName,"lib.isColorDark",this.settings.foregroundColorActive)||(this.xmpTitle.find("a").css({color:this.settings.foregroundColorActive}),this.xmpDescription.find("a").css({color:this.settings.foregroundColorActive}))};d.prototype.calculNewPosition=function(){var b=this.settings.marginBubbleAnnotation-this.settings.paddingBubbleAnnotation-this.settings.sizeBorderCursorBubbleAnnotation,d=this.uiElementWidth-this.domElemWidth-this.settings.positionXAdjusted-this.settings.paddingContainer-
this.settings.marginBubbleAnnotation/2-this.settings.sizeBorderCursorBubbleAnnotation-this.settings.paddingBubbleAnnotation,g=this.settings.positionYAdjusted-this.settings.paddingContainer,f=this.uiElementHeight-this.settings.positionYAdjusted-this.domElemHeight,k=this.settings.positionXAdjusted-this.settings.paddingContainer-this.settings.marginBubbleAnnotation/2-this.settings.sizeBorderCursorBubbleAnnotation-this.settings.paddingBubbleAnnotation;if(d>=this.bubbleDimension[1]&&g>=this.bubbleDimension[0]/
2&&f>this.bubbleDimension[0]/2){this.triangleOut.css({top:this.bubbleDimension[0]/2-13+"px",left:"0px",right:"unset"});this.triangleIn.css(this.cursorToLeftIn);this.bubbleAnnotation.css({left:this.domElemWidth+this.settings.marginBubbleAnnotation+"px",top:this.domElemHeight/2-this.bubbleDimension[0]/2+"px",right:"",bottom:"","transform-origin":"0% 0"});var l="bubbleAnnotationRightLeft"}else k>=this.bubbleDimension[1]&&g>=this.bubbleDimension[0]/2&&f>=this.bubbleDimension[0]/2?(this.triangleOut.css({top:this.bubbleDimension[0]/
2-13+"px",left:"unset",right:"-13px"}),this.triangleIn.css(this.cursorToRightIn),this.bubbleAnnotation.css({right:this.domElemWidth+this.settings.marginBubbleAnnotation+"px",top:this.domElemHeight/2-this.bubbleDimension[0]/2+"px",left:"",bottom:"","transform-origin":"100% 0"}),l="bubbleAnnotationRightLeft"):g+2*b>=this.bubbleDimension[0]&&d>=this.bubbleDimension[1]/2&&k>=this.bubbleDimension[1]/2?(this.triangleOut.css({top:this.bubbleDimension[0]+"px",left:this.bubbleDimension[1]/2-1+"px",right:"unset"}),
this.triangleIn.css(this.cursorToBottomIn),this.bubbleAnnotation.css({left:this.domElemWidth/2-this.bubbleDimension[1]/2+"px",bottom:this.domElemHeight+this.settings.marginBubbleAnnotation+"px",right:"",top:"","transform-origin":"0 100%"}),l="bubbleAnnotationTopBottom"):f+2*b>=this.bubbleDimension[0]&&d>=this.bubbleDimension[1]/2&&k>=this.bubbleDimension[1]/2?(this.triangleOut.css({top:"-13px",left:this.bubbleDimension[1]/2+"px",right:"unset"}),this.triangleIn.css(this.cursorToTopIn),this.bubbleAnnotation.css({left:this.domElemWidth/
2-this.bubbleDimension[1]/2+"px",top:this.domElemHeight+this.settings.marginBubbleAnnotation+"px",right:"",bottom:"","transform-origin":"0 0"}),l="bubbleAnnotationTopBottom"):f+2*b>=this.bubbleDimension[0]&&k>=this.bubbleDimension[1]?(this.triangleOut.css({top:"-13px",left:this.bubbleDimension[1]-21+"px",right:"unset"}),this.triangleIn.css(this.cursorToTopIn),this.bubbleAnnotation.css({left:"unset",right:this.domElemWidth/2-21+"px",top:this.domElemHeight+this.settings.marginBubbleAnnotation+"px",
bottom:"","transform-origin":"0 0"}),l="bubbleAnnotationTopBottom"):f+2*b>=this.bubbleDimension[0]&&d>=this.bubbleDimension[1]?(this.bubbleAnnotation.removeClass("bubbleAnnotationRightLeft").addClass("bubbleAnnotationTopBottom"),this.triangleOut.css({top:"-13px",left:"21px",right:"unset"}),this.triangleIn.css(this.cursorToTopIn),this.bubbleAnnotation.css({left:this.domElemWidth/2-21+"px",top:this.domElemHeight+this.settings.marginBubbleAnnotation+"px",right:"",bottom:"","transform-origin":"0 0"}),
l="bubbleAnnotationTopBottom"):g+2*b>=this.bubbleDimension[0]&&k>=this.bubbleDimension[1]?(this.triangleOut.css({top:this.bubbleDimension[0]+"px",left:this.bubbleDimension[1]-21+"px",right:"unset"}),this.triangleIn.css(this.cursorToBottomIn),this.bubbleAnnotation.css({left:"unset",bottom:this.domElemHeight+this.settings.marginBubbleAnnotation+"px",right:this.domElemWidth/2-21+"px",top:"","transform-origin":"0 100%"}),l="bubbleAnnotationTopBottom"):g+2*b>=this.bubbleDimension[0]&&d>=this.bubbleDimension[1]&&
(this.triangleOut.css({top:this.bubbleDimension[0]+"px",left:"21px",right:"unset"}),this.triangleIn.css(this.cursorToBottomIn),this.bubbleAnnotation.css({left:this.domElemWidth/2-21+"px",bottom:this.domElemHeight+this.settings.marginBubbleAnnotation+"px",right:"",top:"","transform-origin":"0 100%"}),l="bubbleAnnotationTopBottom");return l};d.prototype.calculDirectionOfBubbleAnnotation=function(){var b=this.settings.positionYAdjusted-this.settings.paddingContainer,d=this.uiElementHeight-this.settings.positionYAdjusted-
this.domElemHeight,g=this.settings.positionXAdjusted-this.settings.paddingContainer-this.settings.marginBubbleAnnotation/2-this.settings.sizeBorderCursorBubbleAnnotation-this.settings.paddingBubbleAnnotation;(this.uiElementWidth-this.domElemWidth-this.settings.positionXAdjusted-this.settings.paddingContainer-this.settings.marginBubbleAnnotation/2-this.settings.sizeBorderCursorBubbleAnnotation-this.settings.paddingBubbleAnnotation>=this.bubbleDimension[1]||g>=this.bubbleDimension[1])&&b>=this.bubbleDimension[0]/
2&&d>this.bubbleDimension[0]/2?this.bubbleAnnotation.addClass("bubbleAnnotationRightLeft").removeClass("bubbleAnnotationTopBottom"):this.bubbleAnnotation.addClass("bubbleAnnotationTopBottom").removeClass("bubbleAnnotationRightLeft")};d.prototype.enableDisplayBubbleAnnotation=function(){this.bubbleOpenable=!0};d.prototype.disableDisplayBubbleAnnotation=function(){this.bubbleOpenable=!1};d.prototype.setPosition=function(b,d){this.currentValueRefresh==this.refresh?(this.settings.positionX=b,this.settings.positionY=
d,this.settings.positionXAdjusted=this.settings.positionX-this.settings.size*this.settings.pointer[0].left,this.settings.positionYAdjusted=this.settings.positionY-this.settings.size*this.settings.pointer[0].top,this.verifyInclusion(),this.domElem.css({left:parseInt(this.settings.positionXAdjusted)+"px",top:parseInt(this.settings.positionYAdjusted)+"px"}),this.active&&this.calculNewPosition(),this.currentRefreshCalculDirectionBubbleAnnotation===this.refreshCalculDirectionBubbleAnnotation?(this.calculDirectionOfBubbleAnnotation(),
this.currentRefreshCalculDirectionBubbleAnnotation=1):this.currentRefreshCalculDirectionBubbleAnnotation++,this.currentValueRefresh=1):this.currentValueRefresh++};d.prototype.setOpacity=function(b){for(var d in this.allPath)this.allPath[d].setAttributeNS(null,"fill-opacity",b),this.allPath[d].setAttributeNS(null,"stroke-opacity",b);this.settings.numberActive&&(d=this.domElem.find("text").get(0))&&d.setAttributeNS(null,"fill-opacity",b)};d.prototype.setVisible=function(b,d,g){var f=!1;this.enabled&&
(b&&!this.currentlyOnScreenBorder&&g?d?(this.domElem.show(),f=!0,this.setOpacity(this.settings.fillOpacity)):0==this.settings.hiddenOpacity?this.domElem.hide():(this.domElem.show(),f=!0,this.setOpacity(this.settings.hiddenOpacity)):(this.domElem.hide(),this.active&&this.close()));this.currentlyOnScreen=b;this.currentlyInPlainSight=d;this.currentlyDisplayed=g;this.activateWhenVisible&&f&&!this.active&&this.open(this.activateWhenVisibleCallback)};d.prototype.toggle=function(){this.enabled?this.disable():
this.enable()};d.prototype.enable=function(){this.enabled||(this.enabled=!0,this.configureWidthBubble(),this.setVisible(this.currentlyOnScreen,this.currentlyInPlainSight,this.currentlyDisplayed))};d.prototype.disable=function(){this.enabled&&(this.domElem.hide(),this.enabled=!1)};d.prototype.verifyInclusion=function(){this.currentlyOnScreenBorder=!(0<=this.settings.positionXAdjusted+this.settings.deltaErrorSvgLeft&&this.settings.positionXAdjusted+this.domElemWidth-this.settings.deltaErrorSvgRight<=
this.uiElementWidth&&0<=this.settings.positionYAdjusted+this.settings.deltaErrorSvgTop&&this.settings.positionYAdjusted+this.domElemHeight-this.settings.deltaErrorSvgBot<=this.uiElementHeight)};var l=function(b){if(1<=this.xmpDescription.find("img").length){var d=0,g=0,f=this.xmpDescription.find("img").length-1;this.xmpDescription.find("img").each(stage.setContext(function(f,k,l){var q=k.clientHeight,n=k.clientWidth,t=window.getComputedStyle(k);k=t.getPropertyValue("margin-top");var e=t.getPropertyValue("margin-bottom"),
r=t.getPropertyValue("margin-left");t=t.getPropertyValue("margin-right");k.endsWith("px")&&(q+=+k.substring(0,k.indexOf("px")));e.endsWith("px")&&(q+=+e.substring(0,e.indexOf("px")));r.endsWith("px")&&(n+=+r.substring(0,r.indexOf("px")));t.endsWith("px")&&(n+=+t.substring(0,t.indexOf("px")));q+marginHeight>d&&(d=q);n>g&&(g=n);l==f&&b&&b(d,g)},this,f))}},g=function(b,d){this.descriptionAnnotation.css({height:b+"px","overflow-y":1<this.xmpDescription.find("img").length?"scroll":"hidden"});this.descriptionAnnotation.get(0).clientWidth<
d&&this.xmpDescription.find("img").css({"max-width":"100%"});this.bubbleDimension=[this.bubbleAnnotation.get(0).clientHeight,this.bubbleAnnotation.get(0).clientWidth]};d.prototype.open=function(b){if(this.currentlyDisplayed)if(this.active=!0,b=stage.setContext(function(b){this.apiCore.exec(this.callerName,"onAnnotationPinOpened",this.settings.number);b&&b();this.activateWhenVisibleCallback=null;this.device.isMobile&&1<=this.xmpDescription.find("img").length?(this.domElem.addClass("popupAnnotationActive"),
this.popupAnnotation.show(),this.apiCore.exec(this.callerName,"ui.hideMenu"),this.apiCore.exec(this.callerName,"hideArButton"),this.apiCore.exec(this.callerName,"hideArMenu")):(this.domElem.addClass("bubbleAnnotationActive"),this.allPath[0].setAttributeNS(null,"fill",this.settings.foregroundColorActive),b=stage.setContext(function(b,d){g.call(this,b,d);this.descriptionAnnotation.get(0).clientWidth<d&&l.call(this,stage.setContext(g,this))},this),l.call(this,b),"bubbleAnnotationTopBottom"===this.calculNewPosition()?
this.bubbleAnnotation.addClass("bubbleAnnotationTopBottom").removeClass("bubbleAnnotationRightLeft"):this.bubbleAnnotation.addClass("bubbleAnnotationRightLeft").removeClass("bubbleAnnotationTopBottom"))},this,b),this.settings.moveOnClick&&this.settings.point_of_view){var d=this.settings.point_of_view;d&&void 0!==d.camera_position_x&&void 0!==d.camera_target_x&&void 0!==d.camera_up_x&&this.apiCore.exec(this.callerName,"startAnimatingPath",[{position:[d.camera_position_x,d.camera_position_y,d.camera_position_z],
target:[d.camera_target_x,d.camera_target_y,d.camera_target_z],up:[d.camera_up_x,d.camera_up_y,d.camera_up_z],t:this.settings.animationDuration}],null,null,b)}else b();else this.activateWhenVisible=!0,this.activateWhenVisibleCallback=b};d.prototype.close=function(){this.domElem.removeClass("bubbleAnnotationActive");this.domElem.removeClass("popupAnnotationActive");this.popupAnnotation.hide();this.apiCore.exec(this.callerName,"ui.showMenu");this.device.isMobile&&1<=this.xmpDescription.find("img").length&&
(this.apiCore.exec(this.callerName,"showArButton"),this.apiCore.exec(this.callerName,"showArMenu",!this.apiCore.exec(this.callerName,"getArActive"),!0));this.activateWhenVisible=this.active=!1;for(var b in this.allPath)this.allPath[b].setAttributeNS(null,"fill",this.settings.foregroundColor),this.allPath[b].settings.initialColor=this.settings.foregroundColor;if(this.settings.onClose)this.settings.onClose(this,this.device.isMobile&&1<=this.xmpDescription.find("img").length)};d.prototype.setRefreshValue=
function(b){this.refresh=b};d.prototype.setRefreshValueDirectionOfBubble=function(b){this.refreshCalculDirectionBubbleAnnotation=b};d.prototype.configureWidthBubble=function(){this.xmpTitle.addClass("hackCalcWidth");this.xmpDescription.addClass("hackCalcWidth");var b=this.xmpTitle.getWH()[1];var d=this.xmpDescription.getWH()[1];b=b>.4*this.uiElementWidth||d>.4*this.uiElementWidth?.4*this.uiElementWidth:b>.3*this.uiElementWidth||d>.3*this.uiElementWidth?b>d?b:d:b>=d?b>this.settings.minWidthBubbleAnnotation?
b:this.settings.minWidthBubbleAnnotation:d>this.settings.minWidthBubbleAnnotation?d:this.settings.minWidthBubbleAnnotation;b+=1;81==b&&0==this.bubbleAnnotation.css("width")&&(b=this.previousWidth);this.bubbleAnnotation.css({width:b+"px"});this.previousWidth=b;this.xmpTitle.removeClass("hackCalcWidth");this.xmpDescription.removeClass("hackCalcWidth")};d.prototype.updateInfo=function(b){this.settings.description=b.description;this.settings.title=b.title;b.point_of_view&&(this.settings.point_of_view=
b.point_of_view);var d=this.apiCore.exec(this.callerName,"lib.markdown2HTML",this.settings.title),g=this.apiCore.exec(this.callerName,"lib.markdown2HTML",this.settings.description);this.xmpTitle.get(0).innerHTML=d!=this.settings.title?d:u(this.settings.title);this.xmpDescription.get(0).innerHTML=g!=this.settings.description?g:u(this.settings.description);this.resize(this.uiElementWidth,this.uiElementHeight);this.configureWidthBubble();this.active&&this.open();b.title||b.description?this.bubbleAnnotation.show():
this.bubbleAnnotation.hide();this.setStyle()};return d});stage.provide("emersya.viewer.modules.ui.trigger");
stage.register.call(stage.emersya.viewer.modules.ui,"trigger",function(){var b={number:0,textColor:"#ffffff",positionX:0,positionY:0,size:28,stroke:"white",strokeOpacity:.7,fillOpacity:1,foregroundColor:"rgba(0,0,0,0.7)",foregroundColorActive:"#00b1ab",backgroundColor:"#ffffff",type:"target",actionType:"default",hiddenOpacity:.35,movingTime:1200,movingTime2:1400,pointer:[{top:.5,left:.5}],numberedTarget:!1,posTextX:0,posTextY:0,fontWeight:0},d=function(d,k,l){this.settings=stage.extend(!0,{},b,l);
switch(this.settings.type.toLowerCase()){case "moving2":this.settings.type="moving";break;case "moving":this.settings.type="movingNumber";break;case "cross":case "plus":case "movingtarget":case "numbered":case "simple":case "simplecolored":case "pen":case "penline":break;default:this.settings.type="target"}this.uiElement=$$stage(k);this.uiElementWidth=this.uiElement.getWidth();this.uiElementHeight=this.uiElement.getHeight();this.enabled=!0;this.apiCore=d;this.callerName="UICore-Trigger";this.state=
0;this.ray=20;this.outerRay=25;this.strokeWidth=12;this.changedStart=Date.now();this.build()};d.prototype.build=function(){switch(this.settings.type){case "numbered":this.settings.size=30;this.settings.numberActive=!0;this.settings.posTextX=9<this.settings.number?"51%":"53%";this.settings.posTextY="71%";this.settings.fontSize="14px";this.settings.fontWeight=600;break;case "movingNumber":this.settings.size=50;this.settings.fontWeight=600;this.settings.posTextX=9<this.settings.number?"48%":"50%";this.settings.posTextY=
"60%";this.settings.fontSize="14px";this.settings.numberActive=!0;break;case "moving":case "movingTarget":this.settings.size=40}var b="svgTrigger"+this.settings.number;this.domElem=this.uiElement.build([{tagName:"div",returnActive:!0,attributes:{id:"trigger_"+this.settings.number,klass:"annotationContainer",style:{position:"absolute",left:this.settings.positionXAdjusted,top:this.settings.positionYAdjusted}},childs:[{tagName:"div",attributes:{klass:"svgTrigger "+b,style:{width:this.settings.size,height:this.settings.size}}}]}]);
this.svgIcon=stage.emersya.ui.svgIcon(null,{stroke:this.settings.stroke,strokeOpacity:this.settings.strokeOpacity,fillOpacity:this.settings.fillOpacity,foregroundColor:this.settings.foregroundColor});this.fullIcons=this.svgIcon.getTriggerIcons(b);this.fullIcons[this.settings.type]||(this.settings.type="target");this.apiCore.exec(this.callerName,"lib.insertSvg",this.fullIcons[this.settings.type],{mouseOver:!0,text:this.settings.numberActive?this.settings.number:null,posTextX:this.settings.posTextX,
posTextY:this.settings.posTextY,fontSize:this.settings.fontSize,fontWeight:this.settings.fontWeight,fillText:this.settings.textColor,colorOnClick:"colorOnClick"===this.settings.actionType,colorOnClickColor:this.settings.foregroundColorActive});this.circles=[];for(var d in this.domElem.find("circle").selector)this.circles.push(this.domElem.find("circle").get(d));this.currentValueRefresh=this.refresh=1;"movingNumber"!=this.settings.type&&"moving"!=this.settings.type&&"movingTarget"!=this.settings.type||
this.moveTarget();this.settings.positionXAdjusted=this.settings.positionX-this.settings.size*this.settings.pointer[0].left;this.settings.positionYAdjusted=this.settings.positionY-this.settings.size*this.settings.pointer[0].top;this.domElem.listen("mousedown",stage.setContext(function(b){"colorOnClick"===this.settings.actionType&&this.apiCore.exec(this.callerName,"clearColoredTrigger",this.settings.number);if(this.settings.onClick)this.settings.onClick(this,b)},this));this.domElemWidth=this.domElem.getWidth();
this.domElemHeight=this.domElem.getHeight()};d.prototype.resize=function(b,d){this.uiElementWidth=b;this.uiElementHeight=d};d.prototype.setPosition=function(b,d){this.currentValueRefresh==this.refresh?(this.settings.positionX=b,this.settings.positionY=d,this.settings.positionXAdjusted=this.settings.positionX-this.settings.size*this.settings.pointer[0].left,this.settings.positionYAdjusted=this.settings.positionY-this.settings.size*this.settings.pointer[0].top,this.verifyInclusion(),this.domElem.css({left:parseInt(this.settings.positionXAdjusted)+
"px",top:parseInt(this.settings.positionYAdjusted)+"px"}),this.currentValueRefresh=1):this.currentValueRefresh++};d.prototype.setOpacity=function(b){this.domElem.css({opacity:b});if(this.settings.numberActive){var d=this.domElem.find("text").get(0);d&&d.setAttributeNS(null,"fill-opacity",b)}};d.prototype.setVisible=function(b,d,l){this.enabled&&(b&&!this.currentlyOnScreenBorder&&l?d?(this.domElem.show(),this.setOpacity(this.settings.fillOpacity)):0==this.settings.hiddenOpacity?this.domElem.hide():
(this.domElem.show(),this.setOpacity(this.settings.hiddenOpacity)):this.domElem.hide());this.currentlyOnScreen=b;this.currentlyInPlainSight=d;this.currentlyDisplayed=l};d.prototype.enable=function(){this.enabled||(this.enabled=!0,this.setVisible(this.currentlyOnScreen,this.currentlyInPlainSight,this.currentlyDisplayed))};d.prototype.disable=function(){this.enabled&&(this.enabled=!1,this.domElem.hide())};d.prototype.verifyInclusion=function(){this.currentlyOnScreenBorder=!(0<=this.settings.positionXAdjusted&&
this.settings.positionXAdjusted+this.domElemWidth<=this.uiElementWidth&&0<=this.settings.positionYAdjusted&&this.settings.positionYAdjusted+this.domElemHeight<=this.uiElementHeight)};d.prototype.setRefreshValue=function(b){this.refresh=b};d.prototype.setType=function(b){this.fullIcons[b]&&(this.animationFrame&&window.cancelAnimationFrame(this.animationFrame),this.domElem.remove(),this.settings.type=b,this.build(),this.clearColoredTrigger(),this.setPosition(this.settings.positionX,this.settings.positionY),
this.setVisible(this.currentlyOnScreen,this.currentlyInPlainSight,this.currentlyDisplayed),this.enabled?(this.enabled=!1,this.enable()):(this.enabled=!0,this.disable()))};d.prototype.setColor=function(b){b||(b=this.settings.foregroundColorActive);var d=this.fullIcons[this.settings.type],l=document.getElementById(d.container);l||(l=document.getElementsByClassName(d.container)[0]);d.elems[0].overColor=b;l&&$$stage(l).find("svg").last().children().each(stage.setContext(function(g,k){d.elems[k]&&d.elems[k].colorable&&
(-1!=b.indexOf("#")?g.setAttributeNS(null,"fill",b.substring(0,7)):g.setAttributeNS(null,"fill","#"+b.substring(0,7)),g.setAttributeNS(null,"fill-opacity",1))},this))};d.prototype.clearColoredTrigger=function(){this.apiCore.exec(this.callerName,"lib.resetSvg",this.fullIcons[this.settings.type],this.domElem)};d.prototype.moveTarget=function(){var b=15,d=19;if("moving"==this.settings.type||"movingTarget"==this.settings.type)b=13,d=20;this.renderFunction=stage.setContext(function(){this.animationFrame=
window.requestAnimationFrame(this.renderFunction);var k=(Date.now()-this.changedStart)/this.settings.movingTime2;this.ray=b+.5*(Math.sin(Math.PI*k)+1)*(d-b);this.circles[0].setAttributeNS(null,"r",this.ray);"moving"!=this.settings.type&&"movingTarget"!=this.settings.type||this.circles[2].setAttributeNS(null,"r",this.ray)},this);this.animationFrame=window.requestAnimationFrame(this.renderFunction)};return d});stage.provide("emersya.viewer.modules.ui.annotations");stage.require("emersya.viewer.modules.ui.annotation");
stage.require("emersya.viewer.modules.ui.trigger");
stage.register.call(stage.emersya.viewer.modules.ui,"annotations",function(){var b={annotationAnimationInterval:3E3,annotationAnimationDuration:1300,printLinesAlways:!1,mode:"ONEBYONE",heightCase:"AUTO",moveOnClick:!1,hiddenPinOpacity:.6,descriptionFont:"",titleFont:"",openingEventType:0},d=function(d,k,l){this.settings=stage.extend(!0,{},b,l);this.parentElement=k.get(0);this.annotationsRefactoring=[];this.annotationsByNumber={};this.triggers=[];this.annotations=null;this.triggersDisplayed=!0;this.triggersDisplayedList=
new Set;this.annotationsDisplayed=!0;this.annotationsMode=null;this.apiCore=d;this.callerName="UICore-Annotations";this.number=1;this.device=this.apiCore.exec(this.callerName,"getDevice");this.setMode();this.setSettings(this.settings)};d.prototype.setMode=function(b){b?this.settings.mode=b:b=this.settings.mode;this.annotationsMode="ALLTOGETHER"==b?"SIMPLE":"ALLTOGETHERDOUBLE"==b?"DOUBLE":"ONEBYONE"};d.prototype.setHeightCase=function(b){this.settings.annotationsHeightCase=b};d.prototype.setSettings=
function(b){b.over_background_color||(b.over_background_color=b.backgroundOverColor);-1==b.over_background_color.indexOf("#")?this.settings.backgroundOverColor="#"+b.over_background_color.substring(0,6):this.settings.backgroundOverColor=b.over_background_color.substring(0,7);null!=b.descriptionFont&&(this.settings.descriptionFont=""==b.descriptionFont?"OpenSans":b.descriptionFont+", OpenSans");null!=b.titleFont&&(this.settings.titleFont=""==b.titleFont?"OpenSans":b.titleFont+", OpenSans");this.setOpeningEventType(b.openingEventType)};
d.prototype.setHiddenPinOpacity=function(b){this.settings.hiddenPinOpacity=b};d.prototype.setOpeningEventType=function(b){this.settings.openingEventType=this.device.isMobile?0:b};d.prototype.setMoveOnClick=function(b){this.settings.moveOnClick=b};d.prototype.stopAnnotationsAnimation=function(){this.animationTimeout&&clearTimeout(this.animationTimeout);this.animating=!1;this.currentAnnotation=this.animationTimeout=null;for(var b in this.annotationsByNumber)this.annotations[this.annotationsByNumber[b].id].close()};
d.prototype.startAnnotationsAnimation=function(){this.animationTimeout&&clearTimeout(this.animationTimeout);this.animating=!0;this.animationTimeout=null;k.call(this)};var u=function(){this.currentAnnotation&&(this.animationTimeout=setTimeout(stage.setContext(function(){this.animating?k.call(this):this.stopAnnotationsAnimation()},this),this.currentAnnotation.waiting_duration))},k=function(){var b=1;this.currentAnnotation&&this.currentAnnotation.number+1<=this.sourceAnnotations.length&&(b=this.currentAnnotation.number+
1);var d=this.settings.moveOnClick;this.settings.moveOnClick=!0;this.openAnnotation(b,null,stage.setContext(u,this));this.currentAnnotation&&this.apiCore.exec(this.callerName,"onAnnotationPinOpenByManager",this.annotations[this.currentAnnotation.id]);this.settings.moveOnClick=d},l=function(b){this.annotations[b.id]?this.annotations[b.id].domElem.remove():this.managerMultipleAnnotation&&this.managerMultipleAnnotation.allAnnotationsById[b.id]&&this.managerMultipleAnnotation.allAnnotationsById[b.id].domElem.remove();
delete this.annotations[b.id];delete this.annotationsByNumber[b.number];this.managerMultipleAnnotation&&(this.managerMultipleAnnotation.removeLines(),delete this.managerMultipleAnnotation.allAnnotations[b.number-1])};d.prototype.getAnnotationsDisplayed=function(){return this.annotationsDisplayed};d.prototype.getTriggersDisplayed=function(){return this.triggersDisplayed};d.prototype.getDisplayedTriggersList=function(){return Array.from(this.triggersDisplayedList)};d.prototype.toggleAnnotations=function(b,
d,k){var g=this;if("triggers"===b)void 0===d||null===d?void 0===k||null===k?this.triggers.forEach(function(b){g.triggersDisplayedList.has(b.id)?g.triggersDisplayedList.delete(b.id):g.triggersDisplayedList.add(b.id)}):this.triggersDisplayedList.has(k)?this.triggersDisplayedList.delete(k):this.triggersDisplayedList.add(k):d?void 0===k||null===k?this.triggersDisplayedList=new Set(this.triggers.map(function(b){return b.id})):this.triggersDisplayedList.add(k):void 0===k||null===k?this.triggersDisplayedList.clear():
this.triggersDisplayedList.delete(k),this.triggersDisplayed=0<this.triggersDisplayedList.size,this.triggers.forEach(function(b){g.annotations[-b.id]&&(g.triggersDisplayedList.has(b.id)?g.annotations[-b.id].enable():g.annotations[-b.id].disable())});else if(b=this.sourceAnnotations,d=this.annotationsDisplayed=void 0!==d?d:!this.annotationsDisplayed,"ONEBYONE"==this.annotationsMode)if(d)for(var f in b)this.annotations[b[f].id]&&(this.annotations[b[f].id].enable(),this.apiCore.exec(this.callerName,"onAnnotationsPinDisplayed"));
else for(f in b)this.annotations[b[f].id]&&(this.annotations[b[f].id].disable(),this.apiCore.exec(this.callerName,"onAnnotationsPinHidden"));else this.managerMultipleAnnotation&&(d?this.managerMultipleAnnotation.enable():this.managerMultipleAnnotation.disable())};d.prototype.openAnnotation=function(b,d,k){if(this.annotationsByNumber[b]&&this.annotationsByNumber[b].title||d){d||(d=this.annotationsByNumber[b].id);if(null!=this.currentAnnotation)if(this.currentAnnotation.id!=d)b=this.settings.moveOnClick,
this.settings.moveOnClick=!1,this.closeAnnotation(this.currentAnnotation.number,this.currentAnnotation.id),this.settings.moveOnClick=b;else{this.closeAnnotation(this.currentAnnotation.number,this.currentAnnotation.id);return}this.annotations[d].open(k);if(null==this.currentAnnotation||this.currentAnnotation&&this.currentAnnotation.id!=d)this.currentAnnotation=this.annotations[d]}};d.prototype.closeAnnotation=function(b,d){!this.currentAnnotation||this.currentAnnotation.number!=b&&this.currentAnnotation.id!=
d||(this.currentAnnotation=null);if(this.annotationsByNumber[b]&&this.annotationsByNumber[b].title||d)this.apiCore.exec(this.callerName,"onAnnotationPinClosed",b),d||(d=this.annotationsByNumber[b].id),this.annotations[d]&&this.annotations[d].close(),!this.animating&&this.settings.moveOnClick&&null==this.currentAnnotation&&this.apiCore.exec(this.callerName,"resetCamera",this.settings.annotationAnimationDuration)};d.prototype.hideAnnotation=function(b){return this.annotationsByNumber[b]?(this.annotations[this.annotationsByNumber[b].id].disable(),
stage.createResult(1)):stage.createError(319,"Annotations number "+b+" do not exist.")};d.prototype.showAnnotation=function(b){return this.annotationsByNumber[b]?(this.annotations[this.annotationsByNumber[b].id].enable(),stage.createResult(1)):stage.createError(319,"Annotation number "+b+" do not exist.")};d.prototype.toggleAnnotation=function(b){return this.annotationsByNumber[b]?(this.annotations[this.annotationsByNumber[b].id].toggle(),stage.createResult(1)):stage.createError(319,"Annotation number "+
b+" do not exist.")};d.prototype.setAnnotationsOnly=function(b){if(0<this.annotationsRefactoring.length){var d=[];for(k in this.annotationsRefactoring)"annotation"==this.annotationsRefactoring[k].type&&(l.call(this,this.annotationsRefactoring[k]),d.push(k));for(var g=d.length-1;0<=g;g--)this.annotationsRefactoring.splice(d[g],1)}else this.annotationsRefactoring=[],this.annotations={},this.currentAnnotation=null;this.sourceAnnotations=b;this.annotationsByNumber={};this.managerMultipleAnnotation=null;
if("ONEBYONE"==this.settings.mode)for(g in b){d=b[g];this.annotationsRefactoring.push({id:d.id,x:d.position_x,y:d.position_y,z:d.position_z,source_node:d.source_node,nodeLocalId:d.nodeLocalId,number:d.number,type:"annotation"});var k=this.apiCore.exec(this.callerName,"translate","title"+d.id,"Annotation");var f=this.apiCore.exec(this.callerName,"translate","description"+d.id,"Annotation");this.annotations[d.id]=new stage.emersya.viewer.modules.ui.annotation(this.apiCore,this.parentElement,{size:28,
active:this.currentAnnotation?this.currentAnnotation.id==d.id?!0:!1:!1,number:d.number,point_of_view:d.point_of_view,id:d.id,title:k?k:b[g].title,description:f?f:b[g].description,foregroundColorActive:this.settings.backgroundOverColor,fillOpacity:.9,hiddenOpacity:this.settings.hiddenPinOpacity,descriptionFont:this.settings.descriptionFont,titleFont:this.settings.titleFont,openingEventType:this.settings.openingEventType,animationDuration:this.settings.annotationAnimationDuration,moveOnClick:this.settings.moveOnClick,
onClose:stage.setContext(function(b,d){this.currentAnnotation&&d&&this.currentAnnotation&&this.currentAnnotation.id==b.id&&this.currentAnnotation.number==b.number&&(this.currentAnnotation=null)},this),onClick:stage.setContext(function(b,d,f){f.stopPropagation();this.currentAnnotation===b?this.closeAnnotation(b.number,b.id):(d=stage.setContext(function(){this.apiCore.exec(this.callerName,"onAnnotationPinClicked",b.number);this.apiCore.exec(this.callerName,"stopAnnotationsAnimation");this.currentAnnotation=
b;this.apiCore.exec(this.callerName,"stopAutoRotate");this.apiCore.exec(this.callerName,"ui.changeRotateIcon","pause");this.currentAnnotation&&this.apiCore.exec(this.callerName,"onAnnotationPinOpenByClick",this.annotations[this.currentAnnotation.id])},this),this.openAnnotation(b.number,b.id,d))},this,d)});this.annotations[d.id].number=d.number;this.annotations[d.id].point_of_view=d.point_of_view;this.annotations[d.id].id=d.id;this.annotations[d.id].waiting_duration=d.waiting_duration;this.annotationsByNumber[d.number]=
d}else for(f in this.started=!1,this.managerMultipleAnnotation=new stage.emersya.viewer.modules.ui.multipleAnnotation(this.apiCore,this.parentElement,{mode:this.annotationsMode,heightCase:-1<this.settings.annotationsHeightCase.indexOf("AUTO")||-1<this.settings.annotationsHeightCase.indexOf("auto")?"AUTO":parseInt(this.settings.annotationsHeightCase.replace(/[^0-9]/g,"")),optimization:!0}),b)d=b[f],k=this.apiCore.exec(this.callerName,"translate","title"+d.id,"Annotation"),this.annotationsRefactoring.push({id:d.id,
x:d.position_x,y:d.position_y,z:d.position_z,source_node:d.source_node,nodeLocalId:d.nodeLocalId,number:d.number,type:"annotation"}),this.managerMultipleAnnotation.addMultipleAnnotation({id:d.id,number:d.number,title:k?k:d.title});this.apiCore.exec(this.callerName,"rdr.setAnnotations",this.annotationsRefactoring)};d.prototype.setTriggersOnly=function(b,d){d=void 0===d?!1:d;if(0<this.annotationsRefactoring.length){var g=[],k;for(k in this.annotationsRefactoring)"trigger"==this.annotationsRefactoring[k].type&&
(this.annotations[this.annotationsRefactoring[k].id].domElem.remove(),delete this.annotations[this.annotationsRefactoring[k].id],g.push(k));for(var f=g.length-1;0<=f;f--)this.annotationsRefactoring.splice(g[f],1)}else this.annotationsRefactoring=[],this.annotations={};this.number=1;this.triggers=b;this.triggersDisplayedList.clear();for(f in this.triggers)b=this.triggers[f],(d||b.inUse||b.forceInUse)&&!this.annotations[-b.id]&&(this.annotationsRefactoring.push({id:-b.id,x:b.x,y:b.y,z:b.z,source_node:b.sourceNodeId,
nodeLocalId:b.nodeLocalId,number:this.number,type:"trigger"}),this.annotations[-b.id]=new stage.emersya.viewer.modules.ui.trigger(this.apiCore,this.parentElement,{number:b.id,fillOpacity:.9,hiddenOpacity:b.opacity,type:b.type,actionType:b.actionType?b.actionType:"",foregroundColorActive:this.settings.backgroundOverColor,onClick:stage.setContext(function(b,d,f){this.apiCore.exec(this.callerName,"onAnimationTriggerClicked",b);f.stopPropagation()},this,b.id)}),this.triggersDisplayedList.add(b.id),this.number++);
this.apiCore.exec(this.callerName,"rdr.setAnnotations",this.annotationsRefactoring);this.triggersDisplayed=0<this.triggersDisplayedList.size};d.prototype.move=function(b){if("ONEBYONE"==this.settings.mode)for(var d in b){var g=b[d];this.annotations[g.id]&&(this.annotations[g.id].setPosition(g.x,g.y),this.annotations[g.id].setVisible(0<=g.z,g.visible,g.displayed))}else if(stage.setContext(function(){this.managerMultipleAnnotation&&this.managerMultipleAnnotation.moveAnnotations()},this),this.managerMultipleAnnotation){for(d in b)g=
b[d],this.managerMultipleAnnotation.allAnnotationsById[g.id]?this.managerMultipleAnnotation.allAnnotationsById[g.id].setPosition(g.x,g.y):this.annotations[g.id]&&(this.annotations[g.id].setPosition(g.x,g.y),this.annotations[g.id].setVisible(0<=g.z,g.visible,g.displayed));this.started||(this.started=!0,this.managerMultipleAnnotation.moveAnnotations())}};d.prototype.endCameraInteraction=function(){this.managerMultipleAnnotation&&this.managerMultipleAnnotation.moveAnnotations()};d.prototype.startCameraInteraction=
function(){this.managerMultipleAnnotation&&this.managerMultipleAnnotation.moveAnnotations()};d.prototype.resize=function(b,d){for(var g in this.annotations)this.annotations[g].resize(b,d);this.managerMultipleAnnotation&&this.managerMultipleAnnotation.resize(b,d)};d.prototype.updateAnnotation=function(b){if(b)if("ONEBYONE"==this.settings.mode){this.annotations[b.id]&&this.annotations[b.id].updateInfo(b);for(var d in this.annotationsRefactoring)this.annotationsRefactoring[d].id==b.id&&(void 0!==b.position_x&&
(this.annotationsRefactoring[d].x=b.position_x),void 0!==b.position_y&&(this.annotationsRefactoring[d].y=b.position_y),void 0!==b.position_z&&(this.annotationsRefactoring[d].z=b.position_z),void 0!==b.source_node&&(this.annotationsRefactoring[d].source_node=b.source_node),void 0!==b.number&&(this.annotationsRefactoring[d].number=b.number),void 0!==b.title&&(this.annotationsRefactoring[d].title=b.title),void 0!==b.description&&(this.annotationsRefactoring[d].description=b.description));this.apiCore.exec(this.callerName,
"rdr.setAnnotations",this.annotationsRefactoring)}else this.managerMultipleAnnotation.updateAnnotation(b)};d.prototype.updateLanguage=function(){for(var b=$jscomp.makeIterator(this.sourceAnnotations),d=b.next();!d.done;d=b.next()){d=d.value;var k=this.apiCore.exec(this.callerName,"translate","title"+d.id,"Annotation"),l=this.apiCore.exec(this.callerName,"translate","description"+d.id,"Annotation");this.annotations[d.id].updateInfo({title:k?k:d.title,description:l?l:d.description})}};d.prototype.setTriggerColor=
function(b,d){this.annotations[-b]&&this.annotations[-b].setColor(d)};d.prototype.setTriggersColor=function(b){for(var d in this.annotations)0>d&&this.annotations[d].setColor(b)};d.prototype.setTriggerType=function(b,d){this.annotations[-b]&&this.annotations[-b].setType(d)};d.prototype.setTriggersType=function(b){for(var d in this.annotations)0>d&&this.annotations[d].setType(b)};d.prototype.clearColoredTrigger=function(b){for(var d in this.annotations)this.annotations[d].settings.number!=b&&"colorOnClick"==
this.annotations[d].settings.actionType&&this.annotations[d].clearColoredTrigger()};d.prototype.activateEmptyTriggers=function(){this.setTriggersOnly(this.triggers,!0)};return d});stage.provide("emersya.viewer.modules.ui.multipleAnnotation");
stage.register.call(stage.emersya.viewer.modules.ui,"multipleAnnotation",function(){var b={title:"Test",textColor:"#ffffff",fillColor:"white",fillWeight:1,positionX:0,positionY:0,size:35,stroke:"white",strokeOpacity:.7,fillOpacity:1,foregroundColor:"rgba(255,255,255,0.7)",backgroundColor:"#ffffff",type:"target",number:0,fontFamily:"OpenSans",fontSize:"16px",fontWeight:"bold",id:0,titleWidth:120},d=function(d,k,l,r,f){this.settings=stage.extend(!0,{},b,l);this.pos={x:this.settings.positionX,y:this.settings.positionY};
this.uiElement=$$stage(k);this.multipleAnnotation=this.build();this.posAngle=null;this.a=0;this.b=this.pos.y;this.svg=r.mainSVG;this.currentCase=null;this.controler=r;this.domId=f;this.sizeTexte=this.settings.titleWidth;this.apiCore=d;this.callerName="UICore-Trigger";this.number=this.settings.number;this.svgWidth=$$stage($$stage("#multipleAnnotation_"+this.settings.number).find(".svgAnnotation").get(0)).getWidth();this.svgHeight=$$stage($$stage("#multipleAnnotation_"+this.settings.number).find(".svgAnnotation").get(0)).getHeight()};
d.prototype.build=function(){var b={type:this.settings.type,size:this.settings.size};this.domElem=this.uiElement.build([{tagName:"div",returnActive:!0,attributes:{id:"multipleAnnotation_"+this.settings.number,klass:"multipleAnnotationContainer"},childs:[{tagName:"div",attributes:{klass:"svgAnnotation"}}]}]);this.svgIcon=stage.emersya.ui.svgIcon(this.domElem.get(0).firstChild,b);this.fullIcons=this.svgIcon.getTriggerIcons("multipleAnnotation_"+this.settings.number);this.apiCore.exec(this.callerName,
"lib.insertSvg",this.fullIcons.defaultTarget,{mouseOver:!1,text:null,posTextX:"51%",posTextY:"51%",fontSize:"70%",fontWeight:"700"});this.domElem.css({position:"absolute"});this.updatePosPin();this.heightOfRes=this.domElem.getHeight();this.svgAnnotation=this.domElem.find(".svgAnnotation");this.realOffsetOfCenterPin=this.domElem.selector[0].offsetTop+this.heightOfRes/2};d.prototype.updatePosPin=function(){this.positionXAdjusted=this.pos.x-.5*this.settings.size;this.positionYAdjusted=this.pos.y-.5*
this.settings.size;this.domElem.css({left:this.positionXAdjusted,top:this.positionYAdjusted})};d.prototype.verifyIntersection=function(b){if(this.verifyHorizontalPin(b)||b.verifyHorizontalPin(this))return!0;var d=this.posAngle?this.posAngle.x:this.pos.x,g=this.posAngle?this.posAngle.y:this.pos.y,k=b.posAngle?b.posAngle.x:b.pos.x,f=b.posAngle?b.posAngle.y:b.pos.y;if(Math.abs(f-g)<=this.heightOfRes/2||b.posAngle&&(g=(g-b.b)/b.a,Math.min(d,this.xCasePos)<=g&&g<=Math.max(d,this.xCasePos)&&Math.min(k,
b.pos.x)<=g&&g<=Math.max(k,b.pos.x)||b.verifyPosAnglePin(this)))return!0;if(this.posAngle){if(this.verifyBiaisPin(b)||b.verifyBiaisPin(this)||this.verifyPosAnglePin(b))return!0;g=(f-this.b)/this.a;if(Math.min(d,this.pos.x)<=g&&g<=Math.max(d,this.pos.x)&&Math.min(k,b.xCasePos)<=g&&g<=Math.max(k,b.xCasePos)||this.a!=b.a&&b.posAngle&&(d=(b.b-this.b)/(this.a-b.a),k=this.a*d+this.b,Math.min(this.pos.x,this.posAngle.x)<=d&&d<=Math.max(this.pos.x,this.posAngle.x)&&Math.min(b.pos.x,b.posAngle.x)<=d&&d<=Math.max(b.pos.x,
b.posAngle.x)&&Math.min(this.pos.y,this.posAngle.y)<=k&&k<=Math.max(this.pos.y,this.posAngle.y)&&Math.min(b.pos.y,b.posAngle.y)<=k&&k<=Math.max(b.pos.y,b.posAngle.y)))return!0}return!1};d.prototype.verifyPosAnglePin=function(b){return this.posAngle&&Math.sqrt(Math.pow(this.posAngle.x-b.pos.x,2)+Math.pow(this.posAngle.y-b.pos.y,2))<this.heightOfRes/2?!0:!1};d.prototype.verifyHorizontalPin=function(b){var d=this.posAngle?this.posAngle.x:this.pos.x;return Math.abs(b.pos.y-(this.posAngle?this.posAngle.y:
this.pos.y))<=this.heightOfRes/2&&(this.xCasePos>this.pos.x?d<=b.pos.x:d>=b.pos.x)?!0:!1};d.prototype.verifyBiaisPin=function(b){if(!this.posAngle)return!1;var d=this.posAngle.x,g=this.posAngle.y;return Math.abs(this.a*b.pos.x-b.pos.y+this.b)/Math.sqrt(1+this.a*this.a)<this.heightOfRes/2&&b.pos.x>=Math.min(d,this.pos.x)&&b.pos.x<=Math.max(d,this.pos.x)&&b.pos.y>=Math.min(g,this.pos.y)&&b.pos.y<=Math.max(g,this.pos.y)?!0:!1};d.prototype.calculLineAngle=function(b,d){this.a=(this.pos.y-d)/(this.pos.x-
b);if(0<this.a)this.a=1;else if(0>this.a)this.a=-1;else{this.a=0;this.posAngle=null;return}this.b=this.pos.y-this.a*this.pos.x;this.posAngle={x:(d-this.b)/this.a,y:d};this.xCasePos=b};d.prototype.reset=function(){this.a=0;this.b=this.pos.y;this.posAngle=null};d.prototype.updateLine=function(){if(!this.removed)if(this.polyline||(this.polyline=this.svg.build([{tagName:"polyline",nameSpace:"http://www.w3.org/2000/svg",attributes:{id:"polyline_"+this.settings.number,points:"",style:"fill : none; stroke :"+
this.settings.fillColor+"; stroke-width:"+this.settings.fillWeight+";"}}])),this.posAngle){if(this.pos.x<this.xCasePos?$stage("polyline_"+this.domId).setAttributeNS(null,"points",this.pos.x+","+this.pos.y+" "+this.posAngle.x+","+this.posAngle.y+" "+this.xCasePos+","+this.posAngle.y+" "+(this.xCasePos+5)+","+this.posAngle.y):$stage("polyline_"+this.domId).setAttributeNS(null,"points",this.pos.x+","+this.pos.y+" "+this.posAngle.x+","+this.posAngle.y+" "+this.xCasePos+","+this.posAngle.y+" "+(this.xCasePos-
5)+","+this.posAngle.y),!this.textAnnotation){var b=[{tagName:"div",attributes:{klass:"titleMultipleAnnotationContainer",id:"titleAnnotation_"+this.settings.number},childs:[{tagName:"div",attributes:{klass:"titleMultipleAnnotationText",inner:this.settings.title}}]}];this.uiElement.build(b);this.textAnnotation=$$stage("#titleAnnotation_"+this.settings.number);this.pos.x<this.xCasePos?this.textAnnotation.css({color:this.settings.textColor,fontSize:this.settings.fontSize,top:this.posAngle.y-this.controler.heightCase/
2+"px",left:this.xCasePos+20+"px",height:this.controler.heightCase,"text-align":"left"}):this.textAnnotation.css({color:this.settings.textColor,fontSize:this.settings.fontSize,top:this.posAngle.y-this.controler.heightCase/2+"px",left:this.xCasePos-20-120+"px",height:this.controler.heightCase,"text-align":"right"})}}else this.pos.x<this.xCasePos?$stage("polyline_"+this.domId).setAttributeNS(null,"points",this.pos.x+","+this.pos.y+" "+this.xCasePos+","+this.pos.y+" "+(this.xCasePos+5)+","+this.pos.y):
$stage("polyline_"+this.domId).setAttributeNS(null,"points",this.pos.x+","+this.pos.y+" "+this.xCasePos+","+this.pos.y+" "+(this.xCasePos-5)+","+this.pos.y),this.textAnnotation||(b=[{tagName:"div",attributes:{klass:"titleMultipleAnnotationContainer",id:"titleAnnotation_"+this.settings.number,inner:this.settings.title}}],this.uiElement.build(b),this.textAnnotation=$$stage("#titleAnnotation_"+this.settings.number),this.pos.x<this.xCasePos?this.textAnnotation.css({color:this.settings.textColor,fontSize:this.settings.fontSize,
top:this.pos.y-this.controler.heightCase/2+"px",left:this.xCasePos+20+"px",height:this.controler.heightCase,"text-align":"left"}):this.textAnnotation.css({color:this.settings.textColor,top:this.pos.y-this.controler.heightCase/2+"px",fontSize:this.settings.fontSize,left:this.xCasePos-20-120+"px",height:this.controler.heightCase,"text-align":"right"}))};d.prototype.removeLine=function(){this.polyline?$stage("polyline_"+this.domId).setAttributeNS(null,"points",""):this.polyline=this.svg.build([{tagName:"polyline",
nameSpace:"http://www.w3.org/2000/svg",attributes:{id:"polyline_"+this.settings.number,points:"",style:"fill : none; stroke :"+this.settings.fillColor+"; stroke-width:"+this.settings.fillWeight+";"}}]);this.textAnnotation&&(this.textAnnotation.remove(),this.textAnnotation=null);this.removed=!0};d.prototype.hideSVG=function(){this.svgAnnotation&&this.svgAnnotation.hide()};d.prototype.showSVG=function(){this.svgAnnotation&&this.svgAnnotation.show()};d.prototype.enable=function(){this.removed=!1};d.prototype.length=
function(){if(this.posAngle){var b=Math.sqrt(Math.pow(this.pos.x-this.posAngle.x,2)+Math.pow(this.pos.y-this.posAngle.y,2));b+=Math.abs(this.settings.posMaxX-this.posAngle.x)}else b=Math.abs(this.settings.posMaxX-this.pos.x);return b};d.prototype.distance=function(b){return Math.sqrt(Math.pow(this.pos.x-b.pos.x,2)+Math.pow(this.pos.y-b.pos.y,2))};d.prototype.setPosition=function(b,d){this.settings.positionX=b;this.settings.positionY=d;(.2<Math.abs(this.pos.x-b)||.2<Math.abs(this.pos.y-d))&&this.removeLine();
this.pos.x=b;this.pos.y=d;this.positionXAdjusted=this.pos.x-.5*this.settings.size;this.positionYAdjusted=this.pos.y-.5*this.settings.size;this.domElem.css({left:this.positionXAdjusted,top:this.positionYAdjusted})};d.prototype.updateInfo=function(b){$$stage("#titleAnnotation_"+b.number).find(".titleMultipleAnnotationText").get(0).innerHTML=b.title};var u={offset:100,heightCase:"AUTO",minHeightCase:25,posMaxX:.8,posMinX:.2,mode:"SIMPLE",optimization:!0},k=function(b,d,k){this.settings=stage.extend(!0,
{},u,k);this.apiCore=b;this.element=d;this.uiElement=$$stage(d);this.build();this.allAnnotations=[];this.leftAnnotations=[];this.rightAnnotations=[];this.mainSVG=$$stage(".lineSVG");this.allAnnotationsById={};this.heightCase=this.settings.heightCase;b=this.uiElement.getWidth();this.posMinX=b*this.settings.posMinX;this.posMaxX=b*this.settings.posMaxX;this.displayed=!0;"AUTO"===this.settings.heightCase&&(this.allAnnotations.length?(this.heightCase=Math.floor((this.uiElement.getHeight()-2*this.settings.offset)/
this.allAnnotations.length),this.heightCase<this.settings.minHeightCase&&(this.heightCase=this.settings.minHeightCase)):this.heightCase=this.settings.minHeightCase);this.generateTableOfIndice()};k.prototype.resize=function(b,d){this.mainSVG.css({width:b,height:d});"AUTO"===this.settings.heightCase&&(this.allAnnotations.length?(this.heightCase=Math.floor((this.uiElement.getHeight()-2*this.settings.offset)/this.allAnnotations.length),this.heightCase<this.settings.minHeightCase&&(this.heightCase=this.settings.minHeightCase)):
this.heightCase=this.settings.minHeightCase);this.generateTableOfIndice();this.posMinX=b*this.settings.posMinX;this.posMaxX=b*this.settings.posMaxX;setTimeout(stage.setContext(function(){this.moveAnnotations()},this),100)};k.prototype.build=function(){$$stage(".lineSVG").remove();var b=[{tagName:"svg",nameSpace:"http://www.w3.org/2000/svg",attributes:{klass:"lineSVG",height:this.uiElement.getHeight(),width:this.uiElement.getWidth()}}];this.domElem=this.uiElement.build(b)};k.prototype.generateTableOfIndice=
function(){var b=this.uiElement.getHeight();this.numberAnnotations=Math.floor((b-2*this.settings.offset)/this.heightCase);0>this.numberAnnotations&&(this.numberAnnotations=0);this.offset=(b-this.heightCase*this.numberAnnotations)/2;this.tableOfIndice=[];for(b=0;b<=this.numberAnnotations/2;++b)this.tableOfIndice.push(this.numberAnnotations/2+b),this.tableOfIndice.push(this.numberAnnotations/2-b)};k.prototype.addMultipleAnnotation=function(b){var g=new d(this.apiCore,this.element,b,this,this.allAnnotations.length+
1);this.allAnnotations.push(g);this.allAnnotationsById[b.id]=g;"AUTO"===this.settings.heightCase&&(this.heightCase=Math.floor((this.uiElement.getHeight()-2*this.settings.offset)/("SIMPLE"===this.settings.mode?this.allAnnotations.length:this.allAnnotations.length/2+1)),this.heightCase<this.settings.minHeightCase&&(this.heightCase=this.settings.minHeightCase),this.generateTableOfIndice())};k.prototype.splitAllAnnotations=function(){this.rightAnnotations=[];this.leftAnnotations=[];if("DOUBLE"===this.settings.mode)this.allAnnotations.sort(function(b,
d){return b.pos.x<d.pos.x?-1:b.pos.x>d.pos.x?1:0}),this.leftAnnotations=this.allAnnotations.slice(0,this.allAnnotations.length/2),this.rightAnnotations=this.allAnnotations.slice(this.allAnnotations.length/2,this.allAnnotations.length);else for(var b in this.allAnnotations)this.rightAnnotations[b]=this.allAnnotations[b]};var l=function(b,d,k,l,f,n,u,w,D,A,H,e){this.mode=D;this.level=b;this.nbLevels=H;this.parent=d;this.leaves=f;this.posMaxX=n;this.posMinX=u;this.children=[];this.annotation=k;this.xAnnotation=
l;this.optimization=A;this.sizeContainer=w;this.computeHeight=e};l.prototype.recursInit=function(b){this.annotation&&this.annotation.calculLineAngle(this.xAnnotation,this.computeHeight(this.level));if(this.level>=this.nbLevels||!b.length)this.leaves[this.computeDepth()]&&this.leaves[this.computeDepth()].push(this);else{for(var d=0;d<b.length;++d){var g=b[d],k=new l(this.level+1,this,g,this.xAnnotation,this.leaves,this.posMaxX,this.posMinX,this.sizeContainer,this.mode,this.optimization,this.nbLevels,
this.computeHeight);g.calculLineAngle(this.xAnnotation,this.computeHeight(this.level+1));var f=verifyInclusion({x:g.positionXAdjusted,y:g.positionYAdjusted},{width:g.svgWidth,height:g.svgHeight},g.uiElement);(g.pos.x<g.xCasePos&&g.sizeTexte+this.posMaxX<this.sizeContainer||g.pos.x>g.xCasePos&&g.sizeTexte<this.posMinX)&&f&&(k.checkParentsPosition(b)?(b.splice(d,1),k.recursInit(b),b.splice(d,0,g),this.children.push(k)):k.annotation.reset())}if(this.optimization&&!this.children.length||!this.optimization)this.children[0]=
new l(this.level+1,this,null,this.xAnnotation,this.leaves,this.posMaxX,this.posMinX,this.sizeContainer,this.mode,this.optimization,this.nbLevels,this.computeHeight),this.children[0].recursInit(b)}};l.prototype.checkParentsPosition=function(b){this.annotation.calculLineAngle(this.xAnnotation,this.computeHeight(this.level));if(this.annotation.pos.x>this.posMaxX||this.annotation.pos.x<this.posMinX&&"DOUBLE"===this.mode||this.annotation.posAngle&&(this.annotation.posAngle.x>this.posMaxX||this.annotation.posAngle.x<
this.posMinX))return!1;for(var d=[this.parent],g=0;g<b.length;++g)if(b[g]!==this.annotation&&(this.annotation.verifyBiaisPin(b[g])||this.annotation.verifyPosAnglePin(b[g])||this.annotation.verifyHorizontalPin(b[g])))return!1;for(g=0;g<d.length;++g){d[g].annotation&&d[g].annotation.calculLineAngle(this.xAnnotation,this.computeHeight(d[g].level));if(d[g].annotation&&(this.annotation.verifyIntersection(d[g].annotation)||d[g].annotation.verifyIntersection(this.annotation)))return!1;d[g].parent&&d.push(d[g].parent)}return!0};
l.prototype.computeDepth=function(){for(var b=[this],d=0,k=0;k<b.length;++k)b[k].annotation&&++d,b[k].parent&&b.push(b[k].parent);return d};verifyInclusion=function(b,d,k){return 0<b.x&0<b.y&b.x+d.width<k.getWidth()&&b.y+d.height<k.getHeight()?!0:!1};k.prototype.moveAnnotations=function(){if(this.displayed){this.splitAllAnnotations(this.allAnnotations);for(var b=this.numberAnnotations,d=this.posMaxX,k=this.posMinX,r=[this.posMaxX,this.posMinX],f=[this.rightAnnotations,this.leftAnnotations],n=stage.setContext(function(b){return this.tableOfIndice[b]*
this.heightCase+this.offset},this),u=0;2>u;++u){for(var w=[],D=r[u],A=f[u],H=0;H<=b;++H)w[H]=[];for(H in A)A[H].reset();var e=[];for(H in A)e[H]=A[H];(new l(0,null,null,D,w,d,k,this.uiElement.getWidth(),this.settings.mode,this.settings.optimization,b,n)).recursInit(e);e=0;for(H=b;0<=H;--H)if(w[H].length){e=H;break}for(H in A)A[H].removeLine(H);A=w[e][0];var E=null;for(H in w[e]){for(var F=w[e][H],p=0,m=0;null!=F;)F.annotation&&(p+=F.annotation.length(),++m),F=F.parent;p/=m;E?p<E&&(E=p,A=w[e][H]):
(E=p,A=w[e][H])}for(;null!==A;)null!==A.annotation&&(A.annotation.calculLineAngle(D,n(A.level)),A.annotation.enable()),A=A.parent}this.updateLines()}return!1};k.prototype.enable=function(){this.displayed=!0;for(var b in this.allAnnotations)this.allAnnotations[b].showSVG();this.moveAnnotations()};k.prototype.disable=function(){this.displayed=!1;this.removeLines();for(var b in this.allAnnotations)this.allAnnotations[b].hideSVG()};k.prototype.updateLines=function(){for(var b in this.allAnnotations)this.allAnnotations[b].updateLine()};
k.prototype.removeLines=function(){for(var b in this.allAnnotations)this.allAnnotations[b].removeLine()};k.prototype.updateAnnotation=function(b){for(var d in this.allAnnotations)if(this.allAnnotations[d].number===b.number){this.allAnnotations[d].updateInfo(b);break}};k.prototype.test=function(){this.addMultipleAnnotation({positionX:300,positionY:300,number:1,title:"test1",id:1});this.addMultipleAnnotation({positionX:500,positionY:20,number:2,title:"test2",id:2});this.addMultipleAnnotation({positionX:350,
positionY:120,number:3,title:"test3",id:3});this.addMultipleAnnotation({positionX:350,positionY:100,number:4,title:"test4",id:4});this.addMultipleAnnotation({positionX:350,positionY:244,number:5,title:"test5",id:5});this.addMultipleAnnotation({positionX:350,positionY:500,number:6,title:"test6"});this.addMultipleAnnotation({positionX:500,positionY:320,number:7,title:"test7"});this.addMultipleAnnotation({positionX:500,positionY:350,number:8,title:"test8"});this.addMultipleAnnotation({positionX:500,
positionY:450,number:9,title:"test9"});this.addMultipleAnnotation({positionX:500,positionY:505,number:10,title:"test10"});this.addMultipleAnnotation({positionX:135,positionY:200,number:11,title:"test11"});this.addMultipleAnnotation({positionX:485,positionY:346,number:12,title:"test12"});this.addMultipleAnnotation({positionX:334,positionY:431,number:13,title:"test13"});this.addMultipleAnnotation({positionX:368,positionY:221,number:14,title:"test14"});this.addMultipleAnnotation({positionX:354,positionY:445,
number:15,title:"test15"});this.moveAnnotations()};return k});stage.provide("emersya.viewer.modules.ui.startingTutorial");
stage.register.call(stage.emersya.viewer.modules.ui,"startingTutorial",function(){var b={backgroundNormalColor:"#303030",foregroundSelectedColor:"#00b1ab",integratedInFullLoader:!1,wheelOnCtrl:!1},d=function(d,k,l){this.settings=stage.extend(!0,{},b,l);this.parentElement=k;this.apiCore=d;this.callerName="UICore-startingTutorial";this.svgIcon=stage.emersya.ui.svgIcon(null,this.settings);this.startingTutorialIcons=this.svgIcon.getStartingTutorialIcons();this.isMobile=this.apiCore.exec(this.callerName,
"getDevice").isMobile;this.displayed=null;u.call(this)};d.prototype.destroy=function(){};d.prototype.show=function(){this.startingTutorialContainer.show();this.startingTutorialContainer.removeClass("fade");this.displayed=!0};d.prototype.hide=function(){this.startingTutorialContainer.hide();this.displayed=!1};d.prototype.fade=function(b){this.displayed&&!b&&this.startingTutorialContainer.addClass("fade")};d.prototype.moveBottom=function(){if(this.displayed){var b=this.parentElement.get(0).clientWidth,
d=600>b?8:15;if(this.settings.integratedInFullLoader){var k=600>b?12:16;this.titleContainer.css({fontSize:k+"px"});this.startingTutorialContainer.css({backgroundColor:"rgba(0,0,0,0.7)",bottom:"0px",top:"auto",padding:d+"px",height:2*d+90+"px"});setTimeout(stage.setContext(function(){this.blocsContainer.css({top:"auto"})},this),200)}else{var r=this.parentElement.get(0).clientHeight;this.startingTutorialContainer.get(0);this.startingTutorialContainer.css({backgroundColor:"rgba(0,0,0,0.7)",transform:"translateY("+
(r-(2*d+98))/2+"px)"});setTimeout(stage.setContext(function(){var f=l.call(this,k);this.startingTutorialContainer.css({left:b/2-(2*d+f)/2+"px",bottom:"20px",top:"auto","-webkit-transition":"-webkit-transform 0s","-moz-transition":"transform 0s","-ms-transition":"transform 0s","-o-transition":"transform 0s",transform:"none"})},this),200)}}};d.prototype.updatePosition=function(){k.call(this)};d.prototype.updateLanguage=function(b){this.rotateTextContainer.update(this.apiCore.exec(this.callerName,"translate",
"rotate"));this.moveTextContainer.update(this.apiCore.exec(this.callerName,"translate","translate"));this.zoomTextContainer.update(this.apiCore.exec(this.callerName,"translate","zoom"))};d.prototype.reload=function(b){this.settings=stage.extend(!0,{},this.settings,b);u.call(this)};var u=function(){this.startingTutorialContainer&&this.startingTutorialContainer.remove();this.startingTutorialContainer=$$stage(stage.build(this.parentElement.selector[0],[{tagName:"div",returnActive:!0,attributes:{klass:this.settings.integratedInFullLoader?
"startingTutorialContainer startingTutorialContainerFullLoaderIntegrated":"startingTutorialContainer"},childs:[]}]));var b=[];b.push({tagName:"div",attributes:{klass:"startingTutorialIconContainerContent rotateBlocContent"},childs:[{tagName:"div",attributes:{klass:"startingTutorialIconContainerContentTitleIcon",id:"startingTutorialIconContainerContentTitleIconRotate"}},{tagName:"div",attributes:{klass:"startingTutorialIconContainerContentTitle rotate",inner:this.apiCore.exec(this.callerName,"translate",
"rotate")}},{tagName:"div",attributes:{klass:"startingTutorialIconContainerContentExplanation"},childs:[{tagName:"div",attributes:{klass:"startingTutorialIconContainerContentExplanationBlocSide svgMouseLeftClic",id:"startingTutorialSvgMouseLeftClic"}},{tagName:"div",attributes:{klass:"startingTutorialIconContainerContentExplanationBlocSideTouch touchRotateBloc svgRotateTouch",id:"startingTutorialSvgRotateTouch"}}]}]});b.push({tagName:"div",attributes:{klass:"startingTutorialIconContainerContent moveBlocContent"},
childs:[{tagName:"div",attributes:{klass:"startingTutorialIconContainerContentTitleIcon",id:"startingTutorialIconContainerContentTitleIconTranslate"}},{tagName:"div",attributes:{klass:"startingTutorialIconContainerContentTitle move",inner:this.apiCore.exec(this.callerName,"translate","translate")}},{tagName:"div",attributes:{klass:"startingTutorialIconContainerContentExplanation"},childs:[{tagName:"div",attributes:{klass:"startingTutorialIconContainerContentExplanationBlocSide svgMouseRightClic",
id:"startingTutorialSvgMouseRightClic"}},{tagName:"div",attributes:{klass:"startingTutorialIconContainerContentExplanationBlocSideTouch touchMoveBloc svgMoveTouch",id:"startingTutorialSvgMoveTouch"}}]}]});this.settings.wheelOnCtrl?b.push({tagName:"div",attributes:{klass:"startingTutorialIconContainerContent zoomBlocContent"},childs:[{tagName:"div",attributes:{klass:"startingTutorialIconContainerContentTitleIcon",id:"startingTutorialIconContainerContentTitleIconZoom"}},{tagName:"div",attributes:{klass:"startingTutorialIconContainerContentTitle zoom",
inner:this.apiCore.exec(this.callerName,"translate","zoom")}},{tagName:"div",attributes:{klass:"startingTutorialIconContainerContentExplanation"},childs:[{tagName:"div",attributes:{klass:"startingTutorialIconContainerContentExplanationBlocSide svgMouseWheelOnCtrl",id:"startingTutorialSvgMouseWheelOnCtrl",inner:"CTRL + "}},{tagName:"div",attributes:{klass:"startingTutorialIconContainerContentExplanationBlocSide svgMouseWheelClic",id:"startingTutorialSvgMouseWheelClic"}},{tagName:"div",attributes:{klass:"startingTutorialIconContainerContentExplanationBlocSideTouch touchZoomBloc svgZoomTouch",
id:"startingTutorialSvgZoomTouch"}}]}]}):b.push({tagName:"div",attributes:{klass:"startingTutorialIconContainerContent zoomBlocContent"},childs:[{tagName:"div",attributes:{klass:"startingTutorialIconContainerContentTitleIcon",id:"startingTutorialIconContainerContentTitleIconZoom"}},{tagName:"div",attributes:{klass:"startingTutorialIconContainerContentTitle zoom",inner:this.apiCore.exec(this.callerName,"translate","zoom")}},{tagName:"div",attributes:{klass:"startingTutorialIconContainerContentExplanation"},
childs:[{tagName:"div",attributes:{klass:"startingTutorialIconContainerContentExplanationBlocSide svgMouseWheelClic",id:"startingTutorialSvgMouseWheelClic"}},{tagName:"div",attributes:{klass:"startingTutorialIconContainerContentExplanationBlocSideTouch touchZoomBloc svgZoomTouch",id:"startingTutorialSvgZoomTouch"}}]}]});$$stage(stage.build(this.startingTutorialContainer.selector[0],b));this.blocsContainer=this.startingTutorialContainer.find(".startingTutorialIconContainerContent");this.titleContainer=
this.startingTutorialContainer.find(".startingTutorialIconContainerContentTitle");this.rotateTouchContainer=this.startingTutorialContainer.find(".svgRotateTouch");this.moveTouchContainer=this.startingTutorialContainer.find(".svgMoveTouch");this.zoomTouchContainer=this.startingTutorialContainer.find(".svgZoomTouch");this.rotateMouseContainer=this.startingTutorialContainer.find(".svgMouseLeftClic");this.moveMouseContainer=this.startingTutorialContainer.find(".svgMouseRightClic");this.zoomMouseContainer=
this.startingTutorialContainer.find(".svgMouseWheelClic");this.zoomMouseOnCtrlContainer=this.startingTutorialContainer.find(".svgMouseWheelOnCtrl");this.rotateTextContainer=this.startingTutorialContainer.find(".rotate");this.moveTextContainer=this.startingTutorialContainer.find(".move");this.zoomTextContainer=this.startingTutorialContainer.find(".zoom");this.apiCore.exec(this.callerName,"lib.insertSvg",this.startingTutorialIcons.zoomIcon,{mouseOver:!0});this.apiCore.exec(this.callerName,"lib.insertSvg",
this.startingTutorialIcons.moveIcon,{mouseOver:!0});this.apiCore.exec(this.callerName,"lib.insertSvg",this.startingTutorialIcons.rotateIcon,{mouseOver:!0});this.isMobile?(this.rotateMouseContainer.remove(),this.moveMouseContainer.remove(),this.zoomMouseContainer.remove(),this.zoomMouseOnCtrlContainer.remove(),this.apiCore.exec(this.callerName,"lib.insertSvg",this.startingTutorialIcons.rotateTouch,{mouseOver:!0}),this.apiCore.exec(this.callerName,"lib.insertSvg",this.startingTutorialIcons.moveTouch,
{mouseOver:!0}),this.apiCore.exec(this.callerName,"lib.insertSvg",this.startingTutorialIcons.zoomTouch,{mouseOver:!0})):(this.settings.wheelOnCtrl&&this.zoomMouseContainer.css("display","inline-block"),this.rotateTouchContainer.remove(),this.moveTouchContainer.remove(),this.zoomTouchContainer.remove(),this.apiCore.exec(this.callerName,"lib.insertSvg",this.startingTutorialIcons.mouseWheel,{mouseOver:!0}),this.apiCore.exec(this.callerName,"lib.insertSvg",this.startingTutorialIcons.mouseRightClic,{mouseOver:!0}),
this.apiCore.exec(this.callerName,"lib.insertSvg",this.startingTutorialIcons.mouseLeftClic,{mouseOver:!0}));k.call(this);this.hide()},k=function(){var b=16,d=15;600>this.parentElement.get(0).clientWidth&&(b=12,d=8);this.titleContainer.css({fontSize:b+"px"});b=l.call(this,b);this.settings.integratedInFullLoader?this.blocsContainer.css({top:"calc(50% - 42px)",left:"calc(50% - "+b/2+"px)"}):this.startingTutorialContainer.css({backgroundColor:"rgba(0,0,0,0.7)",borderRadius:"15px",width:2*d+b+10+"px",
left:"calc(50% - "+(d+b/2)+"px)",padding:d+"px"});this.isMobile&&(this.moveTouchContainer.css({marginLeft:(this.moveTouchContainer.parent().get(0).offsetWidth-this.moveTouchContainer.get(0).offsetWidth)/2+"px"}),this.rotateTouchContainer.css({marginLeft:(this.rotateTouchContainer.parent().get(0).offsetWidth-this.rotateTouchContainer.get(0).offsetWidth)/2+"px"}),this.zoomTouchContainer.css({marginLeft:(this.zoomTouchContainer.parent().get(0).offsetWidth-this.zoomTouchContainer.get(0).offsetWidth)/
2+"px"}))},l=function(b){var d=60;this.blocsContainer.each(stage.setContext(function(b,g){d+=b.offsetWidth},this));return d};return d});stage.provide("emersya.viewer.modules.ui.tutorial");stage.require("emersya.viewer.modules.ui.buttons");
stage.register.call(stage.emersya.viewer.modules.ui,"tutorial",function(){var b={handTutorialDuration:3800,handTutorialAngle:100,handTutorialInterval:5E3,handTutorialIcon:0},d=function(d,l,g){this.settings=stage.extend(!0,{},b,g);this.parentElement=l;this.uiElement=$$stage(this.parentElement.selector[0]);this.apiCore=d;this.svgIcon=stage.emersya.ui.svgIcon(null,this.settings);this.callerName="UICore-tutorial";this.svgIcon=stage.emersya.ui.svgIcon(null,this.settings);this.tutorialIcons=this.svgIcon.getTutorialIcons();
this.displayed=!0;this.stopAnimation=!1;this.tutorialContainer=$$stage(stage.build(this.parentElement.selector[0],[{tagName:"div",returnActive:!0,attributes:{klass:"tutorialContainer"},childs:[]}]));this.apiCore.exec(this.callerName,"lib.insertSvg",this.tutorialIcons.interactTouch,{mouseOver:!1});this.resize(this.uiElement.getWidth());this.hide();this.svgIconContainer=this.tutorialContainer.find("svg")};d.prototype.destroy=function(){};d.prototype.show=function(){this.stopAnimation||(this.displayed=
!0,this.tutorialContainer.show(),this.animate())};d.prototype.hide=function(b){b&&(this.interval&&(clearInterval(this.interval),this.interval=null),this.stopAnimation=!0);this.displayed&&(this.displayed=!1,this.tutorialContainer.hide(),this.apiCore.exec(this.callerName,"stopAnimatingPath",!0))};d.prototype.resize=function(b,d){this.uiElementWidth=b;this.handTranslationSize=Math.min(this.uiElementWidth/5,200);b=Math.max(Math.min(this.uiElementWidth/10,100),50);this.tutorialContainer.css({position:"absolute",
left:"calc(50% - "+b/2+"px)",top:"50%",width:b+"px",height:b+"px","z-index":"100","transform-origin":.416*b+"px "+.214*b+"px","pointer-events":"none"})};d.prototype.updateSettings=function(b){this.settings=stage.extend(!0,{},this.settings,b);2==this.settings.handTutorialIcon&&this.svgIcon.loadFile(this.settings.handTutorialIconPath,stage.setContext(function(b){b.response.childNodes&&(this.tutorialContainer.get(0).innerHTML=b.response.documentElement.outerHTML,this.svgIconContainer=this.tutorialContainer.find("svg"),
this.svgIconContainer.length&&(this.svgIconContainer.get(0).setAttribute("height","100%"),this.svgIconContainer.get(0).setAttribute("width","100%")))},this),stage.setContext(function(b){console.warn("failed to load icon")},this))};var u=function(d){return this.settings.handTutorialDuration/(b.handTutorialDuration/d)};d.prototype.startAnimation=function(){1==this.settings.handTutorialIcon?this.svgIconContainer.hide():(this.svgIconContainer.get(0).animate([{transform:"translateX(0px) rotate(-5deg)"},
{transform:"translateX("+.9*this.handTranslationSize+"px) rotate(-5deg)"}],{duration:u.call(this,960),easing:"cubic-bezier(0.2, 0, 1, 1)"}),this.svgIconContainer.get(0).animate([{transform:"translateX("+.9*this.handTranslationSize+"px) rotate(-5deg)"},{transform:"translateX("+this.handTranslationSize+"px) rotate(5deg)"}],{duration:u.call(this,110),delay:u.call(this,960),easing:"cubic-bezier(0, 0, 1, 1)"}),this.svgIconContainer.get(0).animate([{transform:"translateX("+this.handTranslationSize+"px) rotate(5deg)"},
{transform:"translateX(-"+.9*this.handTranslationSize+"px) rotate(5deg)"}],{duration:u.call(this,1560),delay:u.call(this,1070),easing:"cubic-bezier(0.2, 0, 1, 1)"}),this.svgIconContainer.get(0).animate([{transform:"translateX(-"+.9*this.handTranslationSize+"px) rotate(5deg)"},{transform:"translateX(-"+this.handTranslationSize+"px) rotate(-5deg)"}],{duration:u.call(this,110),delay:u.call(this,2630),easing:"cubic-bezier(0, 0, 1, 1)"}),this.svgIconContainer.get(0).animate([{transform:"translateX(-"+
this.handTranslationSize+"px) rotate(-5deg)"},{transform:"translateX(0px) rotate(-5deg)"}],{duration:u.call(this,960),delay:u.call(this,2740),easing:"cubic-bezier(0.2, 0, 1, 1)"}))};d.prototype.startCameraAnimation=function(){if(!this.camera){this.camera=this.apiCore.exec(this.callerName,"getCamera");this.pos1=vec3.create(this.camera.position);this.pos2=vec3.create(this.camera.position);this.pos3=vec3.create(this.camera.position);var b=mat4.identity(mat4.create());mat4.translate(b,this.camera.target);
mat4.rotate(b,-this.settings.handTutorialAngle/2*Math.PI/180,this.camera.up);mat4.translate(b,vec3.negate(this.camera.target,vec3.create()));mat4.multiplyVec3(b,this.pos1);mat4.translate(b,this.camera.target);mat4.rotate(b,this.settings.handTutorialAngle/2*Math.PI/180,this.camera.up);mat4.translate(b,vec3.negate(this.camera.target,vec3.create()));mat4.multiplyVec3(b,this.pos2);mat4.translate(b,this.camera.target);mat4.rotate(b,this.settings.handTutorialAngle/2*Math.PI/180,this.camera.up);mat4.translate(b,
vec3.negate(this.camera.target,vec3.create()));mat4.multiplyVec3(b,this.pos3);this.cameraPath=[{position:this.pos1,target:this.camera.target,up:this.camera.up,fov:this.camera.fov,t:u.call(this,1100),accelerationType:4},{position:this.pos2,target:this.camera.target,up:this.camera.up,fov:this.camera.fov,t:u.call(this,800),accelerationType:1},{position:this.pos3,target:this.camera.target,up:this.camera.up,fov:this.camera.fov,t:u.call(this,800),reversed:!0,accelerationType:1},{position:this.camera.position,
target:this.camera.target,up:this.camera.up,fov:this.camera.fov,t:u.call(this,1100),accelerationType:4,accelerationExponent:1}]}this.apiCore.exec(this.callerName,"startAnimatingPath",this.cameraPath,!1,!1,stage.setContext(function(){this.hide(!1)},this))};d.prototype.animate=function(){this.stopAnimation||this.interval||(this.interval=setInterval(stage.setContext(this.show,this),this.settings.handTutorialDuration+this.settings.handTutorialInterval));this.startAnimation();this.startCameraAnimation()};
return d});stage.provide("emersya.viewer.modules.sceneParser");
stage.register.call(stage.emersya.viewer.modules,"sceneParser",function(){var b={dataPath:"",modelsPath:null},d=[0,1,2,3,4,5,6],u=function(d,u){this.settings=stage.extend(!0,{},b,u);this.apiCore=d;this.cache=!0;this.eventsManager=stage.createEventsManager(this.settings);this.dracoDecoderModule=this.scene=null;this.binaryFeatures={};this.maxLayerIds=this.maxTextureIds=0;this.customTextures={};this.callerName=this.name="SceneParser";this.apiCore.register(this,"scps.readModelGraph",l,!0);this.apiCore.register(this,
"scps.readModelGeometries",g,!0);this.apiCore.register(this,"scps.readScenery",f,!0);this.apiCore.register(this,"scps.readAnimations",n,!0);this.apiCore.register(this,"scps.readWatch",B,!0);this.apiCore.register(this,"scps.readModularConfigurator",w,!0);this.apiCore.register(this,"scps.readWearableAR",D,!0);this.apiCore.register(this,"scps.readPlanner",A,!0);this.apiCore.register(this,"scps.readTranslations",H,!0);this.apiCore.register(this,"scps.readProjectScene",q,!0);this.apiCore.register(this,
"scps.readProjectDefaultScene",r,!0);this.apiCore.register(this,"scps.readProjectJson",t,!0);this.apiCore.register(this,"scps.readConfigurator",e,!0);this.apiCore.register(this,"scps.readPresets",E,!0);this.apiCore.register(this,"scps.readAnnotations",F,!0);this.apiCore.register(this,"scps.readFallback",p,!0);this.apiCore.register(this,"scps.readDFGLUT",U,!0);this.apiCore.register(this,"scps.readProductBlueprint",m,!0);this.apiCore.register(this,"scps.readProductBlueprintRules",h,!0);this.apiCore.register(this,
"scps.readProductConfig",v,!0);this.apiCore.register(this,"scps.readViewPointsLibrary",I,!0);this.apiCore.register(this,"scps.readViewerSettings",J,!0);this.apiCore.register(this,"scps.setCompressionDecoderModule",k,!0)};u.prototype.destroy=function(){this.dracoDecoderModule=this.scene=null;this.apiCore.unregister(this,"scps.readModelGraph");this.apiCore.unregister(this,"scps.readModelGeometries");this.apiCore.unregister(this,"scps.readScenery");this.apiCore.unregister(this,"scps.readAnimations");
this.apiCore.unregister(this,"scps.readWatch");this.apiCore.unregister(this,"scps.readModularConfigurator");this.apiCore.unregister(this,"scps.readWearableAR");this.apiCore.unregister(this,"scps.readPlanner");this.apiCore.unregister(this,"scps.readTranslations");this.apiCore.unregister(this,"scps.readProjectScene");this.apiCore.unregister(this,"scps.readProjectDefaultScene");this.apiCore.unregister(this,"scps.readProjectJson");this.apiCore.unregister(this,"scps.readConfigurator");this.apiCore.unregister(this,
"scps.readPresets");this.apiCore.unregister(this,"scps.readAnnotations");this.apiCore.unregister(this,"scps.readFallback");this.apiCore.unregister(this,"scps.readDFGLUT");this.apiCore.unregister(this,"scps.readProductBlueprint");this.apiCore.unregister(this,"scps.readProductBlueprintRules");this.apiCore.unregister(this,"scps.readProductConfig");this.apiCore.unregister(this,"scps.readViewPointsLibrary");this.apiCore.unregister(this,"scps.readViewerSettings");this.apiCore.unregister(this,"scps.setCompressionDecoderModule");
this.apiCore=null};var k=function(b){this.dracoDecoderModule=b},l=function(b,d){this.scene=b;this.maxLayerIds=this.maxTextureIds=0;this.customTextures={};this.data=d;this.ptr=0;this.binaryVersion=L.call(this);Q.call(this);4278190080>this.binaryVersion?(b=this.binaryVersion,this.binaryVersion=0,ba.call(this,b)):ba.call(this);Z.call(this);da.call(this);this.currentMaterialsType=4278190093<=this.binaryVersion?C.call(this):0;if(this.scene.materialsType=this.currentMaterialsType)for(b=L.call(this),d=0;d<
b;++d){var f=C.call(this),e=G.call(this),g={dirty:!0,angle:0,scaleX:1,scaleY:1,offsetX:0,offsetY:0};4278190101<=this.binaryVersion&&(g=Ua.call(this));var h=Ka.call(this),k=wa.call(this),l=Ja.call(this),m=La.call(this),p=ra.call(this),n=Sa.call(this),q=Ya.call(this),t=Ra.call(this),r=ma.call(this),v=bb.call(this),u=gb.call(this);k=this.scene.register("Material",{id:f,name:e,uvTransform:g,newShaderType:!0,polylists:[],type:1,albedo:h,roughness:k,metalness:l,normalDeformation:m,occlusion:p,opacity:n,
translucency:q,emissive:t,localEnvironment:r,iridescence:v,coating:u});t&&t.glow&&(k.glow=t.glow);h&&h.specular&&(k.specular=h.specular);l&&l.anisotropy&&(k.anisotropy=l.anisotropy);l&&l.carpaint&&(k.carpaint=l.carpaint);n&&n.refraction&&(k.refraction=n.refraction);f=this.scene.register("MaterialTree",{id:f,name:e,uvTransform:g,polylistInstances:[],newShaderType:!0,highlighted:!1,currentMaterialId:f,fromModel:!0});this.scene.materialsContent.materialSettingsByName[f.id]={};this.scene.materialsContent.materialSettingsByName[f.id][e]=
k}else for(b=L.call(this),d=0;d<b;++d){h=!1;var w=u=v=r=q=p=m=k=t=n=l=null,N=null,A=null,na=null,sa={dirty:!0,angle:0,scaleX:1,scaleY:1,offsetX:0,offsetY:0};e=C.call(this);f=G.call(this);4278190088<=this.binaryVersion&&(h=0!=L.call(this));4278190101<=this.binaryVersion&&(sa=Ua.call(this));g=L.call(this);g&1&&(l=xa.call(this));g&2&&(n=Ia.call(this));g&4&&(t=va.call(this));g&8&&(k=qa.call(this));g&16&&(m=X.call(this));g&32&&(p=la.call(this));g&64&&(q=X.call(this));g&128&&(r=Va.call(this));g&256&&(v=
Fa.call(this));g&512&&(u=fa.call(this),this.scene.hasSomeGlow=!0);g&1024&&(w=Ha.call(this));g&2048&&(N=P.call(this));g&4096&&(A=Ga.call(this));g&8192&&(na=Ba.call(this));this.scene.register("Material",{id:e,name:f,uvTransform:sa,type:0,polylists:[],newShaderType:h,lightMap:l,opacity:n,refraction:t,translucency:k,specularAnisotropic:m,normalDeformation:p,shininess:q,reflection:r,emissive:v,glow:u,iridescent:w,specular:N,diffuse:A,ambient:na});g=this.scene.register("MaterialTree",{id:e,name:f,uvTransform:sa,
polylistInstances:[],newShaderType:h,highlighted:!1,currentMaterialId:e,fromModel:!0});this.scene.materialsContent.materialSettingsByName[g.id]={};this.scene.materialsContent.materialSettingsByName[g.id][f]=this.scene.get("Material",e)}this.scene.opacityBlurs=stage.array.uniq(this.scene.opacityBlurs);ib.call(this);this.scene.root=fb.call(this);this.scene.isModel=!0;this.scene.updateModelSceneGraph();this.scene.arData=this.scene.register("ArData",{id:1,realSize:1,algorithm:0,boundingBox:this.scene.createBoundingBox(),
excludedNodes:[],excludedPolylists:[]})},g=function(b,d){this.scene=b;this.data=d;this.ptr=0;this.binaryVersion=L.call(this);b=0;4278190080>this.binaryVersion?(d=this.binaryVersion,this.binaryVersion=0):(4278190112<=this.binaryVersion&&(b=C.call(this)),d=L.call(this));var f=0===b?ta:ua;for(b=0;b<d;++b)ea.call(this,f);d=L.call(this);for(b=0;b<d;++b){var e=C.call(this);f=[];var g=[];if(4278190104<=this.binaryVersion){var h=L.call(this);if(4294967295!==h)for(var k=0;k<h;++k){var l=0;4278190114<=this.binaryVersion&&
(l=L.call(this));var m=L.call(this);if(0===l)f.push(Y.call(this,m));else if(1===l){l=new Int32Array(m);for(var p=0;p<m;p++)l[p]=p;f.push(l)}}h=L.call(this);if(4294967295!==h)for(k=0;k<h;++k)m=L.call(this),4294967295!==m?g.push(Y.call(this,m)):g.push(null)}else k=L.call(this),f.push(Y.call(this,k)),m=L.call(this),4294967295!==m?g.push(Y.call(this,m)):g.push(null);this.scene.get("Polylist",e)||(console.error("missing polylist before reading it (",e,")"),this.scene.register("Polylist",{id:e,list:f,edges:g,
indexBuffer:null,indexLineBuf:null,selected:!1,highlighted:!1,isHidden:!1,duplicatedPolylists:[],geometryId:0}));e=this.scene.get("Polylist",e);e.downloaded=!0;e.list=f;e.edges=g;e.geometry=this.scene.get("Geometry",e.geometryId);e.geometry.polylists.push(e);if(e.geometry)for(k=0;k<e.list.length;++k){for(m=h=0;m<e.list[k].length;++m)0<=e.list[k][m]&&e.list[k][m]<e.geometry.dataBuffers[k].nbFaces&&h++;if(h!=e.list[k].length){m=new Int32Array(h);for(l=h=0;l<e.list[k].length;++l)0<=e.list[k][l]&&e.list[k][l]<
e.geometry.dataBuffers[k].nbFaces&&(m[h]=e.list[k][l],h++);delete e.list[k];e.list[k]=m}}for(k=0;k<e.duplicatedPolylists.length;++k)h=e.duplicatedPolylists[k],h.downloaded=!0,h.list=f,h.edges=g,h.geometry=e.geometry}},q=function(b,d){this.scene=b;this.maxLayerIds=this.maxTextureIds=0;this.customTextures={};this.data=d;this.ptr=0;this.binaryVersion=L.call(this);Q.call(this);if(4278190080>this.binaryVersion){var f=this.binaryVersion;this.binaryVersion=0;ba.call(this,f)}else ba.call(this);Z.call(this);
da.call(this);this.currentMaterialsType=4278190093<=this.binaryVersion?C.call(this):0;null===this.scene.materialsType&&(this.scene.materialsType=this.currentMaterialsType);ib.call(this);if(this.currentMaterialsType){var e=L.call(this);if(4294967295!=e)for(var g=0;g<e;++g){var h=ma.call(this);this.scene.register("PbrLocalEnvironment",h)}var k=L.call(this);if(4294967295!=k)for(g=0;g<k;++g){var l=ra.call(this);this.scene.register("PbrOcclusion",l)}var m=L.call(this);if(4294967295!=m)for(g=0;g<m;++g){var p=
Ya.call(this);this.scene.register("PbrTranslucency",p)}var n=L.call(this);if(4294967295!=n)for(g=0;g<n;++g){var q=Sa.call(this);this.scene.register("PbrOpacity",q)}var t=L.call(this);if(4294967295!=t)for(g=0;g<t;++g){var r=gb.call(this);null!==r&&this.scene.register("PbrCoating",r)}var v=L.call(this);if(4294967295!=v)for(g=0;g<v;++g){var u=La.call(this);this.scene.register("PbrNormalDeformation",u)}var w=L.call(this);if(4294967295!=w)for(g=0;g<w;++g){var N=Ja.call(this);this.scene.register("PbrMetalness",
N)}var A=L.call(this);if(4294967295!=A)for(g=0;g<A;++g){var na=wa.call(this);this.scene.register("PbrRoughness",na)}var sa=L.call(this);if(4294967295!=sa)for(g=0;g<sa;++g){var F=bb.call(this);this.scene.register("PbrIridescence",F)}var B=L.call(this);if(4294967295!=B)for(g=0;g<B;++g){var E=Ra.call(this);this.scene.register("PbrEmissive",E)}var ca=L.call(this);if(4294967295!=ca)for(g=0;g<ca;++g){var Ca=Ka.call(this);this.scene.register("PbrAlbedo",Ca)}var H=L.call(this);if(4294967295!==H)for(g=0;g<
H;++g){var D=C.call(this),Ea=G.call(this),za=G.call(this),ta=0!=C.call(this),I="";4278190103<=this.binaryVersion&&(I=G.call(this));var J={id:D,name:za,technicalName:I,customText:ta,libSourceId:Ea};this.scene.register("MaterialSettings",J)}for(var ua=L.call(this),ia=0;ia<ua;++ia){var ea=C.call(this),M=G.call(this),oa=G.call(this),T={angle:0,scaleX:1,scaleY:1,offsetX:0,offsetY:0};4278190101<=this.binaryVersion&&(T=Ua.call(this));for(var U=[ea],ka=L.call(this),Oa={},Ma=0;Ma<ka;++Ma){for(var Ta=C.call(this),
Qa=C.call(this),Dc,Nb=U.concat([Ta]),Ib=L.call(this),Ob={},Tb=0;Tb<Ib;++Tb){for(var wc=C.call(this),pd=C.call(this),bc,Uc=Nb.concat([wc]),Lc=L.call(this),uc={},Ec=0;Ec<Lc;++Ec){for(var Ub=C.call(this),sb=C.call(this),Cb,pc=Uc.concat([Ub]),Pc=L.call(this),tb={},Hc=0;Hc<Pc;++Hc){for(var Lb=C.call(this),Vc=C.call(this),vc,Ic=pc.concat([Lb]),cc=L.call(this),Pb={},jc=0;jc<cc;++jc){for(var Oc=C.call(this),xc=C.call(this),Gc,Fc=Ic.concat([Oc]),dd=L.call(this),Qc={},fc=0;fc<dd;++fc){for(var vb=C.call(this),
Fb=C.call(this),kc,Db=Fc.concat([vb]),gc=L.call(this),hc={},rc=0;rc<gc;++rc){for(var Mb=C.call(this),Nc=C.call(this),mb,Jb=Db.concat([Mb]),Jc=L.call(this),qd={},Mc=0;Mc<Jc;++Mc){for(var qc=C.call(this),gd=C.call(this),lc,rd=Jb.concat([qc]),wd=L.call(this),sc={},hd=0;hd<wd;++hd){for(var yc=C.call(this),Kb=C.call(this),Zb,Yc=rd.concat([yc]),id=L.call(this),Rc={},yd=0;yd<id;++yd){for(var zd=C.call(this),Eb=C.call(this),nb,bd=Yc.concat([zd]),sd=L.call(this),Dd={},Xc=0;Xc<sd;++Xc){var td=C.call(this),
cd=C.call(this),Vb=Aa.call(this,bd.concat([td]));Dd[td]={levelId:td,content:this.scene.get("PbrAlbedo",cd),materialSettings:Vb}}nb=Dd;Rc[zd]={levelId:zd,content:this.scene.get("PbrEmissive",Eb),albedoLevels:nb}}Zb=Rc;sc[yc]={levelId:yc,content:this.scene.get("PbrIridescence",Kb),emissiveLevels:Zb}}lc=sc;qd[qc]={levelId:qc,content:this.scene.get("PbrRoughness",gd),iridescenceLevels:lc}}mb=qd;hc[Mb]={levelId:Mb,content:this.scene.get("PbrMetalness",Nc),roughnessLevels:mb}}kc=hc;Qc[vb]={levelId:vb,content:this.scene.get("PbrNormalDeformation",
Fb),metalnessLevels:kc}}Gc=Qc;Pb[Oc]={levelId:Oc,content:this.scene.get("PbrCoating",xc),normalDeformationLevels:Gc}}vc=Pb;tb[Lb]={levelId:Lb,content:this.scene.get("PbrOpacity",Vc),coatingLevels:vc}}Cb=tb;uc[Ub]={levelId:Ub,content:this.scene.get("PbrTranslucency",sb),opacityLevels:Cb}}bc=uc;Ob[wc]={levelId:wc,content:this.scene.get("PbrOcclusion",pd),translucencyLevels:bc}}Dc=Ob;Oa[Ta]={levelId:Ta,content:this.scene.get("PbrLocalEnvironment",Qa),occlusionLevels:Dc}}var Wc=this.scene.register("MaterialTree",
{id:ea,name:oa,uvTransform:T,polylistInstances:[],polylistMinId:2E12,localEnvironmentLevels:Oa,highlighted:!1,libSourceId:M,currentMaterialId:null});this.scene.materialsContent.materialSettingsByName[Wc.id]={}}var fd=this.scene.getAllFromCurrentParent("MaterialSettings");for(ia in fd){var jb=fd[ia];Wc=this.scene.get("MaterialTree",jb.mt);null===Wc.currentMaterialId&&(Wc.currentMaterialId=jb.id);this.scene.materialsContent.materialSettingsByName[Wc.id][jb.name]=jb;this.scene.updatePbrMaterial(Wc,jb.path)}}else{var Ad=
L.call(this);if(4294967295!==Ad)for(var Na=0;Na<Ad;++Na){var xd=xa.call(this);this.scene.register("LightMap",xd)}var ub=L.call(this);if(4294967295!==ub)for(Na=0;Na<ub;++Na){var wb=Ia.call(this);this.scene.register("Opacity",wb)}var Bd=L.call(this),Wa;if(4294967295!==Bd)for(Na=0;Na<Bd;++Na)(Wa=va.call(this))&&this.scene.register("Refraction",Wa);var zc=L.call(this);if(4294967295!==zc)for(Na=0;Na<zc;++Na){var mc=qa.call(this);this.scene.register("Translucency",mc)}var jd=L.call(this);if(4294967295!==
jd)for(Na=0;Na<jd;++Na){var Md=X.call(this);this.scene.register("SpecularAnisotropic",Md)}var kd=L.call(this);if(4294967295!==kd)for(Na=0;Na<kd;++Na){var ud=la.call(this);this.scene.register("NormalDeformation",ud)}var Ed=L.call(this);if(4294967295!==Ed)for(Na=0;Na<Ed;++Na){var Qb=X.call(this);this.scene.register("Shininess",Qb)}var Xd=L.call(this),Nd;if(4294967295!==Xd)for(Na=0;Na<Xd;++Na)(Nd=Va.call(this))&&this.scene.register("Reflection",Nd);var qb=L.call(this);if(4294967295!==qb)for(Na=0;Na<
qb;++Na){var $b=Fa.call(this);this.scene.register("Emissive",$b)}var ld=L.call(this);if(4294967295!==ld)for(Na=0;Na<ld;++Na){var Sd=fa.call(this);this.scene.register("Glow",Sd)}var Xa=L.call(this);if(4294967295!==Xa)for(Na=0;Na<Xa;++Na){var Ac=Ha.call(this);this.scene.register("Iridescent",Ac)}var Qd=L.call(this);if(4294967295!==Qd)for(Na=0;Na<Qd;++Na){var ge=P.call(this);this.scene.register("Specular",ge)}var Vd=L.call(this);if(4294967295!==Vd)for(Na=0;Na<Vd;++Na){var $d=Ga.call(this);this.scene.register("Diffuse",
$d)}var Td=L.call(this);if(4294967295!==Td)for(Na=0;Na<Td;++Na){var he=Ba.call(this);this.scene.register("Ambient",he)}var ae=L.call(this);if(4294967295!==ae)for(Na=0;Na<ae;++Na){var ne=C.call(this),Jd="";4278190082<=this.binaryVersion&&(Jd=4278190084<=this.binaryVersion?G.call(this):"/"+C.call(this),"/-1"==Jd&&(Jd=""));var ve=G.call(this),be=!1;4278190087<=this.binaryVersion&&(be=0!=C.call(this));var Wd="";4278190103<=this.binaryVersion&&(Wd=G.call(this));this.scene.register("MaterialSettings",{id:ne,
name:ve,technicalName:Wd,customText:be,libSourceId:Jd})}for(var we=L.call(this),Od=0;Od<we;++Od){var Yd=C.call(this),Id="";4278190082<=this.binaryVersion&&(Id=4278190084<=this.binaryVersion?G.call(this):"/"+C.call(this),"/-1"==Id&&(Id=""));var ie=G.call(this),$c=!1;4278190088<=this.binaryVersion&&($c=0!=L.call(this));var Fd={dirty:!0,angle:0,scaleX:1,scaleY:1,offsetX:0,offsetY:0};4278190101<=this.binaryVersion&&(Fd=Ua.call(this));for(var Ud=[Yd],md=L.call(this),ed={},Zd=0;Zd<md;++Zd){for(var Gd=C.call(this),
je=C.call(this),Rd,Zc=Ud.concat([Gd]),Ld=L.call(this),Kd={},Ie=0;Ie<Ld;++Ie){for(var fe=C.call(this),Cd=C.call(this),Je,bg=Zc.concat([fe]),Ke=L.call(this),Le={},Me=0;Me<Ke;++Me){for(var ke=C.call(this),cg=C.call(this),Ne,eg=bg.concat([ke]),dg=L.call(this),Oe={},Pe=0;Pe<dg;++Pe){for(var le=C.call(this),fg=C.call(this),Qe,gg=eg.concat([le]),hg=L.call(this),Re={},Se=0;Se<hg;++Se){for(var me=C.call(this),ig=C.call(this),Te,jg=gg.concat([me]),kg=L.call(this),Ue={},Ve=0;Ve<kg;++Ve){for(var oe=C.call(this),
lg=C.call(this),We,mg=jg.concat([oe]),ng=L.call(this),Xe={},Ye=0;Ye<ng;++Ye){for(var pe=C.call(this),og=C.call(this),Ze,pg=mg.concat([pe]),qg=L.call(this),$e={},af=0;af<qg;++af){for(var qe=C.call(this),rg=C.call(this),bf,sg=pg.concat([qe]),tg=L.call(this),cf={},df=0;df<tg;++df){for(var re=C.call(this),ug=C.call(this),ef,Cg=sg.concat([re]),Dg=L.call(this),ff={},gf=0;gf<Dg;++gf){for(var se=C.call(this),vg=C.call(this),hf,wg=Cg.concat([se]),xg=L.call(this),jf={},kf=0;kf<xg;++kf){for(var te=C.call(this),
yg=C.call(this),lf,zg=wg.concat([te]),Ag=L.call(this),mf={},nf=0;nf<Ag;++nf){for(var ue=C.call(this),Bg=C.call(this),of,Eg=zg.concat([ue]),Fg=L.call(this),pf={},qf=0;qf<Fg;++qf){for(var xe=C.call(this),Gg=C.call(this),rf,Hg=Eg.concat([xe]),Ig=L.call(this),sf={},tf=0;tf<Ig;++tf){var ye=C.call(this),Jg=C.call(this),Kg=Aa.call(this,Hg.concat([ye]));sf[ye]={levelId:ye,content:this.scene.get("Ambient",Jg),materialSettings:Kg}}rf=sf;pf[xe]={levelId:xe,content:this.scene.get("Diffuse",Gg),ambientLevels:rf}}of=
pf;mf[ue]={levelId:ue,content:this.scene.get("Specular",Bg),diffuseLevels:of}}lf=mf;jf[te]={levelId:te,content:this.scene.get("Iridescent",yg),specularLevels:lf}}hf=jf;ff[se]={levelId:se,content:this.scene.get("Glow",vg),iridescentLevels:hf}}ef=ff;cf[re]={levelId:re,content:this.scene.get("Emissive",ug),glowLevels:ef}}bf=cf;$e[qe]={levelId:qe,content:this.scene.get("Reflection",rg),emissiveLevels:bf}}Ze=$e;Xe[pe]={levelId:pe,content:this.scene.get("Shininess",og),reflectionLevels:Ze}}We=Xe;Ue[oe]=
{levelId:oe,content:this.scene.get("NormalDeformation",lg),shininessLevels:We}}Te=Ue;Re[me]={levelId:me,content:this.scene.get("SpecularAnisotropic",ig),normalDeformationLevels:Te}}Qe=Re;Oe[le]={levelId:le,content:this.scene.get("Translucency",fg),specularAnisotropicLevels:Qe}}Ne=Oe;Le[ke]={levelId:ke,content:this.scene.get("Refraction",cg),translucencyLevels:Ne}}Je=Le;Kd[fe]={levelId:fe,content:this.scene.get("Opacity",Cd),refractionLevels:Je}}Rd=Kd;ed[Gd]={levelId:Gd,content:this.scene.get("LightMap",
je),opacityLevels:Rd}}var Hd=this.scene.register("MaterialTree",{id:Yd,name:ie,uvTransform:Fd,polylistInstances:[],polylistMinId:2E12,newShaderType:$c,lightMapLevels:ed,highlighted:!1,libSourceId:Id,currentMaterialId:null,defaultMaterialId:null});this.scene.materialsContent.materialSettingsByName[Hd.id]={}}var uf=this.scene.getAllFromCurrentParent("MaterialSettings");for(Od in uf){var Pd=uf[Od];Hd=this.scene.get("MaterialTree",Pd.mt);null===Hd.currentMaterialId&&(Hd.currentMaterialId=Pd.id);this.scene.materialsContent.materialSettingsByName[Hd.id][Pd.name]=
Pd;Pd.newShaderType=Hd.newShaderType;this.scene.updateMaterial(Hd,Pd.path)}}this.scene.opacityBlurs=stage.array.uniq(this.scene.opacityBlurs);var vf=L.call(this);if(4294967295!==vf)for(var wf=0;wf<vf;++wf)fb.call(this);var xf=L.call(this);if(4294967295!==xf)for(var yf=0;yf<xf;++yf){var ze=C.call(this);var Lg=G.call(this);var Ae=4278190092<=this.binaryVersion?G.call(this):"";var Mg=S.call(this,16);var zf=C.call(this);var Ng=hb.call(this);var Og=hb.call(this,!0);var Pg=L.call(this);for(var Af={},Bf=
0;Bf<Pg;++Bf){var Cf=C.call(this),Df=C.call(this);Af[Df]=Cf;this.scene.get("Polylist",Df).materialTree=this.scene.get("MaterialTree",Cf)}this.scene.register("ProductNode",{id:ze,localId:-1,name:Lg,sku:Ae,matrix:Mg,opacity:1,baseOpacity:1,sourceNode:-1!=zf?this.scene.get("SourceNode",zf):null,sourceModel:Ng,originalSourceModel:Og,matricesList:[],associations:Af,duplicatedNodes:{}});this.scene.productNodesBySKU[Ae]=this.scene.get("ProductNode",ze);var Be=this.scene.getCurrentParentTypeAndId().id;this.scene.productNodesByProjectAndSKU[Be]||
(this.scene.productNodesByProjectAndSKU[Be]={});this.scene.productNodesByProjectAndSKU[Be][Ae]=this.scene.get("ProductNode",ze)}if(4278190096<=this.binaryVersion){var Ef=L.call(this);if(4294967295!==Ef)for(var Ff=0;Ff<Ef;++Ff){var Qg=C.call(this),Rg=G.call(this),Gf="";4278190105<=this.binaryVersion&&(Gf=G.call(this));for(var Sg=G.call(this),Tg=G.call(this),Ug=C.call(this),ce=[],Vg=L.call(this),Hf=0;Hf<Vg;++Hf)ce.push(this.scene.get("MaterialTree",C.call(this)).id);ce=stage.array.uniq(ce);var If=[],
Jf=L.call(this);if(4294967295!==Jf)for(var Kf=0;Kf<Jf;++Kf){var Wg=C.call(this),Xg=G.call(this),Lf="";4278190105<=this.binaryVersion&&(Lf=G.call(this));var Yg=G.call(this),Zg=G.call(this),$g=db.call(this),Ce={id:Wg,name:Xg,code:Lf,filePath:Yg,preview:Zg,materials:$g};this.scene.get("MaterialTreesGroupConfiguration",Ce.id)||(this.scene.register("MaterialTreesGroupConfiguration",Ce),If.push(Ce))}var ah=If;var Mf=[],Nf=L.call(this);if(4294967295!==Nf)for(var Of=0;Of<Nf;++Of){var bh=C.call(this),ch=C.call(this);
Mf.push({id:bh,order:ch})}this.scene.register("MaterialTreesGroup",{id:Qg,name:Rg,code:Gf,filePath:Sg,defaultConfiguration:Tg,order:Ug,materialTreesIds:ce,configurations:ah,fallbacks:Mf})}}var Pf=L.call(this);if(4294967295!==Pf)for(var Qf=0;Qf<Pf;++Qf){var dh=C.call(this),Rf=C.call(this),eh=K.call(this),fh=K.call(this),gh=K.call(this),hh=K.call(this),ih=K.call(this),jh=S.call(this,3),kh=S.call(this,3),lh=G.call(this),de=C.call(this);this.scene.mirrors.push(this.scene.register("Mirror",{id:dh,polylist:this.scene.get("Polylist",
Rf),minDistance:eh,maxDistance:fh,exponent:gh,intensity:hh,reduction:ih,planePosition:vec3.create(jh),planeNormal:vec3.create(kh),blur:lh,nodes:[],texture:-1!==de?this.scene.textures[this.scene.get("Texture",de).id]:null}));-1!==de&&(this.scene.textures[this.scene.get("Texture",de).id].requiredForInit=!0);this.scene.get("Polylist",Rf).isMirror=!0}var Sf=L.call(this);if(4294967295!==Sf)for(var Tf=0;Tf<Sf;++Tf){var mh=C.call(this),De=C.call(this),nh=C.call(this),oh=K.call(this),ph=0!=R.call(this);R.call(this);
aa.call(this);var qh=S.call(this,3),rh=S.call(this,3),Uf=L.call(this),Vf=[];if(4294967295!==Uf)for(var Wf=0;Wf<Uf;++Wf)switch(L.call(this)){case 1:Vf.push(eb.call(this))}var sh=Vf;var Xf=L.call(this),Yf=[];if(4294967295!==Xf)for(var Zf=0;Zf<Xf;++Zf){var th=C.call(this),uh=K.call(this),vh=K.call(this),wh=K.call(this),xh=S.call(this,3);Yf.push({id:th,amplitude:uh,speed:vh,waveLength:wh,direction:xh})}var yh=Yf;var Bc=this.scene.register("Water",{id:mh,polylist:this.scene.get("Polylist",De),polylistId:De,
textureSize:nh,refractionRatio:oh,randomWaves:ph,cubeCenter:vec3.create(qh),color:vec3.create(rh),equations:sh,waves:yh,nodes:[],amplitudes:[],waveLengths:[],speeds:[],directions:[]});if(Bc.randomWaves)for(var vd=0;8>vd;++vd){Bc.amplitudes.push(.005*Math.random()+.005);Bc.waveLengths.push(.2*Math.random()+.2);Bc.speeds.push(.2);var $f=Math.random()*Math.PI*2;Bc.directions.push(Math.cos($f),Math.sin($f))}else for(vd=0;vd<Bc.waves.length;++vd)Bc.amplitudes.push(Bc.waves[vd].amplitude),Bc.waveLengths.push(Bc.waves[vd].waveLength),
Bc.speeds.push(Bc.waves[vd].speed),Bc.directions.push(Bc.waves[vd].direction[0],Bc.waves[vd].direction[1]);this.scene.waters.push(Bc);this.scene.get("Polylist",De).isWater=!0}if(4278190096<=this.binaryVersion){var zh=K.call(this),Ah=C.call(this),Bh=ab.call(this),ag=L.call(this),Ee=[],ee=[];4294967295!==ag&&(Ee=Y.call(this,ag));this.binaryFeatures[2]&&(S.call(this,3),S.call(this,3));if(4278190121<=this.binaryVersion&&(4278190123>this.binaryVersion||this.binaryFeatures[0]))ee=Array.from(Ee);else for(var Ch=
Array.from(Ee),Fe=Array.from(Ch);0<Fe.length;){var Dh=Fe.shift(),Ge=this.scene.getGlobal("SourceNode",Dh);if(Ge){ee=ee.concat(Ge.polylistIds);for(var Eh in Ge.children)Fe.push(Eh.id)}}var He={id:1,realSize:zh,algorithm:Ah,boundingBox:Bh,excludedPolylists:ee};He=this.scene.register("ArData",He);this.scene.arData||(this.scene.arData=He)}else this.scene.arData=this.scene.register("ArData",{id:1,realSize:1,algorithm:0,boundingBox:this.scene.createBoundingBox(),excludedNodes:[],excludedPolylists:[]})},
t=function(b,d){if(d.product_nodes)for(var f=0;f<d.product_nodes.length;++f){var e=d.product_nodes[f],g=b.get("ProductNode",e.id);g&&e.thumbnail&&(g.thumbnail=this.apiCore.exec(this.callerName,"buildLoadingFilePath",e.thumbnail))}},r=function(b,d,f){this.scene=b;if("object"==stage.typeOf(d))this.scene.applyModularConfiguration(d,!0);else{b=d.split("|");for(var e=d.indexOf("|"),g=d.substring(0,e),h=d.substring(e+1);""!=h&&"{"!=h[0];)e=h.indexOf("|"),g+="|"+(0<=e?h.substring(0,e):h),h=0<=e?h.substring(e+
1):"";this.scene.startingConfigurationStr=d;this.scene.productNodes&&!f&&(this.scene.root=this.scene.readProductNodeStr(g));e=h.indexOf("|");g=0<=e?h.substring(0,e):h;h=0<=e?h.substring(e+1):"";d=1;this.scene.readMaterialConfigsStr(g);if(b.length>++d&&!f&&(e=h.indexOf("|"),g=0<=e?h.substring(0,e):h,h=0<=e?h.substring(e+1):"",this.scene.readMtgcStr(g),b.length>++d&&(e=h.indexOf("|"),g=0<=e?h.substring(0,e):h,h=0<=e?h.substring(e+1):"",this.scene.readPolylistsStr(g),b.length>++d))){e=h.indexOf("|");
g=0<=e?h.substring(0,e):h;for(h=0<=e?h.substring(e+1):"";""!=h&&"["!=h[0];)e=h.indexOf("|"),g+="|"+(0<=e?h.substring(0,e):h),h=0<=e?h.substring(e+1):"",++d;this.scene.readCustomTextsStr(g);if(b.length>++d&&(e=h.indexOf("|"),g=0<=e?h.substring(0,e):h,h=0<=e?h.substring(e+1):"",this.scene.readCustomTexturesStr(g,!0),b.length>++d&&(e=h.indexOf("|"),g=0<=e?h.substring(0,e):h,h=0<=e?h.substring(e+1):"",this.scene.readTexturesTransformsStr(g,!0),b.length>++d&&(e=h.indexOf("|"),g=0<=e?h.substring(0,e):h,
h=0<=e?h.substring(e+1):"",this.scene.readTexturesLayersStr(g,!0),b.length>++d)))){e=h.indexOf("|");g=0<=e?h.substring(0,e):h;for(h=0<=e?h.substring(e+1):"";""!=h&&"{"!=h[0];)e=h.indexOf("|"),g+="|"+(0<=e?h.substring(0,e):h),h=0<=e?h.substring(e+1):"",++d;this.scene.readAnimationStatesStr(g);b.length>++d&&(e=h.indexOf("|"),g=0<=e?h.substring(0,e):h,this.scene.readCustomColorsStr(g))}}}},f=function(b,d){this.scene=b;this.maxLayerIds=this.maxTextureIds=0;this.customTextures={};this.readingScenery=!0;
this.data=d;this.ptr=0;b=C.call(this);d=G.call(this);var e=G.call(this),f=G.call(this);this.binaryVersion=L.call(this);this.scene.lights={ambient:{color:[1,1,1],intensity:1},globalLightCorrection:1,globalEnvironmentCorrection:1,directionals:[],directionalIds:{},spots:[],spotIds:{},hemisphericals:[],hemisphericalIds:{},points:[],pointIds:{},hasSomeDirShadow:0,hasSomeSpotShadow:0,hasSomeAutoAdjustShadow:0,IBL:null};if(this.scene.scenery.environmentTexture){if(this.scene.environmentTextures){var g=this.scene.environmentTextures.indexOf(this.scene.scenery.environmentTexture);
-1!==g&&this.scene.environmentTextures.splice(g,1)}this.scene.texturesManager&&this.scene.texturesManager.removeTexture(this.scene.scenery.environmentTexture)}this.scene.scenery={id:b,name:d,code:e,description:f};this.scene.scenery.materialsType=0;4278190080>this.binaryVersion?(b=this.binaryVersion,this.binaryVersion=0,ba.call(this,b)):(4278190084<=this.binaryVersion&&(this.scene.scenery.materialsType=C.call(this)),this.scene.scenery.fov=K.call(this),this.scene.scenery.adaptativeFov=0!=R.call(this),
this.scene.scenery.xTranslation=0!=R.call(this),this.scene.scenery.yTranslation=0!=R.call(this),b=!0,4278190089<=this.binaryVersion?b=0!=R.call(this):R.call(this),this.scene.scenery.shadowFilter=b,this.scene.scenery.preview=G.call(this),this.scene.scenery.backgroundColor=S.call(this,3),this.scene.scenery.backgroundImage=G.call(this),this.scene.scenery.backgroundOpacity=K.call(this),this.scene.scenery.backgroundImageOpacity=K.call(this),this.scene.scenery.fittingMethod=C.call(this),this.scene.scenery.cameraMode=
C.call(this),this.scene.scenery.sceneControl=C.call(this),this.scene.scenery.xRotationMin=K.call(this),this.scene.scenery.xRotationMax=K.call(this),this.scene.scenery.yRotationMin=K.call(this),this.scene.scenery.yRotationMax=K.call(this),this.scene.scenery.targetRange=K.call(this),this.scene.scenery.targetAxes=S.call(this,3),this.scene.scenery.minZoomRatio=K.call(this),this.scene.scenery.maxZoomRatio=K.call(this),4278190082<=this.binaryVersion?(this.scene.tonemapping.type=C.call(this),this.scene.tonemapping.multiplier=
K.call(this),this.scene.tonemapping.maxLuminance=K.call(this)):(this.scene.tonemapping.type=0,this.scene.tonemapping.multiplier=1,this.scene.tonemapping.maxLuminance=1),4278190089<=this.binaryVersion?(this.scene.scenery.shadowMode=C.call(this),this.scene.scenery.shadowOpacityThreshold=K.call(this)):(this.scene.scenery.shadowMode=0,this.scene.scenery.shadowOpacityThreshold=0),this.scene.scenery.complete=!0,ba.call(this));da.call(this);4278190084<=this.binaryVersion&&Z.call(this);C.call(this);G.call(this);
G.call(this);this.scene.lights.ambient=Ma.call(this);e=L.call(this);for(b=0;b<e;++b)d=Ma.call(this),d.position=S.call(this,3),d.direction=S.call(this,3),d.relativeToCamera=0!=L.call(this),d.shadow=Ta.call(this),this.scene.lights.directionalIds[d.id]?this.scene.lights.directionals[this.scene.lights.directionalIds[d.id]]=d:(this.scene.lights.directionalIds[d.id]=this.scene.lights.directionals.length,this.scene.lights.directionals.push(d));e=L.call(this);for(b=0;b<e;++b)d=Ma.call(this),d.position=S.call(this,
3),d.distance=K.call(this),d.constantAttenuation=K.call(this),d.linearAttenuation=K.call(this),d.quadraticAttenuation=K.call(this),d.relativeToCamera=0!=L.call(this),this.scene.lights.pointIds[d.id]?this.scene.lights.points[this.scene.lights.pointIds[d.id]]=d:(this.scene.lights.pointIds[d.id]=this.scene.lights.points.length,this.scene.lights.points.push(d));e=L.call(this);for(b=0;b<e;++b)d=Ma.call(this),d.skyColor=d.color,d.groundColor=S.call(this,3),d.direction=S.call(this,3),d.relativeToCamera=
0!=L.call(this),this.scene.lights.hemisphericalIds[d.id]?this.scene.lights.hemisphericals[this.scene.lights.hemisphericalIds[d.id]]=d:(this.scene.lights.hemisphericalIds[d.id]=this.scene.lights.hemisphericals.length,this.scene.lights.hemisphericals.push(d));e=L.call(this);for(b=0;b<e;++b)d=Ma.call(this),d.position=S.call(this,3),d.direction=S.call(this,3),d.distance=K.call(this),d.exponent=K.call(this),d.innerAngle=K.call(this),d.outerAngle=K.call(this),d.constantAttenuation=K.call(this),d.linearAttenuation=
K.call(this),d.quadraticAttenuation=K.call(this),d.relativeToCamera=0!=L.call(this),d.shadow=Ta.call(this),this.scene.lights.spotIds[d.id]?this.scene.lights.spots[this.scene.lights.spotIds[d.id]]=d:(this.scene.lights.spotIds[d.id]=this.scene.lights.spots.length,this.scene.lights.spots.push(d));b={};b.id=C.call(this);-1==b.id?b=null:(b.name=G.call(this),b.intensity=K.call(this),b.relativeToCamera=0!=L.call(this),d=Math.abs(C.call(this)),b.texture=this.scene.texturesCube[this.scene.get("TextureCube",
-d).id],b.texture.requiredForInit=!0);this.scene.lights.IBL=b;this.scene.scenery.materialsType&&(b=C.call(this),-1!=b?(this.scene.scenery.environmentTexture=this.scene.textures[this.scene.get("Texture",-Math.abs(b)).id],-1===this.scene.environmentTextures.indexOf(this.scene.scenery.environmentTexture)&&this.scene.environmentTextures.push(this.scene.scenery.environmentTexture)):this.scene.scenery.environmentTexture=null,this.scene.scenery.environmentModified=!1,this.scene.scenery.environmentRelativeToCamera=
0!=L.call(this),this.scene.scenery.renderEnvironment=C.call(this),this.scene.scenery.environmentRotation=K.call(this),this.scene.scenery.environmentExposure=K.call(this));this.readingScenery=!1;this.scene.texturesManager&&this.scene.lights.IBL&&this.scene.lights.IBL.texture&&this.scene.lights.IBL.texture.load()},n=function(b,d){b.triggers=d.triggers||[];b.animations=d.animations||[]},B=function(b,d){b.watch=d},w=function(b,d){b.modularConfigurator=d},D=function(b,d){b.wearableAR=d;b.wearableAR.detectionModel||
(b.wearableAR.detectionModel="V1");b.wearableAR.occluderNodes||(b.wearableAR.occluderNodes=[]);b.wearableAR.glassesTemples||(b.wearableAR.glassesTemples=[]);b.wearableAR.arSpecificPolylists||(b.wearableAR.arSpecificPolylists=[]);b.wearableAR.arHiddenPolylists||(b.wearableAR.arHiddenPolylists=[]);b.wearableAR.leftShoeNode||(b.wearableAR.leftShoeNode={});b.wearableAR.rightShoeNode||(b.wearableAR.rightShoeNode={})},A=function(b,d){b.planner=d},H=function(b,d){this.apiCore.exec(this.callerName,"setTranslations",
d)},e=function(b,d){this.scene=b;this.scene.configurator={categories:[]};this.data=d;this.ptr=0;this.scene.configurator.id=C.call(this);this.scene.configurator.title=G.call(this);this.scene.configurator.routing=G.call(this);this.scene.configurator.filePath=G.call(this);this.scene.configurator.realFilePath=this.apiCore.exec(this.callerName,"buildLoadingFilePath",this.scene.configurator.filePath);this.scene.configurator.transition=C.call(this);var e=L.call(this);if(4294967295!==e){b={};for(d=0;d<e;++d){var f=
C.call(this),g=C.call(this),h=G.call(this),k=C.call(this);var l=[];var m=L.call(this);var p=null;if(4294967295!==m)for(var n=0;n<m;++n){var q=C.call(this),t=G.call(this),r=C.call(this),v=G.call(this),u=0!=R.call(this);R.call(this);R.call(this);R.call(this);var w=db.call(this);q={id:q,name:t,order:r,color:v,isDefault:u,materials:w};l.push(q);u&&(p=q)}g={id:f,parentId:g,name:h,order:k,buttons:l,defaultButton:p,children:[]};this.scene.configurator.categories.push(g);b[f]=g}e=[];for(d in this.scene.configurator.categories)f=
this.scene.configurator.categories[d],-1!==f.parentId&&b[f.parentId]&&(b[f.parentId].children.push(f),e.push(f));for(d in e)this.scene.configurator.categories.splice(this.scene.configurator.categories.indexOf(e[d]),1)}else this.scene.configurator.categories=[]},E=function(b,d,e){this.presets={};this.scene=b;this.data=d;this.ptr=0;this.presets.id=C.call(this);this.presets.name=G.call(this);this.presets.filePath=G.call(this);this.binaryVersion=L.call(this);4278190080>this.binaryVersion?(b=this.binaryVersion,
this.binaryVersion=0,this.presets.presets=Oa.call(this,b)):this.presets.presets=Oa.call(this);e||this.apiCore.exec(this.callerName,"setPresets",this.presets);return this.presets},F=function(b,d){this.scene=b;this.scene.annotations=[];this.data=d;this.ptr=0;b=L.call(this);d=G.call(this);var e=G.call(this),f=[];this.binaryVersion=L.call(this);if(4278190080>this.binaryVersion){var g=this.binaryVersion;this.binaryVersion=0}else g=L.call(this);if(4294967295!==g)for(var h=0;h<g;++h){b=C.call(this);var k=
G.call(this),l=G.call(this),m=G.call(this),p=S.call(this,3),n=G.call(this),q=C.call(this),t=C.call(this);var r=C.call(this);var v=G.call(this),u=S.call(this,3),w=S.call(this,3),N=S.call(this,3);r={id:r,name:v,position:u,up:w,target:N,camera_position_x:u[0],camera_position_y:u[1],camera_position_z:u[2],camera_up_x:w[0],camera_up_y:w[1],camera_up_z:w[2],camera_target_x:N[0],camera_target_y:N[1],camera_target_z:N[2]};v=K.call(this);this.scene.annotations.push({id:b,title:k,description:l,html_description:m,
position:p,position_x:p[0],position_y:p[1],position_z:p[2],type:n,number:q,source_node:t,point_of_view:r,waiting_duration:v})}if(4278190080<=this.binaryVersion&&(g=L.call(this),4294967295!==g))for(h=0;h<g;++h)f.push(G.call(this));return{id:b,name:d,filePath:e,images:f}},p=function(b,d,e){this.fallback={};Ca.call(this,d);e||this.apiCore.exec(this.callerName,"setFallback",this.fallback);return this.fallback},m=function(b,d){b.productData={attributes:{},attributeValues:{},sections:{},options:{},components:{}};
if(d.attributes)for(var e=0;e<d.attributes.length;e++){var f=d.attributes[e];if(f.values&&0!=f.values.length){for(var g=[],h=0;h<f.values.length;h++){var k=f.values[h];k&&0!=k.length&&(g.push(k.code),b.productData.attributeValues[k.code]=stage.extend({},k),b.productData.attributeValues[k.code].attributeCode=f.code)}b.productData.attributes[f.code]=stage.extend({},f);b.productData.attributes[f.code].values=g}}if(d.sections)for(e=0;e<d.sections.length;e++){f=d.sections[e];g=[];if(f.options&&0<f.options.length)for(h=
0;h<f.options.length;h++){k=f.options[h];k.hasOwnProperty("saleable")||(k.saleable=!0);g.push(k.code);for(var l in k.attributes){var m=k.attributes[l];l&&m||delete k.attributes[l];b.productData.attributes[l]||delete k.attributes[l];b.productData.attributeValues[m]||delete k.attributes[l]}if(k.components)for(m=0;m<k.components.length;m++)b.productData.components[k.components[m]]={};else k.components=[];b.productData.options[k.code]=stage.extend({},k);b.productData.options[k.code].keywords=k.keywords&&
0<k.keywords.length?k.keywords.split(";"):[];b.productData.options[k.code].sectionCode=f.code}f.hasOwnProperty("visible")||(f.visible=!0);f.hasOwnProperty("saleable")||(f.saleable=!0);b.productData.sections[f.code]=stage.extend({},f);b.productData.sections[f.code].options=g}},h=function(b,d){d||(d={});b.productRules={sections:d.sections||{},options:d.options||{}};for(var e in b.productRules.sections)b.productRules.sections[e].hasOwnProperty("onOpen")||(b.productRules.sections[e].onOpen={pov:null}),
b.productRules.sections[e].hasOwnProperty("onClose")||(b.productRules.sections[e].onClose={pov:null})},v=function(b,d){b.productData={attributes:{},attributeValues:{},sections:{},options:{},components:{},translations:{}};b.productRules={sections:{},options:{}};if(d.translations)for(var e=$jscomp.makeIterator(this.apiCore.exec(this.callerName,"getLocales")),f=e.next();!f.done;f=e.next())if(f=f.value,d.translations.hasOwnProperty(f))b.productData.translations[f]=d.translations[f];else{var g=f.substring(0,
2);d.translations.hasOwnProperty(g)?b.productData.translations[f]=d.translations[g]:b.productData.translations[f]=d.translations.en}for(var h in d.attributes)for(f=d.attributes[h],b.productData.attributes[h]=f,g=0;g<f.values.length;g++)e=f.values[g],b.productData.attributeValues[e]=d.attributeValues[e],b.productData.attributeValues[e].attributeCode=h;for(var k in d.sections){h=d.sections[k];h.hasOwnProperty("saleable")||(h.saleable=!0);h.hasOwnProperty("visible")||(h.visible=!0);f=null;g=Array.from(h.options);
b.productData.sections[k]=h;b.productData.sections[k].options=[];for(var l=0;l<g.length;l++){var m=g[l],p=d.options[m];if(p.enabled){p.hasOwnProperty("saleable")||(p.saleable=!0);b.productData.sections[k].options.push(m);for(var n in p.attributes)e=p.attributes[n],n&&e||delete p.attributes[n],b.productData.attributes[n]||delete p.attributes[n],b.productData.attributeValues[e]||delete p.attributes[n];for(e=0;e<p.components.length;e++)b.productData.components[p.components[e]]={};b.productData.options[m]=
p;b.productData.options[m].sectionCode=k;b.productData.options[p.code].keywords=0<p.keywords.length?p.keywords.split(";"):[];h.selectedOptions.includes(m)&&(f=m)}}b.productData.sections[k].selectedOption=f}},I=function(b,d){b.viewPoints=d.viewPoints;for(var e=0;e<b.viewPoints.length;++e){var f=b.viewPoints[e];f.tagsSet=f.tags?this.apiCore.exec(this.callerName,"lib.convertStringsToSet",f.tags):new Set}b.viewPointsModelReferenceBoundingBox=d.modelReferenceBoundingBox},J=function(b,d){b.highlight.color=
this.apiCore.exec(this.callerName,"lib.hexToRgba",d.highlight_color?d.highlight_color:"ffffff33",!0);b.highlight.borderColor=this.apiCore.exec(this.callerName,"lib.hexToRgba",d.highlight_border_color?d.highlight_border_color:"00000000",!0);b.highlight.blendingMode=void 0!==d.highlight_blending_mode?d.highlight_blending_mode:1;b.highlight.showSilhouettes=!!b.highlight.borderColor[3];this.apiCore.exec(this.callerName,"viewerSettingsFileLoaded",d)},M=function(b){return Math.log(b)/Math.LN2},T=function(b){var d=
Math.abs(b);if(0==d)return[0,0,0,0];b=0>-b?0:1;var e=Math.floor(M(d));d/=Math.pow(2,e);1>d&&--e;var f=[];f[0]=e+127;f[1]=128*b+Math.floor(128*d)%128;f[2]=Math.floor(Math.floor(d*Math.pow(2,15))%Math.pow(2,8));f[3]=Math.floor(d%Math.pow(2,-15)*Math.pow(2,23));return f},U=function(b,d,e){this.data=d;this.ptr=0;if(2!==e){d=C.call(this);e=S.call(this,d*d*3);for(var f=new Uint8Array(4*d*d),g=new Uint8Array(4*d*d),h=new Uint8Array(4*d*d),k=0;k<d*d;++k){var l=T(e[3*k]),m=T(e[3*k+1]),p=T(e[3*k+2]);f[4*k]=
l[0];f[4*k+1]=l[1];f[4*k+2]=l[2];f[4*k+3]=l[3];g[4*k]=m[0];g[4*k+1]=m[1];g[4*k+2]=m[2];g[4*k+3]=m[3];h[4*k]=p[0];h[4*k+1]=p[1];h[4*k+2]=p[2];h[4*k+3]=p[3]}b.dfglut={size:2*d,halfSize:d,halfPixels:f,halfPixels2:g,halfPixels3:h,halfFloats:e}}else b.env={width:d.width,height:d.height,floatData:d.dataFloat,rgbeData:d.dataRGBE}};M=function(b){return Math.log(b)/Math.LN2};var R=function(){return(new Uint8Array(this.data,this.ptr++,1))[0]},aa=function(){var b=(new Uint16Array(this.data,this.ptr,1))[0];this.ptr+=
2;return b},C=function(){var b=(new Int32Array(this.data,this.ptr,1))[0];this.ptr+=4;return b},L=function(){var b=(new Uint32Array(this.data,this.ptr,1))[0];this.ptr+=4;return b},K=function(){var b=(new Float32Array(this.data,this.ptr,1))[0];this.ptr+=4;if(!isFinite(b)||isNaN(b))b=0;return b},G=function(){var b=L.call(this),d="";if(4294967295!==b){for(var e=new Uint8Array(this.data,this.ptr,b),f=0,g;f<b;)switch(g=e[f++],g>>4){case 1:case 2:case 3:case 4:case 5:case 6:case 7:d+=String.fromCharCode(g);
break;case 12:case 13:char2=e[f++];d+=String.fromCharCode((g&31)<<6|char2&63);break;case 14:char2=e[f++];char3=e[f++];d+=String.fromCharCode((g&15)<<12|(char2&63)<<6|(char3&63)<<0);break;default:10==g&&(d+=String.fromCharCode(g))}this.ptr+=b}return d},S=function(b){if(0===b)return new Uint8Array(0);if(!b)return console.error("Called parseFloat32Array with null argument"),new Uint8Array(0);var d=new Float32Array(this.data,this.ptr,b);this.ptr+=4*b;return d},Y=function(b){if(0===b)return new Uint8Array(0);
if(!b)return console.error("Called parseInt32Array with null argument"),new Uint8Array(0);var d=new Int32Array(this.data,this.ptr,b);this.ptr+=4*b;return d},ia=function(b){if(0===b)return new Uint8Array(0);if(!b)return console.error("Called parseUint8Array with null argument"),new Uint8Array(0);var d=new Uint8Array(this.data,this.ptr,b);this.ptr+=b;return d},Q=function(){this.binaryFeatures={};if(!(4278190123>this.binaryVersion)){var b=L.call(this);if(b){b=Y.call(this,b);for(var e=0;e<b.length;++e)this.binaryFeatures[d[b[e]]]=
!0}}},ta=function(){var b=null,d={},e=C.call(this),f=C.call(this),g=R.call(this);var h=R.call(this);aa.call(this);var k=S.call(this,3*e);var l=S.call(this,3*e);128<=h&&(b=S.call(this,3*e),h-=128);0<h&&(d={});for(var m=0;m<h;++m){var p=C.call(this),n=S.call(this,2*e);d[p]=n;void 0===this.scene.uvsrcsIndex[p]&&(this.scene.uvsrcsIndex[p]=this.scene.uvsrcs.length,this.scene.uvsrcs.push(p))}h=Y.call(this,f*g);return{nbVertices:e,nbFaces:f,polySize:g,vertices:k,faces:h,normals:l,uvs:d,tangents:{},colors:b}},
ua=function(){var b=1;4278190120<=this.binaryVersion&&(b=C.call(this));if(0==b)return ta.call(this);for(var d=b=0,e=null,f=null,g=null,h=null,k=C.call(this),l=C.call(this),m=C.call(this),p=C.call(this),n={},q=0;q<p;q++){g=C.call(this);var t=C.call(this);n[g]=t;g={}}q=ia.call(this,k);0!=k%4&&ia.call(this,4-k%4);p=new this.dracoDecoderModule.DecoderBuffer;p.Init(q,k);k=new this.dracoDecoderModule.Decoder;k.GetEncodedGeometryType(p);q=new this.dracoDecoderModule.Mesh;t=k.DecodeBufferToMesh(p,q);if(t.ok()){b=
q.num_faces();d=q.num_points();e=k.GetAttribute(q,l);f=k.GetAttribute(q,m);m=this.dracoDecoderModule._malloc(12*(d>b?d:b));t=3*d;var r=4*t;h=3*b;l=4*h;k.GetAttributeDataArrayForAllPoints(q,e,this.dracoDecoderModule.DT_FLOAT32,r,m);e=(new Float32Array(this.dracoDecoderModule.HEAPF32.buffer,m,t)).slice();k.GetAttributeDataArrayForAllPoints(q,f,this.dracoDecoderModule.DT_FLOAT32,r,m);f=(new Float32Array(this.dracoDecoderModule.HEAPF32.buffer,m,t)).slice();k.GetTrianglesUInt32Array(q,l,m);h=(new Int32Array(this.dracoDecoderModule.HEAPF32.buffer,
m,h)).slice();for(var v in n)l=parseInt(v),t=k.GetAttribute(q,n[l]),k.GetAttributeDataArrayForAllPoints(q,t,this.dracoDecoderModule.DT_FLOAT32,8*d,m),g[l]=(new Float32Array(this.dracoDecoderModule.HEAPF32.buffer,m,2*d)).slice(),void 0===this.scene.uvsrcsIndex[l]&&(this.scene.uvsrcsIndex[l]=this.scene.uvsrcs.length,this.scene.uvsrcs.push(l));this.dracoDecoderModule._free(m)}else console.error(t.error_msg());this.dracoDecoderModule.destroy(q);this.dracoDecoderModule.destroy(k);this.dracoDecoderModule.destroy(p);
return{nbVertices:d,nbFaces:b,polySize:3,vertices:e,faces:h,normals:f,uvs:g,tangents:{},colors:null}},ea=function(b){var d=C.call(this);if(0>d)return null;var e=G.call(this),f=[];if(4278190104<=this.binaryVersion){var g=L.call(this);if(4294967295!==g)for(var h=0;h<g;++h)f.push(b.call(this))}else f.push(b.call(this));(b=this.scene.get("Geometry",d))?(b.name=e,b.dataBuffers=f,b.polySize=f.length?f[0].polySize:0,b.vertexBuffers=null,b.normalBuffers=null,b.colorBuffers=null,b.uvBuffers=null):this.scene.register("Geometry",
{id:d,name:e,dataBuffers:f,polySize:f.length?f[0].polySize:0,vertexBuffers:null,normalBuffers:null,colorBuffers:null,uvBuffers:null,polylists:[]});return b},oa=function(){for(var b=L.call(this),d={cursors:[]},e=0;e<b;e++){var f=S.call(this,4),g=K.call(this);d.cursors.push({color:f,location:g})}return d},ba=function(b){b=void 0===b?L.call(this):b;for(var d=0;d<b;++d){var e="",f=C.call(this);if(!this.readingScenery&&4278190082<=this.binaryVersion||this.readingScenery)e=!this.readingScenery&&4278190084<=
this.binaryVersion||this.readingScenery&&4278190081<=this.binaryVersion?G.call(this):"/"+C.call(this),"/-1"==e&&(e="");var g=G.call(this),h=C.call(this);this.readingScenery&&(h=-Math.abs(h));var k=L.call(this),l=[],m=null;if(4294967295!==k)for(var p=0;p<k;++p){var n=C.call(this),q=G.call(this),t=C.call(this),r=C.call(this),v=G.call(this),u=G.call(this),w=C.call(this);this.readingScenery&&(n=-Math.abs(n));q=this.scene.register("SourceImage",{id:n,name:q,width:t,height:r,fileType:v,filePath:u,realFilePath:this.apiCore.exec(this.callerName,
"buildLoadingFilePath",u),fileSize:w});n===h&&(m=q);l.push(q)}k=h=0;if(!this.readingScenery&&4278190101<=this.binaryVersion||this.readingScenery&&4278190087<=this.binaryVersion)h=K.call(this),k=K.call(this);this.readingScenery&&(f=-Math.abs(f));e=this.scene.register("ImageRGBA",{id:f,name:g,defaultImage:m,sourceImages:l,images:l,libSourceId:e,widthMM:h,heightMM:k,textureMode:"TEXTURE_2D"});this.readingScenery&&this.scene.scenery.materialsType&&(e.rgbe=!0);this.scene.srcImages[f]=this.scene.texturesManager?
this.scene.texturesManager.addImageRGBA(e):e}},ka=function(){var b=C.call(this);if(-1==b)return null;var d=S.call(this,3),e=K.call(this),f=C.call(this),g=C.call(this);this.readingScenery&&(g=-Math.abs(g));var h=ka.call(this);this.maxLayerIds=Math.max(this.maxLayerIds,b);return this.scene.register("Layer",{id:b,color:d,opacity:e,level:f,layer:h,image:this.scene.srcImages[g]})},Z=function(){for(var b=L.call(this),d=0;d<b;++d){var e=C.call(this);var f=G.call(this),g=G.call(this),h=G.call(this),k=G.call(this),
l=G.call(this),m=K.call(this),p=K.call(this),n=K.call(this),q=K.call(this),t=K.call(this),r=0,v=!1,u=!1,w=0,N=0,P=!1,A=.5,Q=.5,F=0;if(!this.readingScenery&&4278190099<=this.binaryVersion||this.readingScenery&&4278190086<=this.binaryVersion)r=K.call(this);if(!this.readingScenery&&4278190103<=this.binaryVersion||this.readingScenery&&4278190088<=this.binaryVersion)A=K.call(this),Q=K.call(this),F=C.call(this);var B=0!=L.call(this);if(!this.readingScenery&&4278190092<=this.binaryVersion||this.readingScenery&&
4278190084<=this.binaryVersion)v=0!=L.call(this),w=C.call(this);if(!this.readingScenery&&4278190101<=this.binaryVersion||this.readingScenery&&4278190087<=this.binaryVersion)P=0!=L.call(this);if(!this.readingScenery&&4278190098<=this.binaryVersion||this.readingScenery&&4278190085<=this.binaryVersion)N=C.call(this);if(!this.readingScenery&&4278190122<=this.binaryVersion||this.readingScenery&&4278190090<=this.binaryVersion)u=0!=L.call(this),!this.readingScenery&&4278190123<=this.binaryVersion&&!this.binaryFeatures[1]&&
(u=!1);var E=ka.call(this);this.readingScenery&&(e=-Math.abs(e));this.maxTextureIds=Math.max(this.maxTextureIds,e);e=this.scene.register("Texture",{id:e,name:f,wrapS:g,wrapT:h,repeatX:p,repeatY:n,offsetX:q,offsetY:t,pivotX:A,pivotY:Q,angle:r,useMipmap:B,minFilter:k,magFilter:l,anisotropy:m,srgbMode:v,channel:w,layer:E,negativeTexture:u,uvsrc:N,useRealMeasurements:P,uvTransformOrder:F,ignoreGlobalUVTransform:!1});this.scene.useRealMeasurements|=e.useRealMeasurements;this.scene.textures[e.id]=this.scene.texturesManager?
this.scene.texturesManager.addTexture(e):e}},da=function(){for(var b=L.call(this),d=0;d<b;++d){var e=void 0,f=C.call(this);if(-1==f)var g=null;else{if(!this.readingScenery&&4278190082<=this.binaryVersion||this.readingScenery)e=!this.readingScenery&&4278190084<=this.binaryVersion||this.readingScenery&&4278190081<=this.binaryVersion?G.call(this):"/"+C.call(this),"/-1"==e&&(e="");var h=G.call(this);if(4278190083<=this.binaryVersion||this.readingScenery&&4278190081<=this.binaryVersion){var k=0!=R.call(this);
R.call(this);aa.call(this);var l=S.call(this,3);g=K.call(this)}else k=!1,l=[0,0,0],g=0;var m=!1;if(this.readingScenery&&4278190084<=this.binaryVersion||!this.readingScenery&&4278190093<=this.binaryVersion)m=0!=L.call(this);var p=G.call(this),n=G.call(this),q=C.call(this),t=C.call(this),r=C.call(this),v=C.call(this),u=C.call(this),w=C.call(this);this.readingScenery&&(f=-Math.abs(f),q=-Math.abs(q),t=-Math.abs(t),r=-Math.abs(r),v=-Math.abs(v),u=-Math.abs(u),w=-Math.abs(w));g=this.scene.register("TextureCube",
{id:f,name:h,positioned:k,center:l,cubeSize:g,srgbMode:m,minFilter:p,magFilter:n,posX:this.scene.srcImages[q],negX:this.scene.srcImages[t],posY:this.scene.srcImages[r],negY:this.scene.srcImages[v],posZ:this.scene.srcImages[u],negZ:this.scene.srcImages[w],glTexture:null,currentlyLoading:!1,requiredForInit:!1,libSourceId:e})}this.scene.texturesCube[g.id]=this.scene.texturesManager?this.scene.texturesManager.addTextureCube(g):g;this.scene.texturesCube[g.id].libSourceId=g.libSourceId}},X=function(){var b=
C.call(this),d="";4278190082<=this.binaryVersion&&(d=4278190084<=this.binaryVersion?G.call(this):"/"+C.call(this),"/-1"==d&&(d=""));var e=4278190080<=this.binaryVersion?G.call(this):"",f=K.call(this),g=C.call(this),h=null;-1!=g&&(h=this.scene.textures[this.scene.get("Texture",g).id]);return{id:b,name:e,intensity:f,texture:h,libSourceId:d}},Ha=function(){var b=C.call(this),d="";4278190082<=this.binaryVersion&&(d=4278190084<=this.binaryVersion?G.call(this):"/"+C.call(this),"/-1"==d&&(d=""));var e=4278190080<=
this.binaryVersion?G.call(this):"",f=K.call(this),g=C.call(this),h=null,k=null;-1!=g&&(h=this.scene.textures[this.scene.get("Texture",g).id]);g=C.call(this);-1!=g&&(k=this.scene.textures[this.scene.get("Texture",g).id]);return{id:b,name:e,intensity:f,texture:h,intensityTexture:k,libSourceId:d}},Ga=function(){var b=C.call(this),d="";4278190082<=this.binaryVersion&&(d=4278190084<=this.binaryVersion?G.call(this):"/"+C.call(this),"/-1"==d&&(d=""));var e=4278190080<=this.binaryVersion?G.call(this):"",
f=K.call(this),g=S.call(this,3),h=C.call(this),k=null;-1!=h&&(k=this.scene.textures[this.scene.get("Texture",h).id]);return{id:b,name:e,intensity:f,color:g,texture:k,libSourceId:d}},Fa=function(){var b=C.call(this),d="";4278190082<=this.binaryVersion&&(d=4278190084<=this.binaryVersion?G.call(this):"/"+C.call(this),"/-1"==d&&(d=""));var e=4278190080<=this.binaryVersion?G.call(this):"",f=K.call(this),g=S.call(this,3),h=C.call(this),k=null,l=null;-1!=h&&(k=this.scene.textures[this.scene.get("Texture",
h).id]);h=C.call(this);-1!=h&&(l=this.scene.textures[this.scene.get("Texture",h).id]);return{id:b,name:e,intensity:f,color:g,texture:k,intensityTexture:l,libSourceId:d}},xa=function(){var b=C.call(this),d="";4278190082<=this.binaryVersion&&(d=4278190084<=this.binaryVersion?G.call(this):"/"+C.call(this),"/-1"==d&&(d=""));var e=4278190080<=this.binaryVersion?G.call(this):"",f=K.call(this),g=S.call(this,3),h=C.call(this),k=null,l=null;-1!=h&&(l=this.scene.textures[this.scene.get("Texture",h).id]);h=
C.call(this);-1!=h&&(k=this.scene.textures[this.scene.get("Texture",h).id]);return{id:b,name:e,intensity:f,color:g,texture:l,colorTexture:k,libSourceId:d}},Ia=function(){var b=C.call(this),d="";4278190082<=this.binaryVersion&&(d=4278190084<=this.binaryVersion?G.call(this):"/"+C.call(this),"/-1"==d&&(d=""));var e=4278190080<=this.binaryVersion?G.call(this):"",f=K.call(this),g=G.call(this),h=stage.emersya.viewer.TEXTURE_CHANNEL.R;4278190081<=this.binaryVersion&&(h=C.call(this));var k=stage.emersya.viewer.BLENDING_MODE.INTERPOLATIVE;
4278190091<=this.binaryVersion&&(k=C.call(this));var l=0;4278190100<=this.binaryVersion&&(l=K.call(this));var m=!1;4278190094<=this.binaryVersion&&(m=0!=C.call(this));var p=C.call(this),n=null;-1!=p&&(n=this.scene.textures[this.scene.get("Texture",p).id]);""==g||"none"==g?g="none":(1>f||n)&&0<f&&(this.scene.hasSomeBlur=!0,this.scene.opacityBlurs.push(g));return{id:b,name:e,intensity:f,blur:g,channel:h,blending:k,threshold:l,firstFacesOnly:m,texture:n,libSourceId:d}},qa=function(){var b=C.call(this),
d="";4278190082<=this.binaryVersion&&(d=4278190084<=this.binaryVersion?G.call(this):"/"+C.call(this),"/-1"==d&&(d=""));var e=4278190080<=this.binaryVersion?G.call(this):"",f=K.call(this),g=C.call(this),h=null;-1!=g&&(h=this.scene.textures[this.scene.get("Texture",g).id]);return{id:b,name:e,intensity:f,texture:h,libSourceId:d}},Va=function(){var b=C.call(this),d="";4278190082<=this.binaryVersion&&(d=4278190084<=this.binaryVersion?G.call(this):"/"+C.call(this),"/-1"==d&&(d=""));var e=4278190080<=this.binaryVersion?
G.call(this):"",f=K.call(this),g=0;4278190085<=this.binaryVersion&&(g=K.call(this));var h=0!=R.call(this);R.call(this);aa.call(this);var k=C.call(this),l=C.call(this),m=null,p=null;-1!=k&&(m=this.scene.texturesCube[this.scene.get("TextureCube",k).id]);-1!=l&&(p=this.scene.textures[this.scene.get("Texture",l).id]);return{id:b,name:e,intensity:f,blendingLevel:g,textureCube:m,texture:p,relativeToCamera:h,libSourceId:d}},va=function(){var b=C.call(this),d="";4278190082<=this.binaryVersion&&(d=4278190084<=
this.binaryVersion?G.call(this):"/"+C.call(this),"/-1"==d&&(d=""));var e=4278190080<=this.binaryVersion?G.call(this):"",f=K.call(this),g=K.call(this),h=0!=R.call(this);R.call(this);aa.call(this);var k=C.call(this),l=C.call(this),m=null,p=null;-1!=k&&(p=this.scene.texturesCube[this.scene.get("TextureCube",k).id]);-1!=l&&(m=this.scene.textures[this.scene.get("Texture",l).id]);return{id:b,name:e,intensity:f,index:g,textureCube:p,texture:m,relativeToCamera:h,libSourceId:d}},la=function(){var b=C.call(this),
d="";4278190082<=this.binaryVersion&&(d=4278190084<=this.binaryVersion?G.call(this):"/"+C.call(this),"/-1"==d&&(d=""));var e=4278190080<=this.binaryVersion?G.call(this):"",f=K.call(this),g=C.call(this),h=C.call(this),k=C.call(this),l=null;-1!=h&&(l=this.scene.textures[this.scene.get("Texture",h).id]);h=null;-1!=k&&(h=this.scene.textures[this.scene.get("Texture",k).id]);return{id:b,name:e,scale:f,type:g,texture:l,scaleTexture:h,libSourceId:d}},fa=function(){var b=C.call(this),d="";4278190082<=this.binaryVersion&&
(d=4278190084<=this.binaryVersion?G.call(this):"/"+C.call(this),"/-1"==d&&(d=""));var e=4278190080<=this.binaryVersion?G.call(this):"",f=K.call(this),g=C.call(this),h=K.call(this),k=S.call(this,3),l=C.call(this),m=null;-1!=l&&(m=this.scene.textures[this.scene.get("Texture",l).id]);l=C.call(this);var p=null;-1!=l&&(p=this.scene.textures[this.scene.get("Texture",l).id]);l=C.call(this);var n=null;-1!=l&&(n=this.scene.textures[this.scene.get("Texture",l).id]);this.scene.hasSomeGlow=!0;return{id:b,name:e,
opacity:f,size:g,saturation:h,color:k,colorTexture:m,opacityTexture:p,saturationTexture:n,libSourceId:d}},P=function(){var b=C.call(this),d="";4278190082<=this.binaryVersion&&(d=4278190084<=this.binaryVersion?G.call(this):"/"+C.call(this),"/-1"==d&&(d=""));var e=4278190080<=this.binaryVersion?G.call(this):"",f=K.call(this),g=S.call(this,3),h=C.call(this),k=null,l=null;-1!=h&&(k=this.scene.textures[this.scene.get("Texture",h).id]);h=C.call(this);-1!=h&&(l=this.scene.textures[this.scene.get("Texture",
h).id]);h=!1;4278190086<=this.binaryVersion&&(h=C.call(this));h&&(this.scene.hasSomeSpecularGlow=!0);return{id:b,name:e,intensity:f,color:g,texture:k,intensityTexture:l,glow:h,libSourceId:d}},Ba=function(){var b=C.call(this),d="";4278190082<=this.binaryVersion&&(d=4278190084<=this.binaryVersion?G.call(this):"/"+C.call(this),"/-1"==d&&(d=""));var e=4278190080<=this.binaryVersion?G.call(this):"",f=K.call(this);var g=4278190089<=this.binaryVersion?0!=C.call(this):!1;var h=S.call(this,3),k=C.call(this),
l=null;-1!=k&&(l=this.scene.textures[this.scene.get("Texture",k).id]);return{id:b,name:e,intensity:f,diffuseColor:g,color:h,texture:l,libSourceId:d}},Ka=function(){var b=C.call(this);if(-1===b)return null;var d=G.call(this);"/-1"==d&&(d="");var e=G.call(this),f=S.call(this,3),g=K.call(this),h=0;4278190118<=this.binaryVersion&&(h=C.call(this));var k=C.call(this);k=-1!=k?this.scene.textures[this.scene.get("Texture",k).id]:null;if(C.call(this)){var l=K.call(this);var m=S.call(this,3),p=C.call(this),
n=null,q=null;-1!=p&&(n=this.scene.textures[this.scene.get("Texture",p).id]);p=C.call(this);-1!=p&&(q=this.scene.textures[this.scene.get("Texture",p).id]);if(p=C.call(this))this.scene.hasSomeSpecularGlow=!0;var t=!1,r=.04;4278190102<=this.binaryVersion&&(t=0!=C.call(this),r=K.call(this));l={intensity:l,color:m,texture:n,intensityTexture:q,glow:p,fresnelMode:t,fresnel:r}}else l=null;return{id:b,name:e,color:f,intensity:g,blendingMode:h,texture:k,specular:l,libSourceId:d}},wa=function(){var b=C.call(this);
if(-1===b)return null;var d=G.call(this);"/-1"==d&&(d="");var e=G.call(this),f=0!=C.call(this),g=K.call(this),h=C.call(this);h=-1!=h?this.scene.textures[this.scene.get("Texture",h).id]:null;var k=null;if(4278190095<=this.binaryVersion)if(C.call(this)){k=K.call(this);var l=S.call(this,3),m=C.call(this),p=null,n=null,q=!1,t=1,r=null,v=!0;-1!=m&&(p=this.scene.textures[this.scene.get("Texture",m).id]);m=C.call(this);-1!=m&&(n=this.scene.textures[this.scene.get("Texture",m).id]);4278190116<=this.binaryVersion&&
(m=L.call(this),v=0!=(m&1),v||(q=0!=(m&2),t=K.call(this),m=C.call(this),-1!=m&&(r=this.scene.textures[this.scene.get("Texture",m).id])));k={oldShader:v,intensity:k,color:l,texture:p,intensityTexture:n,customRoughness:q,roughness:t,roughnessTexture:r}}else k=null;return{id:b,name:e,gloss:f,intensity:g,texture:h,sheen:k,libSourceId:d}},Ja=function(){var b=C.call(this);if(-1===b)return null;var d=G.call(this);"/-1"==d&&(d="");var e=G.call(this),f=K.call(this),g=C.call(this);g=-1!=g?this.scene.textures[this.scene.get("Texture",
g).id]:null;if(C.call(this)){var h=K.call(this);var k=K.call(this),l=C.call(this);l=-1!=l?this.scene.textures[this.scene.get("Texture",l).id]:null;var m=C.call(this);m=-1!=m?this.scene.textures[this.scene.get("Texture",m).id]:null;var p=C.call(this);p=-1!=p?this.scene.textures[this.scene.get("Texture",p).id]:null;var n=C.call(this);n=-1!=n?this.scene.textures[this.scene.get("Texture",n).id]:null;h={intensity:h,angle:k,texture:l,intensityTexture:m,roughnessTexture:p,rotationTexture:n}}else h=null;
k=null;if(this.binaryFeatures[4])if(C.call(this)){k=K.call(this);l=R.call(this);m=R.call(this);var q=R.call(this);n=R.call(this);p=n&1;n&=2;var t=S.call(this,m),r=S.call(this,m),v=S.call(this,m),u=K.call(this),w=C.call(this),N=C.call(this),P=C.call(this),A=C.call(this),Q=aa.call(this),F=aa.call(this),B=0;0<q&&(B=K.call(this));q=C.call(this);q=-1!=q?this.scene.textures[this.scene.get("Texture",q).id]:null;var E=C.call(this);E=-1!=E?this.scene.textures[this.scene.get("Texture",E).id]:null;var ca=C.call(this);
if((ca=-1!=ca?this.scene.textures[this.scene.get("Texture",ca).id]:null)&&this.scene.texturesManager)for(var Ca=0;Ca<ca.images.length;++Ca)ca.images[Ca].textureMode="TEXTURE_2D_ARRAY",ca.images[Ca].grid={x:Q,y:F,patchCount:A};this.scene.hasSomeCarpaint=!0;k={diffuse:k,specularLobeCount:m,specularLobeCoeffs:r,specularLobeF0s:t,specularLobeSpreads:v,brdfColorTexture:q,isRGBEbrdfColorTexture:p,flakesIntensity:u,flakesMaxThetaI:w,flakesNumThetaI:N,flakesNumThetaF:P,flakesNumPatches:A,flakesColorBias:B,
isRGBEflakesColorTexture:n,flakesColorTexture:ca,flakesSliceLutTexture:E,flakesGridX:Q,flakesGridY:F,coatingFlags:l}}else k=null;return{id:b,name:e,intensity:f,texture:g,anisotropy:h,carpaint:k,libSourceId:d}},La=function(){var b=C.call(this);if(-1===b)return null;var d=G.call(this);"/-1"==d&&(d="");var e=G.call(this),f=C.call(this),g=K.call(this),h=C.call(this);h=-1!=h?this.scene.textures[this.scene.get("Texture",h).id]:null;var k=C.call(this);k=-1!=k?this.scene.textures[this.scene.get("Texture",
k).id]:null;var l=C.call(this),m=K.call(this),p=C.call(this);p=-1!=p?this.scene.textures[this.scene.get("Texture",p).id]:null;var n=C.call(this);n=-1!=n?this.scene.textures[this.scene.get("Texture",n).id]:null;var q=!1,t=!1;4278190115<=this.binaryVersion&&(q=0!=R.call(this),t=0!=R.call(this),aa.call(this));return{id:b,name:e,type:f,inverted:q,intensity:g,texture:h,intensityTexture:k,type2:l,inverted2:t,intensity2:m,texture2:p,intensityTexture2:n,libSourceId:d}},ra=function(){var b=C.call(this);if(-1===
b)return null;var d=G.call(this);"/-1"==d&&(d="");var e=G.call(this),f=K.call(this),g=C.call(this),h=K.call(this);g=-1!=g?this.scene.textures[this.scene.get("Texture",g).id]:null;var k=K.call(this),l=C.call(this),m=K.call(this);l=-1!=l?this.scene.textures[this.scene.get("Texture",l).id]:null;return{id:b,name:e,ambientIntensity:f,ambientTexture:g,ambientTextureCorrection:h,lightIntensity:k,lightTexture:l,lightTextureCorrection:m,libSourceId:d}},Sa=function(){var b=C.call(this);if(-1===b)return null;
var d=G.call(this);"/-1"==d&&(d="");var e=G.call(this),f=C.call(this),g=0;4278190100<=this.binaryVersion&&(g=K.call(this));var h=K.call(this),k=G.call(this),l=0,m=!1;4278190094<=this.binaryVersion?(l=K.call(this),m=0!=C.call(this)):C.call(this);var p=C.call(this);p=-1!=p?this.scene.textures[this.scene.get("Texture",p).id]:null;var n;if(C.call(this)){var q=K.call(this),t=K.call(this),r=0!=R.call(this);R.call(this);aa.call(this);var v=C.call(this);-1!=v&&(n=this.scene.texturesCube[this.scene.get("TextureCube",
v).id]);n={intensity:q,index:t,textureCube:n,relativeToCamera:r}}else n=null;""==k||"none"==k?k="none":(1>h||p)&&0<h&&(this.scene.hasSomeBlur=!0,this.scene.opacityBlurs.push(k));return{id:b,name:e,blending:f,threshold:g,glassMode:l,firstFacesOnly:m,blur:k,intensity:h,texture:p,refraction:n,libSourceId:d}},Ya=function(){var b=C.call(this);if(-1===b)return null;var d=G.call(this),e=G.call(this),f=K.call(this),g=C.call(this),h=null;-1!=g&&(h=this.scene.textures[this.scene.get("Texture",g).id]);return{id:b,
name:e,intensity:f,texture:h,libSourceId:d}},Ra=function(){var b=C.call(this);if(-1===b)return null;var d=G.call(this);"/-1"==d&&(d="");var e=G.call(this),f=K.call(this),g=S.call(this,3),h=C.call(this),k=C.call(this);k=-1!=k?this.scene.textures[this.scene.get("Texture",k).id]:null;if(C.call(this)){var l=K.call(this);var m=C.call(this),p=K.call(this),n=0!=L.call(this),q=S.call(this,3),t=C.call(this),r=null;-1!=t&&(r=this.scene.textures[this.scene.get("Texture",t).id]);t=C.call(this);var v=null;-1!=
t&&(v=this.scene.textures[this.scene.get("Texture",t).id]);t=C.call(this);var u=null;-1!=t&&(u=this.scene.textures[this.scene.get("Texture",t).id]);this.scene.hasSomeGlow=!0;l={opacity:l,size:m,saturation:p,emissiveColor:n,color:q,colorTexture:r,opacityTexture:v,saturationTexture:u}}else l=null;m=null;4278190102<=this.binaryVersion&&(m=C.call(this),m=-1!=m?this.scene.textures[this.scene.get("Texture",m).id]:null);return{id:b,name:e,color:g,intensity:f,blendingMode:h,texture:k,intensityTexture:m,glow:l,
libSourceId:d}},ma=function(){var b=C.call(this);if(-1===b)return null;var d=G.call(this);"/-1"==d&&(d="");var e=G.call(this),f=S.call(this,3),g=C.call(this);g=-1!=g?this.scene.textures[this.scene.get("Texture",g).id]:null;var h=0!=R.call(this),k=0!=R.call(this);aa.call(this);var l=K.call(this),m=K.call(this),p=S.call(this,3),n=K.call(this);if(g&&this.scene.texturesManager){for(var q=0;q<g.images.length;++q)g.images[q].rgbe=!0;-1===this.scene.environmentTextures.indexOf(g)&&this.scene.environmentTextures.push(g)}if(g&&
2048==g.layer.image.defaultImage.width){var t=null;for(q in g.layer.image.images)2048>g.layer.image.images[q].width&&(null===t||g.layer.image.images[q].width>t.width)&&(t=g.layer.image.images[q]);null!==t&&(g.layer.image.defaultImage=t);t=null;for(q in g.layer.image.images)if(2048==g.layer.image.images[q].width){t=q;break}null!==t&&g.layer.image.images.splice(q,1)}return{id:b,name:e,tint:f,texture:g,relativeToCamera:h,positioned:k,rotation:l,exposure:m,center:p,size:n,libSourceId:d}},bb=function(){var b=
C.call(this);if(-1===b)return null;var d=G.call(this);"/-1"==d&&(d="");var e=G.call(this),f=K.call(this),g=C.call(this);g=-1!=g?this.scene.textures[this.scene.get("Texture",g).id]:null;var h=C.call(this),k=oa.call(this),l=C.call(this);switch(h){case 0:var m=function(b){return 1-b};break;case 1:m=function(b){return 2*Math.acos(b)/Math.PI};break;case 2:m=function(b){return Math.sqrt(1-b*b)};break;default:m=function(b){return b}}k.cursors.sort(function(b,d){return m(b.location)-m(d.location)});var p=
{colors:[],locations:[]},n;for(n in k.cursors){var q=k.cursors[n];p.colors.push(q.color[0]);p.colors.push(q.color[1]);p.colors.push(q.color[2]);p.colors.push(q.color[3]);p.locations.push(m(q.location))}return{id:b,name:e,intensity:f,texture:g,colormapping:h,colormap:k,mode:l,shaderColormap:p,libSourceId:d}},gb=function(){var b=C.call(this);if(-1===b)return null;var d=G.call(this);"/-1"==d&&(d="");var e=G.call(this),f=K.call(this),g=K.call(this),h=K.call(this),k=K.call(this),l=S.call(this,3),m=K.call(this),
p=C.call(this);p=-1!=p?this.scene.textures[this.scene.get("Texture",p).id]:null;var n=C.call(this);n=-1!=n?this.scene.textures[this.scene.get("Texture",n).id]:null;var q=C.call(this);q=-1!=q?this.scene.textures[this.scene.get("Texture",q).id]:null;var t=0,r=0,v=0,u=0,w=0,N=.01,P=7E-5,A=[0,0,0],Q={min:0,max:100},F=!1,B=0,E=null,ca=!1;if(4278190119<=this.binaryVersion){t=K.call(this);P=K.call(this);v=K.call(this);this.binaryFeatures[3]?(r=K.call(this),u=K.call(this),N=K.call(this),A=S.call(this,3),
Q.min=100*K.call(this),Q.max=100*K.call(this),w=R.call(this),F=R.call(this),aa.call(this)):(p&&(p.uvTransform.repeat[0]=p.repeatX*=P,p.uvTransform.repeat[1]=p.repeatY*=P),P=7E-5,A=K.call(this),A=[A,A,A],Q={min:19,max:100},F=!0);if(4278190119===this.binaryVersion&&0<t&&null===p)return null;if(0<t||0<r)this.scene.hasSomeFur=!0,this.scene.useRealMeasurements=!0,null===p&&(this.scene.needFurMap=!0)}this.binaryFeatures[4]&&(B=C.call(this),E=-1!=B?this.scene.textures[this.scene.get("Texture",B).id]:null,
B=K.call(this),ca=0!=R.call(this),R.call(this),aa.call(this));return{id:b,name:e,furRealSize:r,furMaxLength:t,furRigidity:v,furDispersion:u,furClumpType:w,furClumpSize:N,furHairSize:P,furRootColor:A,furGradInterval:Q,furGradNormalize:F,intensity:f,thickness:g,ior:k,roughness:h,color:l,colorIntensity:m,intensityTexture:p,thicknessTexture:n,roughnessTexture:q,normalIntensity:B,normalTexture:E,normalInverted:ca,libSourceId:d}},ib=function(){for(var b=L.call(this),d=0;d<b;++d){var e=C.call(this),f=G.call(this),
g=0!=L.call(this),h=!0;4278190113<=this.binaryVersion&&(h=0!=L.call(this));var k=!0,l=!0;4278190117<=this.binaryVersion&&(k=0!=aa.call(this),l=0!=aa.call(this));var m=null;this.binaryFeatures[6]&&(m=K.call(this));var p=K.call(this),n=K.call(this),q=C.call(this),t=C.call(this),r=[];if(4278190097<=this.binaryVersion){r=[];for(var v=L.call(this),u=0;u<v;++u){var w=G.call(this),N=C.call(this),P=null;switch(N){case 1:P=0!=L.call(this);break;case 2:P=C.call(this);break;case 3:P=K.call(this);break;case 4:P=
S.call(this,3);break;case 5:P=G.call(this);break;case 6:var A=C.call(this);if(P=-1!=A?this.scene.textures[this.scene.get("Texture",A).id]:null)this.customTextures[P.id]?(A=P.originData,P=stage.extend({},A),P.id=++this.maxTextureIds,P.layer=stage.extend({},A.layer),P.layer.id=++this.maxLayerIds,this.scene.textures[P.id]=this.scene.texturesManager.addTexture(P),P=this.scene.textures[P.id],this.scene.textures[P.id].ignoreGlobalUVTransform=!0):(this.scene.textures[this.scene.get("Texture",A).id].ignoreGlobalUVTransform=
!0,this.customTextures[P.id]=P);break;case 7:A=C.call(this);P=-1!=A?this.scene.texturesCube[this.scene.get("TextureCube",A).id]:null;break;case 8:P=null}r.push({address:w,type:N,value:P})}}v=[];if(this.binaryFeatures[5]){v=L.call(this);u=[];for(w=0;w<v;++w)u.push(G.call(this));v=u;this.scene.hasSomePolylistTags=Math.max(this.scene.hasSomePolylistTags,v.length);u=this.apiCore.exec(this.callerName,"lib.convertStringsToSet",v)}else u=new Set;w=C.call(this);(N=this.scene.get("Polylist",e))?(N.name=f,
N.doubleSided=g,N.facesOrientation=h,N.polygonOffsetFactor=p,N.polygonOffsetUnits=n,N.subdivisionLevel=q,N.ssaoReceive=k,N.ssaoCast=l,N.refractDistance=m,N.renderingPass=t,N.geometryId=w,N.indexBuffer=null,N.indexLineBuf=null,N.elementTypes=null,N.downloaded=!1,N.selected=!1,N.highlighted=!1,N.isHidden=!1,N.customMaterialValues=r,N.tags=v,N.tagsSet=u,N.customMaterial=this.scene.convertCustomMaterialValuesToMaterial(r)):N=this.scene.register("Polylist",{id:e,name:f,doubleSided:g,facesOrientation:h,
ssaoReceive:k,ssaoCast:l,refractDistance:m,polygonOffsetFactor:p,polygonOffsetUnits:n,subdivisionLevel:q,renderingPass:t,geometryId:w,indexBuffer:null,indexLineBuf:null,elementTypes:null,downloaded:!1,selected:!1,highlighted:!1,isHidden:!1,materialTree:null,customMaterialValues:r,customMaterial:this.scene.convertCustomMaterialValuesToMaterial(r),tags:v,tagsSet:u,duplicatedPolylists:[],instances:[]});e=N.customMaterial;if(this.currentMaterialsType){if(e.emissive&&e.emissive.glow&&(this.scene.hasSomeGlow=
!0),e.metalness&&e.metalness.carpaint&&(this.scene.hasSomeCarpaint=!0),e.coating&&(0<e.coating.furRealSize||0<e.coating.furMaxLength)&&(this.scene.hasSomeFur=!0,this.scene.useRealMeasurements=!0,e.coating.intensityTexture||(this.scene.needFurMap=!0)),e.localEnvironment&&e.localEnvironment.texture){f=e.localEnvironment.texture;if(this.scene.texturesManager)for(g=0;g<f.images.length;++g)f.images[g].rgbe=!0;else f.layer.image.rgbe=!0;-1===this.scene.environmentTextures.indexOf(f)&&this.scene.environmentTextures.push(f)}}else e.glow&&
(this.scene.hasSomeGlow=!0);e.opacity&&e.opacity.blur&&(""==e.opacity.blur||"none"==e.opacity.blur?e.opacity.blur="none":(this.scene.hasSomeBlur=!0,this.scene.opacityBlurs.push(e.opacity.blur)));this.scene.maxRenderingPass=Math.max(this.scene.maxRenderingPass,t)}},hb=function(b){var d=C.call(this);if(-1==d)return null;var e=G.call(this),f=G.call(this),g=G.call(this),h=G.call(this),k=C.call(this),l=C.call(this),m=0;4278190112<=this.binaryVersion&&(m=C.call(this));var p=null,n=null;4278190123<=this.binaryVersion&&
(p=ab.call(this),n=ea.call(this,ta));return b&&(b=this.scene.get("SourceModel",d))?b:this.scene.register("SourceModel",{id:d,code:e,filePath:h,realFilePath:this.apiCore.exec(this.callerName,"buildLoadingFilePath",h+(0!==m?".cbin":".bin")),name:f,extension:g,fileSize:k,uncompressedFileSize:l,geometryCompression:m,boundingBox:p,loadedCallbacks:[],convexHull:n})},fb=function(){var b=C.call(this),d=G.call(this),e=S.call(this,16),f=L.call(this),g=Y.call(this,f),h=L.call(this),k=Y.call(this,h),l=hb.call(this);
h=L.call(this);for(var m=[],p=0;p<h;++p)m.push(fb.call(this));if(f){var n=[];for(p=0;p<f;++p)n.push(this.scene.get("Polylist",g[p]).id);g=n}else g=[];b={id:b,name:d,matrix:mat4.create(e),children:m,polylistIds:g,materialIds:k,sourceModel:l,selected:!1,highlighted:!1,parent:null,opacity:1,baseOpacity:1,explosionVector:vec3.create([0,0,0]),explodable:!1,annotations:[],duplicatedNodes:{},polylists:[]};for(p=0;p<h;++p)m[p].parent=b;this.scene.register("SourceNode",b);return b},Aa=function(b){var d=L.call(this);
1!=d&&console.error("ERREUR nb materials settings != 1");for(var e=0;e<d;++e){C.call(this);var f=C.call(this);L.call(this);f={content:this.scene.get("MaterialSettings",f)};f.content.mt=b.splice(0,1)[0];f.content.path=b}return f},eb=function(){var b=C.call(this),d=S.call(this,3),e=S.call(this,3),f=S.call(this,3),g=S.call(this,3),h=S.call(this,3);return{type:1,id:b,v1:d,v2:e,v3:f,v4:g,normal:h}},ab=function(){var b=K.call(this),d=K.call(this),e=K.call(this),f=K.call(this),g=K.call(this),h=K.call(this);
b={maxX:b,maxY:d,maxZ:e,minX:f,minY:g,minZ:h,center:vec3.create(),vecs:[vec3.create([f,g,h]),vec3.create([f,g,e]),vec3.create([f,d,h]),vec3.create([f,d,e]),vec3.create([b,g,h]),vec3.create([b,g,e]),vec3.create([b,d,h]),vec3.create([b,d,e])],radius:Math.max(Math.abs(b-f),Math.max(Math.abs(d-g),Math.abs(e-h)))};vec3.add([b.minX,b.minY,b.minZ],[b.maxX,b.maxY,b.maxZ],b.center);vec3.scale(b.center,.5);return b},Ma=function(){var b=C.call(this),d=G.call(this),e=S.call(this,3),f=K.call(this),g=!1;4278190083<=
this.binaryVersion&&(g=0!=C.call(this));return{id:b,name:d,color:e,intensity:f,ambientMode:g}},Ta=function(){var b=C.call(this);if(-1==b)return{id:-1,intensity:0,globalIntensity:0,width:1,height:1,bias:0,globalBias:0,near:0,far:0,left:0,right:0,bottom:0,top:0,autoAdjust:!1};var d=K.call(this),e=C.call(this),f=C.call(this),g=K.call(this),h=K.call(this),k=K.call(this),l=K.call(this),m=K.call(this),p=K.call(this),n=K.call(this),q=!1,t=.2,r=.4;4278190089<=this.binaryVersion&&(q=0!=C.call(this),r=K.call(this),
t=K.call(this));return{id:b,intensity:d,globalIntensity:r,width:e,height:f,bias:g,globalBias:t,near:h,far:k,left:l,right:m,bottom:p,top:n,autoAdjust:q}},db=function(){var b=[],d=L.call(this);if(4294967295!==d)for(var e=0;e<d;++e){var f=C.call(this),g=C.call(this),h=C.call(this),k=G.call(this);b.push({id:f,materialTreeId:this.scene.get("MaterialTree",g).id,materialSettingsId:this.scene.get("MaterialSettings",h).id,accessString:k})}return b},Oa=function(b){var d=[];b=b?b:L.call(this);if(4294967295!==
b)for(var e=0;e<b;++e){var f=C.call(this),g=G.call(this),h=G.call(this),k=G.call(this),l=G.call(this),m=0!=R.call(this);R.call(this);aa.call(this);var p=4278190080<=this.binaryVersion?S.call(this,3):[0,.694,.671];var n=db.call(this);var q=4278190081<=this.binaryVersion?G.call(this):null;d.push(this.scene.register("Preset",{id:f,name:g,filePath:h,smallPreviewPath:k,bigPreviewPath:l,displayInWebService:m,color:p,materials:n,sku:q}))}return d},Qa=function(){var b=[],d=L.call(this);if(4294967295!==d)for(var e=
0;e<d;++e){var f=C.call(this),g=G.call(this),h=G.call(this),k=C.call(this),l=C.call(this),m=G.call(this),p=C.call(this),n=G.call(this);b.push({id:f,code:g,filePath:h,realFilePath:""!=h?this.apiCore.exec(this.callerName,"buildLoadingFilePath",h):"",thumbRealFilePath:""!=h?this.apiCore.exec(this.callerName,"buildLoadingFilePath",h+"_thumb"):"",number:k,groupId:l,groupName:m,configurationId:p,configurationName:m+"/"+n,realConfName:n})}return b},N=function(){var b=[],d=L.call(this);if(4294967295!==d)for(var e=
0;e<d;++e){var f=C.call(this),g=G.call(this),h=G.call(this),k=C.call(this),l=G.call(this);b.push({id:f,code:g,filePath:h,realFilePath:this.apiCore.exec(this.callerName,"buildLoadingFilePath",h),thumbRealFilePath:this.apiCore.exec(this.callerName,"buildLoadingFilePath",h+"_thumb"),presetId:k,presetName:l})}return b},za=function(){var b=[],d=L.call(this);if(4294967295!==d)for(var e=0;e<d;++e){var f=C.call(this),g=G.call(this),h=G.call(this),k=C.call(this),l=C.call(this),m=G.call(this),p=C.call(this),
n=G.call(this);b.push({id:f,code:g,filePath:h,realFilePath:""!=h?this.apiCore.exec(this.callerName,"buildLoadingFilePath",h):"",thumbRealFilePath:""!=h?this.apiCore.exec(this.callerName,"buildLoadingFilePath",h+"_thumb"):"",number:k,mtId:l,mtName:m,msId:p,msName:n})}return b},ca=function(){var b=[],d=L.call(this);if(4294967295!==d)for(var e=0;e<d;++e){var f=C.call(this),g=G.call(this),h=G.call(this),k=C.call(this),l=C.call(this),m=C.call(this),p=G.call(this),n=C.call(this),q=G.call(this);b.push({id:f,
code:g,filePath:h,realFilePath:""!=h?this.apiCore.exec(this.callerName,"buildLoadingFilePath",h):"",thumbRealFilePath:""!=h?this.apiCore.exec(this.callerName,"buildLoadingFilePath",h+"_thumb"):"",number:k,polyId:l,mtId:m,mtName:p,msId:n,msName:q})}return b},Ea=function(){var b=[],d=L.call(this);if(4294967295!==d)for(var e=0;e<d;++e){var f=C.call(this),g=C.call(this),h=C.call(this);if(4278190083<=this.binaryVersion){var k=K.call(this);var l=K.call(this)}else k=C.call(this),l=C.call(this);var m=S.call(this,
16);b.push({msId:f,x:g,y:h,width:k,height:l,matrix:m})}return b},Ca=function(b){this.data=b;this.ptr=0;this.fallback.id=C.call(this);this.binaryVersion=L.call(this);this.fallback.code=G.call(this);this.fallback.name=G.call(this);this.fallback.filePath=G.call(this);this.fallback.width=C.call(this);this.fallback.height=C.call(this);this.fallback.thumbnailSize=C.call(this);this.fallback.groupsOnly=4278190081<=this.binaryVersion?C.call(this):0;G.call(this);C.call(this);this.fallback.interactive=4278190084<=
this.binaryVersion?0!=C.call(this):!1;this.fallback.viewpoints=[];this.fallback.disabledViewpoints=[];b=L.call(this);if(4294967295!==b){for(var d=0;d<b;++d){var e=C.call(this),f=G.call(this),g=G.call(this),h=G.call(this),k=0!=R.call(this);R.call(this);aa.call(this);var l=C.call(this),m=S.call(this,3),p=S.call(this,3),n=S.call(this,3),q=1E3;4278190082<=this.binaryVersion&&(q=C.call(this));var t=Qa.call(this),r=N.call(this),v=za.call(this),u=[],P=[];4278190082<=this.binaryVersion&&(u=ca.call(this),
P=Ea.call(this));e={id:e,code:f,name:g,thumbnail:h,realThumbnail:""!=h?this.apiCore.exec(this.callerName,"buildLoadingFilePath",h):"",enabled:k,number:l,cameraPosition:m,cameraUp:p,cameraTarget:n,customTextPerspective:q,mtgcImages:t,presetImages:r,msImages:v,polyImages:u,msCts:P};k?this.fallback.viewpoints.push(e):this.fallback.disabledViewpoints.push(e)}this.fallback.viewpoints.sort(function(b,d){return b.number<d.number?-1:b.number>d.number?1:0})}},Ua=function(){return{dirty:!0,angle:K.call(this),
scaleX:K.call(this),scaleY:K.call(this),offsetX:K.call(this),offsetY:K.call(this)}};return u});stage.provide("emersya.viewer.modules.initializer");stage.require("emersya.viewer.modules.scene");stage.require("emersya.viewer.modules.API.core");stage.require("emersya.viewer.modules.downloadManager");stage.require("emersya.viewer.modules.renderer.core");
stage.register.call(stage.emersya.viewer.modules,"initializer",function(){var b={modelsPath:"",dataPath:"",serverURL:""},d=function(d,f){this.settings=stage.extend(!0,{},b,f);this.apiCore=d;this.eventsManager=stage.createEventsManager(this.settings);this.loadToGl=this.currentlyLoading=!1;this.dfglut=null;navigator.platform.match(/(iPod|iPhone|iPad)/);this.isIos=!0;this.downloadingProductNodes=this.projectsToLoad=0;this.hasDracoModule=!1;this.callerName=this.name="Initializer";this.apiCore.register(this,
"createScene",u,!0);this.apiCore.register(this,"getProjectsDataToDownload",l);this.apiCore.register(this,"loadModel",B);this.apiCore.register(this,"loadModelFromPath",w);this.apiCore.register(this,"loadProject",D);this.apiCore.register(this,"loadProjectModelsAndImages",T);this.apiCore.register(this,"preloadProjectInScene",U);this.apiCore.register(this,"loadProductNode",R);this.apiCore.register(this,"loadProductNodes",aa);this.apiCore.register(this,"loadScenery",e);this.apiCore.register(this,"getCompressedDownloadSize",
q,!0);this.apiCore.register(this,"reload3D",G);this.apiCore.register(this,"loadToGl",S);this.apiCore.register(this,"loadDFGLUT",A);this.apiCore.register(this,"loadDFGLUTCookTorrance",H)};d.prototype.destroy=function(){this.apiCore.unregister(this,"createScene");this.apiCore.unregister(this,"getProjectsDataToDownload");this.apiCore.unregister(this,"loadModel");this.apiCore.unregister(this,"loadModelFromPath");this.apiCore.unregister(this,"loadProject");this.apiCore.unregister(this,"loadProjectModelsAndImages");
this.apiCore.unregister(this,"preloadProjectInScene");this.apiCore.unregister(this,"loadProductNode");this.apiCore.unregister(this,"loadProductNodes");this.apiCore.unregister(this,"loadScenery");this.apiCore.unregister(this,"getCompressedDownloadSize");this.apiCore.unregister(this,"reload3D");this.apiCore.unregister(this,"loadToGl");this.apiCore.unregister(this,"loadDFGLUT");this.apiCore.unregister(this,"loadDFGLUTCookTorrance")};var u=function(b,d,e,f){b=new stage.emersya.viewer.modules.scene(this.apiCore,
this.dfglut,b,f);b.setParent(d,e);return b},k=function(b,d,e,f){var g=this.apiCore.exec(this.callerName,"rdr.getCurrentScene");if(b&&g){b=u.call(this,!1,d,e,f);b.tonemapping=stage.extend({},g.tonemapping);b.scenery=stage.extend({},g.scenery);b.lights=stage.extend({},g.lights);b.lights.buffers=stage.extend({},g.lights.buffers);this.texturesToLoad=0;if(b.lights.IBL){d=b.lights.IBL.texture;f=b.register("ImageRGBA",d.posX);for(e=0;e<f.sourceImages.length;++e)f.sourceImages[e]=b.register("SourceImage",
f.sourceImages[e]);var h=b.register("ImageRGBA",d.negX);for(e=0;e<f.sourceImages.length;++e)h.sourceImages[e]=b.register("SourceImage",h.sourceImages[e]);h.defaultImage=b.get("SourceImage",d.negX.defaultImage.id);var k=b.register("ImageRGBA",d.posY);for(e=0;e<f.sourceImages.length;++e)k.sourceImages[e]=b.register("SourceImage",k.sourceImages[e]);k.defaultImage=b.get("SourceImage",d.posY.defaultImage.id);var l=b.register("ImageRGBA",d.negY);for(e=0;e<f.sourceImages.length;++e)l.sourceImages[e]=b.register("SourceImage",
l.sourceImages[e]);l.defaultImage=b.get("SourceImage",d.negY.defaultImage.id);var m=b.register("ImageRGBA",d.posZ);for(e=0;e<f.sourceImages.length;++e)m.sourceImages[e]=b.register("SourceImage",m.sourceImages[e]);m.defaultImage=b.get("SourceImage",d.posZ.defaultImage.id);var p=b.register("ImageRGBA",d.negZ);for(e=0;e<f.sourceImages.length;++e)p.sourceImages[e]=b.register("SourceImage",p.sourceImages[e]);p.defaultImage=b.get("SourceImage",d.negZ.defaultImage.id);e=b.register("TextureCube",{id:d.id,
name:d.name,minFilter:d.minFilter,magFilter:d.magFilter,posX:b.texturesManager.addImageRGBA(f),negX:b.texturesManager.addImageRGBA(h),posY:b.texturesManager.addImageRGBA(k),negY:b.texturesManager.addImageRGBA(l),posZ:b.texturesManager.addImageRGBA(m),negZ:b.texturesManager.addImageRGBA(p)});b.lights.IBL.texture=b.texturesManager.addTextureCube(e)}if(b.scenery.environmentTexture){d=g.scenery.environmentTexture;g=b.register("ImageRGBA",d.layer.image);for(e=0;e<g.sourceImages.length;++e)g.sourceImages[e]=
b.register("SourceImage",g.sourceImages[e]);g.defaultImage=b.get("SourceImage",d.layer.image.defaultImage.id);g=b.texturesManager.addImageRGBA(g);e=b.register("Texture",{id:d.id,name:d.name,wrapS:d.wrapS,wrapT:d.wrapT,repeatX:d.repeatX,repeatY:d.repeatY,offsetX:d.offsetX,offsetY:d.offsetY,angle:d.angle,useMipmap:d.useMipmap,minFilter:d.minFilter,magFilter:d.magFilter,anisotropy:d.anisotropy,layer:b.register("Layer",{id:d.layer.id,image:g}),imgsSrc:g,uvsrc:d.uvsrc});b.scenery.environmentTexture=b.texturesManager.addTexture(e);
b.scenery.environmentTexture.cube1=d.cube1;b.scenery.environmentTexture.cube2=d.cube2;b.scenery.environmentTexture.cube3=d.cube3;b.scenery.environmentTexture.cube4=d.cube4;b.scenery.environmentTexture.cube5=d.cube5;b.scenery.environmentTexture.cube6=d.cube6;d.cube1=null;d.cube2=null;d.cube3=null;d.cube4=null;d.cube5=null;d.cube6=null;b.environmentTextures.push(b.scenery.environmentTexture)}b.scenery.blurredEnvironment=null}else b=u.call(this,!0,d,e,f);return b},l=function(b,d,e,f){for(var g=[],h=
0;h<d.length;++h){var k=d[h];b.getParentData("Project",k)||-1!==g.indexOf(k)||g.push(k)}b=new FormData;d=this.settings.serverURL+"/FRJB2NHIT4";b.append("p42",JSON.stringify(g));g=new XMLHttpRequest;g.open("POST",d,!0);g.onreadystatechange=stage.setContext(function(b,d){if(b.readyState===XMLHttpRequest.DONE){d={};if(200===b.status)try{d=stage.json.parse(b.responseText)}catch(Z){d.resultSet=null}else d.resultSet=null;b=(b=d)&&b.resultSet?null!=b.resultSet.error?-1!==b.resultSet.error.indexOf("Error 501:")?
stage.createError(313,"Operation not supported."):stage.createError(314,"Error from the server."):stage.createResult(null):stage.createError(314,"There is no response from the server or it is empty.");stage.testResult(b)?f(b):e(d.resultSet.data[0])}},this,g);g.send(b)},g=function(b,d){this.totalBytesToDownload=b;this.totalCompressedSize=d;this.filesProgression={};this.apiCore.exec(this.callerName,"ui.updateLoader",0,this.totalBytesToDownload)},q=function(){return this.totalCompressedSize},t=function(b,
d){this.filesProgression[b]=d;b=0;for(var e in this.filesProgression)b+=this.filesProgression[e];this.apiCore.exec(this.callerName,"ui.updateLoader",b,this.totalBytesToDownload)},r=function(b,d){b&&(this.apiCore.exec(this.callerName,"rdr.deallocateScene",b),delete b);this.currentlyLoading?this.apiCore.exec(this.callerName,"init.downloadError","image",d):this.apiCore.exec(this.callerName,"texturesManager.downloadError","image",d);this.currentlyLoading=!1},f=function(b){this.apiCore.exec(this.callerName,
"init.failedToDownloadImages",b)},n=function(b,d,e,f){b&&(this.apiCore.exec(this.callerName,"rdr.deallocateScene",b),delete b);this.apiCore.exec(this.callerName,"init.downloadError",d,e);this.currentlyLoading=!1},B=function(b,d,e,f,h,l){this.loadToGl=this.apiCore.exec(this.callerName,"rdr.getWebGLContext")?!0:!1;l||(this.lastLoadCall={func:B,args:[b,d,e,!0]});this.currentlyLoading?console.warn("Initializer already in loading process."):(this.currentlyLoading=!0,f=k.call(this,f,"Model",b.split("/").slice(-2)[0],
h),f.isSimpleModel=!0,this.apiCore.exec(this.callerName,"dlm.get",d,"arraybuffer",stage.setContext(function(d,f,h){this.apiCore.exec(this.callerName,"scps.readModelGraph",d,h);d.loadedCallback||this.apiCore.exec(this.callerName,"init.sceneBaseLoaded",d);d.setDefaultLights&&this.apiCore.exec(this.callerName,"setDefaultLights",d);d.updateSceneNodes();f=d.texturesManager.updateStartingRequirements(this.apiCore.exec(this.callerName,"rdr.getWebGLContext"));g.call(this,e+f,e+f);this.apiCore.exec(this.callerName,
"dlm.get",b,"arraybuffer",stage.setContext(function(b,d,e){this.apiCore.exec(this.callerName,"scps.readModelGeometries",b,e);this.loadToGl&&b.texturesManager.setGlContext(this.apiCore.exec(this.callerName,"rdr.getWebGLContext"));L.call(this,b)},this,d),stage.setContext(n,this,d,"model geometries"),stage.setContext(t,this),!0)},this,f),stage.setContext(n,this,f,"model graph"),function(){},!0))},w=function(b,d,e,f,h,l){this.useCache=e;this.loadToGl=this.apiCore.exec(this.callerName,"rdr.getWebGLContext")?
!0:!1;l||(this.lastLoadCall={func:w,args:[b,d,!1,!0]});this.currentlyLoading?console.warn("Initializer already in loading process."):(this.currentlyLoading=!0,e=k.call(this,f,"Model",b.split("/").slice(-2)[0],h),e.isSimpleModel=!0,this.apiCore.exec(this.callerName,"dlm.get",b+"_GS.bin","arraybuffer",stage.setContext(function(e,f,h){this.apiCore.exec(this.callerName,"scps.readModelGraph",e,h);e.loadedCallback||this.apiCore.exec(this.callerName,"init.sceneBaseLoaded",e);e.setDefaultLights&&this.apiCore.exec(this.callerName,
"setDefaultLights",e);e.updateSceneNodes();f=e.texturesManager.updateStartingRequirements(this.apiCore.exec(this.callerName,"rdr.getWebGLContext"));g.call(this,d+f,d+f);this.apiCore.exec(this.callerName,"dlm.get",b+".bin","arraybuffer",stage.setContext(function(b,d,e){this.apiCore.exec(this.callerName,"scps.readModelGeometries",b,e);this.loadToGl&&b.texturesManager.setGlContext(this.apiCore.exec(this.callerName,"rdr.getWebGLContext"));L.call(this,b)},this,e),stage.setContext(n,this,e,"model geometries"),
stage.setContext(t,this),!0)},this,e),stage.setContext(n,this,e,"model graph"),function(){},!0))},D=function(b,d,e,f){this.currentlyLoading?console.warn("Initializer already in loading process."):(this.sceneTexturesReady=this.sceneBaseReady=!1,this.useCache=d,f||(this.lastLoadCall={func:D,args:[b,!1]}),this.currentlyLoading=!0,E.call(this,b,d,e))},A=function(b){this.dfglut?b&&b():this.apiCore.exec(this.callerName,"dlm.get",this.settings.dataPath+"../textures/defaultEnvironment/dfglutfull2.bin","arraybuffer",
stage.setContext(function(d,e){d={};this.apiCore.exec(this.callerName,"scps.readDFGLUT",d,e);this.dfglut=d.dfglut;b&&b()},this),stage.setContext(n,this,null,"dfglut"),null,!0)},H=function(b,d,e){if(this.dfglutCookTorrance)b&&b(this.dfglutCookTorrance);else{var f=stage.setContext(function(d,e){d={};this.apiCore.exec(this.callerName,"scps.readDFGLUT",d,e);this.dfglutCookTorrance=d.dfglut;b&&b(d.dfglut)},this);this.apiCore.exec(this.callerName,"dlm.get",this.settings.dataPath+"../textures/defaultEnvironment/ct_dfg_128x128.bin",
"arraybuffer",f,d,e,!0)}},e=function(b,d){if(this.currentlyLoading)console.warn("Initializer already in loading process.");else if(d=d?d:this.apiCore.exec(this.callerName,"rdr.getCurrentScene")){this.currentlyLoading=!0;this.downloadCount=1;var e=function(d,e,f,g){this.currentlyLoading=!1;e?(this.apiCore.exec(this.callerName,"scps.readDFGLUT",d,g),this.dfglut=d.dfglut):(e=d.getCurrentParentTypeAndId(),d.setParent("Scenery",b.split("/").slice(-2)[0]),this.apiCore.exec(this.callerName,"scps.readScenery",
d,g),d.setParent(e.type,e.id));--this.downloadCount||(this.texturesToLoad=0,d.lights.IBL&&(++this.texturesToLoad,d.texturesManager.downloadTextureCube(d.lights.IBL.texture,stage.setContext(function(){--this.texturesToLoad||(this.apiCore.exec(this.callerName,"rdr.updateSceneLights",d),this.apiCore.exec(this.callerName,"rdr.updateShaders",d),this.apiCore.exec(this.callerName,"rdr.toggleRendering",!0),this.apiCore.exec(this.callerName,"sceneryLoaded"))},this))),d.scenery.environmentTexture&&(++this.texturesToLoad,
d.scenery.environmentTexture.load(),d.texturesManager.downloadTexture(d.scenery.environmentTexture,stage.setContext(function(){--this.texturesToLoad||(this.apiCore.exec(this.callerName,"rdr.updateSceneLights",d),this.apiCore.exec(this.callerName,"rdr.updateShaders",d),this.apiCore.exec(this.callerName,"rdr.toggleRendering",!0),this.apiCore.exec(this.callerName,"sceneryLoaded"))},this),!0)),this.texturesToLoad||(this.apiCore.exec(this.callerName,"rdr.updateSceneLights",d),this.apiCore.exec(this.callerName,
"rdr.updateShaders",d),this.apiCore.exec(this.callerName,"rdr.toggleRendering",!0),this.apiCore.exec(this.callerName,"sceneryLoaded")))};d.materialsType&&!d.dfglut&&this.isIos&&(++this.downloadCount,this.apiCore.exec(this.callerName,"dlm.get",this.settings.dataPath+"../textures/defaultEnvironment/dfglutfull2.bin","arraybuffer",stage.setContext(e,this,d,!0),stage.setContext(n,this,d,"dfglut"),stage.setContext(t,this),!0));this.apiCore.exec(this.callerName,"dlm.get",b,"arraybuffer",stage.setContext(e,
this,d,!1),stage.setContext(n,this,null,"scenery"),function(){},!0);this.apiCore.exec(this.callerName,"rdr.toggleRendering",!1)}else console.warn("No scene to load the scenery to.")},E=function(b,d,e){d=b.sceneryPath&&""!==b.sceneryPath?u.call(this,!1,"Project",b.projectPath.split("/").slice(-2)[0],e):k.call(this,b.keepScenery,"Project",b.projectPath.split("/").slice(-2)[0],e);d.projectDefaultGraphPath=b.projectDefaultGraphPath;d.projectConfigurationPath=b.projectConfigurationPath;this.filesDownloaded=
this.downloadCount=0;e=function(b,d,e,f){this.apiCore.exec(this.callerName,"scps."+d,b,f);++this.filesDownloaded===this.downloadCount&&F.call(this,b)};var f={projectJsonPath:{func:"readProjectJson",type:"json"},sceneryPath:{func:"readScenery",type:"arraybuffer"},animationsPath:{func:"readAnimations",type:"json"},watchPath:{func:"readWatch",type:"json"},modularConfiguratorPath:{func:"readModularConfigurator",type:"json"},projectFurniturePath:{func:"readProjectFurnitureFile",type:"json"},wearableARPath:{func:"readWearableAR",
type:"json"},plannerPath:{func:"readPlanner",type:"json"},configuratorPath:{func:"readConfigurator",type:"arraybuffer"},presetsPath:{func:"readPresets",type:"arraybuffer"},annotationsPath:{func:"readAnnotations",type:"arraybuffer"},fallbackPath:{func:"readFallback",type:"arraybuffer"},productBlueprintFile:{func:"readProductBlueprint",type:"json"},productBlueprintRulesFile:{func:"readProductBlueprintRules",type:"json"},productConfigFile:{func:"readProductConfig",type:"json"},viewPointsLibraryFilePath:{func:"readViewPointsLibrary",
type:"json"},viewerSettingsFilePath:{func:"readViewerSettings",type:"json"},translationsPaths:{func:"readTranslations",type:"json"}},g=[],h;for(h in f)if(b[h])switch(stage.typeOf(b[h])){case "string":""!==b[h]&&(++this.downloadCount,g.push(stage.setContext(this.apiCore.exec,this.apiCore,this.callerName,"dlm.get",b[h],f[h].type,stage.setContext(e,this,d,f[h].func),stage.setContext(n,this,d,h),function(){},this.useCache)));break;case "array":for(var l=0;l<b[h].length;++l)++this.downloadCount,g.push(stage.setContext(this.apiCore.exec,
this.apiCore,this.callerName,"dlm.get",b[h][l],f[h].type,stage.setContext(e,this,d,f[h].func),stage.setContext(n,this,d,h),function(){},this.useCache))}this.apiCore.exec(this.callerName,"dlm.get",b.projectPath,"arraybuffer",stage.setContext(function(b,d,e,f){this.apiCore.exec(this.callerName,"scps.readProjectScene",b,f);if(this.downloadCount)for(b=0;b<g.length;++b)g[b]();else F.call(this,b)},this,d,b),stage.setContext(n,this,d,"project scene"),function(){},this.useCache)},F=function(b){b.projectConfigurationPath&&
""!=b.projectConfigurationPath?this.apiCore.exec(this.callerName,"dlm.get",b.projectConfigurationPath,"text",stage.setContext(p,this,b),stage.setContext(n,this,b,"project default scene"),function(){},this.useCache):this.apiCore.exec(this.callerName,"dlm.get",b.projectDefaultGraphPath,"text",stage.setContext(p,this,b),stage.setContext(n,this,b,"project default scene"),function(){},this.useCache)},p=function(b,d,e){this.defaultConfiguration=e;d=b.getProjectsFromConfiguration(e);d.length?l.call(this,
b,d,stage.setContext(function(d){if(d.length){this.projectsToLoad+=d.length;for(var e=0;e<d.length;++e)U.call(this,d[e],b,stage.setContext(function(){--this.projectsToLoad||m.call(this,b)},this),stage.setContext(n,this,b,"other project"))}else m.call(this,b)},this),stage.setContext(n,this,b,"other project")):m.call(this,b,e)},m=function(b){if("object"!=stage.typeOf(this.defaultConfiguration)||b.validateModularConfiguration(this.defaultConfiguration)){try{this.apiCore.exec(this.callerName,"scps.readProjectDefaultScene",
b,this.defaultConfiguration)}catch(ia){""!==b.projectConfigurationPath?(b.projectConfigurationPath="",F.call(this,b)):n.call(this,b,"other project");return}b.loadedCallback?(this.currentlyLoading=!1,b.loadedCallback(b),delete b.loadedCallback):this.apiCore.exec(this.callerName,"init.sceneBaseLoaded",b)}else b.projectConfigurationPath="",F.call(this,b)},h=function(b,d,e){e=void 0===e?"text/javascript":e;var f=document.getElementsByTagName("head")[0],g=document.createElement("script");g.type=e;g.src=
b;null!==d&&(g.onload=d);f.appendChild(g)},v={},I=function(b){"object"!==typeof WebAssembly||"js"==v.type?h("https://cdn.emersya.com/f/vendors/js/41cc2b2287963f90.js",stage.setContext(J,this,b,!1)):h("https://cdn.emersya.com/f/vendors/wasm/41cc2b2287963f90_wrapper.js",stage.setContext(J,this,b,!0))},J=function(b,d){var e=this;DracoDecoderModule({}).then(function(d){b(d)},function(f){console.error(f);d?h("https://cdn.emersya.com/f/vendors/js/41cc2b2287963f90.js",stage.setContext(J,e,b,!1)):console.error("Failed to create module from fallback javascript!")})},
M=function(b,d,e){var f=0;!this.hasDracoModule&&b&&(++f,I.call(this,stage.setContext(function(b){this.apiCore.exec(this.callerName,"scps.setCompressionDecoderModule",b);this.hasDracoModule=!0;!--f&&e&&e()},this)));!this.hasArModule&&d&&("V1"==d?(++f,h("https://cdn.emersya.com/f/vendors/js/ltsxfh98pqw4x76e.js",stage.setContext(function(){this.hasArModule=!0;!--f&&e&&e()},this))):"V2"==d?(++f,h("https://cdn.emersya.com/f/vendors/js/tbwxuwnilgorcuuw.js",stage.setContext(function(){this.hasArModule=!0;
!--f&&e&&e()},this))):"shoes"==d&&(++f,h("https://cdn.emersya.com/f/vendors/js/8dc65b9d25dcaea/c2794f838ea55bc8.js",stage.setContext(function(){this.hasArModule=!0;!--f&&e&&e()},this),"module")));!f&&e&&e()},T=function(b,d){this.loadToGl=this.loadToGl||(this.apiCore.exec(this.callerName,"rdr.getWebGLContext")?d:!1);var e=b.getAllSourceModelsNotDownloadedYet(),f={},h=d=0,k;for(k in e)h+=e[k].fileSize;if("firefox"===stage.browser.navigator.toLowerCase())for(k in e)d+=e[k].fileSize;else for(k in e)d+=
e[k].uncompressedFileSize;this.loadToGl&&b.texturesManager.setGlContext(this.apiCore.exec(this.callerName,"rdr.getWebGLContext"));b.setDefaultLights&&this.apiCore.exec(this.callerName,"setDefaultLights",b);b.materialsType&&!b.dfglut&&this.isIos&&(stage.browser.navigator.toLowerCase(),d+=1048580);b.updateSceneNodes();var l=b.texturesManager.updateStartingRequirements();this.downloadCount=e.length;this.filesDownloaded=0;g.call(this,d+l,h+l);var m=function(d,e,g){d?(this.apiCore.exec(this.callerName,
"scps.readDFGLUT",b,g,d),this.dfglut=b.dfglut):(b.setParentFromInstance(f[e]),this.apiCore.exec(this.callerName,"scps.readModelGeometries",b,g),f[e].downloaded=!0);++this.filesDownloaded===this.downloadCount&&L.call(this,b)};d=!1;for(k in e)d|=0!==e[k].geometryCompression;M.call(this,d,b.wearableAR&&b.wearableAR.enabled&&b.wearableAR.detectionModel,stage.setContext(function(){for(var d in e)f[e[d].realFilePath]=e[d],this.apiCore.exec(this.callerName,"dlm.get",e[d].realFilePath,"arraybuffer",stage.setContext(m,
this,!1),stage.setContext(n,this,b,"project model"),stage.setContext(t,this),!0)},this));b.materialsType&&!b.dfglut&&this.isIos&&(++this.downloadCount,this.apiCore.exec(this.callerName,"dlm.get",this.settings.dataPath+"../textures/defaultEnvironment/dfglutfull2.bin","arraybuffer",stage.setContext(m,this,!0),stage.setContext(n,this,b,"dfglut"),stage.setContext(t,this),this.useCache));b.hasSomeCarpaint&&!b.dfglutCookTorrance&&(++this.downloadCount,H.call(this,stage.setContext(function(d){b.dfglutCookTorrance=
d;++this.filesDownloaded===this.downloadCount&&L.call(this,b)},this),stage.setContext(n,this,b,"dfglutCookTorrance"),stage.setContext(t,this)));this.downloadCount||L.call(this,b)},U=function(b,d,e,f){var g=b.filePath,h=g.split("/").slice(-2)[0];this.apiCore.exec(this.callerName,"dlm.get",b.filePath,"arraybuffer",stage.setContext(function(d,f,g,k){f.setParent("Project",h);this.apiCore.exec(this.callerName,"scps.readProjectScene",f,k);this.apiCore.exec(this.callerName,"dlm.get",d.replace(".bin","_D"),
"text",stage.setContext(function(d,f,g){var k=this;d.setParent("Project",h);this.apiCore.exec(this.callerName,"scps.readProjectDefaultScene",d,g,!0);var l=0;b.presetsGroupFilePath&&(++l,this.apiCore.exec(this.callerName,"dlm.get",b.presetsGroupFilePath,"arraybuffer",function(b,f){d.setParent("Project",h);k.apiCore.exec(k.callerName,"scps.readPresets",d,f,!0);--l||e()}));b.jsonFilePath&&(++l,this.apiCore.exec(this.callerName,"dlm.get",b.jsonFilePath,"json",function(b,f){d.setParent("Project",h);k.apiCore.exec(k.callerName,
"scps.readProjectJson",d,f);--l||e()},function(){--l||e()}));l||e()},this,f),stage.setContext(n,this,f,"project default scene"),function(){},this.useCache)},this,g,d),f?f:function(){},function(){},!0)},R=function(b,d,e){var f=d.sourceModel;if(f)if(f.downloaded)C.call(this,b,[d],e);else{f.loadedCallbacks.push(stage.setContext(C,this,b,[d],e));var g=function(d,e,f){b.setParentFromInstance(d);this.apiCore.exec(this.callerName,"scps.readModelGeometries",b,f);d.downloaded=!0;d.downloading=!1;for(e=0;e<
d.loadedCallbacks.length;++e)d.loadedCallbacks[e]();d.loadedCallbacks=[]};f.downloading||(f.downloading=!0,M.call(this,0!==f.geometryCompression,!1,stage.setContext(function(){this.apiCore.exec(this.callerName,"dlm.get",f.realFilePath,"arraybuffer",stage.setContext(g,this,f),stage.setContext(n,this,b,"project model"),function(){},this.useCache)},this)))}else e()},aa=function(b,d,e){for(var f=!1,g=[],h={},k=[],l=0;l<d.length;++l){var m=d[l];m.sourceModel&&(f=!0,-1===g.indexOf(m.sourceModel)&&(g.push(m.sourceModel),
h[m.sourceModel.realFilePath]=m.sourceModel,k.push(m)))}if(f)if(g.length){var p=g.length,q=stage.setContext(function(){--p||C.call(this,b,k,e)},this),t=function(d,e,f){b.setParentFromInstance(d);this.apiCore.exec(this.callerName,"scps.readModelGeometries",b,f);h[e].downloaded=!0;h[e].downloading=!1;for(d=0;d<h[e].loadedCallbacks.length;++d)h[e].loadedCallbacks[d]()};d=!1;for(l in g)d|=0!==g[l].geometryCompression;M.call(this,d,!1,stage.setContext(function(){for(var d=0;d<g.length;++d){var e=g[d];
e.downloaded?q():(e.loadedCallbacks.push(q),e.downloading||(e.downloading=!0,this.apiCore.exec(this.callerName,"dlm.get",e.realFilePath,"arraybuffer",stage.setContext(t,this,e),stage.setContext(n,this,b,"project model"),function(){},this.useCache)))}},this))}else C.call(this,b,k,e);else e()},C=function(b,d,e){for(var f={},g=new Set,h=0;h<d.length;++h){var k=d[h];for(n in k.associations){var l=k.associations[n];f[l]||(f[l]={materialTree:b.getFromInstanceParent(k,"MaterialTree",l),polylists:[]});f[l].polylists.push(b.getFromInstanceParent(k,
"Polylist",n));g.add(b.getFromInstanceParent(k,"Polylist",n))}}if(g.size){var m=0;d=stage.setContext(function(b){--m||b()},this,e);h=[];for(l in f){k=b.materials[f[l].materialTree.currentMaterialId];for(var p in f[l].polylists){var n=f[l].polylists[p];if(g.has(n))if(n.instances.length)for(var q in n.instances)h.push(b.fillMaterialNoTextureInstance({onload:d},k,n.customMaterial,n.instances[q].customMaterial));else h.push(b.fillMaterialNoTextureInstance({onload:d},k,n.customMaterial))}}h.length?(m=
h.length,b.texturesManager.downloadMaterials(h)):e()}else e()},L=function(b){b.prepareScene();this.apiCore.exec(this.callerName,"updateSceneCustomTextures",!0,stage.setContext(function(){b.texturesManager.eventsManager.listen(this,"onProgress",t);b.texturesManager.eventsManager.listen(this,"onImageDownloadError",r);b.texturesManager.eventsManager.listen(this,"startingTexturesReady",K);b.texturesManager.eventsManager.listen(this,"failedImages",f);b.texturesManager.loadStartingTextures(this.useCache,
this.loadToGl);this.loadToGl&&!b.loadedToGl&&(this.apiCore.exec(this.callerName,"rdr.initSceneBuffers",b),this.apiCore.exec(this.callerName,"rdr.updateSceneMaterials",b),this.apiCore.exec(this.callerName,"rdr.updateSceneLights",b),this.apiCore.exec(this.callerName,"rdr.updateShaders",b),b.loadedToGl=!0);this.sceneBaseReady=!0},this))},K=function(b){b.texturesManager.eventsManager.detachEvent("startingTexturesReady",K);b.texturesManager.eventsManager.detachEvent("onProgress",t);b.texturesManager.eventsManager.detachEvent("onImageDownloadError",
r);b.texturesManager.eventsManager.detachEvent("failedImages",f);this.currentlyLoading=!1;this.waiting&&(this.waiting.remove(),this.waiting=null);this.sceneTexturesReady=!0;this.loadToGl?b.loaded||(b.loaded=!0,b.loadedCallback?(b.loadedCallback(b),delete b.loadedCallback):this.apiCore.exec(this.callerName,"init.sceneLoaded",b)):this.apiCore.exec(this.callerName,"init.scenePreloaded",b)},G=function(b){if(this.lastLoadCall){this.waiting=stage.emersya.ui.waiting();var d=[].concat(this.lastLoadCall.args);
b&&d.push(b);this.lastLoadCall.func.apply(this,d)}else b&&b()},S=function(b,d){this.loadToGl=void 0!==d?d:!this.loadToGl;b&&this.loadToGl&&(b.texturesManager.setGlContext(this.apiCore.exec(this.callerName,"rdr.getWebGLContext")),setTimeout(stage.setContext(function(){this.sceneBaseReady&&(this.sceneTexturesReady&&b.texturesManager.loadStartingTexturesToGl(),b.loadedToGl||(b.loadedToGl=!0,this.apiCore.exec(this.callerName,"rdr.initSceneBuffers",b),this.apiCore.exec(this.callerName,"rdr.updateSceneMaterials",
b),this.apiCore.exec(this.callerName,"rdr.updateSceneLights",b),this.apiCore.exec(this.callerName,"rdr.updateShaders",b)),this.sceneTexturesReady&&!b.loaded&&(b.loaded=!0,b.loadedCallback?(b.loadedCallback(b),delete b.loadedCallback):this.apiCore.exec(this.callerName,"init.sceneLoaded",b)))},this),1))};return d});stage.provide("emersya.viewer.modules.animationControls");stage.require("emersya.viewer.modules.API.core");
stage.register.call(stage.emersya.viewer.modules,"animationControls",function(){var b={},d=function(d,f){this.settings=stage.extend(!0,{},b,f);this.apiCore=d;this.name="AnimationControls";this.callerName="Animations";this.animationsDataUpdates=!0;this.animationsToUpdate=[];this.apiCore.register(this,"setAnimations",q);this.apiCore.register(this,"resetAnimations",g);this.apiCore.register(this,"triggerAnimation",t,!0);this.apiCore.register(this,"deltaTUpdate",u);this.apiCore.register(this,"presetApplied",
B);this.apiCore.register(this,"toggleAnimationsDataUpdates",l)};d.prototype.destroy=function(){this.apiCore.unregister(this,"setAnimations");this.apiCore.unregister(this,"resetAnimations");this.apiCore.unregister(this,"triggerAnimation");this.apiCore.unregister(this,"deltaTUpdate");this.apiCore.unregister(this,"presetApplied");this.apiCore.unregister(this,"toggleAnimationsDataUpdates")};var u=function(b){if(this.animationsToUpdate.length){var d=[].concat(this.animationsToUpdate);this.animationsToUpdate=
[];for(var e in d){var f=d[e];f.remainingTime-=b;0>=f.remainingTime?(f.anim.currentState=f.finalState,f.callback&&f.callback(),this.apiCore.exec(this.callerName,"onEndAnimation",f.anim.setName,f.finalState,b+f.remainingTime)):this.animationsToUpdate.push(f)}}},k=function(b){var d=b.states[b.stateToLoad],e=b.states.INITIAL;if(!d||!e)return[];for(var f in b.states){var g=b.states[f];g.dijkstraWeight=2E8;g.dijkstraFrom="";g.seen=!1;for(var k in g.animations){var l=g.animations[k];l.dijkstraWeight=1}}e.dijkstraWeight=
0;g=e;for(var h=null;g!==d;){if(!g)return[];g.seen=!0;for(f in g.animations){l=g.animations[f];l.originState=g.name;var n=b.states[l.finalState];!n.seen&&g.dijkstraWeight+l.dijkstraWeight<n.dijkstraWeight&&(n.dijkstraWeight=g.dijkstraWeight+l.dijkstraWeight,n.dijkstraFrom=l,!h||n.dijkstraWeight<h.dijkstraWeight)&&(h=n)}if(g==h)for(f in l=2E10,b.states)g=b.states[f],!g.seen&&g.dijkstraWeight<l&&(l=g.dijkstraWeight,h=g);g=h}if(!d.dijkstraFrom)return[];g=d;for(d=[];g!==e;)d.unshift(stage.extend(!0,{},
g.dijkstraFrom)),g=b.states[g.dijkstraFrom.originState];for(f in b.states)for(k in g=b.states[f],delete g.dijkstraWeight,delete g.dijkstraFrom,delete g.seen,g.animations)l=g.animations[k],delete l.dijkstraWeight;return d},l=function(b){this.animationsDataUpdates=void 0!==b?b:!this.animationsDataUpdates},g=function(){if(this.animationsDataUpdates){var b=this.apiCore.exec(this.callerName,"rdr.getCurrentScene");b&&b.viewerAnimations&&b.viewerAnimations.length&&(this.apiCore.exec(this.callerName,"setAnimations"),
this.apiCore.exec(this.callerName,"onEndAnimation"),b.prepareScene(),this.apiCore.exec(this.callerName,"rdr.updateSceneMaterials",b),this.apiCore.exec(this.callerName,"rdr.updateShaders",b),this.apiCore.exec(this.callerName,"rdr.forceUpdate",10))}},q=function(b,d,e,g){b||(b=this.apiCore.exec(this.callerName,"rdr.getCurrentScene"));if(b&&this.animationsDataUpdates){d=d?d.animations:b.animations;var l=[].concat(this.animationsToUpdate);this.animationsToUpdate=[];for(var p in l){var m=l[p];m.callback&&
m.callback()}b.viewerAnimations&&b.viewerAnimations.length&&(b.resetNodesAnimations(),b.resetMaterialsAnimations(),this.apiCore.exec(this.callerName,"stopAnimatingPath",!0),b.visibilityChanged=!0);b.viewerAnimations=[];b.manualViewerAnimations={};for(p in d)if("manual"===d[p].type){d[p].progression=0;for(var h in d[p].actions)b.manualViewerAnimations[d[p].actions[h].polylist]={action:d[p].actions[h],anims:d[p].states[0].animations,anim:d[p]};for(h in d[p].states[0].animations)for(var n in d[p].states[0].animations[h].nodes){var q=
d[p].states[0].animations[h].nodes[n];b.setNodeManualAnimations(q.id,q.localId,q.animations)}}else for(h in b.viewerAnimations[p]={setName:d[p].name,currentState:"INITIAL",states:{},cyclic:d[p].cyclic,autoStart:"automatic"===d[p].autoStart,stateToLoad:b.animationStatesToLoad[d[p].name]?b.animationStatesToLoad[d[p].name]:void 0!==d[p].stateToLoad&&""!==d[p].stateToLoad?d[p].stateToLoad:"INITIAL"},d[p].states)b.viewerAnimations[p].states[d[p].states[h].name]=d[p].states[h];var t=[];d=[];for(p in b.viewerAnimations)if(l=
b.viewerAnimations[p],l.cyclic){if(!e)for(h in l.states[l.currentState].animations)l.states[l.currentState].animations[h].autoStart=l.autoStart,w.call(this,b,l.states[l.currentState].animations[h])}else if(l.stateToLoad!==l.currentState&&"customWatch"!==l.setName&&(m=k(l),m.length)){for(var r={adjustedTime:0,totalTime:0,nodes:[],materials:[],cameraPath:[],finalState:l.stateToLoad},u=m.length-1;0<=u;--u){var A=m[u];for(h in A.nodes){q=A.nodes[h];for(n in q.animations)q.animations[n].time=q.animations[n].duration=
q.animations[n].adjustedTime=0;var B=!1;for(n in r.nodes){var E=r.nodes[n];if(q.id==E.id){B=!0;E.animations=q.animations.concat(E.animations);break}}B||r.nodes.push(q)}for(h in A.materials)if(q=A.materials[h],q.animations.length){q.animations=[q.animations[q.animations.length-1]];q.animations[0].time=q.animations[0].duration=q.animations[0].adjustedTime=0;B=!1;for(n in r.materials)if(E=r.materials[n],q.material_tree==E.material_tree){B=!0;E.animations=q.animations.concat(E.animations);break}B||r.materials.push(q)}}d.push({set:l,
transition:r})}for(p in b.triggers)for(h in l=b.triggers[p],l.inUse=!1,b.viewerAnimations)for(n in m=b.viewerAnimations[h],m.states)for(u in r=m.states[n],r.animations)if(r.animations[u].triggerId==l.id){l.inUse=!0;break}var D=stage.setContext(function(){var d=[],g;for(g in b.viewerAnimations){var h=b.viewerAnimations[g];if(!h.cyclic&&h.autoStart&&h.currentState===h.stateToLoad&&!e){for(var k in h.states[h.currentState].animations){d.push({set:h,transition:h.states[h.currentState].animations[k]});
break}t.push(h)}}d.length&&f.call(this,b,d);t.length&&this.apiCore.exec(this.callerName,"animationsTriggered",t,stage.emersya.viewer.ANIMATIONS_TRIGGERS.AUTO)},this);if(d.length)if(f.call(this,b,d),!g&&this.animationsToUpdate.length)for(p=this.animationsToUpdate.length-1;0<=p;p--){if(!this.animationsToUpdate[p].remainingTime){this.animationsToUpdate[p].callback=stage.setContext(function(b){b.stopDraw--;this.apiCore.exec(this.callerName,"forceRender");D()},this,b);b.stopDraw++;this.apiCore.exec(this.callerName,
"setNextDeltaT",1);break}}else D();else D()}},t=function(b,d,e){var g=[],k=[],l;for(l in b.viewerAnimations){var m=b.viewerAnimations[l];if("ANIMATING"!==m.currentState&&m.states[m.currentState])if(m.cyclic)for(var h in m.states[m.currentState].animations){var q=m.states[m.currentState].animations[h];q.triggerId==d&&n(b,q)}else for(h in m.states[m.currentState].animations)if(q=m.states[m.currentState].animations[h],q.triggerId==d){m.cpt=0;k.push({set:m,transition:q});m.previousState=m.currentState;
m.currentState="ANIMATING";m.animatingTo=q.finalState;g.push(m);break}}k.length&&(f.call(this,b,k),this.apiCore.exec(this.callerName,"animationsTriggered",g,e));return g},r=function(b,d,e){this.apiCore.exec(this.callerName,"onStartAnimation");this.apiCore.exec(this.callerName,"disableForceRender");d.nodes.length&&D.call(this,b,d,e);if(d.materials&&d.materials.length){for(var f in d.materials)b.setMaterialTreeAnimations(d.materials[f]);this.apiCore.exec(this.callerName,"rdr.updateSceneMaterials",b);
this.apiCore.exec(this.callerName,"rdr.updateShaders",b);this.apiCore.exec(this.callerName,"rdr.forceUpdate",10);this.apiCore.exec(this.callerName,"ignoreNextFrames")}if(d.cameraPath.length&&!this.apiCore.exec(this.callerName,"getArActive")){b=[];for(f in d.cameraPath){var g=d.cameraPath[f];g.adjustedTime||(g.adjustedTime=g.time);if(isNaN(g.position_x)||isNaN(g.position_y)||isNaN(g.position_z)||isNaN(g.target_x)||isNaN(g.target_y)||isNaN(g.target_z)||isNaN(g.up_x)||isNaN(g.up_y)||isNaN(g.up_z)||isNaN(g.adjustedTime))g.empty=
!0,isNaN(g.adjustedTime)&&(g.adjustedTime=0);g.camControl&&g.camControl.targetAxes_x&&(g.camControl.targetAxes=[g.camControl.targetAxes_x,g.camControl.targetAxes_y,g.camControl.targetAxes_z]);b.push({empty:g.empty,position:[g.position_x,g.position_y,g.position_z],target:[g.target_x,g.target_y,g.target_z],up:[g.up_x,g.up_y,g.up_z],fov:0<g.fov&&120>g.fov?g.fov:void 0,accelerationType:g.accelerationType,reversed:g.reversed,accelerationExponent:g.accelerationExponent,camControl:g.camControl,t:g.adjustedTime})}++e.cpt;
this.apiCore.exec(this.callerName,"stopAnimatingPath",!0);this.apiCore.exec(this.callerName,"startAnimatingPath",b,!1,!d.stoppable,stage.setContext(function(b,d){this.apiCore.exec(this.callerName,"cameraAnimationEnd",this.apiCore.exec(this.callerName,"getCamera"))},this,d.finalState,e))}this.animationsToUpdate.push({remainingTime:void 0!==d.adjustedTime?d.adjustedTime:d.totalTime,finalState:d.finalState,anim:e});this.apiCore.exec(this.callerName,"enableForceRender")},f=function(b,d){for(var e=[],
f=0;f<d.length;++f)e=e.concat(d[f].transition.materials);if(e.length){this.apiCore.exec(this.callerName,"beginViewerAnimationTransaction",stage.setContext(function(b,d){for(var e=0;e<d.length;++e)r.call(this,b,d[e].transition,d[e].set)},this,b,d),stage.setContext(function(b){for(b=0;b<d.length;++b)d[b].set.currentState=d[b].set.previousState},this,d));for(f in e){b=e[f];b.mtIds=[];for(var g in b.animations)b.animations[g].empty||(b.mtIds=b.material_tree?b.mtIds.concat(this.apiCore.exec(this.callerName,
"updateMaterialTreeByName",b.material_tree,b.animations[g].material_settings,[])):b.mtIds.concat(this.apiCore.exec(this.callerName,"updateMaterialTreeByPolylistName",b.polylist,b.animations[g].material_settings)));b.mtIds=stage.array.uniq(b.mtIds)}f;this.apiCore.exec(this.callerName,"endTransaction")}else for(f=0;f<d.length;++f)r.call(this,b,d[f].transition,d[f].set)},n=function(b,d){for(var e in d.nodes)b.toggleNodeAnimations(parseInt(d.nodes[e].id),parseInt(d.nodes[e].localId));for(e in d.materials)b.toggleMaterialAnimations(d.materials[e])},
B=function(){var b=this.apiCore.exec(this.callerName,"rdr.getCurrentScene"),d;for(d in b.viewerAnimations){var e=b.viewerAnimations[d];if(e.cyclic)for(var f in e.states[e.currentState].animations)e.states[e.currentState].animations[f].autoStart=e.autoStart,w.call(this,b,e.states[e.currentState].animations[f])}},w=function(b,d){this.apiCore.exec(this.callerName,"beginViewerAnimationTransaction",stage.setContext(function(d){for(var e in d.materials)b.setMaterialTreeAnimations(d.materials[e]);for(e in d.nodes)b.setNodeAnimations(d.nodes[e].id,
d.nodes[e].localId,d.nodes[e].animations,function(){},!0);this.apiCore.exec(this.callerName,"rdr.updateSceneMaterials",b);this.apiCore.exec(this.callerName,"rdr.updateShaders",b);this.apiCore.exec(this.callerName,"rdr.forceUpdate",10);n(b,d);d.autoStart||n(b,d);this.apiCore.exec(this.callerName,"rdr.toggleNodeAnimations",!0)},this,d),stage.setContext(function(b){console.log("Error while loading cyclic material animations.",b)},this,d));for(var e in d.materials){var f=d.materials[e];f.mtIds=[];for(var g in f.animations)f.animations[g].empty||
(f.mtIds=f.material_tree?f.mtIds.concat(this.apiCore.exec(this.callerName,"updateMaterialTreeByName",f.material_tree,f.animations[g].material_settings,[])):f.mtIds.concat(this.apiCore.exec(this.callerName,"updateMaterialTreeByPolylistName",f.polylist,f.animations[g].material_settings)));f.mtIds=stage.array.uniq(f.mtIds)}this.apiCore.exec(this.callerName,"endTransaction")},D=function(b,d,e){this.apiCore.exec(this.callerName,"rdr.toggleNodeAnimations",!1);e.cpt+=d.nodes.length;e=stage.setContext(function(b,
d){--b.cpt||(this.apiCore.exec(this.callerName,"onEndNodeAnimation"),this.apiCore.exec(this.callerName,"rdr.forceUpdate",10))},this,e,d.finalState);for(var f in d.nodes)b.setNodeAnimations(d.nodes[f].id,d.nodes[f].localId,d.nodes[f].animations,e);this.apiCore.exec(this.callerName,"rdr.toggleNodeAnimations",!0)};return d});stage.provide("emersya.viewer.modules.sceneModifier");stage.require("emersya.viewer.modules.API.core");
stage.register.call(stage.emersya.viewer.modules,"sceneModifier",function(){var b={},d=function(d,h){this.settings=stage.extend(!0,{},b,h);this.apiCore=d;this.scene=null;this.callerName=this.name="SceneModifier";this.apiCore.register(this,"createTextureFromDB",J,!0);this.apiCore.register(this,"createTextureCubeFromDB",M,!0);this.apiCore.register(this,"setMaterial",g);this.apiCore.register(this,"setMaterialTree",q);this.apiCore.register(this,"updatePolylist",A);this.apiCore.register(this,"updateMaterialTreeSettings",
t);this.apiCore.register(this,"updateProductNode",f);this.apiCore.register(this,"updateSceneGraph",B);this.apiCore.register(this,"updateSceneGraphWithProductNode",n);this.apiCore.register(this,"updateProductNodeSourceModel",w);this.apiCore.register(this,"updateModelSceneGraph",D);this.apiCore.register(this,"setSceneBase",u);this.apiCore.register(this,"setScene",u);this.apiCore.register(this,"setViewPoints",k);this.apiCore.register(this,"setViewPointsModelReferenceBoundingBox",l);this.apiCore.register(this,
"updateGlobalUVTransformDirtness",r);this.apiCore.register(this,"duplicatePolylist",H,!0);this.apiCore.register(this,"removePolylist",e);this.apiCore.register(this,"setWearableArData",E);this.apiCore.register(this,"updatePresets",F)};d.prototype.destroy=function(){this.apiCore.unregister(this,"createTextureFromDB");this.apiCore.unregister(this,"createTextureCubeFromDB");this.apiCore.unregister(this,"setMaterial");this.apiCore.unregister(this,"setMaterialTree");this.apiCore.unregister(this,"updatePolylist");
this.apiCore.unregister(this,"updateMaterialTreeSettings");this.apiCore.unregister(this,"updateProductNode");this.apiCore.unregister(this,"updateSceneGraph");this.apiCore.unregister(this,"updateSceneGraphWithProductNode");this.apiCore.unregister(this,"updateProductNodeSourceModel");this.apiCore.unregister(this,"updateModelSceneGraph");this.apiCore.unregister(this,"setSceneBase");this.apiCore.unregister(this,"setScene");this.apiCore.unregister(this,"setViewPoints");this.apiCore.unregister(this,"setViewPointsModelReferenceBoundingBox");
this.apiCore.unregister(this,"updateGlobalUVTransformDirtness");this.apiCore.unregister(this,"duplicatePolylist");this.apiCore.unregister(this,"removePolylist");this.apiCore.unregister(this,"setWearableArData");this.apiCore.unregister(this,"updatePresets")};var u=function(b){this.scene=b},k=function(b){this.scene.viewPoints=b;for(b=0;b<this.scene.viewPoints.length;++b){var d=this.scene.viewPoints[b];d.tagsSet=d.tags?this.apiCore.exec(this.callerName,"lib.convertStringsToSet",d.tags):new Set}},l=function(b){this.scene.viewPointsModelReferenceBoundingBox=
b},g=function(b){if(!this.scene)console.error("No scene to modify in sceneModifier.");else if(b){var d=this.scene.get("Material",b.id),e={id:d?d.id:b.id,name:b.name,type:b.type?1:0,polylists:d?d.polylists:[]};d||(e=this.scene.register("Material",e));b.type?(e.uvTransform=I.call(this,b.uv_transform),e.albedo=ea.call(this,b.albedo),e.roughness=oa.call(this,b.roughness),e.metalness=ba.call(this,b.metalness),e.normalDeformation=ka.call(this,b.normal_deformation),e.emissive=Z.call(this,b.emissive),e.occlusion=
da.call(this,b.occlusion),e.opacity=X.call(this,b.opacity),e.translucency=Ha.call(this,b.translucency),e.iridescence=Fa.call(this,b.iridescence),e.localEnvironment=Ga.call(this,b.local_environment),e.anisotropy=xa.call(this,b.anisotropy),e.carpaint=Ia.call(this,b.carpaint),e.refraction=qa.call(this,b.refraction),e.coating=va.call(this,b.coating),e.emissive&&e.emissive.glow&&(e.glow=e.emissive.glow)):(e.name=b.name,e.uvTransform=I.call(this,b.uv_transform),e.newShaderType=b.new_shader_type,e.lightMap=
T.call(this,b.light_map),e.opacity=U.call(this,b.opacity),e.refraction=R.call(this,b.refraction),e.translucency=aa.call(this,b.translucency),e.specularAnisotropic=C.call(this,b.specular_anisotropic),e.normalDeformation=L.call(this,b.normal_deformation),e.shininess=K.call(this,b.shininess),e.reflection=G.call(this,b.reflection),e.emissive=S.call(this,b.emissive),e.glow=Y.call(this,b.glow),e.iridescent=ia.call(this,b.iridescent),e.specular=Q.call(this,b.specular),e.diffuse=ta.call(this,b.diffuse),e.ambient=
ua.call(this,b.ambient),b.glow&&d&&!d.glow&&(d.glow={id:0,color:[0,0,0],size:1,opacity:0,saturation:1,texture:null},this.apiCore.exec(this.callerName,"rdr.updateSceneMaterials",this.scene),this.apiCore.exec(this.callerName,"rdr.updateShaders",this.scene)));this.scene.get("MaterialTree",b.id)||(b=this.scene.register("MaterialTree",{id:b.id,name:e.name,uvTransform:e.uvTransform,polylistInstances:[],newShaderType:e.newShaderType,highlighted:!1,currentMaterialId:e.id}),this.scene.materialsContent.materialSettingsByName[b.id]=
{},this.scene.materialsContent.materialSettingsByName[b.id][e.name]=e);d=stage.setContext(function(b,d,e){if(!--b.cnt){b=[].concat(d.polylists);for(var f in b)b[f].matAnim.resetMaterial(e);this.scene.materials[e.id]=e;this.apiCore.exec(this.callerName,"rdr.updateSceneMaterials",this.scene);this.apiCore.exec(this.callerName,"rdr.updateSceneLights",this.scene);this.apiCore.exec(this.callerName,"rdr.updateShaders",this.scene);--this.scene.stopDraw}},this,{cnt:e.polylists.length},d,e);b=stage.setContext(function(){--this.scene.stopDraw},
this);for(var f=[],g=0;g<e.polylists.length;++g){var h=e.polylists[g],k={onload:d,onerror:b};this.scene.fillMaterialNoTextureInstance(k,e,h.polylist.customMaterial,h.customMaterial);f.push(k)}f.length?(++this.scene.stopDraw,this.scene.texturesManager.downloadMaterials(f)):this.scene.update()}},q=function(b,d){if(this.scene){this.scene.materialTrees[b.id]?(this.scene.materialTrees[b.id].defaultMaterialId=b.default_material_settings.id,this.scene.materialTrees[b.id].name=b.name,this.scene.materialTrees[b.id].uvTransform=
I.call(this,b.uv_transform),this.scene.materialTrees[b.id].fromModel=!1):(this.scene.materialTrees[b.id]={id:b.id,name:b.name,uvTransform:I.call(this,b.uv_transform),polylistInstances:[],polylistMinId:2E12,highlighted:!1,currentMaterialId:b.default_material_settings.id,defaultMaterialId:b.default_material_settings.id},this.scene.materialsContent.materialSettingsByName[b.id]={});this.scene.materialsContent.materialSettingsByName[b.id]={};if(this.scene.materialsType){for(var e=this.scene.materialTrees[b.id],
f=[this.scene.materialTrees[b.id]],g=[],h=0;h<b.local_environment_level.length;++h){for(var k={levelId:b.local_environment_level[h].id,content:b.local_environment_level[h].local_environment?Ga.call(this,b.local_environment_level[h].local_environment):null},l=b.local_environment_level[h],m=f.concat([k]),p=[],n=0;n<l.occlusion_level.length;++n){for(var q={levelId:l.occlusion_level[n].id,content:l.occlusion_level[n].occlusion?da.call(this,l.occlusion_level[n].occlusion):null},t=l.occlusion_level[n],
r=m.concat([q]),u=[],v=0;v<t.translucency_level.length;++v){for(var w={levelId:t.translucency_level[v].id,content:t.translucency_level[v].translucency?Ha.call(this,t.translucency_level[v].translucency):null},P=t.translucency_level[v],A=r.concat([w]),B=[],D=0;D<P.opacity_level.length;++D){for(var E={levelId:P.opacity_level[D].id,content:P.opacity_level[D].opacity?X.call(this,P.opacity_level[D].opacity):null},F=P.opacity_level[D],H=A.concat([E]),N=[],za=0;za<F.coating_level.length;++za){for(var ca=
{levelId:F.coating_level[za].id,content:F.coating_level[za].coating?va.call(this,F.coating_level[za].coating):null},Ea=F.coating_level[za],Ca=H.concat([ca]),Ua=[],J=0;J<Ea.normal_deformation_level.length;++J){for(var na={levelId:Ea.normal_deformation_level[J].id,content:Ea.normal_deformation_level[J].normal_deformation?ka.call(this,Ea.normal_deformation_level[J].normal_deformation):null},Ba=Ea.normal_deformation_level[J],Da=Ca.concat([na]),xa=[],M=0;M<Ba.metalness_level.length;++M){for(var V={levelId:Ba.metalness_level[M].id,
content:Ba.metalness_level[M].metalness?ba.call(this,Ba.metalness_level[M].metalness):null},O=Ba.metalness_level[M],ja=Da.concat([V]),W=[],pa=0;pa<O.roughness_level.length;++pa){for(var Pa={levelId:O.roughness_level[pa].id,content:O.roughness_level[pa].roughness?oa.call(this,O.roughness_level[pa].roughness):null},ha=O.roughness_level[pa],ya=ja.concat([Pa]),zb=[],cb=0;cb<ha.iridescence_level.length;++cb){for(var Ia={levelId:ha.iridescence_level[cb].id,content:ha.iridescence_level[cb].iridescence?Fa.call(this,
ha.iridescence_level[cb].iridescence):null},qa=ha.iridescence_level[cb],Va=ya.concat([Ia]),fa=[],la=0;la<qa.emissive_level.length;++la){for(var Xb={levelId:qa.emissive_level[la].id,content:qa.emissive_level[la].emissive?Z.call(this,qa.emissive_level[la].emissive):null},yb=qa.emissive_level[la],Rb=Va.concat([Xb]),Gb=[],ob=0;ob<yb.albedo_level.length;++ob){var Hb={levelId:yb.albedo_level[ob].id,content:yb.albedo_level[ob].albedo?ea.call(this,yb.albedo_level[ob].albedo):null},tc=yb.albedo_level[ob],
pb=Rb.concat([Hb]);this.materialSettingsCpt||(this.materialSettingsCpt=0);var Ab=null!==tc.material_settings.id?tc.material_settings.id:--this.materialSettingsCpt,Bb=this.scene.get("MaterialSettings",Ab);if(Bb)var $a=Bb;else $a={id:Ab},this.scene.register("MaterialSettings",$a);$a.name=tc.material_settings.name;$a.technicalName=tc.material_settings.technicalName;$a.mt=pb.splice(0,1)[0].id;$a.uvTransform=this.scene.materialTrees[$a.mt].uvTransform;this.scene.materialsContent.materialSettingsByName[$a.mt][$a.name]=
$a;var lb=pb[0],ic=pb[1],ac=pb[2],Yb=pb[3],Kc=pb[4],ad=pb[5],oc=pb[6],Cc=pb[7],nd=pb[8],Sc=pb[9],Tc=pb[10],rb=this.scene.get("Material",$a.id);rb?(rb.name=$a.name,rb.technicalName=$a.technicalName,rb.materialTree=this.scene.materialTrees[$a.mt],rb.uvTransform=$a.uvTransform,rb.localEnvironment=lb.content,rb.occlusion=ic.content,rb.translucency=ac.content,rb.opacity=Yb.content,rb.coating=Kc.content,rb.normalDeformation=ad.content,rb.metalness=oc.content,rb.roughness=Cc.content,rb.iridescence=nd.content,
rb.emissive=Sc.content,rb.albedo=Tc.content):this.scene.register("Material",{id:$a.id,name:$a.name,technicalName:$a.technicalName,polylists:[],materialTree:this.scene.materialTrees[$a.mt],uvTransform:$a.uvTransform,type:1,localEnvironment:lb.content,occlusion:ic.content,translucency:ac.content,opacity:Yb.content,coating:Kc.content,normalDeformation:ad.content,metalness:oc.content,roughness:Cc.content,iridescence:nd.content,emissive:Sc.content,albedo:Tc.content});this.scene.materials[$a.id].glow=Sc.content&&
Sc.content.glow?Sc.content.glow:null;this.scene.materials[$a.id].specular=Tc.content&&Tc.content.specular?Tc.content.specular:null;this.scene.materials[$a.id].anisotropy=oc.content&&oc.content.anisotropy?oc.content.anisotropy:null;this.scene.materials[$a.id].carpaint=oc.content&&oc.content.carpaint?oc.content.carpaint:null;this.scene.materials[$a.id].refraction=Yb.content&&Yb.content.refraction?Yb.content.refraction:null;Hb.materialSettings=$a;Gb.push(Hb)}Xb.albedoLevels=Gb;fa.push(Xb)}Ia.emissiveLevels=
fa;zb.push(Ia)}Pa.iridescenceLevels=zb;W.push(Pa)}V.roughnessLevels=W;xa.push(V)}na.metalnessLevels=xa;Ua.push(na)}ca.normalDeformationLevels=Ua;N.push(ca)}E.coatingLevels=N;B.push(E)}w.opacityLevels=B;u.push(w)}q.translucencyLevels=u;p.push(q)}k.occlusionLevels=p;g.push(k)}e.localEnvironmentLevels=g}else{this.scene.materialTrees[b.id].newShaderType=b.new_shader_type;for(var od=this.scene.materialTrees[b.id],Dc=[this.scene.materialTrees[b.id]],Nb=[],Ib=0;Ib<b.light_map_level.length;++Ib){for(var Ob=
{levelId:b.light_map_level[Ib].id,content:b.light_map_level[Ib].light_map?T.call(this,b.light_map_level[Ib].light_map):null},Tb=b.light_map_level[Ib],wc=Dc.concat([Ob]),pd=[],bc=0;bc<Tb.opacity_level.length;++bc){for(var Uc={levelId:Tb.opacity_level[bc].id,content:Tb.opacity_level[bc].opacity?U.call(this,Tb.opacity_level[bc].opacity):null},Lc=Tb.opacity_level[bc],uc=wc.concat([Uc]),Ec=[],Ub=0;Ub<Lc.refraction_level.length;++Ub){for(var sb={levelId:Lc.refraction_level[Ub].id,content:Lc.refraction_level[Ub].refraction?
R.call(this,Lc.refraction_level[Ub].refraction):null},Cb=Lc.refraction_level[Ub],pc=uc.concat([sb]),Pc=[],tb=0;tb<Cb.translucency_level.length;++tb){for(var Hc={levelId:Cb.translucency_level[tb].id,content:Cb.translucency_level[tb].translucency?aa.call(this,Cb.translucency_level[tb].translucency):null},Lb=Cb.translucency_level[tb],Vc=pc.concat([Hc]),vc=[],Ic=0;Ic<Lb.specular_anisotropic_level.length;++Ic){for(var cc={levelId:Lb.specular_anisotropic_level[Ic].id,content:Lb.specular_anisotropic_level[Ic].specular_anisotropic?
C.call(this,Lb.specular_anisotropic_level[Ic].specular_anisotropic):null},Pb=Lb.specular_anisotropic_level[Ic],jc=Vc.concat([cc]),Oc=[],xc=0;xc<Pb.normal_deformation_level.length;++xc){for(var Gc={levelId:Pb.normal_deformation_level[xc].id,content:Pb.normal_deformation_level[xc].normal_deformation?L.call(this,Pb.normal_deformation_level[xc].normal_deformation):null},Fc=Pb.normal_deformation_level[xc],dd=jc.concat([Gc]),Qc=[],fc=0;fc<Fc.shininess_level.length;++fc){for(var vb={levelId:Fc.shininess_level[fc].id,
content:Fc.shininess_level[fc].shininess?K.call(this,Fc.shininess_level[fc].shininess):null},Fb=Fc.shininess_level[fc],kc=dd.concat([vb]),Db=[],gc=0;gc<Fb.reflection_level.length;++gc){for(var hc={levelId:Fb.reflection_level[gc].id,content:Fb.reflection_level[gc].reflection?G.call(this,Fb.reflection_level[gc].reflection):null},rc=Fb.reflection_level[gc],Mb=kc.concat([hc]),Nc=[],mb=0;mb<rc.emissive_level.length;++mb){for(var Jb={levelId:rc.emissive_level[mb].id,content:rc.emissive_level[mb].emissive?
S.call(this,rc.emissive_level[mb].emissive):null},Jc=rc.emissive_level[mb],qd=Mb.concat([Jb]),Mc=[],qc=0;qc<Jc.glow_level.length;++qc){for(var gd={levelId:Jc.glow_level[qc].id,content:Jc.glow_level[qc].glow?Y.call(this,Jc.glow_level[qc].glow):null},lc=Jc.glow_level[qc],rd=qd.concat([gd]),wd=[],sc=0;sc<lc.iridescent_level.length;++sc){for(var hd={levelId:lc.iridescent_level[sc].id,content:lc.iridescent_level[sc].iridescent?ia.call(this,lc.iridescent_level[sc].iridescent):null},yc=lc.iridescent_level[sc],
Kb=rd.concat([hd]),Zb=[],Yc=0;Yc<yc.specular_level.length;++Yc){for(var id={levelId:yc.specular_level[Yc].id,content:yc.specular_level[Yc].specular?Q.call(this,yc.specular_level[Yc].specular):null},Rc=yc.specular_level[Yc],yd=Kb.concat([id]),zd=[],Eb=0;Eb<Rc.diffuse_level.length;++Eb){for(var nb={levelId:Rc.diffuse_level[Eb].id,content:Rc.diffuse_level[Eb].diffuse?ta.call(this,Rc.diffuse_level[Eb].diffuse):null},bd=Rc.diffuse_level[Eb],sd=yd.concat([nb]),Dd=[],Xc=0;Xc<bd.ambient_level.length;++Xc){var td=
{levelId:bd.ambient_level[Xc].id,content:bd.ambient_level[Xc].ambient?ua.call(this,bd.ambient_level[Xc].ambient):null},cd=bd.ambient_level[Xc],Vb=sd.concat([td]);this.materialSettingsCpt||(this.materialSettingsCpt=0);var Wc=null!==cd.material_settings.id?cd.material_settings.id:--this.materialSettingsCpt,fd=this.scene.get("MaterialSettings",Wc);if(fd)var jb=fd;else jb={id:Wc},this.scene.register("MaterialSettings",jb);jb.name=cd.material_settings.name;jb.technicalName=cd.material_settings.technicalName;
jb.mt=Vb.splice(0,1)[0].id;jb.new_shader_type=this.scene.materialTrees[jb.mt].newShaderType;jb.uvTransform=this.scene.materialTrees[jb.mt].uvTransform;this.scene.materialsContent.materialSettingsByName[jb.mt][jb.name]=jb;var Ad=Vb[0],Na=Vb[1],xd=Vb[2],ub=Vb[3],wb=Vb[4],Bd=Vb[5],Wa=Vb[6],zc=Vb[7],mc=Vb[8],jd=Vb[9],Md=Vb[10],kd=Vb[11],ud=Vb[12],Ed=Vb[13],Qb=this.scene.get("Material",jb.id);Qb?(Qb.name=jb.name,Qb.technicalName=jb.technicalName,Qb.uvTransform=jb.uvTransform,Qb.newShaderType=this.scene.materialTrees[jb.mt].newShaderType,
Qb.materialTree=this.scene.materialTrees[jb.mt],Qb.lightMap=Ad.content,Qb.opacity=Na.content,Qb.refraction=xd.content,Qb.translucency=ub.content,Qb.specularAnisotropic=wb.content,Qb.normalDeformation=Bd.content,Qb.shininess=Wa.content,Qb.reflection=zc.content,Qb.emissive=mc.content,Qb.glow=jd.content,Qb.iridescent=Md.content,Qb.specular=kd.content,Qb.diffuse=ud.content,Qb.ambient=Ed.content):this.scene.register("Material",{id:jb.id,name:jb.name,technicalName:jb.technicalName,newShaderType:this.scene.materialTrees[jb.mt].newShaderType,
uvTransform:jb.uvTransform,polylists:[],materialTree:this.scene.materialTrees[jb.mt],type:0,lightMap:Ad.content,opacity:Na.content,refraction:xd.content,translucency:ub.content,specularAnisotropic:wb.content,normalDeformation:Bd.content,shininess:Wa.content,reflection:zc.content,emissive:mc.content,glow:jd.content,iridescent:Md.content,specular:kd.content,diffuse:ud.content,ambient:Ed.content});td.materialSetting=jb;Dd.push(td)}nb.ambientLevels=Dd;zd.push(nb)}id.diffuseLevels=zd;Zb.push(id)}hd.specularLevels=
Zb;wd.push(hd)}gd.iridescentLevels=wd;Mc.push(gd)}Jb.glowLevels=Mc;Nc.push(Jb)}hc.emissiveLevels=Nc;Db.push(hc)}vb.reflectionLevels=Db;Qc.push(vb)}Gc.shininessLevels=Qc;Oc.push(Gc)}cc.normalDeformationLevels=Oc;vc.push(cc)}Hc.specularAnisotropicLevels=vc;Pc.push(Hc)}sb.translucencyLevels=Pc;Ec.push(sb)}Uc.refractionLevels=Ec;pd.push(Uc)}Ob.opacityLevels=pd;Nb.push(Ob)}od.lightMapLevels=Nb}d&&(this.apiCore.exec(this.callerName,"rdr.updateSceneMaterials",this.scene),this.apiCore.exec(this.callerName,
"rdr.updateShaders",this.scene))}else console.error("No scene to modify in sceneModifier.")},t=function(b,d,e,f,g){if(this.scene)if(b)if(d){var h=this.scene.materialTrees[b.id];if(h)if(b=this.scene.materialsContent.materialSettingsByName[b.id][d])if(b=this.scene.materials[b.id],g){for(l=0;l<h.polylistInstances.length;++l)m=h.polylistInstances[l],m.matAnim.resetMaterial(b);h.currentMaterialId=b.id;e&&e()}else{d={cnt:h.polylistInstances.length};g=stage.setContext(function(b,d,f){if(!--b.cnt&&!b.cancelled){b=
f.id;var g=[].concat(d.polylistInstances),h;for(h in g)delete g[h].downloadingMaterial,g[h].matAnim.resetMaterial(f);d.currentMaterialId=b;this.scene.visibilityChanged|=this.scene.renderingSettings.furSupported&&f.coating&&0<f.coating.furMaxLength;this.apiCore.exec(this.callerName,"rdr.updateSceneMaterials",this.scene);this.apiCore.exec(this.callerName,"rdr.updateSceneLights",this.scene);this.apiCore.exec(this.callerName,"rdr.updateShaders",this.scene);e&&e()}},this,d,h,b);d=stage.setContext(function(b){b.cancelled=
!0;--b.cnt||f&&f()},this,d);var k=[];if(h.polylistInstances.length){for(var l=0;l<h.polylistInstances.length;++l){var m=h.polylistInstances[l];if(m.downloadingMaterial)m.downloadingMaterial.onerror();var p={onload:g,onerror:d};this.scene.fillMaterialNoTextureInstance(p,b,m.polylist.customMaterial,m.customMaterial);m.downloadingMaterial=p;k.push(p)}this.scene.texturesManager.downloadMaterials(k)}else h.currentMaterialId=b.id,e&&e()}else f&&(console.error("not found ms"),f());else f&&(console.error("not found mt"),
f())}else f&&f();else f&&f();else console.error("No scene to modify in sceneModifier.")},r=function(){if(this.scene){for(var b in this.scene.materialTrees)this.scene.materialTrees[b].uvTransform&&(this.scene.materialTrees[b].uvTransform.dirty=!1);for(b in this.scene.materials)this.scene.materials[b].uvTransform&&(this.scene.materials[b].uvTransform.dirty=!1)}},f=function(b){if(this.scene){var d=this.scene.get("ProductNode",b.id),e=this.scene.getCurrentParentTypeAndId().id,f={},g;for(g in b.associations)f[b.associations[g].polylist]=
b.associations[g].material_tree;d?(d.name=b.name,d.sku!=b.sku&&(delete this.scene.productNodesBySKU[d.sku],this.scene.productNodesByProjectAndSKU[e]&&delete this.scene.productNodesByProjectAndSKU[e][b.sku],d.sku=b.sku),d.matrix=b.matrix,d.associations=f):(this.scene.register("ProductNode",{id:b.id,localId:-1,name:b.name,sku:b.sku,matrix:b.matrix,opacity:1,baseOpacity:1,sourceNode:null!=b.source_node?this.scene.get("SourceNode",b.source_node.id):null,sourceModel:null!=b.source_model?this.scene.get("SourceModel",
b.source_model.id):null,originalSourceModel:null!=b.original_source_model?this.scene.get("SourceModel",b.original_source_model.id):null,matricesList:[],associations:f,duplicatedNodes:{}}),d=this.scene.get("ProductNode",b.id),this.scene.productNodes[d.id]=d);this.scene.productNodesBySKU[b.sku]=d;this.scene.productNodesByProjectAndSKU[e]||(this.scene.productNodesByProjectAndSKU[e]={});this.scene.productNodesByProjectAndSKU[e][b.sku]=d}else console.error("No scene to modify in sceneModifier.")},n=function(b,
d){var e=Object.keys(this.scene.productNodeInstancesByLocalId);if(1==e.length&&(e=this.scene.getOriginalIdFromInstance(this.scene.productNodeInstancesByLocalId[e[0]].productNode),b==e)){void 0!==d&&d instanceof Function&&d();return}return B.call(this,"[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]"+b+"-1",d)},B=function(b,d){this.scene?(this.apiCore.exec(this.callerName,"rdr.toggleRendering",!1),this.scene.removeProductNode(this.scene.root.localId),this.scene.root=this.scene.readProductNodeStr({value:b}),this.apiCore.exec(this.callerName,
"loadProductNode",this.scene,this.scene.productNodes[this.scene.root.id],stage.setContext(function(){this.scene.loadMaterials();this.scene.updateSceneNodes();this.scene.prepareScene();this.apiCore.exec(this.callerName,"resetCameraScene");this.apiCore.exec(this.callerName,"rdr.initSceneBuffers",this.scene);this.apiCore.exec(this.callerName,"rdr.updateSceneMaterials",this.scene);this.apiCore.exec(this.callerName,"rdr.updateSceneLights",this.scene);this.apiCore.exec(this.callerName,"rdr.updateShaders",
this.scene);if(this.scene.viewerAnimations.length){for(var b=[].concat(this.scene.viewerAnimations),e=0;e<b.length;++e)b[e].stateToLoad="ANIMATING"==b[e].currentState?b[e].animatingTo:b[e].currentState;this.apiCore.exec(this.callerName,"setAnimations",this.scene,{animations:b})}this.apiCore.exec(this.callerName,"rdr.toggleRendering",!0);this.scene.update();void 0!==d&&d instanceof Function&&d()},this))):console.error("No scene to modify in sceneModifier.")},w=function(b,d,e){this.scene?b&&d&&(b=this.scene.productNodes[b.id],
b.sourceModel.downloaded=!1,b.sourceModel.realFilePath=d.real_file_path,this.apiCore.exec(this.callerName,"rdr.toggleRendering",!1),this.apiCore.exec(this.callerName,"rdr.deallocateProductNode",b),this.apiCore.exec(this.callerName,"loadProductNode",this.scene,b,stage.setContext(function(b){this.apiCore.exec(this.callerName,"rdr.reallocateProductNode",b);this.scene.loadMaterials();this.scene.updateSceneNodes();this.scene.prepareScene();this.apiCore.exec(this.callerName,"rdr.updateSceneMaterials",this.scene);
this.apiCore.exec(this.callerName,"rdr.updateSceneLights",this.scene);this.apiCore.exec(this.callerName,"rdr.updateShaders",this.scene);if(this.scene.viewerAnimations.length){b=[].concat(this.scene.viewerAnimations);for(var d=0;d<b.length;++d)b[d].stateToLoad="ANIMATING"==b[d].currentState?b[d].animatingTo:b[d].currentState;this.apiCore.exec(this.callerName,"setAnimations",this.scene,{animations:b})}this.apiCore.exec(this.callerName,"rdr.toggleRendering",!0);this.scene.update();void 0!==e&&e instanceof
Function&&e()},this,b))):console.error("No scene to modify in sceneModifier.")},D=function(b){if(this.scene){this.scene.root=fa.call(this,b);this.scene.updateModelSceneGraph();this.scene.updateSceneNodes();this.scene.prepareScene();this.apiCore.exec(this.callerName,"rdr.updateSceneMaterials",this.scene);this.apiCore.exec(this.callerName,"rdr.updateShaders",this.scene);b=[];var d=0,e=stage.setContext(function(){++d==this.scene.polylistInstances.length&&(this.apiCore.exec(this.callerName,"rdr.toggleRendering",
!0),this.scene.update())},this),f;for(f in this.scene.polylistInstances)this.scene.polylistInstances[f].matAnim.currentMaterial.onload=e,b.push(this.scene.polylistInstances[f].matAnim.currentMaterial);b.length&&(this.apiCore.exec(this.callerName,"rdr.toggleRendering",!1),this.scene.texturesManager.downloadMaterials(b))}else console.error("No scene to modify in sceneModifier.")},A=function(b){if(this.scene)if(this.scene.polylists[b.id]){la.call(this,b);b=this.scene.polylists[b.id];for(var d=0,e=stage.setContext(function(b){if(++d===
b.instances.length){for(var e=0;e<b.instances.length;++e){var f=b.instances[e];f.matAnim.resetMaterial(this.scene.materials[f.matAnim.currentMaterial.id])}this.scene.maxRenderingPass=Math.max(b.renderingPass,this.scene.maxRenderingPass);b.loaded&&(this.apiCore.exec(this.callerName,"rdr.updateSceneMaterials",this.scene),this.apiCore.exec(this.callerName,"rdr.updateShaders",this.scene));--this.scene.stopDraw;this.scene.update()}},this,b),f=[],g=0;g<b.instances.length;++g)f.push(this.scene.fillMaterialNoTextureInstance({onload:e},
this.scene.materials[b.instances[g].matAnim.currentMaterial.id],b.customMaterial,b.instances[g].customMaterial));f.length&&(++this.scene.stopDraw,this.scene.texturesManager.downloadMaterials(f))}else console.error("No polylist with id "+b.id+" in the current scene.");else console.error("No scene to modify in sceneModifier.")},H=function(b,d){var e=this.scene.polylists[b.id];b=this.scene.register("Polylist",{id:d,name:e.name,double_sided:e.doubleSided,doubleSided:e.doubleSided,faces_orientation:e.facesOrientation,
facesOrientation:e.facesOrientation,ssao_receive:e.ssaoReceive,ssaoReceive:e.ssaoReceive,ssao_cast:e.ssaoCast,ssaoCast:e.ssaoCast,refract_distance:e.refractDistance,refractDistance:e.refractDistance,polygon_offset_factor:e.polygonOffsetFactor-1,polygonOffsetFactor:e.polygonOffsetFactor-1,polygon_offset_units:e.polygonOffsetUnits-1,polygonOffsetUnits:e.polygonOffsetUnits-1,subdivision_level:e.subdivisionLevel,subdivisionLevel:e.subdivisionLevel,rendering_pass:e.renderingPass+1,renderingPass:e.renderingPass+
1,custom_material_values:[],customMaterialValues:[],material_tree:e.materialTree,materialTree:e.materialTree,customMaterial:{},instances:[],list:null,edges:null,indexBuffer:null,indexLineBuf:null,downloaded:e.downloaded,selected:!1,highlighted:!1,isHidden:!1,nodes:[],geometryId:e.geometryId,geometry:e.geometry,basePolylistId:b.id,duplicatedPolylists:[]});if(e.list){b.list=[];for(var f=0;f<e.list.length;++f)b.list[f]=new Int32Array(e.list[f].length),b.list[f].set(e.list[f])}else e.duplicatedPolylists.push(b);
if(e.edges)for(b.edges=[],f=0;f<e.edges.length;++f)e.edges[f]?(b.edges[f]=new Int32Array(e.edges[f].length),b.edges[f].set(e.edges[f])):b.edges[f]=null;for(f=0;f<e.instances.length;++f){var g=e.instances[f],h=this.scene.createPolylistInstance(b,g.node);g.realMeasurementScalingFactors&&(h.realMeasurementScalingFactors=stage.extend(!0,{},g.realMeasurementScalingFactors));g.node.polylists.push(h)}this.scene.polylists[d]=b;e.loaded&&(this.apiCore.exec(this.callerName,"rdr.loadPolylistBuffers",b),this.apiCore.exec(this.callerName,
"rdr.updateSceneMaterials",this.scene),this.apiCore.exec(this.callerName,"rdr.updateShaders",this.scene));this.scene.computePolylistsBoundingBoxes();return b},e=function(b){for(var d=this.scene.polylists[b.id],e=d.materialTree,f=0;f<d.instances.length;++f){var g=d.instances[f];g.matAnim&&(g.matAnim.destroy(),delete g.matAnim);g.node.polylists.splice(g.node.polylists.indexOf(g),1);e.polylistInstances.splice(e.polylistInstances.indexOf(g),1);this.scene.polylistInstances.splice(this.scene.polylistInstances.indexOf(g),
1)}delete this.scene.polylists[b.id];this.apiCore.exec(this.callerName,"rdr.unloadPolylistBuffers",d);this.scene.update()},E=function(b){this.scene&&(this.scene.wearableAR=b)},F=function(b){if(this.scene){for(var d={id:b.id,name:b.name,presets:[]},e=0;e<b.presets.length;++e){var f=b.presets[e],g=this.scene.get("Preset",f.id);g?(g.sku=f.sku,g.color=f.color instanceof Float32Array?f.color:p(f.color),g.name=f.name,g.displayInWebService=f.display_in_web_service,g.filePath=f.file_path,g.bigPreviewPath=
f.big_preview_path,g.smallPreviewPath=f.small_preview_path,g.materials={}):g=this.scene.register("Preset",{id:f.id,sku:f.sku,color:f.color instanceof Float32Array?f.color:p(f.color),name:f.name,displayInWebService:f.display_in_web_service,filePath:f.file_path,bigPreviewPath:f.big_preview_path,smallPreviewPath:f.small_preview_path,materials:{}});for(var h in f.materials){var k=this.scene.get("MaterialTree",f.materials[h].material_tree.id),l=this.scene.get("MaterialSettings",f.materials[h].material_settings.id);
g.materials[h]={materialTreeId:k.id,materialSettingsId:l.id,accessString:f.materials[h].configurator_access}}d.presets.push(g)}this.apiCore.exec(this.callerName,"setPresets",d,!0)}},p=function(b){if(b instanceof Float32Array)return b;var d=b;"#"==d[0]&&(d=d.slice(1,b.length));b="0x"+d.substr(0,2);var e="0x"+d.substr(2,2);d="0x"+d.substr(4,2);return vec3.create([parseInt(b)/255,parseInt(e)/255,parseInt(d)/255])},m=function(b){if(b instanceof Float32Array)return b;var d=b;"#"==d[0]&&(d=d.slice(1,b.length));
return quat4.create([parseInt(d.substr(0,2),16)/255,parseInt(d.substr(2,2),16)/255,parseInt(d.substr(4,2),16)/255,6<d.length?parseInt(d.substr(6,2),16)/255:1])},h=function(b,d){if(!b)return null;var e=[],f=null,g;for(g in b.source_images){var h=b.source_images[g];var k=h;var l=d;if(k){var m=this.scene.get("SourceImage",l?-k.id:k.id);m?(m.name=k.name,m.width=k.width,m.height=k.height,m.fileType=k.file_type,m.filePath=k.file_path,m.realFilePath=(k.html_image?k.html_image.src:null)||k.imageData||k.real_file_path,
m.fileSize=k.file_size):m=this.scene.register("SourceImage",{id:l?-k.id:k.id,name:k.name,width:k.width,height:k.height,fileType:k.file_type,filePath:k.file_path,realFilePath:(k.html_image?k.html_image.src:null)||k.imageData||k.real_file_path,fileSize:k.file_size});k=m}else console.warn("Empty source image"),k=null;h.id==b.default_source_image.id&&(f=k);e.push(k)}if(!e.length)return null;(g=this.scene.get("ImageRGBA",d?-b.id:b.id))?(g.name=b.name,g.rgbe=b.rgbe,g.defaultImage=f,g.sourceImages=e,g.widthMM=
b.width_mm,g.heightMM=b.height_mm):g=this.scene.register("ImageRGBA",{id:d?-b.id:b.id,name:b.name,rgbe:b.rgbe,defaultImage:f,sourceImages:e,widthMM:b.width_mm,heightMM:b.height_mm});this.scene.srcImages[g.id]=this.scene.texturesManager.addImageRGBA(g);return this.scene.srcImages[g.id]},v=function(b,d){if(!b)return null;var e=this.scene.get("Layer",b.id);e?(e.color=b.color,e.opacity=b.opacity,e.level=b.level,e.layer=v.call(this,b.layer,d),e.image=h.call(this,b.image_r_g_b_a,d)):e=this.scene.register("Layer",
{id:b.id,color:b.color,opacity:b.opacity,level:b.level,layer:v.call(this,b.layer,d),image:h.call(this,b.image_r_g_b_a,d)});return e},I=function(b){return b?{dirty:!0,angle:Math.PI*b.angle/180,scaleX:b.scale_x,scaleY:b.scale_y,offsetX:b.offset_x,offsetY:b.offset_y}:null},J=function(b,d,e,f){if(!b)return null;f||(f=this.scene);var g=f.get("Texture",d?-b.id:b.id);g?(g.name=b.name,g.wrapS=b.wrap_s,g.wrapT=b.wrap_t,g.repeatX=b.repeat_x,g.repeatY=b.repeat_y,g.offsetX=b.offset_x,g.offsetY=b.offset_y,g.pivotX=
b.pivot_x,g.pivotY=b.pivot_y,g.angle=Math.PI*b.angle/180,g.useMipmap=b.use_mipmap,g.minFilter=b.min_filter,g.magFilter=b.mag_filter,g.anisotropy=b.anisotropy,g.srgbMode=b.srgb_mode,g.channel=b.channel,g.uvsrc=b.uvsrc,g.useRealMeasurements=b.use_real_measurements,g.ignoreGlobalUVTransform=!0===e,g.uvTransformOrder=b.uv_transform_order,g.layer=v.call(this,b.layer,d),g.negativeTexture=b.negative_texture):g=f.register("Texture",{id:d?-b.id:b.id,name:b.name,wrapS:b.wrap_s,wrapT:b.wrap_t,repeatX:b.repeat_x,
repeatY:b.repeat_y,offsetX:b.offset_x,offsetY:b.offset_y,pivotX:b.pivot_x,pivotY:b.pivot_y,angle:Math.PI*b.angle/180,useMipmap:b.use_mipmap,minFilter:b.min_filter,magFilter:b.mag_filter,anisotropy:b.anisotropy,srgbMode:b.srgb_mode,channel:b.channel,uvsrc:b.uvsrc,useRealMeasurements:b.use_real_measurements,ignoreGlobalUVTransform:!0===e,uvTransformOrder:b.uv_transform_order,layer:v.call(this,b.layer,d),negativeTexture:b.negative_texture});f.textures[g.id]=f.texturesManager.addTexture(g);g.useRealMeasurements&&
!f.useRealMeasurements&&(f.useRealMeasurements=!0,f.computeSceneRealMeasurementScalingFactors(f.arData));return f.textures[g.id]},M=function(b){if(!b)return null;var d=this.scene.get("TextureCube",b.id);d?(d.name=b.name,d.positioned=b.positioned,d.center=[b.center_x,b.center_y,b.center_z],d.cubeSize=b.size,d.wrapS=b.wrap_s,d.wrapT=b.wrap_t,d.minFilter=b.min_filter,d.magFilter=b.mag_filter,d.imagesData=b.imagesData,d.posX=h.call(this,b.positive_x),d.negX=h.call(this,b.negative_x),d.posY=h.call(this,
b.positive_y),d.negY=h.call(this,b.negative_y),d.posZ=h.call(this,b.positive_z),d.negZ=h.call(this,b.negative_z)):d=this.scene.register("TextureCube",{id:b.id,name:b.name,positioned:b.positioned,center:[b.center_x,b.center_y,b.center_z],cubeSize:b.size,wrapS:b.wrap_s,wrapT:b.wrap_t,minFilter:b.min_filter,magFilter:b.mag_filter,imagesData:b.imagesData,posX:h.call(this,b.positive_x),negX:h.call(this,b.negative_x),posY:h.call(this,b.positive_y),negY:h.call(this,b.negative_y),posZ:h.call(this,b.positive_z),
negZ:h.call(this,b.negative_z)});this.scene.texturesCube[d.id]=this.scene.texturesManager.addTextureCube(d);return this.scene.texturesCube[d.id]},T=function(b){return b?{id:b.id,name:b.name,color:p(b.color),intensity:b.intensity,texture:J.call(this,b.texture),colorTexture:J.call(this,b.color_texture)}:null},U=function(b){b={id:b.id,name:b.name,intensity:b.intensity,blur:b.blur,channel:b.channel,blending:b.blending,threshold:b.threshold,firstFacesOnly:b.first_faces_only,texture:J.call(this,b.texture)};
""===b.blur||"none"===b.blur?b.blur="none":(1>b.intensity||b.texture)&&0<b.intensity&&(this.scene.hasSomeBlur=!0,this.scene.opacityBlurs.push(b.blur),this.scene.opacityBlurs=stage.array.uniq(this.scene.opacityBlurs));return b},R=function(b){return b?{id:b.id,name:b.name,intensity:b.intensity,index:b.r_index,relativeToCamera:b.is_relative_to_camera,texture:J.call(this,b.texture),textureCube:M.call(this,b.texture_cube_map)}:null},aa=function(b){return b?{id:b.id,name:b.name,intensity:b.intensity,texture:J.call(this,
b.texture)}:null},C=function(b){return b?{id:b.id,name:b.name,intensity:b.intensity,texture:J.call(this,b.texture)}:null},L=function(b){return b?{id:b.id,name:b.name,type:b.type,scale:b.scale,texture:J.call(this,b.texture),scaleTexture:J.call(this,b.scale_texture)}:null},K=function(b){return{id:b.id,name:b.name,intensity:b.intensity,texture:J.call(this,b.texture)}},G=function(b){return b?{id:b.id,name:b.name,intensity:b.intensity,blendingLevel:b.blending_level,relativeToCamera:b.is_relative_to_camera,
texture:J.call(this,b.texture),textureCube:M.call(this,b.texture_cube_map)}:null},S=function(b){return{id:b.id,name:b.name,color:p(b.color),intensity:b.intensity,texture:J.call(this,b.texture),intensityTexture:J.call(this,b.intensity_texture)}},Y=function(b){if(!b)return null;b={id:b.id,name:b.name,color:p(b.color),size:b.size,opacity:b.opacity,saturation:b.saturation,colorTexture:J.call(this,b.color_texture),opacityTexture:J.call(this,b.opacity_texture),saturationTexture:J.call(this,b.saturation_texture)};
this.scene.hasSomeGlow=!0;return b},ia=function(b){return b?{id:b.id,name:b.name,intensity:b.intensity,texture:J.call(this,b.texture),intensityTexture:J.call(this,b.intensity_texture)}:null},Q=function(b){var d={id:b.id,name:b.name,color:p(b.color),intensity:b.intensity,texture:J.call(this,b.texture),intensityTexture:J.call(this,b.intensity_texture),glow:b.glow};b.glow&&(this.scene.hasSomeSpecularGlow=!0);return d},ta=function(b){return{id:b.id,name:b.name,color:p(b.color),intensity:b.intensity,texture:J.call(this,
b.texture)}},ua=function(b){return{id:b.id,name:b.name,diffuseColor:b.diffuse_color,color:p(b.color),intensity:b.intensity,texture:J.call(this,b.texture)}},ea=function(b){if(!b)return null;var d=b.id,e=b.name,f=b.color instanceof Float32Array?b.color:p(b.color),g=b.intensity,h=void 0!==b.blending_mode?b.blending_mode:0,k=J.call(this,b.texture);if(b=b.specular){var l={id:b.id,name:b.name,color:p(b.color),intensity:b.intensity,texture:J.call(this,b.texture),intensityTexture:J.call(this,b.intensity_texture),
glow:b.glow,fresnelMode:b.fresnel_mode,fresnel:b.fresnel};b.glow&&(this.scene.hasSomeSpecularGlow=!0);b=l}else b=null;return{id:d,name:e,color:f,intensity:g,blendingMode:h,texture:k,specular:b}},oa=function(b){if(!b)return null;var d=b.id,e=b.name,f=b.gloss,g=b.intensity,h=J.call(this,b.texture);b=(b=b.sheen)?{oldShader:1==b.old_shader,color:b.color instanceof Float32Array?b.color:p(b.color),intensity:b.intensity,texture:J.call(this,b.texture),intensityTexture:J.call(this,b.intensity_texture),customRoughness:1==
b.custom_roughness,roughness:b.roughness,roughnessTexture:J.call(this,b.roughness_texture)}:null;return{id:d,name:e,gloss:f,intensity:g,texture:h,sheen:b}},ba=function(b){return b?{id:b.id,name:b.name,intensity:b.intensity,texture:J.call(this,b.texture),anisotropy:xa.call(this,b.anisotropy),carpaint:Ia.call(this,b.carpaint)}:null},ka=function(b){return b?{id:b.id,name:b.name,type:b.type,inverted:b.inverted,intensity:b.intensity,texture:J.call(this,b.texture),intensityTexture:J.call(this,b.intensity_texture),
type2:b.type2,inverted2:b.inverted2,intensity2:b.intensity2,texture2:J.call(this,b.texture2),intensityTexture2:J.call(this,b.intensity_texture2)}:null},Z=function(b){if(!b)return null;var d=b.id,e=b.name,f=b.color instanceof Float32Array?b.color:p(b.color),g=b.intensity,h=b.blending_mode,k=J.call(this,b.texture),l=J.call(this,b.intensity_texture);(b=b.glow)?(b={id:b.id,name:b.name,emissiveColor:b.emissive_color,color:p(b.color),size:b.size,opacity:b.opacity,saturation:b.saturation,colorTexture:J.call(this,
b.color_texture),opacityTexture:J.call(this,b.opacity_texture),saturationTexture:J.call(this,b.saturation_texture)},this.scene.hasSomeGlow=!0):b=null;return{id:d,name:e,color:f,intensity:g,blendingMode:h,texture:k,intensityTexture:l,glow:b}},da=function(b){return b?{id:b.id,name:b.name,ambientIntensity:b.ambient_intensity,ambientTexture:J.call(this,b.ambient_texture),ambientTextureCorrection:b.ambient_texture_correction,lightIntensity:b.light_intensity,lightTexture:J.call(this,b.light_texture),lightTextureCorrection:b.light_texture_correction}:
null},X=function(b){if(!b)return null;b={id:b.id,name:b.name,blending:b.blending,threshold:b.threshold,glassMode:b.glass_mode,firstFacesOnly:b.first_faces_only,intensity:b.intensity,blur:b.blur,texture:J.call(this,b.texture),refraction:qa.call(this,b.refraction)};""===b.blur||"none"===b.blur?b.blur="none":(1>b.intensity||b.texture)&&0<b.intensity&&(this.scene.hasSomeBlur=!0,this.scene.opacityBlurs.push(b.blur),this.scene.opacityBlurs=stage.array.uniq(this.scene.opacityBlurs));return b},Ha=function(b){return b?
{id:b.id,name:b.name,intensity:b.intensity,texture:J.call(this,b.texture)}:null},Ga=function(b){if(!b)return null;b.texture&&(b.texture.layer.image_r_g_b_a.rgbe=!0);b={id:b.id,name:b.name,tint:b.tint instanceof Float32Array?b.tint:p(b.tint),texture:J.call(this,b.texture),relativeToCamera:b.is_relative_to_camera,rotation:b.rotation/360,exposure:b.exposure,positioned:b.positioned,center:b.center,size:b.size};b.texture&&-1===this.scene.environmentTextures.indexOf(b.texture)&&this.scene.environmentTextures.push(b.texture);
return b},Fa=function(b){if(!b)return null;var d={cursors:[]},e={colors:[],locations:[]},f;for(f in b.colormap.cursors){var g=b.colormap.cursors[f];d.cursors.push({color:m(g.color),location:g.location})}d.cursors.sort(function(b,d){return 1-b.location-(1-d.location)});for(f in d.cursors)e.colors.push(d.cursors[f].color[0]),e.colors.push(d.cursors[f].color[1]),e.colors.push(d.cursors[f].color[2]),e.colors.push(d.cursors[f].color[3]),e.locations.push(1-d.cursors[f].location);return{id:b.id,name:b.name,
intensity:b.intensity,texture:J.call(this,b.texture),colormap:d,mode:b.mode,shaderColormap:e}},xa=function(b){return b?{id:b.id,name:b.name,intensity:b.intensity,angle:b.angle,texture:J.call(this,b.texture),intensityTexture:J.call(this,b.intensity_texture),roughnessTexture:J.call(this,b.roughness_texture),rotationTexture:J.call(this,b.rotation_texture)}:null},Ia=function(b){if(!b)return null;for(var d=new Float32Array(b.specular_lobe_count),e=new Float32Array(b.specular_lobe_count),f=new Float32Array(b.specular_lobe_count),
g=0;g<b.specular_lobe_count;++g)d[g]=b.specular_lobes[g].f0,e[g]=b.specular_lobes[g].coef,f[g]=b.specular_lobes[g].spread;this.scene.hasSomeCarpaint=!0;b={id:b.id,name:b.name,diffuse:b.diffuse,coatingFlags:b.coating_flags,specularLobeCount:b.specular_lobe_count,specularLobeF0s:d,specularLobeCoeffs:e,specularLobeSpreads:f,flakesIntensity:b.flakes_intensity,flakesMaxThetaI:b.flakes_max_theta_i,flakesNumThetaI:b.flakes_num_theta_i,flakesNumThetaF:b.flakes_num_theta_f,flakesNumPatches:b.flakes_num_patches,
flakesGridX:b.flakes_grid_x,flakesGridY:b.flakes_grid_y,flakesColorBias:b.flakes_color_bias,isRGBEbrdfColorTexture:b.is_rgbe_brdf_color_texture,isRGBEflakesColorTexture:b.is_rgbe_flakes_color_texture,brdfColorTexture:J.call(this,b.brdf_color_texture),flakesSliceLutTexture:J.call(this,b.flakes_slice_lut_texture),flakesColorTexture:J.call(this,b.flakes_color_texture)};b.flakesColorTexture&&(b.flakesColorTexture.layer.image.textureMode="TEXTURE_2D_ARRAY",b.flakesColorTexture.layer.image.grid={x:b.flakesGridX,
y:b.flakesGridY,patchCount:b.flakesNumPatches});return b},qa=function(b){return b?{id:b.id,name:b.name,intensity:b.intensity,index:b.r_index,relativeToCamera:b.is_relative_to_camera,textureCube:M.call(this,b.texture_cube_map)}:null},Va=function(b){if(!b)return null;var d={};d.furMaxLength=void 0!==b.fur_max_length?b.fur_max_length:0;d.furRealSize=void 0!==b.fur_real_size?b.fur_real_size:0;d.furRigidity=void 0!==b.fur_rigidity?b.fur_rigidity:0;d.furDispersion=void 0!==b.fur_dispersion?b.fur_dispersion:
0;d.furClumpType=void 0!==b.fur_clump_type?b.fur_clump_type:0;d.furClumpSize=void 0!==b.fur_clump_size?b.fur_clump_size:.5;d.furHairSize=void 0!==b.fur_hair_size?b.fur_hair_size:0;d.furRootColor=void 0!==b.fur_root_color?b.fur_root_color instanceof Float32Array?b.fur_root_color:p(b.fur_root_color):[0,0,0];d.furGradInterval=void 0!==b.fur_grad_interval?b.fur_grad_interval:{min:0,max:100};d.furGradNormalize=void 0!==b.fur_grad_normalize?b.fur_grad_normalize:!1;void 0!==b.fur_shadow_intensity&&(d.furRootColor=
[b.fur_shadow_intensity,b.fur_shadow_intensity,b.fur_shadow_intensity],d.furGradInterval={min:19,max:100},d.furGradNormalize=!0);if(0<d.furMaxLength||0<d.furRealSize)this.scene.hasSomeFur=!0,this.scene.useRealMeasurements||(this.scene.useRealMeasurements=!0,this.scene.computeSceneRealMeasurementScalingFactors(this.scene.arData)),d.intensityTexture||(this.scene.needFurMap=!0);return d},va=function(b){return b?Object.assign({id:b.id,name:b.name,intensity:b.intensity,thickness:b.thickness,roughness:b.roughness,
ior:b.ior,color:b.color instanceof Float32Array?b.color:p(b.color),colorIntensity:b.color_intensity,intensityTexture:J.call(this,b.intensity_texture),thicknessTexture:J.call(this,b.thickness_texture),roughnessTexture:J.call(this,b.roughness_texture),normalIntensity:b.normal_intensity,normalInverted:b.normal_inverted,normalTexture:J.call(this,b.normal_texture)},Va.call(this,b)):null},la=function(b){var d=this.scene.polylists[b.id];d.doubleSided=b.double_sided;d.facesOrientation=b.faces_orientation;
d.ssaoReceive=b.ssao_receive;d.ssaoCast=b.ssao_cast;d.refractDistance=parseFloat(b.refract_distance);d.polygonOffsetFactor=parseInt(b.polygon_offset_factor);d.polygonOffsetUnits=parseInt(b.polygon_offset_units);d.subdivisionLevel=parseInt(b.subdivision_level);d.renderingPass=parseInt(b.rendering_pass);var e;if(e=b.custom_material_values){for(var f=[],g=0;g<e.length;++g){var h=e[g];var k=h.address.replace("ambient_intensity","ambientIntensity");k=k.replace("ambient_texture_correction","ambientTextureCorrection");
k=k.replace("ambient_texture","ambientTexture");k=k.replace("blending_level","blendingLevel");k=k.replace("blending_mode","blendingMode");k=k.replace("color_intensity","colorIntensity");k=k.replace("color_texture","colorTexture");k=k.replace("diffuse_color","diffuseColor");k=k.replace("emissive_color","emissiveColor");k=k.replace("first_faces_only","firstFacesOnly");k=k.replace("glass_mode","glassMode");k=k.replace("intensity_texture","intensityTexture");k=k.replace("intensity_texture2","intensityTexture2");
k=k.replace("is_relative_to_camera","relativeToCamera");k=k.replace("light_intensity","lightIntensity");k=k.replace("light_map","lightMap");k=k.replace("light_texture_correction","lightTextureCorrection");k=k.replace("light_texture","lightTexture");k=k.replace("local_environment","localEnvironment");k=k.replace("normal_deformation","normalDeformation");k=k.replace("opacity_texture","opacityTexture");k=k.replace("refraction.r_index","refraction.index");k=k.replace("rotation_texture","rotationTexture");
k=k.replace("roughness_texture","roughnessTexture");k=k.replace("saturation_texture","saturationTexture");k=k.replace("scale_texture","scaleTexture");k=k.replace("specular_anisotropic","specularAnisotropic");k=k.replace("texture_cube_map","textureCube");k=k.replace("thickness_texture","thicknessTexture");k=k.replace("normal_texture","normalTexture");k=k.replace("normal_intensity","normalIntensity");k=k.replace("normal_inverted","normalInverted");k=k.replace("fresnel_mode","fresnelMode");k=k.replace("custom_roughness",
"customRoughness");k=k.replace("fur_max_length","furMaxLength");k=k.replace("fur_real_size","furRealSize");k=k.replace("fur_rigidity","furRigidity");k=k.replace("fur_shadow_intensity","furShadowIntensity");k=k.replace("fur_dispersion","furDispersion");k=k.replace("fur_clump_type","furClumpType");k=k.replace("fur_clump_size","furClumpSize");k=k.replace("fur_hair_size","furHairSize");k=k.replace("fur_root_color","furRootColor");k=k.replace("fur_grad_interval","furGradInterval");k=k.replace("fur_grad_normalize",
"furGradNormalize");k={address:k,type:h.type};switch(h.type){case 1:case 2:case 3:case 5:var l=k;var m=h.value;switch(h.address){case "local_environment.rotation":m/=360}l.value=m;break;case 4:k.value=p(h.value);break;case 6:k.value=J.call(this,h.value,!1,!0);break;case 7:k.value=M.call(this,h.value);break;case 8:k.value=null}-1!==h.address.indexOf(".glow.")&&(this.scene.hasSomeGlow=!0);0===h.address.indexOf("glow")&&(this.scene.hasSomeGlow=!0);h.address.indexOf(".glow")==h.address.length-5&&0<=h.address.length-
5&&(this.scene.hasSomeSpecularGlow=!0);h.address.indexOf(".blur")==h.address.length-5&&0<=h.address.length-5&&(this.scene.hasSomeBlur=!0,this.scene.opacityBlurs.push(h.value),this.scene.opacityBlurs=stage.array.uniq(this.scene.opacityBlurs));f.push(k)}e=f}else e=[];d.customMaterialValues=e;d.customMaterial=this.scene.convertCustomMaterialValuesToMaterial(d.customMaterialValues);d.realMeasurementScalingFactors=b.realMeasurementScalingFactors;e=(e=b.tags)&&e.length?[].concat($jscomp.arrayFromIterable(e)):
[];d.tags=e;d.tagsSet=this.apiCore.exec(this.callerName,"lib.convertStringsToSet",d.tags);this.scene.hasSomePolylistTags=Math.max(this.scene.hasSomePolylistTags,d.tags.length);if(d.customMaterial.localEnvironment&&d.customMaterial.localEnvironment.texture&&-1===this.scene.environmentTextures.indexOf(d.customMaterial.localEnvironment.texture)){e=d.customMaterial.localEnvironment.texture;for(f=0;f<e.images.length;++f)e.images[f].rgbe=!0;this.scene.environmentTextures.push(e)}if(b.material_tree&&d.materialTree.id!==
b.material_tree.id){b=this.scene.materialTrees[b.material_tree.id];for(var n in d.instances)e=d.instances[n],e.materialTree.polylistInstances.splice(e.materialTree.polylistInstances.indexOf(e),1),e.matAnim.resetMaterial(this.scene.materials[b.currentMaterialId]),e.materialTree=b,b.polylistInstances.push(e);d.materialTree=b}},fa=function(b){for(var d={id:b.id,name:b.name,children:[],polylistIds:[],materialIds:[],matrix:mat4.transpose(mat4.create([b.matrix_a1,b.matrix_a2,b.matrix_a3,b.matrix_a4,b.matrix_b1,
b.matrix_b2,b.matrix_b3,b.matrix_b4,b.matrix_c1,b.matrix_c2,b.matrix_c3,b.matrix_c4,b.matrix_d1,b.matrix_d2,b.matrix_d3,b.matrix_d4])),sourceModel:null,selected:!1,highlighted:!1,parent:null,explosionVector:vec3.create([0,0,0]),explodable:!1,annotations:[],duplicatedNodes:[],polylists:[],materials:[]},e=0;e<b.polylists.length;++e)d.polylistIds.push(b.polylists[e].id),d.materialIds.push(b.polylists[e].material.id);for(e=0;e<b.source_nodes.length;++e){var f=fa.call(this,b.source_nodes[e]);f.parent=
d;d.children.push(f)}return this.scene.sourceNodes[d.id]=d};return d});stage.provide("emersya.viewer.modules.sceneConfiguration");stage.require("emersya.viewer.modules.API.core");
stage.register.call(stage.emersya.viewer.modules,"sceneConfiguration",function(){function b(b,d,e,f){var g=parseInt(f.size)/7,h=parseInt(f.size)/15;d+=g;b+=f.bbox.x1;f=f.width;h=void 0===h?2:h;e=void 0===e?"black":e;g=new opentype.Path;g.fill=e;g.stroke=e;g.strokeWidth=h;g.moveTo(b,d);g.lineTo(b+f,d);return g}function d(b){var d,e=0,f=0,g=0;for(d=0;d<b.commands.length;d++){var h=b.commands[d];0==d&&("M"===h.type&&(e=-.25*-h.y),originalMaxX=originalMinX=g=f=h.x);"Z"!==h.type&&(h.x=e+h.x+-.25*h.y);
if("Q"===h.type||"C"===h.type)h.x1=e+h.x1+-.25*h.y1;"C"===h.type&&(h.x2=e+h.x2+-.25*h.y2);"Z"!==h.type&&(f=Math.min(h.x,f),g=Math.max(h.x,g))}return{newX1:f,newX2:g}}function u(b){b.strokeText=!0;b.strokeColor=b.color;b.strokeWidth=b.size/25}var k={noMaterialTransitions:!1,fonts:[],fontsPath:"",configurationCode:"",configurationMetadataPath:""},l=function(b,d){this.settings=stage.extend(!0,{},k,d);this.apiCore=b;this.renderingStarted=!1;this.fonts={};this.loadedFonts={};this.loadingFonts={};t.call(this,
this.settings.fonts);this.transactionIds=0;this.transactionTable={};this.presets={};this.presetsByName={};this.presetsBySkus={};this.hasSomePresets=0;this.loadingFontsCallbacks={};this.fontLoadingIds=0;this.nbFontsToLoad={};this.hasSomeMaterialTreesGroups=0;this.materialTreesGroups=[];this.materialTreesGroupsConfigurationsByName={};this.materialTreesGroupsConfigurationsByCode={};this.noMaterialTransitions=this.settings.noMaterialTransitions;this.callerName=this.name="SceneConfiguration";this.apiCore.register(this,
"setSceneBase",g);this.apiCore.register(this,"setScene",q);this.apiCore.register(this,"setFonts",t);this.apiCore.register(this,"updateScene",r);this.apiCore.register(this,"startRendering",f);this.apiCore.register(this,"disable3D",n);this.apiCore.register(this,"resetMaterials",B);this.apiCore.register(this,"resetTextsAndTextures",w);this.apiCore.register(this,"setNoMaterialTransitions",E);this.apiCore.register(this,"removeGroupsAndPresets",F);this.apiCore.register(this,"getCurrentConfigurationCode",
p,!0);this.apiCore.register(this,"getCurrentConfigurationMetadataPath",m,!0);this.apiCore.register(this,"setCurrentConfigurationCode",h);this.apiCore.register(this,"setCurrentConfigurationMetadataPath",v);this.apiCore.register(this,"getMaterialsByMaterialTreetAndMaterialSettingsNames",I,!0);this.apiCore.register(this,"getTexturesFromMaterialByContents",J,!0);this.apiCore.register(this,"createOrGetTexturesFromMaterialByContents",M,!0);this.apiCore.register(this,"getTexturesByMaterialTreeAndMaterialSettingsNamesAndContents",
T,!0);this.apiCore.register(this,"updateCustomTextureByPolylist",U,!0);this.apiCore.register(this,"updateCustomColorByPolylist",Z,!0);this.apiCore.register(this,"updateCustomTexture",R,!0);this.apiCore.register(this,"updatePolylistInstancesCustomTextures",aa,!0);this.apiCore.register(this,"updateCustomColor",ka,!0);this.apiCore.register(this,"updateCustomColorByMaterialsTreesGroupConfiguration",da,!0);this.apiCore.register(this,"updateCustomColorByMaterialsTreesGroupCodeConfiguration",X,!0);this.apiCore.register(this,
"updatePolylistInstancesCustomColor",Ha,!0);this.apiCore.register(this,"transformTexture",C,!0);this.apiCore.register(this,"updatePolylistInstancesTextureTransform",L,!0);this.apiCore.register(this,"setTextureLayer",K,!0);this.apiCore.register(this,"removeTextureLayer",G,!0);this.apiCore.register(this,"exportTexture",S,!0);this.apiCore.register(this,"updateCustomText",ia,!0);this.apiCore.register(this,"updateCustomTextOpenType",Y,!0);this.apiCore.register(this,"updateCustomTexts",Q,!0);this.apiCore.register(this,
"updateCustomTextsOpenType",ta,!0);this.apiCore.register(this,"updateCustomTextsRealDimensions",ua,!0);this.apiCore.register(this,"updatePolylistInstancesCustomTextsRealDimensions",ea,!0);this.apiCore.register(this,"updateCustomTextMaximized",oa,!0);this.apiCore.register(this,"updateSceneCustomTextures",D);this.apiCore.register(this,"updateSceneTexturesTransforms",A);this.apiCore.register(this,"updateSceneTexturesLayers",H);this.apiCore.register(this,"updateSceneCustomColors",e);this.apiCore.register(this,
"updatePolylistMaterial",Va,!0);this.apiCore.register(this,"updateMaterialTrees",la);this.apiCore.register(this,"updateMaterialTreeByName",va,!0);this.apiCore.register(this,"updateMaterialTreeByPolylistName",fa,!0);this.apiCore.register(this,"beginUpdateTransaction",P,!0);this.apiCore.register(this,"beginViewerAnimationTransaction",Ba);this.apiCore.register(this,"endTransaction",Ka,!0);this.apiCore.register(this,"applyPreset",La,!0);this.apiCore.register(this,"setPresets",wa);this.apiCore.register(this,
"applyMaterialTreesGroupsConfigurations",ma,!0);this.apiCore.register(this,"applyMaterialTreesGroupsConfigurations2",bb,!0);this.apiCore.register(this,"applyMaterialTreesGroupsCodeConfigurations",gb,!0);this.apiCore.register(this,"applyMaterialTreesGroupsCodeConfigurations2",ib,!0);this.apiCore.register(this,"getCurrentMaterialTreesGroupConfigurations",Sa,!0);this.apiCore.register(this,"getMaterialTreesGroupFromMaterialTree",ra,!0);this.apiCore.register(this,"getSceneConfigurationData",Ya,!0);this.apiCore.register(this,
"createTextImg",hb,!0);this.apiCore.register(this,"createTextImgOpentype",fb,!0);this.apiCore.register(this,"createTextsImgOpentype",Aa,!0);this.apiCore.register(this,"getWidthTextImgOpentype",eb,!0);this.apiCore.register(this,"getWidthTextsImgOpentype",ab,!0);this.apiCore.register(this,"createTextsImg",Ma,!0);this.apiCore.register(this,"convertFromCustomContentPath",Ga,!0);this.apiCore.register(this,"convertToCustomContentPath",Fa,!0);this.apiCore.register(this,"registerCustomText",xa)};l.prototype.destroy=
function(){this.destroyed||(this.destroyed=!0,this.apiCore.unregister(this,"setSceneBase"),this.apiCore.unregister(this,"setScene"),this.apiCore.unregister(this,"setFonts"),this.apiCore.unregister(this,"updateScene"),this.apiCore.unregister(this,"startRendering"),this.apiCore.unregister(this,"disable3D"),this.apiCore.unregister(this,"resetMaterials"),this.apiCore.unregister(this,"resetTextsAndTextures"),this.apiCore.unregister(this,"setNoMaterialTransitions"),this.apiCore.unregister(this,"removeGroupsAndPresets"),
this.apiCore.unregister(this,"getCurrentConfigurationCode"),this.apiCore.unregister(this,"getCurrentConfigurationMetadataPath"),this.apiCore.unregister(this,"setCurrentConfigurationCode"),this.apiCore.unregister(this,"setCurrentConfigurationMetadataPath"),this.apiCore.unregister(this,"getMaterialsByMaterialTreetAndMaterialSettingsNames"),this.apiCore.unregister(this,"getTexturesFromMaterialByContents"),this.apiCore.unregister(this,"createOrGetTexturesFromMaterialByContents"),this.apiCore.unregister(this,
"getTexturesByMaterialTreeAndMaterialSettingsNamesAndContents"),this.apiCore.unregister(this,"updateCustomTextureByPolylist"),this.apiCore.unregister(this,"updateCustomColorByPolylist"),this.apiCore.unregister(this,"updateCustomTexture"),this.apiCore.unregister(this,"updatePolylistInstancesCustomTextures"),this.apiCore.unregister(this,"updateCustomColor"),this.apiCore.unregister(this,"updateCustomColorByMaterialsTreesGroupConfiguration"),this.apiCore.unregister(this,"updateCustomColorByMaterialsTreesGroupCodeConfiguration"),
this.apiCore.unregister(this,"updatePolylistInstancesCustomColor"),this.apiCore.unregister(this,"transformTexture"),this.apiCore.unregister(this,"updatePolylistInstancesTextureTransform"),this.apiCore.unregister(this,"setTextureLayer"),this.apiCore.unregister(this,"removeTextureLayer"),this.apiCore.unregister(this,"exportTexture"),this.apiCore.unregister(this,"updateCustomText"),this.apiCore.unregister(this,"updateCustomTextOpenType"),this.apiCore.unregister(this,"updateCustomTexts"),this.apiCore.unregister(this,
"updateCustomTextsOpenType"),this.apiCore.unregister(this,"updateCustomTextsRealDimensions"),this.apiCore.unregister(this,"updatePolylistInstancesCustomTextsRealDimensions"),this.apiCore.unregister(this,"updateCustomTextMaximized"),this.apiCore.unregister(this,"updateSceneCustomTextures"),this.apiCore.unregister(this,"updateSceneTexturesTransforms"),this.apiCore.unregister(this,"updateSceneTexturesLayers"),this.apiCore.unregister(this,"updateSceneCustomColors"),this.apiCore.unregister(this,"updatePolylistMaterial"),
this.apiCore.unregister(this,"updateMaterialTrees"),this.apiCore.unregister(this,"updateMaterialTreeByName"),this.apiCore.unregister(this,"updateMaterialTreeByPolylistName"),this.apiCore.unregister(this,"beginUpdateTransaction"),this.apiCore.unregister(this,"beginViewerAnimationTransaction"),this.apiCore.unregister(this,"endTransaction"),this.apiCore.unregister(this,"applyPreset"),this.apiCore.unregister(this,"setPresets"),this.apiCore.unregister(this,"applyMaterialTreesGroupsConfigurations"),this.apiCore.unregister(this,
"applyMaterialTreesGroupsConfigurations2"),this.apiCore.unregister(this,"applyMaterialTreesGroupsCodeConfigurations"),this.apiCore.unregister(this,"applyMaterialTreesGroupsCodeConfigurations2"),this.apiCore.unregister(this,"getCurrentMaterialTreesGroupConfigurations"),this.apiCore.unregister(this,"getMaterialTreesGroupFromMaterialTree"),this.apiCore.unregister(this,"getSceneConfigurationData"),this.apiCore.unregister(this,"createTextImg"),this.apiCore.unregister(this,"createTextsImg"),this.apiCore.unregister(this,
"createTextImgOpentype"),this.apiCore.unregister(this,"createTextsImgOpentype"),this.apiCore.unregister(this,"getWidthTextImgOpentype"),this.apiCore.unregister(this,"getWidthTextsImgOpentype"),this.apiCore.unregister(this,"convertFromCustomContentPath"),this.apiCore.unregister(this,"convertToCustomContentPath"),this.apiCore.unregister(this,"registerCustomText"),this.settings=this.scene=this.apiCore=null,delete this.transactionTable,this.canvas&&(this.canvas.width=0,this.canvas.height=0,delete this.canvas,
delete this.ctx))};var g=function(b){this.scene=b;Ja.call(this);Ra.call(this);H.call(this);A.call(this);e.call(this)},q=function(b){b!==this.scene?g.call(this,b):this.scene=b},t=function(b){if(b){b=$jscomp.makeIterator(b);for(var d=b.next();!d.done;d=b.next())d=d.value,this.fonts[d.name]=d}},r=function(b){this.scene===b&&(Ja.call(this),Ra.call(this))},f=function(){this.renderingStarted=!0},n=function(){},B=function(){if(this.scene){P.call(this);for(var b in this.scene.materialTrees){var d=this.scene.materialTrees[b];
va.call(this,d.name,this.scene.materialSettings[d.defaultMaterialId].name,[],0)}Ka.call(this)}},w=function(b){var d=[];for(h in this.scene.originalTextures){var e=this.scene.textures[h],f=e.loaded;e.transform([0,0,0],0,[1,1,1],[0,0,0]);e.update(this.scene.originalTextures[h]);f&&d.push.apply(d,$jscomp.arrayFromIterable(e.images))}for(var g in this.scene.customColors){e=this.scene.customColors[g];var h=this.scene.getGlobal("Material",g);for(var k in e){f=k.split(".");var l=h;for(e=0;e<f.length;++e)l[f[e]]||
(l[f[e]]={}),l=l[f[e]];l.originalColor&&(l.color=l.originalColor)}}this.scene.customTexts=[];this.scene.customTextures={};this.scene.customColors={};var m=d.length;g=stage.setContext(function(){if(!--m){for(var d in this.scene.polylistInstances)this.scene.polylistInstances[d].matAnim.reloadMaterial();b&&b()}},this);if(d.length)for(e=0;e<d.length;++e)d[e].download(!0,g);else m=1,g()},D=function(b,d){if(this.scene){var e=[],f=[],g=0;for(l in this.scene.customTextures){var h=this.scene.customTextures[l];
if(h.metadata&&h.metadata.texts&&!h.sourceImage){f.push(h);++g;h=h.metadata;-1===e.indexOf(h.font)&&e.push(h.font);for(var k=0;k<h.texts.length;++k)h.texts[k].font&&-1===e.indexOf(h.texts[k].font)&&e.push(h.texts[k].font)}}var l=stage.setContext(function(){var e=!1,h=stage.setContext(function(){if(!e){e=!0;var f=0,g=function(){if(!--f){var b=[],e;for(e in this.scene.customTextures){var g=this.scene.customTextures[e],h=this.scene.textures[g.textureId];g=g.sourceImage;var k=stage.extend(!1,{},h);k.layer.image=
g;h.finalImage&&0>h.finalImage.id&&b.push(h.finalImage);h.update(k)}for(var l in this.scene.customPolylistInstancesTextures){h=this.scene.customPolylistInstancesTextures[l];var m=h.polylistInstance;for(e=0;e<h.images.length;++e){k=h.images[e];g=k.sourceImage;for(var p=M.call(this,m.customMaterial,[k.path]),n=0;n<p.length;++n)k=stage.extend(!1,{},p[n]),k.layer.image=g,p[n].finalImage&&0>p[n].finalImage.id&&b.push(p[n].finalImage)}}for(e in this.scene.polylistInstances)this.scene.polylistInstances[e].matAnim.reloadMaterial();
b=stage.array.uniq(b);for(e=0;e<b.length;++e)this.scene.texturesManager.deleteLocalSourceImage(b[e]);d&&d()}},h=[],k;for(k in this.scene.customTextures)h.push(this.scene.customTextures[k].sourceImage);for(var l in this.scene.customPolylistInstancesTextures){var m=this.scene.customPolylistInstancesTextures[l];for(k=0;k<m.images.length;++k)h.push(m.images[k].sourceImage)}h=stage.array.uniq(h);if(f=h.length)for(k=0;k<h.length;++k)this.scene.loaded&&this.renderingStarted&&!b?h[k].download(!0,stage.setContext(g,
this)):g.call(this);else d&&d()}},this);if(g){for(var k=0;k<f.length;++k)if(!f[k].sourceImage){var l=stage.extend(!0,{},f[k].metadata),m=stage.setContext(function(b,d){b.sourceImage=this.scene.texturesManager.createLocalImageRGBA({imageData:d,width:b.metadata.imageWidth,height:b.metadata.imageHeight});--g||h()},this,f[k]),p=stage.setContext(function(b,d,e){b=document.createElement("canvas");b.width=1;b.height=1;e=b.getContext("2d");e.fillStyle="rgba(0,0,0,0)";e.fillRect(0,0,1,1);e=b.toDataURL("image/png");
delete b;d(e)},this,f[k],m);switch(f[k].metadata.creationCall){case "updateCustomTextsOpenType":Aa.call(this,l,m,p);break;case "updateCustomTextsRealDimensions":var n=this.scene.textures[f[k].textureId].uvsrc,q=this.scene.texturesManager.findTextureMaterial(f[k].textureId);q&&q.material.materialTree.polylistInstances.length?Oa.call(this,q.material.materialTree.polylistInstances[0],n,l,m,p):--g;break;case "updateCustomTextMaximized":Qa.call(this,l,!1,m,p);break;default:f[k].sourceImage=this.scene.texturesManager.createLocalImageRGBA({imageData:Ma.call(this,
l),width:f[k].metadata.imageWidth,height:f[k].metadata.imageHeight}),--g}}g||h()}else h()},this);e.length?this.apiCore.exec(this.callerName,"ui.waitFontsLoading",e,l,l):l()}},A=function(){if(this.scene){for(var b in this.scene.texturesTransforms){var d=this.scene.texturesTransforms[b];this.scene.textures[d.textureId]&&this.scene.textures[b].transform([-d.translation[0],d.translation[1],0],d.rotation,d.scaling,d.rotationCenter)}if(this.scene.texturesManager)for(b in this.scene.polylistInstances)this.scene.polylistInstances[b].matAnim.reloadMaterial()}},
H=function(){if(this.scene)for(var b in this.scene.texturesLayers){var d=this.scene.texturesLayers[b];if(this.scene.textures[d.textureId]){this.scene.textures[d.textureId].layers=[this.scene.textures[d.textureId].layers.shift()];for(var e in d.layers){this.scene.textures[d.textureId].updateLayer(d.layers[e]);for(var f=this.scene.texturesManager.getTexturesInstances(d.textureId),g=0;g<f.length;++g)f[g].updateLayer(d)}}}},e=function(){if(this.scene)for(var b in this.scene.customColors){var d=this.scene.customColors[b],
e=this.scene.materials[b],f;for(f in d)ba.call(this,e,[f],d[f]);d=[].concat(e.polylists);for(e=0;e<d.length;++e)d[e].matAnim.reloadMaterial()}},E=function(b){this.noMaterialTransitions=b},F=function(){this.presets={};this.presetsByName={};this.presetsBySkus={};this.hasSomeMaterialTreesGroups=this.hasSomePresets=0;this.materialTreesGroups=[];this.materialTreesGroupsConfigurationsByName={};this.materialTreesGroupsConfigurationsByCode={}},p=function(){return this.settings.configurationCode},m=function(){return this.settings.configurationMetadataPath},
h=function(b){this.settings.configurationCode=b},v=function(b){this.settings.configurationMetadataPath=b},I=function(b,d,e){if(!this.scene)return[];var f=[];e=e?this.scene.getAll("MaterialTree"):this.scene.materialTrees;for(var g in e)if(e[g].name===b){var h=this.scene.materialsContent.materialSettingsByName[e[g].id][d];h&&(h=this.scene.materials[h.id])&&f.push(h)}return f},J=function(b,d){var e=[],f;for(f in d)2==d[f].length?b[d[f][0]]&&b[d[f][0]]&&d[f][1]&&b[d[f][0]][d[f][1]]&&e.push(b[d[f][0]][d[f][1]]):
b[d[f][0]]&&b[d[f][0]]&&d[f][1]&&b[d[f][0]][d[f][1]]&&d[f][2]&&b[d[f][0]][d[f][1]][d[f][2]]&&e.push(b[d[f][0]][d[f][1]][d[f][2]]);return e},M=function(b,d){var e=[],f;for(f in d)b[d[f][0]]||(b[d[f][0]]={}),b[d[f][0]][d[f][1]]||(b[d[f][0]][d[f][1]]={layer:{}}),2==d[f].length?e.push(b[d[f][0]][d[f][1]]):(b[d[f][0]][d[f][1]][d[f][2]]||(b[d[f][0]][d[f][1]][d[f][2]]={layer:{}}),e.push(b[d[f][0]][d[f][1]][d[f][2]]));return e},T=function(b,d,e,f){var g=[];b=I.call(this,b,d,f);for(var h in b)g=g.concat(J.call(this,
b[h],e));return g},U=function(b,d,e,f,g){if(this.scene){++this.scene.stopDraw;var h=0,k=[],l=[],m;for(m in this.scene.nodesInUse){var p=this.scene.nodesInUse[m];if(p.polylists)for(var n in p.typedMaterials)for(var q in p.typedMaterials[n]){var t=this.scene.polylists[p.typedMaterials[n][q].polylist];if(t.name==b){var r=this.scene.materialsContent.materialSettingsByName[p.typedMaterials[n][q].material][d];if(r&&(r=this.scene.materials[r.id])){for(var u in f){var v=r[f[u][0]][f[u][1]];if(v){var w=stage.extend(!1,
v);w.imageData=e;v.update(w)}}++h;l=l.concat(t.instances);r.onload=stage.setContext(function(b,d){b=this.scene.texturesManager.getTexturesFromMaterial(b);for(var e=0;e<b.length;++e)b[e].checkLoading();if(!--h){for(e=0;e<d.length;++e)d.matAnim.reloadMaterial();--this.scene.stopDraw;this.apiCore.exec(this.callerName,"rdr.updateSceneMaterials",this.scene);this.apiCore.exec(this.callerName,"rdr.updateShaders",this.scene);this.apiCore.exec(this.callerName,"rdr.forceUpdate",1);this.apiCore.exec(this.callerName,
"onEndUpdateCustomTexture",g)}},this,r,l);k.push(r)}}}}k.length?this.scene.texturesManager.downloadMaterials(k):(--this.scene.stopDraw,this.apiCore.exec(this.callerName,"onEndUpdateCustomTexture",g))}},R=function(b,d,e,f,g,h,k,l,m){if(this.scene){for(var p=I.call(this,b,d),n=[],q=0;q<p.length;++q){var t=p[q],r=J.call(this,t,f);r.length&&n.push({material:t,textures:r})}if(n.length){var v=this.scene.texturesManager.createLocalImageRGBA({imageData:e,width:void 0!==h?h:3,height:void 0!==k?k:3,onImageDownloadError:stage.setContext(function(){--this.scene.stopDraw;
console.log("download error",this.scene.stopDraw);this.apiCore.exec(this.callerName,"onErrorUpdateCustomTexture",g)},this)});Ia.call(this,b,d,f,v,l);b=stage.setContext(function(b){b=[];for(var d=0;d<n.length;++d){for(var e=n[d].material,f=n[d].textures,h=0;h<f.length;++h){var k=stage.extend(!1,{},f[h]);k.layer.image=v;f[h].finalImage&&0>f[h].finalImage.id&&b.push(f[h].finalImage);f[h].update(k)}e=[].concat(e.polylists);for(f=0;f<e.length;++f)e[f].matAnim.reloadCurrentMaterials()}b=stage.array.uniq(b);
for(d=0;d<b.length;++d)this.scene.texturesManager.deleteLocalSourceImage(b[d]);this.scene.update();this.apiCore.exec(this.callerName,"onEndUpdateCustomTexture",g,m)},this,n);this.renderingStarted?v.download(!0,b):b()}else this.apiCore.exec(this.callerName,"onEndUpdateCustomTexture",g,m)}},aa=function(b,d){if(this.scene){++this.scene.stopDraw;var e=[],f;for(f in this.scene.polylists){var g=this.scene.polylists[f],h=b[g.name];if(h)for(var k in g.instances){var l=g.instances[k],m=h.localIds.indexOf(l.node.localId);
if(-1!==m){var p=l.customMaterial,n=M.call(this,p,h.contents[m]);n.length&&e.push({material:p,textures:n,polyInst:l,image:this.scene.texturesManager.createLocalImageRGBA({imageData:h.textures[m],width:3,height:3,onImageDownloadError:stage.setContext(function(){--this.scene.stopDraw;console.log("download error",this.scene.stopDraw);this.apiCore.exec(this.callerName,"onErrorUpdateCustomTexture",d)},this)})})}}}var q=e.length,t=stage.setContext(function(b){if(!--q){b=[];for(var f=0;f<e.length;++f){for(var g=
e[f].textures,h=0;h<g.length;++h)stage.extend(!1,{},g[h]).layer.image=e[f].image,g[h].finalImage&&0>g[h].finalImage.id&&b.push(g[h].finalImage);e[f].polyInst.matAnim.reloadCurrentMaterials()}b=stage.array.uniq(b);for(f=0;f<b.length;++f)this.scene.texturesManager.deleteLocalSourceImage(b[f]);this.scene.update();this.apiCore.exec(this.callerName,"onEndUpdateCustomTexture",d)}},this,e);this.renderingStarted?e.length?e.forEach(function(b){b.image.download(!0,t)}):this.apiCore.exec(this.callerName,"onEndUpdateCustomTexture",
d):(q=1,t());this.scene.update();--this.scene.stopDraw}},C=function(b,d,e,f){if(this.scene){b=T.call(this,b,d,e);for(var g in b)for(this.scene.texturesTransforms[b[g].id]||(this.scene.texturesTransforms[b[g].id]={textureId:b[g].id,translation:vec3.create(),scaling:vec3.create(),rotation:0,rotationCenter:vec3.create()}),vec3.set(f.translation,this.scene.texturesTransforms[b[g].id].translation),vec3.set(f.scaling,this.scene.texturesTransforms[b[g].id].scaling),this.scene.texturesTransforms[b[g].id].rotation=
f.rotation,vec3.set(f.rotationCenter,this.scene.texturesTransforms[b[g].id].rotationCenter),b[g].transform([-f.translation[0],f.translation[1],0],f.rotation,f.scaling,f.rotationCenter),instances=this.scene.texturesManager.getTexturesInstances(b[g].id),g=0;g<instances.length;++g)instances[g].transform([-f.translation[0],f.translation[1],0],f.rotation,f.scaling,f.rotationCenter);this.scene.update()}},L=function(b){if(this.scene){++this.scene.stopDraw;for(var d in this.scene.polylists){var e=this.scene.polylists[d],
f=b[e.name];if(f)for(var g in e.instances){var h=e.instances[g],k=f.localIds.indexOf(h.node.localId);-1!==k&&(k=f.transforms[k],h.textureTransform||(h.textureTransform={matrix:mat4.create(),translation:vec3.create(),scaling:vec3.create(),rotation:0,rotationCenter:vec3.create(),negatedRotationCenter:vec3.create()},h.globalUVTransform={angle:0,offsetX:0,offsetY:0,scaleX:1,scaleY:1}),vec3.set(k.translation,h.textureTransform.translation),vec3.set(k.scaling,h.textureTransform.scaling),vec3.set(k.rotationCenter,
h.textureTransform.rotationCenter),vec3.negate(k.rotationCenter,h.textureTransform.negatedRotationCenter),h.textureTransform.rotation=k.rotation,h.globalUVTransform.angle=k.angle,h.globalUVTransform.offsetX=k.offsetX,h.globalUVTransform.offsetY=k.offsetY,h.globalUVTransform.scaleX=k.scaleX,h.globalUVTransform.scaleY=k.scaleY,h.matAnim.reloadCurrentMaterials())}}this.scene.update();--this.scene.stopDraw}},K=function(b,d,e,f){if(this.scene){b=T.call(this,b,d,e);for(var g in b){b[g].updateLayer(f);d=
this.scene.texturesManager.getTexturesInstances(b[g].id);for(e=0;e<d.length;++e)d[e].updateLayer(f);this.scene.texturesLayers[b[g].id]||(this.scene.texturesLayers[b[g].id]={textureId:b[g].id,layers:[]});this.scene.texturesLayers[b[g].id].layers=[];for(e in b[g].layers)b[g].layers[e].images||this.scene.texturesLayers[b[g].id].layers.push(b[g].layers[e])}this.scene.update()}},G=function(b,d,e,f){if(this.scene){b=T.call(this,b,d,e);for(var g in b){b[g].removeLayer(f);d=this.scene.texturesManager.getTexturesInstances(b[g].id);
for(e=0;e<d.length;++e)d[g].removeLayer(f);this.scene.texturesLayers[b[g].id]||(this.scene.texturesLayers[b[g].id]={textureId:b[g].id,layers:[]});this.scene.texturesLayers[b[g].id].layers=[];for(e in b[g].layers)b[g].layers[e].images||this.scene.texturesLayers[b[g].id].layers.push(b[g].layers[e])}this.scene.update()}},S=function(b,d,e,f,g){if(!this.scene)return null;b=T.call(this,b,d,e);if(1!==b.length)return null;f=b[0].getImageData(f);g&&(f=this.apiCore.exec(this.callerName,"encodeImage",f));return f},
Y=function(b,d,e,f,g,h,k){var l=stage.extend(!0,{},e);l.texts=[{text:e.text}];l.mode="horizontal";return ta.call(this,b,d,l,f,g,h,k)},ia=function(b,d,e,f,g,h,k){if(e.consistentDisplay)return Y.call(this,b,d,e,f,g,h,k);var l=stage.extend(!0,{},e);l.texts=[{text:e.text}];l.mode="horizontal";xa.call(this,b,d,l,f);l.creationCall="updateCustomTexts";e=stage.extend(!0,{},l);R.call(this,b,d,Ma.call(this,l),f,g,h,k,e)},Q=function(b,d,e,f,g,h,k,l){if(e.consistentDisplay)return ta.call(this,b,d,e,f,g,h,k,l);
l||xa.call(this,b,d,e,f);e=stage.extend(!0,{},e);e.creationCall="updateCustomTexts";l=stage.extend(!0,{},e);R.call(this,b,d,Ma.call(this,e),f,g,h,k,l)},ta=function(b,d,e,f,g,h,k){var l=void 0!==e.font,m=l&&void 0!==this.fonts[e.font],p;for(p in e.texts){var n=e.texts[p];if(void 0===n.font){if(!m)return stage.createError(327,"updateCustomTextsOpenType text without font and default font "+(l?"was not found.":"is not set."))}else if(void 0===this.fonts[n.font])return stage.createError(327,"updateCustomTextsOpenType text font was not found.")}xa.call(this,
b,d,e,f);var q=stage.extend(!0,{},e);q.creationCall="updateCustomTextsOpenType";l=stage.setContext(function(e){R.call(this,b,d,e,f,g,h,k,q)},this);m=stage.setContext(function(b){this.apiCore.exec(this.callerName,"onErrorUpdateCustomTextsOpenType",g,err)},this);Aa.call(this,e,l,m);return stage.createResult(null)},ua=function(b,d,e,f,g,h){var k=null,l;for(l in this.scene.materialTrees)if(this.scene.materialTrees[l].name==b){if(1<this.scene.materialTrees[l].polylistInstances.length)return stage.createError(325,
"updateCustomTextsRealDimensions configurable material is applied to more than one mesh.");if(!this.scene.materialTrees[l].polylistInstances.length)return stage.createError(325,"updateCustomTextsRealDimensions configurable material is not applied to any mesh.");k=this.scene.materialTrees[l].polylistInstances[0];break}if(!k)return stage.createError(325,"updateCustomTextsRealDimensions configurable material is not applied to any mesh.");var m=I.call(this,b,d),p=[];for(l=0;l<m.length;++l)p=p.concat(J.call(this,
m[l],f));m=-1;for(l=0;l<p.length;++l)if(-1===m&&(m=p[l].uvsrc),m!==p[l].uvsrc)return stage.createError(325,"updateCustomText configurable material is not applied to any mesh.");if(-1===m)return stage.createError(325,"updateCustomText configurable material is not applied to any texture.");h||(h=stage.extend(!0,{},e),h.realDimensions=!0,xa.call(this,b,d,h,f));var n=stage.extend(!0,{},e);n.realDimensions=!0;n.creationCall="updateCustomTextsRealDimensions";Oa.call(this,k,m,e,stage.setContext(function(h,
k){R.call(this,b,d,h,f,g,e.imageWidth,e.imageHeight,n,k)},this),stage.setContext(function(b){this.apiCore.exec(this.callerName,"onErrorUpdateCustomTextsRealDimensions",g,b)},this));return stage.createResult(null)},ea=function(b,d){var e=this;if(this.scene){++this.scene.stopDraw;var f=[],g=1,h=function(){if(!--g){for(var b=[],h=0;h<f.length;++h){for(var k=f[h].textures,l=0;l<k.length;++l)stage.extend(!1,{},k[l]).layer.image=f[h].image,k[l].finalImage&&0>k[l].finalImage.id&&b.push(k[l].finalImage);
f[h].polyInst.matAnim.reloadCurrentMaterials()}b=stage.array.uniq(b);for(h=0;h<b.length;++h)e.scene.texturesManager.deleteLocalSourceImage(b[h]);--e.scene.stopDraw;e.scene.visibilityChanged=!0;e.scene.update();e.apiCore.exec(e.callerName,"onEndUpdateCustomTexture",d)}},k=function(b,g,k,l,m){l=e.scene.texturesManager.createLocalImageRGBA({imageData:l,width:3,height:3,onImageDownloadError:stage.setContext(function(){--this.scene.stopDraw;console.log("download error",this.scene.stopDraw);this.apiCore.exec(this.callerName,
"onErrorUpdatePolylistInstancesCustomTextsRealDimensions",d)},e)});f.push({material:g,textures:k,polyInst:b,image:l});l.download(!0,h)},l;for(l in this.scene.polylists){var m=this.scene.polylists[l],p=b[m.name];if(p)for(var n in m.instances){var q=m.instances[n],t=p.localIds.indexOf(q.node.localId);if(-1!==t){var r=q.customMaterial,v=M.call(this,r,p.contents[t]);if(v.length){var u=Object.keys(q.polylist.geometry.dataBuffers[0].uvs)[0];void 0!==u&&(t=stage.extend(!0,{},p.configurations[t]),t.realDimensionsForInstances=
!0,t.creationCall="updatePolylistInstancesCustomTextsRealDimensions",++g,Oa.call(this,q,u,t,k.bind(this,q,r,v),stage.setContext(function(b){this.apiCore.exec(this.callerName,"onErrorUpdatePolylistInstancesCustomTextsRealDimensions",d,b)},this)))}}}}this.renderingStarted?--g||h():(g=1,h())}},oa=function(b,d,e,f,g,h,k){var l=stage.extend(!0,{},e);l.texts=[{text:e.text}];l.mode="horizontal";xa.call(this,b,d,l,f);l.creationCall="updateCustomTextMaximized";Qa.call(this,e,!1,stage.setContext(function(e,
m){R.call(this,b,d,e,f,g,h,k,l)},this),stage.setContext(function(b){this.apiCore.exec(this.callerName,"onErrorUpdateCustomTextsRealDimensions",g,b)},this))},ba=function(b,d,e){for(var f in d){for(var g=d[f].split("."),h=b,k=0;k<g.length;++k)h[g[k]]||(h[g[k]]={}),h=h[g[k]];h.originalColor||(h.originalColor=h.color);h.color=e}},ka=function(b,d,e,f){if(this.scene){++this.scene.stopDraw;b=I.call(this,b,d);for(var g in b){d=b[g];qa.call(this,d,f,e);ba.call(this,d,f,e);for(var h=[].concat(d.polylists),
k=0;k<h.length;++k)h[k].matAnim.resetMaterial(d)}this.scene.update();--this.scene.stopDraw;this.apiCore.exec(this.callerName,"customColorUpdated")}},Z=function(b,d,e,f){if(this.scene){++this.scene.stopDraw;for(var g in this.scene.polylists){var h=this.scene.polylists[g];if(h.name===b)for(var k in h.instances){var l=h.instances[k],m=this.scene.materialsContent.materialSettingsByName[l.materialTree.id][d];m&&(m=this.scene.materials[m.id])&&(qa.call(this,m,f,e),ba.call(this,m,f,e),l.matAnim.resetMaterial(m))}}this.scene.update();
--this.scene.stopDraw}},da=function(b,d,e,f){if(!this.scene)return stage.createError(302,"Viewer needs to be loaded or fallbackloaded to load the configuration.");b=b+"/"+d;if(!this.materialTreesGroupsConfigurationsByName[b])return stage.createError(316,"The configuration "+b+" does not exist.");b=this.materialTreesGroupsConfigurationsByName[b];++this.scene.stopDraw;b=$jscomp.makeIterator(b);for(d=b.next();!d.done;d=b.next()){d=d.value;for(var g in d.materials){var h=d.materials[g];if(h.ms&&h.mt){h=
this.scene.materials[h.ms.id];qa.call(this,h,f,e);ba.call(this,h,f,e);for(var k=[].concat(h.polylists),l=0;l<k.length;++l)k[l].matAnim.resetMaterial(h)}}}this.scene.update();--this.scene.stopDraw;return stage.createResult(1)},X=function(b,d,e,f){if(!this.scene)return stage.createError(302,"Viewer needs to be loaded or fallbackloaded to load the configuration.");b=b+"/"+d;if(!this.materialTreesGroupsConfigurationsByCode[b])return stage.createError(316,"The configuration "+b+" does not exist.");b=this.materialTreesGroupsConfigurationsByCode[b];
++this.scene.stopDraw;b=$jscomp.makeIterator(b);for(d=b.next();!d.done;d=b.next()){d=d.value;for(var g in d.materials){var h=d.materials[g];if(h.ms&&h.mt){h=this.scene.materials[h.ms.id];qa.call(this,h,f,e);ba.call(this,h,f,e);for(var k=[].concat(h.polylists),l=0;l<k.length;++l)k[l].matAnim.resetMaterial(h)}}}this.scene.update();--this.scene.stopDraw;return stage.createResult(1)},Ha=function(b){if(this.scene){++this.scene.stopDraw;for(var d in this.scene.polylists){var e=this.scene.polylists[d],f=
b[e.name];if(f)for(var g in e.instances){var h=e.instances[g],k=f.localIds.indexOf(h.node.localId);-1!==k&&(ba.call(this,h.customMaterial,f.contents[k],f.colors[k]),h.matAnim.reloadMaterial())}}this.scene.update();--this.scene.stopDraw}},Ga=function(b){switch(b[0]){case "glow":switch(b[1]){case "colorTexture":return"glowColor";case "opacityTexture":return"glowOpacity";case "saturationTexture":return"glowSaturation"}break;case "specular":switch(b[1]){case "intensityTexture":return"specularIntensity";
case "texture":return"specular"}break;case "reflection":switch(b[1]){case "intensityTexture":return"reflectionIntensity";case "texture":return"reflection"}break;case "refraction":switch(b[1]){case "intensityTexture":return"refractionIntensity";case "texture":return"refraction"}break;case "normalDeformation":switch(b[1]){case "scaleTexture":return"normalScale";case "intensityTexture":return"normalDeformationIntensity";case "intensityTexture2":return"normalDeformationIntensity2";case "texture2":return"normalDeformation2";
case "texture":return"normalDeformation"}case "lightMap":switch(b[1]){case "colorTexture":return"lightColor";case "texture":return"lightMap"}break;case "iridescent":switch(b[1]){case "intensityTexture":return"iridescentIntensity";case "texture":return"iridescent"}break;case "occlusion":switch(b[1]){case "ambientTexture":return"occlusionAmbient";case "lightTexture":return"occlusionLight"}case "coating":switch(b[1]){case "intensityTexture":return"coatingIntensity";case "thicknessTexture":return"coatingThickness";
case "roughnessTexture":return"coatingRoughness";case "normalTexture":return"coatingNormal";case "texture":return"coating"}break;case "metalness":switch(b[1]){case "anisotropy":switch(b[2]){case "intensityTexture":return"metalness.anisotropyIntensity";case "roughnessTexture":return"metalness.anisotropyRoughness";case "rotationTexture":return"metalness.anisotropyRotation";case "texture":return"metalness.anisotropy"}break;case "carpaint":switch(b[2]){case "brdfColorTexture":return"metalness.carpaintBrdfColor";
case "flakesSliceLutTexture":return"metalness.flakesSliceLut";case "flakesColorTexture":return"metalness.flakesColor"}break;case "texture":return"metalness"}case "roughness":switch(b[1]){case "sheen":switch(b[2]){case "intensityTexture":return"roughness.sheenIntensity";case "roughnessTexture":return"roughness.sheenRoughness";case "texture":return"roughness.sheen"}break;case "texture":return"roughness"}break;case "emissive":switch(b[1]){case "glow":switch(b[2]){case "colorTexture":return"emissive.glowColor";
case "opacityTexture":return"emissive.glowOpacity";case "saturationTexture":return"emissive.glowSaturation";case "texture":return"emissive.glow"}break;case "intensityTexture":return"emissiveIntensity";case "texture":return"emissive"}break;case "albedo":switch(b[1]){case "specular":switch(b[2]){case "intensityTexture":return"albedo.specularIntensity";case "texture":return"albedo.specular"}break;case "texture":return"albedo"}break;default:return b[0]}},Fa=function(b){switch(b){case "glowColor":return["glow",
"colorTexture"];case "glowOpacity":return["glow","opacityTexture"];case "glowSaturation":return["glow","saturationTexture"];case "specularIntensity":return["specular","intensityTexture"];case "emissiveIntensity":return["emissive","intensityTexture"];case "reflectionIntensity":return["reflection","texture"];case "refractionIntensity":return["refraction","texture"];case "normalScale":return["normalDeformation","scaleTexture"];case "lightColor":return["lightMap","colorTexture"];case "iridescentIntensity":return["iridescent",
"intensityTexture"];case "occlusionAmbient":return["occlusion","ambientTexture"];case "occlusionLight":return["occlusion","lightTexture"];case "coatingIntensity":return["coating","intensityTexture"];case "coatingThickness":return["coating","thicknessTexture"];case "coatingRoughness":return["coating","roughnessTexture"];case "coatingNormal":return["coating","normalTexture"];case "normalDeformationIntensity":return["normalDeformation","intensityTexture"];case "normalDeformation2":return["normal","texture2"];
case "normalDeformationIntensity2":return["normalDeformation","intensityTexture2"];case "metalness.anisotropy":return["metalness","anisotropy","texture"];case "metalness.anisotropyIntensity":return["metalness","anisotropy","intensityTexture"];case "metalness.anisotropyRoughness":return["metalness","anisotropy","roughnessTexture"];case "metalness.anisotropyRotation":return["metalness","anisotropy","rotationTexture"];case "metalness.carpaint.brdfColor":return["metalness","carpaint","brdfColorTexture"];
case "metalness.carpaintFlakesSliceLut":return["metalness","carpaint","FlakesSliceLutTexture"];case "metalness.carpaintFlakesColor":return["metalness","carpaint","FlakesColorTexture"];case "roughness.sheen":return["roughness","texture"];case "roughness.sheenIntensity":return["roughness","sheen","intensityTexture"];case "roughness.sheenRoughness":return["roughness","sheen","roughnessTexture"];case "emissive.glowColor":return["emissive","glow","colorTexture"];case "emissive.glowOpacity":return["emissive",
"glow","opacityTexture"];case "emissive.glowSaturation":return["emissive","glow","saturationTexture"];case "albedo.specular":return["albedo","specular","texture"];case "albedo.specularIntensity":return["albedo","specular","intensityTexture"];case "baseColor":return this.scene&&this.scene.materialsType?["albedo","texture"]:["diffuse","texture"];default:return[b,"texture"]}},xa=function(b,d,e,f){if(this.scene){var g;for(g in this.scene.materialTrees){var h=this.scene.materialTrees[g];if(h.name==b){if(!this.scene.materialsContent.materialSettingsByName[h.id][d])return;
var k=h.id;var l=this.scene.materialsContent.materialSettingsByName[k][d].id}}if(void 0!==l&&void 0!==k){b=stage.extend(!0,{},e);b.mtId=k;b.msId=l;d=[];for(g in f)d.push(Ga(f[g]));b.contents=f;f=[];for(g in this.scene.customTexts)if(e=this.scene.customTexts[g],e.mtId!=k||e.msId!=l)f.push(e);else{h=[];for(var m in e.contents){var p=Ga(e.contents[m]);-1==d.indexOf(p)&&h.push(p)}h.length&&(e.contents=h,f.push(e))}f.push(b);this.scene.customTexts=f}}},Ia=function(b,d,e,f,g){if(this.scene){b=T.call(this,
b,d,e);for(var h in b)d=b[h],this.scene.customTextures[d.id]||(this.scene.customTextures[d.id]={}),this.scene.customTextures[d.id].textureId=d.id,this.scene.customTextures[d.id].sourceImage=f,this.scene.customTextures[d.id].metadata=g}},qa=function(b,d,e){if(this.scene){this.scene.customColors[b.id]||(this.scene.customColors[b.id]={});b=this.scene.customColors[b.id];for(var f in d)b[d[f]]=e}},Va=function(b,d,e,f,g){if(!this.scene||!this.currentTransaction)return[];var h=[];if("string"!=stage.typeOf(b)){var k=
this.scene.polylists[b];if(!k)return[];var l=k.materialTree;l=this.scene.materialsContent.materialSettingsByName[l.id][d];if(!l)return[];l=this.scene.materials[l.id];if(!l)return[];var m=[];if(void 0!==e||void 0!==f)for(var p in k.instances){var n=k.instances[p],q=n.node,t=!0;void 0!==e&&q.localId!=e&&(t=!1);void 0!==f&&q.id!=f&&(t=!1);t&&m.push(n)}else m=k.instances;this.transactionTable[this.currentTransaction].newLinks.push({polylistInstances:m,newId:l.id,time:void 0!==g?g:1E3});h.push(k);l.onload=
this.transactionTable[this.currentTransaction].updateFunction;l.onerror=this.transactionTable[this.currentTransaction].cancelFunction}else for(var r in this.scene.polylists)if(k=this.scene.polylists[r],k.name===b&&(l=k.materialTree,l=this.scene.materialsContent.materialSettingsByName[l.id][d]))if(l=this.scene.materials[l.id]){m=[];if(void 0!==e||void 0!==f)for(p in k.instances)n=k.instances[p],q=n.node,t=!0,void 0!==e&&q.localId!=e&&(t=!1),void 0!==f&&q.id!=f&&(t=!1),t&&m.push(n);else m=k.instances;
this.transactionTable[this.currentTransaction].newLinks.push({polylistInstances:m,newId:l.id,time:void 0!==g?g:1E3});h.push(k);l.onload=this.transactionTable[this.currentTransaction].updateFunction;l.onerror=this.transactionTable[this.currentTransaction].cancelFunction}return stage.array.uniq(h)},va=function(b,d,e,f){if(this.scene&&this.currentTransaction){void 0===e&&(e=[]);var g=[],h;for(h in this.scene.materialTrees)if(this.scene.materialTrees[h].name===b){var k=h,l=this.scene.materialTrees[h],
m=this.scene.materialsContent.materialSettingsByName[k][d];if(m&&(m=this.scene.materials[m.id])){var p=[];if(e.length)for(var n=0;n<l.polylistInstances.length;++n){var q=l.polylistInstances[n];-1!==e.indexOf(q.node.localId)&&p.push(q)}else p=l.polylistInstances;this.transactionTable[this.currentTransaction].newLinks.push({polylistInstances:p,newId:m.id,time:void 0!==f?f:1E3,updateTree:!e.length,materialTree:l});g.push(k);m.onload=this.transactionTable[this.currentTransaction].updateFunction;m.onerror=
this.transactionTable[this.currentTransaction].cancelFunction}}return stage.array.uniq(g)}},la=function(b,d,e){var f=this;this.scene&&this.currentTransaction&&(void 0===d&&(d=[]),b.forEach(function(b){var g=b.mt;b=b.ms;if(g&&b&&f.scene.materials[b.id]){b=f.scene.materials[b.id];var h=[];if(d.length)for(var k=0;k<g.polylistInstances.length;++k){var l=g.polylistInstances[k];-1!==d.indexOf(l.node.localId)&&h.push(l)}else h=g.polylistInstances;f.transactionTable[f.currentTransaction].newLinks.push({polylistInstances:h,
newId:b.id,time:void 0!==e?e:1E3,updateTree:!d.length,materialTree:g});b.onload=f.transactionTable[f.currentTransaction].updateFunction;b.onerror=f.transactionTable[f.currentTransaction].cancelFunction}}))},fa=function(b,d,e){if(this.scene)for(var f in this.scene.polylists){var g=this.scene.polylists[f];if(g.name==b){var h=this.scene.materialsContent.materialSettingsByName[g.materialTree.id][d];h&&(h=this.scene.materials[h.id])&&(this.transactionTable[this.currentTransaction].newLinks.push({polylistInstances:g.instances,
newId:h.id,time:void 0!==e?e:1E3}),h.onload=this.transactionTable[this.currentTransaction].updateFunction,h.onerror=this.transactionTable[this.currentTransaction].cancelFunction)}}},P=function(b){if(!this.scene)return stage.createResult(null);if(b){if(b==this.previousId||this.transactionTable[b])return this.currentTransaction=null,this.apiCore.exec(this.callerName,"onTransactionIdError",b),stage.createResult(null);var d=b}else d=++this.transactionIds;this.transactionTable[this.previousId]&&!this.transactionTable[this.previousId].fromAnimations&&
this.transactionTable[this.previousId].cancelFunction();this.currentTransaction=d;this.transactionTable[d]={cpt:0,newLinks:[],onSuccess:[],cancelled:!1,cancelFunction:stage.setContext(function(){this.transactionTable[d].cancelled||(this.transactionTable[d].cancelled=!0,this.apiCore.exec(this.callerName,"onTransactionError",d),this.apiCore.exec(this.callerName,"ui.hideBasicLoader"),this.currentTransaction=null)},this),updateFunction:stage.setContext(function(){if(this.transactionTable[d]&&!this.transactionTable[d].cancelled&&
0==--this.transactionTable[d].cpt){var b=this.transactionTable[d];this.scene.updateMaterialsFunction.push(stage.setContext(function(){var e=b.newLinks;if(e.length){if(stage.browser.mobilBrowser||"iPad"==navigator.platform||"iPhone"==navigator.platform||this.noMaterialTransitions)for(var f in e){var g=e[f].newId;e[f].updateTree&&(e[f].materialTree.currentMaterialId=g);for(var h in e[f].polylistsToUpdate)e[f].polylistsToUpdate[h].destroyed||e[f].polylistsToUpdate[h].matAnim.resetMaterial(this.scene.materials[g])}else for(f in e)for(h in g=
e[f].newId,e[f].updateTree&&(e[f].materialTree.currentMaterialId=g),e[f].polylistsToUpdate){var k=e[f].polylistsToUpdate[h];k.destroyed||(k.matAnim.cycling||k.matAnim.computeMaterial(this.scene,1E10,this.apiCore),k.matAnim.addAnimations(e[f],this.scene.materials[g]))}this.apiCore.exec(this.callerName,"rdr.updateSceneMaterials",this.scene);this.apiCore.exec(this.callerName,"rdr.updateShaders",this.scene);this.apiCore.exec(this.callerName,"rdr.forceUpdate",10)}for(f in b.onSuccess)b.onSuccess[f]();
this.apiCore.exec(this.callerName,"onTransactionSuccess",d,!!e.length);this.apiCore.exec(this.callerName,"ui.hideBasicLoader")},this));delete this.transactionTable[d]}},this)};this.previousId=d;return stage.createResult(this.previousId)},Ba=function(b,d){if(!this.scene)return stage.createResult(null);var e=++this.transactionIds;this.currentTransaction=e;this.transactionTable[this.previousId]&&this.transactionTable[this.previousId].fromAnimations&&this.transactionTable[this.previousId].cancelFunction();
this.transactionTable[e]={cpt:0,newLinks:[],cancelled:!1,fromAnimations:!0,cancelFunction:stage.setContext(function(){this.transactionTable[e].cancelled||(this.transactionTable[e].cancelled=!0,this.transactionTable[e].cancelFunction=null,this.transactionTable[e].updateFunction=null,d())},this),updateFunction:stage.setContext(function(){this.transactionTable[e]&&!this.transactionTable[e].cancelled&&0===--this.transactionTable[e].cpt&&(this.apiCore.exec(this.callerName,"ui.hideBasicLoader"),b(),delete this.transactionTable[e],
this.currentTransaction=null)},this)};this.previousId=e;return stage.createResult(this.previousId)},Ka=function(){if(!this.scene)return stage.createResult(null);if(!this.currentTransaction)return stage.createError(311,"There is no active transaction.",event);this.apiCore.exec(this.callerName,"ui.showBasicLoader");for(var b=this.transactionTable[this.currentTransaction].newLinks,d={},e=b.length-1;0<=e;e--){for(var f=b[e],g=[],h=f.polylistInstances.length-1;0<=h;h--)d[f.polylistInstances[h].id]||(g.push(f.polylistInstances[h]),
d[f.polylistInstances[h].id]=!0);f.polylistInstances=g}this.transactionTable[this.currentTransaction].cpt=0;d={};for(e in b)if(f=b[e],d[f.newId]||(d[f.newId]=f),f.polylistInstances)for(d[f.newId].polylistsToUpdate||(d[f.newId].polylistsToUpdate=[]),h=0;h<f.polylistInstances.length;++h)f.polylistInstances[h].matAnim.currentMaterial.id!=f.newId&&d[f.newId].polylistsToUpdate.push(f.polylistInstances[h]);b=[];for(e in d)b.push(d[e]),this.transactionTable[this.currentTransaction].cpt+=d[e].polylistsToUpdate.length;
this.transactionTable[this.currentTransaction].newLinks=b;if(b.length){for(e=0;e<b.length;++e)f=b[e],f.polylistsToUpdate.length||++this.transactionTable[this.currentTransaction].cpt;d=[];for(e=0;e<b.length;++e){f=b[e];for(h=0;h<f.polylistsToUpdate.length;++h){g=f.polylistsToUpdate[h];var k={onload:this.transactionTable[this.currentTransaction].updateFunction,onerror:this.transactionTable[this.currentTransaction].cancelFunction};this.scene.fillMaterialNoTextureInstance(k,this.scene.materials[f.newId],
g.polylist.customMaterial,g.customMaterial);d.push(k)}f.polylistsToUpdate.length||(k={onload:this.transactionTable[this.currentTransaction].updateFunction,onerror:this.transactionTable[this.currentTransaction].cancelFunction},this.scene.fillMaterialNoTextureInstance(k,this.scene.materials[f.newId]),d.push(k))}this.scene.texturesManager.downloadMaterials(d)}else this.transactionTable[this.currentTransaction].cpt=1,this.transactionTable[this.currentTransaction].updateFunction();this.currentTransaction=
null;return stage.createResult(null)},wa=function(b,d){d&&Ja.call(this)},Ja=function(){if(this.scene){this.presetsByName={};this.presetsBySkus={};var b=this.scene.getAllGlobal("Preset"),d;for(d in b){++this.hasSomePresets;var e=b[d];for(d in e.materials){var f=e.materials[d];f.mt=this.scene.materialTrees[f.materialTreeId];f.ms=this.scene.materialSettings[f.materialSettingsId]}this.presetsByName[e.name]?this.presetsByName[e.name].push(e):this.presetsByName[e.name]=[e];if(e.skus)for(var g in e.skus)this.presetsBySkus[e.skus[g]]=
e}}},La=function(b,d,e,f){var g=this;if(!this.scene)return stage.createResult(null);if(!(this.presetsByName[b]&&this.presetsByName[b].length||this.presetsBySkus[b]))return stage.createError(315,"The preset "+b+" does not exist.");if(void 0===f){var h=P.call(this);this.transactionTable[h.result].onSuccess.push(stage.setContext(function(){this.apiCore.exec(this.callerName,"presetApplied",b)},this))}var k=[];this.presetsByName[b]&&k.push.apply(k,$jscomp.arrayFromIterable(this.presetsByName[b]));!k.length&&
this.presetsBySkus[b]&&k.push(this.presetsBySkus[b]);if(d&&d.length)d.forEach(function(b){var d=g.scene.productNodeInstancesByLocalId[b];if(d){var f=d.productNode;k.forEach(function(d){var h=g.scene.getParentIdAndTypeFromInstance(d);if(g.scene.getParentIdAndTypeFromInstance(f).id==h.id)for(var k in d.materials)h=d.materials[k],va.call(g,h.mt.name,h.ms.name,[b],e)})}});else{d=k[0];for(var l in d.materials){var m=d.materials[l];va.call(this,m.mt.name,m.ms.name,[],e)}}return void 0===f?(Ka.call(this),
h):stage.createResult(null)},ra=function(b){for(var d in this.materialTreesGroups){var e=this.materialTreesGroups[d],f;for(f in e.materialTrees)if(e.materialTrees[f].id==b)return e}return null},Sa=function(){var b=[],d;for(d in this.materialTreesGroups)b.push({groupName:this.materialTreesGroups[d].name,configurationName:this.materialTreesGroups[d].currentConfiguration?this.materialTreesGroups[d].currentConfiguration.name:null});return b},Ya=function(b){b||(b=this.scene);if(!b)return null;var d={projectCode:b.getCurrentParentTypeAndId().id,
presets:[],materialsGroups:[],materials:[],products:[]},e=b.getAllGlobal("Preset");for(g in e)d.presets.push({name:e[g].name,SKU:e[g].sku,color:e[g].color,thumbnailURL:this.apiCore.exec(this.callerName,"buildLoadingFilePath",e[g].smallPreviewPath)});for(var f in b.materialTreesGroups){e=b.materialTreesGroups[f];var g={code:e.code,name:e.name,configurations:[]};for(var h in e.configurations){var k=e.configurations[h];g.configurations.push({name:k.name,code:k.code})}d.materialsGroups.push(g)}for(var l in b.materialTrees)f=
b.materialTrees[l],d.materials.push({name:f.name,variations:Object.keys(b.materialsContent.materialSettingsByName[f.id])});for(var m in b.productNodes)l=b.productNodes[m],d.products.push({name:l.name,SKU:l.sku,thumbnail:l.thumbnail,boundingBox:l.sourceModel?l.sourceModel.boundingBox:null});return d},Ra=function(){if(this.scene)for(var b in this.scene.materialTreesGroups){var d=this.scene.materialTreesGroups[b];-1===this.materialTreesGroups.indexOf(d)&&this.materialTreesGroups.push(d);if(d){++this.hasSomeMaterialTreesGroups;
d.materialTrees=[];for(var e in d.materialTreesIds)d.materialTrees.push(this.scene.materialTrees[d.materialTreesIds[e]]);var f=null;for(e in d.configurations){var g=d.configurations[e];f||(f=g);for(var h in g.materials){var k=g.materials[h];k.mt=this.scene.materialTrees[k.materialTreeId];k.ms=this.scene.materialSettings[k.materialSettingsId]}g.group=d;d.currentConfiguration||g.name!==d.defaultConfiguration||(d.currentConfiguration=g);this.materialTreesGroupsConfigurationsByName[d.name+"/"+g.name]||
(this.materialTreesGroupsConfigurationsByName[d.name+"/"+g.name]=[]);this.materialTreesGroupsConfigurationsByCode[d.code+"/"+g.code]||(this.materialTreesGroupsConfigurationsByCode[d.code+"/"+g.code]=[]);this.materialTreesGroupsConfigurationsByName[d.name+"/"+g.name].push(g);this.materialTreesGroupsConfigurationsByCode[d.code+"/"+g.code].push(g)}d.currentConfiguration||(d.currentConfiguration=f)}}else this.hasSomeMaterialTreesGroups=0,this.materialTreesGroups=[],this.materialTreesGroupsConfigurationsByName=
{},this.materialTreesGroupsConfigurationsByCode={}},ma=function(b,d){if(!this.scene)return stage.createResult(null);for(var e in b)if(!this.materialTreesGroupsConfigurationsByName[b[e]])return stage.createError(316,"The configuration "+b[e]+" does not exist.");var f=P.call(this);for(e in b){var g=this.materialTreesGroupsConfigurationsByName[b[e]];this.transactionTable[f.result].onSuccess.push(stage.setContext(function(){for(var b=$jscomp.makeIterator(this),d=b.next();!d.done;d=b.next())d=d.value,
d.group.currentConfiguration=d},g));g=$jscomp.makeIterator(g);for(var h=g.next();!h.done;h=g.next())la.call(this,h.value.materials,[],d)}Ka.call(this);return f},bb=function(b,d,e){if(!this.scene)return stage.createResult(null);for(var f in b)if(!this.materialTreesGroupsConfigurationsByName[b[f].name])return stage.createError(316,"The configuration "+b[f].name+" does not exist.");if(void 0===e)var g=P.call(this);for(f in b){var h=this.materialTreesGroupsConfigurationsByName[b[f].name];b[f].nodeLocalIds.length||
(void 0===e?this.transactionTable[g.result].onSuccess.push(stage.setContext(function(){for(var b=$jscomp.makeIterator(this),d=b.next();!d.done;d=b.next())d=d.value,d.group.currentConfiguration=d},h)):this.transactionTable[e].onSuccess.push(stage.setContext(function(){for(var b=$jscomp.makeIterator(this),d=b.next();!d.done;d=b.next())d=d.value,d.group.currentConfiguration=d},h)));h=$jscomp.makeIterator(h);for(var k=h.next();!k.done;k=h.next())la.call(this,k.value.materials,b[f].nodeLocalIds,d)}return void 0===
e?(Ka.call(this),g):stage.createResult(null)},gb=function(b,d){if(!this.scene)return stage.createResult(null);for(var e in b)if(!this.materialTreesGroupsConfigurationsByCode[b[e]])return stage.createError(316,"The configuration "+b[e]+" does not exist.");var f=P.call(this);for(e in b)for(var g=$jscomp.makeIterator(this.materialTreesGroupsConfigurationsByCode[b[e]]),h=g.next();!h.done;h=g.next())h=h.value,this.transactionTable[f.result].onSuccess.push(stage.setContext(function(){this.group.currentConfiguration=
this},h)),la.call(this,h.materials,[],d);Ka.call(this);return f},ib=function(b,d){if(!this.scene)return stage.createResult(null);for(var e in b)if(!this.materialTreesGroupsConfigurationsByCode[b[e].name])return stage.createError(316,"The configuration "+b[e].name+" does not exist.");var f=P.call(this);for(e in b)for(var g=$jscomp.makeIterator(this.materialTreesGroupsConfigurationsByCode[b[e].name]),h=g.next();!h.done;h=g.next())h=h.value,b[e].nodeLocalIds.length||this.transactionTable[f.result].onSuccess.push(stage.setContext(function(){this.group.currentConfiguration=
this},h)),la.call(this,h.materials,b[e].nodeLocalIds,d);Ka.call(this);return f},hb=function(b,d){7<b.color.length?b.color=this.apiCore.exec(this.callerName,"lib.hexToRgba",b.color):(b.color=this.apiCore.exec(this.callerName,"lib.hexToRgb",b.color),b.color[3]=1);7<b.backgroundColor.length?b.backgroundColor=this.apiCore.exec(this.callerName,"lib.hexToRgba",b.backgroundColor):(b.backgroundColor=this.apiCore.exec(this.callerName,"lib.hexToRgb",b.backgroundColor),b.backgroundColor[3]=1);b.strokeColor&&
(7<b.strokeColor.length?b.strokeColor=this.apiCore.exec(this.callerName,"lib.hexToRgba",b.strokeColor):(b.strokeColor=this.apiCore.exec(this.callerName,"lib.hexToRgb",b.strokeColor),b.strokeColor[3]=1));this.canvas||(this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.canvas.width=20,this.canvas.height=270,this.ctx.lineWidth=2,this.ctx.fillStyle="rgba(0,0,0,0)",this.ctx.fillRect(0,0,1,1));var e="";b.italic&&(e+="italic ");b.bold&&(e+="bold ");e+=b.size+"px ";e+=
b.font;this.canvas.width=b.imageWidth;this.canvas.height=b.imageHeight;this.ctx.textAlign="left";this.ctx.textBaseline="bottom";this.ctx.lineWidth=2;this.ctx.font=e;this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);this.ctx.fillStyle="rgba("+b.backgroundColor[0]+","+b.backgroundColor[1]+","+b.backgroundColor[2]+","+b.backgroundColor[3]+")";this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height);this.ctx.fillStyle="rgba("+b.color[0]+","+b.color[1]+","+b.color[2]+","+b.color[3]+")";this.ctx.font=
e;e=b.textOffsetX;var f=b.textOffsetY;switch(b.verticalAlignment){case "top":f+=b.size;break;case "middle":f+=(b.size/2+b.imageHeight)/2;break;case "bottom":f+=b.imageHeight-b.size/2}var g=this.ctx.measureText(b.text);switch(b.horizontalAlignment){case "left":e+=10;break;case "middle":e+=(b.imageWidth-g.width)/2;break;case "right":e+=b.imageWidth-g.width-10}var h=parseInt(b.size)/15,k=-parseInt(b.size)/10;b.underline&&(this.ctx.lineWidth=h,this.ctx.strokeStyle=this.ctx.fillStyle,this.ctx.beginPath(),
this.ctx.moveTo(e,f+k),this.ctx.lineTo(e+g.width,f+k),this.ctx.closePath(),this.ctx.stroke());b.strokeText?(this.ctx.lineWidth=1,b.strokeWidth&&(this.ctx.lineWidth=parseInt(b.strokeWidth)),this.ctx.strokeStyle="rgba("+b.strokeColor[0]+","+b.strokeColor[1]+","+b.strokeColor[2]+","+b.strokeColor[3]+")",b.underline&&(this.ctx.beginPath(),this.ctx.moveTo(e,f+k-.5*h),this.ctx.lineTo(e+g.width,f+k-.5*h),this.ctx.lineTo(e+g.width,f+k+.5*h),this.ctx.lineTo(e,f+k+.5*h),this.ctx.lineTo(e,f+k-.5*h),this.ctx.closePath(),
this.ctx.stroke()),this.ctx.fillText(b.text,e,f),this.ctx.strokeText(b.text,e,f)):this.ctx.fillText(b.text,e,f);if(d)return this.canvas;b=this.canvas.toDataURL("image/png");this.canvas.width=1;this.canvas.height=1;return b},fb=function(b,d,e){b.mode="horizontal";b.texts=[{text:b.text}];return Aa.call(this,b,d,e)},Aa=function(e,f,g){Ta.call(this,e,stage.setContext(function(){this.canvas||(this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.canvas.width=20,this.canvas.height=
270,this.ctx.lineWidth=2,this.ctx.fillStyle="rgba(0,0,0,0)",this.ctx.fillRect(0,0,1,1));7<e.color.length?e.color=this.apiCore.exec(this.callerName,"lib.hexToRgba",e.color):(e.color=this.apiCore.exec(this.callerName,"lib.hexToRgb",e.color),e.color[3]=1);7<e.backgroundColor.length?e.backgroundColor=this.apiCore.exec(this.callerName,"lib.hexToRgba",e.backgroundColor):(e.backgroundColor=this.apiCore.exec(this.callerName,"lib.hexToRgb",e.backgroundColor),e.backgroundColor[3]=1);e.strokeColor&&(7<e.strokeColor.length?
e.strokeColor=this.apiCore.exec(this.callerName,"lib.hexToRgba",e.strokeColor):(e.strokeColor=this.apiCore.exec(this.callerName,"lib.hexToRgb",e.strokeColor),e.strokeColor[3]=1));var g=e.imageWidth,h=e.imageHeight;this.canvas.width=g;this.canvas.height=h;this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);this.ctx.fillStyle="rgba("+e.backgroundColor[0]+","+e.backgroundColor[1]+","+e.backgroundColor[2]+","+e.backgroundColor[3]+")";this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height);
for(var k=0,l=0,m=[],p=0;p<e.texts.length;++p){var n=e.texts[p],q="text color strokeText strokeColor strokeWidth underline italic bold size font offsetX offsetY preSpacing postSpacing countTrailingWhitespaces".split(" ");for(A in q){var t=q[A];void 0===n[t]&&(n[t]=e[t])}void 0===n.preSpacing&&(n.preSpacing=0);void 0===n.postSpacing&&(n.postSpacing=0);n.color&&"string"==typeof n.color&&(7<n.color.length?n.color=this.apiCore.exec(this.callerName,"lib.hexToRgba",n.color):(n.color=this.apiCore.exec(this.callerName,
"lib.hexToRgb",n.color),n.color[3]=1));n.bold?u(n):n.strokeColor&&"string"==typeof n.strokeColor&&(7<n.strokeColor.length?n.strokeColor=this.apiCore.exec(this.callerName,"lib.hexToRgba",n.strokeColor):(n.strokeColor=this.apiCore.exec(this.callerName,"lib.hexToRgb",n.strokeColor),n.strokeColor[3]=1));n.color&&(n.colorRGBA="rgba("+n.color[0]+","+n.color[1]+","+n.color[2]+","+n.color[3]+")");n.strokeColor&&(n.strokeColorRGBA="rgba("+n.strokeColor[0]+","+n.strokeColor[1]+","+n.strokeColor[2]+","+n.strokeColor[3]+
")");n.realFont=this.loadedFonts[n.font];n.bbox=n.realFont.getPath(n.text,0,0,n.size,{kerning:!0,features:{liga:!0,rlig:!0}}).getBoundingBox();q=0;if(n.countTrailingWhitespaces){var r=n.size+"";t=n.realFont._emersya.delimiter;if(t.dimensionsPerFontSize[r])v=t.dimensionsPerFontSize[r];else{var v={};v.glyph=n.realFont.charToGlyph(t.char);v.path=n.realFont.getPath(t.char,0,0,n.size,{kerning:!0,features:{liga:!0,rlig:!0}});v.bbox=v.path.getBoundingBox();var w=(v.glyph.xMax-v.glyph.xMin)/(v.bbox.x2-v.bbox.x1);
v.width=v.glyph.advanceWidth/w;v.height=v.glyph.advanceWidth/w;t.dimensionsPerFontSize[r]=v}r=" "===n.text[n.text.length-1];w=n.text;" "===n.text[0]&&(w=t.char+w,q+=v.width);r&&(w+=t.char,q+=v.width);0<q&&(t=n.realFont.getPath(w,0,0,n.size,{kerning:!0,features:{liga:!0,rlig:!0}}).getBoundingBox(),n.bbox.x1=t.x1,n.bbox.x2=t.x2)}n.italic&&(t=n.realFont.getPath(n.text,0,0,n.size,{kerning:!0,features:{liga:!0,rlig:!0}}),t=d(t),n.bbox.x1=t.newX1,n.bbox.x2=t.newX2);n.height="static"==e.textAlignment?n.size*
(n.realFont.ascender-n.realFont.descender)/n.realFont.unitsPerEm:n.bbox.y2-n.bbox.y1;n.width=n.bbox.x2-n.bbox.x1-q;k=Math.max(n.width,k);l=Math.max(n.height,l)}if("horizontal"===e.mode){for(p=k=0;p<e.texts.length;++p){n=e.texts[p];var A=n.preSpacing;n.offsetX&&(A+=n.offsetX);n.beforeOffset=A;q=A+n.width+n.postSpacing;n.fullWidth=q;k+=q}q=e.textOffsetX;A=e.textOffsetY;switch(e.horizontalAlignment){case "left":q+=10;break;case "middle":q+=(g-k)/2;break;case "right":q+=g-k-10}switch(e.verticalAlignment){case "top":A+=
10;break;case "middle":A+=(h-l)/2;break;case "bottom":A+=h-l-10}h=q;for(p=0;p<e.texts.length;++p){n=e.texts[p];q=k=null;switch(n.verticalAlignment){case "top":k=A;break;case "bottom":q=A+l;break;default:k=A+(l-n.height)/2}g=h-n.bbox.x1;g+=n.beforeOffset;var B;null!==k?B="static"==e.textAlignment?k+n.size:k-n.bbox.y1:null!==q&&(B="static"==e.textAlignment?q:q-n.bbox.y2);n.offsetY&&(B+=n.offsetY);t=n.realFont.getPath(n.text,g,B,n.size,{kerning:!0,features:{liga:!0,rlig:!0}});t.fill=n.colorRGBA;if(void 0!==
n.strokeText?n.strokeText:e.strokeText)t.stroke=n.strokeColorRGBA,t.strokeWidth=n.strokeWidth;n.italic&&d(t);n.underline&&m.push(b(g,B,t.fill,n));m.push(t);h+=n.fullWidth}}else{for(p=l=0;p<e.texts.length;++p)n=e.texts[p],q=p<e.texts.length-1?n.size:n.height,A=n.preSpacing,n.offsetY&&(A+=n.offsetY),q+=A+n.postSpacing,n.beforeOffset=A,n.fullHeight=q,l+=q;q=e.textOffsetX;A=e.textOffsetY;switch(e.horizontalAlignment){case "left":q+=10;break;case "middle":q+=(g-k)/2;break;case "right":q+=g-k-10}switch(e.verticalAlignment){case "top":A+=
10;break;case "middle":A+=(h-l)/2;break;case "bottom":A+=h-l-10}h=A;for(p=0;p<e.texts.length;++p){n=e.texts[p];B=h-n.bbox.y1;"static"==e.textAlignment&&(B=h+n.size);B+=n.beforeOffset;g=q;switch(n.horizontalAlignment){case "left":break;case "right":g+=k-n.width;break;default:g+=(k-n.width)/2}g-=n.bbox.x1;n.offsetX&&(g+=n.offsetX);t=n.realFont.getPath(n.text,g,B,n.size,{kerning:!0,features:{liga:!0,rlig:!0}});t.fill=n.colorRGBA;if(void 0!==n.strokeText?n.strokeText:e.strokeText)t.stroke=n.strokeColorRGBA,
t.strokeWidth=n.strokeWidth;n.italic&&d(t);n.underline&&m.push(b(g,B,t.fill,n));m.push(t);h+=n.fullHeight}}for(var N in m)m[N].draw(this.ctx);m=this.canvas.toDataURL("image/png");this.canvas.width=1;this.canvas.height=1;f(m)},this),g)},eb=function(b,d,e){b.mode="horizontal";b.texts=[{text:b.text}];return ab.call(this,b,d,e)},ab=function(b,e,f){Ta.call(this,b,stage.setContext(function(){this.canvas||(this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.canvas.width=
20,this.canvas.height=270,this.ctx.lineWidth=2,this.ctx.fillStyle="rgba(0,0,0,0)",this.ctx.fillRect(0,0,1,1));7<b.color.length?b.color=this.apiCore.exec(this.callerName,"lib.hexToRgba",b.color):(b.color=this.apiCore.exec(this.callerName,"lib.hexToRgb",b.color),b.color[3]=1);7<b.backgroundColor.length?b.backgroundColor=this.apiCore.exec(this.callerName,"lib.hexToRgba",b.backgroundColor):(b.backgroundColor=this.apiCore.exec(this.callerName,"lib.hexToRgb",b.backgroundColor),b.backgroundColor[3]=1);b.strokeColor&&
(7<b.strokeColor.length?b.strokeColor=this.apiCore.exec(this.callerName,"lib.hexToRgba",b.strokeColor):(b.strokeColor=this.apiCore.exec(this.callerName,"lib.hexToRgb",b.strokeColor),b.strokeColor[3]=1));var f=b.imageHeight;this.canvas.width=b.imageWidth;this.canvas.height=f;this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);this.ctx.fillStyle="rgba("+b.backgroundColor[0]+","+b.backgroundColor[1]+","+b.backgroundColor[2]+","+b.backgroundColor[3]+")";this.ctx.fillRect(0,0,this.canvas.width,
this.canvas.height);var g=0;for(f=0;f<b.texts.length;++f){var h=b.texts[f],k="text color strokeText strokeColor strokeWidth underline italic bold size font offsetX offsetY preSpacing postSpacing countTrailingWhitespaces".split(" "),l;for(l in k){var m=k[l];void 0===h[m]&&(h[m]=b[m])}void 0===h.preSpacing&&(h.preSpacing=0);void 0===h.postSpacing&&(h.postSpacing=0);h.color&&"string"==typeof h.color&&(7<h.color.length?h.color=this.apiCore.exec(this.callerName,"lib.hexToRgba",h.color):(h.color=this.apiCore.exec(this.callerName,
"lib.hexToRgb",h.color),h.color[3]=1));h.bold?u(h):h.strokeColor&&"string"==typeof h.strokeColor&&(7<h.strokeColor.length?h.strokeColor=this.apiCore.exec(this.callerName,"lib.hexToRgba",h.strokeColor):(h.strokeColor=this.apiCore.exec(this.callerName,"lib.hexToRgb",h.strokeColor),h.strokeColor[3]=1));h.color&&(h.colorRGBA="rgba("+h.color[0]+","+h.color[1]+","+h.color[2]+","+h.color[3]+")");h.strokeColor&&(h.strokeColorRGBA="rgba("+h.strokeColor[0]+","+h.strokeColor[1]+","+h.strokeColor[2]+","+h.strokeColor[3]+
")");h.realFont=this.loadedFonts[h.font];h.bbox=h.realFont.getPath(h.text,0,0,h.size,{kerning:!0,features:{liga:!0,rlig:!0}}).getBoundingBox();k=0;if(h.countTrailingWhitespaces){var n=h.size+"";m=h.realFont._emersya.delimiter;if(m.dimensionsPerFontSize[n])p=m.dimensionsPerFontSize[n];else{var p={};p.glyph=h.realFont.charToGlyph(m.char);p.path=h.realFont.getPath(m.char,0,0,h.size,{kerning:!0,features:{liga:!0,rlig:!0}});p.bbox=p.path.getBoundingBox();var q=(p.glyph.xMax-p.glyph.xMin)/(p.bbox.x2-p.bbox.x1);
p.width=p.glyph.advanceWidth/q;p.height=p.glyph.advanceWidth/q;m.dimensionsPerFontSize[n]=p}n=" "===h.text[h.text.length-1];q=h.text;" "===h.text[0]&&(q=m.char+q,k+=p.width);n&&(q+=m.char,k+=p.width);0<k&&(m=h.realFont.getPath(q,0,0,h.size,{kerning:!0,features:{liga:!0,rlig:!0}}).getBoundingBox(),h.bbox.x1=m.x1,h.bbox.x2=m.x2)}h.italic&&(path=h.realFont.getPath(h.text,0,0,h.size,{kerning:!0,features:{liga:!0,rlig:!0}}),m=d(path),h.bbox.x1=m.newX1,h.bbox.x2=m.newX2);h.height="static"==b.textAlignment?
h.size*(h.realFont.ascender-h.realFont.descender)/h.realFont.unitsPerEm:h.bbox.y2-h.bbox.y1;h.width=h.bbox.x2-h.bbox.x1-k;g=Math.max(h.width,g)}if("horizontal"===b.mode)for(f=l=0;f<b.texts.length;++f)h=b.texts[f],g=h.preSpacing,h.offsetX&&(g+=h.offsetX),h.beforeOffset=g,textSize=g+h.width+h.postSpacing,h.fullWidth=textSize,l+=textSize;else l=g;e(l)},this),f)},Ma=function(b,d){7<b.color.length?b.color=this.apiCore.exec(this.callerName,"lib.hexToRgba",b.color):(b.color=this.apiCore.exec(this.callerName,
"lib.hexToRgb",b.color),b.color[3]=1);7<b.backgroundColor.length?b.backgroundColor=this.apiCore.exec(this.callerName,"lib.hexToRgba",b.backgroundColor):(b.backgroundColor=this.apiCore.exec(this.callerName,"lib.hexToRgb",b.backgroundColor),b.backgroundColor[3]=1);b.strokeColor&&(7<b.strokeColor.length?b.strokeColor=this.apiCore.exec(this.callerName,"lib.hexToRgba",b.strokeColor):(b.strokeColor=this.apiCore.exec(this.callerName,"lib.hexToRgb",b.strokeColor),b.strokeColor[3]=1));this.canvas||(this.canvas=
document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.canvas.width=20,this.canvas.height=270,this.ctx.lineWidth=2,this.ctx.fillStyle="rgba(0,0,0,0)",this.ctx.fillRect(0,0,1,1));this.canvas.width=b.imageWidth;this.canvas.height=b.imageHeight;this.ctx.textAlign="left";this.ctx.textBaseline="bottom";this.ctx.lineWidth=2;if("horizontal"===b.mode){var e=0,f=0,g;for(g in b.texts){void 0!==b.texts[g].color&&(7<b.texts[g].color.length?b.texts[g].color=this.apiCore.exec(this.callerName,
"lib.hexToRgba",b.texts[g].color):(b.texts[g].color=this.apiCore.exec(this.callerName,"lib.hexToRgb",b.texts[g].color),b.texts[g].color[3]=1));void 0!==b.texts[g].strokeColor&&(7<b.texts[g].strokeColor.length?b.texts[g].strokeColor=this.apiCore.exec(this.callerName,"lib.hexToRgba",b.texts[g].strokeColor):(b.texts[g].strokeColor=this.apiCore.exec(this.callerName,"lib.hexToRgb",b.texts[g].strokeColor),b.texts[g].strokeColor[3]=1));var h="";void 0!==b.texts[g].italic?b.texts[g].italic&&(h+="italic "):
b.italic&&(h+="italic ");void 0!==b.texts[g].bold?b.texts[g].bold&&(h+="bold "):b.bold&&(h+="bold ");h=void 0!==b.texts[g].size?h+(b.texts[g].size+"px "):h+(b.size+"px ");h=void 0!==b.texts[g].font?h+b.texts[g].font:h+b.font;b.texts[g].realFont=h;this.ctx.font=h;b.texts[g].preSpacing?e+=b.texts[g].preSpacing:b.texts[g].preSpacing=0;b.texts[g].postSpacing?e+=b.texts[g].postSpacing:b.texts[g].postSpacing=0;b.texts[g].textSize=this.ctx.measureText(b.texts[g].text);b.texts[g].textSize.height=void 0!==
b.texts[g].size?parseInt(b.texts[g].size):parseInt(b.size);e+=Math.round(b.texts[g].textSize.width);b.texts[g].textSize.height>f&&(f=Math.round(b.texts[g].textSize.height))}this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);this.ctx.fillStyle="rgba("+b.backgroundColor[0]+","+b.backgroundColor[1]+","+b.backgroundColor[2]+","+b.backgroundColor[3]+")";this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height);h=b.textOffsetX;var k=b.textOffsetY;switch(b.verticalAlignment){case "top":k+=f;
break;case "middle":k+=(f/2+b.imageHeight)/2;break;case "bottom":k+=b.imageHeight-f/2}switch(b.horizontalAlignment){case "left":h+=10;break;case "middle":h+=(b.imageWidth-e)/2;break;case "right":h+=b.imageWidth-e-10}e=0;for(g in b.texts){this.ctx.font=b.texts[g].realFont;var l=h+e+b.texts[g].preSpacing,m=k;switch(b.texts[g].verticalAlignment){case "top":m-=f-b.texts[g].textSize.height;break;case "bottom":break;default:m-=(f-b.texts[g].textSize.height)/2}b.texts[g].offsetY&&(m+=b.texts[g].offsetY);
var n=void 0!==b.texts[g].color?"rgba("+b.texts[g].color[0]+","+b.texts[g].color[1]+","+b.texts[g].color[2]+","+b.texts[g].color[3]+")":"rgba("+b.color[0]+","+b.color[1]+","+b.color[2]+","+b.color[3]+")";this.ctx.fillStyle=n;n=void 0!==b.texts[g].underline?b.texts[g].underline:b.underline;var p=void 0!==b.texts[g].strokeText?b.texts[g].strokeText:b.strokeText,q=parseInt(b.texts[g].textSize.height)/15,t=-parseInt(b.texts[g].textSize.height)/10;n&&(this.ctx.lineWidth=q,this.ctx.strokeStyle=this.ctx.fillStyle,
this.ctx.beginPath(),this.ctx.moveTo(l,m+t),this.ctx.lineTo(l+b.texts[g].textSize.width,m+t),this.ctx.closePath(),this.ctx.stroke());p?(this.ctx.lineWidth=1,b.texts[g].strokeWidth?this.ctx.lineWidth=parseInt(b.texts[g].strokeWidth):b.strokeWidth&&(this.ctx.lineWidth=parseInt(b.strokeWidth)),this.ctx.strokeStyle=b.texts[g].strokeColor?"rgba("+b.texts[g].strokeColor[0]+","+b.texts[g].strokeColor[1]+","+b.texts[g].strokeColor[2]+","+b.texts[g].strokeColor[3]+")":"rgba("+b.strokeColor[0]+","+b.strokeColor[1]+
","+b.strokeColor[2]+","+b.strokeColor[3]+")",n&&(this.ctx.beginPath(),this.ctx.moveTo(l,m+t-.5*q),this.ctx.lineTo(l+b.texts[g].textSize.width,m+t-.5*q),this.ctx.lineTo(l+b.texts[g].textSize.width,m+t+.5*q),this.ctx.lineTo(l,m+t+.5*q),this.ctx.lineTo(l,m+t-.5*q),this.ctx.closePath(),this.ctx.stroke()),this.ctx.fillText(b.texts[g].text,l,m),this.ctx.strokeText(b.texts[g].text,l,m)):this.ctx.fillText(b.texts[g].text,l,m);e+=b.texts[g].preSpacing+b.texts[g].textSize.width+b.texts[g].postSpacing}}else{f=
e=0;for(g in b.texts)void 0!==b.texts[g].color&&(7<b.texts[g].color.length?b.texts[g].color=this.apiCore.exec(this.callerName,"lib.hexToRgba",b.texts[g].color):(b.texts[g].color=this.apiCore.exec(this.callerName,"lib.hexToRgb",b.texts[g].color),b.texts[g].color[3]=1)),void 0!==b.texts[g].strokeColor&&(7<b.texts[g].strokeColor.length?b.texts[g].strokeColor=this.apiCore.exec(this.callerName,"lib.hexToRgba",b.texts[g].strokeColor):(b.texts[g].strokeColor=this.apiCore.exec(this.callerName,"lib.hexToRgb",
b.texts[g].strokeColor),b.texts[g].strokeColor[3]=1)),h="",void 0!==b.texts[g].italic?b.texts[g].italic&&(h+="italic "):b.italic&&(h+="italic "),void 0!==b.texts[g].bold?b.texts[g].bold&&(h+="bold "):b.bold&&(h+="bold "),h=void 0!==b.texts[g].size?h+(b.texts[g].size+"px "):h+(b.size+"px "),h=void 0!==b.texts[g].font?h+b.texts[g].font:h+b.font,b.texts[g].realFont=h,this.ctx.font=h,b.texts[g].preSpacing?f+=b.texts[g].preSpacing:b.texts[g].preSpacing=0,b.texts[g].postSpacing?f+=b.texts[g].postSpacing:
b.texts[g].postSpacing=0,b.texts[g].textSize=this.ctx.measureText(b.texts[g].text),b.texts[g].textSize.height=void 0!==b.texts[g].size?parseInt(b.texts[g].size):parseInt(b.size),f+=Math.round(b.texts[g].textSize.height),b.texts[g].textSize.width>e&&(e=Math.round(b.texts[g].textSize.width));this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);this.ctx.fillStyle="rgba("+b.backgroundColor[0]+","+b.backgroundColor[1]+","+b.backgroundColor[2]+","+b.backgroundColor[3]+")";this.ctx.fillRect(0,0,
this.canvas.width,this.canvas.height);h=b.textOffsetX;k=b.textOffsetY;switch(b.verticalAlignment){case "top":k+=0;break;case "middle":k+=(-f+b.imageHeight)/2;break;case "bottom":k+=b.imageHeight-f}switch(b.horizontalAlignment){case "left":h+=10;break;case "middle":h+=(b.imageWidth-e)/2;break;case "right":h+=b.imageWidth-e-10}f=0;for(g in b.texts){this.ctx.font=b.texts[g].realFont;f+=b.texts[g].preSpacing+b.texts[g].textSize.height;l=h;m=k+f;switch(b.texts[g].horizontalAlignment){case "left":break;
case "right":l+=e-b.texts[g].textSize.width;break;default:l+=(e-b.texts[g].textSize.width)/2}b.texts[g].offsetX&&(l+=b.texts[g].offsetX);n=void 0!==b.texts[g].color?"rgba("+b.texts[g].color[0]+","+b.texts[g].color[1]+","+b.texts[g].color[2]+","+b.texts[g].color[3]+")":"rgba("+b.color[0]+","+b.color[1]+","+b.color[2]+","+b.color[3]+")";this.ctx.fillStyle=n;n=void 0!==b.texts[g].underline?b.texts[g].underline:b.underline;p=void 0!==b.texts[g].strokeText?b.texts[g].strokeText:b.strokeText;q=parseInt(b.texts[g].textSize.height)/
15;t=-parseInt(b.texts[g].textSize.height)/10;n&&(this.ctx.lineWidth=q,this.ctx.strokeStyle=this.ctx.fillStyle,this.ctx.beginPath(),this.ctx.moveTo(l,m+t),this.ctx.lineTo(l+b.texts[g].textSize.width,m+t),this.ctx.closePath(),this.ctx.stroke());p?(this.ctx.lineWidth=1,b.texts[g].strokeWidth?this.ctx.lineWidth=parseInt(b.texts[g].strokeWidth):b.strokeWidth&&(this.ctx.lineWidth=parseInt(b.strokeWidth)),this.ctx.strokeStyle=b.texts[g].strokeColor?"rgba("+b.texts[g].strokeColor[0]+","+b.texts[g].strokeColor[1]+
","+b.texts[g].strokeColor[2]+","+b.texts[g].strokeColor[3]+")":"rgba("+b.strokeColor[0]+","+b.strokeColor[1]+","+b.strokeColor[2]+","+b.strokeColor[3]+")",n&&(this.ctx.beginPath(),this.ctx.moveTo(l,m+t-.5*q),this.ctx.lineTo(l+b.texts[g].textSize.width,m+t-.5*q),this.ctx.lineTo(l+b.texts[g].textSize.width,m+t+.5*q),this.ctx.lineTo(l,m+t+.5*q),this.ctx.lineTo(l,m+t-.5*q),this.ctx.closePath(),this.ctx.stroke()),this.ctx.fillText(b.texts[g].text,l,m),this.ctx.strokeText(b.texts[g].text,l,m)):this.ctx.fillText(b.texts[g].text,
l,m);f+=b.texts[g].postSpacing}}if(d)return this.canvas;b=this.canvas.toDataURL("image/png");this.canvas.width=1;this.canvas.height=1;return b},Ta=function(b,d,e){var f=[];this.loadedFonts[b.font]||f.push(b.font);if(b.texts&&b.texts.length)for(var g=0;g<b.texts.length;++g){var h=b.texts[g];h.font&&-1===f.indexOf(h.font)&&!this.loadedFonts[h.font]&&f.push(h.font)}this.nbFontsToLoad[++this.fontLoadingIds]=f.length;b=stage.setContext(function(b){--this.nbFontsToLoad[b]||d&&d()},this,this.fontLoadingIds);
if(f.length)for(g=0;g<f.length;++g)if(h=f[g],this.fonts[h]){var k=this.fonts[h].doNotUseFontsPath?this.fonts[h].font_file.path:this.settings.fontsPath+this.fonts[h].font_file.path;this.loadingFontsCallbacks[h]||(this.loadingFontsCallbacks[h]={successCallbacks:[],errorCallbacks:[]});this.loadingFontsCallbacks[h].successCallbacks.push(b);-1===this.loadingFontsCallbacks[h].errorCallbacks.indexOf(e)&&this.loadingFontsCallbacks[h].errorCallbacks.push(e);this.loadingFonts[h]||(opentype.load(k,stage.setContext(db,
this,h)),this.loadingFonts[h]=!0)}else e&&e();else d&&d()},db=function(b,d,e){if(d)for(var f in this.loadingFontsCallbacks[b].errorCallbacks)this.loadingFontsCallbacks[b].errorCallbacks[f](d);else for(f in e._emersya={delimiter:{char:"\udbff\udfff",dimensionsPerFontSize:{}}},this.loadedFonts[b]=e,this.loadingFontsCallbacks[b].successCallbacks)this.loadingFontsCallbacks[b].successCallbacks[f]();delete this.loadingFontsCallbacks[b]},Oa=function(b,d,e,f,g){Ta.call(this,e,stage.setContext(function(){this.canvas||
(this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.canvas.width=20,this.canvas.height=270,this.ctx.lineWidth=2,this.ctx.fillStyle="rgba(0,0,0,0)",this.ctx.fillRect(0,0,1,1));7<e.color.length?e.color=this.apiCore.exec(this.callerName,"lib.hexToRgba",e.color):(e.color=this.apiCore.exec(this.callerName,"lib.hexToRgb",e.color),e.color[3]=1);7<e.backgroundColor.length?e.backgroundColor=this.apiCore.exec(this.callerName,"lib.hexToRgba",e.backgroundColor):(e.backgroundColor=
this.apiCore.exec(this.callerName,"lib.hexToRgb",e.backgroundColor),e.backgroundColor[3]=1);e.strokeColor&&(7<e.strokeColor.length?e.strokeColor=this.apiCore.exec(this.callerName,"lib.hexToRgba",e.strokeColor):(e.strokeColor=this.apiCore.exec(this.callerName,"lib.hexToRgb",e.strokeColor),e.strokeColor[3]=1));var h=this.scene.computeUVCoverage(b.polylist,d),k=e.imageWidth,l=e.imageWidth/e.uvRatio,m=h.minX*k,n=h.minY*l,p=h.maxX*k-m,q=h.maxY*l-n;h=p/e.surfaceWidth;this.canvas.width=k;this.canvas.height=
l;this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);this.ctx.fillStyle="rgba("+e.backgroundColor[0]+","+e.backgroundColor[1]+","+e.backgroundColor[2]+","+e.backgroundColor[3]+")";this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height);var t=0;k=[];for(l=0;l<e.texts.length;++l){var r=e.texts[l];r.preSpacing=void 0===r.preSpacing?0:r.preSpacing*h;r.postSpacing=void 0===r.postSpacing?0:r.postSpacing*h;r.color?7<r.color.length?r.color=this.apiCore.exec(this.callerName,"lib.hexToRgba",r.color):
(r.color=this.apiCore.exec(this.callerName,"lib.hexToRgb",r.color),r.color[3]=1):r.color=e.color;r.strokeColor?7<r.strokeColor.length?r.strokeColor=this.apiCore.exec(this.callerName,"lib.hexToRgba",r.strokeColor):(r.strokeColor=this.apiCore.exec(this.callerName,"lib.hexToRgb",r.strokeColor),r.strokeColor[3]=1):e.strokeColor&&(r.strokeColor=e.strokeColor);var v=(void 0!==r.maxTextWidth?r.maxTextWidth:e.maxTextWidth)*h,u=(void 0!==r.maxTextHeight?r.maxTextHeight:e.maxTextHeight)*h;r.realFont=this.loadedFonts[void 0!==
r.font?r.font:e.font];r.fontSize=u*r.realFont.unitsPerEm/(r.realFont.ascender-r.realFont.descender);r.bbox=r.realFont.getPath(r.text,0,0,r.fontSize,{kerning:!0,features:{liga:!0,rlig:!0}}).getBoundingBox();var w=0;if(e.countTrailingWhitespaces){var A=r.fontSize+"",B=r.realFont._emersya.delimiter;if(B.dimensionsPerFontSize[A])Q=B.dimensionsPerFontSize[A];else{var Q={};Q.glyph=r.realFont.charToGlyph(B.char);Q.path=r.realFont.getPath(B.char,0,0,r.fontSize,{kerning:!0,features:{liga:!0,rlig:!0}});Q.bbox=
Q.path.getBoundingBox();var D=(Q.glyph.xMax-Q.glyph.xMin)/(Q.bbox.x2-Q.bbox.x1);Q.width=Q.glyph.advanceWidth/D;Q.height=Q.glyph.advanceWidth/D;B.dimensionsPerFontSize[A]=Q}A=" "===r.text[r.text.length-1];D=r.text;" "===r.text[0]&&(D=B.char+D,w+=Q.width);A&&(D+=B.char,w+=Q.width);0<w&&(B=r.realFont.getPath(D,0,0,r.fontSize,{kerning:!0,features:{liga:!0,rlig:!0}}).getBoundingBox(),r.bbox.x1=B.x1,r.bbox.x2=B.x2)}r.width=r.bbox.x2-r.bbox.x1-w;r.height="static"===e.textAlignment?u:r.bbox.y2-r.bbox.y1;
if(r.width>v){g("The text "+r.text+" does not fit.");return}t=Math.max(r.height,t);k.push(v-r.width)}if("horizontal"===e.mode){v=0;u=t;for(l=0;l<e.texts.length;++l)r=e.texts[l],v+=r.width+r.preSpacing+r.postSpacing;m+=e.textOffsetX*h;n+=e.textOffsetY*h;switch(e.horizontalAlignment){case "middle":m+=(p-v)/2;break;case "right":m+=p-v}switch(e.verticalAlignment){case "middle":n+=(q-u)/2;break;case "bottom":n+=q-u}for(l=v=0;l<e.texts.length;++l){r=e.texts[l];p=m+v+r.preSpacing-r.bbox.x1;q=n;switch(r.verticalAlignment){case "top":switch(e.textAlignment){case "static":q-=
t-r.height*r.realFont.ascender/(r.realFont.ascender-r.realFont.descender);break;case "dynamic":q-=r.bbox.y1}break;case "bottom":switch(e.textAlignment){case "static":q+=t-r.height+r.height*r.realFont.ascender/(r.realFont.ascender-r.realFont.descender);break;case "dynamic":q+=t-r.height-r.bbox.y1}break;default:switch(e.textAlignment){case "static":q+=(t-r.height)/2+r.height*r.realFont.ascender/(r.realFont.ascender-r.realFont.descender);break;case "dynamic":q+=(t-r.height)/2-r.bbox.y1}}r.offsetX&&(p+=
r.offsetX*h);r.offsetY&&(q+=r.offsetY*h);p=r.realFont.getPath(r.text,p,q,r.fontSize,{kerning:!0,features:{liga:!0,rlig:!0}});p.fill="rgba("+r.color[0]+","+r.color[1]+","+r.color[2]+","+r.color[3]+")";if(void 0!==r.strokeText?r.strokeText:e.strokeText)p.stroke="rgba("+r.strokeColor[0]+","+r.strokeColor[1]+","+r.strokeColor[2]+","+r.strokeColor[3]+")",p.strokeWidth=r.strokeWidth;p.draw(this.ctx);v+=r.preSpacing+r.width+r.postSpacing}}else{for(l=u=v=0;l<e.texts.length;++l)r=e.texts[l],v=Math.max(r.width,
v),u="static"==e.textAlignment?u+(r.fontSize*(r.realFont.ascender-r.realFont.descender)/r.realFont.unitsPerEm+r.preSpacing+r.postSpacing):u+(r.height+r.preSpacing+r.postSpacing);m+=e.textOffsetX*h;n+=e.textOffsetY*h;switch(e.horizontalAlignment){case "middle":m+=(p-v)/2;break;case "right":m+=p-v}switch(e.verticalAlignment){case "middle":n+=(q-u)/2;break;case "bottom":n+=q-u}for(l=t=0;l<e.texts.length;++l){r=e.texts[l];t+=r.preSpacing;p=m-r.bbox.x1;q=n+t;q="static"==e.textAlignment?q+r.height*r.realFont.ascender/
(r.realFont.ascender-r.realFont.descender):q+(r.height-r.bbox.y2);switch(r.horizontalAlignment){case "left":break;case "right":p+=v-r.width;break;default:p+=(v-r.width)/2}r.offsetX&&(p+=r.offsetX*h);r.offsetY&&(q+=r.offsetY*h);p=r.realFont.getPath(r.text,p,q,r.fontSize,{kerning:!0,features:{liga:!0,rlig:!0}});p.fill="rgba("+r.color[0]+","+r.color[1]+","+r.color[2]+","+r.color[3]+")";if(void 0!==r.strokeText?r.strokeText:e.strokeText)p.stroke="rgba("+r.strokeColor[0]+","+r.strokeColor[1]+","+r.strokeColor[2]+
","+r.strokeColor[3]+")",p.strokeWidth=r.strokeWidth;p.draw(this.ctx);t="static"==e.textAlignment?t+(r.fontSize*(r.realFont.ascender-r.realFont.descender)/r.realFont.unitsPerEm+r.postSpacing):t+(r.height+r.postSpacing)}}h=this.canvas.toDataURL("image/png");this.canvas.width=1;this.canvas.height=1;f(h,{availableTextsSpace:k})},this),g)},Qa=function(b,d,e,f){Ta.call(this,b,stage.setContext(function(){7<b.color.length?b.color=this.apiCore.exec(this.callerName,"lib.hexToRgba",b.color):(b.color=this.apiCore.exec(this.callerName,
"lib.hexToRgb",b.color),b.color[3]=1);7<b.backgroundColor.length?b.backgroundColor=this.apiCore.exec(this.callerName,"lib.hexToRgba",b.backgroundColor):(b.backgroundColor=this.apiCore.exec(this.callerName,"lib.hexToRgb",b.backgroundColor),b.backgroundColor[3]=1);b.strokeColor&&(7<b.strokeColor.length?b.strokeColor=this.apiCore.exec(this.callerName,"lib.hexToRgba",b.strokeColor):(b.strokeColor=this.apiCore.exec(this.callerName,"lib.hexToRgb",b.strokeColor),b.strokeColor[3]=1));this.canvas||(this.canvas=
document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.canvas.width=20,this.canvas.height=270,this.ctx.lineWidth=2,this.ctx.fillStyle="rgba(0,0,0,0)",this.ctx.fillRect(0,0,1,1));this.canvas.width=b.imageWidth;this.canvas.height=b.imageHeight;this.ctx.textAlign="left";this.ctx.textBaseline="bottom";this.ctx.lineWidth=2;this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);this.ctx.fillStyle="rgba("+b.backgroundColor[0]+","+b.backgroundColor[1]+","+b.backgroundColor[2]+","+
b.backgroundColor[3]+")";this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height);var f=this.loadedFonts[b.font],g=b.imageWidth-b.left-b.right,h=b.imageHeight-b.top-b.bottom;var k=b.text;if(k.length){var l=f.getPath(k,0,0,1E3,{kerning:!0,features:{liga:!0,rlig:!0}}).getBoundingBox();k=l.x2-l.x1;var m=l.y2-l.y1;var n=g/h>k/m?h/m:g/k;k=parseInt(k*n);m=parseInt(m*n);var p=parseInt(l.x1*n);l=parseInt(l.y1*n);n=Math.floor(1E3*n)}else n=l=p=m=k=0;f=f.getPath(b.text,b.left-p+.5*(g-k),b.top-l+.5*(h-m),
n,{kerning:!0,features:{liga:!0,rlig:!0}});f.fill="rgba("+b.color[0]+","+b.color[1]+","+b.color[2]+","+b.color[3]+")";b.strokeText&&(f.stroke="rgba("+b.strokeColor[0]+","+b.strokeColor[1]+","+b.strokeColor[2]+","+b.strokeColor[3]+")",f.strokeWidth=b.strokeWidth);f.draw(this.ctx);d?e(this.canvas):(f=this.canvas.toDataURL("image/png"),this.canvas.width=1,this.canvas.height=1,e(f))},this),f)};return l});stage.provide("emersya.viewer.modules.ui.configurator");
stage.register.call(stage.emersya.viewer.modules.ui,"configurator",function(){var b={},d=function(d,l,g){this.settings=stage.extend(!0,{},b,g);this.parentElement=l;this.configurator={};this.configuratorButtons={};this.configuratorCategories={};this.configuratorContainer=null;this.activeCategoryButton={};this.apiCore=d;this.callerName="UICore-configurator"};d.prototype.destroy=function(){this.configuratorContainer&&(this.configuratorContainer.remove(),this.configuratorContainer=null)};d.prototype.set=
function(b){b?(this.configurator=stage.extend(!0,{},b),u.call(this)):this.configuratorContainer&&(this.configuratorContainer.remove(),this.configuratorContainer=null)};d.prototype.show=function(){this.configuratorContainer&&this.configuratorContainer.show()};d.prototype.hide=function(){this.configuratorContainer&&this.configuratorContainer.hide()};d.prototype.setDefaultConfiguration=function(){var b=[],d;for(d in this.configurator.categories){var g=this.configurator.categories[d];b.push({categoryId:g.id,
buttonId:this.activeCategoryButton[g.id]})}this.apiCore.exec(this.callerName,"switchConfigurations",b)};d.prototype.setButtonColor=function(b){$$stage("#button"+b.id).css({"background-color":b.color})};d.prototype.setButtonTitle=function(b){var d=this.apiCore.exec(this.callerName,"translate","name"+b.id,"ConfiguratorButton");d||(d=b.name);$$stage("#button"+b.id).get(0).title=d};d.prototype.clear=function(b){this.configuratorContainer&&(b?this.configurator.id==b&&(this.configuratorContainer.remove(),
this.configuratorContainer=null):(this.configuratorContainer.remove(),this.configuratorContainer=null))};d.prototype.updateLanguage=function(b){if(this.configurator)for(var d in this.configurator.categories){b=this.configurator.categories[d];for(var g in b.buttons)this.setButtonTitle(b.buttons[g])}};var u=function(){this.configuratorContainer&&this.configuratorContainer.remove();var b=[{tagName:"div",returnActive:!0,attributes:{klass:"configuratorPanel"},childs:[]}],d=[],g;for(g in this.configurator.categories){var q=
this.configurator.categories[g];this.configuratorCategories[q.id]=q;this.activeCategoryButton[q.id]||(this.activeCategoryButton[q.id]=q.defaultButton.id);d.push({tagName:"div",attributes:{klass:"configuratorCategoryContainer, configuratorCategory_"+q.id},childs:[]});var t=[],r;for(r in q.buttons){var f=q.buttons[r];this.configuratorButtons[f.id]=f;var n=this.apiCore.exec(this.callerName,"translate","name"+f.id,"ConfiguratorButton");n||(n=f.name);"#"!==f.color[0]&&(f.color="#"+f.color);t.push({tagName:"div",
attributes:{klass:"bigDarkCircle"},childs:[{tagName:"div",attributes:{klass:"smallDarkCircle"},childs:[{tagName:"div",attributes:{id:"button"+f.id,klass:"buttonContainer",title:n,style:{"background-color":f.color}},events:[{onEvent:"click",callback:stage.setContext(function(b,d){this.apiCore.exec(this.callerName,"switchConfiguration",b,d)},this,q.id,f.id)}]}]}]})}d[g].childs=t}b[0].childs=d;this.configuratorContainer=$$stage(stage.build(this.parentElement.selector[0],b))};d.prototype.switchConfiguration=
function(b,d){var g=this.configuratorButtons[d];b=this.configuratorCategories[b];this.activeCategoryButton[b.id]=d;if(b&&g){d=$$stage("#button"+g.id);b.activeButton&&b.activeButton.removeClass("configuratorActiveButton");d.addClass("configuratorActiveButton");b.activeButton=d;this.apiCore.exec(this.callerName,"beginUpdateTransaction");for(var k in g.materials)d=g.materials[k].accessString.split("/"),this.apiCore.exec(this.callerName,"updateMaterialTreeByName",d[0],d[1],[],this.configurator.transition);
this.apiCore.exec(this.callerName,"endTransaction")}};d.prototype.switchConfigurations=function(b){for(var d=[],g=0;g<b.length;g++){var k=this.configuratorButtons[b[g].buttonId],t=this.configuratorCategories[b[g].categoryId];this.activeCategoryButton[t.id]=b[g].buttonId;if(t&&k){var r=$$stage("#button"+k.id);t.activeButton&&t.activeButton.removeClass("configuratorActiveButton");r.addClass("configuratorActiveButton");t.activeButton=r;for(var f in k.materials)d.push(k.materials[f].accessString)}}if(0<
d.length){this.apiCore.exec(this.callerName,"beginUpdateTransaction");for(g=0;g<d.length;g++)b=d[g].split("/"),this.apiCore.exec(this.callerName,"updateMaterialTreeByName",b[0],b[1],[],this.configurator.transition);this.apiCore.exec(this.callerName,"endTransaction")}};d.prototype.switchConfigurationByName=function(b,d){for(var g in this.configurator.categories){var k=this.configurator.categories[g];if(k.name==b){for(var l in k.buttons)if(b=k.buttons[l],b.name==d){this.apiCore.exec(this.callerName,
"switchConfiguration",k.id,b.id);break}break}}};d.prototype.setConfiguratorTransition=function(b){this.configurator.transition=b};return d});stage.provide("emersya.viewer.modules.watchControls");stage.require("emersya.viewer.modules.API.core");
stage.register.call(stage.emersya.viewer.modules,"watchControls",function(){var b={},d=function(d,k){this.settings=stage.extend(!0,{},b,k);this.apiCore=d;this.triggerId=-9999;this.triggerIds=[-9998,-9997,-9996,-9995,-9994,-9993,-9992,-9991,-9990,-9989];this.setNames="customWatch customWatchSecondHand customWatchDayOfWeekHand customWatchDayHand customWatchMonthHand customWatchSatToSunHand customWatch28to1Hand customWatch29to1Hand customWatch30to1Hand customWatch31to1Hand customWatchDecToJanHandHand".split(" ");
this.days="sun mon tue wed thu fri sat".split(" ");this.fullDays="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" ");this.months="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" ");this.fullMonths="January February March April May June July August September October November December".split(" ");this.monthsLength=[31,(new Date).getFullYear()%4?28:29,31,30,31,30,31,31,30,31,30,31];this.name="watchControls";this.callerName="Watch";this.apiCore.register(this,"setWatch",g);this.apiCore.register(this,
"removeWatch",f);this.apiCore.register(this,"removeScene",u)};d.prototype.destroy=function(){this.apiCore.unregister(this,"setWatch");this.apiCore.unregister(this,"removeWatch");this.apiCore.unregister(this,"removeScene");this.destroyed||(this.destroyed=!0,this.canvas&&(this.canvas.width=0,this.canvas.height=0,this.ctx=this.canvas=null))};var u=function(){this.secondsInterval&&(clearInterval(this.secondsInterval),this.secondsInterval=null);this.timeOut&&(clearTimeout(this.timeOut),this.timeOut=null)},
k=function(b,d,f){return{time:d,animations:[{type:"rotation",double1:f,vec1_x:b.center_x,vec1_y:b.center_y,vec1_z:b.center_z,vec2_x:b.axis_x,vec2_y:b.axis_y,vec2_z:b.axis_z}]}},l=function(b){return{autoStart:"manual",cyclic:!1,name:this.setNames[b+1],states:[{name:"INITIAL",animations:[{triggerId:this.triggerIds[b],totalTime:100,finalState:"INITIAL",cameraPath:[],materials:[],nodes:[]}]}]}},g=function(b){this.secondsInterval&&clearInterval(this.secondsInterval);this.timeOut&&clearTimeout(this.timeOut);
var d=this.apiCore.exec(this.callerName,"rdr.getCurrentScene");if(d){var f=new Date;f.getFullYear();var g=f.getMonth()+1,e=f.getDate(),u=f.getDay(),w=f.getHours(),p=f.getMinutes(),m=f.getSeconds();f=60+f.getTimezoneOffset();("000"+Math.floor((3600*w+60*(p+f)+m)/86.4)%1E3).slice(-3);for(triggerIndex in d.triggers)f=this.triggerIds.indexOf(d.triggers[triggerIndex].id),-1<f?this.triggerIds[f]=q.call(this,d):d.triggers[triggerIndex].id==this.triggerId&&(this.triggerId=q.call(this,d));f=this.baseAnimations?
this.baseAnimations:d.viewerAnimations;for(var h in f){f[h].name=f[h].setName;var v=this.setNames.indexOf(f[h].name);-1<v&&(this.setNames[v]=t.call(this,v,f))}h=[{autoStart:"automatic",cyclic:!1,name:this.setNames[0],states:[{name:"INITIAL",animations:[{triggerId:this.triggerId,totalTime:0,finalState:"READY",cameraPath:[],materials:[],nodes:[]}]}]},l.call(this,0),l.call(this,1),l.call(this,2),l.call(this,3),l.call(this,4),l.call(this,5),l.call(this,6),l.call(this,7),l.call(this,8),l.call(this,9)];
f=h[0].states[0].animations[0].nodes;v=h[1].states[0].animations[0].nodes;var B=h[2].states[0].animations[0].nodes,J=h[3].states[0].animations[0].nodes,M=h[4].states[0].animations[0].nodes,T=h[5].states[0].animations[0].nodes,U=h[6].states[0].animations[0].nodes,R=h[7].states[0].animations[0].nodes,aa=h[8].states[0].animations[0].nodes,C=h[9].states[0].animations[0].nodes,L=h[10].states[0].animations[0].nodes,K;for(K in b.mechParts){var G=b.mechParts[K];if(G.nodeId){var S=-Math.PI/180*G.startDegreesRotation,
Y=G.discreteRotation?G.totalDegreesRotation/360:1;switch(G.type){case "MY":var ia=G.discreteRotation?0:e/31;Y*=-.5235987755982988;S=Y*(g-1+ia)+S;G.discreteRotation?(f.push({id:G.nodeId,localId:1,animations:[k.call(this,G,500,S)]}),M.push({id:G.nodeId,localId:1,animations:[k.call(this,G,10,Y)]}),L.push({id:G.nodeId,localId:1,animations:[k.call(this,G,10,-11*Y)]})):f.push({id:G.nodeId,localId:1,animations:[k.call(this,G,500,S),k.call(this,G,864E5,-.017167173)]});break;case "DM":ia=G.discreteRotation?
0:w/24+p/1440;Y*=-.2026833970057931;S=Y*(e-1+ia)+S;G.discreteRotation?(f.push({id:G.nodeId,localId:1,animations:[k.call(this,G,500,S)]}),J.push({id:G.nodeId,localId:1,animations:[k.call(this,G,10,Y)]}),U.push({id:G.nodeId,localId:1,animations:[k.call(this,G,10,-27*Y)]}),R.push({id:G.nodeId,localId:1,animations:[k.call(this,G,10,-28*Y)]}),aa.push({id:G.nodeId,localId:1,animations:[k.call(this,G,10,-29*Y)]}),C.push({id:G.nodeId,localId:1,animations:[k.call(this,G,10,-30*Y)]})):f.push({id:G.nodeId,localId:1,
animations:[k.call(this,G,500,S),k.call(this,G,864E5,-.202683397)]});break;case "DW":ia=G.discreteRotation?0:w/24+p/1440;Y*=-.8975979010256552;S=Y*(u+ia)+S;G.discreteRotation?(f.push({id:G.nodeId,localId:1,animations:[k.call(this,G,500,S)]}),B.push({id:G.nodeId,localId:1,animations:[k.call(this,G,10,Y)]}),T.push({id:G.nodeId,localId:1,animations:[k.call(this,G,10,-6*Y)]})):f.push({id:G.nodeId,localId:1,animations:[k.call(this,G,500,S),k.call(this,G,864E5,-.8975979)]});break;case "H":f.push({id:G.nodeId,
localId:1,animations:[k.call(this,G,500,-(w%12+p/60)*Math.PI/6),k.call(this,G,864E5,-12.566370614359172)]});break;case "M":f.push({id:G.nodeId,localId:1,animations:[k.call(this,G,500,-(p+m/60)*Math.PI/30),k.call(this,G,864E5,-150.79644737231007)]});break;case "S":S=-m*Math.PI/30-S,G.discreteRotation?(f.push({id:G.nodeId,localId:1,animations:[k.call(this,G,500,S)]}),v.push({id:G.nodeId,localId:1,animations:[k.call(this,G,10,-.10471975511965977)]})):f.push({id:G.nodeId,localId:1,animations:[k.call(this,
G,500,S),k.call(this,G,864E5,-9047.786842338604)]})}}}n.call(this,b.digiParts);this.secondsInterval=setInterval(stage.setContext(function(){var d=this.apiCore.exec(this.callerName,"rdr.getCurrentScene");d&&this.apiCore.exec(this.callerName,"rdr.getWebGLContext")&&(n.call(this,b.digiParts,!0),this.apiCore.exec(this.callerName,"triggerAnimation",d,this.triggerIds[0],stage.emersya.viewer.ANIMATIONS_TRIGGERS.WATCH))},this),1E3);g=864E5-36E5*w-6E4*p-1E3*m;this.timeOut=setTimeout(stage.setContext(r,this),
g);d.animations||(d.animations=[]);for(K=0;K<d.animations.length;++K)-1<this.setNames.indexOf(d.animations[K].name)&&(d.animations.splice(K,1),--K);this.baseAnimations?d.animations=this.baseAnimations.concat(h):(this.baseAnimations=d.viewerAnimations,d.animations=d.viewerAnimations.concat(h));this.apiCore.exec(this.callerName,"setAnimations",d)}},q=function(b){var d=[];for(triggerIndex in b.triggers)d.push(b.triggers[triggerIndex].id);for(animationIndex in b.viewerAnimations){var f=b.viewerAnimations[animationIndex];
for(stateIndex in f.states){var g=f.states[stateIndex];for(transitionIndex in g.animations)d.push(g.animations[transitionIndex].triggerId)}}for(b=this.triggerIds[this.triggerIds.length-1]+1;-1<d.indexOf(b)||b==this.triggerId||-1<this.triggerIds.indexOf(b);)++b;return b},t=function(b,d){var f=[];for(setIndex in d)f.push(d[setIndex].name);d=1;for(var g=this.setNames[b]+"_1";-1<f.indexOf(g);)++d,g=this.setNames[b]+"_"+d;return g},r=function(){var b=new Date,d=b.getMonth()+1,f=b.getDate();b=b.getDay();
var g=this.apiCore.exec(this.callerName,"rdr.getCurrentScene");if(g&&this.apiCore.exec(this.callerName,"rdr.getWebGLContext")){0==b?this.apiCore.exec(this.callerName,"triggerAnimation",g,this.triggerIds[4],stage.emersya.viewer.ANIMATIONS_TRIGGERS.WATCH):this.apiCore.exec(this.callerName,"triggerAnimation",g,this.triggerIds[1],stage.emersya.viewer.ANIMATIONS_TRIGGERS.WATCH);if(1==f)switch(1==d?31:this.monthsLength[d-2]){case 28:this.apiCore.exec(this.callerName,"triggerAnimation",g,this.triggerIds[5],
stage.emersya.viewer.ANIMATIONS_TRIGGERS.WATCH);break;case 29:this.apiCore.exec(this.callerName,"triggerAnimation",g,this.triggerIds[6],stage.emersya.viewer.ANIMATIONS_TRIGGERS.WATCH);break;case 30:this.apiCore.exec(this.callerName,"triggerAnimation",g,this.triggerIds[7],stage.emersya.viewer.ANIMATIONS_TRIGGERS.WATCH);break;default:this.apiCore.exec(this.callerName,"triggerAnimation",g,this.triggerIds[8],stage.emersya.viewer.ANIMATIONS_TRIGGERS.WATCH)}else this.apiCore.exec(this.callerName,"triggerAnimation",
g,this.triggerIds[2],stage.emersya.viewer.ANIMATIONS_TRIGGERS.WATCH);1==d?this.apiCore.exec(this.callerName,"triggerAnimation",g,this.triggerIds[9],stage.emersya.viewer.ANIMATIONS_TRIGGERS.WATCH):this.apiCore.exec(this.callerName,"triggerAnimation",g,this.triggerIds[3],stage.emersya.viewer.ANIMATIONS_TRIGGERS.WATCH);this.timeOut=setTimeout(stage.setContext(r,this),864E5)}},f=function(){this.secondsInterval&&clearInterval(this.secondsInterval);this.timeOut&&clearTimeout(this.timeOut);var b=this.apiCore.exec(this.callerName,
"rdr.getCurrentScene");if(b&&b.animations){for(var d=0;d<b.animations.length;++d)-1<this.setNames.indexOf(b.animations[d].name)&&(b.animations.splice(d,1),--d);this.apiCore.exec(this.callerName,"setAnimations",b);this.apiCore.exec(this.callerName,"resetTextsAndTextures")}},n=function(b,d){var f=new Date;d=f.getFullYear();var g=f.getMonth()+1,e=f.getDate(),k=f.getDay(),l=f.getHours(),n=1>l?12:12<l?l-12:l,m=f.getMinutes(),h=f.getSeconds(),q=Math.floor((new Date-new Date(d,0,0))/864E5);f=60+f.getTimezoneOffset();
f=("000"+Math.floor((3600*l+60*(m+f)+h)/86.4)%1E3).slice(-3);for(var r in b){var t=b[r],u={name:t.name,material_tree:t.material_tree,material_settings:t.material_settings,contents:t.contents,color:t.color,backgroundColor:t.backgroundColor,italic:t.italic,bold:t.bold,imageWidth:t.imageWidth,imageHeight:t.imageHeight,verticalAlignment:t.verticalAlignment,horizontalAlignment:t.horizontalAlignment,size:t.size,font:t.font,textOffsetX:t.textOffsetX,textOffsetY:t.textOffsetY},w=t.format,D="",R;for(R in w)switch(w[R]){case "d":D+=
10>e?"0"+e:e;break;case "j":D+=e;break;case "N":D+=0==k-1?7:k;break;case "w":D+=k+1;break;case "z":D+=q-1;break;case "W":D+=parseInt((q-1)/7);break;case "m":D+=10>g?"0"+g:g;break;case "M":D+=this.months[g-1];break;case "n":D+=g;break;case "t":D+=this.monthsLength[g-1];break;case "L":D+=29==this.monthsLength[1]?1:0;break;case "o":D+=d;break;case "Y":D+=d;break;case "y":D+=(""+d).substr(2,2);break;case "a":D+=12>l?"am":"pm";break;case "A":D+=12>l?"AM":"PM";break;case "B":D+=f;break;case "g":D+=n;break;
case "G":D+=l;break;case "h":D+=10>n?"0"+n:n;break;case "H":D+=10>l?"0"+l:l;break;case "i":D+=10>m?"0"+m:m;break;case "s":D+=10>h?"0"+h:h;break;case "S":D+=1==e?"st":2==e?"nd":3==e?"tr":"th";break;case "D":D+=this.days[k];break;case "l":D+=this.fullDays[k];break;case "F":D+=this.fullMonths[g-1];break;default:D+=w[R]}u.text=D;w=[];for(R in t.contents)switch(t.contents[R]){case "glowColor":w.push(["glow","colorTexture"]);break;case "glowOpacity":w.push(["glow","opacityTexture"]);break;case "glowSaturation":w.push(["glow",
"saturationTexture"]);break;case "specularIntensity":w.push(["specular","intensityTexture"]);break;case "emissiveIntensity":w.push(["emissive","intensityTexture"]);break;case "reflectionIntensity":w.push(["reflection","intensityTexture"]);break;case "refractionIntensity":w.push(["refraction","intensityTexture"]);break;case "normalScale":w.push(["normalDeformation","scaleTexture"]);break;case "lightColor":w.push(["lightMap","colorTexture"]);break;case "iridescentIntensity":w.push(["iridescent","intensityTexture"]);
break;default:w.push([t.contents[R],"texture"])}this.apiCore.exec(this.callerName,"updateCustomTexture",t.material_tree,t.material_settings,B.call(this,u),w,12,t.imageWidth,t.imageHeight)}},B=function(b){b.color=this.apiCore.exec(this.callerName,"lib.hexToRgb",b.color);b.backgroundColor=this.apiCore.exec(this.callerName,"lib.hexToRgb",b.backgroundColor);b.backgroundColor[3]=255;this.canvas||(this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.canvas.width=20,this.canvas.height=
270,this.ctx.lineWidth=2,this.ctx.fillStyle="rgba(0,0,0,0)",this.ctx.fillRect(0,0,1,1));var d="";b.italic&&(d+="italic ");b.bold&&(d+="bold ");d+=b.size+"px ";d+=b.font;this.ctx.textAlign="left";this.ctx.textBaseline="bottom";this.ctx.lineWidth=2;this.ctx.font=d;this.canvas.width=b.imageWidth;this.canvas.height=b.imageHeight;this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);this.ctx.fillStyle="rgba("+b.backgroundColor[0]+","+b.backgroundColor[1]+","+b.backgroundColor[2]+","+b.backgroundColor[3]+
")";this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height);this.ctx.fillStyle="rgba("+b.color[0]+","+b.color[1]+","+b.color[2]+",1)";this.ctx.font=d;d=b.textOffsetX;var f=b.textOffsetY;switch(b.verticalAlignment){case "top":f+=b.size;break;case "middle":f+=(b.size/2+b.imageHeight)/2;break;case "bottom":f+=b.imageHeight-b.size/2}switch(b.horizontalAlignment){case "left":d+=10;break;case "middle":d+=(b.imageWidth-this.ctx.measureText(b.text).width)/2;break;case "right":d+=b.imageWidth-this.ctx.measureText(b.text).width-
10}this.ctx.fillText(b.text,d,f);b=this.canvas.toDataURL("image/png");this.canvas.width=1;this.canvas.height=1;return b};return d});stage.provide("emersya.viewer.modules.modularConfigurator");stage.require("emersya.viewer.modules.API.core");
stage.register.call(stage.emersya.viewer.modules,"modularConfigurator",function(){var b={GLOBAL:1,BY_ZONE:2},d={style:{backgroundOverColor:"#00b1abff",backgroundNormalColor:"#303030DD",backgroundSelectedColor:"#000000DD",foregroundOverColor:"#ffffffff",foregroundNormalColor:"#ffffffff",foregroundSelectedColor:"#00b1abff",neutralOverColor:"#888888ff",neutralNormalColor:"#888888ff",neutralSelectedColor:"#00b1abff",borderColor:"#ffffff30",logoNeutralColor:"#434649",isColorful:!1},furnitureMode:!1,renderBoundingBoxes:!1},
u=function(b,e,f){this.mainContainer=$$stage(e);this.settings=stage.extend(!0,{},d,f);this.apiCore=b;this.mode=1;this.productNodesInstancesContainers={};this.zoneProductNodesInstancesContainers={};this.currentPlaceholderInstances={};this.lastDragId=this.internalDragIds=this.dragIds=0;this.internalDragId=null;this.draggingLocalIds=[];this.draggingProductNodesSettings={};this.graphSlotIds=this.graphZoneIds=0;this.onViewerDrop=stage.setContext(U,this);this.graphNodes=[];this.graphNodesByLocalId={};this.samePosDragTimeout=
null;this.previousMousePosY=this.previousMousePosX=-1;this.oneMouseInRequired=!1;this.currentGlobalFurnitureConfiguration=null;b=this.mainContainer.getWH();this.viewerWidth=b[1];this.viewerHeight=b[0];this.computeMatrix=mat4.create();this.container=this.mainContainer.build([{tagName:"div",returnActive:!0,attributes:{klass:"modularConfiguratorContainer"},events:[],childs:[{tagName:"div",attributes:{klass:"modularConfiguratorPlaceholdersLoadersContainer"}}]}]);this.placeholderPinsContainer=this.container.find(".modularConfiguratorPlaceholdersLoadersContainer");
this.name="modularConfigurator";this.callerName="ModularConfigurator";this.apiCore.register(this,"resize",h);this.apiCore.register(this,"setScene",I);this.apiCore.register(this,"removeScene",J)};u.prototype.modeIs=function(d){return(this.mode&b[d])===b[d]};u.prototype.destroy=function(){this.apiCore.unregister(this,"resize");this.apiCore.unregister(this,"setScene");this.apiCore.unregister(this,"removeScene");this.apiCore.unregister(this,"onAnnotationsMove");this.apiCore.unregister(this,"modularConfigurator.selectSlotProduct");
this.apiCore.unregister(this,"modularConfigurator.toggleUi")};var k=function(b,d,e,f,h){(b=g.call(this,b,na.call(this,d),f,e,h))&&this.apiCore.exec(this.callerName,"toggleMouseTrackingMode",!0,!0);return b},l=function(b,d,e,f,h){(b=g.call(this,b,d,f,e,h))&&this.apiCore.exec(this.callerName,"toggleMouseTrackingMode",!0,!0);return b},g=function(b,d,e,g,h){e||(e=this.draggableProducts[b]);if(!e)return!1;this.currentProductNodeInstanceDropCandidate=null;E.call(this);null===g&&(g=++this.dragIds);this.lastDragId=
g;h&&(h.dataTransfer.setDragImage(new Image,0,0),h.dataTransfer.setData("application/json",'{"dragId": '+g+"}"),h.dataTransfer.setData("text/plain",'{"dragId": '+g+"}"));this.apiCore.exec(this.callerName,"setCursor","grabbing");u.isConfiguratorUIDisabled||Ma.call(this);this.dragging=!0;this.draggingProductNodesSettings[g]={productSettings:[],materialsToApply:null,stopped:!1};this.draggingLocalIds=[];var k=[];h={};this.viewerSize=this.apiCore.exec(this.callerName,"rdr.getCanvasSize");for(var l=0;l<
e.length;++l){var m=e[l],n=m.graphZone.graphNode.node.localId,p=m.connectionMatrix,v=this.scene.productNodeInstancesByLocalId[n];if(this.settings.furnitureMode)n=d?d:this.currentGlobalFurnitureConfiguration?this.currentGlobalFurnitureConfiguration:m.targetZone.defaultConfiguration,2==this.draggingMode?k.length?f.call(this,g,b,m,n,k,h):r.call(this,g,b,m,n,k,h):r.call(this,g,b,m,n,k,h);else{var w=this.scene.get("ProductNode",b),O=w.sourceModel.boundingBox?w.sourceModel.boundingBox.center:[0,0,0];mat4.multiplyVec3(mat4.multiply(v.modelMatrix,
p,t),O,q);m.children=[];v=this.scene.getNewProductNodeInstanceLocalId();this.draggingProductNodesSettings[g].productSettings.push({SKU:w.sku,localId:v,parentLocalId:n,matrix:p,addable:m,furnitureArticle:"",furnitureConfiguration:"",screenPosition:this.apiCore.exec(this.callerName,"rdr.getScreenPosition",q)});this.draggingProductNodesSettings[g].materialsToApply=d;this.draggingLocalIds.push(v);w.sourceModel&&!w.sourceModel.downloaded&&k.push(w)}}b=this.draggingProductNodesSettings[g].productSettings;
2==this.draggingMode&&(b=[b[0]],b[0].relationProductSettings&&b.push(b[0].relationProductSettings));b=this.scene.addProductNodesPlaceholders(b).map(function(b){return{instance:b,renderAsGhost:!0}});2==this.draggingMode&&(d=this.scene.productNodeInstancesByLocalId[this.draggingLocalIds[0]],this.apiCore.exec(this.callerName,"productNodeInstanceDraggingStarted",d,d.boundingBoxWithoutNodes));this.apiCore.exec(this.callerName,"rdr.initSceneBuffers",this.scene);this.apiCore.exec(this.callerName,"rdr.updateSceneLights",
this.scene);b.length?this.apiCore.exec(this.callerName,"rdr.renderProductNodeInstancesAsGhost",b,!0):(this.apiCore.exec(this.callerName,"rdr.updateSceneMaterials",this.scene),this.apiCore.exec(this.callerName,"rdr.updateShaders",this.scene));this.scene.update();setTimeout(stage.setContext(function(){this.apiCore.exec(this.callerName,"loadProductNodes",this.scene,k,stage.setContext(A,this,g))},this),0);return this.oneMouseInRequired=!0},q=[0,0,0],t=mat4.create(),r=function(b,d,e,f,g,h){var k=e.graphZone.graphNode.node.localId,
l=e.relation,m=e.connectionMatrix,n=this.scene.productNodeInstancesByLocalId[k],p=this.apiCore.exec(this.callerName,"ofml.getModularGraphToBuild","|"+d+"|"+f);d=p.nodesToBuild[0];d.boundingBox=e.targetZone.boundingBox?this.scene.copyBoundingBox(e.targetZone.boundingBox):this.scene.createAndFillBoundingBox(-.5,.5,0,1,-.5,.5);d.parentLocalId=k;d.addable=e;d.childrenToBuild=p.nodesToBuild.splice(1,p.nodesToBuild.length-1);d.matrix=m;e.children=[].concat($jscomp.arrayFromIterable(d.childrenToBuild));
e.furnitureConfiguration=f;f=d.productNode;f=f.sourceModel&&f.sourceModel.boundingBox?f.sourceModel.boundingBox.center:[0,0,0];mat4.multiplyVec3(mat4.multiply(n.modelMatrix,m,t),f,q);d.screenPosition=this.apiCore.exec(this.callerName,"rdr.getScreenPosition",q,null,this.viewerSize[0],this.viewerSize[1]);g.push.apply(g,$jscomp.arrayFromIterable(p.productNodesToLoad));this.draggingProductNodesSettings[b].productSettings.push(d);this.draggingProductNodesSettings[b].materialsToApply=p.materialsToApply;
this.draggingLocalIds.push(d.localId);l.addProduct&&(m=this.settings.furnitureMode&&"none"!==l.article?l.article:l.productNodeId,n=Ha.call(this,l,e),p=this.apiCore.exec(this.callerName,"ofml.getModularGraphToBuild","|"+m+"|"+l.defaultConfiguration),f=p.nodesToBuild[0],f.boundingBox=l.boundingBox?this.scene.copyBoundingBox(l.boundingBox):this.scene.createAndFillBoundingBox(-.5,.5,0,1,-.5,.5),f.parentLocalId=d.localId,f.childrenToBuild=p.nodesToBuild.splice(1,p.nodesToBuild.length-1),f.matrix=n,d.childrenToBuild.push.apply(d.childrenToBuild,
[f].concat($jscomp.arrayFromIterable(f.childrenToBuild))),e.relationChildren=[].concat($jscomp.arrayFromIterable(f.childrenToBuild)),g.push.apply(g,$jscomp.arrayFromIterable(p.productNodesToLoad)),d.relationProductSettings=f,this.draggingProductNodesSettings[b].productSettings.push(f),h[m]=f)},f=function(b,d,e,f,g,h){d=e.graphZone.graphNode.node.localId;var k=e.relation,l=e.connectionMatrix,m=this.draggingProductNodesSettings[b].productSettings[0].productNode;m=m.sourceModel&&m.sourceModel.boundingBox?
m.sourceModel.boundingBox.center:[0,0,0];mat4.multiplyVec3(mat4.multiply(this.scene.productNodeInstancesByLocalId[d].modelMatrix,l,t),m,q);e.children=this.draggingProductNodesSettings[b].productSettings[0].addable.children;e.furnitureConfiguration=f;m=null;if(k.addProduct)if(f=this.settings.furnitureMode&&"none"!==k.article?k.article:k.productNodeId,h[f])m={localId:h[f].localId,matrix:Ha.call(this,k,e)},e.relationChildren=[].concat($jscomp.arrayFromIterable(h[f].childrenToBuild));else{m=Ha.call(this,
k,e);k=this.apiCore.exec(this.callerName,"ofml.getModularGraphToBuild","|"+f+"|"+k.defaultConfiguration);var n=k.nodesToBuild[0];n.boundingBox=this.scene.createAndFillBoundingBox(-.5,.5,0,1,-.5,.5);n.parentLocalId=rootToBuild.localId;n.childrenToBuild=k.nodesToBuild.splice(1,k.nodesToBuild.length-1);n.matrix=m;e.relationChildren=[].concat($jscomp.arrayFromIterable(n.childrenToBuild));g.push.apply(g,$jscomp.arrayFromIterable(k.productNodesToLoad));rootToBuild.relationProductSettings=n;this.draggingProductNodesSettings[b].productSettings.push(n);
m=h[f]=n}this.draggingProductNodesSettings[b].productSettings.push({addable:e,matrix:l,parentLocalId:d,screenPosition:this.apiCore.exec(this.callerName,"rdr.getScreenPosition",q,null,this.viewerSize[0],this.viewerSize[1]),relationProductSettings:m})},n=function(b,d,e){var f=this,g={cnt:0,toUpdate:[]},h=stage.setContext(function(b){if(++b.cnt==b.toUpdate.length&&!b.cancelled){for(var d in b.toUpdate)b.toUpdate[d].polyInst.matAnim.resetMaterial(b.toUpdate[d].mat);e()}},this,g),k=stage.setContext(function(b){b.cancelled=
!0;++b.cnt==b.toUpdate.length&&this.apiCore.exec(this.callerName,"onError","configuration download error")},this,g),l=[],m={},n;for(n in b.materials){m.$jscomp$loop$prop$toApply$287=b.materials[n];m.$jscomp$loop$prop$toApply$287.materialTree||(m.$jscomp$loop$prop$toApply$287.materialTree=Object.values(this.scene.materialTrees).filter(function(b){return function(d){return d.name===b.$jscomp$loop$prop$toApply$287.configurableMaterial}}(m))[0],m.$jscomp$loop$prop$toApply$287.materialSettings=this.scene.materialsContent.materialSettingsByName[m.$jscomp$loop$prop$toApply$287.materialTree.id][m.$jscomp$loop$prop$toApply$287.materialVariation]);
var p=m.$jscomp$loop$prop$toApply$287.materialTree,q=this.scene.materials[m.$jscomp$loop$prop$toApply$287.materialSettings.id],r;for(r in p.polylistInstances){var t=p.polylistInstances[r];if(!d.length||-1!==d.indexOf(t.node.localId)){var v={onload:h,onerror:k};this.scene.fillMaterialNoTextureInstance(v,q,t.polylist.customMaterial,t.customMaterial);t.downloadingMaterial=v;l.push(v);g.toUpdate.push({polyInst:t,mat:q})}}m={$jscomp$loop$prop$toApply$287:m.$jscomp$loop$prop$toApply$287}}m={};for(var u in b.polylists)m.$jscomp$loop$prop$toApply$194$289=
b.polylists[u],m.$jscomp$loop$prop$newMaterial$196$290=this.scene.materials[m.$jscomp$loop$prop$toApply$194$289.materialSettings.id],d.forEach(function(b){return function(d){b.$jscomp$loop$prop$toApply$194$289.polylist.instances.filter(function(b){return b.node.localId==d}).forEach(function(d){var e={onload:h,onerror:k};f.scene.fillMaterialNoTextureInstance(e,b.$jscomp$loop$prop$newMaterial$196$290,d.polylist.customMaterial,d.customMaterial);d.downloadingMaterial=e;l.push(e);g.toUpdate.push({polyInst:d,
mat:b.$jscomp$loop$prop$newMaterial$196$290})})}}(m)),m={$jscomp$loop$prop$toApply$194$289:m.$jscomp$loop$prop$toApply$194$289,$jscomp$loop$prop$newMaterial$196$290:m.$jscomp$loop$prop$newMaterial$196$290};l.length?this.scene.texturesManager.downloadMaterials(l):e()},B=function(b,d){var e=this;this.transactionContent=[];this.apiCore.exec(this.callerName,"beginViewerAnimationTransaction",stage.setContext(function(){for(var b in this.transactionContent){var e=this.scene.materials[this.transactionContent[b].ms.id],
f;for(f in this.transactionContent[b].polylistInstances)this.transactionContent[b].polylistInstances[f].matAnim.resetMaterial(e)}d()},this),stage.setContext(function(){this.apiCore.exec(this.callerName,"onError","configuration download error")},this));for(var f in this.scene.materialTrees);var g={};b=$jscomp.makeIterator(b);for(var h=b.next();!h.done;g={$jscomp$loop$prop$productNodesIds$293:g.$jscomp$loop$prop$productNodesIds$293},h=b.next()){h=h.value;var k=h.materialsToApply;g.$jscomp$loop$prop$productNodesIds$293=
h.productNodesIds;for(f in k.materials){var l=k.materials[f];this.apiCore.exec(this.callerName,"updateMaterialTreeByName",l.materialTree.name,l.materialSettings.name,g.$jscomp$loop$prop$productNodesIds$293,0);this.transactionContent.push({mt:l.materialTree,ms:l.materialSettings,polylistInstances:l.materialTree.polylistInstances.filter(function(b){return function(d){return-1!==b.$jscomp$loop$prop$productNodesIds$293.indexOf(d.node.localId)}}(g))})}for(f in k.polylists)l=k.polylists[f],g.$jscomp$loop$prop$productNodesIds$293.forEach(function(b){e.apiCore.exec(e.callerName,
"updatePolylistMaterial",l.polylist.id,l.materialSettings.name,b,void 0,0)}),this.transactionContent.push({polylist:l.polylist,ms:l.materialSettings,polylistInstances:l.polylist.instances.filter(function(b){return function(d){return-1!==b.$jscomp$loop$prop$productNodesIds$293.indexOf(d.node.localId)}}(g))})}this.apiCore.exec(this.callerName,"endTransaction")},w=function(b){--this.scene.stopDraw;u.isConfiguratorUIDisabled||eb.call(this);this.apiCore.exec(this.callerName,"resetCameraScene");for(var d=
[],e=0;e<this.draggingProductNodesSettings[b].productSettings.length;++e){var f=this.draggingProductNodesSettings[b].productSettings[e];if(void 0===f.kept&&(d.push({instance:this.scene.productNodeInstancesByLocalId[f.localId],renderAsGhost:!0}),2==this.draggingMode))break}this.apiCore.exec(this.callerName,"rdr.initSceneBuffers",this.scene);this.apiCore.exec(this.callerName,"rdr.updateSceneLights",this.scene);d.length?this.apiCore.exec(this.callerName,"rdr.renderProductNodeInstancesAsGhost",d,!0):
(this.apiCore.exec(this.callerName,"rdr.updateSceneMaterials",this.scene),this.apiCore.exec(this.callerName,"rdr.updateShaders",this.scene));for(var g in this.scene.nodesInUse)this.scene.updateMatrices(this.scene.nodesInUse[g])},D=function(b,d,e){var f=this;e||d.forEach(function(b){return f.scene.productNodeInstancesByLocalId[b].notDraggable=!0});if(this.draggingProductNodesSettings[b].materialsToApply){var g=[];for(d=0;d<this.draggingProductNodesSettings[b].productSettings.length&&(e=this.draggingProductNodesSettings[b].productSettings[d],
g.push(e.localId),e.childrenToBuild&&e.childrenToBuild.forEach(function(b){return g.push(b.localId)}),2!=this.draggingMode);++d);n.call(this,this.draggingProductNodesSettings[b].materialsToApply,g,stage.setContext(w,this,b))}else w.call(this,b)},A=function(b){this.draggingProductNodesSettings[b].stopped&&(this.lastPlaceholdersPositions=null);for(var d=!0,e=[],f=0;f<this.draggingProductNodesSettings[b].productSettings.length;++f){var g=this.draggingProductNodesSettings[b].productSettings[f];e.push(g);
if(g.kept){d=!1;f=[g];g.childrenToBuild&&f.push.apply(f,$jscomp.arrayFromIterable(g.childrenToBuild));++this.scene.stopDraw;this.scene.addProductNodes(f,stage.setContext(D,this,b,f.map(function(b){return b.localId}),this.draggingProductNodesSettings[b].stopped));break}else g.childrenToBuild&&e.push.apply(e,$jscomp.arrayFromIterable(g.childrenToBuild));if(2==this.draggingMode)break}d&&this.scene.productNodeInstancesByLocalId[e[0].localId]&&(++this.scene.stopDraw,this.scene.addProductNodes(e,stage.setContext(D,
this,b,e.map(function(b){return b.localId}),this.draggingProductNodesSettings[b].stopped)));this.lastPlaceholdersPositions=null};u.prototype.onDraggableProductDragEnd=function(){this.dragging&&(E.call(this),u.isConfiguratorUIDisabled||ab.call(this))};u.prototype.insertProductManually=function(b,d,e,f){f.inUse&&this.currentProductNodeInstance&&Ia.call(this,this.currentProductNodeInstance);this.updateSlotWhenProductNodeAdded=!0;oa.call(this,b,d,e)};var H=function(b){if(!this.scene)return stage.createError(302,
"No scene to modify.");b=this.scene.productNodeInstancesByLocalId[b];if(!b)return stage.createError(304,"Invalid localId, there is no node with this localId.");if(!b.parent)return stage.createError(304,"Invalid localId, root node can not be deleted.");Ia.call(this,b);return stage.createResult(1)},e=function(b,d,e,f){var g=this;if(b&&d&&Object.keys(e).length){var h=Object.keys(e).map(function(b){if(g.settings.furnitureMode)return{name:e[b][0].targetZone.name,article:b,defaultConfiguration:g.currentGlobalFurnitureConfiguration||
e[b][0].targetZone.defaultConfiguration};b=g.scene.productNodes[b];return{name:b.name,SKU:b.sku,thumbnail:b.thumbnail}}),k=[];f=f?ka.call(this,f,k):null;this.apiCore.exec(this.callerName,"modularConfiguratorSlotSelected",b.id,b.zone,d.id,d.slot,h,f,k)}else this.apiCore.exec(this.callerName,"modularConfiguratorSlotDeselected")},E=function(){if(this.dragging){this.apiCore.exec(this.callerName,"setCursor","grab");for(var b=[],d=0;d<this.draggingProductNodesSettings[this.lastDragId].productSettings.length;++d){var e=
this.draggingProductNodesSettings[this.lastDragId].productSettings[d];e.kept||b.push(e.localId)}this.dragging=!1;this.scene.removeProductNodes(b);u.isConfiguratorUIDisabled||eb.call(this)}},F=function(b){this.currentProductNodeInstance&&(u.isConfiguratorUIDisabled||this.productNodesInstancesContainers[this.currentProductNodeInstance.localId].elem.removeClass("selected"));if(b&&this.graphNodesByLocalId[b.localId]){var d=this.graphNodesByLocalId[b.localId];this.currentProductNodeInstance=b=this.graphNodesByLocalId[b.localId].node;
!u.isConfiguratorUIDisabled&&this.productNodesInstancesContainers[b.localId]&&this.productNodesInstancesContainers[b.localId].elem.addClass("selected");this.apiCore.exec(this.callerName,"modularConfiguratorProductSelected",b);d.parentGraphSlot?(b=fa.call(this,d.parentGraphZone,d.parentGraphSlot),u.isConfiguratorUIDisabled||N.call(this,b,d.parentGraphZone,d.parentGraphSlot,d),e.call(this,d.parentGraphZone,d.parentGraphSlot,b,d)):e.call(this,null,null,{},null)}else this.currentProductNodeInstance=null,
ia.call(this,!1),e.call(this,null,null,{},null),this.apiCore.exec(this.callerName,"modularConfiguratorProductSelected",null)},p=function(b,d){var e=this;d=void 0===d?null:d;var f=[];if(d)for(var g=0;g<d.graphZone.slots.length;++g){var h=d.graphZone.slots[g];-1!==d.sourceSlots.indexOf(h.slot)&&(h.inUse=!0,h.productNodeLocalId=b.localId,f.push(h))}var k=new kb(b,d,f);this.graphNodes.push(k);this.graphNodesByLocalId[b.localId]=k;d&&(k.childrenNodes.forEach(function(b){return e.graphNodesByLocalId[b.localId]=
k}),d.graphZone.graphNode.children.push(k));b=k.node.productNode.id;d&&this.settings.furnitureMode&&d.targetZone.article&&(b=d.targetZone.article);b=$jscomp.makeIterator(this.zonesByProductId[b]);for(f=b.next();!f.done;f=b.next()){f=f.value;g=m.call(this,f,k);d&&f===d.targetZone&&(k.graphZone=g,g.productNodesInstances=d.graphZone.productNodesInstances);h=$jscomp.makeIterator(f.slots);for(var l=h.next();!l.done;l=h.next()){var n=l.value;l=d&&-1!==d.targetSlots.indexOf(n);n=new xb(++this.graphSlotIds,
n,l,this.scene);g.slots.push(n);d&&f===d.targetZone&&l&&k.graphSlots.push(n)}k.graphZones.push(g)}return k},m=function(b,d){return new Da(++this.graphZoneIds,b,d,this.scene)},h=function(b,d){this.viewerWidth=b;this.viewerHeight=d},v=function(b){return this.settings.furnitureMode&&"none"!==b.article?b.article:b.productNodeId},I=function(d){if((this.scene=d)&&d.modularConfigurator){this.computeBoundingBox=this.scene.createBoundingBox();this.runtimeRegistered||(this.runtimeRegistered=!0,this.apiCore.register(this,
"polylistSelection",M),this.apiCore.register(this,"polylistHighlight",T),this.apiCore.register(this,"mouseDrop",U),this.apiCore.register(this,"mouseTrackingUpdate",L),this.apiCore.register(this,"placeholdersAdded",Q),this.apiCore.register(this,"placeholderRemoved",ta),this.apiCore.register(this,"placeholdersTrackingUpdate",ua),this.apiCore.register(this,"modularConfigurator.getModularScene",Z,!0),this.apiCore.register(this,"modularConfigurator.getGloballyAvailableProducts",Ka,!0),this.apiCore.register(this,
"modularConfigurator.removeProductNodeInstance",H,!0),this.apiCore.register(this,"modularConfigurator.startProductDragDrop",k,!0),this.apiCore.register(this,"modularConfigurator.startFurnitureProductDragDrop",l,!0),this.apiCore.register(this,"modularConfigurator.stopProductNodeDragDrop",C),this.apiCore.register(this,"modularConfigurator.updateProductDragPosition",K),this.apiCore.register(this,"startProductNodeInstanceDragging",aa),this.apiCore.register(this,"stopProductNodeInstanceDragging",C),this.apiCore.register(this,
"updateDraggingNodePosition",Y),this.apiCore.register(this,"modularConfigurator.isProductNodeRotatable",bb,!0),this.apiCore.register(this,"modularConfigurator.rotateProductNode",gb),this.apiCore.register(this,"modularConfigurator.setModularConfiguratorScene",La),this.apiCore.register(this,"modularConfigurator.setFurnitureProductNodeInstanceConfiguration",Sa),this.apiCore.register(this,"modularConfigurator.setFurnitureProductNodeInstancesConfigurations",Ya),this.apiCore.register(this,"modularConfigurator.setGlobalFurnitureConfiguration",
Ra));this.modularConfigurator=d.modularConfigurator;this.mode=void 0!==this.modularConfigurator.mode?this.modularConfigurator.mode:b.GLOBAL;this.draggingMode=void 0!==this.modularConfigurator.draggingMode?this.modularConfigurator.draggingMode:1;u.isConfiguratorUIDisabled||(this.pinIds=1,this.pins=[],this.slotsByPinId={},this.productsContainers={},this.zoneProductNodesContainers={},this.zonesContainers={},this.globalProductsContainer||(d=[{tagName:"div",attributes:{klass:"modularConfiguratorPinsContainer"}},
{tagName:"div",attributes:{klass:"modularConfiguratorRightPanelContainer"},childs:[{tagName:"div",attributes:{klass:"modularConfiguratorZonesContainer",inner:"Zones",title:"Zones"}},{tagName:"div",attributes:{klass:"modularConfiguratorGlobalProductsContainer",inner:"Global",title:"Global"},childs:fb.call(this)},{tagName:"div",attributes:{klass:"modularConfiguratorSlotContainer"},childs:[{tagName:"div",attributes:{klass:"modularConfiguratorSlotTitle",inner:"Slot",title:"Slot"}}]}]}],this.container.build(d),
this.pinsContainer=this.container.find(".modularConfiguratorPinsContainer"),this.menuContainer=this.container.find(".modularConfiguratorRightPanelContainer"),this.globalProductsContainer=this.container.find(".modularConfiguratorGlobalProductsContainer"),this.globalProductsListContainer=this.container.find(".modularConfiguratorAddableProductsListContainer"),this.globalProductsListListContainer=this.container.find(".modularConfiguratorAddableProductsListListContainer"),this.globalProductInstancesListContainer=
this.container.find(".modularConfiguratorProductInstancesListContainer"),this.globalProductInstancesListListContainer=this.container.find(".modularConfiguratorProductInstancesListListContainer"),this.zonesContainer=this.container.find(".modularConfiguratorZonesContainer"),this.slotContainer=this.container.find(".modularConfiguratorSlotContainer"),this.slotContainerTitle=this.slotContainer.find(".modularConfiguratorSlotTitle"),this.globalProductsContainer.hide(),this.zonesContainer.hide(),this.slotContainer.hide()),
this.apiCore.register(this,"onAnnotationsMove",Ta),this.apiCore.register(this,"modularConfigurator.selectSlotProduct",Aa),this.apiCore.register(this,"modularConfigurator.toggleUi",hb),hb.call(this,!1,!1));this.zonesByProductId={};this.zonesByReference={};this.slotsByConnectorType={};this.draggingProductNodesSettings={};if(this.modularConfigurator.connectorZones){d=$jscomp.makeIterator(this.modularConfigurator.connectorZones);for(var e=d.next();!e.done;e=d.next()){e=e.value;var f=v.call(this,e);this.zonesByProductId[f]||
(this.zonesByProductId[f]=[]);this.zonesByProductId[f].push(e);this.zonesByReference[e.reference]=e;e.boundingBox&&(e.boundingBox=this.scene.createAndFillBoundingBox(e.boundingBox.minX,e.boundingBox.maxX,e.boundingBox.minY,e.boundingBox.maxY,e.boundingBox.minZ,e.boundingBox.maxZ));if(e.collisionBoundingBoxes)for(f=0;f<e.collisionBoundingBoxes.length;++f)e.collisionBoundingBoxes[f]=this.scene.createAndFillBoundingBox(e.collisionBoundingBoxes[f].minX,e.collisionBoundingBoxes[f].maxX,e.collisionBoundingBoxes[f].minY,
e.collisionBoundingBoxes[f].maxY,e.collisionBoundingBoxes[f].minZ,e.collisionBoundingBoxes[f].maxZ);else e.collisionBoundingBoxes=[];f=$jscomp.makeIterator(e.slots);for(var g=f.next();!g.done;g=f.next()){g=g.value;for(var h=$jscomp.makeIterator(g.connectors),m=h.next();!m.done;m=h.next())m=m.value,this.slotsByConnectorType[m.type]||(this.slotsByConnectorType[m.type]=[]),this.slotsByConnectorType[m.type].push({connector:m,slot:g,zone:e})}}}this.connectorCompatibilities={};if(this.modularConfigurator.connectorRelations)for(d=
0;d<this.modularConfigurator.connectorRelations.length;++d)if(e=this.modularConfigurator.connectorRelations[d],e.links.length){f=mat4.identity(mat4.create());e.angleX&&mat4.rotateX(f,e.angleX*Math.PI/180);e.angleY&&mat4.rotateY(f,e.angleY*Math.PI/180);e.angleZ&&mat4.rotateZ(f,e.angleZ*Math.PI/180);void 0!==e.position_x&&mat4.translate(f,[e.position_x,e.position_y,e.position_z]);e.matrix=f;f=[];g=[];for(h=0;h<e.links.length;++h)f.push(e.links[h].source),g.push(e.links[h].target);this.connectorCompatibilities[f[0]]||
(this.connectorCompatibilities[f[0]]=[]);this.connectorCompatibilities[f[0]].push({sources:f,targets:g,relation:e});if(e.bidirectional){f=[];g=[];for(h=0;h<e.links.length;++h)g.push(e.links[h].source),f.push(e.links[h].target);this.connectorCompatibilities[f[0]]||(this.connectorCompatibilities[f[0]]=[]);this.connectorCompatibilities[f[0]].push({sources:f,targets:g,relation:e})}}this.modularConfigurator.defaultGraph?La.call(this,this.modularConfigurator.defaultGraph.root,!0,!1):this.scene.root.productNode&&
this.zonesByProductId[this.scene.root.productNode.id]&&La.call(this,{SKU:this.scene.root.productNode.sku,children:[]},!0,!0);this.apiCore.exec(this.callerName,"toggleProductNodesDrag",!0);this.apiCore.exec(this.callerName,"setProductNodesDragMode",stage.emersya.viewer.PRODUCT_NODES_DRAG_MODE.OVERED);ia.call(this,!0)}else this.runtimeRegistered&&(this.runtimeRegistered=!1,this.apiCore.unregister(this,"polylistSelection"),this.apiCore.unregister(this,"polylistHighlight"),this.apiCore.unregister(this,
"mouseDrop"),this.apiCore.unregister(this,"mouseTrackingUpdate"),this.apiCore.unregister(this,"placeholdersAdded"),this.apiCore.unregister(this,"placeholderRemoved"),this.apiCore.unregister(this,"placeholdersTrackingUpdate"),this.apiCore.unregister(this,"modularConfigurator.getModularScene"),this.apiCore.unregister(this,"modularConfigurator.getGloballyAvailableProducts"),this.apiCore.unregister(this,"modularConfigurator.removeProductNodeInstance"),this.apiCore.unregister(this,"modularConfigurator.startProductDragDrop"),
this.apiCore.unregister(this,"modularConfigurator.startFurnitureProductDragDrop"),this.apiCore.unregister(this,"modularConfigurator.stopProductNodeDragDrop"),this.apiCore.unregister(this,"modularConfigurator.updateProductDragPosition"),this.apiCore.unregister(this,"startProductNodeInstanceDragging"),this.apiCore.unregister(this,"stopProductNodeInstanceDragging"),this.apiCore.unregister(this,"updateDraggingNodePosition"),this.apiCore.unregister(this,"modularConfigurator.isProductNodeRotatable"),this.apiCore.unregister(this,
"modularConfigurator.rotateProductNode"),this.apiCore.unregister(this,"modularConfigurator.setModularConfiguratorScene"),this.apiCore.unregister(this,"modularConfigurator.setFurnitureProductNodeInstanceConfiguration"),this.apiCore.unregister(this,"modularConfigurator.setFurnitureProductNodeInstancesConfigurations"),this.apiCore.unregister(this,"modularConfigurator.setGlobalFurnitureConfiguration"))},J=function(){La.call(this,{SKU:this.scene.root.productNode.sku,children:[]},!0,!1)},M=function(b){this.modularConfigurator&&
F.call(this,b.length?this.scene.productNodeInstancesByLocalId[b[0].node.localId]:null)},T=function(b){this.scene.setHighlight([],[],[]);if(b.length&&(2!==this.draggingMode||!this.currentProductNodeInstanceDropCandidate)){if(this.draggingLocalIds.length){if(-1!==this.draggingLocalIds.indexOf(b[0].node.localId))for(var d=0;d<this.scene.polylistInstances.length;++d){var e=this.scene.polylistInstances[d];e.node.localId==b[0].node.localId&&(e.highlighted=!0)}}else{var f={};for(d=0;d<b.length;++d)if(e=
b[d].node,e.boundingBoxWithoutNodes&&this.graphNodesByLocalId[e.localId].graphZone){var g=e.parent,h=[e];v.call(this,this.graphNodesByLocalId[e.localId].graphZone.zone);for(var k=null;g&&g.parent&&!g.draggable&&(k=this.graphNodesByLocalId[e.parent.localId])&&k.parent&&k.node.draggable;)h.push(g.localId),g=g.parent;if(g&&g.draggable)for(f[g.localId]=!0,e=[this.graphNodesByLocalId[g.localId]],g=0;g<e.length;++g)h=e[g],f[h.node.localId]=!0,h.childrenNodes&&h.childrenNodes.forEach(function(b){f[b.localId]=
!0}),e.push.apply(e,$jscomp.arrayFromIterable(h.children.filter(function(b){return b.parentRelation.draggable})))}if(Object.keys(f).length)for(b=0;b<this.scene.polylistInstances.length;++b)d=this.scene.polylistInstances[b],f[d.node.localId]&&(d.highlighted=!0)}this.scene.update()}},U=function(b,d){d=this.apiCore.exec(this.callerName,"rdr.getUnderMousePolylist",d);(b.getData("application/json")||b.getData("text/plain"))&&(b=JSON.parse(b.getData("application/json")||b.getData("text/plain")))&&C.call(this,
d,b.dragId)},R=function(b,d){var e=this,f=null;d.fromRelation&&(f=d,d=d.children[0]);var g=b.parentGraphSlot.allAddableProducts[v.call(this,d.graphZone.zone)];if(g.length&&(g=g.filter(function(d){return d.relation==b.parentRelation&&!(new Set(d.sourceSlots)).difference(new Set(b.parentGraphSlots.map(function(b){return b.slot}))).size}),g.length)){var h=g[0];g=d.graphSlots[0].allAddableProducts[v.call(this,b.graphZone.zone)];if(g.length&&(g=g.filter(function(b){return b.relation==d.parentRelation&&
!(new Set(b.targetSlots)).difference(new Set(d.parentGraphSlots.map(function(b){return b.slot}))).size}),g.length)){var k=g[0];g=b.parent;g.children.splice(g.children.indexOf(b),1);g.children.push(d);d.parent=g;d.parentGraphSlots.forEach(function(b){return b.inUse=!1});b.parentGraphSlots.forEach(function(b){return b.inUse=!1});d.parentGraphSlots=[];for(var l=0;l<h.graphZone.slots.length;++l){var m=h.graphZone.slots[l];-1!==h.sourceSlots.indexOf(m.slot)&&(d.parentGraphSlots.push(m),m.inUse=!0)}f?(f.parent=
d,b.parent=f,b.children.splice(b.children.indexOf(f),1),d.children.push(f),f.children.splice(f.children.indexOf(d),1),f.children.push(b)):(b.parent=d,b.children.splice(b.children.indexOf(d),1),d.children.push(b));b.parentGraphSlots=[];for(l=0;l<k.graphZone.slots.length;++l)m=k.graphZone.slots[l],-1!==k.sourceSlots.indexOf(m.slot)&&(b.parentGraphSlots.push(m),m.inUse=!0);b.node.children.splice(b.node.children.indexOf(d.node),1);g.node.children.push(d.node);d.node.parent=g.node.parent;g.node.children.splice(g.node.children.indexOf(b.node),
1);d.node.children.push(b.node);b.node.parent=d.node.parent;f&&(d.node.children.splice(d.node.children.indexOf(f.node),1),b.node.children.push(f.node),f.node.parent=b.node);d.parentGraphZone=h.graphZone;d.parentGraphSlot=h.graphSlot;d.parentRelation=h.relation;d.connectionMatrix=h.connectionMatrix;d.collisionBoundingBoxes.forEach(function(b){return e.scene.boundingBoxesToRender=e.scene.boundingBoxesToRender.filter(function(d){return d!==b})});d.collisionBoundingBoxes=h.collisionBoundingBoxes;b.parentGraphZone=
k.graphZone;b.parentGraphSlot=k.graphSlot;b.parentRelation=k.relation;b.connectionMatrix=k.connectionMatrix;b.collisionBoundingBoxes.forEach(function(b){return e.scene.boundingBoxesToRender=e.scene.boundingBoxesToRender.filter(function(d){return d!==b})});b.collisionBoundingBoxes=k.collisionBoundingBoxes;mat4.set(d.node.modelMatrix,g.node.matrix);mat4.set(d.connectionMatrix,d.node.matrix);mat4.set(b.connectionMatrix,b.node.matrix);f&&(g=Ha.call(this,k.relation,k),mat4.set(g,f.node.matrix));this.scene.recursiveComputeMatrices(this.scene.root,
mat4.identity(mat4.create()));qa.call(this,h);qa.call(this,k);b.graphSlots=[];b.graphZones.forEach(function(d){d.zone===k.targetZone&&(b.graphZone=d);d.slots.forEach(function(f){for(var g in f.allAddableProducts)f.allAddableProducts[g].forEach(function(b){return qa.call(e,b)});d.zone===k.targetZone&&k.targetSlots.includes(f.slot)&&(b.graphSlots.push(f),f.inUse=!0)})});d.graphSlots=[];d.graphZones.forEach(function(b){b.zone===h.targetZone&&(d.graphZone=b);b.slots.forEach(function(f){for(var g in f.allAddableProducts)f.allAddableProducts[g].forEach(function(b){return qa.call(e,
b)});b.zone===h.targetZone&&h.targetSlots.includes(f.slot)&&(d.graphSlots.push(f),f.inUse=!0)})});Ba.call(this);this.settings.renderBoundingBoxes&&this.scene.boundingBoxesToRender.push.apply(this.scene.boundingBoxesToRender,$jscomp.arrayFromIterable(d.collisionBoundingBoxes));this.apiCore.exec(this.callerName,"modularConfiguratorSceneUpdated",Z.call(this))}}},aa=function(b,d){var e=this;if(!d&&this.graphNodesByLocalId[b.localId]&&b.boundingBoxWithoutNodes){F.call(this,null);if(2!==this.draggingMode)Ia.call(this,
b,!0),this.settings.furnitureMode?g.call(this,graphNode.graphZone.zone.article,graphNode.currentFurnitureConfiguration,null,null,null):g.call(this,b.productNode.id,null,null,null,null);else{var f=this.graphNodesByLocalId[b.localId];d=f.children.filter(function(b){return!b.parentRelation.draggable});var h=0;f.parent.graphZones.forEach(function(b){return h+=b.slots.length});1==d.length&&f.parent&&!f.parent.parent&&1==h&&R.call(this,f,d[0]);var k=v.call(this,f.graphZone.zone),l=new Set;d=[f];for(var m=
[mat4.identity(mat4.create())],n=[],p={$jscomp$loop$prop$i$296:0};p.$jscomp$loop$prop$i$296<d.length;p={$jscomp$loop$prop$i$296:p.$jscomp$loop$prop$i$296},++p.$jscomp$loop$prop$i$296)l.add(d[p.$jscomp$loop$prop$i$296]),d.push.apply(d,$jscomp.arrayFromIterable(d[p.$jscomp$loop$prop$i$296].children)),d[p.$jscomp$loop$prop$i$296].children.forEach(function(b){return function(d){m.push(mat4.multiply(m[b.$jscomp$loop$prop$i$296],d.node.matrix,mat4.create()))}}(p)),p.$jscomp$loop$prop$i$296&&n.push.apply(n,
$jscomp.arrayFromIterable(d[p.$jscomp$loop$prop$i$296].graphZone.zone.collisionBoundingBoxes.map(function(b){return function(d){return e.scene.transformBoundingBox(d,m[b.$jscomp$loop$prop$i$296])}}(p))));var q=new Set(l);q.add(f);var r=n.map(function(b){return e.scene.copyBoundingBox(b)});f.parentGraphSlots.forEach(function(b){return b.inUse=!1});f.graphSlots.forEach(function(b){return b.inUse=!1});d=[];var t=[];p=$jscomp.makeIterator(this.graphNodes);for(var u=p.next();!u.done;u=p.next())if(u=u.value,
!l.has(u)){u!==f&&u.collisionBoundingBoxes&&t.push.apply(t,$jscomp.arrayFromIterable(u.collisionBoundingBoxes));u=$jscomp.makeIterator(u.graphZones);for(var w=u.next();!w.done;w=u.next()){w=$jscomp.makeIterator(w.value.slots);for(var A=w.next();!A.done;A=w.next())A=A.value,A.inUse||A.allAddableProducts[k]&&d.push.apply(d,$jscomp.arrayFromIterable(A.allAddableProducts[k].filter(function(b){return!b.collidingWith.size||e.scene.setIsSubsetOf(b.collidingWith,q)})))}}d=d.filter(function(b){for(var d=0;d<
n.length;++d)e.scene.transformBoundingBox(n[d],mat4.multiply(b.graphZone.graphNode.node.modelMatrix,b.connectionMatrix,e.computeMatrix),r[d]);return!e.scene.areBoundingBoxesArraysColliding(r,t)});k=this.apiCore.exec(this.callerName,"rdr.getCanvasSize");l=mat4.create();this.lastDragId=p=--this.internalDragIds;this.draggingProductNodesSettings[p]={productSettings:[],materialsToApply:null,stopped:!1};for(u=0;u<d.length;++u){w=d[u];A=w.graphZone.graphNode.node.localId;var B=w.connectionMatrix,V=f.node.productNode;
V=V.sourceModel&&V.sourceModel.boundingBox?V.sourceModel.boundingBox.center:[0,0,0];V=mat4.multiplyVec3(mat4.multiply(this.scene.productNodeInstancesByLocalId[A].modelMatrix,B,l),V,vec3.create());this.draggingProductNodesSettings[p].productSettings.push({addable:w,matrix:B,parentLocalId:A,screenPosition:this.apiCore.exec(this.callerName,"rdr.getScreenPosition",V,null,k[0],k[1])})}this.draggingProductNodesSettings[p].productSettings=this.draggingProductNodesSettings[p].productSettings.sort(function(b,
d){return b.addable.targetZone===f.graphZone.zone?-1:d.addable.targetZone===f.graphZone.zone?1:0});this.apiCore.exec(this.callerName,"rdr.renderProductNodeInstanceAsGhost",b,!0,!0);this.apiCore.exec(this.callerName,"productNodeInstanceDraggingStarted",b,b.boundingBoxWithoutNodes);this.draggingGraphNode=f}this.internalDragId=this.lastDragId}},C=function(b,d){this.samePosDragTimeout&&(clearTimeout(this.samePosDragTimeout),this.samePosDragTimeout=null);this.apiCore.exec(this.callerName,"toggleMouseTrackingMode",
!1,!1);if(void 0===d){if(null===this.internalDragId)if(this.draggingLocalIds.length&&this.lastDragId)d=this.lastDragId;else return;else d=this.internalDragId;this.internalDragId=null}if(this.draggingProductNodesSettings[d]&&(u.isConfiguratorUIDisabled||ab.call(this),this.apiCore.exec(this.callerName,"setCursor","grab"),this.dragging=!1,u.isConfiguratorUIDisabled||eb.call(this),b=b&&b.length&&b[0].node.localId,!this.draggingProductNodesSettings[d].stopped)){for(var e=[],f=!1,g=0;g<this.draggingProductNodesSettings[d].productSettings.length;++g){var h=
this.draggingProductNodesSettings[d].productSettings[g],k=b==h.localId;if(!k&&h.children)for(var l=0;!k&&l<h.children.length;++l)k=b==h.children[l].localId;2===this.draggingMode&&this.currentProductNodeInstanceDropCandidate===h||2!==this.draggingMode&&k?(this.draggingGraphNode?(2===this.draggingMode&&this.apiCore.exec(this.callerName,"productNodeInstanceDraggingStopped",this.draggingGraphNode.node),xa.call(this,this.draggingGraphNode,h.addable)):(f=2===this.draggingMode?this.draggingLocalIds[0]:h.localId,
2===this.draggingMode&&this.apiCore.exec(this.callerName,"productNodeInstanceDraggingStopped",this.scene.productNodeInstancesByLocalId[f]),Fa.call(this,f,h.addable,h.relationProductSettings?h.relationProductSettings.localId:null),h.kept=!0),f=!0):(h.kept=!1,2!==this.draggingMode&&e.push(h.localId))}f||2!==this.draggingMode||(this.draggingGraphNode?(this.apiCore.exec(this.callerName,"productNodeInstanceDraggingStopped",this.draggingGraphNode.node),Ia.call(this,this.draggingGraphNode.node)):e.push.apply(e,
$jscomp.arrayFromIterable(this.draggingLocalIds)));e.length?this.scene.removeProductNodes(e):this.scene.computeSceneBoundingBoxes();this.draggingProductNodesSettings[d].stopped=f;this.draggingGraphNode=this.currentProductNodeInstanceDropCandidate=null;this.draggingLocalIds=[];f||this.apiCore.exec(this.callerName,"modularConfiguratorSceneUpdated",Z.call(this))}},L=function(b,d,e,f){b=!this.previousMouseLeaved&&f;this.previousMouseLeaved=f;!this.oneMouseInRequired&&e.x==this.previousMousePosX&&e.y==
this.previousMousePosY&&!f||b?this.samePosDragTimeout||(this.samePosDragTimeout=setTimeout(C.bind(this,null,this.lastDragId),1E3)):(f?Y.call(this,{x:-1,y:-1}):(!1===f&&(this.oneMouseInRequired=!1),this.samePosDragTimeout&&(clearTimeout(this.samePosDragTimeout),this.samePosDragTimeout=null),Y.call(this,e)),this.previousMousePosX=e.x,this.previousMousePosY=e.y)},K=function(b,d,e){this.draggingProductNodesSettings[b]&&(this.apiCore.exec(this.callerName,"toggleMouseTrackingMode",!1,!1),Y.call(this,{x:d,
y:e}))},G=function(b,d){var e=[b];b={};for(var f=!1,g=0;g<e.length;++g){var h=e[g];1!=h.type&&(b[h.localId]=!0,e.push.apply(e,$jscomp.arrayFromIterable(h.children)))}for(e=0;e<this.scene.polylistInstances.length;++e)g=this.scene.polylistInstances[e],b[g.node.localId]&&(f=f||g.hidden!=d,g.hidden=d);return f},S=function(b,d,e){if(d&&d.parent.fromRelation){var f=Ha.call(this,e.addable.relation,e.addable);mat4.set(f,d.parent.node.matrix)}else e.relationProductSettings&&this.scene.productNodeInstancesByLocalId[e.relationProductSettings.localId]&&
mat4.set(e.relationProductSettings.matrix,this.scene.productNodeInstancesByLocalId[e.relationProductSettings.localId].matrix);mat4.set(e.matrix,b.matrix);if(e.parentLocalId!=b.parent.localId)b.parent.children.splice(b.parent.children.indexOf(b),1),d=this.scene.productNodeInstancesByLocalId[e.parentLocalId],d.children.push(b),b.parent=d,this.scene.recursiveComputeMatrices(this.scene.root,mat4.identity(mat4.create()));else for(var g in this.scene.nodesInUse)this.scene.updateMatrices(this.scene.nodesInUse[g]);
this.scene.update()},Y=function(b){var d=!1;if(this.draggingGraphNode){if(2==this.draggingMode){var e=this.draggingGraphNode.node;this.apiCore.exec(this.callerName,"rdr.renderProductNodeInstanceAsGhost",e,!0,!0);for(var f=this.draggingProductNodesSettings[this.lastDragId],g=[b.x,b.y,0],h=f.productSettings[0],k=vec3.length(vec3.subtract([h.screenPosition.x,h.screenPosition.y,0],g)),l=0;l<f.productSettings.length;++l){var m=f.productSettings[l];if(m.screenPosition){var n=vec3.length(vec3.subtract([m.screenPosition.x,
m.screenPosition.y,0],g));n<k&&(k=n,h=m)}}0<=b.x&&0<=b.y&&b.x<this.viewerWidth&&b.y<this.viewerHeight?(this.currentProductNodeInstanceDropCandidate!==h&&(this.currentProductNodeInstanceDropCandidate=h,d=G.call(this,e,!1)||d,S.call(this,e,this.draggingGraphNode,this.currentProductNodeInstanceDropCandidate)),this.apiCore.exec(this.callerName,"productNodeInstanceDraggingUpdate",e,mat4.multiplyVec3(this.currentProductNodeInstanceDropCandidate.matrix,[0,0,0]))):(this.currentProductNodeInstanceDropCandidate&&
(d=G.call(this,e,!0)||d),this.currentProductNodeInstanceDropCandidate=null)}}else{e=this.draggingProductNodesSettings[this.lastDragId];if(!e.productSettings.length)return;if(2==this.draggingMode){f=this.scene.productNodeInstancesByLocalId[this.draggingLocalIds[0]];this.apiCore.exec(this.callerName,"rdr.renderProductNodeInstanceAsGhost",f,!0,!0);g=[b.x,b.y,0];h=e.productSettings[0];k=vec3.length(vec3.subtract([h.screenPosition.x,h.screenPosition.y,0],g));for(l=0;l<e.productSettings.length;++l)m=e.productSettings[l],
m.screenPosition&&(n=vec3.length(vec3.subtract([m.screenPosition.x,m.screenPosition.y,0],g)),n<k&&(k=n,h=m));0<=b.x&&0<=b.y&&b.x<this.viewerWidth&&b.y<this.viewerHeight?(this.currentProductNodeInstanceDropCandidate!==h&&(this.currentProductNodeInstanceDropCandidate=h,d=G.call(this,f,!1)||d,S.call(this,f,null,this.currentProductNodeInstanceDropCandidate)),this.apiCore.exec(this.callerName,"productNodeInstanceDraggingUpdate",f,mat4.multiplyVec3(this.currentProductNodeInstanceDropCandidate.matrix,[0,
0,0]))):(this.currentProductNodeInstanceDropCandidate&&(d=G.call(this,f,!0)||d),this.currentProductNodeInstanceDropCandidate=null)}this.lastPlaceholdersPositions&&ua.call(this,this.lastPlaceholdersPositions)}d&&(this.scene.visibilityChanged=!0,this.scene.update())},ia=function(d){u.isConfiguratorUIDisabled||(this.slotContainer.hide(),eb.call(this,d));if(this.mode&b.GLOBAL){u.isConfiguratorUIDisabled||this.globalProductsContainer.show();if(!u.isConfiguratorUIDisabled&&this.menuDisplayed)for(var e in this.productsContainers)this.productsContainers[e].elem.detach();
if(!u.isConfiguratorUIDisabled&&this.menuDisplayed){if(Object.keys(this.draggableProducts).length){this.globalProductsListContainer.show();for(var f in this.draggableProducts)for(d=this.draggableProducts[f],e=0;e<d.length;++e){var h=f;Qa.call(this,h);this.productsContainers[h].onDragStart=stage.setContext(g,this,h,null,d,null);this.productsContainers[h].elem.listen("dragstart",this.productsContainers[h].onDragStart);this.productsContainers[h].elem.get(0).setAttribute("draggable",!0);this.productsContainers[h].elem.attach(this.globalProductsListListContainer.get(0),
"bottom")}}else this.globalProductsListContainer.hide();if(Object.keys(this.productNodesInstancesContainers).length){this.globalProductInstancesListContainer.show();for(var k in this.productNodesInstancesContainers)f=this.productNodesInstancesContainers[k].elem,f.detach(),f.attach(this.globalProductInstancesListListContainer.get(0),"bottom")}else this.globalProductInstancesListContainer.hide()}}else u.isConfiguratorUIDisabled||this.globalProductsContainer.hide();if(this.mode&b.BY_ZONE){u.isConfiguratorUIDisabled||
this.zonesContainer.show();if(!u.isConfiguratorUIDisabled)for(var l in this.zoneProductNodesContainers)this.zoneProductNodesContainers[l].elem.detach();k=$jscomp.makeIterator(this.graphNodes);for(l=k.next();!l.done;l=k.next())for(l=$jscomp.makeIterator(l.value.graphZones),f=l.next();!f.done;f=l.next()){f=f.value;u.isConfiguratorUIDisabled||f.container||(d=[{tagName:"div",attributes:{klass:"modularConfiguratorZoneProductsContainer"},returnActive:!0,childs:[{tagName:"div",attributes:{klass:"modularConfiguratorZoneProductsTitle",
inner:f.zone.name,title:f.zone.name},events:[{onEvent:"click",callback:stage.setContext(Ea,this,f)}]},{tagName:"div",attributes:{klass:"modularConfiguratorZoneListsContainer"},childs:fb.call(this)}]}],f.container=this.zonesContainer.build(d),f.productsListContainer=f.container.find(".modularConfiguratorAddableProductsListContainer"),f.productsListListContainer=f.container.find(".modularConfiguratorAddableProductsListListContainer"),f.productInstancesListContainer=f.container.find(".modularConfiguratorProductInstancesListContainer"),
f.productInstancesListListContainer=f.container.find(".modularConfiguratorProductInstancesListListContainer"));f.draggableProductNodes={};d=$jscomp.makeIterator(f.slots);for(e=d.next();!e.done;e=d.next())if(e=e.value,la.call(this,f,e),!e.inUse)for(var m in e.addableProducts)f.draggableProductNodes[m]||(f.draggableProductNodes[m]=[]),f.draggableProductNodes[m].push.apply(f.draggableProductNodes[m],$jscomp.arrayFromIterable(e.addableProducts[m]));ib.call(this,f)}}else u.isConfiguratorUIDisabled||this.zonesContainer.hide()},
Q=function(b){for(var d=0;d<b.length;++d){var e=b[d];this.currentPlaceholderInstances[e.localId]=e;e.placeholderPinContainer=this.placeholderPinsContainer.build([{tagName:"div",attributes:{klass:"modularConfiguratorPlaceholderPinContainer "+e.fullId,style:"pointer-events:none"},returnActive:!0}]);e.placeholderPinContainer.hide()}},ta=function(b){this.currentPlaceholderInstances[b.localId]&&delete this.currentPlaceholderInstances[b.localId];b.placeholderPinContainer&&(b.waiting&&(b.waiting.remove(),
b.waiting=null),b.placeholderPinContainer.remove(),delete b.placeholderPinContainer)},ua=function(b){for(var d=0;d<b.length;++d){var e=b[d],f=this.currentPlaceholderInstances[e.localId];if(f){var g=f.placeholderPinContainer;!e.displayed||2==this.draggingMode&&this.currentProductNodeInstanceDropCandidate!==f?(f.waiting&&(f.waiting.remove(),f.waiting=null),g.hide()):(g.show(),f.waiting=this.apiCore.exec(this.callerName,"ui.buildBasicLoader",g),e.visible||g.css({opacity:.5}),g.css({top:e.y-15+"px",left:e.x-
15+"px"}))}else console.warn("missing moved product node instance placeholder")}this.lastPlaceholdersPositions=b},ea=function(b,d,e,f){f.inUse&&this.currentProductNodeInstance&&Ia.call(this,this.currentProductNodeInstance);this.updateSlotWhenProductNodeAdded=!0;oa.call(this,b,d,e)},oa=function(b,d,e,f,g,h,k,l){var m=this,n=this.scene.get("ProductNode",b),p=this.scene.getParentIdAndTypeFromInstance(n).id,q=e.graphNode.node.localId,r=mat4.identity(mat4.create());mat4.translate(r,[d.connector.position_x,
d.connector.position_y,d.connector.position_z]);mat4.rotateZ(r,d.connector.angleZ*Math.PI/180);mat4.rotateY(r,d.connector.angleY*Math.PI/180);mat4.rotateX(r,d.connector.angleX*Math.PI/180);mat4.rotateX(r,-d.targetSlot.connector.angleX*Math.PI/180);mat4.rotateY(r,-d.targetSlot.connector.angleY*Math.PI/180);mat4.rotateZ(r,-d.targetSlot.connector.angleZ*Math.PI/180);mat4.translate(r,[-d.targetSlot.connector.position_x,-d.targetSlot.connector.position_y,-d.targetSlot.connector.position_z]);b=mat4.multiplyVec3(r,
[0,0,0]);d.childrenToBuild=[];d.children=[];if(g)return d.relationChildren=null,d.children=[],Fa.call(this,g,d,h,!0);g=void 0!==l?l:this.scene.getNewProductNodeInstanceLocalId();this.scene.addProductNodesPlaceholders([{SKU:n.sku,localId:g,parentLocalId:q,matrix:r,addable:d}]);this.apiCore.exec(this.callerName,"rdr.initSceneBuffers",this.scene);this.apiCore.exec(this.callerName,"rdr.updateSceneMaterials",this.scene);this.apiCore.exec(this.callerName,"rdr.updateSceneLights",this.scene);this.apiCore.exec(this.callerName,
"rdr.updateShaders",this.scene);this.scene.update();if(f){f=[{SKU:n.sku,localId:g,parentLocalId:q,matrix:r,addable:d,furnitureArticle:"",furnitureConfiguration:"",screenPosition:this.apiCore.exec(this.callerName,"rdr.getScreenPosition",b)}];d=Fa.call(this,g,d,null,!0);var t={};if(k&&k.meshes){var v=sa.call(this);h=this.scene.getAllFromInstanceParent(n,"MaterialSettings");var u={};Object.values(h).forEach(function(b){u[b.name]=m.scene.materials[b.id]});t.polylists=[];k.meshes.forEach(function(b){t.polylists.push({polylist:v[b.name],
materialSettings:u[b.materialVariation]})})}return{toLoad:[n],toBuild:f,graphNode:d,materials:{materialsToApply:t,productNodesIds:[g]}}}this.apiCore.exec(this.callerName,"loadProductNode",this.scene,n,stage.setContext(function(){++this.scene.stopDraw;this.scene.addProductNode(n.sku,p,g,q,r,stage.setContext(function(){this.apiCore.exec(this.callerName,"rdr.initSceneBuffers",this.scene);this.apiCore.exec(this.callerName,"rdr.updateSceneMaterials",this.scene);this.apiCore.exec(this.callerName,"rdr.updateSceneLights",
this.scene);this.apiCore.exec(this.callerName,"rdr.updateShaders",this.scene);--this.scene.stopDraw},this))},this));return Fa.call(this,g,d)},ba=function(b,d,e,f,g,h){var k=e.graphZone.graphNode.node.localId,l=mat4.identity(mat4.create());mat4.translate(l,[e.connector.position_x,e.connector.position_y,e.connector.position_z]);mat4.rotateZ(l,e.connector.angleZ*Math.PI/180);mat4.rotateY(l,e.connector.angleY*Math.PI/180);mat4.rotateX(l,e.connector.angleX*Math.PI/180);mat4.rotateX(l,-e.targetSlot.connector.angleX*
Math.PI/180);mat4.rotateY(l,-e.targetSlot.connector.angleY*Math.PI/180);mat4.rotateZ(l,-e.targetSlot.connector.angleZ*Math.PI/180);mat4.translate(l,[-e.targetSlot.connector.position_x,-e.targetSlot.connector.position_y,-e.targetSlot.connector.position_z]);var m=this.scene.productNodeInstancesByLocalId[k];e.furnitureConfiguration=d;if(g){e.relationChildren=null;e.children=[];var n=Fa.call(this,g,e,h,!0);e=this.scene.productNodeInstancesByLocalId[g];n.childrenNodes=n.parent.fromRelation?e.children.filter(function(b){return b.localId!=
n.parent.node.localId}).slice(0,1):[e.children[0]];for(e=0;e<n.childrenNodes.length;++e)n.childrenNodes.push.apply(n.childrenNodes,$jscomp.arrayFromIterable(n.childrenNodes[e].children.filter(function(b){return 0==b.type}))),this.graphNodesByLocalId[n.childrenNodes[e].localId]=n;return n}b=this.apiCore.exec(this.callerName,"ofml.getModularGraphToBuild","|"+b+"|"+(d?d:""));var p=b.nodesToBuild[0];p.boundingBox=this.scene.copyBoundingBox(e.targetZone.boundingBox);p.parentLocalId=k;p.addable=e;p.childrenToBuild=
b.nodesToBuild.splice(1,b.nodesToBuild.length-1);p.matrix=l;e.children=[].concat($jscomp.arrayFromIterable(p.childrenToBuild));k=p.productNode;k=k.sourceModel&&k.sourceModel.boundingBox?k.sourceModel.boundingBox.center:[0,0,0];l=mat4.multiplyVec3(mat4.multiply(m.modelMatrix,l,mat4.create()),k,vec3.create());p.screenPosition=this.apiCore.exec(this.callerName,"rdr.getScreenPosition",l);l=e.relation;l.addProduct?(m=this.settings.furnitureMode&&"none"!==l.article?l.article:l.productNodeId,h=Ha.call(this,
l,e),m=this.apiCore.exec(this.callerName,"ofml.getModularGraphToBuild","|"+m+"|"+l.defaultConfiguration),k=m.nodesToBuild[0],k.boundingBox=l.boundingBox?this.scene.copyBoundingBox(l.boundingBox):this.scene.createAndFillBoundingBox(-.5,.5,0,1,-.5,.5),k.parentLocalId=p.localId,k.childrenToBuild=m.nodesToBuild.splice(1,m.nodesToBuild.length-1),k.matrix=h,p.childrenToBuild.push.apply(p.childrenToBuild,[k].concat($jscomp.arrayFromIterable(k.childrenToBuild))),e.relationChildren=[].concat($jscomp.arrayFromIterable(k.childrenToBuild)),
b.productNodesToLoad.push.apply(b.productNodesToLoad,$jscomp.arrayFromIterable(m.productNodesToLoad)),p.relationProductSettings=k,this.scene.addProductNodesPlaceholders([].concat($jscomp.arrayFromIterable(b.nodesToBuild),[k])),h=k.localId):this.scene.addProductNodesPlaceholders(b.nodesToBuild);this.apiCore.exec(this.callerName,"rdr.initSceneBuffers",this.scene);this.apiCore.exec(this.callerName,"rdr.updateSceneMaterials",this.scene);this.apiCore.exec(this.callerName,"rdr.updateSceneLights",this.scene);
this.apiCore.exec(this.callerName,"rdr.updateShaders",this.scene);this.scene.update();if(f)return e=Fa.call(this,p.localId,e,h,!0),f=[p].concat($jscomp.arrayFromIterable(p.childrenToBuild)),{toLoad:b.productNodesToLoad,toBuild:f,graphNode:e,materials:{materialsToApply:b.materialsToApply,productNodesIds:f.map(function(b){return b.localId})}};e=Fa.call(this,p.localId,e,h,!1);var q=function(){--this.scene.stopDraw;this.apiCore.exec(this.callerName,"rdr.initSceneBuffers",this.scene);this.apiCore.exec(this.callerName,
"rdr.updateSceneLights",this.scene);this.apiCore.exec(this.callerName,"rdr.updateSceneMaterials",this.scene);this.apiCore.exec(this.callerName,"rdr.updateShaders",this.scene);for(var b in this.scene.nodesInUse)this.scene.updateMatrices(this.scene.nodesInUse[b])};this.apiCore.exec(this.callerName,"loadProductNodes",this.scene,b.productNodesToLoad,stage.setContext(function(){++this.scene.stopDraw;p.childrenToBuild?this.scene.addProductNodes([p].concat($jscomp.arrayFromIterable(p.childrenToBuild)),stage.setContext(q,
this)):this.scene.addProductNodes([p],stage.setContext(q,this))},this));return e},ka=function(b,d){var e=this,f={productNodeInstance:b.node,children:[]};if(b.fromRelation)f.fromRelation=!0,f.relation={name:b.parentRelation.name,reference:b.parentRelation.reference},this.settings.furnitureMode&&(f.furnitureArticle=b.article,f.furnitureConfiguration=b.currentFurnitureConfiguration);else{if(b.parent){f.id=b.graphZone.id;f.name=b.graphZone.zone.name;f.reference=b.graphZone.zone.reference;f.slots=[];f.parentSlots=
[];f.parentZone={name:b.parentGraphZone.zone.name,reference:b.parentGraphZone.zone.reference};f.relation={name:b.parentRelation.name,reference:b.parentRelation.reference};for(var g=0;g<b.graphSlots.length;++g){var h=b.graphSlots[g];f.slots.push({id:h.id,name:h.slot.name,reference:h.slot.reference})}for(g=0;g<b.parentGraphSlots.length;++g)h=b.parentGraphSlots[g],f.parentSlots.push({id:h.id,name:h.slot.name,reference:h.slot.reference})}if(this.settings.furnitureMode)b.parent&&(f.furnitureArticle=b.graphZone.zone.article,
f.furnitureConfiguration=b.currentFurnitureConfiguration);else{var k=[];g=[b.node];for(h=0;h<g.length;++h){var l=g[h];h&&1!=l.type||(g.push.apply(g,$jscomp.arrayFromIterable(l.children)),l.polylists&&l.polylists.forEach(function(b){k.push({name:b.polylist.name,materialVariation:b.matAnim.currentMaterial.name})}))}f.configuration={meshes:k}}}f.childrenNodes=b.childrenNodes;b.children.forEach(function(b){f.children.push(ka.call(e,b,d))});d.push(f);return f},Z=function(){var b={root:null,allNodes:[]};
this.graphRoot&&(b.root=ka.call(this,this.graphRoot,b.allNodes));return b},da=function(b){if(b.parent){for(var d=!0,e=b.parent.fromRelation?b.parent.parent:b.parent,f=0;f<e.children.length&&d;++f){var g=e.children[f];g.fromRelation&&(g=g.children[0]);g!==b&&(d=d&&g.parentRelation.draggable&&g.node.draggable)}b.parent.fromRelation?b.parent.parent.node.draggable=d:b.parent.node.draggable=d;X.call(this,e)}},X=function(b){if(b&&b.parent&&!b.parent.parent){var d=0,e=null;b.children.forEach(function(b){return!b.parentRelation.draggable&&
++d&&(e=b)});var f=0;b.parent.graphZones.forEach(function(b){return f+=b.slots.length});1==d&&1==f&&e.parentRelation.bidirectional&&b.parentGraphSlot.allAddableProducts[v.call(this,(e.fromRelation?e.children[0]:e).graphZone.zone)]&&(b.node.draggable=!0)}},Ha=function(b,d){var e=mat4.identity(mat4.create());mat4.translate(e,[d.targetSlot.connector.position_x,d.targetSlot.connector.position_y,d.targetSlot.connector.position_z]);mat4.rotateZ(e,d.targetSlot.connector.angleZ*Math.PI/180);mat4.rotateY(e,
d.targetSlot.connector.angleY*Math.PI/180);mat4.rotateX(e,d.targetSlot.connector.angleX*Math.PI/180);mat4.multiply(e,b.matrix);return e},Ga=function(b,d,e,f){var g=this;f=b.parentRelation;Ha.call(this,f,d);if(this.settings.furnitureMode){var h=f.defaultConfiguration;e=this.scene.productNodeInstancesByLocalId[e];var k=new kb(e,null,[]);k.fromRelation=!0;k.childrenNodes=d.relationChildren;k.children=[b];k.parent=b.parent;k.parentRelation=f;k.article=f.article;k.currentFurnitureConfiguration=h;if(!d.relationChildren){f=
[e];for(h=0;h<f.length;++h)f.push.apply(f,$jscomp.arrayFromIterable(f[h].children.filter(function(b){return 1!=b.type})));k.childrenNodes=f.slice(1,f.length)}d.relation.draggable||(d.graphZone.graphNode.parent.node.draggable=!1);b.parent.children.splice(b.parent.children.indexOf(b),1);b.parent.children.push(k);b.parent=k;this.graphNodes.push(k);this.graphNodesByLocalId[e.localId]=k;k.childrenNodes.forEach(function(b){return g.graphNodesByLocalId[b.localId]=k})}},Fa=function(b,d,e,f){var g=this,h=
this.scene.productNodeInstancesByLocalId[b];h.draggable=!0;this.apiCore.exec(this.callerName,"rdr.renderProductNodeInstanceAsGhost",h,!1,!0);var k=p.call(this,h,d);d.graphZone.productNodesInstances[b]=h;d.relation.draggable||(d.graphZone.graphNode.node.draggable=!1);h.notDraggable=!1;k.childrenNodes.forEach(function(b){return g.scene.productNodeInstancesByLocalId[b.localId]&&(g.scene.productNodeInstancesByLocalId[b.localId].notDraggable=!1)});u.isConfiguratorUIDisabled?(this.productNodesInstancesContainers[b]=
{addable:d},this.zoneProductNodesInstancesContainers[b]={addable:d}):(za.call(this,b),ca.call(this,b));Ba.call(this);ia.call(this,!1);this.updateSlotWhenProductNodeAdded&&(F.call(this,k.node),this.updateSlotWhenProductNodeAdded=!1);d.relation.addProduct&&Ga.call(this,k,d,e,f);X.call(this,d.graphZone.graphNode);f||this.apiCore.exec(this.callerName,"modularConfiguratorSceneUpdated",Z.call(this));this.settings.renderBoundingBoxes&&(h.children[0].renderBoundingBox=!0,d.relation.addProduct&&(h.children[1].renderBoundingBox=
!0),this.scene.boundingBoxesToRender.push.apply(this.scene.boundingBoxesToRender,$jscomp.arrayFromIterable(k.collisionBoundingBoxes)));return k},xa=function(b,d,e){for(var f=0;f<b.parentGraphSlots.length;++f)b.parentGraphSlots[f].inUse=!1,delete b.parentGraphSlots[f].productNodeLocalId;for(f=0;f<b.graphSlots.length;++f)b.graphSlots[f].inUse=!1,b.graphSlots[f].draggableProducts=null;da.call(this,b);f=[];for(var g=0;g<d.graphZone.slots.length;++g){var h=d.graphZone.slots[g];-1!==d.sourceSlots.indexOf(h.slot)&&
(h.inUse=!0,h.draggableProducts=null,h.productNodeLocalId=b.node.localId,f.push(h))}if(this.settings.renderBoundingBoxes){for(g=0;g<b.collisionBoundingBoxes.length;++g)-1!==this.scene.boundingBoxesToRender.indexOf(b.collisionBoundingBoxes[g])&&this.scene.boundingBoxesToRender.splice(this.scene.boundingBoxesToRender.indexOf(b.collisionBoundingBoxes[g]),1);this.scene.boundingBoxesToRender.push.apply(this.scene.boundingBoxesToRender,$jscomp.arrayFromIterable(d.collisionBoundingBoxes))}b.connectionMatrix=
d.connectionMatrix;b.collisionBoundingBoxes=d.collisionBoundingBoxes;this.apiCore.exec(this.callerName,"rdr.renderProductNodeInstanceAsGhost",b.node,!1,!0);b.parentGraphZone=d.graphZone;b.parentGraphSlot=d.graphSlot;b.parentGraphSlots=f;b.parentRelation=d.relation;b.parent.fromRelation?(b.parent.parent.children.splice(b.parent.parent.children.indexOf(b.parent),1),X.call(this,b.parent.parent),b.parent.parent=d.graphZone.graphNode,d.graphZone.graphNode.children.push(b.parent)):(b.parent.children.splice(b.parent.children.indexOf(b),
1),X.call(this,b.parent),b.parent=d.graphZone.graphNode,d.graphZone.graphNode.children.push(b));d.relation.draggable||(d.graphZone.graphNode.fromRelation?d.graphZone.graphNode.parent.node.draggable=!1:d.graphZone.graphNode.node.draggable=!1);v.call(this,b.graphZone.zone);b.graphSlots=[];for(g=0;g<b.graphZones.length;++g){h=b.graphZones[g];h.zone===d.targetZone&&(b.graphZone=h,h.productNodesInstances=d.graphZone.productNodesInstances);for(var k=0;k<h.slots.length;++k){var l=h.slots[k];f=-1!==d.targetSlots.indexOf(l.slot);
h.zone===d.targetZone&&f&&(l.inUse&&console.error("something went wrong, this slot is already in use",l,h,b),l.inUse=f,b.graphSlots.push(l));for(var m in l.allAddableProducts){var n=$jscomp.makeIterator(l.allAddableProducts[m]);for(f=n.next();!f.done;f=n.next())qa.call(this,f.value)}}}m=[].concat($jscomp.arrayFromIterable(b.children));for(g=0;g<m.length;++g){h=m[g];k=$jscomp.makeIterator(h.graphZones);for(f=k.next();!f.done;f=k.next())for(l=$jscomp.makeIterator(f.value.slots),f=l.next();!f.done;f=
l.next()){n=f.value;for(var p in n.allAddableProducts){var q=$jscomp.makeIterator(n.allAddableProducts[p]);for(f=q.next();!f.done;f=q.next())qa.call(this,f.value)}}m.push.apply(m,$jscomp.arrayFromIterable(h.children))}Ba.call(this);ia.call(this,!1);X.call(this,d.graphZone.graphNode);this.updateSlotWhenProductNodeAdded&&(F.call(this,b.node),this.updateSlotWhenProductNodeAdded=!1);e||this.apiCore.exec(this.callerName,"modularConfiguratorSceneUpdated",Z.call(this));return b},Ia=function(b,d){if(b){for(var e=
b.localId,f=this.graphNodesByLocalId[e],g=[b],h=0;h<g.length;++h)1!=g[h].type&&(delete this.graphNodesByLocalId[g[h].localId],g.push.apply(g,$jscomp.arrayFromIterable(g[h].children)));if(f.parent){for(g=0;g<f.parentGraphSlots.length;++g)f.parentGraphSlots[g].inUse=!1;f.parent.fromRelation?(f.parent.parent.children.splice(f.parent.parent.children.indexOf(f.parent),1),this.graphNodes.splice(this.graphNodes.indexOf(f.parent),1)):f.parent.children.splice(f.parent.children.indexOf(f),1);da.call(this,f)}else this.graphRoot=
null;this.graphNodes.splice(this.graphNodes.indexOf(f),1);for(g=0;g<f.children.length;++g){h=f.children[g];f.children.push.apply(f.children,$jscomp.arrayFromIterable(h.children));h.node&&this.productNodesInstancesContainers[h.node.localId]&&(this.productNodesInstancesContainers[h.node.localId].elem.detach(),delete this.productNodesInstancesContainers[h.node.localId],this.zoneProductNodesInstancesContainers[h.node.localId].elem.detach(),delete this.zoneProductNodesInstancesContainers[h.node.localId]);
for(var k=$jscomp.makeIterator(h.graphZones),l=k.next();!l.done;l=k.next())l=l.value,l.container&&(l.container.detach(),delete l.container);if(this.settings.renderBoundingBoxes)for(k=0;k<h.collisionBoundingBoxes.length;++k)-1!==this.scene.boundingBoxesToRender.indexOf(h.collisionBoundingBoxes[k])&&this.scene.boundingBoxesToRender.splice(this.scene.boundingBoxesToRender.indexOf(h.collisionBoundingBoxes[k]),1);this.graphNodes.splice(this.graphNodes.indexOf(h),1);h.destroy(this.scene)}g=$jscomp.makeIterator(f.graphZones);
for(h=g.next();!h.done;h=g.next())h=h.value,h.container&&(h.container.detach(),delete h.container);this.scene.removeProductNode(e,!1,d);if(this.settings.renderBoundingBoxes)for(d=0;d<f.collisionBoundingBoxes.length;++d)-1!==this.scene.boundingBoxesToRender.indexOf(f.collisionBoundingBoxes[d])&&this.scene.boundingBoxesToRender.splice(this.scene.boundingBoxesToRender.indexOf(f.collisionBoundingBoxes[d]),1);this.apiCore.exec(this.callerName,"resetCameraScene");this.apiCore.exec(this.callerName,"rdr.initSceneBuffers",
this.scene);this.apiCore.exec(this.callerName,"rdr.updateSceneMaterials",this.scene);this.apiCore.exec(this.callerName,"rdr.updateSceneLights",this.scene);this.apiCore.exec(this.callerName,"rdr.updateShaders",this.scene);f.parentGraphZone.productNodesInstances&&delete f.parentGraphZone.productNodesInstances[e];this.currentProductNodeInstance===b&&F.call(this,null);u.isConfiguratorUIDisabled||(this.productNodesInstancesContainers[e].elem.detach(),this.zoneProductNodesInstancesContainers[e].elem.detach());
delete this.productNodesInstancesContainers[e];delete this.zoneProductNodesInstancesContainers[e];f.destroy(this.scene);Ba.call(this);ia.call(this,!1);this.apiCore.exec(this.callerName,"modularConfiguratorSceneUpdated",Z.call(this))}},qa=function(b){for(var d=0;d<b.targetSlot.zone.collisionBoundingBoxes.length;++d)b.collisionBoundingBoxes[d]=this.scene.transformBoundingBox(b.targetSlot.zone.collisionBoundingBoxes[d],mat4.multiply(b.graphZone.graphNode.node.modelMatrix,b.connectionMatrix,this.computeMatrix),
b.collisionBoundingBoxes[d])},Va=function(b){var d=!1;if(b.collisionBoundingBoxes.length)for(var e=$jscomp.makeIterator(this.graphNodes),f=e.next();!f.done;f=e.next())if(f=f.value,!(this.graphNodesToIgnoreCollisionsWith&&this.graphNodesToIgnoreCollisionsWith.has(f)||1===f.node.localId)&&f.collisionBoundingBoxes.length){var g=this.scene.areBoundingBoxesArraysColliding(f.collisionBoundingBoxes,b.collisionBoundingBoxes);d=d||g;g?(b.collidingWith.add(f),f.collidingWith.add(b)):(b.collidingWith.delete(f),
f.collidingWith.delete(b))}d?-1!==b.graphSlot.addableProducts[b.productId].indexOf(b)&&b.graphSlot.addableProducts[b.productId].splice(b.graphSlot.addableProducts[b.productId].indexOf(b),1):-1===b.graphSlot.addableProducts[b.productId].indexOf(b)&&b.graphSlot.addableProducts[b.productId].push(b)},va=function(b,d,e){if(d.allAddableProducts)for(var f in d.allAddableProducts){b={};for(var g=$jscomp.makeIterator(d.allAddableProducts[f]),h=g.next();!h.done;b={$jscomp$loop$prop$parentGraphSlotsInUse$298:b.$jscomp$loop$prop$parentGraphSlotsInUse$298},
h=g.next())h=h.value,b.$jscomp$loop$prop$parentGraphSlotsInUse$298=!1,h.sourceSlots.forEach(function(b){return function(d){return b.$jscomp$loop$prop$parentGraphSlotsInUse$298=b.$jscomp$loop$prop$parentGraphSlotsInUse$298||d.inUse}}(b)),e&&qa.call(this,h),h.parentGraphSlotsInUse=b.$jscomp$loop$prop$parentGraphSlotsInUse$298,Va.call(this,h)}else for(d.addableProducts={},d.allAddableProducts={},e=0;e<d.slot.connectors.length;++e)if(f=d.slot.connectors[e],g=this.connectorCompatibilities[f.type])for(h=
0;h<g.length;++h){var k=g[h],l=k.targets[0],m=b.slots.indexOf(d);if(b.slots.length-m>=k.sources.length&&this.slotsByConnectorType[l])for(var n=0;n<this.slotsByConnectorType[l].length;++n){var p=this.slotsByConnectorType[l][n],q=p.zone,r=q.slots.indexOf(p.slot),t=p.zone.productNodeId;this.settings.furnitureMode&&(t=p.zone.article);var v=[],u=[],w=q.slots.length-r>=k.targets.length,A=!1,B=void 0,Q=void 0,D=void 0;B=r;Q=m;for(D=0;w&&B<q.slots.length&&Q<b.slots.length&&D<k.sources.length;++B,++Q,++D){var E=
b.slots[Q];r=E.slot;var C=q.slots[B];A=A||E.inUse;E=!1;for(var F=0;!E&&F<r.connectors.length;++F)E=r.connectors[F].type==k.sources[D];if(E)for(E=!1,F=0;!E&&F<C.connectors.length;++F)E=C.connectors[F].type==k.targets[D];E||(w=!1);v.push(r);u.push(C)}w&&D==k.sources.length&&(d.allAddableProducts[t]||(d.addableProducts[t]=[],d.allAddableProducts[t]=[]),p=new Za(t,b,d,p,f,v,[].concat($jscomp.arrayFromIterable(k.sources)),q,u,[].concat($jscomp.arrayFromIterable(k.targets)),k.relation),wa.call(this,p,p.connectionMatrix),
d.allAddableProducts[t].push(p),p.parentGraphSlotsInUse=A,qa.call(this,p),Va.call(this,p))}}},la=function(b,d,e){e||(e={});for(var f=0;f<b.slots.length;++f){var g=b.slots[f];if(!g.inUse&&(d?d===g:1))for(var h in g.addableProducts){var k=g.addableProducts[h].filter(function(b){return!b.parentGraphSlotsInUse});k.length&&(e[h]||(e[h]=[]),e[h].push.apply(e[h],$jscomp.arrayFromIterable(k)))}}return e},fa=function(b,d,e){e||(e={});for(var f=0;f<b.slots.length;++f){var g=b.slots[f];if(d?d===g:1)for(var h in g.allAddableProducts){var k=
g.allAddableProducts[h].filter(function(b){return!b.parentGraphSlotsInUse});k.length&&(e[h]||(e[h]=[]),e[h].push.apply(e[h],$jscomp.arrayFromIterable(k)))}}return e},P=function(){for(var b={},d=0;d<this.graphNodes.length;++d)for(var e=this.graphNodes[d],f=0;f<e.graphZones.length;++f)la.call(this,e.graphZones[f],null,b);return b},Ba=function(){this.draggableProducts={};for(var b=$jscomp.makeIterator(this.graphNodes),d=b.next();!d.done;d=b.next()){d=$jscomp.makeIterator(d.value.graphZones);for(var e=
d.next();!e.done;e=d.next()){e=e.value;for(var f=$jscomp.makeIterator(e.slots),g=f.next();!g.done;g=f.next())if(g=g.value,va.call(this,e,g),!g.inUse)for(var h in g.addableProducts)this.draggableProducts[h]||(this.draggableProducts[h]=[]),this.draggableProducts[h].push.apply(this.draggableProducts[h],$jscomp.arrayFromIterable(g.addableProducts[h].filter(function(b){return!b.parentGraphSlotsInUse})))}}},Ka=function(b){var d=this,e=P.call(this);if(!b)return Object.keys(e).map(function(b){return d.settings.furnitureMode?
{name:e[b][0].targetZone.name,article:b,defaultConfiguration:d.currentGlobalFurnitureConfiguration||e[b][0].targetZone.defaultConfiguration}:d.scene.productNodes[b]});var f=stage.extend({},this.zonesByProductId);b=Object.keys(e).map(function(b){delete f[b];return d.settings.furnitureMode?{available:!0,name:e[b][0].targetZone.name,article:b,defaultConfiguration:d.currentGlobalFurnitureConfiguration||e[b][0].targetZone.defaultConfiguration}:stage.extend({available:!0},d.scene.productNodes[b])});return[].concat($jscomp.arrayFromIterable(b),
$jscomp.arrayFromIterable(Object.keys(f).map(function(b){return d.settings.furnitureMode?{available:!1,name:f[b][0].name,article:b,defaultConfiguration:d.currentGlobalFurnitureConfiguration||f[b][0].defaultConfiguration}:stage.extend({available:!1},d.scene.productNodes[b])})))},wa=function(b,d){d=mat4.identity(d?d:mat4.create());mat4.translate(d,[b.connector.position_x,b.connector.position_y,b.connector.position_z]);mat4.rotateZ(d,b.connector.angleZ*Math.PI/180);mat4.rotateY(d,b.connector.angleY*
Math.PI/180);mat4.rotateX(d,b.connector.angleX*Math.PI/180);mat4.rotateX(d,-b.targetSlot.connector.angleX*Math.PI/180);mat4.rotateY(d,-b.targetSlot.connector.angleY*Math.PI/180);mat4.rotateZ(d,-b.targetSlot.connector.angleZ*Math.PI/180);mat4.translate(d,[-b.targetSlot.connector.position_x,-b.targetSlot.connector.position_y,-b.targetSlot.connector.position_z]);return d},Ja=function(b,d,e,f,g){var h=null;if(b.fromRelation)for(Ja.call(this,b.children[0],d,e,b,g),d=1;d<b.children.length;++d)Ja.call(this,
b.children[d],h,e,null,g);else{for(var k=!1,l=0;!k&&l<d.graphZones.length;++l){var m=d.graphZones[l];if(m.zone.reference==b.parentZone.reference){var n=this.zonesByReference[b.reference],p=v.call(this,n),q=la.call(this,m);if(q[p])for(var r=0;!k&&r<q[p].length;++r){var t=q[p][r];if(t.targetZone===n&&t.graphZone.zone===m.zone&&t.sourceSlots.length==b.parentSlots.length&&t.targetSlots.length==b.slots.length){for(var u=!0,w=0;u&&w<t.sourceSlots.length;++w)u=t.sourceSlots[w].reference==b.parentSlots[w].reference&&
t.targetSlots[w].reference==b.slots[w].reference;u&&(g?h=this.settings.furnitureMode?ba.call(this,t.targetZone.article,b.furnitureConfiguration,t,!0,b.localId,f&&f.localId):oa.call(this,t.targetZone.productNodeId,t,t.graphZone,!0,b.localId,f&&f.localId,b.configuration,null):(this.settings.furnitureMode?e.push(ba.call(this,t.targetZone.article,b.furnitureConfiguration,t,!0)):e.push(oa.call(this,t.targetZone.productNodeId,t,t.graphZone,!0,null,null,b.configuration,b.localId)),h=e.slice(-1)[0].graphNode),
k=!0)}}}}if(k)for(d=0;d<b.children.length;++d)Ja.call(this,b.children[d],h,e,null,g)}},La=function(b,d,e){var f=this;if(b.SKU!==this.scene.root.productNode.sku)return stage.createError(304,"Configuration can not be applied to this viewer.");if(!d)for(var g=0;g<this.scene.root.children.length;++g)1!=this.scene.root.children[g].type&&this.scene.removeProductNode(this.scene.root.children[g].localId);this.graphNodes.forEach(function(b){return b.destroy(f.scene)});this.graphNodes=[];this.graphNodesByLocalId=
{};this.graphRoot=p.call(this,this.scene.root);Ba.call(this);var h=[];for(g=0;g<b.children.length;++g)Ja.call(this,b.children[g],this.graphRoot,h,null,d);if(d)e||this.apiCore.exec(this.callerName,"modularConfiguratorSceneUpdated",Z.call(this));else{var k=[],l=[];h.forEach(function(b){k.push.apply(k,$jscomp.arrayFromIterable(b.toLoad));l.push.apply(l,$jscomp.arrayFromIterable(b.toBuild))});this.apiCore.exec(this.callerName,"loadProductNodes",this.scene,k,stage.setContext(function(){var b=this;++this.scene.stopDraw;
this.scene.addProductNodes(l,stage.setContext(ra,this,h,function(){e||b.apiCore.exec(b.callerName,"modularConfiguratorSceneUpdated",Z.call(b))}))},this))}},ra=function(b,d){var e=this;this.transactionContent=[];this.apiCore.exec(this.callerName,"beginViewerAnimationTransaction",stage.setContext(function(){for(var b in this.transactionContent){var e=this.transactionContent[b].mt,f=this.scene.materials[this.transactionContent[b].ms.id],g=this.transactionContent[b].productNodesIds;if(e){e.currentMaterialId=
f.id;for(var h in e.polylistInstances){var k=e.polylistInstances[h];g.length&&-1===g.indexOf(k.node.localId)||k.matAnim.resetMaterial(f)}}else for(h in e=this.transactionContent[b].polylist,e.instances)k=e.instances[h],g.length&&-1===g.indexOf(k.node.localId)||k.matAnim.resetMaterial(f)}--this.scene.stopDraw;this.apiCore.exec(this.callerName,"rdr.initSceneBuffers",this.scene);this.apiCore.exec(this.callerName,"rdr.updateSceneLights",this.scene);this.apiCore.exec(this.callerName,"rdr.updateSceneMaterials",
this.scene);this.apiCore.exec(this.callerName,"rdr.updateShaders",this.scene);for(b in this.scene.nodesInUse)this.scene.updateMatrices(this.scene.nodesInUse[b]);d&&d()},this),stage.setContext(function(){this.apiCore.exec(this.callerName,"onError","configuration download error")},this));b.forEach(function(b){if(b.materials){for(var d in b.materials.materialsToApply.materials){var f=b.materials.materialsToApply.materials[d];e.apiCore.exec(e.callerName,"updateMaterialTreeByName",f.materialTree.name,
f.materialSettings.name,b.materials.productNodesIds,0);e.transactionContent.push({mt:f.materialTree,ms:f.materialSettings,productNodesIds:b.materials.productNodesIds})}for(d in b.materials.materialsToApply.polylists)f=b.materials.materialsToApply.polylists[d],b.materials.productNodesIds.forEach(function(b){e.apiCore.exec(e.callerName,"updatePolylistMaterial",f.polylist.id,f.materialSettings.name,b,void 0,0)}),e.transactionContent.push({polylist:f.polylist,ms:f.materialSettings,productNodesIds:b.materials.productNodesIds})}});
this.apiCore.exec(this.callerName,"endTransaction")},Sa=function(b,d,e){var f=this;if(b=this.graphNodesByLocalId[b]){var g=b.graphZone,h="|"+g.zone.article+"|"+d;b.currentFurnitureConfiguration=d;d=this.apiCore.exec(this.callerName,"ofml.getModularGraphToBuild",h);b=Object.keys(g.productNodesInstances).map(function(b){return parseInt(b)}).concat(b.childrenNodes.map(function(b){return b.localId}));n.call(this,d.materialsToApply,b,function(){f.apiCore.exec(f.callerName,"rdr.initSceneBuffers",f.scene);
f.apiCore.exec(f.callerName,"rdr.updateSceneLights",f.scene);f.apiCore.exec(f.callerName,"rdr.updateSceneMaterials",f.scene);f.apiCore.exec(f.callerName,"rdr.updateShaders",f.scene);f.scene.update();f.apiCore.exec(f.callerName,"modularConfiguratorSceneUpdated",Z.call(f));e&&e()})}},Ya=function(b,d){var e=this,f=[];b=$jscomp.makeIterator(b);for(var g=b.next();!g.done;g=b.next()){var h=g.value;g=h.configuration;h=this.graphNodesByLocalId[h.localId];if(!h)return;var k=h.graphZone,l="|"+k.zone.article+
"|"+g;h.currentFurnitureConfiguration=g;g=this.apiCore.exec(this.callerName,"ofml.getModularGraphToBuild",l);h=Object.keys(k.productNodesInstances).map(function(b){return parseInt(b)}).concat(h.childrenNodes.map(function(b){return b.localId}));f.push({materialsToApply:g.materialsToApply,productNodesIds:h})}B.call(this,f,function(){e.apiCore.exec(e.callerName,"rdr.initSceneBuffers",e.scene);e.apiCore.exec(e.callerName,"rdr.updateSceneLights",e.scene);e.apiCore.exec(e.callerName,"rdr.updateSceneMaterials",
e.scene);e.apiCore.exec(e.callerName,"rdr.updateShaders",e.scene);e.scene.update();e.apiCore.exec(e.callerName,"modularConfiguratorSceneUpdated",Z.call(e));d&&d()})},Ra=function(b,d){for(var e=this,f=[],g=0;g<this.graphNodes.length;++g){var h=this.graphNodes[g],k=h.graphZone;if(k){var l=this.apiCore.exec(this.callerName,"ofml.getModularGraphToBuild","|"+k.zone.article+"|"+b);h.currentFurnitureConfiguration=b;k=Object.keys(k.productNodesInstances).map(function(b){return parseInt(b)});h.childrenNodes&&
k.push.apply(k,$jscomp.arrayFromIterable(h.childrenNodes.map(function(b){return b.localId})));f.push({materials:{materialsToApply:l.materialsToApply,productNodesIds:k}})}}ra.call(this,f,function(){e.apiCore.exec(e.callerName,"modularConfiguratorSceneUpdated",Z.call(e));d&&d()});this.currentGlobalFurnitureConfiguration=b},ma=function(b){var d=this,e=this.graphNodesByLocalId[b];b=e.children.filter(function(b){return!b.parentRelation.draggable});var f=0;e.parent.graphZones.forEach(function(b){return f+=
b.slots.length});1==b.length&&e.parent&&!e.parent.parent&&1==f&&R.call(this,e,b[0]);b=v.call(this,e.graphZone.zone);for(var g=new Set,h=[e],k=[mat4.identity(mat4.create())],l=[],m={$jscomp$loop$prop$i$301:0};m.$jscomp$loop$prop$i$301<h.length;m={$jscomp$loop$prop$i$301:m.$jscomp$loop$prop$i$301},++m.$jscomp$loop$prop$i$301)g.add(h[m.$jscomp$loop$prop$i$301]),h.push.apply(h,$jscomp.arrayFromIterable(h[m.$jscomp$loop$prop$i$301].children)),h[m.$jscomp$loop$prop$i$301].children.forEach(function(b){return function(d){k.push(mat4.multiply(k[b.$jscomp$loop$prop$i$301],
d.node.matrix,mat4.create()))}}(m)),h[m.$jscomp$loop$prop$i$301].fromRelation||l.push.apply(l,$jscomp.arrayFromIterable(h[m.$jscomp$loop$prop$i$301].graphZone.zone.collisionBoundingBoxes.map(function(b){return function(e){return d.scene.transformBoundingBox(e,k[b.$jscomp$loop$prop$i$301])}}(m))));var n=l.map(function(b){return d.scene.copyBoundingBox(b)}),p=[];h=$jscomp.makeIterator(this.graphNodes);for(m=h.next();!m.done;m=h.next())m=m.value,g.has(m)||m!==e&&m.collisionBoundingBoxes&&p.push.apply(p,
$jscomp.arrayFromIterable(m.collisionBoundingBoxes));g=[];h=null;var q={};e.parentGraphSlot.allAddableProducts[b]&&(g.push.apply(g,$jscomp.arrayFromIterable(e.parentGraphSlot.allAddableProducts[b].filter(function(b){return b.targetSlots[0].reference===e.graphSlots[0].slot.reference&&e.graphZone.zone===b.targetZone}))),h=g[0],q[h.targetZone.reference]=!0,g.push.apply(g,$jscomp.arrayFromIterable(e.parentGraphSlot.allAddableProducts[b].filter(function(b){if(q[b.targetZone.reference]||b.parentGraphSlotsInUse)return!1;
for(var e=0;e<l.length;++e)d.scene.transformBoundingBox(l[e],mat4.multiply(b.graphZone.graphNode.node.modelMatrix,b.connectionMatrix,d.computeMatrix),n[e]);return d.scene.areBoundingBoxesArraysColliding(n,p)?!1:q[b.targetZone.reference]=!0}))));return{addables:g,currentAddable:h}},bb=function(b){return this.scene.productNodeInstancesByLocalId[b]&&this.scene.productNodeInstancesByLocalId[b].draggable?1<ma.call(this,b).addables.length:!1},gb=function(b){if(this.graphNodesByLocalId[b]){var d=this.graphNodesByLocalId[b],
e=d.parent;if(d.node.draggable){var f=ma.call(this,b);1<f.addables.length&&f.currentAddable&&(b=f.addables,b=b.sort(function(b,d){return b.targetZone.number<d.targetZone.number?1:-1}),f=b.indexOf(f.currentAddable),b.splice(f,1),b=b[f%b.length],S.call(this,d.node,d,{matrix:b.connectionMatrix,parentLocalId:e.fromRelation?e.parent.node.localId:e.node.localId,addable:b}),xa.call(this,d,b),this.scene.computeSceneBoundingBoxes(),this.scene.hasSomeShadow&&(this.scene.visibilityChanged=!0))}}},ib=function(b){this.currentZoneSelected===
b&&(this.draggableProducts=b.draggableProductNodes);if(!u.isConfiguratorUIDisabled&&this.menuDisplayed){Object.keys(b.draggableProductNodes).length||Object.keys(b.productNodesInstances).length||b.container.hide();b.container.show();if(Object.keys(b.draggableProductNodes).length){b.productsListContainer.show();for(var d in b.draggableProductNodes)for(var e=b.draggableProductNodes[d],f=0;f<e.length;++f){var h=d;var k=e,l=h;this.zoneProductNodesContainers[l]||(this.zoneProductNodesContainers[l]={elem:this.globalProductsListListContainer.build([{tagName:"div",
attributes:{klass:"modularConfiguratorProductContainer"},returnActive:!0,childs:[{tagName:"div",attributes:{klass:"modularConfiguratorProductPreviewContainer"}},{tagName:"div",attributes:{klass:"modularConfiguratorProductTitleContainer",inner:this.scene.productNodes[l].name}}]}])});for(var m=[["onDragStart","dragstart"]],n=0;n<m.length;++n)this.zoneProductNodesContainers[l][m[n][0]]&&this.zoneProductNodesContainers[l].elem.unListen(m[n][1],this.zoneProductNodesContainers[l][m[n][0]]);this.zoneProductNodesContainers[l].elem.detach();
this.zoneProductNodesContainers[h].onDragStart=stage.setContext(g,this,h,null,k);this.zoneProductNodesContainers[h].elem.listen("dragstart",this.zoneProductNodesContainers[h].onDragStart);this.zoneProductNodesContainers[h].elem.get(0).setAttribute("draggable",!0);h=this.zoneProductNodesContainers[h].elem;h.attach(b.productsListListContainer.get(0),"bottom")}}else b.productsListContainer.hide();if(Object.keys(b.productNodesInstances).length){b.productInstancesListContainer.show();for(var p in b.productNodesInstances)h=
this.zoneProductNodesInstancesContainers[p].elem,h.detach(),h.attach(b.productInstancesListListContainer.get(0),"bottom")}else b.productInstancesListContainer.hide()}},hb=function(b,d){this.menuDisplayed=void 0!==b?b:!this.menuDisplayed;this.pinsDisplayed=void 0!==d?d:!this.pinsDisplayed;this.menuDisplayed?(this.menuContainer.show(),ia.call(this,!1)):this.menuContainer.hide();this.pinsDisplayed?this.pinsContainer.show():this.pinsContainer.hide()},fb=function(){return[{tagName:"div",attributes:{klass:"modularConfiguratorAddableProductsTitle"},
childs:[{tagName:"div",attributes:{klass:"modularConfiguratorAddableProductsListContainer"},childs:[{tagName:"div",attributes:{klass:"modularConfiguratorAddableProductsListTitle",inner:"Drag product to add",title:"Drag product to add"}},{tagName:"div",attributes:{klass:"modularConfiguratorAddableProductsListListContainer"}}]}]},{tagName:"div",attributes:{klass:"modularConfiguratorProductInstancesListContainer"},childs:[{tagName:"div",attributes:{klass:"modularConfiguratorProductInstancesListTitle",
inner:"Added products",title:"Added products"}},{tagName:"div",attributes:{klass:"modularConfiguratorProductInstancesListListContainer"}}]}]},Aa=function(b,d,e,f){b=this.scene.get("ModularConfiguratorGraphZone",b);d=this.scene.get("ModularConfiguratorGraphZoneSlot",d);b&&d&&(f=fa.call(this,b,d),f[e]&&(d.inUse&&Ia.call(this,this.scene.productNodeInstancesByLocalId[d.productNodeLocalId]),this.updateSlotWhenProductNodeAdded=!0,oa.call(this,e,f[e][0],b)))},eb=function(d){if(this.pinsDisplayed){for(var e=
0;e<this.pins.length;++e){var f=this.pins[e].slot?this.pins[e].slot.pinContainer:this.pins[e].nodeInstance?this.pins[e].nodeInstance.pinContainer:null;f&&f.remove()}this.pinIds=1;this.pins=[];this.slotsByPinId={};if(!this.dragging)for(e=0;e<this.graphNodes.length;++e){f=this.graphNodes[e];for(var g=0;g<f.graphZones.length;++g){var h=f.graphZones[g];if(this.mode!==b.BY_ZONE||!this.currentZoneSelected||h===this.currentZoneSelected)for(var k=0;k<h.slots.length;++k){var l=h.slots[k];if(!l.inUse&&Object.keys(la.call(this,
h,l)).length){var m={id:this.pinIds,number:g,zone:h,slot:l,nodeLocalId:f.node.localId,productNodeId:f.node.productNode.id,x:l.slot.position_x,y:l.slot.position_y,z:l.slot.position_z};this.slotsByPinId[this.pinIds++]=l;this.pins.push(m);db.call(this,h,l)}}}}d?setTimeout(stage.setContext(function(){this.apiCore.exec(this.callerName,"rdr.setAnnotations",this.pins)},this),1):this.apiCore.exec(this.callerName,"rdr.setAnnotations",this.pins)}},ab=function(){for(var b=0;b<this.pins.length;++b)this.pins[b].slot.pinContainer&&
this.pins[b].slot.pinContainer.css({"pointer-events":"default",display:"block"})},Ma=function(){for(var b=0;b<this.pins.length;++b)this.pins[b].slot.pinContainer&&this.pins[b].slot.pinContainer.css({"pointer-events":"none",display:"none"})},Ta=function(b){if(this.modularConfigurator&&!u.isConfiguratorUIDisabled)for(var d=0;d<b.length;++d){var e=b[d],f=this.slotsByPinId[e.id],g=null;if(f)g=f.pinContainer;else if(f=this.nodeInstancesByPinId[e.id])g=f.pinContainer;e.displayed?(g.show(),e.visible||g.css({opacity:.5}),
g.css({top:e.y-20+"px",left:e.x-20+"px"})):g.hide()}},db=function(b,d){b=[{tagName:"div",attributes:{klass:"modularConfiguratorPinContainer"},events:[{onEvent:"click",callback:stage.setContext(Oa,this,b,d)}],returnActive:!0,childs:[{tagName:"svg",nameSpace:"http://www.w3.org/2000/svg",attributes:{klass:"modularConfiguratorPin",viewBox:"0 0 30 30",preserveAspectRatio:"xMidYMid",width:30,height:30},childs:[{tagName:"path",nameSpace:"http://www.w3.org/2000/svg",attributes:{klass:"circleBackground",d:"M16.5 7.5H13.5V13.5H7.5V16.5H13.5V22.5H16.5V16.5H22.5V13.5H16.5V7.5ZM15 0C6.735 0 0 6.735 0 15C0 23.265 6.735 30 15 30C23.265 30 30 23.265 30 15C30 6.735 23.265 0 15 0ZM15 27C8.385 27 3 21.615 3 15C3 8.385 8.385 3 15 3C21.615 3 27 8.385 27 15C27 21.615 21.615 27 15 27Z",
fill:this.settings.style.foregroundNormalColor}}]}]}];d.pinContainer=this.pinsContainer.build(b);d.pinContainer.hide()},Oa=function(b,d){E.call(this);this.currentProductNodeInstance&&F.call(this,this.currentProductNodeInstance);var f=fa.call(this,b,d);N.call(this,f,b,d,null);e.call(this,b,d,f,null)},Qa=function(b){if(!this.productsContainers[b]){var d=this.settings.furnitureMode?{name:b,thumbnail:null}:this.scene.productNodes[b],e=[{tagName:"div",attributes:{klass:"modularConfiguratorProductContainer"},
returnActive:!0,childs:[{tagName:"div",attributes:{klass:"modularConfiguratorProductPreviewContainer"}},{tagName:"div",attributes:{klass:"modularConfiguratorProductTitleContainer",inner:d.name,title:d.name}}]}];u.isConfiguratorUIDisabled?this.productsContainers[b]={}:(this.productsContainers[b]={elem:this.globalProductsListListContainer.build(e)},d.thumbnail?this.productsContainers[b].elem.find(".modularConfiguratorProductPreviewContainer").css({"background-image":"url("+d.thumbnail+")"}):this.productsContainers[b].elem.find(".modularConfiguratorProductPreviewContainer").hide())}d=
$jscomp.makeIterator([["onClick","click"],["onDragStart","dragstart"]]);for(e=d.next();!e.done;e=d.next())e=e.value,this.productsContainers[b][e[0]]&&this.productsContainers[b].elem.unListen(e[1],this.productsContainers[b][e[0]]);u.isConfiguratorUIDisabled||this.productsContainers[b].elem.detach();return this.productsContainers[b]},N=function(b,d,e,f){if(u.isConfiguratorUIDisabled)for(var g in b);else{for(var h in this.productsContainers)this.productsContainers[h].elem.detach();for(var k in this.productNodesInstancesContainers)this.productNodesInstancesContainers[k].elem.detach();
u.isConfiguratorUIDisabled||(this.slotContainerTitle.update(d.zone.name+" - "+e.slot.name),this.slotContainerTitle.get(0).setAttribute("title",d.zone.name+" - "+e.slot.name));for(var l in b)if(!f||f.node.productNode.id!=l)for(g=$jscomp.makeIterator(b[l]),h=g.next();!h.done;h=g.next()){h=h.value;k=l;var m=d,n=e;Qa.call(this,k);this.productsContainers[k].onClick=stage.setContext(ea,this,k,h,m,n);this.productsContainers[k].elem.listen("click",this.productsContainers[k].onClick);this.productsContainers[k].elem.get(0).removeAttribute("draggable");
this.productsContainers[k].elem.attach(this.slotContainer.get(0),"bottom")}f&&za.call(this,f.node.localId).elem.attach(this.slotContainer.get(0),"bottom");this.slotContainer.show();this.globalProductsContainer.hide();this.zonesContainer.hide()}return b},za=function(b){if(!this.productNodesInstancesContainers[b]){var d=[{tagName:"div",attributes:{klass:"modularConfiguratorProductContainer modularConfiguratorProductInstanceContainer"},returnActive:!0,events:[{onEvent:"click",callback:stage.setContext(Ca,
this)}],childs:[{tagName:"div",attributes:{klass:"modularConfiguratorProductPreviewContainer"}},{tagName:"div",attributes:{klass:"modularConfiguratorProductTitleContainer",inner:this.scene.productNodeInstancesByLocalId[b].name}},{tagName:"div",attributes:{klass:"modularConfiguratorProductDeleteButton",inner:"X"},events:[{onEvent:"click",callback:stage.setContext(Ua,this,b)}]}]}];this.productNodesInstancesContainers[b]={elem:this.globalProductInstancesListListContainer.build(d)}}this.productNodesInstancesContainers[b].elem.detach();
return this.productNodesInstancesContainers[b]},ca=function(b){if(!this.zoneProductNodesInstancesContainers[b]){var d=[{tagName:"div",attributes:{klass:"modularConfiguratorProductContainer modularConfiguratorProductInstanceContainer"},returnActive:!0,events:[{onEvent:"click",callback:stage.setContext(Ca,this)}],childs:[{tagName:"div",attributes:{klass:"modularConfiguratorProductPreviewContainer"}},{tagName:"div",attributes:{klass:"modularConfiguratorProductTitleContainer",inner:this.scene.productNodeInstancesByLocalId[b].name}},
{tagName:"div",attributes:{klass:"modularConfiguratorProductDeleteButton",inner:"X"},events:[{onEvent:"click",callback:stage.setContext(Ua,this,b)}]}]}];this.zoneProductNodesInstancesContainers[b]={elem:this.globalProductInstancesListListContainer.build(d)}}this.zoneProductNodesInstancesContainers[b].elem.detach();return this.zoneProductNodesInstancesContainers[b]},Ea=function(b){this.currentZoneSelected&&this.currentZoneSelected.container.removeClass("displayed");this.currentZoneSelected===b?(this.currentZoneSelected=
null,u.isConfiguratorUIDisabled||eb.call(this)):(this.currentZoneSelected=b,this.currentZoneSelected.container.addClass("displayed"),u.isConfiguratorUIDisabled||eb.call(this),ib.call(this,b))},Ca=function(b){console.log("instance clicked",b)},Ua=function(b,d){d.stopPropagation();d.preventDefault();Ia.call(this,this.scene.productNodeInstancesByLocalId[b])},sa=function(){var b=this.scene.getAll("Polylist"),d={};Object.values(b).forEach(function(b){d[b.name]=b});return d},na=function(b){if(!b)return null;
var d={materials:[],polylists:[]};for(f in b.materialTrees){var e=b.materialTrees[f];e=this.scene.getMaterialTreeAndSettingsByMtMsNames(e.materialTree,e.materialSettings);1==e.length&&d.materials.push(e[0])}var f=sa.call(this);for(var g in b.polylists){var h=b.polylists[g];f[h.polylist]&&(e=f[h.polylist],(h=this.scene.materialsContent.materialSettingsByName[e.materialTree.id][h.materialSettings])&&d.polylists.push({polylist:e,materialSettings:h}))}return d},kb=function(b,d,e){this.node=b;this.parentGraphSlots=
e;d?(this.childrenNodes=d.children,this.currentFurnitureConfiguration=d.furnitureConfiguration,this.parent=d.graphZone.graphNode,this.parentGraphZone=d.graphZone,this.parentGraphSlot=d.graphSlot,this.parentRelation=d.relation,this.connectionMatrix=d.connectionMatrix,this.collisionBoundingBoxes=d.collisionBoundingBoxes):(this.childrenNodes=[],this.currentFurnitureConfiguration="",this.parentRelation=this.parentGraphSlot=this.parentGraphZone=this.parent=null,this.connectionMatrix=mat4.identity(mat4.create()),
this.collisionBoundingBoxes=[]);this.graphZone=null;this.graphSlots=[];this.graphZones=[];this.children=[];this.collidingWith=new Set;this.fromRelation=!1};kb.prototype.destroy=function(b){if(!this.destroyed){this.destroyed=!0;this.graphZones.forEach(function(d){return d.destroy(b)});for(var d=$jscomp.makeIterator(this.collidingWith),e=d.next();!e.done;e=d.next())e.value.collidingWith.delete(this);delete this.parent;delete this.children;delete this.graphZone;delete this.graphSlots;delete this.graphZones;
delete this.parentGraphZone;delete this.parentGraphSlot;delete this.parentGraphSlots;delete this.collisionBoundingBoxes;delete this.collidingWith}};var Da=function(b,d,e,f){this.id=b;this.zone=d;this.graphNode=e;this.slots=[];this.draggableProductNodes={};this.productNodesInstances={};f.register("ModularConfiguratorGraphZone",this)};Da.prototype.destroy=function(b){this.destroyed||(this.destroyed=!0,b.unregister("ModularConfiguratorGraphZone",this),this.slots.forEach(function(d){return d.destroy(b)}),
delete this.zone,delete this.graphNode,delete this.slots,delete this.draggableProductNodes,delete this.productNodesInstances)};var xb=function(b,d,e,f){this.id=b;this.slot=d;this.inUse=e;f.register("ModularConfiguratorGraphZoneSlot",this)};xb.prototype.destroy=function(b){if(!this.destroyed){this.destroyed=!0;b.unregister("ModularConfiguratorGraphZoneSlot",this);for(var d in this.allAddableProducts)this.allAddableProducts[d].forEach(function(b){return b.destroy()}),this.allAddableProducts[d]=[];delete this.slot;
delete this.allAddableProducts;delete this.addableProducts}};var Za=function(b,d,e,f,g,h,k,l,m,n,p){this.productId=b;this.graphZone=d;this.graphSlot=e;this.targetSlot=f;this.connector=g;this.sourceSlots=h;this.sourceConnectors=k;this.targetZone=l;this.targetSlots=m;this.targetConnectors=n;this.relation=p;this.connectionMatrix=mat4.create();this.collisionBoundingBoxes=[];this.collidingWith=new Set};Za.prototype.destroy=function(){for(var b=$jscomp.makeIterator(this.collidingWith),d=b.next();!d.done;d=
b.next())d.value.collidingWith.delete(this);delete this.graphZone;delete this.graphSlot;delete this.targetSlot;delete this.connector;delete this.sourceSlots;delete this.sourceConnectors;delete this.targetZone;delete this.targetSlots;delete this.targetConnectors;delete this.relation;delete this.connectionMatrix;delete this.collisionBoundingBoxes;delete this.collidingWith};return u});stage.provide("emersya.viewer.modules.arCore");stage.require("emersya.viewer.modules.API.core");
stage.register.call(stage.emersya.viewer.modules,"arCore",function(){var b={routing:"",mainColor:"#00b1ab",secondColor:"#ffffff",displayShareOnSocialNetworkButton:!1,displayDownloadRenderButton:!1,displayAnimationMenu:!1,displayPresetMenu:!1,displayMenu:!1,displayArStartButton:!0,videoOpacity:.5,photoOpacity:.5,arEmersyaEnabled:1,arMoveAroundEnabled:0,arBackgroundLandscapeImageType:0,arBackgroundLandscapeImagePath:"",arBackgroundPortraitImageType:0,arBackgroundPortraitImagePath:"",arSimplifiedMode:!1,
displayPrivacyPolicyMessage:!1,enableCustomPrivacyPolicyMessage:!1,customEmersyaPrivacyPolicyMessage:"",customWearablePrivacyPolicyMessage:"",customPrivacyPolicyValidationMessage:""},d=function(d,m,I,R,T){this.settings=stage.extend(!0,{},b,T);this.apiCore=d;this.iframeApi=m;this.parentElement=$$stage(R);this.rendererContainer=$$stage(I);this.parentFromSameLocation=!1;try{window.opener&&(this.parentFromSameLocation=window.opener&&-1!=window.location.href.indexOf(p(window.opener.location.href)))}catch(zb){}this.viewerEmbedded=
!0;try{this.viewerEmbedded=window.location!==window.parent.location}catch(zb){}this.arUi=null;this.presets=[];this.arActive=!1;this.arControls=null;this.arDisplayed=!1;this.currentPreset=null;this.arSettingsSet=!1;this.shareArCanvas=null;this.animationsState={};this.initialCameraPath=null;this.faceWebcamTrackingAvailable=this.initArModulesRequired=!1;this.arLink=this.settings.serverURL+"/"+this.settings.arRouting+this.settings.routing;this.mainContainer=this.parentElement.build([{tagName:"div",returnActive:!0,
attributes:{klass:"viewerArContainer"},childs:[]}]);this.device=this.apiCore.exec(this.callerName,"getDevice");this.browser=this.apiCore.exec(this.callerName,"getBrowser");window.arCoreApi=this.apiCore;this.callerName=this.name="arCore";this.apiCore.register(this,"frameStart",l);this.apiCore.register(this,"setPresets",n);this.apiCore.register(this,"onEndAnimation",w);this.apiCore.register(this,"videoStart",A,!0);this.apiCore.register(this,"videoStop",H);this.apiCore.register(this,"getStream",e,!0);
this.apiCore.register(this,"switchCamera",F);this.apiCore.register(this,"getArActive",E,!0);this.apiCore.register(this,"startRendering",t);this.apiCore.register(this,"deviceDetected",r);this.apiCore.register(this,"setSceneBase",g);this.apiCore.register(this,"setScene",q);this.apiCore.register(this,"showAr",S);this.apiCore.register(this,"shareAr",M,!0);this.apiCore.register(this,"startAr",J);this.apiCore.register(this,"setArQrCodeUrl",B);this.apiCore.register(this,"startEmersyaAr",h);this.apiCore.register(this,
"startMoveAroundAr",v);this.apiCore.register(this,"stopAr",Y);this.apiCore.register(this,"takeArPicture",D);this.apiCore.register(this,"showArHelper",ia);this.apiCore.register(this,"hideArHelper",Q);this.apiCore.register(this,"showArShareButton",ta);this.apiCore.register(this,"hideArShareButton",ua);this.apiCore.register(this,"showArInteractionSelectionButton",ea);this.apiCore.register(this,"hideArInteractionSelectionButton",oa);this.apiCore.register(this,"createVideoElem",da);this.apiCore.register(this,
"createVykingSubVideoElem",X);this.apiCore.register(this,"createVykingSubVideoElem2",Ha);this.apiCore.register(this,"getVideoElem",Ga,!0);this.apiCore.register(this,"getVykingSubVideoElem",Fa,!0);this.apiCore.register(this,"getVykingSubVideoElem2",xa,!0);this.apiCore.register(this,"deleteVideoElem",Ia);this.apiCore.register(this,"getUserSize",aa,!0);this.apiCore.register(this,"getPhotoCanvas",G,!0);this.apiCore.register(this,"getArCanvas",C,!0);this.apiCore.register(this,"showArCanvas",L);this.apiCore.register(this,
"hideArCanvas",K);this.apiCore.register(this,"showArSizeSelector",ba);this.apiCore.register(this,"hideArSizeSelector",ka);this.apiCore.register(this,"quitArSizeSelector",Z);this.apiCore.register(this,"showSwitchCameraButton",wa);this.apiCore.register(this,"hideSwitchCameraButton",Ja);this.apiCore.register(this,"showTakePictureButton",La);this.apiCore.register(this,"hideTakePictureButton",ra);this.apiCore.register(this,"showArSettingsButton",Sa);this.apiCore.register(this,"hideArSettingsButton",Ya);
this.apiCore.register(this,"showArVideoUi",Va);this.apiCore.register(this,"showArButton",fa);this.apiCore.register(this,"hideArButton",P);this.apiCore.register(this,"showArMenu",Ba);this.apiCore.register(this,"hideArMenu",Ka);this.apiCore.register(this,"toggleShareButton",Ra);this.apiCore.register(this,"foldShareButton",ma);this.apiCore.register(this,"unfoldShareButton",bb);this.apiCore.register(this,"togglePresetsMenu",gb);this.apiCore.register(this,"showArInstructionMessageOne",ib);this.apiCore.register(this,
"showArInstructionMessageTwo",hb);this.apiCore.register(this,"hideArInstructionMessageOne",fb);this.apiCore.register(this,"hideArInstructionMessageTwo",Aa);this.apiCore.register(this,"showFaceTrackingMask",ab);this.apiCore.register(this,"hideFaceTrackingMask",Ma);this.apiCore.register(this,"hideArMessageScreen",eb);this.apiCore.register(this,"showIosClearCacheMessage",Oa);this.apiCore.register(this,"showActivateCameraMessage",db);this.apiCore.register(this,"showMoveYourDeviceMessage",Ea);this.apiCore.register(this,
"showIosPopupBlockedMessage",Ua);this.apiCore.register(this,"showOperaUnavailableMessage",za);this.apiCore.register(this,"showOrientationChangeMessage",ca);this.apiCore.register(this,"showUnavailableOrientationMessage",Qa);this.apiCore.register(this,"showIosUnavailableOrientationMessage",N);this.apiCore.register(this,"showShoeArUnavailableMessage",sa);this.apiCore.register(this,"showArLoader",xb);this.apiCore.register(this,"hideArLoader",Za);this.apiCore.register(this,"mouseButtonPress",V);this.apiCore.register(this,
"mouseButtonRelease",O);this.apiCore.register(this,"deltaUpdate",ja);this.apiCore.register(this,"presetApplied",u);this.apiCore.register(this,"animationsTriggered",k);(this.scene=this.apiCore.exec(this.callerName,"rdr.getCurrentScene"))&&t.call(this);this.device.detected&&f.call(this)};d.prototype.destroy=function(){this.apiCore.unregister(this,"frameStart");this.apiCore.unregister(this,"setPresets");this.apiCore.unregister(this,"onEndAnimation");this.apiCore.unregister(this,"videoStart");this.apiCore.unregister(this,
"videoStop");this.apiCore.unregister(this,"getStream");this.apiCore.unregister(this,"switchCamera");this.apiCore.unregister(this,"getArActive");this.apiCore.unregister(this,"setScene");this.apiCore.unregister(this,"deviceDetected");this.apiCore.unregister(this,"setSceneBase");this.apiCore.unregister(this,"setScene");this.apiCore.unregister(this,"showAr");this.apiCore.unregister(this,"shareAr");this.apiCore.unregister(this,"takeArPicture");this.apiCore.unregister(this,"startAr");this.apiCore.unregister(this,
"setArQrCodeUrl");this.apiCore.unregister(this,"startEmersyaAr");this.apiCore.unregister(this,"startMoveAroundAr");this.apiCore.unregister(this,"stopAr");this.apiCore.unregister(this,"showArHelper");this.apiCore.unregister(this,"hideArHelper");this.apiCore.unregister(this,"showArShareButton");this.apiCore.unregister(this,"hideArShareButton");this.apiCore.unregister(this,"showArSizeSelector");this.apiCore.unregister(this,"hideArSizeSelector");this.apiCore.unregister(this,"createVideoElem");this.apiCore.unregister(this,
"createVykingSubVideoElem");this.apiCore.unregister(this,"createVykingSubVideoElem2");this.apiCore.unregister(this,"getVideoElem");this.apiCore.unregister(this,"getVykingSubVideoElem");this.apiCore.unregister(this,"getVykingSubVideoElem2");this.apiCore.unregister(this,"deleteVideoElem");this.apiCore.unregister(this,"getUserSize");this.apiCore.unregister(this,"getArCanvas");this.apiCore.unregister(this,"showArCanvas");this.apiCore.unregister(this,"hideArCanvas");this.apiCore.unregister(this,"getPhotoCanvas");
this.apiCore.unregister(this,"quitArSizeSelector");this.apiCore.unregister(this,"showArButton");this.apiCore.unregister(this,"hideArButton");this.apiCore.unregister(this,"showArMenu");this.apiCore.unregister(this,"hideArMenu");this.apiCore.unregister(this,"toggleShareButton");this.apiCore.unregister(this,"foldShareButton");this.apiCore.unregister(this,"unfoldShareButton");this.apiCore.unregister(this,"togglePresetsMenu");this.apiCore.unregister(this,"showArInstructionMessageOne");this.apiCore.unregister(this,
"showArInstructionMessageTwo");this.apiCore.unregister(this,"showFaceTrackingMask");this.apiCore.unregister(this,"hideFaceTrackingMask");this.apiCore.unregister(this,"hideArMessageScreen");this.apiCore.unregister(this,"showIosClearCacheMessage");this.apiCore.unregister(this,"showActivateCameraMessage");this.apiCore.unregister(this,"showMoveYourDeviceMessage");this.apiCore.unregister(this,"showIosPopupBlockedMessage");this.apiCore.unregister(this,"showOperaUnavailableMessage");this.apiCore.unregister(this,
"showOrientationChangeMessage");this.apiCore.unregister(this,"showUnavailableOrientationMessage");this.apiCore.unregister(this,"showIosUnavailableOrientationMessage");this.apiCore.unregister(this,"showShoeArUnavailableMessage");this.apiCore.unregister(this,"showArLoader");this.apiCore.unregister(this,"hideArLoader");this.apiCore.unregister(this,"mouseButtonPress");this.apiCore.unregister(this,"mouseButtonRelease");this.apiCore.unregister(this,"deltaUpdate");this.apiCore.unregister(this,"ar.isStarted");
this.apiCore.unregister(this,"presetApplied");this.apiCore.unregister(this,"animationsTriggered");this.arControls&&(this.arControls.destroy(),this.arControls=null);this.faceTrackingArControls&&(this.faceTrackingArControls.destroy(),this.faceTrackingArControls=null);this.arUi&&(this.arUi.destroy(),this.arUi=null)};d.prototype.updateSettings=function(d){this.settings=stage.extend(!0,{},b,d);this.arUi||(t.call(this),f.call(this));this.arUi&&this.arControls&&(d=va.call(this),this.arUi.setSettings(d),
this.arUi.updateUi(),d=la.call(this),this.arControls.setSettings(d),this.faceTrackingArControls&&this.faceTrackingArControls.updateData())};var u=function(b){this.currentPreset=b},k=function(b,d){for(d=0;d<b.length;d++){var e=b[d];e&&(this.animationsState[e.setName]=e.animatingTo)}},l=function(b){this.arUi&&this.arUi.updateFrame(b)},g=function(b){this.parentFromSameLocation&&window.opener&&window.opener.localStorage.getItem("animations")&&(this.animationsState=JSON.parse(window.opener.localStorage.getItem("animations")))&&
(b.animationStatesToLoad=this.animationsState)},q=function(b){b&&(this.scene=b)},t=function(){this.arSettingsSet=!0;this.scene&&(this.wearableAREnabled=this.scene&&this.scene.wearableAR&&this.scene.wearableAR.enabled&&stage.emersya.viewer.modules.faceTrackingArControlsV1,this.settings.animations=this.scene.animations,this.scene.arData&&(-1==this.settings.mainColor.indexOf("#")&&(this.settings.mainColor="#"+this.settings.mainColor),7==this.settings.mainColor.length&&(this.settings.mainColor+="ff"),
-1==this.settings.secondColor.indexOf("#")&&(this.settings.secondColor="#"+this.settings.secondColor),7==this.settings.secondColor.length&&(this.settings.secondColor+="ff")),(this.initArModulesRequired||this.wearableAREnabled)&&f.call(this))},r=function(){f.call(this)},f=function(){if(this.arSettingsSet){if(!this.arUi){if(this.wearableAREnabled)"V1"==this.scene.wearableAR.detectionModel?this.faceTrackingArControls=new stage.emersya.viewer.modules.faceTrackingArControlsV1(this.apiCore,this.scene,{}):
"V2"==this.scene.wearableAR.detectionModel?this.faceTrackingArControls=new stage.emersya.viewer.modules.faceTrackingArControlsV2(this.apiCore,this.scene,{}):"shoes"==this.scene.wearableAR.detectionModel&&(this.faceTrackingArControls=new stage.emersya.viewer.modules.shoeTrackingArControls(this.apiCore,this.scene,{}));else if(!this.arControls){var b=la.call(this);this.arControls=new stage.emersya.viewer.modules.arControls(this.apiCore,b)}b=va.call(this);this.arUi=new stage.emersya.viewer.modules.arUI(this.apiCore,
this.iframeApi,this.mainContainer,b);this.apiCore.exec(this.callerName,"arReady");this.settings.arAutostart&&h.call(this);this.initArModulesRequired=!1}!this.wearableAREnabled&&this.parentFromSameLocation&&window.opener&&(parseFloat(window.opener.localStorage.getItem("size"))&&(this.arUi.actualArSize=Math.floor(100*window.opener.localStorage.getItem("size"))),window.opener.localStorage.getItem("presetName")&&(this.currentPreset=window.opener.localStorage.getItem("presetName"))&&this.apiCore.exec(this.callerName,
"applyPreset",this.currentPreset),h.call(this))}else this.initArModulesRequired=!0},n=function(b){for(var d=0;d<b.presets.length;d++){var e=b.presets[d];e.displayInWebService&&this.presets.push({name:e.name,preview:e.smallPreviewPath,color:e.color})}this.arUi&&this.arUi.setPresets(this.presets)},B=function(b){this.arUi&&this.arUi.setQrCodeUrl(b)},w=function(){this.arUi&&this.arUi.updateArAnimations()},D=function(){this.parentFromSameLocation&&window.opener?(this.arControls.clearAR(),window.opener.postMessage({action:"arTabClosed",
beta:this.arControls.getBeta(),gamma:this.arControls.getGamma(),userHeight:this.arControls.getUser().height,center:this.arControls.getCenter().slice(),cameraPos:this.arControls.getCameraPosition().slice(),cameraTarget:this.arControls.getCameraTarget().slice(),imageData:this.arControls.getVideoImage(),portraitMode:this.arControls.getPortraitMode()},"*")):(qa.call(this),this.arControls&&this.arControls.takePhoto())},A=function(){if(this.arControls)return this.arControls.videoStart()},H=function(){this.arControls&&
this.arControls.videoStop()},e=function(){return this.arControls?this.arControls.getStream():null},E=function(){return this.arActive},F=function(){this.arControls&&this.arControls.switchCamera()},p=function(b){if(-1!=b.indexOf("showcase")||-1!=b.indexOf("replay")||-1!=b.indexOf("presets")){var d=b.split("showcase");2>d.length&&(d=b.split("replay"),2>d.length&&(d=b.split("presets")));d=d[1].split("/");d=d[2];return b.replace("/"+d,"")}return-1!=b.indexOf("configurator")||-1!=b.indexOf("watch")?(d=
b.split("configurator"),2>d.length&&(d=b.split("watch")),d=d[1].split("/"),d=d[3],b.replace("/"+d,"")):b},m=function(b){b=void 0===b?null:b;return null==b||"no"==b.startInNewPage?null:stage.setContext(function(b,d){"newTab"==b.startInNewPage?window.open(d+"?arAutoClose"):"newWindow"==b.startInNewPage&&window.open(d+"?arAutoClose","_blank","popup=true,width="+screen.width+",height="+screen.height)},this,b)},h=function(b){if(this.wearableAREnabled)I.call(this);else if(this.apiCore.exec(this.callerName,
"ui.hideHandTutorial",!0),this.apiCore.exec(this.callerName,"arUserExperienceStarted"),b&&b.image){var d=new Image,e=document.createElement("canvas"),f=e.getContext("2d");d.onload=stage.setContext(function(){this.arActive=!0;qa.call(this);this.apiCore.exec(this.callerName,"hideArButton");this.arUi&&this.arUi.hideArMenuQuitIcon();ua.call(this);var b=640,g=480,h=d.width<=d.height;this.device.hfov=48.5;this.device.vfov=62;this.device.isMobile=!0;this.device.vfov_rad=Math.PI/180*this.device.vfov;this.device.hfov_rad=
Math.PI/180*this.device.hfov;h&&(g=$jscomp.makeIterator([g,b]),b=g.next().value,g=g.next().value);e.width=b;e.height=g;f.drawImage(d,0,0,b,g);b={imageData:f.getImageData(0,0,b,g),beta:1.28,gamma:0,userHeight:1.71-(h?0:.03),portraitMode:h,listenWheelEvents:!0};this.arControls.setArPhoto(b);e.remove();d.remove()},this);d.src=b.image}else{var g=null;g=this.device.isMobile?m.call(this,b):stage.setContext(Da,this);if(null!=g)xb.call(this),this.apiCore.exec(this.callerName,"getEmersyaArLink",stage.setContext(function(b,
d){Za.call(this);b.call(this,d)},this,g));else if(this.device.arCompatible||this.device.arForced||window.force){if(!this.device.arForced)if(this.device.isIos){if(!this.browser.isSafari){this.arUi&&(Za.call(this),this.arUi.displayChromeIosUnavailableMessage());return}if("iPhone 6"==this.device.model||"iPhone 5s"==this.device.model){Ta.call(this);return}if(this.browser.oldSafari&&!this.device.orientationEnabled&&!this.device.motionEnabled){N.call(this);return}}else if(!(this.device.orientationEnabled||
this.device.motionEnabled&&this.browser.isFirefox&&!this.device.isMobile)){Qa.call(this);return}if(this.settings.displayPrivacyPolicyMessage&&!this.emersyaPrivacyPolicyAccepted)this.arUi.displayEmersyaArPrivacyPolicyMessage(stage.setContext(function(){this.emersyaPrivacyPolicyAccepted=!0;h.call(this)},this),function(){});else if(this.settings.jsShowcase||!this.viewerEmbedded||this.parentFromSameLocation||this.browser.isChrome)this.arUi.actualArSize?(Za.call(this),this.arControls.start(),this.apiCore.exec(this.callerName,
"arStarted")):(this.apiCore.exec(this.callerName,"showArSizeSelector"),Za.call(this));else{localStorage.setItem("size",this.arUi.actualArSize);localStorage.setItem("presetName",this.currentPreset);localStorage.setItem("animations",JSON.stringify(this.animationsState));if(b=this.apiCore.exec(this.callerName,"ofml.getCurrentConfigurationRoute"))var k=window.open(b,"_blank");else b=window.location.href,this.currentPreset&&(b=p(b)+"/"+this.currentPreset),k=window.open(b,"_blank");k.vendorCanvas={width:window.innerWidth,
height:window.innerHeight};k.force=!0;this.apiCore.exec(this.callerName,"showArSizeSelectorNewTab");b=stage.setContext(function(b){b.source==k&&("arTabClosedError"==b.data.action?this.apiCore.exec(this.callerName,"removeArModules"):"arQuitTabClosed"==b.data.action?this.apiCore.exec(this.callerName,"stopAr"):"arTabClosed"==b.data.action&&(this.arActive=!0,this.apiCore.exec(this.callerName,"startArNewTab"),this.arUi.actualArSize=b.data.userHeight,qa.call(this),this.arControls.setArPhoto(b.data)),k.close())},
this);window.removeEventListener("message",b,!1);window.addEventListener("message",b,!1);Za.call(this)}}else 0==this.device.cameras.length?db.call(this):this.browser.isEdge?showUnavailableARExperienceMessage.call(this):this.browser.isOpera?za.call(this):Ta.call(this)}},v=function(b){b=stage.setContext(function(b){this.device.isMobile?this.moveAroundTab.location=b+"?arAutoStart":(Za.call(this),Da.call(this,b))},this);var d=stage.setContext(function(b){this.moveAroundTab?(this.moveAroundTab.close(),
delete this.moveAroundTab):Za.call(this);this.arUi.displayArMoveAroundNotAvailableMessage(b)},this);if(this.device.isMobile){var e=[];if(this.device.supportsNativeAr(e))this.moveAroundTab=window.open(this.arLink+"/wait/","_blank");else{d(e);return}}else xb.call(this);this.apiCore.exec(this.callerName,"exportConfiguration",b,d)},I=function(b){b=void 0===b?null:b;var d=null;d=0==this.device.cameras.length?stage.setContext(Da,this):m.call(this,b);null!=d?(xb.call(this),this.apiCore.exec(this.callerName,
"getEmersyaArLink",stage.setContext(function(b,d){Za.call(this);b.call(this,d)},this,d))):this.settings.displayPrivacyPolicyMessage&&!this.faceTrackingPrivacyPolicyAccepted?this.arUi.displayWearableArPrivacyPolicyMessage(stage.setContext(function(){this.faceTrackingPrivacyPolicyAccepted=!0;I.call(this)},this),function(){}):(this.apiCore.exec(this.callerName,"arUserExperienceStarted"),this.arUi.displayRequestingCameraMessage(stage.setContext(function(){this.apiCore.exec(this.callerName,"stopAr")},
this)),this.faceTrackingArControls.startAR(stage.setContext(function(){this.faceWebcamTrackingAvailable=!0;this.arUi.hideArMessageScreen(null,"requestCameraAccess");this.arUi.hideArButton();this.arUi.showArMenu(!1,!0);this.arUi.showArMenuQuitIcon();this.arUi.setSettings({forceHideArStartButton:!0})},this),stage.setContext(function(b){this.arUi.hideArMessageScreen(null,"requestCameraAccess");"WEBCAM_UNAVAILABLE"===b||"ALREADY_INITIALIZED"==b&&!this.faceWebcamTrackingAvailable?(this.faceWebcamTrackingAvailable=
!1,db.call(this)):Ta.call(this,!1)},this)))},J=function(b){b=void 0===b?null:b;this.wearableAREnabled?I.call(this,b):this.settings.arMoveAroundEnabled&&this.settings.arEmersyaEnabled?this.arUi.showArTypeSelector():this.settings.arMoveAroundEnabled?v.call(this,b):h.call(this,b)},M=function(b,d){var e=this.apiCore.exec(this.callerName,"getPhotoCanvas"),f=this.apiCore.exec(this.callerName,"rdr.takeScreenshot",2*e.get(0).width,2*e.get(0).height,!1,2,null);this.shareArCanvas||(this.shareArCanvas=document.createElement("canvas"));
var g=this.shareArCanvas.getContext("2d");g.canvas.width=e.get(0).width;g.canvas.height=e.get(0).height;g.drawImage(e.get(0),0,0,e.get(0).width,e.get(0).height);var h=new Image;h.crossOrigin="anonymous";h.src=f;h.onload=stage.setContext(function(f){g.drawImage(h,0,0,e.get(0).width,e.get(0).height);f=this.shareArCanvas.toDataURL("image/png");if("download"==b)if(Za.call(this),this.apiCore.exec(this.callerName,"arShared"),this.apiCore.exec(this.callerName,"arDownload"),d)d(f);else if(this.device.isIos){var k=
window.open();!k||k.closed||"undefined"==typeof k.closed?this.apiCore.exec(this.callerName,"showIosPopupBlockedMessage"):k.document.write('<img src="'+f+'" width=100%>')}else this.arUi.downloadButton.get(0).href=f,this.arUi.downloadButton.get(0).click();else T.call(this,this.apiCore.exec(this.callerName,"encodeImage",f),b)},this)},T=function(b,d){var e=stage.json.stringify({p1:this.settings.routing,screenshot:b});b=this.settings.serverURL+"/5J2JN3V8FE";if(window.FormData&&window.XMLHttpRequest){var f=
new FormData;f.append("settings",e);e=new XMLHttpRequest;e.open("POST",b,!0);e.onreadystatechange=stage.setContext(function(b,e){Za.call(this);if(b.readyState===XMLHttpRequest.DONE){eb.call(this);e={};if(200===b.status)try{e=stage.json.parse(b.responseText)}catch(cb){e.resultSet=null}else e.resultSet=null;stage.testResult(U.call(this,e))?(this.apiCore.exec(this.callerName,"arSharedError"),Ca.call(this,stage.setContext(function(){this.apiCore.exec(this.callerName,"arShared")},this))):(eb.call(this),
this.apiCore.exec(this.callerName,"arShared"),R.call(this,d,stage.json.parse(b.responseText).resultSet.data[0],"Emersya AR photo",""),this.apiCore.exec(this.callerName,"stats.textureExported"))}},this,e);e.send(f)}else f={async:!0,onLoad:stage.setContext(function(b){Za.call(this);stage.testResult(U.call(this,b.response))?(this.apiCore.exec(this.callerName,"arSharedError"),Ca.call(this,stage.setContext(function(){this.apiCore.exec(this.callerName,"arShared")},this))):(this.apiCore.exec(this.callerName,
"arShared"),this.apiCore.exec(this.callerName,"stats.textureExported"),R.call(this,d,b.response.resultSet.data[0],"Emersya AR photo",""))},this),onError:stage.setContext(Ca,this),onTimeout:stage.setContext(Ca,this),onAbort:stage.setContext(Ca,this)},stage.ajax.post(b,"settings="+encodeURIComponent(e),f)},U=function(b){return b&&b.resultSet?null!=b.resultSet.error?b=-1!==b.resultSet.error.indexOf("Error 501:")?stage.createError(313,"Operation not supported."):stage.createError(314,"Error from the server."):
stage.createResult(null):b=stage.createError(314,"There is no response from the server or it is empty.")},R=function(b,d,e,f){var g=function(b){this.device.isIos&&(!b||b.closed||"undefined"==typeof b.closed)&&this.apiCore.exec(this.callerName,"showIosPopupBlockedMessage")},h={async:!0,onLoad:stage.setContext(function(d){switch(b){case "facebook":this.apiCore.registerOnce(this.callerName,"shareOnFacebookSuccess",stage.setContext(g,this));this.apiCore.exec(this.callerName,"shareOnFacebook",d.response.resultSet.data[0]);
break;case "twitter":this.apiCore.registerOnce(this.callerName,"shareOnTwitterSuccess",stage.setContext(g,this)),this.apiCore.exec(this.callerName,"shareOnTwitter",d.response.resultSet.data[0])}},this)};requestURL="url="+d+"&type=1&title="+e+"&description="+f;stage.ajax.get("https://ws.emersya.com/ws/redirect/create",requestURL,h)},aa=function(){if(this.arUi)return this.arUi.getSize()},C=function(){if(this.arUi)return this.arUi.getArCanvas()},L=function(){this.arUi&&this.arUi.showArCanvas()},K=function(){this.arUi&&
this.arUi.hideArCanvas()},G=function(){if(this.arUi)return this.arUi.getPhotoCanvas()},S=function(){this.arUi&&(this.arDisplayed=!0,this.arUi.show())},Y=function(){this.faceTrackingArControls?(this.faceTrackingArControls.stopAR(),this.arUi&&this.arUi.hide()):(this.rendererContainer.css({top:"0px",height:"100%"}),this.apiCore.exec(this.callerName,"domChange"),this.parentFromSameLocation&&window.opener?window.opener.postMessage({action:"arQuitTabClosed"},"*"):(this.arActive=this.arDisplayed=!1,this.arUi&&
(this.arUi.hide(),this.apiCore.exec(this.callerName,"toggleCameraLock",!1)),this.rendererContainer.css("opacity",1),this.apiCore.exec(this.callerName,"arControls.stopAr",!1),this.apiCore.exec(this.callerName,"resetCamera",0,!1),this.apiCore.exec(this.callerName,"ui.showDisable3DButton"),this.apiCore.exec(this.callerName,"setAdaptativeFov",this.settings.adaptativeFov),this.apiCore.exec(this.callerName,"hideArInstructionMessageOne"),this.apiCore.exec(this.callerName,"hideArInstructionMessageTwo"),this.apiCore.exec(this.callerName,
"resetBackground"),this.apiCore.exec(this.callerName,"showArButton")));window.opener&&!this.viewerEmbedded&&!this.settings.jsShowcase&&window.location.search.includes("?arAutoClose")&&window.close()},ia=function(){this.arUi&&this.arUi.showArHelper()},Q=function(){this.arUi&&this.arUi.hideArHelper()},ta=function(){this.arUi&&this.arUi.showArShareButton()},ua=function(){this.arUi&&this.arUi.hideArShareButton()},ea=function(){this.arUi&&this.arUi.showArInteractionSelectionButton()},oa=function(){this.arUi&&
this.arUi.hideArInteractionSelectionButton()},ba=function(){this.apiCore.exec(this.callerName,"hideSwitchCameraButton");this.apiCore.exec(this.callerName,"hideTakePictureButton");this.apiCore.exec(this.callerName,"hideArSettingsButton");this.arUi&&this.arUi.showArSizeSelectionContainer()},ka=function(){this.arUi&&this.arUi.hideArSizeSelectionContainer()},Z=function(){this.arActive?(this.apiCore.exec(this.callerName,"showSwitchCameraButton"),this.apiCore.exec(this.callerName,"showTakePictureButton"),
this.apiCore.exec(this.callerName,"showArSettingsButton")):this.apiCore.exec(this.callerName,"stopAr");this.apiCore.exec(this.callerName,"quitArSizeSelection");this.apiCore.exec(this.callerName,"hideArSizeSelector")},da=function(){this.arUi&&this.arUi.createVideoElem()},X=function(){this.arUi&&this.arUi.createVykingSubVideoElem()},Ha=function(){this.arUi&&this.arUi.createVykingSubVideoElem2()},Ga=function(){return this.arUi?this.arUi.getVideoElem():null},Fa=function(){return this.arUi?this.arUi.getVykingSubVideoElem():
null},xa=function(){return this.arUi?this.arUi.getVykingSubVideoElem2():null},Ia=function(){this.arUi&&this.arUi.deleteVideoElem()},qa=function(){this.rendererContainer.css("opacity",this.settings.photoOpacity);this.apiCore.exec(this.callerName,"ui.hideDisable3DButton");if(this.settings.realTimeRefraction){var b=this.apiCore.exec(this.callerName,"getPhotoCanvas");this.apiCore.exec(this.callerName,"rdr.setBackgroundColor",this.settings.backgroundColor,this.settings.backgroundOpacity);this.apiCore.exec(this.callerName,
"rdr.setBackgroundImage",b.get(0),this.settings.imageFitting,this.settings.imageOffset,this.settings.imageOpacity)}else this.apiCore.exec(this.callerName,"rdr.removeBackgroundImage"),this.apiCore.exec(this.callerName,"rdr.setBackgroundColor",this.settings.backgroundColor,0);this.apiCore.exec(this.callerName,"setAdaptativeFov",!1);this.apiCore.exec(this.callerName,"toggleCameraLock",!0);this.apiCore.exec(this.callerName,"hideSwitchCameraButton");this.apiCore.exec(this.callerName,"hideTakePictureButton");
this.apiCore.exec(this.callerName,"hideArSettingsButton");this.apiCore.exec(this.callerName,"showArMenu",!1,!0);this.apiCore.exec(this.callerName,"showArShareButton");this.apiCore.exec(this.callerName,"showArInteractionSelectionButton");this.apiCore.exec(this.callerName,"showArButton");this.apiCore.exec(this.callerName,"showArCanvas");this.apiCore.exec(this.callerName,"showArInstructionMessageTwo");this.arUi&&this.arUi.toggleArActiveState(!0)},Va=function(){this.arActive=!0;this.apiCore.exec(this.callerName,
"hideArLoader");this.apiCore.exec(this.callerName,"hideArSizeSelector");this.apiCore.exec(this.callerName,"showArMenu",!1,!0);this.apiCore.exec(this.callerName,"showSwitchCameraButton");this.apiCore.exec(this.callerName,"showTakePictureButton");this.apiCore.exec(this.callerName,"showArSettingsButton");this.apiCore.exec(this.callerName,"showArButton");this.apiCore.exec(this.callerName,"showArCanvas");this.apiCore.exec(this.callerName,"hideArButton");this.apiCore.exec(this.callerName,"hideArShareButton");
this.apiCore.exec(this.callerName,"hideArInteractionSelectionButton");this.apiCore.exec(this.callerName,"showArInstructionMessageOne");this.rendererContainer.css("opacity",this.settings.videoOpacity);this.apiCore.exec(this.callerName,"ui.hideDisable3DButton");this.apiCore.exec(this.callerName,"rdr.removeBackgroundImage");this.apiCore.exec(this.callerName,"rdr.setBackgroundColor",this.settings.backgroundColor,0);this.apiCore.exec(this.callerName,"setAdaptativeFov",!1);this.apiCore.exec(this.callerName,
"toggleCameraLock",!0);this.arUi&&this.arUi.toggleArActiveState(!0)},va=function(){return{mainColor:this.settings.mainColor,secondColor:this.settings.secondColor,shareOnSocialNetwork:this.settings.displayShareOnSocialNetworkButton,displayDownloadRenderButton:this.settings.displayDownloadRenderButton,displayAnimationMenu:this.settings.displayAnimationMenu,displayPresetMenu:this.settings.displayPresetMenu,displayArMenu:this.settings.displayMenu,displayArStartButton:this.settings.displayArStartButton,
presets:this.presets,animations:this.settings.animations,qrCodePath:this.settings.qrCodePath,qrCodeUrl:this.settings.qrCodeUrl,serverURL:this.settings.serverURL,routing:this.settings.routing,arType:this.wearableAREnabled?"wearable":"default",arBackgroundLandscapeImageType:this.settings.arBackgroundLandscapeImageType,arBackgroundLandscapeImagePath:this.settings.arBackgroundLandscapeImagePath,arBackgroundPortraitImageType:this.settings.arBackgroundPortraitImageType,arBackgroundPortraitImagePath:this.settings.arBackgroundPortraitImagePath,
arSimplifiedMode:this.settings.arSimplifiedMode,enableCustomPrivacyPolicyMessage:this.settings.enableCustomPrivacyPolicyMessage,customEmersyaPrivacyPolicyMessageNotTranslated:this.settings.customEmersyaPrivacyPolicyMessage,customWearablePrivacyPolicyMessageNotTranslated:this.settings.customWearablePrivacyPolicyMessage,customPrivacyPolicyValidationMessageNotTranslated:this.settings.customPrivacyPolicyValidationMessage}},la=function(){var b={scene:this.scene,cameraRotationCenter:this.settings.cameraTarget,
realTimeRefraction:this.settings.realTimeRefraction};this.scene&&(b.oldRenderEnvironment=this.scene.scenery.renderEnvironment);return b},fa=function(){this.arUi&&this.arUi.showArButton(this.arActive)},P=function(){this.arUi&&this.arUi.hideArButton()},Ba=function(b,d){this.arUi&&this.arUi.showArMenu(void 0===b?!1:b,void 0===d?!1:d)},Ka=function(){this.arUi&&this.arUi.hideArMenu()},wa=function(){this.arUi&&this.arUi.showSwitchCameraButton()},Ja=function(){this.arUi&&this.arUi.hideSwitchCameraButton()},
La=function(){this.arUi&&this.arUi.showTakePictureButton()},ra=function(){this.arUi&&this.arUi.hideTakePictureButton()},Sa=function(){this.arUi&&this.arUi.showArSettingsButton()},Ya=function(){this.arUi&&this.arUi.hideArSettingsButton()},Ra=function(){this.arUi&&this.arUi.toggleShareButton()},ma=function(){this.arUi&&this.arUi.foldShareButton()},bb=function(){this.arUi&&this.arUi.unfoldShareButton()},gb=function(b){this.arUi&&this.arUi.togglePresetsMenu(b)},ib=function(){this.arUi&&this.arUi.showArInstructionMessageOne()},
hb=function(){this.arUi&&this.arUi.showArInstructionMessageTwo()},fb=function(){this.arUi&&this.arUi.hideArInstructionMessageOne()},Aa=function(){this.arUi&&this.arUi.hideArInstructionMessageTwo()},eb=function(){this.arUi&&this.arUi.hideArMessageScreen()},ab=function(){this.arUi&&this.arUi.showFaceTrackingMask()},Ma=function(){this.arUi&&this.arUi.hideFaceTrackingMask()},Ta=function(b){b=void 0===b?!0:b;this.arUi&&(Za.call(this),this.arUi.displayUnavailableArModelMessage(kb.call(this),b))},db=function(){this.arUi&&
(Za.call(this),this.arUi.displayActivateCameraMessage())},Oa=function(){this.arUi&&(Za.call(this),this.arUi.displayIosClearCacheMessage())},Qa=function(b){this.arUi&&(Za.call(this),this.arUi.displayUnavailableOrientationScreen(b))},N=function(){this.arUi&&(Za.call(this),this.arUi.displayIosUnavailableOrientationScreen())},za=function(){this.arUi&&(Za.call(this),this.arUi.displayOperaUnavailableMessage())},ca=function(b){this.arUi&&(Za.call(this),b||(b=na.call(this)),this.arUi.displayOrientationChangeScreen(b))},
Ea=function(){this.arUi&&(Za.call(this),this.arUi.displayMoveYourDeviceScreen(na.call(this)))},Ca=function(b){this.arUi&&(Za.call(this),b||(b=na.call(this)),this.arUi.displaySharingErrorMessage(b))},Ua=function(){this.arUi&&(Za.call(this),this.arUi.displayIosPopupBlockedMessage(na.call(this)))},sa=function(){this.arUi&&(Za.call(this),this.arUi.displayShoeArUnavailableMessage())},na=function(){return callback=stage.setContext(function(){this.parentFromSameLocation&&window.opener&&(window.opener.postMessage({action:"arTabClosedError"},
"*"),this.apiCore.exec(this.callerName,"videoStop"))},this)},kb=function(){return callback=stage.setContext(function(){this.parentFromSameLocation&&window.opener&&window.opener.postMessage({action:"arQuitTabClosed"},"*")},this)},Da=function(b){this.arUi&&this.arUi.displayQRCode(b)},xb=function(){this.arUi&&this.arUi.showLoader()},Za=function(){this.arUi&&this.arUi.hideLoader()},V=function(b,d,e){if(this.arUi&&this.arActive)this.arUi.onMouseButtonPress(b,d,e)},O=function(b,d,e){if(this.arUi&&this.arActive)this.arUi.onMouseButtonRelease(b,
d,e)},ja=function(b,d){if(this.arUi&&this.arActive)this.arUi.onMouseDeltaUpdate(b,d)};return d});stage.provide("emersya.viewer.modules.arControls");stage.require("emersya.viewer.modules.API.core");
stage.register.call(stage.emersya.viewer.modules,"arControls",function(){var b=[[1280,960],[640,480],[320,240]],d={collisionMode:0,realTimeRefraction:!1,oldRenderEnvironment:null,cameraRotationCenter:[0,0,0],algorithm:0},u=function(b,d){this.face=this.palm=this.arm=this.shoulder=this.neck=this.eye=this.height=null;this.sole=.02};u.prototype.initUser=function(b){100<=b&&(b/=100);this.height=b;this.eye=.936*this.height;this.neck=.87*this.height;this.shoulder=.818*this.height;this.arm=.336*this.height;
this.palm=.015*this.height;this.face=.05*this.height};var k=function(b,d){this.setSettings(d);this.apiCore=b;this.callerName=this.name="arControls";this.apiCore.register(this,"arControls.stopAr",f);this.apiCore.register(this,"arControls.rotateCameraAroundCenter",H,!0);this.apiCore.register(this,"arControls.repositionCenter",F,!0);this.apiCore.register(this,"arControls.updateGamma",l);this.apiCore.register(this,"arControls.initParameters",n);this.apiCore.register(this,"arControls.getPhotoTaken",t,
!0);this.apiCore.register(this,"arControls.isInitialized",r,!0);this.apiCore.register(this,"arControls.moveCenter",q,!0);this.apiCore.register(this,"arControls.stopMovingCenter",g,!0);this.apiCore.register(this,"setScene",B);this.browser=this.apiCore.exec(this.callerName,"getBrowser");this.device=this.apiCore.exec(this.callerName,"getDevice");this.delay=Math.round(1500/this.browser.frequence);this.apiCore.exec(this.callerName,"arUI.setDelay",this.delay);this.portraitMode=!1;this.videoAngle=0;this.photoTaken=
this.shouldRotateVideoCanvas=!1;this.beta=0;this.centerPositionIsValid=!0;this.viewerDisplayed=!1;this.gamma=0;this.cosGamma=1;this.baseGamma=this.baseBeta=this.sinGamma=0;this.degreeToRadian=Math.PI/180;this.environmentCamera=!0;this.user=new u;this.vendorCropRect=null;this.initialized=!1;window.addEventListener("beforeunload",stage.setContext(function(b){this.videoStop()},this))};k.prototype.setSettings=function(b){var e=!1;b.scene&&(this.scene=b.scene,b.scene=null,e=!0);this.settings=this.settings?
stage.extend(!0,this.settings,b):stage.extend(!0,d,b);this.camera||(this.camera={position:[0,0,0],target:[0,0,0],rotationCenter:{x:0,y:0,z:0}});e&&(this.scene.recursiveComputeBoundingBoxesWithoutNodes(this.scene.root),this.scene.root.boundingBoxWithoutNodes&&(this.boundingBox=this.scene.copyBoundingBox(this.scene.root.boundingBoxWithoutNodes)),this.scene.arData&&(this.settings.algorithm=this.scene.arData.algorithm,this.scale=(this.scene.arData.boundingBox.maxY-this.scene.arData.boundingBox.minY)/
this.scene.arData.realSize),this.boundingBox||(this.boundingBox=this.scene.createBoundingBox(),this.boundingBox.maxX=1,this.boundingBox.maxY=1,this.boundingBox.maxZ=1));b.realSize&&(this.realSize=b.realSize);this.scale&&(void 0==b.realSize&&(this.realSize=(this.boundingBox.maxY-this.boundingBox.minY)/this.scale),this.objectOffset={vertical:(this.boundingBox.maxZ-this.boundingBox.minZ)/this.scale,horizontal:(this.boundingBox.maxX-this.boundingBox.minX)/this.scale,max:{both:Math.max(this.boundingBox.maxZ,
this.boundingBox.maxX)/this.scale,vertical:(this.boundingBox.maxZ-this.boundingBox.minZ)/this.scale,horizontal:(this.boundingBox.maxX-this.boundingBox.minX)/this.scale}},this.objectOffset.offsets3D={bottom:[0,0,this.objectOffset.max.vertical/2],top:[0,0,-this.objectOffset.max.vertical/2],right:[-this.objectOffset.max.horizontal/2,0,0],left:[this.objectOffset.max.horizontal/2,0,0]},this.camera.rotationCenter={x:this.settings.cameraRotationCenter[0]/this.scale,y:this.boundingBox.minY/this.scale,z:this.settings.cameraRotationCenter[2]/
this.scale})};k.prototype.destroy=function(){this.apiCore.unregister(this,"arControls.stopAr");this.apiCore.unregister(this,"arControls.rotateCameraAroundCenter");this.apiCore.unregister(this,"arControls.repositionCenter");this.apiCore.unregister(this,"arControls.updateGamma");this.apiCore.unregister(this,"arControls.initParameters");this.apiCore.unregister(this,"arControls.getPhotoTaken");this.apiCore.unregister(this,"arControls.isInitialized");this.apiCore.unregister(this,"arControls.getVendorCropRect");
this.apiCore.unregister(this,"arControls.moveCenter");this.apiCore.unregister(this,"setScene")};var l=function(b){this.gamma+=b;this.cosGamma=Math.cos(this.gamma);this.sinGamma=Math.sin(this.gamma);var d=$jscomp.makeIterator([this.objectOffset.max.horizontal/2,this.objectOffset.max.vertical/2]);b=d.next().value;d=d.next().value;this.objectOffset.offsets3D={bottom:[-d*this.sinGamma,0,d*this.cosGamma],top:[d*this.sinGamma,0,-d*this.cosGamma],right:[-b*this.cosGamma,0,-b*this.sinGamma],left:[b*this.cosGamma,
0,+b*this.sinGamma]}};k.prototype.getUser=function(){return this.user};k.prototype.getCenter=function(){return this.center};var g=function(b){this.centerOffset=b=void 0===b?[0,0]:b},q=function(b){b=void 0===b?[0,0]:b;g.call(this,[this.centerOffset[0]+b[0],this.centerOffset[1]+b[1]])},t=function(){return this.photoTaken},r=function(){return this.initialized},f=function(){this.apiCore.exec(this.callerName,"toggleEnvironmentRendering",this.settings.oldRenderEnvironment);this.clearAR();this.ctx_photo&&
this.ctx_photo.clearRect(0,0,this.canvasDimensions.displayCanvas.width,this.canvasDimensions.displayCanvas.height);this.ctx_canvas&&this.ctx_canvas.clearRect(0,0,this.canvasDimensions.displayCanvas.width,this.canvasDimensions.displayCanvas.height)};k.prototype.start=function(){document.oncontextmenu=new Function("return false");n.call(this);p.call(this)};var n=function(d,f,h,k,l){l=void 0===l?null:l;this.user.initUser(d?d:this.apiCore.exec(this.callerName,"getUserSize"));void 0==f?v.call(this):this.portraitMode=
f;var m=l;m=void 0===m?null:m;d=b[2][0];f=b[2][1];h=b[1][0];l=b[1][1];k={tanHalfV:Math.tan(this.device.vfov_rad/2),tanHalfH:Math.tan(this.device.hfov_rad/2),current:0};m&&(h=m.height,l=m.width);this.portraitMode&&(l=$jscomp.makeIterator([f,d,l,h]),d=l.next().value,f=l.next().value,h=l.next().value,l=l.next().value);if(this.portraitMode&&!this.device.isMobile||!this.portraitMode&&this.device.isMobile)m=$jscomp.makeIterator([k.tanHalfV,k.tanHalfH]),k.tanHalfH=m.next().value,k.tanHalfV=m.next().value;
this.canvasDimensions={displayCanvas:{width:$$stage("#privateEmersyaViewerContainer").get(0).clientWidth,height:$$stage("#privateEmersyaViewerContainer").get(0).clientHeight,fov:0,currentWidth:0,currentHeight:0,deltaX:0,deltaY:0},computeCanvas:{width:d,height:f,currentWidth:0,currentHeight:0,minWidth:d-1,minHeight:f-1,nbPixels:d*f,halfWidth:Math.round(.5*d),halfHeight:Math.round(.5*f),deltaX:0,deltaY:0},videoCanvas:{width:h,height:l,fov:k,currentWidth:0,currentHeight:0,nbPixels:h*l,halfWidth:Math.round(.5*
h),halfHeight:Math.round(.5*l),deltaX:0,deltaY:0,displayedWidth:0,displayedHeight:0}};this.canvasDimensions.computeCanvas.toDisplayFactor=Math.max(this.canvasDimensions.displayCanvas.width/this.canvasDimensions.computeCanvas.width,this.canvasDimensions.displayCanvas.height/this.canvasDimensions.computeCanvas.height);this.canvasDimensions.videoCanvas.toComputeFactor=this.canvasDimensions.computeCanvas.width/this.canvasDimensions.videoCanvas.width;this.canvasDimensions.videoCanvas.toDisplayFactor=Math.max(this.canvasDimensions.displayCanvas.width/
this.canvasDimensions.videoCanvas.width,this.canvasDimensions.displayCanvas.height/this.canvasDimensions.videoCanvas.height);this.canvasDimensions.displayCanvas.toVideoFactor=1/this.canvasDimensions.videoCanvas.toDisplayFactor;this.canvasDimensions.displayCanvas.toComputeFactor=this.canvasDimensions.videoCanvas.toComputeFactor/this.canvasDimensions.videoCanvas.toDisplayFactor;this.canvasDimensions.videoCanvas.deltaX=Math.round((this.canvasDimensions.videoCanvas.width-this.canvasDimensions.displayCanvas.toVideoFactor*
this.canvasDimensions.displayCanvas.width)/2);this.canvasDimensions.videoCanvas.deltaY=Math.round((this.canvasDimensions.videoCanvas.height-this.canvasDimensions.displayCanvas.toVideoFactor*this.canvasDimensions.displayCanvas.height)/2);this.canvasDimensions.videoCanvas.displayedWidth=this.canvasDimensions.videoCanvas.width-2*Math.round(this.canvasDimensions.videoCanvas.deltaX);this.canvasDimensions.videoCanvas.displayedHeight=this.canvasDimensions.videoCanvas.height-2*Math.round(this.canvasDimensions.videoCanvas.deltaY);
this.canvasDimensions.computeCanvas.deltaX=Math.round(this.canvasDimensions.videoCanvas.toComputeFactor*this.canvasDimensions.videoCanvas.deltaX);this.canvasDimensions.computeCanvas.deltaY=Math.round(this.canvasDimensions.videoCanvas.toComputeFactor*this.canvasDimensions.videoCanvas.deltaY);this.canvasDimensions.displayCanvas.deltaX=Math.round(this.canvasDimensions.videoCanvas.toDisplayFactor*this.canvasDimensions.videoCanvas.deltaX);this.canvasDimensions.displayCanvas.deltaY=Math.round(this.canvasDimensions.videoCanvas.toDisplayFactor*
this.canvasDimensions.videoCanvas.deltaY);this.canvasDimensions.displayCanvas.fov=360*Math.atan(this.canvasDimensions.videoCanvas.displayedHeight/this.canvasDimensions.videoCanvas.height*this.canvasDimensions.videoCanvas.fov.tanHalfV)/Math.PI;this.c_vid||(this.c_vid=document.createElement("canvas"),this.ctx_vid=this.c_vid.getContext("2d"));this.c_vid.width=this.canvasDimensions.videoCanvas.width;this.c_vid.height=this.canvasDimensions.videoCanvas.height;this.photo=this.apiCore.exec(this.callerName,
"getPhotoCanvas");this.canvas=this.apiCore.exec(this.callerName,"getArCanvas");this.ctx_photo=this.photo.get(0).getContext("2d");this.ctx_canvas=this.canvas.get(0).getContext("2d");this.photo.get(0).width=this.canvasDimensions.displayCanvas.width;this.photo.get(0).height=this.canvasDimensions.displayCanvas.height;this.canvas.get(0).width=this.canvasDimensions.displayCanvas.width;this.canvas.get(0).height=this.canvasDimensions.displayCanvas.height;this.ctx_img||(this.c_img=document.createElement("canvas"),
this.ctx_img=this.c_img.getContext("2d"));this.c_img.width=this.canvasDimensions.computeCanvas.width;this.c_img.height=this.canvasDimensions.computeCanvas.height;this.ellipseExcentricity=1.5;this.ellipseRadiusMax=.282*this.user.height;this.apiCore.exec(this.callerName,"toggleEnvironmentRendering",0);this.enableCollisionCheck=!0;d=this.settings.algorithm;this.defaultCenter=[this.canvasDimensions.computeCanvas.halfWidth,Math.round(2*this.canvasDimensions.computeCanvas.height/3)];this.arOnTable=this.arOnCeiling=
this.arOnGround=this.arOnWorktop=!1;this.enableCollisionCheck=5!=d;switch(d){case 2:this.arOnWorktop=!0;this.surfaceHeight=.92;this.trustedRectWidth=this.trustedRectHeight=10;break;case 3:this.arOnTable=!0;this.surfaceHeight=.75;this.trustedRectWidth=this.trustedRectHeight=10;break;case 4:case 5:this.defaultCenter[1]=Math.round(this.canvasDimensions.computeCanvas.height/3);this.arOnCeiling=!0;this.surfaceHeight=0;this.ceilHeight=2.5;this.trustedSurfaceRect={imin:0,imax:Math.trunc(this.canvasDimensions.computeCanvas.height/
4),jmin:Math.trunc(this.canvasDimensions.computeCanvas.width/3),jmax:Math.trunc(this.canvasDimensions.computeCanvas.width/3*2)};break;default:this.arOnGround=!0,this.surfaceHeight=0,this.trustedSurfaceRect={imin:this.canvasDimensions.computeCanvas.height-2,imax:this.canvasDimensions.computeCanvas.height-2,jmin:1,jmax:this.canvasDimensions.computeCanvas.width-2}}this.center=this.defaultCenter;g.call(this);this.side_radius=4;this.arOnGround||this.arOnCeiling?(this.blur_radius=4,this.canny_thresholds=
{value:{low:30,high:80},saturation:{low:30,high:80}}):(this.blur_radius=2,this.canny_thresholds={value:{low:50,high:130},saturation:{low:50,high:180}});this.temp_img1=new jsfeat.matrix_t(this.canvasDimensions.computeCanvas.width,this.canvasDimensions.computeCanvas.height,jsfeat.U8C1_t);this.temp_img2=new jsfeat.matrix_t(this.canvasDimensions.computeCanvas.width,this.canvasDimensions.computeCanvas.height,jsfeat.U8C1_t);this.surface_mask=new jsfeat.matrix_t(this.canvasDimensions.computeCanvas.width,
this.canvasDimensions.computeCanvas.height,jsfeat.U8C1_t);this.img_hue=new jsfeat.matrix_t(this.canvasDimensions.computeCanvas.width,this.canvasDimensions.computeCanvas.height,jsfeat.U8C1_t);this.img_saturation=new jsfeat.matrix_t(this.canvasDimensions.computeCanvas.width,this.canvasDimensions.computeCanvas.height,jsfeat.U8C1_t);this.img_saturation_blured=new jsfeat.matrix_t(this.canvasDimensions.computeCanvas.width,this.canvasDimensions.computeCanvas.height,jsfeat.U8C1_t);this.img_saturation_edges=
new jsfeat.matrix_t(this.canvasDimensions.computeCanvas.width,this.canvasDimensions.computeCanvas.height,jsfeat.U8C1_t);this.img_value=new jsfeat.matrix_t(this.canvasDimensions.computeCanvas.width,this.canvasDimensions.computeCanvas.height,jsfeat.U8C1_t);this.img_value_blured=new jsfeat.matrix_t(this.canvasDimensions.computeCanvas.width,this.canvasDimensions.computeCanvas.height,jsfeat.U8C1_t);this.img_value_edges=new jsfeat.matrix_t(this.canvasDimensions.computeCanvas.width,this.canvasDimensions.computeCanvas.height,
jsfeat.U8C1_t);this.surfaceID=0;this.fifo=Array(this.canvasDimensions.computeCanvas.nbPixels);this.region=Array(this.canvasDimensions.computeCanvas.nbPixels);this.alreadySeen=Array(this.canvasDimensions.computeCanvas.nbPixels);this.side4=[-this.canvasDimensions.computeCanvas.width,this.canvasDimensions.computeCanvas.width,-1,1];this.sideK=this.side4.slice();d=1;for(f=2;d<this.side_radius;d++,f++)this.sideK.push(d*(-1-this.canvasDimensions.computeCanvas.width),d*(1-this.canvasDimensions.computeCanvas.width),
d*(-1+this.canvasDimensions.computeCanvas.width),d*(1+this.canvasDimensions.computeCanvas.width),-f,f,-f*this.canvasDimensions.computeCanvas.width,f*this.canvasDimensions.computeCanvas.width);this.side4_size=this.side4.length;this.sideK_size=this.sideK.length;e.call(this);void 0!==window.vendorCanvas&&(d=1/Math.min(this.canvasDimensions.videoCanvas.width/this.canvasDimensions.displayCanvas.width,this.canvasDimensions.videoCanvas.height/this.canvasDimensions.displayCanvas.height),f=this.canvasDimensions.videoCanvas.width/
this.canvasDimensions.videoCanvas.height>window.vendorCanvas.width/window.vendorCanvas.height?this.canvasDimensions.videoCanvas.height*d/window.vendorCanvas.height:this.canvasDimensions.videoCanvas.width*d/window.vendorCanvas.width,d=window.vendorCanvas.width*f,f*=window.vendorCanvas.height,this.vendorCropRect={x:Math.round(this.canvasDimensions.displayCanvas.width/2-d/2),y:Math.round(this.canvasDimensions.displayCanvas.height/2-f/2),width:Math.round(d),height:Math.round(f)},this.apiCore.exec(this.callerName,
"arUI.updateCropRectArea",this.vendorCropRect));this.deviceOrientationIsValid=!1;this.centerPositionIsValid=!0;this.viewerDisplayed=!1;this.apiCore.exec(this.callerName,"arUI.setViewerVisibility",!1);this.initialized=!0};k.prototype.takePhoto=function(){w.call(this);this.apiCore.exec(this.callerName,"hideArLoader")};k.prototype.setArPhoto=function(b){this.apiCore.exec(this.callerName,"arUI.setPhotoTaken",!0);this.beta=b.beta;this.gamma=b.gamma;this.cosGamma=Math.cos(this.gamma);this.sinGamma=Math.sin(this.gamma);
n.call(this,b.userHeight,b.portraitMode,b.cameraPos,b.cameraTarget,b.dimensions);b.center&&(this.center=b.center);b.listenWheelEvents&&!this.onwheel&&(this.incrementFactor=this.realSize/100*5,this.originalRealSize=this.realSize,this.onwheel=stage.setContext(function(b){b=this.realSize+this.incrementFactor*(0<b.deltaY?-1:1);b<this.originalRealSize/10&&(b=this.originalRealSize/10);this.setSettings({realSize:b});A.call(this)},this),window.addEventListener("wheel",this.onwheel));this.ctx_vid.putImageData(b.imageData,
0,0);w.call(this)};var B=function(b){b&&this.setSettings({scene:b})},w=function(b){this.photoTaken=!0;this.clearAR();this.ctx_img.drawImage(this.c_vid,0,0,this.canvasDimensions.videoCanvas.width,this.canvasDimensions.videoCanvas.height,0,0,this.canvasDimensions.computeCanvas.width,this.canvasDimensions.computeCanvas.height);h.call(this);if(this.enableCollisionCheck){for(var d=this.ctx_img.getImageData(0,0,this.canvasDimensions.computeCanvas.width,this.canvasDimensions.computeCanvas.height),e,f=0;f<
this.canvasDimensions.computeCanvas.nbPixels;f++){var g=d.data[4*f],k=d.data[4*f+1],l=d.data[4*f+2],m=g,n=g;k>n&&(n=k,e="g");k<m&&(m=k);l>n&&(n=l,e="b");l<m&&(m=l);n==m?this.img_hue.data[f]=0:("r"==e&&(this.img_hue.data[f]=((k-l)/(n-m)*60+360)%360),"g"==e&&(this.img_hue.data[f]=(l-g)/(n-m)*60+120),"b"==e&&(this.img_hue.data[f]=(g-k)/(n-m)*60+240));this.img_saturation.data[f]=0==n?0:Math.round(255*(1-m/n));this.img_value.data[f]=n}for(f=0;f<this.canvasDimensions.computeCanvas.nbPixels;f++)this.img_hue.data[f]=
this.img_hue.data[f]/360*255;jsfeat.imgproc.gaussian_blur(this.img_value,this.img_value_blured,(this.blur_radius|0)+1<<1,0);jsfeat.imgproc.canny(this.img_value_blured,this.img_value_edges,this.canny_thresholds.value.low|0,this.canny_thresholds.value.high|0);this.arOnGround||this.arOnCeiling||(this.trustedSurfaceRect={imin:Math.round(this.center[1]-this.trustedRectHeight/2),imax:Math.round(this.center[1]+this.trustedRectHeight/2),jmin:Math.round(this.center[0]-this.trustedRectWidth/2),jmax:Math.round(this.center[0]+
this.trustedRectWidth/2)},1>this.trustedSurfaceRect.imin?(this.trustedSurfaceRect.imin=1,this.trustedSurfaceRect.imax=this.trustedRectHeight+1):this.trustedSurfaceRect.imax>this.canvasDimensions.computeCanvas.height-2&&(this.trustedSurfaceRect.imax=this.canvasDimensions.computeCanvas.height-2,this.trustedSurfaceRect.imin=this.canvasDimensions.computeCanvas.height-2-this.trustedRectHeight),1>this.trustedSurfaceRect.jmin?(this.trustedSurfaceRect.jmin=1,this.trustedSurfaceRect.jmax=this.trustedRectWidth+
1):this.trustedSurfaceRect.jmin>this.canvasDimensions.computeCanvas.width-2&&(this.trustedSurfaceRect.jmax=this.canvasDimensions.computeCanvas.width-2,this.trustedSurfaceRect.jmin=this.canvasDimensions.computeCanvas.width-2-this.trustedRectWidth));var p=0,q=0;if(this.arOnGround||this.arOnCeiling)if(this.arOnGround)for(var r=Math.trunc(2/3*this.canvasDimensions.computeCanvas.height);r<this.canvasDimensions.computeCanvas.height;r++)for(var t=0;t<r-.5*this.canvasDimensions.computeCanvas.height;t++)0!=
this.img_value_edges.data[r*this.canvasDimensions.computeCanvas.width+Math.trunc(this.canvasDimensions.computeCanvas.width/2+(t-(r-.5*this.canvasDimensions.computeCanvas.height)/2))]&&p++,q++;else for(var v=3*this.canvasDimensions.computeCanvas.width/(2*this.canvasDimensions.computeCanvas.height),u=0;u<Math.trunc(1/3*this.canvasDimensions.computeCanvas.height);u++)for(var w=Math.trunc(v*u);w<Math.trunc(this.canvasDimensions.computeCanvas.width-v*u);w++)0!=this.img_value_edges.data[u*this.canvasDimensions.computeCanvas.width+
w]&&p++,q++;else for(var A=this.trustedSurfaceRect.imin;A<this.trustedSurfaceRect.imax+1;A++)for(var B=this.trustedSurfaceRect.jmin;B<this.trustedSurfaceRect.jmax+1;B++)0!=this.img_value_edges.data[A*this.canvasDimensions.computeCanvas.width+B]&&p++,q++;if("canny"==(.05<p/q?"patchs":"canny")){jsfeat.imgproc.gaussian_blur(this.img_saturation,this.img_saturation_blured,(this.blur_radius|0)+1<<1,0);jsfeat.imgproc.canny(this.img_saturation_blured,this.img_saturation_edges,this.canny_thresholds.saturation.low|
0,this.canny_thresholds.saturation.high|0);var E=Array(this.canvasDimensions.computeCanvas.nbPixels).fill(!0);if(this.arOnGround||this.arOnCeiling)var D=[this.img_saturation_edges,this.img_value_edges];else{for(var da=0;da<this.canvasDimensions.computeCanvas.nbPixels;da++)255==this.img_saturation_edges.data[da]&&(this.img_value_edges.data[da]=255);D=[this.img_value_edges]}for(f=0;f<D.length;f++)for(ea.call(this,D[f],this.temp_img1),this.surfaceID=J.call(this,this.temp_img1.data),da=0;da<this.canvasDimensions.computeCanvas.nbPixels;da++)this.region[da]!=
this.surfaceID&&(E[da]=!1);for(f=0;f<this.canvasDimensions.computeCanvas.nbPixels;f++)this.temp_img1.data[f]=E[f]?0:255;oa.call(this,this.temp_img1,this.temp_img2);oa.call(this,this.temp_img2,this.temp_img1);ea.call(this,this.temp_img1,this.surface_mask);this.surfaceID=J.call(this,this.surface_mask.data)}else{var H=1-this.beta/(4*Math.PI),I=Math.trunc(this.canvasDimensions.computeCanvas.width/10);this.surfaceID=255;var M=this.img_value.data,T=this.img_hue.data,Z=this.img_saturation.data,ba=Array(this.canvasDimensions.computeCanvas.nbPixels).fill(0),
U=I,Aa=Array(this.canvasDimensions.computeCanvas.nbPixels).fill(-1),eb=0,ab=Math.trunc(this.canvasDimensions.computeCanvas.width/2)%U;0!=ab&&(ab-=U);for(var Ma=this.canvasDimensions.computeCanvas.height-I;0<=Ma;Ma-=U){for(var Ta=0;Ta<this.canvasDimensions.computeCanvas.width;Ta+=U){for(var db=0;db<U;db++)for(var Oa=0;Oa<U;Oa++)Ta+Oa+ab<this.canvasDimensions.computeCanvas.width&&0<=Ta+Oa+ab&&(Aa[(Ma+db)*this.canvasDimensions.computeCanvas.width+Ta+Oa+ab]=eb);eb++}U=6<U*H?Math.round(U*H):6;ab=Math.trunc(this.canvasDimensions.computeCanvas.width/
2)%U;0!=ab&&(ab-=U)}for(var Qa,N=0,za=this.canvasDimensions.computeCanvas.width-1,ca=-1;-1===ca;)ca=Aa[N*this.canvasDimensions.computeCanvas.width+za],za--,0>za&&(N++,za=this.canvasDimensions.computeCanvas.width-1);Qa=ca+1;for(var Ea=Array(Qa).fill([]),Ca=Array(Qa).fill([]),Ua=Array(Qa).fill([]),sa,na=0;na<this.canvasDimensions.computeCanvas.nbPixels;na++)sa=Aa[na],-1!=sa&&(0==Ea[sa].length?Ea[sa]=[M[na]]:Ea[sa].push(M[na]),0==Ca[sa].length?Ca[sa]=[T[na]]:Ca[sa].push(T[na]),0==Ua[sa].length?Ua[sa]=
[Z[na]]:Ua[sa].push(Z[na]));for(var kb=Array(Ea.length),Da=0;Da<Ea.length;Da++){for(var xb=Da,Za=Ea[Da],V=Array(256).fill(0),O=0;O<Za.length;O++)V[Za[O]]++;kb[xb]=V}for(var ja=Array(kb.length),W=0;W<kb.length;W++)ja[W]=ta(kb[W]);for(var pa,Pa,ha=Array(256).fill(0),ya,zb=aa(Ua),cb,nc=aa(Ca),dc,Wb=Ca.length,Sb=Array(Wb),ec=0;ec<Wb;ec++)Sb[ec]=L(C(Ca,Ua,ec),2);for(var Xb=Array(256).fill(0),yb,Rb,Gb,ob,Hb,tc=[],pb=[],Ab=K.call(this,Aa),Bb=0;Bb<Ab.length;Bb++){Y.call(this,ba,Aa,Ab[Bb],255);ha=ua(ha,kb[Ab[Bb]]);
Xb=ua(Xb,C(Ca,Ua,Ab[Bb]));tc.push(Ab[Bb]);var $a=S.call(this,Ab[Bb],Aa);for(j=0;j<$a.length;j++)Ab.includes($a[j])||pb.includes($a[j])||-1==$a[j]||pb.push($a[j])}ya=ta(ha);for(yb=L(Xb,4);0<pb.length;){var lb=pb.shift();20>=zb[lb]?(Gb=!1,ob=4):(Gb=!0,ob=8);Hb=0;for(var ic=void 0,ac=lb,Yb=ja,Kc=Ab,ad=S.call(this,ac,Aa),oc=[],Cc=0;Cc<ad.length;Cc++)Kc.includes(ad[Cc])&&oc.push(Yb[ad[Cc]]);if(0==oc.length)pa=-1;else{var nd=Yb[ac],Sc=ia(oc[0],nd);for(Cc=1;Cc<oc.length;Cc++)ic=ia(oc[Cc],nd),ic<Sc&&(Sc=
ic);pa=Sc}Pa=ia(ya,ja[lb]);Hb+=2*R(pa,.75)/2;Hb+=2*R(Pa,.75)/2;cb=G.call(this,lb,zb,Ab,Aa);Hb+=2*R(cb,20);if(Gb){dc=G.call(this,lb,nc,Ab,Aa);Hb+=1*R(dc,30);var Tc=void 0,rb=void 0,od=void 0,Dc=void 0,Nb=yb,Ib=Sb[lb];Nb.length>Ib.length&&(Tc=Ib.slice(),Ib=Nb,Nb=Tc);for(var Ob=Dc=0;Ob<Nb.length;Ob++){rb=Math.abs(Nb[Ob]-Ib[0]);for(var Tb=1;Tb<Ib.length;Tb++)Math.abs(Nb[Ob]-Ib[Tb])<rb&&(rb=Math.abs(Nb[Ob]-Ib[Tb]));Dc+=rb}if(Nb.length==Ib.length){for(Ob=od=0;Ob<Ib.length;Ob++){rb=Math.abs(Ib[Ob]-Nb[0]);
for(Tb=1;Tb<Nb.length;Tb++)Math.abs(Ib[Ob]-Nb[Tb])<rb&&(rb=Math.abs(Ib[Ob]-Nb[Tb]));od+=rb}od<Dc&&(Dc=od)}Rb=Dc/Nb.length;Hb+=3*R(Rb,15)}Hb/=ob;if(.85<Hb){Y.call(this,ba,Aa,lb,255);Ab.push(lb);ha=ua(ha,kb[lb]);ya=ta(ha);var wc=S.call(this,lb,Aa);for(Bb=0;Bb<wc.length;Bb++)tc.includes(wc[Bb])||pb.includes(wc[Bb])||pb.push(wc[Bb])}tc.push(lb)}var pd=ba,bc=K.call(this,Aa),Uc=[],Lc=[],uc,Ec=Array(pd.length).fill(0);var Ub=[];for(var sb=0;sb<bc.length;sb++){Y.call(this,Ec,Aa,bc[sb],255);var Cb=S.call(this,
bc[sb],Aa);for(j=0;j<Cb.length;j++)bc.includes(Cb[j])||Ub.includes(Cb[j])||Ub.push(Cb[j])}for(;0<Ub.length;){var pc=Ub.shift();if(Ab.includes(pc)){Cb=S.call(this,pc,Aa);var Pc=Cb.length;for(sb=uc=0;sb<Pc;sb++)Ab.includes(Cb[sb])&&uc++;if(Pc==uc)for(Y.call(this,Ec,Aa,pc,255),Lc.push(pc),sb=0;sb<Cb.length;sb++)bc.includes(Cb[sb])||Ub.includes(Cb[sb])||Ub.push(Cb[sb]);else Uc.push(pc)}bc.push(pc)}for(;0<Uc.length;){pc=Uc.shift();Cb=S.call(this,pc,Aa);for(sb=uc=0;sb<Cb.length;sb++)Lc.includes(Cb[sb])&&
uc++;0<uc&&Y.call(this,Ec,Aa,pc,255)}for(var tb=ba=Ec,Hc=Q.call(this,tb,12,1),Lb=this.arOnGround||this.arOnCeiling?Array(this.canvasDimensions.computeCanvas.width).fill(this.canvasDimensions.computeCanvas.height):Q.call(this,tb,12,1,!1),Vc=0;Vc<this.canvasDimensions.computeCanvas.height;Vc++)for(var vc=0;vc<this.canvasDimensions.computeCanvas.width;vc++)tb[Vc*this.canvasDimensions.computeCanvas.width+vc]=Vc<Hc[vc]||Vc>Lb[vc]?0:255;this.region=ba=tb}var Ic=Math.floor(this.canvasDimensions.computeCanvas.halfHeight+
Math.round(-this.canvasDimensions.videoCanvas.height*Math.tan(Math.PI/2-this.beta)/(2*this.canvasDimensions.videoCanvas.fov.tanHalfV)*this.canvasDimensions.videoCanvas.toComputeFactor));this.alreadySeen.fill(!1);if(this.arOnCeiling)for(var cc=0;cc<this.canvasDimensions.computeCanvas.width;cc++)for(var Pb=Ic;Pb<=this.canvasDimensions.computeCanvas.height;Pb++){var jc=Pb*this.canvasDimensions.computeCanvas.width+cc;this.region[jc]=-10;this.alreadySeen[jc]=!0}else for(cc=0;cc<this.canvasDimensions.computeCanvas.width;cc++)for(Pb=
0;Pb<=Ic;Pb++)jc=Pb*this.canvasDimensions.computeCanvas.width+cc,this.region[jc]=-10,this.alreadySeen[jc]=!0;var Oc=.75*this.objectOffset.max.both;for(cc=0;cc<this.canvasDimensions.computeCanvas.width;cc++)for(Pb=0;Pb<this.canvasDimensions.computeCanvas.height;Pb++)if(jc=Pb*this.canvasDimensions.computeCanvas.width+cc,this.region[jc]==this.surfaceID)for(var xc=0;xc<this.side4_size;xc++){var Gc=jc+this.side4[xc];if(!this.alreadySeen[Gc]&&this.region[Gc]!=this.surfaceID){var Fc=Gc%this.canvasDimensions.computeCanvas.width,
dd=Math.floor(Gc/this.canvasDimensions.computeCanvas.width),Qc=this.surface_mask.data;if(0>=Fc||Fc>=this.canvasDimensions.computeCanvas.minWidth||0>=dd||dd>=this.canvasDimensions.computeCanvas.minHeight)var fc=[];else{var vb=dd*this.canvasDimensions.computeCanvas.width+Fc;this.alreadySeen[vb]=!0;var Fb=[];this.fifo[0]=vb;for(var kc=0,Db=1;kc<Db;){vb=this.fifo[kc];Fb.push(vb);for(var gc=0;gc<this.side4_size;gc++){var hc=vb+this.side4[gc],rc=hc%this.canvasDimensions.computeCanvas.width,Mb=Math.floor(hc/
this.canvasDimensions.computeCanvas.width);0<rc&&rc<this.canvasDimensions.computeCanvas.minWidth&&0<Mb&&Mb<this.canvasDimensions.computeCanvas.minHeight&&!this.alreadySeen[hc]&&Qc[hc]==Qc[vb]&&(Fb.push(hc),this.alreadySeen[hc]=!0,this.fifo[Db]=hc,Db++)}kc++}fc=Fb}for(var Nc=fc.length,mb=[this.canvasDimensions.computeCanvas.width,this.canvasDimensions.computeCanvas.height,0,0],Jb=0;Jb<Nc;Jb++){var Jc=fc[Jb]%this.canvasDimensions.computeCanvas.width,qd=Math.floor(fc[Jb]/this.canvasDimensions.computeCanvas.width);
mb[0]=Math.min(mb[0],Jc);mb[1]=Math.min(mb[1],qd);mb[2]=Math.max(mb[2],Jc);mb[3]=Math.max(mb[3],qd)}var Mc=[.5*(mb[0]+mb[2]),.5*(mb[1]+mb[3])],qc=[Mc[0],mb[1]],gd=[Mc[0],mb[3]],lc=[mb[0],Mc[1]],rd=[mb[2],Mc[1]],wd=$jscomp.makeIterator(ka.call(this,qc[0],qc[1],this.Hcam,this.camera.distanceToTarget,this.beta)),sc=wd.next().value;wd.next();var hd=$jscomp.makeIterator(ka.call(this,gd[0],gd[1],this.Hcam,this.camera.distanceToTarget,this.beta)),yc=hd.next().value;hd.next();var Kb=$jscomp.makeIterator(ka.call(this,
lc[0],lc[1],this.Hcam,this.camera.distanceToTarget,this.beta)),Zb=Kb.next().value;Kb.next();var Yc=$jscomp.makeIterator(ka.call(this,rd[0],rd[1],this.Hcam,this.camera.distanceToTarget,this.beta)),id=Yc.next().value;Yc.next();if(this.arOnCeiling){var Rc=$jscomp.makeIterator([sc,yc]);yc=Rc.next().value;sc=Rc.next().value}if(!(sc[2]<yc[2]||Zb[0]<id[0])&&sc[2]-yc[2]<Oc&&Zb[0]-id[0]<Oc)for(Jb=0;Jb<Nc;Jb++)this.region[fc[Jb]]=this.surfaceID}}}F.call(this,!0)};k.prototype.clearAR=function(){this.intervalMoveCamera&&
(window.clearInterval(this.intervalMoveCamera),delete this.intervalMoveCamera);this.intervalDrawVideo&&(window.clearInterval(this.intervalDrawVideo),delete this.intervalDrawVideo);this.deviceOrientationListener&&(window.removeEventListener("deviceorientation",this.deviceOrientationListener),delete this.deviceOrientationListener);this.videoStop()};k.prototype.shouldWaitDelay=function(){if(Date.now()-this.lastCallDate<this.delay)return!0;this.lastCallDate=Date.now();return!1};k.prototype.setBetaGamma=
function(b,d){this.baseBeta=b;this.baseGamma=d;if(this.environmentCamera){var f=void 0===screen.orientation?0>window.orientation?270:window.orientation:screen.orientation.angle;this.beta=90==f?0>d?-d:180-d:270==f?0>d?180+d:d:b;this.beta=Math.min(Math.max(this.beta,0),180)*this.degreeToRadian}else this.beta=Math.max(Math.abs(Math.PI-b),Math.abs(Math.PI-d))*this.degreeToRadian;e.call(this)};k.prototype.getBeta=function(){return this.beta};k.prototype.getGamma=function(){return this.gamma};k.prototype.checkPositionValidity=
function(b){return this.centerPositionIsValid?b?this.arOnCeiling?this.beta>Math.PI/2:this.beta<Math.PI/2:!0:!1};deviceOrientationListener=function(b){this.shouldWaitDelay()||this.setBetaGamma(b.beta,b.gamma)};var D=function(b){b=void 0===b?null:b;b!=this.viewerDisplayed&&(null==b&&(b=this.viewerDisplayed),this.viewerDisplayed=b,this.apiCore.exec(this.callerName,"arUI.setViewerVisibility",this.viewerDisplayed))},A=function(){this.camera.distanceToTarget=this.arOnCeiling?-Math.tan(this.beta)*(this.ceilHeight-
this.Hcam):Math.tan(this.beta)*this.Hcam;var b=$jscomp.makeIterator(ka.call(this,this.center[0],this.center[1],this.Hcam,this.camera.distanceToTarget,this.beta,-1));this.cameraTargetPosition=b.next().value;this.centerPositionIsValid=b.next().value;H.call(this)},H=function(){if(this.checkPositionValidity(!1)){this.camera.position=[this.camera.distanceToTarget*this.sinGamma,this.Hcam,this.camera.distanceToTarget*this.cosGamma];this.arOnCeiling&&(this.camera.position[1]=-(this.ceilHeight-this.Hcam));
var b=this.cameraTargetPosition[0]*this.cosGamma+this.cameraTargetPosition[2]*this.sinGamma,d=this.cameraTargetPosition[1],e=this.cameraTargetPosition[2]*this.cosGamma-this.cameraTargetPosition[0]*this.sinGamma;this.camera.position[0]+=b+this.camera.rotationCenter.x;this.camera.position[1]+=d+this.camera.rotationCenter.y;this.camera.position[2]+=e+this.camera.rotationCenter.z;this.camera.target=[b+this.camera.rotationCenter.x,d+this.camera.rotationCenter.y,e+this.camera.rotationCenter.z];E.call(this);
D.call(this,!0)}else D.call(this,!1)},e=function(){var b=Math.cos(this.beta)/Math.sin(this.beta);isFinite(b)||(b=0);this.Hcam=this.user.eye-b*this.ellipseRadiusMax/Math.sqrt(1+this.ellipseExcentricity*this.ellipseExcentricity*b*b)-this.surfaceHeight;this.Hcam+=Math.sin(this.beta)*(this.device.camPosition[this.portraitMode?0:1]-this.user.palm)-(!this.device.isIos&&this.device.isMobile||this.device.isPreviPhone()?.104:.181)},E=function(){var b=this,d=[{position:this.camera.position.map(function(d){return d*
b.scale}),target:this.camera.target.map(function(d){return d*b.scale}),up:[0,1,0],t:0,fov:this.canvasDimensions.displayCanvas.fov}];this.apiCore.exec(this.callerName,"startAnimatingPath",d,0,1)};k.prototype.getCameraPosition=function(){return this.camera.position};k.prototype.getCameraTarget=function(){return this.camera.target};k.prototype.switchCamera=function(){this.device.cameras&&1<this.device.cameras.length&&(this.environmentCamera=!this.environmentCamera);this.stream&&this.stream.getTracks().forEach(function(b){return b.stop()});
this.stream=null;this.videoStart()};var F=function(b){b=void 0===b?!1:b;var d=[Math.min(this.canvasDimensions.computeCanvas.width,Math.max(Math.round(this.center[0]+this.centerOffset[0]),0)),Math.min(this.canvasDimensions.computeCanvas.height,Math.max(Math.round(this.center[1]+this.centerOffset[1]),0))],e=[0,0];if(this.photoTaken&&this.enableCollisionCheck)if(b)a:{b=d[0];d=d[1];var f=d*this.canvasDimensions.computeCanvas.width+b;this.alreadySeen.fill(!1);this.alreadySeen[f]=!0;if(this.region[f]!=
this.surfaceID||U.call(this,b,d)){this.fifo[0]=f;for(var h=0,k=1;h<k;){f=this.fifo[h];for(var l=0;l<this.side4_size;l++){var m=f+this.side4[l],n=m%this.canvasDimensions.computeCanvas.width,p=Math.floor(m/this.canvasDimensions.computeCanvas.width);if(0<n&&n<this.canvasDimensions.computeCanvas.minWidth&&0<p&&p<this.canvasDimensions.computeCanvas.minHeight){if(this.region[m]==this.surfaceID&&!U.call(this,n,p)){d=[n,p];break a}this.alreadySeen[m]||(this.alreadySeen[m]=!0,this.fifo[k]=m,k++)}}h++}}d=[b,
d]}else{e=[this.center[0]+this.centerOffset[0],this.center[1]+this.centerOffset[1]];a:{b=d;d=this.center;l=d[0]-b[0];m=d[1]-b[1];f=Math.abs(l);h=Math.abs(m);k=0;l=0<l?1:-1;m=0<m?1:-1;if(f>h)for(n=b[0],p=b[1];0>l?n>=d[0]:n<=d[0];n+=l){if(!U.call(this,n,p)){d=[n,p];break a}k+=h;k<<1>=f&&(p+=m,k-=f)}else for(n=b[0],p=b[1];0>m?p>=d[1]:p<=d[1];p+=m){if(!U.call(this,n,p)){d=[n,p];break a}k+=f;k<<1>=h&&(n+=l,k-=h)}d=b}e=[e[0]-d[0],e[1]-d[1]]}this.center=d;g.call(this,e);this.photoTaken&&A.call(this)},p=
function(){var b=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(d){if(1==d.nextAddress)return b.photoTaken=!1,b.clearAR(),d.yield(b.videoStart(),2);g.call(b);A.call(b);m.call(b);b.deviceOrientationListener||(b.intervalMoveCamera=window.setInterval(stage.setContext(A,b),b.delay*(b.device.isIos?3:1)),b.intervalDrawVideo=window.setInterval(stage.setContext(m,b),b.delay),b.deviceOrientationListener=stage.setContext(deviceOrientationListener,b),window.addEventListener("deviceorientation",
b.deviceOrientationListener,!1));setTimeout(stage.setContext(function(){this.apiCore.exec(this.callerName,"showArVideoUi")},b),b.delay);setTimeout(stage.setContext(function(){0==this.beta&&this.browser.oldSafari&&(this.device.isIos?this.apiCore.exec(this.callerName,"showIosUnavailableOrientationMessage"):this.apiCore.exec(this.callerName,"showMoveYourDeviceMessage"))},b),1E3);d.jumpToEnd()})},m=function(){this.videoElem&&!this.photoTaken&&(this.ctx_canvas.clearRect(0,0,this.canvasDimensions.displayCanvas.width,
this.canvasDimensions.displayCanvas.height),this.drawStreamToVid(),h.call(this))},h=function(){this.ctx_photo.drawImage(this.c_vid,this.canvasDimensions.videoCanvas.deltaX,this.canvasDimensions.videoCanvas.deltaY,this.canvasDimensions.videoCanvas.displayedWidth,this.canvasDimensions.videoCanvas.displayedHeight,0,0,this.canvasDimensions.displayCanvas.width,this.canvasDimensions.displayCanvas.height)};k.prototype.getStream=function(){return this.stream};k.prototype.getVideoAngle=function(){var b=0;
screen.orientation&&screen.orientation.angle&&(b=screen.orientation.angle);this.browser.isChrome||0!=b||(b=window.matchMedia("(orientation: landscape)").matches?0<=this.baseBeta?0:180:0<=this.baseGamma?270:90);return b};k.prototype.drawStreamToVid=function(){this.shouldRotateVideoCanvas?(this.ctx_vid.save(),this.ctx_vid.translate(this.canvasDimensions.videoCanvas.width/2,this.canvasDimensions.videoCanvas.height/2),this.ctx_vid.rotate(-this.videoAngle),this.ctx_vid.drawImage(this.videoElem,-this.videoElem.videoWidth/
2,-this.videoElem.videoHeight/2),this.ctx_vid.restore()):this.ctx_vid.drawImage(this.videoElem,0,0);this.settings.realTimeRefraction&&this.apiCore.exec(this.callerName,"rdr.setBackgroundImage",this.c_vid,1,{x:.5,y:.5},1)};k.prototype.getVideoImage=function(){return this.ctx_vid.getImageData(0,0,this.canvasDimensions.videoCanvas.width,this.canvasDimensions.videoCanvas.height)};k.prototype.videoStart=function(){var b=this,d;return $jscomp.asyncExecutePromiseGeneratorProgram(function(e){if(1==e.nextAddress){b.browser.isSafari&&
!b.browser.oldSafari&&b.apiCore.exec(b.callerName,"requestOrientationMotion");b.videoElem||(b.apiCore.exec(b.callerName,"createVideoElem"),b.videoElem=b.apiCore.exec(b.callerName,"getVideoElem"));if(b.stream)return b.videoElem.srcObject=b.stream,b.videoElem.onloadedmetadata=stage.setContext(function(){this.videoElem.play()},b),e.jumpTo(2);b.apiCore.exec(b.callerName,"arVideoStarted");return e.yield(b.apiCore.exec(b.callerName,"arUI.requestCameraStream",b.environmentCamera),3)}2!=e.nextAddress&&(d=
e.yieldResult,b.stream=d,b.videoElem.srcObject=b.stream,b.videoElem.onloadedmetadata=stage.setContext(function(){this.videoElem.play()},b),b.apiCore.exec(b.callerName,"arVideoSettings",b.stream.getVideoTracks()[0].getSettings()));v.call(b);e.jumpToEnd()})};k.prototype.videoStop=function(){this.videoElem&&(this.apiCore.exec(this.callerName,"arVideoStopped"),this.stream&&(this.device.isIos&&this.stream.getTracks().forEach(function(b){b.stop()}),this.apiCore.exec(this.callerName,"arUI.resetCameraState")),
this.videoElem.pause(),this.stream=this.videoElem.srcObject=null)};var v=function(){this.portraitMode=!((window.orientation||(window.screen.orientation?window.screen.orientation.angle+(this.device.isMobile?0:90):0))%180);var b=this.getVideoAngle();this.videoAngle=b*this.degreeToRadian;this.portraitMode||!this.shouldRotateVideoCanvas||90!=b&&270!=b||(this.portraitMode=!0)};k.prototype.getPortraitMode=function(){return this.portraitMode};var I=function(b,d,e,f,g,h){var k={minX:this.canvasDimensions.computeCanvas.width,
minY:this.canvasDimensions.computeCanvas.height,maxX:0,maxY:0};b=$jscomp.makeIterator(ka.call(this,b,d,e,f,g));d=b.next().value;b.next();h=[[d[0]+h.bottom[0]+h.right[0],d[1],d[2]+h.bottom[2]+h.right[2]],[d[0]+h.bottom[0]+h.left[0],d[1],d[2]+h.bottom[2]+h.left[2]],[d[0]+h.top[0]+h.left[0],d[1],d[2]+h.top[2]+h.left[2]],[d[0]+h.top[0]+h.right[0],d[1],d[2]+h.top[2]+h.right[2]]];corners2d=[];for(b=0;b<h.length;b++)corners2d.push(Z.call(this,h[b][0],h[b][1],h[b][2],e,f,g)),k.minX=Math.min(k.minX,corners2d[b][0]),
k.maxX=Math.max(k.maxX,corners2d[b][0]),k.minY=Math.min(k.minY,corners2d[b][1]),k.maxY=Math.max(k.maxY,corners2d[b][1]);return[h,corners2d,k]},J=function(b){this.region.fill(void 0);for(var d=0,e=0,f=0,g=this.trustedSurfaceRect.imin;g<this.trustedSurfaceRect.imax+1;g++)for(var h=this.trustedSurfaceRect.jmin;h<this.trustedSurfaceRect.jmax+1;h++){var k=g*this.canvasDimensions.computeCanvas.width+h;if(0==b[k]&&void 0==this.region[k]){this.region[k]=d;var l=1;this.fifo[0]=k;for(var m=0,n=1;m<n;){k=this.fifo[m];
for(var p=0;p<this.side4_size;p++){var q=k+this.side4[p],r=q%this.canvasDimensions.computeCanvas.width,t=Math.floor(q/this.canvasDimensions.computeCanvas.width);0<r&&r<this.canvasDimensions.computeCanvas.minWidth&&0<t&&t<this.canvasDimensions.computeCanvas.minHeight&&0==b[q]&&void 0==this.region[q]&&(255==b[q-1]!=(255==b[q+1])||255==b[q-this.canvasDimensions.computeCanvas.width]!=(255==b[q+this.canvasDimensions.computeCanvas.width])||0==b[q-1]&&0==b[q-this.canvasDimensions.computeCanvas.width])&&
(this.region[q]=d,t==this.canvasDimensions.computeCanvas.height-2&&l++,this.fifo[n]=q,n++)}m++}l>f&&(e=d,f=l);d++}}return e},M=function(b,d,e){var f=d[0]-b[0],g=d[1]-b[1],h=Math.abs(f),k=Math.abs(g),l=0;f=0<f?1:-1;g=0<g?1:-1;if(h>k){var m=b[0];for(b=b[1];0>f?m>=d[0]:m<=d[0];m+=f){if(this.region[b*this.canvasDimensions.computeCanvas.width+m]!=this.surfaceID)return!0;e&&e.points.push([m,b]);l+=k;l<<1>=h&&(b+=g,l-=h)}}else for(m=b[0],b=b[1];0>g?b>=d[1]:b<=d[1];b+=g){if(this.region[b*this.canvasDimensions.computeCanvas.width+
m]!=this.surfaceID)return!0;e&&e.points.push([m,b]);l+=h;l<<1>=k&&(m+=f,l-=k)}return!1},T=function(b){var d=this,e={points:[]};if(M.call(this,b[1],b[2],e)||M.call(this,b[0],b[2],e)||M.call(this,b[0],b[1],e))return!0;e.points.sort(function(b,d){return b[1]===d[1]?b[0]-d[0]:b[1]-d[1]}).forEach(function(b,e,f){if((e=f[e+1])&&b[1]===e[1])for(f=b[0];f<e[0];f++){if(d.region[b[1]*d.canvasDimensions.computeCanvas.width+f]!=d.surfaceID)return!0}else if(d.region[b[1]*d.canvasDimensions.computeCanvas.width+
b[0]]!=d.surfaceID)return!0});return!1},U=function(b,d){var e=$jscomp.makeIterator(I.call(this,b,d,this.Hcam,this.camera.distanceToTarget,this.beta,this.objectOffset.offsets3D));e.next();var f=e.next().value;e=e.next().value;e.maxY==e.minY&&e.maxY++;e.maxX==e.minX&&e.maxX++;var g=ba.call(this,e.maxX,e.maxY),h=ba.call(this,e.minX,e.minY);if(g[0]-h[0]>this.canvasDimensions.displayCanvas.width||g[1]-h[1]>this.canvasDimensions.displayCanvas.height||0>h[0]||0>h[1]||g[0]>this.canvasDimensions.displayCanvas.width||
g[1]>this.canvasDimensions.displayCanvas.height)return!0;if(2==this.settings.collisionMode){for(f=e.minX;f<e.maxX;f++)if(this.region[d*this.canvasDimensions.computeCanvas.width+f]!==this.surfaceID)return!0;for(d=e.minY;d<e.maxY;d++)if(this.region[d*this.canvasDimensions.computeCanvas.width+b]!==this.surfaceID)return!0;return!1}b=0==this.settings.collisionMode;b=(void 0===b?0:b)?T.call(this,[f[0],f[1],f[2]])||T.call(this,[f[0],f[2],f[3]]):M.call(this,f[1],f[2])||M.call(this,f[0],f[1])||M.call(this,
f[2],f[3])||M.call(this,f[3],f[0]);return b},R=function(b,d){var e=0;b<=2*d&&(e=b<=d?1:1-(b-d)/d);return e},aa=function(b){for(var d=Array(b.length),e=0;e<b.length;e++){for(var f=e,g=b[e],h=0,k=0;k<g.length;k++)h+=g[k];d[f]=h/g.length}return d},C=function(b,d,e){var f=Array(256).fill(0);b=b[e];d=d[e];for(e=0;e<b.length;e++)f[Math.trunc(b[e])]+=d[e]/255;return f},L=function(b,d){var e=[],f=[],g,h=Array(256).fill(0);var k=[];for(var l,m,n,p,q,r=g=0;r<b.length;r++)if(0!=r&&r!=b.length-1)b[r-1]<b[r]&&
b[r+1]<b[r]&&(k.push(r),h[r]=b[r]);else if(0==r&&b[r+1]<b[r]||r==b.length-1&&b[r-1]<b[r])k.push(r),h[r]=b[r];for(b=!1;!b&&10>g;){b=!0;for(r=0;r<k.length-1;r++)l=k[r],m=k[r+1],10>Math.abs(l-m)&&(b=!1,n=h[l],p=h[m],q=Math.trunc((l*n+m*p)/(n+p)),h[l]=0,h[m]=0,h[q]=n+p,k.splice(r+1,1),k[r]=q);g++}for(r=0;r<h.length;r++)0<h[r]&&f.push(r);if(f.length<=d)0==f.length?e.push([-1]):e=f;else for(r=0;r<d;r++){g=0;k=h[f[0]];for(b=0;b<f.length;b++)h[f[b]]>k&&(k=h[f[b]],g=b);e.push(f[g]);f.splice(g,1)}return e},
K=function(b){var d=[];if(this.arOnGround||this.arOnCeiling)for(var e=Math.trunc(2/3*this.canvasDimensions.computeCanvas.height);e<this.canvasDimensions.computeCanvas.height;e++)for(var f=0;f<e-.5*this.canvasDimensions.computeCanvas.height;f++){var g=Math.trunc(this.canvasDimensions.computeCanvas.width/2+(f-(e-.5*this.canvasDimensions.computeCanvas.height)/2));d.includes(b[e*this.canvasDimensions.computeCanvas.width+g])||d.push(b[e*this.canvasDimensions.computeCanvas.width+g])}else for(e=this.trustedSurfaceRect.imin;e<
this.trustedSurfaceRect.imax+1;e++)for(f=this.trustedSurfaceRect.jmin;f<this.trustedSurfaceRect.jmax+1;f++)g=b[e*this.canvasDimensions.computeCanvas.width+f],d.includes(g)||d.push(g);return d},G=function(b,d,e,f){var g=S.call(this,b,f);f=[];for(var h=0;h<g.length;h++)e.includes(g[h])&&f.push(d[g[h]]);if(0==f.length)return-1;d=d[b];e=Math.abs(f[0]-d);for(h=1;h<f.length;h++)b=Math.abs(f[h]-d),b<e&&(e=b);return e},S=function(b,d){for(var e,f=0,g=e=0,h=0;h<this.canvasDimensions.computeCanvas.nbPixels;h++)d[h]==
b&&(f+=Math.trunc(h/this.canvasDimensions.computeCanvas.width),e+=h%this.canvasDimensions.computeCanvas.width,g++);f=Math.trunc(f/g);e=Math.trunc(e/g);e=f*this.canvasDimensions.computeCanvas.width+e;f=Math.trunc(e/this.canvasDimensions.computeCanvas.width);e%=this.canvasDimensions.computeCanvas.width;for(var k=h=g=!0,l=!0,m=[],n=g||h||k||l,p=1;n;)g&&(0>f-p?g=!1:d[(f-p)*this.canvasDimensions.computeCanvas.width+e]!=b&&(m.push(d[(f-p)*this.canvasDimensions.computeCanvas.width+e]),g=!1)),h&&(f+p>=this.canvasDimensions.computeCanvas.height?
h=!1:d[(f+p)*this.canvasDimensions.computeCanvas.width+e]!=b&&(m.push(d[(f+p)*this.canvasDimensions.computeCanvas.width+e]),h=!1)),k&&(0>e-p?k=!1:d[f*this.canvasDimensions.computeCanvas.width+e-p]!=b&&(m.push(d[f*this.canvasDimensions.computeCanvas.width+e-p]),k=!1)),l&&(e+p>=this.canvasDimensions.computeCanvas.width?l=!1:d[f*this.canvasDimensions.computeCanvas.width+e+p]!=b&&(m.push(d[f*this.canvasDimensions.computeCanvas.width+e+p]),l=!1)),n=g||h||k||l,p++;for(p=0;p<m.length;p++)-1==m[p]&&m.splice(p,
1);return m},Y=function(b,d,e,f){for(var g=0;g<this.canvasDimensions.computeCanvas.nbPixels;g++)d[g]==e&&(b[g]=f)},ia=function(b,d){for(var e,f,g,h=0;256>h;h++){for(var k=e=0;256>k;k++)g=(k+h)%256,e=0==b[k]+d[g]?e+0:e+Math.pow(b[k]-d[g],2)/(b[k]+d[g]);if(e<f||void 0==f)f=e}return f},Q=function(b,d,e,f){f=void 0===f?!0:f;for(var g=Array(this.canvasDimensions.computeCanvas.width).fill(f?this.canvasDimensions.computeCanvas.height:0),h=0;h<this.canvasDimensions.computeCanvas.width;h++)for(var k=0;k<this.canvasDimensions.computeCanvas.height;k++)255==
b[k*this.canvasDimensions.computeCanvas.width+h]&&(f?g[h]>k&&(g[h]=k):g[h]<k&&(g[h]=k));for(b=0;b<e;b++)for(f=g.slice(),h=0;h<this.canvasDimensions.computeCanvas.width;h++){cpt=sum=0;for(k=-d;k<d;k++)0<=h+k&&h+k<this.canvasDimensions.computeCanvas.width&&(sum+=f[h+k],cpt++);g[h]=sum/cpt}return g},ta=function(b){for(var d=0,e=Array(256).fill(0),f=0;256>f;f++)d+=b[f];if(0==d)return b;for(f=0;256>f;f++)e[f]+=b[f]/d;return e},ua=function(b,d){for(var e=Array(256),f=0;256>f;f++)e[f]=b[f]+d[f];return e},
ea=function(b,d){d.data.fill(0);for(var e=1;e<this.canvasDimensions.computeCanvas.minWidth;e++)for(var f=1;f<this.canvasDimensions.computeCanvas.minHeight;f++){var g=f*this.canvasDimensions.computeCanvas.width+e;if(255==b.data[g])for(var h=b.data[g]=0;h<this.side4_size;h++)if(255==b.data[g+this.side4[h]]){b.data[g]=255;break}if(255==b.data[g]){for(h=0;h<this.sideK_size;h++){var k=g+this.sideK[h];var l=k%this.canvasDimensions.computeCanvas.width,m=Math.floor(k/this.canvasDimensions.computeCanvas.width);
0<l&&l<this.canvasDimensions.computeCanvas.minWidth&&0<m&&m<this.canvasDimensions.computeCanvas.minHeight&&(d.data[k]=255)}d.data[g]=255}}},oa=function(b,d){d.data.fill(255);for(var e=1;e<this.canvasDimensions.computeCanvas.minWidth;e++)for(var f=1;f<this.canvasDimensions.computeCanvas.minHeight;f++){var g=f*this.canvasDimensions.computeCanvas.width+e;if(0==b.data[g]){b.data[g]=255;for(var h=0;h<this.side4_size;h++)if(0==b.data[g+this.side4[h]]){b.data[g]=0;break}}if(0==b.data[g]){for(h=0;h<this.sideK_size;h++){var k=
g+this.sideK[h];var l=k%this.canvasDimensions.computeCanvas.width,m=Math.floor(k/this.canvasDimensions.computeCanvas.width);0<l&&l<this.canvasDimensions.computeCanvas.minWidth&&0<m&&m<this.canvasDimensions.computeCanvas.minHeight&&(d.data[k]=0)}d.data[g]=0}}},ba=function(b,d){return[Math.round(b*this.canvasDimensions.computeCanvas.toDisplayFactor-this.canvasDimensions.displayCanvas.deltaX),Math.round(d*this.canvasDimensions.computeCanvas.toDisplayFactor-this.canvasDimensions.displayCanvas.deltaY)]},
ka=function(b,d,e,f,g,h){h=void 0===h?1:h;b-=this.canvasDimensions.computeCanvas.halfWidth;d-=this.canvasDimensions.computeCanvas.halfHeight;d=g-Math.atan(2*d/this.canvasDimensions.computeCanvas.height*this.canvasDimensions.videoCanvas.fov.tanHalfV);var k=0;if(this.arOnCeiling){var l=d>Math.PI/2&&d<Math.PI;var m=-(this.ceilHeight-e)*Math.tan(d);k=-this.realSize;e=-(this.ceilHeight-e)/Math.cos(d)}else l=0<d&&d<Math.PI/2,m=e*Math.tan(d),e/=Math.cos(d);return[[2*b/this.canvasDimensions.computeCanvas.width*
h*Math.cos(d-g)*this.canvasDimensions.videoCanvas.fov.tanHalfH*e,h*k,h*(f-m)],l]},Z=function(b,d,e,f,g,h){this.arOnCeiling?(d=Math.atan((e-g)/(this.ceilHeight-f)),b=-b*this.canvasDimensions.computeCanvas.width*Math.cos(d)/(2*Math.cos(d-h)*(this.ceilHeight-f)*this.canvasDimensions.videoCanvas.fov.tanHalfH)):(d=Math.atan((-e+g)/f),b=b*this.canvasDimensions.computeCanvas.width*Math.cos(d)/(2*Math.cos(d-h)*f*this.canvasDimensions.videoCanvas.fov.tanHalfH));h=this.canvasDimensions.computeCanvas.height/
(2*this.canvasDimensions.videoCanvas.fov.tanHalfV)*Math.tan(h-d);b+=this.canvasDimensions.computeCanvas.halfWidth;h+=this.canvasDimensions.computeCanvas.halfHeight;return[Math.round(b),Math.round(h)]};return k});stage.provide("emersya.viewer.modules.faceTrackingArControlsV1");stage.require("emersya.viewer.modules.API.core");
stage.register.call(stage.emersya.viewer.modules,"faceTrackingArControlsV1",function(){var b={cameraMinVideoDimFov:35},d=function(d,f,k){this.apiCore=d;this.settings=stage.extend(!0,b,k);this.scene=f;this.wearableAR=this.scene.wearableAR;this.camera={position:[0,0,0],target:[0,0,-1],up:[0,1,0],fov:0};this.root=this.scene.root;this.bbox=this.scene.arData.boundingBox;this.hiddenRootTranslation=[-this.root.boundingBox.minX,-this.root.boundingBox.minY,-this.root.boundingBox.minZ];this.identityMatrix=
mat4.identity(mat4.create());this.bbox.center||(this.bbox.center=[this.bbox.minX+(this.bbox.maxX-this.bbox.minX)/2,this.bbox.minY+(this.bbox.maxY-this.bbox.minY)/2,this.bbox.minZ+(this.bbox.maxZ-this.bbox.minZ)/2]);this.bbox.xLength=this.bbox.maxX-this.bbox.minX;this.bbox.yLength=this.bbox.maxY-this.bbox.minY;this.bbox.zLength=this.bbox.maxZ-this.bbox.minZ;this.maxRxStartingAngle=15*Math.PI/180;this.maxRyStartingAngle=15*Math.PI/180;this.maxRzStartingAngle=10*Math.PI/180;this.maxRxGlobalAngle=40*
Math.PI/180;this.maxRyGlobalAngle=50*Math.PI/180;this.maxRzGlobalAngle=45*Math.PI/180;this.minFaceScaling=.18;this.minStableDuration=500;this.visiblePolylists=[];for(d=0;d<this.wearableAR.arSpecificPolylists.length;++d)this.scene.polylists[this.wearableAR.arSpecificPolylists[d]]&&this.visiblePolylists.push(this.scene.polylists[this.wearableAR.arSpecificPolylists[d]]);this.hiddenPolylists=[];for(d=0;d<this.wearableAR.arHiddenPolylists.length;++d)this.scene.polylists[this.wearableAR.arHiddenPolylists[d]]&&
this.hiddenPolylists.push(this.scene.polylists[this.wearableAR.arHiddenPolylists[d]]);this.callerName=this.name="faceTrackingArControlsV1";this.apiCore.register(this,"resize",g)};d.prototype.destroy=function(){this.apiCore.unregister(this,"resize");return this.stopAR()};d.prototype.updateData=function(){this.arModuleSpec&&(k.call(this),this.apiCore.exec(this.callerName,"rdr.hidePolylists",this.visiblePolylists),this.apiCore.exec(this.callerName,"rdr.showPolylists",this.hiddenPolylists));this.wearableAR=
this.scene.wearableAR;this.root=this.scene.root;this.bbox=this.scene.arData.boundingBox;this.bbox.center||(this.bbox.center=[this.bbox.minX+(this.bbox.maxX-this.bbox.minX)/2,this.bbox.minY+(this.bbox.maxY-this.bbox.minY)/2,this.bbox.minZ+(this.bbox.maxZ-this.bbox.minZ)/2],this.bbox.xLength=this.bbox.maxX-this.bbox.minX,this.bbox.yLength=this.bbox.maxY-this.bbox.minY,this.bbox.zLength=this.bbox.maxZ-this.bbox.minZ);this.maxRxStartingAngle=15*Math.PI/180;this.maxRyStartingAngle=15*Math.PI/180;this.maxRzStartingAngle=
10*Math.PI/180;this.maxRxGlobalAngle=40*Math.PI/180;this.maxRyGlobalAngle=50*Math.PI/180;this.maxRzGlobalAngle=45*Math.PI/180;this.minFaceScaling=.18;this.minStableDuration=500;this.visiblePolylists=[];for(var b=0;b<this.wearableAR.arSpecificPolylists.length;++b)this.scene.polylists[this.wearableAR.arSpecificPolylists[b]]&&this.visiblePolylists.push(this.scene.polylists[this.wearableAR.arSpecificPolylists[b]]);this.hiddenPolylists=[];for(b=0;b<this.wearableAR.arHiddenPolylists.length;++b)this.scene.polylists[this.wearableAR.arHiddenPolylists[b]]&&
this.hiddenPolylists.push(this.scene.polylists[this.wearableAR.arHiddenPolylists[b]]);this.arModuleSpec&&(u.call(this),this.apiCore.exec(this.callerName,"rdr.showPolylists",this.visiblePolylists),this.apiCore.exec(this.callerName,"rdr.hidePolylists",this.hiddenPolylists))};var u=function(){for(var b=0;b<this.wearableAR.occluderNodes.length;++b){var d=this.scene.sourceNodes[this.wearableAR.occluderNodes[b]],g;for(g in d.duplicatedNodes)for(var k=d.duplicatedNodes[g],l=0;l<k.polylists.length;++l){var q=
k.polylists[l];q.occluder=!0;this.scene.occluders.push(q)}}for(b=0;b<this.scene.polylistInstances.length;++b)this.scene.polylistInstances[b].fadeOut=null;for(b=0;b<this.wearableAR.glassesTemples.length;++b)for(d=this.wearableAR.glassesTemples[b],g=0;g<d.polylists.length;++g)if(l=d.polylists[g],this.scene.polylists[l])for(k=this.scene.polylists[l],l=0;l<k.instances.length;++l){q=k.instances[l];var t=0,u=0;switch(d.fadeOutAxis){case 0:t=k.boundingBox.minX;u=k.boundingBox.maxX;break;case 1:t=k.boundingBox.minY;
u=k.boundingBox.maxY;break;case 2:t=k.boundingBox.minZ,u=k.boundingBox.maxZ}q.fadeOut={axis:d.fadeOutAxis,start:t+d.fadeOutStart*(u-t),end:t+d.fadeOutEnd*(u-t)}}this.apiCore.exec(this.callerName,"rdr.updateSceneMaterials",this.scene);this.apiCore.exec(this.callerName,"rdr.udpateShaders",this.scene)},k=function(){for(var b=0;b<this.wearableAR.occluderNodes.length;++b){var d=this.scene.sourceNodes[this.wearableAR.occluderNodes[b]],g;for(g in d.duplicatedNodes)for(var k=d.duplicatedNodes[g],l=0;l<k.polylists.length;++l){var q=
k.polylists[l];q.occluder=!1;this.scene.occluders.splice(this.scene.occluders.indexOf(q),1)}}for(b=0;b<this.wearableAR.glassesTemples.length;++b)for(d=this.wearableAR.glassesTemples[b],g=0;g<d.polylists.length;++g)if(l=d.polylists[g],this.scene.polylists[l])for(k=this.scene.polylists[l],l=0;l<k.instances.length;++l)q=k.instances[l],q.fadeOut=null;this.apiCore.exec(this.callerName,"rdr.updateSceneMaterials",this.scene);this.apiCore.exec(this.callerName,"rdr.udpateShaders",this.scene)};d.prototype.startAR=
function(b,d){this.arModuleReadyCallback=b;this.arModuleErrorCallback=d;this.stopped=!1;this.apiCore.exec(this.callerName,"rdr.forceUpdate",200);this.rendererCanvas=this.apiCore.exec(this.callerName,"rdr.getWebGLContext").canvas;this.arModuleCanvas||(this.arModuleCanvas=document.createElement("canvas"));this.arModuleCanvas.width=this.rendererCanvas.width;this.arModuleCanvas.height=this.rendererCanvas.height;arFaceTrackingModule.init({followZRot:!0,canvas:this.arModuleCanvas,NNCPath:"https://cdn.emersya.com/f/vendors/assets/nn/",
maxFacesDetected:1,callbackReady:stage.setContext(l,this),callbackTrack:stage.setContext(t,this)})};d.prototype.stopAR=function(){this.stopped=!0;if(!this.arModuleSpec)return!1;this.apiCore.exec(this.callerName,"arVideoStopped");k.call(this);this.apiCore.exec(this.callerName,"ui.hideBasicLoader");this.apiCore.exec(this.callerName,"resetBackground");this.apiCore.exec(this.callerName,"toggleCameraLock",!1);this.apiCore.exec(this.callerName,"resetCamera");this.apiCore.exec(this.callerName,"setAdaptativeFov",
this.scene.scenery.adaptativeFov);this.apiCore.exec(this.callerName,"resetRendererMinimumQualityAndTargetFramerate");this.apiCore.exec(this.callerName,"rdr.hidePolylists",this.visiblePolylists);this.apiCore.exec(this.callerName,"rdr.showPolylists",this.hiddenPolylists);this.apiCore.exec(this.callerName,"restartRendering");this.apiCore.exec(this.callerName,"hideFaceTrackingMask");this.apiCore.exec(this.callerName,"toggleAnnotations","annotations",!0);this.apiCore.exec(this.callerName,"arUI.setSettings",
{forceHideArStartButton:!1});this.apiCore.exec(this.callerName,"showArButton");this.apiCore.exec(this.callerName,"setCameraScreenOffsets",0,0);var b=this.scene.root;mat4.identity(b.matrix);this.scene.recursiveComputeMatrices(b,b.matrix);this.scene.updateSceneBoundingBoxesFromRaw();this.scene.updatedBoundingBox=!0;this.scene.forceCameraUpdate=!0;delete this.arModuleSpec;arFaceTrackingModule.destroy();return!0};var l=function(b,d){this.arModuleSpec=d;this.stopped?this.stopAR():b?this.arModuleErrorCallback&&
this.arModuleErrorCallback(b):(this.videoElement=d.videoElement,this.videoElement.width=this.videoElement.videoWidth,this.videoElement.height=this.videoElement.videoHeight,this.apiCore.exec(this.callerName,"arVideoSettings",{frameRate:0,width:this.videoElement.width,height:this.videoElement.height}),u.call(this),this.apiCore.exec(this.callerName,"setAdaptativeFov",!1),this.apiCore.exec(this.callerName,"rdr.setMinimumQualityAndTargetFramerate",1,0),this.apiCore.exec(this.callerName,"toggleCameraLock",
!0),this.apiCore.exec(this.callerName,"rdr.showPolylists",this.visiblePolylists),this.apiCore.exec(this.callerName,"rdr.hidePolylists",this.hiddenPolylists),this.apiCore.exec(this.callerName,"showFaceTrackingMask"),this.apiCore.exec(this.callerName,"stopRendering"),this.apiCore.exec(this.callerName,"toggleAnnotations","annotations",!1),this.apiCore.exec(this.callerName,"arUI.toggleArActiveState",!0),this.apiCore.exec(this.callerName,"arVideoStarted"),q.call(this),g.call(this,this.rendererCanvas.width,
this.rendererCanvas.height),this.apiCore.exec(this.callerName,"getDevice"),arFaceTrackingModule.set_stabilizationSettings({translationFactorRange:[5E-4,.002],rotationFactorRange:[.002,.01],qualityFactorRange:[.9,.98],alphaRange:[.05,1]}),this.arJustStarted=!0,this.arModuleReadyCallback&&(this.arModuleReadyCallback(),delete this.arModuleReadyCallback))},g=function(b,d){if(this.arModuleSpec){var f=b/d,g=this.videoElement.videoWidth,k=this.videoElement.videoHeight;this.videoElement.width=g;this.videoElement.height=
k;var l=g/k,q=this.settings.cameraMinVideoDimFov*(k>g?1/l:l);var r=f>l?b/g:d/k;this.scaleW=f>l?b/(g*r):d/(k*r);this.scaleW=1/this.scaleW;f>l&&(q*=1-(k-g/f)/k);this.camera.fov=q;this.aspectRatio=f;this.halfTanFOVX=Math.tan(f*q*Math.PI/360);this.tanFactor=f*q*Math.PI/360;this.rhtkmtu=f;if(this.arModuleCanvas.width!==b||this.arModuleCanvas.height!==d)this.arModuleCanvas.width=b,this.arModuleCanvas.height=d,arFaceTrackingModule.resize();this.apiCore.exec(this.callerName,"startAnimatingPath",[this.camera])}},
q=function(){mat4.identity(this.root.matrix);mat4.translate(this.root.matrix,this.hiddenRootTranslation);this.scene.recursiveComputeMatrices(this.root,this.identityMatrix)},t=function(b){try{this.apiCore.exec(this.callerName,"rdr.setBackgroundImage",this.videoElement,1,{x:.5,y:.5},1,!0);if(.8>b.detected){q.call(this);this.apiCore.exec(this.callerName,"showFaceTrackingMask");this.apiCore.exec(this.callerName,"forceRender");this.stoppedDate=Date.now();return}if(Math.abs(b.rx)>this.maxRxGlobalAngle||
Math.abs(b.ry)>this.maxRyGlobalAngle||Math.abs(b.rz)>this.maxRzGlobalAngle){q.call(this);this.apiCore.exec(this.callerName,"showFaceTrackingMask");this.apiCore.exec(this.callerName,"forceRender");this.stoppedDate=Date.now();return}if(1<=this.rhtkmtu&&b.s*this.scaleW*this.rhtkmtu<this.minFaceScaling||1>=this.rhtkmtu&&b.s*this.scaleW<this.minFaceScaling){q.call(this);this.apiCore.exec(this.callerName,"showFaceTrackingMask");this.apiCore.exec(this.callerName,"forceRender");this.stoppedDate=Date.now();
return}if(this.arJustStarted&&(Math.abs(b.rx)>this.maxRxStartingAngle||Math.abs(b.ry)>this.maxRyStartingAngle||Math.abs(b.rz)>this.maxRzStartingAngle)){q.call(this);this.apiCore.exec(this.callerName,"showFaceTrackingMask");this.apiCore.exec(this.callerName,"forceRender");this.stoppedDate=Date.now();return}if(Date.now()-this.stoppedDate<this.minStableDuration){this.apiCore.exec(this.callerName,"showFaceTrackingMask");this.apiCore.exec(this.callerName,"forceRender");return}this.apiCore.exec(this.callerName,
"hideFaceTrackingMask");this.arJustStarted=!1;var d=this.scene.arData.boundingBox.maxX-this.scene.arData.boundingBox.minX,g=1*d/(2*Math.tan(b.s*this.scaleW*this.tanFactor));switch(this.wearableAR.algorithm){case "globalOffsets":var k=(b.x-Math.pow(b.ry*(.8- -b.rx)/.8*.05,1))*this.scaleW,l=b.y*this.scaleW,t=-g;this.apiCore.exec(this.callerName,"setCameraScreenOffsets",-k,l);mat4.identity(this.scene.root.matrix);mat4.translate(this.scene.root.matrix,[0,d/4,t]);mat4.scale(this.scene.root.matrix,[this.wearableAR.size,
this.wearableAR.size,this.wearableAR.size]);mat4.rotateZ(this.scene.root.matrix,-b.rz);mat4.rotateY(this.scene.root.matrix,-b.ry);mat4.rotateX(this.scene.root.matrix,b.rx);mat4.translate(this.scene.root.matrix,[0,this.wearableAR.offsetY,this.wearableAR.offsetZ]);break;default:k=b.x*this.scaleW;l=b.y*this.scaleW;t=-g;this.apiCore.exec(this.callerName,"setCameraScreenOffsets",-k,l);mat4.identity(this.scene.root.matrix);var r=this.wearableAR.offsetZ;0>b.rx&&(r*=1-Math.min(-Math.sin(b.rx)/.6,1),mat4.translate(this.scene.root.matrix,
[0,-Math.sin(b.rx)*(this.bbox.maxY-this.bbox.minY),0]));mat4.translate(this.scene.root.matrix,[0,0,t]);mat4.scale(this.scene.root.matrix,[this.wearableAR.size,this.wearableAR.size,this.wearableAR.size]);mat4.translate(this.scene.root.matrix,[this.bbox.center[0],this.wearableAR.offsetY*this.bbox.yLength,this.bbox.maxZ+r]);mat4.rotateZ(this.scene.root.matrix,-b.rz);mat4.rotateY(this.scene.root.matrix,-b.ry);mat4.rotateX(this.scene.root.matrix,b.rx);mat4.translate(this.scene.root.matrix,[-this.bbox.center[0],
0,-this.bbox.maxZ-r]);mat4.translate(this.scene.root.matrix,[0,-this.bbox.minY,0])}this.scene.recursiveComputeMatrices(this.scene.root,this.identityMatrix);this.scene.updateSceneBoundingBoxesFromRaw();this.scene.updatedBoundingBox=!0;this.scene.forceCameraUpdate=!0;this.apiCore.exec(this.callerName,"forceRender")}catch(H){console.error(H)}this.scene.update()};return d});stage.provide("emersya.viewer.modules.faceTrackingArControlsV2");stage.require("emersya.viewer.modules.API.core");
var toType=function(b){return{}.toString.call(b).match(/\s([a-zA-Z]+)/)[1].toLowerCase()},zPolyCoefs=[-2.905231090019119,-147.3245229260515,-3785.322630374301,-51789.76819564008,-358676.60869705584,-989042.4943269695],rxPolyCoefs=[-.1922605520676231,.2511134166612952,-.009690648207246088,-.007910043209530931,.0015009220354444157,-1.0373939941225874E-4,2.528581643956862E-6],qPolyCoefs_Multi=[1.0959511406722091,.047204452335423426,-.06517574997133849,.045434529173180076,-.0792924425074162,.6184940971857597,
-3.3025475795083945E-5,.24904081014083632,-.02925203441681918,.2219809846736358],qPolyExpos_Multi=[[0,0],[1,0],[0,1],[2,0],[1,1],[0,2],[3,0],[2,1],[1,2],[0,3]];function poly(b,d){for(var u=0,k=0;k<b.length;k++)u+=b[k]*Math.pow(d,k);return u}function multiPoly(b,d,u,k){for(var l=0,g=0;g<b.length;g++)l+=b[g]*Math.pow(u,d[g][0])*Math.pow(k,d[g][1]);return l}
var detectStateStabilization=function(b,d,u,k,l){var g=b.x-d.x,q=b.y-d.y,t=b.z-d.z,r=b.rx-d.rx,f=b.ry-d.ry,n=b.rz-d.rz,B=u[0],w=u[1];u=k[0];k=k[1];var D=l[0],A=l[1];l=D+Math.pow(Math.min(1,Math.max(0,(Math.sqrt(Math.pow(g,2)+Math.pow(q/2,2))-B)/(w-B))),1)*(A-D);B=D+Math.pow(Math.min(1,Math.max(0,(Math.abs(3*t)-B)/(w-B))),1)*(A-D);w=D+Math.pow(Math.min(1,Math.max(0,(Math.sqrt(Math.pow(f,2)+Math.pow(n,2))-u)/(k-u))),1)*(A-D);u=D+Math.pow(Math.min(1,Math.max(0,(Math.abs(r)-u)/(k-u))),1)*(A-D);b.x=d.x+
l*g;b.y=d.y+l*q;b.z=d.z+B*t;b.rx=d.rx+u*r;b.ry=d.ry+w*f;b.rz=d.rz+w*n;return b},checkVideoSize=function(){this.videoElement.width!=this.videoElement.videoWidth&&(this.videoElement.width=this.videoElement.videoWidth);this.videoElement.height!=this.videoElement.videoHeight&&(this.videoElement.height=this.videoElement.videoHeight)},updateFov=function(){var b=this.videoElement.videoWidth,d=this.videoElement.videoHeight,u=b/d,k=this.rendererCanvas.width/this.rendererCanvas.height,l=this.settings.cameraMinVideoDimFov*
this.settings.cameraFovAdjustment*(d>b?1/u:u);k>u&&(l*=1-(d-b/k)/d);this.camera.fov!=l&&(this.camera.fov=l,this.apiCore.exec(this.callerName,"startAnimatingPath",[this.camera]))};
stage.register.call(stage.emersya.viewer.modules,"faceTrackingArControlsV2",function(){var b={cameraMinVideoDimFov:35,cameraFovAdjustment:1/3},d=function(d,k,f){this.apiCore=d;this.settings=stage.extend(!0,b,f);this.scene=k;this.wearableAR=this.scene.wearableAR;this.camera={position:[0,0,0],target:[0,0,-1],up:[0,1,0],fov:0};this.root=this.scene.root;this.bbox=this.scene.arData.boundingBox;this.hiddenRootTranslation=-this.root.boundingBox.minZ;this.identityMatrix=mat4.identity(mat4.create());this.bbox.center||
(this.bbox.center=[this.bbox.minX+(this.bbox.maxX-this.bbox.minX)/2,this.bbox.minY+(this.bbox.maxY-this.bbox.minY)/2,this.bbox.minZ+(this.bbox.maxZ-this.bbox.minZ)/2]);this.bbox.xLength=this.bbox.maxX-this.bbox.minX;this.bbox.yLength=this.bbox.maxY-this.bbox.minY;this.bbox.zLength=this.bbox.maxZ-this.bbox.minZ;this.maxRxStartingAngle=40*Math.PI/180;this.maxRyStartingAngle=40*Math.PI/180;this.maxRzStartingAngle=90*Math.PI/180;this.maxRxGlobalAngle=40*Math.PI/180;this.maxRyGlobalAngle=40*Math.PI/180;
this.maxRzGlobalAngle=90*Math.PI/180;this.minStableDuration=500;this.visiblePolylists=[];for(d=0;d<this.wearableAR.arSpecificPolylists.length;++d)this.scene.polylists[this.wearableAR.arSpecificPolylists[d]]&&this.visiblePolylists.push(this.scene.polylists[this.wearableAR.arSpecificPolylists[d]]);this.hiddenPolylists=[];for(d=0;d<this.wearableAR.arHiddenPolylists.length;++d)this.scene.polylists[this.wearableAR.arHiddenPolylists[d]]&&this.hiddenPolylists.push(this.scene.polylists[this.wearableAR.arHiddenPolylists[d]]);
this.device=this.apiCore.exec(this.callerName,"getDevice");this.callerName=this.name="faceTrackingArControlsV2";this.apiCore.register(this,"resize",g)};d.prototype.destroy=function(){this.apiCore.unregister(this,"resize");return this.stopAR()};d.prototype.updateData=function(){this.arStarted&&(k.call(this),this.apiCore.exec(this.callerName,"rdr.hidePolylists",this.visiblePolylists),this.apiCore.exec(this.callerName,"rdr.showPolylists",this.hiddenPolylists));this.wearableAR=this.scene.wearableAR;this.root=
this.scene.root;this.bbox=this.scene.arData.boundingBox;this.bbox.center||(this.bbox.center=[this.bbox.minX+(this.bbox.maxX-this.bbox.minX)/2,this.bbox.minY+(this.bbox.maxY-this.bbox.minY)/2,this.bbox.minZ+(this.bbox.maxZ-this.bbox.minZ)/2],this.bbox.xLength=this.bbox.maxX-this.bbox.minX,this.bbox.yLength=this.bbox.maxY-this.bbox.minY,this.bbox.zLength=this.bbox.maxZ-this.bbox.minZ);this.maxRxStartingAngle=40*Math.PI/180;this.maxRyStartingAngle=40*Math.PI/180;this.maxRzStartingAngle=90*Math.PI/180;
this.maxRxGlobalAngle=40*Math.PI/180;this.maxRyGlobalAngle=40*Math.PI/180;this.maxRzGlobalAngle=90*Math.PI/180;this.minStableDuration=500;this.visiblePolylists=[];for(var b=0;b<this.wearableAR.arSpecificPolylists.length;++b)this.scene.polylists[this.wearableAR.arSpecificPolylists[b]]&&this.visiblePolylists.push(this.scene.polylists[this.wearableAR.arSpecificPolylists[b]]);this.hiddenPolylists=[];for(b=0;b<this.wearableAR.arHiddenPolylists.length;++b)this.scene.polylists[this.wearableAR.arHiddenPolylists[b]]&&
this.hiddenPolylists.push(this.scene.polylists[this.wearableAR.arHiddenPolylists[b]]);this.arStarted||(u.call(this),this.apiCore.exec(this.callerName,"rdr.showPolylists",this.visiblePolylists),this.apiCore.exec(this.callerName,"rdr.hidePolylists",this.hiddenPolylists))};var u=function(){for(var b=0;b<this.wearableAR.occluderNodes.length;++b){var d=this.scene.sourceNodes[this.wearableAR.occluderNodes[b]],f;for(f in d.duplicatedNodes)for(var g=d.duplicatedNodes[f],k=0;k<g.polylists.length;++k){var l=
g.polylists[k];l.occluder=!0;this.scene.occluders.push(l)}}for(b=0;b<this.scene.polylistInstances.length;++b)this.scene.polylistInstances[b].fadeOut=null;for(b=0;b<this.wearableAR.glassesTemples.length;++b)for(d=this.wearableAR.glassesTemples[b],f=0;f<d.polylists.length;++f)if(k=d.polylists[f],this.scene.polylists[k])for(g=this.scene.polylists[k],k=0;k<g.instances.length;++k){l=g.instances[k];var q=0,u=0;switch(d.fadeOutAxis){case 0:q=g.boundingBox.minX;u=g.boundingBox.maxX;break;case 1:q=g.boundingBox.minY;
u=g.boundingBox.maxY;break;case 2:q=g.boundingBox.minZ,u=g.boundingBox.maxZ}l.fadeOut={axis:d.fadeOutAxis,start:q+d.fadeOutStart*(u-q),end:q+d.fadeOutEnd*(u-q)}}this.apiCore.exec(this.callerName,"rdr.updateSceneMaterials",this.scene);this.apiCore.exec(this.callerName,"rdr.udpateShaders",this.scene)},k=function(){for(var b=0;b<this.wearableAR.occluderNodes.length;++b){var d=this.scene.sourceNodes[this.wearableAR.occluderNodes[b]],f;for(f in d.duplicatedNodes)for(var g=d.duplicatedNodes[f],k=0;k<g.polylists.length;++k){var l=
g.polylists[k];l.occluder=!1;this.scene.occluders.splice(this.scene.occluders.indexOf(l),1)}}for(b=0;b<this.wearableAR.glassesTemples.length;++b)for(d=this.wearableAR.glassesTemples[b],f=0;f<d.polylists.length;++f)if(k=d.polylists[f],this.scene.polylists[k])for(g=this.scene.polylists[k],k=0;k<g.instances.length;++k)l=g.instances[k],l.fadeOut=null;this.apiCore.exec(this.callerName,"rdr.updateSceneMaterials",this.scene);this.apiCore.exec(this.callerName,"rdr.udpateShaders",this.scene)};d.prototype.startAR=
function(b,d){this.running=!0;this.modelHeight=this.root.boundingBox.maxY-this.root.boundingBox.minY;this.arModuleReadyCallback=b;this.arModuleErrorCallback=d;this.stopped=!1;this.apiCore.exec(this.callerName,"rdr.forceUpdate",200);this.rendererCanvas=this.apiCore.exec(this.callerName,"rdr.getWebGLContext").canvas;this.videoElement||(this.apiCore.exec(this.callerName,"createVideoElem"),this.videoElement=this.apiCore.exec(this.callerName,"getVideoElem"),this.videoElement.setAttribute("playsinline",
!0));(function(b){var d=this,f;return $jscomp.asyncExecutePromiseGeneratorProgram(function(g){if(1==g.nextAddress)return d.apiCore.exec(d.callerName,"arVideoStarted"),g.yield(d.apiCore.exec(d.callerName,"arUI.requestCameraStream",d.environmentCamera),2);f=g.yieldResult;if(!d.videoElement)return f&&f.getTracks()[0].stop(),g.return();d.stream=f;d.videoElement.srcObject=d.stream;d.videoElement.onloadedmetadata=stage.setContext(function(){this.videoElement.play();b.call(this)},d);g.jumpToEnd()})}).call(this,
function(){l.call(this,null)})};d.prototype.stopAR=function(){this.running=!1;this.apiCore.exec(this.callerName,"arVideoStopped");this.arWaitingLoader&&(this.arWaitingLoader.remove(),delete this.arWaitingLoader);k.call(this);this.apiCore.exec(this.callerName,"ui.hideBasicLoader");this.apiCore.exec(this.callerName,"resetBackground");this.apiCore.exec(this.callerName,"toggleCameraLock",!1);this.apiCore.exec(this.callerName,"resetCamera");this.apiCore.exec(this.callerName,"setAdaptativeFov",this.scene.scenery.adaptativeFov);
this.apiCore.exec(this.callerName,"rdr.hidePolylists",this.visiblePolylists);this.apiCore.exec(this.callerName,"rdr.showPolylists",this.hiddenPolylists);this.apiCore.exec(this.callerName,"restartRendering");this.apiCore.exec(this.callerName,"hideFaceTrackingMask");this.apiCore.exec(this.callerName,"toggleAnnotations","annotations",!0);this.apiCore.exec(this.callerName,"arUI.setSettings",{forceHideArStartButton:!1});this.apiCore.exec(this.callerName,"showArButton");this.apiCore.exec(this.callerName,
"setCameraScreenOffsets",0,0);var b=this.scene.root;mat4.identity(b.matrix);this.scene.recursiveComputeMatrices(b,b.matrix);this.scene.updateSceneBoundingBoxesFromRaw();this.scene.updatedBoundingBox=!0;this.scene.forceCameraUpdate=!0;this.arStarted=!1;this.videoElement&&(this.apiCore.exec(this.callerName,"arVideoStopped"),this.stream&&(this.device.isIos&&this.stream.getTracks().forEach(function(b){b.stop()}),this.apiCore.exec(this.callerName,"arUI.resetCameraState")),this.apiCore.exec(this.callerName,
"deleteVideoElem"),this.videoElement.pause(),this.videoElement.srcObject&&(this.videoElement.srcObject.getTracks()[0].stop(),this.videoElement.srcObject=null),this.stream&&(this.stream.getTracks()[0].stop(),delete this.stream),this.videoElement.remove(),delete this.videoElement)};var l=function(b){if(b)this.arModuleErrorCallback&&this.arModuleErrorCallback(b);else{this.arStarted=!0;this.videoElement.width=this.rendererCanvas.width;this.videoElement.height=this.rendererCanvas.height;this.apiCore.exec(this.callerName,
"arVideoSettings",{frameRate:0,width:this.videoElement.width,height:this.videoElement.height});u.call(this);this.apiCore.exec(this.callerName,"setAdaptativeFov",!1);this.apiCore.exec(this.callerName,"rdr.setScalingAndHdOnStopMode",0,stage.emersya.viewer.HD_ON_STOP_MODES.OFF,1);this.apiCore.exec(this.callerName,"toggleCameraLock",!0);this.apiCore.exec(this.callerName,"rdr.showPolylists",this.visiblePolylists);this.apiCore.exec(this.callerName,"rdr.hidePolylists",this.hiddenPolylists);this.apiCore.exec(this.callerName,
"stopRendering");this.videoElement.onloadeddata=stage.setContext(function(){g.call(this,this.rendererCanvas.width,this.rendererCanvas.height);this.apiCore.exec(this.callerName,"arUI.toggleArActiveState",!0);this.apiCore.exec(this.callerName,"arVideoStarted");this.apiCore.exec(this.callerName,"rdr.setBackgroundImage",this.videoElement,1,{x:.5,y:.5},1,!0);this.scene.update();q.call(this);this.apiCore.exec(this.callerName,"forceRender");this.arWaitingLoader||(this.arWaitingLoader=stage.emersya.ui.waiting({container:this.rendererCanvas.parentElement,
backgroundColor:"#000000ff",circleColor:"#00b1abff",customKlass:"little-centered"}))},this);this.arJustStarted=!0;this.arModuleReadyCallback&&(this.arModuleReadyCallback(),delete this.arModuleReadyCallback);var d=this.videoElement;b=function(b){checkVideoSize.call(this);updateFov.call(this);this.t2=Date.now();this.arWaitingLoader&&(this.arWaitingLoader.remove(),delete this.arWaitingLoader);if(b.multiFaceLandmarks)if(0==b.multiFaceLandmarks.length)this.apiCore.exec(this.callerName,"rdr.setBackgroundImage",
this.videoElement,1,{x:.5,y:.5},1,!0),this.scene.update(),q.call(this),this.apiCore.exec(this.callerName,"showFaceTrackingMask"),this.apiCore.exec(this.callerName,"forceRender"),this.stoppedDate=Date.now();else if(Date.now()-this.stoppedDate<this.minStableDuration)this.apiCore.exec(this.callerName,"rdr.setBackgroundImage",this.videoElement,1,{x:.5,y:.5},1,!0),this.scene.update(),q.call(this),this.apiCore.exec(this.callerName,"showFaceTrackingMask"),this.apiCore.exec(this.callerName,"forceRender");
else{b=$jscomp.makeIterator(b.multiFaceLandmarks);for(var d=b.next();!d.done;d=b.next()){var f=d.value;d=f[168].x;var g=f[168].y,k=f[4].z,l=this.videoElement.videoWidth/this.videoElement.videoHeight;k*=l/(1280/720);d=2*d-1;g=.9-2*g;var e=this.rendererCanvas,n=e.width/e.height,r=n/l;if(n>l){g*=r;var p=f[263].x;var m=f[263].y*r;var h=f[33].x;var t=f[33].y*r}else d/=r,p=f[263].x/r,m=f[263].y,h=f[33].x/r,t=f[33].y;var u=f[263],J=f[33],M=(t-m)*e.height,T=J.z-u.z,U=Math.sqrt(Math.pow(u.x-J.x,2)+Math.pow(u.y-
J.y,2)+Math.pow(u.z-J.z,2));h=Math.sqrt(Math.pow(e.width*(p-h),2)+Math.pow(e.height*(m-t),2)+Math.pow(u.z-J.z,2));f=poly(rxPolyCoefs,f[10].z/f[2].z);T=Math.asin(-T/U);M=Math.asin(M/h);U=[.01,.035];h=[.02,.15];t=[.2,1];p={x:d,y:g,z:k,rx:f,ry:T,rz:M};this.previousDetectState?(U=detectStateStabilization(p,this.previousDetectState,U,h,t),d=U.x,g=U.y,k=U.z,f=U.rx,T=U.ry,M=U.rz,this.previousDetectState=U):this.previousDetectState=p;-.25<=f&&(f=-.25+.8*(f+.25));T*=1.1;k*=multiPoly(qPolyCoefs_Multi,qPolyExpos_Multi,
f,T);k*=(1+.18*Math.abs(f))*(1-.1*Math.abs(T));k=poly(zPolyCoefs,k);n>l?(g-=.07*k*r,d-=.025*M/k,d-=.008*T/k,g+=.03*f*r/k):(g-=.07*k,d-=.025*M/r/k,d-=.008*T/r/k,g+=.03*f/k);this.detectState=d={x:d,y:g,z:k,rx:f,ry:T,rz:M};a:{try{this.apiCore.exec(this.callerName,"rdr.setBackgroundImage",this.videoElement,1,{x:.5,y:.5},1,!0);if(Math.abs(d.rx)>this.maxRxGlobalAngle||Math.abs(d.ry)>this.maxRyGlobalAngle||Math.abs(d.rz)>this.maxRzGlobalAngle){q.call(this);this.apiCore.exec(this.callerName,"showFaceTrackingMask");
this.apiCore.exec(this.callerName,"forceRender");this.stoppedDate=Date.now();break a}if(this.arJustStarted&&(Math.abs(d.rx)>this.maxRxStartingAngle||Math.abs(d.ry)>this.maxRyStartingAngle||Math.abs(d.rz)>this.maxRzStartingAngle)){q.call(this);this.apiCore.exec(this.callerName,"showFaceTrackingMask");this.apiCore.exec(this.callerName,"forceRender");this.stoppedDate=Date.now();break a}if(Date.now()-this.stoppedDate<this.minStableDuration){this.apiCore.exec(this.callerName,"showFaceTrackingMask");this.apiCore.exec(this.callerName,
"forceRender");break a}this.apiCore.exec(this.callerName,"hideFaceTrackingMask");this.arJustStarted=!1;var R=this.videoElement.videoWidth/this.videoElement.videoHeight;this.adjustedSize=1<=R?this.wearableAR.size*R*720/1280:1*this.wearableAR.size/R*720/1280;this.adjustedSize*=this.settings.cameraFovAdjustment;var aa=d.z;this.apiCore.exec(this.callerName,"setCameraScreenOffsets",-(d.x*this.scaleW),d.y*this.scaleW);this.rootMatrix||(this.rootMatrix=mat4.create());mat4.identity(this.rootMatrix);var C=
this.wearableAR.offsetZ;mat4.translate(this.rootMatrix,[0,0,aa]);var L=this.scene.arData.realSize/this.modelHeight;L*=1.15;mat4.scale(this.rootMatrix,[L,L,L]);mat4.scale(this.rootMatrix,[this.adjustedSize,this.adjustedSize,this.adjustedSize]);mat4.translate(this.rootMatrix,[this.bbox.center[0],0,this.bbox.maxZ+C]);mat4.rotateZ(this.rootMatrix,-d.rz);mat4.rotateY(this.rootMatrix,-d.ry);mat4.rotateX(this.rootMatrix,d.rx);mat4.translate(this.rootMatrix,[-this.bbox.center[0],(this.wearableAR.offsetY-
.4)*this.bbox.yLength,-this.bbox.maxZ-C]);mat4.translate(this.rootMatrix,[0,-this.bbox.minY,0]);this.scene.root.matrix=this.rootMatrix;this.scene.recursiveComputeMatrices(this.scene.root,this.identityMatrix);this.scene.updateSceneBoundingBoxesFromRaw();this.scene.updatedBoundingBox=!0;this.scene.forceCameraUpdate=!0;this.apiCore.exec(this.callerName,"forceRender")}catch(K){console.error(K)}this.scene.update()}}}}.bind(this);var f=new FaceMesh({locateFile:function(b){return"https://cdn.emersya.com/f/vendors/assets/fm/"+
b}});f.setOptions({maxNumFaces:1,minDetectionConfidence:.5,minTrackingConfidence:.5});f.onResults(b);(new Camera(d,{onFrame:function(){return $jscomp.asyncExecutePromiseGeneratorProgram(function(b){return b.yield(f.send({image:d}),0)})},width:1280,height:720})).start()}},g=function(b,d){if(this.arStarted){var f=b/d,g=this.videoElement.videoWidth,k=this.videoElement.videoHeight;this.videoElement.width=g;this.videoElement.height=k;var l=g/k;var q=f>l?b/g:d/k;this.scaleW=f>l?b/(g*q):d/(k*q);this.scaleW=
1/this.scaleW;b=this.settings.cameraMinVideoDimFov*this.settings.cameraFovAdjustment*(k>g?1/l:l);f>l&&(b*=1-(k-g/f)/k);this.camera.fov=b;this.rhtkmtu=f;this.apiCore.exec(this.callerName,"startAnimatingPath",[this.camera])}},q=function(){this.rootMatrix||(this.rootMatrix=mat4.create());mat4.identity(this.rootMatrix);mat4.translate(this.rootMatrix,[0,0,this.hiddenRootTranslation]);this.scene.recursiveComputeMatrices(this.scene.root,this.rootMatrix)};return d});stage.provide("emersya.viewer.modules.shoeTrackingArControls");
stage.require("emersya.viewer.modules.API.core");toType=function(b){return{}.toString.call(b).match(/\s([a-zA-Z]+)/)[1].toLowerCase()};
var vykingStabilization=function(b,d){var u=b.x-d.x,k=b.y-d.y,l=b.z-d.z,g=b.rx-d.rx,q=b.ry-d.ry,t=b.rz-d.rz,r=this.vykingTranslationFactorRange[0];var f=Math.min(1,Math.max(0,(Math.sqrt(Math.pow(u,2)+Math.pow(k,2)+Math.pow(l,2))-r)/(this.vykingTranslationFactorRange[1]-r)));r=this.vykingRotationFactorRange[0];var n=Math.min(1,Math.max(0,(Math.sqrt(Math.pow(g,2)+Math.pow(q,2)+Math.pow(t,2))-r)/(this.vykingRotationFactorRange[1]-r)));var B=this.vykingAlphaRange[0],w=this.vykingAlphaRange[1];r=B+Math.pow(f,
1)*(w-B);f=B+Math.pow(f,1)*(w-B);var D=B+Math.pow(n,1)*(w-B);n=B+Math.pow(n,1)*(w-B);b.x=d.x+r*u;b.y=d.y+r*k;b.z=d.z+f*l;b.rx=d.rx+n*g;b.ry=d.ry+D*q;b.rz=d.rz+D*t;return b};checkVideoSize=function(){this.videoElement.width!=this.videoElement.videoWidth&&(this.videoElement.width=this.videoElement.videoWidth);this.videoElement.height!=this.videoElement.videoHeight&&(this.videoElement.height=this.videoElement.videoHeight)};
updateFov=function(){var b=this.videoElement.videoWidth,d=this.videoElement.videoHeight,u=b/d,k=this.rendererCanvas.width/this.rendererCanvas.height,l=this.settings.cameraMinVideoDimFov*this.settings.cameraFovAdjustment*(d>b?1/u:u);k>u&&(l*=1-(d-b/k)/d);this.camera.fov!=l&&(this.camera.fov=l,this.apiCore.exec(this.callerName,"startAnimatingPath",[this.camera]))};
stage.register.call(stage.emersya.viewer.modules,"shoeTrackingArControls",function(){var b={cameraMinVideoDimFov:35,cameraFovAdjustment:1/3},d=function(b){return Array.isArray(b)&&0==b.length},u=function(d,g,e){this.apiCore=d;this.settings=stage.extend(!0,b,e);this.scene=g;this.wearableAR=this.scene.wearableAR;this.camera={position:[0,0,0],target:[0,0,-1],up:[0,1,0],fov:0};this.root=this.scene.root;this.bbox=this.scene.arData.boundingBox;this.hiddenRootTranslation=-this.root.boundingBox.minZ;this.identityMatrix=
mat4.identity(mat4.create());this.bbox.center||(this.bbox.center=[this.bbox.minX+(this.bbox.maxX-this.bbox.minX)/2,this.bbox.minY+(this.bbox.maxY-this.bbox.minY)/2,this.bbox.minZ+(this.bbox.maxZ-this.bbox.minZ)/2]);this.bbox.xLength=this.bbox.maxX-this.bbox.minX;this.bbox.yLength=this.bbox.maxY-this.bbox.minY;this.bbox.zLength=this.bbox.maxZ-this.bbox.minZ;this.maxRxStartingAngle=40*Math.PI/180;this.maxRyStartingAngle=40*Math.PI/180;this.maxRzStartingAngle=90*Math.PI/180;this.maxRxGlobalAngle=40*
Math.PI/180;this.maxRyGlobalAngle=40*Math.PI/180;this.maxRzGlobalAngle=90*Math.PI/180;this.vykingMaxRzGlobalAngle=20*Math.PI/180;this.minFaceScaling=.18;this.minStableDuration=500;this.visiblePolylists=[];for(d=0;d<this.wearableAR.arSpecificPolylists.length;++d)this.scene.polylists[this.wearableAR.arSpecificPolylists[d]]&&this.visiblePolylists.push(this.scene.polylists[this.wearableAR.arSpecificPolylists[d]]);this.hiddenPolylists=[];for(d=0;d<this.wearableAR.arHiddenPolylists.length;++d)this.scene.polylists[this.wearableAR.arHiddenPolylists[d]]&&
this.hiddenPolylists.push(this.scene.polylists[this.wearableAR.arHiddenPolylists[d]]);this.device=this.apiCore.exec(this.callerName,"getDevice");this.callerName=this.name="shoeTrackingArControls";this.apiCore.register(this,"resize",f)};u.prototype.destroy=function(){this.apiCore.unregister(this,"resize");return this.stopAR()};u.prototype.updateData=function(){this.arStarted&&(l.call(this),this.apiCore.exec(this.callerName,"rdr.hidePolylists",this.visiblePolylists),this.apiCore.exec(this.callerName,
"rdr.showPolylists",this.hiddenPolylists));this.wearableAR=this.scene.wearableAR;this.root=this.scene.root;this.bbox=this.scene.arData.boundingBox;this.bbox.center||(this.bbox.center=[this.bbox.minX+(this.bbox.maxX-this.bbox.minX)/2,this.bbox.minY+(this.bbox.maxY-this.bbox.minY)/2,this.bbox.minZ+(this.bbox.maxZ-this.bbox.minZ)/2],this.bbox.xLength=this.bbox.maxX-this.bbox.minX,this.bbox.yLength=this.bbox.maxY-this.bbox.minY,this.bbox.zLength=this.bbox.maxZ-this.bbox.minZ);this.maxRxStartingAngle=
40*Math.PI/180;this.maxRyStartingAngle=40*Math.PI/180;this.maxRzStartingAngle=90*Math.PI/180;this.maxRxGlobalAngle=40*Math.PI/180;this.maxRyGlobalAngle=40*Math.PI/180;this.maxRzGlobalAngle=90*Math.PI/180;this.minFaceScaling=.18;this.minStableDuration=500;this.visiblePolylists=[];for(var b=0;b<this.wearableAR.arSpecificPolylists.length;++b)this.scene.polylists[this.wearableAR.arSpecificPolylists[b]]&&this.visiblePolylists.push(this.scene.polylists[this.wearableAR.arSpecificPolylists[b]]);this.hiddenPolylists=
[];for(b=0;b<this.wearableAR.arHiddenPolylists.length;++b)this.scene.polylists[this.wearableAR.arHiddenPolylists[b]]&&this.hiddenPolylists.push(this.scene.polylists[this.wearableAR.arHiddenPolylists[b]]);this.arStarted||(k.call(this),this.apiCore.exec(this.callerName,"rdr.showPolylists",this.visiblePolylists),this.apiCore.exec(this.callerName,"rdr.hidePolylists",this.hiddenPolylists))};var k=function(){for(var b=0;b<this.wearableAR.occluderNodes.length;++b){var d=this.scene.sourceNodes[this.wearableAR.occluderNodes[b]],
e;for(e in d.duplicatedNodes)for(var f=d.duplicatedNodes[e],g=0;g<f.polylists.length;++g){var k=f.polylists[g];k.occluder=!0;this.scene.occluders.push(k)}}for(b=0;b<this.scene.polylistInstances.length;++b)this.scene.polylistInstances[b].fadeOut=null;for(b=0;b<this.wearableAR.glassesTemples.length;++b)for(d=this.wearableAR.glassesTemples[b],e=0;e<d.polylists.length;++e)if(g=d.polylists[e],this.scene.polylists[g])for(f=this.scene.polylists[g],g=0;g<f.instances.length;++g){k=f.instances[g];var l=0,h=
0;switch(d.fadeOutAxis){case 0:l=f.boundingBox.minX;h=f.boundingBox.maxX;break;case 1:l=f.boundingBox.minY;h=f.boundingBox.maxY;break;case 2:l=f.boundingBox.minZ,h=f.boundingBox.maxZ}k.occluder=!0;this.scene.occluders.push(k);k.fadeOut={axis:d.fadeOutAxis,start:l+d.fadeOutStart*(h-l),end:l+d.fadeOutEnd*(h-l)}}this.apiCore.exec(this.callerName,"rdr.updateSceneMaterials",this.scene);this.apiCore.exec(this.callerName,"rdr.udpateShaders",this.scene)},l=function(){for(var b=0;b<this.wearableAR.occluderNodes.length;++b){var d=
this.scene.sourceNodes[this.wearableAR.occluderNodes[b]],e;for(e in d.duplicatedNodes)for(var f=d.duplicatedNodes[e],g=0;g<f.polylists.length;++g){var k=f.polylists[g];k.occluder=!1;this.scene.occluders.splice(this.scene.occluders.indexOf(k),1)}}for(b=0;b<this.wearableAR.glassesTemples.length;++b)for(d=this.wearableAR.glassesTemples[b],e=0;e<d.polylists.length;++e)if(g=d.polylists[e],this.scene.polylists[g])for(f=this.scene.polylists[g],g=0;g<f.instances.length;++g)k=f.instances[g],k.occluder=!1,
k.fadeOut=null,this.scene.occluders.splice(this.scene.occluders.indexOf(k),1);this.apiCore.exec(this.callerName,"rdr.updateSceneMaterials",this.scene);this.apiCore.exec(this.callerName,"rdr.udpateShaders",this.scene)},g=function(){this.configKey="com.emersya";this.configPromise=function(b){var d;return $jscomp.asyncExecutePromiseGeneratorProgram(function(e){if(1==e.nextAddress)return e.yield(fetch(encodeURI(b),{method:"GET",cache:"no-cache"}),2);d=e.yieldResult;if(!d.ok)throw Error("Failed to load configuration from "+
b+". Status: "+d.status);return e.return(d.arrayBuffer())})}("https://cdn.emersya.com/f/vendors/js/8dc65b9d25dcaea/27jqcmnkh5tettb.bin")},q=function(b,d){if(b.id==d)return b;for(var e,f=0;f<b.children.length&&(e=q(b.children[f],d),void 0==e);f++);return e},t=function(b){return null==b?mat4.identity(mat4.create()):mat4.multiply(t(b.parent),b.matrix)};u.prototype.startAR=function(b,d){this.running=!0;g.call(this);this.device.isMobile?(this.vykingArStoppedEvent||(this.vykingArStoppedEvent=new Event("vykingArStop")),
this.vykingArStoppedEvent.arStopped=!1,document.dispatchEvent(this.vykingArStoppedEvent),this.leftShoeParentMatrix||(this.leftShoeParentMatrix=mat4.create()),this.rightShoeParentMatrix||(this.rightShoeParentMatrix=mat4.create()),void 0!=this.wearableAR.leftShoeNode.id&&(this.leftShoeNode=q(this.scene.root,this.wearableAR.leftShoeNode.id),void 0!=this.leftShoeNode&&(this.leftShoeParentMatrix=t(this.leftShoeNode.parent),mat4.inverse(this.leftShoeParentMatrix))),void 0!=this.wearableAR.rightShoeNode.id&&
(this.rightShoeNode=q(this.scene.root,this.wearableAR.rightShoeNode.id),void 0!=this.rightShoeNode&&(this.rightShoeParentMatrix=t(this.rightShoeNode.parent),mat4.inverse(this.rightShoeParentMatrix))),w.call(this)&&!this.leftFootBaseMat&&(this.leftFootBaseMat=mat4.create(this.leftShoeNode.matrix)),D.call(this)&&!this.rightFootBaseMat&&(this.rightFootBaseMat=mat4.create(this.rightShoeNode.matrix)),this.environmentCamera=!0,this.scene.enableArOccluder=!0,this.modelHeight=this.root.boundingBox.maxY-this.root.boundingBox.minY,
this.arModuleReadyCallback=b,this.arModuleErrorCallback=d,this.stopped=!1,this.apiCore.exec(this.callerName,"rdr.forceUpdate",200),this.rendererCanvas=this.apiCore.exec(this.callerName,"rdr.getWebGLContext").canvas,this.videoElement||(this.apiCore.exec(this.callerName,"createVideoElem"),this.videoElement=this.apiCore.exec(this.callerName,"getVideoElem"),this.videoElement.setAttribute("playsinline",!0)),function(b){var d=this,e;return $jscomp.asyncExecutePromiseGeneratorProgram(function(f){if(1==f.nextAddress)return d.apiCore.exec(d.callerName,
"arVideoStarted"),f.yield(d.apiCore.exec(d.callerName,"arUI.requestCameraStream",d.environmentCamera),2);e=f.yieldResult;d.stream=e;d.videoElement.srcObject=d.stream;d.videoElement.onloadedmetadata=stage.setContext(function(){this.videoElement.play();b.call(this)},d);f.jumpToEnd()})}.call(this,function(){r.call(this,null)})):(this.running=!1,this.apiCore.exec(this.callerName,"arUI.showLoader"),b=stage.setContext(function(b){this.apiCore.exec(this.callerName,"arUI.hideLoader",b);this.apiCore.exec(this.callerName,
"hideArMessageScreen");this.apiCore.exec(this.callerName,"arUI.displayQRCode",b)},this),this.apiCore.exec(this.callerName,"getEmersyaArLink",b))};u.prototype.stopAR=function(){this.running=!1;this.vykingArStoppedEvent||(this.vykingArStoppedEvent=new Event("vykingArStop"));this.vykingArStoppedEvent.arStopped=!0;document.dispatchEvent(this.vykingArStoppedEvent);this.scene.enableArOccluder=!1;w.call(this)&&this.leftFootBaseMat&&this.leftShoeNode&&(this.leftShoeNode.matrix=this.leftFootBaseMat);D.call(this)&&
this.rightFootBaseMat&&this.rightShoeNode&&(this.rightShoeNode.matrix=this.rightFootBaseMat);this.arWaitingLoader&&(this.arWaitingLoader.remove(),delete this.arWaitingLoader);this.apiCore.exec(this.callerName,"arVideoStopped");l.call(this);this.apiCore.exec(this.callerName,"ui.hideBasicLoader");this.apiCore.exec(this.callerName,"resetBackground");this.apiCore.exec(this.callerName,"toggleCameraLock",!1);this.apiCore.exec(this.callerName,"resetCamera");this.apiCore.exec(this.callerName,"setAdaptativeFov",
this.scene.scenery.adaptativeFov);this.apiCore.exec(this.callerName,"rdr.hidePolylists",this.visiblePolylists);this.apiCore.exec(this.callerName,"rdr.showPolylists",this.hiddenPolylists);this.apiCore.exec(this.callerName,"hideFaceTrackingMask");this.apiCore.exec(this.callerName,"toggleAnnotations","annotations",!0);this.apiCore.exec(this.callerName,"arUI.setSettings",{forceHideArStartButton:!1});this.apiCore.exec(this.callerName,"showArButton");var b=this.scene.root;mat4.identity(b.matrix);this.scene.recursiveComputeMatrices(b,
b.matrix);this.scene.updateSceneBoundingBoxesFromRaw();this.scene.updatedBoundingBox=!0;this.scene.forceCameraUpdate=!0;this.arStarted=!1;this.videoElement&&(this.stream&&(this.device.isIos&&this.stream.getTracks().forEach(function(b){b.stop()}),this.apiCore.exec(this.callerName,"arUI.resetCameraState")),this.apiCore.exec(this.callerName,"deleteVideoElem"),this.videoElement.pause(),this.videoElement.srcObject&&(this.videoElement.srcObject.getTracks()[0].stop(),this.videoElement.srcObject=null),this.stream&&
(this.stream.getTracks()[0].stop(),delete this.stream),this.videoElement.remove(),delete this.videoElement)};var r=function(b){if(b)this.arModuleErrorCallback&&this.arModuleErrorCallback(b);else{this.arStarted=!0;this.videoElement.width=this.rendererCanvas.width;this.videoElement.height=this.rendererCanvas.height;this.apiCore.exec(this.callerName,"arVideoSettings",{frameRate:0,width:this.videoElement.width,height:this.videoElement.height});k.call(this);this.apiCore.exec(this.callerName,"setAdaptativeFov",
!1);this.apiCore.exec(this.callerName,"rdr.setScalingAndHdOnStopMode",0,stage.emersya.viewer.HD_ON_STOP_MODES.OFF,1);this.apiCore.exec(this.callerName,"toggleCameraLock",!0);this.apiCore.exec(this.callerName,"rdr.showPolylists",this.visiblePolylists);this.apiCore.exec(this.callerName,"rdr.hidePolylists",this.hiddenPolylists);this.apiCore.exec(this.callerName,"arUI.toggleArActiveState",!0);this.apiCore.exec(this.callerName,"arVideoStarted");this.videoElement.onloadeddata=stage.setContext(function(){f.call(this,
this.rendererCanvas.width,this.rendererCanvas.height);this.apiCore.exec(this.callerName,"rdr.setBackgroundImage",this.videoElement,1,{x:.5,y:.5},1,!1);this.scene.update();n.call(this);this.apiCore.exec(this.callerName,"forceUpdate",1);this.shoeBackgroundTextureBuffer||(this.shoeBackgroundTextureBuffer=[]);this.arWaitingLoader||(this.arWaitingLoader=stage.emersya.ui.waiting({container:this.rendererCanvas.parentElement,backgroundColor:"#000000ff",circleColor:"#00b1abff",customKlass:"little-centered"}))},
this);this.arJustStarted=!0;this.arModuleReadyCallback&&(this.arModuleReadyCallback(),delete this.arModuleReadyCallback);var d=this.videoElement;(function(){var b=this;window.vykingMain?(this.firstInitTime=Date.now(),this.firstCallback=!0,window.vykingMain.call(this,this.configPromise,this.configKey,d),this.vykingEventListenerCreated||(document.addEventListener("vyking",function(d){if(b.running){d=d.vykingResult;var e={};b.scene.arData.vykingData&&(e.previousOcclusionMaskTexture=b.scene.arData.vykingData.occlusionMaskTexture);
e.occlusionMaskTexture=d.imageData.mask.data;e.rotationAngle=d.rotationAngle;e.occlusionMaskWidth=128;e.occlusionMaskHeight=160;b.scene.arData.vykingData=e;var f=d.body.footLeft,g=d.body.footRight;f.isDetected&&(e=f.transform,b.matrixFootLeft=mat4.create(e));g.isDetected&&(e=g.transform,b.matrixFootRight=mat4.create(e));a:{e=b.matrixFootLeft;var h=b.matrixFootRight;f=f.isDetected;g=g.isDetected;d=d.rotationAngle;try{checkVideoSize.call(b);updateFov.call(b);b.apiCore.exec(b.callerName,"rdr.setBackgroundImage",
b.videoElement,1,{x:.5,y:.5},1,!1);b.scene.update();b.arWaitingLoader&&(b.arWaitingLoader.remove(),delete b.arWaitingLoader);if(w.call(b)&&D.call(b)&&!g&&!f||w.call(b)&&!D.call(b)&&!f||!w.call(b)&&!g){n.call(b);b.apiCore.exec(b.callerName,"forceUpdate",1);b.stoppedDate=Date.now();break a}b.apiCore.exec(b.callerName,"hideFaceTrackingMask");b.arJustStarted=!1;b.adjustedSize=b.wearableAR.size;b.adjustedSize*=b.settings.cameraFovAdjustment;b.rootMatrix||(b.rootMatrix=mat4.create());mat4.identity(b.rootMatrix);
mat4.translate(b.rootMatrix,[0,-.1,0]);var k=3*b.scene.arData.realSize/b.modelHeight;b.vykingSceneMatrix||(b.vykingSceneMatrix=mat4.create(b.scene.root.children[0].matrix));w.call(b)&&(f?(e=B.call(b,e,!1,f,d),mat4.multiply(e,b.vykingSceneMatrix,e),mat4.multiply(b.rootMatrix,e,e),mat4.multiply(b.leftShoeParentMatrix,e,e),mat4.scale(e,[k,k,k]),mat4.scale(e,[b.adjustedSize,b.adjustedSize,b.adjustedSize]),b.leftShoeNode.matrix=e):(mat4.identity(b.leftShoeNode.matrix),mat4.translate(b.leftShoeNode.matrix,
[0,0,-b.root.boundingBox.minZ])));D.call(b)&&(g?(h=B.call(b,h,!0,g,d),mat4.multiply(h,b.vykingSceneMatrix,h),mat4.multiply(b.rootMatrix,h,h),mat4.multiply(b.rightShoeParentMatrix,h,h),mat4.scale(h,[k,k,k]),mat4.scale(h,[b.adjustedSize,b.adjustedSize,b.adjustedSize]),b.rightShoeNode.matrix=h):(mat4.identity(b.rightShoeNode.matrix),mat4.translate(b.rightShoeNode.matrix,[0,0,-b.root.boundingBox.minZ])));w.call(b)||D.call(b)||(g?(h=B.call(b,h,!0,g,d),mat4.multiply(b.rootMatrix,h,h),mat4.scale(h,[k,k,
k]),mat4.scale(h,[b.adjustedSize,b.adjustedSize,b.adjustedSize]),b.scene.root.matrix=h):n.call(b));b.scene.recursiveComputeMatrices(b.scene.root,b.identityMatrix);b.scene.updateSceneBoundingBoxesFromRaw();b.scene.updatedBoundingBox=!0;b.scene.forceCameraUpdate=!0;b.apiCore.exec(b.callerName,"forceUpdate",1)}catch(I){console.error(I)}++b.scene.needsUpdate}}},!1),this.vykingEventListenerCreated=!0)):(this.apiCore.exec(this.callerName,"stopAr"),this.apiCore.exec(this.callerName,"showShoeArUnavailableMessage"))}).call(this)}},
f=function(b,d){if(this.arStarted){var e=b/d,f=this.videoElement.videoWidth,g=this.videoElement.videoHeight;this.videoElement.width=f;this.videoElement.height=g;var k=f/g;var l=e>k?b/f:d/g;this.scaleW=e>k?b/(f*l):d/(g*l);this.scaleW=1/this.scaleW;b=this.settings.cameraMinVideoDimFov*this.settings.cameraFovAdjustment*(g>f?1/k:k);e>k&&(b*=1-(g-f/e)/g);this.camera.fov=b;this.rhtkmtu=e;this.apiCore.exec(this.callerName,"startAnimatingPath",[this.camera])}},n=function(){this.rootMatrix||(this.rootMatrix=
mat4.create());mat4.identity(this.rootMatrix);mat4.translate(this.rootMatrix,[-this.root.boundingBox.minX,-this.root.boundingBox.minY,-this.root.boundingBox.minZ]);this.scene.recursiveComputeMatrices(this.scene.root,this.rootMatrix)},B=function(b,d,e,f){if(e){e=mat4.create(b);var g=[e[12],e[13],e[14]],k=e[15]*Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)),l=e[15]*Math.sqrt(Math.pow(e[4],2)+Math.pow(e[5],2)+Math.pow(e[6],2)),h=e[15]*Math.sqrt(Math.pow(e[8],2)+Math.pow(e[9],2)+Math.pow(e[10],
2));var n=[k,l,h];0!=k&&(e[0]/=k,e[1]/=k,e[2]/=k);0!=l&&(e[4]/=l,e[5]/=l,e[6]/=l);0!=h&&(e[8]/=h,e[9]/=h,e[10]/=h);e[15]=1;k=[e[0],e[1],e[2]];l=[e[4],e[5],e[6]];k=[k[1]*l[2]-k[2]*l[1],k[2]*l[0]-k[0]*l[2],k[0]*l[1]-k[1]*l[0]];l=[e[8],e[9],e[10]];0>k[0]*l[0]+k[1]*l[1]+k[2]*l[2]&&(e[0]*=-1,e[1]*=-1,e[2]*=-1);k=Math.atan2(e[6],e[10]);l=Math.sin(k);h=Math.cos(k);n=[g,[-k,-Math.atan2(-e[2],Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2))),-Math.atan2(l*e[8]-h*e[4],h*e[5]-l*e[9])],n];e=n[0];g=n[1];n=n[2];k=
this.videoElement.width/this.videoElement.height;e[2]=1<=k?e[2]*Math.pow(1920/1080/k,2):e[2]*Math.pow(1920/1080*k,4);g={x:e[0],y:e[1],z:e[2],rx:g[0],ry:g[1],rz:g[2],sx:n[0],sy:n[1],sz:n[2]};this.previousVykingDetectState||(this.previousVykingDetectState=g);d?this.rightShoePreviousDetectState=g:this.leftShoePreviousDetectState=g}else d?this.rightShoePreviousDetectState&&(g=this.rightShoePreviousDetectState):this.leftShoePreviousDetectState&&(g=this.leftShoePreviousDetectState);mat4.identity(b);mat4.rotateZ(b,
f-Math.PI/2);mat4.translate(b,[.9*g.y,.9*g.x,-g.z]);mat4.rotateX(b,Math.PI/2+g.rx);mat4.rotateY(b,-Math.PI/2-g.rz);mat4.rotateZ(b,Math.PI+g.ry);mat4.translate(b,[0,0,.05]);mat4.translate(b,[-.1*Math.sin(f+g.rz),0,.1*(Math.cos(f+g.rz)+1.2)]);d?mat4.translate(b,[this.wearableAR.offsetX,this.wearableAR.offsetY,this.wearableAR.offsetZ]):mat4.translate(b,[-this.wearableAR.offsetX,this.wearableAR.offsetY,this.wearableAR.offsetZ]);return b},w=function(){return void 0!=this.leftShoeNode&&!d(this.leftShoeNode)},
D=function(){return void 0!=this.rightShoeNode&&!d(this.rightShoeNode)};return u});stage.provide("emersya.viewer.modules.arUI");var toImageType={0:"fit",1:"maximize",2:"strech"};
stage.register.call(stage.emersya.viewer.modules,"arUI",function(){function b(b){var d=this;b=void 0===b?null:b;null==b&&(b=Object.keys(this.translatedDomElements));var e=[],f=this.apiCore.exec(this.callerName,"isCurrentLocaleRightToLeft");b.filter(function(b){return d.translatedDomElements[b]}).forEach(function(b){if(d.translatedDomElements[b].container){var g=d.apiCore.exec(d.callerName,"translate",d.translatedDomElements[b].value,d.translatedDomElements[b].category);!g&&d.translatedDomElements[b].defaultValue&&
(g=d.translatedDomElements[b].defaultValue);d.translatedDomElements[b].textDecoration&&(g=d.translatedDomElements[b].textDecoration(g));d.translatedDomElements[b].container.innerHTML=g;$$stage(d.translatedDomElements[b].container).css({direction:f?"rtl":"ltr"});if(d.translatedDomElements[b].onUpdated)d.translatedDomElements[b].onUpdated(d.translatedDomElements[b].container);d.translatedDomElements[b].onAllTranslationsDone&&e.push(d.translatedDomElements[b].onAllTranslationsDone)}});e.forEach(function(b){return b()})}
var d={mainColor:"#00B1AB",minHeight:100,maxHeight:220,thirdColor:null,mouseSpeed:.5,secondColor:"#ffffff",defaultHeight:170,displayPresetMenu:!1,displayArMenu:!0,displayArStartButton:!0,forceHideArStartButton:!1,displayAnimationMenu:!1,shareOnSocialNetwork:!1,displayDownloadRenderButton:!1,serverURL:"",routing:"",arType:"default",arBackgroundLandscapeImageType:0,arBackgroundLandscapeImagePath:"",arBackgroundPortraitImageType:0,arBackgroundPortraitImagePath:"",arSimplifiedMode:!1,enableCustomPrivacyPolicyMessage:!1,
customEmersyaPrivacyPolicyMessageNotTranslated:"",customWearablePrivacyPolicyMessageNotTranslated:"",customPrivacyPolicyValidationMessageNotTranslated:"",aRDefaultQRCodeStartingScreen:!0},u=function(b,f,g,h){this.apiCore=b;this.iframeApi=f;navigator.cookieEnabled&&stage.readCookie("emersyaArSize")&&(d.defaultHeight=stage.readCookie("emersyaArSize"));this.settings=stage.extend(!0,{},d,h);this.delay=null;this.deltaT=0;this.rotating=!1;this.videoElem=this.arCanvas=null;this.translating=this.fullscreen=
this.photoTaken=!1;this.actualArSize=this.photoCanvas=null;this.previousWidth=g.getWH().width;this.parentElement=g;this.previousHeight=g.getWH().height;this.helperContainer=null;this.interactionType="rotate";this.shareArButtonContainer=this.arButtonContainer=null;this.presetsContainerVisible=!1;this.arSizeSelectionContainer=null;this.arActive=this.animationsContainerVisible=!1;this.cameraAccessStateEnum=Object.freeze({UNASKED:0,PENDING:1,GRANTED:2,DENIED:3,ERROR:4});this.cameraAccessState=this.cameraAccessStateEnum.UNASKED;
k.call(this);this.device=this.apiCore.exec(this.callerName,"getDevice");this.browser=this.apiCore.exec(this.callerName,"getBrowser");this.fullIcons=stage.emersya.ui.svgIcon(null,this.settings).getArUiIcons();this.apiCore.exec(this.callerName,"lib.isColorDark",this.settings.mainColor.substring(0,7))?this.settings.thirdColor=this.apiCore.exec(this.callerName,"lib.getClearestColor",this.settings.mainColor.substring(0,7),.25):this.settings.thirdColor=this.apiCore.exec(this.callerName,"lib.getDarkestColor",
this.settings.mainColor.substring(0,7),.25);this.rgba=this.apiCore.exec(this.callerName,"lib.hexToRgba",this.settings.secondColor.substring(0,7)+"99");this.rgbaMainColor=this.apiCore.exec(this.callerName,"lib.hexToRgba",this.settings.mainColor.substring(0,7)+"dd");this.apiCore.exec(this.callerName,"lib.setStyle",{thirdColor:this.settings.thirdColor,mainArColor:this.settings.mainColor,secondArColor:this.settings.secondColor});(b=document.querySelector('meta[name="viewport"]'))&&b.setAttribute("content",
"width=device-width, , height=device-height, initial-scale=1.0, maximum-scale=1.0, user-scalable=0");this.translatedDomElements={};skel=[{tagName:"div",attributes:{klass:"camera "},childs:[{tagName:"canvas",attributes:{id:"emersyaPhoto"}}]},{tagName:"div",attributes:{klass:"canvas"},childs:[{tagName:"canvas",attributes:{id:"emersyaCanvas"}}]}];$$stage(this.parentElement.get(0).parentElement.parentElement).build(skel);this.arCamera=$$stage(this.parentElement.get(0).parentElement.parentElement).find(".camera");
this.arCanvas=$$stage(this.parentElement.get(0).parentElement.parentElement).find("#emersyaCanvas");this.photoCanvas=$$stage(this.parentElement.get(0).parentElement.parentElement).find("#emersyaPhoto");L.call(this);"wearable"===this.settings.arType?S.call(this):G.call(this);ia.call(this);I.call(this);this.arInteractionSelectionButton?this.showArInteractionSelectionButton():(skel=[{tagName:"div",returnActive:!0,attributes:{klass:"arInteractionSelectionButtonContainer",style:{"-moz-box-shadow":"0 0 6px rgba("+
this.rgba.r+","+this.rgba.g+","+this.rgba.b+","+this.rgba.a/255+")","-webkit-box-shadow":"0 0 6px rgba("+this.rgba.r+","+this.rgba.g+","+this.rgba.b+","+this.rgba.a/255+")","box-shadow":"0 0 6px rgba("+this.rgba.r+","+this.rgba.g+","+this.rgba.b+","+this.rgba.a/255+")"}},childs:[{tagName:"div",attributes:{klass:"arInteractionButtonIcon"}},{tagName:"div",attributes:{klass:"arInteractionRotateButtonIcon"}},{tagName:"div",attributes:{klass:"arInteractionMoveButtonIcon"}}],events:[{onEvent:"touchstart",
callback:stage.setContext(p,this)},{onEvent:"mousedown",callback:stage.setContext(p,this)},{onEvent:"touchend",callback:stage.setContext(m,this)},{onEvent:"mouseup",callback:stage.setContext(m,this)},{onEvent:"mouseout",callback:stage.setContext(m,this)},{onEvent:"mousemove",callback:stage.setContext(F,this)},{onEvent:"touchmove",callback:stage.setContext(F,this)}]}],this.arInteractionSelectionButton=this.parentElement.build(skel),this.arInteractionButtonIcon=this.arInteractionSelectionButton.find(".arInteractionButtonIcon"),
this.arInteractionMoveButtonIcon=this.arInteractionSelectionButton.find(".arInteractionMoveButtonIcon"),this.arInteractionRotateButtonIcon=this.arInteractionSelectionButton.find(".arInteractionRotateButtonIcon"),this.arInteractionMoveButtonIcon.css("opacity",.4),this.apiCore.exec(this.callerName,"lib.insertSvg",this.fullIcons.arRotateButtonIcon,{}),this.apiCore.exec(this.callerName,"lib.insertSvg",this.fullIcons.arMoveButtonIcon,{}),this.hideArInteractionSelectionButton());E.call(this);H.call(this);
stage.emersya.viewer.modules.faceTrackingArControlsV1&&(this.faceTrackingMaskContainer?this.showFaceTrackingMask():(skel=[{tagName:"div",returnActive:!0,attributes:{klass:"faceTrackingMaskContainer"},childs:[{tagName:"div",attributes:{klass:"faceTrackingMaskTopPart"}},{tagName:"div",attributes:{klass:"faceTrackingMaskLeftPart"}},{tagName:"div",attributes:{klass:"faceTrackingMaskMiddlePart"}},{tagName:"div",attributes:{klass:"faceTrackingMaskRightPart"}},{tagName:"div",attributes:{klass:"faceTrackingMaskBottomPart"}}]}],
this.faceTrackingMaskContainer=this.parentElement.build(skel),this.faceTrackingMaskTopPart=this.faceTrackingMaskContainer.find(".faceTrackingMaskTopPart"),this.faceTrackingMaskBottomPart=this.faceTrackingMaskContainer.find(".faceTrackingMaskBottomPart"),this.faceTrackingMaskLeftPart=this.faceTrackingMaskContainer.find(".faceTrackingMaskLeftPart"),this.faceTrackingMaskRightPart=this.faceTrackingMaskContainer.find(".faceTrackingMaskRightPart"),this.faceTrackingMaskMiddlePart=this.faceTrackingMaskContainer.find(".faceTrackingMaskMiddlePart"),
e.call(this,this.previousWidth,this.previousHeight),this.hideFaceTrackingMask()));this.apiCore.exec(this.callerName,"domChange")};u.prototype.destroy=function(){this.apiCore.unregister(this,"resize");this.apiCore.unregister(this,"localeChanged");this.apiCore.unregister(this,"arUI.setDelay");this.apiCore.unregister(this,"arUI.setPhotoTaken");this.apiCore.unregister(this,"arUI.requestCameraStream");this.apiCore.unregister(this,"arUI.resetCameraState");this.apiCore.unregister(this,"arUI.updateCropRectArea");
this.apiCore.unregister(this,"arUI.setARDefaultQRCodeStartingScreen");this.apiCore.unregister(this,"arUI.setSettings");this.apiCore.unregister(this,"arUI.setViewerVisibility");this.apiCore.unregister(this,"arUI.displayQRCode");this.apiCore.unregister(this,"arUI.toggleArActiveState");this.arCanvas.remove();this.photoCanvas.remove();this.parentElement.remove()};u.prototype.setSettings=function(b){this.settings=stage.extend(!0,this.settings,b)};u.prototype.setPresets=function(b){this.settings.presets=
b};u.prototype.setQrCodeUrl=function(b){this.customQrCodeUrl=b};u.prototype.hide=function(){this.hideArPresets();this.hideArAnimations();this.toggleArActiveState(!1);this.showArInteractionSelectionButton();this.hideArMenuQuitIcon();this.deleteVideoElem();this.hideTakePictureButton();this.hideSwitchCameraButton();this.hideArSettingsButton();this.hideArShareButton();this.hideArCanvas();this.hideArInteractionSelectionButton();this.hideQRCode();this.actualArSize=null};u.prototype.updateUi=function(){this.showArButton()};
u.prototype.show=function(){this.showArButton();this.showArInteractionSelectionButton()};var k=function(){var d=this;this.callerName=this.name="arUI";this.apiCore.register(this,"resize",q);this.apiCore.register(this,"localeChanged",function(e){return b.call(d)});this.apiCore.register(this,"arUI.setDelay",l);this.apiCore.register(this,"arUI.setPhotoTaken",g);this.apiCore.register(this,"arUI.requestCameraStream",D,!0);this.apiCore.register(this,"arUI.resetCameraState",w);this.apiCore.register(this,
"arUI.updateCropRectArea",A);this.apiCore.register(this,"arUI.setARDefaultQRCodeStartingScreen",v);this.apiCore.register(this,"arUI.setSettings",this.setSettings);this.apiCore.register(this,"arUI.setViewerVisibility",this.setViewerVisibility);this.apiCore.register(this,"arUI.displayQRCode",this.displayQRCode);this.apiCore.register(this,"arUI.toggleArActiveState",this.toggleArActiveState)},l=function(b){this.delay=b},g=function(b){this.photoTaken=b};u.prototype.getArCanvas=function(){return this.arCanvas};
u.prototype.getPhotoCanvas=function(){return this.photoCanvas};u.prototype.showArCanvas=function(){$$stage(this.arCanvas.get(0).parentElement).show();$$stage(this.photoCanvas.get(0).parentElement).show()};u.prototype.hideArCanvas=function(){$$stage(this.arCanvas.get(0).parentElement).hide();$$stage(this.photoCanvas.get(0).parentElement).hide()};u.prototype.setViewerVisibility=function(b){void 0===b||b?this.arCamera.removeClass("overViewer"):this.arCamera.addClass("overViewer")};u.prototype.onMouseButtonPress=
function(b,d,e){switch(b){case 0:this.fingerNumber=1;break;case 2:this.fingerNumber=2}};u.prototype.onMouseButtonRelease=function(b,d,e){this.fingerNumber=0;this.rotating?(this.rotating=!1,this.apiCore.exec(this.callerName,"stat.newArRotation")):this.translating&&(this.translating=!1,this.apiCore.exec(this.callerName,"arControls.stopMovingCenter"),this.apiCore.exec(this.callerName,"stat.newArTranslation"))};u.prototype.onMouseDeltaUpdate=function(b,d){if(this.fingerNumber)if("rotate"==this.interactionType&&
1==this.fingerNumber||"rotate"!=this.interactionType&&2==this.fingerNumber)this.apiCore.exec(this.callerName,"arControls.updateGamma",-b*Math.PI/180),this.rotating=this.updateImageAnalysisRotationOnly=!0;else if("move"==this.interactionType&&1==this.fingerNumber||"move"!=this.interactionType&&2==this.fingerNumber)this.apiCore.exec(this.callerName,"arControls.moveCenter",[b*this.settings.mouseSpeed,d*this.settings.mouseSpeed]),this.translating=this.updateRepositionCenter=!0};u.prototype.updateFrame=
function(b){this.updateImageAnalysisRotationOnly&&(this.updateImageAnalysisRotationOnly=!1,this.apiCore.exec(this.callerName,"arControls.getPhotoTaken")&&this.apiCore.exec(this.callerName,"arControls.rotateCameraAroundCenter"));this.deltaT+=b;this.deltaT>this.delay&&(this.deltaT-=this.delay,this.updateRepositionCenter&&(this.updateRepositionCenter=!1,this.apiCore.exec(this.callerName,"arControls.repositionCenter")))};var q=function(b,d){this.arSizeSelectionVisible&&(f.call(this),B.call(this,null,
this.actualArSize?this.actualArSize:this.settings.defaultHeight));this.faceTrackingMaskContainer&&e.call(this,b,d);this.arButtonContainer&&(200>d?this.hideArButton():this.showArButton());T.call(this);if(this.previousWidth===b&&this.previousHeight===d)this.hideArMessageScreen(null,"orientationChange");else if(this.qrCodeContainerDisplayed&&t.call(this,b,d),this.apiCore.exec(this.callerName,"arControls.isInitialized"))if(this.photoTaken){if(!this.displayMessageScreen&&this.previousWidth!=b&&this.previousHeight!=
d){var g=stage.setContext(function(){this.apiCore.exec(this.callerName,"startEmersyaAr");this.previousWidth=b;this.previousHeight=d},this);this.apiCore.exec(this.callerName,"showOrientationChangeMessage",g)}}else this.apiCore.exec(this.callerName,"arControls.initParameters"),this.previousWidth=b,this.previousHeight=d},t=function(b,d){this.qrCodeContainer&&(d&&b||(d=this.qrCodeContainer.get(0).clientHeight,b=this.qrCodeContainer.get(0).clientWidth),this.qrCodeContainer.css(b>d?this.qrCodeContainerStyle.landscape:
this.qrCodeContainerStyle.portrait),this.tryNextToYouContainer&&this.tryNextToYouContainer.css("margin-bottom",""),this.qrCodeImage&&this.qrCodeImage.css({height:"","min-height":"",width:"","min-width":"",margin:""}),this.orGoTContainer&&this.orGoTContainer.css("margin-top",""),this.qrCodeBackButon&&this.qrCodeBackButon.css("margin-top",""),this.onlyAvailableContainer&&this.onlyAvailableContainer.css("margin",""),this.scanThisCodeContainer&&this.scanThisCodeContainer.css("margin-top",""),400>b?this.qrCodeContainer.css("padding",
"50px"):this.qrCodeContainer.css("padding",""),750>d&&(this.tryNextToYouContainer&&this.tryNextToYouContainer.css("margin-bottom","20px"),this.qrCodeImage&&170<=d&&(this.qrCodeImage.css("height","150px"),this.qrCodeImage.css("min-height","150px"),this.qrCodeImage.css("width","150px"),this.qrCodeImage.css("min-width","150px")),this.orGoTContainer&&450<=d&&this.orGoTContainer.css("margin-top","10px"),this.qrCodeBackButon&&430<=d&&this.qrCodeBackButon.css("margin-top","50px"),this.onlyAvailableContainer&&
380<=d&&this.onlyAvailableContainer.css("margin","10px 0")),560>d?(this.arQrCodePageIcon&&this.arQrCodePageIcon.hide(),this.tryNextToYouContainer&&this.tryNextToYouContainer.hide()):(this.arQrCodePageIcon&&this.arQrCodePageIcon.show(),this.tryNextToYouContainer&&this.tryNextToYouContainer.show()),450>d?this.orGoTContainer&&this.orGoTContainer.hide():this.orGoTContainer&&this.orGoTContainer.show(),430>d?(this.urlContainer&&this.urlContainer.hide(),this.qrCodeBackButon&&380<=d&&this.qrCodeBackButon.css("margin-top",
"30px")):this.urlContainer&&this.urlContainer.show(),380>d?(this.onlyAvailableContainer&&this.onlyAvailableContainer.hide(),this.qrCodeBackButon&&230<=d&&this.qrCodeBackButon.css("margin-top","10px"),this.scanThisCodeContainer&&this.qrCodeBackButon&&this.scanThisCodeContainer.hide()):(this.onlyAvailableContainer&&this.onlyAvailableContainer.show(),this.scanThisCodeContainer&&this.qrCodeBackButon&&this.scanThisCodeContainer.show()),330>d&&this.scanThisCodeContainer&&230<=d&&this.scanThisCodeContainer.css("margin-top",
"0px"),300>d?this.powerByEmersyaLogoQrCode&&this.powerByEmersyaLogoQrCode.hide():this.powerByEmersyaLogoQrCode&&this.powerByEmersyaLogoQrCode.show(),230>d?(this.qrCodeBackButon&&this.qrCodeBackButon.css("margin-top","0px"),this.qrCodeImage&&this.qrCodeImage.css("margin","0px"),this.scanThisCodeContainer&&!this.qrCodeBackButon&&this.scanThisCodeContainer.hide()):this.scanThisCodeContainer&&!this.qrCodeBackButon&&this.scanThisCodeContainer.show(),d<(this.qrCodeBackButon?210:170)&&this.qrCodeImage&&
(b=d,this.qrCodeBackButon&&(b-=this.qrCodeBackButon.get(0).clientHeight),b-=20,50>b&&(b=50),b+="px",this.qrCodeImage.css("height",b),this.qrCodeImage.css("min-height",b),this.qrCodeImage.css("width",b),this.qrCodeImage.css("min-width",b)))};u.prototype.createVideoElem=function(){this.videoElem||(skel=[{tagName:"video",returnActive:!0,attributes:{klass:"arVideoContainer",playsinline:!0,"webkit-playsinline":!0,style:{opacity:0,width:"100%",height:"100%"}}}],this.videoElem=this.parentElement.build(skel))};
u.prototype.createVykingSubVideoElem=function(){this.vykingSubVideoElem||(skel=[{tagName:"video",returnActive:!0,attributes:{klass:"arVideoContainer",playsinline:!0,"webkit-playsinline":!0,style:{opacity:0,width:"100%",height:"100%"}}}],this.vykingSubVideoElem=this.parentElement.build(skel))};u.prototype.createVykingSubVideoElem2=function(){this.vykingSubVideoElem2||(skel=[{tagName:"video",returnActive:!0,attributes:{klass:"arVideoContainer",playsinline:!0,"webkit-playsinline":!0,style:{opacity:0,
width:"100%",height:"100%"}}}],this.vykingSubVideoElem2=this.parentElement.build(skel))};u.prototype.getVideoElem=function(){return this.videoElem.get(0)};u.prototype.getVykingSubVideoElem=function(){return this.vykingSubVideoElem.get(0)};u.prototype.getVykingSubVideoElem2=function(){return this.vykingSubVideoElem2.get(0)};u.prototype.deleteVideoElem=function(){this.videoElem&&(this.videoElem.remove(),this.videoElem=null)};var r=function(){var b=this;skel=[{tagName:"div",returnActive:!0,attributes:{klass:"arSizeSelectionContainer",
style:{backgroundColor:this.settings.mainColor,color:this.settings.secondColor}},childs:[{tagName:"div",attributes:{klass:"quitArSizeSelection"},events:[{onEvent:"click",callback:stage.setContext(function(){this.apiCore.exec(this.callerName,"quitArSizeSelector")},this)}]},{tagName:"div",attributes:{klass:"arSizeSelectionTitle"},childs:[{tagName:"div",attributes:{klass:"arSizeSelectionTitleText"}},{tagName:"span",attributes:{klass:"arSelectYourSizeText"}}]},{tagName:"div",attributes:{klass:"sizeSelectorContainer",
style:"overscroll-behavior: contain; -ms-scroll-chaining: none; /* Edge version < 18 */"},childs:[{tagName:"div",attributes:{klass:"sizeSliderContainer"},childs:[{tagName:"div",attributes:{klass:"sizeSelectedContainer"},childs:[{tagName:"div",attributes:{klass:"sizeContainer"}},{tagName:"div",attributes:{klass:"arrowContainer",style:{"border-left":"8px solid "+this.settings.secondColor}}}]},{tagName:"div",attributes:{klass:"wheelWrapper"},childs:[{tagName:"div",attributes:{klass:"sizeSliderSubContainer"},
childs:[{tagName:"div",attributes:{klass:"sizeSliderSelectorArrowTop",style:{"border-bottom":"8px solid "+this.settings.secondColor}}},{tagName:"div",attributes:{klass:"sizeSliderSelector"},events:[{onEvent:"scroll",callback:stage.setContext(B,this)}]},{tagName:"div",attributes:{klass:"sizeSliderSelectorBottomTop",style:{"border-top":"8px solid "+this.settings.secondColor}}}]},{tagName:"div",attributes:{klass:"wheelShadow"}}]}]},{tagName:"div",attributes:{klass:"mainArrowContainer"},childs:[{tagName:"div",
attributes:{klass:"mainArrowTopContainer",style:{"border-bottom":"8px solid "+this.settings.secondColor}}},{tagName:"div",attributes:{klass:"mainArrowStickContainer",style:{backgroundColor:this.settings.secondColor}}},{tagName:"div",attributes:{klass:"mainArrowBottomContainer",style:{"border-top":"8px solid "+this.settings.secondColor}}}]},{tagName:"div",attributes:{klass:"arManIcon"}}]},{tagName:"div",attributes:{klass:"arValidSizeButton",style:{color:this.settings.secondColor}},events:[{onEvent:"click",
callback:stage.setContext(function(){this.hideArSizeSelectionContainer();var b=stage.setContext(function(){navigator.cookieEnabled&&stage.createCookie("emersyaArSize",this.actualArSize,30);this.apiCore.exec(this.callerName,"arSizeSelected",this.actualArSize);this.apiCore.exec(this.callerName,"startEmersyaAr")},this);this.showLoader(b,!0)},this)}]}]}];this.arSizeSelectionContainer=this.parentElement.build(skel);this.sizeSliderSubContainer=this.arSizeSelectionContainer.find(".sizeSliderSubContainer");
this.sizeSelectorContainer=this.arSizeSelectionContainer.find(".sizeSelectorContainer");this.sizeSliderSelector=this.arSizeSelectionContainer.find(".sizeSliderSelector");this.wheelShadow=this.arSizeSelectionContainer.find(".wheelShadow");this.sizeContainer=this.arSizeSelectionContainer.find(".sizeContainer");this.arManIcon=this.arSizeSelectionContainer.find(".arManIcon");this.arValidSizeButton=this.arSizeSelectionContainer.find(".arValidSizeButton");this.translatedDomElements.arSizeSelectionTitleText=
{container:this.arSizeSelectionContainer.find(".arSizeSelectionTitleText").get(0),value:"pleaseStandUp"};this.translatedDomElements.arSelectYourSizeText={container:this.arSizeSelectionContainer.find(".arSelectYourSizeText").get(0),value:"selectYourSize"};this.translatedDomElements.arValidSizeButton={container:this.arSizeSelectionContainer.find(".arValidSizeButton").get(0),value:"start",textDecoration:function(b){return b.toUpperCase()},onUpdated:function(){b.arValidSizeButton.css("width",null);var d=
b.arValidSizeButton.get(0).offsetWidth;b.arValidSizeButton.css("width",d+30+"px")}};this.apiCore.exec(this.callerName,"lib.insertSvg",this.fullIcons.arSizeIcon,{});this.apiCore.exec(this.callerName,"lib.insertSvg",this.fullIcons.arManIcon,{});this.apiCore.exec(this.callerName,"lib.insertSvg",this.fullIcons.quitSizeSelectionIcon,{mouseOver:!0});for(var d=[],e=this.settings.maxHeight;e>this.settings.minHeight;e-=10)d.push({tagName:"div",attributes:{id:"sizeElem"+e/10,klass:"sizeElement"},childs:[{tagName:"div",
attributes:{klass:"sizeElementText",inner:n(e)}},{tagName:"div",attributes:{klass:"arSizeSeparator",inner:"_____"}}]});d.push({tagName:"div",attributes:{id:"sizeElem"+this.settings.minHeight/10,inner:n(this.settings.minHeight)}});d.push({tagName:"div",attributes:{klass:"sizeSliderSelectorSpacer",style:"margin: 0;"}});this.sizeSliderSelector.build(d)},f=function(){var b="rgb("+this.rgbaMainColor.r+", "+this.rgbaMainColor.g+", "+this.rgbaMainColor.b+")",d="rgba("+this.rgbaMainColor.r+", "+this.rgbaMainColor.g+
", "+this.rgbaMainColor.b+", 0)";this.wheelShadow.css({background:"linear-gradient(to bottom, "+b+" 0%, "+d+" 30%, "+d+" 70%, "+b+" 100%)"});b=this.sizeSliderSelector.get(0).getBoundingClientRect().height/2;d=this.sizeSliderSelector.find(".sizeElementText").get(0).getBoundingClientRect().height/2;this.sizeSliderSelector.css({"padding-top":b-d+"px"});this.sizeSliderSelector.find(".sizeSliderSelectorSpacer").css({height:b-d+"px"});this.arManIcon.find("svg").get(0).setAttribute("viewBox","11 -2 88 297");
this.arManIcon.find("svg").get(0).setAttribute("preserveAspectRatio","xMinYMid meet")},n=function(b){b=b.toString();return b.substring(0,1)+"m"+b.substring(1)},B=function(b,d){b=this.sizeSliderSelector.get(0).scrollTop;var e=(this.settings.maxHeight-this.settings.minHeight)/(this.sizeSliderSelector.get(0).scrollHeight-this.sizeSliderSelector.get(0).clientHeight);d?(this.actualArSize=d,b=(this.settings.maxHeight-d)/e,this.sizeSliderSelector.get(0).scrollTop=parseInt(b)):this.actualArSize=Math.round(Math.min(Math.max(this.settings.minHeight,
this.settings.maxHeight-b*e),this.settings.maxHeight));this.sizeContainer.get(0).innerHTML=n(this.actualArSize)};u.prototype.getSize=function(){return this.actualArSize};u.prototype.showArSizeSelectionContainer=function(){this.apiCore.exec(this.callerName,"arSizeSelectionDisplayed");this.arSizeSelectionContainer?this.arSizeSelectionContainer.css({display:"flex"}):r.call(this);b.call(this,["arSizeSelectionTitleText","arSelectYourSizeText","arValidSizeButton"]);f.call(this);B.call(this,null,this.actualArSize?
this.actualArSize:this.settings.defaultHeight);this.arSizeSelectionVisible=!0};u.prototype.hideArSizeSelectionContainer=function(){this.arSizeSelectionContainer&&(this.arSizeSelectionContainer.hide(),this.arSizeSelectionVisible=!1)};var w=function(){this.cameraAccessState=this.cameraAccessStateEnum.UNASKED},D=function(b){var d=this,e;return $jscomp.asyncExecutePromiseGeneratorProgram(function(f){switch(d.cameraAccessState){case d.cameraAccessStateEnum.UNASKED:d.cameraAccessState=d.cameraAccessStateEnum.PENDING;
d.cameraPendingTime=(new Date).getTime();break;case d.cameraAccessStateEnum.PENDING:1500<(new Date).getTime()-d.cameraPendingTime&&(d.hideLoader(),d.displayActivateCameraMessage())}e=d;return f.return(new Promise(function(d,f){e.apiCore.exec(e.callerName,"getCameraStream",b).then(function(b){e.cameraAccessState=e.cameraAccessStateEnum.GRANTED;d(b)}).catch(function(f){e.device.cameras.back=[];e.device.cameras.front=[];e.apiCore.exec(e.callerName,"getCameraStream",b).then(function(b){e.cameraAccessState=
e.cameraAccessStateEnum.GRANTED;d(b)}).catch(function(b){console.log(b);"NotAllowedError"===b.name?(e.displayActivateCameraMessage(),e.hideLoader(),e.cameraAccessState=e.cameraAccessStateEnum.DENIED):(e.displayPermissionErrorPopup(b),e.cameraAccessState=e.cameraAccessStateEnum.ERROR)})})}))})},A=function(b){if(this.cropRectArea){var d=b.width/b.height,e=window.innerWidth/window.innerHeight,f=this.cropRectArea.find(".cropRectAreaTop"),g=this.cropRectArea.find(".cropRectAreaCenter"),h=this.cropRectArea.find(".cropRectAreaBottom");
d=d>e;var k=this.cropRectArea.get(0).clientWidth,l=this.cropRectArea.get(0).clientHeight;d?(d=[0,b.x,0],e=[0,b.y,b.y+b.height],k=[k,b.width,k],l=(l-b.height)/2,b=[l,b.height,l]):(d=[0,b.x,b.x+b.width],e=[0,b.y,0],k=(k-b.width)/2,k=[k,b.width,k],b=[l,b.height,l]);f.css({top:e[0]+"px",left:d[0]+"px",width:k[0]+"px",height:b[0]+"px"});g.css({top:e[1]+"px",left:d[1]+"px",width:k[1]+"px",height:b[1]+"px"});h.css({top:e[2]+"px",left:d[2]+"px",width:k[2]+"px",height:b[2]+"px"})}else this.cropRectArea||(this.cropRectArea=
this.parentElement.build([{tagName:"div",returnActive:!0,attributes:{klass:"cropRectArea"},childs:[{tagName:"div",attributes:{klass:"cropRectAreaTop"}},{tagName:"div",attributes:{klass:"cropRectAreaCenter"}},{tagName:"div",attributes:{klass:"cropRectAreaBottom"}}]}]),A.call(this,b))};u.prototype.showCropRectArea=function(){this.cropRectArea&&this.cropRectArea.show()};u.prototype.hideCropRectArea=function(){this.cropRectArea&&this.cropRectArea.hide()};var H=function(){this.arSettingsButtonContainer?
this.showArSettingsButton():(skel=[{tagName:"div",returnActive:!0,attributes:{klass:"arSettingsButtonContainer"},childs:[{tagName:"div",attributes:{klass:"arSettingsButtonIcon"}}],events:[{onEvent:"click",callback:stage.setContext(function(){this.apiCore.exec(this.callerName,"showArSizeSelector")},this)}]}],this.arSettingsButtonContainer=this.parentElement.build(skel),this.apiCore.exec(this.callerName,"lib.insertSvg",this.fullIcons.settingsIcon,{}),this.hideArSettingsButton())};u.prototype.showArSettingsButton=
function(){this.arSettingsButtonContainer&&this.arSettingsButtonContainer.show()};u.prototype.hideArSettingsButton=function(){this.arSettingsButtonContainer&&this.arSettingsButtonContainer.hide()};var e=function(b,d){1<b/d?(this.faceTrackingMaskTopPart.hide(),this.faceTrackingMaskBottomPart.hide(),this.faceTrackingMaskLeftPart.css({display:"inline-block",width:"calc(50% - "+d/2+"px)"}),this.faceTrackingMaskRightPart.css({display:"inline-block",width:"calc(50% - "+d/2+"px)"}),this.faceTrackingMaskMiddlePart.css({width:""+
d+"px",height:""+d+"px"})):(this.faceTrackingMaskLeftPart.hide(),this.faceTrackingMaskRightPart.hide(),this.faceTrackingMaskTopPart.css({display:"block",height:"calc(50% - "+b/2+"px)"}),this.faceTrackingMaskBottomPart.css({display:"block",height:"calc(50% - "+b/2+"px)"}),this.faceTrackingMaskMiddlePart.css({width:""+b+"px",height:""+b+"px"}))};u.prototype.showFaceTrackingMask=function(){this.faceTrackingMaskContainer&&this.faceTrackingMaskContainer.show()};u.prototype.hideFaceTrackingMask=function(){this.faceTrackingMaskContainer&&
this.faceTrackingMaskContainer.hide()};u.prototype.showSwitchCameraButton=function(){this.switchCameraButtonContainer&&this.switchCameraButtonContainer.show()};u.prototype.hideSwitchCameraButton=function(){this.switchCameraButtonContainer&&this.switchCameraButtonContainer.hide()};var E=function(){this.takePictureButtonContainer?this.showTakePictureButton():(skel=[{tagName:"div",returnActive:!0,attributes:{klass:"takePictureButtonContainer"},events:[{onEvent:"click",callback:stage.setContext(function(){if(!this.photoTaken){this.photoTaken=
!0;var b=stage.setContext(function(){setTimeout(stage.setContext(function(){this.apiCore.exec(this.callerName,"takeArPicture")},this),10)},this);this.showLoader(b,!1)}},this)}]}],this.takePictureButtonContainer=this.parentElement.build(skel),this.apiCore.exec(this.callerName,"lib.insertSvg",this.fullIcons.moving,{}),this.hideTakePictureButton())};u.prototype.showTakePictureButton=function(){this.takePictureButtonContainer&&(this.photoTaken=!1,this.takePictureButtonContainer.show())};u.prototype.hideTakePictureButton=
function(){this.takePictureButtonContainer&&this.takePictureButtonContainer.hide()};moveTarget=function(){var b=Date.now();this.renderFunction=stage.setContext(function(){this.animationFrame=window.requestAnimationFrame(this.renderFunction);var d=(Date.now()-b)/1400;d=1+2*(Math.sin(Math.PI*d)+1);this.takePictureButtonContainer.find("circle").get(2).setAttributeNS(null,"stroke-width",d)},this);this.animationFrame=window.requestAnimationFrame(this.renderFunction)};var F=function(b){b.stopPropagation();
b.preventDefault();if(this.pointerdown){b=b.touches?b.touches[0].clientX:b.pageX?b.pageX:b.clientX;var d=0;this.arInteractionButtonIcon.get(0).style.left&&(d=parseInt(this.arInteractionButtonIcon.get(0).style.left.replace("px","")));d=Math.max(0,Math.min(35,d+b-this.pointerXPosition));1>Math.abs(b-this.pointerXPosition)?this.slideMove=!1:(this.slideMove=!0,this.arInteractionButtonIcon.css({left:d+"px",transition:"all 0s"}),this.pointerXPosition=b)}},p=function(b){b.stopPropagation();b.preventDefault();
this.pointerdown=!0;this.pointerXPosition=b.touches?b.touches[0].clientX:b.pageX?b.pageX:b.clientX},m=function(b){b.stopPropagation();b.preventDefault();this.pointerdown&&(this.slideMove?(this.arInteractionButtonIcon.css({transition:"all 0.4s ease 0s"}),b=0,this.arInteractionButtonIcon.get(0).style.left&&(b=parseInt(this.arInteractionButtonIcon.get(0).style.left.replace("px",""))),"rotate"!=this.interactionType?17>b?this.changeArInteractionType():this.arInteractionButtonIcon.css("left","35px"):"move"!=
this.interactionType&&(17<b?this.changeArInteractionType():this.arInteractionButtonIcon.css("left","0px"))):this.changeArInteractionType(),this.pointerdown=this.slideMove=!1,this.apiCore.exec(this.callerName,"foldShareButton"))},h=function(b,d){var e={"background-image":""!=b?'url("'+b+'")':"","background-size":""};""!=b&&(b=toImageType[d],"strech"==b?e["background-size"]="100% 100%":"fit"==b?e["background-size"]="contain":"maximize"==b&&(e["background-size"]="cover"));return e};u.prototype.changeArInteractionType=
function(b){b&&(b.preventDefault(),b.stopPropagation());"rotate"==this.interactionType?(this.interactionType="move",this.arInteractionButtonIcon.css("left","35px"),this.arInteractionRotateButtonIcon.css("opacity",.4),this.arInteractionMoveButtonIcon.css("opacity",1),(b=$$stage(".arHelper .arHelperRotateIconTouch").detach())&&b.attach($$stage(".arHelper .moveArContainer .iconContainer").get(0)),(b=$$stage(".arHelper .arHelperRotateIcon").detach())&&b.attach($$stage(".arHelper .moveArContainer .iconContainer").get(0)),
(b=$$stage(".arHelper .arHelperMoveIconTouch").detach())&&b.attach($$stage(".arHelper .rotateArContainer .iconContainer").get(0)),(b=$$stage(".arHelper .arHelperMoveIcon").detach())&&b.attach($$stage(".arHelper .rotateArContainer .iconContainer").get(0))):(this.interactionType="rotate",this.arInteractionButtonIcon.css("left","0px"),this.arInteractionRotateButtonIcon.css("opacity",1),this.arInteractionMoveButtonIcon.css("opacity",.4),(b=$$stage(".arHelper .arHelperRotateIconTouch").detach())&&b.attach($$stage(".arHelper .rotateArContainer .iconContainer").get(0)),
(b=$$stage(".arHelper .arHelperRotateIcon").detach())&&b.attach($$stage(".arHelper .rotateArContainer .iconContainer").get(0)),(b=$$stage(".arHelper .arHelperMoveIconTouch").detach())&&b.attach($$stage(".arHelper .moveArContainer .iconContainer").get(0)),(b=$$stage(".arHelper .arHelperMoveIcon").detach())&&b.attach($$stage(".arHelper .moveArContainer .iconContainer").get(0)))};u.prototype.showArInteractionSelectionButton=function(){this.arInteractionSelectionButton&&this.arInteractionSelectionButton.show()};
u.prototype.hideArInteractionSelectionButton=function(){this.arInteractionSelectionButton&&this.arInteractionSelectionButton.hide()};u.prototype.showArTypeSelector=function(){var d=this;if(this.arTypeSelectorContainer)this.arTypeSelectorContainer.show();else{var e=[{tagName:"div",returnActive:!0,attributes:{klass:"arTypeSelectorContainer",style:{backgroundColor:this.settings.mainColor,color:this.settings.secondColor,"-moz-box-shadow":"0 0 6px rgba("+this.rgba.r+","+this.rgba.g+","+this.rgba.b+","+
this.rgba.a/255+")","-webkit-box-shadow":"0 0 6px rgba("+this.rgba.r+","+this.rgba.g+","+this.rgba.b+","+this.rgba.a/255+")","box-shadow":"0 0 6px rgba("+this.rgba.r+","+this.rgba.g+","+this.rgba.b+","+this.rgba.a/255+")"}},childs:[{tagName:"div",attributes:{klass:"arTypeSelectorQuitButon",inner:"q"},events:[{onEvent:"click",callback:stage.setContext(function(b){b.stopPropagation();b.preventDefault();this.arTypeSelectorContainer.hide()},this)}]},{tagName:"div",attributes:{klass:"arTypeSelectorTitle",
style:{color:this.settings.secondColor}}},{tagName:"div",attributes:{klass:"placeAndInteractContainer",style:{color:this.settings.secondColor}},childs:[{tagName:"div",attributes:{klass:"placeAndInteractIconContainer"}},{tagName:"div",attributes:{klass:"placeAndInteractTitleContainer"},childs:[{tagName:"span",attributes:{klass:"placeAndInteractTitleContainerWithArPhoto"}}]}],events:[{onEvent:"click",callback:stage.setContext(function(b){b.stopPropagation();b.preventDefault();this.apiCore.exec(this.callerName,
"startEmersyaAr");this.arTypeSelectorContainer.hide()},this)}]},{tagName:"div",attributes:{klass:"moveAroundContainer",style:{color:this.settings.secondColor}},childs:[{tagName:"div",attributes:{klass:"moveAroundIconContainer"}},{tagName:"div",attributes:{klass:"moveAroundTitleContainer"}}],events:[{onEvent:"click",callback:stage.setContext(function(b){b.stopPropagation();b.preventDefault();this.apiCore.exec(this.callerName,"startMoveAroundAr");this.arTypeSelectorContainer.hide()},this)}]}]}];this.arTypeSelectorContainer=
this.parentElement.build(e);this.translatedDomElements.arTypeSelectorTitle={container:this.arTypeSelectorContainer.find(".arTypeSelectorTitle").get(0),value:"chooseYourARExperience"};this.translatedDomElements.placeAndInteractTitleContainer={container:this.arTypeSelectorContainer.find(".placeAndInteractTitleContainer").get(0),value:"placeAndInteract"};this.translatedDomElements.placeAndInteractTitleContainerWithArPhoto={container:this.arTypeSelectorContainer.find(".placeAndInteractTitleContainerWithArPhoto").get(0),
value:"withArPhoto"};this.translatedDomElements.moveAroundTitleContainer={container:this.arTypeSelectorContainer.find(".moveAroundTitleContainer").get(0),value:"moveAround",onAllTranslationsDone:function(){d.arTypeSelectorContainer.find(".placeAndInteractContainer").css({height:null,"margin-left":null,"margin-top":null});d.arTypeSelectorContainer.find(".moveAroundContainer").css({height:null,"margin-left":null,"margin-top":null});d.arTypeSelectorContainer.find(".moveAroundTitleContainer").css("font-size",
null);d.arTypeSelectorContainer.find(".placeAndInteractTitleContainer").css("font-size",null);d.arTypeSelectorContainer.find(".placeAndInteractIconContainer").css({width:null,height:null});d.arTypeSelectorContainer.find(".moveAroundIconContainer").css({width:null,height:null});d.apiCore.exec(d.callerName,"lib.insertSvg",d.fullIcons.arTypeSelectorQuitButon,{mouseOver:!0});d.apiCore.exec(d.callerName,"lib.insertSvg",d.fullIcons.moveAround,{});d.apiCore.exec(d.callerName,"lib.insertSvg",d.fullIcons.placeAndInteract,
{});var b=d.arTypeSelectorContainer.find(".arTypeSelectorTitle").get(0).offsetHeight+d.arTypeSelectorContainer.find(".arTypeSelectorQuitButon").get(0).offsetHeight,e=45,f=(d.parentElement.getHeight()-(b+e+30+30))/2;d.arTypeSelectorContainer.find(".placeAndInteractContainer").css("height",f+"px");d.arTypeSelectorContainer.find(".moveAroundContainer").css("height",f+"px");d.arTypeSelectorContainer.find(".placeAndInteractContainer").css("margin-top",b+e+"px");400==d.arTypeSelectorContainer.find(".placeAndInteractContainer").get(0).offsetWidth&&
(d.arTypeSelectorContainer.find(".placeAndInteractContainer").css("margin-left","calc(50% - 200px)"),d.arTypeSelectorContainer.find(".moveAroundContainer").css("margin-left","calc(50% - 200px)"));300==d.arTypeSelectorContainer.find(".placeAndInteractContainer").get(0).offsetHeight&&(e=Math.round((d.arTypeSelectorContainer.getHeight()-(b+600))/3),d.arTypeSelectorContainer.find(".placeAndInteractContainer").css("margin-top",e+b+"px"),d.arTypeSelectorContainer.find(".moveAroundContainer").css("margin-top",
e+"px"));Math.max(d.arTypeSelectorContainer.find(".placeAndInteractTitleContainer").get(0).offsetHeight+d.arTypeSelectorContainer.find(".placeAndInteractIconContainer").get(0).offsetHeight,d.arTypeSelectorContainer.find(".moveAroundTitleContainer").get(0).offsetHeight+d.arTypeSelectorContainer.find(".moveAroundIconContainer").get(0).offsetHeight)>f&&(d.arTypeSelectorContainer.find(".moveAroundTitleContainer").css("font-size","18px"),d.arTypeSelectorContainer.find(".placeAndInteractTitleContainer").css("font-size",
"18px"),d.arTypeSelectorContainer.find(".placeAndInteractIconContainer").css({width:"80px",height:"80px"}),d.arTypeSelectorContainer.find(".moveAroundIconContainer").css({width:"90px",height:"90px"}))}}}b.call(this,["arTypeSelectorTitle","placeAndInteractTitleContainer","placeAndInteractTitleContainerWithArPhoto","moveAroundTitleContainer"])};var v=function(b){this.settings.aRDefaultQRCodeStartingScreen=void 0!==b?b:!this.settings.aRDefaultQRCodeStartingScreen};u.prototype.displayQRCode=function(d){this.customQrCodeUrl&&
""!=this.customQrCodeUrl&&(d=this.customQrCodeUrl);if(this.settings.aRDefaultQRCodeStartingScreen){if(!this.qrCodeContainer){var e=this.settings.arSimplifiedMode?[{tagName:"div",attributes:{klass:"qrCodeImage",style:{marginTop:"0px"}}},{tagName:"div",attributes:{klass:"scanThisCodeContainer",style:{color:this.settings.secondColor}}},{tagName:"div",attributes:{klass:"powerByEmersyaLogoQrCode"}},{tagName:"div",attributes:{klass:"qrCodeBackButon",inner:"< Back"},events:[{onEvent:"click",callback:stage.setContext(function(b){b.stopPropagation();
b.preventDefault();this.hideQRCode()},this)}]}]:[{tagName:"div",attributes:{klass:"qrCodeQuitButon",inner:"q"},events:[{onEvent:"click",callback:stage.setContext(function(b){b.stopPropagation();b.preventDefault();this.hideQRCode()},this)}]},{tagName:"div",attributes:{klass:"arQrCodePageIcon"}},{tagName:"div",attributes:{klass:"tryNextToYouContainer"},childs:[{tagName:"span",attributes:{klass:"tryNextToYouBold"}},{tagName:"span",attributes:{klass:"tryNextToYouNormal"}}]},{tagName:"div",attributes:{klass:"scanThisCodeContainer"}},
{tagName:"div",attributes:{klass:"qrCodeImage"}},{tagName:"div",attributes:{klass:"orGoTContainer"}},{tagName:"div",attributes:{klass:"urlContainer",inner:d}},{tagName:"div",attributes:{klass:"onlyAvailableContainer"}},{tagName:"div",attributes:{klass:"powerByEmersyaLogoQrCode"}}];this.qrCodeContainer=this.parentElement.build([{tagName:"div",returnActive:!0,attributes:{klass:"qrCodeContainer",style:{backgroundColor:this.settings.mainColor,color:this.settings.secondColor,"-moz-box-shadow":"0 0 6px rgba("+
this.rgba.r+","+this.rgba.g+","+this.rgba.b+","+this.rgba.a/255+")","-webkit-box-shadow":"0 0 6px rgba("+this.rgba.r+","+this.rgba.g+","+this.rgba.b+","+this.rgba.a/255+")","box-shadow":"0 0 6px rgba("+this.rgba.r+","+this.rgba.g+","+this.rgba.b+","+this.rgba.a/255+")"}},childs:e}]);this.settings.arSimplifiedMode?this.translatedDomElements.scanThisCodeContainer={container:this.qrCodeContainer.find(".scanThisCodeContainer").get(0),value:"scanQrCode",onAllTranslationsDone:t.bind(this)}:(this.translatedDomElements.tryNextToYouBold=
{container:this.qrCodeContainer.find(".tryNextToYouBold").get(0),value:"wearable"===this.settings.arType?"tryOnYou":"tryNextToYou"},this.translatedDomElements.tryNextToYouNormal={container:this.qrCodeContainer.find(".tryNextToYouNormal").get(0),value:"inAugmentedReality"},this.translatedDomElements.scanThisCodeContainer={container:this.qrCodeContainer.find(".scanThisCodeContainer").get(0),value:"scanQrCode"},this.translatedDomElements.orGoTContainer={container:this.qrCodeContainer.find(".orGoTContainer").get(0),
value:"orGoTo"},this.translatedDomElements.onlyAvailableContainer={container:this.qrCodeContainer.find(".onlyAvailableContainer").get(0),value:"wearable"===this.settings.arType?"onlyAvailableOnDevicesWithACamera":"onlyAvailableOnMobilesAndTablets",onAllTranslationsDone:t.bind(this)});this.qrCodeContainerStyle={landscape:h.call(this,this.settings.arBackgroundLandscapeImagePath,this.settings.arBackgroundLandscapeImageType),portrait:h.call(this,this.settings.arBackgroundPortraitImagePath,this.settings.arBackgroundPortraitImageType)};
this.scanThisCodeContainer=this.qrCodeContainer.find(".scanThisCodeContainer");this.qrCodeImage=this.qrCodeContainer.find(".qrCodeImage");this.powerByEmersyaLogoQrCode=this.qrCodeContainer.find(".powerByEmersyaLogoQrCode");this.settings.arSimplifiedMode?this.qrCodeBackButon=this.qrCodeContainer.find(".qrCodeBackButon"):(this.qrCodeQuitButon=this.qrCodeContainer.find(".qrCodeQuitButon"),this.arQrCodePageIcon=this.qrCodeContainer.find(".arQrCodePageIcon"),this.tryNextToYouContainer=this.qrCodeContainer.find(".tryNextToYouContainer"),
this.orGoTContainer=this.qrCodeContainer.find(".orGoTContainer"),this.urlContainer=this.qrCodeContainer.find(".urlContainer"),this.onlyAvailableContainer=this.qrCodeContainer.find(".onlyAvailableContainer"));this.apiCore.exec(this.callerName,"lib.insertSvg",this.fullIcons.qrCodeQuitButon,{mouseOver:!0});this.apiCore.exec(this.callerName,"lib.insertSvg",this.fullIcons.arQrCodePageIcon,{});this.apiCore.exec(this.callerName,"lib.insertSvg",this.fullIcons.emersyaPoweredByIconQrCode,{});availableHeight=
this.qrCodeContainer.get(0).clientHeight-760;this.qrCodeGenerator=new QRCode(this.qrCodeContainer.find(".qrCodeImage").get(0),{width:this.qrCodeContainer.find(".qrCodeImage").get(0).clientWidth,height:this.qrCodeContainer.find(".qrCodeImage").get(0).clientHeight,correctLevel:QRCode.CorrectLevel.Q})}this.qrCodeGenerator.clear();this.qrCodeGenerator.makeCode(d);this.urlContainer&&(this.urlContainer.get(0).innerText=d);this.qrCodeContainer.css("display","flex");b.call(this,"scanThisCodeContainer tryNextToYouBold tryNextToYouNormal scanThisCodeContainer orGoTContainer onlyAvailableContainer".split(" "));
this.qrCodeContainerDisplayed=!0;this.apiCore.exec(this.callerName,"viewerOverlayStatusUpdated",{displayed:this.qrCodeContainerDisplayed,type:"ArQrCode"})}else{e=document.createElement("div");e.id="qrcode";this.parentElement.get(0).appendChild(e);var f=Math.min(this.parentElement.get(0).clientWidth,this.parentElement.get(0).clientHeight);(new QRCode("qrcode",{text:d,width:f,height:f,correctLevel:QRCode.CorrectLevel.Q}))._oDrawing._elImage.onload=stage.setContext(function(b,d,e){this.apiCore.exec(this.callerName,
"ARQRCodeStartingScreenExpected",{url:d,qrcode:e.srcElement.src});b.remove()},this,e,d)}};u.prototype.hideQRCode=function(b){this.qrCodeContainer&&this.qrCodeContainer.hide();this.qrCodeContainerDisplayed=!1;this.apiCore.exec(this.callerName,"viewerOverlayStatusUpdated",{displayed:this.qrCodeContainerDisplayed,type:"ArQrCode"})};var I=function(){this.arButtonContainer||(skel=[{tagName:"div",returnActive:!0,attributes:{klass:"arButtonContainer",style:{backgroundColor:this.settings.mainColor,color:this.settings.secondColor,
"-moz-box-shadow":"0 0 6px rgba("+this.rgba.r+","+this.rgba.g+","+this.rgba.b+","+this.rgba.a/255+")","-webkit-box-shadow":"0 0 6px rgba("+this.rgba.r+","+this.rgba.g+","+this.rgba.b+","+this.rgba.a/255+")","box-shadow":"0 0 6px rgba("+this.rgba.r+","+this.rgba.g+","+this.rgba.b+","+this.rgba.a/255+")"}},childs:[{tagName:"div",attributes:{klass:"arButtonIcon"}},{tagName:"div",attributes:{klass:"arButtonTitle"}}],events:[{onEvent:"click",callback:stage.setContext(function(){this.apiCore.exec(this.callerName,
"startAr");this.apiCore.exec(this.callerName,"arStartButtonClicked");this.apiCore.exec(this.callerName,"foldShareButton")},this)}]}],this.arButtonContainer=this.parentElement.build(skel),this.translatedDomElements.arButtonTitle={container:this.arButtonContainer.find(".arButtonTitle").get(0),value:"wearable"===this.settings.arType?"tryOnYou":"tryNextToYouButtonTitle",onUpdated:stage.setContext(J,this)},this.apiCore.exec(this.callerName,"lib.insertSvg",this.fullIcons.arIcon,{}));this.showArButton()};
u.prototype.showArButton=function(){this.photoTaken&&this.arActive||this.settings.displayArStartButton&&!this.settings.forceHideArStartButton?(this.arButtonContainer.show(),b.call(this,["arButtonTitle"])):this.hideArButton()};u.prototype.hideArButton=function(){this.arButtonContainer.hide()};u.prototype.toggleArActiveState=function(b){this.arActive=void 0===b?!this.arActive:b;this.arButtonContainer&&(this.arActive?this.arButtonContainer.addClass("arActive"):this.arButtonContainer.removeClass("arActive"));
this.apiCore.exec(this.callerName,"ui.toggleMenu",!this.arActive);J.call(this)};var J=function(){if(this.arButtonContainer)if(this.arButtonContainer.css("width",null),this.arButtonContainer.css("left",null),this.arActive)this.arButtonContainer.css("width","50px"),this.arButtonContainer.css("left","20px");else{var b=this.arButtonContainer.find(".arButtonIcon").get(0).offsetWidth+this.arButtonContainer.find(".arButtonTitle").get(0).offsetWidth+50+10,d="calc(50% - "+b+"px / 2)";this.arButtonContainer.css("width",
b+"px");this.arButtonContainer.css("left",d)}},M=function(d){var e=this;if(!this.displayMessageScreen){this.apiCore.exec(this.callerName,"displayMessageScreen");skel=[{tagName:"div",returnActive:!0,attributes:{klass:"arMessageScreen",style:{backgroundColor:this.settings.mainColor,zIndex:1E3}},childs:[{tagName:"div",attributes:{klass:"arMessageTitle",style:{color:this.settings.secondColor}}}]}];d.hideQuitButton||skel[0].childs.push({tagName:"div",attributes:{klass:"quitArMessageScreen"},events:[{onEvent:"click",
callback:stage.setContext(this.hideArMessageScreen,this,d.quitCallback,d.messageType)}]});d.message&&skel[0].childs.push({tagName:"div",attributes:{klass:"arMessageInstruction",style:{color:this.settings.secondColor,backgroundColor:this.settings.thirdColor,borderColor:this.settings.secondColor}},childs:[{tagName:"div",attributes:{klass:"arMessageInstructionText"}}]});for(var f={tagName:"div",attributes:{klass:"arMessageButtonsContainer"},childs:[]},g=0;g<d.buttons.length;g++){var h=d.buttons[g];h.id=
"arMessageOkButton"+g;f.childs.push({tagName:"div",attributes:{klass:"arMessageOkButton",id:h.id,style:{color:this.settings.secondColor,backgroundColor:this.settings.thirdColor,"border-color":this.settings.secondColor}},events:[{onEvent:"click",callback:stage.setContext(this.hideArMessageScreen,this,h.onclick,d.messageType)}]})}skel[0].childs.push(f);this.displayMessageScreen=this.parentElement.build(skel);var k=["arMessageTitle"];this.translatedDomElements.arMessageTitle={container:this.displayMessageScreen.find(".arMessageTitle").get(0),
value:d.title,onAllTranslationsDone:function(){e.apiCore.exec(e.callerName,"lib.insertSvg",e.fullIcons.unavailableArInstructionIcon,{});e.apiCore.exec(e.callerName,"lib.insertSvg",e.fullIcons.quitArMessageScreen,{mouseOver:!0});T.call(e)}};d.message&&(k.push("arMessageInstructionText"),this.translatedDomElements.arMessageInstructionText={container:this.displayMessageScreen.find(".arMessageInstructionText").get(0),value:d.message,defaultValue:d.messageDefaultValue,category:d.messageCategory,textDecoration:function(b){d.messageMarkdown&&
(b=e.apiCore.exec(e.callerName,"lib.markdown2HTML",b));d.messageMultiLine&&(b=b.replace(/\./g,".<br>"));return b.replace(/\n/g,"</br>")}});d.buttons.forEach(function(b){var d=b.id;k.push(d);e.translatedDomElements[d]={container:e.displayMessageScreen.find("#"+d).get(0),value:b.text,defaultValue:b.textDefaultValue,category:b.textCategory}});this.displayMessageScreenData={fontSize:100,messageType:d.messageType};b.call(this,k)}},T=function(){if(this.displayMessageScreen){var b=this.displayMessageScreen.find(".arMessageInstruction").get(0);
if(b){var d=b.scrollHeight>b.clientHeight;if(d){this.displayMessageScreen.addClass("little");d=b.scrollHeight>b.clientHeight;for(var e=this.displayMessageScreenData.fontSize-5;d&&50<=e;)this.displayMessageScreen.css("fontSize",e+"%"),d=b.scrollHeight>b.clientHeight,this.displayMessageScreenData.fontSize=e,e-=5}else{for(e=this.displayMessageScreenData.fontSize+5;!d&&100>e;)this.displayMessageScreen.css("fontSize",e+"%"),d=b.scrollHeight>b.clientHeight,e+=5;d?(this.displayMessageScreen.css("fontSize",
e-10+"%"),this.displayMessageScreenData.fontSize=e-10):(this.displayMessageScreen.removeClass("little"),(d=b.scrollHeight>b.clientHeight)&&this.displayMessageScreen.addClass("little"))}}}};u.prototype.hideArMessageScreen=function(b,d){!this.displayMessageScreen||d&&this.displayMessageScreenData.messageType!=d||(this.apiCore.exec(this.callerName,"hideMessageScreen"),this.displayMessageScreen.remove(),this.displayMessageScreen=null,b&&b.call(this))};u.prototype.displayOrientationChangeScreen=function(b){M.call(this,
{messageType:"orientationChange",title:"orientationChangeTitle",message:"orientationChangeMessage",quitCallback:b,buttons:[{text:"restart",onclick:b}]});this.apiCore.exec(this.callerName,"arErrorMessageDisplayed",702)};u.prototype.displayMoveYourDeviceScreen=function(b){M.call(this,{messageType:"moveYourDevice",title:"moveYourDevice",message:null,quitCallback:b,buttons:[{text:"ok",onclick:b}]});this.apiCore.exec(this.callerName,"arErrorMessageDisplayed",703)};u.prototype.displaySharingErrorMessage=
function(b){M.call(this,{messageType:"sharingError",title:"sharingError",message:null,quitCallback:b,buttons:[{text:"ok",onclick:b}]});this.apiCore.exec(this.callerName,"arErrorMessageDisplayed",704)};u.prototype.displayUnavailableArModelMessage=function(b,d){b=[{text:"ok",onclick:b}];d&&b.push({text:"forceAr",onclick:C});M.call(this,{messageType:"modelDisabled",title:"modelDisabledTitle",message:"modelDisabledMessage",messageMultiLine:!0,quitCallback:null,buttons:b});this.apiCore.exec(this.callerName,
"arErrorMessageDisplayed",705)};u.prototype.displayActivateCameraMessage=function(){M.call(this,{messageType:"activateCamera",title:"activateCamera",message:"enableCamera",messageMultiLine:!0,quitCallback:null,buttons:[{text:"restart",onclick:aa}]});this.apiCore.exec(this.callerName,"arErrorMessageDisplayed",706)};u.prototype.displayIosClearCacheMessage=function(){M.call(this,{messageType:"iosMotionError",title:"iosMotionErrorTitle",message:"iosMotionErrorMessage",messageMultiLine:!0,quitCallback:null,
buttons:[{text:"restart",onclick:aa}]});this.apiCore.exec(this.callerName,"arErrorMessageDisplayed",706)};u.prototype.displayUnavailableOrientationScreen=function(){M.call(this,{messageType:"motionError",title:"motionError",message:"activateMotionSensor",messageMultiLine:!0,quitCallback:null,buttons:[{text:"restart",onclick:aa}]});this.apiCore.exec(this.callerName,"arErrorMessageDisplayed",707)};u.prototype.displayIosUnavailableOrientationScreen=function(){M.call(this,{messageType:"motionError",title:"motionError",
message:"activateMotionSensor",messageMultiLine:!0,quitCallback:null,buttons:[{text:"restart",onclick:aa}]});this.apiCore.exec(this.callerName,"arErrorMessageDisplayed",707)};u.prototype.displayOperaUnavailableMessage=function(){M.call(this,{messageType:"useOtherBrowsers",title:"useOtherBrowsers",message:"arCannotRunOpera",messageMultiLine:!0,quitCallback:null,buttons:[{text:"copylink",onclick:R}]});this.apiCore.exec(this.callerName,"arErrorMessageDisplayed",708)};u.prototype.displayChromeIosUnavailableMessage=
function(){M.call(this,{messageType:"arCannotRunOnChromeIos",title:"arCannotRunOnChromeIos",message:"useSafari",messageMultiLine:!0,quitCallback:null,buttons:[{text:"copylink",onclick:R}]});this.apiCore.exec(this.callerName,"arErrorMessageDisplayed",709)};u.prototype.displayIosPopupBlockedMessage=function(b){M.call(this,{messageType:"iosPopupError",title:"iosPopupErrorTitle",message:"iosPopupErrorMessage",messageMultiLine:!0,quitCallback:b,buttons:[{text:"ok",onclick:b}]});this.apiCore.exec(this.callerName,
"arErrorMessageDisplayed",710)};u.prototype.displayPermissionErrorPopup=function(b){var d={messageType:"arCameraErrorUnknownContent",title:"arCameraErrorUnknownContent",message:null,messageMultiLine:!0,buttons:[{text:"restart",onclick:aa}]};"NotReadableError"==b&&(d.messageType="arCameraErrorTitle",d.title="arCameraErrorUnknownContent",d.message="arCameraErrorNotReadableContent");M.call(this,d);this.apiCore.exec(this.callerName,"arErrorMessageDisplayed",711)};u.prototype.displayArMoveAroundNotAvailableMessage=
function(b){var d="arMoveAroundNotAvailable",e=[{text:"ok"}];b&&b instanceof Array&&!b.includes("not-ar-compatible")&&b.includes("not-chrome")&&(d="arMoveAroundNotAvailableUseChrome",e=[{text:"copylink",onclick:R}]);M.call(this,{messageType:"arMoveAroundNotAvailable",title:null,message:d,buttons:e});this.apiCore.exec(this.callerName,"arErrorMessageDisplayed",712)};u.prototype.displayShoeArUnavailableMessage=function(){M.call(this,{messageType:"useOtherBrowsers",title:"shoeArUnavailable",message:"shoeArCannotSupportBrowser",
messageMultiLine:!0,quitCallback:null,buttons:[{text:"copylink",onclick:R}]});this.apiCore.exec(this.callerName,"arErrorMessageDisplayed",713)};u.prototype.displayRequestingCameraMessage=function(b){M.call(this,{messageType:"requestCameraAccess",title:"requestingCameraAccessTitle",message:"requestingCameraAccessMessage",quitCallback:b,buttons:[]})};u.prototype.displayWearableArPrivacyPolicyMessage=function(b,d){U.call(this,b,d,!0)};u.prototype.displayEmersyaArPrivacyPolicyMessage=function(b,d){U.call(this,
b,d,!1)};var U=function(b,d,e){e=void 0===e?!1:e;var f=null,g=null,h=null,k=null;if(0<this.settings.customPrivacyPolicyValidationMessageNotTranslated.length){k=this.settings.customPrivacyPolicyValidationMessageNotTranslated;h="ViewerSettings";var l="ar_custom_privacy_policy_validation_message"}else l="continue";var m=e?this.settings.customWearablePrivacyPolicyMessageNotTranslated:this.settings.customEmersyaPrivacyPolicyMessageNotTranslated;this.settings.enableCustomPrivacyPolicyMessage&&0<m.length?
(f=m,g="ViewerSettings",m=e?"ar_wearable_custom_privacy_policy_message":"ar_custom_emersya_privacy_policy_message"):m=e?"arWearablePrivacyPolicyMessage":"arEmersyaPrivacyPolicyMessage";M.call(this,{messageType:e?"arWearablePrivacyPolicyWarning":"arEmersyaPrivacyPolicyWarning",title:e?"arWearablePrivacyPolicyWarning":"arEmersyaPrivacyPolicyWarning",message:m,messageMarkdown:!0,messageCategory:g,messageDefaultValue:f,quitCallback:d,buttons:[{textCategory:h,textDefaultValue:k,text:l,onclick:b}]})},R=
function(){var b=document.createElement("input");b.contentEditable=!0;b.readOnly=!0;text=window.location!=window.parent.location?document.referrer:document.location.href;document.body.appendChild(b);b.value=text;this.device.isIos?b.setSelectionRange(0,999999):b.select();document.execCommand("copy");b.remove();(this.browser.isChrome||this.browser.isEdge||this.browser.isFirefox)&&this.device.isIos?setTimeout(function(){alert("Link copied")},10):alert("Link copied")},aa=function(){document.location.reload(!0)},
C=function(){this.device.arForced=!0;this.apiCore.exec(this.callerName,"startEmersyaAr")},L=function(){if(this.settings.shareOnSocialNetwork||this.settings.displayDownloadRenderButton){skel=[{tagName:"div",returnActive:!0,attributes:{klass:"shareArButton",style:{backgroundColor:this.settings.mainColor,"-moz-box-shadow":"0 0 6px rgba("+this.rgba.r+","+this.rgba.g+","+this.rgba.b+","+this.rgba.a/255+")","-webkit-box-shadow":"0 0 6px rgba("+this.rgba.r+","+this.rgba.g+","+this.rgba.b+","+this.rgba.a/
255+")","box-shadow":"0 0 6px rgba("+this.rgba.r+","+this.rgba.g+","+this.rgba.b+","+this.rgba.a/255+")"}},childs:[{tagName:"div",attributes:{klass:"shareArIconContainer",style:{backgroundColor:this.settings.mainColor}},childs:[{tagName:"div",attributes:{klass:"shareArIcon"}}]}],events:[{onEvent:"click",callback:stage.setContext(function(){this.apiCore.exec(this.callerName,"toggleShareButton")},this)}]}];var b=0;this.settings.shareOnSocialNetwork&&(skel[0].childs.unshift(K.call(this,"facebook","\u00e3")),
skel[0].childs.unshift(K.call(this,"twitter","\u00ef")),b+=90);this.settings.displayDownloadRenderButton&&(skel[0].childs.unshift(K.call(this,"download","I")),b+=45);this.shareArButtonContainer=this.parentElement.build(skel);this.shareArButtonContainerStyle={inactive:{height:null},active:{height:this.shareArButtonContainer.getHeight()+b+"px"}};this.apiCore.exec(this.callerName,"lib.insertSvg",this.fullIcons.shareIcon,{});this.settings.displayDownloadRenderButton&&(this.apiCore.exec(this.callerName,
"lib.insertSvg",this.fullIcons.downloadIcon,{}),this.downloadButton=this.shareArButtonContainer.find(".downloadArIcon"));this.settings.shareOnSocialNetwork&&(this.apiCore.exec(this.callerName,"lib.insertSvg",this.fullIcons.facebookIcon,{}),this.apiCore.exec(this.callerName,"lib.insertSvg",this.fullIcons.twitterIcon,{}));this.hideArShareButton()}};u.prototype.toggleShareButton=function(){this.shareArButtonContainer.hasClass("active")?this.apiCore.exec(this.callerName,"foldShareButton"):this.apiCore.exec(this.callerName,
"unfoldShareButton")};u.prototype.foldShareButton=function(){this.shareArButtonContainer&&(this.shareArButtonContainer.css(this.shareArButtonContainerStyle.inactive),this.shareArButtonContainer.removeClass("active"),$$stage(".viewerArContainer .shareArButton .shareArIcon").css("opacity",1),$$stage(".viewerArContainer .shareArButton .facebookArIcon").hide(),$$stage(".viewerArContainer .shareArButton .twitterArIcon").hide(),$$stage(".viewerArContainer .shareArButton .downloadArIcon").hide())};u.prototype.unfoldShareButton=
function(){this.shareArButtonContainer&&(this.shareArButtonContainer.css(this.shareArButtonContainerStyle.active),this.shareArButtonContainer.addClass("active"),$$stage(".viewerArContainer .shareArButton .facebookArIcon").show(),$$stage(".viewerArContainer .shareArButton .twitterArIcon").show(),$$stage(".viewerArContainer .shareArButton .downloadArIcon").show(),$$stage(".viewerArContainer .shareArButton .shareArIcon").css("opacity",.4))};var K=function(b,d){return"download"==b?{tagName:"a",attributes:{klass:b+
"ArIcon",inner:d,download:"emersyaAR.jpeg",target:"_blank"},events:[{onEvent:"click",callback:stage.setContext(function(b,d){d.isTrusted&&!this.isSharing&&(this.isSharing=!0,d.stopPropagation(),d.preventDefault(),this.apiCore.exec(this.callerName,"startSharing"),d=stage.setContext(function(){setTimeout(stage.setContext(function(){this.apiCore.exec(this.callerName,"shareAr",b);this.isSharing=!1},this),10)},this),this.showLoader(d,!1))},this,b)}]}:{tagName:"div",attributes:{klass:b+"ArIcon",inner:d},
events:[{onEvent:"click",callback:stage.setContext(function(b,d){d.isTrusted&&(d.stopPropagation(),d.preventDefault(),this.apiCore.exec(this.callerName,"startSharing"),d=stage.setContext(function(){setTimeout(stage.setContext(function(){this.apiCore.exec(this.callerName,"shareAr",b)},this),10)},this),this.showLoader(d,!1))},this,b)}]}};u.prototype.showArShareButton=function(){this.shareArButtonContainer&&this.shareArButtonContainer.show()};u.prototype.hideArShareButton=function(){this.shareArButtonContainer&&
this.shareArButtonContainer.hide()};var G=function(){if(!this.menuContainer){var b=[{tagName:"div",returnActive:!0,attributes:{klass:"arMenu",style:{}},childs:[{tagName:"div",attributes:{klass:"arMenuIcon quitArIcon"},events:[{onEvent:"click",callback:stage.setContext(function(){this.browser.isChrome&&this.fullscreen?this.toggleFullScreen():(this.apiCore.exec(this.callerName,"stopAr"),this.apiCore.exec(this.callerName,"ui.showMenu"))},this)}]}]}],d="";$$stage(this.parentElement.get(0).parentElement.parentElement).find(".disable3D").get(0)&&
(d=" spaceOnTop");d={tagName:"div",attributes:{klass:"arMenuIcon arHelperIcon"+d},events:[{onEvent:"click",callback:stage.setContext(function(){this.apiCore.exec(this.callerName,"onShowArHelper");this.apiCore.exec(this.callerName,"foldShareButton");this.showArHelper()},this)}]};b[0].childs.push(d);var e=d=!1;if(this.settings.displayPresetMenu&&this.settings.presets&&0<this.settings.presets.length){d=!0;var f={tagName:"div",attributes:{klass:"arMenuIcon arPresetIcon"},events:[{onEvent:"click",callback:stage.setContext(this.togglePresetsMenu,
this)}]};b[0].childs.push(f);f={tagName:"div",attributes:{klass:"arPresetsContainer",style:{}},childs:[{tagName:"div",attributes:{klass:"arPresetsScrollingContainer",style:{width:50*this.settings.presets.length,"min-width":"100%"}},childs:[]}]};for(var g=0;g<this.settings.presets.length;g++){var h=this.settings.presets[g];f.childs[0].childs.push({tagName:"div",attributes:{klass:"presetElem",style:{"background-color":"rgb("+parseInt(255*h.color[0])+","+parseInt(255*h.color[1])+","+parseInt(255*h.color[2])+
")"}},events:[{onEvent:"click",callback:stage.setContext(function(b){this.apiCore.exec(this.callerName,"applyPreset",b.name,[])},this,h)}],childs:[]})}this.settings.displayAnimationMenu&&this.settings.animations&&0<this.settings.animations.length?b.push(f):(f.attributes.style.width="100%",f.attributes.style["background-color"]="rgba(0,0,0,0)",f.attributes.style.transition="none",f.attributes.style["border-bottom"]="none",b[0].attributes.style["border-bottom"]="1px solid #d4dde6",b[0].childs.push(f));
this.apiCore.exec(this.callerName,"addingPresetToArMenu")}this.settings.displayAnimationMenu&&this.settings.animations&&0<this.settings.animations.length&&!this.apiCore.exec(this.callerName,"arControls.isSeparatedTab")&&(e=!0,f={tagName:"div",attributes:{klass:"arMenuIcon arAnimationIcon"},events:[{onEvent:"click",callback:stage.setContext(this.toggleArAnimations,this)}]},b[0].childs.push(f),b.push({tagName:"div",attributes:{klass:"arAnimationsContainer"},childs:[{tagName:"div",attributes:{klass:"arAnimationsScrollingContainer"},
childs:[]}]}));d||e||(b[0].attributes.style["background-color"]="rgba(0,0,0,0)");this.menuContainer=this.parentElement.build(b);this.presetsContainer=this.parentElement.find(".arPresetsContainer");this.animationsContainer=this.parentElement.find(".arAnimationsContainer");this.arAnimationIcon=this.parentElement.find(".arAnimationIcon");this.arMenuQuitIcon=this.parentElement.find(".quitArIcon");this.arHelperIcon=this.parentElement.find(".arHelperIcon");this.arPresetIcon=this.parentElement.find(".arPresetIcon");
this.arAnimationsScrollingContainer=this.parentElement.find(".arAnimationsScrollingContainer");this.apiCore.exec(this.callerName,"lib.insertSvg",this.fullIcons.quitArIcon,{});this.apiCore.exec(this.callerName,"lib.insertSvg",this.fullIcons.arhelperIcon,{});this.apiCore.exec(this.callerName,"lib.insertSvg",this.fullIcons.arPresetIcon,{});this.apiCore.exec(this.callerName,"lib.insertSvg",this.fullIcons.arAnimationIcon,{})}this.settings.displayArMenu?this.showArMenu(!0):this.hideArMenu()},S=function(){if(!this.menuContainer){var b=
[{tagName:"div",returnActive:!0,attributes:{klass:"arMenu wearable"},childs:[{tagName:"div",attributes:{klass:"arMenuIcon quitArIcon"},events:[{onEvent:"click",callback:stage.setContext(function(){this.browser.isChrome&&this.fullscreen?this.toggleFullScreen():(this.apiCore.exec(this.callerName,"stopAr"),this.apiCore.exec(this.callerName,"ui.showMenu"))},this)}]}]}];this.arMenuQuitIcon=this.menuContainer=this.parentElement.build(b);this.apiCore.exec(this.callerName,"lib.insertSvg",this.fullIcons.quitArIcon,
{})}this.hideArMenu()};u.prototype.hideArMenuQuitIcon=function(){this.arMenuQuitIcon&&(this.arMenuQuitIcon.hide(),Y.call(this))};u.prototype.showArMenuQuitIcon=function(){this.arMenuQuitIcon&&(this.arMenuQuitIcon.show(),Y.call(this))};u.prototype.showArMenu=function(b,d){if(void 0===d||!d||this.settings.displayArMenu)this.apiCore.exec(this.callerName,"ui.hideMenu"),"wearable"!==this.settings.arType&&this.apiCore.exec(this.callerName,"ui.disableMenu"),this.menuContainer&&this.menuContainer.show(),
b?this.hideArMenuQuitIcon():this.showArMenuQuitIcon(),this.settings.displayPresetMenu&&this.settings.presets&&0<this.settings.presets.length&&(this.togglePresetsMenu(!0),Y.call(this))};u.prototype.hideArMenu=function(){this.menuContainer&&this.menuContainer.hide()};u.prototype.togglePresetsMenu=function(b){b&&"boolean"!=typeof b&&(b=void 0);void 0!=b?b?this.showArPresets():this.hideArPresets():this.presetsContainerVisible?this.hideArPresets():this.showArPresets()};var Y=function(){if(this.presetsContainerVisible&&
0==this.animationsContainer.length){var b=this.arMenuQuitIcon.get(0).clientWidth+this.arHelperIcon.get(0).clientWidth;this.presetsContainer.css({width:"calc(100% - "+b+"px)"})}};u.prototype.showArPresets=function(){this.presetsContainer&&0<this.presetsContainer.length&&(this.hideArAnimations(),this.apiCore.exec(this.callerName,"ui.hidePresets"),this.presetsContainerVisible=!0,this.arPresetIcon.css({"border-bottom":"2px solid"+this.settings.mainColor}),0==this.animationsContainer.length?(this.presetsContainer.css({top:"0px",
opacity:1}),this.arPresetIcon.hide()):(this.arPresetIcon.find("path").get(0).style.fill=this.settings.mainColor,this.presetsContainer.css({top:"50px",opacity:1})))};u.prototype.hideArPresets=function(){this.presetsContainer&&0<this.presetsContainer.length&&(this.arPresetIcon.css({color:"#4f5865","border-bottom":"2px solid rgba(0,0,0,0)"}),this.arPresetIcon.find("path").get(0).style.fill="#4f5865",0!=this.animationsContainer.length&&(this.presetsContainerVisible=!1,this.presetsContainer.css({top:"0px",
opacity:0})))};u.prototype.updateArAnimations=function(){if(this.animationsContainer&&0<this.animationsContainer.length){for(var b=[],d=0;d<this.settings.animations.length;d++){var e=this.settings.animations[d];e.currentState||(e.currentState=e.stateToLoad?e.stateToLoad:"INITIAL");for(var f=0;f<e.states.length;f++)for(var g=e.states[f],h=0;h<g.animations.length;h++){var k=g.animations[h];k.originState==e.currentState&&b.push({tagName:"div",attributes:{klass:"animationState",inner:k.finalState,style:{border:"1px solid "+
this.settings.mainColor}},events:[{onEvent:"click",callback:stage.setContext(function(b,d){var e=this.apiCore.exec(this.callerName,"rdr.getCurrentScene");this.apiCore.exec(this.callerName,"triggerAnimation",e,b.triggerId,stage.emersya.viewer.ANIMATIONS_TRIGGERS.IFRAME);d.currentState=b.finalState},this,k,e)}],childs:[]})}}0<b.length&&this.arAnimationsScrollingContainer.empty().build(b)}};u.prototype.toggleArAnimations=function(){this.animationsContainerVisible?this.hideArAnimations():this.showArAnimations()};
u.prototype.showArAnimations=function(){this.animationsContainer&&0<this.animationsContainer.length&&(this.hideArPresets(),this.updateArAnimations(),this.arAnimationIcon.css({"border-bottom":"2px solid "+this.settings.mainColor}),this.arAnimationIcon.find("path").get(0).style.fill=this.settings.mainColor,this.animationsContainerVisible=!0,this.animationsContainer.css({top:"50px",opacity:1}))};u.prototype.hideArAnimations=function(){this.animationsContainer&&0<this.animationsContainer.length&&(this.animationsContainerVisible=
!1,this.animationsContainer.css({top:"0px",opacity:0}),this.arAnimationIcon.css({"border-bottom":"2px solid rgba(0,0,0,0)"}),this.arAnimationIcon.find("path").get(0).style.fill="#4f5865")};var ia=function(){skel=[{tagName:"div",returnActive:!0,attributes:{klass:"arHelper",style:{backgroundColor:this.settings.mainColor}},childs:[{tagName:"div",attributes:{klass:"moveArContainer"},childs:[{tagName:"div",attributes:{klass:"moveArIconTitle"}},{tagName:"div",attributes:{klass:"menuTitle",style:{color:this.settings.secondColor}}},
{tagName:"div",attributes:{klass:"iconContainer"},childs:[{tagName:"div",attributes:{klass:"arHelperMoveIconTouch"}},{tagName:"div",attributes:{klass:"arHelperMoveIcon"}}]}]},{tagName:"div",attributes:{klass:"rotateArContainer"},childs:[{tagName:"div",attributes:{klass:"rotateArIconTitle"}},{tagName:"div",attributes:{klass:"menuTitle",style:{color:this.settings.secondColor}}},{tagName:"div",attributes:{klass:"iconContainer"},childs:[{tagName:"div",attributes:{klass:"arHelperRotateIconTouch"}},{tagName:"div",
attributes:{klass:"arHelperRotateIcon"}}]}]},{tagName:"div",attributes:{klass:"powerbyArContainer"},childs:[{tagName:"a",attributes:{klass:"powerbyArContainerIcon",target:"blank",href:"https://emersya.com/"},childs:[{tagName:"div",attributes:{klass:"emersyaArLogoHelper"}}]}]},{tagName:"div",attributes:{klass:"quitArHelpIcon"},events:[{onEvent:"click",callback:stage.setContext(function(){this.apiCore.exec(this.callerName,"onHideArHelper");this.hideArHelper()},this)}]}]}];this.helperContainer=this.parentElement.build(skel);
this.translatedDomElements["rotateArContainer-menuTitle"]={container:this.helperContainer.find(".rotateArContainer").find(".menuTitle").get(0),value:"rotate"};this.translatedDomElements["moveArContainer-menuTitle"]={container:this.helperContainer.find(".moveArContainer").find(".menuTitle").get(0),value:"translate"};this.apiCore.exec(this.callerName,"lib.insertSvg",this.fullIcons.quitIcon,{mouseOver:!0});this.apiCore.exec(this.callerName,"lib.insertSvg",this.fullIcons.emersyaPoweredByIcon,{});this.apiCore.exec(this.callerName,
"lib.insertSvg",this.fullIcons.rotateIcon,{});this.apiCore.exec(this.callerName,"lib.insertSvg",this.fullIcons.rotateTouch,{});this.apiCore.exec(this.callerName,"lib.insertSvg",this.fullIcons.moveIcon,{});this.apiCore.exec(this.callerName,"lib.insertSvg",this.fullIcons.moveTouch,{});this.device.isMobile?(this.helperContainer.find(".arHelperMoveIcon").hide(),this.helperContainer.find(".arHelperRotateIcon").hide(),this.helperContainer.find(".arHelperZoomIcon").hide()):(this.apiCore.exec(this.callerName,
"lib.insertSvg",this.fullIcons.mouseLeftClic,{}),this.apiCore.exec(this.callerName,"lib.insertSvg",this.fullIcons.mouseRightClic,{}),this.apiCore.exec(this.callerName,"lib.insertSvg",this.fullIcons.mouseWheel,{}));this.hideArHelper()};u.prototype.showArHelper=function(){this.helperContainer&&(this.helperContainer.show(),b.call(this,["rotateArContainer-menuTitle","moveArContainer-menuTitle"]),Y.call(this))};u.prototype.hideArHelper=function(){this.helperContainer&&(this.helperContainer.hide(),Y.call(this))};
u.prototype.hideArInstructionMessageOne=function(){this.arInstructionMessageOne&&this.arInstructionMessageOne.hide()};u.prototype.showArInstructionMessageOne=function(){var d=this;this.hideArInstructionMessageTwo();if(!this.arInstructionMessageOne){var e=this.apiCore.exec(this.callerName,"rdr.getCurrentScene");switch(e.arData.algorithm){case 2:var f="arInstructionOneWorktop";break;case 3:f="arInstructionOneTable";break;case 4:case 5:f="arInstructionOneCeiling";break;default:f="arInstructionOne"}skel=
[{tagName:"div",returnActive:!0,attributes:{klass:"arInstructionMessageOne algorithm"+e.arData.algorithm}}];this.arInstructionMessageOne=this.parentElement.build(skel);this.translatedDomElements.arInstructionMessageOne={container:this.arInstructionMessageOne.get(0),value:f,onUpdated:function(){d.arInstructionMessageOne.css("left",null);d.arInstructionMessageOne.css({left:"calc(50% - "+d.arInstructionMessageOne.get(0).offsetWidth/2+"px)"})}}}this.arInstructionMessageOne.show();b.call(this,["arInstructionMessageOne"])};
u.prototype.hideArInstructionMessageTwo=function(){this.arInstructionMessageTwo&&this.arInstructionMessageTwo.hide()};u.prototype.showArInstructionMessageTwo=function(){var d=this,e=this.apiCore.exec(this.callerName,"rdr.getCurrentScene");this.hideArInstructionMessageOne();this.arInstructionMessageTwo||(skel=[{tagName:"div",returnActive:!0,attributes:{klass:"arInstructionMessageTwo algorithm"+e.arData.algorithm}}],this.arInstructionMessageTwo=this.parentElement.build(skel),this.translatedDomElements.arInstructionMessageTwo=
{container:this.arInstructionMessageTwo.get(0),value:"arInstructionTwo",onUpdated:function(){d.arInstructionMessageTwo.css("left",null);d.arInstructionMessageTwo.css({left:"calc(50% - "+d.arInstructionMessageTwo.get(0).offsetWidth/2+"px)"})}});this.arInstructionMessageTwo.show();b.call(this,["arInstructionMessageTwo"])};u.prototype.showLoader=function(b,d){this.apiCore.exec(this.callerName,"onShowArLoader");this.apiCore.exec(this.callerName,"ui.showBasicLoader",{backgroundColor:this.settings.mainColor,
circleColor:this.settings.secondColor,opacity:.4},!0);b&&setTimeout(b,10)};u.prototype.hideLoader=function(){this.apiCore.exec(this.callerName,"onHideArLoader");this.apiCore.exec(this.callerName,"ui.hideBasicLoader")};return u});stage.provide("emersya.viewer.modules.deviceDetection");stage.require("emersya.viewer.modules.API.core");
stage.register.call(stage.emersya.viewer.modules,"deviceDetection",function(){function b(){var b=this,d;return $jscomp.asyncExecutePromiseGeneratorProgram(function(e){d={video:{}};0<b.device.cameras.back.length?d.video.deviceId={exact:b.device.cameras.back[0].deviceId}:d.video.facingMode={exact:"environment"};return e.return(d)})}function d(){var b=this,d;return $jscomp.asyncExecutePromiseGeneratorProgram(function(e){d={video:{}};0<b.device.cameras.front.length?d.video.deviceId={exact:b.device.cameras.front[0].deviceId}:
d.video.facingMode={ideal:"user"};return e.return(d)})}function u(f){var g=this,e;return $jscomp.asyncExecutePromiseGeneratorProgram(function(k){switch(k.nextAddress){case 1:return f?k.yield(b.call(g),5):k.yield(d.call(g),4);case 4:e=k.yieldResult;k.jumpTo(3);break;case 5:e=k.yieldResult;case 3:return k.return(navigator.mediaDevices.getUserMedia(e))}})}var k={vfov:"",hfov:"",os:""},l=function(b,d){this.settings=stage.extend(!0,{},k,d);this.apiCore=b;this.device=new DeviceDetector(this.settings);this.browser=
this.device.browser;this.wideAngle=!1;this.name=this.callerName="deviceDetection";r.call(this);this.apiCore.register(this,"getDevice",g,!0);this.apiCore.register(this,"getBrowser",q,!0);this.apiCore.register(this,"isArCompatible",t,!0);this.apiCore.register(this,"getCameraStream",u,!0);this.apiCore.register(this,"requestOrientationMotion",D,!0)};l.prototype.destroy=function(){this.apiCore.unregister(this,"getDevice");this.apiCore.unregister(this,"getBrowser");this.apiCore.unregister(this,"isArCompatible");
this.apiCore.unregister(this,"getCameraStream");this.apiCore.unregister(this,"requestOrientationMotion")};var g=function(){this.device||r.call(this);return this.device},q=function(){return this.browser},t=function(){this.apiCore.exec(this.callerName,"onGetARCompatibility",this.device.arCompatible);return this.device.arCompatible},r=function(){this.device.arCompatible=!1;this.device.motionEnabled=!1;this.device.orientationEnabled=!1;this.device.arForced=!1;this.device.detected=!1;f.call(this)},f=function(){this.device.cameras=
{length:this.device.isMobile?1:0,others:[],back:[],front:[]};var b=0;try{navigator.mediaDevices?navigator.mediaDevices.enumerateDevices().then(function(d){var e=!1;0<d.length&&d.forEach(function(f){++b;"videoinput"===f.kind?(++this.device.cameras.length,this.getDeviceOrientationAndMotion||(this.getDeviceOrientationAndMotion=!0,this.device.isMobile&&!this.device.isIos?(n.call(this),B.call(this)):w.call(this),e=!0),f.facingMode&&"environment"==f.facingMode||f.label&&-1!=f.label.search(/rear|back/i)?
this.device.cameras.back.push(f):f.facingMode&&"user"==f.facingMode||f.label&&-1!=f.label.search(/front|face|selfie|ir/i)?this.device.cameras.front.push(f):this.device.cameras.others.push(f)):b==d.length&&0==this.device.cameras.length&&(w.call(this),e=!0)}.bind(this));e||setTimeout(stage.setContext(function(){w.call(this)},this),1)}.bind(this)).catch(function(b){setTimeout(stage.setContext(function(){w.call(this)},this),1)}.bind(this)):setTimeout(stage.setContext(function(){w.call(this)},this),1)}catch(H){setTimeout(stage.setContext(function(){w.call(this)},
this),1)}},n=function(){(new Promise(function(b,d){this.canGetDeviceOrientation=stage.setContext(b,this,!0);window.addEventListener("deviceorientation",this.canGetDeviceOrientation,!1);setTimeout(stage.setContext(b,this,!1),0<this.device.cameras.length?1E4:100)}.bind(this))).then(function(b){this.device.orientationEnabled=b;w.call(this);window.removeEventListener("deviceorientation",this.canGetDeviceOrientation,!1)}.bind(this))},B=function(){(new Promise(function(b,d){this.canGetDeviceMotion=stage.setContext(b,
this,!0);window.addEventListener("devicemotion",this.canGetDeviceMotion,!1);setTimeout(stage.setContext(b,this,!1),0<this.device.cameras.length?1E4:100)}.bind(this))).then(function(b){this.device.motionEnabled=b;w.call(this);window.removeEventListener("devicemotion",this.canGetDeviceMotion,!1)}.bind(this))},w=function(){this.device.isIos?this.device.arCompatible=!0:0<this.device.cameras.length&&(this.device.motionEnabled||this.device.orientationEnabled)&&!this.browser.isEdge&&!this.browser.isOpera&&
(this.device.arCompatible=!0);this.device.detected=!0;this.apiCore.exec(this.callerName,"deviceDetected")},D=function(){var b=this;window.DeviceOrientationEvent&&window.DeviceOrientationEvent.requestPermission&&window.DeviceOrientationEvent.requestPermission().then(function(d){"granted"==d?(b.device.motionEnabled=!0,b.device.orientationEnabled=!0):b.apiCore.exec(b.callerName,"showIosClearCacheMessage")})};return l});stage.provide("emersya.viewer.modules.sharingManager");
stage.register.call(stage.emersya.viewer.modules,"sharingManager",function(){var b={popUpWidth:550,popUpHeight:420,facebook:{id:null,fb_autoLogAppEvents:!0,fb_xfbml:!0,fb_version:"v3.2"}},d=function(d,k){this.settings=stage.extend({},b,k);this.apiCore=d;this.callerName=this.name="sharingManager";this.apiCore.register(this,"shareOnFacebook",shareOnFacebook);this.apiCore.register(this,"shareOnTwitter",shareOnTwitter);this.apiCore.register(this,"shareOnWhatsApp",shareOnWhatsApp);this.apiCore.register(this,
"shareOnReddit",shareOnReddit);this.apiCore.register(this,"shareOnPinterest",shareOnPinterest);this.apiCore.register(this,"shareWithWebShareAPI",shareWithWebShareAPI)};d.prototype.destroy=function(){this.apiCore.unregister(this,"shareOnFacebook");this.apiCore.unregister(this,"shareOnTwitter");this.apiCore.unregister(this,"shareOnWhatsApp");this.apiCore.unregister(this,"shareOnReddit");this.apiCore.unregister(this,"shareOnPinterest");this.apiCore.unregister(this,"shareWithWebShareAPI")};shareOnFacebook=
function(b){b=createSocialPopUp.call(this,encodeURI("https://www.facebook.com/sharer/sharer.php?u="+b));this.apiCore.exec(this.callerName,"shareOnFacebookSuccess",b)};shareOnTwitter=function(b,d,l){var g="https://twitter.com/intent/tweet?",k=[];l&&k.push("text="+l);d&&k.push("hashtags="+d.join(","));b&&k.push("url="+b);g+=k.join("&");b=createSocialPopUp.call(this,encodeURI(g));this.apiCore.exec(this.callerName,"shareOnTwitterSuccess",b)};shareOnLinkedIn=function(b){createSocialPopUp.call(this,encodeURI("https://www.linkedin.com/shareArticle?mini=true&url="+
b))};shareOnWhatsApp=function(b){createSocialPopUp.call(this,encodeURI("https://wa.me/?text="+b))};shareOnReddit=function(b){createSocialPopUp.call(this,encodeURI("https://www.reddit.com/submit?url="+b))};shareOnPinterest=function(b){createSocialPopUp.call(this,encodeURI("http://pinterest.com/pin/create/button/?url="+b))};shareWithWebShareAPI=function(b,d,l){navigator.share?navigator.share({title:d?d:null,text:l?l:null,url:b}).then(function(){console.log("Successful share")}).catch(function(b){console.log("Error sharing",
b)}):console.log("Your device/navigator does not support the Web Share API")};createSocialPopUp=function(b){return window.open(b,null,"scrollbars=yes,resizable=yes,toolbar=no,location=yes,width="+this.settings.popUpWidth+",height="+this.settings.popUpHeight+",left="+(Math.round((window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width)/2)-Math.round(this.settings.popUpWidth/2)+(void 0!=window.screenLeft?window.screenLeft:screen.left))+
",top="+(Math.round((window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height)/2)-Math.round(this.settings.popUpHeight/2)+(void 0!=window.screenTop?window.screenTop:screen.top)))};return d});
